var jj=Object.defineProperty;var zj=(xi,Qn,Un)=>Qn in xi?jj(xi,Qn,{enumerable:!0,configurable:!0,writable:!0,value:Un}):xi[Qn]=Un;var Bt=(xi,Qn,Un)=>zj(xi,typeof Qn!="symbol"?Qn+"":Qn,Un);(function(){"use strict";const xi=new Set,Qn={emit(t,e,n,r,i){Qn.invoke(Dv(t,e,n,r,i))},invoke(t){xi.forEach(e=>e.handle(t))},connect(t){xi.add(t)},disconnect(t){xi.delete(t)}};var Un=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ho(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function iv(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Rp={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Un,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Rp);var sv=Rp.exports,Sp=ho(sv),Op={};(function(t){var e=Un&&Un.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,p;d<h;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,b=l.addAdverb,_=b===void 0?!1:b,v=e(e(e([],e([],Array(m),!0).map(function(T){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),_?[n(t.adverbs)]:[],!0);return h&&(v=v.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),v.join(f)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return t.adjectives.length*f*t.nouns.length*t.verbs.length*(h?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(t.adjectives).length*f+f*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(h?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(t.adjectives).length*f+f*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(h?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(Op);var Ip=ho(Op);const ov="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let av=t=>crypto.getRandomValues(new Uint8Array(t)),cv=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},Np=(t,e=21)=>cv(t,e,av),lv=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=ov[n[t]&63];return e};var Cp="abcdefghijklmnopqrstuvwxyz",Lp="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Mp="0123456789",uv="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",hv="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const fv=Mp,dv=Cp,pv=Lp;var mv=fv+dv+pv,bh={lowercase:Cp,uppercase:Lp,numbers:Mp,nolookalikes:uv,nolookalikesSafe:hv,alphanumeric:mv};function ze(){return`sid_${lv(12).replaceAll("-",".")}`}Np(bh.numbers,4),Np(`${bh.numbers}${bh.lowercase}`,16);function Fn(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function gv(){return Ip({capitalize:!1,adjectiveCount:1})}function _v(){return Ip({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var yv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),bv=Object.prototype.hasOwnProperty;function wh(t,e){return bv.call(t,e)}function xh(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)wh(t,i)&&r.push(i);return r}function Bn(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Eh(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Rs(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Up(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function vh(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(vh(t[e]))return!0}else if(typeof t=="object"){for(var r=xh(t),i=r.length,s=0;s<i;s++)if(vh(t[r[s]]))return!0}}return!1}function Fp(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Bp=function(t){yv(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,Fp(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Fp(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),Fe=Bp,wv=Bn,fo={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=Yc(n,this.path);r&&(r=Bn(r));var i=Ss(n,{op:"remove",path:this.from}).removed;return Ss(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=Yc(n,this.from);return Ss(n,{op:"add",path:this.path,value:Bn(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:ba(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},xv={add:function(t,e,n){return Eh(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:fo.move,copy:fo.copy,test:fo.test,_get:fo._get};function Yc(t,e){if(e=="")return t;var n={op:"_get",path:e};return Ss(t,n),n.value}function Ss(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):Vc(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=Yc(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=ba(t,e.value),o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new Fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Bn(t));var a=e.path||"",c=a.split("/"),l=t,u=1,f=c.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=Vc;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Up(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!Eh(h))throw new Fe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);Eh(h)&&(h=~~h)}if(u>=f){if(n&&e.op==="add"&&h>l.length)throw new Fe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=xv[e.op].call(e,l,h,t);if(o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=f){var o=fo[e.op].call(e,l,h,t);if(o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Fe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function kh(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new Fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Bn(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=Ss(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function Ev(t,e,n){var r=Ss(t,e);if(r.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function Vc(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new Fe("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(fo[t.op]){if(typeof t.path!="string")throw new Fe("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Fe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Fe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&vh(t.value))throw new Fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Fe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new Fe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Pp([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Fe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new Fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Pp(t,e,n){try{if(!Array.isArray(t))throw new Fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)kh(Bn(e),Bn(t),n||!0);else{n=n||Vc;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof Fe)return i;throw i}}function ba(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!ba(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ba(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var vv=Object.freeze({__proto__:null,JsonPatchError:Fe,_areEquals:ba,applyOperation:Ss,applyPatch:kh,applyReducer:Ev,deepClone:wv,getValueByPointer:Yc,validate:Pp,validator:Vc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Th=new WeakMap,kv=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),Tv=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function Av(t){return Th.get(t)}function Rv(t,e){return t.observers.get(e)}function Sv(t,e){t.observers.delete(e.callback)}function Ov(t,e){e.unobserve()}function Iv(t,e){var n=[],r,i=Av(t);if(!i)i=new kv(t),Th.set(t,i);else{var s=Rv(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Bn(t),e){r.callback=e,r.next=null;var o=function(){Ah(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){Ah(r),clearTimeout(r.next),Sv(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new Tv(e,r)),r}function Ah(t,e){e===void 0&&(e=!1);var n=Th.get(t.object);Rh(n.value,t.object,t.patches,"",e),t.patches.length&&kh(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function Rh(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=xh(e),o=xh(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(wh(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var f=e[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?Rh(u,f,n,r+"/"+Rs(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+Rs(l),value:Bn(u)}),n.push({op:"replace",path:r+"/"+Rs(l),value:Bn(f)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+Rs(l),value:Bn(u)}),n.push({op:"remove",path:r+"/"+Rs(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!wh(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+Rs(l),value:Bn(e[l])})}}}function Dp(t,e,n){n===void 0&&(n=!1);var r=[];return Rh(t,e,r,"",n),r}var Nv=Object.freeze({__proto__:null,compare:Dp,generate:Ah,observe:Iv,unobserve:Ov});Object.assign({},vv,Nv,{JsonPatchError:Bp,deepClone:Bn,escapePathComponent:Rs,unescapePathComponent:Up});var Cv=typeof Element<"u",Lv=typeof Map=="function",Mv=typeof Set=="function",Uv=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Zc(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!Zc(t[r],e[r]))return!1;return!0}var s;if(Lv&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!Zc(r.value[1],e.get(r.value[0])))return!1;return!0}if(Mv&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(Uv&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(Cv&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!Zc(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var Fv=function(e,n){try{return Zc(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},Bv=ho(Fv);function x(t){return t!=null}const pr=Object.keys;function tr(t){return Bn(t)}function Pv(t){return typeof t=="boolean"}function kt(t){return typeof t=="number"&&isNaN(t)===!1}function gt(t){return typeof t=="string"}function ue(t){return Array.isArray(t)}function Sh(t){return t}var At=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(At||{}),Ut=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(Ut||{}),Pn=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(Pn||{}),dt=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.PLAYER=18]="PLAYER",t[t.FIND=19]="FIND",t[t.FLEE=20]="FLEE",t[t.TO=21]="TO",t[t.MID=22]="MID",t[t.OVER=23]="OVER",t[t.UNDER=24]="UNDER",t))(dt||{}),vt=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.HOTKEY=11]="HOTKEY",t[t.COPYIT=12]="COPYIT",t[t.OPENIT=13]="OPENIT",t[t.ZSSEDIT=14]="ZSSEDIT",t[t.CHAREDIT=15]="CHAREDIT",t[t.COLOREDIT=16]="COLOREDIT",t))(vt||{});function It(t){return(t==null?void 0:t.toLowerCase().trim())??""}function Dv(t,e,n,r,i){return{session:t,player:e,id:ze(),sender:n,target:r,data:i}}function er(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function po(t,e=[],n=Sh,r=""){const i=ze(),s=It(t),o=e.map(It);let a=r;const c={id(){return i},name(){return t},session(l){return x(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,f){Qn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=er(l.target),d=It(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&x(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return Qn.connect(c),c}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const $v=4,$p=0,jp=1,jv=2;function mo(t){let e=t.length;for(;--e>=0;)t[e]=0}const zv=0,zp=1,Kv=2,Wv=3,Hv=258,Oh=29,wa=256,xa=wa+1+Oh,go=30,Ih=19,Kp=2*xa+1,Os=15,Nh=16,Gv=7,Ch=256,Wp=16,Hp=17,Gp=18,Lh=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Xc=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Yv=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Yp=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vv=512,Ei=new Array((xa+2)*2);mo(Ei);const Ea=new Array(go*2);mo(Ea);const va=new Array(Vv);mo(va);const ka=new Array(Hv-Wv+1);mo(ka);const Mh=new Array(Oh);mo(Mh);const qc=new Array(go);mo(qc);function Uh(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let Vp,Zp,Xp;function Fh(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const qp=t=>t<256?va[t]:va[256+(t>>>7)],Ta=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},Dn=(t,e,n)=>{t.bi_valid>Nh-n?(t.bi_buf|=e<<t.bi_valid&65535,Ta(t,t.bi_buf),t.bi_buf=e>>Nh-t.bi_valid,t.bi_valid+=n-Nh):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Gr=(t,e,n)=>{Dn(t,n[e*2],n[e*2+1])},Jp=(t,e)=>{let n=0;do n|=t&1,t>>>=1,n<<=1;while(--e>0);return n>>>1},Zv=t=>{t.bi_valid===16?(Ta(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},Xv=(t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,f,d,h,p,m=0;for(d=0;d<=Os;d++)t.bl_count[d]=0;for(n[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<Kp;l++)u=t.heap[l],d=n[n[u*2+1]*2+1]+1,d>c&&(d=c,m++),n[u*2+1]=d,!(u>r)&&(t.bl_count[d]++,h=0,u>=a&&(h=o[u-a]),p=n[u*2],t.opt_len+=p*(d+h),s&&(t.static_len+=p*(i[u*2+1]+h)));if(m!==0){do{for(d=c-1;t.bl_count[d]===0;)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[c]--,m-=2}while(m>0);for(d=c;d!==0;d--)for(u=t.bl_count[d];u!==0;)f=t.heap[--l],!(f>r)&&(n[f*2+1]!==d&&(t.opt_len+=(d-n[f*2+1])*n[f*2],n[f*2+1]=d),u--)}},Qp=(t,e,n)=>{const r=new Array(Os+1);let i=0,s,o;for(s=1;s<=Os;s++)i=i+n[s-1]<<1,r[s]=i;for(o=0;o<=e;o++){let a=t[o*2+1];a!==0&&(t[o*2]=Jp(r[a]++,a))}},qv=()=>{let t,e,n,r,i;const s=new Array(Os+1);for(n=0,r=0;r<Oh-1;r++)for(Mh[r]=n,t=0;t<1<<Lh[r];t++)ka[n++]=r;for(ka[n-1]=r,i=0,r=0;r<16;r++)for(qc[r]=i,t=0;t<1<<Xc[r];t++)va[i++]=r;for(i>>=7;r<go;r++)for(qc[r]=i<<7,t=0;t<1<<Xc[r]-7;t++)va[256+i++]=r;for(e=0;e<=Os;e++)s[e]=0;for(t=0;t<=143;)Ei[t*2+1]=8,t++,s[8]++;for(;t<=255;)Ei[t*2+1]=9,t++,s[9]++;for(;t<=279;)Ei[t*2+1]=7,t++,s[7]++;for(;t<=287;)Ei[t*2+1]=8,t++,s[8]++;for(Qp(Ei,xa+1,s),t=0;t<go;t++)Ea[t*2+1]=5,Ea[t*2]=Jp(t,5);Vp=new Uh(Ei,Lh,wa+1,xa,Os),Zp=new Uh(Ea,Xc,0,go,Os),Xp=new Uh(new Array(0),Yv,0,Ih,Gv)},tm=t=>{let e;for(e=0;e<xa;e++)t.dyn_ltree[e*2]=0;for(e=0;e<go;e++)t.dyn_dtree[e*2]=0;for(e=0;e<Ih;e++)t.bl_tree[e*2]=0;t.dyn_ltree[Ch*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},em=t=>{t.bi_valid>8?Ta(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},nm=(t,e,n,r)=>{const i=e*2,s=n*2;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},Bh=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&nm(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!nm(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},rm=(t,e,n)=>{let r,i,s=0,o,a;if(t.sym_next!==0)do r=t.pending_buf[t.sym_buf+s++]&255,r+=(t.pending_buf[t.sym_buf+s++]&255)<<8,i=t.pending_buf[t.sym_buf+s++],r===0?Gr(t,i,e):(o=ka[i],Gr(t,o+wa+1,e),a=Lh[o],a!==0&&(i-=Mh[o],Dn(t,i,a)),r--,o=qp(r),Gr(t,o,n),a=Xc[o],a!==0&&(r-=qc[o],Dn(t,r,a)));while(s<t.sym_next);Gr(t,Ch,e)},Ph=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,c=-1,l;for(t.heap_len=0,t.heap_max=Kp,o=0;o<s;o++)n[o*2]!==0?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):n[o*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=r[l*2+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)Bh(t,n,o);l=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Bh(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[l*2]=n[o*2]+n[a*2],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[o*2+1]=n[a*2+1]=l,t.heap[1]=l++,Bh(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Xv(t,e),Qp(n,c,t.bl_count)},im=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),e[(n+1)*2+1]=65535,r=0;r<=n;r++)s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)&&(a<l?t.bl_tree[s*2]+=a:s!==0?(s!==i&&t.bl_tree[s*2]++,t.bl_tree[Wp*2]++):a<=10?t.bl_tree[Hp*2]++:t.bl_tree[Gp*2]++,a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4))},sm=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),r=0;r<=n;r++)if(s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)){if(a<l)do Gr(t,s,t.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Gr(t,s,t.bl_tree),a--),Gr(t,Wp,t.bl_tree),Dn(t,a-3,2)):a<=10?(Gr(t,Hp,t.bl_tree),Dn(t,a-3,3)):(Gr(t,Gp,t.bl_tree),Dn(t,a-11,7));a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4)}},Jv=t=>{let e;for(im(t,t.dyn_ltree,t.l_desc.max_code),im(t,t.dyn_dtree,t.d_desc.max_code),Ph(t,t.bl_desc),e=Ih-1;e>=3&&t.bl_tree[Yp[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},Qv=(t,e,n,r)=>{let i;for(Dn(t,e-257,5),Dn(t,n-1,5),Dn(t,r-4,4),i=0;i<r;i++)Dn(t,t.bl_tree[Yp[i]*2+1],3);sm(t,t.dyn_ltree,e-1),sm(t,t.dyn_dtree,n-1)},tk=t=>{let e=4093624447,n;for(n=0;n<=31;n++,e>>>=1)if(e&1&&t.dyn_ltree[n*2]!==0)return $p;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return jp;for(n=32;n<wa;n++)if(t.dyn_ltree[n*2]!==0)return jp;return $p};let om=!1;const ek=t=>{om||(qv(),om=!0),t.l_desc=new Fh(t.dyn_ltree,Vp),t.d_desc=new Fh(t.dyn_dtree,Zp),t.bl_desc=new Fh(t.bl_tree,Xp),t.bi_buf=0,t.bi_valid=0,tm(t)},am=(t,e,n,r)=>{Dn(t,(zv<<1)+(r?1:0),3),em(t),Ta(t,n),Ta(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n},nk=t=>{Dn(t,zp<<1,3),Gr(t,Ch,Ei),Zv(t)},rk=(t,e,n,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===jv&&(t.strm.data_type=tk(t)),Ph(t,t.l_desc),Ph(t,t.d_desc),o=Jv(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?am(t,e,n,r):t.strategy===$v||s===i?(Dn(t,(zp<<1)+(r?1:0),3),rm(t,Ei,Ea)):(Dn(t,(Kv<<1)+(r?1:0),3),Qv(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),rm(t,t.dyn_ltree,t.dyn_dtree)),tm(t),r&&em(t)},ik=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[n*2]++:(t.matches++,e--,t.dyn_ltree[(ka[n]+wa+1)*2]++,t.dyn_dtree[qp(e)*2]++),t.sym_next===t.sym_end);var sk=ek,ok=am,ak=rk,ck=ik,lk=nk,uk={_tr_init:sk,_tr_stored_block:ok,_tr_flush_block:ak,_tr_tally:ck,_tr_align:lk},Aa=(t,e,n,r)=>{let i=t&65535|0,s=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const hk=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},fk=new Uint32Array(hk());var an=(t,e,n,r)=>{const i=fk,s=r+n;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[(t^e[o])&255];return t^-1},Is={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ns={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:dk,_tr_stored_block:Dh,_tr_flush_block:pk,_tr_tally:Zi,_tr_align:mk}=uk,{Z_NO_FLUSH:Xi,Z_PARTIAL_FLUSH:gk,Z_FULL_FLUSH:_k,Z_FINISH:mr,Z_BLOCK:cm,Z_OK:dn,Z_STREAM_END:lm,Z_STREAM_ERROR:Yr,Z_DATA_ERROR:yk,Z_BUF_ERROR:$h,Z_DEFAULT_COMPRESSION:bk,Z_FILTERED:wk,Z_HUFFMAN_ONLY:Jc,Z_RLE:xk,Z_FIXED:Ek,Z_DEFAULT_STRATEGY:vk,Z_UNKNOWN:kk,Z_DEFLATED:Qc}=Ns,Tk=9,Ak=15,Rk=8,jh=256+1+29,Sk=30,Ok=19,Ik=2*jh+1,Nk=15,Zt=3,qi=258,Vr=qi+Zt+1,Ck=32,_o=42,zh=57,Kh=69,Wh=73,Hh=91,Gh=103,Cs=113,Ra=666,An=1,yo=2,Ls=3,bo=4,Lk=3,Ms=(t,e)=>(t.msg=Is[e],e),um=t=>t*2-(t>4?9:0),Ji=t=>{let e=t.length;for(;--e>=0;)t[e]=0},Mk=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do n=t.head[--r],t.head[r]=n>=i?n-i:0;while(--e);e=i,r=e;do n=t.prev[--r],t.prev[r]=n>=i?n-i:0;while(--e)};let Qi=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const nr=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},rr=(t,e)=>{pk(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,nr(t.strm)},ce=(t,e)=>{t.pending_buf[t.pending++]=e},Sa=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},Yh=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=Aa(t.adler,e,i,n):t.state.wrap===2&&(t.adler=an(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},hm=(t,e)=>{let n=t.max_chain_length,r=t.strstart,i,s,o=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-Vr?t.strstart-(t.w_size-Vr):0,l=t.window,u=t.w_mask,f=t.prev,d=t.strstart+qi;let h=l[r+o-1],p=l[r+o];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,!(l[i+o]!==p||l[i+o-1]!==h||l[i]!==l[r]||l[++i]!==l[r+1])){r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<d);if(s=qi-(d-r),r=d-qi,s>o){if(t.match_start=e,o=s,s>=a)break;h=l[r+o-1],p=l[r+o]}}while((e=f[e&u])>c&&--n!==0);return o<=t.lookahead?o:t.lookahead},wo=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Vr)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),Mk(t),r+=e),t.strm.avail_in===0)break;if(n=Yh(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=Zt)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Qi(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Qi(t,t.ins_h,t.window[i+Zt-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<Zt)););}while(t.lookahead<Vr&&t.strm.avail_in!==0)},fm=(t,e)=>{let n=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r,i,s,o=0,a=t.strm.avail_in;do{if(r=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,i=t.strstart-t.block_start,r>i+t.strm.avail_in&&(r=i+t.strm.avail_in),r>s&&(r=s),r<n&&(r===0&&e!==mr||e===Xi||r!==i+t.strm.avail_in)))break;o=e===mr&&r===i+t.strm.avail_in?1:0,Dh(t,0,0,o),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,nr(t.strm),i&&(i>r&&(i=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,r-=i),r&&(Yh(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(o===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?bo:e!==Xi&&e!==mr&&t.strm.avail_in===0&&t.strstart===t.block_start?yo:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(Yh(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,n=s>t.w_size?t.w_size:s,i=t.strstart-t.block_start,(i>=n||(i||e===mr)&&e!==Xi&&t.strm.avail_in===0&&i<=s)&&(r=i>s?s:i,o=e===mr&&t.strm.avail_in===0&&r===i?1:0,Dh(t,t.block_start,r,o),t.block_start+=r,nr(t.strm)),o?Ls:An)},Vh=(t,e)=>{let n,r;for(;;){if(t.lookahead<Vr){if(wo(t),t.lookahead<Vr&&e===Xi)return An;if(t.lookahead===0)break}if(n=0,t.lookahead>=Zt&&(t.ins_h=Qi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-Vr&&(t.match_length=hm(t,n)),t.match_length>=Zt)if(r=Zi(t,t.strstart-t.match_start,t.match_length-Zt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Zt){t.match_length--;do t.strstart++,t.ins_h=Qi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Qi(t,t.ins_h,t.window[t.strstart+1]);else r=Zi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(rr(t,!1),t.strm.avail_out===0))return An}return t.insert=t.strstart<Zt-1?t.strstart:Zt-1,e===mr?(rr(t,!0),t.strm.avail_out===0?Ls:bo):t.sym_next&&(rr(t,!1),t.strm.avail_out===0)?An:yo},xo=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<Vr){if(wo(t),t.lookahead<Vr&&e===Xi)return An;if(t.lookahead===0)break}if(n=0,t.lookahead>=Zt&&(t.ins_h=Qi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Zt-1,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Vr&&(t.match_length=hm(t,n),t.match_length<=5&&(t.strategy===wk||t.match_length===Zt&&t.strstart-t.match_start>4096)&&(t.match_length=Zt-1)),t.prev_length>=Zt&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-Zt,r=Zi(t,t.strstart-1-t.prev_match,t.prev_length-Zt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Qi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=Zt-1,t.strstart++,r&&(rr(t,!1),t.strm.avail_out===0))return An}else if(t.match_available){if(r=Zi(t,0,t.window[t.strstart-1]),r&&rr(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return An}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Zi(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Zt-1?t.strstart:Zt-1,e===mr?(rr(t,!0),t.strm.avail_out===0?Ls:bo):t.sym_next&&(rr(t,!1),t.strm.avail_out===0)?An:yo},Uk=(t,e)=>{let n,r,i,s;const o=t.window;for(;;){if(t.lookahead<=qi){if(wo(t),t.lookahead<=qi&&e===Xi)return An;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Zt&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+qi;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);t.match_length=qi-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Zt?(n=Zi(t,1,t.match_length-Zt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Zi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(rr(t,!1),t.strm.avail_out===0))return An}return t.insert=0,e===mr?(rr(t,!0),t.strm.avail_out===0?Ls:bo):t.sym_next&&(rr(t,!1),t.strm.avail_out===0)?An:yo},Fk=(t,e)=>{let n;for(;;){if(t.lookahead===0&&(wo(t),t.lookahead===0)){if(e===Xi)return An;break}if(t.match_length=0,n=Zi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(rr(t,!1),t.strm.avail_out===0))return An}return t.insert=0,e===mr?(rr(t,!0),t.strm.avail_out===0?Ls:bo):t.sym_next&&(rr(t,!1),t.strm.avail_out===0)?An:yo};function Zr(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const Oa=[new Zr(0,0,0,0,fm),new Zr(4,4,8,4,Vh),new Zr(4,5,16,8,Vh),new Zr(4,6,32,32,Vh),new Zr(4,4,16,16,xo),new Zr(8,16,32,32,xo),new Zr(8,16,128,128,xo),new Zr(8,32,128,256,xo),new Zr(32,128,258,1024,xo),new Zr(32,258,258,4096,xo)],Bk=t=>{t.window_size=2*t.w_size,Ji(t.head),t.max_lazy_match=Oa[t.level].max_lazy,t.good_match=Oa[t.level].good_length,t.nice_match=Oa[t.level].nice_length,t.max_chain_length=Oa[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Zt-1,t.match_available=0,t.ins_h=0};function Pk(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Qc,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Ik*2),this.dyn_dtree=new Uint16Array((2*Sk+1)*2),this.bl_tree=new Uint16Array((2*Ok+1)*2),Ji(this.dyn_ltree),Ji(this.dyn_dtree),Ji(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Nk+1),this.heap=new Uint16Array(2*jh+1),Ji(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*jh+1),Ji(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ia=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==_o&&e.status!==zh&&e.status!==Kh&&e.status!==Wh&&e.status!==Hh&&e.status!==Gh&&e.status!==Cs&&e.status!==Ra?1:0},dm=t=>{if(Ia(t))return Ms(t,Yr);t.total_in=t.total_out=0,t.data_type=kk;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?zh:e.wrap?_o:Cs,t.adler=e.wrap===2?0:1,e.last_flush=-2,dk(e),dn},pm=t=>{const e=dm(t);return e===dn&&Bk(t.state),e},Dk=(t,e)=>Ia(t)||t.state.wrap!==2?Yr:(t.state.gzhead=e,dn),mm=(t,e,n,r,i,s)=>{if(!t)return Yr;let o=1;if(e===bk&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>Tk||n!==Qc||r<8||r>15||e<0||e>9||s<0||s>Ek||r===8&&o!==1)return Ms(t,Yr);r===8&&(r=9);const a=new Pk;return t.state=a,a.strm=t,a.status=_o,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Zt-1)/Zt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=s,a.method=n,pm(t)},$k=(t,e)=>mm(t,e,Qc,Ak,Rk,vk),jk=(t,e)=>{if(Ia(t)||e>cm||e<0)return t?Ms(t,Yr):Yr;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===Ra&&e!==mr)return Ms(t,t.avail_out===0?$h:Yr);const r=n.last_flush;if(n.last_flush=e,n.pending!==0){if(nr(t),t.avail_out===0)return n.last_flush=-1,dn}else if(t.avail_in===0&&um(e)<=um(r)&&e!==mr)return Ms(t,$h);if(n.status===Ra&&t.avail_in!==0)return Ms(t,$h);if(n.status===_o&&n.wrap===0&&(n.status=Cs),n.status===_o){let i=Qc+(n.w_bits-8<<4)<<8,s=-1;if(n.strategy>=Jc||n.level<2?s=0:n.level<6?s=1:n.level===6?s=2:s=3,i|=s<<6,n.strstart!==0&&(i|=Ck),i+=31-i%31,Sa(n,i),n.strstart!==0&&(Sa(n,t.adler>>>16),Sa(n,t.adler&65535)),t.adler=1,n.status=Cs,nr(t),n.pending!==0)return n.last_flush=-1,dn}if(n.status===zh){if(t.adler=0,ce(n,31),ce(n,139),ce(n,8),n.gzhead)ce(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),ce(n,n.gzhead.time&255),ce(n,n.gzhead.time>>8&255),ce(n,n.gzhead.time>>16&255),ce(n,n.gzhead.time>>24&255),ce(n,n.level===9?2:n.strategy>=Jc||n.level<2?4:0),ce(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(ce(n,n.gzhead.extra.length&255),ce(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=an(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=Kh;else if(ce(n,0),ce(n,0),ce(n,0),ce(n,0),ce(n,0),ce(n,n.level===9?2:n.strategy>=Jc||n.level<2?4:0),ce(n,Lk),n.status=Cs,nr(t),n.pending!==0)return n.last_flush=-1,dn}if(n.status===Kh){if(n.gzhead.extra){let i=n.pending,s=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=a,nr(t),n.pending!==0)return n.last_flush=-1,dn;i=0,s-=a}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=Wh}if(n.status===Wh){if(n.gzhead.name){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i)),nr(t),n.pending!==0)return n.last_flush=-1,dn;i=0}n.gzindex<n.gzhead.name.length?s=n.gzhead.name.charCodeAt(n.gzindex++)&255:s=0,ce(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=Hh}if(n.status===Hh){if(n.gzhead.comment){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i)),nr(t),n.pending!==0)return n.last_flush=-1,dn;i=0}n.gzindex<n.gzhead.comment.length?s=n.gzhead.comment.charCodeAt(n.gzindex++)&255:s=0,ce(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=an(t.adler,n.pending_buf,n.pending-i,i))}n.status=Gh}if(n.status===Gh){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(nr(t),n.pending!==0))return n.last_flush=-1,dn;ce(n,t.adler&255),ce(n,t.adler>>8&255),t.adler=0}if(n.status=Cs,nr(t),n.pending!==0)return n.last_flush=-1,dn}if(t.avail_in!==0||n.lookahead!==0||e!==Xi&&n.status!==Ra){let i=n.level===0?fm(n,e):n.strategy===Jc?Fk(n,e):n.strategy===xk?Uk(n,e):Oa[n.level].func(n,e);if((i===Ls||i===bo)&&(n.status=Ra),i===An||i===Ls)return t.avail_out===0&&(n.last_flush=-1),dn;if(i===yo&&(e===gk?mk(n):e!==cm&&(Dh(n,0,0,!1),e===_k&&(Ji(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),nr(t),t.avail_out===0))return n.last_flush=-1,dn}return e!==mr?dn:n.wrap<=0?lm:(n.wrap===2?(ce(n,t.adler&255),ce(n,t.adler>>8&255),ce(n,t.adler>>16&255),ce(n,t.adler>>24&255),ce(n,t.total_in&255),ce(n,t.total_in>>8&255),ce(n,t.total_in>>16&255),ce(n,t.total_in>>24&255)):(Sa(n,t.adler>>>16),Sa(n,t.adler&65535)),nr(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?dn:lm)},zk=t=>{if(Ia(t))return Yr;const e=t.state.status;return t.state=null,e===Cs?Ms(t,yk):dn},Kk=(t,e)=>{let n=e.length;if(Ia(t))return Yr;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==_o||r.lookahead)return Yr;if(i===1&&(t.adler=Aa(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Ji(r.head),r.strstart=0,r.block_start=0,r.insert=0);let c=new Uint8Array(r.w_size);c.set(e.subarray(n-r.w_size,n),0),e=c,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,wo(r);r.lookahead>=Zt;){let c=r.strstart,l=r.lookahead-(Zt-1);do r.ins_h=Qi(r,r.ins_h,r.window[c+Zt-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++;while(--l);r.strstart=c,r.lookahead=Zt-1,wo(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=Zt-1,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,dn};var Wk=$k,Hk=mm,Gk=pm,Yk=dm,Vk=Dk,Zk=jk,Xk=zk,qk=Kk,Jk="pako deflate (from Nodeca project)",Na={deflateInit:Wk,deflateInit2:Hk,deflateReset:Gk,deflateResetKeep:Yk,deflateSetHeader:Vk,deflate:Zk,deflateEnd:Xk,deflateSetDictionary:qk,deflateInfo:Jk};const Qk=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var tT=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Qk(n,r)&&(t[r]=n[r])}}return t},eT=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let o=t[r];n.set(o,i),i+=o.length}return n},tl={assign:tT,flattenChunks:eT};let gm=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{gm=!1}const Ca=new Uint8Array(256);for(let t=0;t<256;t++)Ca[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Ca[254]=Ca[254]=1;var nT=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|n&63):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|n&63):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|n&63);return e};const rT=(t,e)=>{if(e<65534&&t.subarray&&gm)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var iT=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const s=new Array(n*2);for(i=0,r=0;r<n;){let o=t[r++];if(o<128){s[i++]=o;continue}let a=Ca[o];if(a>4){s[i++]=65533,r+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&r<n;)o=o<<6|t[r++]&63,a--;if(a>1){s[i++]=65533;continue}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023)}return rT(s,i)},sT=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+Ca[t[n]]>e?n:e},La={string2buf:nT,buf2string:iT,utf8border:sT};function oT(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var _m=oT;const ym=Object.prototype.toString,{Z_NO_FLUSH:aT,Z_SYNC_FLUSH:cT,Z_FULL_FLUSH:lT,Z_FINISH:uT,Z_OK:el,Z_STREAM_END:hT,Z_DEFAULT_COMPRESSION:fT,Z_DEFAULT_STRATEGY:dT,Z_DEFLATED:pT}=Ns;function Ma(t){this.options=tl.assign({level:fT,method:pT,chunkSize:16384,windowBits:15,memLevel:8,strategy:dT},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _m,this.strm.avail_out=0;let n=Na.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==el)throw new Error(Is[n]);if(e.header&&Na.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(typeof e.dictionary=="string"?r=La.string2buf(e.dictionary):ym.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,n=Na.deflateSetDictionary(this.strm,r),n!==el)throw new Error(Is[n]);this._dict_set=!0}}Ma.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?uT:aT,typeof t=="string"?n.input=La.string2buf(t):ym.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===cT||s===lT)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(i=Na.deflate(n,s),i===hT)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Na.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===el;if(n.avail_out===0){this.onData(n.output);continue}if(s>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0},Ma.prototype.onData=function(t){this.chunks.push(t)},Ma.prototype.onEnd=function(t){t===el&&(this.result=tl.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Zh(t,e){const n=new Ma(e);if(n.push(t,!0),n.err)throw n.msg||Is[n.err];return n.result}function mT(t,e){return e=e||{},e.raw=!0,Zh(t,e)}function gT(t,e){return e=e||{},e.gzip=!0,Zh(t,e)}var _T=Ma,yT=Zh,bT=mT,wT=gT,xT=Ns,ET={Deflate:_T,deflate:yT,deflateRaw:bT,gzip:wT,constants:xT};const nl=16209,vT=16191;var kT=function(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,b,_,v,T,A,C,R,S,U,I,P;const W=e.state;r=e.next_in,I=e.input,i=r+(e.avail_in-5),s=e.next_out,P=e.output,o=s-(n-e.avail_out),a=s+(e.avail_out-257),c=W.dmax,l=W.wsize,u=W.whave,f=W.wnext,d=W.window,h=W.hold,p=W.bits,m=W.lencode,b=W.distcode,_=(1<<W.lenbits)-1,v=(1<<W.distbits)-1;t:do{p<15&&(h+=I[r++]<<p,p+=8,h+=I[r++]<<p,p+=8),T=m[h&_];e:for(;;){if(A=T>>>24,h>>>=A,p-=A,A=T>>>16&255,A===0)P[s++]=T&65535;else if(A&16){C=T&65535,A&=15,A&&(p<A&&(h+=I[r++]<<p,p+=8),C+=h&(1<<A)-1,h>>>=A,p-=A),p<15&&(h+=I[r++]<<p,p+=8,h+=I[r++]<<p,p+=8),T=b[h&v];n:for(;;){if(A=T>>>24,h>>>=A,p-=A,A=T>>>16&255,A&16){if(R=T&65535,A&=15,p<A&&(h+=I[r++]<<p,p+=8,p<A&&(h+=I[r++]<<p,p+=8)),R+=h&(1<<A)-1,R>c){e.msg="invalid distance too far back",W.mode=nl;break t}if(h>>>=A,p-=A,A=s-o,R>A){if(A=R-A,A>u&&W.sane){e.msg="invalid distance too far back",W.mode=nl;break t}if(S=0,U=d,f===0){if(S+=l-A,A<C){C-=A;do P[s++]=d[S++];while(--A);S=s-R,U=P}}else if(f<A){if(S+=l+f-A,A-=f,A<C){C-=A;do P[s++]=d[S++];while(--A);if(S=0,f<C){A=f,C-=A;do P[s++]=d[S++];while(--A);S=s-R,U=P}}}else if(S+=f-A,A<C){C-=A;do P[s++]=d[S++];while(--A);S=s-R,U=P}for(;C>2;)P[s++]=U[S++],P[s++]=U[S++],P[s++]=U[S++],C-=3;C&&(P[s++]=U[S++],C>1&&(P[s++]=U[S++]))}else{S=s-R;do P[s++]=P[S++],P[s++]=P[S++],P[s++]=P[S++],C-=3;while(C>2);C&&(P[s++]=P[S++],C>1&&(P[s++]=P[S++]))}}else if(A&64){e.msg="invalid distance code",W.mode=nl;break t}else{T=b[(T&65535)+(h&(1<<A)-1)];continue n}break}}else if(A&64)if(A&32){W.mode=vT;break t}else{e.msg="invalid literal/length code",W.mode=nl;break t}else{T=m[(T&65535)+(h&(1<<A)-1)];continue e}break}}while(r<i&&s<a);C=p>>3,r-=C,p-=C<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?5+(i-r):5-(r-i),e.avail_out=s<a?257+(a-s):257-(s-a),W.hold=h,W.bits=p};const Eo=15,bm=852,wm=592,xm=0,Xh=1,Em=2,TT=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),AT=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),RT=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ST=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ua=(t,e,n,r,i,s,o,a)=>{const c=a.bits;let l=0,u=0,f=0,d=0,h=0,p=0,m=0,b=0,_=0,v=0,T,A,C,R,S,U=null,I;const P=new Uint16Array(Eo+1),W=new Uint16Array(Eo+1);let L=null,N,E,D;for(l=0;l<=Eo;l++)P[l]=0;for(u=0;u<r;u++)P[e[n+u]]++;for(h=c,d=Eo;d>=1&&P[d]===0;d--);if(h>d&&(h=d),d===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(f=1;f<d&&P[f]===0;f++);for(h<f&&(h=f),b=1,l=1;l<=Eo;l++)if(b<<=1,b-=P[l],b<0)return-1;if(b>0&&(t===xm||d!==1))return-1;for(W[1]=0,l=1;l<Eo;l++)W[l+1]=W[l]+P[l];for(u=0;u<r;u++)e[n+u]!==0&&(o[W[e[n+u]]++]=u);if(t===xm?(U=L=o,I=20):t===Xh?(U=TT,L=AT,I=257):(U=RT,L=ST,I=0),v=0,u=0,l=f,S=s,p=h,m=0,C=-1,_=1<<h,R=_-1,t===Xh&&_>bm||t===Em&&_>wm)return 1;for(;;){N=l-m,o[u]+1<I?(E=0,D=o[u]):o[u]>=I?(E=L[o[u]-I],D=U[o[u]-I]):(E=96,D=0),T=1<<l-m,A=1<<p,f=A;do A-=T,i[S+(v>>m)+A]=N<<24|E<<16|D|0;while(A!==0);for(T=1<<l-1;v&T;)T>>=1;if(T!==0?(v&=T-1,v+=T):v=0,u++,--P[l]===0){if(l===d)break;l=e[n+o[u]]}if(l>h&&(v&R)!==C){for(m===0&&(m=h),S+=f,p=l-m,b=1<<p;p+m<d&&(b-=P[p+m],!(b<=0));)p++,b<<=1;if(_+=1<<p,t===Xh&&_>bm||t===Em&&_>wm)return 1;C=v&R,i[C]=h<<24|p<<16|S-s|0}}return v!==0&&(i[S+v]=l-m<<24|64<<16|0),a.bits=h,0};const OT=0,vm=1,km=2,{Z_FINISH:Tm,Z_BLOCK:IT,Z_TREES:rl,Z_OK:Us,Z_STREAM_END:NT,Z_NEED_DICT:CT,Z_STREAM_ERROR:gr,Z_DATA_ERROR:Am,Z_MEM_ERROR:Rm,Z_BUF_ERROR:LT,Z_DEFLATED:Sm}=Ns,il=16180,Om=16181,Im=16182,Nm=16183,Cm=16184,Lm=16185,Mm=16186,Um=16187,Fm=16188,Bm=16189,sl=16190,vi=16191,qh=16192,Pm=16193,Jh=16194,Dm=16195,$m=16196,jm=16197,zm=16198,ol=16199,al=16200,Km=16201,Wm=16202,Hm=16203,Gm=16204,Ym=16205,Qh=16206,Vm=16207,Zm=16208,ke=16209,Xm=16210,qm=16211,MT=852,UT=592,FT=15,Jm=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function BT(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Fs=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<il||e.mode>qm?1:0},Qm=t=>{if(Fs(t))return gr;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=il,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(MT),e.distcode=e.distdyn=new Int32Array(UT),e.sane=1,e.back=-1,Us},tg=t=>{if(Fs(t))return gr;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Qm(t)},eg=(t,e)=>{let n;if(Fs(t))return gr;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?gr:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,tg(t))},ng=(t,e)=>{if(!t)return gr;const n=new BT;t.state=n,n.strm=t,n.window=null,n.mode=il;const r=eg(t,e);return r!==Us&&(t.state=null),r},PT=t=>ng(t,FT);let rg=!0,tf,ef;const DT=t=>{if(rg){tf=new Int32Array(512),ef=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Ua(vm,t.lens,0,288,tf,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Ua(km,t.lens,0,32,ef,0,t.work,{bits:5}),rg=!1}t.lencode=tf,t.lenbits=9,t.distcode=ef,t.distbits=5},ig=(t,e,n,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),r-=i,r?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},$T=(t,e)=>{let n,r,i,s,o,a,c,l,u,f,d,h,p,m,b=0,_,v,T,A,C,R,S,U;const I=new Uint8Array(4);let P,W;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Fs(t)||!t.output||!t.input&&t.avail_in!==0)return gr;n=t.state,n.mode===vi&&(n.mode=qh),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,f=a,d=c,U=Us;t:for(;;)switch(n.mode){case il:if(n.wrap===0){n.mode=qh;break}for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&2&&l===35615){n.wbits===0&&(n.wbits=15),n.check=0,I[0]=l&255,I[1]=l>>>8&255,n.check=an(n.check,I,2,0),l=0,u=0,n.mode=Om;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=ke;break}if((l&15)!==Sm){t.msg="unknown compression method",n.mode=ke;break}if(l>>>=4,u-=4,S=(l&15)+8,n.wbits===0&&(n.wbits=S),S>15||S>n.wbits){t.msg="invalid window size",n.mode=ke;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=l&512?Bm:vi,l=0,u=0;break;case Om:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.flags=l,(n.flags&255)!==Sm){t.msg="unknown compression method",n.mode=ke;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=ke;break}n.head&&(n.head.text=l>>8&1),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=an(n.check,I,2,0)),l=0,u=0,n.mode=Im;case Im:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.time=l),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,I[2]=l>>>16&255,I[3]=l>>>24&255,n.check=an(n.check,I,4,0)),l=0,u=0,n.mode=Nm;case Nm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.xflags=l&255,n.head.os=l>>8),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=an(n.check,I,2,0)),l=0,u=0,n.mode=Cm;case Cm:if(n.flags&1024){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=an(n.check,I,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=Lm;case Lm:if(n.flags&1024&&(h=n.length,h>a&&(h=a),h&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+h),S)),n.flags&512&&n.wrap&4&&(n.check=an(n.check,r,h,s)),a-=h,s+=h,n.length-=h),n.length))break t;n.length=0,n.mode=Mm;case Mm:if(n.flags&2048){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=an(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=Um;case Um:if(n.flags&4096){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=an(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.comment=null);n.mode=Fm;case Fm:if(n.flags&512){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.check&65535)){t.msg="header crc mismatch",n.mode=ke;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=vi;break;case Bm:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}t.adler=n.check=Jm(l),l=0,u=0,n.mode=sl;case sl:if(n.havedict===0)return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,CT;t.adler=n.check=1,n.mode=vi;case vi:if(e===IT||e===rl)break t;case qh:if(n.last){l>>>=u&7,u-=u&7,n.mode=Qh;break}for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}switch(n.last=l&1,l>>>=1,u-=1,l&3){case 0:n.mode=Pm;break;case 1:if(DT(n),n.mode=ol,e===rl){l>>>=2,u-=2;break t}break;case 2:n.mode=$m;break;case 3:t.msg="invalid block type",n.mode=ke}l>>>=2,u-=2;break;case Pm:for(l>>>=u&7,u-=u&7;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=ke;break}if(n.length=l&65535,l=0,u=0,n.mode=Jh,e===rl)break t;case Jh:n.mode=Dm;case Dm:if(h=n.length,h){if(h>a&&(h=a),h>c&&(h=c),h===0)break t;i.set(r.subarray(s,s+h),o),a-=h,s+=h,c-=h,o+=h,n.length-=h;break}n.mode=vi;break;case $m:for(;u<14;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.nlen=(l&31)+257,l>>>=5,u-=5,n.ndist=(l&31)+1,l>>>=5,u-=5,n.ncode=(l&15)+4,l>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=ke;break}n.have=0,n.mode=jm;case jm:for(;n.have<n.ncode;){for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.lens[L[n.have++]]=l&7,l>>>=3,u-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,P={bits:n.lenbits},U=Ua(OT,n.lens,0,19,n.lencode,0,n.work,P),n.lenbits=P.bits,U){t.msg="invalid code lengths set",n.mode=ke;break}n.have=0,n.mode=zm;case zm:for(;n.have<n.nlen+n.ndist;){for(;b=n.lencode[l&(1<<n.lenbits)-1],_=b>>>24,v=b>>>16&255,T=b&65535,!(_<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(T<16)l>>>=_,u-=_,n.lens[n.have++]=T;else{if(T===16){for(W=_+2;u<W;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(l>>>=_,u-=_,n.have===0){t.msg="invalid bit length repeat",n.mode=ke;break}S=n.lens[n.have-1],h=3+(l&3),l>>>=2,u-=2}else if(T===17){for(W=_+3;u<W;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=_,u-=_,S=0,h=3+(l&7),l>>>=3,u-=3}else{for(W=_+7;u<W;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=_,u-=_,S=0,h=11+(l&127),l>>>=7,u-=7}if(n.have+h>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=ke;break}for(;h--;)n.lens[n.have++]=S}}if(n.mode===ke)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=ke;break}if(n.lenbits=9,P={bits:n.lenbits},U=Ua(vm,n.lens,0,n.nlen,n.lencode,0,n.work,P),n.lenbits=P.bits,U){t.msg="invalid literal/lengths set",n.mode=ke;break}if(n.distbits=6,n.distcode=n.distdyn,P={bits:n.distbits},U=Ua(km,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,P),n.distbits=P.bits,U){t.msg="invalid distances set",n.mode=ke;break}if(n.mode=ol,e===rl)break t;case ol:n.mode=al;case al:if(a>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,kT(t,d),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,n.mode===vi&&(n.back=-1);break}for(n.back=0;b=n.lencode[l&(1<<n.lenbits)-1],_=b>>>24,v=b>>>16&255,T=b&65535,!(_<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(v&&!(v&240)){for(A=_,C=v,R=T;b=n.lencode[R+((l&(1<<A+C)-1)>>A)],_=b>>>24,v=b>>>16&255,T=b&65535,!(A+_<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=A,u-=A,n.back+=A}if(l>>>=_,u-=_,n.back+=_,n.length=T,v===0){n.mode=Ym;break}if(v&32){n.back=-1,n.mode=vi;break}if(v&64){t.msg="invalid literal/length code",n.mode=ke;break}n.extra=v&15,n.mode=Km;case Km:if(n.extra){for(W=n.extra;u<W;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=Wm;case Wm:for(;b=n.distcode[l&(1<<n.distbits)-1],_=b>>>24,v=b>>>16&255,T=b&65535,!(_<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(!(v&240)){for(A=_,C=v,R=T;b=n.distcode[R+((l&(1<<A+C)-1)>>A)],_=b>>>24,v=b>>>16&255,T=b&65535,!(A+_<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=A,u-=A,n.back+=A}if(l>>>=_,u-=_,n.back+=_,v&64){t.msg="invalid distance code",n.mode=ke;break}n.offset=T,n.extra=v&15,n.mode=Hm;case Hm:if(n.extra){for(W=n.extra;u<W;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=ke;break}n.mode=Gm;case Gm:if(c===0)break t;if(h=d-c,n.offset>h){if(h=n.offset-h,h>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=ke;break}h>n.wnext?(h-=n.wnext,p=n.wsize-h):p=n.wnext-h,h>n.length&&(h=n.length),m=n.window}else m=i,p=o-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do i[o++]=m[p++];while(--h);n.length===0&&(n.mode=al);break;case Ym:if(c===0)break t;i[o++]=n.length,c--,n.mode=al;break;case Qh:if(n.wrap){for(;u<32;){if(a===0)break t;a--,l|=r[s++]<<u,u+=8}if(d-=c,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?an(n.check,i,d,o-d):Aa(n.check,i,d,o-d)),d=c,n.wrap&4&&(n.flags?l:Jm(l))!==n.check){t.msg="incorrect data check",n.mode=ke;break}l=0,u=0}n.mode=Vm;case Vm:if(n.wrap&&n.flags){for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=ke;break}l=0,u=0}n.mode=Zm;case Zm:U=NT;break t;case ke:U=Am;break t;case Xm:return Rm;case qm:default:return gr}return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,(n.wsize||d!==t.avail_out&&n.mode<ke&&(n.mode<Qh||e!==Tm))&&ig(t,t.output,t.next_out,d-t.avail_out),f-=t.avail_in,d-=t.avail_out,t.total_in+=f,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?an(n.check,i,d,t.next_out-d):Aa(n.check,i,d,t.next_out-d)),t.data_type=n.bits+(n.last?64:0)+(n.mode===vi?128:0)+(n.mode===ol||n.mode===Jh?256:0),(f===0&&d===0||e===Tm)&&U===Us&&(U=LT),U},jT=t=>{if(Fs(t))return gr;let e=t.state;return e.window&&(e.window=null),t.state=null,Us},zT=(t,e)=>{if(Fs(t))return gr;const n=t.state;return n.wrap&2?(n.head=e,e.done=!1,Us):gr},KT=(t,e)=>{const n=e.length;let r,i,s;return Fs(t)||(r=t.state,r.wrap!==0&&r.mode!==sl)?gr:r.mode===sl&&(i=1,i=Aa(i,e,n,0),i!==r.check)?Am:(s=ig(t,e,n,n),s?(r.mode=Xm,Rm):(r.havedict=1,Us))};var WT=tg,HT=eg,GT=Qm,YT=PT,VT=ng,ZT=$T,XT=jT,qT=zT,JT=KT,QT="pako inflate (from Nodeca project)",ki={inflateReset:WT,inflateReset2:HT,inflateResetKeep:GT,inflateInit:YT,inflateInit2:VT,inflate:ZT,inflateEnd:XT,inflateGetHeader:qT,inflateSetDictionary:JT,inflateInfo:QT};function tA(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var eA=tA;const sg=Object.prototype.toString,{Z_NO_FLUSH:nA,Z_FINISH:rA,Z_OK:Fa,Z_STREAM_END:nf,Z_NEED_DICT:rf,Z_STREAM_ERROR:iA,Z_DATA_ERROR:og,Z_MEM_ERROR:sA}=Ns;function Ba(t){this.options=tl.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _m,this.strm.avail_out=0;let n=ki.inflateInit2(this.strm,e.windowBits);if(n!==Fa)throw new Error(Is[n]);if(this.header=new eA,ki.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=La.string2buf(e.dictionary):sg.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=ki.inflateSetDictionary(this.strm,e.dictionary),n!==Fa)))throw new Error(Is[n])}Ba.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?rA:nA,sg.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=ki.inflate(n,o),s===rf&&i&&(s=ki.inflateSetDictionary(n,i),s===Fa?s=ki.inflate(n,o):s===og&&(s=rf));n.avail_in>0&&s===nf&&n.state.wrap>0&&t[n.next_in]!==0;)ki.inflateReset(n),s=ki.inflate(n,o);switch(s){case iA:case og:case rf:case sA:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||s===nf))if(this.options.to==="string"){let c=La.utf8border(n.output,n.next_out),l=n.next_out-c,u=La.buf2string(n.output,c);n.next_out=l,n.avail_out=r-l,l&&n.output.set(n.output.subarray(c,c+l),0),this.onData(u)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(s===Fa&&a===0)){if(s===nf)return s=ki.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Ba.prototype.onData=function(t){this.chunks.push(t)},Ba.prototype.onEnd=function(t){t===Fa&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=tl.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function sf(t,e){const n=new Ba(e);if(n.push(t),n.err)throw n.msg||Is[n.err];return n.result}function oA(t,e){return e=e||{},e.raw=!0,sf(t,e)}var aA=Ba,cA=sf,lA=oA,uA=sf,hA=Ns,fA={Inflate:aA,inflate:cA,inflateRaw:lA,ungzip:uA,constants:hA};const{Deflate:dA,deflate:pA,deflateRaw:mA,gzip:gA}=ET,{Inflate:_A,inflate:yA,inflateRaw:bA,ungzip:wA}=fA;var xA=dA,EA=pA,vA=mA,kA=gA,TA=_A,AA=yA,RA=bA,SA=wA,OA=Ns,IA={Deflate:xA,deflate:EA,deflateRaw:vA,gzip:kA,Inflate:TA,inflate:AA,inflateRaw:RA,ungzip:SA,constants:OA};function ag(t){let e=t.r.toString(16),n=t.g.toString(16),r=t.b.toString(16);return e.length<2&&(e="0"+e),n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),e+n+r}const NA=t=>new Promise((e,n)=>{try{const r=IA.inflate(t),i=CA(r);e(i)}catch(r){n(r)}}),CA=t=>{const e=new DataView(t.buffer),n={version:e.getUint32(0,!0),layers:[]},r=e.getUint32(4,!0);let i=8;for(let s=0;s<r;s++){const o={width:0,height:0,raster:[]};o.width=e.getUint32(i,!0),i+=4,o.height=e.getUint32(i,!0),i+=4,o.raster=Array(o.height*o.width);for(let a=0;a<o.width;a++)for(let c=0;c<o.height;c++){const l={asciiCode:e.getUint32(i,!0),transparent:!1,color:{r:0,g:0,b:0,hex:""},bg:{r:0,g:0,b:0,hex:""}};i+=4,l.color.r=e.getUint8(i++),l.color.g=e.getUint8(i++),l.color.b=e.getUint8(i++),l.color.hex=ag(l.color),l.bg.r=e.getUint8(i++),l.bg.g=e.getUint8(i++),l.bg.b=e.getUint8(i++),l.bg.hex=ag(l.bg),l.transparent=l.bg.r===255&&l.bg.g===0&&l.bg.b===255,o.raster[a+o.width*c]=l}n.layers.push(o)}return n};function LA(t){return typeof t=="object"&&gt(t.session)&&gt(t.player)&&gt(t.id)&&gt(t.sender)&&gt(t.target)}function de(t,e,n,...r){return t.emit(e,"error",[`$red${n}$blue>>`,...r]),!1}function MA(t,e,...n){return t.emit(e,"info",n),!0}function pe(t,e,...n){return t.emit(e,"log",n),!0}function UA(t,e,n){t.emit(e,"toast",n)}function FA(t,e,n){t.emit(e,"bridge:streamstart",n)}function BA(t,e){t.emit(e,"bridge:streamstop",void 0)}function PA(t,e,n){t.emit(e,"bridge:chatstart",n)}function DA(t,e){t.emit(e,"bridge:chatstop")}function $A(t,e,n,r,i,s,o){t.emit(e,"bridge:fetch",[n,r,i,s,o])}function jA(t,e){t.emit(e,"bridge:talkstart",e)}function zA(t,e){t.emit(e,"bridge:talkstop",e)}function KA(t,e){t.emit(e,"bridge:mediastart",e)}function WA(t,e){t.emit(e,"bridge:mediastop",e)}function HA(t,e,n){t.emit(e,"bridge:start",n)}function GA(t,e,n){t.emit(e,"bridge:tab",n)}function YA(t,e,n){t.emit(e,"gadgetclient:paint",n)}function VA(t,e,n){t.emit(e,"gadgetclient:patch",n)}function ZA(t,e){t.emit(e,"gadgetserver:clearscroll")}function XA(t){t.emit("","ready")}function cg(t,e){t.emit(e,"register:loginfail")}function of(t,e){t.emit(e,"register:loginready",!0)}function qA(t,e,n,r){t.emit(e,"register:savemem",[n,r])}function JA(t,e,n){t.emit(e,"register:forkmem",[n])}function QA(t,e,n,r){t.emit(e,"register:itchiopublishmem",[n,r])}function af(t,e,n){t.emit(e,"register:copy",n)}function tR(t,e,n,r){t.emit(e,"register:copyjsonfile",[n,r])}function lg(t,e,n,r){t.emit(e,"register:downloadjsonfile",[n,r])}function eR(t,e){t.emit(e,"register:dev",void 0)}function nR(t,e){t.emit(e,"register:share",void 0)}function rR(t,e){t.emit(e,"register:nuke",void 0)}function iR(t,e){t.emit(e,"register:enterar",void 0)}function sR(t,e,n,r){t.emit(e,"synth:tts",[n,r])}function oR(t,e,n,r,i){t.emit(e,"synth:play",[n,r,i])}function aR(t,e,n){t.emit(e,"synth:focus",n)}function cR(t,e,n){t.emit(e,"synth:bpm",n)}function lR(t,e,n){t.emit(e,"synth:playvolume",n)}function uR(t,e,n){t.emit(e,"synth:bgplayvolume",n)}function hR(t,e,n){t.emit(e,"synth:ttsvolume",n)}function cf(t,e,n,r,i){t.emit(e,"synth:voice",[n,r,i])}function ug(t,e,n,r,i,s){t.emit(e,"synth:voicefx",[n,r,i,s])}function fR(t,e,n,r){t.emit(e,"register:config",[n,r])}function dR(t,e){t.emit(e,"register:configshow")}function pR(t,e){t.emit(e,"register:inspector")}function hg(t,e,n,r,i,s){t.emit(e,"register:editor:open",[n,r,i,s])}function mR(t,e){t.emit(e,"vm:local")}function fg(t,e){t.emit(e,"vm:logout")}function cl(t,e){const[n,r]=e;return`${t}:${[n,r].filter(x).join(":")}`}function gR(t,e,n){t.emit(e,"vm:cli",n)}function _R(t,e){t.emit(e,"vm:restart")}function dg(t,e){t.emit(e,"vm:flush")}function yR(t,e){t.emit(e,"vm:fork")}function bR(t,e){t.emit(e,"vm:itchiopublish")}function wR(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function xR(t,e){return{filename:t,json:e}}function ER(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function vR(t,e){const n={filename:t,cursor:0,content:void 0};return NA(e).then(r=>{n.content=r}).catch(()=>{}),n}function Pa(t,e,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=wR(i,s);break;case"json":o=xR(i,s);break;case"binary":o=ER(i,s);break;case"rexpaint":o=vR(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[n,r,i,o])},1)}function kR(t){const e=new Set;function n(s){LA(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Qn.invoke(s))}const r=po("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){Qn.disconnect(r)}return{forward:n,disconnect:i}}function TR(t){switch(t.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const e=er(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const lf=66.666,ll=Math.round(1e3/lf),pg=3;function mg(t){return new Promise(e=>setTimeout(e,t))}const uf=po("clock");let hf=0,ul=0,ff=0,gg=performance.now();function _g(){const t=performance.now(),e=t-gg;ff+=e,ff>=lf&&(ff%=lf,uf.emit("","tick",ul),uf.emit("","tock",ul),++hf,++ul,hf>=ll&&(hf%=ll,uf.emit("","second",ul))),gg=t,setTimeout(_g,2)}_g();function AR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yg={exports:{}},Ke=yg.exports={},Xr,qr;function df(){throw new Error("setTimeout has not been defined")}function pf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Xr=setTimeout:Xr=df}catch{Xr=df}try{typeof clearTimeout=="function"?qr=clearTimeout:qr=pf}catch{qr=pf}})();function bg(t){if(Xr===setTimeout)return setTimeout(t,0);if((Xr===df||!Xr)&&setTimeout)return Xr=setTimeout,setTimeout(t,0);try{return Xr(t,0)}catch{try{return Xr.call(null,t,0)}catch{return Xr.call(this,t,0)}}}function RR(t){if(qr===clearTimeout)return clearTimeout(t);if((qr===pf||!qr)&&clearTimeout)return qr=clearTimeout,clearTimeout(t);try{return qr(t)}catch{try{return qr.call(null,t)}catch{return qr.call(this,t)}}}var Ti=[],vo=!1,Bs,hl=-1;function SR(){!vo||!Bs||(vo=!1,Bs.length?Ti=Bs.concat(Ti):hl=-1,Ti.length&&wg())}function wg(){if(!vo){var t=bg(SR);vo=!0;for(var e=Ti.length;e;){for(Bs=Ti,Ti=[];++hl<e;)Bs&&Bs[hl].run();hl=-1,e=Ti.length}Bs=null,vo=!1,RR(t)}}Ke.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ti.push(new xg(t,e)),Ti.length===1&&!vo&&bg(wg)};function xg(t,e){this.fun=t,this.array=e}xg.prototype.run=function(){this.fun.apply(null,this.array)},Ke.title="browser",Ke.browser=!0,Ke.env={},Ke.argv=[],Ke.version="",Ke.versions={};function Ai(){}Ke.on=Ai,Ke.addListener=Ai,Ke.once=Ai,Ke.off=Ai,Ke.removeListener=Ai,Ke.removeAllListeners=Ai,Ke.emit=Ai,Ke.prependListener=Ai,Ke.prependOnceListener=Ai,Ke.listeners=function(t){return[]},Ke.binding=function(t){throw new Error("process.binding is not supported")},Ke.cwd=function(){return"/"},Ke.chdir=function(t){throw new Error("process.chdir is not supported")},Ke.umask=function(){return 0};var OR=yg.exports;const Nr=AR(OR);var Kt={},mf=Symbol.for("react.transitional.element"),IR=Symbol.for("react.portal"),NR=Symbol.for("react.fragment"),CR=Symbol.for("react.strict_mode"),LR=Symbol.for("react.profiler"),MR=Symbol.for("react.consumer"),UR=Symbol.for("react.context"),FR=Symbol.for("react.forward_ref"),BR=Symbol.for("react.suspense"),PR=Symbol.for("react.memo"),Eg=Symbol.for("react.lazy"),vg=Symbol.iterator;function DR(t){return t===null||typeof t!="object"?null:(t=vg&&t[vg]||t["@@iterator"],typeof t=="function"?t:null)}var kg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Tg=Object.assign,Ag={};function ko(t,e,n){this.props=t,this.context=e,this.refs=Ag,this.updater=n||kg}ko.prototype.isReactComponent={},ko.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},ko.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Rg(){}Rg.prototype=ko.prototype;function gf(t,e,n){this.props=t,this.context=e,this.refs=Ag,this.updater=n||kg}var _f=gf.prototype=new Rg;_f.constructor=gf,Tg(_f,ko.prototype),_f.isPureReactComponent=!0;var Sg=Array.isArray,Te={H:null,A:null,T:null,S:null,V:null},Og=Object.prototype.hasOwnProperty;function yf(t,e,n,r,i,s){return n=s.ref,{$$typeof:mf,type:t,key:e,ref:n!==void 0?n:null,props:s}}function $R(t,e){return yf(t.type,e,void 0,void 0,void 0,t.props)}function bf(t){return typeof t=="object"&&t!==null&&t.$$typeof===mf}function jR(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Ig=/\/+/g;function wf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?jR(""+t.key):e.toString(36)}function Ng(){}function zR(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(Ng,Ng):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function To(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case mf:case IR:o=!0;break;case Eg:return o=t._init,To(o(t._payload),e,n,r,i)}}if(o)return i=i(t),o=r===""?"."+wf(t,0):r,Sg(i)?(n="",o!=null&&(n=o.replace(Ig,"$&/")+"/"),To(i,e,n,"",function(l){return l})):i!=null&&(bf(i)&&(i=$R(i,n+(i.key==null||t&&t.key===i.key?"":(""+i.key).replace(Ig,"$&/")+"/")+o)),e.push(i)),1;o=0;var a=r===""?".":r+":";if(Sg(t))for(var c=0;c<t.length;c++)r=t[c],s=a+wf(r,c),o+=To(r,e,n,s,i);else if(c=DR(t),typeof c=="function")for(t=c.call(t),c=0;!(r=t.next()).done;)r=r.value,s=a+wf(r,c++),o+=To(r,e,n,s,i);else if(s==="object"){if(typeof t.then=="function")return To(zR(t),e,n,r,i);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return o}function fl(t,e,n){if(t==null)return t;var r=[],i=0;return To(t,r,"","",function(s){return e.call(n,s,i++)}),r}function KR(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Cg=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof Nr=="object"&&typeof Nr.emit=="function"){Nr.emit("uncaughtException",t);return}console.error(t)};function WR(){}Kt.Children={map:fl,forEach:function(t,e,n){fl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return fl(t,function(){e++}),e},toArray:function(t){return fl(t,function(e){return e})||[]},only:function(t){if(!bf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},Kt.Component=ko,Kt.Fragment=NR,Kt.Profiler=LR,Kt.PureComponent=gf,Kt.StrictMode=CR,Kt.Suspense=BR,Kt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Te,Kt.__COMPILER_RUNTIME={__proto__:null,c:function(t){return Te.H.useMemoCache(t)}},Kt.cache=function(t){return function(){return t.apply(null,arguments)}},Kt.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var r=Tg({},t.props),i=t.key,s=void 0;if(e!=null)for(o in e.ref!==void 0&&(s=void 0),e.key!==void 0&&(i=""+e.key),e)!Og.call(e,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&e.ref===void 0||(r[o]=e[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return yf(t.type,i,void 0,void 0,s,r)},Kt.createContext=function(t){return t={$$typeof:UR,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:MR,_context:t},t},Kt.createElement=function(t,e,n){var r,i={},s=null;if(e!=null)for(r in e.key!==void 0&&(s=""+e.key),e)Og.call(e,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return yf(t,s,void 0,void 0,null,i)},Kt.createRef=function(){return{current:null}},Kt.forwardRef=function(t){return{$$typeof:FR,render:t}},Kt.isValidElement=bf,Kt.lazy=function(t){return{$$typeof:Eg,_payload:{_status:-1,_result:t},_init:KR}},Kt.memo=function(t,e){return{$$typeof:PR,type:t,compare:e===void 0?null:e}},Kt.startTransition=function(t){var e=Te.T,n={};Te.T=n;try{var r=t(),i=Te.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(WR,Cg)}catch(s){Cg(s)}finally{Te.T=e}},Kt.unstable_useCacheRefresh=function(){return Te.H.useCacheRefresh()},Kt.use=function(t){return Te.H.use(t)},Kt.useActionState=function(t,e,n){return Te.H.useActionState(t,e,n)},Kt.useCallback=function(t,e){return Te.H.useCallback(t,e)},Kt.useContext=function(t){return Te.H.useContext(t)},Kt.useDebugValue=function(){},Kt.useDeferredValue=function(t,e){return Te.H.useDeferredValue(t,e)},Kt.useEffect=function(t,e,n){var r=Te.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(t,e)},Kt.useId=function(){return Te.H.useId()},Kt.useImperativeHandle=function(t,e,n){return Te.H.useImperativeHandle(t,e,n)},Kt.useInsertionEffect=function(t,e){return Te.H.useInsertionEffect(t,e)},Kt.useLayoutEffect=function(t,e){return Te.H.useLayoutEffect(t,e)},Kt.useMemo=function(t,e){return Te.H.useMemo(t,e)},Kt.useOptimistic=function(t,e){return Te.H.useOptimistic(t,e)},Kt.useReducer=function(t,e,n){return Te.H.useReducer(t,e,n)},Kt.useRef=function(t){return Te.H.useRef(t)},Kt.useState=function(t){return Te.H.useState(t)},Kt.useSyncExternalStore=function(t,e,n){return Te.H.useSyncExternalStore(t,e,n)},Kt.useTransition=function(){return Te.H.useTransition()},Kt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Lg="0123456789abcdef",Mg=[],dl=[];for(let t=0;t<256;t++)Mg[t]=Lg[t>>4&15]+Lg[t&15],t<16&&(t<10?dl[48+t]=t:dl[87+t]=t);const Ug=t=>{const e=t.length;let n="",r=0;for(;r<e;)n+=Mg[t[r++]];return n},pl=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=dl[t.charCodeAt(s++)]<<4|dl[t.charCodeAt(s++)];return r};for(var Fg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",HR=typeof Uint8Array>"u"?[]:new Uint8Array(256),ml=0;ml<Fg.length;ml++)HR[Fg.charCodeAt(ml)]=ml;new TextDecoder,new TextEncoder;const Bg=typeof window<"u"?window:self,Pg=Bg.crypto||Bg.msCrypto||{};Pg.subtle||Pg.webkitSubtle;const Ao=globalThis||void 0||self,Cr=()=>new Map,xf=t=>{const e=Cr();return t.forEach((n,r)=>{e.set(r,n)}),e},ts=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},GR=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},YR=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},Ro=()=>new Set,Ef=t=>t[t.length-1],VR=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Ps=Array.from,ZR=Array.isArray;class XR{constructor(){this._observers=Cr()}on(e,n){return ts(this._observers,e,Ro).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Ps((this._observers.get(e)||Cr()).values()).forEach(r=>r(...n))}destroy(){this._observers=Cr()}}const es=Math.floor,gl=Math.abs,Dg=(t,e)=>t<e?t:e,Ds=(t,e)=>t>e?t:e,$g=t=>t!==0?t<0:1/t<0,jg=1,zg=2,vf=4,kf=8,Da=32,Ri=64,ir=128,_l=31,Tf=63,$s=127,qR=2147483647,Kg=Number.MAX_SAFE_INTEGER,JR=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&es(t)===t),QR=t=>t.toLowerCase(),tS=/^\s*/g,eS=t=>t.replace(tS,""),nS=/([A-Z])/g,Wg=(t,e)=>eS(t.replace(nS,n=>`${e}${QR(n)}`)),rS=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},$a=typeof TextEncoder<"u"?new TextEncoder:null,iS=$a?t=>$a.encode(t):rS;let ja=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ja&&ja.decode(new Uint8Array).length===1&&(ja=null);class za{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const yl=()=>new za,sS=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Jr=t=>{const e=new Uint8Array(sS(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},oS=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Ds(n,e)*2),t.cpos=0)},cn=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},Af=cn,re=(t,e)=>{for(;e>$s;)cn(t,ir|$s&e),e=es(e/128);cn(t,$s&e)},Rf=(t,e)=>{const n=$g(e);for(n&&(e=-e),cn(t,(e>Tf?ir:0)|(n?Ri:0)|Tf&e),e=es(e/64);e>0;)cn(t,(e>$s?ir:0)|$s&e),e=es(e/128)},Sf=new Uint8Array(3e4),aS=Sf.length/3,cS=(t,e)=>{if(e.length<aS){const n=$a.encodeInto(e,Sf).written||0;re(t,n);for(let r=0;r<n;r++)cn(t,Sf[r])}else sr(t,iS(e))},lS=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;re(t,r);for(let i=0;i<r;i++)cn(t,n.codePointAt(i))},So=$a&&$a.encodeInto?cS:lS,bl=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Dg(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Ds(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},sr=(t,e)=>{re(t,e.byteLength),bl(t,e)},Of=(t,e)=>{oS(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},uS=(t,e)=>Of(t,4).setFloat32(0,e,!1),hS=(t,e)=>Of(t,8).setFloat64(0,e,!1),fS=(t,e)=>Of(t,8).setBigInt64(0,e,!1),Hg=new DataView(new ArrayBuffer(4)),dS=t=>(Hg.setFloat32(0,t),Hg.getFloat32(0)===t),Ka=(t,e)=>{switch(typeof e){case"string":cn(t,119),So(t,e);break;case"number":JR(e)&&gl(e)<=qR?(cn(t,125),Rf(t,e)):dS(e)?(cn(t,124),uS(t,e)):(cn(t,123),hS(t,e));break;case"bigint":cn(t,122),fS(t,e);break;case"object":if(e===null)cn(t,126);else if(ZR(e)){cn(t,117),re(t,e.length);for(let n=0;n<e.length;n++)Ka(t,e[n])}else if(e instanceof Uint8Array)cn(t,116),sr(t,e);else{cn(t,118);const n=Object.keys(e);re(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];So(t,i),Ka(t,e[i])}}break;case"boolean":cn(t,e?120:121);break;default:cn(t,127)}};class Gg extends za{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&re(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Yg=t=>{t.count>0&&(Rf(t.encoder,t.count===1?t.s:-t.s),t.count>1&&re(t.encoder,t.count-2))};class wl{constructor(){this.encoder=new za,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Yg(this),this.count=1,this.s=e)}toUint8Array(){return Yg(this),Jr(this.encoder)}}const Vg=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Rf(t.encoder,e),t.count>1&&re(t.encoder,t.count-2)}};class If{constructor(){this.encoder=new za,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Vg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Vg(this),Jr(this.encoder)}}class pS{constructor(){this.sarr=[],this.s="",this.lensE=new wl}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new za;return this.sarr.push(this.s),this.s="",So(e,this.sarr.join("")),bl(e,this.lensE.toUint8Array()),Jr(e)}}const ns=t=>new Error(t),Qr=()=>{throw ns("Method unimplemented")},ti=()=>{throw ns("Unexpected case")},Zg=ns("Unexpected end of array"),Xg=ns("Integer out of Range");class xl{constructor(e){this.arr=e,this.pos=0}}const Oo=t=>new xl(t),mS=t=>t.pos!==t.arr.length,gS=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},or=t=>gS(t,Wt(t)),Io=t=>t.arr[t.pos++],Wt=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&$s)*n,n*=128,i<ir)return e;if(e>Kg)throw Xg}throw Zg},Nf=t=>{let e=t.arr[t.pos++],n=e&Tf,r=64;const i=(e&Ri)>0?-1:1;if(!(e&ir))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&$s)*r,r*=128,e<ir)return i*n;if(n>Kg)throw Xg}throw Zg},No=ja?t=>ja.decode(or(t)):t=>{let e=Wt(t);if(e===0)return"";{let n=String.fromCodePoint(Io(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Io(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},Cf=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},_S=[t=>{},t=>null,Nf,t=>Cf(t,4).getFloat32(0,!1),t=>Cf(t,8).getFloat64(0,!1),t=>Cf(t,8).getBigInt64(0,!1),t=>!1,t=>!0,No,t=>{const e=Wt(t),n={};for(let r=0;r<e;r++){const i=No(t);n[i]=Wa(t)}return n},t=>{const e=Wt(t),n=[];for(let r=0;r<e;r++)n.push(Wa(t));return n},or],Wa=t=>_S[127-Io(t)](t);class qg extends xl{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),mS(this)?this.count=Wt(this)+1:this.count=-1),this.count--,this.s}}class El extends xl{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Nf(this);const e=$g(this.s);this.count=1,e&&(this.s=-this.s,this.count=Wt(this)+2)}return this.count--,this.s}}class Lf extends xl{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Nf(this),n=e&1;this.diff=es(e/2),this.count=1,n&&(this.count=Wt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class yS{constructor(e){this.decoder=new El(e),this.str=No(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const bS=crypto.getRandomValues.bind(crypto),Jg=()=>bS(new Uint32Array(1))[0],wS="10000000-1000-4000-8000"+-1e11,xS=()=>wS.replace(/[018]/g,t=>(t^Jg()&15>>t/4).toString(16)),Qg=t=>new Promise(t);Promise.all.bind(Promise);var t_={},vl={};vl.byteLength=kS,vl.toByteArray=AS,vl.fromByteArray=OS;for(var ei=[],_r=[],ES=typeof Uint8Array<"u"?Uint8Array:Array,Mf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Co=0,vS=Mf.length;Co<vS;++Co)ei[Co]=Mf[Co],_r[Mf.charCodeAt(Co)]=Co;_r[45]=62,_r[95]=63;function e_(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function kS(t){var e=e_(t),n=e[0],r=e[1];return(n+r)*3/4-r}function TS(t,e,n){return(e+n)*3/4-n}function AS(t){var e,n=e_(t),r=n[0],i=n[1],s=new ES(TS(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=_r[t.charCodeAt(c)]<<18|_r[t.charCodeAt(c+1)]<<12|_r[t.charCodeAt(c+2)]<<6|_r[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=_r[t.charCodeAt(c)]<<2|_r[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=_r[t.charCodeAt(c)]<<10|_r[t.charCodeAt(c+1)]<<4|_r[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function RS(t){return ei[t>>18&63]+ei[t>>12&63]+ei[t>>6&63]+ei[t&63]}function SS(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(RS(r));return i.join("")}function OS(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(SS(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(ei[e>>2]+ei[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(ei[e>>10]+ei[e>>4&63]+ei[e<<2&63]+"=")),i.join("")}var Uf={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Uf.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=t[e+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+t[e+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},Uf.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,p=r?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?e+=d/c:e+=d*Math.pow(2,1-f),e*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*c-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;t[n+h]=a&255,h+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+h]=o&255,h+=p,o/=256,l-=8);t[n+h-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=vl,n=Uf,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=C,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const O=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(O,g),O.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(O){if(O>i)throw new RangeError('The value "'+O+'" is invalid for option "size"');const g=new s(O);return Object.setPrototypeOf(g,u.prototype),g}function u(O,g,y){if(typeof O=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(O)}return f(O,g,y)}u.poolSize=8192;function f(O,g,y){if(typeof O=="string")return m(O,g);if(o.isView(O))return _(O);if(O==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O);if(pt(O,o)||O&&pt(O.buffer,o)||typeof a<"u"&&(pt(O,a)||O&&pt(O.buffer,a)))return v(O,g,y);if(typeof O=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=O.valueOf&&O.valueOf();if(M!=null&&M!==O)return u.from(M,g,y);const z=T(O);if(z)return z;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof O[Symbol.toPrimitive]=="function")return u.from(O[Symbol.toPrimitive]("string"),g,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O)}u.from=function(O,g,y){return f(O,g,y)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(O){if(typeof O!="number")throw new TypeError('"size" argument must be of type number');if(O<0)throw new RangeError('The value "'+O+'" is invalid for option "size"')}function h(O,g,y){return d(O),O<=0?l(O):g!==void 0?typeof y=="string"?l(O).fill(g,y):l(O).fill(g):l(O)}u.alloc=function(O,g,y){return h(O,g,y)};function p(O){return d(O),l(O<0?0:A(O)|0)}u.allocUnsafe=function(O){return p(O)},u.allocUnsafeSlow=function(O){return p(O)};function m(O,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const y=R(O,g)|0;let M=l(y);const z=M.write(O,g);return z!==y&&(M=M.slice(0,z)),M}function b(O){const g=O.length<0?0:A(O.length)|0,y=l(g);for(let M=0;M<g;M+=1)y[M]=O[M]&255;return y}function _(O){if(pt(O,s)){const g=new s(O);return v(g.buffer,g.byteOffset,g.byteLength)}return b(O)}function v(O,g,y){if(g<0||O.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(O.byteLength<g+(y||0))throw new RangeError('"length" is outside of buffer bounds');let M;return g===void 0&&y===void 0?M=new s(O):y===void 0?M=new s(O,g):M=new s(O,g,y),Object.setPrototypeOf(M,u.prototype),M}function T(O){if(u.isBuffer(O)){const g=A(O.length)|0,y=l(g);return y.length===0||O.copy(y,0,0,g),y}if(O.length!==void 0)return typeof O.length!="number"||St(O.length)?l(0):b(O);if(O.type==="Buffer"&&Array.isArray(O.data))return b(O.data)}function A(O){if(O>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return O|0}function C(O){return+O!=O&&(O=0),u.alloc(+O)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,y){if(pt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),pt(y,s)&&(y=u.from(y,y.offset,y.byteLength)),!u.isBuffer(g)||!u.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===y)return 0;let M=g.length,z=y.length;for(let Q=0,it=Math.min(M,z);Q<it;++Q)if(g[Q]!==y[Q]){M=g[Q],z=y[Q];break}return M<z?-1:z<M?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,y){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let M;if(y===void 0)for(y=0,M=0;M<g.length;++M)y+=g[M].length;const z=u.allocUnsafe(y);let Q=0;for(M=0;M<g.length;++M){let it=g[M];if(pt(it,s))Q+it.length>z.length?(u.isBuffer(it)||(it=u.from(it)),it.copy(z,Q)):s.prototype.set.call(z,it,Q);else if(u.isBuffer(it))it.copy(z,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=it.length}return z};function R(O,g){if(u.isBuffer(O))return O.length;if(o.isView(O)||pt(O,o))return O.byteLength;if(typeof O!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof O);const y=O.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&y===0)return 0;let z=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return ct(O).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return mt(O).length;default:if(z)return M?-1:ct(O).length;g=(""+g).toLowerCase(),z=!0}}u.byteLength=R;function S(O,g,y){let M=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,g>>>=0,y<=g))return"";for(O||(O="utf8");;)switch(O){case"hex":return H(this,g,y);case"utf8":case"utf-8":return $(this,g,y);case"ascii":return at(this,g,y);case"latin1":case"binary":return Y(this,g,y);case"base64":return Z(this,g,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return wt(this,g,y);default:if(M)throw new TypeError("Unknown encoding: "+O);O=(O+"").toLowerCase(),M=!0}}u.prototype._isBuffer=!0;function U(O,g,y){const M=O[g];O[g]=O[y],O[y]=M}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<g;y+=2)U(this,y,y+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<g;y+=4)U(this,y,y+3),U(this,y+1,y+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<g;y+=8)U(this,y,y+7),U(this,y+1,y+6),U(this,y+2,y+5),U(this,y+3,y+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?$(this,0,g):S.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const y=t.INSPECT_MAX_BYTES;return g=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,y,M,z,Q){if(pt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(y===void 0&&(y=0),M===void 0&&(M=g?g.length:0),z===void 0&&(z=0),Q===void 0&&(Q=this.length),y<0||M>g.length||z<0||Q>this.length)throw new RangeError("out of range index");if(z>=Q&&y>=M)return 0;if(z>=Q)return-1;if(y>=M)return 1;if(y>>>=0,M>>>=0,z>>>=0,Q>>>=0,this===g)return 0;let it=Q-z,zt=M-y;const Ne=Math.min(it,zt),we=this.slice(z,Q),Ce=g.slice(y,M);for(let he=0;he<Ne;++he)if(we[he]!==Ce[he]){it=we[he],zt=Ce[he];break}return it<zt?-1:zt<it?1:0};function I(O,g,y,M,z){if(O.length===0)return-1;if(typeof y=="string"?(M=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,St(y)&&(y=z?0:O.length-1),y<0&&(y=O.length+y),y>=O.length){if(z)return-1;y=O.length-1}else if(y<0)if(z)y=0;else return-1;if(typeof g=="string"&&(g=u.from(g,M)),u.isBuffer(g))return g.length===0?-1:P(O,g,y,M,z);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?z?s.prototype.indexOf.call(O,g,y):s.prototype.lastIndexOf.call(O,g,y):P(O,[g],y,M,z);throw new TypeError("val must be string, number or Buffer")}function P(O,g,y,M,z){let Q=1,it=O.length,zt=g.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(O.length<2||g.length<2)return-1;Q=2,it/=2,zt/=2,y/=2}function Ne(Ce,he){return Q===1?Ce[he]:Ce.readUInt16BE(he*Q)}let we;if(z){let Ce=-1;for(we=y;we<it;we++)if(Ne(O,we)===Ne(g,Ce===-1?0:we-Ce)){if(Ce===-1&&(Ce=we),we-Ce+1===zt)return Ce*Q}else Ce!==-1&&(we-=we-Ce),Ce=-1}else for(y+zt>it&&(y=it-zt),we=y;we>=0;we--){let Ce=!0;for(let he=0;he<zt;he++)if(Ne(O,we+he)!==Ne(g,he)){Ce=!1;break}if(Ce)return we}return-1}u.prototype.includes=function(g,y,M){return this.indexOf(g,y,M)!==-1},u.prototype.indexOf=function(g,y,M){return I(this,g,y,M,!0)},u.prototype.lastIndexOf=function(g,y,M){return I(this,g,y,M,!1)};function W(O,g,y,M){y=Number(y)||0;const z=O.length-y;M?(M=Number(M),M>z&&(M=z)):M=z;const Q=g.length;M>Q/2&&(M=Q/2);let it;for(it=0;it<M;++it){const zt=parseInt(g.substr(it*2,2),16);if(St(zt))return it;O[y+it]=zt}return it}function L(O,g,y,M){return xt(ct(g,O.length-y),O,y,M)}function N(O,g,y,M){return xt(ft(g),O,y,M)}function E(O,g,y,M){return xt(mt(g),O,y,M)}function D(O,g,y,M){return xt(J(g,O.length-y),O,y,M)}u.prototype.write=function(g,y,M,z){if(y===void 0)z="utf8",M=this.length,y=0;else if(M===void 0&&typeof y=="string")z=y,M=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(M)?(M=M>>>0,z===void 0&&(z="utf8")):(z=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Q=this.length-y;if((M===void 0||M>Q)&&(M=Q),g.length>0&&(M<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");z||(z="utf8");let it=!1;for(;;)switch(z){case"hex":return W(this,g,y,M);case"utf8":case"utf-8":return L(this,g,y,M);case"ascii":case"latin1":case"binary":return N(this,g,y,M);case"base64":return E(this,g,y,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,g,y,M);default:if(it)throw new TypeError("Unknown encoding: "+z);z=(""+z).toLowerCase(),it=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(O,g,y){return g===0&&y===O.length?e.fromByteArray(O):e.fromByteArray(O.slice(g,y))}function $(O,g,y){y=Math.min(O.length,y);const M=[];let z=g;for(;z<y;){const Q=O[z];let it=null,zt=Q>239?4:Q>223?3:Q>191?2:1;if(z+zt<=y){let Ne,we,Ce,he;switch(zt){case 1:Q<128&&(it=Q);break;case 2:Ne=O[z+1],(Ne&192)===128&&(he=(Q&31)<<6|Ne&63,he>127&&(it=he));break;case 3:Ne=O[z+1],we=O[z+2],(Ne&192)===128&&(we&192)===128&&(he=(Q&15)<<12|(Ne&63)<<6|we&63,he>2047&&(he<55296||he>57343)&&(it=he));break;case 4:Ne=O[z+1],we=O[z+2],Ce=O[z+3],(Ne&192)===128&&(we&192)===128&&(Ce&192)===128&&(he=(Q&15)<<18|(Ne&63)<<12|(we&63)<<6|Ce&63,he>65535&&he<1114112&&(it=he))}}it===null?(it=65533,zt=1):it>65535&&(it-=65536,M.push(it>>>10&1023|55296),it=56320|it&1023),M.push(it),z+=zt}return nt(M)}const st=4096;function nt(O){const g=O.length;if(g<=st)return String.fromCharCode.apply(String,O);let y="",M=0;for(;M<g;)y+=String.fromCharCode.apply(String,O.slice(M,M+=st));return y}function at(O,g,y){let M="";y=Math.min(O.length,y);for(let z=g;z<y;++z)M+=String.fromCharCode(O[z]&127);return M}function Y(O,g,y){let M="";y=Math.min(O.length,y);for(let z=g;z<y;++z)M+=String.fromCharCode(O[z]);return M}function H(O,g,y){const M=O.length;(!g||g<0)&&(g=0),(!y||y<0||y>M)&&(y=M);let z="";for(let Q=g;Q<y;++Q)z+=fe[O[Q]];return z}function wt(O,g,y){const M=O.slice(g,y);let z="";for(let Q=0;Q<M.length-1;Q+=2)z+=String.fromCharCode(M[Q]+M[Q+1]*256);return z}u.prototype.slice=function(g,y){const M=this.length;g=~~g,y=y===void 0?M:~~y,g<0?(g+=M,g<0&&(g=0)):g>M&&(g=M),y<0?(y+=M,y<0&&(y=0)):y>M&&(y=M),y<g&&(y=g);const z=this.subarray(g,y);return Object.setPrototypeOf(z,u.prototype),z};function lt(O,g,y){if(O%1!==0||O<0)throw new RangeError("offset is not uint");if(O+g>y)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,y,M){g=g>>>0,y=y>>>0,M||lt(g,y,this.length);let z=this[g],Q=1,it=0;for(;++it<y&&(Q*=256);)z+=this[g+it]*Q;return z},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,y,M){g=g>>>0,y=y>>>0,M||lt(g,y,this.length);let z=this[g+--y],Q=1;for(;y>0&&(Q*=256);)z+=this[g+--y]*Q;return z},u.prototype.readUint8=u.prototype.readUInt8=function(g,y){return g=g>>>0,y||lt(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,y){return g=g>>>0,y||lt(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,y){return g=g>>>0,y||lt(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=$t(function(g){g=g>>>0,et(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&B(g,this.length-8);const z=y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,Q=this[++g]+this[++g]*2**8+this[++g]*2**16+M*2**24;return BigInt(z)+(BigInt(Q)<<BigInt(32))}),u.prototype.readBigUInt64BE=$t(function(g){g=g>>>0,et(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&B(g,this.length-8);const z=y*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],Q=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M;return(BigInt(z)<<BigInt(32))+BigInt(Q)}),u.prototype.readIntLE=function(g,y,M){g=g>>>0,y=y>>>0,M||lt(g,y,this.length);let z=this[g],Q=1,it=0;for(;++it<y&&(Q*=256);)z+=this[g+it]*Q;return Q*=128,z>=Q&&(z-=Math.pow(2,8*y)),z},u.prototype.readIntBE=function(g,y,M){g=g>>>0,y=y>>>0,M||lt(g,y,this.length);let z=y,Q=1,it=this[g+--z];for(;z>0&&(Q*=256);)it+=this[g+--z]*Q;return Q*=128,it>=Q&&(it-=Math.pow(2,8*y)),it},u.prototype.readInt8=function(g,y){return g=g>>>0,y||lt(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,y){g=g>>>0,y||lt(g,2,this.length);const M=this[g]|this[g+1]<<8;return M&32768?M|4294901760:M},u.prototype.readInt16BE=function(g,y){g=g>>>0,y||lt(g,2,this.length);const M=this[g+1]|this[g]<<8;return M&32768?M|4294901760:M},u.prototype.readInt32LE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=$t(function(g){g=g>>>0,et(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&B(g,this.length-8);const z=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(M<<24);return(BigInt(z)<<BigInt(32))+BigInt(y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=$t(function(g){g=g>>>0,et(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&B(g,this.length-8);const z=(y<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(z)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M)}),u.prototype.readFloatLE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,y){return g=g>>>0,y||lt(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,y){return g=g>>>0,y||lt(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,y){return g=g>>>0,y||lt(g,8,this.length),n.read(this,g,!1,52,8)};function ht(O,g,y,M,z,Q){if(!u.isBuffer(O))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>z||g<Q)throw new RangeError('"value" argument is out of bounds');if(y+M>O.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,y,M,z){if(g=+g,y=y>>>0,M=M>>>0,!z){const zt=Math.pow(2,8*M)-1;ht(this,g,y,M,zt,0)}let Q=1,it=0;for(this[y]=g&255;++it<M&&(Q*=256);)this[y+it]=g/Q&255;return y+M},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,y,M,z){if(g=+g,y=y>>>0,M=M>>>0,!z){const zt=Math.pow(2,8*M)-1;ht(this,g,y,M,zt,0)}let Q=M-1,it=1;for(this[y+Q]=g&255;--Q>=0&&(it*=256);)this[y+Q]=g/it&255;return y+M},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,1,255,0),this[y]=g&255,y+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,2,65535,0),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,2,65535,0),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,4,4294967295,0),this[y+3]=g>>>24,this[y+2]=g>>>16,this[y+1]=g>>>8,this[y]=g&255,y+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,4,4294967295,0),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4};function jt(O,g,y,M,z){ot(g,M,z,O,y,7);let Q=Number(g&BigInt(4294967295));O[y++]=Q,Q=Q>>8,O[y++]=Q,Q=Q>>8,O[y++]=Q,Q=Q>>8,O[y++]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[y++]=it,it=it>>8,O[y++]=it,it=it>>8,O[y++]=it,it=it>>8,O[y++]=it,y}function ae(O,g,y,M,z){ot(g,M,z,O,y,7);let Q=Number(g&BigInt(4294967295));O[y+7]=Q,Q=Q>>8,O[y+6]=Q,Q=Q>>8,O[y+5]=Q,Q=Q>>8,O[y+4]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[y+3]=it,it=it>>8,O[y+2]=it,it=it>>8,O[y+1]=it,it=it>>8,O[y]=it,y+8}u.prototype.writeBigUInt64LE=$t(function(g,y=0){return jt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=$t(function(g,y=0){return ae(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,y,M,z){if(g=+g,y=y>>>0,!z){const Ne=Math.pow(2,8*M-1);ht(this,g,y,M,Ne-1,-Ne)}let Q=0,it=1,zt=0;for(this[y]=g&255;++Q<M&&(it*=256);)g<0&&zt===0&&this[y+Q-1]!==0&&(zt=1),this[y+Q]=(g/it>>0)-zt&255;return y+M},u.prototype.writeIntBE=function(g,y,M,z){if(g=+g,y=y>>>0,!z){const Ne=Math.pow(2,8*M-1);ht(this,g,y,M,Ne-1,-Ne)}let Q=M-1,it=1,zt=0;for(this[y+Q]=g&255;--Q>=0&&(it*=256);)g<0&&zt===0&&this[y+Q+1]!==0&&(zt=1),this[y+Q]=(g/it>>0)-zt&255;return y+M},u.prototype.writeInt8=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,1,127,-128),g<0&&(g=255+g+1),this[y]=g&255,y+1},u.prototype.writeInt16LE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,2,32767,-32768),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeInt16BE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,2,32767,-32768),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeInt32LE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,4,2147483647,-2147483648),this[y]=g&255,this[y+1]=g>>>8,this[y+2]=g>>>16,this[y+3]=g>>>24,y+4},u.prototype.writeInt32BE=function(g,y,M){return g=+g,y=y>>>0,M||ht(this,g,y,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4},u.prototype.writeBigInt64LE=$t(function(g,y=0){return jt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=$t(function(g,y=0){return ae(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Dt(O,g,y,M,z,Q){if(y+M>O.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function Pt(O,g,y,M,z){return g=+g,y=y>>>0,z||Dt(O,g,y,4),n.write(O,g,y,M,23,4),y+4}u.prototype.writeFloatLE=function(g,y,M){return Pt(this,g,y,!0,M)},u.prototype.writeFloatBE=function(g,y,M){return Pt(this,g,y,!1,M)};function le(O,g,y,M,z){return g=+g,y=y>>>0,z||Dt(O,g,y,8),n.write(O,g,y,M,52,8),y+8}u.prototype.writeDoubleLE=function(g,y,M){return le(this,g,y,!0,M)},u.prototype.writeDoubleBE=function(g,y,M){return le(this,g,y,!1,M)},u.prototype.copy=function(g,y,M,z){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(M||(M=0),!z&&z!==0&&(z=this.length),y>=g.length&&(y=g.length),y||(y=0),z>0&&z<M&&(z=M),z===M||g.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(z<0)throw new RangeError("sourceEnd out of bounds");z>this.length&&(z=this.length),g.length-y<z-M&&(z=g.length-y+M);const Q=z-M;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,M,z):s.prototype.set.call(g,this.subarray(M,z),y),Q},u.prototype.fill=function(g,y,M,z){if(typeof g=="string"){if(typeof y=="string"?(z=y,y=0,M=this.length):typeof M=="string"&&(z=M,M=this.length),z!==void 0&&typeof z!="string")throw new TypeError("encoding must be a string");if(typeof z=="string"&&!u.isEncoding(z))throw new TypeError("Unknown encoding: "+z);if(g.length===1){const it=g.charCodeAt(0);(z==="utf8"&&it<128||z==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(y<0||this.length<y||this.length<M)throw new RangeError("Out of range index");if(M<=y)return this;y=y>>>0,M=M===void 0?this.length:M>>>0,g||(g=0);let Q;if(typeof g=="number")for(Q=y;Q<M;++Q)this[Q]=g;else{const it=u.isBuffer(g)?g:u.from(g,z),zt=it.length;if(zt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(Q=0;Q<M-y;++Q)this[Q+y]=it[Q%zt]}return this};const Yt={};function Ie(O,g,y){Yt[O]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${O}]`,this.stack,delete this.name}get code(){return O}set code(z){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:z,writable:!0})}toString(){return`${this.name} [${O}]: ${this.message}`}}}Ie("ERR_BUFFER_OUT_OF_BOUNDS",function(O){return O?`${O} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ie("ERR_INVALID_ARG_TYPE",function(O,g){return`The "${O}" argument must be of type number. Received type ${typeof g}`},TypeError),Ie("ERR_OUT_OF_RANGE",function(O,g,y){let M=`The value of "${O}" is out of range.`,z=y;return Number.isInteger(y)&&Math.abs(y)>2**32?z=je(String(y)):typeof y=="bigint"&&(z=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&(z=je(z)),z+="n"),M+=` It must be ${g}. Received ${z}`,M},RangeError);function je(O){let g="",y=O.length;const M=O[0]==="-"?1:0;for(;y>=M+4;y-=3)g=`_${O.slice(y-3,y)}${g}`;return`${O.slice(0,y)}${g}`}function k(O,g,y){et(g,"offset"),(O[g]===void 0||O[g+y]===void 0)&&B(g,O.length-(y+1))}function ot(O,g,y,M,z,Q){if(O>y||O<g){const it=typeof g=="bigint"?"n":"";let zt;throw g===0||g===BigInt(0)?zt=`>= 0${it} and < 2${it} ** ${(Q+1)*8}${it}`:zt=`>= -(2${it} ** ${(Q+1)*8-1}${it}) and < 2 ** ${(Q+1)*8-1}${it}`,new Yt.ERR_OUT_OF_RANGE("value",zt,O)}k(M,z,Q)}function et(O,g){if(typeof O!="number")throw new Yt.ERR_INVALID_ARG_TYPE(g,"number",O)}function B(O,g,y){throw Math.floor(O)!==O?(et(O,y),new Yt.ERR_OUT_OF_RANGE("offset","an integer",O)):g<0?new Yt.ERR_BUFFER_OUT_OF_BOUNDS:new Yt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,O)}const F=/[^+/0-9A-Za-z-_]/g;function V(O){if(O=O.split("=")[0],O=O.trim().replace(F,""),O.length<2)return"";for(;O.length%4!==0;)O=O+"=";return O}function ct(O,g){g=g||1/0;let y;const M=O.length;let z=null;const Q=[];for(let it=0;it<M;++it){if(y=O.charCodeAt(it),y>55295&&y<57344){if(!z){if(y>56319){(g-=3)>-1&&Q.push(239,191,189);continue}else if(it+1===M){(g-=3)>-1&&Q.push(239,191,189);continue}z=y;continue}if(y<56320){(g-=3)>-1&&Q.push(239,191,189),z=y;continue}y=(z-55296<<10|y-56320)+65536}else z&&(g-=3)>-1&&Q.push(239,191,189);if(z=null,y<128){if((g-=1)<0)break;Q.push(y)}else if(y<2048){if((g-=2)<0)break;Q.push(y>>6|192,y&63|128)}else if(y<65536){if((g-=3)<0)break;Q.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((g-=4)<0)break;Q.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return Q}function ft(O){const g=[];for(let y=0;y<O.length;++y)g.push(O.charCodeAt(y)&255);return g}function J(O,g){let y,M,z;const Q=[];for(let it=0;it<O.length&&!((g-=2)<0);++it)y=O.charCodeAt(it),M=y>>8,z=y%256,Q.push(z),Q.push(M);return Q}function mt(O){return e.toByteArray(V(O))}function xt(O,g,y,M){let z;for(z=0;z<M&&!(z+y>=g.length||z>=O.length);++z)g[z+y]=O[z];return z}function pt(O,g){return O instanceof g||O!=null&&O.constructor!=null&&O.constructor.name!=null&&O.constructor.name===g.name}function St(O){return O!==O}const fe=function(){const O="0123456789abcdef",g=new Array(256);for(let y=0;y<16;++y){const M=y*16;for(let z=0;z<16;++z)g[M+z]=O[y]+O[z]}return g}();function $t(O){return typeof BigInt>"u"?Jn:O}function Jn(){throw new Error("BigInt not supported")}})(t_);const pn=t_.Buffer,n_=t=>t===void 0?null:t;class IS{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let r_=new IS,NS=!0;try{typeof localStorage<"u"&&localStorage&&(r_=localStorage,NS=!1)}catch{}const CS=r_,LS=Object.assign,MS=Object.keys,US=(t,e)=>{for(const n in t)e(t[n],n)},i_=t=>MS(t).length,FS=t=>{for(const e in t)return!1;return!0},BS=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},PS=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),DS=(t,e)=>t===e||i_(t)===i_(e)&&BS(t,(n,r)=>(n!==void 0||PS(e,r))&&e[r]===n),$S=Object.freeze,s_=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&s_(t[e])}return $S(t)},Ff=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Ff(t,e,n+1)}},jS=t=>t,zS=(t,e)=>e.includes(t);var o_={};const Ha=typeof Nr<"u"&&Nr.release&&/node|io\.js/.test(Nr.release.name)&&Object.prototype.toString.call(typeof Nr<"u"?Nr:0)==="[object process]";let ni;const KS=()=>{if(ni===void 0)if(Ha){ni=Cr();const t=Nr.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&ni.set(e,""),e=r):e!==null&&(ni.set(e,r),e=null)}e!==null&&ni.set(e,"")}else typeof location=="object"?(ni=Cr(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");ni.set(`--${Wg(e,"-")}`,n),ni.set(`-${Wg(e,"-")}`,n)}})):ni=Cr();return ni},Bf=t=>KS().has(t),kl=t=>n_(Ha?o_[t.toUpperCase().replaceAll("-","_")]:CS.getItem(t)),a_=t=>Bf("--"+t)||kl(t)!==null;a_("production");const WS=Ha&&zS(o_.FORCE_COLOR,["true","1","2"])||!Bf("--no-colors")&&!a_("no-color")&&(!Ha||Nr.stdout.isTTY)&&(!Ha||Bf("--color")||kl("COLORTERM")!==null||(kl("TERM")||"").includes("color")),HS=t=>new Uint8Array(t),GS=t=>{const e=HS(t.byteLength);return e.set(t),e};class YS{constructor(e,n){this.left=e,this.right=n}}const Si=(t,e)=>new YS(t,e);typeof DOMParser<"u"&&new DOMParser;const VS=t=>GR(t,(e,n)=>`${n}:${e};`).join(""),Oi=Symbol,c_=Oi(),l_=Oi(),ZS=Oi(),XS=Oi(),qS=Oi(),u_=Oi(),JS=Oi(),Pf=Oi(),QS=Oi(),tO=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},eO={[c_]:Si("font-weight","bold"),[l_]:Si("font-weight","normal"),[ZS]:Si("color","blue"),[qS]:Si("color","green"),[XS]:Si("color","grey"),[u_]:Si("color","red"),[JS]:Si("color","purple"),[Pf]:Si("color","orange"),[QS]:Si("color","black")},h_=WS?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Cr();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=eO[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=VS(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:tO,nO=(...t)=>{console.log(...h_(t)),f_.forEach(e=>e.print(t))},rO=(...t)=>{console.warn(...h_(t)),t.unshift(Pf),f_.forEach(e=>e.print(t))},f_=Ro(),d_=t=>({[Symbol.iterator](){return this},next:t}),iO=(t,e)=>d_(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Df=(t,e)=>d_(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class $f{constructor(e,n){this.clock=e,this.len=n}}class Ga{constructor(){this.clients=new Map}}const p_=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];I_(t,s,a.clock,a.len,n)}}),sO=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=es((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},m_=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&sO(n,e.clock)!==null},jf=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=Ds(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},oO=t=>{const e=new Ga;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)VR(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return jf(e),e},Tl=(t,e,n,r)=>{ts(t.clients,e,()=>[]).push(new $f(n,r))},aO=()=>new Ga,cO=t=>{const e=aO();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new $f(a,c))}}i.length>0&&e.clients.set(r,i)}),e},Lo=(t,e)=>{re(t.restEncoder,e.clients.size),Ps(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),re(t.restEncoder,n);const i=r.length;re(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},zf=t=>{const e=new Ga,n=Wt(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Wt(t.restDecoder),s=Wt(t.restDecoder);if(s>0){const o=ts(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new $f(t.readDsClock(),t.readDsLen()))}}return e},g_=(t,e,n)=>{const r=new Ga,i=Wt(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Wt(t.restDecoder),a=Wt(t.restDecoder),c=n.clients.get(o)||[],l=ln(n,o);for(let u=0;u<a;u++){const f=t.readDsClock(),d=f+t.readDsLen();if(f<l){l<d&&Tl(r,o,l,d-l);let h=ri(c,f),p=c[h];for(!p.deleted&&p.id.clock<f&&(c.splice(h+1,0,Dl(e,p,f-p.id.clock)),h++);h<c.length&&(p=c[h++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(h,0,Dl(e,p,d-p.id.clock)),p.delete(e))}else Tl(r,o,f,d-f)}}if(r.clients.size>0){const s=new js;return re(s.restEncoder,0),Lo(s,r),s.toUint8Array()}return null},__=Jg;class Mo extends XR{constructor({guid:e=xS(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=__(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new R_,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Qg(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Qg(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&me(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ps(this.subdocs).map(e=>e.guid))}transact(e,n=null){return me(this,e,n)}get(e,n=mn){const r=ts(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==mn&&i!==n)if(i===mn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Po)}getText(e=""){return this.get(e,Ii)}getMap(e=""){return this.get(e,Do)}getXmlElement(e=""){return this.get(e,jo)}getXmlFragment(e=""){return this.get(e,zs)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Ps(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new Mo({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,me(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class y_{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Wt(this.restDecoder)}readDsLen(){return Wt(this.restDecoder)}}class b_ extends y_{readLeftID(){return Xt(Wt(this.restDecoder),Wt(this.restDecoder))}readRightID(){return Xt(Wt(this.restDecoder),Wt(this.restDecoder))}readClient(){return Wt(this.restDecoder)}readInfo(){return Io(this.restDecoder)}readString(){return No(this.restDecoder)}readParentInfo(){return Wt(this.restDecoder)===1}readTypeRef(){return Wt(this.restDecoder)}readLen(){return Wt(this.restDecoder)}readAny(){return Wa(this.restDecoder)}readBuf(){return GS(or(this.restDecoder))}readJSON(){return JSON.parse(No(this.restDecoder))}readKey(){return No(this.restDecoder)}}class lO{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Wt(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Wt(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Uo extends lO{constructor(e){super(e),this.keys=[],Wt(e),this.keyClockDecoder=new Lf(or(e)),this.clientDecoder=new El(or(e)),this.leftClockDecoder=new Lf(or(e)),this.rightClockDecoder=new Lf(or(e)),this.infoDecoder=new qg(or(e),Io),this.stringDecoder=new yS(or(e)),this.parentInfoDecoder=new qg(or(e),Io),this.typeRefDecoder=new El(or(e)),this.lenDecoder=new El(or(e))}readLeftID(){return new Fo(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Fo(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Wa(this.restDecoder)}readBuf(){return or(this.restDecoder)}readJSON(){return Wa(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class uO{constructor(){this.restEncoder=yl()}toUint8Array(){return Jr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){re(this.restEncoder,e)}writeDsLen(e){re(this.restEncoder,e)}}class Ya extends uO{writeLeftID(e){re(this.restEncoder,e.client),re(this.restEncoder,e.clock)}writeRightID(e){re(this.restEncoder,e.client),re(this.restEncoder,e.clock)}writeClient(e){re(this.restEncoder,e)}writeInfo(e){Af(this.restEncoder,e)}writeString(e){So(this.restEncoder,e)}writeParentInfo(e){re(this.restEncoder,e?1:0)}writeTypeRef(e){re(this.restEncoder,e)}writeLen(e){re(this.restEncoder,e)}writeAny(e){Ka(this.restEncoder,e)}writeBuf(e){sr(this.restEncoder,e)}writeJSON(e){So(this.restEncoder,JSON.stringify(e))}writeKey(e){So(this.restEncoder,e)}}class hO{constructor(){this.restEncoder=yl(),this.dsCurrVal=0}toUint8Array(){return Jr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,re(this.restEncoder,n)}writeDsLen(e){e===0&&ti(),re(this.restEncoder,e-1),this.dsCurrVal+=e}}class js extends hO{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new If,this.clientEncoder=new wl,this.leftClockEncoder=new If,this.rightClockEncoder=new If,this.infoEncoder=new Gg(Af),this.stringEncoder=new pS,this.parentInfoEncoder=new Gg(Af),this.typeRefEncoder=new wl,this.lenEncoder=new wl}toUint8Array(){const e=yl();return re(e,0),sr(e,this.keyClockEncoder.toUint8Array()),sr(e,this.clientEncoder.toUint8Array()),sr(e,this.leftClockEncoder.toUint8Array()),sr(e,this.rightClockEncoder.toUint8Array()),sr(e,Jr(this.infoEncoder)),sr(e,this.stringEncoder.toUint8Array()),sr(e,Jr(this.parentInfoEncoder)),sr(e,this.typeRefEncoder.toUint8Array()),sr(e,this.lenEncoder.toUint8Array()),bl(e,Jr(this.restEncoder)),Jr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Ka(this.restEncoder,e)}writeBuf(e){sr(this.restEncoder,e)}writeJSON(e){Ka(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const fO=(t,e,n,r)=>{r=Ds(r,e[0].id.clock);const i=ri(e,r);re(t.restEncoder,e.length-i),t.writeClient(n),re(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},Kf=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{ln(e,s)>i&&r.set(s,i)}),Hf(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),re(t.restEncoder,r.size),Ps(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{fO(t,e.clients.get(i),i,s)})},dO=(t,e)=>{const n=Cr(),r=Wt(t.restDecoder);for(let i=0;i<r;i++){const s=Wt(t.restDecoder),o=new Array(s),a=t.readClient();let c=Wt(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(_l&u){case 0:{const f=t.readLen();o[l]=new yr(Xt(a,c),f),c+=f;break}case 10:{const f=Wt(t.restDecoder);o[l]=new br(Xt(a,c),f),c+=f;break}default:{const f=(u&(Ri|ir))===0,d=new Qe(Xt(a,c),null,(u&ir)===ir?t.readLeftID():null,null,(u&Ri)===Ri?t.readRightID():null,f?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,f&&(u&Da)===Da?t.readString():null,ey(t,u));o[l]=d,c+=d.length}}}}return n},pO=(t,e,n)=>{const r=[];let i=Ps(n.keys()).sort((h,p)=>h-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new R_,c=new Map,l=(h,p)=>{const m=c.get(h);(m==null||m>p)&&c.set(h,p)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const p=h.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[h]),i=i.filter(b=>b!==p)}r.length=0};for(;;){if(u.constructor!==br){const p=ts(f,u.id.client,()=>ln(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const b=n.get(m)||{refs:[],i:0};if(b.refs.length===b.i)l(m,ln(e,m)),d();else{u=b.refs[b.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new js;return Kf(h,a,new Map),re(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},mO=(t,e)=>Kf(t,e.doc.store,e.beforeState),gO=(t,e,n,r=new Uo(t))=>me(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=dO(r,o),l=pO(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<ln(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const p=u.missing.get(d);(p==null||p>h)&&u.missing.set(d,h)}u.update=Sl([u.update,l.update])}}else a.pendingStructs=l;const f=g_(r,i,a);if(a.pendingDs){const d=new Uo(Oo(a.pendingDs));Wt(d.restDecoder);const h=g_(d,i,a);f&&h?a.pendingDs=Sl([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,w_(i.doc,d)}},n,!1),w_=(t,e,n,r=Uo)=>{const i=Oo(e);gO(i,t,n,new r(i))},x_=(t,e,n)=>w_(t,e,n,b_),_O=(t,e,n=new Map)=>{Kf(t,e.store,n),Lo(t,cO(e.store))},yO=(t,e=new Uint8Array([0]),n=new js)=>{const r=E_(e);_O(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(IO(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Ya)return SO(i.map((s,o)=>o===0?s:CO(s)));if(n.constructor===js)return Sl(i)}return i[0]},bO=(t,e)=>yO(t,e,new Ya),wO=t=>{const e=new Map,n=Wt(t.restDecoder);for(let r=0;r<n;r++){const i=Wt(t.restDecoder),s=Wt(t.restDecoder);e.set(i,s)}return e},E_=t=>wO(new y_(Oo(t)));class xO{constructor(){this.l=[]}}const v_=()=>new xO,k_=(t,e)=>t.l.push(e),T_=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},A_=(t,e,n)=>Ff(t.l,[e,n]);class Fo{constructor(e,n){this.client=e,this.clock=n}}const Al=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Xt=(t,e)=>new Fo(t,e),EO=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw ti()},Bo=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!m_(e.ds,t.id),Wf=(t,e)=>{const n=ts(t.meta,Wf,Ro),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<ln(r,s)&&rs(t,Xt(s,i))}),p_(t,e.ds,i=>{}),n.add(e))};class R_{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Hf=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},ln=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},S_=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw ti()}n.push(e)},ri=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=es(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=es((n+r)/2)}throw ti()},Gf=(t,e)=>{const n=t.clients.get(e.client);return n[ri(n,e.clock)]},Yf=(t,e,n)=>{const r=ri(e,n),i=e[r];return i.id.clock<n&&i instanceof Qe?(e.splice(r+1,0,Dl(t,i,n-i.id.clock)),r+1):r},rs=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Yf(t,n,e.clock)]},O_=(t,e,n)=>{const r=e.clients.get(n.client),i=ri(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==yr&&r.splice(i+1,0,Dl(t,s,n.clock-s.id.clock+1)),s},vO=(t,e,n)=>{const r=t.clients.get(e.id.client);r[ri(r,e.id.clock)]=n},I_=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=Yf(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&Yf(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class kO{constructor(e,n,r){this.doc=e,this.deleteSet=new Ga,this.beforeState=Hf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const N_=(t,e)=>e.deleteSet.clients.size===0&&!YR(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(jf(e.deleteSet),mO(t,e),Lo(t,e.deleteSet),!0),C_=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&ts(t.changed,e,Ro).add(n)},Rl=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Qe&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},TO=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=ri(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Qe&&f.deleted&&!f.keep&&n(f)&&f.gc(e,!1)}}}},AO=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Dg(i.length-1,1+ri(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+Rl(i,c)}})},L_=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{jf(s),n.afterState=Hf(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),A_(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Ff(a,[]),n._needFormattingCleanup&&GO(n)}finally{r.gc&&TO(s,i,r.gcFilter),AO(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),p=Ds(ri(h,d),1);for(let m=h.length-1;m>=p;)m-=1+Rl(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),p=ri(h,d);p+1<h.length&&Rl(h,p+1)>1||p>0&&Rl(h,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(nO(Pf,c_,"[yjs] ",l_,u_,"Changed the client-id because another client seems to be using it."),r.clientID=__()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Ya;N_(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new js;N_(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):L_(t,e+1)}}},me=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new kO(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&L_(i,0)}}return o};function*RO(t){const e=Wt(t.restDecoder);for(let n=0;n<e;n++){const r=Wt(t.restDecoder),i=t.readClient();let s=Wt(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Wt(t.restDecoder);yield new br(Xt(i,s),c),s+=c}else if(_l&a){const c=(a&(Ri|ir))===0,l=new Qe(Xt(i,s),null,(a&ir)===ir?t.readLeftID():null,null,(a&Ri)===Ri?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&Da)===Da?t.readString():null,ey(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new yr(Xt(i,s),c),s+=c}}}}class Vf{constructor(e,n){this.gen=RO(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===br);return this.curr}}class Zf{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const SO=t=>Sl(t,b_,Ya),OO=(t,e)=>{if(t.constructor===yr){const{client:n,clock:r}=t.id;return new yr(Xt(n,r+e),t.length-e)}else if(t.constructor===br){const{client:n,clock:r}=t.id;return new br(Xt(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new Qe(Xt(r,i+e),null,Xt(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Sl=(t,e=Uo,n=js)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(Oo(u)));let i=r.map(u=>new Vf(u,!0)),s=null;const o=new n,a=new Zf(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const p=d.curr.id.clock-h.curr.id.clock;return p===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===br?1:-1:p}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)is(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===br)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{is(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new br(Xt(f,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===br?s.struct.length-=p:d=OO(d,p)),s.struct.mergeWith(d)||(is(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==br;d=u.next())is(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(is(a,s.struct,s.offset),s=null),Xf(a);const c=r.map(u=>zf(u)),l=oO(c);return Lo(o,l),o.toUint8Array()},IO=(t,e,n=Uo,r=js)=>{const i=E_(e),s=new r,o=new Zf(s),a=new n(Oo(t)),c=new Vf(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===br){c.next();continue}if(u.id.clock+u.length>d)for(is(o,u,Ds(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)is(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}Xf(o);const l=zf(a);return Lo(s,l),s.toUint8Array()},M_=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Jr(t.encoder.restEncoder)}),t.encoder.restEncoder=yl(),t.written=0)},is=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&M_(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),re(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Xf=t=>{M_(t);const e=t.encoder.restEncoder;re(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];re(e,r.written),bl(e,r.restEncoder)}},NO=(t,e,n,r)=>{const i=new n(Oo(t)),s=new Vf(i,!1),o=new r,a=new Zf(o);for(let l=s.curr;l!==null;l=s.next())is(a,e(l),0);Xf(a);const c=zf(i);return Lo(o,c),o.toUint8Array()},CO=t=>NO(t,jS,Uo,Ya),U_="You must not compute changes after the event-handler fired.";class Ol{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=LO(this.currentTarget,this.target))}deletes(e){return m_(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw ns(U_);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Ef(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Ef(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Ef(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw ns(U_);const n=this.target,r=Ro(),i=Ro(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const LO=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},wn=()=>{rO("Invalid access: Add Yjs type to a document before reading data.")},F_=80;let qf=0;class MO{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=qf++}}const UO=t=>{t.timestamp=qf++},B_=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=qf++},FO=(t,e,n)=>{if(t.length>=F_){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return B_(r,e,n),r}else{const r=new MO(e,n);return t.push(r),r}},Il=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>gl(e-s.index)<gl(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,UO(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&gl(n.index-i)<r.parent.length/F_?(B_(n,r,i),n):FO(t._searchMarker,r,i)},Va=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=Ds(e,i.index+n))}},Nl=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;ts(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;A_(r._eH,n,e)};class mn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=v_(),this._dEH=v_(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Qr()}clone(){throw Qr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){k_(this._eH,e)}observeDeep(e){k_(this._dEH,e)}unobserve(e){T_(this._eH,e)}unobserveDeep(e){T_(this._dEH,e)}toJSON(){}}const P_=(t,e,n)=>{t.doc??wn(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},D_=t=>{t.doc??wn();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},Za=(t,e)=>{let n=0,r=t._start;for(t.doc??wn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},$_=(t,e)=>{const n=[];return Za(t,(r,i)=>{n.push(e(r,i,t))}),n},BO=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},j_=(t,e)=>{t.doc??wn();const n=Il(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Cl=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Qe(Xt(o,ln(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ws(l)),i.integrate(t,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Qe(Xt(o,ln(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Xa(new Uint8Array(f))),i.integrate(t,0);break;case Mo:i=new Qe(Xt(o,ln(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ja(f)),i.integrate(t,0);break;default:if(f instanceof mn)i=new Qe(Xt(o,ln(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ni(f)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},z_=()=>ns("Length exceeded!"),K_=(t,e,n,r)=>{if(n>e._length)throw z_();if(n===0)return e._searchMarker&&Va(e._searchMarker,n,r.length),Cl(t,e,null,r);const i=n,s=Il(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&rs(t,Xt(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Va(e._searchMarker,i,r.length),Cl(t,e,o,r)},PO=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Cl(t,e,i,n)},W_=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=Il(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&rs(t,Xt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&rs(t,Xt(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw z_();e._searchMarker&&Va(e._searchMarker,i,-s+r)},Ll=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Jf=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new Ws([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Ws([r]);break;case Uint8Array:a=new Xa(r);break;case Mo:a=new Ja(r);break;default:if(r instanceof mn)a=new Ni(r);else throw new Error("Unexpected content type")}new Qe(Xt(o,ln(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Qf=(t,e)=>{t.doc??wn();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},H_=t=>{const e={};return t.doc??wn(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},G_=(t,e)=>{t.doc??wn();const n=t._map.get(e);return n!==void 0&&!n.deleted},DO=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Bo(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Ml=t=>(t.doc??wn(),iO(t._map.entries(),e=>!e[1].deleted));class $O extends Ol{}class Po extends mn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Po;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Po}clone(){const e=new Po;return e.insert(0,this.toArray().map(n=>n instanceof mn?n.clone():n)),e}get length(){return this.doc??wn(),this._length}_callObserver(e,n){super._callObserver(e,n),Nl(this,e,new $O(this,e))}insert(e,n){this.doc!==null?me(this.doc,r=>{K_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?me(this.doc,n=>{PO(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?me(this.doc,r=>{W_(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return j_(this,e)}toArray(){return D_(this)}slice(e=0,n=this.length){return P_(this,e,n)}toJSON(){return this.map(e=>e instanceof mn?e.toJSON():e)}map(e){return $_(this,e)}forEach(e){Za(this,e)}[Symbol.iterator](){return BO(this)}_write(e){e.writeTypeRef(hI)}}const jO=t=>new Po;class zO extends Ol{constructor(e,n,r){super(e,n),this.keysChanged=r}}class Do extends mn{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Do}clone(){const e=new Do;return this.forEach((n,r)=>{e.set(r,n instanceof mn?n.clone():n)}),e}_callObserver(e,n){Nl(this,e,new zO(this,e,n))}toJSON(){this.doc??wn();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof mn?i.toJSON():i}}),e}get size(){return[...Ml(this)].length}keys(){return Df(Ml(this),e=>e[0])}values(){return Df(Ml(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Df(Ml(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??wn(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?me(this.doc,n=>{Ll(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?me(this.doc,r=>{Jf(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Qf(this,e)}has(e){return G_(this,e)}clear(){this.doc!==null?me(this.doc,e=>{this.forEach(function(n,r,i){Ll(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(fI)}}const KO=t=>new Do,ss=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&DS(t,e);class td{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&ti(),this.right.content.constructor){case Je:this.right.deleted||$o(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Y_=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Je:e.right.deleted||$o(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&rs(t,Xt(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Ul=(t,e,n,r)=>{const i=new Map,s=r?Il(e,n):null;if(s){const o=new td(s.p.left,s.p,s.index,i);return Y_(t,o,n-s.index)}else{const o=new td(null,e._start,0,i);return Y_(t,o,n)}},V_=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Je&&ss(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Qe(Xt(s,ln(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Je(a,o));u.integrate(t,0),n.right=u,n.forward()})},$o=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Z_=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Je&&ss(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},X_=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!ss(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Qe(Xt(s,ln(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new Je(a,c)),n.right.integrate(t,0),n.forward()}}return o},ed=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=t.doc,o=s.clientID;Z_(n,i);const a=X_(t,e,n,i),c=r.constructor===String?new ii(r):r instanceof mn?new Ni(r):new Ks(r);let{left:l,right:u,index:f}=n;e._searchMarker&&Va(e._searchMarker,n.index,c.getLength()),u=new Qe(Xt(o,ln(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=f,n.forward(),V_(t,e,n,a)},q_=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;Z_(n,i);const a=X_(t,e,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Je));){if(!n.right.deleted)switch(n.right.content.constructor){case Je:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(ss(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&rs(t,Xt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Qe(Xt(o,ln(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new ii(c)),n.right.integrate(t,0),n.forward()}V_(t,e,n,a)},J_=(t,e,n,r,i)=>{let s=e;const o=Cr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Je){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Je:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(e.delete(t),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&$o(i,l);break}}}e=e.right}return a},WO=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Je){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},HO=t=>{let e=0;return me(t.doc,n=>{let r=t._start,i=t._start,s=Cr();const o=xf(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Je:$o(o,i.content);break;default:e+=J_(n,r,i,s,o),s=xf(o),r=i;break}i=i.right}}),e},GO=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&I_(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Je&&o.constructor!==yr&&e.add(o.parent)})}me(n,r=>{p_(t,t.deleteSet,i=>{if(i instanceof yr||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Je?e.add(s):WO(r,i)});for(const i of e)HO(i)})},Q_=(t,e,n)=>{const r=n,i=xf(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Ni:case Ks:case ii:n<e.right.length&&rs(t,Xt(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&J_(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Va(o._searchMarker,e.index,-r+n),e};class YO extends Ol{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];me(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),l="";break;case"retain":u>0&&(h={retain:u},FS(c)||(h.attributes=LS({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case Ni:case Ks:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case ii:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Je:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;ss(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),ss(p,s.get(h)??null)?delete c[h]:c[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;ss(m,p)||(a==="retain"&&d(),c[h]=m)}else if(!o.deleted){s.set(h,p);const m=c[h];m!==void 0&&(ss(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[h]:c[h]=p))}o.deleted||(a==="insert"&&d(),$o(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Ii extends mn{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??wn(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Ii}clone(){const e=new Ii;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new YO(this,e,n);Nl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??wn();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===ii&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?me(this.doc,r=>{const i=new td(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ed(r,this,i,a,o.attributes||{})}else o.retain!==void 0?q_(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Q_(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??wn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(Bo(c,e)||n!==void 0&&Bo(c,n))switch(c.content.constructor){case ii:{const f=s.get("ychange");e!==void 0&&!Bo(c,e)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Bo(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case Ni:case Ks:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,p)=>{d[p]=h})}i.push(f);break}case Je:Bo(c,e)&&(l(),$o(s,c.content));break}c=c.right}l()};return e||n?me(o,f=>{e&&Wf(f,e),n&&Wf(f,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?me(i,s=>{const o=Ul(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),ed(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?me(i,s=>{const o=Ul(s,this,e,!r);ed(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?me(r,i=>{Q_(i,Ul(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?me(i,s=>{const o=Ul(s,this,e,!1);o.right!==null&&q_(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?me(this.doc,n=>{Ll(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?me(this.doc,r=>{Jf(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Qf(this,e)}getAttributes(){return H_(this)}_write(e){e.writeTypeRef(dI)}}const VO=t=>new Ii;class nd{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??wn()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===jo||n.constructor===zs)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class zs extends mn{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new zs}clone(){const e=new zs;return e.insert(0,this.toArray().map(n=>n instanceof mn?n.clone():n)),e}get length(){return this.doc??wn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new nd(this,e)}querySelector(e){e=e.toUpperCase();const r=new nd(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Ps(new nd(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Nl(this,e,new qO(this,n,e))}toString(){return $_(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Za(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?me(this.doc,r=>{K_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)me(this.doc,r=>{const i=e&&e instanceof mn?e._item:e;Cl(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw ns("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?me(this.doc,r=>{W_(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return D_(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return j_(this,e)}slice(e=0,n=this.length){return P_(this,e,n)}forEach(e){Za(this,e)}_write(e){e.writeTypeRef(mI)}}const ZO=t=>new zs;class jo extends zs{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new jo(this.nodeName)}clone(){const e=new jo(this.nodeName),n=this.getAttributes();return US(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof mn?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?me(this.doc,n=>{Ll(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?me(this.doc,r=>{Jf(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Qf(this,e)}hasAttribute(e){return G_(this,e)}getAttributes(e){return e?DO(this,e):H_(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Za(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(pI),e.writeKey(this.nodeName)}}const XO=t=>new jo(t.readKey());class qO extends Ol{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Fl extends Do{constructor(e){super(),this.hookName=e}_copy(){return new Fl(this.hookName)}clone(){const e=new Fl(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(gI),e.writeKey(this.hookName)}}const JO=t=>new Fl(t.readKey());class Bl extends Ii{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Bl}clone(){const e=new Bl;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(_I)}}const QO=t=>new Bl;class rd{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Qr()}mergeWith(e){return!1}write(e,n,r){throw Qr()}integrate(e,n){throw Qr()}}const tI=0;class yr extends rd{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),S_(e.doc.store,this)}write(e,n){e.writeInfo(tI),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Xa{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Xa(this.content)}splice(e){throw Qr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const eI=t=>new Xa(t.readBuf());class qa{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new qa(this.len)}splice(e){const n=new qa(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){Tl(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const nI=t=>new qa(t.readLen()),ty=(t,e)=>new Mo({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Ja{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ja(ty(this.doc.guid,this.opts))}splice(e){throw Qr()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const rI=t=>new Ja(ty(t.readString(),t.readAny()));class Ks{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Ks(this.embed)}splice(e){throw Qr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const iI=t=>new Ks(t.readJSON());class Je{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Je(this.key,this.value)}splice(e){throw Qr()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const sI=t=>new Je(t.readKey(),t.readJSON());class Pl{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Pl(this.arr)}splice(e){const n=new Pl(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const oI=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Pl(n)},aI=kl("node_env")==="development";class Ws{constructor(e){this.arr=e,aI&&s_(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ws(this.arr)}splice(e){const n=new Ws(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const cI=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Ws(n)};class ii{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ii(this.str)}splice(e){const n=new ii(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const lI=t=>new ii(t.readString()),uI=[jO,KO,VO,XO,ZO,JO,QO],hI=0,fI=1,dI=2,pI=3,mI=4,gI=5,_I=6;class Ni{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ni(this.type._copy())}splice(e){throw Qr()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const yI=t=>new Ni(uI[t.readTypeRef()](t)),Dl=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new Qe(Xt(r,i+n),e,Xt(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Xt(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class Qe extends rd{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?zg:0}set marker(e){(this.info&kf)>0!==e&&(this.info^=kf)}get marker(){return(this.info&kf)>0}get keep(){return(this.info&jg)>0}set keep(e){this.keep!==e&&(this.info^=jg)}get countable(){return(this.info&zg)>0}get deleted(){return(this.info&vf)>0}set deleted(e){this.deleted!==e&&(this.info^=vf)}markDeleted(){this.info|=vf}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ln(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ln(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Fo&&this.id.client!==this.parent.client&&this.parent.clock>=ln(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=O_(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=rs(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===yr||this.right&&this.right.constructor===yr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Qe?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Qe&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Fo){const r=Gf(n,this.parent);r.constructor===yr?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=O_(e,e.doc.store,Xt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Al(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Al(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Gf(e.doc.store,i.origin)))s.has(Gf(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),S_(e.doc.store,this),this.content.integrate(e,this),C_(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new yr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Xt(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Al(e.origin,this.lastId)&&this.right===e&&Al(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Tl(e.deleteSet,this.id.client,this.id.clock,this.length),C_(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw ti();this.content.gc(e),n?vO(e,this,new yr(this.id,this.length)):this.content=new qa(this.length)}write(e,n){const r=n>0?Xt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&_l|(r===null?0:ir)|(i===null?0:Ri)|(s===null?0:Da);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=EO(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Fo?(e.writeParentInfo(!1),e.writeLeftID(a)):ti();s!==null&&e.writeString(s)}this.content.write(e,n)}}const ey=(t,e)=>bI[e&_l](t),bI=[()=>{ti()},nI,oI,eI,lI,iI,sI,yI,cI,rI,()=>{ti()}],wI=10;class br extends rd{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){ti()}write(e,n){e.writeInfo(wI),re(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const ny=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ao<"u"?Ao:{},ry="__ $YJS$ __";ny[ry]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),ny[ry]=!0;let iy=!1;const ar=new Mo;function sy(t,e,n){const r=ar.getMap();if(!r.has(t))switch(e){case 0:case 1:r.set(t,n);break}}function xI(t,e){sy(t,0,e)}function id(t,e){const n=new Ii(e);sy(t,1,n)}function EI(t,e){ar.getMap().set(t,e)}function vI(t,e){const n=ar.getMap(),r=new Ii(e);n.set(t,r)}function oy(t,e){const n=ar.getMap();function r(i){const s=n.get(t);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&e(s)}return n.has(t)&&e(n.get(t)),n.observeDeep(r),()=>{n.observeDeep(r)}}function kI(t,e){return oy(t,n=>{kt(n)&&e(n)})}function ay(t,e){return oy(t,n=>{n instanceof Ii&&e(n.toJSON())})}const Hs=po("modem",["second"],t=>{if(Hs.session(t))switch(t.target){case"second":!iy&&t.data%2===0&&Hs.emit(t.player,"modem:join");break;case"join":t.sender!==Hs.id()&&Hs.reply(t,"joinack",Ug(bO(ar)));break;case"joinack":t.sender!==Hs.id()&&(iy=!0,x_(ar,pl(t.data),ar));break;case"sync":{t.sender!==Hs.id()&&x(t.data)&&x_(ar,pl(t.data),ar);break}}});function cy(t,e){e!==ar&&Hs.emit("","modem:sync",Ug(t))}ar.on("update",cy),ar.on("destroy",()=>{ar.off("update",cy)});function TI(t,e){return t%e}function AI(t,e){return Math.floor(t/e)}function RI(t,e){return{x:TI(t,e),y:AI(t,e)}}function si(t,e){return t.x+t.y*e}function zo(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function ly(t,e,n,r){const i=[],s=Math.min(t,n),o=Math.max(t,n),a=Math.min(e,r),c=Math.max(e,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function uy(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const hy="176",SI="",Lr="srgb",fy="srgb-linear",dy="linear",sd="srgb";function Mr(t,e,n){return Math.max(e,Math.min(n,t))}function OI(t,e){return(t%e+e)%e}function od(t,e,n){return(1-n)*t+n*e}class Qa{constructor(e=0,n=0){Qa.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Mr(this.x,e.x,n.x),this.y=Mr(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Mr(this.x,e,n),this.y=Mr(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Mr(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Mr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class tc{constructor(e,n,r,i,s,o,a,c,l){tc.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],p=r[8],m=i[0],b=i[3],_=i[6],v=i[1],T=i[4],A=i[7],C=i[2],R=i[5],S=i[8];return s[0]=o*m+a*v+c*C,s[3]=o*b+a*T+c*R,s[6]=o*_+a*A+c*S,s[1]=l*m+u*v+f*C,s[4]=l*b+u*T+f*R,s[7]=l*_+u*A+f*S,s[2]=d*m+h*v+p*C,s[5]=d*b+h*T+p*R,s[8]=d*_+h*A+p*S,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,p=n*f+r*d+i*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=f*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=d*m,e[4]=(u*n-i*c)*m,e[5]=(i*s-a*n)*m,e[6]=h*m,e[7]=(r*c-l*n)*m,e[8]=(o*n-r*s)*m,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(ad.makeScale(e,n)),this}rotate(e){return this.premultiply(ad.makeRotation(-e)),this}translate(e,n){return this.premultiply(ad.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const ad=new tc,py=new tc().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),my=new tc().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function II(){const t={enabled:!0,workingColorSpace:fy,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===sd&&(i.r=Ko(i.r),i.g=Ko(i.g),i.b=Ko(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===sd&&(i.r=Wo(i.r),i.g=Wo(i.g),i.b=Wo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===SI?dy:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[fy]:{primaries:e,whitePoint:r,transfer:dy,toXYZ:py,fromXYZ:my,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Lr},outputColorSpaceConfig:{drawingBufferColorSpace:Lr}},[Lr]:{primaries:e,whitePoint:r,transfer:sd,toXYZ:py,fromXYZ:my,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Lr}}}),t}const Ur=II();function Ko(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Wo(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const gy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},os={h:0,s:0,l:0},$l={h:0,s:0,l:0};function cd(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class ld{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Lr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ur.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=Ur.workingColorSpace){return this.r=e,this.g=n,this.b=r,Ur.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=Ur.workingColorSpace){if(e=OI(e,1),n=Mr(n,0,1),r=Mr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=cd(o,s,e+1/3),this.g=cd(o,s,e),this.b=cd(o,s,e-1/3)}return Ur.toWorkingColorSpace(this,i),this}setStyle(e,n=Lr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Lr){const r=gy[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ko(e.r),this.g=Ko(e.g),this.b=Ko(e.b),this}copyLinearToSRGB(e){return this.r=Wo(e.r),this.g=Wo(e.g),this.b=Wo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Lr){return Ur.fromWorkingColorSpace(xn.copy(this),e),Math.round(Mr(xn.r*255,0,255))*65536+Math.round(Mr(xn.g*255,0,255))*256+Math.round(Mr(xn.b*255,0,255))}getHexString(e=Lr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Ur.workingColorSpace){Ur.fromWorkingColorSpace(xn.copy(this),n);const r=xn.r,i=xn.g,s=xn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=Ur.workingColorSpace){return Ur.fromWorkingColorSpace(xn.copy(this),n),e.r=xn.r,e.g=xn.g,e.b=xn.b,e}getStyle(e=Lr){Ur.fromWorkingColorSpace(xn.copy(this),e);const n=xn.r,r=xn.g,i=xn.b;return e!==Lr?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(os),this.setHSL(os.h+e,os.s+n,os.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(os),e.getHSL($l);const r=od(os.h,$l.h,n),i=od(os.s,$l.s,n),s=od(os.l,$l.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const xn=new ld;ld.NAMES=gy,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:hy}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=hy),new Qa,new Qa;function tn(t,e,n){return Math.max(e,Math.min(n,t))}function _y(t){return t/180*Math.PI}function yy(t){return t*180/Math.PI}const NI=Sp("089fad0j9awfem09wavefc09uwaef");function CI(){return NI()}function LI(t){return Sp(t)()}function wr(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(CI()*i)}function by(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(LI(t)*s)}function wy(t,e,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function MI(t){return t[wr(0,t.length-1)]}function UI(t,e){return e[by(t,0,e.length-1)]}function Ae(...t){return MI(t.flat())}function xy(t,...e){return UI(t,e.flat())}function FI(t){return[...new Set(t)].filter(x)}function Gs(t){return x(t)&&x(t.x)&&x(t.y)}function We(t,e){switch(e){case dt.NORTH:--t.y;break;case dt.SOUTH:++t.y;break;case dt.WEST:--t.x;break;case dt.EAST:++t.x;break}return t}function BI(t,e){return t<0?dt.WEST:t>0?dt.EAST:e<0?dt.NORTH:e>0?dt.SOUTH:dt.IDLE}function Fr(t,e){return BI(e.x-t.x,e.y-t.y)}const ud={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Br(t){return ue(t)&&Ey(t[0])}function Ey(t){return x(dt[t])&&gt(t)}function PI(t){const e=dt[t];return x(e)?e:dt.IDLE}function hd(t){if(gt(t))return ud[It(t)]}function DI(t){if(Br(t))return t;if(Ey(t))return[t];const e=hd(t);if(x(e))return[e]}function vy(t){const e=w.words[t],n=DI(e);return Br(n)?[n,t+1]:[void 0,t]}function ky(t){var i,s;const e=[];let[n,r]=vy(t);for(;Br(n);){switch(e.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=rt(w.words,r,[j.NUMBER,j.NUMBER]);e.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=rt(w.words,r,[j.DIR]);e.push(c.destpt.x,c.destpt.y),r=l;break}case"TO":{const[c,l,u]=rt(w.words,r,[j.DIR,j.DIR]),f=((i=w.element)==null?void 0:i.x)??0,d=((s=w.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,e.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[e,r]}const[o,a]=vy(r);n=o,r=a}return e.length?[e,r]:[void 0,t]}function $I(t){return x(t)&&t<At.ONBLACK?t:void 0}function jI(t){return x(t)&&t>At.WHITE&&t<At.ONCLEAR?t-At.ONBLACK:void 0}const ec={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function oi(t){return ue(t)&&Ay(t[0])}function Ty(t){return oi(t)&&t[0].startsWith("ON")}function Ay(t){return x(At[t])&&gt(t)}function jl(t){if(gt(t))return ec[It(t)]}function Ry(t){return t.map(e=>At[e]).find(e=>x(e)&&e<At.ONBLACK)}function Sy(t){return t.map(e=>At[e]).find(e=>x(e)&&e>=At.ONBLACK)}function zI(t){if(oi(t))return t;if(Ay(t))return[t];const e=jl(t);if(x(e))return[e]}function Oy(t){const e=w.words[t],n=zI(e);return oi(n)?[n,t+1]:[void 0,t]}function fd(t){const e=[];let n=t;const[r,i]=Oy(t);if(oi(r)&&(e.push(...r),n=i),oi(e)&&!Ty(e)){const[s,o]=Oy(i);Ty(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function Iy(t){const e={};return t.every(n=>{const r=At[n];x(r)&&(r<At.ONBLACK?e.color=r:e.bg=r-At.ONBLACK)}),e}function Ho(t){return ue(t)&&typeof t[0]=="string"}function KI(t){const e=w.words[t];return gt(e)?[e,t+1]:[void 0,t]}function Ny(t){const e=w.words[t];if(Ho(e))return[e,t+1];const[n,r]=fd(t),[i,s]=KI(r);return gt(i)?[[i,n],s]:[void 0,t]}function zl(t){if(!Ho(t))return;const[e]=t;return e}function dd(t){if(!Ho(t))return;const[,e]=t,n=x(e)?Ry(e):void 0;return x(n)?n:void 0}function Cy(t){if(!Ho(t))return;const[,e]=t,n=x(e)?Sy(e):void 0;return x(n)?n:void 0}var pd;try{pd=new TextDecoder}catch{}var yt,xr,K=0,ge={},qt,as,Er=0,ai=0,un,Ci,$n=[],Vt,Ly={useRecords:!1,mapsAsObjects:!0};class My{}const Uy=new My;Uy.name="MessagePack 0xC1";var cs=!1,Fy=2,By;try{new Function("")}catch{Fy=1/0}class nc{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(yt)return Xy(()=>(bd(),this?this.unpack(e,n):nc.prototype.unpack.call(Ly,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof pn<"u"?pn.from(e):new Uint8Array(e)),typeof n=="object"?(xr=n.end||e.length,K=n.start||0):(K=0,xr=n>-1?n:e.length),ai=0,as=null,un=null,yt=e;try{Vt=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw yt=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof nc){if(ge=this,this.structures)return qt=this.structures,Kl(n);(!qt||qt.length>0)&&(qt=[])}else ge=Ly,(!qt||qt.length>0)&&(qt=[]);return Kl(n)}unpackMultiple(e,n){let r,i=0;try{cs=!0;let s=e.length,o=this?this.unpack(e,s):Wl.unpack(e,s);if(n){if(n(o,i,K)===!1)return;for(;K<s;)if(i=K,n(Kl(),i,K)===!1)return}else{for(r=[o];K<s;)i=K,r.push(Kl());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{cs=!1,bd()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function Kl(t){try{if(!ge.trusted&&!cs){let n=qt.sharedLength||0;n<qt.length&&(qt.length=n)}let e;if(ge.randomAccessStructure&&yt[K]<64&&yt[K]>=32&&By?(e=By(yt,K,xr,ge),yt=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),K=xr):e=He(),un&&(K=un.postBundlePosition,un=null),cs&&(qt.restoreStructures=null),K==xr)qt&&qt.restoreStructures&&Py(),qt=null,yt=null,Ci&&(Ci=null);else{if(K>xr)throw new Error("Unexpected end of MessagePack data");if(!cs){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw qt&&qt.restoreStructures&&Py(),bd(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||K>xr)&&(e.incomplete=!0),e}}function Py(){for(let t in qt.restoreStructures)qt[t]=qt.restoreStructures[t];qt.restoreStructures=null}function He(){let t=yt[K++];if(t<160)if(t<128){if(t<64)return t;{let e=qt[t&63]||ge.getStructures&&$y()[t&63];return e?(e.read||(e.read=md(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,ge.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Gy();r==="__proto__"&&(r="__proto_"),e[r]=He()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(He(),He());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=He();return ge.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(ai>=K)return as.slice(K-Er,(K+=e)-Er);if(ai==0&&xr<140){let n=e<16?_d(e):Ky(e);if(n!=null)return n}return gd(e)}else{let e;switch(t){case 192:return null;case 193:return un?(e=He(),e>0?un[1].slice(un.position1,un.position1+=e):un[0].slice(un.position0,un.position0-=e)):Uy;case 194:return!1;case 195:return!0;case 196:if(e=yt[K++],e===void 0)throw new Error("Unexpected end of buffer");return yd(e);case 197:return e=Vt.getUint16(K),K+=2,yd(e);case 198:return e=Vt.getUint32(K),K+=4,yd(e);case 199:return Ys(yt[K++]);case 200:return e=Vt.getUint16(K),K+=2,Ys(e);case 201:return e=Vt.getUint32(K),K+=4,Ys(e);case 202:if(e=Vt.getFloat32(K),ge.useFloat32>2){let n=wd[(yt[K]&127)<<1|yt[K+1]>>7];return K+=4,(n*e+(e>0?.5:-.5)>>0)/n}return K+=4,e;case 203:return e=Vt.getFloat64(K),K+=8,e;case 204:return yt[K++];case 205:return e=Vt.getUint16(K),K+=2,e;case 206:return e=Vt.getUint32(K),K+=4,e;case 207:return ge.int64AsType==="number"?(e=Vt.getUint32(K)*4294967296,e+=Vt.getUint32(K+4)):ge.int64AsType==="string"?e=Vt.getBigUint64(K).toString():ge.int64AsType==="auto"?(e=Vt.getBigUint64(K),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Vt.getBigUint64(K),K+=8,e;case 208:return Vt.getInt8(K++);case 209:return e=Vt.getInt16(K),K+=2,e;case 210:return e=Vt.getInt32(K),K+=4,e;case 211:return ge.int64AsType==="number"?(e=Vt.getInt32(K)*4294967296,e+=Vt.getUint32(K+4)):ge.int64AsType==="string"?e=Vt.getBigInt64(K).toString():ge.int64AsType==="auto"?(e=Vt.getBigInt64(K),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Vt.getBigInt64(K),K+=8,e;case 212:if(e=yt[K++],e==114)return Vy(yt[K++]&63);{let n=$n[e];if(n)return n.read?(K++,n.read(He())):n.noBuffer?(K++,n()):n(yt.subarray(K,++K));throw new Error("Unknown extension "+e)}case 213:return e=yt[K],e==114?(K++,Vy(yt[K++]&63,yt[K++])):Ys(2);case 214:return Ys(4);case 215:return Ys(8);case 216:return Ys(16);case 217:return e=yt[K++],ai>=K?as.slice(K-Er,(K+=e)-Er):HI(e);case 218:return e=Vt.getUint16(K),K+=2,ai>=K?as.slice(K-Er,(K+=e)-Er):GI(e);case 219:return e=Vt.getUint32(K),K+=4,ai>=K?as.slice(K-Er,(K+=e)-Er):YI(e);case 220:return e=Vt.getUint16(K),K+=2,jy(e);case 221:return e=Vt.getUint32(K),K+=4,jy(e);case 222:return e=Vt.getUint16(K),K+=2,zy(e);case 223:return e=Vt.getUint32(K),K+=4,zy(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const WI=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function md(t,e){function n(){if(n.count++>Fy){let i=t.read=new Function("r","return function(){return "+(ge.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":WI.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(He);return t.highByte===0&&(t.read=Dy(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=He()}return ge.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?Dy(e,n):n}const Dy=(t,e)=>function(){let n=yt[K++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=qt[r]||$y()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=md(i,t)),i.read()};function $y(){let t=Xy(()=>(yt=null,ge.getStructures()));return qt=ge._mergeStructures(t,qt)}var gd=rc,HI=rc,GI=rc,YI=rc;function rc(t){let e;if(t<16&&(e=_d(t)))return e;if(t>64&&pd)return pd.decode(yt.subarray(K,K+=t));const n=K+t,r=[];for(e="";K<n;){const i=yt[K++];if(!(i&128))r.push(i);else if((i&224)===192){const s=yt[K++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=yt[K++]&63,o=yt[K++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=yt[K++]&63,o=yt[K++]&63,a=yt[K++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=hn.apply(String,r),r.length=0)}return r.length>0&&(e+=hn.apply(String,r)),e}function jy(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=He();return ge.freezeData?Object.freeze(e):e}function zy(t){if(ge.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Gy();r==="__proto__"&&(r="__proto_"),e[r]=He()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(He(),He());return e}}var hn=String.fromCharCode;function Ky(t){let e=K,n=new Array(t);for(let r=0;r<t;r++){const i=yt[K++];if((i&128)>0){K=e;return}n[r]=i}return hn.apply(String,n)}function _d(t){if(t<4)if(t<2){if(t===0)return"";{let e=yt[K++];if((e&128)>1){K-=1;return}return hn(e)}}else{let e=yt[K++],n=yt[K++];if((e&128)>0||(n&128)>0){K-=2;return}if(t<3)return hn(e,n);let r=yt[K++];if((r&128)>0){K-=3;return}return hn(e,n,r)}else{let e=yt[K++],n=yt[K++],r=yt[K++],i=yt[K++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){K-=4;return}if(t<6){if(t===4)return hn(e,n,r,i);{let s=yt[K++];if((s&128)>0){K-=5;return}return hn(e,n,r,i,s)}}else if(t<8){let s=yt[K++],o=yt[K++];if((s&128)>0||(o&128)>0){K-=6;return}if(t<7)return hn(e,n,r,i,s,o);let a=yt[K++];if((a&128)>0){K-=7;return}return hn(e,n,r,i,s,o,a)}else{let s=yt[K++],o=yt[K++],a=yt[K++],c=yt[K++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){K-=8;return}if(t<10){if(t===8)return hn(e,n,r,i,s,o,a,c);{let l=yt[K++];if((l&128)>0){K-=9;return}return hn(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=yt[K++],u=yt[K++];if((l&128)>0||(u&128)>0){K-=10;return}if(t<11)return hn(e,n,r,i,s,o,a,c,l,u);let f=yt[K++];if((f&128)>0){K-=11;return}return hn(e,n,r,i,s,o,a,c,l,u,f)}else{let l=yt[K++],u=yt[K++],f=yt[K++],d=yt[K++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){K-=12;return}if(t<14){if(t===12)return hn(e,n,r,i,s,o,a,c,l,u,f,d);{let h=yt[K++];if((h&128)>0){K-=13;return}return hn(e,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=yt[K++],p=yt[K++];if((h&128)>0||(p&128)>0){K-=14;return}if(t<15)return hn(e,n,r,i,s,o,a,c,l,u,f,d,h,p);let m=yt[K++];if((m&128)>0){K-=15;return}return hn(e,n,r,i,s,o,a,c,l,u,f,d,h,p,m)}}}}}function Wy(){let t=yt[K++],e;if(t<192)e=t-160;else switch(t){case 217:e=yt[K++];break;case 218:e=Vt.getUint16(K),K+=2;break;case 219:e=Vt.getUint32(K),K+=4;break;default:throw new Error("Expected string")}return rc(e)}function yd(t){return ge.copyBuffers?Uint8Array.prototype.slice.call(yt,K,K+=t):yt.subarray(K,K+=t)}function Ys(t){let e=yt[K++];if($n[e]){let n;return $n[e](yt.subarray(K,n=K+=t),r=>{K=r;try{return He()}finally{K=n}})}else throw new Error("Unknown extension type "+e)}var Hy=new Array(4096);function Gy(){let t=yt[K++];if(t>=160&&t<192){if(t=t-160,ai>=K)return as.slice(K-Er,(K+=t)-Er);if(!(ai==0&&xr<180))return gd(t)}else return K--,Yy(He());let e=(t<<5^(t>1?Vt.getUint16(K):t>0?yt[K]:0))&4095,n=Hy[e],r=K,i=K+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Vt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=yt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return K=r,n.string;i-=3,r=K}for(n=[],Hy[e]=n,n.bytes=t;r<i;)s=Vt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=yt[r++],n.push(s);let a=t<16?_d(t):Ky(t);return a!=null?n.string=a:n.string=gd(t)}function Yy(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const Vy=(t,e)=>{let n=He().map(Yy),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=qt[t];return i&&(i.isShared||cs)&&((qt.restoreStructures||(qt.restoreStructures=[]))[t]=i),qt[t]=n,n.read=md(n,r),n.read()};$n[0]=()=>{},$n[0].noBuffer=!0,$n[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let VI={Error,TypeError,ReferenceError};$n[101]=()=>{let t=He();return(VI[t[0]]||Error)(t[1],{cause:t[2]})},$n[105]=t=>{if(ge.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Vt.getUint32(K-4);Ci||(Ci=new Map);let n=yt[K],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Ci.set(e,i);let s=He();return i.used?Object.assign(r,s):(i.target=s,s)},$n[112]=t=>{if(ge.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Vt.getUint32(K-4),n=Ci.get(e);return n.used=!0,n.target},$n[115]=()=>new Set(He());const Zy=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let ZI=typeof globalThis=="object"?globalThis:window;$n[116]=t=>{let e=t[0],n=Zy[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new ZI[n](Uint8Array.prototype.slice.call(t,1).buffer)},$n[120]=()=>{let t=He();return new RegExp(t[0],t[1])};const XI=[];$n[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=K;return K+=e-t.length,un=XI,un=[Wy(),Wy()],un.position0=0,un.position1=0,un.postBundlePosition=K,K=n,He()},$n[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function Xy(t){let e=xr,n=K,r=Er,i=ai,s=as,o=Ci,a=un,c=new Uint8Array(yt.slice(0,xr)),l=qt,u=qt.slice(0,qt.length),f=ge,d=cs,h=t();return xr=e,K=n,Er=r,ai=i,as=s,Ci=o,un=a,yt=c,cs=d,qt=l,qt.splice(0,qt.length,...u),ge=f,Vt=new DataView(yt.buffer,yt.byteOffset,yt.byteLength),h}function bd(){yt=null,Ci=null,qt=null}const wd=new Array(147);for(let t=0;t<256;t++)wd[t]=+("1e"+Math.floor(45.15-t*.30103));var Wl=new nc({useRecords:!1});const qI=Wl.unpack;Wl.unpackMultiple,Wl.unpack;let JI=new Float32Array(1);new Uint8Array(JI.buffer,0,4);let Hl;try{Hl=new TextEncoder}catch{}let xd,qy;const Gl=typeof pn<"u",Yl=Gl?function(t){return pn.allocUnsafeSlow(t)}:Uint8Array,Jy=Gl?pn:Uint8Array,Qy=Gl?4294967296:2144337920;let q,ic,_e,G=0,Rn,Le=null,QI;const tN=21760,eN=/[\u0080-\uFFFF]/,Go=Symbol("record-id");class nN extends nc{constructor(e){super(e),this.offset=0;let n,r,i,s,o=Jy.prototype.utf8Write?function(N,E){return q.utf8Write(N,E,q.byteLength-E)}:Hl&&Hl.encodeInto?function(N,E){return Hl.encodeInto(N,q.subarray(E)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let f=e.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,p=u+f+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],b=0,_=0;this.pack=this.encode=function(N,E){if(q||(q=new Yl(8192),_e=q.dataView||(q.dataView=new DataView(q.buffer,0,8192)),G=0),Rn=q.length-10,Rn-G<2048?(q=new Yl(q.length),_e=q.dataView||(q.dataView=new DataView(q.buffer,0,q.length)),Rn=q.length-10,G=0):G=G+7&2147483640,n=G,E&lN&&(G+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof N!="string"?(Le=[],Le.size=1/0):Le=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let Z=i.sharedLength||0;if(Z>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let $=0;$<Z;$++){let st=i[$];if(!st)continue;let nt,at=i.transitions;for(let Y=0,H=st.length;Y<H;Y++){let wt=st[Y];nt=at[wt],nt||(nt=at[wt]=Object.create(null)),at=nt}at[Go]=$+64}this.lastNamedStructuresLength=Z}c||(i.nextId=Z+64)}r&&(r=!1);let D;try{a.randomAccessStructure&&N&&N.constructor&&N.constructor===Object?L(N):A(N);let Z=Le;if(Le&&nb(n,A,0),s&&s.idsToInsert){let $=s.idsToInsert.sort((Y,H)=>Y.offset>H.offset?1:-1),st=$.length,nt=-1;for(;Z&&st>0;){let Y=$[--st].offset+n;Y<Z.stringsPosition+n&&nt===-1&&(nt=0),Y>Z.position+n?nt>=0&&(nt+=6):(nt>=0&&(_e.setUint32(Z.position+n,_e.getUint32(Z.position+n)+nt),nt=-1),Z=Z.previous,st++)}nt>=0&&Z&&_e.setUint32(Z.position+n,_e.getUint32(Z.position+n)+nt),G+=$.length*6,G>Rn&&I(G),a.offset=G;let at=iN(q.subarray(n,G),$);return s=null,at}return a.offset=G,E&aN?(q.start=n,q.end=G,q):q.subarray(n,G)}catch(Z){throw D=Z,Z}finally{if(i&&(v(),r&&a.saveStructures)){let Z=i.sharedLength||0,$=q.subarray(n,G),st=sN(i,a);if(!D)return a.saveStructures(st,st.isCompatible)===!1?a.pack(N,E):(a.lastNamedStructuresLength=Z,q.length>1073741824&&(q=null),$)}q.length>1073741824&&(q=null),E&cN&&(G=n)}};const v=()=>{_<10&&_++;let N=i.sharedLength||0;if(i.length>N&&!c&&(i.length=N),b>1e4)i.transitions=null,_=0,b=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let E=0,D=m.length;E<D;E++)m[E][Go]=0;m=[]}},T=N=>{var E=N.length;E<16?q[G++]=144|E:E<65536?(q[G++]=220,q[G++]=E>>8,q[G++]=E&255):(q[G++]=221,_e.setUint32(G,E),G+=4);for(let D=0;D<E;D++)A(N[D])},A=N=>{G>Rn&&(q=I(G));var E=typeof N,D;if(E==="string"){let Z=N.length;if(Le&&Z>=4&&Z<4096){if((Le.size+=Z)>tN){let at,Y=(Le[0]?Le[0].length*3+Le[1].length:0)+10;G+Y>Rn&&(q=I(G+Y));let H;Le.position?(H=Le,q[G]=200,G+=3,q[G++]=98,at=G-n,G+=4,nb(n,A,0),_e.setUint16(at+n-3,G-n-at)):(q[G++]=214,q[G++]=98,at=G-n,G+=4),Le=["",""],Le.previous=H,Le.size=0,Le.position=at}let nt=eN.test(N);Le[nt?0:1]+=N,q[G++]=193,A(nt?-Z:Z);return}let $;Z<32?$=1:Z<256?$=2:Z<65536?$=3:$=5;let st=Z*3;if(G+st>Rn&&(q=I(G+st)),Z<64||!o){let nt,at,Y,H=G+$;for(nt=0;nt<Z;nt++)at=N.charCodeAt(nt),at<128?q[H++]=at:at<2048?(q[H++]=at>>6|192,q[H++]=at&63|128):(at&64512)===55296&&((Y=N.charCodeAt(nt+1))&64512)===56320?(at=65536+((at&1023)<<10)+(Y&1023),nt++,q[H++]=at>>18|240,q[H++]=at>>12&63|128,q[H++]=at>>6&63|128,q[H++]=at&63|128):(q[H++]=at>>12|224,q[H++]=at>>6&63|128,q[H++]=at&63|128);D=H-G-$}else D=o(N,G+$);D<32?q[G++]=160|D:D<256?($<2&&q.copyWithin(G+2,G+1,G+1+D),q[G++]=217,q[G++]=D):D<65536?($<3&&q.copyWithin(G+3,G+2,G+2+D),q[G++]=218,q[G++]=D>>8,q[G++]=D&255):($<5&&q.copyWithin(G+5,G+3,G+3+D),q[G++]=219,_e.setUint32(G,D),G+=4),G+=D}else if(E==="number")if(N>>>0===N)N<32||N<128&&this.useRecords===!1||N<64&&!this.randomAccessStructure?q[G++]=N:N<256?(q[G++]=204,q[G++]=N):N<65536?(q[G++]=205,q[G++]=N>>8,q[G++]=N&255):(q[G++]=206,_e.setUint32(G,N),G+=4);else if(N>>0===N)N>=-32?q[G++]=256+N:N>=-128?(q[G++]=208,q[G++]=N+256):N>=-32768?(q[G++]=209,_e.setInt16(G,N),G+=2):(q[G++]=210,_e.setInt32(G,N),G+=4);else{let Z;if((Z=this.useFloat32)>0&&N<4294967296&&N>=-2147483648){q[G++]=202,_e.setFloat32(G,N);let $;if(Z<4||($=N*wd[(q[G]&127)<<1|q[G+1]>>7])>>0===$){G+=4;return}else G--}q[G++]=203,_e.setFloat64(G,N),G+=8}else if(E==="object"||E==="function")if(!N)q[G++]=192;else{if(s){let $=s.get(N);if($){if(!$.id){let st=s.idsToInsert||(s.idsToInsert=[]);$.id=st.push($)}q[G++]=214,q[G++]=112,_e.setUint32(G,$.id),G+=4;return}else s.set(N,{offset:G-n})}let Z=N.constructor;if(Z===Object)U(N);else if(Z===Array)T(N);else if(Z===Map)if(this.mapAsEmptyObject)q[G++]=128;else{D=N.size,D<16?q[G++]=128|D:D<65536?(q[G++]=222,q[G++]=D>>8,q[G++]=D&255):(q[G++]=223,_e.setUint32(G,D),G+=4);for(let[$,st]of N)A($),A(st)}else{for(let $=0,st=xd.length;$<st;$++){let nt=qy[$];if(N instanceof nt){let at=xd[$];if(at.write){at.type&&(q[G++]=212,q[G++]=at.type,q[G++]=0);let ht=at.write.call(this,N);ht===N?Array.isArray(N)?T(N):U(N):A(ht);return}let Y=q,H=_e,wt=G;q=null;let lt;try{lt=at.pack.call(this,N,ht=>(q=Y,Y=null,G+=ht,G>Rn&&I(G),{target:q,targetView:_e,position:G-ht}),A)}finally{Y&&(q=Y,_e=H,G=wt,Rn=q.length-10)}lt&&(lt.length+G>Rn&&I(lt.length+G),G=rN(lt,q,G,at.type));return}}if(Array.isArray(N))T(N);else{if(N.toJSON){const $=N.toJSON();if($!==N)return A($)}if(E==="function")return A(this.writeFunction&&this.writeFunction(N));U(N)}}}else if(E==="boolean")q[G++]=N?195:194;else if(E==="bigint"){if(N<BigInt(1)<<BigInt(63)&&N>=-(BigInt(1)<<BigInt(63)))q[G++]=211,_e.setBigInt64(G,N);else if(N<BigInt(1)<<BigInt(64)&&N>0)q[G++]=207,_e.setBigUint64(G,N);else if(this.largeBigIntToFloat)q[G++]=203,_e.setFloat64(G,Number(N));else{if(this.largeBigIntToString)return A(N.toString());if(this.useBigIntExtension&&N<BigInt(2)**BigInt(1023)&&N>-(BigInt(2)**BigInt(1023))){q[G++]=199,G++,q[G++]=66;let Z=[],$;do{let st=N&BigInt(255);$=(st&BigInt(128))===(N<BigInt(0)?BigInt(128):BigInt(0)),Z.push(st),N>>=BigInt(8)}while(!((N===BigInt(0)||N===BigInt(-1))&&$));q[G-2]=Z.length;for(let st=Z.length;st>0;)q[G++]=Number(Z[--st]);return}else throw new RangeError(N+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}G+=8}else if(E==="undefined")this.encodeUndefinedAsNil?q[G++]=192:(q[G++]=212,q[G++]=0,q[G++]=0);else throw new Error("Unknown type: "+E)},C=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?N=>{let E;if(this.skipValues){E=[];for(let $ in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty($))&&!this.skipValues.includes(N[$])&&E.push($)}else E=Object.keys(N);let D=E.length;D<16?q[G++]=128|D:D<65536?(q[G++]=222,q[G++]=D>>8,q[G++]=D&255):(q[G++]=223,_e.setUint32(G,D),G+=4);let Z;if(this.coercibleKeyAsNumber)for(let $=0;$<D;$++){Z=E[$];let st=Number(Z);A(isNaN(st)?Z:st),A(N[Z])}else for(let $=0;$<D;$++)A(Z=E[$]),A(N[Z])}:N=>{q[G++]=222;let E=G-n;G+=2;let D=0;for(let Z in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(Z))&&(A(Z),A(N[Z]),D++);if(D>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');q[E+++n]=D>>8,q[E+n]=D&255},R=this.useRecords===!1?C:e.progressiveRecords&&!d?N=>{let E,D=i.transitions||(i.transitions=Object.create(null)),Z=G++-n,$;for(let st in N)if(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st)){if(E=D[st],E)D=E;else{let nt=Object.keys(N),at=D;D=i.transitions;let Y=0;for(let H=0,wt=nt.length;H<wt;H++){let lt=nt[H];E=D[lt],E||(E=D[lt]=Object.create(null),Y++),D=E}Z+n+1==G?(G--,P(D,nt,Y)):W(D,nt,Z,Y),$=!0,D=at[st]}A(N[st])}if(!$){let st=D[Go];st?q[Z+n]=st:W(D,Object.keys(N),Z,0)}}:N=>{let E,D=i.transitions||(i.transitions=Object.create(null)),Z=0;for(let st in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st))&&(E=D[st],E||(E=D[st]=Object.create(null),Z++),D=E);let $=D[Go];$?$>=96&&d?(q[G++]=(($-=96)&31)+96,q[G++]=$>>5):q[G++]=$:P(D,D.__keys__||Object.keys(N),Z);for(let st in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st))&&A(N[st])},S=typeof this.useRecords=="function"&&this.useRecords,U=S?N=>{S(N)?R(N):C(N)}:R,I=N=>{let E;if(N>16777216){if(N-n>Qy)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(Qy,Math.round(Math.max((N-n)*(N>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(N-n<<2,q.length-1)>>12)+1<<12;let D=new Yl(E);return _e=D.dataView||(D.dataView=new DataView(D.buffer,0,E)),N=Math.min(N,q.length),q.copy?q.copy(D,0,n,N):D.set(q.slice(n,N)),G-=n,n=0,Rn=D.length-10,q=D},P=(N,E,D)=>{let Z=i.nextId;Z||(Z=64),Z<h&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(Z=i.nextOwnId,Z<p||(Z=h),i.nextOwnId=Z+1):(Z>=p&&(Z=h),i.nextId=Z+1);let $=E.highByte=Z>=96&&d?Z-96>>5:-1;N[Go]=Z,N.__keys__=E,i[Z-64]=E,Z<h?(E.isShared=!0,i.sharedLength=Z-63,r=!0,$>=0?(q[G++]=(Z&31)+96,q[G++]=$):q[G++]=Z):($>=0?(q[G++]=213,q[G++]=114,q[G++]=(Z&31)+96,q[G++]=$):(q[G++]=212,q[G++]=114,q[G++]=Z),D&&(b+=_*D),m.length>=f&&(m.shift()[Go]=0),m.push(N),A(E))},W=(N,E,D,Z)=>{let $=q,st=G,nt=Rn,at=n;q=ic,G=0,n=0,q||(ic=q=new Yl(8192)),Rn=q.length-10,P(N,E,Z),ic=q;let Y=G;if(q=$,G=st,Rn=nt,n=at,Y>1){let H=G+Y-1;H>Rn&&I(H);let wt=D+n;q.copyWithin(wt+Y,wt+1,G),q.set(ic.slice(0,Y),wt),G=H}else q[D+n]=ic[0]},L=N=>{let E=QI(N,q,n,G,i,I,(D,Z,$)=>{if($)return r=!0;G=Z;let st=q;return A(D),v(),st!==q?{position:G,targetView:_e,target:q}:G},this);if(E===0)return U(N);G=E}}useBuffer(e){q=e,q.dataView||(q.dataView=new DataView(q.buffer,q.byteOffset,q.byteLength)),G=0}set position(e){G=e}get position(){return G}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}qy=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,My],xd=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?tb(t,16,e):eb(Gl?pn.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==Jy&&this.moreTypes?tb(t,Zy.indexOf(n.name),e):eb(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function tb(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function eb(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function rN(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function iN(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function nb(t,e,n){if(Le.length>0){_e.setUint32(Le.position+t,G+n-Le.position-t),Le.stringsPosition=G-t;let r=Le;Le=null,e(r[0]),e(r[1])}}function sN(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let rb=new nN({useRecords:!1});const oN=rb.pack;rb.pack;const aN=512,cN=1024,lN=2048,tt=po("SOFTWARE");function Re(){return null}function Yo(t,e,n={}){if(!x(t))return;const r=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=n[o];x(c)&&(a=c(a));const l=e[o];x(l)&&(o=l),a!==null&&r.push(o,a)}return r}function sc(t,e,n={}){if(x(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];x(a)&&(s=a);const c=n[s];x(c)&&(o=c(o)),r[s]=o}return r}catch(r){de(tt,"","binary",r.message)}}function uN(t){try{const e=tr(t);return oN(e)}catch(e){de(tt,"","binary",e.message)}}function hN(t){try{return qI(t)}catch(e){de(tt,"","binary",e.message)}}function ib(){return{id:ze()}}var Vl=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.breakable=16]="breakable",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.stopped=27]="stopped",t[t.removed=28]="removed",t[t.party=29]="party",t[t.group=30]="group",t[t.lightdir=31]="lightdir",t))(Vl||{});function Zl(t){return x(t==null?void 0:t.id)?Yo(t,Vl,{category:Re,kinddata:Re,stopped:Re,removed:Re,bucket:Re}):Yo(t,Vl,{id:Re,x:Re,y:Re,lx:Re,ly:Re,code:Re,category:Re,kinddata:Re,stopped:Re,removed:Re,bucket:Re})}function Xl(t){return sc(t,Vl)}function gn(t){var e;return(((e=t==null?void 0:t.id)==null?void 0:e.length)??0)>0}function oc(t,e){if(!x(t)||!oi(e))return;const{color:n,bg:r}=Iy(e);x(n)&&(t.color=n),x(r)&&(t.bg=r)}function ci(t){var e;return It((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"")}const Tt=60,Ht=25,Ed=Tt*Ht;var _t=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(_t||{});function fN(){return new Array(Tt*Ht).map(()=>{})}function ql(t=Sh){const e={terrain:fN(),objects:{},id:""};return t(e)}var vd=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t[t.camera=12]="camera",t[t.graphics=13]="graphics",t))(vd||{});function dN(t){return Yo(t,vd,{terrain:e=>e.map(Zl),objects:e=>Object.values(e).filter(n=>!n.removed).map(Zl),id:Re,named:Re,lookup:Re,codepage:Re,distmaps:Re,overboard:Re,underboard:Re})}function pN(t){return sc(t,vd,{terrain:e=>e.map(Xl),objects:e=>{const n={};for(let r=0;r<e.length;++r){const i=Xl(e[r]);x(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Jl(t){return zo(t.x,t.y,0,Tt-1,Ht-1,0)}function Pr(t,e){return!x(t)||!x(e==null?void 0:e.x)||!x(e==null?void 0:e.y)||e.x<0||e.x>=Tt||e.y<0||e.y>=Ht?-1:e.x+e.y*Tt}function Jt(t,e){const n=Pr(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=Sn(t,t.lookup[n]??"");return x(r)?r:t.terrain[n]}function mN(t,e){const n=Sn(t,e);if(x(n))return n;const r=parseFloat(e),i=RI(isNaN(r)?-1:r,Tt);return ls(t,i.x,i.y)}function ls(t,e,n){return(e>=0&&e<Tt)??(n>=0&&n<Ht)?t==null?void 0:t.terrain[e+n*Tt]:void 0}function Se(t,e){if(!x(t)||!x(e)||!x(e.x)||!x(e.y)||e.x<0||e.x>=Tt||e.y<0||e.y>=Ht)return;const n=tr(e),r=e.x+e.y*Tt;return t.terrain[r]=n,delete t.distmaps,t.terrain[r]}function kd(t,e){if(!x(t)||!x(e))return;const n=tr(e);return n.id=n.id??ze(),t.objects[n.id]=n,t.objects[n.id]}function gN(t,e,n){return Se(t,{...e,kind:n})}function Td(t,e,n,r){return kd(t,{...e,kind:n,id:r})}function Sn(t,e){if(t)return t.objects[e]}function _N(t,e){const n=Pr(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=Sn(t,t.lookup[n]??"");if(x(r))return r}function sb(t,e){return x(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function yN(t,e,n){if(!x(t)||!x(e))return;const r=t.objects[n];if(x(r))return r;if(Gs(e))return ab(e,lc(t,"player"))}function ac(t,e){const n=t??Ut.ISWALK,r=e??Ut.ISWALK;switch(n){case Ut.ISWALK:return r!==Ut.ISWALK;case Ut.ISSWIM:return r!==Ut.ISSWIM;case Ut.ISSOLID:return!0;case Ut.ISBULLET:return r!==Ut.ISWALK&&r!==Ut.ISSWIM}}function cc(t,e,n){const r=t==null?void 0:t.objects[n];if(x(r))return r;const i=lc(t,"player");return x(e)?(e.x<0&&(e.x=wr(0,Tt-1)),e.y<0&&(e.y=wr(0,Ht-1)),ab(e,i)):Ae(...i)}function lc(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(x)}function bN(t){const e=[];for(let n=0;n<Ht;++n)for(let r=0;r<Tt;++r){const i={x:r,y:n},s=Jt(t,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&e.push(i)}return e}function Ad(t,e){const n=zl(e),r=dd(e),i=Cy(e);return lc(t,n??"").filter(s=>{var o,a,c;return!(x(n)&&It((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||x(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??At.WHITE)!==r||x(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??At.BLACK)!==i)}).filter(x)}function ob(t,e){return x(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(x(i))return i;const s=lc(t,It(n));if(s.length)return s}else if(Gs(n)&&n.x>=0&&n.x<Tt&&n.y>=0&&n.y<Ht){const i=n.x+n.y*Tt,s=(r=t.lookup)==null?void 0:r[i];return x(s)?t.objects[s]:t.terrain[i]}}).flat().filter(x):[]}function ab(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function cb(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}const Rd=14,uc=3,us=8,hs=14,Ql=16,wN=16,xN=16;var tu=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(tu||{});function hc(t,e){return new Array(t).fill(e)}function EN(t,e,n,r,i,s=0){const o=r*i;return{id:`tiles:${t}:${e}`,type:1,tag:n,width:r,height:i,char:hc(o,0),color:hc(o,0),bg:hc(o,s),wall:hc(o,0)}}function vN(t,e,n,r=1,i=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:i,bg:At.ONCLEAR}}function kN(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function TN(t,e,n,r,i=0){const s=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:hc(s,i)}}function AN(t,e,n,r){return{id:`media:${t}:${e}`,type:4,mime:n,media:r}}function RN(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:1.5,graphics:"flat",facing:0}}function lb(t,e){return`${t}:${e}`}const SN=1,ON=16,IN=256;var On=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(On||{});function Sd(t){const e=Math.floor(t.length/uc);if(e*uc!==t.length)return;const n=cb(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function NN(t,e){return t&1<<e?255:0}function ub(t){const e=Math.floor(t.length/Rd);if(e*Rd!==t.length)return;const n=Math.ceil(e/Ql),r=us*Ql,i=cb(r,hs*n);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*hs+a,u=t[c];for(let f=0;f<us;++f){const d=s*us+f;i.bits[d+l*r]=NN(u,7-f)}++a,a===hs&&(a=0,++s,s===Ql&&(s=0,++o))}return i}const CN=pl("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),hb=pl("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var fb=typeof Ao=="object"&&Ao&&Ao.Object===Object&&Ao,LN=typeof self=="object"&&self&&self.Object===Object&&self,li=fb||LN||Function("return this")(),vr=li.Symbol,db=Object.prototype,MN=db.hasOwnProperty,UN=db.toString,fc=vr?vr.toStringTag:void 0;function FN(t){var e=MN.call(t,fc),n=t[fc];try{t[fc]=void 0;var r=!0}catch{}var i=UN.call(t);return r&&(e?t[fc]=n:delete t[fc]),i}var BN=Object.prototype,PN=BN.toString;function DN(t){return PN.call(t)}var $N="[object Null]",jN="[object Undefined]",pb=vr?vr.toStringTag:void 0;function fs(t){return t==null?t===void 0?jN:$N:pb&&pb in Object(t)?FN(t):DN(t)}function Dr(t){return t!=null&&typeof t=="object"}var zN="[object Symbol]";function eu(t){return typeof t=="symbol"||Dr(t)&&fs(t)==zN}function nu(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var ne=Array.isArray,KN=1/0,mb=vr?vr.prototype:void 0,gb=mb?mb.toString:void 0;function _b(t){if(typeof t=="string")return t;if(ne(t))return nu(t,_b)+"";if(eu(t))return gb?gb.call(t):"";var e=t+"";return e=="0"&&1/t==-KN?"-0":e}var WN=/\s/;function HN(t){for(var e=t.length;e--&&WN.test(t.charAt(e)););return e}var GN=/^\s+/;function YN(t){return t&&t.slice(0,HN(t)+1).replace(GN,"")}function kr(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var yb=NaN,VN=/^[-+]0x[0-9a-f]+$/i,ZN=/^0b[01]+$/i,XN=/^0o[0-7]+$/i,qN=parseInt;function JN(t){if(typeof t=="number")return t;if(eu(t))return yb;if(kr(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=kr(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=YN(t);var n=ZN.test(t);return n||XN.test(t)?qN(t.slice(2),n?2:8):VN.test(t)?yb:+t}var bb=1/0,QN=17976931348623157e292;function tC(t){if(!t)return t===0?t:0;if(t=JN(t),t===bb||t===-bb){var e=t<0?-1:1;return e*QN}return t===t?t:0}function ru(t){var e=tC(t),n=e%1;return e===e?n?e-n:e:0}function Vo(t){return t}var eC="[object AsyncFunction]",nC="[object Function]",rC="[object GeneratorFunction]",iC="[object Proxy]";function Li(t){if(!kr(t))return!1;var e=fs(t);return e==nC||e==rC||e==eC||e==iC}var Od=li["__core-js_shared__"],wb=function(){var t=/[^.]+$/.exec(Od&&Od.keys&&Od.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function sC(t){return!!wb&&wb in t}var oC=Function.prototype,aC=oC.toString;function Vs(t){if(t!=null){try{return aC.call(t)}catch{}try{return t+""}catch{}}return""}var cC=/[\\^$.*+?()[\]{}|]/g,lC=/^\[object .+?Constructor\]$/,uC=Function.prototype,hC=Object.prototype,fC=uC.toString,dC=hC.hasOwnProperty,pC=RegExp("^"+fC.call(dC).replace(cC,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function mC(t){if(!kr(t)||sC(t))return!1;var e=Li(t)?pC:lC;return e.test(Vs(t))}function gC(t,e){return t==null?void 0:t[e]}function Zs(t,e){var n=gC(t,e);return mC(n)?n:void 0}var Id=Zs(li,"WeakMap"),xb=Object.create,_C=function(){function t(){}return function(e){if(!kr(e))return{};if(xb)return xb(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function yC(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function en(){}function bC(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var wC=800,xC=16,EC=Date.now;function vC(t){var e=0,n=0;return function(){var r=EC(),i=xC-(r-n);if(n=r,i>0){if(++e>=wC)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function kC(t){return function(){return t}}var iu=function(){try{var t=Zs(Object,"defineProperty");return t({},"",{}),t}catch{}}(),TC=iu?function(t,e){return iu(t,"toString",{configurable:!0,enumerable:!1,value:kC(e),writable:!0})}:Vo,AC=vC(TC);function Eb(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function vb(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function RC(t){return t!==t}function SC(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function Nd(t,e,n){return e===e?SC(t,e,n):vb(t,RC,n)}function kb(t,e){var n=t==null?0:t.length;return!!n&&Nd(t,e,0)>-1}var OC=9007199254740991,IC=/^(?:0|[1-9]\d*)$/;function su(t,e){var n=typeof t;return e=e??OC,!!e&&(n=="number"||n!="symbol"&&IC.test(t))&&t>-1&&t%1==0&&t<e}function Cd(t,e,n){e=="__proto__"&&iu?iu(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function dc(t,e){return t===e||t!==t&&e!==e}var NC=Object.prototype,CC=NC.hasOwnProperty;function ou(t,e,n){var r=t[e];(!(CC.call(t,e)&&dc(r,n))||n===void 0&&!(e in t))&&Cd(t,e,n)}function Ld(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?Cd(n,a,c):ou(n,a,c)}return n}var Tb=Math.max;function LC(t,e,n){return e=Tb(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=Tb(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),yC(t,this,a)}}function Md(t,e){return AC(LC(t,e,Vo),t+"")}var MC=9007199254740991;function Ud(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=MC}function ui(t){return t!=null&&Ud(t.length)&&!Li(t)}function Ab(t,e,n){if(!kr(n))return!1;var r=typeof e;return(r=="number"?ui(n)&&su(e,n.length):r=="string"&&e in n)?dc(n[e],t):!1}function UC(t){return Md(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&Ab(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var FC=Object.prototype;function pc(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||FC;return t===n}function BC(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var PC="[object Arguments]";function Rb(t){return Dr(t)&&fs(t)==PC}var Sb=Object.prototype,DC=Sb.hasOwnProperty,$C=Sb.propertyIsEnumerable,au=Rb(function(){return arguments}())?Rb:function(t){return Dr(t)&&DC.call(t,"callee")&&!$C.call(t,"callee")};function jC(){return!1}var Ob=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ib=Ob&&typeof module=="object"&&module&&!module.nodeType&&module,zC=Ib&&Ib.exports===Ob,Nb=zC?li.Buffer:void 0,KC=Nb?Nb.isBuffer:void 0,mc=KC||jC,WC="[object Arguments]",HC="[object Array]",GC="[object Boolean]",YC="[object Date]",VC="[object Error]",ZC="[object Function]",XC="[object Map]",qC="[object Number]",JC="[object Object]",QC="[object RegExp]",t6="[object Set]",e6="[object String]",n6="[object WeakMap]",r6="[object ArrayBuffer]",i6="[object DataView]",s6="[object Float32Array]",o6="[object Float64Array]",a6="[object Int8Array]",c6="[object Int16Array]",l6="[object Int32Array]",u6="[object Uint8Array]",h6="[object Uint8ClampedArray]",f6="[object Uint16Array]",d6="[object Uint32Array]",xe={};xe[s6]=xe[o6]=xe[a6]=xe[c6]=xe[l6]=xe[u6]=xe[h6]=xe[f6]=xe[d6]=!0,xe[WC]=xe[HC]=xe[r6]=xe[GC]=xe[i6]=xe[YC]=xe[VC]=xe[ZC]=xe[XC]=xe[qC]=xe[JC]=xe[QC]=xe[t6]=xe[e6]=xe[n6]=!1;function p6(t){return Dr(t)&&Ud(t.length)&&!!xe[fs(t)]}function cu(t){return function(e){return t(e)}}var Cb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,gc=Cb&&typeof module=="object"&&module&&!module.nodeType&&module,m6=gc&&gc.exports===Cb,Fd=m6&&fb.process,ds=function(){try{var t=gc&&gc.require&&gc.require("util").types;return t||Fd&&Fd.binding&&Fd.binding("util")}catch{}}(),Lb=ds&&ds.isTypedArray,Bd=Lb?cu(Lb):p6,g6=Object.prototype,_6=g6.hasOwnProperty;function Mb(t,e){var n=ne(t),r=!n&&au(t),i=!n&&!r&&mc(t),s=!n&&!r&&!i&&Bd(t),o=n||r||i||s,a=o?BC(t.length,String):[],c=a.length;for(var l in t)(e||_6.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||su(l,c)))&&a.push(l);return a}function Ub(t,e){return function(n){return t(e(n))}}var y6=Ub(Object.keys,Object),b6=Object.prototype,w6=b6.hasOwnProperty;function Fb(t){if(!pc(t))return y6(t);var e=[];for(var n in Object(t))w6.call(t,n)&&n!="constructor"&&e.push(n);return e}function Tr(t){return ui(t)?Mb(t):Fb(t)}var x6=Object.prototype,E6=x6.hasOwnProperty,jn=UC(function(t,e){if(pc(e)||ui(e)){Ld(e,Tr(e),t);return}for(var n in e)E6.call(e,n)&&ou(t,n,e[n])});function v6(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var k6=Object.prototype,T6=k6.hasOwnProperty;function A6(t){if(!kr(t))return v6(t);var e=pc(t),n=[];for(var r in t)r=="constructor"&&(e||!T6.call(t,r))||n.push(r);return n}function Bb(t){return ui(t)?Mb(t,!0):A6(t)}var R6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,S6=/^\w*$/;function Pd(t,e){if(ne(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||eu(t)?!0:S6.test(t)||!R6.test(t)||e!=null&&t in Object(e)}var _c=Zs(Object,"create");function O6(){this.__data__=_c?_c(null):{},this.size=0}function I6(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var N6="__lodash_hash_undefined__",C6=Object.prototype,L6=C6.hasOwnProperty;function M6(t){var e=this.__data__;if(_c){var n=e[t];return n===N6?void 0:n}return L6.call(e,t)?e[t]:void 0}var U6=Object.prototype,F6=U6.hasOwnProperty;function B6(t){var e=this.__data__;return _c?e[t]!==void 0:F6.call(e,t)}var P6="__lodash_hash_undefined__";function D6(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=_c&&e===void 0?P6:e,this}function Xs(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Xs.prototype.clear=O6,Xs.prototype.delete=I6,Xs.prototype.get=M6,Xs.prototype.has=B6,Xs.prototype.set=D6;function $6(){this.__data__=[],this.size=0}function lu(t,e){for(var n=t.length;n--;)if(dc(t[n][0],e))return n;return-1}var j6=Array.prototype,z6=j6.splice;function K6(t){var e=this.__data__,n=lu(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():z6.call(e,n,1),--this.size,!0}function W6(t){var e=this.__data__,n=lu(e,t);return n<0?void 0:e[n][1]}function H6(t){return lu(this.__data__,t)>-1}function G6(t,e){var n=this.__data__,r=lu(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Mi(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Mi.prototype.clear=$6,Mi.prototype.delete=K6,Mi.prototype.get=W6,Mi.prototype.has=H6,Mi.prototype.set=G6;var yc=Zs(li,"Map");function Y6(){this.size=0,this.__data__={hash:new Xs,map:new(yc||Mi),string:new Xs}}function V6(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function uu(t,e){var n=t.__data__;return V6(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Z6(t){var e=uu(this,t).delete(t);return this.size-=e?1:0,e}function X6(t){return uu(this,t).get(t)}function q6(t){return uu(this,t).has(t)}function J6(t,e){var n=uu(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Ui(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ui.prototype.clear=Y6,Ui.prototype.delete=Z6,Ui.prototype.get=X6,Ui.prototype.has=q6,Ui.prototype.set=J6;var Q6="Expected a function";function Dd(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Q6);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Dd.Cache||Ui),n}Dd.Cache=Ui;var tL=500;function eL(t){var e=Dd(t,function(r){return n.size===tL&&n.clear(),r}),n=e.cache;return e}var nL=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rL=/\\(\\)?/g,iL=eL(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(nL,function(n,r,i,s){e.push(i?s.replace(rL,"$1"):r||n)}),e});function Pb(t){return t==null?"":_b(t)}function hu(t,e){return ne(t)?t:Pd(t,e)?[t]:iL(Pb(t))}var sL=1/0;function bc(t){if(typeof t=="string"||eu(t))return t;var e=t+"";return e=="0"&&1/t==-sL?"-0":e}function $d(t,e){e=hu(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[bc(e[n++])];return n&&n==r?t:void 0}function oL(t,e,n){var r=t==null?void 0:$d(t,e);return r===void 0?n:r}function jd(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Db=vr?vr.isConcatSpreadable:void 0;function aL(t){return ne(t)||au(t)||!!(Db&&t&&t[Db])}function zd(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=aL),i||(i=[]);++s<o;){var a=t[s];n(a)?jd(i,a):r||(i[i.length]=a)}return i}function cr(t){var e=t==null?0:t.length;return e?zd(t):[]}var $b=Ub(Object.getPrototypeOf,Object);function Kd(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function cL(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:Kd(t,e,n)}var lL="\\ud800-\\udfff",uL="\\u0300-\\u036f",hL="\\ufe20-\\ufe2f",fL="\\u20d0-\\u20ff",dL=uL+hL+fL,pL="\\ufe0e\\ufe0f",mL="\\u200d",gL=RegExp("["+mL+lL+dL+pL+"]");function jb(t){return gL.test(t)}function _L(t){return t.split("")}var zb="\\ud800-\\udfff",yL="\\u0300-\\u036f",bL="\\ufe20-\\ufe2f",wL="\\u20d0-\\u20ff",xL=yL+bL+wL,EL="\\ufe0e\\ufe0f",vL="["+zb+"]",Wd="["+xL+"]",Hd="\\ud83c[\\udffb-\\udfff]",kL="(?:"+Wd+"|"+Hd+")",Kb="[^"+zb+"]",Wb="(?:\\ud83c[\\udde6-\\uddff]){2}",Hb="[\\ud800-\\udbff][\\udc00-\\udfff]",TL="\\u200d",Gb=kL+"?",Yb="["+EL+"]?",AL="(?:"+TL+"(?:"+[Kb,Wb,Hb].join("|")+")"+Yb+Gb+")*",RL=Yb+Gb+AL,SL="(?:"+[Kb+Wd+"?",Wd,Wb,Hb,vL].join("|")+")",OL=RegExp(Hd+"(?="+Hd+")|"+SL+RL,"g");function IL(t){return t.match(OL)||[]}function NL(t){return jb(t)?IL(t):_L(t)}function CL(t){return function(e){e=Pb(e);var n=jb(e)?NL(e):void 0,r=n?n[0]:e.charAt(0),i=n?cL(n,1).join(""):e.slice(1);return r[t]()+i}}var Vb=CL("toUpperCase");function LL(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function ML(){this.__data__=new Mi,this.size=0}function UL(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function FL(t){return this.__data__.get(t)}function BL(t){return this.__data__.has(t)}var PL=200;function DL(t,e){var n=this.__data__;if(n instanceof Mi){var r=n.__data__;if(!yc||r.length<PL-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ui(r)}return n.set(t,e),this.size=n.size,this}function hi(t){var e=this.__data__=new Mi(t);this.size=e.size}hi.prototype.clear=ML,hi.prototype.delete=UL,hi.prototype.get=FL,hi.prototype.has=BL,hi.prototype.set=DL;function $L(t,e){return t&&Ld(e,Tr(e),t)}var Zb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Xb=Zb&&typeof module=="object"&&module&&!module.nodeType&&module,jL=Xb&&Xb.exports===Zb,qb=jL?li.Buffer:void 0,Jb=qb?qb.allocUnsafe:void 0;function zL(t,e){var n=t.length,r=Jb?Jb(n):new t.constructor(n);return t.copy(r),r}function Gd(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Qb(){return[]}var KL=Object.prototype,WL=KL.propertyIsEnumerable,t1=Object.getOwnPropertySymbols,Yd=t1?function(t){return t==null?[]:(t=Object(t),Gd(t1(t),function(e){return WL.call(t,e)}))}:Qb;function HL(t,e){return Ld(t,Yd(t),e)}var GL=Object.getOwnPropertySymbols,YL=GL?function(t){for(var e=[];t;)jd(e,Yd(t)),t=$b(t);return e}:Qb;function e1(t,e,n){var r=e(t);return ne(t)?r:jd(r,n(t))}function Vd(t){return e1(t,Tr,Yd)}function VL(t){return e1(t,Bb,YL)}var Zd=Zs(li,"DataView"),Xd=Zs(li,"Promise"),Zo=Zs(li,"Set"),n1="[object Map]",ZL="[object Object]",r1="[object Promise]",i1="[object Set]",s1="[object WeakMap]",o1="[object DataView]",XL=Vs(Zd),qL=Vs(yc),JL=Vs(Xd),QL=Vs(Zo),t2=Vs(Id),Ar=fs;(Zd&&Ar(new Zd(new ArrayBuffer(1)))!=o1||yc&&Ar(new yc)!=n1||Xd&&Ar(Xd.resolve())!=r1||Zo&&Ar(new Zo)!=i1||Id&&Ar(new Id)!=s1)&&(Ar=function(t){var e=fs(t),n=e==ZL?t.constructor:void 0,r=n?Vs(n):"";if(r)switch(r){case XL:return o1;case qL:return n1;case JL:return r1;case QL:return i1;case t2:return s1}return e});var e2=Object.prototype,n2=e2.hasOwnProperty;function r2(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&n2.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var fu=li.Uint8Array;function i2(t){var e=new t.constructor(t.byteLength);return new fu(e).set(new fu(t)),e}function s2(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var o2=/\w*$/;function a2(t){var e=new t.constructor(t.source,o2.exec(t));return e.lastIndex=t.lastIndex,e}var a1=vr?vr.prototype:void 0,c1=a1?a1.valueOf:void 0;function c2(t){return c1?Object(c1.call(t)):{}}function l2(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var u2="[object Boolean]",h2="[object Date]",f2="[object Map]",d2="[object Number]",p2="[object RegExp]",m2="[object Set]",g2="[object String]",_2="[object Symbol]",y2="[object ArrayBuffer]",b2="[object DataView]",w2="[object Float32Array]",x2="[object Float64Array]",E2="[object Int8Array]",v2="[object Int16Array]",k2="[object Int32Array]",T2="[object Uint8Array]",A2="[object Uint8ClampedArray]",R2="[object Uint16Array]",S2="[object Uint32Array]";function O2(t,e,n){var r=t.constructor;switch(e){case y2:return i2(t);case u2:case h2:return new r(+t);case b2:return s2(t);case w2:case x2:case E2:case v2:case k2:case T2:case A2:case R2:case S2:return l2(t);case f2:return new r;case d2:case g2:return new r(t);case p2:return a2(t);case m2:return new r;case _2:return c2(t)}}function I2(t){return typeof t.constructor=="function"&&!pc(t)?_C($b(t)):{}}var N2="[object Map]";function C2(t){return Dr(t)&&Ar(t)==N2}var l1=ds&&ds.isMap,L2=l1?cu(l1):C2,M2="[object Set]";function U2(t){return Dr(t)&&Ar(t)==M2}var u1=ds&&ds.isSet,F2=u1?cu(u1):U2,h1="[object Arguments]",B2="[object Array]",P2="[object Boolean]",D2="[object Date]",$2="[object Error]",f1="[object Function]",j2="[object GeneratorFunction]",z2="[object Map]",K2="[object Number]",d1="[object Object]",W2="[object RegExp]",H2="[object Set]",G2="[object String]",Y2="[object Symbol]",V2="[object WeakMap]",Z2="[object ArrayBuffer]",X2="[object DataView]",q2="[object Float32Array]",J2="[object Float64Array]",Q2="[object Int8Array]",tM="[object Int16Array]",eM="[object Int32Array]",nM="[object Uint8Array]",rM="[object Uint8ClampedArray]",iM="[object Uint16Array]",sM="[object Uint32Array]",ye={};ye[h1]=ye[B2]=ye[Z2]=ye[X2]=ye[P2]=ye[D2]=ye[q2]=ye[J2]=ye[Q2]=ye[tM]=ye[eM]=ye[z2]=ye[K2]=ye[d1]=ye[W2]=ye[H2]=ye[G2]=ye[Y2]=ye[nM]=ye[rM]=ye[iM]=ye[sM]=!0,ye[$2]=ye[f1]=ye[V2]=!1;function du(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!kr(t))return t;var a=ne(t);if(a)return o=r2(t),bC(t,o);var c=Ar(t),l=c==f1||c==j2;if(mc(t))return zL(t);if(c==d1||c==h1||l&&!i)return o=l?{}:I2(t),HL(t,$L(o,t));if(!ye[c])return i?t:{};o=O2(t,c),s||(s=new hi);var u=s.get(t);if(u)return u;s.set(t,o),F2(t)?t.forEach(function(h){o.add(du(h,e,n,h,t,s))}):L2(t)&&t.forEach(function(h,p){o.set(p,du(h,e,n,p,t,s))});var f=Vd,d=a?void 0:f(t);return Eb(d||t,function(h,p){d&&(p=h,h=t[p]),ou(o,p,du(h,e,n,p,t,s))}),o}var oM=4;function _n(t){return du(t,oM)}function wc(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var aM="__lodash_hash_undefined__";function cM(t){return this.__data__.set(t,aM),this}function lM(t){return this.__data__.has(t)}function Xo(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ui;++e<n;)this.add(t[e])}Xo.prototype.add=Xo.prototype.push=cM,Xo.prototype.has=lM;function p1(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function qd(t,e){return t.has(e)}var uM=1,hM=2;function m1(t,e,n,r,i,s){var o=n&uM,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var f=-1,d=!0,h=n&hM?new Xo:void 0;for(s.set(t,e),s.set(e,t);++f<a;){var p=t[f],m=e[f];if(r)var b=o?r(m,p,f,e,t,s):r(p,m,f,t,e,s);if(b!==void 0){if(b)continue;d=!1;break}if(h){if(!p1(e,function(_,v){if(!qd(h,v)&&(p===_||i(p,_,n,r,s)))return h.push(v)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function fM(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function Jd(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var dM=1,pM=2,mM="[object Boolean]",gM="[object Date]",_M="[object Error]",yM="[object Map]",bM="[object Number]",wM="[object RegExp]",xM="[object Set]",EM="[object String]",vM="[object Symbol]",kM="[object ArrayBuffer]",TM="[object DataView]",g1=vr?vr.prototype:void 0,Qd=g1?g1.valueOf:void 0;function AM(t,e,n,r,i,s,o){switch(n){case TM:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case kM:return!(t.byteLength!=e.byteLength||!s(new fu(t),new fu(e)));case mM:case gM:case bM:return dc(+t,+e);case _M:return t.name==e.name&&t.message==e.message;case wM:case EM:return t==e+"";case yM:var a=fM;case xM:var c=r&dM;if(a||(a=Jd),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=pM,o.set(t,e);var u=m1(a(t),a(e),r,i,s,o);return o.delete(t),u;case vM:if(Qd)return Qd.call(t)==Qd.call(e)}return!1}var RM=1,SM=Object.prototype,OM=SM.hasOwnProperty;function IM(t,e,n,r,i,s){var o=n&RM,a=Vd(t),c=a.length,l=Vd(e),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in e:OM.call(e,d)))return!1}var h=s.get(t),p=s.get(e);if(h&&p)return h==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var b=o;++f<c;){d=a[f];var _=t[d],v=e[d];if(r)var T=o?r(v,_,d,e,t,s):r(_,v,d,t,e,s);if(!(T===void 0?_===v||i(_,v,n,r,s):T)){m=!1;break}b||(b=d=="constructor")}if(m&&!b){var A=t.constructor,C=e.constructor;A!=C&&"constructor"in t&&"constructor"in e&&!(typeof A=="function"&&A instanceof A&&typeof C=="function"&&C instanceof C)&&(m=!1)}return s.delete(t),s.delete(e),m}var NM=1,_1="[object Arguments]",y1="[object Array]",pu="[object Object]",CM=Object.prototype,b1=CM.hasOwnProperty;function LM(t,e,n,r,i,s){var o=ne(t),a=ne(e),c=o?y1:Ar(t),l=a?y1:Ar(e);c=c==_1?pu:c,l=l==_1?pu:l;var u=c==pu,f=l==pu,d=c==l;if(d&&mc(t)){if(!mc(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new hi),o||Bd(t)?m1(t,e,n,r,i,s):AM(t,e,c,n,r,i,s);if(!(n&NM)){var h=u&&b1.call(t,"__wrapped__"),p=f&&b1.call(e,"__wrapped__");if(h||p){var m=h?t.value():t,b=p?e.value():e;return s||(s=new hi),i(m,b,n,r,s)}}return d?(s||(s=new hi),IM(t,e,n,r,i,s)):!1}function t0(t,e,n,r,i){return t===e?!0:t==null||e==null||!Dr(t)&&!Dr(e)?t!==t&&e!==e:LM(t,e,n,r,t0,i)}var MM=1,UM=2;function FM(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new hi,f;if(!(f===void 0?t0(l,c,MM|UM,r,u):f))return!1}}return!0}function w1(t){return t===t&&!kr(t)}function BM(t){for(var e=Tr(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,w1(i)]}return e}function x1(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function PM(t){var e=BM(t);return e.length==1&&e[0][2]?x1(e[0][0],e[0][1]):function(n){return n===t||FM(n,t,e)}}function DM(t,e){return t!=null&&e in Object(t)}function E1(t,e,n){e=hu(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=bc(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&Ud(i)&&su(o,i)&&(ne(t)||au(t)))}function $M(t,e){return t!=null&&E1(t,e,DM)}var jM=1,zM=2;function KM(t,e){return Pd(t)&&w1(e)?x1(bc(t),e):function(n){var r=oL(n,t);return r===void 0&&r===e?$M(n,t):t0(e,r,jM|zM)}}function WM(t){return function(e){return e==null?void 0:e[t]}}function HM(t){return function(e){return $d(e,t)}}function GM(t){return Pd(t)?WM(bc(t)):HM(t)}function fi(t){return typeof t=="function"?t:t==null?Vo:typeof t=="object"?ne(t)?KM(t[0],t[1]):PM(t):GM(t)}function YM(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function VM(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var ZM=VM();function XM(t,e){return t&&ZM(t,e,Tr)}function qM(t,e){return function(n,r){if(n==null)return n;if(!ui(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var qs=qM(XM);function JM(t,e,n,r){return qs(t,function(i,s,o){e(r,i,n(i),o)}),r}function QM(t,e){return function(n,r){var i=ne(n)?YM:JM,s=e?e():{};return i(n,t,fi(r),s)}}var v1=Object.prototype,t8=v1.hasOwnProperty,e0=Md(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&Ab(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=Bb(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||dc(u,v1[l])&&!t8.call(t,l))&&(t[l]=s[l])}return t});function k1(t){return Dr(t)&&ui(t)}var e8=200;function n8(t,e,n,r){var i=-1,s=kb,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=e8&&(s=qd,o=!1,e=new Xo(e));t:for(;++i<a;){var u=t[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(e[d]===f)continue t;c.push(u)}else s(e,f,r)||c.push(u)}return c}var mu=Md(function(t,e){return k1(t)?n8(t,zd(e,1,k1,!0)):[]});function qo(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function yn(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ru(e),Kd(t,e<0?0:e,r)):[]}function xc(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ru(e),e=r-e,Kd(t,0,e<0?0:e)):[]}function r8(t){return typeof t=="function"?t:Vo}function Ct(t,e){var n=ne(t)?Eb:qs;return n(t,r8(e))}function i8(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function s8(t,e){var n=!0;return qs(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function $r(t,e,n){var r=ne(t)?i8:s8;return r(t,fi(e))}function T1(t,e){var n=[];return qs(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function Rr(t,e){var n=ne(t)?Gd:T1;return n(t,fi(e))}function o8(t){return function(e,n,r){var i=Object(e);if(!ui(e)){var s=fi(n);e=Tr(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var a8=Math.max;function c8(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:ru(n);return i<0&&(i=a8(r+i,0)),vb(t,fi(e),i)}var Jo=o8(c8);function jr(t){return t&&t.length?t[0]:void 0}function l8(t,e){var n=-1,r=ui(t)?Array(t.length):[];return qs(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function Et(t,e){var n=ne(t)?nu:l8;return n(t,fi(e))}function Sr(t,e){return zd(Et(t,e))}var u8=Object.prototype,h8=u8.hasOwnProperty,A1=QM(function(t,e,n){h8.call(t,n)?t[n].push(e):Cd(t,n,[e])}),f8=Object.prototype,d8=f8.hasOwnProperty;function p8(t,e){return t!=null&&d8.call(t,e)}function Nt(t,e){return t!=null&&E1(t,e,p8)}var m8="[object String]";function zn(t){return typeof t=="string"||!ne(t)&&Dr(t)&&fs(t)==m8}function g8(t,e){return nu(e,function(n){return t[n]})}function Ze(t){return t==null?[]:g8(t,Tr(t))}var _8=Math.max;function In(t,e,n,r){t=ui(t)?t:Ze(t),n=n&&!r?ru(n):0;var i=t.length;return n<0&&(n=_8(i+n,0)),zn(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Nd(t,e,n)>-1}function R1(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return Nd(t,e,i)}var y8="[object Map]",b8="[object Set]",w8=Object.prototype,x8=w8.hasOwnProperty;function be(t){if(t==null)return!0;if(ui(t)&&(ne(t)||typeof t=="string"||typeof t.splice=="function"||mc(t)||Bd(t)||au(t)))return!t.length;var e=Ar(t);if(e==y8||e==b8)return!t.size;if(pc(t))return!Fb(t).length;for(var n in t)if(x8.call(t,n))return!1;return!0}var E8="[object RegExp]";function v8(t){return Dr(t)&&fs(t)==E8}var S1=ds&&ds.isRegExp,Fi=S1?cu(S1):v8;function Bi(t){return t===void 0}var k8="Expected a function";function T8(t){if(typeof t!="function")throw new TypeError(k8);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function A8(t,e,n,r){if(!kr(t))return t;e=hu(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=bc(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=kr(u)?u:su(e[i+1])?[]:{})}ou(a,c,l),a=a[c]}return t}function R8(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=$d(t,o);n(a,o)&&A8(s,hu(o,t),a)}return s}function zr(t,e){if(t==null)return{};var n=nu(VL(t),function(r){return[r]});return e=fi(e),R8(t,n,function(r,i){return e(r,i[0])})}function S8(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function Kn(t,e,n){var r=ne(t)?LL:S8,i=arguments.length<3;return r(t,fi(e),n,i,qs)}function gu(t,e){var n=ne(t)?Gd:T1;return n(t,T8(fi(e)))}function O8(t,e){var n;return qs(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function n0(t,e,n){var r=ne(t)?p1:O8;return r(t,fi(e))}var I8=1/0,N8=Zo&&1/Jd(new Zo([,-0]))[1]==I8?function(t){return new Zo(t)}:en,C8=200;function L8(t,e,n){var r=-1,i=kb,s=t.length,o=!0,a=[],c=a;if(s>=C8){var l=N8(t);if(l)return Jd(l);o=!1,i=qd,c=new Xo}else c=a;t:for(;++r<s;){var u=t[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function _u(t){return t&&t.length?L8(t):[]}function r0(t){console&&console.error&&console.error(`Error: ${t}`)}function O1(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function I1(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function N1(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function M8(t){return U8(t)?t.LABEL:t.name}function U8(t){return zn(t.LABEL)&&t.LABEL!==""}class di{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Ct(this.definition,n=>{n.accept(e)})}}class Wn extends di{constructor(e){super([]),this.idx=1,jn(this,zr(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Qo extends di{constructor(e){super(e.definition),this.orgText="",jn(this,zr(e,n=>n!==void 0))}}class Hn extends di{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,jn(this,zr(e,n=>n!==void 0))}}class Gn extends di{constructor(e){super(e.definition),this.idx=1,jn(this,zr(e,n=>n!==void 0))}}class pi extends di{constructor(e){super(e.definition),this.idx=1,jn(this,zr(e,n=>n!==void 0))}}class mi extends di{constructor(e){super(e.definition),this.idx=1,jn(this,zr(e,n=>n!==void 0))}}class nn extends di{constructor(e){super(e.definition),this.idx=1,jn(this,zr(e,n=>n!==void 0))}}class Kr extends di{constructor(e){super(e.definition),this.idx=1,jn(this,zr(e,n=>n!==void 0))}}class Wr extends di{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,jn(this,zr(e,n=>n!==void 0))}}class Me{constructor(e){this.idx=1,jn(this,zr(e,n=>n!==void 0))}accept(e){e.visit(this)}}function F8(t){return Et(t,yu)}function yu(t){function e(n){return Et(n,yu)}if(t instanceof Wn){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return zn(t.label)&&(n.label=t.label),n}else{if(t instanceof Hn)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Gn)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof pi)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof mi)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:yu(new Me({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Kr)return{type:"RepetitionWithSeparator",idx:t.idx,separator:yu(new Me({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof nn)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Wr)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Me){const n={type:"Terminal",name:t.terminalType.name,label:M8(t.terminalType),idx:t.idx};zn(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=Fi(r)?r.source:r),n}else{if(t instanceof Qo)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class Js{visit(e){const n=e;switch(n.constructor){case Wn:return this.visitNonTerminal(n);case Hn:return this.visitAlternative(n);case Gn:return this.visitOption(n);case pi:return this.visitRepetitionMandatory(n);case mi:return this.visitRepetitionMandatoryWithSeparator(n);case Kr:return this.visitRepetitionWithSeparator(n);case nn:return this.visitRepetition(n);case Wr:return this.visitAlternation(n);case Me:return this.visitTerminal(n);case Qo:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function B8(t){return t instanceof Hn||t instanceof Gn||t instanceof nn||t instanceof pi||t instanceof mi||t instanceof Kr||t instanceof Me||t instanceof Qo}function bu(t,e=[]){return t instanceof Gn||t instanceof nn||t instanceof Kr?!0:t instanceof Wr?n0(t.definition,r=>bu(r,e)):t instanceof Wn&&In(e,t)?!1:t instanceof di?(t instanceof Wn&&e.push(t),$r(t.definition,r=>bu(r,e))):!1}function P8(t){return t instanceof Wr}function gi(t){if(t instanceof Wn)return"SUBRULE";if(t instanceof Gn)return"OPTION";if(t instanceof Wr)return"OR";if(t instanceof pi)return"AT_LEAST_ONE";if(t instanceof mi)return"AT_LEAST_ONE_SEP";if(t instanceof Kr)return"MANY_SEP";if(t instanceof nn)return"MANY";if(t instanceof Me)return"CONSUME";throw Error("non exhaustive match")}class wu{walk(e,n=[]){Ct(e.definition,(r,i)=>{const s=yn(e.definition,i+1);if(r instanceof Wn)this.walkProdRef(r,s,n);else if(r instanceof Me)this.walkTerminal(r,s,n);else if(r instanceof Hn)this.walkFlat(r,s,n);else if(r instanceof Gn)this.walkOption(r,s,n);else if(r instanceof pi)this.walkAtLeastOne(r,s,n);else if(r instanceof mi)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Kr)this.walkManySep(r,s,n);else if(r instanceof nn)this.walkMany(r,s,n);else if(r instanceof Wr)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new Gn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=C1(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new Gn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=C1(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);Ct(e.definition,s=>{const o=new Hn({definition:[s]});this.walk(o,i)})}}function C1(t,e,n){return[new Gn({definition:[new Me({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function Ec(t){if(t instanceof Wn)return Ec(t.referencedRule);if(t instanceof Me)return j8(t);if(B8(t))return D8(t);if(P8(t))return $8(t);throw Error("non exhaustive match")}function D8(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=bu(s),e=e.concat(Ec(s)),r=r+1,i=n.length>r;return _u(e)}function $8(t){const e=Et(t.definition,n=>Ec(n));return _u(cr(e))}function j8(t){return[t.terminalType]}const L1="_~IN~_";class z8 extends wu{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=W8(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new Hn({definition:s}),a=Ec(o);this.follows[i]=a}}function K8(t){const e={};return Ct(t,n=>{const r=new z8(n).startWalking();jn(e,r)}),e}function W8(t,e){return t.name+e+L1}function Ft(t){return t.charCodeAt(0)}function i0(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function vc(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function ta(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function H8(){throw Error("Internal Error - Should never get here!")}function M1(t){return t.type==="Character"}const xu=[];for(let t=Ft("0");t<=Ft("9");t++)xu.push(t);const Eu=[Ft("_")].concat(xu);for(let t=Ft("a");t<=Ft("z");t++)Eu.push(t);for(let t=Ft("A");t<=Ft("Z");t++)Eu.push(t);const U1=[Ft(" "),Ft("\f"),Ft(`
`),Ft("\r"),Ft("	"),Ft("\v"),Ft("	"),Ft(""),Ft(""),Ft(""),Ft(""),Ft(""),Ft(""),Ft(""),Ft(""),Ft(""),Ft(""),Ft(""),Ft(""),Ft(""),Ft("\u2028"),Ft("\u2029"),Ft(""),Ft(""),Ft(""),Ft("\uFEFF")],G8=/[0-9a-fA-F]/,vu=/[0-9]/,Y8=/[1-9]/;class V8{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":vc(r,"global");break;case"i":vc(r,"ignoreCase");break;case"m":vc(r,"multiLine");break;case"u":vc(r,"unicode");break;case"y":vc(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}ta(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return H8()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;ta(n);break}if(!(e===!0&&n===void 0)&&ta(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),ta(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ft(`
`),Ft("\r"),Ft("\u2028"),Ft("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=xu;break;case"D":e=xu,n=!0;break;case"s":e=U1;break;case"S":e=U1,n=!0;break;case"w":e=Eu;break;case"W":e=Eu,n=!0;break}if(ta(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Ft("\f");break;case"n":e=Ft(`
`);break;case"r":e=Ft("\r");break;case"t":e=Ft("	");break;case"v":e=Ft("\v");break}if(ta(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ft("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Ft(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Ft(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,M1(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,M1(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else i0(r.value,e),e.push(Ft("-")),i0(i.value,e)}else i0(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ft("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(Y8.test(e)===!1)throw Error("Expecting a positive integer");for(;vu.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(vu.test(e)===!1)throw Error("Expecting an integer");for(;vu.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ft(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return vu.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(G8.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class s0{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let ku={};const Z8=new V8;function Tu(t){const e=t.toString();if(ku.hasOwnProperty(e))return ku[e];{const n=Z8.pattern(e);return ku[e]=n,n}}function X8(){ku={}}const F1="Complement Sets are not supported for first char optimization",Au=`Unable to use "first char" lexer optimizations:
`;function q8(t,e=!1){try{const n=Tu(t);return o0(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===F1)e&&O1(`${Au}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),r0(`${Au}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function o0(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)o0(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Ru(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(F1);Ct(o.value,c=>{if(typeof c=="number")Ru(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Ru(u,e,n);else{for(let u=l.from;u<=l.to&&u<Tc;u++)Ru(u,e,n);if(l.to>=Tc){const u=l.from>=Tc?l.from:Tc,f=l.to,d=ps(u),h=ps(f);for(let p=d;p<=h;p++)e[p]=p}}}});break;case"Group":o0(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&a0(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ze(e)}function Ru(t,e,n){const r=ps(t);e[r]=r,n===!0&&J8(t,e)}function J8(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=ps(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=ps(i.charCodeAt(0));e[s]=s}}}function B1(t,e){return Jo(t.value,n=>{if(typeof n=="number")return In(e,n);{const r=n;return Jo(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function a0(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?ne(t.value)?$r(t.value,a0):a0(t.value):!1}class Q8 extends s0{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){In(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?B1(e,this.targetCharCodes)===void 0&&(this.found=!0):B1(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function c0(t,e){if(e instanceof RegExp){const n=Tu(e),r=new Q8(t);return r.visit(n),r.found}else return Jo(e,n=>In(t,n.charCodeAt(0)))!==void 0}const Qs="PATTERN",kc="defaultMode",Su="modes";let P1=typeof new RegExp("(?:)").sticky=="boolean";function t3(t,e){e=e0(e,{useSticky:P1,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(v,T)=>T()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{v3()});let r;n("Reject Lexer.NA",()=>{r=gu(t,v=>v[Qs]===rn.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Et(r,v=>{const T=v[Qs];if(Fi(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!In(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:e.useSticky?$1(T):D1(T)}else{if(Li(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),C=new RegExp(A);return e.useSticky?$1(C):D1(C)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=Et(r,v=>v.tokenTypeIdx),a=Et(r,v=>{const T=v.GROUP;if(T!==rn.SKIPPED){if(zn(T))return T;if(Bi(T))return!1;throw Error("non exhaustive match")}}),c=Et(r,v=>{const T=v.LONGER_ALT;if(T)return ne(T)?Et(T,C=>R1(r,C)):[R1(r,T)]}),l=Et(r,v=>v.PUSH_MODE),u=Et(r,v=>Nt(v,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const v=K1(e.lineTerminatorCharacters);f=Et(r,T=>!1),e.positionTracking!=="onlyOffset"&&(f=Et(r,T=>Nt(T,"LINE_BREAKS")?!!T.LINE_BREAKS:z1(T,v)===!1&&c0(v,T.PATTERN)))});let d,h,p,m;n("Misc Mapping #2",()=>{d=Et(r,j1),h=Et(s,w3),p=Kn(r,(v,T)=>{const A=T.GROUP;return zn(A)&&A!==rn.SKIPPED&&(v[A]=[]),v},{}),m=Et(s,(v,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:f[T],isCustom:d[T],short:h[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let b=!0,_=[];return e.safeMode||n("First Char Optimization",()=>{_=Kn(r,(v,T,A)=>{if(typeof T.PATTERN=="string"){const C=T.PATTERN.charCodeAt(0),R=ps(C);l0(v,R,m[A])}else if(ne(T.START_CHARS_HINT)){let C;Ct(T.START_CHARS_HINT,R=>{const S=typeof R=="string"?R.charCodeAt(0):R,U=ps(S);C!==U&&(C=U,l0(v,U,m[A]))})}else if(Fi(T.PATTERN))if(T.PATTERN.unicode)b=!1,e.ensureOptimizations&&r0(`${Au}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const C=q8(T.PATTERN,e.ensureOptimizations);be(C)&&(b=!1),Ct(C,R=>{l0(v,R,m[A])})}else e.ensureOptimizations&&r0(`${Au}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return v},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:_,hasCustom:i,canBeOptimized:b}}function e3(t,e){let n=[];const r=r3(t);n=n.concat(r.errors);const i=i3(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(n3(s)),n=n.concat(f3(s)),n=n.concat(d3(s,e)),n=n.concat(p3(s)),n}function n3(t){let e=[];const n=Rr(t,r=>Fi(r[Qs]));return e=e.concat(o3(n)),e=e.concat(l3(n)),e=e.concat(u3(n)),e=e.concat(h3(n)),e=e.concat(a3(n)),e}function r3(t){const e=Rr(t,i=>!Nt(i,Qs)),n=Et(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Be.MISSING_PATTERN,tokenTypes:[i]})),r=mu(t,e);return{errors:n,valid:r}}function i3(t){const e=Rr(t,i=>{const s=i[Qs];return!Fi(s)&&!Li(s)&&!Nt(s,"exec")&&!zn(s)}),n=Et(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Be.INVALID_PATTERN,tokenTypes:[i]})),r=mu(t,e);return{errors:n,valid:r}}const s3=/[^\\][$]/;function o3(t){class e extends s0{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Rr(t,i=>{const s=i.PATTERN;try{const o=Tu(s),a=new e;return a.visit(o),a.found}catch{return s3.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function a3(t){const e=Rr(t,r=>r.PATTERN.test(""));return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Be.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const c3=/[^\\[][\^]|^\^/;function l3(t){class e extends s0{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Rr(t,i=>{const s=i.PATTERN;try{const o=Tu(s),a=new e;return a.visit(o),a.found}catch{return c3.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function u3(t){const e=Rr(t,r=>{const i=r[Qs];return i instanceof RegExp&&(i.multiline||i.global)});return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Be.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function h3(t){const e=[];let n=Et(t,s=>Kn(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!In(e,a)&&a.PATTERN!==rn.NA&&(e.push(a),o.push(a)),o),[]));n=wc(n);const r=Rr(n,s=>s.length>1);return Et(r,s=>{const o=Et(s,c=>c.name);return{message:`The same RegExp pattern ->${jr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Be.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function f3(t){const e=Rr(t,r=>{if(!Nt(r,"GROUP"))return!1;const i=r.GROUP;return i!==rn.SKIPPED&&i!==rn.NA&&!zn(i)});return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Be.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function d3(t,e){const n=Rr(t,i=>i.PUSH_MODE!==void 0&&!In(e,i.PUSH_MODE));return Et(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Be.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function p3(t){const e=[],n=Kn(t,(r,i,s)=>{const o=i.PATTERN;return o===rn.NA||(zn(o)?r.push({str:o,idx:s,tokenType:i}):Fi(o)&&g3(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Ct(t,(r,i)=>{Ct(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&m3(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Be.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function m3(t,e){if(Fi(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Li(e))return e(t,0,[],{});if(Nt(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function g3(t){return Jo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function D1(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function $1(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function _3(t,e,n){const r=[];return Nt(t,kc)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+kc+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Nt(t,Su)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Su+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Nt(t,Su)&&Nt(t,kc)&&!Nt(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${kc}: <${t.defaultMode}>which does not exist
`,type:Be.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Nt(t,Su)&&Ct(t.modes,(i,s)=>{Ct(i,(o,a)=>{if(Bi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Be.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Nt(o,"LONGER_ALT")){const c=ne(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ct(c,l=>{!Bi(l)&&!In(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Be.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function y3(t,e,n){const r=[];let i=!1;const s=wc(cr(Ze(t.modes))),o=gu(s,c=>c[Qs]===rn.NA),a=K1(n);return e&&Ct(o,c=>{const l=z1(c,a);if(l!==!1){const f={message:E3(c,l),type:l.issue,tokenType:c};r.push(f)}else Nt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):c0(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Be.NO_LINE_BREAKS_FLAGS}),r}function b3(t){const e={},n=Tr(t);return Ct(n,r=>{const i=t[r];if(ne(i))e[r]=[];else throw Error("non exhaustive match")}),e}function j1(t){const e=t.PATTERN;if(Fi(e))return!1;if(Li(e))return!0;if(Nt(e,"exec"))return!0;if(zn(e))return!1;throw Error("non exhaustive match")}function w3(t){return zn(t)&&t.length===1?t.charCodeAt(0):!1}const x3={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function z1(t,e){if(Nt(t,"LINE_BREAKS"))return!1;if(Fi(t.PATTERN)){try{c0(e,t.PATTERN)}catch(n){return{issue:Be.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(zn(t.PATTERN))return!1;if(j1(t))return{issue:Be.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function E3(t,e){if(e.issue===Be.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Be.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function K1(t){return Et(t,n=>zn(n)?n.charCodeAt(0):n)}function l0(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const Tc=256;let Ou=[];function ps(t){return t<Tc?t:Ou[t]}function v3(){if(be(Ou)){Ou=new Array(65536);for(let t=0;t<65536;t++)Ou[t]=t>255?255+~~(t/255):t}}function Ac(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function Iu(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let W1=1;const H1={};function Rc(t){const e=k3(t);T3(e),R3(e),A3(e),Ct(e,n=>{n.isParent=n.categoryMatches.length>0})}function k3(t){let e=_n(t),n=t,r=!0;for(;r;){n=wc(cr(Et(n,s=>s.CATEGORIES)));const i=mu(n,e);e=e.concat(i),be(i)?r=!1:n=i}return e}function T3(t){Ct(t,e=>{Y1(e)||(H1[W1]=e,e.tokenTypeIdx=W1++),V1(e)&&!ne(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),V1(e)||(e.CATEGORIES=[]),S3(e)||(e.categoryMatches=[]),O3(e)||(e.categoryMatchesMap={})})}function A3(t){Ct(t,e=>{e.categoryMatches=[],Ct(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(H1[r].tokenTypeIdx)})})}function R3(t){Ct(t,e=>{G1([],e)})}function G1(t,e){Ct(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),Ct(e.CATEGORIES,n=>{const r=t.concat(e);In(r,n)||G1(r,n)})}function Y1(t){return Nt(t,"tokenTypeIdx")}function V1(t){return Nt(t,"CATEGORIES")}function S3(t){return Nt(t,"categoryMatches")}function O3(t){return Nt(t,"categoryMatchesMap")}function I3(t){return Nt(t,"tokenTypeIdx")}const N3={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var Be;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Be||(Be={}));const Sc={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:N3,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Sc);let rn=class{constructor(e,n=Sc){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=I1(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=jn({},Sc,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Sc.lineTerminatorsPattern)this.config.lineTerminatorsPattern=x3;else if(this.config.lineTerminatorCharacters===Sc.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),ne(e)?i={modes:{defaultMode:_n(e)},defaultMode:kc}:(s=!1,i=_n(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(_3(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(y3(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ct(i.modes,(a,c)=>{i.modes[c]=gu(a,l=>Bi(l))});const o=Tr(i.modes);if(Ct(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(e3(a,o))}),be(this.lexerDefinitionErrors)){Rc(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=t3(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=jn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!be(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Et(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ct(this.lexerDefinitionWarning,a=>{O1(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(P1?(this.chopInput=Vo,this.match=this.matchWithTest):(this.updateLastIndex=en,this.match=this.matchWithExec),s&&(this.handleModes=en),this.trackStartLines===!1&&(this.computeNewColumn=Vo),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=en),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Kn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!be(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{X8()}),this.TRACE_INIT("toFastProperties",()=>{N1(this)})})}tokenize(e,n=this.defaultMode){if(!be(this.lexerDefinitionErrors)){const i=Et(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,b,_;const v=e,T=v.length;let A=0,C=0;const R=this.hasCustom?0:Math.floor(e.length/10),S=new Array(R),U=[];let I=this.trackStartLines?1:void 0,P=this.trackStartLines?1:void 0;const W=b3(this.emptyGroups),L=this.trackStartLines,N=this.config.lineTerminatorsPattern;let E=0,D=[],Z=[];const $=[],st=[];Object.freeze(st);let nt;function at(){return D}function Y(jt){const ae=ps(jt),Dt=Z[ae];return Dt===void 0?st:Dt}const H=jt=>{if($.length===1&&jt.tokenType.PUSH_MODE===void 0){const ae=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(jt);U.push({offset:jt.startOffset,line:jt.startLine,column:jt.startColumn,length:jt.image.length,message:ae})}else{$.pop();const ae=qo($);D=this.patternIdxToConfig[ae],Z=this.charCodeToPatternIdxToConfig[ae],E=D.length;const Dt=this.canModeBeOptimized[ae]&&this.config.safeMode===!1;Z&&Dt?nt=Y:nt=at}};function wt(jt){$.push(jt),Z=this.charCodeToPatternIdxToConfig[jt],D=this.patternIdxToConfig[jt],E=D.length,E=D.length;const ae=this.canModeBeOptimized[jt]&&this.config.safeMode===!1;Z&&ae?nt=Y:nt=at}wt.call(this,n);let lt;const ht=this.config.recoveryEnabled;for(;A<T;){c=null;const jt=v.charCodeAt(A),ae=nt(jt),Dt=ae.length;for(r=0;r<Dt;r++){lt=ae[r];const Pt=lt.pattern;l=null;const le=lt.short;if(le!==!1?jt===le&&(c=Pt):lt.isCustom===!0?(_=Pt.exec(v,A,S,W),_!==null?(c=_[0],_.payload!==void 0&&(l=_.payload)):c=null):(this.updateLastIndex(Pt,A),c=this.match(Pt,e,A)),c!==null){if(a=lt.longerAlt,a!==void 0){const Yt=a.length;for(s=0;s<Yt;s++){const Ie=D[a[s]],je=Ie.pattern;if(u=null,Ie.isCustom===!0?(_=je.exec(v,A,S,W),_!==null?(o=_[0],_.payload!==void 0&&(u=_.payload)):o=null):(this.updateLastIndex(je,A),o=this.match(je,e,A)),o&&o.length>c.length){c=o,l=u,lt=Ie;break}}}break}}if(c!==null){if(f=c.length,d=lt.group,d!==void 0&&(h=lt.tokenTypeIdx,p=this.createTokenInstance(c,A,h,lt.tokenType,I,P,f),this.handlePayload(p,l),d===!1?C=this.addToken(S,C,p):W[d].push(p)),e=this.chopInput(e,f),A=A+f,P=this.computeNewColumn(P,f),L===!0&&lt.canLineTerminator===!0){let Pt=0,le,Yt;N.lastIndex=0;do le=N.test(c),le===!0&&(Yt=N.lastIndex-1,Pt++);while(le===!0);Pt!==0&&(I=I+Pt,P=f-Yt,this.updateTokenEndLineColumnLocation(p,d,Yt,Pt,I,P,f))}this.handleModes(lt,H,wt,p)}else{const Pt=A,le=I,Yt=P;let Ie=ht===!1;for(;Ie===!1&&A<T;)for(e=this.chopInput(e,1),A++,i=0;i<E;i++){const je=D[i],k=je.pattern,ot=je.short;if(ot!==!1?v.charCodeAt(A)===ot&&(Ie=!0):je.isCustom===!0?Ie=k.exec(v,A,S,W)!==null:(this.updateLastIndex(k,A),Ie=k.exec(e)!==null),Ie===!0)break}if(m=A-Pt,P=this.computeNewColumn(P,m),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,Pt,m,le,Yt),U.push({offset:Pt,line:le,column:Yt,length:m,message:b}),ht===!1)break}}return this.hasCustom||(S.length=C),{tokens:S,groups:W,errors:U}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};rn.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",rn.NA=/NOT_APPLICABLE/;function Oc(t){return Z1(t)?t.LABEL:t.name}function Z1(t){return zn(t.LABEL)&&t.LABEL!==""}const C3="parent",X1="categories",q1="label",J1="group",Q1="push_mode",tw="pop_mode",ew="longer_alt",nw="line_breaks",rw="start_chars_hint";function lr(t){return L3(t)}function L3(t){const e=t.pattern,n={};if(n.name=t.name,Bi(e)||(n.PATTERN=e),Nt(t,C3))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Nt(t,X1)&&(n.CATEGORIES=t[X1]),Rc([n]),Nt(t,q1)&&(n.LABEL=t[q1]),Nt(t,J1)&&(n.GROUP=t[J1]),Nt(t,tw)&&(n.POP_MODE=t[tw]),Nt(t,Q1)&&(n.PUSH_MODE=t[Q1]),Nt(t,ew)&&(n.LONGER_ALT=t[ew]),Nt(t,nw)&&(n.LINE_BREAKS=t[nw]),Nt(t,rw)&&(n.START_CHARS_HINT=t[rw]),n}const to=lr({name:"EOF",pattern:rn.NA});Rc([to]);function Nu(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function M3(t,e){return Ac(t,e)}const iw={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${Z1(t)?`--> ${Oc(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+jr(e).image+"'";if(r)return s+r+a;{const c=Kn(t,(d,h)=>d.concat(h),[]),l=Et(c,d=>`[${Et(d,h=>Oc(h)).join(", ")}]`),f=`one of these possible Token sequences:
${Et(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+jr(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Et(t,l=>`[${Et(l,u=>Oc(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(iw);const U3={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},eo={buildDuplicateFoundError(t,e){function n(u){return u instanceof Me?u.terminalType.name:u instanceof Wn?u.nonTerminalName:""}const r=t.name,i=jr(e),s=i.idx,o=gi(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=Et(t.prefixPath,i=>Oc(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=Et(t.prefixPath,i=>Oc(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=gi(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=Et(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Qo?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function F3(t,e){const n=new B3(t,e);return n.resolveRefs(),n.errors}class B3 extends Js{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Ct(Ze(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Nn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class P3 extends wu{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=_n(this.path.ruleStack).reverse(),this.occurrenceStack=_n(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){be(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class D3 extends P3{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Hn({definition:i});this.possibleTokTypes=Ec(s),this.found=!0}}}class Cu extends wu{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class $3 extends Cu{walkMany(e,n,r){if(e.idx===this.occurrence){const i=jr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class sw extends Cu{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=jr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class j3 extends Cu{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=jr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class ow extends Cu{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=jr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function u0(t,e,n=[]){n=_n(n);let r=[],i=0;function s(a){return a.concat(yn(t,i+1))}function o(a){const c=u0(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof Hn)return o(a.definition);if(a instanceof Wn)return o(a.definition);if(a instanceof Gn)r=o(a.definition);else if(a instanceof pi){const c=a.definition.concat([new nn({definition:a.definition})]);return o(c)}else if(a instanceof mi){const c=[new Hn({definition:a.definition}),new nn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Kr){const c=a.definition.concat([new nn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof nn){const c=a.definition.concat([new nn({definition:a.definition})]);r=o(c)}else{if(a instanceof Wr)return Ct(a.definition,c=>{be(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Me)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:yn(t,i)}),r}function aw(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!be(f);){const d=f.pop();if(d===o){a&&qo(f).idx<=l&&f.pop();continue}const h=d.def,p=d.idx,m=d.ruleStack,b=d.occurrenceStack;if(be(h))continue;const _=h[0];if(_===i){const v={idx:p,def:yn(h),ruleStack:xc(m),occurrenceStack:xc(b)};f.push(v)}else if(_ instanceof Me)if(p<c-1){const v=p+1,T=e[v];if(n(T,_.terminalType)){const A={idx:v,def:yn(h),ruleStack:m,occurrenceStack:b};f.push(A)}}else if(p===c-1)u.push({nextTokenType:_.terminalType,nextTokenOccurrence:_.idx,ruleStack:m,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(_ instanceof Wn){const v=_n(m);v.push(_.nonTerminalName);const T=_n(b);T.push(_.idx);const A={idx:p,def:_.definition.concat(s,yn(h)),ruleStack:v,occurrenceStack:T};f.push(A)}else if(_ instanceof Gn){const v={idx:p,def:yn(h),ruleStack:m,occurrenceStack:b};f.push(v),f.push(o);const T={idx:p,def:_.definition.concat(yn(h)),ruleStack:m,occurrenceStack:b};f.push(T)}else if(_ instanceof pi){const v=new nn({definition:_.definition,idx:_.idx}),T=_.definition.concat([v],yn(h)),A={idx:p,def:T,ruleStack:m,occurrenceStack:b};f.push(A)}else if(_ instanceof mi){const v=new Me({terminalType:_.separator}),T=new nn({definition:[v].concat(_.definition),idx:_.idx}),A=_.definition.concat([T],yn(h)),C={idx:p,def:A,ruleStack:m,occurrenceStack:b};f.push(C)}else if(_ instanceof Kr){const v={idx:p,def:yn(h),ruleStack:m,occurrenceStack:b};f.push(v),f.push(o);const T=new Me({terminalType:_.separator}),A=new nn({definition:[T].concat(_.definition),idx:_.idx}),C=_.definition.concat([A],yn(h)),R={idx:p,def:C,ruleStack:m,occurrenceStack:b};f.push(R)}else if(_ instanceof nn){const v={idx:p,def:yn(h),ruleStack:m,occurrenceStack:b};f.push(v),f.push(o);const T=new nn({definition:_.definition,idx:_.idx}),A=_.definition.concat([T],yn(h)),C={idx:p,def:A,ruleStack:m,occurrenceStack:b};f.push(C)}else if(_ instanceof Wr)for(let v=_.definition.length-1;v>=0;v--){const T=_.definition[v],A={idx:p,def:T.definition.concat(yn(h)),ruleStack:m,occurrenceStack:b};f.push(A),f.push(o)}else if(_ instanceof Hn)f.push({idx:p,def:_.definition.concat(yn(h)),ruleStack:m,occurrenceStack:b});else if(_ instanceof Qo)f.push(z3(_,p,m,b));else throw Error("non exhaustive match")}return u}function z3(t,e,n,r){const i=_n(n);i.push(t.name);const s=_n(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var Pe;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(Pe||(Pe={}));function cw(t){if(t instanceof Gn||t==="Option")return Pe.OPTION;if(t instanceof nn||t==="Repetition")return Pe.REPETITION;if(t instanceof pi||t==="RepetitionMandatory")return Pe.REPETITION_MANDATORY;if(t instanceof mi||t==="RepetitionMandatoryWithSeparator")return Pe.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Kr||t==="RepetitionWithSeparator")return Pe.REPETITION_WITH_SEPARATOR;if(t instanceof Wr||t==="Alternation")return Pe.ALTERNATION;throw Error("non exhaustive match")}function K3(t,e,n,r,i,s){const o=f0(t,e,n),a=fw(o)?Iu:Ac;return s(o,r,a,i)}function W3(t,e,n,r,i,s){const o=d0(t,e,i,n),a=fw(o)?Iu:Ac;return s(o[0],a,r)}function H3(t,e,n,r){const i=t.length,s=$r(t,o=>$r(o,a=>a.length===1));if(e)return function(o){const a=Et(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],p=h.length;for(let m=0;m<p;m++){const b=this.LA(m+1);if(n(b,h[m])===!1)continue t}return c}}};if(s&&!r){const o=Et(t,c=>cr(c)),a=Kn(o,(c,l,u)=>(Ct(l,f=>{Nt(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Ct(f.categoryMatches,d=>{Nt(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function G3(t,e,n){const r=$r(t,s=>s.length===1),i=t.length;if(r&&!n){const s=cr(t);if(s.length===1&&be(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Kn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ct(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue t}return!0}return!1}}class Y3 extends wu{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,Pe.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,Pe.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,Pe.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,Pe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class lw extends Js{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,Pe.OPTION)}visitRepetition(e){this.checkIsTarget(e,Pe.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,Pe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,Pe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,Pe.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,Pe.ALTERNATION)}}function uw(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function h0(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function V3(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function hw(t,e){const n=Et(t,o=>u0([o],1)),r=uw(n.length),i=Et(n,o=>{const a={};return Ct(o,c=>{const l=h0(c.partialPath);Ct(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=uw(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=h0(f);if(V3(i,h,c)||be(d)||f.length===e){const m=r[c];if(p0(m,f)===!1){m.push(f);for(let b=0;b<h.length;b++){const _=h[b];i[c][_]=!0}}}else{const m=u0(d,o+1,f);s[c]=s[c].concat(m),Ct(m,b=>{const _=h0(b.partialPath);Ct(_,v=>{i[c][v]=!0})})}}}}return r}function f0(t,e,n,r){const i=new lw(t,Pe.ALTERNATION,r);return e.accept(i),hw(i.result,n)}function d0(t,e,n,r){const i=new lw(t,n);e.accept(i);const s=i.result,a=new Y3(e,t,n).startWalking(),c=new Hn({definition:s}),l=new Hn({definition:a});return hw([c,l],r)}function p0(t,e){t:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function Z3(t,e){return t.length<e.length&&$r(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function fw(t){return $r(t,e=>$r(e,n=>$r(n,r=>be(r.categoryMatches))))}function X3(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return Et(e,n=>Object.assign({type:Nn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function q3(t,e,n,r){const i=Sr(t,c=>J3(c,n)),s=uU(t,e,n),o=Sr(t,c=>oU(c,n)),a=Sr(t,c=>eU(c,t,r,n));return i.concat(s,o,a)}function J3(t,e){const n=new tU;t.accept(n);const r=n.allProductions,i=A1(r,Q3),s=zr(i,a=>a.length>1);return Et(Ze(s),a=>{const c=jr(a),l=e.buildDuplicateFoundError(t,a),u=gi(c),f={message:l,type:Nn.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=dw(c);return d&&(f.parameter=d),f})}function Q3(t){return`${gi(t)}_#_${t.idx}_#_${dw(t)}`}function dw(t){return t instanceof Me?t.terminalType.name:t instanceof Wn?t.nonTerminalName:""}class tU extends Js{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function eU(t,e,n,r){const i=[];if(Kn(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:Nn.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function nU(t,e,n){const r=[];let i;return In(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Nn.INVALID_RULE_OVERRIDE,ruleName:t})),r}function pw(t,e,n,r=[]){const i=[],s=Lu(e.definition);if(be(s))return[];{const o=t.name;In(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Nn.LEFT_RECURSION,ruleName:o});const c=mu(s,r.concat([t])),l=Sr(c,u=>{const f=_n(r);return f.push(u),pw(t,u,n,f)});return i.concat(l)}}function Lu(t){let e=[];if(be(t))return e;const n=jr(t);if(n instanceof Wn)e.push(n.referencedRule);else if(n instanceof Hn||n instanceof Gn||n instanceof pi||n instanceof mi||n instanceof Kr||n instanceof nn)e=e.concat(Lu(n.definition));else if(n instanceof Wr)e=cr(Et(n.definition,s=>Lu(s.definition)));else if(!(n instanceof Me))throw Error("non exhaustive match");const r=bu(n),i=t.length>1;if(r&&i){const s=yn(t);return e.concat(Lu(s))}else return e}class m0 extends Js{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function rU(t,e){const n=new m0;t.accept(n);const r=n.alternations;return Sr(r,s=>{const o=xc(s.definition);return Sr(o,(a,c)=>{const l=aw([a],[],Ac,1);return be(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:Nn.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function iU(t,e,n){const r=new m0;t.accept(r);let i=r.alternations;return i=gu(i,o=>o.ignoreAmbiguities===!0),Sr(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=f0(a,t,c,o),u=cU(l,o,t,n),f=lU(l,o,t,n);return u.concat(f)})}class sU extends Js{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function oU(t,e){const n=new m0;t.accept(n);const r=n.alternations;return Sr(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Nn.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function aU(t,e,n){const r=[];return Ct(t,i=>{const s=new sU;i.accept(s);const o=s.allProductions;Ct(o,a=>{const c=cw(a),l=a.maxLookahead||e,u=a.idx,d=d0(u,i,c,l)[0];if(be(cr(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:Nn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function cU(t,e,n,r){const i=[],s=Kn(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Ct(c,u=>{const f=[l];Ct(t,(d,h)=>{l!==h&&p0(d,u)&&e.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!p0(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return Et(s,a=>{const c=Et(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Nn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function lU(t,e,n,r){const i=Kn(t,(o,a,c)=>{const l=Et(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return wc(Sr(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Rr(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&Z3(d.path,l));return Et(u,d=>{const h=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:h,prefixPath:d.path}),type:Nn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:h}})}))}function uU(t,e,n){const r=[],i=Et(e,s=>s.name);return Ct(t,s=>{const o=s.name;if(In(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:Nn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function hU(t){const e=e0(t,{errMsgProvider:U3}),n={};return Ct(t.rules,r=>{n[r.name]=r}),F3(n,e.errMsgProvider)}function fU(t){return t=e0(t,{errMsgProvider:eo}),q3(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const mw="MismatchedTokenException",gw="NoViableAltException",_w="EarlyExitException",yw="NotAllInputParsedException",bw=[mw,gw,_w,yw];Object.freeze(bw);function Mu(t){return In(bw,t.name)}class Uu extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class ww extends Uu{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=mw}}class dU extends Uu{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=gw}}class pU extends Uu{constructor(e,n){super(e,n),this.name=yw}}class mU extends Uu{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=_w}}const g0={},xw="InRuleRecoveryException";class gU extends Error{constructor(e){super(e),this.name=xw}}class _U{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Nt(e,"recoveryEnabled")?e.recoveryEnabled:Pi.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=yU)}getTokenToInsert(e){const n=Nu(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new ww(h,l,this.LA(0));p.resyncedTokens=xc(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new gU("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||be(n))return!1;const r=this.LA(1);return Jo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return In(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Jo(e,s=>M3(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return g0;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Et(e,(r,i)=>i===0?g0:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=Et(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return cr(e)}getFollowSetFromFollowKey(e){if(e===g0)return[to];const n=e.ruleName+e.idxInCallingRule+L1+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,to)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return xc(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=_n(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Et(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function yU(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=to,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const bU=4,ms=8,Ew=1<<ms,vw=2<<ms,_0=3<<ms,y0=4<<ms,b0=5<<ms,Fu=6<<ms;function w0(t,e,n){return n|e|t}class wU{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:Pi.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(be(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return Sr(e,n=>pw(n,n,eo))}validateEmptyOrAlternatives(e){return Sr(e,n=>rU(n,eo))}validateAmbiguousAlternationAlternatives(e,n){return Sr(e,r=>iU(r,n,eo))}validateSomeNonEmptyLookaheadPath(e,n){return aU(e,n,eo)}buildLookaheadForAlternation(e){return K3(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,H3)}buildLookaheadForOptional(e){return W3(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,cw(e.prodType),G3)}}class xU{initLooksAhead(e){this.dynamicTokensEnabled=Nt(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Pi.dynamicTokensEnabled,this.maxLookahead=Nt(e,"maxLookahead")?e.maxLookahead:Pi.maxLookahead,this.lookaheadStrategy=Nt(e,"lookaheadStrategy")?e.lookaheadStrategy:new wU({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Ct(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=vU(n);Ct(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${gi(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=w0(this.fullRuleNameToShort[n.name],Ew,l.idx);this.setLaFuncCache(d,f)})}),Ct(i,l=>{this.computeLookaheadFunc(n,l.idx,_0,"Repetition",l.maxLookahead,gi(l))}),Ct(s,l=>{this.computeLookaheadFunc(n,l.idx,vw,"Option",l.maxLookahead,gi(l))}),Ct(o,l=>{this.computeLookaheadFunc(n,l.idx,y0,"RepetitionMandatory",l.maxLookahead,gi(l))}),Ct(a,l=>{this.computeLookaheadFunc(n,l.idx,Fu,"RepetitionMandatoryWithSeparator",l.maxLookahead,gi(l))}),Ct(c,l=>{this.computeLookaheadFunc(n,l.idx,b0,"RepetitionWithSeparator",l.maxLookahead,gi(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=w0(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return w0(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class EU extends Js{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Bu=new EU;function vU(t){Bu.reset(),t.accept(Bu);const e=Bu.dslMethods;return Bu.reset(),e}function kw(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function Tw(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function kU(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function TU(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const AU="name";function Aw(t,e){Object.defineProperty(t,AU,{enumerable:!1,configurable:!0,writable:!1,value:e})}function RU(t,e){const n=Tr(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function SU(t,e){const n=function(){};Aw(n,t+"BaseSemantics");const r={visit:function(i,s){if(ne(i)&&(i=i[0]),!Bi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=IU(this,e);if(!be(i)){const s=Et(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function OU(t,e,n){const r=function(){};Aw(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Ct(e,s=>{i[s]=RU}),r.prototype=i,r.prototype.constructor=r,r}var x0;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(x0||(x0={}));function IU(t,e){return NU(t,e)}function NU(t,e){const n=Rr(e,i=>Li(t[i])===!1),r=Et(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:x0.MISSING_METHOD,methodName:i}));return wc(r)}class CU{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Nt(e,"nodeLocationTracking")?e.nodeLocationTracking:Pi.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=en,this.cstFinallyStateUpdate=en,this.cstPostTerminal=en,this.cstPostNonTerminal=en,this.cstPostRule=en;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Tw,this.setNodeLocationFromNode=Tw,this.cstPostRule=en,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=en,this.setNodeLocationFromNode=en,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=kw,this.setNodeLocationFromNode=kw,this.cstPostRule=en,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=en,this.setNodeLocationFromNode=en,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=en,this.setNodeLocationFromNode=en,this.cstPostRule=en,this.setInitialNodeLocation=en;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];kU(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];TU(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Bi(this.baseCstVisitorConstructor)){const e=SU(this.className,Tr(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Bi(this.baseCstVisitorWithDefaultsConstructor)){const e=OU(this.className,Tr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class LU{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):$u}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?$u:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class MU{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=ju){if(In(this.definedRulesNames,e)){const o={message:eo.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Nn.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=ju){const i=nU(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Mu(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return F8(Ze(this.gastProductionsCache))}}class UU{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Iu,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Nt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(ne(e)){if(be(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(ne(e))this.tokensMap=Kn(e,(s,o)=>(s[o.name]=o,s),{});else if(Nt(e,"modes")&&$r(cr(Ze(e.modes)),I3)){const s=cr(Ze(e.modes)),o=_u(s);this.tokensMap=Kn(o,(a,c)=>(a[c.name]=c,a),{})}else if(kr(e))this.tokensMap=_n(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=to;const r=Nt(e,"modes")?cr(Ze(e.modes)):Ze(e),i=$r(r,s=>be(s.categoryMatches));this.tokenMatcher=i?Iu:Ac,Rc(Ze(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Nt(r,"resyncEnabled")?r.resyncEnabled:ju.resyncEnabled,s=Nt(r,"recoveryValueFunc")?r.recoveryValueFunc:ju.recoveryValueFunc,o=this.ruleShortNameIdx<<bU+ms;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Mu(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(vw,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(y0,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,Pe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,y0,e,j3)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Fu,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,ow],a,Fu,e,ow)}else throw this.raiseEarlyExitException(e,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(_0,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,_0,e,$3,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(b0,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,sw],a,b0,e,sw)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,Fu,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(Ew,n),i=ne(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new pU(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Mu(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new ww(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===xw?r:s}}else throw r}saveRecogState(){const e=this.errors,n=_n(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),to)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class FU{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Nt(e,"errorMessageProvider")?e.errorMessageProvider:Pi.errorMessageProvider}SAVE_ERROR(e){if(Mu(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:_n(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return _n(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=d0(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new mU(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=f0(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new dU(c,this.LA(1),a))}}class BU{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Bi(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return aw([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=jr(e.ruleStack),i=this.getGAstProductions()[n];return new D3(i,e).startWalking()}}const Pu={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Pu);const Rw=!0,Sw=Math.pow(2,ms)-1,Ow=lr({name:"RECORDING_PHASE_TOKEN",pattern:rn.NA});Rc([Ow]);const Iw=Nu(Ow,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Iw);const PU={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class DU{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return $u}topLevelRuleRecord(e,n){try{const r=new Qo({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Ic.call(this,Gn,e,n)}atLeastOneInternalRecord(e,n){Ic.call(this,pi,n,e)}atLeastOneSepFirstInternalRecord(e,n){Ic.call(this,mi,n,e,Rw)}manyInternalRecord(e,n){Ic.call(this,nn,n,e)}manySepFirstInternalRecord(e,n){Ic.call(this,Kr,n,e,Rw)}orInternalRecord(e,n){return $U.call(this,e,n)}subruleInternalRecord(e,n,r){if(Du(n),!e||Nt(e,"ruleName")===!1){const a=new Error(`<SUBRULE${Nw(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=qo(this.recordingProdStack),s=e.ruleName,o=new Wn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?PU:Pu}consumeInternalRecord(e,n,r){if(Du(n),!Y1(e)){const o=new Error(`<CONSUME${Nw(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=qo(this.recordingProdStack),s=new Me({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),Iw}}function Ic(t,e,n,r=!1){Du(n);const i=qo(this.recordingProdStack),s=Li(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),Nt(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Pu}function $U(t,e){Du(e);const n=qo(this.recordingProdStack),r=ne(t)===!1,i=r===!1?t:t.DEF,s=new Wr({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});Nt(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=n0(i,a=>Li(a.GATE));return s.hasPredicates=o,n.definition.push(s),Ct(i,a=>{const c=new Hn({definition:[]});s.definition.push(c),Nt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Nt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Pu}function Nw(t){return t===0?"":`${t}`}function Du(t){if(t<0||t>Sw){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${Sw+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class jU{initPerformanceTracer(e){if(Nt(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Pi.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=I1(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function zU(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const $u=Nu(to,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze($u);const Pi=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:iw,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),ju=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Nn;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Nn||(Nn={}));let E0=class ev{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{N1(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ct(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=hU({rules:Ze(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(be(r)&&this.skipValidations===!1){const i=fU({rules:Ze(this.gastProductionsCache),tokenTypes:Ze(this.tokensMap),errMsgProvider:eo,grammarName:n}),s=X3({lookaheadStrategy:this.lookaheadStrategy,rules:Ze(this.gastProductionsCache),tokenTypes:Ze(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),be(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=K8(Ze(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ze(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ze(this.gastProductionsCache))})),!ev.DEFER_DEFINITION_ERRORS_HANDLING&&!be(this.definitionErrors))throw e=Et(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Nt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Nt(n,"skipValidations")?n.skipValidations:Pi.skipValidations}};E0.DEFER_DEFINITION_ERRORS_HANDLING=!1,zU(E0,[_U,xU,CU,LU,UU,MU,FU,BU,DU,jU]);class KU extends E0{constructor(e,n=Pi){const r=_n(n);r.outputCst=!0,super(e,r)}}function WU(t){const e=new HU,n=Ze(t);return Et(n,r=>e.visitRule(r))}class HU extends Js{visitRule(e){const n=this.visitEach(e.definition),r=A1(n,s=>s.propertyName),i=Et(r,(s,o)=>{const a=!n0(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Et(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:zu(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:zu(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:zu(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:zu(e)}]}visitEachAndOverrideWith(e,n){return Et(this.visitEach(e),r=>jn({},r,n))}visitEach(e){return cr(Et(e,n=>this.visit(n)))}}function zu(t){return t instanceof Wn?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function GU(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(cr(Et(t,r=>YU(r)))),e.includeVisitorInterface&&(n=n.concat(qU(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function YU(t){const e=VU(t),n=ZU(t);return[e,n]}function VU(t){const e=Lw(t.name),n=v0(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function ZU(t){return`export type ${v0(t.name)} = {
  ${Et(t.properties,n=>XU(n)).join(`
  `)}
};`}function XU(t){const e=QU(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function qU(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Et(e,n=>JU(n)).join(`
  `)}
}`}function JU(t){const e=v0(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function QU(t){if(ne(t)){const e=_u(Et(t,r=>Cw(r)));return"("+Kn(e,(r,i)=>r+" | "+i)+")"}else return Cw(t)}function Cw(t){return t.kind==="token"?"IToken":Lw(t.name)}function Lw(t){return Vb(t)+"CstNode"}function v0(t){return Vb(t)+"CstChildren"}const tF={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function eF(t,e){const n=Object.assign(Object.assign({},tF),e),r=WU(t);return GU(r,n)}const _i=!!JSON.parse("false"),nF=!!JSON.parse("false");JSON.parse("false");const rF=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Di={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return us*Di.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return hs*Di.DRAW_CHAR_SCALE}},Ku=wy(32,126).map(t=>String.fromCharCode(t));function Gt(t){return lr({...t,name:`token_${t.name}`})}function gs(t,e=!1){return Gt(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:bn,group:rn.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:bn})}const Nc=Gt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),iF=Gt({name:"whitespace",pattern:/ +/,group:rn.SKIPPED}),sF=Gt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:rn.SKIPPED}),k0=Gt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),ea=Gt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Mw=!1;function oF(t,e,n){if(!Mw)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Nc)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const Uw=Gt({name:"text",pattern:oF,line_breaks:!1,start_chars_hint:Ku.filter(t=>"@#/?':!".includes(t)===!1)}),Fw=Gt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),T0=Gt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Bw=Gt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Pw=Gt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),bn=Gt({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Ku}),Dw=Gt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),$w=Gt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),jw=Gt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:bn}),zw=Gt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:bn}),Kw=Gt({name:"islessthan",pattern:/<|below/,longer_alt:bn}),Ww=Gt({name:"isgreaterthan",pattern:/>|above/,longer_alt:bn}),Hw=Gt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:bn}),Gw=Gt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:bn}),A0=Gt({name:"or",pattern:/or/i,longer_alt:bn}),R0=Gt({name:"not",pattern:/not/i,longer_alt:bn}),S0=Gt({name:"and",pattern:/and/i,longer_alt:bn}),O0=Gt({name:"plus",pattern:/\+/}),I0=Gt({name:"minus",pattern:/-/}),Yw=Gt({name:"power",pattern:/\*\*/}),Vw=Gt({name:"multiply",pattern:/\*/}),N0=Gt({name:"divide",pattern:/\//}),Zw=Gt({name:"moddivide",pattern:/%/}),Xw=Gt({name:"floordivide",pattern:/%%/}),qw=Gt({name:"query",pattern:/\?/}),Jw=Gt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),Qw=Gt({name:"rparen",pattern:/\)/,pop_mode:!0}),tx=Gt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Ku,longer_alt:bn}),ex=Gt({name:"command_toast",pattern:/toast .*/,start_chars_hint:Ku,longer_alt:bn}),C0=Gt({name:"if",pattern:/if|try|take|give/,longer_alt:bn}),Wu=gs("do"),L0=gs("done"),M0=gs("else"),nx=gs("while"),rx=gs("repeat"),ix=gs("waitfor"),sx=Gt({name:"foreach",pattern:/foreach|for/,longer_alt:bn}),ox=gs("break"),ax=gs("continue");function cx(t){return[...t,$w,jw,zw,Hw,Kw,Gw,Ww,A0,R0,S0,O0,I0,Yw,Vw,N0,Xw,Zw,qw,Jw,Qw,Dw,bn]}const lx=cx([Uw,k0,tx,ex,ea,Fw,T0,Bw,Pw,Nc,iF,ox,ax,L0,Wu,M0,sx,C0,rx,ix,nx]),aF=new rn({defaultMode:"use_newlines",modes:{use_newlines:lx,ignore_newlines:cx([sF])}},{skipValidations:!_i,ensureOptimizations:_i,positionTracking:"full"});function ux(t){Mw=!0;const e=aF.tokenize(t||` 
`),[n]=(ue(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(Nu(Nc,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function cF(t,e,n=!0){if(n){const[r,...i]=e;switch(It(r??"")){default:return{type:vt.OBJECT,values:e};case"loader":return{type:vt.LOADER,values:i};case"board":return{type:vt.BOARD,values:i};case"object":return{type:vt.OBJECT,values:i};case"terrain":return{type:vt.TERRAIN,values:i};case"charset":return{type:vt.CHARSET,values:i};case"palette":return{type:vt.PALETTE,values:i}}}else{const[r,i,...s]=e,o=It(i??""),a=[r,t,...s];switch(o){default:return{type:vt.CONST,values:e};case"rn":case"range":return{type:vt.RANGE,values:a};case"sl":case"select":return{type:vt.SELECT,values:a};case"nm":case"number":return{type:vt.NUMBER,values:a};case"tx":case"text":return{type:vt.TEXT,values:a};case"hk":case"hotkey":return{type:vt.HOTKEY,values:a};case"copyit":return{type:vt.COPYIT,values:a};case"openit":return{type:vt.OPENIT,values:a};case"zssedit":return{type:vt.ZSSEDIT,values:a};case"charedit":return{type:vt.CHAREDIT,values:a};case"coloredit":return{type:vt.COLOREDIT,values:a}}}}function ur(t){switch(t){case vt.LOADER:return"loader";case vt.BOARD:return"board";case vt.OBJECT:return"object";case vt.TERRAIN:return"terrain";case vt.CHARSET:return"charset";case vt.PALETTE:return"palette";case vt.CONST:return"const";case vt.RANGE:return"range";case vt.SELECT:return"select";case vt.NUMBER:return"number";case vt.TEXT:return"text";case vt.HOTKEY:return"hotkey";case vt.COPYIT:return"copyit";case vt.OPENIT:return"openit";case vt.ZSSEDIT:return"zssedit";case vt.CHAREDIT:return"charedit";case vt.COLOREDIT:return"coloredit"}}var U0=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(U0||{});function hx(t){return Yo(t,U0,{bits:e=>Array.from(e)})}function fx(t){return sc(t,U0,{bits:e=>new Uint8Array(e)})}function lF(t,e){return{id:ze(),code:t,...e}}var F0=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(F0||{});function uF(t){return Yo(t,F0,{board:dN,object:Zl,terrain:Zl,charset:hx,palette:hx,stats:Re})}function hF(t){return sc(t,F0,{board:pN,object:Xl,terrain:Xl,charset:fx,palette:fx})}function Cc(t){const e={...no(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function fF(t){return x(t)?(t.stats=void 0,no(t)):{}}function dx(t){const e=ux(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===k0){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=cF(gt(c)?c:"",l,r),f=It(u.values.join(" "));switch(r=!1,u.type){case vt.LOADER:n.type=_t.LOADER,n.name=f;break;case vt.BOARD:n.type=_t.BOARD,n.name=f;break;case vt.OBJECT:n.type=_t.OBJECT,n.name=f||"object";break;case vt.TERRAIN:n.type=_t.TERRAIN,n.name=f;break;case vt.CHARSET:n.type=_t.CHARSET,n.name=f;break;case vt.PALETTE:n.type=_t.PALETTE,n.name=f;break;case vt.CONST:{const[d,h]=u.values;if(gt(d)){const p=It(d);if(gt(h)){const m=parseFloat(h);n[p]=kt(m)?m:h}else kt(h)?n[p]=h:n[p]=1}break}case vt.RANGE:case vt.SELECT:case vt.NUMBER:case vt.TEXT:case vt.HOTKEY:case vt.ZSSEDIT:case vt.CHAREDIT:case vt.COLOREDIT:{const[d,...h]=u.values;if(gt(d)){const p=It(d);n[p]=[ur(u.type),...h]}break}}}}return n}function no(t){var e;return x(t)?(x((e=t.stats)==null?void 0:e.type)||(t.stats=dx(t.code),x(t.stats.type)||(t.stats.type=_t.OBJECT)),t.stats):{}}function px(t){switch(t){default:case _t.ERROR:return"error";case _t.LOADER:return ur(vt.LOADER);case _t.BOARD:return ur(vt.BOARD);case _t.OBJECT:return ur(vt.OBJECT);case _t.TERRAIN:return ur(vt.TERRAIN);case _t.CHARSET:return ur(vt.CHARSET);case _t.PALETTE:return ur(vt.PALETTE)}}function $i(t){return no(t).type??_t.ERROR}function ji(t){return px($i(t))}function Ge(t){return no(t).name??""}function B0(t,e){return no(t)[e]}const Hu=new ld;function dF(t){if(!gt(t))return;const e=jl(t);if(x(e)&&x(At[e]))return At[e];const n=It(t),r=dt[n];if(x(r))return r}function P0(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(!ue(s))switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[i]=t[i];break;case"color":case"bg":case"lightdir":e[i]=dF(t[i])??t[i];break;case"ispushable":e.pushable=1;break;case"notpushable":e.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=Ut.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=Ut.ISSWIM;break;case"issolid":e.collision=Ut.ISSOLID;break;case"isbullet":e.collision=Ut.ISBULLET;break;case"isbreakable":e.breakable=1;break;case"notbreakable":e.breakable=0;break}}}function Ee(t){var e;if(x(t))switch($i(t)){default:return;case _t.ERROR:return t.code??"";case _t.LOADER:return t.code??"";case _t.BOARD:{x(t.board)||(t.board=ql()),t.board.id=t.id;const n=Cc(t);return n.isdark&&(t.board.isdark=1),n.notdark&&(t.board.isdark=0),kt(n.startx)&&(t.board.startx=n.startx),kt(n.starty)&&(t.board.starty=n.starty),gt(n.over)&&(t.board.over=n.over),gt(n.under)&&(t.board.under=n.under),gt(n.camera)&&(t.board.camera=n.camera),gt(n.graphics)&&(t.board.graphics=n.graphics),kt(n.facing)&&(t.board.facing=n.facing),gt(n.exitnorth)&&(t.board.exitnorth=n.exitnorth),gt(n.exitsouth)&&(t.board.exitsouth=n.exitsouth),gt(n.exitwest)&&(t.board.exitwest=n.exitwest),gt(n.exiteast)&&(t.board.exiteast=n.exiteast),kt(n.timelimit)&&(t.board.timelimit=n.timelimit),n.restartonzap&&(t.board.restartonzap=1),n.norestartonzap&&(t.board.restartonzap=0),kt(n.maxplayershots)&&(t.board.maxplayershots=n.maxplayershots),t.board}case _t.OBJECT:return x(t.object)||(t.object=ib()),t.object.id=t.id,t.object.name=Ge(t),t.object.category=Pn.ISOBJECT,P0(Cc(t),t.object),t.object;case _t.TERRAIN:return x(t.terrain)||(t.terrain=ib()),t.terrain.id=t.id,t.terrain.name=Ge(t),t.terrain.category=Pn.ISTERRAIN,P0(Cc(t),t.terrain),t.terrain;case _t.PALETTE:{if(x(t.palette)||(t.palette=Sd(hb)),x((e=t.palette)==null?void 0:e.bits)){const n=Cc(t),r=pr(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&gt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Hu.set(o);const c=a*uc,l=Hu.r*63,u=Hu.g*63,f=Hu.b*63;t.palette.bits[c+0]=tn(l,0,63),t.palette.bits[c+1]=tn(u,0,63),t.palette.bits[c+2]=tn(f,0,63)}}}}return t.palette}case _t.CHARSET:return x(t.charset)||(t.charset=ub(CN)),t.charset}}function mx(t){return{id:ze(),name:gv(),timestamp:0,activelist:[],pages:t,flags:{}}}var D0=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t[t.token=6]="token",t))(D0||{});function pF(t){return Yo(t,D0,{pages:e=>e.map(uF),flags:e=>{const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(e[i]).length===0&&delete e[i]}return e}})}function mF(t){return sc(t,D0,{pages:e=>e.map(hF)})}function gx(t){x(t)&&(t.token=`${_v()}${wr(1111,9999)}`)}function zi(t,e){if(!x(t))return;const n=It(e);return t.pages.find(i=>i.id===e||n===Ge(i))}function Ye(t,e,n){if(!x(t))return;const r=It(n);return t.pages.find(s=>$i(s)===e&&(s.id===n||r===Ge(s)))}function $0(t,e,n){let r=Ye(t,e,n);if(!x(r)){const i=px(e);return r=lF(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),yx(t,r),[r,!0]}return[r,!1]}function ro(t,e){return x(t)?t.pages.filter(n=>$i(n)===e):[]}function Yn(t,e,n){if(!x(t))return[];const r=It(n);return t.pages.filter(s=>$i(s)===e).filter(s=>{const o=no(s),a=It(Ge(s));return s.id===n||r===a||x(o[n])})}function j0(t){return x(t)?tr(t.pages).sort((n,r)=>{const i=$i(n),s=$i(r);return i===s?Ge(n).localeCompare(Ge(r)):s-i}):[]}function _x(t,e){if(x(e)){const n=Ye(t,_t.TERRAIN,e.kind??"");if(x(n))return n;const r=Ye(t,_t.OBJECT,e.kind??"");if(x(r))return r}}function yx(t,e){if(!x(t)||!x(e))return!1;const n=zi(t,e.id);return x(n)?!1:(t.pages.push(e),gx(t),!0)}function bx(t,e){const n=zi(t,e);if(x(t)&&x(n)){const r=It(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==Ge(i)),gx(t),n}}function _s(t,e){if(x(e)&&x(e.kind))return x(e.kinddata)||(e.kinddata=x(e.id)?io(t,e.kind):Lc(t,e.kind)),e.kinddata}function ie(t,e,n){const r=_s(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])??B0(zi(t,(r==null?void 0:r.id)??""),n)}function na(t,e,n,r,i){const s=_s(t,e);return{char:(e==null?void 0:e.char)??(s==null?void 0:s.char)??n,color:(e==null?void 0:e.color)??(s==null?void 0:s.color)??r,bg:(e==null?void 0:e.bg)??(s==null?void 0:s.bg)??i,light:(e==null?void 0:e.light)??(s==null?void 0:s.light)??0}}function io(t,e){const n=e??"",r=Ye(t,_t.OBJECT,n);if(x(r)){const i=Ee(r);return{...tr(i),name:n,code:r.code}}}function Lc(t,e){const n=e??"",r=Ye(t,_t.TERRAIN,n);if(x(r)){const i=Ee(r);return{...tr(i),name:n,code:r.code}}}function ys(t,e){const n=zi(t,e);return Ee(n)}function gF(t,e){return!!(t!=null&&t.flags[e])}function Ki(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function wx(t,e){t&&delete t.flags[e]}function xx(t,e,n){const r=Ki(t,e);return r==null?void 0:r[n]}function _F(t,e,n,r){const i=Ki(t,e);return i&&(i[n]=r),r}function so(t,e){const n=xx(t,e,"board");return ys(t,gt(n)?n:"")}function yF(t,e){return(t==null?void 0:t.activelist.includes(e))??!1}function Gu(t,e,n){if(!x(t))return;_F(t,e,"board",n);const r=ys(t,n);x(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function ra(t,e,n,r){if(!x(t))return;const i=so(t,e);if(!x(i))return;const s=Sn(i,e);if(!gn(s)||!(s!=null&&s.id))return;const o=ys(t,n);if(!x(o)||(De(t,o),K0(t,o,Ut.ISWALK,r,!0)))return;delete i.objects[s.id];const a=Pr(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Pr(o,s);o.lookup&&(o.lookup[c]=s.id),Gu(t,e,o.id)}function bF(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=xx(t,r,"board");return gt(i)?i:""});return FI(n)}function ia(t){const e=bF(t),n=new Set,r=[];for(let i=0;i<e.length;++i){const s=ys(t,e[i]);if(x(s)&&!n.has(s.id)){if(gt(s.over))if(gt(s.overboard)){const o=ys(t,s.overboard);x(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=Yn(t,_t.BOARD,s.over);if(o.length){const a=Ae(o),c=Ee(a);x(c)&&(s.overboard=c.id)}}else gt(s.overboard)&&delete s.overboard;if(r.push(s),gt(s.under))if(gt(s.underboard)){const o=ys(t,s.underboard);x(o)||delete s.underboard}else{const o=Yn(t,_t.BOARD,s.under);if(o.length){const a=Ae(o),c=Ee(a);x(c)&&(s.underboard=c.id)}}else gt(s.underboard)&&delete s.underboard}}return r}function wF(t,e,n,r,i){if(!x(e))return;x(e.distmaps)||(e.distmaps={});const s=`${n}.${r.x}.${r.y}.${i.x}.${i.y}`;let o=e.distmaps[s];if(!x(o)){o=new Array(Ed).fill(-2);const a=[{...i}];let c=0;for(;a.length;){const l=a.shift();if(x(l)&&Jl(l)){const u=si(l,Tt);if(o[u]===-2){const f=ls(e,l.x,l.y);ac(n,ie(t,f,"collision")??Ut.ISWALK)||(o[u]=c,a.push({x:l.x,y:l.y-1},{x:l.x,y:l.y+1},{x:l.x-1,y:l.y},{x:l.x+1,y:l.y})),++c}}}e.distmaps[s]=o}return o}function Ex(t,e){return Jl(t)?e[si(t,Tt)]:-1}function vx(t,e,n,r,i,s){if(!x(t)||!x(e))return;const o=wF(t,e,n,r,i);if(!x(o))return;const a=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let c;if(s){let l=s?0:1e4;for(let u=0;u<a.length;++u){const f=Ex(a[u],o);f>=0&&f>l&&(l=f,c=a[u])}}else{let l=1e5;for(let u=0;u<a.length;++u){const f=Ex(a[u],o);f>=0&&f<l&&(l=f,c=a[u])}}return c}function De(t,e){var a;if(!x(t)||!x(e)||x(e.lookup)&&x(e.named))return;const n=new Array(Tt*Ht).fill(void 0),r={},i=Object.values(e.objects);for(let c=0;c<i.length;++c){const l=i[c];if(x(l.x)&&x(l.y)&&x(l.id)&&!x(l.removed)){l.category=Pn.ISOBJECT,n[l.x+l.y*Tt]=l.id;const u=It(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<e.terrain.length;++c){const l=e.terrain[c];if(x(l)){l.x=s,l.y=o,l.category=Pn.ISTERRAIN;const u=ci(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=Tt&&(s=0,++o)}e.lookup=n,e.named=r}function Mc(t,e){x(e)&&(delete e.named,delete e.lookup,De(t,e))}function kx(t,e,n,r){var s;if(!x(t)||!x(e)||!x(e.named)||!x(n))return;const i=It(n.name??((s=n.kinddata)==null?void 0:s.name)??"");e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function xF(t,e,n){if(!(!x(t)||!x(e)||!x(e.lookup)||!x(n==null?void 0:n.id))&&!x(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*Tt]=n.id}}function EF(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.x)&&x(n.y)){const i=ci(n),s=Pr(e,n);x((r=e.named)==null?void 0:r[i])&&e.named[i].delete(s)}}function z0(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.id)){if(x(e.lookup)&&x(n.x)&&x(n.y)){const s=n.x+n.y*Tt;e.lookup[s]===n.id&&(e.lookup[s]=void 0)}const i=ci(n);x((r=e.named)==null?void 0:r[i])&&x(n.id)&&e.named[i].delete(n.id)}}function Yu(t,e,n,r,i,s){const o=dt.MID;if(!x(t)||!x(e)||!x(n))return{dir:i,startpt:s,destpt:s,layer:o};const a={x:n.x??0,y:n.y??0},c={x:n.lx??a.x,y:n.ly??a.y},l=Fr(c,a),u=Tt-1,f=Ht-1;for(let d=0;d<i.length;++d){const h=PI(i[d]);switch(h){case dt.IDLE:break;case dt.NORTH:case dt.SOUTH:case dt.WEST:case dt.EAST:We(a,h);break;case dt.BY:{const[p,m]=i.slice(d+1);kt(p)&&kt(m)&&(a.x=tn(a.x+p,0,u),a.y=tn(a.y+m,0,f)),d+=2;break}case dt.TO:case dt.AT:{const[p,m]=i.slice(d+1);kt(p)&&kt(m)&&(a.x=tn(p,0,u),a.y=tn(m,0,f)),d+=2;break}case dt.FLOW:We(a,l);break;case dt.SEEK:{const p=yN(e,n,r);Gs(p)&&We(a,Fr(s,p));break}case dt.RNDNS:We(a,Ae(dt.NORTH,dt.SOUTH));break;case dt.RNDNE:We(a,Ae(dt.NORTH,dt.EAST));break;case dt.RND:We(a,Ae(dt.NORTH,dt.SOUTH,dt.WEST,dt.EAST));break;case dt.CW:case dt.CCW:case dt.OPP:case dt.RNDP:{const p=Yu(t,e,n,r,i.slice(d+1),s);switch(a.x=s.x,a.y=s.y,h){case dt.CW:switch(Fr(s,p.destpt)){case dt.NORTH:We(a,dt.EAST);break;case dt.SOUTH:We(a,dt.WEST);break;case dt.EAST:We(a,dt.SOUTH);break;case dt.WEST:We(a,dt.NORTH);break}break;case dt.CCW:switch(Fr(s,p.destpt)){case dt.NORTH:We(a,dt.WEST);break;case dt.SOUTH:We(a,dt.EAST);break;case dt.EAST:We(a,dt.NORTH);break;case dt.WEST:We(a,dt.SOUTH);break}break;case dt.OPP:switch(Fr(s,p.destpt)){case dt.NORTH:We(a,dt.SOUTH);break;case dt.SOUTH:We(a,dt.NORTH);break;case dt.EAST:We(a,dt.WEST);break;case dt.WEST:We(a,dt.EAST);break}break;case dt.RNDP:switch(Fr(s,p.destpt)){case dt.NORTH:case dt.SOUTH:a.x+=Ae(-1,1);break;case dt.WEST:case dt.EAST:a.y+=Ae(-1,1);break}break}break}case dt.FLEE:case dt.AWAY:{const[p,m]=i.slice(d+1);if(kt(p)&&kt(m)){const b={x:tn(p,0,u),y:tn(m,0,f)},_=ie(t,n,"collision"),v=vx(t,e,_,a,b,!0);x(v)&&(a.x=v.x,a.y=v.y)}d+=2;break}case dt.FIND:case dt.TOWARD:{const[p,m]=i.slice(d+1);if(kt(p)&&kt(m)){const b={x:tn(p,0,u),y:tn(m,0,f)};if(wr(1,100)<5)We(a,Ae(dt.NORTH,dt.SOUTH,dt.WEST,dt.EAST));else{const _=ie(t,n,"collision"),v=vx(t,e,_,a,b,!1);if(x(v))if(v.x!==p&&v.y!==m&&_N(e,v))switch(Fr(s,v)){case dt.EAST:case dt.WEST:a.y+=Ae(-1,1);break;case dt.NORTH:case dt.SOUTH:a.x+=Ae(-1,1);break}else a.x=v.x,a.y=v.y}}d+=2;break}case dt.PLAYER:{const p=cc(e,s,r);Gs(p)&&(a.x=p.x,a.y=p.y);break}case dt.OVER:case dt.UNDER:{const p=Yu(t,e,n,r,i.slice(d+1),s);return p.layer=h,p}}}return{dir:i,startpt:s,destpt:a,layer:o}}function vF(t,e,n,r){if(x(t)&&x(e)&&x(n)){const[i,s]=n,o=io(t,i);if(x(o)&&x(o.name)){const a=Td(e,r,i);return oc(a,s),a}}}function yi(t,e,n,r,i){if(x(t)&&x(e)&&x(n)){const[s,o]=n,a=Lc(t,s);if(x(a)){const l=gN(e,r,s);if(x(l)){oc(l,o);const u=si(r,Tt);return _s(t,l),kx(t,e,l,u),l}}const c=io(t,s);if(x(c)&&x(c.name)){const l=Td(e,r,s,i);if(x(l))return oc(l,o),xF(t,e,l),_s(t,l),kx(t,e,l),l}}}function En(t,e,n,r){return!x(n)||ci(n)==="player"?!1:(n.id?(n.removed=r,z0(t,e,n)):(Se(e,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),EF(t,e,n)),!0)}function K0(t,e,n,r,i=!1){if(!x(t)||!x(e)||!x(e.lookup)||r.x<0||r.x>=Tt||r.y<0||r.y>=Ht)return!0;const s=r.x+r.y*Tt,o=Sn(e,e.lookup[s]??"404");if(x(o))return!(i&&Fn(o.id));const a=e.terrain[s];return x(a)?ac(n,ie(t,a,"collision")??Ut.ISWALK):!1}function kF(t,e,n,r){const i=Sn(e,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=ie(t,i,"collision");return K0(t,e,a,r)}function W0(t,e,n,r){var d;const i=Sn(e,(n==null?void 0:n.id)??"");if(!x(t)||!x(e)||!x(i)||!x(i.x)||!x(i.y)||!x(e.lookup)||!x(n)||r.x<0||r.x>=Tt||r.y<0||r.y>=Ht)return{name:"edge",kind:"edge",collision:Ut.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Pr(e,i),o=Pr(e,r),a=ie(t,i,"collision")??Ut.ISWALK,c=Fn(i==null?void 0:i.id),l=Sn(e,e.lookup[o]??""),u=Fn((l==null?void 0:l.id)??"");if(x(l)&&(!c||!u)){const h=ie(t,n,"group")??"",p=ie(t,l,"group")??"";if((h||p)&&h!=p)return{...l};if(!!ie(t,l,"breakable"))return i.x=r.x,i.y=r.y,{...l};if(a===Ut.ISBULLET)return{...l};if(!!ie(t,l,"pushable")){const _=Fr({x:i.x,y:i.y},r),v=We({x:l.x??0,y:l.y??0},_),T=W0(t,e,l,v);if(x(T))return{...l}}else return{...l}}const f=e.terrain[o];if(x(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??Ut.ISWALK;if(ac(a,h))return{...f,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,x(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function TF(t,e,n){const r=[];if(!x(t)||!x(e))return r;const i=Object.values(e.objects);for(let s=0;s<i.length;++s){const o=i[s];x(o.id)&&x(o.removed)&&n-o.removed>ll*5&&(r.push(o.id),sb(e,o.id))}return r}function AF(t,e,n,r=pg){const i=[];if(!x(t)||!x(e))return i;e.lookup=void 0,De(t,e);const s=Object.values(e.objects);for(let a=0;a<s.length;++a){const c=s[a];if(!x(c.id))continue;c.lx=c.x,c.ly=c.y;const l=_s(t,c),u=`${(l==null?void 0:l.code)??""}
${c.code??""}`;if(u){if(c.removed){const f=n-c.removed,d=ie(t,c,"cycle")??r;if(f>d)continue}i.push({id:c.id,type:_t.OBJECT,code:u,object:c,terrain:void 0})}}const o=TF(t,e,n);for(let a=0;a<o.length;++a)i.push({id:o[a],type:_t.ERROR,code:"",object:void 0,terrain:void 0});return i}function Tx(t,e,n){const r=[],i=[];if(!x(t)||!x(e))return{objectelements:r,terrainelements:i};function s(a){const c=ie(t,a,n);return x(c)||ci(a)===n||ie(t,a,"group")===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c)&&r.push(c)}for(let a=0;a<Ed;++a){const c=e.terrain[a];x(c)&&s(c)&&i.push(c)}return{objectelements:r,terrainelements:i}}var Ax={exports:{}},H0={exports:{}},Rx;function RF(){return Rx||(Rx=1,function(t,e){(function(n,r){t.exports=r()})(Un,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(m){if(m)for(var b=0;b<u.length;b++)m[u[b]]!==void 0&&this["set"+r(u[b])](m[u[b]])}f.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof f)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new f(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",b=this.getLineNumber()||"",_=this.getColumnNumber()||"",v=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+b+":"+_+")":"[eval]:"+b+":"+_:v?v+" ("+m+":"+b+":"+_+")":m+":"+b+":"+_}},f.fromString=function(b){var _=b.indexOf("("),v=b.lastIndexOf(")"),T=b.substring(0,_),A=b.substring(_+1,v).split(","),C=b.substring(v+1);if(C.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(C,""),S=R[1],U=R[2],I=R[3];return new f({functionName:T,args:A||void 0,fileName:S,lineNumber:U||void 0,columnNumber:I||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(m){return function(b){this[m]=!!b}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(m){return function(b){if(!n(b))throw new TypeError(m+" must be a Number");this[m]=Number(b)}}(o[h]);for(var p=0;p<a.length;p++)f.prototype["get"+r(a[p])]=i(a[p]),f.prototype["set"+r(a[p])]=function(m){return function(b){this[m]=String(b)}}(a[p]);return f})}(H0)),H0.exports}(function(t,e){(function(n,r){t.exports=r(RF())})(Un,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),p=d&&f||void 0,m=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:p,fileName:m,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",p=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;h.match(/\(([^)]*)\)/)&&(m=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Ax);var SF=Ax.exports,OF=ho(SF);function Wi(t){const e={},n={tick(){},everytick(){},listcommands(){return pr(e)},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}function Ue(t){return`${t??""}`}function Uc(t,e){const n=parseFloat(Ue(t));return isNaN(n)?e:n}function Sx(t,e,n){var i;const[r]=rt(e,0,[j.MAYBE_NAME]);oR(tt,t,((i=w.board)==null?void 0:i.id)??"",r??"",n)}function Vn(t,e,n,r){const[i,s]=rt(r,0,[j.NUMBER_OR_STRING,j.MAYBE_NUMBER_OR_STRING]);ug(tt,t,e,n,i,s)}const IF=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Ox(t,e,n){const[r,i]=rt(n,0,[j.NUMBER_OR_STRING]);if(kt(r))cf(tt,t,e,"volume",r);else if(IF.includes(It(r))){const[s,o]=rt(n,i,[j.NUMBER_OR_STRING,j.MAYBE_NUMBER_OR_STRING]);ug(tt,t,e,r,s,o)}else{const[s]=rt(n,i,[j.MAYBE_NUMBER_OR_STRING]);if(kt(s)){const o=n.length-i,a=new Array(o).fill(j.NUMBER),c=rt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;cf(tt,t,e,r,l)}else{const[o]=rt(n,i,[j.MAYBE_NUMBER_OR_STRING]);cf(tt,t,e,r,o)}}}let Ix="en-US-GuyNeural";const G0=Wi().command("talk",(t,e)=>{const[n]=rt(e,0,[j.ANY]);switch(It(n)){default:jA(tt,w.elementfocus);break;case"stop":zA(tt,w.elementfocus);break}return 0}).command("media",(t,e)=>{const[n]=rt(e,0,[j.ANY]);switch(It(n)){default:KA(tt,w.elementfocus);break;case"stop":WA(tt,w.elementfocus);break}return 0}).command("tts",(t,e)=>{const n=e.map(Ue).join("");return sR(tt,w.elementfocus,Ix,n),0}).command("ttsvoice",(t,e)=>(Ix=e.map(Ue).join(""),0)).command("bpm",(t,e)=>{const[n]=rt(e,0,[j.NUMBER]);return cR(tt,w.elementfocus,n),0}).command("vol",(t,e)=>{const[n]=rt(e,0,[j.NUMBER]);return lR(tt,w.elementfocus,n),0}).command("bgvol",(t,e)=>{const[n]=rt(e,0,[j.NUMBER]);return uR(tt,w.elementfocus,n),0}).command("ttsvol",(t,e)=>{const[n]=rt(e,0,[j.NUMBER]);return hR(tt,w.elementfocus,n),0}).command("play",(t,e)=>(Sx(w.elementfocus,e,!1),0)).command("bgplay",(t,e)=>(Sx(w.elementfocus,e,!0),0)).command("synth",(t,e)=>{for(let n=0;n<8;++n)Ox(w.elementfocus,n,e);return 0}).command("echo",(t,e)=>{for(let n=0;n<3;++n)Vn(w.elementfocus,n,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let n=0;n<3;++n)Vn(w.elementfocus,n,"fc",e);return 0}).command("phaser",(t,e)=>{for(let n=0;n<3;++n)Vn(w.elementfocus,n,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let n=0;n<3;++n)Vn(w.elementfocus,n,"reverb",e);return 0}).command("distort",(t,e)=>{for(let n=0;n<3;++n)Vn(w.elementfocus,n,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let n=0;n<3;++n)Vn(w.elementfocus,n,"vibrato",e);return 0}).command("autowah",(t,e)=>{for(let n=0;n<3;++n)Vn(w.elementfocus,n,"autowah",e);return 0});for(let t=0;t<8;++t)G0.command(`synth${t+1}`,(e,n)=>(Ox(w.elementfocus,t,n),0));for(let t=0;t<3;++t){const e=t+1;G0.command(`echo${e}`,(n,r)=>(Vn(w.elementfocus,t,"echo",r),0)).command(`fcrush${e}`,(n,r)=>(Vn(w.elementfocus,t,"fcrush",r),0)).command(`phaser${e}`,(n,r)=>(Vn(w.elementfocus,t,"phaser",r),0)).command(`reverb${e}`,(n,r)=>(Vn(w.elementfocus,t,"reverb",r),0)).command(`distort${e}`,(n,r)=>(Vn(w.elementfocus,t,"distort",r),0)).command(`vibrato${e}`,(n,r)=>(Vn(w.elementfocus,t,"vibrato",r),0)).command(`autowah${e}`,(n,r)=>(Vn(w.elementfocus,t,"autowah",r),0))}const NF=wy(32,126).map(t=>String.fromCharCode(t)),CF=lr({name:"Whitespace",pattern:/ +/}),LF=lr({name:"WhitespaceSkipped",pattern:/ +/,group:rn.SKIPPED}),Y0=lr({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Nx=lr({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:NF}),V0=lr({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Z0=lr({name:"EscapedDollar",pattern:"$$"}),X0=lr({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),q0=lr({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),Cx=lr({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function MF(t,e=""){return lr({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const Lx=Object.keys(ec).map(t=>MF(`\\$(${t})`,t)),UF=[CF,Y0,...Lx,V0,Nx,q0,Z0,Cx,X0],FF=new rn(UF,{skipValidations:!_i,ensureOptimizations:_i}),BF=new rn([LF,Y0,...Lx,V0,Nx,q0,Z0,Cx,X0],{skipValidations:!_i,ensureOptimizations:_i});function J0(t,e=!1){return e?BF.tokenize(t):FF.tokenize(t)}function Q0(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function Mx(t){t.active={...t.reset}}function Ux(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case Z0:s("$");break;case q0:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case V0:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Y0:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=ec[l],f=$I(At[u]),d=jI(At[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):x(f)?e.active.color=f:x(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(x(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){Mx(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;DF(u,u+l.length,e.active.color,e.active.bg,e),PF(u,l,e)}}}function Fx(t,e,n){const r=J0(t);r.tokens&&(Ux(r.tokens,e),n&&Mx(e),e.changed())}function Bx(t,e,n){const r=J0(t);if(!r.tokens)return;const i=Q0(e,n,At.WHITE,At.BLACK);return i.measureonly=!0,Ux(r.tokens,i),i.x>0&&++i.y,i}function PF(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function DF(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function Px(t,e,n){if(!Gs(w.element))return 0;const[r,i]=rt(e,0,[j.DIR,j.MAYBE_KIND]),s=i??["bullet"],o=vF(w.book,w.board,s,{x:w.element.x,y:w.element.y});if(x(o)){x(n)&&(o.arg=n),o.party=w.elementid,o.collision=Ut.ISBULLET,o.breakable=1,o.stepx=r.destpt.x-w.element.x,o.stepy=r.destpt.y-w.element.y,o.bg=At.ONCLEAR;const a=_s(w.book,o),c=o.code??(a==null?void 0:a.code)??"";PE(w.book,w.board,o,c,1)}return t.yield(),0}function Vu(t,e,n,r){var u,f;if(!Gs(w.element)||!x(w.book)||!x(w.board)||!x(w.element))return 0;De(w.book,w.board);const[i,s]=rt(e,0,[j.DIR,j.KIND]),o=Jt(w.board,i.destpt);if((o==null?void 0:o.category)===Pn.ISOBJECT&&(o!=null&&o.pushable)){const d={x:((u=w.element)==null?void 0:u.x)??0,y:((f=w.element)==null?void 0:f.y)??0},h=We(i.destpt,Fr(d,i.destpt));W0(w.book,w.board,o,h)}const[a]=s,c=Lc(w.book,a);x(c)&&yi(w.book,w.board,s,i.destpt,n);const l=io(w.book,a);if(x(l)){const d=io(w.book,a)??Lc(w.book,a),h=ie(w.book,d,"collision")??Ut.ISWALK;if(!K0(w.book,w.board,h,i.destpt)){const m=yi(w.book,w.board,s,i.destpt,n);x(m)&&x(r)&&(m.arg=r)}}return 0}function Dx(t,e,n){if(!x(w.book)||!x(w.board))return 0;De(w.book,w.board);const[r,i]=rt(e,0,[j.DIR,j.DIR]),s=Jt(w.board,r.destpt);return gn(s),0}const $F=Wi().command("board",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r]=rt(e,0,[j.STRING]),[i,s]=rt(e,r,[j.MAYBE_NUMBER,j.MAYBE_NUMBER]),o=Yn(w.book,_t.BOARD,n);if(o.length){const a=Ae(...o);x(a)&&ra(w.book,w.elementfocus,a.id,{x:i??Math.round(Tt*.5),y:s??Math.round(Ht*.5)})}return 0}).command("build",(t,e)=>{if(!x(w.book)||!x(w.board)||!x(w.element))return 0;const[n,r]=rt(e,0,[j.NAME,j.MAYBE_STRING]);if(gt(r)){const s=Yn(w.book,_t.BOARD,r),o=Ae(...s);return x(o)&&t.set(n,o.id),0}const i=ql();return x(i)&&t.set(n,i.id),0}).command("shove",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;De(w.book,w.board);const[n,r]=rt(e,0,[j.DIR,j.DIR]),i=Jt(w.board,n.destpt);return gn(i)&&Ts(w.book,w.board,i,r.destpt),0}).command("dupe",Dx).command("duplicate",Dx).command("write",(t,e)=>{var d;if(!x(w.book)||!x(w.board))return 0;De(w.book,w.board);const[n,r,i]=rt(e,0,[j.DIR,j.COLOR]),s=e.slice(i).map(Ue).join(" "),{color:o,bg:a}=Iy(r),c=((d=Bx(s,256,1))==null?void 0:d.measuredwidth)??1,l=Q0(256,1,o??At.WHITE,a??At.BLACK);Fx(s,l,!1);const u=c-1;switch(Fr(n.startpt,n.destpt)){case dt.EAST:for(let h=0;h<c;++h)Se(w.board,{x:n.destpt.x+h,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case dt.WEST:for(let h=0;h<c;++h)Se(w.board,{x:n.destpt.x+h-u,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case dt.NORTH:for(let h=0;h<c;++h)Se(w.board,{x:n.destpt.x,y:n.destpt.y+h-u,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case dt.SOUTH:for(let h=0;h<c;++h)Se(w.board,{x:n.destpt.x,y:n.destpt.y+h,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break}return 0}).command("change",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;De(w.book,w.board);const[n,r]=rt(e,0,[j.KIND,j.KIND]);(zl(n)??"")==="empty"&&bN(w.board).forEach(c=>{yi(w.book,w.board,r,c)});const s=zl(r),o=dd(r),a=Cy(r);return Ad(w.board,n).forEach(c=>{if(ci(c)===s)x(o)&&(c.color=o),x(a)&&(c.bg=a);else if(En(w.book,w.board,c,w.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};yi(w.book,w.board,r,l)}}),0}).command("put",(t,e)=>Vu(t,e)).command("putwith",(t,e)=>{const[n,r]=rt(e,0,[j.ANY]);return Vu(t,e.slice(r),void 0,n)}).command("oneof",(t,e)=>{const[n,r]=rt(e,0,[j.ANY]);return x(w.board)&&Sn(w.board,n)?0:Vu(t,e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=rt(e,0,[j.ANY,j.ANY]);return x(w.board)&&Sn(w.board,r)?0:Vu(t,e.slice(i),r,n)}).command("shoot",Px).command("shootwith",(t,e)=>{const[n,r]=rt(e,0,[j.ANY]);return Px(t,e.slice(r),n)}),bs="$dkpurple",jF="$196",zF="$205",sn="$yellow$205$205$205$196";function Oe(t,e,n){MA(t,e,n)}function KF(t,e,n){const r=jF.repeat(n);Oe(t,e,`${bs}${r}`)}function tp(t,e,n){const r=zF.repeat(n);Oe(t,e,`${bs}${r}`)}function ep(t,e,n){Oe(t,e,`${bs} ${" ".repeat(n.length)} `),KF(t,e,n.length+2),Oe(t,e,`${bs} $white${n} `),tp(t,e,n.length+2)}function oo(t,e,n){Oe(t,e,`${bs} ${" ".repeat(n.length)} `),Oe(t,e,`${bs} $gray${n} `),tp(t,e,n.length+2)}function Fc(t,e,n,r){Oe(t,e,`${bs} $white${n} $blue${r}`)}function Zn(t,e,n){Oe(t,e,`${bs}$blue${n}`)}function WF(t,e,n,r){Oe(t,e,`!${n};${r}`)}var HF=`desc;$DKGRAYname and type of codepage
`,GF=Object.freeze({__proto__:null,default:HF}),YF="desc;changes object into specified element",VF=Object.freeze({__proto__:null,default:YF}),ZF="desc;like #play but for sound effects",XF=Object.freeze({__proto__:null,default:ZF}),qF="",JF=Object.freeze({__proto__:null,default:qF}),QF="",tB=Object.freeze({__proto__:null,default:QF}),eB="",nB=Object.freeze({__proto__:null,default:eB}),rB="",iB=Object.freeze({__proto__:null,default:rB}),sB="",oB=Object.freeze({__proto__:null,default:sB}),aB="",cB=Object.freeze({__proto__:null,default:aB}),lB="",uB=Object.freeze({__proto__:null,default:lB}),hB="",fB=Object.freeze({__proto__:null,default:hB}),dB="",pB=Object.freeze({__proto__:null,default:dB}),mB="",gB=Object.freeze({__proto__:null,default:mB}),_B="",yB=Object.freeze({__proto__:null,default:_B}),bB="",wB=Object.freeze({__proto__:null,default:bB}),xB="",EB=Object.freeze({__proto__:null,default:xB}),vB="",kB=Object.freeze({__proto__:null,default:vB}),TB="",AB=Object.freeze({__proto__:null,default:TB}),RB=`desc;$DKGRAYstarts a section of an if-do-done block
`,SB=Object.freeze({__proto__:null,default:RB}),OB=`desc;$DKGRAYcompletes an if-do-done block
`,IB=Object.freeze({__proto__:null,default:OB}),NB="",CB=Object.freeze({__proto__:null,default:NB}),LB="",MB=Object.freeze({__proto__:null,default:LB}),UB="",FB=Object.freeze({__proto__:null,default:UB}),BB=`desc;$DKGRAYelse logic in an if-do-done block
`,PB=Object.freeze({__proto__:null,default:BB}),DB=`desc;$DKGRAYconditional else logic in an if-do-done block
`,$B=Object.freeze({__proto__:null,default:DB}),jB="",zB=Object.freeze({__proto__:null,default:jB}),KB="",WB=Object.freeze({__proto__:null,default:KB}),HB="",GB=Object.freeze({__proto__:null,default:HB}),YB="",VB=Object.freeze({__proto__:null,default:YB}),ZB="",XB=Object.freeze({__proto__:null,default:ZB}),qB="",JB=Object.freeze({__proto__:null,default:qB}),QB="",tP=Object.freeze({__proto__:null,default:QB}),eP="",nP=Object.freeze({__proto__:null,default:eP}),rP=`desc;$DKGRAYhalt until the next cycle
`,iP=Object.freeze({__proto__:null,default:rP}),sP=`desc;$DKGRAYevals condition for true or false
`,oP=Object.freeze({__proto__:null,default:sP}),aP="",cP=Object.freeze({__proto__:null,default:aP}),lP="",uP=Object.freeze({__proto__:null,default:lP}),hP="",fP=Object.freeze({__proto__:null,default:hP}),dP="",pP=Object.freeze({__proto__:null,default:dP}),mP="",gP=Object.freeze({__proto__:null,default:mP}),_P="",yP=Object.freeze({__proto__:null,default:_P}),bP="",wP=Object.freeze({__proto__:null,default:bP}),xP="",EP=Object.freeze({__proto__:null,default:xP}),vP="",kP=Object.freeze({__proto__:null,default:vP}),TP="",AP=Object.freeze({__proto__:null,default:TP}),RP="",SP=Object.freeze({__proto__:null,default:RP}),OP="",IP=Object.freeze({__proto__:null,default:OP}),NP="",CP=Object.freeze({__proto__:null,default:NP}),LP="",MP=Object.freeze({__proto__:null,default:LP}),UP="",FP=Object.freeze({__proto__:null,default:UP}),BP="",PP=Object.freeze({__proto__:null,default:BP}),DP="",$P=Object.freeze({__proto__:null,default:DP}),jP="",zP=Object.freeze({__proto__:null,default:jP}),KP="",WP=Object.freeze({__proto__:null,default:KP}),HP="",GP=Object.freeze({__proto__:null,default:HP}),YP="",VP=Object.freeze({__proto__:null,default:YP}),ZP=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,XP=Object.freeze({__proto__:null,default:ZP}),qP="",JP=Object.freeze({__proto__:null,default:qP}),QP="",tD=Object.freeze({__proto__:null,default:QP}),eD="",nD=Object.freeze({__proto__:null,default:eD}),rD="",iD=Object.freeze({__proto__:null,default:rD}),sD="",oD=Object.freeze({__proto__:null,default:sD}),aD="",cD=Object.freeze({__proto__:null,default:aD}),lD="",uD=Object.freeze({__proto__:null,default:lD}),hD="",fD=Object.freeze({__proto__:null,default:hD}),dD="",pD=Object.freeze({__proto__:null,default:dD}),mD="",gD=Object.freeze({__proto__:null,default:mD}),_D="",yD=Object.freeze({__proto__:null,default:_D}),bD="",wD=Object.freeze({__proto__:null,default:bD}),xD="",ED=Object.freeze({__proto__:null,default:xD}),vD="",kD=Object.freeze({__proto__:null,default:vD}),TD="",AD=Object.freeze({__proto__:null,default:TD}),RD="",SD=Object.freeze({__proto__:null,default:RD}),OD="",ID=Object.freeze({__proto__:null,default:OD}),ND="",CD=Object.freeze({__proto__:null,default:ND}),LD="",MD=Object.freeze({__proto__:null,default:LD}),UD=`desc;$DKGRAYdesignates an inactive label or comment
`,FD=Object.freeze({__proto__:null,default:UD}),BD=`desc;$DKGRAYadds hyperlink text

`,PD=Object.freeze({__proto__:null,default:BD}),DD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,$D=Object.freeze({__proto__:null,default:DD}),jD=`desc;$DKGRAYread number input into given stat/flag
`,zD=Object.freeze({__proto__:null,default:jD}),KD=`desc;$DKGRAYa slider input from 1 to 9 

`,WD=Object.freeze({__proto__:null,default:KD}),HD=`desc;$DKGRAYlist with label value pairs to pick from
`,GD=Object.freeze({__proto__:null,default:HD}),YD=`desc;$DKGRAYread text input into given stat/flag
`,VD=Object.freeze({__proto__:null,default:YD}),ZD=`desc;$DKGRAYdesignates a starting point for running code
`,XD=Object.freeze({__proto__:null,default:ZD}),qD=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,JD=Object.freeze({__proto__:null,default:qD}),QD=`desc;$DKGRAYwill move the object in the given direction
`,t$=Object.freeze({__proto__:null,default:QD}),e$=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,n$=Object.freeze({__proto__:null,default:e$}),r$=`desc;$DKGRAYcustom 8x14 charset
`,i$=Object.freeze({__proto__:null,default:r$}),s$=`desc;$DKGRAYsets stat to given value

`,o$=Object.freeze({__proto__:null,default:s$}),a$=`desc;$DKGRAYsends the given message when hotkey is pressed

`,c$=Object.freeze({__proto__:null,default:a$}),l$=`desc;$DKGRAYread external content and/or handle events
`,u$=Object.freeze({__proto__:null,default:l$}),h$=`desc;$DKGRAYread number input into given stat/flag
`,f$=Object.freeze({__proto__:null,default:h$}),d$=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,p$=Object.freeze({__proto__:null,default:d$}),m$=`desc;$DKGRAYcustom palette colors
`,g$=Object.freeze({__proto__:null,default:m$}),_$=`desc;$DKGRAYa slider input from 1 to 9 

`,y$=Object.freeze({__proto__:null,default:_$}),b$=`desc;$DKGRAYlist with label value pairs to pick from
`,w$=Object.freeze({__proto__:null,default:b$}),x$=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,E$=Object.freeze({__proto__:null,default:x$}),v$=`desc;$DKGRAYread text input into given stat/flag
`,k$=Object.freeze({__proto__:null,default:v$}),T$=`desc;$DKGRAYadds text
`,A$=Object.freeze({__proto__:null,default:T$}),R$=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,S$=Object.freeze({__proto__:null,default:R$}),O$=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,I$=Object.freeze({__proto__:null,default:O$}),N$=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,C$=Object.freeze({__proto__:null,default:N$}),L$=`header;player settings
#set user "name goes here"
`,M$=Object.freeze({__proto__:null,default:L$}),U$=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,F$=Object.freeze({__proto__:null,default:U$});const $x=Object.assign({"./editor/codepagename.txt":GF,"./editor/command/become.txt":VF,"./editor/command/bgplay.txt":XF,"./editor/command/bgvol.txt":JF,"./editor/command/bind.txt":tB,"./editor/command/board.txt":nB,"./editor/command/bpm.txt":iB,"./editor/command/break.txt":oB,"./editor/command/change.txt":cB,"./editor/command/char.txt":uB,"./editor/command/charset.txt":fB,"./editor/command/clear.txt":pB,"./editor/command/color.txt":gB,"./editor/command/continue.txt":yB,"./editor/command/copy.txt":wB,"./editor/command/cycle.txt":EB,"./editor/command/die.txt":kB,"./editor/command/distort.txt":AB,"./editor/command/do.txt":SB,"./editor/command/done.txt":IB,"./editor/command/duplicate.txt":CB,"./editor/command/echo.txt":MB,"./editor/command/edge.txt":FB,"./editor/command/else.txt":PB,"./editor/command/elseif.txt":$B,"./editor/command/end.txt":zB,"./editor/command/endgame.txt":WB,"./editor/command/endwith.txt":GB,"./editor/command/fcrush.txt":VB,"./editor/command/fetch.txt":XB,"./editor/command/fetchwith.txt":JB,"./editor/command/foreach.txt":tP,"./editor/command/go.txt":nP,"./editor/command/idle.txt":iP,"./editor/command/if.txt":oP,"./editor/command/lock.txt":cP,"./editor/command/oneof.txt":uP,"./editor/command/oneofwith.txt":fP,"./editor/command/palette.txt":pP,"./editor/command/phaser.txt":gP,"./editor/command/pivot.txt":yP,"./editor/command/play.txt":wP,"./editor/command/put.txt":EP,"./editor/command/putwith.txt":kP,"./editor/command/readbin.txt":AP,"./editor/command/readjson.txt":SP,"./editor/command/readline.txt":IP,"./editor/command/readrexpaint.txt":CP,"./editor/command/remix.txt":MP,"./editor/command/repeat.txt":FP,"./editor/command/restore.txt":PP,"./editor/command/reverb.txt":$P,"./editor/command/revert.txt":zP,"./editor/command/run.txt":WP,"./editor/command/runwith.txt":GP,"./editor/command/set.txt":VP,"./editor/command/shoot.txt":XP,"./editor/command/shootwith.txt":JP,"./editor/command/shove.txt":tD,"./editor/command/snapshot.txt":nD,"./editor/command/synth.txt":iD,"./editor/command/toast.txt":oD,"./editor/command/tts.txt":cD,"./editor/command/ttsvol.txt":uD,"./editor/command/twitchbroadcast.txt":fD,"./editor/command/twitchchat.txt":pD,"./editor/command/unlock.txt":gD,"./editor/command/vibrato.txt":yD,"./editor/command/vol.txt":wD,"./editor/command/waitfor.txt":ED,"./editor/command/walk.txt":kD,"./editor/command/weave.txt":AD,"./editor/command/while.txt":SD,"./editor/command/with.txt":ID,"./editor/command/write.txt":CD,"./editor/command/zap.txt":MD,"./editor/comment.txt":FD,"./editor/hyperlink.txt":PD,"./editor/hyperlink/hotkey.txt":$D,"./editor/hyperlink/number.txt":zD,"./editor/hyperlink/range.txt":WD,"./editor/hyperlink/select.txt":GD,"./editor/hyperlink/text.txt":VD,"./editor/label.txt":XD,"./editor/shortgo.txt":JD,"./editor/shorttry.txt":t$,"./editor/stat/board.txt":n$,"./editor/stat/charset.txt":i$,"./editor/stat/const.txt":o$,"./editor/stat/hotkey.txt":c$,"./editor/stat/loader.txt":u$,"./editor/stat/number.txt":f$,"./editor/stat/object.txt":p$,"./editor/stat/palette.txt":g$,"./editor/stat/range.txt":y$,"./editor/stat/select.txt":w$,"./editor/stat/terrain.txt":E$,"./editor/stat/text.txt":k$,"./editor/text.txt":A$,"./help/controls.txt":S$,"./help/developer.txt":I$,"./help/menu.txt":C$,"./help/player.txt":M$,"./help/text.txt":F$}),jx={};pr($x).forEach(t=>{const e=t.replace(".txt","").replace("./","").replaceAll("/",":");jx[e]=$x[t].default});function B$(t){const e=It(t.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=jx[e];if(x(n))return n;const{target:r,path:i}=er(e);switch(r){case"editor":{const s=er(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function P$(t,e){const n=(t??"").split(`
`);for(let r=0;r<n.length;++r)e(n[r].split(";"))}function D$(t,e){const[n,...r]=e,i=r[0]??"",s=r[1]??"";switch(It(n.trim())){case"header":ep(tt,t,i);break;case"section":oo(tt,t,i);break;case"option":Fc(tt,t,i,s);break;default:n.trimStart().startsWith("!")?WF(tt,t,n.trimStart().slice(1),i):Oe(tt,t,n);break}}function Hi(t){const[e,n]=rt(t,0,[j.NAME,j.ANY]);if(It(e)==="send"&&Br(n)){const[,r,i,s]=rt(t,0,[j.NAME,j.DIR,j.MAYBE_NAME]);return gt(i)&&i.startsWith(":")?{targetdir:r,label:[i.substring(1).trim(),...t.slice(s)].join(" ")}:{targetdir:r,label:t.slice(s-1).join(" ")}}else if(gt(e)){const[r,i,s]=rt(t,0,[j.NAME,j.MAYBE_NAME]);return gt(i)&&i.startsWith(":")?{targetname:r,label:[i.substring(1).trim(),...t.slice(s)].join(" ")}:{targetname:"self",label:[r,...t.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function sa(){dg(tt,dr())}function Bc(t){P$(B$(`help:${t}`),e=>D$(w.elementfocus,e))}function zx(t){switch(t.label){case"helpmenu":Bc("menu");break;case"helpcontrols":Bc("controls");break;case"helptext":Bc("text");break;case"helpdeveloper":Bc("developer");break;case"helpplayer":Bc("player");break;default:{const e=oe(Lt.MAIN),n=ia(e);x(t.targetname)?da(t.targetname,t.label,void 0,n):x(t.targetdir)&&da(t.targetdir.destpt,t.label,void 0,n);break}}}const $$=Wi().command("shortsend",(t,e)=>{const n=Hi(e);return zx(n),0}).command("send",(t,e)=>{const n=Hi(["send",...e]);return zx(n),0}).command("stat",(t,e)=>{const[n,...r]=e.map(Ue),i=r.join(" ");function s(o,a){if(x(o)&&(t.command("pageopen",o.id),a)){const c=Ge(o),l=ji(o);Oe(tt,w.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(It(n)){case ur(vt.LOADER):{const[o,a]=ks(Lt.CONTENT,i,_t.LOADER);s(o,a);break}default:{const[o,a]=ks(Lt.CONTENT,[n,...r].join(" "),_t.OBJECT);s(o,a);break}case ur(vt.BOARD):{const[o,a]=ks(Lt.CONTENT,i,_t.BOARD);s(o,a);break}case ur(vt.OBJECT):{const[o,a]=ks(Lt.CONTENT,i,_t.OBJECT);s(o,a);break}case ur(vt.TERRAIN):{const[o,a]=ks(Lt.CONTENT,i,_t.TERRAIN);s(o,a);break}case ur(vt.CHARSET):{const[o,a]=ks(Lt.CONTENT,i,_t.CHARSET);s(o,a);break}case ur(vt.PALETTE):{const[o,a]=ks(Lt.CONTENT,i,_t.PALETTE);s(o,a);break}}return 0}).command("text",(t,e)=>{const n=e.map(Ue).join(" ");if(x(w.element)&&w.elementisplayer){const{user:r}=Or(w.elementid),i=gt(r)?r:"player";w.element.tickertext=`${i}: ${n}`,w.element.tickertime=w.timestamp;const s=na(w.book,w.element,1,At.WHITE,At.BLACK);pe(tt,w.elementid,`$${At[s.color]}$ON${At[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),Pa(tt,w.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Ue(n),s=Hi(r);if(x(s.targetname)){const{user:o}=Or(w.elementid),a=gt(o)?o:"player",c=na(w.book,w.element,1,At.WHITE,At.BLACK),l=`$${At[c.color]}$ON${At[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;pe(tt,w.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(t,e)=>{const[n,r]=rt(e,0,[j.MAYBE_NAME,j.MAYBE_STRING]);return gt(n)&&gt(r)?fR(tt,w.elementfocus,n,r):dR(tt,w.elementfocus),0}).command("bookcreate",(t,e)=>{const[n]=rt(e,0,[j.MAYBE_NAME]),r=LE(n);return x(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=rt(e,0,[j.NAME]),r=Hr(n);return x(r)?(pe(tt,w.elementfocus,`opened [book] ${r.name}`),hh(Lt.MAIN,r.id),t.command("pages")):de(tt,w.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(t,e)=>{const[n]=rt(e,0,[j.NAME]),r=oe(Lt.MAIN),i=Hr(n);return x(i)&&(r===i&&hh(Lt.MAIN,""),D4(n),pe(tt,w.elementfocus,`trashed [book] ${i.name}`),sa(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[n]=rt(e,0,[j.NAME]),r=Yn(w.book,_t.BOARD,n);if(r.length){const i=Ae(...r);x(i)&&ra(w.book,w.elementfocus,i.id,{x:wr(0,Tt-1),y:wr(0,Ht-1)})}return 0}).command("pageopen",(t,e)=>{const[n,r]=rt(e,0,[j.NAME,j.MAYBE_NAME]),i=fn(Lt.MAIN);if(!x(i))return 0;const s=zi(i,n);if(x(s)){const o=Ge(s),a=ji(s);pe(tt,w.elementfocus,`opened [${a}] ${o}`);const c=[s.id,r];id(cl(i.id,c),s.code);const l=ji(s);hg(tt,w.elementfocus,i.id,c,l,`${o} - ${i.name}`)}else de(tt,"pageopen",`page ${n} not found`,w.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[n]=rt(e,0,[j.NAME]),r=fn(Lt.MAIN),i=bx(r,n);if(x(n)){const s=Ge(i),o=ji(i);pe(tt,w.elementfocus,`trashed [${o}] ${s}`),sa(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(Ue).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{oo(tt,w.elementfocus,"books");const t=oe(Lt.MAIN);Fc(tt,w.elementfocus,"main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=oe(Lt.CONTENT);Fc(tt,w.elementfocus,"content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),tp(tt,w.elementfocus,7);const n=lo();return n.length?n.forEach(r=>{Oe(tt,w.elementfocus,`!bookopen ${r.id};${r.name}`)}):Zn(tt,w.elementfocus,"no books found"),Oe(tt,w.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=fn(Lt.MAIN);return x(t)&&(oo(tt,w.elementfocus,"pages"),Fc(tt,w.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?j0(t).forEach(n=>{const r=Ge(n),i=ji(n);Oe(tt,w.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(Oe(tt,w.elementfocus,""),Zn(tt,w.elementfocus,"$white no pages found"),Zn(tt,w.elementfocus,"$white use @ to create a page"),Zn(tt,w.elementfocus,"$white @board name of board"),Zn(tt,w.elementfocus,"$white @object name of object"),Zn(tt,w.elementfocus,"$white @terrain name of terrain"),Zn(tt,w.elementfocus,"$white You can omit the type and it will default to object"),Zn(tt,w.elementfocus,"$white @object name of object"),Zn(tt,w.elementfocus,"$white @name of object"))),0}).command("boards",()=>{oo(tt,w.elementfocus,"boards");const t=fn(Lt.MAIN);if(x(t)){Fc(tt,w.elementfocus,"main",`${t.name} $GREEN${t.id}`);const e=j0(t);e.filter(n=>$i(n)===_t.BOARD).forEach(n=>{const r=Ge(n),i=ji(n);Oe(tt,w.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),e.length===0&&(Oe(tt,w.elementfocus,""),Zn(tt,w.elementfocus,"$white no boards found"),Zn(tt,w.elementfocus,"$white use @ to create a board"),Zn(tt,w.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{oo(tt,w.elementfocus,"$REDTRASH"),Zn(tt,w.elementfocus,"books");const t=lo();t.length&&(t.forEach(n=>{Oe(tt,w.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Oe(tt,w.elementfocus,""));const e=oe(Lt.MAIN);return x(e)&&(Zn(tt,w.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=Ge(n);Oe(tt,w.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Oe(tt,w.elementfocus,"")),0}).command("dev",()=>(sa(),eR(tt,w.elementfocus),0)).command("share",()=>(sa(),nR(tt,w.elementfocus),0)).command("save",()=>(sa(),0)).command("fork",()=>(yR(tt,w.elementfocus),0)).command("itchiopublish",()=>(bR(tt,w.elementfocus),0)).command("nuke",()=>(rR(tt,w.elementfocus),0)).command("restart",()=>(_R(tt,w.elementfocus),sa(),0)).command("export",()=>{ep(tt,w.elementfocus,"E X P O R T"),oo(tt,w.elementfocus,"books");const t=lo();return t.length&&t.forEach(e=>Oe(tt,w.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[n]=rt(e,0,[j.NAME]),r=Hr(n);return x(r)&&(ep(tt,w.elementfocus,"E X P O R T"),oo(tt,w.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=j0(r);Oe(tt,w.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Ge(s),a=ji(s);Oe(tt,w.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[n]=rt(e,0,[j.NAME]),r=Hr(n);return x(r)&&lg(tt,w.elementfocus,tr(r),`${r.name}.book.json`),0}).command("pageexport",(t,e)=>{const[n]=rt(e,0,[j.NAME]),{target:r,path:i}=er(n),s=Hr(r),o=zi(s,i);return x(o)&&lg(tt,w.elementfocus,tr(o),`${Ge(o)}.${ji(o)}.json`),0}).command("gadget",()=>(pR(tt,w.elementfocus),0)).command("joincode",(t,e)=>{const[n]=rt(e,0,[j.MAYBE_NAME]);return HA(tt,w.elementfocus,!!n),0}).command("jointab",(t,e)=>{const[n]=rt(e,0,[j.MAYBE_NAME]);return GA(tt,w.elementfocus,!!n),0}).command("startlookingglass",()=>(iR(tt,w.elementfocus),0)),j$=Wi().command("toast",(t,e)=>{const n=e.map(Ue).join("");return UA(tt,w.elementfocus,n),0}).command("palette",(t,e)=>{const[n]=rt(e,0,[j.NAME]),r=UE(),i=Ye(w.book,_t.PALETTE,n);return x(i)?(r.palette=i.id,pe(tt,w.elementfocus,`loaded palette ${n}`)):de(tt,w.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(t,e)=>{const[n]=rt(e,0,[j.NAME]),r=UE(),i=Ye(w.book,_t.CHARSET,n);return x(i)?(r.charset=i.id,pe(tt,w.elementfocus,`loaded charset ${n}`)):de(tt,w.elementfocus,"not-found",`unabled to find charset ${n}`),0}),np={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Pc(t){return ue(t)&&Kx(t[0])}function Kx(t){return x(Pn[t])&&gt(t)}function Wx(t){if(gt(t))return np[It(t)]}function Hx(t){if(Pc(t))return t;if(Kx(t))return[t];const e=Wx(t);if(x(e))return[e]}function z$(t){const e=w.words[t],n=Hx(e);if(Pc(n))return[n,t+1];const[r,i]=qn(t),s=Hx(r);return Pc(s)?[s,i]:[void 0,t]}const rp={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Ut.ISSOLID,Ut.ISWALK,Ut.ISSWIM,Ut.ISBULLET,Ut.ISWALK,Ut.ISSWIM;function Zu(t){return ue(t)&&ip(t[0])}function ip(t){return x(Ut[t])&&gt(t)}function K$(t){if(gt(t))return rp[It(t)]}function W$(t){const e=w.words[t];if(Zu(e))return[e,t+1];if(ip(e))return[[e],t+1];const[n,r]=qn(t);return Zu(n)?[n,r]:ip(n)?[[n],r]:[void 0,t]}const H$=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Gx=new Set(["char","color","bg","group","party","player","pushable","collision","breakable","p1","p2","p3","cycle","stepx","stepy","light","lightdir","sender","arg"]),G$=["NORTH","SOUTH","WEST","EAST"];function Y$(t){const e=Or(t);if(kt(e.inputcurrent)||(e.inputcurrent=0),ue(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=On.NONE,i=0]=n??[On.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&SN?1:0,e.inputctrl=i&ON?1:0,e.inputshift=i&IN?1:0,r){case On.MOVE_UP:case On.MOVE_DOWN:case On.MOVE_LEFT:case On.MOVE_RIGHT:e.inputmove=[G$[r-On.MOVE_UP]];break;case On.OK_BUTTON:e.inputok=1;break;case On.CANCEL_BUTTON:e.inputcancel=1;break;case On.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==On.NONE&&o!==r}),e}function V$(t){const e=np[t];if(x(e))return e;const n=rp[t];if(x(n))return n;const r=ec[t];if(x(r))return r;const i=ud[t];if(x(i))return i}const Z$=Wi({get(t,e){var o,a,c,l,u,f,d,h,p,m,b,_,v,T,A,C,R,S,U,I,P;const n=V$(e);if(x(n))return[!0,n];if(w.elementisplayer&&H$.has(e)){const W=Y$(w.elementid)[e];return[x(W),W]}const r=cc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus??dr();switch(e){case"camera":case"graphics":case"facing":if(x((c=w.board)==null?void 0:c[e]))return[!0,(l=w.board)==null?void 0:l[e]];break;case"isdark":return[!0,(u=w.board)!=null&&u.isdark?1:0];case"startx":return[!0,((f=w.board)==null?void 0:f.startx)??0];case"starty":return[!0,((d=w.board)==null?void 0:d.starty)??0];case"over":return[!0,((h=w.board)==null?void 0:h.over)??""];case"under":return[!0,((p=w.board)==null?void 0:p.under)??""];case"exitnorth":return[!0,((m=w.board)==null?void 0:m.exitnorth)??""];case"exitsouth":return[!0,((b=w.board)==null?void 0:b.exitsouth)??""];case"exitwest":return[!0,((_=w.board)==null?void 0:_.exitwest)??""];case"exiteast":return[!0,((v=w.board)==null?void 0:v.exiteast)??""];case"timelimit":return[!0,((T=w.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((A=w.board)==null?void 0:A.restartonzap)??0];case"maxplayershots":return[!0,((C=w.board)==null?void 0:C.maxplayershots)??0];case"boardid":return[!0,((R=w.board)==null?void 0:R.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((S=w.element)==null?void 0:S.id)??""];case"thisx":return[!0,((U=w.element)==null?void 0:U.x)??-1];case"thisy":return[!0,((I=w.element)==null?void 0:I.y)??-1];default:{const W=(P=w.element)==null?void 0:P[e];if(Gx.has(e))return[!0,W];break}}const s=Or(i)[e];return[x(s),s]},set(t,e,n){var o,a;const r=cc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus;switch(e){case"camera":case"graphics":case"facing":break;case"isdark":if(x(w.board))return w.board.isdark=n?1:0,[!0,w.board.isdark];break;case"startx":if(x(w.board))return w.board.startx=Uc(n,0),[!0,w.board.startx];break;case"starty":if(x(w.board))return w.board.starty=Uc(n,0),[!0,w.board.starty];break;case"over":if(x(w.board))return w.board.over=Ue(n),[!0,w.board.over];break;case"under":if(x(w.board))return[!0,w.board.under=Ue(n)];break;case"exitnorth":if(x(w.board))return[!0,w.board.exitnorth=Ue(n)];break;case"exitsouth":if(x(w.board))return[!0,w.board.exitsouth=Ue(n)];break;case"exitwest":if(x(w.board))return[!0,w.board.exitwest=Ue(n)];break;case"exiteast":if(x(w.board))return[!0,w.board.exiteast=Ue(n)];break;case"timelimit":if(x(w.board))return[!0,w.board.timelimit=Uc(n,0)];break;case"restartonzap":if(x(w.board))return[!0,w.board.restartonzap=n?1:0];break;case"maxplayershots":if(x(w.board))return[!0,w.board.maxplayershots=Uc(n,0)];break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(Gx.has(e))return x(w.element)&&(w.element[e]=n),[!0,n];break}}const s=Or(i);return x(s)?(s[e]=n,[!0,n]):[!1,n]},everytick(){var t,e,n,r,i;if(!((t=w.element)!=null&&t.removed)&&(x((e=w.element)==null?void 0:e.stepx)||x((n=w.element)==null?void 0:n.stepy))){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};Ts(w.book,w.board,w.element,{x:s.x+(w.element.stepx??0),y:s.y+(w.element.stepy??0)})===!1&&(w.element.stepx=0,w.element.stepy=0,ie(w.book,w.element,"breakable")&&En(w.book,w.board,w.element,w.timestamp))}}}).command("clear",(t,e)=>{for(let n=0;n<e.length;++n)t.set(Ue(e[n]),0);return 0}).command("set",(t,e)=>{const[n,r]=rt(e,0,[j.NAME,j.ANY]);return t.set(n,r??1),0}).command("become",(t,e)=>{var r,i;const[n]=rt(e,0,[j.KIND]);if(De(w.book,w.board),z0(w.book,w.board,w.element),En(w.book,w.board,w.element,w.timestamp)){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};yi(w.book,w.board,n,s)}return t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=rt(e,0,[j.ANY]);if(Br(n)){const[r,i]=rt(e,0,[j.DIR,j.NUMBER]),s=Jt(w.board,r.destpt);x(s)&&(s.char=i)}else x(w.element)&&kt(n)&&(w.element.char=n);return 0}).command("color",(t,e)=>{const[n]=rt(e,0,[j.ANY]);if(Br(n)){const[r,i]=rt(e,0,[j.DIR,j.COLOR]),s=Jt(w.board,r.destpt);x(s)&&oc(w.element,i)}else{const[r]=rt(e,0,[j.COLOR]);x(w.element)&&x(r)&&oc(w.element,r)}return 0}).command("go",(t,e)=>{if(x(w.element)){const[n]=rt(e,0,[j.DIR]);if(Ts(w.book,w.board,w.element,n.destpt),t.yield(),w.element.x===n.destpt.x&&w.element.y===n.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!x(w.element))return 0;const[n]=rt(e,0,[j.DIR]),r=w.element.x??0,i=w.element.y??0;return w.element.stepx=n.destpt.x-r,w.element.stepy=n.destpt.y-i,0}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=rt(e,0,[j.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(Ue(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(Ue(e[0])),0)).command("cycle",(t,e)=>{if(x(w.element)){const[n]=rt(e,0,[j.NUMBER]);w.element.cycle=tn(Math.round(n),1,255)}return 0}).command("die",t=>(En(w.book,w.board,w.element,w.timestamp),t.endofprogram(),0)).command("endgame",()=>(fg(tt,w.elementfocus),0)).command("run",(t,e)=>{const[n]=rt(e,0,[j.NAME]);return fh(n),0}).command("runwith",(t,e)=>{const[n,r]=rt(e,0,[j.ANY,j.NAME]);return t.set("arg",n),fh(r),0}),Xu={};function X$(t){var e;return(e=Xu[t])==null?void 0:e.arg}function q$(t){var e;return(e=Xu[t])==null?void 0:e.format}function ws(t){var e;return(e=Xu[t])==null?void 0:e.content}function J$(t,e,n,r,i){const s=oe(Lt.MAIN);if(!x(s))return;const o=ro(s,_t.LOADER).filter(a=>{const c=no(a),l=c.format,u=gt(l)?new RegExp(l).test(e):!1,f=c.event,d=gt(f)?new RegExp(f).test(n):!1;return gt(l)&&gt(f)?u&&d:gt(l)?u:gt(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${ze()}_loader`;Xu[c]={arg:t,format:e,content:r,player:i},W4(c,o[a].code)}}function Yx(t,e){if(!x(t))return;const n=It(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const Q$=(t,e)=>{const n=ws(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[j.NAME]),s=It(r);switch(s){case"seek":{const[o]=rt(e,i,[j.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(e,i,[j.NAME]);t.set(o,Yx(n,s));break}case"text":{const[o,a]=rt(e,i,[j.NAME,j.NAME]),c=Yx(n,o);if(kt(c)&&gt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);t.set(a,f),n.cursor+=c}break}case"palette":{const[o]=rt(e,i,[j.NAME]),[a]=$0(w.book,_t.PALETTE,o),c=Ee(a);if(x(c)){const l=xN*uc,u=Sd(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=rt(e,i,[j.NAME]),[a]=$0(w.book,_t.CHARSET,o),c=Ee(a);if(x(c)){const l=Ql*wN*Rd,u=ub(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},oa=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",qu=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!qu(t[n],e[n]))return!1;return!0}if(oa(t)&&oa(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!qu(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},Ju=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(oa(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},t5=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",Vx=t=>t>="0"&&t<="9"||t==="-",e5=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var X;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(X||(X={}));const Zx={"(":X.TOK_LPAREN,")":X.TOK_RPAREN,"*":X.TOK_STAR,",":X.TOK_COMMA,".":X.TOK_DOT,":":X.TOK_COLON,"@":X.TOK_CURRENT,$:X.TOK_ROOT,"]":X.TOK_RBRACKET,"{":X.TOK_LBRACE,"}":X.TOK_RBRACE},n5={"!":!0,"<":!0,"=":!0,">":!0},r5={"	":!0,"\n":!0,"\r":!0," ":!0};class i5{constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(t5(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:X.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Zx[e[this._current]]!==void 0)n.push({start:this._current,type:Zx[e[this._current]],value:e[this._current]}),this._current+=1;else if(Vx(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:X.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:X.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);n.push({start:r,type:X.TOK_LITERAL,value:o})}else if(n5[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if(r5[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:X.TOK_AND,value:"&&"})):n.push({start:r,type:X.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:X.TOK_OR,value:"||"})):n.push({start:r,type:X.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&e5(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;Vx(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:X.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:X.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:X.TOK_FLATTEN,value:"[]"}):{start:n,type:X.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_NE,value:"!="}):{start:n,type:X.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_LTE,value:"<="}):{start:n,type:X.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_GTE,value:">="}):{start:n,type:X.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:X.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n='[{"',r=["true","false","null"],i="-0123456789";if(e==="")return!1;if(n.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const s5=new i5,vn={[X.TOK_EOF]:0,[X.TOK_UNQUOTEDIDENTIFIER]:0,[X.TOK_QUOTEDIDENTIFIER]:0,[X.TOK_RBRACKET]:0,[X.TOK_RPAREN]:0,[X.TOK_COMMA]:0,[X.TOK_RBRACE]:0,[X.TOK_NUMBER]:0,[X.TOK_CURRENT]:0,[X.TOK_EXPREF]:0,[X.TOK_ROOT]:0,[X.TOK_PIPE]:1,[X.TOK_OR]:2,[X.TOK_AND]:3,[X.TOK_EQ]:5,[X.TOK_GT]:5,[X.TOK_LT]:5,[X.TOK_GTE]:5,[X.TOK_LTE]:5,[X.TOK_NE]:5,[X.TOK_FLATTEN]:9,[X.TOK_STAR]:20,[X.TOK_FILTER]:21,[X.TOK_DOT]:40,[X.TOK_NOT]:45,[X.TOK_LBRACE]:50,[X.TOK_LBRACKET]:55,[X.TOK_LPAREN]:60};class o5{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==X.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...s5.tokenize(e),{type:X.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<vn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case X.TOK_LITERAL:return{type:"Literal",value:e.value};case X.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case X.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===X.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case X.TOK_NOT:return r=this.expression(vn.Not),{type:"NotExpression",children:[r]};case X.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===X.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(vn.Star),{type:"ValueProjection",children:[n,r]};case X.TOK_FILTER:return this.led(e.type,{type:"Identity"});case X.TOK_LBRACE:return this.parseMultiselectHash();case X.TOK_FLATTEN:return n={type:X.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(vn.Flatten),{type:"Projection",children:[n,r]};case X.TOK_LBRACKET:return this.lookahead(0)===X.TOK_NUMBER||this.lookahead(0)===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===X.TOK_STAR&&this.lookahead(1)===X.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(vn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case X.TOK_CURRENT:return{type:X.TOK_CURRENT};case X.TOK_ROOT:return{type:X.TOK_ROOT};case X.TOK_EXPREF:return i=this.expression(vn.Expref),{type:"ExpressionReference",children:[i]};case X.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(i={type:X.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(X.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case X.TOK_DOT:const i=vn.Dot;return this.lookahead(0)!==X.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case X.TOK_PIPE:return r=this.expression(vn.Pipe),{type:X.TOK_PIPE,children:[n,r]};case X.TOK_OR:return r=this.expression(vn.Or),{type:"OrExpression",children:[n,r]};case X.TOK_AND:return r=this.expression(vn.And),{type:"AndExpression",children:[n,r]};case X.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(a={type:X.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===X.TOK_COMMA&&this.match(X.TOK_COMMA),o.push(a);return this.match(X.TOK_RPAREN),{name:s,type:"Function",children:o};case X.TOK_FILTER:const l=this.expression(0);return this.match(X.TOK_RBRACKET),r=this.lookahead(0)===X.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(vn.Filter),{type:"FilterProjection",children:[n,r,l]};case X.TOK_FLATTEN:const u={type:X.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(vn.Flatten);return{type:"Projection",children:[u,f]};case X.TOK_EQ:case X.TOK_NE:case X.TOK_GT:case X.TOK_GTE:case X.TOK_LT:case X.TOK_LTE:return this.parseComparator(n,e);case X.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===X.TOK_NUMBER||d.type===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(X.TOK_STAR),this.match(X.TOK_RBRACKET),r=this.parseProjectionRHS(vn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===X.TOK_COLON||this.lookahead(1)===X.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(X.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(vn.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==X.TOK_RBRACKET&&n<3;){if(r===X.TOK_COLON)n+=1,this.advance();else if(r===X.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(X.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression(vn[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER,X.TOK_STAR].includes(n))return this.expression(e);if(n===X.TOK_LBRACKET)return this.match(X.TOK_LBRACKET),this.parseMultiselectList();if(n===X.TOK_LBRACE)return this.match(X.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(vn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===X.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===X.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===X.TOK_DOT)return this.match(X.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==X.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===X.TOK_COMMA&&(this.match(X.TOK_COMMA),this.lookahead(0)===X.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(X.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(X.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===X.TOK_COMMA)this.match(X.TOK_COMMA);else if(this.lookahead(0)===X.TOK_RBRACE){this.match(X.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const a5=new o5;var ut;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class c5{constructor(e){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>oa(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(m=>{var b;return(b=!m.optional)!==null&&b!==void 0?b:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,p;for(let m=0;m<r.length;m+=1){p=!1,d=r[m].types,h=this.getTypeName(n[m]);let b;for(b=0;b<d.length;b+=1)if(h!==void 0&&this.typeMatches(h,d[b],n[m])){p=!0;break}if(!p&&h!==void 0){const _=d.map(v=>this.TYPE_NAME_TABLE[v]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${m+1} to be type (${_}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(e,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return e===ut.TYPE_ARRAY;if(e===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return e.jmespathType===X.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class l5{constructor(){this._rootValue=null,this.runtime=new c5(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,o,a,c,l,u,f,d,h;switch(e.type){case"Field":return n===null?null:oa(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),d=1;d<e.children.length;d+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=e.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...e.children],b=this.computeSliceParams(n.length,m),[_,v,T]=b;if(s=[],T>0)for(d=_;d<v;d+=T)s.push(n[d]);else for(d=_;d>v;d+=T)s.push(n[d]);return s;case"Projection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(e.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(e.children[0],n),!oa(h))return null;f=[];const A=Object.values(h);for(d=0;d<A.length;d+=1)i=this.visit(e.children[1],A[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;const C=[],R=[];for(d=0;d<h.length;d+=1)r=this.visit(e.children[2],h[d]),Ju(r)||C.push(h[d]);for(let L=0;L<C.length;L+=1)i=this.visit(e.children[1],C[L]),i!==null&&R.push(i);return R;case"Comparator":switch(o=this.visit(e.children[0],n),a=this.visit(e.children[1],n),e.name){case X.TOK_EQ:s=qu(o,a);break;case X.TOK_NE:s=!qu(o,a);break;case X.TOK_GT:s=o>a;break;case X.TOK_GTE:s=o>=a;break;case X.TOK_LT:s=o<a;break;case X.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case X.TOK_FLATTEN:const S=this.visit(e.children[0],n);if(!Array.isArray(S))return null;let U=[];for(d=0;d<S.length;d+=1)i=S[d],Array.isArray(i)?U=[...U,...i]:U.push(i);return U;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<e.children.length;d+=1)f.push(this.visit(e.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let I;for(d=0;d<e.children.length;d+=1)I=e.children[d],f[I.name]=this.visit(I.value,n);return f;case"OrExpression":return r=this.visit(e.children[0],n),Ju(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return o=this.visit(e.children[0],n),Ju(o)?o:this.visit(e.children[1],n);case"NotExpression":return o=this.visit(e.children[0],n),Ju(o);case"Literal":return e.value;case X.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case X.TOK_CURRENT:return n;case X.TOK_ROOT:return this._rootValue;case"Function":const P=[];for(let L=0;L<e.children.length;L+=1)P.push(this.visit(e.children[L],n));return this.runtime.callFunction(e.name,P);case"ExpressionReference":const W=e.children[0];return W.jmespathType=X.TOK_EXPREF,W;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const u5=new l5;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function h5(t,e){const n=a5.parse(e);return u5.search(n,t)}const f5=(t,e)=>{const n=ws(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[j.NAME,j.NAME]),s=h5(n.json,r);return t.set(i,s),0};function d5(t,e){return Math.sqrt(Math.pow(t.r-e.r,2)+Math.pow(t.g-e.g,2)+Math.pow(t.b-e.b,2))}const Qu=Sd(hb);function Xx(t){let e;if(!x(Qu))return e;let n=1e9;for(let r=0;r<=At.BLACK;++r){const i=r*uc,s=Qu.bits[i],o=Qu.bits[i+1],a=Qu.bits[i+2],c=d5(t,{r:s,g:o,b:a,hex:""});c<n&&(e=r,n=c)}return e}const p5=(t,e)=>{var a,c,l,u;const n=ws(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[j.NAME]),s=It(r),o=((a=n.content)==null?void 0:a.layers)??[];switch(s){case"seek":{const[f]=rt(e,i,[j.NUMBER]);n.cursor=tn(f,0,o.length-1);break}case"layer":{const f=n.cursor+1;n.cursor=tn(f,0,o.length-1);break}case"char":{const[f,d,h]=rt(e,i,[j.NUMBER,j.NUMBER,j.NAME]),p=(c=n.content)==null?void 0:c.layers[n.cursor];x(p)&&zo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,p.raster[f+d*p.width].asciiCode);break}case"color":{const[f,d,h]=rt(e,i,[j.NUMBER,j.NUMBER,j.NAME]),p=(l=n.content)==null?void 0:l.layers[n.cursor];x(p)&&zo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,Xx(p.raster[f+d*p.width].color));break}case"bg":{const[f,d,h]=rt(e,i,[j.NUMBER,j.NUMBER,j.NAME]),p=(u=n.content)==null?void 0:u.layers[n.cursor];x(p)&&zo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,Xx(p.raster[f+d*p.width].bg));break}}return 0},m5=(t,e)=>{const n=ws(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[j.NAME]);switch(It(r)){case"seek":{const[o]=rt(e,i,[j.NUMBER]);n.cursor=tn(o,0,n.lines.length-1);break}case"line":n.cursor=tn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[f,d]=rt(e,u,[j.NAME]);t.set(f,c[l]??0),++l,u=d}break}}return 0};function qx(t){const e=oe(Lt.MAIN),n=ia(e);x(t.targetdir)?da(t.targetdir.destpt,t.label,void 0,n):x(t.targetname)&&da(t.targetname,t.label,void 0,n)}const g5=Wi({get(t,e){var r,i,s;const n=q$(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const o=ws(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"lines":return[!0,o.lines.length]}break}case"json":{const o=ws(t.id());switch(e){case"filename":return[!0,o.filename]}break}case"binary":{const o=ws(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"bytes":return[!0,o.bytes.length]}break}case"rexpaint":{const o=ws(t.id());switch(e){case"filename":return[!0,o.filename];case"layers":return[!0,((r=o.content)==null?void 0:r.layers.length)??0];case"width":return[!0,((i=o.content)==null?void 0:i.layers[o.cursor].width)??0];case"height":return[!0,((s=o.content)==null?void 0:s.layers[o.cursor].height)??0];case"cursor":return[!0,o.cursor]}break}}return[!1,void 0]}}).command("shortsend",(t,e)=>{const n=Hi(e);return qx(n),0}).command("send",(t,e)=>{const n=Hi(["send",...e]);return qx(n),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(Ue).join(" ");return pe(tt,w.elementfocus,"$175",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Ue(n),s=Hi(r);return x(s.targetname)&&pe(tt,w.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",m5).command("readjson",f5).command("readbin",Q$).command("readrexpaint",p5).command("withboard",(t,e)=>{const[n]=rt(e,0,[j.STRING]),r=Yn(w.book,_t.BOARD,n);if(r.length){const i=Ae(...r);x(i)&&(w.board=Ee(i),w.element={x:-1,y:-1})}return 0});function Jx(t,e,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=rt(i,a,[j.ANY]);ue(c)&&!Br(c)&&!Pc(c)&&!Zu(c)&&!oi(c)?o.push(...c):o.push(c),a=l}switch(It(r)){case"get":case"post:json":$A(tt,w.elementfocus,t,e,n,r,o);break}return 0}const _5=Wi().command("fetch",(t,e)=>{const[n,r,i="get",s]=rt(e,0,[j.NAME,j.NAME,j.MAYBE_STRING]);return Jx(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",o]=rt(e,0,[j.ANY,j.NAME,j.NAME,j.MAYBE_STRING]);return Jx(n,r,i,s,e,o),0}).command("chat",(t,e)=>{const[n]=rt(e,0,[j.MAYBE_NAME]);return n?PA(tt,w.elementfocus,n):DA(tt,w.elementfocus),0}).command("broadcast",(t,e)=>{const[n]=rt(e,0,[j.MAYBE_NAME]);return n?FA(tt,w.elementfocus,n):BA(tt,w.elementfocus),0});function Qx(t,e){var n,r;if(x(e.targetname))switch(e.targetname){case"all":for(const i of Object.keys(((n=w.board)==null?void 0:n.objects)??{}))t.send(w.elementfocus,i,e.label);break;case"self":t.message({session:tt.session(),player:w.elementfocus,id:ze(),sender:t.id(),target:e.label});break;case"others":for(const i of Object.keys(((r=w.board)==null?void 0:r.objects)??{}))i!==t.id()&&t.send(w.elementfocus,i,e.label);break;default:{const i=ob(w.board,[e.targetname]);for(let s=0;s<i.length;++s){const o=i[s];x(o.id)&&t.send(w.elementfocus,o.id,e.label)}break}}else if(x(e.targetdir)){const i=Jt(w.board,e.targetdir.destpt);x(i==null?void 0:i.id)&&t.send(w.elementfocus,i.id,e.label)}}const y5=Wi({set(t,e,n){return ej(t,e,n),[!1,void 0]},everytick(){const t=Mn(w.elementid),[e]=t;if(t.length===1&&gt(e)){if(x(w.element))if(e.trim().length===0){const n=qe(w.elementid);n.sidebar=[]}else w.element.tickertext=e,w.element.tickertime=w.timestamp}else if(t.length>1)if(w.elementisplayer){const n=qe(w.elementid);n.sidebar=t}else{const n=qe(w.elementfocus);n.scroll=t}}}).command("shortsend",(t,e)=>{const n=Hi(e);return Qx(t,n),0}).command("send",(t,e)=>{const n=Hi(["send",...e]);return Qx(t,n),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(Ue).join("");return Mt(w.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Ue(n),s=Hi(r);return x(s.targetname)&&Ot(w.elementid,t.id(),i,`${s.targetname}:${s.label}`.split(" "),t.get,t.set),0});function tE(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=Jt(e,{x:s,y:i});gn(o)&&En(t,e,o,t.timestamp),Se(e,{x:s,y:i})}}function b5(t,e,n){for(let r=e.y;r<=n.y;++r)for(let i=e.x;i<=n.x;++i)Se(t,{x:i,y:r})}function eE(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=Jt(e,{x:s,y:i});gn(o)&&En(t,e,o,t.timestamp),Se(e,{x:s,y:i})}}function aa(t,e){x(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.code=e.code,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.stepx=e.stepx,t.stepy=e.stepy,t.pushable=e.pushable,t.collision=e.collision,t.breakable=e.breakable,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function sp(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return w5(t,e,n,i)}if(!x(w.book))return;const s=w.book,o=Ye(s,_t.BOARD,t),a=Ee(o);if(!x(a))return;const c=Ye(s,_t.BOARD,e),l=Ee(c);if(!x(l))return;De(s,a),De(s,l);let u=!1;if(x(a)&&x(l)){switch(i){case"all":tE(s,l,n,r);break;case"object":eE(s,l,n,r);break;case"terrain":b5(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,p=!1;switch(i){case"all":h=!0,p=!0;break;case"object":h=!0;break;case"terrain":p=!0;break}const m={x:d,y:f};let b,_=Jt(a,m);if(gn(_)?(b=ls(a,d,f),Fn(_==null?void 0:_.id)&&(_=void 0)):(b=_,_=void 0),x(b)&&(p||u&&ie(s,b,"group")===i)){u&&tE(s,l,m,m);const v=yi(s,l,[b.kind??""],m);aa(v,b)}if(x(_)&&(h||u&&ie(s,_,"group")===i)){u&&eE(s,l,m,m);const v=yi(s,l,[_.kind??""],m);aa(v,_)}}Mc(s,l)}}function w5(t,e,n,r){if(!x(w.book))return;const i=w.book,s=Ye(i,_t.BOARD,t),o=Ee(s);if(!x(o))return;const a=Ye(i,_t.BOARD,e),c=Ee(a);if(x(c)&&(De(i,o),De(i,c),x(o)&&x(c))){const{terrainelements:l,objectelements:u}=Tx(i,o,r);if(l.length===0&&u.length===0)return;const f={x:Tt,y:Ht};for(let d=0;d<l.length;++d){const h=l[d];kt(h.x)&&(f.x=Math.min(f.x,h.x)),kt(h.y)&&(f.y=Math.min(f.y,h.y))}for(let d=0;d<u.length;++d){const h=u[d];kt(h.x)&&(f.x=Math.min(f.x,h.x)),kt(h.y)&&(f.y=Math.min(f.y,h.y))}for(let d=0;d<l.length;++d){const h=l[d],p={x:n.x+(h.x??0)-f.x,y:n.y+(h.y??0)-f.y},m=Jt(c,p);x(m)&&(gn(m)&&En(i,c,m,i.timestamp),Se(c,p));const b=yi(i,c,[h.kind??""],p);aa(b,h)}for(let d=0;d<u.length;++d){const h=u[d],p={x:n.x+(h.x??0)-f.x,y:n.y+(h.y??0)-f.y},m=yi(i,c,[h.kind??""],p);aa(m,h)}Mc(i,c)}}function x5(t,e,n,r,i){if(!x(w.book))return;const s=w.book,o=Ye(s,_t.BOARD,t),a=Ee(o);if(!x(a))return;const c=ql(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";De(s,a),De(s,c);const f=-Math.tan(e*.5),d=Math.sin(e),h=Math.round(12.5*f),p=Math.round(12.5*d),m=new Array(Ht).fill(0);uy(h,0,-h,Ht-1).forEach(A=>{A.x<0?m[A.y]=Math.min(m[A.y],A.x):m[A.y]=Math.max(m[A.y],A.x)});const _=new Array(Tt).fill(0);uy(0,p,Tt-1,-p).forEach(A=>{A.y<0?_[A.x]=Math.min(_[A.x],A.y):_[A.x]=Math.max(_[A.x],A.y)});const T=[m,_,m];for(let A=0;A<T.length;++A){const C=T[A];if(A!==1){for(let R=0;R<Ht;++R){const S=C[R],U=R*Tt;for(let I=0;I<Tt;I++){const P=(I+S+Tt)%Tt;u&&(c.terrain[P+U]=a.terrain[I+U])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const U=R[S],{x:I,y:P}=a.objects[U];if(x(I)&&x(P)){const W=C[P];a.objects[U].x=(I+W+Tt)%Tt,a.objects[U].lx=a.objects[U].x}}}}if(A===1){for(let R=0;R<Tt;++R){const S=C[R];for(let U=0;U<Ht;++U){const I=(U+S+Ht)%Ht;u&&(c.terrain[R+I*Tt]=a.terrain[R+U*Tt])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const U=R[S],{x:I,y:P}=a.objects[U];if(x(I)&&x(P)){const W=C[I];a.objects[U].y=(P+W+Ht)%Ht,a.objects[U].ly=a.objects[U].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,De(s,c),De(s,a)}}function E5(t,e){let n=0,r=0,i=0;for(;i<t.length;i++)n+=t[i];for(i=0,e*=n;e&&i<t.length;){if(r+=t[i],e<=r)return i;i++}return 0}var v5=E5;const k5=v5,Qt=function(){};Qt.prototype.FMX=0,Qt.prototype.FMY=0,Qt.prototype.FMXxFMY=0,Qt.prototype.T=0,Qt.prototype.N=0,Qt.prototype.initiliazedField=!1,Qt.prototype.generationComplete=!1,Qt.prototype.wave=null,Qt.prototype.compatible=null,Qt.prototype.weightLogWeights=null,Qt.prototype.sumOfWeights=0,Qt.prototype.sumOfWeightLogWeights=0,Qt.prototype.startingEntropy=0,Qt.prototype.sumsOfOnes=null,Qt.prototype.sumsOfWeights=null,Qt.prototype.sumsOfWeightLogWeights=null,Qt.prototype.entropies=null,Qt.prototype.propagator=null,Qt.prototype.observed=null,Qt.prototype.distribution=null,Qt.prototype.stack=null,Qt.prototype.stackSize=0,Qt.prototype.DX=[-1,0,1,0],Qt.prototype.DY=[0,1,0,-1],Qt.prototype.opposite=[2,3,0,1],Qt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let t=0;t<this.FMXxFMY;t++){this.wave[t]=new Array(this.T),this.compatible[t]=new Array(this.T);for(let e=0;e<this.T;e++)this.compatible[t][e]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let t=0;t<this.T;t++)this.weightLogWeights[t]=this.weights[t]*Math.log(this.weights[t]),this.sumOfWeights+=this.weights[t],this.sumOfWeightLogWeights+=this.weightLogWeights[t];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},Qt.prototype.observe=function(t){let e=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=e){const c=1e-6*t();a+c<e&&(e=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=k5(this.distribution,t()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},Qt.prototype.propagate=function(){for(;this.stackSize>0;){const t=this.stack[this.stackSize-1];this.stackSize--;const e=t[0],n=e%this.FMX,r=e/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][t[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],p=f[h];p[i]--,p[i]==0&&this.ban(l,h)}}}},Qt.prototype.singleIteration=function(t){const e=this.observe(t);return e!==null?(this.generationComplete=e,!!e):(this.propagate(),null)},Qt.prototype.iterate=function(t,e){this.wave||this.initialize(),this.initiliazedField||this.clear(),t=t||0,e=e||Math.random;for(let n=0;n<t||t===0;n++){const r=this.singleIteration(e);if(r!==null)return!!r}return!0},Qt.prototype.generate=function(t){for(t=t||Math.random,this.wave||this.initialize(),this.clear();;){const e=this.singleIteration(t);if(e!==null)return!!e}},Qt.prototype.isGenerationComplete=function(){return this.generationComplete},Qt.prototype.ban=function(t,e){const n=this.compatible[t][e];for(let i=0;i<4;i++)n[i]=0;this.wave[t][e]=!1,this.stack[this.stackSize]=[t,e],this.stackSize++,this.sumsOfOnes[t]-=1,this.sumsOfWeights[t]-=this.weights[e],this.sumsOfWeightLogWeights[t]-=this.weightLogWeights[e];const r=this.sumsOfWeights[t];this.entropies[t]=Math.log(r)-this.sumsOfWeightLogWeights[t]/r},Qt.prototype.clear=function(){for(let t=0;t<this.FMXxFMY;t++){for(let e=0;e<this.T;e++){this.wave[t][e]=!0;for(let n=0;n<4;n++)this.compatible[t][e][n]=this.propagator[this.opposite[n]][e].length}this.sumsOfOnes[t]=this.weights.length,this.sumsOfWeights[t]=this.sumOfWeights,this.sumsOfWeightLogWeights[t]=this.sumOfWeightLogWeights,this.entropies[t]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var nE=Qt;const rE=nE,Gi=function(e,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let I=0;I<f;I++)d[I]=new Array(r);this.colors=[];const h={};for(let I=0;I<r;I++)for(let P=0;P<n;P++){const W=(I*n+P)*4,L=[e[W],e[W+1],e[W+2],e[W+3]],N=L.join("-");h.hasOwnProperty(N)||(h[N]=this.colors.length,this.colors.push(L)),d[P][I]=h[N]}const p=this.colors.length,m=Math.pow(p,i*i),b=function(P){let W=new Array(i*i);for(let L=0;L<i;L++)for(let N=0;N<i;N++)W[N+L*i]=P(N,L);return W},_=function(P,W){return b(function(L,N){return d[(P+L)%n][(W+N)%r]})},v=function(P){return b(function(W,L){return P[i-1-L+W*i]})},T=function(P){return b(function(W,L){return P[i-1-W+L*i]})},A=function(P){let W=0,L=1;for(let N=0;N<P.length;N++)W+=P[P.length-1-N]*L,L*=p;return W},C=function(P){let W=P,L=m;const N=new Array(i*i);for(let E=0;E<N.length;E++){L/=p;let D=0;for(;W>=L;)W-=L,D++;N[E]=D}return N},R={},S=[];for(let I=0;I<(a?r:r-i+1);I++)for(let P=0;P<(a?n:n-i+1);P++){const W=new Array(8);W[0]=_(P,I),W[1]=T(W[0]),W[2]=v(W[0]),W[3]=T(W[2]),W[4]=v(W[2]),W[5]=T(W[4]),W[6]=v(W[4]),W[7]=T(W[6]);for(let L=0;L<l;L++){const N=A(W[L]);R[N]?R[N]++:(S.push(N),R[N]=1)}}this.T=S.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let I=0;I<this.T;I++){const P=parseInt(S[I],10);this.patterns[I]=C(P),this.weights[I]=R[P]}const U=function(P,W,L,N){const E=L<0?0:L,D=L<0?L+i:i,Z=N<0?0:N,$=N<0?N+i:i;for(let st=Z;st<$;st++)for(let nt=E;nt<D;nt++)if(P[nt+i*st]!=W[nt-L+i*(st-N)])return!1;return!0};this.propagator=new Array(4);for(let I=0;I<4;I++){this.propagator[I]=new Array(this.T);for(let P=0;P<this.T;P++){const W=[];for(let L=0;L<this.T;L++)U(this.patterns[P],this.patterns[L],this.DX[I],this.DY[I])&&W.push(L);this.propagator[I][P]=W}}};Gi.prototype=Object.create(rE.prototype),Gi.prototype.constructor=Gi,Gi.prototype.onBoundary=function(t,e){return!this.periodic&&(t+this.N>this.FMX||e+this.N>this.FMY||t<0||e<0)},Gi.prototype.clear=function(){if(rE.prototype.clear.call(this),this.ground!==0){for(let t=0;t<this.FMX;t++){for(let e=0;e<this.T;e++)e!==this.ground&&this.ban(t+(this.FMY-1)*this.FMX,e);for(let e=0;e<this.FMY-1;e++)this.ban(t+e*this.FMX,this.ground)}this.propagate()}},Gi.prototype.graphics=function(t){return t=t||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t),t},Gi.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMY;e++){const n=e<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(e*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(e-n)*this.FMX]][i+n*this.N]];t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3]}}},Gi.prototype.graphicsIncomplete=function(t){for(let e=0;e<this.FMXxFMY;e++){const n=e%this.FMX,r=e/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const p=d+h*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const b=this.colors[this.patterns[m][f+u*this.N]];s+=b[0],o+=b[1],a+=b[2],c+=b[3]}}const l=e*4;t[l]=s/i,t[l+1]=o/i,t[l+2]=a/i,t[l+3]=c/i}};var T5=Gi;const A5=nE,xs=function(e,n,r,i,s){const o=e.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!e.unique;let c=null;n&&e.subsets&&e.subsets[n]&&(c=e.subsets[n]);const l=function(A){const C=new Array(o*o);for(let R=0;R<o;R++)for(let S=0;S<o;S++)C[S+R*o]=A(S,R);return C},u=function(A){return l(function(C,R){return A[o-1-R+C*o]})},f=function(A){return l(function(C,R){return A[o-1-C+R*o]})};this.tiles=[];const d=[],h=[],p={};let m,b,_;for(let T=0;T<e.tiles.length;T++){const A=e.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":_=4,m=function(R){return(R+1)%4},b=function(R){return R%2===0?R+1:R-1};break;case"T":_=4,m=function(R){return(R+1)%4},b=function(R){return R%2===0?R:4-R};break;case"I":_=2,m=function(R){return 1-R},b=function(R){return R};break;case"\\":_=2,m=function(R){return 1-R},b=function(R){return 1-R};break;case"F":_=8,m=function(R){return R<4?(R+1)%4:4+(R-1)%4},b=function(R){return R<4?R+4:R-4};break;default:_=1,m=function(R){return R},b=function(R){return R};break}this.T=h.length,p[A.name]=this.T;for(let R=0;R<_;R++)h.push([this.T+R,this.T+m(R),this.T+m(m(R)),this.T+m(m(m(R))),this.T+b(R),this.T+b(m(R)),this.T+b(m(m(R))),this.T+b(m(m(m(R))))]);let C;if(a)for(let R=0;R<_;R++)C=A.bitmap[R],this.tiles.push(l(function(S,U){return[C[(o*U+S)*4],C[(o*U+S)*4+1],C[(o*U+S)*4+2],C[(o*U+S)*4+3]]}));else{C=A.bitmap,this.tiles.push(l(function(R,S){return[C[(o*S+R)*4],C[(o*S+R)*4+1],C[(o*S+R)*4+2],C[(o*S+R)*4+3]]}));for(let R=1;R<_;R++)this.tiles.push(R<4?u(this.tiles[this.T+R-1]):f(this.tiles[this.T+R-4]))}for(let R=0;R<_;R++)d.push(A.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const v=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),v[T]=new Array(this.T);for(let A=0;A<this.T;A++){v[T][A]=new Array(this.T);for(let C=0;C<this.T;C++)v[T][A][C]=!1}}for(let T=0;T<e.neighbors.length;T++){const A=e.neighbors[T],C=A.left.split(" ").filter(function(W){return W.length}),R=A.right.split(" ").filter(function(W){return W.length});if(c!==null&&(c.indexOf(C[0])===-1||c.indexOf(R[0])===-1))continue;const S=h[p[C[0]]][C.length==1?0:parseInt(C[1],10)],U=h[S][1],I=h[p[R[0]]][R.length==1?0:parseInt(R[1],10)],P=h[I][1];v[0][I][S]=!0,v[0][h[I][6]][h[S][6]]=!0,v[0][h[S][4]][h[I][4]]=!0,v[0][h[S][2]][h[I][2]]=!0,v[1][P][U]=!0,v[1][h[U][6]][h[P][6]]=!0,v[1][h[P][4]][h[U][4]]=!0,v[1][h[U][2]][h[P][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)v[2][T][A]=v[0][A][T],v[3][T][A]=v[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const C=[],R=v[T][A];for(let S=0;S<this.T;S++)R[S]&&C.push(S);this.propagator[T][A]=C}};xs.prototype=Object.create(A5.prototype),xs.prototype.constructor=xs,xs.prototype.onBoundary=function(t,e){return!this.periodic&&(t<0||e<0||t>=this.FMX||e>=this.FMY)},xs.prototype.graphics=function(t,e){return t=t||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t,e),t},xs.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMX;e++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[e+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(e*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];t[o]=a[0],t[o+1]=a[1],t[o+2]=a[2],t[o+3]=a[3]}}},xs.prototype.graphicsIncomplete=function(t,e){(!e||e.length!==4)&&(e=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(e&&s===this.T)t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];else{let f=0,d=0,h=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const b=this.tiles[m][l+c*this.tilesize],_=this.weights[m]*a;f+=b[0]*_,d+=b[1]*_,h+=b[2]*_,p+=b[3]*_}t[u]=f,t[u+1]=d,t[u+2]=h,t[u+3]=p}}}};var R5=xs,S5={OverlappingModel:T5,SimpleTiledModel:R5},O5=ho(S5);const iE=5;function sE(t,e,n,r,i,s,o){if(!x(w.book))return!1;const a=w.book,c=Ye(a,_t.BOARD,t),l=Ye(a,_t.BOARD,e),u=Ee(c),f=Ee(l);if(!x(u)||!x(f))return!1;De(a,u),De(a,f);let d=0;const h=new Map,p=new Map;let m=0;const b=32,_=new Uint8Array(Ed*4);for(let S=0;S<Ht;++S)for(let U=0;U<Tt;++U){const I=Jt(f,{x:U,y:S}),P=(I==null?void 0:I.char)??0,W=(I==null?void 0:I.color)??b,L=(I==null?void 0:I.bg)??b;_[m++]=P,_[m++]=W,_[m++]=L;const N=_s(a,I),E=It((N==null?void 0:N.name)??"empty"),D=h.get(E);kt(D)?_[m++]=D:(h.set(E,d),p.set(d,E),_[m++]=d++)}const v=s.x-i.x+1,T=s.y-i.y+1,A=new O5.OverlappingModel(_,Tt,Ht,n,v,T,!1,!1,r,0);let C=0;for(;C<iE&&!A.generate();++C);if(C===iE)return!1;m=0;const R=A.graphics();for(let S=i.y;S<=s.y;++S)for(let U=i.x;U<=s.x;++U){const I={x:U,y:S},P=R[m++],W=R[m++],L=R[m++];switch(d=R[m++],o){case"all":{const st=Jt(u,{x:U,y:S});gn(st)&&En(a,u,st,a.timestamp),Se(u,{x:U,y:S});break}case"object":{const st=Jt(u,{x:U,y:S});gn(st)&&En(a,u,st,a.timestamp);break}case"terrain":Se(u,{x:U,y:S});break}let N=p.get(d)??"";const E=io(a,N),D=Lc(a,N),Z=E??D;switch(o){case"all":break;case"object":x(D)&&(N="");break;case"terrain":x(E)&&(N="");break;default:if(ie(a,D,"group")!==o&&(N=""),N){const st=Jt(u,{x:U,y:S});gn(st)&&En(a,u,st,a.timestamp),Se(u,{x:U,y:S})}break}const $=N?yi(a,u,[N],I):void 0;if(!(!x($)||!x(Z))&&(aa($,Z),P>0&&($.char=P),W<b&&($.color=W),L<b&&($.bg=L),gn($))){const st=Ae(lc(f,N));x(st)&&(Se(u,{...ls(f,st.x??0,st.y??0),x:U,y:S}),aa($,st))}}return!0}function oE(t){return`zss_snapshot_${t}`}const aE={x:0,y:0},cE={x:Tt-1,y:Ht-1},lE="all";function I5(t){const e=Ye(w.book,_t.BOARD,t),n=Ee(e);if(!x(n))return;const r=oE(n.id);bx(w.book,r);const[i]=ks(Lt.CONTENT,r,_t.BOARD),s=Ee(i);if(x(s))return sp(t,s.id,aE,cE,lE),s}function N5(t){const e=Ye(w.book,_t.BOARD,t),n=Ee(e);if(!x(n))return;const r=oE(n.id),i=Ye(w.book,_t.BOARD,r),s=Ee(i);if(x(s))return sp(s.id,t,aE,cE,lE),s}function C5(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return L5(t,e,i)}if(!x(w.book))return;const s=w.book,o=Ye(s,_t.BOARD,t),a=Ee(o);if(!x(a))return;const c=ql();De(s,a);for(let l=n.y;l<=r.y;++l)for(let u=n.x;u<=r.x;++u){let f=!1,d=!1;switch(i){case"all":f=!0,d=!0;break;case"object":f=!0;break;case"terrain":d=!0;break}const h=(u+e.x+Tt)%Tt,p=(l+e.y+Ht)%Ht;if(f){const m=Jt(a,{x:u,y:l});gn(m)&&x(m==null?void 0:m.x)&&x(m==null?void 0:m.y)&&(m.x=h,m.lx=h,m.y=p,m.ly=p)}d&&(c.terrain[h+p*Tt]=a.terrain[u+l*Tt])}(i==="all"||i==="terrain")&&(a.terrain=[...c.terrain]),Mc(s,a)}function L5(t,e,n){if(!x(w.book))return;const r=w.book,i=Ye(r,_t.BOARD,t),s=Ee(i);if(!x(s))return;De(r,s);const{terrainelements:o,objectelements:a}=Tx(r,s,n);if(o.length===0&&a.length===0)return;const c=a.map(p=>p.id??""),l=o.map(p=>si({x:p.x??0,y:p.y??0},Tt)),u=[],f=[];for(let p=0;p<o.length;++p){const m=o[p],b={x:m.x??-1,y:m.y??-1},_=Jt(s,b);x(_)&&gn(_)&&(u.push(_.id??""),u.push(_.id??""),f.push(si({x:_.x??0,y:_.y??0},Tt)))}let d=!1;for(let p=0;p<o.length;++p){const m=o[p],b=ie(r,m,"collision")??Ut.ISWALK,_={x:m.x??-1,y:m.y??-1},v=si(_,Tt),T={x:_.x+e.x,y:_.y+e.y};if(Jl(T)){const A=Jt(s,T),C=(A==null?void 0:A.id)??"",R=si({x:(A==null?void 0:A.x)??0,y:(A==null?void 0:A.y)??0},Tt),S=ie(r,A,"collision")??Ut.ISWALK;if(x(A)&&gn(A)&&u.includes(C)!==!0&&c.includes(C)!==!0){let U=!1;const I=f.includes(v),P=I?Jt(s,_):void 0,W=I?ie(r,P,"pushable"):!1,L=I&&W;if(ie(r,A,"pushable")&&(b!==Ut.ISWALK||I)){let N=I;x(P)&&W&&(d=Ts(r,s,P,{x:(P.x??0)-e.x,y:(P.y??0)-e.y})!==!0,d||(N=!1)),(N||b!==Ut.ISWALK)&&(d=Ts(r,s,A,{x:(A.x??0)+e.x,y:(A.y??0)+e.y})!==!0,d&&(U=L))}else(b!==Ut.ISWALK||L)&&(d=!0,U=L);U&&x(P)&&(d=Ts(r,s,P,{x:(P.x??0)-e.x,y:(P.y??0)-e.y})!==!0)}else S===Ut.ISSOLID&&l.includes(R)===!1&&(d=!0)}else d=!0}if(d)return;for(let p=0;p<a.length;++p){const m=a[p],b=ie(r,m,"collision"),_={x:m.x??0,y:m.y??0},v={x:_.x+e.x,y:_.y+e.y};if(Jl(v)){const T=Jt(s,v),A=(T==null?void 0:T.id)??"",C=ie(r,T,"collision")??Ut.ISWALK,R=ie(r,T,"group")??"";x(T)&&gn(T)&&u.includes(A)&&c.includes(A)!==!0?ie(r,T,"pushable")?d=Ts(r,s,T,v)!==!0:d=!0:ac(b,C)&&n!==R&&(d=!0)}else d=!0}if(d)return;(e.x>0||e.y>0)&&o.reverse();for(let p=0;p<o.length;++p){const m=o[p],b={x:m.x??-1,y:m.y??-1},_={x:b.x+e.x,y:b.y+e.y},v=ls(s,_.x,_.y);if(x(m)&&x(v)){Se(s,{...m,x:_.x,y:_.y}),Se(s,{...v,x:b.x,y:b.y});const T=Jt(s,b);gn(T)&&x(T)&&(T.x=(T.x??0)+e.x,T.y=(T.y??0)+e.y,T.lx=(T.lx??0)+e.x,T.ly=(T.ly??0)+e.y)}}Mc(r,s);for(let p=0;p<a.length;++p){const m=a[p],b={x:m.x??-1,y:m.y??-1},_={x:b.x+e.x,y:b.y+e.y};if(!Ts(r,s,m,_))break}Mc(r,s)}function th(t,e){let n="all";const r={x:0,y:0},i={x:Tt-1,y:Ht-1};for(let s=e;s<t.length;){const[o,a]=rt(t,s,[j.MAYBE_NUMBER_OR_STRING]);if(gt(o))n=It(o),s=a;else if(kt(o)){const[c,l,u,f]=rt(t,a,[j.NUMBER,j.MAYBE_NUMBER,j.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const M5=Wi().command("snapshot",()=>(!x(w.book)||!x(w.board)||I5(w.board.id),0)).command("revert",()=>(!x(w.book)||!x(w.board)||N5(w.board.id),0)).command("copy",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r]=rt(e,0,[j.STRING]),i=Yn(w.book,_t.BOARD,n),s=Ae(...i);if(x(s)){const o=th(e,r);sp(s.id,w.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r,i,s]=rt(e,0,[j.STRING,j.NUMBER,j.NUMBER]),o=Yn(w.book,_t.BOARD,n),a=Ae(...o);if(x(a)){const c=th(e,s);sE(w.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(t,e)=>{var o,a;if(!x(w.book)||!x(w.board))return 0;const[n,r]=rt(e,0,[j.DIR]),i={x:n.destpt.x-(((o=w.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=w.element)==null?void 0:a.y)??0)},s=th(e,r);return C5(w.board.id,i,s.pt1,s.pt2,s.targetset),0}).command("pivot",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r]=rt(e,0,[j.NUMBER]),i=th(e,r);return x5(w.board.id,_y(n),i.pt1,i.pt2,i.targetset),0});var Es=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(Es||{});const U5={audio:G0,board:$F,cli:$$,display:j$,element:Z$,runtime:y5,loader:g5,network:_5,transform:M5},op=["audio","board","display","network","transform","element"],F5={0:[],1:["cli",...op],2:["loader",...op],3:["runtime",...op]},B5={0:new Map,1:new Map,2:new Map,3:new Map};function ca(t){return(F5[t]??[]).map(n=>U5[n]).filter(x)}function ap(t){const e=[],n=ca(t);for(let r=0;r<n.length;++r)e.push(...n[r].listcommands());return e}function P5(t,e){const n=B5[t];if(!n.has(e)){let r;const i=ca(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!x(r));++s);n.set(e,r)}return n.get(e)}function D5(t,e,n){const r=ca(t);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(e,n);if(o)return[o,a]}}return[!1,void 0]}function $5(t,e,n,r){const i=ca(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,n,r);if(a)return[a,r]}}return[!1,void 0]}function j5(t,e){const n=ca(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function uE(t,e){const n=ca(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var hE={},fE={},dE={};const pE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");dE.encode=function(t){if(0<=t&&t<pE.length)return pE[t];throw new TypeError("Must be between 0 and 63: "+t)};const z5=dE,mE=5,gE=1<<mE,K5=gE-1,W5=gE;function H5(t){return t<0?(-t<<1)+1:(t<<1)+0}fE.encode=function(e){let n="",r,i=H5(e);do r=i&K5,i>>>=mE,i>0&&(r|=W5),n+=z5.encode(r);while(i>0);return n};var Dc={};(function(t){function e(R,S,U){if(S in R)return R[S];if(arguments.length===3)return U;throw new Error('"'+S+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(R){const S=R.match(n);return S?{scheme:S[1],auth:S[2],host:S[3],port:S[4],path:S[5]}:null}t.urlParse=i;function s(R){let S="";return R.scheme&&(S+=R.scheme+":"),S+="//",R.auth&&(S+=R.auth+"@"),R.host&&(S+=R.host),R.port&&(S+=":"+R.port),R.path&&(S+=R.path),S}t.urlGenerate=s;const o=32;function a(R){const S=[];return function(U){for(let P=0;P<S.length;P++)if(S[P].input===U){const W=S[0];return S[0]=S[P],S[P]=W,S[0].result}const I=R(U);return S.unshift({input:U,result:I}),S.length>o&&S.pop(),I}}const c=a(function(S){let U=S;const I=i(S);if(I){if(!I.path)return S;U=I.path}const P=t.isAbsolute(U),W=[];let L=0,N=0;for(;;)if(L=N,N=U.indexOf("/",L),N===-1){W.push(U.slice(L));break}else for(W.push(U.slice(L,N));N<U.length&&U[N]==="/";)N++;let E=0;for(N=W.length-1;N>=0;N--){const D=W[N];D==="."?W.splice(N,1):D===".."?E++:E>0&&(D===""?(W.splice(N+1,E),E=0):(W.splice(N,2),E--))}return U=W.join("/"),U===""&&(U=P?"/":"."),I?(I.path=U,s(I)):U});t.normalize=c;function l(R,S){R===""&&(R="."),S===""&&(S=".");const U=i(S),I=i(R);if(I&&(R=I.path||"/"),U&&!U.scheme)return I&&(U.scheme=I.scheme),s(U);if(U||S.match(r))return S;if(I&&!I.host&&!I.path)return I.host=S,s(I);const P=S.charAt(0)==="/"?S:c(R.replace(/\/+$/,"")+"/"+S);return I?(I.path=P,s(I)):P}t.join=l,t.isAbsolute=function(R){return R.charAt(0)==="/"||n.test(R)};function u(R,S){R===""&&(R="."),R=R.replace(/\/$/,"");let U=0;for(;S.indexOf(R+"/")!==0;){const I=R.lastIndexOf("/");if(I<0||(R=R.slice(0,I),R.match(/^([^\/]+:\/)?\/*$/)))return S;++U}return Array(U+1).join("../")+S.substr(R.length+1)}t.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(R){return R}function h(R){return m(R)?"$"+R:R}t.toSetString=f?d:h;function p(R){return m(R)?R.slice(1):R}t.fromSetString=f?d:p;function m(R){if(!R)return!1;const S=R.length;if(S<9||R.charCodeAt(S-1)!==95||R.charCodeAt(S-2)!==95||R.charCodeAt(S-3)!==111||R.charCodeAt(S-4)!==116||R.charCodeAt(S-5)!==111||R.charCodeAt(S-6)!==114||R.charCodeAt(S-7)!==112||R.charCodeAt(S-8)!==95||R.charCodeAt(S-9)!==95)return!1;for(let U=S-10;U>=0;U--)if(R.charCodeAt(U)!==36)return!1;return!0}function b(R,S,U){let I=v(R.source,S.source);return I!==0||(I=R.originalLine-S.originalLine,I!==0)||(I=R.originalColumn-S.originalColumn,I!==0||U)||(I=R.generatedColumn-S.generatedColumn,I!==0)||(I=R.generatedLine-S.generatedLine,I!==0)?I:v(R.name,S.name)}t.compareByOriginalPositions=b;function _(R,S,U){let I=R.generatedLine-S.generatedLine;return I!==0||(I=R.generatedColumn-S.generatedColumn,I!==0||U)||(I=v(R.source,S.source),I!==0)||(I=R.originalLine-S.originalLine,I!==0)||(I=R.originalColumn-S.originalColumn,I!==0)?I:v(R.name,S.name)}t.compareByGeneratedPositionsDeflated=_;function v(R,S){return R===S?0:R===null?1:S===null?-1:R>S?1:-1}function T(R,S){let U=R.generatedLine-S.generatedLine;return U!==0||(U=R.generatedColumn-S.generatedColumn,U!==0)||(U=v(R.source,S.source),U!==0)||(U=R.originalLine-S.originalLine,U!==0)||(U=R.originalColumn-S.originalColumn,U!==0)?U:v(R.name,S.name)}t.compareByGeneratedPositionsInflated=T;function A(R){return JSON.parse(R.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=A;function C(R,S,U){if(S=S||"",R&&(R[R.length-1]!=="/"&&S[0]!=="/"&&(R+="/"),S=R+S),U){const I=i(U);if(!I)throw new Error("sourceMapURL could not be parsed");if(I.path){const P=I.path.lastIndexOf("/");P>=0&&(I.path=I.path.substring(0,P+1))}S=l(s(I),S)}return c(S)}t.computeSourceURL=C})(Dc);var cp={};let G5=class nv{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new nv;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};cp.ArraySet=G5;var _E={};const yE=Dc;function Y5(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||yE.compareByGeneratedPositionsInflated(t,e)<=0}let V5=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){Y5(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(yE.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};_E.MappingList=V5;const $c=fE,Xe=Dc,eh=cp.ArraySet,Z5=_E.MappingList;let bE=class rv{constructor(e){e||(e={}),this._file=Xe.getArg(e,"file",null),this._sourceRoot=Xe.getArg(e,"sourceRoot",null),this._skipValidation=Xe.getArg(e,"skipValidation",!1),this._sources=new eh,this._names=new eh,this._mappings=new Z5,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new rv({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Xe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=Xe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=Xe.getArg(e,"generated"),r=Xe.getArg(e,"original",null);let i=Xe.getArg(e,"source",null),s=Xe.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=Xe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Xe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Xe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=Xe.relative(s,i));const o=this._mappings.toArray().length>0?new eh:this._sources,a=new eh;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=Xe.join(r,c.source)),s!=null&&(c.source=Xe.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=Xe.join(r,c)),s!=null&&(c=Xe.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,p=d.length;h<p;h++){if(l=d[h],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!Xe.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=$c.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=$c.encode(f-o),o=f,c+=$c.encode(l.originalLine-1-i),i=l.originalLine-1,c+=$c.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=$c.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Xe.relative(n,r));const i=Xe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};bE.prototype._version=3,hE.SourceMapGenerator=bE;var wE={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(wE);var jc={exports:{}},X5={},q5=Object.freeze({__proto__:null,default:X5}),xE=iv(q5);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;jc.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},jc.exports.initialize=e=>t=e}else{const t=xE,e=xE;jc.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},jc.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var EE=jc.exports;const J5=EE;function Q5(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let zc=null;var t4=function(){if(zc)return zc;const e=[];return zc=J5().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new Q5;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),e[e.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw zc=null,n}),zc};const Rt=Dc,lp=wE,nh=cp.ArraySet,e4=EE,n4=t4,up=Symbol("smcInternal");class Ve{constructor(e,n){return e==up?Promise.resolve(this):i4(e,n)}static initialize(e){e4.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return s4(e,n)}static async with(e,n,r){const i=await new Ve(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Ve.prototype._version=3,Ve.GENERATED_ORDER=1,Ve.ORIGINAL_ORDER=2,Ve.GREATEST_LOWER_BOUND=1,Ve.LEAST_UPPER_BOUND=2;class Kc extends Ve{constructor(e,n){return super(up).then(r=>{let i=e;typeof e=="string"&&(i=Rt.parseSourceMapInput(e));const s=Rt.getArg(i,"version");let o=Rt.getArg(i,"sources");const a=Rt.getArg(i,"names",[]);let c=Rt.getArg(i,"sourceRoot",null);const l=Rt.getArg(i,"sourcesContent",null),u=Rt.getArg(i,"mappings"),f=Rt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Rt.normalize(c)),o=o.map(String).map(Rt.normalize).map(function(d){return c&&Rt.isAbsolute(c)&&Rt.isAbsolute(d)?Rt.relative(c,d):d}),r._names=nh.fromArray(a.map(String),!0),r._sources=nh.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return Rt.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,n4().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=Rt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new Kc(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||Ve.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Rt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case Ve.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Ve.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=Rt.getArg(e,"source");const r=Rt.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:Rt.getArg(e,"line"),generatedColumn:Rt.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Rt.getArg(e,"bias",Ve.GREATEST_LOWER_BOUND);r==null&&(r=Ve.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Rt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Rt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Rt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Rt.getArg(i,"originalLine",null),column:Rt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=Rt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Rt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=Rt.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Rt.getArg(e,"line"),originalColumn:Rt.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Rt.getArg(e,"bias",Ve.GREATEST_LOWER_BOUND);i==null&&(i=Ve.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Rt.getArg(s,"generatedLine",null),column:Rt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Kc.prototype.consumer=Ve;class r4 extends Ve{constructor(e,n){return super(up).then(r=>{let i=e;typeof e=="string"&&(i=Rt.parseSourceMapInput(e));const s=Rt.getArg(i,"version"),o=Rt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new nh,r._names=new nh,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Rt.getArg(c,"offset"),u=Rt.getArg(l,"line"),f=Rt.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new Ve(Rt.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(Rt.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(Rt.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:Rt.getArg(e,"line"),generatedColumn:Rt.getArg(e,"column")},r=lp.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Rt.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Rt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,n,r){const i=n||null,s=r||Ve.GENERATED_ORDER;let o;switch(s){case Ve.GENERATED_ORDER:o=this._generatedMappings;break;case Ve.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Rt.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return lp.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=Rt.getArg(e,"line"),r={source:Rt.getArg(e,"source"),originalLine:n,originalColumn:Rt.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Rt.compareByOriginalPositions,lp.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Rt.getArg(o,"generatedLine",null),column:Rt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Rt.getArg(o,"generatedLine",null),column:Rt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function i4(t,e){let n=t;typeof t=="string"&&(n=Rt.parseSourceMapInput(t));const r=n.sections!=null?new r4(n,e):new Kc(n,e);return Promise.resolve(r)}function s4(t,e){return Kc.fromSourceMap(t,e)}var vE={};const o4=hE.SourceMapGenerator,rh=Dc,a4=/(\r?\n)/,c4=10,la="$$$isSourceNode$$$";let l4=class Ap{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[la]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new Ap,s=e.split(a4);let o=0;const a=function(){const h=m(),p=m()||"";return h+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const p=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,p),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const p=n.sourceContentFor(h);p!=null&&(r!=null&&(h=rh.join(r,h)),i.setSourceContent(h,p))}),i;function d(h,p){if(h===null||h.source===void 0)i.add(p);else{const m=r?rh.join(r,h.source):h.source;i.add(new Ap(h.originalLine,h.originalColumn,m,p,h.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[la]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[la]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[la]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[la]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[rh.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][la]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(rh.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new o4(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===c4?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};vE.SourceNode=l4;var u4=vE.SourceNode;let kE=0;const TE=_i,h4=["Command","lines"];class f4 extends KU{constructor(){super(lx,{traceInitPerf:_i,skipValidations:!_i,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Bt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Bt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Nc)}])}));Bt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Bt(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Bt(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Bt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(T0)}));Bt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(k0)}));Bt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Uw)}])}));Bt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Fw)}));Bt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Bw),this.SUBRULE(this.words),this.CONSUME(Pw)}));Bt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(ea),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Bt(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Bt(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Bt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Bt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(N0),this.SUBRULE(this.words)}));Bt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(qw),this.SUBRULE(this.words)}));Bt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(C0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Bt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Wu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Nc)),this.CONSUME4(ea),this.CONSUME4(L0)}}])}));Bt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Wu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(ea),this.CONSUME(L0)}}])}));Bt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Wu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Bt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(ea),this.CONSUME(M0),this.CONSUME(C0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Bt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(ea),this.CONSUME(M0),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Bt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(nx),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Bt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(rx),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Bt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(ix),this.SUBRULE(this.words)}));Bt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(sx),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Bt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(ox)}));Bt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(ax)}));Bt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(tx)}));Bt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(ex)}));Bt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(A0),this.SUBRULE2(this.and_test)})}));Bt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(S0),this.SUBRULE2(this.not_test)})}));Bt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(R0),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Bt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Bt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(jw)},{ALT:()=>this.CONSUME(zw)},{ALT:()=>this.CONSUME(Kw)},{ALT:()=>this.CONSUME(Ww)},{ALT:()=>this.CONSUME(Hw)},{ALT:()=>this.CONSUME(Gw)}])}));Bt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(A0),this.SUBRULE2(this.and_test_value)})}));Bt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(S0),this.SUBRULE2(this.not_test_value)})}));Bt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(R0),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Bt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Bt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(O0)},{ALT:()=>this.CONSUME(I0)}]),this.SUBRULE(this.term)}));Bt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Bt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Vw)},{ALT:()=>this.CONSUME(N0)},{ALT:()=>this.CONSUME(Zw)},{ALT:()=>this.CONSUME(Xw)}]),this.SUBRULE(this.factor)}));Bt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(O0)},{ALT:()=>this.CONSUME(I0)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Bt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Yw),this.SUBRULE(this.factor)})}));Bt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Bt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(T0)},{ALT:()=>this.CONSUME(Dw)},{ALT:()=>this.CONSUME(bn)},{ALT:()=>this.CONSUME($w)},{ALT:()=>{this.CONSUME(Jw),this.SUBRULE(this.words),this.CONSUME(Qw)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=h4.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(kE++).toString().padStart(3),c=s?"font-weight: bold;":"";if(TE&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),TE&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),kE--},i)}}const ua=new f4;if(nF){const t=ua.getGAstProductions(),e=eF(t);console.info(e)}const d4=ua.getBaseCstVisitorConstructor();var bt=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(bt||{}),ao=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(ao||{}),bi=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(bi||{}),ih=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(ih||{});function hr(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class p4 extends d4{constructor(){super();Bt(this,"unique",0);_i&&this.validateVisitor()}visit(n){if(ue(n)&&(n=n[0]),!!x(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():x(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:hr(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:hr(n.token_stat,"@").slice(1)}))}stmt_text(n,r){return this.createlinenode(r,this.createcodenode(r,{type:6,value:hr(n.token_text,"")}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:hr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:hr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n,r){return n.words?this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n,r){const[i]=this.createlogicnode(r,hr(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=ze(),s=ze();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=ze(),s=ze();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,hr(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){return this.createcodenode(r,{type:17,lines:this.go(n.command_fork)})}command_while(n,r){const i=ze(),s=ze();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=ze(),s=ze(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=ze(),s=ze(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=ze();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=hr(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}))}command_toast(n,r){const s=hr(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,"toast"),this.createstringnode(r,s)].flat()}))}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}token(n,r){if(n.token_label){const i=hr(n.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_stringliteraldouble){const i=hr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=hr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(hr(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return n.token_lparen?this.createcodenode(r,{type:31,words:this.go(n.words)}):[]}}const m4=new p4,Xn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},sh="zss.js";function te(t,e){return new u4(t.startLine??1,t.startColumn??1,sh,e)}function hp(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function fp(t){return`'${hp(t)}'`}function oh(t){if(t.startsWith('"'))return oh(t.replaceAll(/(^"|"$)/g,""));const e=J0(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===X0?`', api.get('${hp(r.image.substring(1))}'), '`:hp(r.image)).join("")}'].join('')`}function ha(t){return t.filter(e=>e!==void 0).map(se)}function AE(t){return te(t,"")}function g4(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function on(t,e,n){return te(t,[`api.${e}(`,...g4(n,", "),")"])}function _4(t){if(t.type===bt.COMPARE&&t.compare.type===bt.COMPARE_ITEM)switch(t.compare.method){case ao.IS_EQ:return on(t,"isEq",[se(t.lhs),se(t.rhs)]);case ao.IS_NOT_EQ:return on(t,"isNotEq",[se(t.lhs),se(t.rhs)]);case ao.IS_LESS_THAN:return on(t,"isLessThan",[se(t.lhs),se(t.rhs)]);case ao.IS_GREATER_THAN:return on(t,"isGreaterThan",[se(t.lhs),se(t.rhs)]);case ao.IS_LESS_THAN_OR_EQ:return on(t,"isLessThanOrEq",[se(t.lhs),se(t.rhs)]);case ao.IS_GREATER_THAN_OR_EQ:return on(t,"isGreaterThanOrEq",[se(t.lhs),se(t.rhs)])}return te(t,"")}function co(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",se(n),")"])}function RE(t,e,n){return t.prepend(`api.${e}(`),t.add([se(n),")"])}function y4(t,e){if(t.type===bt.OPERATOR_ITEM)switch(t.operator){case bi.PLUS:return co(e,"opPlus",t.rhs);case bi.MINUS:return co(e,"opMinus",t.rhs);case bi.POWER:return co(e,"opPower",t.rhs);case bi.MULTIPLY:return co(e,"opMultiply",t.rhs);case bi.DIVIDE:return co(e,"opDivide",t.rhs);case bi.MOD_DIVIDE:return co(e,"opModDivide",t.rhs);case bi.FLOOR_DIVIDE:return co(e,"opFloorDivide",t.rhs);case bi.UNI_PLUS:return RE(e,"opUniPlus",t.rhs);case bi.UNI_MINUS:return RE(e,"opUniMinus",t.rhs)}return te(t,"")}function b4(t){if(t.type===bt.OPERATOR){const e=t.lhs?se(t.lhs):te(t,"");return t.items.forEach(n=>y4(n,e)),e}return te(t,"")}function ah(t,e){return te(t,[on(t,"jump",[`${e}`]),"; continue;"])}function Yi(t){return Xn.linelookup[t??""]??-1}function dp(t,e){Xn.linelookup[t]=e}function fa(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case bt.WHILE:case bt.REPEAT:case bt.FOREACH:case bt.ELSE_IF:i.type===e&&(i.done=n);break;case bt.IF_BLOCK:case bt.IF_CHECK:i.type===e&&(i.skip=n);break;case bt.LINE:fa(i.stmts,e,n);break}}}function SE(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case bt.WHILE:case bt.REPEAT:case bt.FOREACH:case bt.ELSE_IF:i.type===e&&dp(i.done,n);break;case bt.IF_BLOCK:case bt.IF_CHECK:i.type===e&&dp(i.skip,n);break;case bt.LINE:SE(i.stmts,e,n);break}}}function se(t){var e;switch(t.type){case bt.PROGRAM:return te(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(se).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${sh}`]);case bt.API:return te(t,["  ",on(t,t.method,ha(t.words)),`;
`]);case bt.LINE:return te(t,[`case ${t.lineindex}:
`,...t.stmts.map(se).flat(),`  break;
`]);case bt.MARK:return te(t,`  // ${t.comment}
`);case bt.GOTO:{const n=Yi(t.id);return te(t,["  ",ah(t,n),`
`])}case bt.COUNT:return te(t,`${t.index}`);case bt.LITERAL:switch(t.literal){case ih.NUMBER:return te(t,`${t.value}`);case ih.STRING:return te(t,fp(t.value));case ih.TEMPLATE:return te(t,oh(t.value))}return AE(t);case bt.TEXT:return te(t,["  ",on(t,"text",[oh(t.value)]),`;
`]);case bt.STAT:if(Xn.isfirststat){Xn.isfirststat=!1;const n=t.value.trim().split(" ").map(fp);return te(t,["  ",on(t,"stat",n),`;
`])}return te(t,`  // skipped ${t.value}
`);case bt.LABEL:{const n=It(t.name),r=t.active?"label":"comment";Xn.labels[n]||(Xn.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return Xn.labels[n].push(i),te(t,`  // ${i} '${n}' ${r}
`)}case bt.HYPERLINK:return te(t,["  ",on(t,"hyperlink",[oh(t.text),...ha(t.link)]),`;
`]);case bt.MOVE:{const n=on(t,"command",[fp("go"),ha(t.words)].flat());return t.wait?te(t,["  if (",n,`) { continue; };
`]):te(t,["  ",n,`;
`])}case bt.COMMAND:return te(t,["  if (",on(t,"command",ha(t.words)),`) { continue; };
`]);case bt.IF:{const n=((e=t.block)==null?void 0:e.type)===bt.IF_BLOCK?t.block:void 0;if(x(n)){fa([t.check],bt.IF_CHECK,n.skip);const r=te(t,se(t.check));return n.lines.forEach(i=>r.add(se(i))),SE(n.altlines,bt.ELSE_IF,Yi(n.done)),n.altlines.forEach(i=>r.add(se(i))),r}return te(t,se(t.check))}case bt.IF_CHECK:{const n=Yi(t.skip);return n===-1?te(t,["  ",on(t,t.method,ha(t.words)),`;
`]):te(t,["  if (!",on(t,t.method,ha(t.words)),") { ",ah(t,n),` }
`])}case bt.ELSE_IF:case bt.ELSE:{const n=te(t,"");return t.lines.forEach(r=>n.add(se(r))),n}case bt.WHILE:{const n=Yi(t.loop),r=Yi(t.done),i=te(t,"");return fa(t.lines,bt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case bt.BREAK:s.goto=r;break;case bt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case bt.REPEAT:{const n=Yi(t.loop),r=Yi(t.done),i=te(t,"");return fa(t.lines,bt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case bt.BREAK:s.goto=r;break;case bt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case bt.WAITFOR:{const n=te(t,"");return fa(t.lines,bt.IF_CHECK,t.loop),t.lines.forEach(r=>{n.add(se(r))}),n}case bt.FOREACH:{const n=Yi(t.loop),r=Yi(t.done),i=te(t,"");return fa(t.lines,bt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case bt.BREAK:s.goto=r;break;case bt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case bt.BREAK:return te(t,["  ",ah(t,t.goto),`
`]);case bt.CONTINUE:return te(t,["  ",ah(t,t.goto),`
`]);case bt.OR:return on(t,"or",t.items.map(se));case bt.AND:return on(t,"and",t.items.map(se));case bt.NOT:return on(t,"not",t.items.map(se));case bt.COMPARE:return _4(t);case bt.OPERATOR:return b4(t);case bt.EXPR:return on(t,"expr",t.words.map(se));default:return console.error("<unsupported node>",t.type,t),AE(t)}}function wi(t){if(x(t))switch(t.type===bt.LINE&&++Xn.lineindex,t.lineindex=Xn.lineindex,t.type){case bt.PROGRAM:t.lines.forEach(wi);break;case bt.LINE:t.stmts.forEach(wi);break;case bt.MARK:dp(t.id,t.lineindex);break;case bt.IF:wi(t.check),wi(t.block);break;case bt.IF_BLOCK:t.lines.forEach(wi),t.altlines.forEach(wi);break;case bt.ELSE_IF:t.lines.forEach(wi);break;case bt.ELSE:case bt.WHILE:case bt.REPEAT:case bt.FOREACH:case bt.WAITFOR:t.lines.forEach(wi);break;case bt.MOVE:case bt.COMMAND:case bt.IF_CHECK:t.words.forEach(wi);break}}function w4(t){Xn.labels={},Xn.internal=1,Xn.lineindex=0,Xn.isfirststat=!0,wi(t)}function x4(t){return w4(t),{...se(t).toStringWithSourceMap({file:`${sh}.map`}),...Xn}}function OE(t){return ue(t)?t.length>0?1:0:t??0}function E4(t){return`${t}_chip`}function IE(t=""){return`vm:${t??""}`}function v4(t,e,n){var l,u;const r=E4(t),i=Or(r);let s;const o=tr(Object.entries(n.labels??{}));(!ue(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){w.words=d;const h=P5(e,f);return x(h)?h(c,d):f!=="send"?a("shortsend",[f,...d]):0}const c={halt(){B4(r)},id(){return t},set(f,d){const[h,p]=$5(e,c,f,d);if(h)return p},get(f){const[d,h]=D5(e,c,f);if(d)return h},tick(f){const d=kt(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return uE(e,c),!1;i.lc=0,i.ys=0,w.get=c.get,j5(e,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){de(tt,w.elementfocus,"crash",p.message),i.es=1}return uE(e,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return kt(i.lc)?++i.lc>Di.HALT_AT_COUNT:!0},hm(){if(ue(i.mg)&&ue(i.lb)){const[f]=i.mg;if(x(f))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f)return p.find(m=>kt(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,p){tt.emit(f,`${IE(d)}:${h}`,p)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(ue(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f){const p=h[1].findIndex(m=>m>0);if(p>=0&&x(h[1])){h[1][p]*=-1;break}}}},restore(f){if(ue(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f)for(let p=0;p<h[1].length;p++)h[1][p]=Math.abs(h[1][p])}},getcase(){i.ec=kt(i.ec)?i.ec:1;const f=c.hm();if(f&&ue(i.mg)){const[,d,h,p]=i.mg;c.set("sender",h),x(d)&&c.set("arg",d),p&&(c.set("player",p),w.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=kt(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=OF.parse(f),[h]=d.filter(p=>p.fileName===sh);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(It(Ue(d)),h)},if(...f){const[d,h]=rt(f,0,[j.ANY]),p=OE(d);return p&&h<f.length&&c.command(...f.slice(h)),p?1:0},try(...f){const[,d]=rt(f,0,[j.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,p]=rt(f,0,[j.NAME,j.ANY]),m=kt(h),b=m?p:1,_=c.get(d),v=m?h:1;if(!kt(_))return b<f.length&&c.command(...f.slice(b)),1;const T=_-v;return T<0?(b<f.length&&c.command(...f.slice(b)),1):(c.set(d,T),0)},give(...f){const[d,h,p]=rt(f,0,[j.NAME,j.ANY]),m=kt(h),b=m?p:1,_=c.get(d),v=m?h:1,T=_===void 0?1:0;return T&&b<f.length&&c.command(...f.slice(b)),c.set(d,Uc(_,0)+v),T},repeatstart(f,...d){const[h,p]=rt(d,0,[j.NUMBER]),m=`repeatcount${f}`,b=`repeatwords${f}`;i[m]=h,i[b]=p<d.length?d.slice(p):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!kt(i[d]))return 0;const p=i[d];i[d]=p-1;const m=p>0,b=i[h];return m&&ue(b)&&c.command(...b),m?1:0},foreachstart(f,...d){const[h,p,m,b]=rt(d,0,[j.NAME,j.NUMBER,j.NUMBER,j.MAYBE_NUMBER]);let _=Math.min(p,m),v=Math.max(p,m);const T=(b??0)||1;if(T<0){const A=_;_=v,v=A}return c.set(h,_-T),0},foreach(f,...d){const[h,p,m,b,_]=rt(d,0,[j.NAME,j.NUMBER,j.NUMBER,j.MAYBE_NUMBER]);let v=Math.min(p,m),T=Math.max(p,m);const A=(b??0)||1;if(A<0){const S=v;v=T,T=S}let C=c.get(h);!kt(C)||C<v||C>T?C=v:C+=A;const R=C<=T?1:0;return R&&(c.set(h,C),_<d.length&&c.command(...d.slice(_))),R},waitfor(...f){const[d]=rt(f,0,[j.ANY]),h=OE(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[j.ANY]);if(d=p,d)break;h=m}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[j.ANY]);if(d=p,!d)break;h=m}return d},not(...f){const[d]=rt(f,0,[j.ANY]);return d?0:1},expr(f){return f},isEq(f,d){const[h]=rt([f],0,[j.ANY]),[p]=rt([d],0,[j.ANY]);return typeof h=="object"||typeof p=="object"?Bv(h,p)?1:0:h===p?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=rt([f],0,[j.NUMBER]),[p]=rt([d],0,[j.NUMBER]);return h<p?1:0},isGreaterThan(f,d){const[h]=rt([f],0,[j.NUMBER]),[p]=rt([d],0,[j.NUMBER]);return h>p?1:0},isLessThanOrEq(f,d){const[h]=rt([f],0,[j.NUMBER]),[p]=rt([d],0,[j.NUMBER]);return h<=p?1:0},isGreaterThanOrEq(f,d){const[h]=rt([f],0,[j.NUMBER]),[p]=rt([d],0,[j.NUMBER]);return h>=p?1:0},opPlus(f,d){const[h]=rt([f],0,[j.ANY]),[p]=rt([d],0,[j.ANY]);return h+p},opMinus(f,d){const[h]=rt([f],0,[j.ANY]),[p]=rt([d],0,[j.ANY]);return h-p},opPower(f,d){const[h]=rt([f],0,[j.NUMBER]),[p]=rt([d],0,[j.NUMBER]);return Math.pow(h,p)},opMultiply(f,d){const[h]=rt([f],0,[j.NUMBER]),[p]=rt([d],0,[j.NUMBER]);return h*p},opDivide(f,d){const[h]=rt([f],0,[j.NUMBER]),[p]=rt([d],0,[j.NUMBER]);return h/p},opModDivide(f,d){const[h]=rt([f],0,[j.NUMBER]),[p]=rt([d],0,[j.NUMBER]);return h%p},opFloorDivide(f,d){const[h]=rt([f],0,[j.NUMBER]),[p]=rt([d],0,[j.NUMBER]);return Math.floor(h/p)},opUniPlus(f){const[d]=rt([f],0,[j.NUMBER]);return+d},opUniMinus(f){const[d]=rt([f],0,[j.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function pp(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];ue(r)?r.forEach(i=>{e.push(pp(i))}):e.push(pp(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function k4(t){const e=ux(`${t}
`);if(e.errors.length>0)return e;ua.input=e.tokens;const n=ua.program();if(ua.errors.length>0)return{tokens:e.tokens,errors:ua.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=m4.go(n);return r?(pp(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const mp=Object.getPrototypeOf(function*(){}).constructor;function T4(t,e){const n=`compile-${t}`;console.time(n);const r=k4(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=x4(r.ast);if(i.code){rF&&console.info(i.code);try{return{...r,...i,source:i.code,code:new mp("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new mp("api"," ")}}}return{...r,...i,source:"",code:new mp("api"," ")}}function A4(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=T4(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return x(s)?s.isended():!0},halt(i){const s=e[i];return x(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];x(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=e[i];if(!x(e[i])){const f=n(a,c);if(l=e[i]=v4(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((_,v)=>[_,v]);p.slice(h-5,h).forEach(([_,v])=>{de(tt,dr(),"build",`$grey${v+1} $grey${_}`)});const[m,b]=p[h]??[];if(gt(m)&&x(b)){const _=(d.column??1)-1,v=_+d.length,T=_<m.length?m:`${m}*`,A=T.substring(0,_),C=T.substring(_,v),R=T.substring(v);de(tt,dr(),"build",`$red${b+1} $grey${A}$red${C}$grey${R}`)}return d.message.split(`
`).forEach(_=>{de(tt,dr(),"build",_)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=er(i.target),a=e[s];if(x(a)){const c={...i,target:o};a.message(c)}}};return r}const kn=new Qa,Cn={},ch={};function NE(t,e,n,r,i,s=0){const o=`tiles:${t}:${e}`;return x(Cn[o])||(Cn[o]=EN(t,e,n,r,i,s)),Cn[o]}function R4(t,e,n,r){const i=`sprites:${t}:${e}:${n}`,s=`sprite:${t}:${e}:${r}`;return x(ch[s])||(ch[s]=vN(t,e,n)),ch[s].id=i,ch[s]}function S4(t,e){const n=`sprites:${t}:${e}`;return x(Cn[n])||(Cn[n]=kN(t,e)),Cn[n]}function O4(t,e,n,r,i=0){const s=`dither:${t}:${e}`;return x(Cn[s])||(Cn[s]=TN(t,e,n,r,i)),Cn[s]}function lh(t,e,n,r){const i=`media:${t}:${e}`;x(Cn[i])||(Cn[i]=AN(t,e,n,r));const s=Cn[i];return s.mime=n,s.media=r,s}function I4(t,e){const n=`control:${t}:${e}`;return x(Cn[n])||(Cn[n]=RN(t,e)),Cn[n]}const vs=3;function CE(t,e){const n=[],r=(t.x+.5)*us,i=(t.y+.5)*hs,s=e.x*us,o=e.y*hs,a=s-r,c=o-i;kn.x=a-vs,kn.y=c-vs,n.push(kn.angle()),kn.x=a+us+vs,kn.y=c-vs,n.push(kn.angle()),kn.x=a-vs,kn.y=c+hs+vs,n.push(kn.angle()),kn.x=a+us+vs,kn.y=c+hs+vs,n.push(kn.angle());const l=n.map(h=>Math.round(yy(h))),u=Math.min(...l),f=Math.max(...l);if(f-u>180){const h=l.filter(_=>_<180),p=l.filter(_=>_>180),m=Math.max(...h);return[Math.min(...p),m]}return[u,f]}function uh(t,e,n,r,i,s,o,a,c,l){var A;const u={x:c,y:l},f=Pr(e,u);if(f===-1)return;kn.x=c-s.x,kn.y=l-s.y;const d=kn.length();if(d>o)return;const h=Math.round(yy(kn.angle()));let p=0;for(let C=0;C<r.length;++C){const[R,S,U]=r[C];R>S?(h>=R||h<=S)&&(p=Math.max(p,U)):h>=R&&h<=S&&(p=Math.max(p,U))}const m=o*.5;n[f]=Math.min(n[f],p+(d<m?0:(d-m)*a)),n[f]=tn(n[f],0,1);const b=Sn(e,((A=e.lookup)==null?void 0:A[f])??"");if(x(b)){const C=[...CE(s,u),.25];i.push(C)}const _=e.terrain[f],v=_s(t,_),T=(_==null?void 0:_.collision)??(v==null?void 0:v.collision);if(ac(Ut.ISBULLET,T)){const C=[...CE(s,u),1];i.push(C)}}function gp(t,e,n,r,i,s,o){if(!x(r)||!x(r.terrain)||!x(r.objects))return[];const a=[];let c=e;const l=Tt,u=Ht,f=o?At.BLACK:At.ONCLEAR,d=NE(t,c++,"terrain",l,u,f);a.push(d);const h=c++,p=S4(t,h);p.sprites=[],a.push(p);const m=r.isdark?1:0,b=O4(t,c++,l,u,m);a.push(b),b.alphas.fill(m);const _=NE(t,c++,"tickers",l,u,At.ONCLEAR);a.push(_),_.char.fill(0);const v={...Q0(Tt,Ht,i,At.ONCLEAR),..._},T=I4(t,c++);if(s){a.push(T);const{graphics:U,camera:I,facing:P}=Or(t),W=r.graphics??U??"",L=r.camera??I??"",N=r.facing??P??"";if(gt(W)){const E=It(W);switch(E){case"fpv":case"iso":case"mode7":T.graphics=E;break;default:case"flat":T.graphics="flat";break}}if(gt(L))switch(It(L)){default:case"mid":T.viewscale=tu.MID;break;case"near":T.viewscale=tu.NEAR;break;case"far":T.viewscale=tu.FAR;break}kt(N)&&(T.facing=_y(N%360))}for(let U=0;U<r.terrain.length;++U){const I=r.terrain[U],P=na(n,I,0,At.WHITE,o?At.BLACK:At.ONCLEAR),W=ie(n,I,"collision");d.char[U]=P.char,d.color[U]=P.color,d.bg[U]=P.bg,d.wall[U]=W===Ut.ISSOLID?1:0}const A=Object.values(r.objects??{});for(let U=0;U<A.length;++U){const I=A[U];if(gt(I.tickertext)&&kt(I.tickertime)&&I.tickertext.length){const N=Tt,E=Bx(I.tickertext,N,Ht-1),D=(E==null?void 0:E.measuredwidth)??1,Z=I.x??0,$=I.y??0,st=$<Ht*.5;v.x=Z-Math.floor(D*.5),v.y=$+(st?1:-1),v.x+D>Tt&&(v.x=Tt-D),v.x<0&&(v.x=0),Fx(I.tickertext,v,!0)}if(x(I.removed))continue;const P=I.id??"",W=na(n,I,1,At.WHITE,At.BLACK),L=R4(t,h,P,U);if(L.x=I.x??0,L.y=I.y??0,L.char=W.char,L.color=W.color,L.bg=W.bg,p.sprites.push(L),m){if(W.light>0){const N=Pr(r,L),E=tn(Math.round(W.light),1,Ht),D=1/(E*.5);if(b.alphas[N]=0,E>1){const Z=[];for(let $=1;$<=E;++$){if($===2){const at=ie(n,I,"lightdir");if(Br(at)){const Y=Yu(n,r,I,"",at,L);switch(Fr(L,Y.destpt)){case dt.EAST:Z.push([45,315,1]);break;case dt.WEST:Z.push([225,135,1]);break;case dt.NORTH:Z.push([315,225,1]);break;case dt.SOUTH:Z.push([135,45,1]);break}}}const st=[];for(let at=L.y-$;at<=L.y+$;++at)uh(n,r,b.alphas,Z,st,L,E,D,L.x-$,at),uh(n,r,b.alphas,Z,st,L,E,D,L.x+$,at);const nt=$-1;for(let at=L.x-nt;at<=L.x+nt;++at)uh(n,r,b.alphas,Z,st,L,E,D,at,L.y-$),uh(n,r,b.alphas,Z,st,L,E,D,at,L.y+$);for(let at=0;at<st.length;++at){const Y=st[at];let H=0;for(H=0;H<Z.length;++H){const wt=Z[H];if(wt[1]>wt[0]&&Y[1]>=wt[0]&&Y[0]<=wt[1]&&Y[2]>=1&&wt[2]>=1){Z[H]=[Math.min(Y[0],wt[0]),Math.max(Y[1],wt[1]),1];break}}H===Z.length&&Z.push(Y)}}}}else if(Fn(P)){const N=Pr(r,L);b.alphas[N]=0}}P===t&&(T.focusx=L.x,T.focusy=L.y,T.focusid=P)}a.push(lh(t,c++,"text/mood",m?"dark":"bright"));const C=oe(Lt.MAIN),R=Ki(C,Lt.MAIN);if(gt(R.palette)){const U=Ye(C,_t.PALETTE,R.palette),I=Ee(U);x(I==null?void 0:I.bits)&&a.push(lh(t,c++,"image/palette",Array.from(I.bits)))}if(gt(R.charset)){const U=Ye(C,_t.CHARSET,R.charset),I=Ee(U);x(I==null?void 0:I.bits)&&a.push(lh(t,c++,"image/charset",Array.from(I.bits)))}const S=Object.keys(r.objects).filter(Fn);return a.push(lh(t,c++,"text/players",S.join(","))),a}const fr=A4();var Lt=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(Lt||{});const ve={halt:!1,session:ze(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function N4(){return ve.session}function dr(){return ve.operator}function C4(t){ve.operator=t}function L4(t){ve.halt=t}function M4(){return ve.halt}function lo(){return[...ve.books.values()]}function U4(){const[t]=ve.books.values();return t}function Hr(t){const e=It(t);return ve.books.get(t)??lo().find(n=>n.name===e)}function hh(t,e){x(Hr(e))&&(ve.software[t]=e)}function oe(t){return Hr(ve.software[t])}function LE(t){const e=mx([]);return gt(t)&&(e.name=t),_p(e),pe(tt,ve.operator,`created [book] ${e.name}`),e}function F4(t){let e=Hr(t);return x(e)||(e=mx([]),e.name=t),_p(e),pe(tt,ve.operator,`created [book] ${e.name}`),e}function fn(t,e){let n=x(e)?F4(e):oe(t);return x(n)||(x(n)||(n=U4()),x(n)||(n=LE(e)),x(n)&&pe(tt,ve.operator,`opened [book] ${n.name} for ${t}`)),hh(t,n.id),n}function ks(t,e,n){return $0(fn(t),n,e)}function Or(t){const e=fn("main");return Ki(e,t)}function ME(t){const e=fn("main");return gF(e,t)}function UE(){const t=fn("main");return Ki(t,"main")}function B4(t){const e=fn("main");return wx(e,t)}function P4(t,e){ve.books.clear(),t.forEach(r=>{ve.books.set(r.id,r),r.name==="main"&&(ve.software.main=r.id)});const n=Hr(e);if(x(n)&&hh("main",n.id),!ve.software.main){const r=ve.books.values().next();r.value&&(ve.software.main=r.value.id)}}function _p(t){return ve.books.set(t.id,t),t.id}function D4(t){const e=Hr(t);e&&ve.books.delete(e.id)}function FE(t){if(!gt(t)||!t)return de(tt,t,"login",`failed for playerid ==>${t}<==`);const e=oe("main");if(!x(e))return de(tt,t,"login:main","login failed to find book 'main'");const n=so(e,t);if(x(n))return!0;const r=Yn(e,_t.BOARD,"title");if(r.length===0)return de(tt,t,"login:title","login failed to find board with 'title' stat");const i=io(e,"player");if(!x(i))return de(tt,t,"login:player","login failed to find object type 'player'");const s=xy(t,r),o=Ee(s);if(x(o)){const a=B0(s,"startx"),c=B0(s,"starty"),l=kt(a)?a:Math.round(Tt*.5),u=kt(c)?c:Math.round(Ht*.5),f=i.name??"player",d=Td(o,{x:l,y:u},f,t);if(x(d==null?void 0:d.id))return d.player=t,Gu(e,t,o.id),!0}return!1}function $4(t){const e=oe("main"),n=so(e,t);if(!x(e))return;const r=[t];for(let i=0;i<e.activelist.length;++i){const s=e.activelist[i];s.startsWith(t)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];Gu(e,s,""),z0(e,n,Sn(n,s)),sb(n,s),fr.halt(s),wx(e,s)}}function Ln(t){const e=oe("main");return so(e,t)}function j4(t){const e=oe("main"),n=yF(e,t),r=so(e,t),i=Sn(r,t);return n&&x(i)}function z4(t){const e=oe("main"),n=ia(e);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Fn(c)&&x(t[c])===!1&&(t[c]=0,Gu(e,c,i.id))}}}function BE(t){fr.message(t)}function $e(t,e,n,r){const i=ci(e);gt(n.id)&&tt.emit(t,"vm:touched",[n.id,i,r])}function K4(t,e,n,r){const i=n.id??"";if(r.x<0){const s=Yn(t,_t.BOARD,(e==null?void 0:e.exitwest)??"");if(s.length){const o=Ae(s);ra(t,i,o.id,{x:Tt-1,y:r.y})}}else if(r.x>=Tt){const s=Yn(t,_t.BOARD,(e==null?void 0:e.exiteast)??"");if(s.length){const o=Ae(s);ra(t,i,o.id,{x:0,y:r.y})}}else if(r.y<0){const s=Yn(t,_t.BOARD,(e==null?void 0:e.exitnorth)??"");if(s.length){const o=Ae(s);ra(t,i,o.id,{x:r.x,y:Ht-1})}}else if(r.y>=Ht){const s=Yn(t,_t.BOARD,(e==null?void 0:e.exitsouth)??"");if(s.length){const o=Ae(s);ra(t,i,o.id,{x:r.x,y:0})}}}function Ts(t,e,n,r){if(!x(n==null?void 0:n.id))return!1;const i=W0(t,e,n,r);if(x(i)){const s=Fn(n.id),o=Fn(n.party??n.id),a=ie(t,n,"collision")===Ut.ISBULLET;let c="";n.party&&o&&(c=n.party),s&&(c=n.id);const l=Fn(i.id),u=Fn(i.party??i.id),f=ie(t,i,"collision")===Ut.ISBULLET;let d="";if(i.party&&u&&(d=i.party),l&&(d=i.id??""),s&&i.kind==="edge"?K4(t,e,n,r):s?l?($e("",i,n,"bump"),$e("",n,i,"bump")):f?o===u?($e("",i,n,"thud"),$e("",n,i,"partyshot")):($e(d,i,n,"thud"),$e(c,n,i,"shot")):($e(d,i,n,"thud"),$e(c,n,i,"touch")):a?f?($e("",i,n,"thud"),$e("",n,i,"thud")):o===u?($e("",i,n,"thud"),$e("",n,i,"partyshot")):($e(d,i,n,"thud"),$e(c,n,i,"shot")):l?($e(d,i,n,"bump"),$e(c,n,i,"touch")):f?o===u?($e("",i,n,"partyshot"),$e("",n,i,"thud")):($e(d,i,n,"shot"),$e(c,n,i,"thud")):($e("",i,n,"thud"),$e("",n,i,"bump")),ie(t,i,"breakable")){if(x(i==null?void 0:i.id)){const h=Jt(e,{x:i.x??-1,y:i.y??-1});x(h)&&En(w.book,w.board,h,w.timestamp)}else Se(e,{x:r.x,y:r.y});return!0}return!1}return!0}function PE(t,e,n,r,i=pg){var u;if(!x(t)||!x(e)||!x(n))return;const s={...w};w.book=t,w.board=e,w.element=n,w.elementid=n.id??"",w.elementisplayer=Fn(w.elementid);const o=w.element.player??ve.operator;w.elementfocus=w.elementisplayer?w.elementid:o;const a=ie(t,n,"cycle")??i,c=n.id??"",l=It(n.name??((u=n.kinddata)==null?void 0:u.name)??"");if(fr.tick(c,Es.RUNTIME,a,l,r),kt(n==null?void 0:n.tickertime)&&w.timestamp-n.tickertime>ll*5&&(n.tickertime=0,n.tickertext=""),w.elementisplayer){const f=Or(w.elementid);kt(f.inputcurrent)&&(f.inputcurrent=0)}pr(s).forEach(f=>{w[f]=s[f]})}function W4(t,e){ve.loaders.set(t,e)}function H4(t){fr.halt(t)}function G4(){const t=fr.ids();for(let n=0;n<t.length;++n)fr.halt(t[n]);const e=oe("main");x(e)&&(e.flags={})}function Y4(t=!1){const e=oe("main");if(!x(e))return;const n=e.timestamp+1,r=Di.HALT_AT_COUNT;Di.HALT_AT_COUNT=r*2,ve.loaders.forEach((s,o)=>{const a={...w};w.timestamp=e.timestamp,w.book=e,w.board=void 0,w.element=void 0,w.elementid=o,w.elementisplayer=!1,w.elementfocus=dr();const c=X$(o);x(c)&&fr.arg(o,c),fr.tick(o,Es.LOADER,1,"loader",s),fr.isended(o)&&(fr.halt(o),ve.loaders.delete(o)),pr(a).forEach(l=>{w[l]=a[l]})}),Di.HALT_AT_COUNT=r,e.timestamp=n,w.timestamp=n;const i=ia(e);for(let s=0;s<i.length;++s){const o=i[s],a=AF(e,o,n);for(let c=0;c<a.length;++c){const{id:l,type:u,code:f,object:d}=a[c];u===_t.ERROR?fr.halt(l):(!t||Fn((d==null?void 0:d.id)??""))&&PE(e,o,d,f)}}}function da(t,e,n,r){const i=oe("main");if(!x(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(x(c.id)){const l=`${IE(c.id)}:${e}`;tt.emit("",l,n)}}}if(Gs(t)){for(let o=0;o<r.length;++o){const a=r[o],c=Jt(a,t);x(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(It(t)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(ob(a,[t]));break}}}}function V4(t){const e=Or(t),n=e.playbuffer=gt(e.playbuffer)?e.playbuffer:"";n&&DE(t,n,!1)}function DE(t,e,n=!0){var o;const r=fn("main");if(!x(r))return;const i=`${t}_cli`;w.timestamp=r.timestamp,w.book=r,w.board=so(r,t),w.element=Sn(w.board,t),w.elementid=((o=w.element)==null?void 0:o.id)??"",w.elementisplayer=!0,w.elementfocus=w.elementid||t;const s=Di.HALT_AT_COUNT;if(Di.HALT_AT_COUNT=s*8,fr.once(i,Es.CLI,"cli",e),n){const a=Or(t);a.playbuffer=e}Di.HALT_AT_COUNT=s}function fh(t){var a;const e=fn("main"),n=zi(e,t);if(!x(e)||!x(n)||!x(w.element))return;const r={...w},i=`${t}_run`,s=It(w.element.name??((a=w.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";fr.once(i,Es.RUNTIME,s,o),pr(r).forEach(c=>{w[c]=r[c]})}function Z4(t,e){const n=oe("main"),r=so(n,t),i=[],s=[],o=[];if(!x(n)||!x(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=ys(n,r.overboard??""),l=ys(n,r.underboard??"");return s.push(...gp(t,0,n,l,e,!1,!0)),o.push(...gp(t,s.length,n,r,e,!0,a!=="flat")),i.push(...gp(t,s.length+o.length,n,c,e,!1,!1)),{over:i,under:s,layers:o}}function pa(t,e=0){const n=[];let r=t;for(;r<w.words.length;){const[i,s]=qn(r);if(ue(i)&&!Br(i)&&!Pc(i)&&!Zu(i)&&!oi(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),e>0&&n.length>=e)return[n,r]}return[n,r]}function qn(t){var r,i,s,o,a,c,l,u,f;const e=w.words[t],n=t+1;if(Wx(e)){const[d,h]=z$(t);if(x(d))return[d,h]}if(K$(e)){const[d,h]=W$(t);if(x(d))return[d,h]}if(jl(e)){const[d,h]=fd(t);if(x(d))return[d,h]}if(gt(e)&&It(e)==="rnd"){const[d,h]=qn(n),[p,m]=qn(h);return kt(d)&&kt(p)?[wr(d,p),m]:kt(d)?[wr(0,d),h]:[wr(0,1),n]}if(hd(e)){const[d,h]=ky(t);if(x(d))return[d,h]}if(!x(e))return[void 0,t];if(kt(e)||ue(e))return[e,n];if(gt(e)){const d=It(e),h=(r=w.get)==null?void 0:r.call(w,e);if(x(h))return[h,n];switch(d){case"aligned":case"alligned":{const p=cc(w.board,{x:((i=w.element)==null?void 0:i.x)??-1,y:((s=w.element)==null?void 0:s.y)??-1},w.elementfocus);return!x(w.element)||!x(p)?[0,n]:[w.element.x===p.x||w.element.y===p.y?1:0,n]}case"contact":{const p=cc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus);if(!x(w.element)||!x(p))return[0,n];const m=(p.x??0)-(((c=w.element)==null?void 0:c.x)??0),b=(p.y??0)-(((l=w.element)==null?void 0:l.y)??0);return[m===0&&Math.abs(b)<2||b===0&&Math.abs(m)<2?1:0,n]}case"blocked":{const[p,m]=rt(w.words,n,[j.DIR]);return[kF(w.book,w.board,w.element,p.destpt)?1:0,m]}case"any":{const[p,m]=rt(w.words,n,[j.KIND]);return[Ad(w.board,p).length?1:0,m]}case"count":{const[p,m]=rt(w.words,n,[j.KIND]);return[Ad(w.board,p).length,m]}case"color":{const[p,m,b]=rt(w.words,n,[j.DIR,j.COLOR]),_=p.layer===dt.MID?Jt(w.board,p.destpt):ls(w.board,p.destpt.x,p.destpt.y);if(x(_)){const v=na(w.book,_,-1,-1,-1);return[Ry(m)===v.color||Sy(m)===v.bg?1:0,b]}return[0,b]}case"detect":{const[p,m,b]=rt(w.words,n,[j.DIR,j.KIND]),_=p.layer===dt.MID?Jt(w.board,p.destpt):ls(w.board,p.destpt.x,p.destpt.y);if(x(_)){const v=It(zl(m)),T=dd(m),A=na(w.book,_,-1,-1,-1);if(v&&v===It(ci(_)))return[1,b];if(x(T)&&T===A.color)return[1,b]}return[0,b]}case"rnd":return[wr(0,1),n];case"abs":{const[p,m]=rt(w.words,n,[j.NUMBER]);return[Math.abs(p),m]}case"intceil":{const[p,m]=rt(w.words,n,[j.NUMBER]);return[Math.ceil(p),m]}case"intfloor":{const[p,m]=rt(w.words,n,[j.NUMBER]);return[Math.floor(p),m]}case"intround":{const[p,m]=rt(w.words,n,[j.NUMBER]);return[Math.round(p),m]}case"clamp":{const[p,m,b,_]=rt(w.words,n,[j.NUMBER,j.NUMBER,j.NUMBER]);return[tn(p,m,b),_]}case"min":{const[p,m]=pa(n);return[Math.min(...p),m]}case"max":{const[p,m]=pa(n);return[Math.max(...p),m]}case"pick":{const[p,m]=pa(n);return[Ae(p),m]}case"pickwith":{const[p,m]=rt(w.words,n,[j.NUMBER_OR_STRING]),[b,_]=pa(m);return[xy(`${p}`,b),_]}case"random":{const[p,m]=pa(n,2),[b,_]=p;return[wr(b,_??0),m]}case"randomwith":{const[p,m]=rt(w.words,n,[j.NUMBER_OR_STRING]),[b,_]=pa(m,2),[v,T]=b;return[by(`${p}`,v,T??0),_]}case"run":{const[p,m]=rt(w.words,n,[j.NAME]);return fh(p),[(u=w.get)==null?void 0:u.call(w,"arg"),m]}case"runwith":{const[p,m,b]=rt(w.words,n,[j.ANY,j.NAME]);return x(w.element)&&(w.element.arg=p),fh(m),[(f=w.get)==null?void 0:f.call(w,"arg"),b]}}}return[e,n]}const w={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var j=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.MAYBE_KIND=7]="MAYBE_KIND",t[t.MAYBE_NAME=8]="MAYBE_NAME",t[t.MAYBE_NUMBER=9]="MAYBE_NUMBER",t[t.MAYBE_STRING=10]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",t[t.ANY=12]="ANY",t))(j||{});function Tn(t,e,n){throw console.info(n,w.element,w.elementid,w.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function $E(t){var n,r;const e={x:((n=w.element)==null?void 0:n.x)??0,y:((r=w.element)==null?void 0:r.y)??0};return Yu(w.book,w.board,w.element,w.elementfocus,t,e)}function rt(t,e,n){const r=w.words;w.words=t;const i=[];let s=e;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=Ny(s);Ho(a)?(s=c,i.push(a)):Tn("kind",a,t);break}case 0:{if(jl(t[0])===void 0){const[a,c]=qn(s);oi(a)?(s=c,i.push(a)):Tn("color",a,t)}else{const[a,c]=fd(s);oi(a)?(s=c,i.push(a)):Tn("color",a,t)}break}case 2:{if(hd(t[0])===void 0){const[a,c]=qn(s);Br(a)?(s=c,i.push($E(a))):Tn("direction",a,t)}else{const[a,c]=ky(s);Br(a)?(s=c,i.push($E(a))):Tn("direction",a,t)}break}case 3:{const a=w.words[s];gt(a)||Tn("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=qn(s);if(gt(a)){const l=parseFloat(a);kt(l)?i.push(l):Tn("number",a,t)}else kt(a)?i.push(a):Tn("number",a,t);s=c;break}case 5:{const[a,c]=qn(s);gt(a)||Tn("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=qn(s);let l=a;if(gt(l)){const u=parseFloat(l);kt(u)&&(l=u)}else kt(l)||Tn("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=Ny(s);a!==void 0&&!Ho(a)&&Tn("optional kind",a,t),s=c,i.push(a);break}case 8:{const a=w.words[s];a!==void 0&&!gt(a)&&Tn("optional string",a,t),++s,i.push(a);break}case 9:{const[a,c]=qn(s);if(gt(a)){const l=parseFloat(a);kt(l)?i.push(l):Tn("optional number",a,t)}else kt(a)||a===void 0?i.push(a):Tn("optional number",a,t);s=c;break}case 10:{const[a,c]=qn(s);a!==void 0&&!gt(a)&&Tn("optional string",a,t),s=c,i.push(a);break}case 11:{const[a,c]=qn(s);let l=a;if(gt(l)){const u=parseFloat(l);kt(u)&&(l=u)}else l!==void 0&&!kt(l)&&Tn("number or string",l,t);s=c,i.push(l);break}case 12:{const[a,c]=qn(s);s=c,i.push(a);break}}return w.words=r,[...i,s]}const dh={},ma={};function yp(){return{id:ze(),layers:[],scroll:[],sidebar:[]}}const X4=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),q4=new Set(["tx","text"]),J4={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},jE={};let zE=t=>{let e=jE[t];return x(e)||(jE[t]=e=yp()),e};function Q4(t){zE=t}function qe(t){return zE(t)}function bp(t){return x(dh[t])||(dh[t]=[]),dh[t]}function tj(t){const e=qe(t);e.scroll=[]}function ej(t,e,n){Object.values(ma).forEach(r=>{if(r[e]!==void 0){const i=lb(t.id(),e);kt(n)&&EI(i,n),gt(n)&&vI(i,n)}})}function Mn(t){const e=bp(t);return dh[t]=[],e}function Mt(t,e){bp(t).push(e)}function Ot(t,e,n,r,i=()=>0,s=Sh){const o=[e,n,...r],a=It(`${o[3]}`),c={...w};function l(u,f){x(f)&&f!==i(u)&&(w.board=c.board,w.element=c.element,w.elementfocus=c.elementfocus,s(u,f))}if(X4.has(a)){const u=`${o[2]}`;ma[e]=ma[e]??{};const f=i(u)??J4[a];if(ma[e][u]===void 0){const d=lb(e,u);kt(f)&&xI(d,f),gt(f)&&id(d,f),q4.has(a)?ma[e][u]=ay(d,h=>{l(u,h)}):ma[e][u]=kI(d,h=>{l(u,h)})}}bp(t).push(o)}Q4(t=>{if(Fn(t)){const e=oe(Lt.MAIN),n=Ki(e,Lt.GADGETSTORE);let r=n[t];return x(r)||(n[t]=r=yp()),r}return yp()});let KE=0;function nj(){switch(KE++){case 0:return At.BLUE;case 1:return At.BLACK;case 2:return At.GREEN;case 3:return At.BLACK;case 4:return At.CYAN;case 5:return At.BLACK;case 6:return At.RED;case 7:return At.BLACK;case 8:return At.PURPLE;case 9:return At.BLACK;case 10:return At.YELLOW;case 11:return At.BLACK;case 12:return At.WHITE;default:return KE=0,At.BLACK}}const ph=po("gadgetserver",["tock","second"],t=>{if(!ph.session(t))return;const e=oe(Lt.MAIN),n=(e==null?void 0:e.activelist)??[],r=Ki(e,Lt.GADGETSYNC);switch(t.target){case"tock":{const i=nj();for(let s=0;s<n.length;++s){const o=n[s],{over:a,under:c,layers:l}=Z4(o,i),u=qe(o);u.over=a,u.under=c,u.layers=l;const f=r[o]??{},d=Dp(f,u);d.length&&(r[o]=tr(u),VA(ph,o,d))}break}case"second":for(let i=0;i<n.length;++i){const s=n[i],o=Ln(s);x(o)&&aR(ph,s,o.id)}break;case"desync":YA(ph,t.player,qe(t.player));break;case"clearscroll":tj(t.player);break;case"clearplayer":{const i=oe(Lt.MAIN),s=Ki(i,Lt.GADGETSTORE);delete s[t.player];const o=Ki(i,Lt.GADGETSYNC);delete o[t.player];break}}});function mh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var WE={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof mh=="function"&&mh;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(p){var m=r[l][1][p];return o(m||p)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof mh=="function"&&mh,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,p,m,b=[],_=0,v=c.length,T=v,A=s.getTypeOf(c)!=="string";_<c.length;)T=v-_,f=A?(l=c[_++],u=_<v?c[_++]:0,_<v?c[_++]:0):(l=c.charCodeAt(_++),u=_<v?c.charCodeAt(_++):0,_<v?c.charCodeAt(_++):0),d=l>>2,h=(3&l)<<4|u>>4,p=1<T?(15&u)<<2|f>>6:64,m=2<T?63&f:64,b.push(a.charAt(d)+a.charAt(h)+a.charAt(p)+a.charAt(m));return b.join("")},i.decode=function(c){var l,u,f,d,h,p,m=0,b=0,_="data:";if(c.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var v,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=o.uint8array?new Uint8Array(0|T):new Array(0|T);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(m++)))>>2,f=(3&h)<<6|(p=a.indexOf(c.charAt(m++))),v[b++]=l,h!==64&&(v[b++]=u),p!==64&&(v[b++]=f);return v}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,p){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,p){var m,b="";for(m=0;m<p;m++)b+=String.fromCharCode(255&h),h>>>=8;return b}function o(h,p,m,b,_,v){var T,A,C=h.file,R=h.compression,S=v!==l.utf8encode,U=a.transformTo("string",v(C.name)),I=a.transformTo("string",l.utf8encode(C.name)),P=C.comment,W=a.transformTo("string",v(P)),L=a.transformTo("string",l.utf8encode(P)),N=I.length!==C.name.length,E=L.length!==P.length,D="",Z="",$="",st=C.dir,nt=C.date,at={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(at.crc32=h.crc32,at.compressedSize=h.compressedSize,at.uncompressedSize=h.uncompressedSize);var Y=0;p&&(Y|=8),S||!N&&!E||(Y|=2048);var H=0,wt=0;st&&(H|=16),_==="UNIX"?(wt=798,H|=function(ht,jt){var ae=ht;return ht||(ae=jt?16893:33204),(65535&ae)<<16}(C.unixPermissions,st)):(wt=20,H|=function(ht){return 63&(ht||0)}(C.dosPermissions)),T=nt.getUTCHours(),T<<=6,T|=nt.getUTCMinutes(),T<<=5,T|=nt.getUTCSeconds()/2,A=nt.getUTCFullYear()-1980,A<<=4,A|=nt.getUTCMonth()+1,A<<=5,A|=nt.getUTCDate(),N&&(Z=s(1,1)+s(u(U),4)+I,D+="up"+s(Z.length,2)+Z),E&&($=s(1,1)+s(u(W),4)+L,D+="uc"+s($.length,2)+$);var lt="";return lt+=`
\0`,lt+=s(Y,2),lt+=R.magic,lt+=s(T,2),lt+=s(A,2),lt+=s(at.crc32,4),lt+=s(at.compressedSize,4),lt+=s(at.uncompressedSize,4),lt+=s(U.length,2),lt+=s(D.length,2),{fileRecord:f.LOCAL_FILE_HEADER+lt+U+D,dirRecord:f.CENTRAL_FILE_HEADER+s(wt,2)+lt+s(W.length,2)+"\0\0\0\0"+s(H,4)+s(b,4)+U+D+W}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,p,m,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-b-1))/m:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=o(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=o(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(b){return f.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,b=function(_,v,T,A,C){var R=a.transformTo("string",C(A));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(_,2)+s(_,2)+s(v,4)+s(T,4)+s(R.length,2)+R}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var p=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var p=function(v,T){var A=v||T,C=s[A];if(!C)throw new Error(A+" is not a valid compression method !");return C}(h.options.compression,c.compression),m=h.options.compressionOptions||c.compressionOptions||{},b=h.dir,_=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:d,dir:b,date:_,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(b){p(b)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var p=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(m){var b=new c(h);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],_=m.files;if(h.checkCRC32)for(var v=0;v<_.length;v++)b.push(f(_[v]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),_=b.files,v=0;v<_.length;v++){var T=_[v],A=T.fileNameStr,C=s.resolve(T.fileNameStr);p.file(C,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:h.createFolders}),T.dir||(p.file(C).unsafeOriginalName=A)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof pn<"u",newBufferFrom:function(s,o){if(pn.from&&pn.from!==Uint8Array.from)return pn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new pn(s,o)},allocBuffer:function(s){if(pn.alloc)return pn.alloc(s);var o=new pn(s);return o.fill(0),o},isBuffer:function(s){return pn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(C,R,S){var U,I=a.getTypeOf(R),P=a.extend(S||{},u);P.date=P.date||new Date,P.compression!==null&&(P.compression=P.compression.toUpperCase()),typeof P.unixPermissions=="string"&&(P.unixPermissions=parseInt(P.unixPermissions,8)),P.unixPermissions&&16384&P.unixPermissions&&(P.dir=!0),P.dosPermissions&&16&P.dosPermissions&&(P.dir=!0),P.dir&&(C=_(C)),P.createFolders&&(U=b(C))&&v.call(this,U,!0);var W=I==="string"&&P.binary===!1&&P.base64===!1;S&&S.binary!==void 0||(P.binary=!W),(R instanceof f&&R.uncompressedSize===0||P.dir||!R||R.length===0)&&(P.base64=!1,P.binary=!0,R="",P.compression="STORE",I="string");var L=null;L=R instanceof f||R instanceof c?R:p.isNode&&p.isStream(R)?new m(C,R):a.prepareContent(C,R,P.binary,P.optimizedBinaryString,P.base64);var N=new d(C,L,P);this.files[C]=N}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),b=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var R=C.lastIndexOf("/");return 0<R?C.substring(0,R):""},_=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},v=function(C,R){return R=R!==void 0?R:u.createFolders,C=_(C),this.files[C]||s.call(this,C,null,{dir:!0,createFolders:R}),this.files[C]};function T(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var R,S,U;for(R in this.files)U=this.files[R],(S=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&C(S,U)},filter:function(C){var R=[];return this.forEach(function(S,U){C(S,U)&&R.push(U)}),R},file:function(C,R,S){if(arguments.length!==1)return C=this.root+C,s.call(this,C,R,S),this;if(T(C)){var U=C;return this.filter(function(P,W){return!W.dir&&U.test(P)})}var I=this.files[this.root+C];return I&&!I.dir?I:null},folder:function(C){if(!C)return this;if(T(C))return this.filter(function(I,P){return P.dir&&C.test(I)});var R=this.root+C,S=v.call(this,R),U=this.clone();return U.root=S.name,U},remove:function(C){C=this.root+C;var R=this.files[C];if(R||(C.slice(-1)!=="/"&&(C+="/"),R=this.files[C]),R&&!R.dir)delete this.files[C];else for(var S=this.filter(function(I,P){return P.name.slice(0,C.length)===C}),U=0;U<S.length;U++)delete this.files[S[U].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var R,S={};try{if((S=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");a.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var U=S.comment||this.comment||"";R=h.generateWorker(this,S,U)}catch(I){(R=new c("error")).error(I)}return new l(R,S.type||"string",S.mimeType)},generateAsync:function(C,R){return this.generateInternalStream(C).accumulate(R)},generateNodeStream:function(C,R){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(R)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(b,_){var v=[],T=p._internalType,A=p._outputType,C=p._mimeType;p.on("data",function(R,S){v.push(R),m&&m(S)}).on("error",function(R){v=[],_(R)}).on("end",function(){try{var R=function(S,U,I){switch(S){case"blob":return s.newBlob(s.transformTo("arraybuffer",U),I);case"base64":return c.encode(U);default:return s.transformTo(S,U)}}(A,function(S,U){var I,P=0,W=null,L=0;for(I=0;I<U.length;I++)L+=U[I].length;switch(S){case"string":return U.join("");case"array":return Array.prototype.concat.apply([],U);case"uint8array":for(W=new Uint8Array(L),I=0;I<U.length;I++)W.set(U[I],P),P+=U[I].length;return W;case"nodebuffer":return pn.concat(U);default:throw new Error("concat : unsupported type '"+S+"'")}}(T,v),C);b(R)}catch(S){_(S)}v=[]}).resume()})}function h(p,m,b){var _=m;switch(m){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=m,this._mimeType=b,s.checkSupport(_),this._worker=p.pipe(new o(_)),p.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}h.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var b=this;return p==="data"?this._worker.on(p,function(_){m.call(b,_.data,_.meta)}):this._worker.on(p,function(){s.delay(m,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof pn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(p){var m,b,_,v,T,A=p.length,C=0;for(v=0;v<A;v++)(64512&(b=p.charCodeAt(v)))==55296&&v+1<A&&(64512&(_=p.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),v++),C+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),v=T=0;T<C;v++)(64512&(b=p.charCodeAt(v)))==55296&&v+1<A&&(64512&(_=p.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),v++),b<128?m[T++]=b:(b<2048?m[T++]=192|b>>>6:(b<65536?m[T++]=224|b>>>12:(m[T++]=240|b>>>18,m[T++]=128|b>>>12&63),m[T++]=128|b>>>6&63),m[T++]=128|63&b);return m}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,b,_,v,T=p.length,A=new Array(2*T);for(m=b=0;m<T;)if((_=p[m++])<128)A[b++]=_;else if(4<(v=l[_]))A[b++]=65533,m+=v-1;else{for(_&=v===2?31:v===3?15:7;1<v&&m<T;)_=_<<6|63&p[m++],v--;1<v?A[b++]=65533:_<65536?A[b++]=_:(_-=65536,A[b++]=55296|_>>10&1023,A[b++]=56320|1023&_)}return A.length!==b&&(A.subarray?A=A.subarray(0,b):A.length=b),s.applyFromCharCode(A)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var p=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(v,T){var A;for((T=T||v.length)>v.length&&(T=v.length),A=T-1;0<=A&&(192&v[A])==128;)A--;return A<0||A===0?T:A+l[v[A]]>T?A:T}(p),_=p;b!==p.length&&(o.uint8array?(_=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(_=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:i.utf8decode(_),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,b){for(var _=0;_<m.length;++_)b[_]=255&m.charCodeAt(_);return b}n("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(m),_.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(m,b,_){var v=[],T=0,A=m.length;if(A<=_)return String.fromCharCode.apply(null,m);for(;T<A;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,m.slice(T,Math.min(T+_,A)))):v.push(String.fromCharCode.apply(null,m.subarray(T,Math.min(T+_,A)))),T+=_;return v.join("")},stringifyByChar:function(m){for(var b="",_=0;_<m.length;_++)b+=String.fromCharCode(m[_]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var b=65536,_=i.getTypeOf(m),v=!0;if(_==="uint8array"?v=f.applyCanBeUsed.uint8array:_==="nodebuffer"&&(v=f.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return f.stringifyByChunk(m,_,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(m)}function h(m,b){for(var _=0;_<m.length;_++)b[_]=m[_];return b}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var _=i.getTypeOf(b);return p[_][m](b)},i.resolve=function(m){for(var b=m.split("/"),_=[],v=0;v<b.length;v++){var T=b[v];T==="."||T===""&&v!==0&&v!==b.length-1||(T===".."?_.pop():_.push(T))}return _.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,_,v="";for(_=0;_<(m||"").length;_++)v+="\\x"+((b=m.charCodeAt(_))<16?"0":"")+b.toString(16).toUpperCase();return v},i.delay=function(m,b,_){setImmediate(function(){m.apply(_||null,b||[])})},i.inherits=function(m,b){function _(){}_.prototype=b.prototype,m.prototype=new _},i.extend=function(){var m,b,_={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&_[b]===void 0&&(_[b]=arguments[m][b]);return _},i.prepareContent=function(m,b,_,v,T){return c.Promise.resolve(b).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(C,R){var S=new FileReader;S.onload=function(U){C(U.target.result)},S.onerror=function(U){R(U.target.error)},S.readAsArrayBuffer(A)}):A}).then(function(A){var C=i.getTypeOf(A);return C?(C==="arraybuffer"?A=i.transformTo("uint8array",A):C==="string"&&(T?A=o.decode(A):_&&v!==!0&&(A=function(R){return u(R,s.uint8array?new Uint8Array(R.length):new Array(R.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var p=this.reader.readString(4)===d;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,p=this.zip64EndOfCentralSize-44;0<p;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=d-h;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,p){this.options=h,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var _ in u)if(Object.prototype.hasOwnProperty.call(u,_)&&u[_].magic===b)return u[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,b,_=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<_;)p=h.readInt(2),m=h.readInt(2),b=h.readData(m),this.extraFields[p]={id:p,length:m,value:b};h.setIndex(_)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var _=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,b="string";try{if(!p)throw new Error("No output type specified.");var _=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var v=!this._dataBinary;v&&!_&&(m=m.pipe(new c.Utf8EncodeWorker)),!v&&_&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(T){(m=new u("error")).error(T)}return new o(m,b,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var h=[];function p(){var m,b;a=!0;for(var _=h.length;_;){for(b=h,h=[],m=-1;++m<_;)b[m]();_=h.length}a=!1}r.exports=function(m){h.push(m)!==1||a||o()}}).call(this,typeof Un<"u"?Un:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,_!==o&&m(this,_)}function d(_,v,T){this.promise=_,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function h(_,v,T){s(function(){var A;try{A=v(T)}catch(C){return a.reject(_,C)}A===_?a.reject(_,new TypeError("Cannot resolve promise with itself")):a.resolve(_,A)})}function p(_){var v=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof v=="function")return function(){v.apply(_,arguments)}}function m(_,v){var T=!1;function A(S){T||(T=!0,a.reject(_,S))}function C(S){T||(T=!0,a.resolve(_,S))}var R=b(function(){v(C,A)});R.status==="error"&&A(R.value)}function b(_,v){var T={};try{T.value=_(v),T.status="success"}catch(A){T.status="error",T.value=A}return T}(r.exports=f).prototype.finally=function(_){if(typeof _!="function")return this;var v=this.constructor;return this.then(function(T){return v.resolve(_()).then(function(){return T})},function(T){return v.resolve(_()).then(function(){throw T})})},f.prototype.catch=function(_){return this.then(null,_)},f.prototype.then=function(_,v){if(typeof _!="function"&&this.state===l||typeof v!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==u?h(T,this.state===l?_:v,this.outcome):this.queue.push(new d(T,_,v)),T},d.prototype.callFulfilled=function(_){a.resolve(this.promise,_)},d.prototype.otherCallFulfilled=function(_){h(this.promise,this.onFulfilled,_)},d.prototype.callRejected=function(_){a.reject(this.promise,_)},d.prototype.otherCallRejected=function(_){h(this.promise,this.onRejected,_)},a.resolve=function(_,v){var T=b(p,v);if(T.status==="error")return a.reject(_,T.value);var A=T.value;if(A)m(_,A);else{_.state=l,_.outcome=v;for(var C=-1,R=_.queue.length;++C<R;)_.queue[C].callFulfilled(v)}return _},a.reject=function(_,v){_.state=c,_.outcome=v;for(var T=-1,A=_.queue.length;++T<A;)_.queue[T].callRejected(v);return _},f.resolve=function(_){return _ instanceof this?_:a.resolve(new this(o),_)},f.reject=function(_){var v=new this(o);return a.reject(v,_)},f.all=function(_){var v=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=_.length,A=!1;if(!T)return this.resolve([]);for(var C=new Array(T),R=0,S=-1,U=new this(o);++S<T;)I(_[S],S);return U;function I(P,W){v.resolve(P).then(function(L){C[W]=L,++R!==T||A||(A=!0,a.resolve(U,C))},function(L){A||(A=!0,a.reject(U,L))})}},f.race=function(_){var v=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=_.length,A=!1;if(!T)return this.resolve([]);for(var C=-1,R=new this(o);++C<T;)S=_[C],v.resolve(S).then(function(U){A||(A=!0,a.resolve(R,U))},function(U){A||(A=!0,a.reject(R,U))});var S;return R}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,p=8;function m(_){if(!(this instanceof m))return new m(_);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},_||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(T!==f)throw new Error(c[T]);if(v.header&&s.deflateSetHeader(this.strm,v.header),v.dictionary){var A;if(A=typeof v.dictionary=="string"?a.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==f)throw new Error(c[T]);this._dict_set=!0}}function b(_,v){var T=new m(v);if(T.push(_,!0),T.err)throw T.msg||c[T.err];return T.result}m.prototype.push=function(_,v){var T,A,C=this.strm,R=this.options.chunkSize;if(this.ended)return!1;A=v===~~v?v:v===!0?4:0,typeof _=="string"?C.input=a.string2buf(_):u.call(_)==="[object ArrayBuffer]"?C.input=new Uint8Array(_):C.input=_,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(R),C.next_out=0,C.avail_out=R),(T=s.deflate(C,A))!==1&&T!==f)return this.onEnd(T),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===f):A!==2||(this.onEnd(f),!(C.avail_out=0))},m.prototype.onData=function(_){this.chunks.push(_)},m.prototype.onEnd=function(_){_===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(_,v){return(v=v||{}).raw=!0,b(_,v)},i.gzip=function(_,v){return(v=v||{}).gzip=!0,b(_,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var _=s.inflateInit2(this.strm,b.windowBits);if(_!==c.Z_OK)throw new Error(l[_]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function p(m,b){var _=new h(b);if(_.push(m,!0),_.err)throw _.msg||l[_.err];return _.result}h.prototype.push=function(m,b){var _,v,T,A,C,R,S=this.strm,U=this.options.chunkSize,I=this.options.dictionary,P=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?S.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?S.input=new Uint8Array(m):S.input=m,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new o.Buf8(U),S.next_out=0,S.avail_out=U),(_=s.inflate(S,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&I&&(R=typeof I=="string"?a.string2buf(I):d.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,_=s.inflateSetDictionary(this.strm,R)),_===c.Z_BUF_ERROR&&P===!0&&(_=c.Z_OK,P=!1),_!==c.Z_STREAM_END&&_!==c.Z_OK)return this.onEnd(_),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&_!==c.Z_STREAM_END&&(S.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(S.output,S.next_out),A=S.next_out-T,C=a.buf2string(S.output,T),S.next_out=A,S.avail_out=U-A,A&&o.arraySet(S.output,S.output,T,A,0),this.onData(C)):this.onData(o.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(P=!0)}while((0<S.avail_in||S.avail_out===0)&&_!==c.Z_STREAM_END);return _===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(_=s.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(S.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=h,i.inflate=p,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,p(m,b)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,p;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(p=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],p.set(h,d),d+=h.length;return p}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",p=0;p<d;p++)h+=String.fromCharCode(f[p]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,p,m,b,_=f.length,v=0;for(m=0;m<_;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),v+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(v),m=b=0;b<v;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?d[b++]=h:(h<2048?d[b++]=192|h>>>6:(h<65536?d[b++]=224|h>>>12:(d[b++]=240|h>>>18,d[b++]=128|h>>>12&63),d[b++]=128|h>>>6&63),d[b++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,p=d.length;h<p;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,p,m,b,_=d||f.length,v=new Array(2*_);for(h=p=0;h<_;)if((m=f[h++])<128)v[p++]=m;else if(4<(b=c[m]))v[p++]=65533,h+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&h<_;)m=m<<6|63&f[h++],b--;1<b?v[p++]=65533:m<65536?v[p++]=m:(m-=65536,v[p++]=55296|m>>10&1023,v[p++]=56320|1023&m)}return u(v,p)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,p=-2,m=-1,b=4,_=2,v=8,T=9,A=286,C=30,R=19,S=2*A+1,U=15,I=3,P=258,W=P+I+1,L=42,N=113,E=1,D=2,Z=3,$=4;function st(k,ot){return k.msg=u[ot],ot}function nt(k){return(k<<1)-(4<k?9:0)}function at(k){for(var ot=k.length;0<=--ot;)k[ot]=0}function Y(k){var ot=k.state,et=ot.pending;et>k.avail_out&&(et=k.avail_out),et!==0&&(o.arraySet(k.output,ot.pending_buf,ot.pending_out,et,k.next_out),k.next_out+=et,ot.pending_out+=et,k.total_out+=et,k.avail_out-=et,ot.pending-=et,ot.pending===0&&(ot.pending_out=0))}function H(k,ot){a._tr_flush_block(k,0<=k.block_start?k.block_start:-1,k.strstart-k.block_start,ot),k.block_start=k.strstart,Y(k.strm)}function wt(k,ot){k.pending_buf[k.pending++]=ot}function lt(k,ot){k.pending_buf[k.pending++]=ot>>>8&255,k.pending_buf[k.pending++]=255&ot}function ht(k,ot){var et,B,F=k.max_chain_length,V=k.strstart,ct=k.prev_length,ft=k.nice_match,J=k.strstart>k.w_size-W?k.strstart-(k.w_size-W):0,mt=k.window,xt=k.w_mask,pt=k.prev,St=k.strstart+P,fe=mt[V+ct-1],$t=mt[V+ct];k.prev_length>=k.good_match&&(F>>=2),ft>k.lookahead&&(ft=k.lookahead);do if(mt[(et=ot)+ct]===$t&&mt[et+ct-1]===fe&&mt[et]===mt[V]&&mt[++et]===mt[V+1]){V+=2,et++;do;while(mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&mt[++V]===mt[++et]&&V<St);if(B=P-(St-V),V=St-P,ct<B){if(k.match_start=ot,ft<=(ct=B))break;fe=mt[V+ct-1],$t=mt[V+ct]}}while((ot=pt[ot&xt])>J&&--F!=0);return ct<=k.lookahead?ct:k.lookahead}function jt(k){var ot,et,B,F,V,ct,ft,J,mt,xt,pt=k.w_size;do{if(F=k.window_size-k.lookahead-k.strstart,k.strstart>=pt+(pt-W)){for(o.arraySet(k.window,k.window,pt,pt,0),k.match_start-=pt,k.strstart-=pt,k.block_start-=pt,ot=et=k.hash_size;B=k.head[--ot],k.head[ot]=pt<=B?B-pt:0,--et;);for(ot=et=pt;B=k.prev[--ot],k.prev[ot]=pt<=B?B-pt:0,--et;);F+=pt}if(k.strm.avail_in===0)break;if(ct=k.strm,ft=k.window,J=k.strstart+k.lookahead,mt=F,xt=void 0,xt=ct.avail_in,mt<xt&&(xt=mt),et=xt===0?0:(ct.avail_in-=xt,o.arraySet(ft,ct.input,ct.next_in,xt,J),ct.state.wrap===1?ct.adler=c(ct.adler,ft,xt,J):ct.state.wrap===2&&(ct.adler=l(ct.adler,ft,xt,J)),ct.next_in+=xt,ct.total_in+=xt,xt),k.lookahead+=et,k.lookahead+k.insert>=I)for(V=k.strstart-k.insert,k.ins_h=k.window[V],k.ins_h=(k.ins_h<<k.hash_shift^k.window[V+1])&k.hash_mask;k.insert&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[V+I-1])&k.hash_mask,k.prev[V&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=V,V++,k.insert--,!(k.lookahead+k.insert<I)););}while(k.lookahead<W&&k.strm.avail_in!==0)}function ae(k,ot){for(var et,B;;){if(k.lookahead<W){if(jt(k),k.lookahead<W&&ot===f)return E;if(k.lookahead===0)break}if(et=0,k.lookahead>=I&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+I-1])&k.hash_mask,et=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),et!==0&&k.strstart-et<=k.w_size-W&&(k.match_length=ht(k,et)),k.match_length>=I)if(B=a._tr_tally(k,k.strstart-k.match_start,k.match_length-I),k.lookahead-=k.match_length,k.match_length<=k.max_lazy_match&&k.lookahead>=I){for(k.match_length--;k.strstart++,k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+I-1])&k.hash_mask,et=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart,--k.match_length!=0;);k.strstart++}else k.strstart+=k.match_length,k.match_length=0,k.ins_h=k.window[k.strstart],k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+1])&k.hash_mask;else B=a._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++;if(B&&(H(k,!1),k.strm.avail_out===0))return E}return k.insert=k.strstart<I-1?k.strstart:I-1,ot===d?(H(k,!0),k.strm.avail_out===0?Z:$):k.last_lit&&(H(k,!1),k.strm.avail_out===0)?E:D}function Dt(k,ot){for(var et,B,F;;){if(k.lookahead<W){if(jt(k),k.lookahead<W&&ot===f)return E;if(k.lookahead===0)break}if(et=0,k.lookahead>=I&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+I-1])&k.hash_mask,et=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),k.prev_length=k.match_length,k.prev_match=k.match_start,k.match_length=I-1,et!==0&&k.prev_length<k.max_lazy_match&&k.strstart-et<=k.w_size-W&&(k.match_length=ht(k,et),k.match_length<=5&&(k.strategy===1||k.match_length===I&&4096<k.strstart-k.match_start)&&(k.match_length=I-1)),k.prev_length>=I&&k.match_length<=k.prev_length){for(F=k.strstart+k.lookahead-I,B=a._tr_tally(k,k.strstart-1-k.prev_match,k.prev_length-I),k.lookahead-=k.prev_length-1,k.prev_length-=2;++k.strstart<=F&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+I-1])&k.hash_mask,et=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),--k.prev_length!=0;);if(k.match_available=0,k.match_length=I-1,k.strstart++,B&&(H(k,!1),k.strm.avail_out===0))return E}else if(k.match_available){if((B=a._tr_tally(k,0,k.window[k.strstart-1]))&&H(k,!1),k.strstart++,k.lookahead--,k.strm.avail_out===0)return E}else k.match_available=1,k.strstart++,k.lookahead--}return k.match_available&&(B=a._tr_tally(k,0,k.window[k.strstart-1]),k.match_available=0),k.insert=k.strstart<I-1?k.strstart:I-1,ot===d?(H(k,!0),k.strm.avail_out===0?Z:$):k.last_lit&&(H(k,!1),k.strm.avail_out===0)?E:D}function Pt(k,ot,et,B,F){this.good_length=k,this.max_lazy=ot,this.nice_length=et,this.max_chain=B,this.func=F}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*S),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*R+1)),at(this.dyn_ltree),at(this.dyn_dtree),at(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(U+1),this.heap=new o.Buf16(2*A+1),at(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),at(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Yt(k){var ot;return k&&k.state?(k.total_in=k.total_out=0,k.data_type=_,(ot=k.state).pending=0,ot.pending_out=0,ot.wrap<0&&(ot.wrap=-ot.wrap),ot.status=ot.wrap?L:N,k.adler=ot.wrap===2?0:1,ot.last_flush=f,a._tr_init(ot),h):st(k,p)}function Ie(k){var ot=Yt(k);return ot===h&&function(et){et.window_size=2*et.w_size,at(et.head),et.max_lazy_match=s[et.level].max_lazy,et.good_match=s[et.level].good_length,et.nice_match=s[et.level].nice_length,et.max_chain_length=s[et.level].max_chain,et.strstart=0,et.block_start=0,et.lookahead=0,et.insert=0,et.match_length=et.prev_length=I-1,et.match_available=0,et.ins_h=0}(k.state),ot}function je(k,ot,et,B,F,V){if(!k)return p;var ct=1;if(ot===m&&(ot=6),B<0?(ct=0,B=-B):15<B&&(ct=2,B-=16),F<1||T<F||et!==v||B<8||15<B||ot<0||9<ot||V<0||b<V)return st(k,p);B===8&&(B=9);var ft=new le;return(k.state=ft).strm=k,ft.wrap=ct,ft.gzhead=null,ft.w_bits=B,ft.w_size=1<<ft.w_bits,ft.w_mask=ft.w_size-1,ft.hash_bits=F+7,ft.hash_size=1<<ft.hash_bits,ft.hash_mask=ft.hash_size-1,ft.hash_shift=~~((ft.hash_bits+I-1)/I),ft.window=new o.Buf8(2*ft.w_size),ft.head=new o.Buf16(ft.hash_size),ft.prev=new o.Buf16(ft.w_size),ft.lit_bufsize=1<<F+6,ft.pending_buf_size=4*ft.lit_bufsize,ft.pending_buf=new o.Buf8(ft.pending_buf_size),ft.d_buf=1*ft.lit_bufsize,ft.l_buf=3*ft.lit_bufsize,ft.level=ot,ft.strategy=V,ft.method=et,Ie(k)}s=[new Pt(0,0,0,0,function(k,ot){var et=65535;for(et>k.pending_buf_size-5&&(et=k.pending_buf_size-5);;){if(k.lookahead<=1){if(jt(k),k.lookahead===0&&ot===f)return E;if(k.lookahead===0)break}k.strstart+=k.lookahead,k.lookahead=0;var B=k.block_start+et;if((k.strstart===0||k.strstart>=B)&&(k.lookahead=k.strstart-B,k.strstart=B,H(k,!1),k.strm.avail_out===0)||k.strstart-k.block_start>=k.w_size-W&&(H(k,!1),k.strm.avail_out===0))return E}return k.insert=0,ot===d?(H(k,!0),k.strm.avail_out===0?Z:$):(k.strstart>k.block_start&&(H(k,!1),k.strm.avail_out),E)}),new Pt(4,4,8,4,ae),new Pt(4,5,16,8,ae),new Pt(4,6,32,32,ae),new Pt(4,4,16,16,Dt),new Pt(8,16,32,32,Dt),new Pt(8,16,128,128,Dt),new Pt(8,32,128,256,Dt),new Pt(32,128,258,1024,Dt),new Pt(32,258,258,4096,Dt)],i.deflateInit=function(k,ot){return je(k,ot,v,15,8,0)},i.deflateInit2=je,i.deflateReset=Ie,i.deflateResetKeep=Yt,i.deflateSetHeader=function(k,ot){return k&&k.state?k.state.wrap!==2?p:(k.state.gzhead=ot,h):p},i.deflate=function(k,ot){var et,B,F,V;if(!k||!k.state||5<ot||ot<0)return k?st(k,p):p;if(B=k.state,!k.output||!k.input&&k.avail_in!==0||B.status===666&&ot!==d)return st(k,k.avail_out===0?-5:p);if(B.strm=k,et=B.last_flush,B.last_flush=ot,B.status===L)if(B.wrap===2)k.adler=0,wt(B,31),wt(B,139),wt(B,8),B.gzhead?(wt(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),wt(B,255&B.gzhead.time),wt(B,B.gzhead.time>>8&255),wt(B,B.gzhead.time>>16&255),wt(B,B.gzhead.time>>24&255),wt(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),wt(B,255&B.gzhead.os),B.gzhead.extra&&B.gzhead.extra.length&&(wt(B,255&B.gzhead.extra.length),wt(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(k.adler=l(k.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=69):(wt(B,0),wt(B,0),wt(B,0),wt(B,0),wt(B,0),wt(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),wt(B,3),B.status=N);else{var ct=v+(B.w_bits-8<<4)<<8;ct|=(2<=B.strategy||B.level<2?0:B.level<6?1:B.level===6?2:3)<<6,B.strstart!==0&&(ct|=32),ct+=31-ct%31,B.status=N,lt(B,ct),B.strstart!==0&&(lt(B,k.adler>>>16),lt(B,65535&k.adler)),k.adler=1}if(B.status===69)if(B.gzhead.extra){for(F=B.pending;B.gzindex<(65535&B.gzhead.extra.length)&&(B.pending!==B.pending_buf_size||(B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),Y(k),F=B.pending,B.pending!==B.pending_buf_size));)wt(B,255&B.gzhead.extra[B.gzindex]),B.gzindex++;B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=73)}else B.status=73;if(B.status===73)if(B.gzhead.name){F=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),Y(k),F=B.pending,B.pending===B.pending_buf_size)){V=1;break}V=B.gzindex<B.gzhead.name.length?255&B.gzhead.name.charCodeAt(B.gzindex++):0,wt(B,V)}while(V!==0);B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),V===0&&(B.gzindex=0,B.status=91)}else B.status=91;if(B.status===91)if(B.gzhead.comment){F=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),Y(k),F=B.pending,B.pending===B.pending_buf_size)){V=1;break}V=B.gzindex<B.gzhead.comment.length?255&B.gzhead.comment.charCodeAt(B.gzindex++):0,wt(B,V)}while(V!==0);B.gzhead.hcrc&&B.pending>F&&(k.adler=l(k.adler,B.pending_buf,B.pending-F,F)),V===0&&(B.status=103)}else B.status=103;if(B.status===103&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&Y(k),B.pending+2<=B.pending_buf_size&&(wt(B,255&k.adler),wt(B,k.adler>>8&255),k.adler=0,B.status=N)):B.status=N),B.pending!==0){if(Y(k),k.avail_out===0)return B.last_flush=-1,h}else if(k.avail_in===0&&nt(ot)<=nt(et)&&ot!==d)return st(k,-5);if(B.status===666&&k.avail_in!==0)return st(k,-5);if(k.avail_in!==0||B.lookahead!==0||ot!==f&&B.status!==666){var ft=B.strategy===2?function(J,mt){for(var xt;;){if(J.lookahead===0&&(jt(J),J.lookahead===0)){if(mt===f)return E;break}if(J.match_length=0,xt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++,xt&&(H(J,!1),J.strm.avail_out===0))return E}return J.insert=0,mt===d?(H(J,!0),J.strm.avail_out===0?Z:$):J.last_lit&&(H(J,!1),J.strm.avail_out===0)?E:D}(B,ot):B.strategy===3?function(J,mt){for(var xt,pt,St,fe,$t=J.window;;){if(J.lookahead<=P){if(jt(J),J.lookahead<=P&&mt===f)return E;if(J.lookahead===0)break}if(J.match_length=0,J.lookahead>=I&&0<J.strstart&&(pt=$t[St=J.strstart-1])===$t[++St]&&pt===$t[++St]&&pt===$t[++St]){fe=J.strstart+P;do;while(pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&pt===$t[++St]&&St<fe);J.match_length=P-(fe-St),J.match_length>J.lookahead&&(J.match_length=J.lookahead)}if(J.match_length>=I?(xt=a._tr_tally(J,1,J.match_length-I),J.lookahead-=J.match_length,J.strstart+=J.match_length,J.match_length=0):(xt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++),xt&&(H(J,!1),J.strm.avail_out===0))return E}return J.insert=0,mt===d?(H(J,!0),J.strm.avail_out===0?Z:$):J.last_lit&&(H(J,!1),J.strm.avail_out===0)?E:D}(B,ot):s[B.level].func(B,ot);if(ft!==Z&&ft!==$||(B.status=666),ft===E||ft===Z)return k.avail_out===0&&(B.last_flush=-1),h;if(ft===D&&(ot===1?a._tr_align(B):ot!==5&&(a._tr_stored_block(B,0,0,!1),ot===3&&(at(B.head),B.lookahead===0&&(B.strstart=0,B.block_start=0,B.insert=0))),Y(k),k.avail_out===0))return B.last_flush=-1,h}return ot!==d?h:B.wrap<=0?1:(B.wrap===2?(wt(B,255&k.adler),wt(B,k.adler>>8&255),wt(B,k.adler>>16&255),wt(B,k.adler>>24&255),wt(B,255&k.total_in),wt(B,k.total_in>>8&255),wt(B,k.total_in>>16&255),wt(B,k.total_in>>24&255)):(lt(B,k.adler>>>16),lt(B,65535&k.adler)),Y(k),0<B.wrap&&(B.wrap=-B.wrap),B.pending!==0?h:1)},i.deflateEnd=function(k){var ot;return k&&k.state?(ot=k.state.status)!==L&&ot!==69&&ot!==73&&ot!==91&&ot!==103&&ot!==N&&ot!==666?st(k,p):(k.state=null,ot===N?st(k,-3):h):p},i.deflateSetDictionary=function(k,ot){var et,B,F,V,ct,ft,J,mt,xt=ot.length;if(!k||!k.state||(V=(et=k.state).wrap)===2||V===1&&et.status!==L||et.lookahead)return p;for(V===1&&(k.adler=c(k.adler,ot,xt,0)),et.wrap=0,xt>=et.w_size&&(V===0&&(at(et.head),et.strstart=0,et.block_start=0,et.insert=0),mt=new o.Buf8(et.w_size),o.arraySet(mt,ot,xt-et.w_size,et.w_size,0),ot=mt,xt=et.w_size),ct=k.avail_in,ft=k.next_in,J=k.input,k.avail_in=xt,k.next_in=0,k.input=ot,jt(et);et.lookahead>=I;){for(B=et.strstart,F=et.lookahead-(I-1);et.ins_h=(et.ins_h<<et.hash_shift^et.window[B+I-1])&et.hash_mask,et.prev[B&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=B,B++,--F;);et.strstart=B,et.lookahead=I-1,jt(et)}return et.strstart+=et.lookahead,et.block_start=et.strstart,et.insert=et.lookahead,et.lookahead=0,et.match_length=et.prev_length=I-1,et.match_available=0,k.next_in=ft,k.input=J,k.avail_in=ct,et.wrap=V,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,p,m,b,_,v,T,A,C,R,S,U,I,P,W,L,N,E,D;a=s.state,c=s.next_in,E=s.input,l=c+(s.avail_in-5),u=s.next_out,D=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,p=a.wsize,m=a.whave,b=a.wnext,_=a.window,v=a.hold,T=a.bits,A=a.lencode,C=a.distcode,R=(1<<a.lenbits)-1,S=(1<<a.distbits)-1;t:do{T<15&&(v+=E[c++]<<T,T+=8,v+=E[c++]<<T,T+=8),U=A[v&R];e:for(;;){if(v>>>=I=U>>>24,T-=I,(I=U>>>16&255)===0)D[u++]=65535&U;else{if(!(16&I)){if(!(64&I)){U=A[(65535&U)+(v&(1<<I)-1)];continue e}if(32&I){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}P=65535&U,(I&=15)&&(T<I&&(v+=E[c++]<<T,T+=8),P+=v&(1<<I)-1,v>>>=I,T-=I),T<15&&(v+=E[c++]<<T,T+=8,v+=E[c++]<<T,T+=8),U=C[v&S];n:for(;;){if(v>>>=I=U>>>24,T-=I,!(16&(I=U>>>16&255))){if(!(64&I)){U=C[(65535&U)+(v&(1<<I)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(W=65535&U,T<(I&=15)&&(v+=E[c++]<<T,(T+=8)<I&&(v+=E[c++]<<T,T+=8)),h<(W+=v&(1<<I)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(v>>>=I,T-=I,(I=u-f)<W){if(m<(I=W-I)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(N=_,(L=0)===b){if(L+=p-I,I<P){for(P-=I;D[u++]=_[L++],--I;);L=u-W,N=D}}else if(b<I){if(L+=p+b-I,(I-=b)<P){for(P-=I;D[u++]=_[L++],--I;);if(L=0,b<P){for(P-=I=b;D[u++]=_[L++],--I;);L=u-W,N=D}}}else if(L+=b-I,I<P){for(P-=I;D[u++]=_[L++],--I;);L=u-W,N=D}for(;2<P;)D[u++]=N[L++],D[u++]=N[L++],D[u++]=N[L++],P-=3;P&&(D[u++]=N[L++],1<P&&(D[u++]=N[L++]))}else{for(L=u-W;D[u++]=D[L++],D[u++]=D[L++],D[u++]=D[L++],2<(P-=3););P&&(D[u++]=D[L++],1<P&&(D[u++]=D[L++]))}break}}break}}while(c<l&&u<d);c-=P=T>>3,v&=(1<<(T-=P<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=v,a.bits=T}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,p=1,m=852,b=592;function _(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(L){var N;return L&&L.state?(N=L.state,L.total_in=L.total_out=N.total=0,L.msg="",N.wrap&&(L.adler=1&N.wrap),N.mode=p,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new s.Buf32(m),N.distcode=N.distdyn=new s.Buf32(b),N.sane=1,N.back=-1,d):h}function A(L){var N;return L&&L.state?((N=L.state).wsize=0,N.whave=0,N.wnext=0,T(L)):h}function C(L,N){var E,D;return L&&L.state?(D=L.state,N<0?(E=0,N=-N):(E=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?h:(D.window!==null&&D.wbits!==N&&(D.window=null),D.wrap=E,D.wbits=N,A(L))):h}function R(L,N){var E,D;return L?(D=new v,(L.state=D).window=null,(E=C(L,N))!==d&&(L.state=null),E):h}var S,U,I=!0;function P(L){if(I){var N;for(S=new s.Buf32(512),U=new s.Buf32(32),N=0;N<144;)L.lens[N++]=8;for(;N<256;)L.lens[N++]=9;for(;N<280;)L.lens[N++]=7;for(;N<288;)L.lens[N++]=8;for(l(u,L.lens,0,288,S,0,L.work,{bits:9}),N=0;N<32;)L.lens[N++]=5;l(f,L.lens,0,32,U,0,L.work,{bits:5}),I=!1}L.lencode=S,L.lenbits=9,L.distcode=U,L.distbits=5}function W(L,N,E,D){var Z,$=L.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new s.Buf8($.wsize)),D>=$.wsize?(s.arraySet($.window,N,E-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(D<(Z=$.wsize-$.wnext)&&(Z=D),s.arraySet($.window,N,E-D,Z,$.wnext),(D-=Z)?(s.arraySet($.window,N,E-D,D,0),$.wnext=D,$.whave=$.wsize):($.wnext+=Z,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=Z))),0}i.inflateReset=A,i.inflateReset2=C,i.inflateResetKeep=T,i.inflateInit=function(L){return R(L,15)},i.inflateInit2=R,i.inflate=function(L,N){var E,D,Z,$,st,nt,at,Y,H,wt,lt,ht,jt,ae,Dt,Pt,le,Yt,Ie,je,k,ot,et,B,F=0,V=new s.Buf8(4),ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return h;(E=L.state).mode===12&&(E.mode=13),st=L.next_out,Z=L.output,at=L.avail_out,$=L.next_in,D=L.input,nt=L.avail_in,Y=E.hold,H=E.bits,wt=nt,lt=at,ot=d;t:for(;;)switch(E.mode){case p:if(E.wrap===0){E.mode=13;break}for(;H<16;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}if(2&E.wrap&&Y===35615){V[E.check=0]=255&Y,V[1]=Y>>>8&255,E.check=a(E.check,V,2,0),H=Y=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&Y)<<8)+(Y>>8))%31){L.msg="incorrect header check",E.mode=30;break}if((15&Y)!=8){L.msg="unknown compression method",E.mode=30;break}if(H-=4,k=8+(15&(Y>>>=4)),E.wbits===0)E.wbits=k;else if(k>E.wbits){L.msg="invalid window size",E.mode=30;break}E.dmax=1<<k,L.adler=E.check=1,E.mode=512&Y?10:12,H=Y=0;break;case 2:for(;H<16;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}if(E.flags=Y,(255&E.flags)!=8){L.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){L.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=Y>>8&1),512&E.flags&&(V[0]=255&Y,V[1]=Y>>>8&255,E.check=a(E.check,V,2,0)),H=Y=0,E.mode=3;case 3:for(;H<32;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}E.head&&(E.head.time=Y),512&E.flags&&(V[0]=255&Y,V[1]=Y>>>8&255,V[2]=Y>>>16&255,V[3]=Y>>>24&255,E.check=a(E.check,V,4,0)),H=Y=0,E.mode=4;case 4:for(;H<16;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}E.head&&(E.head.xflags=255&Y,E.head.os=Y>>8),512&E.flags&&(V[0]=255&Y,V[1]=Y>>>8&255,E.check=a(E.check,V,2,0)),H=Y=0,E.mode=5;case 5:if(1024&E.flags){for(;H<16;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}E.length=Y,E.head&&(E.head.extra_len=Y),512&E.flags&&(V[0]=255&Y,V[1]=Y>>>8&255,E.check=a(E.check,V,2,0)),H=Y=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(nt<(ht=E.length)&&(ht=nt),ht&&(E.head&&(k=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,D,$,ht,k)),512&E.flags&&(E.check=a(E.check,D,ht,$)),nt-=ht,$+=ht,E.length-=ht),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(nt===0)break t;for(ht=0;k=D[$+ht++],E.head&&k&&E.length<65536&&(E.head.name+=String.fromCharCode(k)),k&&ht<nt;);if(512&E.flags&&(E.check=a(E.check,D,ht,$)),nt-=ht,$+=ht,k)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(nt===0)break t;for(ht=0;k=D[$+ht++],E.head&&k&&E.length<65536&&(E.head.comment+=String.fromCharCode(k)),k&&ht<nt;);if(512&E.flags&&(E.check=a(E.check,D,ht,$)),nt-=ht,$+=ht,k)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;H<16;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}if(Y!==(65535&E.check)){L.msg="header crc mismatch",E.mode=30;break}H=Y=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),L.adler=E.check=0,E.mode=12;break;case 10:for(;H<32;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}L.adler=E.check=_(Y),H=Y=0,E.mode=11;case 11:if(E.havedict===0)return L.next_out=st,L.avail_out=at,L.next_in=$,L.avail_in=nt,E.hold=Y,E.bits=H,2;L.adler=E.check=1,E.mode=12;case 12:if(N===5||N===6)break t;case 13:if(E.last){Y>>>=7&H,H-=7&H,E.mode=27;break}for(;H<3;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}switch(E.last=1&Y,H-=1,3&(Y>>>=1)){case 0:E.mode=14;break;case 1:if(P(E),E.mode=20,N!==6)break;Y>>>=2,H-=2;break t;case 2:E.mode=17;break;case 3:L.msg="invalid block type",E.mode=30}Y>>>=2,H-=2;break;case 14:for(Y>>>=7&H,H-=7&H;H<32;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}if((65535&Y)!=(Y>>>16^65535)){L.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&Y,H=Y=0,E.mode=15,N===6)break t;case 15:E.mode=16;case 16:if(ht=E.length){if(nt<ht&&(ht=nt),at<ht&&(ht=at),ht===0)break t;s.arraySet(Z,D,$,ht,st),nt-=ht,$+=ht,at-=ht,st+=ht,E.length-=ht;break}E.mode=12;break;case 17:for(;H<14;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}if(E.nlen=257+(31&Y),Y>>>=5,H-=5,E.ndist=1+(31&Y),Y>>>=5,H-=5,E.ncode=4+(15&Y),Y>>>=4,H-=4,286<E.nlen||30<E.ndist){L.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;H<3;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}E.lens[ct[E.have++]]=7&Y,Y>>>=3,H-=3}for(;E.have<19;)E.lens[ct[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,et={bits:E.lenbits},ot=l(0,E.lens,0,19,E.lencode,0,E.work,et),E.lenbits=et.bits,ot){L.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;Pt=(F=E.lencode[Y&(1<<E.lenbits)-1])>>>16&255,le=65535&F,!((Dt=F>>>24)<=H);){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}if(le<16)Y>>>=Dt,H-=Dt,E.lens[E.have++]=le;else{if(le===16){for(B=Dt+2;H<B;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}if(Y>>>=Dt,H-=Dt,E.have===0){L.msg="invalid bit length repeat",E.mode=30;break}k=E.lens[E.have-1],ht=3+(3&Y),Y>>>=2,H-=2}else if(le===17){for(B=Dt+3;H<B;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}H-=Dt,k=0,ht=3+(7&(Y>>>=Dt)),Y>>>=3,H-=3}else{for(B=Dt+7;H<B;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}H-=Dt,k=0,ht=11+(127&(Y>>>=Dt)),Y>>>=7,H-=7}if(E.have+ht>E.nlen+E.ndist){L.msg="invalid bit length repeat",E.mode=30;break}for(;ht--;)E.lens[E.have++]=k}}if(E.mode===30)break;if(E.lens[256]===0){L.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,et={bits:E.lenbits},ot=l(u,E.lens,0,E.nlen,E.lencode,0,E.work,et),E.lenbits=et.bits,ot){L.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,et={bits:E.distbits},ot=l(f,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,et),E.distbits=et.bits,ot){L.msg="invalid distances set",E.mode=30;break}if(E.mode=20,N===6)break t;case 20:E.mode=21;case 21:if(6<=nt&&258<=at){L.next_out=st,L.avail_out=at,L.next_in=$,L.avail_in=nt,E.hold=Y,E.bits=H,c(L,lt),st=L.next_out,Z=L.output,at=L.avail_out,$=L.next_in,D=L.input,nt=L.avail_in,Y=E.hold,H=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;Pt=(F=E.lencode[Y&(1<<E.lenbits)-1])>>>16&255,le=65535&F,!((Dt=F>>>24)<=H);){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}if(Pt&&!(240&Pt)){for(Yt=Dt,Ie=Pt,je=le;Pt=(F=E.lencode[je+((Y&(1<<Yt+Ie)-1)>>Yt)])>>>16&255,le=65535&F,!(Yt+(Dt=F>>>24)<=H);){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}Y>>>=Yt,H-=Yt,E.back+=Yt}if(Y>>>=Dt,H-=Dt,E.back+=Dt,E.length=le,Pt===0){E.mode=26;break}if(32&Pt){E.back=-1,E.mode=12;break}if(64&Pt){L.msg="invalid literal/length code",E.mode=30;break}E.extra=15&Pt,E.mode=22;case 22:if(E.extra){for(B=E.extra;H<B;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}E.length+=Y&(1<<E.extra)-1,Y>>>=E.extra,H-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;Pt=(F=E.distcode[Y&(1<<E.distbits)-1])>>>16&255,le=65535&F,!((Dt=F>>>24)<=H);){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}if(!(240&Pt)){for(Yt=Dt,Ie=Pt,je=le;Pt=(F=E.distcode[je+((Y&(1<<Yt+Ie)-1)>>Yt)])>>>16&255,le=65535&F,!(Yt+(Dt=F>>>24)<=H);){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}Y>>>=Yt,H-=Yt,E.back+=Yt}if(Y>>>=Dt,H-=Dt,E.back+=Dt,64&Pt){L.msg="invalid distance code",E.mode=30;break}E.offset=le,E.extra=15&Pt,E.mode=24;case 24:if(E.extra){for(B=E.extra;H<B;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}E.offset+=Y&(1<<E.extra)-1,Y>>>=E.extra,H-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){L.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(at===0)break t;if(ht=lt-at,E.offset>ht){if((ht=E.offset-ht)>E.whave&&E.sane){L.msg="invalid distance too far back",E.mode=30;break}jt=ht>E.wnext?(ht-=E.wnext,E.wsize-ht):E.wnext-ht,ht>E.length&&(ht=E.length),ae=E.window}else ae=Z,jt=st-E.offset,ht=E.length;for(at<ht&&(ht=at),at-=ht,E.length-=ht;Z[st++]=ae[jt++],--ht;);E.length===0&&(E.mode=21);break;case 26:if(at===0)break t;Z[st++]=E.length,at--,E.mode=21;break;case 27:if(E.wrap){for(;H<32;){if(nt===0)break t;nt--,Y|=D[$++]<<H,H+=8}if(lt-=at,L.total_out+=lt,E.total+=lt,lt&&(L.adler=E.check=E.flags?a(E.check,Z,lt,st-lt):o(E.check,Z,lt,st-lt)),lt=at,(E.flags?Y:_(Y))!==E.check){L.msg="incorrect data check",E.mode=30;break}H=Y=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;H<32;){if(nt===0)break t;nt--,Y+=D[$++]<<H,H+=8}if(Y!==(4294967295&E.total)){L.msg="incorrect length check",E.mode=30;break}H=Y=0}E.mode=29;case 29:ot=1;break t;case 30:ot=-3;break t;case 31:return-4;case 32:default:return h}return L.next_out=st,L.avail_out=at,L.next_in=$,L.avail_in=nt,E.hold=Y,E.bits=H,(E.wsize||lt!==L.avail_out&&E.mode<30&&(E.mode<27||N!==4))&&W(L,L.output,L.next_out,lt-L.avail_out)?(E.mode=31,-4):(wt-=L.avail_in,lt-=L.avail_out,L.total_in+=wt,L.total_out+=lt,E.total+=lt,E.wrap&&lt&&(L.adler=E.check=E.flags?a(E.check,Z,lt,L.next_out-lt):o(E.check,Z,lt,L.next_out-lt)),L.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(wt==0&&lt===0||N===4)&&ot===d&&(ot=-5),ot)},i.inflateEnd=function(L){if(!L||!L.state)return h;var N=L.state;return N.window&&(N.window=null),L.state=null,d},i.inflateGetHeader=function(L,N){var E;return L&&L.state&&2&(E=L.state).wrap?((E.head=N).done=!1,d):h},i.inflateSetDictionary=function(L,N){var E,D=N.length;return L&&L.state?(E=L.state).wrap!==0&&E.mode!==11?h:E.mode===11&&o(1,N,D,0)!==E.check?-3:W(L,N,D,D)?(E.mode=31,-4):(E.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,p,m,b,_){var v,T,A,C,R,S,U,I,P,W=_.bits,L=0,N=0,E=0,D=0,Z=0,$=0,st=0,nt=0,at=0,Y=0,H=null,wt=0,lt=new s.Buf16(16),ht=new s.Buf16(16),jt=null,ae=0;for(L=0;L<=15;L++)lt[L]=0;for(N=0;N<h;N++)lt[f[d+N]]++;for(Z=W,D=15;1<=D&&lt[D]===0;D--);if(D<Z&&(Z=D),D===0)return p[m++]=20971520,p[m++]=20971520,_.bits=1,0;for(E=1;E<D&&lt[E]===0;E++);for(Z<E&&(Z=E),L=nt=1;L<=15;L++)if(nt<<=1,(nt-=lt[L])<0)return-1;if(0<nt&&(u===0||D!==1))return-1;for(ht[1]=0,L=1;L<15;L++)ht[L+1]=ht[L]+lt[L];for(N=0;N<h;N++)f[d+N]!==0&&(b[ht[f[d+N]]++]=N);if(S=u===0?(H=jt=b,19):u===1?(H=o,wt-=257,jt=a,ae-=257,256):(H=c,jt=l,-1),L=E,R=m,st=N=Y=0,A=-1,C=(at=1<<($=Z))-1,u===1&&852<at||u===2&&592<at)return 1;for(;;){for(U=L-st,P=b[N]<S?(I=0,b[N]):b[N]>S?(I=jt[ae+b[N]],H[wt+b[N]]):(I=96,0),v=1<<L-st,E=T=1<<$;p[R+(Y>>st)+(T-=v)]=U<<24|I<<16|P|0,T!==0;);for(v=1<<L-1;Y&v;)v>>=1;if(v!==0?(Y&=v-1,Y+=v):Y=0,N++,--lt[L]==0){if(L===D)break;L=f[d+b[N]]}if(Z<L&&(Y&C)!==A){for(st===0&&(st=Z),R+=E,nt=1<<($=L-st);$+st<D&&!((nt-=lt[$+st])<=0);)$++,nt<<=1;if(at+=1<<$,u===1&&852<at||u===2&&592<at)return 1;p[A=Y&C]=Z<<24|$<<16|R-m|0}}return Y!==0&&(p[R+Y]=L-st<<24|64<<16|0),_.bits=Z,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(F){for(var V=F.length;0<=--V;)F[V]=0}var l=0,u=29,f=256,d=f+1+u,h=30,p=19,m=2*d+1,b=15,_=16,v=7,T=256,A=16,C=17,R=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],W=new Array(2*(d+2));c(W);var L=new Array(2*h);c(L);var N=new Array(512);c(N);var E=new Array(256);c(E);var D=new Array(u);c(D);var Z,$,st,nt=new Array(h);function at(F,V,ct,ft,J){this.static_tree=F,this.extra_bits=V,this.extra_base=ct,this.elems=ft,this.max_length=J,this.has_stree=F&&F.length}function Y(F,V){this.dyn_tree=F,this.max_code=0,this.stat_desc=V}function H(F){return F<256?N[F]:N[256+(F>>>7)]}function wt(F,V){F.pending_buf[F.pending++]=255&V,F.pending_buf[F.pending++]=V>>>8&255}function lt(F,V,ct){F.bi_valid>_-ct?(F.bi_buf|=V<<F.bi_valid&65535,wt(F,F.bi_buf),F.bi_buf=V>>_-F.bi_valid,F.bi_valid+=ct-_):(F.bi_buf|=V<<F.bi_valid&65535,F.bi_valid+=ct)}function ht(F,V,ct){lt(F,ct[2*V],ct[2*V+1])}function jt(F,V){for(var ct=0;ct|=1&F,F>>>=1,ct<<=1,0<--V;);return ct>>>1}function ae(F,V,ct){var ft,J,mt=new Array(b+1),xt=0;for(ft=1;ft<=b;ft++)mt[ft]=xt=xt+ct[ft-1]<<1;for(J=0;J<=V;J++){var pt=F[2*J+1];pt!==0&&(F[2*J]=jt(mt[pt]++,pt))}}function Dt(F){var V;for(V=0;V<d;V++)F.dyn_ltree[2*V]=0;for(V=0;V<h;V++)F.dyn_dtree[2*V]=0;for(V=0;V<p;V++)F.bl_tree[2*V]=0;F.dyn_ltree[2*T]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function Pt(F){8<F.bi_valid?wt(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function le(F,V,ct,ft){var J=2*V,mt=2*ct;return F[J]<F[mt]||F[J]===F[mt]&&ft[V]<=ft[ct]}function Yt(F,V,ct){for(var ft=F.heap[ct],J=ct<<1;J<=F.heap_len&&(J<F.heap_len&&le(V,F.heap[J+1],F.heap[J],F.depth)&&J++,!le(V,ft,F.heap[J],F.depth));)F.heap[ct]=F.heap[J],ct=J,J<<=1;F.heap[ct]=ft}function Ie(F,V,ct){var ft,J,mt,xt,pt=0;if(F.last_lit!==0)for(;ft=F.pending_buf[F.d_buf+2*pt]<<8|F.pending_buf[F.d_buf+2*pt+1],J=F.pending_buf[F.l_buf+pt],pt++,ft===0?ht(F,J,V):(ht(F,(mt=E[J])+f+1,V),(xt=S[mt])!==0&&lt(F,J-=D[mt],xt),ht(F,mt=H(--ft),ct),(xt=U[mt])!==0&&lt(F,ft-=nt[mt],xt)),pt<F.last_lit;);ht(F,T,V)}function je(F,V){var ct,ft,J,mt=V.dyn_tree,xt=V.stat_desc.static_tree,pt=V.stat_desc.has_stree,St=V.stat_desc.elems,fe=-1;for(F.heap_len=0,F.heap_max=m,ct=0;ct<St;ct++)mt[2*ct]!==0?(F.heap[++F.heap_len]=fe=ct,F.depth[ct]=0):mt[2*ct+1]=0;for(;F.heap_len<2;)mt[2*(J=F.heap[++F.heap_len]=fe<2?++fe:0)]=1,F.depth[J]=0,F.opt_len--,pt&&(F.static_len-=xt[2*J+1]);for(V.max_code=fe,ct=F.heap_len>>1;1<=ct;ct--)Yt(F,mt,ct);for(J=St;ct=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Yt(F,mt,1),ft=F.heap[1],F.heap[--F.heap_max]=ct,F.heap[--F.heap_max]=ft,mt[2*J]=mt[2*ct]+mt[2*ft],F.depth[J]=(F.depth[ct]>=F.depth[ft]?F.depth[ct]:F.depth[ft])+1,mt[2*ct+1]=mt[2*ft+1]=J,F.heap[1]=J++,Yt(F,mt,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function($t,Jn){var O,g,y,M,z,Q,it=Jn.dyn_tree,zt=Jn.max_code,Ne=Jn.stat_desc.static_tree,we=Jn.stat_desc.has_stree,Ce=Jn.stat_desc.extra_bits,he=Jn.stat_desc.extra_base,Gc=Jn.stat_desc.max_length,yh=0;for(M=0;M<=b;M++)$t.bl_count[M]=0;for(it[2*$t.heap[$t.heap_max]+1]=0,O=$t.heap_max+1;O<m;O++)Gc<(M=it[2*it[2*(g=$t.heap[O])+1]+1]+1)&&(M=Gc,yh++),it[2*g+1]=M,zt<g||($t.bl_count[M]++,z=0,he<=g&&(z=Ce[g-he]),Q=it[2*g],$t.opt_len+=Q*(M+z),we&&($t.static_len+=Q*(Ne[2*g+1]+z)));if(yh!==0){do{for(M=Gc-1;$t.bl_count[M]===0;)M--;$t.bl_count[M]--,$t.bl_count[M+1]+=2,$t.bl_count[Gc]--,yh-=2}while(0<yh);for(M=Gc;M!==0;M--)for(g=$t.bl_count[M];g!==0;)zt<(y=$t.heap[--O])||(it[2*y+1]!==M&&($t.opt_len+=(M-it[2*y+1])*it[2*y],it[2*y+1]=M),g--)}}(F,V),ae(mt,fe,F.bl_count)}function k(F,V,ct){var ft,J,mt=-1,xt=V[1],pt=0,St=7,fe=4;for(xt===0&&(St=138,fe=3),V[2*(ct+1)+1]=65535,ft=0;ft<=ct;ft++)J=xt,xt=V[2*(ft+1)+1],++pt<St&&J===xt||(pt<fe?F.bl_tree[2*J]+=pt:J!==0?(J!==mt&&F.bl_tree[2*J]++,F.bl_tree[2*A]++):pt<=10?F.bl_tree[2*C]++:F.bl_tree[2*R]++,mt=J,fe=(pt=0)===xt?(St=138,3):J===xt?(St=6,3):(St=7,4))}function ot(F,V,ct){var ft,J,mt=-1,xt=V[1],pt=0,St=7,fe=4;for(xt===0&&(St=138,fe=3),ft=0;ft<=ct;ft++)if(J=xt,xt=V[2*(ft+1)+1],!(++pt<St&&J===xt)){if(pt<fe)for(;ht(F,J,F.bl_tree),--pt!=0;);else J!==0?(J!==mt&&(ht(F,J,F.bl_tree),pt--),ht(F,A,F.bl_tree),lt(F,pt-3,2)):pt<=10?(ht(F,C,F.bl_tree),lt(F,pt-3,3)):(ht(F,R,F.bl_tree),lt(F,pt-11,7));mt=J,fe=(pt=0)===xt?(St=138,3):J===xt?(St=6,3):(St=7,4)}}c(nt);var et=!1;function B(F,V,ct,ft){lt(F,(l<<1)+(ft?1:0),3),function(J,mt,xt,pt){Pt(J),wt(J,xt),wt(J,~xt),s.arraySet(J.pending_buf,J.window,mt,xt,J.pending),J.pending+=xt}(F,V,ct)}i._tr_init=function(F){et||(function(){var V,ct,ft,J,mt,xt=new Array(b+1);for(J=ft=0;J<u-1;J++)for(D[J]=ft,V=0;V<1<<S[J];V++)E[ft++]=J;for(E[ft-1]=J,J=mt=0;J<16;J++)for(nt[J]=mt,V=0;V<1<<U[J];V++)N[mt++]=J;for(mt>>=7;J<h;J++)for(nt[J]=mt<<7,V=0;V<1<<U[J]-7;V++)N[256+mt++]=J;for(ct=0;ct<=b;ct++)xt[ct]=0;for(V=0;V<=143;)W[2*V+1]=8,V++,xt[8]++;for(;V<=255;)W[2*V+1]=9,V++,xt[9]++;for(;V<=279;)W[2*V+1]=7,V++,xt[7]++;for(;V<=287;)W[2*V+1]=8,V++,xt[8]++;for(ae(W,d+1,xt),V=0;V<h;V++)L[2*V+1]=5,L[2*V]=jt(V,5);Z=new at(W,S,f+1,d,b),$=new at(L,U,0,h,b),st=new at(new Array(0),I,0,p,v)}(),et=!0),F.l_desc=new Y(F.dyn_ltree,Z),F.d_desc=new Y(F.dyn_dtree,$),F.bl_desc=new Y(F.bl_tree,st),F.bi_buf=0,F.bi_valid=0,Dt(F)},i._tr_stored_block=B,i._tr_flush_block=function(F,V,ct,ft){var J,mt,xt=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(pt){var St,fe=4093624447;for(St=0;St<=31;St++,fe>>>=1)if(1&fe&&pt.dyn_ltree[2*St]!==0)return o;if(pt.dyn_ltree[18]!==0||pt.dyn_ltree[20]!==0||pt.dyn_ltree[26]!==0)return a;for(St=32;St<f;St++)if(pt.dyn_ltree[2*St]!==0)return a;return o}(F)),je(F,F.l_desc),je(F,F.d_desc),xt=function(pt){var St;for(k(pt,pt.dyn_ltree,pt.l_desc.max_code),k(pt,pt.dyn_dtree,pt.d_desc.max_code),je(pt,pt.bl_desc),St=p-1;3<=St&&pt.bl_tree[2*P[St]+1]===0;St--);return pt.opt_len+=3*(St+1)+5+5+4,St}(F),J=F.opt_len+3+7>>>3,(mt=F.static_len+3+7>>>3)<=J&&(J=mt)):J=mt=ct+5,ct+4<=J&&V!==-1?B(F,V,ct,ft):F.strategy===4||mt===J?(lt(F,2+(ft?1:0),3),Ie(F,W,L)):(lt(F,4+(ft?1:0),3),function(pt,St,fe,$t){var Jn;for(lt(pt,St-257,5),lt(pt,fe-1,5),lt(pt,$t-4,4),Jn=0;Jn<$t;Jn++)lt(pt,pt.bl_tree[2*P[Jn]+1],3);ot(pt,pt.dyn_ltree,St-1),ot(pt,pt.dyn_dtree,fe-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,xt+1),Ie(F,F.dyn_ltree,F.dyn_dtree)),Dt(F),ft&&Pt(F)},i._tr_tally=function(F,V,ct){return F.pending_buf[F.d_buf+2*F.last_lit]=V>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&V,F.pending_buf[F.l_buf+F.last_lit]=255&ct,F.last_lit++,V===0?F.dyn_ltree[2*ct]++:(F.matches++,V--,F.dyn_ltree[2*(E[ct]+f+1)]++,F.dyn_dtree[2*H(V)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){lt(F,2,3),ht(F,T,W),function(V){V.bi_valid===16?(wt(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},p=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(A){Nr.nextTick(function(){v(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,C=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=C,A}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(f+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){v(A.data)},function(A){u.port2.postMessage(A)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(A){var C=m.createElement("script");C.onreadystatechange=function(){v(A),C.onreadystatechange=null,l.removeChild(C),C=null},l.appendChild(C)}):function(A){setTimeout(v,0,A)},b.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var C=new Array(arguments.length-1),R=0;R<C.length;R++)C[R]=arguments[R+1];var S={callback:A,args:C};return h[d]=S,c(d),d++},b.clearImmediate=_}function _(A){delete h[A]}function v(A){if(p)setTimeout(v,0,A);else{var C=h[A];if(C){p=!0;try{(function(R){var S=R.callback,U=R.args;switch(U.length){case 0:S();break;case 1:S(U[0]);break;case 2:S(U[0],U[1]);break;case 3:S(U[0],U[1],U[2]);break;default:S.apply(a,U)}})(C)}finally{_(A),p=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(f)===0&&v(+A.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Un<"u"?Un:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(WE);var rj=WE.exports,wp=ho(rj);const HE={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(HE);var Ir=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},ga,Wc,uo;class ij{constructor(...e){ga.set(this,new Map),Wc.set(this,new Map),uo.set(this,new Map);for(const n of e)this.define(n)}define(e,n=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Ir(this,uo,"f").has(r)||Ir(this,uo,"f").set(r,new Set);const s=Ir(this,uo,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Ir(this,Wc,"f").set(r,a),o=!1,c)continue;const l=Ir(this,ga,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Ir(this,ga,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const n=e.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<e.length;return!(r.length<n.length-1)&&i?null:Ir(this,ga,"f").get(r)??null}getExtension(e){var n;return typeof e!="string"?null:(e=(n=e==null?void 0:e.split)==null?void 0:n.call(e,";")[0],(e&&Ir(this,Wc,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:Ir(this,uo,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of Ir(this,uo,"f").values())Object.freeze(e);return this}_getTestState(){return{types:Ir(this,ga,"f"),extensions:Ir(this,Wc,"f")}}}ga=new WeakMap,Wc=new WeakMap,uo=new WeakMap;var sj=new ij(HE)._freeze();function GE(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:if(t.endsWith(".xp"))return"application/rexpaint";break}return sj.getType(t)??"application/octet-stream"}async function oj(t,e,n){try{pe(tt,t,"parsezipfile",e.name);const r=await e.arrayBuffer();(await new wp().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=GE(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{de(tt,t,"crash",c.message)})})}catch(r){de(tt,t,"crash",r.message)}}async function YE(t,e,n){try{pe(tt,e,"parsebinaryfile",t.name);const r=await t.arrayBuffer();n(new Uint8Array(r))}catch(r){de(tt,e,"crash",r.message)}}function VE(t,e){function n(r){if(x(e))switch(r){case"text/plain":e.text().then(i=>Pa(tt,t,void 0,"text",`file:${e.name}`,i)).catch(i=>de(tt,t,"crash",i.message));break;case"application/json":e.text().then(i=>Pa(tt,t,void 0,"json",`file:${e.name}`,i)).catch(i=>de(tt,t,"crash",i.message));break;case"application/zip":oj(t,e,i=>VE(t,i)).catch(i=>de(tt,t,"crash",i.message));break;case"application/rexpaint":YE(e,t,i=>Pa(tt,t,void 0,"rexpaint",`file:${e.name}`,i)).catch(i=>de(tt,t,"crash",i.message));break;case"application/octet-stream":YE(e,t,i=>Pa(tt,t,void 0,"binary",`file:${e.name}`,i)).catch(i=>de(tt,t,"crash",i.message));break;default:e.arrayBuffer().then(i=>{const s=GE(e.name,new Uint8Array(i));if(s)n(s);else return de(tt,t,"parsewebfile",`unsupported file ${e.name}`)}).catch(i=>de(tt,t,"crash",i.message));return}}n((e==null?void 0:e.type)??"")}function Vi(t,e,n){n().catch(r=>{console.error(r),de(t,e,"crash",r==null?void 0:r.message)})}function aj(t){const[e,n]=t.split(":"),r=x(n);return[r?e:"self",r?n:t]}function cj(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return e+n}function lj(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const uj=new Date("1980/09/02");async function xp(t){return console.info("saved",t),new Promise((e,n)=>{const r=new wp;for(let i=0;i<t.length;++i){const s=t[i],o=pF(s);if(o){const a=uN(o);x(a)&&r.file(s.id,a,{date:uj})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{e(lj(i))}).catch(n)})}async function hj(t){return new Promise((e,n)=>{const r=new wp;r.loadAsync(cj(t),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=mF(hN(c));x(l)&&i.push(l)}e(i)}).catch(n)})}function gh(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function fj(t,e,n,r){const i=Ln(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){kt(u)&&(s=u,ly(e.x,e.y,n.x,n.y).forEach(f=>{const d=Jt(i,f);x(d)&&(d[l]=u)}))}Mt(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),Mt(t,sn),Ot(t,`batch:${gh(e,n)}`,"char",[r,"charedit"],o,a);const c=qe(t);c.scroll=Mn(t)}function dj(t,e,n,r){const i=Ln(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){if(kt(u)){s=u;for(let f=e.y;f<=n.y;++f)for(let d=e.x;d<=n.x;++d){const h=Jt(i,{x:d,y:f});x(h)&&(h[l]=u)}}}Mt(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),Mt(t,sn),Ot(t,`batch:${gh(e,n)}`,"color",[r,"coloredit"],o,a);const c=qe(t);c.scroll=Mn(t)}function pj(t,e,n,r){const i=Ln(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){kt(u)&&(s=u,ly(e.x,e.y,n.x,n.y).forEach(f=>{const d=Jt(i,f);x(d)&&(d[l]=u)}))}Mt(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),Mt(t,sn),Ot(t,`batch:${gh(e,n)}`,"color",[r,"coloredit"],o,a);const c=qe(t);c.scroll=Mn(t)}const Hc={stat:"",patternsize:2,mirror:1};function mj(t,e,n,r){const i=fn(Lt.MAIN);if(!x(i))return;const s=Ln(t);if(!x(s))return;const o=gh(e,n);Mt(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),Mt(t,sn),Ot(t,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),Ot(t,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),r&&Ot(t,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),Ot(t,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]);function a(p){const{target:m}=er(p);return Hc[m]}function c(p,m){if(kt(m)||gt(m)){const{target:b}=er(p);Hc[b]=m}}Ot(t,"batch","remix",[`stat:${o}`,"text"],a,c),Ot(t,"batch","patternsize",[`patternsize:${o}`,"number","1","5"],a,c),Ot(t,"batch","mirror",[`mirror:${o}`,"number","1","8"],a,c),Ot(t,"batch","run",[`remixrun:${o}`,"hk","r"," R "]),Mt(t,sn),Ot(t,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),Ot(t,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),Ot(t,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Mt(t,sn),Ot(t,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Mt(t,sn),Mt(t,"codepages:"),Ot(t,"batch","edit @board codepage",[`pageopen:${s.id}`]);const l=Math.min(e.x,n.x),u=Math.min(e.y,n.y),f=Math.max(e.x,n.x),d=Math.max(e.y,n.y),h=new Set;for(let p=u;p<=d;++p)for(let m=l;m<=f;++m){const b=Jt(s,{x:m,y:p}),_=_x(i,b);x(_)&&!h.has(_.id)&&(h.add(_.id),Ot(t,"batch",`edit @${Ge(_)}`,[`pageopen:${_.id}`]))}}function Ep(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function gj(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const r=Ep(n);return(i,s)=>r.then(o=>s(o.transaction(e,i).objectStore(e)))}let vp;function ZE(){return vp||(vp=gj("keyval-store","keyval")),vp}function _j(t,e=ZE()){return e("readonly",n=>Ep(n.get(t)))}function yj(t,e,n=ZE()){return n("readwrite",r=>new Promise((i,s)=>{r.get(t).onsuccess=function(){try{r.put(e(this.result),t),i(Ep(r.transaction))}catch(o){s(o)}}}))}function kp(t,e){return`${t.x},${t.y},${e.x},${e.y}`}async function XE(){return _j("secretheap")}async function qE(t){return yj("secretheap",t)}async function bj(){return!!await XE()}function JE(t,e,n){const r=Math.min(e.x,n.x),i=Math.min(e.y,n.y),s=Math.max(e.x,n.x),o=Math.max(e.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},p=Jt(t,{x:d,y:f});(p==null?void 0:p.category)===Pn.ISOBJECT?(l.push(tr(ls(t,d,f))),ci(p)!=="player"&&u.push({...tr(p),...h,id:"blank"})):l.push({...tr(p),...h})}return{board:t.id,width:a,height:c,terrain:l,objects:u}}async function wj(t,e,n,r){const i=Ln(t);if(!x(i))return;const s=JE(i,e,n);switch(r){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await qE(()=>s)}function xj(t,e,n){const r=kp(e,n);Mt(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),Mt(t,sn),Ot(t,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Ot(t,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Ot(t,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=qe(t);i.scroll=Mn(t)}async function Ej(t,e,n,r){const i=fn(Lt.MAIN);if(!x(i))return;const s=Ln(t);if(!x(s))return;const o=JE(s,e,n);switch(r){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(r){case"cutall":{for(let a=e.y;a<=n.y;++a)for(let c=e.x;c<=n.x;++c){const l=Jt(s,{x:c,y:a});(l==null?void 0:l.category)===Pn.ISOBJECT&&En(i,s,l,i.timestamp),Se(s,{x:c,y:a})}break}case"cutobjects":{for(let a=e.y;a<=n.y;++a)for(let c=e.x;c<=n.x;++c){const l=Jt(s,{x:c,y:a});(l==null?void 0:l.category)===Pn.ISOBJECT&&En(i,s,l,i.timestamp)}break}case"cutterrain":{for(let a=e.y;a<=n.y;++a)for(let c=e.x;c<=n.x;++c)Se(s,{x:c,y:a});break}}await qE(()=>o)}function vj(t,e,n){const r=kp(e,n);Mt(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),Mt(t,sn),Ot(t,"batch","cut terrain & objects",[`cutall:${r}`,"hk","1"]),Ot(t,"batch","cut objects",[`cutobjects:${r}`,"hk","2"]),Ot(t,"batch","cut terrain",[`cutterrain:${r}`,"hk","3"]);const i=qe(t);i.scroll=Mn(t)}async function kj(t,e,n,r){const i=Ln(t),s=await XE();if(!x(i)||!x(s))return;const o=Math.min(e.x,n.x),a=Math.min(e.y,n.y),c=Math.max(e.x,n.x),l=Math.max(e.y,n.y),u=c-o+1,f=l-a+1,d=Math.min(s.width,u),h=Math.min(s.height,f);switch(r){case"pasteall":{for(let p=0;p<h;++p)for(let m=0;m<d;++m){const b=si({x:m,y:p},s.width);Se(i,{...s.terrain[b],x:o+m,y:a+p})}for(let p=0;p<s.objects.length;++p){const m=s.objects[p];x(m.x)&&x(m.y)&&zo(m.x,m.y,0,u-1,f-1,0)&&kd(i,{...m,id:void 0,x:o+m.x,y:a+m.y})}break}case"pasteobjects":for(let p=0;p<s.objects.length;++p){const m=s.objects[p];x(m.x)&&x(m.y)&&zo(m.x,m.y,0,u-1,f-1,0)&&kd(i,{...m,id:void 0,x:o+m.x,y:a+m.y})}break;case"pasteterrain":for(let p=0;p<h;++p)for(let m=0;m<d;++m){const b=si({x:m,y:p},s.width);Se(i,{...s.terrain[b],x:o+m,y:a+p})}break;case"pasteterraintiled":for(let p=a;p<=l;++p)for(let m=o;m<=c;++m){const b=(m-o)%s.width,_=(p-a)%s.height,v=si({x:b,y:_},s.width);Se(i,{...s.terrain[v],x:m,y:p})}break}}function Tj(t,e,n){const r=kp(e,n);Mt(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),Mt(t,sn),Ot(t,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Ot(t,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Ot(t,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Ot(t,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=qe(t);i.scroll=Mn(t)}function Tp(t,e){return`inspect:${e!=null&&e.id?e.id:Pr(t,e)}`}function Aj(t,e,n){const r=fn(Lt.MAIN);if(!x(r))return;const i=Ln(t);if(!x(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){x(e)&&(e[d]=h)}const a=e.category===Pn.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=Tp(i,e);Mt(t,`${a}: ${c} ${l}`),Mt(t,sn),Ot(t,u,"color",[n,"coloredit"],s,o);const f=qe(t);f.scroll=Mn(t)}function Rj(t,e,n){const r=fn(Lt.MAIN);if(!x(r))return;const i=Ln(t);if(!x(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){x(e)&&(e[d]=h)}const a=e.category===Pn.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=Tp(i,e);Mt(t,`${a}: ${c} ${l}`),Mt(t,sn),Ot(t,u,"char",[n,"charedit"],s,o);const f=qe(t);f.scroll=Mn(t)}function Sj(t,e,n,r,i,s){var f,d,h;function o(p){var b;const m=(r==null?void 0:r[p])??((b=r==null?void 0:r.kinddata)==null?void 0:b[p]);if(!x(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Ut.ISWALK;case"pushable":return 0;case"breakable":return 0}return m}function a(p,m){x(r)&&(r[p]=m)}s?Mt(t,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):Mt(t,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),Mt(t,sn);const c=Tp(e,r);s?(Ot(t,c,"cycle",["cycle","number","1","255"],o,a),Ot(t,c,"collision",["collision","select","iswalking",`${Ut.ISWALK}`,"isswimming",`${Ut.ISSWIM}`],o,a)):Ot(t,c,"collision",["collision","select","iswalkable",`${Ut.ISWALK}`,"isswimable",`${Ut.ISSWIM}`,"issolid",`${Ut.ISSOLID}`],o,a),s&&Ot(t,c,"pushable",["pushable","select","no","0","yes","1"],o,a),Ot(t,c,"breakable",["breakable","select","no","0","yes","1"],o,a);const l=Cc(n),u=pr(l);for(let p=0;p<u.length;++p){const m=u[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ue(l[m])){const[b,_,...v]=l[m];gt(_)&&Ot(t,c,_||m,[m,b,...v],o,a)}break}}Ot(t,c,"copy coords",["copycoords","hk","5"," 5 "]),Mt(t,sn),Ot(t,c,`char: ${r.char??((f=r.kinddata)==null?void 0:f.char)??1}`,["char","hk","a"," A ","next"],o,a),Ot(t,c,`color: ${r.color??((d=r.kinddata)==null?void 0:d.color)??15}`,["color","hk","c"," C ","next"],o,a),Ot(t,c,`bg: ${r.bg??((h=r.kinddata)==null?void 0:h.bg)??0}`,["bg","hk","b"," B ","next"],o,a),Mt(t,sn),Ot(t,c,"make empty",["empty","hk","0"],o,a),Mt(t,sn),Ot(t,"batch","edit @board codepage",[`pageopen:${e.id}`]),Ot(t,"batch",`edit @${Ge(n)}`,[`pageopen:${n.id}`])}function Oj(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function Ij(t,e,n,r){const i=fn(Lt.MAIN);if(!x(i))return;const s=Ln(t);if(x(s))switch(r){case"emptyall":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=Jt(s,{x:a,y:o});(c==null?void 0:c.category)===Pn.ISOBJECT&&En(i,s,c,i.timestamp),Se(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=Jt(s,{x:a,y:o});(c==null?void 0:c.category)===Pn.ISOBJECT&&En(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a)Se(s,{x:a,y:o});break}}}function Nj(t,e,n){const r=fn(Lt.MAIN);if(!x(r))return;const i=Ln(t);if(!x(i))return;const s=Oj(e,n);Mt(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),Mt(t,sn),Ot(t,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),Ot(t,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),Ot(t,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=qe(t);o.scroll=Mn(t)}async function Cj(t,e,n){const r=fn(Lt.MAIN),i=await bj();if(!x(r))return;const s=Ln(t);if(!x(s))return;if(De(r,s),e.x===n.x&&e.y===n.y){const a=Jt(s,e),c=_x(r,a);x(a)&&x(c)&&Sj(t,s,c,a,e,gn(a)),a!=null&&a.kind||(Mt(t,`empty: ${e.x}, ${e.y}`),Mt(t,sn),Ot(t,"empty","copy coords",[`copycoords:${e.x},${e.y}`,"hk","5"," 5 "]),Ot(t,"batch","edit @board codepage",[`pageopen:${s.id}`]))}else mj(t,e,n,i);const o=qe(t);o.scroll=Mn(t)}function Lj(t,e){const n=oe(Lt.MAIN);if(!x(n))return;const r=Ln(e);if(!x(r))return;const i=er(t),s=mN(r,i.target);if(x(s))switch(i.path){case"copycoords":af(tt,dr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":Aj(e,s,i.path);break;case"char":Rj(e,s,i.path);break;case"empty":En(n,r,s,n.timestamp);break;case"code":Vi(tt,e,async()=>{const o=ci(s),a="object";pe(tt,e,`opened [${a}] ${o}`);const c=[r.id,s.id];id(cl(n.id,c),s.code??""),ZA(tt,e),await mg(800),hg(tt,e,n.id,c,a,`${o} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}async function Mj(t,e){const n=Ln(e);if(!x(n))return;const r=er(t),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":xj(e,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await wj(e,c,l,r.target);break;case"cut":vj(e,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await Ej(e,c,l,r.target);break;case"paste":Tj(e,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await kj(e,c,l,r.target);break;case"empty":Nj(e,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":Ij(e,c,l,r.target);break;case"chars":fj(e,c,l,"char");break;case"colors":dj(e,c,l,"color");break;case"bgs":pj(e,c,l,"bg");break;case"copycoords":af(tt,e,[i,s,o,a].join(" "));break;case"remixrun":{const u=Yn(w.book,_t.BOARD,Hc.stat),f=Ae(...u);x(f)&&sE(n.id,f.id,Hc.patternsize,Hc.mirror,c,l,"all");break}case"pageopen":Vi(tt,e,async()=>{await mg(800),gR(tt,e,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const Uj=16,As={},_h={},Fj=60;let QE=0;const _a={},ya={};async function tv(t){const e=lo(),n=oe(Lt.MAIN);if(e.length&&x(n)){const r=await xp(e),i=`${t?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;qA(ee,dr(),i,r)}}async function Bj(){const t=lo(),e=oe(Lt.MAIN);if(t.length&&x(e)){const n=await xp(t);JA(ee,dr(),n)}}async function Pj(){const t=lo(),e=oe(Lt.MAIN);return t.length&&x(e)?xp(t):""}const ee=po("vm",["tick","second"],t=>{var n;if(!ee.session(t))return;const e=dr();switch(t.target){case"operator":C4(t.player),pe(ee,t.player,`operator set to ${t.player}`),ee.replynext(t,"ackoperator",!0);break;case"zsswords":{const r=oe(Lt.MAIN);ee.replynext(t,"ackzsswords",{cli:ap(Es.CLI),loader:ap(Es.LOADER),runtime:ap(Es.RUNTIME),flags:[...pr(Or(t.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isbreakable","notbreakable","p1","p2","p3","cycle","stepx","stepy","light","lightdir","sender","arg"],kinds:[...ro(r,_t.OBJECT).map(i=>Ge(i)),...pr(np)],altkinds:[...ro(r,_t.TERRAIN),...ro(r,_t.BOARD),...ro(r,_t.PALETTE),...ro(r,_t.CHARSET),...ro(r,_t.LOADER)].map(i=>Ge(i)),colors:[...pr(ec)],dirs:[...pr(ud).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...pr(rp)],exprs:["aligned","alligned","contact","blocked","any","count","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":t.player===e&&Vi(ee,t.player,async()=>{if(ue(t.data)){const[r,i]=t.data,s=await hj(r),o=s.map(a=>a.name);P4(s,i),pe(ee,t.player,`loading ${o.join(", ")}`),of(ee,t.player)}});break;case"search":j4(t.player)||of(ee,t.player);break;case"logout":$4(t.player),delete As[t.player],pe(ee,e,`player ${t.player} logout`),of(ee,t.player);break;case"login":FE(t.player)?(As[t.player]=0,pe(ee,dr(),`login from ${t.player}`),ee.replynext(t,"acklogin",!0)):cg(ee,t.player);break;case"local":FE(t.player)?(As[t.player]=0,pe(ee,dr(),`login from ${t.player}`)):cg(ee,t.player);break;case"doot":As[t.player]=0,_h[t.player]=_h[t.player]??0,_h[t.player]%32===0&&pe(ee,t.player,`$whiteactive $blue${t.player}`),++_h[t.player];break;case"input":{if(t.player.includes("local")&&!ME(t.player)&&mR(ee,t.player),!t.player.includes("local")||ME(t.player)){const r=Or(t.player),[i=On.NONE,s=0]=t.data??[On.NONE,0];ue(r.inputqueue)||(r.inputqueue=[]),i!==On.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(ue(t.data)){const[r,i]=t.data,s=cl(r,i);x(ya[s])||(ya[s]=ay(s,o=>{const[a,c]=i,l=Hr(r),u=zi(l,a);if(x(u))if($i(u)===_t.BOARD&&x(c)){const f=Ee(u),d=Sn(f,c);x(d)&&(d.code=o,P0(dx(o),d))}else u.code=o,fF(u)})),_a[s]=_a[s]??new Set,_a[s].add(t.player)}break;case"coderelease":if(ue(t.data)){const[r,i]=t.data,[,s]=i,o=cl(r,i);x(_a[o])&&(_a[o].delete(t.player),_a[o].size===0&&((n=ya[o])==null||n.call(ya),ya[o]=void 0,gt(s)&&H4(s)))}break;case"halt":t.player===e&&Pv(t.data)&&L4(t.data);break;case"tick":Y4(M4());break;case"synthsend":if(gt(t.data)){const[r,i]=aj(t.data),s=oe(Lt.MAIN);da(r,i,void 0,ia(s))}break;case"second":{z4(As);const r=Object.keys(As);for(let i=0;i<r.length;++i)++As[r[i]];for(let i=0;i<r.length;++i){const s=r[i];As[s]>=Uj&&fg(ee,s)}++QE>=Fj&&(QE=0,Vi(ee,t.player,async()=>{await tv(!0)}));break}case"copyjsonfile":if(t.player===e){const r=oe(Lt.MAIN);if(x(r)&&ue(t.data)){const[i]=t.data,s=zi(r,i);x(s)&&tR(ee,e,s,`${Ge(s)}.${ji(s)}.json`)}}break;case"refscroll":{Mt(t.player,"stat refs"),Mt(t.player,sn),Ot(t.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Ot(t.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),Ot(t.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const r=qe(t.player);r.scroll=Mn(t.player);break}case"fork":t.player===e&&Vi(ee,t.player,async()=>{await Bj()});break;case"itchiopublish":Vi(ee,t.player,async()=>{if(t.player===e){const r=oe(Lt.MAIN);if(x(r)){const i=await Pj();QA(ee,t.player,r.name,i)}}});break;case"flush":t.player===e&&Vi(ee,t.player,async()=>{await tv()});break;case"cli":DE(t.player,t.data);break;case"clirepeatlast":V4(t.player);break;case"restart":t.player===e&&(G4(),dg(ee,t.player));break;case"inspect":Vi(ee,t.player,async()=>{if(ue(t.data)){const[r,i]=t.data;await Cj(t.player,r,i)}});break;case"loader":if(ue(t.data)){const[r,i,s,o]=t.data;if(i==="file")VE(t.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){pe(ee,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=oe(Lt.MAIN);x(c)&&x(a.data)&&gt(a.exported)&&(_p(a.data),pe(ee,t.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){pe(ee,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=oe(Lt.MAIN);x(c)&&x(a.data)&&gt(a.exported)&&(yx(c,a.data),pe(ee,t.player,`loaded ${a.exported}`))}else J$(r,i,s,o,t.player)}break;default:{const{target:r,path:i}=er(t.target);switch(It(r)){case"refscroll":switch(i){case"charscroll":{Ot(t.player,"refscroll","char",["char","charedit"]);const s=qe(t.player);s.scroll=Mn(t.player);break}case"colorscroll":{Ot(t.player,"refscroll","color",["color","coloredit"]);const s=qe(t.player);s.scroll=Mn(t.player);break}case"notesscroll":{Mt(t.player,"duration             cdefgab - notes "),Mt(t.player,"y - 64th note        x - rest"),Mt(t.player,"t - 32nd note        "),Mt(t.player,"s - 16th note.       drums"),Mt(t.player,"i - eight note.      0 - tick"),Mt(t.player,"q - quarter note     1 - tweet"),Mt(t.player,"h - half note        2 - cowbell"),Mt(t.player,"w - whole note       p - clap"),Mt(t.player,"                     4 - high snare"),Mt(t.player,"mods                 5 - high woodblock"),Mt(t.player,"3 - triplet          6 - low snare"),Mt(t.player,". - time and a half  7 - low tom"),Mt(t.player,"# - sharp            8 - low woodblock"),Mt(t.player,"! - flat             9 - bass drum");const s=qe(t.player);s.scroll=Mn(t.player);break}}break;case"batch":Vi(ee,t.player,async()=>{await Mj(i,t.player)});break;case"empty":{const s=er(i);switch(s.target){case"copycoords":af(ee,dr(),s.path.split(",").join(" "));break}break}case"inspect":Lj(i,t.player);break;case"touched":if(ue(t.data)){const[s,o,a]=t.data;BE({...t,target:`${s}:${a}`,data:void 0,sender:o})}break;default:{const s=er(i);if(It(s.target)==="self"||!s.path)t.target=t.target.replace("self:",""),BE(t);else{const o=oe(Lt.MAIN);da(s.target,s.path,void 0,ia(o))}break}}break}}},N4());function Dj(){XA(ee)}const{forward:$j}=kR(t=>{TR(t)&&postMessage(t)});onmessage=function(e){$j(e.data)},setTimeout(Dj,100)})();

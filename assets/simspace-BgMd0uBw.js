var LM=Object.defineProperty;var MM=(ti,Un,kn)=>Un in ti?LM(ti,Un,{enumerable:!0,configurable:!0,writable:!0,value:kn}):ti[Un]=kn;var Nt=(ti,Un,kn)=>MM(ti,typeof Un!="symbol"?Un+"":Un,kn);(function(){"use strict";const ti=new Set,Un={emit(e,t,n,r,i){Un.invoke(Db(e,t,n,r,i))},invoke(e){switch(e.target){}ti.forEach(t=>t.handle(e))},connect(e){ti.add(e)},disconnect(e){ti.delete(e)}};var kn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ib(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var ld={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(kn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=r();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(ld);var sb=ld.exports,ud=xs(sb),hd={};(function(e){var t=kn&&kn.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var f=0,d=l.length,p;f<d;f++)(p||!(f in l))&&(p||(p=Array.prototype.slice.call(l,0,f)),p[f]=l[f]);return u.concat(p||Array.prototype.slice.call(l))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(u){return u[Math.floor(Math.random()*u.length)]}function r(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,f=u.capitalize,d=f===void 0?!0:f,p=u.adjectiveCount,m=p===void 0?1:p,w=u.addAdverb,E=w===void 0?!1:w,x=t(t(t([],t([],Array(m),!0).map(function(A){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),E?[n(e.adverbs)]:[],!0);return d&&(x=x.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),x.join(h)}e.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(d?e.adverbs.length:1)}e.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,m=p===void 0?"":p;return r(e.adjectives).length*h+h*m.length+r(e.nouns).length+m.length+r(e.verbs).length+(d?r(e.adverbs).length+m.length:0)}e.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,m=p===void 0?"":p;return i(e.adjectives).length*h+h*m.length+i(e.nouns).length+m.length+i(e.verbs).length+(d?i(e.adverbs).length+m.length:0)}e.minLength=c,e.default=s})(hd);var ob=xs(hd);const ab="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let cb=e=>crypto.getRandomValues(new Uint8Array(e)),lb=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},fd=(e,t=21)=>lb(e,t,cb),ub=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=ab[n[e]&63];return t};var dd="abcdefghijklmnopqrstuvwxyz",pd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",md="0123456789",hb="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",fb="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const db=md,pb=dd,mb=pd;var gb=db+pb+mb,Bl={lowercase:dd,uppercase:pd,numbers:md,nolookalikes:hb,nolookalikesSafe:fb,alphanumeric:gb};function Ne(){return`sid_${ub(12).replaceAll("-",".")}`}fd(Bl.numbers,4),fd(`${Bl.numbers}${Bl.lowercase}`,16);function Ts(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function yb(){return ob({capitalize:!1,adjectiveCount:1})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var _b=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),bb=Object.prototype.hasOwnProperty;function Pl(e,t){return bb.call(e,t)}function Dl(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)Pl(e,i)&&r.push(i);return r}function xn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function $l(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Yi(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function gd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function jl(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(jl(e[t]))return!0}else if(typeof e=="object"){for(var r=Dl(e),i=r.length,s=0;s<i;s++)if(jl(e[r[s]]))return!0}}return!1}function yd(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var _d=function(e){_b(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,yd(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=yd(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),Se=_d,Eb=xn,As={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=va(n,this.path);r&&(r=xn(r));var i=Vi(n,{op:"remove",path:this.from}).removed;return Vi(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=va(n,this.from);return Vi(n,{op:"add",path:this.path,value:xn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:wo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},wb={add:function(e,t,n){return $l(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:As.move,copy:As.copy,test:As.test,_get:As._get};function va(e,t){if(t=="")return e;var n={op:"_get",path:t};return Vi(e,n),n.value}function Vi(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Sa(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=va(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=wo(e,t.value),o.test===!1)throw new Se("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Se("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=xn(e));var a=t.path||"",c=a.split("/"),u=e,l=1,h=c.length,f=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=Sa;;){if(d=c[l],d&&d.indexOf("~")!=-1&&(d=gd(d)),i&&(d=="__proto__"||d=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&f===void 0&&(u[d]===void 0?f=c.slice(0,l).join("/"):l==h-1&&(f=t.path),f!==void 0&&p(t,0,e,f)),l++,Array.isArray(u)){if(d==="-")d=u.length;else{if(n&&!$l(d))throw new Se("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);$l(d)&&(d=~~d)}if(l>=h){if(n&&t.op==="add"&&d>u.length)throw new Se("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=wb[t.op].call(t,u,d,e);if(o.test===!1)throw new Se("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(l>=h){var o=As[t.op].call(t,u,d,e);if(o.test===!1)throw new Se("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(u=u[d],n&&l<h&&(!u||typeof u!="object"))throw new Se("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function zl(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Se("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=xn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Vi(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function kb(e,t,n){var r=Vi(e,t);if(r.test===!1)throw new Se("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Sa(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Se("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(As[e.op]){if(typeof e.path!="string")throw new Se("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Se('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Se("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Se("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&jl(e.value))throw new Se("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Se("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Se("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=bd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Se("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Se("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function bd(e,t,n){try{if(!Array.isArray(e))throw new Se("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)zl(xn(t),xn(e),n||!0);else{n=n||Sa;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Se)return i;throw i}}function wo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!wo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!wo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var xb=Object.freeze({__proto__:null,JsonPatchError:Se,_areEquals:wo,applyOperation:Vi,applyPatch:zl,applyReducer:kb,deepClone:Eb,getValueByPointer:va,validate:bd,validator:Sa});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Wl=new WeakMap,Tb=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Ab=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function vb(e){return Wl.get(e)}function Sb(e,t){return e.observers.get(t)}function Rb(e,t){e.observers.delete(t.callback)}function Ib(e,t){t.unobserve()}function Ob(e,t){var n=[],r,i=vb(e);if(!i)i=new Tb(e),Wl.set(e,i);else{var s=Sb(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=xn(e),t){r.callback=t,r.next=null;var o=function(){Kl(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){Kl(r),clearTimeout(r.next),Rb(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new Ab(t,r)),r}function Kl(e,t){t===void 0&&(t=!1);var n=Wl.get(e.object);Gl(n.value,e.object,e.patches,"",t),e.patches.length&&zl(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Gl(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Dl(t),o=Dl(e),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=e[u];if(Pl(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var h=t[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?Gl(l,h,n,r+"/"+Yi(u),i):l!==h&&(i&&n.push({op:"test",path:r+"/"+Yi(u),value:xn(l)}),n.push({op:"replace",path:r+"/"+Yi(u),value:xn(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Yi(u),value:xn(l)}),n.push({op:"remove",path:r+"/"+Yi(u)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!Pl(e,u)&&t[u]!==void 0&&n.push({op:"add",path:r+"/"+Yi(u),value:xn(t[u])})}}}function Ed(e,t,n){n===void 0&&(n=!1);var r=[];return Gl(e,t,r,"",n),r}var Nb=Object.freeze({__proto__:null,compare:Ed,generate:Kl,observe:Ob,unobserve:Ib});Object.assign({},xb,Nb,{JsonPatchError:_d,deepClone:xn,escapePathComponent:Yi,unescapePathComponent:gd});var Cb=typeof Element<"u",Lb=typeof Map=="function",Mb=typeof Set=="function",Ub=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ra(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ra(e[r],t[r]))return!1;return!0}var s;if(Lb&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ra(r.value[1],t.get(r.value[0])))return!1;return!0}if(Mb&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(Ub&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(Cb&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ra(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var Fb=function(t,n){try{return Ra(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},Bb=xs(Fb);function k(e){return e!=null}const Kn=Object.keys;function Xe(e){return xn(e)}function Pb(e){return typeof e=="boolean"}function Ct(e){return typeof e=="number"&&isNaN(e)===!1}function St(e){return typeof e=="string"}function re(e){return Array.isArray(e)}function Hl(e){return e}var jt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(jt||{}),Ht=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Ht||{}),Gn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Gn||{}),yt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(yt||{}),wt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.COPYIT=13]="COPYIT",e[e.OPENIT=14]="OPENIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(wt||{});function Mt(e){return e.toLowerCase().trim()}function Db(e,t,n,r,i){return{session:e,id:Ne(),target:t,sender:n,data:r,player:i}}function Xi(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function vs(e,t=[],n=Hl,r=""){const i=Ne(),s=Mt(e),o=t.map(Mt);let a=r;const c={id(){return i},name(){return e},session(u){return k(u)?u.session===a?u.session:"":a},topics(){return t},emit(u,l,h){Un.emit(a,u,i,l,h)},reply(u,l,h,f){c.emit(`${u.sender}:${l}`,h,f)},replynext(u,l,h,f){setTimeout(()=>c.emit(`${u.sender}:${l}`,h,f),64)},handle(u){const{target:l,path:h}=Xi(u.target),f=Mt(l);!a&&f==="ready"&&(a=u.session),f==="bridge"&&k(u.session)&&(a=u.session),o.findIndex(d=>d==="all"||d===f)!==-1&&n(u),(i===l||f==="all"||s===f)&&n({...u,target:h})}};return Un.connect(c),c}function $b(e){return k(e)&&typeof e=="object"&&St(e.id)&&St(e.target)&&St(e.sender)}function ae(e,t,n,r){const i=r??"";return e.emit(`error:${t}`,n,i),dE(e,n,i)}function jb(e,t,n){e.emit("broadcast:startstream",t,n)}function zb(e,t){e.emit("broadcast:stopstream",void 0,t)}function Wb(e,t,n){e.emit("chat:connect",t,n)}function Kb(e,t){e.emit("chat:disconnect",void 0,t)}function Gb(e,t,n){e.emit("gadgetclient:paint",t,n)}function Hb(e,t,n){e.emit("gadgetclient:patch",t,n)}function Yb(e,t){e.emit("gadgetserver:clearscroll",void 0,t)}function Vb(e,t,n,r,i,s,o){e.emit("network:fetch",[t,n,r,i,s],o)}function Xb(e,t,n){e.emit("network:start",t,n)}function qb(e,t,n){e.emit("network:tab",t,n)}function Jb(e){e.emit("ready")}function Yl(e,t){e.emit("register:loginready",!0,t)}function Zb(e,t,n,r){e.emit("register:savemem",[t,n],r)}function Qb(e,t,n){e.emit("register:forkmem",[t],n)}function tE(e,t,n){e.emit("register:copy",t,n)}function eE(e,t,n,r){e.emit("register:copyjsonfile",[t,n],r)}function wd(e,t,n,r){e.emit("register:downloadjsonfile",[t,n],r)}function nE(e,t){e.emit("register:dev",void 0,t)}function rE(e,t){e.emit("register:share",void 0,t)}function iE(e,t){e.emit("register:nuke",void 0,t)}function sE(e,t,n){e.emit("synth:tts",[t,n])}function oE(e,t){e.emit("synth:tta",[t])}function aE(e,t,n){e.emit("synth:play",[t,n])}function cE(e,t){e.emit("synth:bpm",t)}function lE(e,t){e.emit("synth:playvolume",t)}function uE(e,t){e.emit("synth:bgplayvolume",t)}function hE(e,t){e.emit("synth:ttsvolume",t)}function Vl(e,t,n,r){e.emit("synth:voice",[t,n,r])}function kd(e,t,n,r,i){e.emit("synth:voicefx",[t,n,r,i])}function xr(e,...t){return e.emit("tape:info",t),!0}function xd(e,...t){return e.emit("tape:debug",t),!0}function fE(e,t,n){e.emit("tape:inspector",t,n)}function dE(e,...t){return e.emit("tape:error",t),!1}function Td(e,t,n,r,i,s){e.emit("tape:editor:open",[t,n,r,i],s)}function Ad(e,t){e.emit("vm:logout",void 0,t)}function Ia(e,t){return`${e}:${t.join(":")}`}function pE(e,t){e.emit("vm:restart",void 0,t)}function vd(e,t){e.emit("vm:flush",void 0,t)}function mE(e,t){e.emit("vm:fork",void 0,t)}function gE(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function yE(e,t){return{filename:e,json:t}}function _E(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function Xl(e,t,n,r,i,s){let o;switch(n){case"file":o=i;break;case"text":o=gE(r,i);break;case"json":o=yE(r,i);break;case"binary":o=_E(r,i);break}setTimeout(()=>{e.emit("vm:loader",[t,n,r,o],s)},1)}function bE(e){const t=new Set;function n(s){$b(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Un.invoke(s))}const r=vs("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Un.disconnect(r)}return{forward:n,disconnect:i}}const ql=66.666,Oa=Math.round(1e3/ql),EE=3;function wE(e){return new Promise(t=>setTimeout(t,e))}const Jl=vs("clock");let Zl=0,Na=0,Ql=0,Sd=performance.now();function Rd(){const e=performance.now(),t=e-Sd;Ql+=t,Ql>=ql&&(Ql%=ql,Jl.emit("tick",Na),Jl.emit("tock",Na),++Zl,++Na,Zl>=Oa&&(Zl%=Oa,Jl.emit("second",Na))),Sd=e,setTimeout(Rd,2)}Rd();const Id=1,Od=2,tu=4,eu=8,ko=32,ei=64,Fn=128,Ca=31,nu=63,qi=127,kE=2147483647,xi=Math.floor,La=Math.abs,Nd=(e,t)=>e<t?e:t,Ji=(e,t)=>e>t?e:t,Cd=e=>e!==0?e<0:1/e<0,Ld=Number.MAX_SAFE_INTEGER,xE=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&xi(e)===e),Ss=()=>new Set,ru=e=>e[e.length-1],TE=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Ti=Array.from,AE=Array.isArray,vE=e=>e.toLowerCase(),SE=/^\s*/g,RE=e=>e.replace(SE,""),IE=/([A-Z])/g,Md=(e,t)=>RE(e.replace(IE,n=>`${t}${vE(n)}`)),OE=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},xo=typeof TextEncoder<"u"?new TextEncoder:null,NE=xo?e=>xo.encode(e):OE;let To=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});To&&To.decode(new Uint8Array).length===1&&(To=null);const Ai=e=>new Error(e),Tr=()=>{throw Ai("Method unimplemented")},Ar=()=>{throw Ai("Unexpected case")};class Ao{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const vi=()=>new Ao,CE=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},cr=e=>{const t=new Uint8Array(CE(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},LE=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Ji(n,t)*2),e.cpos=0)},qe=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},iu=qe,Bt=(e,t)=>{for(;t>qi;)qe(e,Fn|qi&t),t=xi(t/128);qe(e,qi&t)},su=(e,t)=>{const n=Cd(t);for(n&&(t=-t),qe(e,(t>nu?Fn:0)|(n?ei:0)|nu&t),t=xi(t/64);t>0;)qe(e,(t>qi?Fn:0)|qi&t),t=xi(t/128)},ou=new Uint8Array(3e4),ME=ou.length/3,UE=(e,t)=>{if(t.length<ME){const n=xo.encodeInto(t,ou).written||0;Bt(e,n);for(let r=0;r<n;r++)qe(e,ou[r])}else sn(e,NE(t))},FE=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;Bt(e,r);for(let i=0;i<r;i++)qe(e,n.codePointAt(i))},Rs=xo&&xo.encodeInto?UE:FE,Ma=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=Nd(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Ji(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},sn=(e,t)=>{Bt(e,t.byteLength),Ma(e,t)},au=(e,t)=>{LE(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},BE=(e,t)=>au(e,4).setFloat32(0,t,!1),PE=(e,t)=>au(e,8).setFloat64(0,t,!1),DE=(e,t)=>au(e,8).setBigInt64(0,t,!1),Ud=new DataView(new ArrayBuffer(4)),$E=e=>(Ud.setFloat32(0,e),Ud.getFloat32(0)===e),vo=(e,t)=>{switch(typeof t){case"string":qe(e,119),Rs(e,t);break;case"number":xE(t)&&La(t)<=kE?(qe(e,125),su(e,t)):$E(t)?(qe(e,124),BE(e,t)):(qe(e,123),PE(e,t));break;case"bigint":qe(e,122),DE(e,t);break;case"object":if(t===null)qe(e,126);else if(AE(t)){qe(e,117),Bt(e,t.length);for(let n=0;n<t.length;n++)vo(e,t[n])}else if(t instanceof Uint8Array)qe(e,116),sn(e,t);else{qe(e,118);const n=Object.keys(t);Bt(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Rs(e,i),vo(e,t[i])}}break;case"boolean":qe(e,t?120:121);break;default:qe(e,127)}};class Fd extends Ao{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&Bt(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Bd=e=>{e.count>0&&(su(e.encoder,e.count===1?e.s:-e.s),e.count>1&&Bt(e.encoder,e.count-2))};class Ua{constructor(){this.encoder=new Ao,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Bd(this),this.count=1,this.s=t)}toUint8Array(){return Bd(this),cr(this.encoder)}}const Pd=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);su(e.encoder,t),e.count>1&&Bt(e.encoder,e.count-2)}};class cu{constructor(){this.encoder=new Ao,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Pd(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Pd(this),cr(this.encoder)}}class jE{constructor(){this.sarr=[],this.s="",this.lensE=new Ua}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Ao;return this.sarr.push(this.s),this.s="",Rs(t,this.sarr.join("")),Ma(t,this.lensE.toUint8Array()),cr(t)}}const Dd=Ai("Unexpected end of array"),$d=Ai("Integer out of Range");class Fa{constructor(t){this.arr=t,this.pos=0}}const Zi=e=>new Fa(e),zE=e=>e.pos!==e.arr.length,WE=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},dn=e=>WE(e,Pt(e)),Is=e=>e.arr[e.pos++],Pt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&qi)*n,n*=128,i<Fn)return t;if(t>Ld)throw $d}throw Dd},lu=e=>{let t=e.arr[e.pos++],n=t&nu,r=64;const i=(t&ei)>0?-1:1;if(!(t&Fn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&qi)*r,r*=128,t<Fn)return i*n;if(n>Ld)throw $d}throw Dd},Os=To?e=>To.decode(dn(e)):e=>{let t=Pt(e);if(t===0)return"";{let n=String.fromCodePoint(Is(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Is(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},uu=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},KE=[e=>{},e=>null,lu,e=>uu(e,4).getFloat32(0,!1),e=>uu(e,8).getFloat64(0,!1),e=>uu(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Os,e=>{const t=Pt(e),n={};for(let r=0;r<t;r++){const i=Os(e);n[i]=So(e)}return n},e=>{const t=Pt(e),n=[];for(let r=0;r<t;r++)n.push(So(e));return n},dn],So=e=>KE[127-Is(e)](e);class jd extends Fa{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),zE(this)?this.count=Pt(this)+1:this.count=-1),this.count--,this.s}}class Ba extends Fa{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=lu(this);const t=Cd(this.s);this.count=1,t&&(this.s=-this.s,this.count=Pt(this)+2)}return this.count--,this.s}}class hu extends Fa{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=lu(this),n=t&1;this.diff=xi(t/2),this.count=1,n&&(this.count=Pt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class GE{constructor(t){this.decoder=new Ba(t),this.str=Os(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}var Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ro=Symbol.for("react.element"),HE=Symbol.for("react.portal"),YE=Symbol.for("react.fragment"),VE=Symbol.for("react.strict_mode"),XE=Symbol.for("react.profiler"),qE=Symbol.for("react.provider"),JE=Symbol.for("react.context"),ZE=Symbol.for("react.forward_ref"),QE=Symbol.for("react.suspense"),tw=Symbol.for("react.memo"),ew=Symbol.for("react.lazy"),zd=Symbol.iterator;function nw(e){return e===null||typeof e!="object"?null:(e=zd&&e[zd]||e["@@iterator"],typeof e=="function"?e:null)}var Wd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Kd=Object.assign,Gd={};function Ns(e,t,n){this.props=e,this.context=t,this.refs=Gd,this.updater=n||Wd}Ns.prototype.isReactComponent={},Ns.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Ns.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Hd(){}Hd.prototype=Ns.prototype;function fu(e,t,n){this.props=e,this.context=t,this.refs=Gd,this.updater=n||Wd}var du=fu.prototype=new Hd;du.constructor=fu,Kd(du,Ns.prototype),du.isPureReactComponent=!0;var Yd=Array.isArray,Vd=Object.prototype.hasOwnProperty,pu={current:null},Xd={key:!0,ref:!0,__self:!0,__source:!0};function qd(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)Vd.call(t,r)&&!Xd.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ro,type:e,key:s,ref:o,props:i,_owner:pu.current}}function rw(e,t){return{$$typeof:Ro,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function mu(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ro}function iw(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Jd=/\/+/g;function gu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?iw(""+e.key):t.toString(36)}function Pa(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Ro:case HE:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+gu(o,0):r,Yd(i)?(n="",e!=null&&(n=e.replace(Jd,"$&/")+"/"),Pa(i,t,n,"",function(u){return u})):i!=null&&(mu(i)&&(i=rw(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Jd,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",Yd(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+gu(s,a);o+=Pa(s,t,n,c,i)}else if(c=nw(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+gu(s,a++),o+=Pa(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Da(e,t,n){if(e==null)return e;var r=[],i=0;return Pa(e,r,"","",function(s){return t.call(n,s,i++)}),r}function sw(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var pn={current:null},$a={transition:null},ow={ReactCurrentDispatcher:pn,ReactCurrentBatchConfig:$a,ReactCurrentOwner:pu};function Zd(){throw Error("act(...) is not supported in production builds of React.")}Yt.Children={map:Da,forEach:function(e,t,n){Da(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Da(e,function(){t++}),t},toArray:function(e){return Da(e,function(t){return t})||[]},only:function(e){if(!mu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Yt.Component=Ns,Yt.Fragment=YE,Yt.Profiler=XE,Yt.PureComponent=fu,Yt.StrictMode=VE,Yt.Suspense=QE,Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ow,Yt.act=Zd,Yt.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Kd({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=pu.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)Vd.call(t,c)&&!Xd.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Ro,type:e.type,key:i,ref:s,props:r,_owner:o}},Yt.createContext=function(e){return e={$$typeof:JE,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:qE,_context:e},e.Consumer=e},Yt.createElement=qd,Yt.createFactory=function(e){var t=qd.bind(null,e);return t.type=e,t},Yt.createRef=function(){return{current:null}},Yt.forwardRef=function(e){return{$$typeof:ZE,render:e}},Yt.isValidElement=mu,Yt.lazy=function(e){return{$$typeof:ew,_payload:{_status:-1,_result:e},_init:sw}},Yt.memo=function(e,t){return{$$typeof:tw,type:e,compare:t===void 0?null:t}},Yt.startTransition=function(e){var t=$a.transition;$a.transition={};try{e()}finally{$a.transition=t}},Yt.unstable_act=Zd,Yt.useCallback=function(e,t){return pn.current.useCallback(e,t)},Yt.useContext=function(e){return pn.current.useContext(e)},Yt.useDebugValue=function(){},Yt.useDeferredValue=function(e){return pn.current.useDeferredValue(e)},Yt.useEffect=function(e,t){return pn.current.useEffect(e,t)},Yt.useId=function(){return pn.current.useId()},Yt.useImperativeHandle=function(e,t,n){return pn.current.useImperativeHandle(e,t,n)},Yt.useInsertionEffect=function(e,t){return pn.current.useInsertionEffect(e,t)},Yt.useLayoutEffect=function(e,t){return pn.current.useLayoutEffect(e,t)},Yt.useMemo=function(e,t){return pn.current.useMemo(e,t)},Yt.useReducer=function(e,t,n){return pn.current.useReducer(e,t,n)},Yt.useRef=function(e){return pn.current.useRef(e)},Yt.useState=function(e){return pn.current.useState(e)},Yt.useSyncExternalStore=function(e,t,n){return pn.current.useSyncExternalStore(e,t,n)},Yt.useTransition=function(){return pn.current.useTransition()},Yt.version="18.3.1";const Cs=globalThis||void 0||self,lr=()=>new Map,yu=e=>{const t=lr();return e.forEach((n,r)=>{t.set(r,n)}),t},Si=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},aw=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},cw=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1};class lw{constructor(){this._observers=lr()}on(t,n){return Si(this._observers,t,Ss).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Ti((this._observers.get(t)||lr()).values()).forEach(r=>r(...n))}destroy(){this._observers=lr()}}const uw=crypto.getRandomValues.bind(crypto),Qd=()=>uw(new Uint32Array(1))[0],hw="10000000-1000-4000-8000"+-1e11,fw=()=>hw.replace(/[018]/g,e=>(e^Qd()&15>>e/4).toString(16)),tp=e=>new Promise(e);Promise.all.bind(Promise);var ep={},ja={};ja.byteLength=mw,ja.toByteArray=yw,ja.fromByteArray=Ew;for(var vr=[],Hn=[],dw=typeof Uint8Array<"u"?Uint8Array:Array,_u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ls=0,pw=_u.length;Ls<pw;++Ls)vr[Ls]=_u[Ls],Hn[_u.charCodeAt(Ls)]=Ls;Hn[45]=62,Hn[95]=63;function np(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function mw(e){var t=np(e),n=t[0],r=t[1];return(n+r)*3/4-r}function gw(e,t,n){return(t+n)*3/4-n}function yw(e){var t,n=np(e),r=n[0],i=n[1],s=new dw(gw(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=Hn[e.charCodeAt(c)]<<18|Hn[e.charCodeAt(c+1)]<<12|Hn[e.charCodeAt(c+2)]<<6|Hn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=Hn[e.charCodeAt(c)]<<2|Hn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=Hn[e.charCodeAt(c)]<<10|Hn[e.charCodeAt(c+1)]<<4|Hn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function _w(e){return vr[e>>18&63]+vr[e>>12&63]+vr[e>>6&63]+vr[e&63]}function bw(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(_w(r));return i.join("")}function Ew(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(bw(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(vr[t>>2]+vr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(vr[t>>10]+vr[t>>4&63]+vr[t<<2&63]+"=")),i.join("")}var bu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */bu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,u=c>>1,l=-7,h=n?i-1:0,f=n?-1:1,d=e[t+h];for(h+=f,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=s*256+e[t+h],h+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=o*256+e[t+h],h+=f,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-u}return(d?-1:1)*o*Math.pow(2,s-r)},bu.write=function(e,t,n,r,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,h=l>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,m=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=f/c:t+=f*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+d]=a&255,d+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+d]=o&255,d+=p,o/=256,u-=8);e[n+d-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=ja,n=bu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=U,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const v=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(v,g),v.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(v){if(v>i)throw new RangeError('The value "'+v+'" is invalid for option "size"');const g=new s(v);return Object.setPrototypeOf(g,l.prototype),g}function l(v,g,y){if(typeof v=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(v)}return h(v,g,y)}l.poolSize=8192;function h(v,g,y){if(typeof v=="string")return m(v,g);if(o.isView(v))return E(v);if(v==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof v);if(dt(v,o)||v&&dt(v.buffer,o)||typeof a<"u"&&(dt(v,a)||v&&dt(v.buffer,a)))return x(v,g,y);if(typeof v=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const N=v.valueOf&&v.valueOf();if(N!=null&&N!==v)return l.from(N,g,y);const D=A(v);if(D)return D;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof v[Symbol.toPrimitive]=="function")return l.from(v[Symbol.toPrimitive]("string"),g,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof v)}l.from=function(v,g,y){return h(v,g,y)},Object.setPrototypeOf(l.prototype,s.prototype),Object.setPrototypeOf(l,s);function f(v){if(typeof v!="number")throw new TypeError('"size" argument must be of type number');if(v<0)throw new RangeError('The value "'+v+'" is invalid for option "size"')}function d(v,g,y){return f(v),v<=0?u(v):g!==void 0?typeof y=="string"?u(v).fill(g,y):u(v).fill(g):u(v)}l.alloc=function(v,g,y){return d(v,g,y)};function p(v){return f(v),u(v<0?0:I(v)|0)}l.allocUnsafe=function(v){return p(v)},l.allocUnsafeSlow=function(v){return p(v)};function m(v,g){if((typeof g!="string"||g==="")&&(g="utf8"),!l.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const y=S(v,g)|0;let N=u(y);const D=N.write(v,g);return D!==y&&(N=N.slice(0,D)),N}function w(v){const g=v.length<0?0:I(v.length)|0,y=u(g);for(let N=0;N<g;N+=1)y[N]=v[N]&255;return y}function E(v){if(dt(v,s)){const g=new s(v);return x(g.buffer,g.byteOffset,g.byteLength)}return w(v)}function x(v,g,y){if(g<0||v.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(v.byteLength<g+(y||0))throw new RangeError('"length" is outside of buffer bounds');let N;return g===void 0&&y===void 0?N=new s(v):y===void 0?N=new s(v,g):N=new s(v,g,y),Object.setPrototypeOf(N,l.prototype),N}function A(v){if(l.isBuffer(v)){const g=I(v.length)|0,y=u(g);return y.length===0||v.copy(y,0,0,g),y}if(v.length!==void 0)return typeof v.length!="number"||vt(v.length)?u(0):w(v);if(v.type==="Buffer"&&Array.isArray(v.data))return w(v.data)}function I(v){if(v>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return v|0}function U(v){return+v!=v&&(v=0),l.alloc(+v)}l.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==l.prototype},l.compare=function(g,y){if(dt(g,s)&&(g=l.from(g,g.offset,g.byteLength)),dt(y,s)&&(y=l.from(y,y.offset,y.byteLength)),!l.isBuffer(g)||!l.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===y)return 0;let N=g.length,D=y.length;for(let Q=0,rt=Math.min(N,D);Q<rt;++Q)if(g[Q]!==y[Q]){N=g[Q],D=y[Q];break}return N<D?-1:D<N?1:0},l.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(g,y){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return l.alloc(0);let N;if(y===void 0)for(y=0,N=0;N<g.length;++N)y+=g[N].length;const D=l.allocUnsafe(y);let Q=0;for(N=0;N<g.length;++N){let rt=g[N];if(dt(rt,s))Q+rt.length>D.length?(l.isBuffer(rt)||(rt=l.from(rt)),rt.copy(D,Q)):s.prototype.set.call(D,rt,Q);else if(l.isBuffer(rt))rt.copy(D,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=rt.length}return D};function S(v,g){if(l.isBuffer(v))return v.length;if(o.isView(v)||dt(v,o))return v.byteLength;if(typeof v!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof v);const y=v.length,N=arguments.length>2&&arguments[2]===!0;if(!N&&y===0)return 0;let D=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return at(v).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return pt(v).length;default:if(D)return N?-1:at(v).length;g=(""+g).toLowerCase(),D=!0}}l.byteLength=S;function O(v,g,y){let N=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,g>>>=0,y<=g))return"";for(v||(v="utf8");;)switch(v){case"hex":return W(this,g,y);case"utf8":case"utf-8":return $(this,g,y);case"ascii":return ft(this,g,y);case"latin1":case"binary":return H(this,g,y);case"base64":return Z(this,g,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,g,y);default:if(N)throw new TypeError("Unknown encoding: "+v);v=(v+"").toLowerCase(),N=!0}}l.prototype._isBuffer=!0;function B(v,g,y){const N=v[g];v[g]=v[y],v[y]=N}l.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<g;y+=2)B(this,y,y+1);return this},l.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<g;y+=4)B(this,y,y+3),B(this,y+1,y+2);return this},l.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<g;y+=8)B(this,y,y+7),B(this,y+1,y+6),B(this,y+2,y+5),B(this,y+3,y+4);return this},l.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?$(this,0,g):O.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(g){if(!l.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:l.compare(this,g)===0},l.prototype.inspect=function(){let g="";const y=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(g+=" ... "),"<Buffer "+g+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(g,y,N,D,Q){if(dt(g,s)&&(g=l.from(g,g.offset,g.byteLength)),!l.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(y===void 0&&(y=0),N===void 0&&(N=g?g.length:0),D===void 0&&(D=0),Q===void 0&&(Q=this.length),y<0||N>g.length||D<0||Q>this.length)throw new RangeError("out of range index");if(D>=Q&&y>=N)return 0;if(D>=Q)return-1;if(y>=N)return 1;if(y>>>=0,N>>>=0,D>>>=0,Q>>>=0,this===g)return 0;let rt=Q-D,Ft=N-y;const Ee=Math.min(rt,Ft),ye=this.slice(D,Q),we=g.slice(y,N);for(let oe=0;oe<Ee;++oe)if(ye[oe]!==we[oe]){rt=ye[oe],Ft=we[oe];break}return rt<Ft?-1:Ft<rt?1:0};function C(v,g,y,N,D){if(v.length===0)return-1;if(typeof y=="string"?(N=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,vt(y)&&(y=D?0:v.length-1),y<0&&(y=v.length+y),y>=v.length){if(D)return-1;y=v.length-1}else if(y<0)if(D)y=0;else return-1;if(typeof g=="string"&&(g=l.from(g,N)),l.isBuffer(g))return g.length===0?-1:G(v,g,y,N,D);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?D?s.prototype.indexOf.call(v,g,y):s.prototype.lastIndexOf.call(v,g,y):G(v,[g],y,N,D);throw new TypeError("val must be string, number or Buffer")}function G(v,g,y,N,D){let Q=1,rt=v.length,Ft=g.length;if(N!==void 0&&(N=String(N).toLowerCase(),N==="ucs2"||N==="ucs-2"||N==="utf16le"||N==="utf-16le")){if(v.length<2||g.length<2)return-1;Q=2,rt/=2,Ft/=2,y/=2}function Ee(we,oe){return Q===1?we[oe]:we.readUInt16BE(oe*Q)}let ye;if(D){let we=-1;for(ye=y;ye<rt;ye++)if(Ee(v,ye)===Ee(g,we===-1?0:ye-we)){if(we===-1&&(we=ye),ye-we+1===Ft)return we*Q}else we!==-1&&(ye-=ye-we),we=-1}else for(y+Ft>rt&&(y=rt-Ft),ye=y;ye>=0;ye--){let we=!0;for(let oe=0;oe<Ft;oe++)if(Ee(v,ye+oe)!==Ee(g,oe)){we=!1;break}if(we)return ye}return-1}l.prototype.includes=function(g,y,N){return this.indexOf(g,y,N)!==-1},l.prototype.indexOf=function(g,y,N){return C(this,g,y,N,!0)},l.prototype.lastIndexOf=function(g,y,N){return C(this,g,y,N,!1)};function tt(v,g,y,N){y=Number(y)||0;const D=v.length-y;N?(N=Number(N),N>D&&(N=D)):N=D;const Q=g.length;N>Q/2&&(N=Q/2);let rt;for(rt=0;rt<N;++rt){const Ft=parseInt(g.substr(rt*2,2),16);if(vt(Ft))return rt;v[y+rt]=Ft}return rt}function L(v,g,y,N){return _t(at(g,v.length-y),v,y,N)}function R(v,g,y,N){return _t(ht(g),v,y,N)}function _(v,g,y,N){return _t(pt(g),v,y,N)}function P(v,g,y,N){return _t(J(g,v.length-y),v,y,N)}l.prototype.write=function(g,y,N,D){if(y===void 0)D="utf8",N=this.length,y=0;else if(N===void 0&&typeof y=="string")D=y,N=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(N)?(N=N>>>0,D===void 0&&(D="utf8")):(D=N,N=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Q=this.length-y;if((N===void 0||N>Q)&&(N=Q),g.length>0&&(N<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");D||(D="utf8");let rt=!1;for(;;)switch(D){case"hex":return tt(this,g,y,N);case"utf8":case"utf-8":return L(this,g,y,N);case"ascii":case"latin1":case"binary":return R(this,g,y,N);case"base64":return _(this,g,y,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,g,y,N);default:if(rt)throw new TypeError("Unknown encoding: "+D);D=(""+D).toLowerCase(),rt=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(v,g,y){return g===0&&y===v.length?t.fromByteArray(v):t.fromByteArray(v.slice(g,y))}function $(v,g,y){y=Math.min(v.length,y);const N=[];let D=g;for(;D<y;){const Q=v[D];let rt=null,Ft=Q>239?4:Q>223?3:Q>191?2:1;if(D+Ft<=y){let Ee,ye,we,oe;switch(Ft){case 1:Q<128&&(rt=Q);break;case 2:Ee=v[D+1],(Ee&192)===128&&(oe=(Q&31)<<6|Ee&63,oe>127&&(rt=oe));break;case 3:Ee=v[D+1],ye=v[D+2],(Ee&192)===128&&(ye&192)===128&&(oe=(Q&15)<<12|(Ee&63)<<6|ye&63,oe>2047&&(oe<55296||oe>57343)&&(rt=oe));break;case 4:Ee=v[D+1],ye=v[D+2],we=v[D+3],(Ee&192)===128&&(ye&192)===128&&(we&192)===128&&(oe=(Q&15)<<18|(Ee&63)<<12|(ye&63)<<6|we&63,oe>65535&&oe<1114112&&(rt=oe))}}rt===null?(rt=65533,Ft=1):rt>65535&&(rt-=65536,N.push(rt>>>10&1023|55296),rt=56320|rt&1023),N.push(rt),D+=Ft}return et(N)}const lt=4096;function et(v){const g=v.length;if(g<=lt)return String.fromCharCode.apply(String,v);let y="",N=0;for(;N<g;)y+=String.fromCharCode.apply(String,v.slice(N,N+=lt));return y}function ft(v,g,y){let N="";y=Math.min(v.length,y);for(let D=g;D<y;++D)N+=String.fromCharCode(v[D]&127);return N}function H(v,g,y){let N="";y=Math.min(v.length,y);for(let D=g;D<y;++D)N+=String.fromCharCode(v[D]);return N}function W(v,g,y){const N=v.length;(!g||g<0)&&(g=0),(!y||y<0||y>N)&&(y=N);let D="";for(let Q=g;Q<y;++Q)D+=le[v[Q]];return D}function bt(v,g,y){const N=v.slice(g,y);let D="";for(let Q=0;Q<N.length-1;Q+=2)D+=String.fromCharCode(N[Q]+N[Q+1]*256);return D}l.prototype.slice=function(g,y){const N=this.length;g=~~g,y=y===void 0?N:~~y,g<0?(g+=N,g<0&&(g=0)):g>N&&(g=N),y<0?(y+=N,y<0&&(y=0)):y>N&&(y=N),y<g&&(y=g);const D=this.subarray(g,y);return Object.setPrototypeOf(D,l.prototype),D};function ot(v,g,y){if(v%1!==0||v<0)throw new RangeError("offset is not uint");if(v+g>y)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let D=this[g],Q=1,rt=0;for(;++rt<y&&(Q*=256);)D+=this[g+rt]*Q;return D},l.prototype.readUintBE=l.prototype.readUIntBE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let D=this[g+--y],Q=1;for(;y>0&&(Q*=256);)D+=this[g+--y]*Q;return D},l.prototype.readUint8=l.prototype.readUInt8=function(g,y){return g=g>>>0,y||ot(g,1,this.length),this[g]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(g,y){return g=g>>>0,y||ot(g,2,this.length),this[g]|this[g+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(g,y){return g=g>>>0,y||ot(g,2,this.length),this[g]<<8|this[g+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},l.prototype.readBigUInt64LE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const D=y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,Q=this[++g]+this[++g]*2**8+this[++g]*2**16+N*2**24;return BigInt(D)+(BigInt(Q)<<BigInt(32))}),l.prototype.readBigUInt64BE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const D=y*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],Q=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+N;return(BigInt(D)<<BigInt(32))+BigInt(Q)}),l.prototype.readIntLE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let D=this[g],Q=1,rt=0;for(;++rt<y&&(Q*=256);)D+=this[g+rt]*Q;return Q*=128,D>=Q&&(D-=Math.pow(2,8*y)),D},l.prototype.readIntBE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let D=y,Q=1,rt=this[g+--D];for(;D>0&&(Q*=256);)rt+=this[g+--D]*Q;return Q*=128,rt>=Q&&(rt-=Math.pow(2,8*y)),rt},l.prototype.readInt8=function(g,y){return g=g>>>0,y||ot(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},l.prototype.readInt16LE=function(g,y){g=g>>>0,y||ot(g,2,this.length);const N=this[g]|this[g+1]<<8;return N&32768?N|4294901760:N},l.prototype.readInt16BE=function(g,y){g=g>>>0,y||ot(g,2,this.length);const N=this[g+1]|this[g]<<8;return N&32768?N|4294901760:N},l.prototype.readInt32LE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},l.prototype.readInt32BE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},l.prototype.readBigInt64LE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const D=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(N<<24);return(BigInt(D)<<BigInt(32))+BigInt(y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),l.prototype.readBigInt64BE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const D=(y<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(D)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+N)}),l.prototype.readFloatLE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),n.read(this,g,!0,23,4)},l.prototype.readFloatBE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),n.read(this,g,!1,23,4)},l.prototype.readDoubleLE=function(g,y){return g=g>>>0,y||ot(g,8,this.length),n.read(this,g,!0,52,8)},l.prototype.readDoubleBE=function(g,y){return g=g>>>0,y||ot(g,8,this.length),n.read(this,g,!1,52,8)};function ct(v,g,y,N,D,Q){if(!l.isBuffer(v))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>D||g<Q)throw new RangeError('"value" argument is out of bounds');if(y+N>v.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(g,y,N,D){if(g=+g,y=y>>>0,N=N>>>0,!D){const Ft=Math.pow(2,8*N)-1;ct(this,g,y,N,Ft,0)}let Q=1,rt=0;for(this[y]=g&255;++rt<N&&(Q*=256);)this[y+rt]=g/Q&255;return y+N},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(g,y,N,D){if(g=+g,y=y>>>0,N=N>>>0,!D){const Ft=Math.pow(2,8*N)-1;ct(this,g,y,N,Ft,0)}let Q=N-1,rt=1;for(this[y+Q]=g&255;--Q>=0&&(rt*=256);)this[y+Q]=g/rt&255;return y+N},l.prototype.writeUint8=l.prototype.writeUInt8=function(g,y,N){return g=+g,y=y>>>0,N||ct(this,g,y,1,255,0),this[y]=g&255,y+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(g,y,N){return g=+g,y=y>>>0,N||ct(this,g,y,2,65535,0),this[y]=g&255,this[y+1]=g>>>8,y+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(g,y,N){return g=+g,y=y>>>0,N||ct(this,g,y,2,65535,0),this[y]=g>>>8,this[y+1]=g&255,y+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(g,y,N){return g=+g,y=y>>>0,N||ct(this,g,y,4,4294967295,0),this[y+3]=g>>>24,this[y+2]=g>>>16,this[y+1]=g>>>8,this[y]=g&255,y+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(g,y,N){return g=+g,y=y>>>0,N||ct(this,g,y,4,4294967295,0),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4};function Lt(v,g,y,N,D){st(g,N,D,v,y,7);let Q=Number(g&BigInt(4294967295));v[y++]=Q,Q=Q>>8,v[y++]=Q,Q=Q>>8,v[y++]=Q,Q=Q>>8,v[y++]=Q;let rt=Number(g>>BigInt(32)&BigInt(4294967295));return v[y++]=rt,rt=rt>>8,v[y++]=rt,rt=rt>>8,v[y++]=rt,rt=rt>>8,v[y++]=rt,y}function te(v,g,y,N,D){st(g,N,D,v,y,7);let Q=Number(g&BigInt(4294967295));v[y+7]=Q,Q=Q>>8,v[y+6]=Q,Q=Q>>8,v[y+5]=Q,Q=Q>>8,v[y+4]=Q;let rt=Number(g>>BigInt(32)&BigInt(4294967295));return v[y+3]=rt,rt=rt>>8,v[y+2]=rt,rt=rt>>8,v[y+1]=rt,rt=rt>>8,v[y]=rt,y+8}l.prototype.writeBigUInt64LE=Ut(function(g,y=0){return Lt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Ut(function(g,y=0){return te(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(g,y,N,D){if(g=+g,y=y>>>0,!D){const Ee=Math.pow(2,8*N-1);ct(this,g,y,N,Ee-1,-Ee)}let Q=0,rt=1,Ft=0;for(this[y]=g&255;++Q<N&&(rt*=256);)g<0&&Ft===0&&this[y+Q-1]!==0&&(Ft=1),this[y+Q]=(g/rt>>0)-Ft&255;return y+N},l.prototype.writeIntBE=function(g,y,N,D){if(g=+g,y=y>>>0,!D){const Ee=Math.pow(2,8*N-1);ct(this,g,y,N,Ee-1,-Ee)}let Q=N-1,rt=1,Ft=0;for(this[y+Q]=g&255;--Q>=0&&(rt*=256);)g<0&&Ft===0&&this[y+Q+1]!==0&&(Ft=1),this[y+Q]=(g/rt>>0)-Ft&255;return y+N},l.prototype.writeInt8=function(g,y,N){return g=+g,y=y>>>0,N||ct(this,g,y,1,127,-128),g<0&&(g=255+g+1),this[y]=g&255,y+1},l.prototype.writeInt16LE=function(g,y,N){return g=+g,y=y>>>0,N||ct(this,g,y,2,32767,-32768),this[y]=g&255,this[y+1]=g>>>8,y+2},l.prototype.writeInt16BE=function(g,y,N){return g=+g,y=y>>>0,N||ct(this,g,y,2,32767,-32768),this[y]=g>>>8,this[y+1]=g&255,y+2},l.prototype.writeInt32LE=function(g,y,N){return g=+g,y=y>>>0,N||ct(this,g,y,4,2147483647,-2147483648),this[y]=g&255,this[y+1]=g>>>8,this[y+2]=g>>>16,this[y+3]=g>>>24,y+4},l.prototype.writeInt32BE=function(g,y,N){return g=+g,y=y>>>0,N||ct(this,g,y,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4},l.prototype.writeBigInt64LE=Ut(function(g,y=0){return Lt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Ut(function(g,y=0){return te(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function At(v,g,y,N,D,Q){if(y+N>v.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function xt(v,g,y,N,D){return g=+g,y=y>>>0,D||At(v,g,y,4),n.write(v,g,y,N,23,4),y+4}l.prototype.writeFloatLE=function(g,y,N){return xt(this,g,y,!0,N)},l.prototype.writeFloatBE=function(g,y,N){return xt(this,g,y,!1,N)};function $t(v,g,y,N,D){return g=+g,y=y>>>0,D||At(v,g,y,8),n.write(v,g,y,N,52,8),y+8}l.prototype.writeDoubleLE=function(g,y,N){return $t(this,g,y,!0,N)},l.prototype.writeDoubleBE=function(g,y,N){return $t(this,g,y,!1,N)},l.prototype.copy=function(g,y,N,D){if(!l.isBuffer(g))throw new TypeError("argument should be a Buffer");if(N||(N=0),!D&&D!==0&&(D=this.length),y>=g.length&&(y=g.length),y||(y=0),D>0&&D<N&&(D=N),D===N||g.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("Index out of range");if(D<0)throw new RangeError("sourceEnd out of bounds");D>this.length&&(D=this.length),g.length-y<D-N&&(D=g.length-y+N);const Q=D-N;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,N,D):s.prototype.set.call(g,this.subarray(N,D),y),Q},l.prototype.fill=function(g,y,N,D){if(typeof g=="string"){if(typeof y=="string"?(D=y,y=0,N=this.length):typeof N=="string"&&(D=N,N=this.length),D!==void 0&&typeof D!="string")throw new TypeError("encoding must be a string");if(typeof D=="string"&&!l.isEncoding(D))throw new TypeError("Unknown encoding: "+D);if(g.length===1){const rt=g.charCodeAt(0);(D==="utf8"&&rt<128||D==="latin1")&&(g=rt)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(y<0||this.length<y||this.length<N)throw new RangeError("Out of range index");if(N<=y)return this;y=y>>>0,N=N===void 0?this.length:N>>>0,g||(g=0);let Q;if(typeof g=="number")for(Q=y;Q<N;++Q)this[Q]=g;else{const rt=l.isBuffer(g)?g:l.from(g,D),Ft=rt.length;if(Ft===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(Q=0;Q<N-y;++Q)this[Q+y]=rt[Q%Ft]}return this};const Gt={};function be(v,g,y){Gt[v]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${v}]`,this.stack,delete this.name}get code(){return v}set code(D){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:D,writable:!0})}toString(){return`${this.name} [${v}]: ${this.message}`}}}be("ERR_BUFFER_OUT_OF_BOUNDS",function(v){return v?`${v} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),be("ERR_INVALID_ARG_TYPE",function(v,g){return`The "${v}" argument must be of type number. Received type ${typeof g}`},TypeError),be("ERR_OUT_OF_RANGE",function(v,g,y){let N=`The value of "${v}" is out of range.`,D=y;return Number.isInteger(y)&&Math.abs(y)>2**32?D=Oe(String(y)):typeof y=="bigint"&&(D=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&(D=Oe(D)),D+="n"),N+=` It must be ${g}. Received ${D}`,N},RangeError);function Oe(v){let g="",y=v.length;const N=v[0]==="-"?1:0;for(;y>=N+4;y-=3)g=`_${v.slice(y-3,y)}${g}`;return`${v.slice(0,y)}${g}`}function b(v,g,y){nt(g,"offset"),(v[g]===void 0||v[g+y]===void 0)&&F(g,v.length-(y+1))}function st(v,g,y,N,D,Q){if(v>y||v<g){const rt=typeof g=="bigint"?"n":"";let Ft;throw g===0||g===BigInt(0)?Ft=`>= 0${rt} and < 2${rt} ** ${(Q+1)*8}${rt}`:Ft=`>= -(2${rt} ** ${(Q+1)*8-1}${rt}) and < 2 ** ${(Q+1)*8-1}${rt}`,new Gt.ERR_OUT_OF_RANGE("value",Ft,v)}b(N,D,Q)}function nt(v,g){if(typeof v!="number")throw new Gt.ERR_INVALID_ARG_TYPE(g,"number",v)}function F(v,g,y){throw Math.floor(v)!==v?(nt(v,y),new Gt.ERR_OUT_OF_RANGE("offset","an integer",v)):g<0?new Gt.ERR_BUFFER_OUT_OF_BOUNDS:new Gt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,v)}const M=/[^+/0-9A-Za-z-_]/g;function Y(v){if(v=v.split("=")[0],v=v.trim().replace(M,""),v.length<2)return"";for(;v.length%4!==0;)v=v+"=";return v}function at(v,g){g=g||1/0;let y;const N=v.length;let D=null;const Q=[];for(let rt=0;rt<N;++rt){if(y=v.charCodeAt(rt),y>55295&&y<57344){if(!D){if(y>56319){(g-=3)>-1&&Q.push(239,191,189);continue}else if(rt+1===N){(g-=3)>-1&&Q.push(239,191,189);continue}D=y;continue}if(y<56320){(g-=3)>-1&&Q.push(239,191,189),D=y;continue}y=(D-55296<<10|y-56320)+65536}else D&&(g-=3)>-1&&Q.push(239,191,189);if(D=null,y<128){if((g-=1)<0)break;Q.push(y)}else if(y<2048){if((g-=2)<0)break;Q.push(y>>6|192,y&63|128)}else if(y<65536){if((g-=3)<0)break;Q.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((g-=4)<0)break;Q.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return Q}function ht(v){const g=[];for(let y=0;y<v.length;++y)g.push(v.charCodeAt(y)&255);return g}function J(v,g){let y,N,D;const Q=[];for(let rt=0;rt<v.length&&!((g-=2)<0);++rt)y=v.charCodeAt(rt),N=y>>8,D=y%256,Q.push(D),Q.push(N);return Q}function pt(v){return t.toByteArray(Y(v))}function _t(v,g,y,N){let D;for(D=0;D<N&&!(D+y>=g.length||D>=v.length);++D)g[D+y]=v[D];return D}function dt(v,g){return v instanceof g||v!=null&&v.constructor!=null&&v.constructor.name!=null&&v.constructor.name===g.name}function vt(v){return v!==v}const le=function(){const v="0123456789abcdef",g=new Array(256);for(let y=0;y<16;++y){const N=y*16;for(let D=0;D<16;++D)g[N+D]=v[y]+v[D]}return g}();function Ut(v){return typeof BigInt>"u"?Mn:v}function Mn(){throw new Error("BigInt not supported")}})(ep);const tn=ep.Buffer;function ww(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var rp={exports:{}},Ce=rp.exports={},Sr,Rr;function Eu(){throw new Error("setTimeout has not been defined")}function wu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Sr=setTimeout:Sr=Eu}catch{Sr=Eu}try{typeof clearTimeout=="function"?Rr=clearTimeout:Rr=wu}catch{Rr=wu}})();function ip(e){if(Sr===setTimeout)return setTimeout(e,0);if((Sr===Eu||!Sr)&&setTimeout)return Sr=setTimeout,setTimeout(e,0);try{return Sr(e,0)}catch{try{return Sr.call(null,e,0)}catch{return Sr.call(this,e,0)}}}function kw(e){if(Rr===clearTimeout)return clearTimeout(e);if((Rr===wu||!Rr)&&clearTimeout)return Rr=clearTimeout,clearTimeout(e);try{return Rr(e)}catch{try{return Rr.call(null,e)}catch{return Rr.call(this,e)}}}var ni=[],Ms=!1,Qi,za=-1;function xw(){!Ms||!Qi||(Ms=!1,Qi.length?ni=Qi.concat(ni):za=-1,ni.length&&sp())}function sp(){if(!Ms){var e=ip(xw);Ms=!0;for(var t=ni.length;t;){for(Qi=ni,ni=[];++za<t;)Qi&&Qi[za].run();za=-1,t=ni.length}Qi=null,Ms=!1,kw(e)}}Ce.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ni.push(new op(e,t)),ni.length===1&&!Ms&&ip(sp)};function op(e,t){this.fun=e,this.array=t}op.prototype.run=function(){this.fun.apply(null,this.array)},Ce.title="browser",Ce.browser=!0,Ce.env={},Ce.argv=[],Ce.version="",Ce.versions={};function ri(){}Ce.on=ri,Ce.addListener=ri,Ce.once=ri,Ce.off=ri,Ce.removeListener=ri,Ce.removeAllListeners=ri,Ce.emit=ri,Ce.prependListener=ri,Ce.prependOnceListener=ri,Ce.listeners=function(e){return[]},Ce.binding=function(e){throw new Error("process.binding is not supported")},Ce.cwd=function(){return"/"},Ce.chdir=function(e){throw new Error("process.chdir is not supported")},Ce.umask=function(){return 0};var Tw=rp.exports;const Ri=ww(Tw),ap=e=>e===void 0?null:e;class Aw{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let cp=new Aw,vw=!0;try{typeof localStorage<"u"&&localStorage&&(cp=localStorage,vw=!1)}catch{}const Sw=cp,Rw=Object.assign,Iw=Object.keys,Ow=(e,t)=>{for(const n in e)t(e[n],n)},lp=e=>Iw(e).length,Nw=e=>{for(const t in e)return!1;return!0},Cw=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Lw=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Mw=(e,t)=>e===t||lp(e)===lp(t)&&Cw(e,(n,r)=>(n!==void 0||Lw(t,r))&&t[r]===n),Uw=Object.freeze,up=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&up(e[t])}return Uw(e)},ku=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&ku(e,t,n+1)}},Fw=e=>e,Bw=(e,t)=>t.includes(e);var hp={};const Io=typeof Ri<"u"&&Ri.release&&/node|io\.js/.test(Ri.release.name)&&Object.prototype.toString.call(typeof Ri<"u"?Ri:0)==="[object process]";let Ir;const Pw=()=>{if(Ir===void 0)if(Io){Ir=lr();const e=Ri.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Ir.set(t,""),t=r):t!==null&&(Ir.set(t,r),t=null)}t!==null&&Ir.set(t,"")}else typeof location=="object"?(Ir=lr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Ir.set(`--${Md(t,"-")}`,n),Ir.set(`-${Md(t,"-")}`,n)}})):Ir=lr();return Ir},xu=e=>Pw().has(e),Wa=e=>ap(Io?hp[e.toUpperCase().replaceAll("-","_")]:Sw.getItem(e)),fp=e=>xu("--"+e)||Wa(e)!==null;fp("production");const Dw=Io&&Bw(hp.FORCE_COLOR,["true","1","2"])||!xu("--no-colors")&&!fp("no-color")&&(!Io||Ri.stdout.isTTY)&&(!Io||xu("--color")||Wa("COLORTERM")!==null||(Wa("TERM")||"").includes("color")),$w=e=>new Uint8Array(e),jw=e=>{const t=$w(e.byteLength);return t.set(e),t};class zw{constructor(t,n){this.left=t,this.right=n}}const ii=(e,t)=>new zw(e,t);typeof DOMParser<"u"&&new DOMParser;const Ww=e=>aw(e,(t,n)=>`${n}:${t};`).join(""),si=Symbol,dp=si(),pp=si(),Kw=si(),Gw=si(),Hw=si(),mp=si(),Yw=si(),Tu=si(),Vw=si(),Xw=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},qw={[dp]:ii("font-weight","bold"),[pp]:ii("font-weight","normal"),[Kw]:ii("color","blue"),[Hw]:ii("color","green"),[Gw]:ii("color","grey"),[mp]:ii("color","red"),[Yw]:ii("color","purple"),[Tu]:ii("color","orange"),[Vw]:ii("color","black")},gp=Dw?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=lr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=qw[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=Ww(r);s>0||u.length>0?(t.push("%c"+a),n.push(u)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:Xw,Jw=(...e)=>{console.log(...gp(e)),yp.forEach(t=>t.print(e))},Zw=(...e)=>{console.warn(...gp(e)),e.unshift(Tu),yp.forEach(t=>t.print(e))},yp=Ss(),_p=e=>({[Symbol.iterator](){return this},next:e}),Qw=(e,t)=>_p(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Au=(e,t)=>_p(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class vu{constructor(t,n){this.clock=t,this.len=n}}class Oo{constructor(){this.clients=new Map}}const bp=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Bp(e,s,a.clock,a.len,n)}}),tk=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=xi((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},Ep=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&tk(n,t.clock)!==null},Su=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=Ji(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},ek=e=>{const t=new Oo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)TE(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Su(t),t},Ka=(e,t,n,r)=>{Si(e.clients,t,()=>[]).push(new vu(n,r))},nk=()=>new Oo,rk=e=>{const t=nk();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let u=n[s+1];s+1<n.length&&u.deleted;u=n[++s+1])c+=u.length;i.push(new vu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Us=(e,t)=>{Bt(e.restEncoder,t.clients.size),Ti(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),Bt(e.restEncoder,n);const i=r.length;Bt(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Ru=e=>{const t=new Oo,n=Pt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Pt(e.restDecoder),s=Pt(e.restDecoder);if(s>0){const o=Si(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new vu(e.readDsClock(),e.readDsLen()))}}return t},wp=(e,t,n)=>{const r=new Oo,i=Pt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Pt(e.restDecoder),a=Pt(e.restDecoder),c=n.clients.get(o)||[],u=Je(n,o);for(let l=0;l<a;l++){const h=e.readDsClock(),f=h+e.readDsLen();if(h<u){u<f&&Ka(r,o,u,f-u);let d=Or(c,h),p=c[d];for(!p.deleted&&p.id.clock<h&&(c.splice(d+1,0,sc(t,p,h-p.id.clock)),d++);d<c.length&&(p=c[d++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(d,0,sc(t,p,f-p.id.clock)),p.delete(t))}else Ka(r,o,h,f-h)}}if(r.clients.size>0){const s=new ts;return Bt(s.restEncoder,0),Us(s,r),s.toUint8Array()}return null},kp=Qd;class Fs extends lw{constructor({guid:t=fw(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=kp(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Mp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=tp(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>tp(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&ue(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ti(this.subdocs).map(t=>t.guid))}transact(t,n=null){return ue(this,t,n)}get(t,n=en){const r=Si(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==en&&i!==n)if(i===en){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,$s)}getText(t=""){return this.get(t,oi)}getMap(t=""){return this.get(t,js)}getXmlElement(t=""){return this.get(t,Ws)}getXmlFragment(t=""){return this.get(t,es)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Ti(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Fs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,ue(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class xp{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Pt(this.restDecoder)}readDsLen(){return Pt(this.restDecoder)}}class Tp extends xp{readLeftID(){return Xt(Pt(this.restDecoder),Pt(this.restDecoder))}readRightID(){return Xt(Pt(this.restDecoder),Pt(this.restDecoder))}readClient(){return Pt(this.restDecoder)}readInfo(){return Is(this.restDecoder)}readString(){return Os(this.restDecoder)}readParentInfo(){return Pt(this.restDecoder)===1}readTypeRef(){return Pt(this.restDecoder)}readLen(){return Pt(this.restDecoder)}readAny(){return So(this.restDecoder)}readBuf(){return jw(dn(this.restDecoder))}readJSON(){return JSON.parse(Os(this.restDecoder))}readKey(){return Os(this.restDecoder)}}class ik{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Pt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Pt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Bs extends ik{constructor(t){super(t),this.keys=[],Pt(t),this.keyClockDecoder=new hu(dn(t)),this.clientDecoder=new Ba(dn(t)),this.leftClockDecoder=new hu(dn(t)),this.rightClockDecoder=new hu(dn(t)),this.infoDecoder=new jd(dn(t),Is),this.stringDecoder=new GE(dn(t)),this.parentInfoDecoder=new jd(dn(t),Is),this.typeRefDecoder=new Ba(dn(t)),this.lenDecoder=new Ba(dn(t))}readLeftID(){return new Ps(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ps(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return So(this.restDecoder)}readBuf(){return dn(this.restDecoder)}readJSON(){return So(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Ap{constructor(){this.restEncoder=vi()}toUint8Array(){return cr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){Bt(this.restEncoder,t)}writeDsLen(t){Bt(this.restEncoder,t)}}class No extends Ap{writeLeftID(t){Bt(this.restEncoder,t.client),Bt(this.restEncoder,t.clock)}writeRightID(t){Bt(this.restEncoder,t.client),Bt(this.restEncoder,t.clock)}writeClient(t){Bt(this.restEncoder,t)}writeInfo(t){iu(this.restEncoder,t)}writeString(t){Rs(this.restEncoder,t)}writeParentInfo(t){Bt(this.restEncoder,t?1:0)}writeTypeRef(t){Bt(this.restEncoder,t)}writeLen(t){Bt(this.restEncoder,t)}writeAny(t){vo(this.restEncoder,t)}writeBuf(t){sn(this.restEncoder,t)}writeJSON(t){Rs(this.restEncoder,JSON.stringify(t))}writeKey(t){Rs(this.restEncoder,t)}}class vp{constructor(){this.restEncoder=vi(),this.dsCurrVal=0}toUint8Array(){return cr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,Bt(this.restEncoder,n)}writeDsLen(t){t===0&&Ar(),Bt(this.restEncoder,t-1),this.dsCurrVal+=t}}class ts extends vp{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new cu,this.clientEncoder=new Ua,this.leftClockEncoder=new cu,this.rightClockEncoder=new cu,this.infoEncoder=new Fd(iu),this.stringEncoder=new jE,this.parentInfoEncoder=new Fd(iu),this.typeRefEncoder=new Ua,this.lenEncoder=new Ua}toUint8Array(){const t=vi();return Bt(t,0),sn(t,this.keyClockEncoder.toUint8Array()),sn(t,this.clientEncoder.toUint8Array()),sn(t,this.leftClockEncoder.toUint8Array()),sn(t,this.rightClockEncoder.toUint8Array()),sn(t,cr(this.infoEncoder)),sn(t,this.stringEncoder.toUint8Array()),sn(t,cr(this.parentInfoEncoder)),sn(t,this.typeRefEncoder.toUint8Array()),sn(t,this.lenEncoder.toUint8Array()),Ma(t,cr(this.restEncoder)),cr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){vo(this.restEncoder,t)}writeBuf(t){sn(this.restEncoder,t)}writeJSON(t){vo(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const sk=(e,t,n,r)=>{r=Ji(r,t[0].id.clock);const i=Or(t,r);Bt(e.restEncoder,t.length-i),e.writeClient(n),Bt(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},Iu=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{Je(t,s)>i&&r.set(s,i)}),Ha(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Bt(e.restEncoder,r.size),Ti(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{sk(e,t.clients.get(i),i,s)})},ok=(e,t)=>{const n=lr(),r=Pt(e.restDecoder);for(let i=0;i<r;i++){const s=Pt(e.restDecoder),o=new Array(s),a=e.readClient();let c=Pt(e.restDecoder);n.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=e.readInfo();switch(Ca&l){case 0:{const h=e.readLen();o[u]=new Yn(Xt(a,c),h),c+=h;break}case 10:{const h=Pt(e.restDecoder);o[u]=new Vn(Xt(a,c),h),c+=h;break}default:{const h=(l&(ei|Fn))===0,f=new ze(Xt(a,c),null,(l&Fn)===Fn?e.readLeftID():null,null,(l&ei)===ei?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(l&ko)===ko?e.readString():null,c0(e,l));o[u]=f,c+=f.length}}}}return n},ak=(e,t,n)=>{const r=[];let i=Ti(n.keys()).sort((d,p)=>d-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let d=n.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=n.get(i[i.length-1]);else return null;return d};let o=s();if(o===null)return null;const a=new Mp,c=new Map,u=(d,p)=>{const m=c.get(d);(m==null||m>p)&&c.set(d,p)};let l=o.refs[o.i++];const h=new Map,f=()=>{for(const d of r){const p=d.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[d]),i=i.filter(w=>w!==p)}r.length=0};for(;;){if(l.constructor!==Vn){const p=Si(h,l.id.client,()=>Je(t,l.id.client))-l.id.clock;if(p<0)r.push(l),u(l.id.client,l.id.clock-1),f();else{const m=l.getMissing(e,t);if(m!==null){r.push(l);const w=n.get(m)||{refs:[],i:0};if(w.refs.length===w.i)u(m,Je(t,m)),f();else{l=w.refs[w.i++];continue}}else(p===0||p<l.length)&&(l.integrate(e,p),h.set(l.id.client,l.id.clock+l.length))}}if(r.length>0)l=r.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const d=new ts;return Iu(d,a,new Map),Bt(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},ck=(e,t)=>Iu(e,t.doc.store,t.beforeState),lk=(e,t,n,r=new Bs(e))=>ue(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=ok(r,o),u=ak(i,a,c),l=a.pendingStructs;if(l){for(const[f,d]of l.missing)if(d<Je(a,f)){s=!0;break}if(u){for(const[f,d]of u.missing){const p=l.missing.get(f);(p==null||p>d)&&l.missing.set(f,d)}l.update=Va([l.update,u.update])}}else a.pendingStructs=u;const h=wp(r,i,a);if(a.pendingDs){const f=new Bs(Zi(a.pendingDs));Pt(f.restDecoder);const d=wp(f,i,a);h&&d?a.pendingDs=Va([h,d]):a.pendingDs=h||d}else a.pendingDs=h;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,Sp(i.doc,f)}},n,!1),Sp=(e,t,n,r=Bs)=>{const i=Zi(t);lk(i,e,n,new r(i))},uk=(e,t,n)=>Sp(e,t,n,Tp),hk=(e,t,n=new Map)=>{Iu(e,t.store,n),Us(e,rk(t.store))},fk=(e,t=new Uint8Array([0]),n=new ts)=>{const r=Rp(t);hk(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Sk(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===No)return Ak(i.map((s,o)=>o===0?s:Ik(s)));if(n.constructor===ts)return Va(i)}return i[0]},dk=(e,t)=>fk(e,t,new No),pk=e=>{const t=new Map,n=Pt(e.restDecoder);for(let r=0;r<n;r++){const i=Pt(e.restDecoder),s=Pt(e.restDecoder);t.set(i,s)}return t},Rp=e=>pk(new xp(Zi(e))),Ip=(e,t)=>(Bt(e.restEncoder,t.size),Ti(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{Bt(e.restEncoder,n),Bt(e.restEncoder,r)}),e),mk=(e,t)=>Ip(e,Ha(t.store)),gk=(e,t=new vp)=>(e instanceof Map?Ip(t,e):mk(t,e),t.toUint8Array()),yk=e=>gk(e,new Ap);class _k{constructor(){this.l=[]}}const Op=()=>new _k,Np=(e,t)=>e.l.push(t),Cp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Lp=(e,t,n)=>ku(e.l,[t,n]);class Ps{constructor(t,n){this.client=t,this.clock=n}}const Ga=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Xt=(e,t)=>new Ps(e,t),bk=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Ar()},Ds=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Ep(t.ds,e.id),Ou=(e,t)=>{const n=Si(e.meta,Ou,Ss),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<Je(r,s)&&Ii(e,Xt(s,i))}),bp(e,t.ds,i=>{}),n.add(t))};class Mp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ha=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},Je=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Up=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Ar()}n.push(t)},Or=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=xi(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=xi((n+r)/2)}throw Ar()},Nu=(e,t)=>{const n=e.clients.get(t.client);return n[Or(n,t.clock)]},Cu=(e,t,n)=>{const r=Or(t,n),i=t[r];return i.id.clock<n&&i instanceof ze?(t.splice(r+1,0,sc(e,i,n-i.id.clock)),r+1):r},Ii=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Cu(e,n,t.clock)]},Fp=(e,t,n)=>{const r=t.clients.get(n.client),i=Or(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Yn&&r.splice(i+1,0,sc(e,s,n.clock-s.id.clock+1)),s},Ek=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Or(r,t.id.clock)]=n},Bp=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Cu(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Cu(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class wk{constructor(t,n,r){this.doc=t,this.deleteSet=new Oo,this.beforeState=Ha(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Pp=(e,t)=>t.deleteSet.clients.size===0&&!cw(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Su(t.deleteSet),ck(e,t),Us(e,t.deleteSet),!0),Dp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Si(e.changed,t,Ss).add(n)},Ya=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},kk=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=Or(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof ze&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},xk=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Nd(i.length-1,1+Or(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+Ya(i,c)}})},$p=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Su(s),n.afterState=Ha(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),Lp(u._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),ku(a,[]),n._needFormattingCleanup&&Wk(n)}finally{r.gc&&kk(s,i,r.gcFilter),xk(s,i),n.afterState.forEach((l,h)=>{const f=n.beforeState.get(h)||0;if(f!==l){const d=i.clients.get(h),p=Ji(Or(d,f),1);for(let m=d.length-1;m>=p;)m-=1+Ya(d,m)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:f}=o[l].id,d=i.clients.get(h),p=Or(d,f);p+1<d.length&&Ya(d,p+1)>1||p>0&&Ya(d,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Jw(Tu,dp,"[yjs] ",pp,mp,"Changed the client-id because another client seems to be using it."),r.clientID=kp()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const l=new No;Pp(l,n)&&r.emit("update",[l.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const l=new ts;Pp(l,n)&&r.emit("updateV2",[l.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=n;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=r.clientID,l.collectionid==null&&(l.collectionid=r.collectionid),r.subdocs.add(l)}),u.forEach(l=>r.subdocs.delete(l)),r.emit("subdocs",[{loaded:c,added:a,removed:u},r,n]),u.forEach(l=>l.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):$p(e,t+1)}}},ue=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new wk(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&$p(i,0)}}return o};function*Tk(e){const t=Pt(e.restDecoder);for(let n=0;n<t;n++){const r=Pt(e.restDecoder),i=e.readClient();let s=Pt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Pt(e.restDecoder);yield new Vn(Xt(i,s),c),s+=c}else if(Ca&a){const c=(a&(ei|Fn))===0,u=new ze(Xt(i,s),null,(a&Fn)===Fn?e.readLeftID():null,null,(a&ei)===ei?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&ko)===ko?e.readString():null,c0(e,a));yield u,s+=u.length}else{const c=e.readLen();yield new Yn(Xt(i,s),c),s+=c}}}}class Lu{constructor(t,n){this.gen=Tk(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Vn);return this.curr}}class Mu{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Ak=e=>Va(e,Tp,No),vk=(e,t)=>{if(e.constructor===Yn){const{client:n,clock:r}=e.id;return new Yn(Xt(n,r+t),e.length-t)}else if(e.constructor===Vn){const{client:n,clock:r}=e.id;return new Vn(Xt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new ze(Xt(r,i+t),null,Xt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Va=(e,t=Bs,n=ts)=>{if(e.length===1)return e[0];const r=e.map(l=>new t(Zi(l)));let i=r.map(l=>new Lu(l,!0)),s=null;const o=new n,a=new Mu(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){const p=f.curr.id.clock-d.curr.id.clock;return p===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===Vn?1:-1:p}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let f=l.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=l.next(),d=!0;if(f===null||f.id.client!==h||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Oi(a,s.struct,s.offset),s={struct:f,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===Vn)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{Oi(a,s.struct,s.offset);const p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Vn(Xt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===Vn?s.struct.length-=p:f=vk(f,p)),s.struct.mergeWith(f)||(Oi(a,s.struct,s.offset),s={struct:f,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let f=l.curr;f!==null&&f.id.client===h&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==Vn;f=l.next())Oi(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(Oi(a,s.struct,s.offset),s=null),Uu(a);const c=r.map(l=>Ru(l)),u=ek(c);return Us(o,u),o.toUint8Array()},Sk=(e,t,n=Bs,r=ts)=>{const i=Rp(t),s=new r,o=new Mu(s),a=new n(Zi(e)),c=new Lu(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,f=i.get(h)||0;if(c.curr.constructor===Vn){c.next();continue}if(l.id.clock+l.length>f)for(Oi(o,l,Ji(f-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Oi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=f;)c.next()}Uu(o);const u=Ru(a);return Us(s,u),s.toUint8Array()},jp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:cr(e.encoder.restEncoder)}),e.encoder.restEncoder=vi(),e.written=0)},Oi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&jp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),Bt(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Uu=e=>{jp(e);const t=e.encoder.restEncoder;Bt(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];Bt(t,r.written),Ma(t,r.restEncoder)}},Rk=(e,t,n,r)=>{const i=new n(Zi(e)),s=new Lu(i,!1),o=new r,a=new Mu(o);for(let u=s.curr;u!==null;u=s.next())Oi(a,t(u),0);Uu(a);const c=Ru(i);return Us(o,c),o.toUint8Array()},Ik=e=>Rk(e,Fw,Bs,No),zp="You must not compute changes after the event-handler fired.";class Xa{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Ok(this.currentTarget,this.target))}deletes(t){return Ep(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ai(zp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=ru(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=ru(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=ru(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ai(zp);const n=this.target,r=Ss(),i=Ss(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const Ok=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},on=()=>{Zw("Invalid access: Add Yjs type to a document before reading data.")},Wp=80;let Fu=0;class Nk{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Fu++}}const Ck=e=>{e.timestamp=Fu++},Kp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Fu++},Lk=(e,t,n)=>{if(e.length>=Wp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Kp(r,t,n),r}else{const r=new Nk(t,n);return e.push(r),r}},qa=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>La(t-s.index)<La(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Ck(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&La(n.index-i)<r.parent.length/Wp?(Kp(n,r,i),n):Lk(e._searchMarker,r,i)},Co=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=Ji(t,i.index+n))}},Ja=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Si(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Lp(r._eH,n,t)};class en{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Op(),this._dEH=Op(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Tr()}clone(){throw Tr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Np(this._eH,t)}observeDeep(t){Np(this._dEH,t)}unobserve(t){Cp(this._eH,t)}unobserveDeep(t){Cp(this._dEH,t)}toJSON(){}}const Gp=(e,t,n)=>{e.doc??on(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},Hp=e=>{e.doc??on();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Lo=(e,t)=>{let n=0,r=e._start;for(e.doc??on();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},Yp=(e,t)=>{const n=[];return Lo(e,(r,i)=>{n.push(t(r,i,e))}),n},Mk=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Vp=(e,t)=>{e.doc??on();const n=qa(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Za=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let u=[];const l=()=>{u.length>0&&(i=new ze(Xt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new rs(u)),i.integrate(e,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new ze(Xt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Mo(new Uint8Array(h))),i.integrate(e,0);break;case Fs:i=new ze(Xt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Fo(h)),i.integrate(e,0);break;default:if(h instanceof en)i=new ze(Xt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ai(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},Xp=()=>Ai("Length exceeded!"),qp=(e,t,n,r)=>{if(n>t._length)throw Xp();if(n===0)return t._searchMarker&&Co(t._searchMarker,n,r.length),Za(e,t,null,r);const i=n,s=qa(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ii(e,Xt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Co(t._searchMarker,i,r.length),Za(e,t,o,r)},Uk=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Za(e,t,i,n)},Jp=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=qa(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ii(e,Xt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ii(e,Xt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Xp();t._searchMarker&&Co(t._searchMarker,i,-s+r)},Qa=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Bu=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new rs([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new rs([r]);break;case Uint8Array:a=new Mo(r);break;case Fs:a=new Fo(r);break;default:if(r instanceof en)a=new ai(r);else throw new Error("Unexpected content type")}new ze(Xt(o,Je(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},Pu=(e,t)=>{e.doc??on();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Zp=e=>{const t={};return e.doc??on(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Qp=(e,t)=>{e.doc??on();const n=e._map.get(t);return n!==void 0&&!n.deleted},Fk=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Ds(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},tc=e=>(e.doc??on(),Qw(e._map.entries(),t=>!t[1].deleted));class Bk extends Xa{}class $s extends en{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new $s;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $s}clone(){const t=new $s;return t.insert(0,this.toArray().map(n=>n instanceof en?n.clone():n)),t}get length(){return this.doc??on(),this._length}_callObserver(t,n){super._callObserver(t,n),Ja(this,t,new Bk(this,t))}insert(t,n){this.doc!==null?ue(this.doc,r=>{qp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?ue(this.doc,n=>{Uk(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?ue(this.doc,r=>{Jp(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Vp(this,t)}toArray(){return Hp(this)}slice(t=0,n=this.length){return Gp(this,t,n)}toJSON(){return this.map(t=>t instanceof en?t.toJSON():t)}map(t){return Yp(this,t)}forEach(t){Lo(this,t)}[Symbol.iterator](){return Mk(this)}_write(t){t.writeTypeRef(cx)}}const Pk=e=>new $s;class Dk extends Xa{constructor(t,n,r){super(t,n),this.keysChanged=r}}class js extends en{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new js}clone(){const t=new js;return this.forEach((n,r)=>{t.set(r,n instanceof en?n.clone():n)}),t}_callObserver(t,n){Ja(this,t,new Dk(this,t,n))}toJSON(){this.doc??on();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof en?i.toJSON():i}}),t}get size(){return[...tc(this)].length}keys(){return Au(tc(this),t=>t[0])}values(){return Au(tc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Au(tc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??on(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?ue(this.doc,n=>{Qa(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?ue(this.doc,r=>{Bu(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Pu(this,t)}has(t){return Qp(this,t)}clear(){this.doc!==null?ue(this.doc,t=>{this.forEach(function(n,r,i){Qa(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(lx)}}const $k=e=>new js,Ni=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Mw(e,t);class Du{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Ar(),this.right.content.constructor){case je:this.right.deleted||zs(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const t0=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case je:t.right.deleted||zs(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Ii(e,Xt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},ec=(e,t,n,r)=>{const i=new Map,s=r?qa(t,n):null;if(s){const o=new Du(s.p.left,s.p,s.index,i);return t0(e,o,n-s.index)}else{const o=new Du(null,t._start,0,i);return t0(e,o,n)}},e0=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===je&&Ni(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,u=n.right,l=new ze(Xt(s,Je(i.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,new je(a,o));l.integrate(e,0),n.right=l,n.forward()})},zs=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},n0=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===je&&Ni(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},r0=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],u=n.currentAttributes.get(a)??null;if(!Ni(u,c)){o.set(a,u);const{left:l,right:h}=n;n.right=new ze(Xt(s,Je(i.store,s)),l,l&&l.lastId,h,h&&h.id,t,null,new je(a,c)),n.right.integrate(e,0),n.forward()}}return o},$u=(e,t,n,r,i)=>{n.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});const s=e.doc,o=s.clientID;n0(n,i);const a=r0(e,t,n,i),c=r.constructor===String?new Nr(r):r instanceof en?new ai(r):new ns(r);let{left:u,right:l,index:h}=n;t._searchMarker&&Co(t._searchMarker,n.index,c.getLength()),l=new ze(Xt(o,Je(s.store,o)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),n.right=l,n.index=h,n.forward(),e0(e,t,n,a)},i0=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;n0(n,i);const a=r0(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===je));){if(!n.right.deleted)switch(n.right.content.constructor){case je:{const{key:c,value:u}=n.right.content,l=i[c];if(l!==void 0){if(Ni(l,u))a.delete(c);else{if(r===0)break t;a.set(c,u)}n.right.delete(e)}else n.currentAttributes.set(c,u);break}default:r<n.right.length&&Ii(e,Xt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new ze(Xt(o,Je(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Nr(c)),n.right.integrate(e,0),n.forward()}e0(e,t,n,a)},s0=(e,t,n,r,i)=>{let s=t;const o=lr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===je){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case je:{const{key:l,value:h}=u,f=r.get(l)??null;(o.get(l)!==u||f===h)&&(t.delete(e),a++,!c&&(i.get(l)??null)===h&&f!==h&&(f===null?i.delete(l):i.set(l,f))),!c&&!t.deleted&&zs(i,u);break}}}t=t.right}return a},jk=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===je){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},zk=e=>{let t=0;return ue(e.doc,n=>{let r=e._start,i=e._start,s=lr();const o=yu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case je:zs(o,i.content);break;default:t+=s0(n,r,i,s,o),s=yu(o),r=i;break}i=i.right}}),t},Wk=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Bp(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===je&&o.constructor!==Yn&&t.add(o.parent)})}ue(n,r=>{bp(e,e.deleteSet,i=>{if(i instanceof Yn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===je?t.add(s):jk(r,i)});for(const i of t)zk(i)})},o0=(e,t,n)=>{const r=n,i=yu(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case ai:case ns:case Nr:n<t.right.length&&Ii(e,Xt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&s0(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Co(o._searchMarker,t.index,-r+n),t};class Kk extends Xa{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];ue(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const f=()=>{if(a!==null){let d=null;switch(a){case"delete":h>0&&(d={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(d={insert:u},i.size>0&&(d.attributes={},i.forEach((p,m)=>{p!==null&&(d.attributes[m]=p)}))),u="";break;case"retain":l>0&&(d={retain:l},Nw(c)||(d.attributes=Rw({},c))),l=0;break}d&&n.push(d),a=null}};for(;o!==null;){switch(o.content.constructor){case ai:case ns:this.adds(o)?this.deletes(o)||(f(),a="insert",u=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=1);break;case Nr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=o.length);break;case je:{const{key:d,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(d)??null;Ni(m,p)?p!==null&&o.delete(r):(a==="retain"&&f(),Ni(p,s.get(d)??null)?delete c[d]:c[d]=p)}}else if(this.deletes(o)){s.set(d,p);const m=i.get(d)??null;Ni(m,p)||(a==="retain"&&f(),c[d]=m)}else if(!o.deleted){s.set(d,p);const m=c[d];m!==void 0&&(Ni(m,p)?m!==null&&o.delete(r):(a==="retain"&&f(),p===null?delete c[d]:c[d]=p))}o.deleted||(a==="insert"&&f(),zs(i,o.content));break}}o=o.right}for(f();n.length>0;){const d=n[n.length-1];if(d.retain!==void 0&&d.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class oi extends en{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??on(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new oi}clone(){const t=new oi;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new Kk(this,t,n);Ja(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??on();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Nr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?ue(this.doc,r=>{const i=new Du(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&$u(r,this,i,a,o.attributes||{})}else o.retain!==void 0?i0(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&o0(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??on();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let f=!1;s.forEach((p,m)=>{f=!0,h[m]=p});const d={insert:a};f&&(d.attributes=h),i.push(d),a=""}}const l=()=>{for(;c!==null;){if(Ds(c,t)||n!==void 0&&Ds(c,n))switch(c.content.constructor){case Nr:{const h=s.get("ychange");t!==void 0&&!Ds(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Ds(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case ai:case ns:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const f={};h.attributes=f,s.forEach((d,p)=>{f[p]=d})}i.push(h);break}case je:Ds(c,t)&&(u(),zs(s,c.content));break}c=c.right}u()};return t||n?ue(o,h=>{t&&Ou(h,t),n&&Ou(h,n),l()},"cleanup"):l(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?ue(i,s=>{const o=ec(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),$u(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?ue(i,s=>{const o=ec(s,this,t,!r);$u(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?ue(r,i=>{o0(i,ec(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?ue(i,s=>{const o=ec(s,this,t,!1);o.right!==null&&i0(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?ue(this.doc,n=>{Qa(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?ue(this.doc,r=>{Bu(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Pu(this,t)}getAttributes(){return Zp(this)}_write(t){t.writeTypeRef(ux)}}const Gk=e=>new oi;class ju{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??on()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Ws||n.constructor===es)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class es extends en{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new es}clone(){const t=new es;return t.insert(0,this.toArray().map(n=>n instanceof en?n.clone():n)),t}get length(){return this.doc??on(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new ju(this,t)}querySelector(t){t=t.toUpperCase();const r=new ju(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Ti(new ju(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Ja(this,t,new Vk(this,n,t))}toString(){return Yp(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Lo(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?ue(this.doc,r=>{qp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)ue(this.doc,r=>{const i=t&&t instanceof en?t._item:t;Za(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Ai("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?ue(this.doc,r=>{Jp(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Hp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Vp(this,t)}slice(t=0,n=this.length){return Gp(this,t,n)}forEach(t){Lo(this,t)}_write(t){t.writeTypeRef(fx)}}const Hk=e=>new es;class Ws extends es{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Ws(this.nodeName)}clone(){const t=new Ws(this.nodeName),n=this.getAttributes();return Ow(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof en?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?ue(this.doc,n=>{Qa(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?ue(this.doc,r=>{Bu(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Pu(this,t)}hasAttribute(t){return Qp(this,t)}getAttributes(t){return t?Fk(this,t):Zp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Lo(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(hx),t.writeKey(this.nodeName)}}const Yk=e=>new Ws(e.readKey());class Vk extends Xa{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class nc extends js{constructor(t){super(),this.hookName=t}_copy(){return new nc(this.hookName)}clone(){const t=new nc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(dx),t.writeKey(this.hookName)}}const Xk=e=>new nc(e.readKey());class rc extends oi{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new rc}clone(){const t=new rc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(px)}}const qk=e=>new rc;class zu{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Tr()}mergeWith(t){return!1}write(t,n,r){throw Tr()}integrate(t,n){throw Tr()}}const Jk=0;class Yn extends zu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Up(t.doc.store,this)}write(t,n){t.writeInfo(Jk),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Mo{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Mo(this.content)}splice(t){throw Tr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const Zk=e=>new Mo(e.readBuf());class Uo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Uo(this.len)}splice(t){const n=new Uo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Ka(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Qk=e=>new Uo(e.readLen()),a0=(e,t)=>new Fs({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Fo{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Fo(a0(this.doc.guid,this.opts))}splice(t){throw Tr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const tx=e=>new Fo(a0(e.readString(),e.readAny()));class ns{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ns(this.embed)}splice(t){throw Tr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const ex=e=>new ns(e.readJSON());class je{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new je(this.key,this.value)}splice(t){throw Tr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const nx=e=>new je(e.readKey(),e.readJSON());class ic{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ic(this.arr)}splice(t){const n=new ic(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const rx=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new ic(n)},ix=Wa("node_env")==="development";class rs{constructor(t){this.arr=t,ix&&up(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new rs(this.arr)}splice(t){const n=new rs(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const sx=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new rs(n)};class Nr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Nr(this.str)}splice(t){const n=new Nr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const ox=e=>new Nr(e.readString()),ax=[Pk,$k,Gk,Yk,Hk,Xk,qk],cx=0,lx=1,ux=2,hx=3,fx=4,dx=5,px=6;class ai{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ai(this.type._copy())}splice(t){throw Tr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const mx=e=>new ai(ax[e.readTypeRef()](e)),sc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new ze(Xt(r,i+n),t,Xt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=Xt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class ze extends zu{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Od:0}set marker(t){(this.info&eu)>0!==t&&(this.info^=eu)}get marker(){return(this.info&eu)>0}get keep(){return(this.info&Id)>0}set keep(t){this.keep!==t&&(this.info^=Id)}get countable(){return(this.info&Od)>0}get deleted(){return(this.info&tu)>0}set deleted(t){this.deleted!==t&&(this.info^=tu)}markDeleted(){this.info|=tu}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Je(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Je(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ps&&this.id.client!==this.parent.client&&this.parent.clock>=Je(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Fp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ii(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Yn||this.right&&this.right.constructor===Yn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ps){const r=Nu(n,this.parent);r.constructor===Yn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=Fp(t,t.doc.store,Xt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Ga(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Ga(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Nu(t.doc.store,i.origin)))s.has(Nu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Up(t.doc.store,this),this.content.integrate(t,this),Dp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Yn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Xt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ga(t.origin,this.lastId)&&this.right===t&&Ga(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Ka(t.deleteSet,this.id.client,this.id.clock,this.length),Dp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Ar();this.content.gc(t),n?Ek(t,this,new Yn(this.id,this.length)):this.content=new Uo(this.length)}write(t,n){const r=n>0?Xt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Ca|(r===null?0:Fn)|(i===null?0:ei)|(s===null?0:ko);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=bk(a);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Ps?(t.writeParentInfo(!1),t.writeLeftID(a)):Ar();s!==null&&t.writeString(s)}this.content.write(t,n)}}const c0=(e,t)=>gx[t&Ca](e),gx=[()=>{Ar()},Qk,rx,Zk,ox,ex,nx,mx,sx,tx,()=>{Ar()}],yx=10;class Vn extends zu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Ar()}write(t,n){t.writeInfo(yx),Bt(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const l0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Cs<"u"?Cs:{},u0="__ $YJS$ __";l0[u0]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),l0[u0]=!0;const Wu=0,h0=1,f0=2,_x=(e,t)=>{Bt(e,Wu);const n=yk(t);sn(e,n)},d0=(e,t,n)=>{Bt(e,h0),sn(e,dk(t,n))},bx=(e,t,n)=>d0(t,n,dn(e)),p0=(e,t,n)=>{try{uk(t,dn(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Ex=(e,t)=>{Bt(e,f0),sn(e,t)},wx=p0,kx=(e,t,n,r)=>{const i=Pt(e);switch(i){case Wu:bx(e,t,n);break;case h0:p0(e,n,r);break;case f0:wx(e,n,r);break;default:throw new Error("Unknown message type")}return i};let m0=!1;const Cr=new Fs;function g0(e,t,n){const r=Cr.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function xx(e,t){g0(e,0,t)}function Ku(e,t){const n=new oi(t);g0(e,1,n)}function Tx(e,t){Cr.getMap().set(e,t)}function Ax(e,t){const n=Cr.getMap(),r=new oi(t);n.set(e,r)}function y0(e,t){const n=Cr.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function vx(e,t){return y0(e,n=>{Ct(n)&&t(n)})}function _0(e,t){return y0(e,n=>{n instanceof oi&&t(n.toJSON())})}function oc(e){return cr(e)}const Xn=vs("modem",["second"],e=>{if(Xn.session(e))switch(e.target){case"second":!m0&&e.data%2===0&&Xn.emit("modem:join");break;case"join":if(e.sender!==Xn.id()){Xn.reply(e,"joinack");const t=vi();_x(t,Cr),Xn.reply(e,"sync",oc(t));const n=vi();d0(n,Cr),Xn.reply(e,"sync",oc(n))}break;case"joinack":e.sender!==Xn.id()&&(m0=!0);break;case"sync":{if(e.sender!==Xn.id()&&k(e.data))try{const t=Zi(e.data),n=vi();kx(t,n,Cr,Xn)===Wu&&Xn.emit("modem:sync",oc(n))}catch(t){ae(Xn,"sync",t.message)}break}}});function b0(e){const t=vi();Ex(t,e),Xn.emit("modem:sync",oc(t))}Cr.on("update",b0),Cr.on("destroy",()=>{Cr.off("update",b0)});function Sx(e,t){return e%t}function Rx(e,t){return Math.floor(e/t)}function E0(e,t){return{x:Sx(e,t),y:Rx(e,t)}}function ac(e,t){return e.x+e.y*t}function w0(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function k0(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let u=a;u<=c;++u)for(let l=s;l<=o;++l)i.push({x:l,y:u});return i}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const x0="170",Ix="",ur="srgb",T0="srgb-linear",A0="linear",Gu="srgb";function Ks(e,t,n){return Math.max(t,Math.min(n,e))}function Ox(e,t){return(e%t+t)%t}function Hu(e,t,n){return(1-n)*e+n*t}class Bo{constructor(t=0,n=0){Bo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Ks(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Po{constructor(t,n,r,i,s,o,a,c,u){Po.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,u)}set(t,n,r,i,s,o,a,c,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=n,l[4]=s,l[5]=c,l[6]=r,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],u=r[1],l=r[4],h=r[7],f=r[2],d=r[5],p=r[8],m=i[0],w=i[3],E=i[6],x=i[1],A=i[4],I=i[7],U=i[2],S=i[5],O=i[8];return s[0]=o*m+a*x+c*U,s[3]=o*w+a*A+c*S,s[6]=o*E+a*I+c*O,s[1]=u*m+l*x+h*U,s[4]=u*w+l*A+h*S,s[7]=u*E+l*I+h*O,s[2]=f*m+d*x+p*U,s[5]=f*w+d*A+p*S,s[8]=f*E+d*I+p*O,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8];return n*o*l-n*a*u-r*s*l+r*a*c+i*s*u-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,f=a*c-l*s,d=u*s-o*c,p=n*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(i*u-l*r)*m,t[2]=(a*r-i*o)*m,t[3]=f*m,t[4]=(l*n-i*c)*m,t[5]=(i*s-a*n)*m,t[6]=d*m,t[7]=(r*c-u*n)*m,t[8]=(o*n-r*s)*m,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(r*c,r*u,-r*(c*o+u*a)+o+t,-i*u,i*c,-i*(-u*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(Yu.makeScale(t,n)),this}rotate(t){return this.premultiply(Yu.makeRotation(-t)),this}translate(t,n){return this.premultiply(Yu.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Yu=new Po,qn={enabled:!0,workingColorSpace:T0,spaces:{},convert:function(e,t,n){return this.enabled===!1||t===n||!t||!n||(this.spaces[t].transfer===Gu&&(e.r=Gs(e.r),e.g=Gs(e.g),e.b=Gs(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Gu&&(e.r=Hs(e.r),e.g=Hs(e.g),e.b=Hs(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Ix?A0:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function Gs(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function Hs(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const v0=[.64,.33,.3,.6,.15,.06],S0=[.2126,.7152,.0722],R0=[.3127,.329],I0=new Po().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),O0=new Po().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);qn.define({[T0]:{primaries:v0,whitePoint:R0,transfer:A0,toXYZ:I0,fromXYZ:O0,luminanceCoefficients:S0,workingColorSpaceConfig:{unpackColorSpace:ur},outputColorSpaceConfig:{drawingBufferColorSpace:ur}},[ur]:{primaries:v0,whitePoint:R0,transfer:Gu,toXYZ:I0,fromXYZ:O0,luminanceCoefficients:S0,outputColorSpaceConfig:{drawingBufferColorSpace:ur}}});const N0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ci={h:0,s:0,l:0},cc={h:0,s:0,l:0};function Vu(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class Xu{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=ur){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,qn.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=qn.workingColorSpace){return this.r=t,this.g=n,this.b=r,qn.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=qn.workingColorSpace){if(t=Ox(t,1),n=Ks(n,0,1),r=Ks(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=Vu(o,s,t+1/3),this.g=Vu(o,s,t),this.b=Vu(o,s,t-1/3)}return qn.toWorkingColorSpace(this,i),this}setStyle(t,n=ur){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=ur){const r=N0[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Gs(t.r),this.g=Gs(t.g),this.b=Gs(t.b),this}copyLinearToSRGB(t){return this.r=Hs(t.r),this.g=Hs(t.g),this.b=Hs(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=ur){return qn.fromWorkingColorSpace(an.copy(this),t),Math.round(Ks(an.r*255,0,255))*65536+Math.round(Ks(an.g*255,0,255))*256+Math.round(Ks(an.b*255,0,255))}getHexString(t=ur){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=qn.workingColorSpace){qn.fromWorkingColorSpace(an.copy(this),n);const r=an.r,i=an.g,s=an.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,u;const l=(a+o)/2;if(a===o)c=0,u=0;else{const h=o-a;switch(u=l<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return t.h=c,t.s=u,t.l=l,t}getRGB(t,n=qn.workingColorSpace){return qn.fromWorkingColorSpace(an.copy(this),n),t.r=an.r,t.g=an.g,t.b=an.b,t}getStyle(t=ur){qn.fromWorkingColorSpace(an.copy(this),t);const n=an.r,r=an.g,i=an.b;return t!==ur?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Ci),this.setHSL(Ci.h+t,Ci.s+n,Ci.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Ci),t.getHSL(cc);const r=Hu(Ci.h,cc.h,n),i=Hu(Ci.s,cc.s,n),s=Hu(Ci.l,cc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const an=new Xu;Xu.NAMES=N0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:x0}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=x0),new Bo,new Bo;function Bn(e,t,n){return Math.max(t,Math.min(n,e))}function qu(e){return e*180/Math.PI}const Nx=ud("089fad0j9awfem09wavefc09uwaef");function Cx(){return Nx()}function Lx(e){return ud(e)()}function Li(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(Cx()*i)}function C0(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(Lx(e)*s)}function L0(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function Mx(e){return e[Li(0,e.length-1)]}function Ux(e,t){return t[C0(e,0,t.length-1)]}function cn(...e){return Mx(e.flat())}function M0(e,...t){return Ux(e,t.flat())}function Fx(e){return[...new Set(e)].filter(k)}var U0={exports:{}},Ju={exports:{}},F0;function Bx(){return F0||(F0=1,function(e,t){(function(n,r){e.exports=r()})(kn,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(m){if(m)for(var w=0;w<l.length;w++)m[l[w]]!==void 0&&this["set"+r(l[w])](m[l[w]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",w=this.getLineNumber()||"",E=this.getColumnNumber()||"",x=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+w+":"+E+")":"[eval]:"+w+":"+E:x?x+" ("+m+":"+w+":"+E+")":m+":"+w+":"+E}},h.fromString=function(w){var E=w.indexOf("("),x=w.lastIndexOf(")"),A=w.substring(0,E),I=w.substring(E+1,x).split(","),U=w.substring(x+1);if(U.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(U,""),O=S[1],B=S[2],C=S[3];return new h({functionName:A,args:I||void 0,fileName:O,lineNumber:B||void 0,columnNumber:C||void 0})};for(var f=0;f<s.length;f++)h.prototype["get"+r(s[f])]=i(s[f]),h.prototype["set"+r(s[f])]=function(m){return function(w){this[m]=!!w}}(s[f]);for(var d=0;d<o.length;d++)h.prototype["get"+r(o[d])]=i(o[d]),h.prototype["set"+r(o[d])]=function(m){return function(w){if(!n(w))throw new TypeError(m+" must be a Number");this[m]=Number(w)}}(o[d]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(w){this[m]=String(w)}}(a[p]);return h})}(Ju)),Ju.exports}(function(e,t){(function(n,r){e.exports=r(Bx())})(kn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=h.match(/ (\(.+\)$)/);h=f?h.replace(f[0],""):h;var d=this.extractLocation(f?f[1]:h),p=f&&h||void 0,m=["eval","<anonymous>"].indexOf(d[0])>-1?void 0:d[0];return new r({functionName:p,fileName:m,lineNumber:d[1],columnNumber:d[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new r({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=l.match(h),d=f&&f[1]?f[1]:void 0,p=this.extractLocation(l.replace(h,""));return new r({functionName:d,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],f=2,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],f=0,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),f=this.extractLocation(h.pop()),d=h.shift()||"",p=d.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;d.match(/\(([^)]*)\)/)&&(m=d.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var w=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:w,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:l})},this)}}})})(U0);var Px=U0.exports,Dx=xs(Px);const Zu=14,lc=3,uc=8,hc=14,fc=16,$x=16,jx=16;function dc(e,t){return new Array(e).fill(t)}function zx(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:dc(s,0),color:dc(s,0),bg:dc(s,i)}}function Wx(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:jt.ONCLEAR}}function Kx(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function Gx(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:dc(s,i)}}function Hx(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function Yx(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5}}function B0(e,t){return`${e}:${t}`}const Vx=1,Xx=16,qx=256;var mn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(mn||{});const Lr=!!JSON.parse("false"),Jx=!!JSON.parse("false");JSON.parse("false");const Zx=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const ci={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return uc*ci.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return hc*ci.DRAW_CHAR_SCALE}},z=vs("SOFTWARE");function li(e){const t={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},listcommands(){return Kn(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function ke(e){return`${e??""}`}function Do(e,t){const n=parseFloat(ke(e));return isNaN(n)?t:n}function P0(e,t){const[n]=it(e,0,[V.NAME]);aE(z,n,t)}function Jn(e,t,n){const[r,i]=it(n,0,[V.NUMBER_OR_STRING,V.MAYBE_NUMBER_OR_STRING]);kd(z,e,t,r,i)}const Qx=["echo","reverb","phaser","distortion","vibrato","fc"];function D0(e,t){const[n,r]=it(t,0,[V.NUMBER_OR_STRING]);if(Ct(n))Vl(z,e,"volume",n);else if(Qx.includes(Mt(n))){const[i,s]=it(t,r,[V.NUMBER_OR_STRING,V.MAYBE_NUMBER_OR_STRING]);kd(z,e,n,i,s)}else{const[i]=it(t,r,[V.MAYBE_NUMBER_OR_STRING]);if(Ct(i)){const s=t.length-r,o=new Array(s).fill(V.NUMBER),a=it(t,r,o).slice(0,s),c=a.length===1?a[0]:a;Vl(z,e,n,c)}else{const[s]=it(t,r,[V.MAYBE_NUMBER_OR_STRING]);Vl(z,e,n,s)}}}const Qu=li().command("tts",(e,t)=>{const[n,r]=it(t,0,[V.STRING]),i=t.slice(r).map(ke).join("");return sE(z,n,i),0}).command("tta",(e,t)=>{const n=t.map(ke).join("");return oE(z,n),0}).command("bpm",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return cE(z,n),0}).command("vol",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return lE(z,n),0}).command("bgvol",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return uE(z,n),0}).command("ttsvol",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return hE(z,n),0}).command("play",(e,t)=>(P0(t,!1),0)).command("bgplay",(e,t)=>(P0(t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)D0(n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)Jn(n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)Jn(n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)Jn(n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)Jn(n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)Jn(n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)Jn(n,"vibrato",t);return 0});for(let e=0;e<8;++e)Qu.command(`synth${e+1}`,(t,n)=>(D0(e,n),0));for(let e=0;e<3;++e){const t=e+1;Qu.command(`echo${t}`,(n,r)=>(Jn(e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(Jn(e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(Jn(e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(Jn(e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(Jn(e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(Jn(e,"vibrato",r),0))}function tT(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var eT=tT;const nT=eT,qt=function(){};qt.prototype.FMX=0,qt.prototype.FMY=0,qt.prototype.FMXxFMY=0,qt.prototype.T=0,qt.prototype.N=0,qt.prototype.initiliazedField=!1,qt.prototype.generationComplete=!1,qt.prototype.wave=null,qt.prototype.compatible=null,qt.prototype.weightLogWeights=null,qt.prototype.sumOfWeights=0,qt.prototype.sumOfWeightLogWeights=0,qt.prototype.startingEntropy=0,qt.prototype.sumsOfOnes=null,qt.prototype.sumsOfWeights=null,qt.prototype.sumsOfWeightLogWeights=null,qt.prototype.entropies=null,qt.prototype.propagator=null,qt.prototype.observed=null,qt.prototype.distribution=null,qt.prototype.stack=null,qt.prototype.stackSize=0,qt.prototype.DX=[-1,0,1,0],qt.prototype.DY=[0,1,0,-1],qt.prototype.opposite=[2,3,0,1],qt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},qt.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=nT(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},qt.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const u=a+c*this.FMX,l=this.propagator[i][e[1]],h=this.compatible[u];for(let f=0;f<l.length;f++){const d=l[f],p=h[d];p[i]--,p[i]==0&&this.ban(u,d)}}}},qt.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},qt.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},qt.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},qt.prototype.isGenerationComplete=function(){return this.generationComplete},qt.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},qt.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var $0=qt;const j0=$0,ui=function(t,n,r,i,s,o,a,c,u,l){l=l||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const h=n,f=new Array(h);for(let C=0;C<h;C++)f[C]=new Array(r);this.colors=[];const d={};for(let C=0;C<r;C++)for(let G=0;G<n;G++){const tt=(C*n+G)*4,L=[t[tt],t[tt+1],t[tt+2],t[tt+3]],R=L.join("-");d.hasOwnProperty(R)||(d[R]=this.colors.length,this.colors.push(L)),f[G][C]=d[R]}const p=this.colors.length,m=Math.pow(p,i*i),w=function(G){let tt=new Array(i*i);for(let L=0;L<i;L++)for(let R=0;R<i;R++)tt[R+L*i]=G(R,L);return tt},E=function(G,tt){return w(function(L,R){return f[(G+L)%n][(tt+R)%r]})},x=function(G){return w(function(tt,L){return G[i-1-L+tt*i]})},A=function(G){return w(function(tt,L){return G[i-1-tt+L*i]})},I=function(G){let tt=0,L=1;for(let R=0;R<G.length;R++)tt+=G[G.length-1-R]*L,L*=p;return tt},U=function(G){let tt=G,L=m;const R=new Array(i*i);for(let _=0;_<R.length;_++){L/=p;let P=0;for(;tt>=L;)tt-=L,P++;R[_]=P}return R},S={},O=[];for(let C=0;C<(a?r:r-i+1);C++)for(let G=0;G<(a?n:n-i+1);G++){const tt=new Array(8);tt[0]=E(G,C),tt[1]=A(tt[0]),tt[2]=x(tt[0]),tt[3]=A(tt[2]),tt[4]=x(tt[2]),tt[5]=A(tt[4]),tt[6]=x(tt[4]),tt[7]=A(tt[6]);for(let L=0;L<u;L++){const R=I(tt[L]);S[R]?S[R]++:(O.push(R),S[R]=1)}}this.T=O.length,this.ground=(l+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let C=0;C<this.T;C++){const G=parseInt(O[C],10);this.patterns[C]=U(G),this.weights[C]=S[G]}const B=function(G,tt,L,R){const _=L<0?0:L,P=L<0?L+i:i,Z=R<0?0:R,$=R<0?R+i:i;for(let lt=Z;lt<$;lt++)for(let et=_;et<P;et++)if(G[et+i*lt]!=tt[et-L+i*(lt-R)])return!1;return!0};this.propagator=new Array(4);for(let C=0;C<4;C++){this.propagator[C]=new Array(this.T);for(let G=0;G<this.T;G++){const tt=[];for(let L=0;L<this.T;L++)B(this.patterns[G],this.patterns[L],this.DX[C],this.DY[C])&&tt.push(L);this.propagator[C][G]=tt}}};ui.prototype=Object.create(j0.prototype),ui.prototype.constructor=ui,ui.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},ui.prototype.clear=function(){if(j0.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},ui.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},ui.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},ui.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let l=0;l<this.N;l++)for(let h=0;h<this.N;h++){let f=n-h;f<0&&(f+=this.FMX);let d=r-l;if(d<0&&(d+=this.FMY),this.onBoundary(f,d))continue;const p=f+d*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const w=this.colors[this.patterns[m][h+l*this.N]];s+=w[0],o+=w[1],a+=w[2],c+=w[3]}}const u=t*4;e[u]=s/i,e[u+1]=o/i,e[u+2]=a/i,e[u+3]=c/i}};var rT=ui;const iT=$0,Mi=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const u=function(I){const U=new Array(o*o);for(let S=0;S<o;S++)for(let O=0;O<o;O++)U[O+S*o]=I(O,S);return U},l=function(I){return u(function(U,S){return I[o-1-S+U*o]})},h=function(I){return u(function(U,S){return I[o-1-U+S*o]})};this.tiles=[];const f=[],d=[],p={};let m,w,E;for(let A=0;A<t.tiles.length;A++){const I=t.tiles[A];if(c!==null&&c.indexOf(I.name)===-1)continue;switch(I.symmetry){case"L":E=4,m=function(S){return(S+1)%4},w=function(S){return S%2===0?S+1:S-1};break;case"T":E=4,m=function(S){return(S+1)%4},w=function(S){return S%2===0?S:4-S};break;case"I":E=2,m=function(S){return 1-S},w=function(S){return S};break;case"\\":E=2,m=function(S){return 1-S},w=function(S){return 1-S};break;case"F":E=8,m=function(S){return S<4?(S+1)%4:4+(S-1)%4},w=function(S){return S<4?S+4:S-4};break;default:E=1,m=function(S){return S},w=function(S){return S};break}this.T=d.length,p[I.name]=this.T;for(let S=0;S<E;S++)d.push([this.T+S,this.T+m(S),this.T+m(m(S)),this.T+m(m(m(S))),this.T+w(S),this.T+w(m(S)),this.T+w(m(m(S))),this.T+w(m(m(m(S))))]);let U;if(a)for(let S=0;S<E;S++)U=I.bitmap[S],this.tiles.push(u(function(O,B){return[U[(o*B+O)*4],U[(o*B+O)*4+1],U[(o*B+O)*4+2],U[(o*B+O)*4+3]]}));else{U=I.bitmap,this.tiles.push(u(function(S,O){return[U[(o*O+S)*4],U[(o*O+S)*4+1],U[(o*O+S)*4+2],U[(o*O+S)*4+3]]}));for(let S=1;S<E;S++)this.tiles.push(S<4?l(this.tiles[this.T+S-1]):h(this.tiles[this.T+S-4]))}for(let S=0;S<E;S++)f.push(I.weight||1)}this.T=d.length,this.weights=f,this.propagator=new Array(4);const x=new Array(4);for(let A=0;A<4;A++){this.propagator[A]=new Array(this.T),x[A]=new Array(this.T);for(let I=0;I<this.T;I++){x[A][I]=new Array(this.T);for(let U=0;U<this.T;U++)x[A][I][U]=!1}}for(let A=0;A<t.neighbors.length;A++){const I=t.neighbors[A],U=I.left.split(" ").filter(function(tt){return tt.length}),S=I.right.split(" ").filter(function(tt){return tt.length});if(c!==null&&(c.indexOf(U[0])===-1||c.indexOf(S[0])===-1))continue;const O=d[p[U[0]]][U.length==1?0:parseInt(U[1],10)],B=d[O][1],C=d[p[S[0]]][S.length==1?0:parseInt(S[1],10)],G=d[C][1];x[0][C][O]=!0,x[0][d[C][6]][d[O][6]]=!0,x[0][d[O][4]][d[C][4]]=!0,x[0][d[O][2]][d[C][2]]=!0,x[1][G][B]=!0,x[1][d[B][6]][d[G][6]]=!0,x[1][d[G][4]][d[B][4]]=!0,x[1][d[B][2]][d[G][2]]=!0}for(let A=0;A<this.T;A++)for(let I=0;I<this.T;I++)x[2][A][I]=x[0][I][A],x[3][A][I]=x[1][I][A];for(let A=0;A<4;A++)for(let I=0;I<this.T;I++){const U=[],S=x[A][I];for(let O=0;O<this.T;O++)S[O]&&U.push(O);this.propagator[A][I]=U}};Mi.prototype=Object.create(iT.prototype),Mi.prototype.constructor=Mi,Mi.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},Mi.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},Mi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},Mi.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let u=0;u<this.tilesize;u++){const l=(n*this.tilesize+u+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];else{let h=0,f=0,d=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const w=this.tiles[m][u+c*this.tilesize],E=this.weights[m]*a;h+=w[0]*E,f+=w[1]*E,d+=w[2]*E,p+=w[3]*E}e[l]=h,e[l+1]=f,e[l+2]=d,e[l+3]=p}}}};var sT=Mi,oT={OverlappingModel:rT,SimpleTiledModel:sT},aT=xs(oT);function cT(e){return k(e)&&e<jt.ONBLACK?e:void 0}function lT(e){return k(e)&&e>jt.WHITE&&e<jt.ONCLEAR?e-jt.ONBLACK:void 0}const $o={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Pn(e){return re(e)&&W0(e[0])}function z0(e){return Pn(e)&&e[0].startsWith("ON")}function W0(e){return k(jt[e])&&St(e)}function K0(e){if(St(e))return $o[Mt(e)]}function uT(e){return e.map(t=>jt[t]).find(t=>k(t)&&t<jt.ONBLACK)}function hT(e){return e.map(t=>jt[t]).find(t=>k(t)&&t>=jt.ONBLACK)}function fT(e){if(Pn(e))return e;if(W0(e))return[e];const t=K0(e);if(k(t))return[t]}function G0(e){const t=T.words[e],n=fT(t);return Pn(n)?[n,e+1]:[void 0,e]}function pc(e){const t=[];let n=e;const[r,i]=G0(e);if(Pn(r)&&(t.push(...r),n=i),Pn(t)&&!z0(t)){const[s,o]=G0(i);z0(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function H0(e){const t={};return e.every(n=>{const r=jt[n];k(r)&&(r<jt.ONBLACK?t.color=r:t.bg=r-jt.ONBLACK)}),t}function Ys(e){return re(e)&&typeof e[0]=="string"}function dT(e){const t=T.words[e];return St(t)?[t,e+1]:[void 0,e]}function Y0(e){const t=T.words[e];if(Ys(t))return[t,e+1];const[n,r]=pc(e),[i,s]=dT(r);return St(i)?[[i,n],s]:[void 0,e]}function mc(e){if(!Ys(e))return;const[t]=e;return t}function V0(e){if(!Ys(e))return;const[,t]=e,n=k(t)?uT(t):void 0;return k(n)?n:void 0}function X0(e){if(!Ys(e))return;const[,t]=e,n=k(t)?hT(t):void 0;return k(n)?n:void 0}const Wt=60,xe=25,pT=Wt*xe;var Et=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(Et||{});function th(e,t){const n=e??Ht.ISWALK,r=t??Ht.ISWALK;switch(n){case Ht.ISWALK:return r!==Ht.ISWALK;case Ht.ISSWIM:return r!==Ht.ISSWIM;case Ht.ISSOLID:return!0;case Ht.ISBULLET:return r!==Ht.ISWALK&&r!==Ht.ISSWIM}}function gc(e,t,n){const r=e==null?void 0:e.objects[n];if(k(r))return r;if(k(t)){const i=Vs(e,"player"),s={x:t.x??0,y:t.y??0};Z0(s,i)}}function Vs(e,t){var r,i;return t==="empty"?[...(e==null?void 0:e.terrain)??[]].map((o,a)=>{if(!(o!=null&&o.name)&&!(o!=null&&o.kind))return{...E0(a,Wt),name:"empty"}}).filter(k):[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(k)}function q0(e,t){const n=mc(t),r=V0(t),i=X0(t);return e.filter(s=>{var o,a,c;return!(k(n)&&Mt((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||k(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??jt.WHITE)!==r||k(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??jt.BLACK)!==i)}).filter(k)}function J0(e,t){return k(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(k(i))return i;const s=Vs(e,Mt(n));if(s.length)return s}else if(mo(n)&&n.x>=0&&n.x<Wt&&n.y>=0&&n.y<xe){const i=n.x+n.y*Wt,s=(r=e.lookup)==null?void 0:r[i];return k(s)?e.objects[s]:e.terrain[i]}}).flat().filter(k):[]}function Z0(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var eh;try{eh=new TextDecoder}catch{}var mt,Zn,j=0,he={},Jt,Ui,Qn=0,Mr=0,Ze,hi,Tn=[],Vt,Q0={useRecords:!1,mapsAsObjects:!0};class tm{}const em=new tm;em.name="MessagePack 0xC1";var Fi=!1,nm=2,rm;try{new Function("")}catch{nm=1/0}class jo{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(mt)return gm(()=>(oh(),this?this.unpack(t,n):jo.prototype.unpack.call(Q0,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof tn<"u"?tn.from(t):new Uint8Array(t)),typeof n=="object"?(Zn=n.end||t.length,j=n.start||0):(j=0,Zn=n>-1?n:t.length),Mr=0,Ui=null,Ze=null,mt=t;try{Vt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw mt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof jo){if(he=this,this.structures)return Jt=this.structures,yc(n);(!Jt||Jt.length>0)&&(Jt=[])}else he=Q0,(!Jt||Jt.length>0)&&(Jt=[]);return yc(n)}unpackMultiple(t,n){let r,i=0;try{Fi=!0;let s=t.length,o=this?this.unpack(t,s):_c.unpack(t,s);if(n){if(n(o,i,j)===!1)return;for(;j<s;)if(i=j,n(yc(),i,j)===!1)return}else{for(r=[o];j<s;)i=j,r.push(yc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Fi=!1,oh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function yc(e){try{if(!he.trusted&&!Fi){let n=Jt.sharedLength||0;n<Jt.length&&(Jt.length=n)}let t;if(he.randomAccessStructure&&mt[j]<64&&mt[j]>=32&&rm?(t=rm(mt,j,Zn,he),mt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),j=Zn):t=Le(),Ze&&(j=Ze.postBundlePosition,Ze=null),Fi&&(Jt.restoreStructures=null),j==Zn)Jt&&Jt.restoreStructures&&im(),Jt=null,mt=null,hi&&(hi=null);else{if(j>Zn)throw new Error("Unexpected end of MessagePack data");if(!Fi){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Jt&&Jt.restoreStructures&&im(),oh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||j>Zn)&&(t.incomplete=!0),t}}function im(){for(let e in Jt.restoreStructures)Jt[e]=Jt.restoreStructures[e];Jt.restoreStructures=null}function Le(){let e=mt[j++];if(e<160)if(e<128){if(e<64)return e;{let t=Jt[e&63]||he.getStructures&&om()[e&63];return t?(t.read||(t.read=nh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,he.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=fm();r==="__proto__"&&(r="__proto_"),t[r]=Le()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Le(),Le());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Le();return he.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Mr>=j)return Ui.slice(j-Qn,(j+=t)-Qn);if(Mr==0&&Zn<140){let n=t<16?ih(t):lm(t);if(n!=null)return n}return rh(t)}else{let t;switch(e){case 192:return null;case 193:return Ze?(t=Le(),t>0?Ze[1].slice(Ze.position1,Ze.position1+=t):Ze[0].slice(Ze.position0,Ze.position0-=t)):em;case 194:return!1;case 195:return!0;case 196:if(t=mt[j++],t===void 0)throw new Error("Unexpected end of buffer");return sh(t);case 197:return t=Vt.getUint16(j),j+=2,sh(t);case 198:return t=Vt.getUint32(j),j+=4,sh(t);case 199:return is(mt[j++]);case 200:return t=Vt.getUint16(j),j+=2,is(t);case 201:return t=Vt.getUint32(j),j+=4,is(t);case 202:if(t=Vt.getFloat32(j),he.useFloat32>2){let n=ah[(mt[j]&127)<<1|mt[j+1]>>7];return j+=4,(n*t+(t>0?.5:-.5)>>0)/n}return j+=4,t;case 203:return t=Vt.getFloat64(j),j+=8,t;case 204:return mt[j++];case 205:return t=Vt.getUint16(j),j+=2,t;case 206:return t=Vt.getUint32(j),j+=4,t;case 207:return he.int64AsType==="number"?(t=Vt.getUint32(j)*4294967296,t+=Vt.getUint32(j+4)):he.int64AsType==="string"?t=Vt.getBigUint64(j).toString():he.int64AsType==="auto"?(t=Vt.getBigUint64(j),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Vt.getBigUint64(j),j+=8,t;case 208:return Vt.getInt8(j++);case 209:return t=Vt.getInt16(j),j+=2,t;case 210:return t=Vt.getInt32(j),j+=4,t;case 211:return he.int64AsType==="number"?(t=Vt.getInt32(j)*4294967296,t+=Vt.getUint32(j+4)):he.int64AsType==="string"?t=Vt.getBigInt64(j).toString():he.int64AsType==="auto"?(t=Vt.getBigInt64(j),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Vt.getBigInt64(j),j+=8,t;case 212:if(t=mt[j++],t==114)return pm(mt[j++]&63);{let n=Tn[t];if(n)return n.read?(j++,n.read(Le())):n.noBuffer?(j++,n()):n(mt.subarray(j,++j));throw new Error("Unknown extension "+t)}case 213:return t=mt[j],t==114?(j++,pm(mt[j++]&63,mt[j++])):is(2);case 214:return is(4);case 215:return is(8);case 216:return is(16);case 217:return t=mt[j++],Mr>=j?Ui.slice(j-Qn,(j+=t)-Qn):gT(t);case 218:return t=Vt.getUint16(j),j+=2,Mr>=j?Ui.slice(j-Qn,(j+=t)-Qn):yT(t);case 219:return t=Vt.getUint32(j),j+=4,Mr>=j?Ui.slice(j-Qn,(j+=t)-Qn):_T(t);case 220:return t=Vt.getUint16(j),j+=2,am(t);case 221:return t=Vt.getUint32(j),j+=4,am(t);case 222:return t=Vt.getUint16(j),j+=2,cm(t);case 223:return t=Vt.getUint32(j),j+=4,cm(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const mT=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function nh(e,t){function n(){if(n.count++>nm){let i=e.read=new Function("r","return function(){return "+(he.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":mT.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Le);return e.highByte===0&&(e.read=sm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Le()}return he.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?sm(t,n):n}const sm=(e,t)=>function(){let n=mt[j++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Jt[r]||om()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=nh(i,e)),i.read()};function om(){let e=gm(()=>(mt=null,he.getStructures()));return Jt=he._mergeStructures(e,Jt)}var rh=zo,gT=zo,yT=zo,_T=zo;function zo(e){let t;if(e<16&&(t=ih(e)))return t;if(e>64&&eh)return eh.decode(mt.subarray(j,j+=e));const n=j+e,r=[];for(t="";j<n;){const i=mt[j++];if(!(i&128))r.push(i);else if((i&224)===192){const s=mt[j++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=mt[j++]&63,o=mt[j++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=mt[j++]&63,o=mt[j++]&63,a=mt[j++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=Qe.apply(String,r),r.length=0)}return r.length>0&&(t+=Qe.apply(String,r)),t}function am(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Le();return he.freezeData?Object.freeze(t):t}function cm(e){if(he.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=fm();r==="__proto__"&&(r="__proto_"),t[r]=Le()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Le(),Le());return t}}var Qe=String.fromCharCode;function lm(e){let t=j,n=new Array(e);for(let r=0;r<e;r++){const i=mt[j++];if((i&128)>0){j=t;return}n[r]=i}return Qe.apply(String,n)}function ih(e){if(e<4)if(e<2){if(e===0)return"";{let t=mt[j++];if((t&128)>1){j-=1;return}return Qe(t)}}else{let t=mt[j++],n=mt[j++];if((t&128)>0||(n&128)>0){j-=2;return}if(e<3)return Qe(t,n);let r=mt[j++];if((r&128)>0){j-=3;return}return Qe(t,n,r)}else{let t=mt[j++],n=mt[j++],r=mt[j++],i=mt[j++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){j-=4;return}if(e<6){if(e===4)return Qe(t,n,r,i);{let s=mt[j++];if((s&128)>0){j-=5;return}return Qe(t,n,r,i,s)}}else if(e<8){let s=mt[j++],o=mt[j++];if((s&128)>0||(o&128)>0){j-=6;return}if(e<7)return Qe(t,n,r,i,s,o);let a=mt[j++];if((a&128)>0){j-=7;return}return Qe(t,n,r,i,s,o,a)}else{let s=mt[j++],o=mt[j++],a=mt[j++],c=mt[j++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){j-=8;return}if(e<10){if(e===8)return Qe(t,n,r,i,s,o,a,c);{let u=mt[j++];if((u&128)>0){j-=9;return}return Qe(t,n,r,i,s,o,a,c,u)}}else if(e<12){let u=mt[j++],l=mt[j++];if((u&128)>0||(l&128)>0){j-=10;return}if(e<11)return Qe(t,n,r,i,s,o,a,c,u,l);let h=mt[j++];if((h&128)>0){j-=11;return}return Qe(t,n,r,i,s,o,a,c,u,l,h)}else{let u=mt[j++],l=mt[j++],h=mt[j++],f=mt[j++];if((u&128)>0||(l&128)>0||(h&128)>0||(f&128)>0){j-=12;return}if(e<14){if(e===12)return Qe(t,n,r,i,s,o,a,c,u,l,h,f);{let d=mt[j++];if((d&128)>0){j-=13;return}return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d)}}else{let d=mt[j++],p=mt[j++];if((d&128)>0||(p&128)>0){j-=14;return}if(e<15)return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d,p);let m=mt[j++];if((m&128)>0){j-=15;return}return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d,p,m)}}}}}function um(){let e=mt[j++],t;if(e<192)t=e-160;else switch(e){case 217:t=mt[j++];break;case 218:t=Vt.getUint16(j),j+=2;break;case 219:t=Vt.getUint32(j),j+=4;break;default:throw new Error("Expected string")}return zo(t)}function sh(e){return he.copyBuffers?Uint8Array.prototype.slice.call(mt,j,j+=e):mt.subarray(j,j+=e)}function is(e){let t=mt[j++];if(Tn[t]){let n;return Tn[t](mt.subarray(j,n=j+=e),r=>{j=r;try{return Le()}finally{j=n}})}else throw new Error("Unknown extension type "+t)}var hm=new Array(4096);function fm(){let e=mt[j++];if(e>=160&&e<192){if(e=e-160,Mr>=j)return Ui.slice(j-Qn,(j+=e)-Qn);if(!(Mr==0&&Zn<180))return rh(e)}else return j--,dm(Le());let t=(e<<5^(e>1?Vt.getUint16(j):e>0?mt[j]:0))&4095,n=hm[t],r=j,i=j+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Vt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=mt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return j=r,n.string;i-=3,r=j}for(n=[],hm[t]=n,n.bytes=e;r<i;)s=Vt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=mt[r++],n.push(s);let a=e<16?ih(e):lm(e);return a!=null?n.string=a:n.string=rh(e)}function dm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const pm=(e,t)=>{let n=Le().map(dm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Jt[e];return i&&(i.isShared||Fi)&&((Jt.restoreStructures||(Jt.restoreStructures=[]))[e]=i),Jt[e]=n,n.read=nh(n,r),n.read()};Tn[0]=()=>{},Tn[0].noBuffer=!0,Tn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let bT={Error,TypeError,ReferenceError};Tn[101]=()=>{let e=Le();return(bT[e[0]]||Error)(e[1],{cause:e[2]})},Tn[105]=e=>{if(he.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Vt.getUint32(j-4);hi||(hi=new Map);let n=mt[j],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};hi.set(t,i);let s=Le();return i.used?Object.assign(r,s):(i.target=s,s)},Tn[112]=e=>{if(he.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Vt.getUint32(j-4),n=hi.get(t);return n.used=!0,n.target},Tn[115]=()=>new Set(Le());const mm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let ET=typeof globalThis=="object"?globalThis:window;Tn[116]=e=>{let t=e[0],n=mm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new ET[n](Uint8Array.prototype.slice.call(e,1).buffer)},Tn[120]=()=>{let e=Le();return new RegExp(e[0],e[1])};const wT=[];Tn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=j;return j+=t-e.length,Ze=wT,Ze=[um(),um()],Ze.position0=0,Ze.position1=0,Ze.postBundlePosition=j,j=n,Le()},Tn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function gm(e){let t=Zn,n=j,r=Qn,i=Mr,s=Ui,o=hi,a=Ze,c=new Uint8Array(mt.slice(0,Zn)),u=Jt,l=Jt.slice(0,Jt.length),h=he,f=Fi,d=e();return Zn=t,j=n,Qn=r,Mr=i,Ui=s,hi=o,Ze=a,mt=c,Fi=f,Jt=u,Jt.splice(0,Jt.length,...l),he=h,Vt=new DataView(mt.buffer,mt.byteOffset,mt.byteLength),d}function oh(){mt=null,hi=null,Jt=null}const ah=new Array(147);for(let e=0;e<256;e++)ah[e]=+("1e"+Math.floor(45.15-e*.30103));var _c=new jo({useRecords:!1});const kT=_c.unpack;_c.unpackMultiple,_c.unpack;let xT=new Float32Array(1);new Uint8Array(xT.buffer,0,4);let bc;try{bc=new TextEncoder}catch{}let ch,ym;const Ec=typeof tn<"u",wc=Ec?function(e){return tn.allocUnsafeSlow(e)}:Uint8Array,_m=Ec?tn:Uint8Array,bm=Ec?4294967296:2144337920;let q,Wo,fe,K=0,gn,Te=null,TT;const AT=21760,vT=/[\u0080-\uFFFF]/,Xs=Symbol("record-id");class ST extends jo{constructor(t){super(t),this.offset=0;let n,r,i,s,o=_m.prototype.utf8Write?function(R,_){return q.utf8Write(R,_,q.byteLength-_)}:bc&&bc.encodeInto?function(R,_){return bc.encodeInto(R,q.subarray(_)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let f=l>32||h+l>64,d=l+64,p=l+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],w=0,E=0;this.pack=this.encode=function(R,_){if(q||(q=new wc(8192),fe=q.dataView||(q.dataView=new DataView(q.buffer,0,8192)),K=0),gn=q.length-10,gn-K<2048?(q=new wc(q.length),fe=q.dataView||(q.dataView=new DataView(q.buffer,0,q.length)),gn=q.length-10,K=0):K=K+7&2147483640,n=K,_&MT&&(K+=_&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof R!="string"?(Te=[],Te.size=1/0):Te=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let Z=i.sharedLength||0;if(Z>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let $=0;$<Z;$++){let lt=i[$];if(!lt)continue;let et,ft=i.transitions;for(let H=0,W=lt.length;H<W;H++){let bt=lt[H];et=ft[bt],et||(et=ft[bt]=Object.create(null)),ft=et}ft[Xs]=$+64}this.lastNamedStructuresLength=Z}c||(i.nextId=Z+64)}r&&(r=!1);let P;try{a.randomAccessStructure&&R&&R.constructor&&R.constructor===Object?L(R):I(R);let Z=Te;if(Te&&km(n,I,0),s&&s.idsToInsert){let $=s.idsToInsert.sort((H,W)=>H.offset>W.offset?1:-1),lt=$.length,et=-1;for(;Z&&lt>0;){let H=$[--lt].offset+n;H<Z.stringsPosition+n&&et===-1&&(et=0),H>Z.position+n?et>=0&&(et+=6):(et>=0&&(fe.setUint32(Z.position+n,fe.getUint32(Z.position+n)+et),et=-1),Z=Z.previous,lt++)}et>=0&&Z&&fe.setUint32(Z.position+n,fe.getUint32(Z.position+n)+et),K+=$.length*6,K>gn&&C(K),a.offset=K;let ft=IT(q.subarray(n,K),$);return s=null,ft}return a.offset=K,_&CT?(q.start=n,q.end=K,q):q.subarray(n,K)}catch(Z){throw P=Z,Z}finally{if(i&&(x(),r&&a.saveStructures)){let Z=i.sharedLength||0,$=q.subarray(n,K),lt=OT(i,a);if(!P)return a.saveStructures(lt,lt.isCompatible)===!1?a.pack(R,_):(a.lastNamedStructuresLength=Z,q.length>1073741824&&(q=null),$)}q.length>1073741824&&(q=null),_&LT&&(K=n)}};const x=()=>{E<10&&E++;let R=i.sharedLength||0;if(i.length>R&&!c&&(i.length=R),w>1e4)i.transitions=null,E=0,w=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let _=0,P=m.length;_<P;_++)m[_][Xs]=0;m=[]}},A=R=>{var _=R.length;_<16?q[K++]=144|_:_<65536?(q[K++]=220,q[K++]=_>>8,q[K++]=_&255):(q[K++]=221,fe.setUint32(K,_),K+=4);for(let P=0;P<_;P++)I(R[P])},I=R=>{K>gn&&(q=C(K));var _=typeof R,P;if(_==="string"){let Z=R.length;if(Te&&Z>=4&&Z<4096){if((Te.size+=Z)>AT){let ft,H=(Te[0]?Te[0].length*3+Te[1].length:0)+10;K+H>gn&&(q=C(K+H));let W;Te.position?(W=Te,q[K]=200,K+=3,q[K++]=98,ft=K-n,K+=4,km(n,I,0),fe.setUint16(ft+n-3,K-n-ft)):(q[K++]=214,q[K++]=98,ft=K-n,K+=4),Te=["",""],Te.previous=W,Te.size=0,Te.position=ft}let et=vT.test(R);Te[et?0:1]+=R,q[K++]=193,I(et?-Z:Z);return}let $;Z<32?$=1:Z<256?$=2:Z<65536?$=3:$=5;let lt=Z*3;if(K+lt>gn&&(q=C(K+lt)),Z<64||!o){let et,ft,H,W=K+$;for(et=0;et<Z;et++)ft=R.charCodeAt(et),ft<128?q[W++]=ft:ft<2048?(q[W++]=ft>>6|192,q[W++]=ft&63|128):(ft&64512)===55296&&((H=R.charCodeAt(et+1))&64512)===56320?(ft=65536+((ft&1023)<<10)+(H&1023),et++,q[W++]=ft>>18|240,q[W++]=ft>>12&63|128,q[W++]=ft>>6&63|128,q[W++]=ft&63|128):(q[W++]=ft>>12|224,q[W++]=ft>>6&63|128,q[W++]=ft&63|128);P=W-K-$}else P=o(R,K+$);P<32?q[K++]=160|P:P<256?($<2&&q.copyWithin(K+2,K+1,K+1+P),q[K++]=217,q[K++]=P):P<65536?($<3&&q.copyWithin(K+3,K+2,K+2+P),q[K++]=218,q[K++]=P>>8,q[K++]=P&255):($<5&&q.copyWithin(K+5,K+3,K+3+P),q[K++]=219,fe.setUint32(K,P),K+=4),K+=P}else if(_==="number")if(R>>>0===R)R<32||R<128&&this.useRecords===!1||R<64&&!this.randomAccessStructure?q[K++]=R:R<256?(q[K++]=204,q[K++]=R):R<65536?(q[K++]=205,q[K++]=R>>8,q[K++]=R&255):(q[K++]=206,fe.setUint32(K,R),K+=4);else if(R>>0===R)R>=-32?q[K++]=256+R:R>=-128?(q[K++]=208,q[K++]=R+256):R>=-32768?(q[K++]=209,fe.setInt16(K,R),K+=2):(q[K++]=210,fe.setInt32(K,R),K+=4);else{let Z;if((Z=this.useFloat32)>0&&R<4294967296&&R>=-2147483648){q[K++]=202,fe.setFloat32(K,R);let $;if(Z<4||($=R*ah[(q[K]&127)<<1|q[K+1]>>7])>>0===$){K+=4;return}else K--}q[K++]=203,fe.setFloat64(K,R),K+=8}else if(_==="object"||_==="function")if(!R)q[K++]=192;else{if(s){let $=s.get(R);if($){if(!$.id){let lt=s.idsToInsert||(s.idsToInsert=[]);$.id=lt.push($)}q[K++]=214,q[K++]=112,fe.setUint32(K,$.id),K+=4;return}else s.set(R,{offset:K-n})}let Z=R.constructor;if(Z===Object)B(R);else if(Z===Array)A(R);else if(Z===Map)if(this.mapAsEmptyObject)q[K++]=128;else{P=R.size,P<16?q[K++]=128|P:P<65536?(q[K++]=222,q[K++]=P>>8,q[K++]=P&255):(q[K++]=223,fe.setUint32(K,P),K+=4);for(let[$,lt]of R)I($),I(lt)}else{for(let $=0,lt=ch.length;$<lt;$++){let et=ym[$];if(R instanceof et){let ft=ch[$];if(ft.write){ft.type&&(q[K++]=212,q[K++]=ft.type,q[K++]=0);let ct=ft.write.call(this,R);ct===R?Array.isArray(R)?A(R):B(R):I(ct);return}let H=q,W=fe,bt=K;q=null;let ot;try{ot=ft.pack.call(this,R,ct=>(q=H,H=null,K+=ct,K>gn&&C(K),{target:q,targetView:fe,position:K-ct}),I)}finally{H&&(q=H,fe=W,K=bt,gn=q.length-10)}ot&&(ot.length+K>gn&&C(ot.length+K),K=RT(ot,q,K,ft.type));return}}if(Array.isArray(R))A(R);else{if(R.toJSON){const $=R.toJSON();if($!==R)return I($)}if(_==="function")return I(this.writeFunction&&this.writeFunction(R));B(R)}}}else if(_==="boolean")q[K++]=R?195:194;else if(_==="bigint"){if(R<BigInt(1)<<BigInt(63)&&R>=-(BigInt(1)<<BigInt(63)))q[K++]=211,fe.setBigInt64(K,R);else if(R<BigInt(1)<<BigInt(64)&&R>0)q[K++]=207,fe.setBigUint64(K,R);else if(this.largeBigIntToFloat)q[K++]=203,fe.setFloat64(K,Number(R));else{if(this.largeBigIntToString)return I(R.toString());if(this.useBigIntExtension&&R<BigInt(2)**BigInt(1023)&&R>-(BigInt(2)**BigInt(1023))){q[K++]=199,K++,q[K++]=66;let Z=[],$;do{let lt=R&BigInt(255);$=(lt&BigInt(128))===(R<BigInt(0)?BigInt(128):BigInt(0)),Z.push(lt),R>>=BigInt(8)}while(!((R===BigInt(0)||R===BigInt(-1))&&$));q[K-2]=Z.length;for(let lt=Z.length;lt>0;)q[K++]=Number(Z[--lt]);return}else throw new RangeError(R+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}K+=8}else if(_==="undefined")this.encodeUndefinedAsNil?q[K++]=192:(q[K++]=212,q[K++]=0,q[K++]=0);else throw new Error("Unknown type: "+_)},U=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?R=>{let _;if(this.skipValues){_=[];for(let $ in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty($))&&!this.skipValues.includes(R[$])&&_.push($)}else _=Object.keys(R);let P=_.length;P<16?q[K++]=128|P:P<65536?(q[K++]=222,q[K++]=P>>8,q[K++]=P&255):(q[K++]=223,fe.setUint32(K,P),K+=4);let Z;if(this.coercibleKeyAsNumber)for(let $=0;$<P;$++){Z=_[$];let lt=Number(Z);I(isNaN(lt)?Z:lt),I(R[Z])}else for(let $=0;$<P;$++)I(Z=_[$]),I(R[Z])}:R=>{q[K++]=222;let _=K-n;K+=2;let P=0;for(let Z in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(Z))&&(I(Z),I(R[Z]),P++);if(P>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');q[_+++n]=P>>8,q[_+n]=P&255},S=this.useRecords===!1?U:t.progressiveRecords&&!f?R=>{let _,P=i.transitions||(i.transitions=Object.create(null)),Z=K++-n,$;for(let lt in R)if(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(lt)){if(_=P[lt],_)P=_;else{let et=Object.keys(R),ft=P;P=i.transitions;let H=0;for(let W=0,bt=et.length;W<bt;W++){let ot=et[W];_=P[ot],_||(_=P[ot]=Object.create(null),H++),P=_}Z+n+1==K?(K--,G(P,et,H)):tt(P,et,Z,H),$=!0,P=ft[lt]}I(R[lt])}if(!$){let lt=P[Xs];lt?q[Z+n]=lt:tt(P,Object.keys(R),Z,0)}}:R=>{let _,P=i.transitions||(i.transitions=Object.create(null)),Z=0;for(let lt in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(lt))&&(_=P[lt],_||(_=P[lt]=Object.create(null),Z++),P=_);let $=P[Xs];$?$>=96&&f?(q[K++]=(($-=96)&31)+96,q[K++]=$>>5):q[K++]=$:G(P,P.__keys__||Object.keys(R),Z);for(let lt in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(lt))&&I(R[lt])},O=typeof this.useRecords=="function"&&this.useRecords,B=O?R=>{O(R)?S(R):U(R)}:S,C=R=>{let _;if(R>16777216){if(R-n>bm)throw new Error("Packed buffer would be larger than maximum buffer size");_=Math.min(bm,Math.round(Math.max((R-n)*(R>67108864?1.25:2),4194304)/4096)*4096)}else _=(Math.max(R-n<<2,q.length-1)>>12)+1<<12;let P=new wc(_);return fe=P.dataView||(P.dataView=new DataView(P.buffer,0,_)),R=Math.min(R,q.length),q.copy?q.copy(P,0,n,R):P.set(q.slice(n,R)),K-=n,n=0,gn=P.length-10,q=P},G=(R,_,P)=>{let Z=i.nextId;Z||(Z=64),Z<d&&this.shouldShareStructure&&!this.shouldShareStructure(_)?(Z=i.nextOwnId,Z<p||(Z=d),i.nextOwnId=Z+1):(Z>=p&&(Z=d),i.nextId=Z+1);let $=_.highByte=Z>=96&&f?Z-96>>5:-1;R[Xs]=Z,R.__keys__=_,i[Z-64]=_,Z<d?(_.isShared=!0,i.sharedLength=Z-63,r=!0,$>=0?(q[K++]=(Z&31)+96,q[K++]=$):q[K++]=Z):($>=0?(q[K++]=213,q[K++]=114,q[K++]=(Z&31)+96,q[K++]=$):(q[K++]=212,q[K++]=114,q[K++]=Z),P&&(w+=E*P),m.length>=h&&(m.shift()[Xs]=0),m.push(R),I(_))},tt=(R,_,P,Z)=>{let $=q,lt=K,et=gn,ft=n;q=Wo,K=0,n=0,q||(Wo=q=new wc(8192)),gn=q.length-10,G(R,_,Z),Wo=q;let H=K;if(q=$,K=lt,gn=et,n=ft,H>1){let W=K+H-1;W>gn&&C(W);let bt=P+n;q.copyWithin(bt+H,bt+1,K),q.set(Wo.slice(0,H),bt),K=W}else q[P+n]=Wo[0]},L=R=>{let _=TT(R,q,n,K,i,C,(P,Z,$)=>{if($)return r=!0;K=Z;let lt=q;return I(P),x(),lt!==q?{position:K,targetView:fe,target:q}:K},this);if(_===0)return B(R);K=_}}useBuffer(t){q=t,q.dataView||(q.dataView=new DataView(q.buffer,q.byteOffset,q.byteLength)),K=0}set position(t){K=t}get position(){return K}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}ym=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,tm],ch=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Em(e,16,t):wm(Ec?tn.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==_m&&this.moreTypes?Em(e,mm.indexOf(n.name),t):wm(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Em(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function wm(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function RT(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function IT(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function km(e,t,n){if(Te.length>0){fe.setUint32(Te.position+e,K+n-Te.position-e),Te.stringsPosition=K-e;let r=Te;Te=null,t(r[0]),t(r[1])}}function OT(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let xm=new ST({useRecords:!1});const NT=xm.pack;xm.pack;const CT=512,LT=1024,MT=2048;function Me(){return null}function qs(e,t,n={}){if(!k(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];k(c)&&(a=c(a));const u=t[o];k(u)&&(o=u),a!==null&&r.push(o,a)}return r}function Ko(e,t,n={}){if(k(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];k(a)&&(s=a);const c=n[s];k(c)&&(o=c(o)),r[s]=o}return r}catch(r){ae(z,"binary",r.message)}}function UT(e){try{const t=Xe(e);return NT(t)}catch(t){ae(z,"binary",t.message)}}function FT(e){try{return kT(e)}catch(t){ae(z,"binary",t.message)}}function Tm(){return{id:Ne()}}var kc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e))(kc||{});function xc(e){return k(e==null?void 0:e.id)?qs(e,kc,{category:Me,kinddata:Me,stopped:Me,removed:Me,bucket:Me}):qs(e,kc,{id:Me,x:Me,y:Me,lx:Me,ly:Me,code:Me,category:Me,kinddata:Me,stopped:Me,removed:Me,bucket:Me})}function Tc(e){return Ko(e,kc)}function Ac(e){var t;return((t=e==null?void 0:e.id)==null?void 0:t.length)??!1}function vc(e,t){if(!k(e)||!Pn(t))return;const{color:n,bg:r}=H0(t);k(n)&&(e.color=n),k(r)&&(e.bg=r)}function Ur(e){var t;return Mt((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function Am(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function vm(e){const t=Math.floor(e.length/lc);if(t*lc!==e.length){ae(z,"size","wrong number of bytes for a palette");return}const n=Am(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function BT(e,t){return e&1<<t?255:0}function Sm(e){const t=Math.floor(e.length/Zu);if(t*Zu!==e.length){ae(z,"size","wrong number of bytes for a charset");return}const n=Math.ceil(t/fc),r=uc*fc,i=Am(r,hc*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const u=o*hc+a,l=e[c];for(let h=0;h<uc;++h){const f=s*uc+h;i.bits[f+u*r]=BT(l,7-h)}++a,a===hc&&(a=0,++s,s===fc&&(s=0,++o))}return i}const PT=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,126,0,0,0,0,0,126,255,219,255,255,195,231,255,126,0,0,0,0,0,0,108,254,254,254,254,124,56,16,0,0,0,0,0,0,16,56,124,254,124,56,16,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,30,14,26,50,120,204,204,204,120,0,0,0,0,0,60,102,102,102,60,24,126,24,24,0,0,0,0,0,63,51,63,48,48,48,112,240,224,0,0,0,0,0,127,99,127,99,99,99,103,231,230,192,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,128,192,224,248,254,248,224,192,128,0,0,0,0,0,2,6,14,62,254,62,14,6,2,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,102,102,102,102,102,102,0,102,102,0,0,0,0,0,127,219,219,219,123,27,27,27,27,0,0,0,0,124,198,96,56,108,198,198,108,56,12,198,124,0,0,0,0,0,0,0,0,0,254,254,254,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,24,60,126,24,24,24,24,24,24,0,0,0,0,0,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,24,12,254,12,24,0,0,0,0,0,0,0,0,0,48,96,254,96,48,0,0,0,0,0,0,0,0,0,0,192,192,192,254,0,0,0,0,0,0,0,0,0,40,108,254,108,40,0,0,0,0,0,0,0,0,16,56,56,124,124,254,254,0,0,0,0,0,0,0,254,254,124,124,56,56,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,24,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,108,108,254,108,108,0,0,0,24,24,124,198,194,192,124,6,134,198,124,24,24,0,0,0,0,0,194,198,12,24,48,102,198,0,0,0,0,0,56,108,108,56,118,220,204,204,118,0,0,0,0,48,48,48,96,0,0,0,0,0,0,0,0,0,0,0,12,24,48,48,48,48,48,24,12,0,0,0,0,0,48,24,12,12,12,12,12,24,48,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,48,0,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,2,6,12,24,48,96,192,128,0,0,0,0,0,0,124,198,206,222,246,230,198,198,124,0,0,0,0,0,24,56,120,24,24,24,24,24,126,0,0,0,0,0,124,198,6,12,24,48,96,198,254,0,0,0,0,0,124,198,6,6,60,6,6,198,124,0,0,0,0,0,12,28,60,108,204,254,12,12,30,0,0,0,0,0,254,192,192,192,252,6,6,198,124,0,0,0,0,0,56,96,192,192,252,198,198,198,124,0,0,0,0,0,254,198,6,12,24,48,48,48,48,0,0,0,0,0,124,198,198,198,124,198,198,198,124,0,0,0,0,0,124,198,198,198,126,6,6,12,120,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,24,24,0,0,0,24,24,48,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,124,198,198,12,24,24,0,24,24,0,0,0,0,0,124,198,198,222,222,222,220,192,124,0,0,0,0,0,16,56,108,198,198,254,198,198,198,0,0,0,0,0,252,102,102,102,124,102,102,102,252,0,0,0,0,0,60,102,194,192,192,192,194,102,60,0,0,0,0,0,248,108,102,102,102,102,102,108,248,0,0,0,0,0,254,102,98,104,120,104,98,102,254,0,0,0,0,0,254,102,98,104,120,104,96,96,240,0,0,0,0,0,60,102,194,192,192,222,198,102,58,0,0,0,0,0,198,198,198,198,254,198,198,198,198,0,0,0,0,0,60,24,24,24,24,24,24,24,60,0,0,0,0,0,30,12,12,12,12,12,204,204,120,0,0,0,0,0,230,102,108,108,120,108,108,102,230,0,0,0,0,0,240,96,96,96,96,96,98,102,254,0,0,0,0,0,198,238,254,254,214,198,198,198,198,0,0,0,0,0,198,230,246,254,222,206,198,198,198,0,0,0,0,0,56,108,198,198,198,198,198,108,56,0,0,0,0,0,252,102,102,102,124,96,96,96,240,0,0,0,0,0,124,198,198,198,198,214,222,124,12,14,0,0,0,0,252,102,102,102,124,108,102,102,230,0,0,0,0,0,124,198,198,96,56,12,198,198,124,0,0,0,0,0,126,126,90,24,24,24,24,24,60,0,0,0,0,0,198,198,198,198,198,198,198,198,124,0,0,0,0,0,198,198,198,198,198,198,108,56,16,0,0,0,0,0,198,198,198,198,214,214,254,124,108,0,0,0,0,0,198,198,108,56,56,56,108,198,198,0,0,0,0,0,102,102,102,102,60,24,24,24,60,0,0,0,0,0,254,198,140,24,48,96,194,198,254,0,0,0,0,0,60,48,48,48,48,48,48,48,60,0,0,0,0,0,128,192,224,112,56,28,14,6,2,0,0,0,0,0,60,12,12,12,12,12,12,12,60,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,12,124,204,204,118,0,0,0,0,0,224,96,96,120,108,102,102,102,124,0,0,0,0,0,0,0,0,124,198,192,192,198,124,0,0,0,0,0,28,12,12,60,108,204,204,204,118,0,0,0,0,0,0,0,0,124,198,254,192,198,124,0,0,0,0,0,56,108,100,96,240,96,96,96,240,0,0,0,0,0,0,0,0,118,204,204,204,124,12,204,120,0,0,0,224,96,96,108,118,102,102,102,230,0,0,0,0,0,24,24,0,56,24,24,24,24,60,0,0,0,0,0,6,6,0,14,6,6,6,6,102,102,60,0,0,0,224,96,96,102,108,120,108,102,230,0,0,0,0,0,56,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,236,254,214,214,214,198,0,0,0,0,0,0,0,0,220,102,102,102,102,102,0,0,0,0,0,0,0,0,124,198,198,198,198,124,0,0,0,0,0,0,0,0,220,102,102,102,124,96,96,240,0,0,0,0,0,0,118,204,204,204,124,12,12,30,0,0,0,0,0,0,220,118,102,96,96,240,0,0,0,0,0,0,0,0,124,198,112,28,198,124,0,0,0,0,0,16,48,48,252,48,48,48,54,28,0,0,0,0,0,0,0,0,204,204,204,204,204,118,0,0,0,0,0,0,0,0,102,102,102,102,60,24,0,0,0,0,0,0,0,0,198,198,214,214,254,108,0,0,0,0,0,0,0,0,198,108,56,56,108,198,0,0,0,0,0,0,0,0,198,198,198,198,126,6,12,248,0,0,0,0,0,0,254,204,24,48,102,254,0,0,0,0,0,14,24,24,24,112,24,24,24,14,0,0,0,0,0,24,24,24,24,0,24,24,24,24,0,0,0,0,0,112,24,24,24,14,24,24,24,112,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,60,102,194,192,192,194,102,60,12,6,124,0,0,0,204,204,0,204,204,204,204,204,118,0,0,0,0,12,24,48,0,124,198,254,192,198,124,0,0,0,0,16,56,108,0,120,12,124,204,204,118,0,0,0,0,0,204,204,0,120,12,124,204,204,118,0,0,0,0,96,48,24,0,120,12,124,204,204,118,0,0,0,0,56,108,56,0,120,12,124,204,204,118,0,0,0,0,0,0,0,60,102,96,102,60,12,6,60,0,0,0,16,56,108,0,124,198,254,192,198,124,0,0,0,0,0,204,204,0,124,198,254,192,198,124,0,0,0,0,96,48,24,0,124,198,254,192,198,124,0,0,0,0,0,102,102,0,56,24,24,24,24,60,0,0,0,0,24,60,102,0,56,24,24,24,24,60,0,0,0,0,96,48,24,0,56,24,24,24,24,60,0,0,0,0,198,198,16,56,108,198,198,254,198,198,0,0,0,56,108,56,0,56,108,198,198,254,198,198,0,0,0,24,48,96,0,254,102,96,124,96,102,254,0,0,0,0,0,0,0,204,118,54,126,216,216,110,0,0,0,0,0,62,108,204,204,254,204,204,204,206,0,0,0,0,16,56,108,0,124,198,198,198,198,124,0,0,0,0,0,198,198,0,124,198,198,198,198,124,0,0,0,0,96,48,24,0,124,198,198,198,198,124,0,0,0,0,48,120,204,0,204,204,204,204,204,118,0,0,0,0,96,48,24,0,204,204,204,204,204,118,0,0,0,0,0,198,198,0,198,198,198,198,126,6,12,120,0,0,198,198,56,108,198,198,198,198,108,56,0,0,0,0,198,198,0,198,198,198,198,198,198,124,0,0,0,0,24,24,60,102,96,96,102,60,24,24,0,0,0,0,56,108,100,96,240,96,96,96,230,252,0,0,0,0,0,102,102,60,24,126,24,126,24,24,0,0,0,0,248,204,204,248,196,204,222,204,204,198,0,0,0,0,14,27,24,24,24,126,24,24,24,24,216,112,0,0,24,48,96,0,120,12,124,204,204,118,0,0,0,0,12,24,48,0,56,24,24,24,24,60,0,0,0,0,24,48,96,0,124,198,198,198,198,124,0,0,0,0,24,48,96,0,204,204,204,204,204,118,0,0,0,0,0,118,220,0,220,102,102,102,102,102,0,0,0,118,220,0,198,230,246,254,222,206,198,198,0,0,0,0,60,108,108,62,0,126,0,0,0,0,0,0,0,0,56,108,108,56,0,124,0,0,0,0,0,0,0,0,0,48,48,0,48,48,96,198,198,124,0,0,0,0,0,0,0,0,0,254,192,192,192,0,0,0,0,0,0,0,0,0,0,254,6,6,6,0,0,0,0,0,192,192,198,204,216,48,96,220,134,12,24,62,0,0,192,192,198,204,216,48,102,206,158,62,6,6,0,0,0,24,24,0,24,24,60,60,60,24,0,0,0,0,0,0,0,54,108,216,108,54,0,0,0,0,0,0,0,0,0,216,108,54,108,216,0,0,0,0,0,17,68,17,68,17,68,17,68,17,68,17,68,17,68,85,170,85,170,85,170,85,170,85,170,85,170,85,170,221,119,221,119,221,119,221,119,221,119,221,119,221,119,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,248,24,24,24,24,24,24,24,24,24,24,24,248,24,248,24,24,24,24,24,24,54,54,54,54,54,54,54,246,54,54,54,54,54,54,0,0,0,0,0,0,0,254,54,54,54,54,54,54,0,0,0,0,0,248,24,248,24,24,24,24,24,24,54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54,54,54,54,246,6,254,0,0,0,0,0,0,54,54,54,54,54,54,54,254,0,0,0,0,0,0,24,24,24,24,24,248,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,248,24,24,24,24,24,24,24,24,24,24,24,24,24,31,0,0,0,0,0,0,24,24,24,24,24,24,24,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,24,24,24,24,24,24,24,24,24,24,24,24,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,255,0,0,0,0,0,0,24,24,24,24,24,24,24,255,24,24,24,24,24,24,24,24,24,24,24,31,24,31,24,24,24,24,24,24,54,54,54,54,54,54,54,55,54,54,54,54,54,54,54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54,54,54,54,55,48,55,54,54,54,54,54,54,0,0,0,0,0,255,0,255,0,0,0,0,0,0,54,54,54,54,54,247,0,247,54,54,54,54,54,54,24,24,24,24,24,255,0,255,0,0,0,0,0,0,54,54,54,54,54,54,54,255,0,0,0,0,0,0,0,0,0,0,0,255,0,255,24,24,24,24,24,24,0,0,0,0,0,0,0,255,54,54,54,54,54,54,54,54,54,54,54,54,54,63,0,0,0,0,0,0,24,24,24,24,24,31,24,31,0,0,0,0,0,0,0,0,0,0,0,31,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,63,54,54,54,54,54,54,54,54,54,54,54,54,54,255,54,54,54,54,54,54,24,24,24,24,24,255,24,255,24,24,24,24,24,24,24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,31,24,24,24,24,24,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,118,220,216,216,220,118,0,0,0,0,0,0,0,124,198,252,198,198,252,192,192,64,0,0,0,254,198,198,192,192,192,192,192,192,0,0,0,0,0,0,0,254,108,108,108,108,108,108,0,0,0,0,0,254,198,96,48,24,48,96,198,254,0,0,0,0,0,0,0,0,126,216,216,216,216,112,0,0,0,0,0,0,0,102,102,102,102,124,96,96,192,0,0,0,0,0,0,118,220,24,24,24,24,24,0,0,0,0,0,126,24,60,102,102,102,60,24,126,0,0,0,0,0,56,108,198,198,254,198,198,108,56,0,0,0,0,0,56,108,198,198,198,108,108,108,238,0,0,0,0,0,30,48,24,12,62,102,102,102,60,0,0,0,0,0,0,0,0,126,219,219,126,0,0,0,0,0,0,0,3,6,126,219,219,243,126,96,192,0,0,0,0,0,28,48,96,96,124,96,96,48,28,0,0,0,0,0,0,124,198,198,198,198,198,198,198,0,0,0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,216,216,112,0,0,0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0,56,108,108,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,15,12,12,12,12,12,236,108,60,28,0,0,0,0,216,108,108,108,108,108,0,0,0,0,0,0,0,0,112,216,48,96,200,248,0,0,0,0,0,0,0,0,0,0,0,124,124,124,124,124,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),DT=new Uint8Array([0,0,0,0,0,42,0,42,0,0,42,42,42,0,0,42,0,42,42,21,0,42,42,42,21,21,21,21,21,63,21,63,21,21,63,63,63,21,21,63,21,63,63,63,21,63,63,63]);var Rm=typeof Cs=="object"&&Cs&&Cs.Object===Object&&Cs,$T=typeof self=="object"&&self&&self.Object===Object&&self,Fr=Rm||$T||Function("return this")(),tr=Fr.Symbol,Im=Object.prototype,jT=Im.hasOwnProperty,zT=Im.toString,Go=tr?tr.toStringTag:void 0;function WT(e){var t=jT.call(e,Go),n=e[Go];try{e[Go]=void 0;var r=!0}catch{}var i=zT.call(e);return r&&(t?e[Go]=n:delete e[Go]),i}var KT=Object.prototype,GT=KT.toString;function HT(e){return GT.call(e)}var YT="[object Null]",VT="[object Undefined]",Om=tr?tr.toStringTag:void 0;function Bi(e){return e==null?e===void 0?VT:YT:Om&&Om in Object(e)?WT(e):HT(e)}function hr(e){return e!=null&&typeof e=="object"}var XT="[object Symbol]";function Sc(e){return typeof e=="symbol"||hr(e)&&Bi(e)==XT}function Rc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var Qt=Array.isArray,qT=1/0,Nm=tr?tr.prototype:void 0,Cm=Nm?Nm.toString:void 0;function Lm(e){if(typeof e=="string")return e;if(Qt(e))return Rc(e,Lm)+"";if(Sc(e))return Cm?Cm.call(e):"";var t=e+"";return t=="0"&&1/e==-qT?"-0":t}var JT=/\s/;function ZT(e){for(var t=e.length;t--&&JT.test(e.charAt(t)););return t}var QT=/^\s+/;function tA(e){return e&&e.slice(0,ZT(e)+1).replace(QT,"")}function er(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Mm=NaN,eA=/^[-+]0x[0-9a-f]+$/i,nA=/^0b[01]+$/i,rA=/^0o[0-7]+$/i,iA=parseInt;function sA(e){if(typeof e=="number")return e;if(Sc(e))return Mm;if(er(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=er(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=tA(e);var n=nA.test(e);return n||rA.test(e)?iA(e.slice(2),n?2:8):eA.test(e)?Mm:+e}var Um=1/0,oA=17976931348623157e292;function aA(e){if(!e)return e===0?e:0;if(e=sA(e),e===Um||e===-Um){var t=e<0?-1:1;return t*oA}return e===e?e:0}function Ic(e){var t=aA(e),n=t%1;return t===t?n?t-n:t:0}function Js(e){return e}var cA="[object AsyncFunction]",lA="[object Function]",uA="[object GeneratorFunction]",hA="[object Proxy]";function fi(e){if(!er(e))return!1;var t=Bi(e);return t==lA||t==uA||t==cA||t==hA}var lh=Fr["__core-js_shared__"],Fm=function(){var e=/[^.]+$/.exec(lh&&lh.keys&&lh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function fA(e){return!!Fm&&Fm in e}var dA=Function.prototype,pA=dA.toString;function ss(e){if(e!=null){try{return pA.call(e)}catch{}try{return e+""}catch{}}return""}var mA=/[\\^$.*+?()[\]{}|]/g,gA=/^\[object .+?Constructor\]$/,yA=Function.prototype,_A=Object.prototype,bA=yA.toString,EA=_A.hasOwnProperty,wA=RegExp("^"+bA.call(EA).replace(mA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function kA(e){if(!er(e)||fA(e))return!1;var t=fi(e)?wA:gA;return t.test(ss(e))}function xA(e,t){return e==null?void 0:e[t]}function os(e,t){var n=xA(e,t);return kA(n)?n:void 0}var uh=os(Fr,"WeakMap"),Bm=Object.create,TA=function(){function e(){}return function(t){if(!er(t))return{};if(Bm)return Bm(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function AA(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function We(){}function vA(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var SA=800,RA=16,IA=Date.now;function OA(e){var t=0,n=0;return function(){var r=IA(),i=RA-(r-n);if(n=r,i>0){if(++t>=SA)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function NA(e){return function(){return e}}var Oc=function(){try{var e=os(Object,"defineProperty");return e({},"",{}),e}catch{}}(),CA=Oc?function(e,t){return Oc(e,"toString",{configurable:!0,enumerable:!1,value:NA(t),writable:!0})}:Js,LA=OA(CA);function Pm(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Dm(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function MA(e){return e!==e}function UA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function hh(e,t,n){return t===t?UA(e,t,n):Dm(e,MA,n)}function $m(e,t){var n=e==null?0:e.length;return!!n&&hh(e,t,0)>-1}var FA=9007199254740991,BA=/^(?:0|[1-9]\d*)$/;function Nc(e,t){var n=typeof e;return t=t??FA,!!t&&(n=="number"||n!="symbol"&&BA.test(e))&&e>-1&&e%1==0&&e<t}function fh(e,t,n){t=="__proto__"&&Oc?Oc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Ho(e,t){return e===t||e!==e&&t!==t}var PA=Object.prototype,DA=PA.hasOwnProperty;function Cc(e,t,n){var r=e[t];(!(DA.call(e,t)&&Ho(r,n))||n===void 0&&!(t in e))&&fh(e,t,n)}function dh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?fh(n,a,c):Cc(n,a,c)}return n}var jm=Math.max;function $A(e,t,n){return t=jm(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=jm(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),AA(e,this,a)}}function ph(e,t){return LA($A(e,t,Js),e+"")}var jA=9007199254740991;function mh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=jA}function Br(e){return e!=null&&mh(e.length)&&!fi(e)}function zm(e,t,n){if(!er(n))return!1;var r=typeof t;return(r=="number"?Br(n)&&Nc(t,n.length):r=="string"&&t in n)?Ho(n[t],e):!1}function zA(e){return ph(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&zm(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var WA=Object.prototype;function Yo(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||WA;return e===n}function KA(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var GA="[object Arguments]";function Wm(e){return hr(e)&&Bi(e)==GA}var Km=Object.prototype,HA=Km.hasOwnProperty,YA=Km.propertyIsEnumerable,Lc=Wm(function(){return arguments}())?Wm:function(e){return hr(e)&&HA.call(e,"callee")&&!YA.call(e,"callee")};function VA(){return!1}var Gm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Hm=Gm&&typeof module=="object"&&module&&!module.nodeType&&module,XA=Hm&&Hm.exports===Gm,Ym=XA?Fr.Buffer:void 0,qA=Ym?Ym.isBuffer:void 0,Vo=qA||VA,JA="[object Arguments]",ZA="[object Array]",QA="[object Boolean]",tv="[object Date]",ev="[object Error]",nv="[object Function]",rv="[object Map]",iv="[object Number]",sv="[object Object]",ov="[object RegExp]",av="[object Set]",cv="[object String]",lv="[object WeakMap]",uv="[object ArrayBuffer]",hv="[object DataView]",fv="[object Float32Array]",dv="[object Float64Array]",pv="[object Int8Array]",mv="[object Int16Array]",gv="[object Int32Array]",yv="[object Uint8Array]",_v="[object Uint8ClampedArray]",bv="[object Uint16Array]",Ev="[object Uint32Array]",_e={};_e[fv]=_e[dv]=_e[pv]=_e[mv]=_e[gv]=_e[yv]=_e[_v]=_e[bv]=_e[Ev]=!0,_e[JA]=_e[ZA]=_e[uv]=_e[QA]=_e[hv]=_e[tv]=_e[ev]=_e[nv]=_e[rv]=_e[iv]=_e[sv]=_e[ov]=_e[av]=_e[cv]=_e[lv]=!1;function wv(e){return hr(e)&&mh(e.length)&&!!_e[Bi(e)]}function Mc(e){return function(t){return e(t)}}var Vm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Xo=Vm&&typeof module=="object"&&module&&!module.nodeType&&module,kv=Xo&&Xo.exports===Vm,gh=kv&&Rm.process,Pi=function(){try{var e=Xo&&Xo.require&&Xo.require("util").types;return e||gh&&gh.binding&&gh.binding("util")}catch{}}(),Xm=Pi&&Pi.isTypedArray,yh=Xm?Mc(Xm):wv,xv=Object.prototype,Tv=xv.hasOwnProperty;function qm(e,t){var n=Qt(e),r=!n&&Lc(e),i=!n&&!r&&Vo(e),s=!n&&!r&&!i&&yh(e),o=n||r||i||s,a=o?KA(e.length,String):[],c=a.length;for(var u in e)(t||Tv.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Nc(u,c)))&&a.push(u);return a}function Jm(e,t){return function(n){return e(t(n))}}var Av=Jm(Object.keys,Object),vv=Object.prototype,Sv=vv.hasOwnProperty;function Zm(e){if(!Yo(e))return Av(e);var t=[];for(var n in Object(e))Sv.call(e,n)&&n!="constructor"&&t.push(n);return t}function nr(e){return Br(e)?qm(e):Zm(e)}var Rv=Object.prototype,Iv=Rv.hasOwnProperty,An=zA(function(e,t){if(Yo(t)||Br(t)){dh(t,nr(t),e);return}for(var n in t)Iv.call(t,n)&&Cc(e,n,t[n])});function Ov(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var Nv=Object.prototype,Cv=Nv.hasOwnProperty;function Lv(e){if(!er(e))return Ov(e);var t=Yo(e),n=[];for(var r in e)r=="constructor"&&(t||!Cv.call(e,r))||n.push(r);return n}function Qm(e){return Br(e)?qm(e,!0):Lv(e)}var Mv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Uv=/^\w*$/;function _h(e,t){if(Qt(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Sc(e)?!0:Uv.test(e)||!Mv.test(e)||t!=null&&e in Object(t)}var qo=os(Object,"create");function Fv(){this.__data__=qo?qo(null):{},this.size=0}function Bv(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Pv="__lodash_hash_undefined__",Dv=Object.prototype,$v=Dv.hasOwnProperty;function jv(e){var t=this.__data__;if(qo){var n=t[e];return n===Pv?void 0:n}return $v.call(t,e)?t[e]:void 0}var zv=Object.prototype,Wv=zv.hasOwnProperty;function Kv(e){var t=this.__data__;return qo?t[e]!==void 0:Wv.call(t,e)}var Gv="__lodash_hash_undefined__";function Hv(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=qo&&t===void 0?Gv:t,this}function as(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}as.prototype.clear=Fv,as.prototype.delete=Bv,as.prototype.get=jv,as.prototype.has=Kv,as.prototype.set=Hv;function Yv(){this.__data__=[],this.size=0}function Uc(e,t){for(var n=e.length;n--;)if(Ho(e[n][0],t))return n;return-1}var Vv=Array.prototype,Xv=Vv.splice;function qv(e){var t=this.__data__,n=Uc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():Xv.call(t,n,1),--this.size,!0}function Jv(e){var t=this.__data__,n=Uc(t,e);return n<0?void 0:t[n][1]}function Zv(e){return Uc(this.__data__,e)>-1}function Qv(e,t){var n=this.__data__,r=Uc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function di(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}di.prototype.clear=Yv,di.prototype.delete=qv,di.prototype.get=Jv,di.prototype.has=Zv,di.prototype.set=Qv;var Jo=os(Fr,"Map");function t2(){this.size=0,this.__data__={hash:new as,map:new(Jo||di),string:new as}}function e2(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Fc(e,t){var n=e.__data__;return e2(t)?n[typeof t=="string"?"string":"hash"]:n.map}function n2(e){var t=Fc(this,e).delete(e);return this.size-=t?1:0,t}function r2(e){return Fc(this,e).get(e)}function i2(e){return Fc(this,e).has(e)}function s2(e,t){var n=Fc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function pi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}pi.prototype.clear=t2,pi.prototype.delete=n2,pi.prototype.get=r2,pi.prototype.has=i2,pi.prototype.set=s2;var o2="Expected a function";function bh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(o2);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(bh.Cache||pi),n}bh.Cache=pi;var a2=500;function c2(e){var t=bh(e,function(r){return n.size===a2&&n.clear(),r}),n=t.cache;return t}var l2=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u2=/\\(\\)?/g,h2=c2(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(l2,function(n,r,i,s){t.push(i?s.replace(u2,"$1"):r||n)}),t});function tg(e){return e==null?"":Lm(e)}function Bc(e,t){return Qt(e)?e:_h(e,t)?[e]:h2(tg(e))}var f2=1/0;function Zo(e){if(typeof e=="string"||Sc(e))return e;var t=e+"";return t=="0"&&1/e==-f2?"-0":t}function Eh(e,t){t=Bc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Zo(t[n++])];return n&&n==r?e:void 0}function d2(e,t,n){var r=e==null?void 0:Eh(e,t);return r===void 0?n:r}function wh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var eg=tr?tr.isConcatSpreadable:void 0;function p2(e){return Qt(e)||Lc(e)||!!(eg&&e&&e[eg])}function kh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=p2),i||(i=[]);++s<o;){var a=e[s];n(a)?wh(i,a):r||(i[i.length]=a)}return i}function Dn(e){var t=e==null?0:e.length;return t?kh(e):[]}var ng=Jm(Object.getPrototypeOf,Object);function xh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function m2(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:xh(e,t,n)}var g2="\\ud800-\\udfff",y2="\\u0300-\\u036f",_2="\\ufe20-\\ufe2f",b2="\\u20d0-\\u20ff",E2=y2+_2+b2,w2="\\ufe0e\\ufe0f",k2="\\u200d",x2=RegExp("["+k2+g2+E2+w2+"]");function rg(e){return x2.test(e)}function T2(e){return e.split("")}var ig="\\ud800-\\udfff",A2="\\u0300-\\u036f",v2="\\ufe20-\\ufe2f",S2="\\u20d0-\\u20ff",R2=A2+v2+S2,I2="\\ufe0e\\ufe0f",O2="["+ig+"]",Th="["+R2+"]",Ah="\\ud83c[\\udffb-\\udfff]",N2="(?:"+Th+"|"+Ah+")",sg="[^"+ig+"]",og="(?:\\ud83c[\\udde6-\\uddff]){2}",ag="[\\ud800-\\udbff][\\udc00-\\udfff]",C2="\\u200d",cg=N2+"?",lg="["+I2+"]?",L2="(?:"+C2+"(?:"+[sg,og,ag].join("|")+")"+lg+cg+")*",M2=lg+cg+L2,U2="(?:"+[sg+Th+"?",Th,og,ag,O2].join("|")+")",F2=RegExp(Ah+"(?="+Ah+")|"+U2+M2,"g");function B2(e){return e.match(F2)||[]}function P2(e){return rg(e)?B2(e):T2(e)}function D2(e){return function(t){t=tg(t);var n=rg(t)?P2(t):void 0,r=n?n[0]:t.charAt(0),i=n?m2(n,1).join(""):t.slice(1);return r[e]()+i}}var ug=D2("toUpperCase");function $2(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function j2(){this.__data__=new di,this.size=0}function z2(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function W2(e){return this.__data__.get(e)}function K2(e){return this.__data__.has(e)}var G2=200;function H2(e,t){var n=this.__data__;if(n instanceof di){var r=n.__data__;if(!Jo||r.length<G2-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new pi(r)}return n.set(e,t),this.size=n.size,this}function Pr(e){var t=this.__data__=new di(e);this.size=t.size}Pr.prototype.clear=j2,Pr.prototype.delete=z2,Pr.prototype.get=W2,Pr.prototype.has=K2,Pr.prototype.set=H2;function Y2(e,t){return e&&dh(t,nr(t),e)}var hg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fg=hg&&typeof module=="object"&&module&&!module.nodeType&&module,V2=fg&&fg.exports===hg,dg=V2?Fr.Buffer:void 0,pg=dg?dg.allocUnsafe:void 0;function X2(e,t){var n=e.length,r=pg?pg(n):new e.constructor(n);return e.copy(r),r}function vh(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function mg(){return[]}var q2=Object.prototype,J2=q2.propertyIsEnumerable,gg=Object.getOwnPropertySymbols,Sh=gg?function(e){return e==null?[]:(e=Object(e),vh(gg(e),function(t){return J2.call(e,t)}))}:mg;function Z2(e,t){return dh(e,Sh(e),t)}var Q2=Object.getOwnPropertySymbols,tS=Q2?function(e){for(var t=[];e;)wh(t,Sh(e)),e=ng(e);return t}:mg;function yg(e,t,n){var r=t(e);return Qt(e)?r:wh(r,n(e))}function Rh(e){return yg(e,nr,Sh)}function eS(e){return yg(e,Qm,tS)}var Ih=os(Fr,"DataView"),Oh=os(Fr,"Promise"),Zs=os(Fr,"Set"),_g="[object Map]",nS="[object Object]",bg="[object Promise]",Eg="[object Set]",wg="[object WeakMap]",kg="[object DataView]",rS=ss(Ih),iS=ss(Jo),sS=ss(Oh),oS=ss(Zs),aS=ss(uh),rr=Bi;(Ih&&rr(new Ih(new ArrayBuffer(1)))!=kg||Jo&&rr(new Jo)!=_g||Oh&&rr(Oh.resolve())!=bg||Zs&&rr(new Zs)!=Eg||uh&&rr(new uh)!=wg)&&(rr=function(e){var t=Bi(e),n=t==nS?e.constructor:void 0,r=n?ss(n):"";if(r)switch(r){case rS:return kg;case iS:return _g;case sS:return bg;case oS:return Eg;case aS:return wg}return t});var cS=Object.prototype,lS=cS.hasOwnProperty;function uS(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&lS.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Pc=Fr.Uint8Array;function hS(e){var t=new e.constructor(e.byteLength);return new Pc(t).set(new Pc(e)),t}function fS(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var dS=/\w*$/;function pS(e){var t=new e.constructor(e.source,dS.exec(e));return t.lastIndex=e.lastIndex,t}var xg=tr?tr.prototype:void 0,Tg=xg?xg.valueOf:void 0;function mS(e){return Tg?Object(Tg.call(e)):{}}function gS(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var yS="[object Boolean]",_S="[object Date]",bS="[object Map]",ES="[object Number]",wS="[object RegExp]",kS="[object Set]",xS="[object String]",TS="[object Symbol]",AS="[object ArrayBuffer]",vS="[object DataView]",SS="[object Float32Array]",RS="[object Float64Array]",IS="[object Int8Array]",OS="[object Int16Array]",NS="[object Int32Array]",CS="[object Uint8Array]",LS="[object Uint8ClampedArray]",MS="[object Uint16Array]",US="[object Uint32Array]";function FS(e,t,n){var r=e.constructor;switch(t){case AS:return hS(e);case yS:case _S:return new r(+e);case vS:return fS(e);case SS:case RS:case IS:case OS:case NS:case CS:case LS:case MS:case US:return gS(e);case bS:return new r;case ES:case xS:return new r(e);case wS:return pS(e);case kS:return new r;case TS:return mS(e)}}function BS(e){return typeof e.constructor=="function"&&!Yo(e)?TA(ng(e)):{}}var PS="[object Map]";function DS(e){return hr(e)&&rr(e)==PS}var Ag=Pi&&Pi.isMap,$S=Ag?Mc(Ag):DS,jS="[object Set]";function zS(e){return hr(e)&&rr(e)==jS}var vg=Pi&&Pi.isSet,WS=vg?Mc(vg):zS,Sg="[object Arguments]",KS="[object Array]",GS="[object Boolean]",HS="[object Date]",YS="[object Error]",Rg="[object Function]",VS="[object GeneratorFunction]",XS="[object Map]",qS="[object Number]",Ig="[object Object]",JS="[object RegExp]",ZS="[object Set]",QS="[object String]",tR="[object Symbol]",eR="[object WeakMap]",nR="[object ArrayBuffer]",rR="[object DataView]",iR="[object Float32Array]",sR="[object Float64Array]",oR="[object Int8Array]",aR="[object Int16Array]",cR="[object Int32Array]",lR="[object Uint8Array]",uR="[object Uint8ClampedArray]",hR="[object Uint16Array]",fR="[object Uint32Array]",de={};de[Sg]=de[KS]=de[nR]=de[rR]=de[GS]=de[HS]=de[iR]=de[sR]=de[oR]=de[aR]=de[cR]=de[XS]=de[qS]=de[Ig]=de[JS]=de[ZS]=de[QS]=de[tR]=de[lR]=de[uR]=de[hR]=de[fR]=!0,de[YS]=de[Rg]=de[eR]=!1;function Dc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!er(e))return e;var a=Qt(e);if(a)return o=uS(e),vA(e,o);var c=rr(e),u=c==Rg||c==VS;if(Vo(e))return X2(e);if(c==Ig||c==Sg||u&&!i)return o=u?{}:BS(e),Z2(e,Y2(o,e));if(!de[c])return i?e:{};o=FS(e,c),s||(s=new Pr);var l=s.get(e);if(l)return l;s.set(e,o),WS(e)?e.forEach(function(d){o.add(Dc(d,t,n,d,e,s))}):$S(e)&&e.forEach(function(d,p){o.set(p,Dc(d,t,n,p,e,s))});var h=Rh,f=a?void 0:h(e);return Pm(f||e,function(d,p){f&&(p=d,d=e[p]),Cc(o,p,Dc(d,t,n,p,e,s))}),o}var dR=4;function nn(e){return Dc(e,dR)}function Qo(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var pR="__lodash_hash_undefined__";function mR(e){return this.__data__.set(e,pR),this}function gR(e){return this.__data__.has(e)}function Qs(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new pi;++t<n;)this.add(e[t])}Qs.prototype.add=Qs.prototype.push=mR,Qs.prototype.has=gR;function Og(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Nh(e,t){return e.has(t)}var yR=1,_R=2;function Ng(e,t,n,r,i,s){var o=n&yR,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var h=-1,f=!0,d=n&_R?new Qs:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],m=t[h];if(r)var w=o?r(m,p,h,t,e,s):r(p,m,h,e,t,s);if(w!==void 0){if(w)continue;f=!1;break}if(d){if(!Og(t,function(E,x){if(!Nh(d,x)&&(p===E||i(p,E,n,r,s)))return d.push(x)})){f=!1;break}}else if(!(p===m||i(p,m,n,r,s))){f=!1;break}}return s.delete(e),s.delete(t),f}function bR(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Ch(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var ER=1,wR=2,kR="[object Boolean]",xR="[object Date]",TR="[object Error]",AR="[object Map]",vR="[object Number]",SR="[object RegExp]",RR="[object Set]",IR="[object String]",OR="[object Symbol]",NR="[object ArrayBuffer]",CR="[object DataView]",Cg=tr?tr.prototype:void 0,Lh=Cg?Cg.valueOf:void 0;function LR(e,t,n,r,i,s,o){switch(n){case CR:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case NR:return!(e.byteLength!=t.byteLength||!s(new Pc(e),new Pc(t)));case kR:case xR:case vR:return Ho(+e,+t);case TR:return e.name==t.name&&e.message==t.message;case SR:case IR:return e==t+"";case AR:var a=bR;case RR:var c=r&ER;if(a||(a=Ch),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=wR,o.set(e,t);var l=Ng(a(e),a(t),r,i,s,o);return o.delete(e),l;case OR:if(Lh)return Lh.call(e)==Lh.call(t)}return!1}var MR=1,UR=Object.prototype,FR=UR.hasOwnProperty;function BR(e,t,n,r,i,s){var o=n&MR,a=Rh(e),c=a.length,u=Rh(t),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var f=a[h];if(!(o?f in t:FR.call(t,f)))return!1}var d=s.get(e),p=s.get(t);if(d&&p)return d==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var w=o;++h<c;){f=a[h];var E=e[f],x=t[f];if(r)var A=o?r(x,E,f,t,e,s):r(E,x,f,e,t,s);if(!(A===void 0?E===x||i(E,x,n,r,s):A)){m=!1;break}w||(w=f=="constructor")}if(m&&!w){var I=e.constructor,U=t.constructor;I!=U&&"constructor"in e&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof U=="function"&&U instanceof U)&&(m=!1)}return s.delete(e),s.delete(t),m}var PR=1,Lg="[object Arguments]",Mg="[object Array]",$c="[object Object]",DR=Object.prototype,Ug=DR.hasOwnProperty;function $R(e,t,n,r,i,s){var o=Qt(e),a=Qt(t),c=o?Mg:rr(e),u=a?Mg:rr(t);c=c==Lg?$c:c,u=u==Lg?$c:u;var l=c==$c,h=u==$c,f=c==u;if(f&&Vo(e)){if(!Vo(t))return!1;o=!0,l=!1}if(f&&!l)return s||(s=new Pr),o||yh(e)?Ng(e,t,n,r,i,s):LR(e,t,c,n,r,i,s);if(!(n&PR)){var d=l&&Ug.call(e,"__wrapped__"),p=h&&Ug.call(t,"__wrapped__");if(d||p){var m=d?e.value():e,w=p?t.value():t;return s||(s=new Pr),i(m,w,n,r,s)}}return f?(s||(s=new Pr),BR(e,t,n,r,i,s)):!1}function Mh(e,t,n,r,i){return e===t?!0:e==null||t==null||!hr(e)&&!hr(t)?e!==e&&t!==t:$R(e,t,n,r,Mh,i)}var jR=1,zR=2;function WR(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],u=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var l=new Pr,h;if(!(h===void 0?Mh(u,c,jR|zR,r,l):h))return!1}}return!0}function Fg(e){return e===e&&!er(e)}function KR(e){for(var t=nr(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Fg(i)]}return t}function Bg(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function GR(e){var t=KR(e);return t.length==1&&t[0][2]?Bg(t[0][0],t[0][1]):function(n){return n===e||WR(n,e,t)}}function HR(e,t){return e!=null&&t in Object(e)}function Pg(e,t,n){t=Bc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=Zo(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&mh(i)&&Nc(o,i)&&(Qt(e)||Lc(e)))}function YR(e,t){return e!=null&&Pg(e,t,HR)}var VR=1,XR=2;function qR(e,t){return _h(e)&&Fg(t)?Bg(Zo(e),t):function(n){var r=d2(n,e);return r===void 0&&r===t?YR(n,e):Mh(t,r,VR|XR)}}function JR(e){return function(t){return t==null?void 0:t[e]}}function ZR(e){return function(t){return Eh(t,e)}}function QR(e){return _h(e)?JR(Zo(e)):ZR(e)}function Dr(e){return typeof e=="function"?e:e==null?Js:typeof e=="object"?Qt(e)?qR(e[0],e[1]):GR(e):QR(e)}function tI(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function eI(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var nI=eI();function rI(e,t){return e&&nI(e,t,nr)}function iI(e,t){return function(n,r){if(n==null)return n;if(!Br(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var cs=iI(rI);function sI(e,t,n,r){return cs(e,function(i,s,o){t(r,i,n(i),o)}),r}function oI(e,t){return function(n,r){var i=Qt(n)?tI:sI,s=t?t():{};return i(n,e,Dr(r),s)}}var Dg=Object.prototype,aI=Dg.hasOwnProperty,Uh=ph(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&zm(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Qm(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||Ho(l,Dg[u])&&!aI.call(e,u))&&(e[u]=s[u])}return e});function $g(e){return hr(e)&&Br(e)}var cI=200;function lI(e,t,n,r){var i=-1,s=$m,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;t.length>=cI&&(s=Nh,o=!1,t=new Qs(t));t:for(;++i<a;){var l=e[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=u;f--;)if(t[f]===h)continue t;c.push(l)}else s(t,h,r)||c.push(l)}return c}var jc=ph(function(e,t){return $g(e)?lI(e,kh(t,1,$g,!0)):[]});function to(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function rn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Ic(t),xh(e,t<0?0:t,r)):[]}function ta(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Ic(t),t=r-t,xh(e,0,t<0?0:t)):[]}function uI(e){return typeof e=="function"?e:Js}function It(e,t){var n=Qt(e)?Pm:cs;return n(e,uI(t))}function hI(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function fI(e,t){var n=!0;return cs(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function fr(e,t,n){var r=Qt(e)?hI:fI;return r(e,Dr(t))}function jg(e,t){var n=[];return cs(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function ir(e,t){var n=Qt(e)?vh:jg;return n(e,Dr(t))}function dI(e){return function(t,n,r){var i=Object(t);if(!Br(t)){var s=Dr(n);t=nr(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var pI=Math.max;function mI(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Ic(n);return i<0&&(i=pI(r+i,0)),Dm(e,Dr(t),i)}var eo=dI(mI);function dr(e){return e&&e.length?e[0]:void 0}function gI(e,t){var n=-1,r=Br(e)?Array(e.length):[];return cs(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function kt(e,t){var n=Qt(e)?Rc:gI;return n(e,Dr(t))}function sr(e,t){return kh(kt(e,t))}var yI=Object.prototype,_I=yI.hasOwnProperty,zg=oI(function(e,t,n){_I.call(e,n)?e[n].push(t):fh(e,n,[t])}),bI=Object.prototype,EI=bI.hasOwnProperty;function wI(e,t){return e!=null&&EI.call(e,t)}function Rt(e,t){return e!=null&&Pg(e,t,wI)}var kI="[object String]";function vn(e){return typeof e=="string"||!Qt(e)&&hr(e)&&Bi(e)==kI}function xI(e,t){return Rc(t,function(n){return e[n]})}function Be(e){return e==null?[]:xI(e,nr(e))}var TI=Math.max;function yn(e,t,n,r){e=Br(e)?e:Be(e),n=n&&!r?Ic(n):0;var i=e.length;return n<0&&(n=TI(i+n,0)),vn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&hh(e,t,n)>-1}function Wg(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return hh(e,t,i)}var AI="[object Map]",vI="[object Set]",SI=Object.prototype,RI=SI.hasOwnProperty;function pe(e){if(e==null)return!0;if(Br(e)&&(Qt(e)||typeof e=="string"||typeof e.splice=="function"||Vo(e)||yh(e)||Lc(e)))return!e.length;var t=rr(e);if(t==AI||t==vI)return!e.size;if(Yo(e))return!Zm(e).length;for(var n in e)if(RI.call(e,n))return!1;return!0}var II="[object RegExp]";function OI(e){return hr(e)&&Bi(e)==II}var Kg=Pi&&Pi.isRegExp,mi=Kg?Mc(Kg):OI;function gi(e){return e===void 0}var NI="Expected a function";function CI(e){if(typeof e!="function")throw new TypeError(NI);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function LI(e,t,n,r){if(!er(e))return e;t=Bc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=Zo(t[i]),u=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=er(l)?l:Nc(t[i+1])?[]:{})}Cc(a,c,u),a=a[c]}return e}function MI(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Eh(e,o);n(a,o)&&LI(s,Bc(o,e),a)}return s}function pr(e,t){if(e==null)return{};var n=Rc(eS(e),function(r){return[r]});return t=Dr(t),MI(e,n,function(r,i){return t(r,i[0])})}function UI(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Sn(e,t,n){var r=Qt(e)?$2:UI,i=arguments.length<3;return r(e,Dr(t),n,i,cs)}function zc(e,t){var n=Qt(e)?vh:jg;return n(e,CI(Dr(t)))}function FI(e,t){var n;return cs(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function Fh(e,t,n){var r=Qt(e)?Og:FI;return r(e,Dr(t))}var BI=1/0,PI=Zs&&1/Ch(new Zs([,-0]))[1]==BI?function(e){return new Zs(e)}:We,DI=200;function $I(e,t,n){var r=-1,i=$m,s=e.length,o=!0,a=[],c=a;if(s>=DI){var u=PI(e);if(u)return Ch(u);o=!1,i=Nh,c=new Qs}else c=a;t:for(;++r<s;){var l=e[r],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=c.length;f--;)if(c[f]===h)continue t;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}function Wc(e){return e&&e.length?$I(e):[]}function Bh(e){console&&console.error&&console.error(`Error: ${e}`)}function Gg(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function Hg(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function Yg(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function jI(e){return zI(e)?e.LABEL:e.name}function zI(e){return vn(e.LABEL)&&e.LABEL!==""}class $r{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),It(this.definition,n=>{n.accept(t)})}}class Rn extends $r{constructor(t){super([]),this.idx=1,An(this,pr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class no extends $r{constructor(t){super(t.definition),this.orgText="",An(this,pr(t,n=>n!==void 0))}}class In extends $r{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,An(this,pr(t,n=>n!==void 0))}}class On extends $r{constructor(t){super(t.definition),this.idx=1,An(this,pr(t,n=>n!==void 0))}}class jr extends $r{constructor(t){super(t.definition),this.idx=1,An(this,pr(t,n=>n!==void 0))}}class zr extends $r{constructor(t){super(t.definition),this.idx=1,An(this,pr(t,n=>n!==void 0))}}class Ke extends $r{constructor(t){super(t.definition),this.idx=1,An(this,pr(t,n=>n!==void 0))}}class mr extends $r{constructor(t){super(t.definition),this.idx=1,An(this,pr(t,n=>n!==void 0))}}class gr extends $r{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,An(this,pr(t,n=>n!==void 0))}}class Ae{constructor(t){this.idx=1,An(this,pr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function WI(e){return kt(e,Kc)}function Kc(e){function t(n){return kt(n,Kc)}if(e instanceof Rn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return vn(e.label)&&(n.label=e.label),n}else{if(e instanceof In)return{type:"Alternative",definition:t(e.definition)};if(e instanceof On)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof jr)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof zr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Kc(new Ae({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof mr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Kc(new Ae({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Ke)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof gr)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Ae){const n={type:"Terminal",name:e.terminalType.name,label:jI(e.terminalType),idx:e.idx};vn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=mi(r)?r.source:r),n}else{if(e instanceof no)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class ls{visit(t){const n=t;switch(n.constructor){case Rn:return this.visitNonTerminal(n);case In:return this.visitAlternative(n);case On:return this.visitOption(n);case jr:return this.visitRepetitionMandatory(n);case zr:return this.visitRepetitionMandatoryWithSeparator(n);case mr:return this.visitRepetitionWithSeparator(n);case Ke:return this.visitRepetition(n);case gr:return this.visitAlternation(n);case Ae:return this.visitTerminal(n);case no:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function KI(e){return e instanceof In||e instanceof On||e instanceof Ke||e instanceof jr||e instanceof zr||e instanceof mr||e instanceof Ae||e instanceof no}function Gc(e,t=[]){return e instanceof On||e instanceof Ke||e instanceof mr?!0:e instanceof gr?Fh(e.definition,r=>Gc(r,t)):e instanceof Rn&&yn(t,e)?!1:e instanceof $r?(e instanceof Rn&&t.push(e),fr(e.definition,r=>Gc(r,t))):!1}function GI(e){return e instanceof gr}function Wr(e){if(e instanceof Rn)return"SUBRULE";if(e instanceof On)return"OPTION";if(e instanceof gr)return"OR";if(e instanceof jr)return"AT_LEAST_ONE";if(e instanceof zr)return"AT_LEAST_ONE_SEP";if(e instanceof mr)return"MANY_SEP";if(e instanceof Ke)return"MANY";if(e instanceof Ae)return"CONSUME";throw Error("non exhaustive match")}class Hc{walk(t,n=[]){It(t.definition,(r,i)=>{const s=rn(t.definition,i+1);if(r instanceof Rn)this.walkProdRef(r,s,n);else if(r instanceof Ae)this.walkTerminal(r,s,n);else if(r instanceof In)this.walkFlat(r,s,n);else if(r instanceof On)this.walkOption(r,s,n);else if(r instanceof jr)this.walkAtLeastOne(r,s,n);else if(r instanceof zr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof mr)this.walkManySep(r,s,n);else if(r instanceof Ke)this.walkMany(r,s,n);else if(r instanceof gr)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new On({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=Vg(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new On({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=Vg(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);It(t.definition,s=>{const o=new In({definition:[s]});this.walk(o,i)})}}function Vg(e,t,n){return[new On({definition:[new Ae({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function ea(e){if(e instanceof Rn)return ea(e.referencedRule);if(e instanceof Ae)return VI(e);if(KI(e))return HI(e);if(GI(e))return YI(e);throw Error("non exhaustive match")}function HI(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Gc(s),t=t.concat(ea(s)),r=r+1,i=n.length>r;return Wc(t)}function YI(e){const t=kt(e.definition,n=>ea(n));return Wc(Dn(t))}function VI(e){return[e.terminalType]}const Xg="_~IN~_";class XI extends Hc{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=JI(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new In({definition:s}),a=ea(o);this.follows[i]=a}}function qI(e){const t={};return It(e,n=>{const r=new XI(n).startWalking();An(t,r)}),t}function JI(e,t){return e.name+t+Xg}function Ot(e){return e.charCodeAt(0)}function Ph(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function na(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function ro(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function ZI(){throw Error("Internal Error - Should never get here!")}function qg(e){return e.type==="Character"}const Yc=[];for(let e=Ot("0");e<=Ot("9");e++)Yc.push(e);const Vc=[Ot("_")].concat(Yc);for(let e=Ot("a");e<=Ot("z");e++)Vc.push(e);for(let e=Ot("A");e<=Ot("Z");e++)Vc.push(e);const Jg=[Ot(" "),Ot("\f"),Ot(`
`),Ot("\r"),Ot("	"),Ot("\v"),Ot("	"),Ot(" "),Ot(" "),Ot(" "),Ot(" "),Ot(" "),Ot(" "),Ot(" "),Ot(" "),Ot(" "),Ot(" "),Ot(" "),Ot(" "),Ot(" "),Ot("\u2028"),Ot("\u2029"),Ot(" "),Ot(" "),Ot("　"),Ot("\uFEFF")],QI=/[0-9a-fA-F]/,Xc=/[0-9]/,tO=/[1-9]/;class eO{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":na(r,"global");break;case"i":na(r,"ignoreCase");break;case"m":na(r,"multiLine");break;case"u":na(r,"unicode");break;case"y":na(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}ro(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return ZI()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;ro(n);break}if(!(t===!0&&n===void 0)&&ro(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),ro(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ot(`
`),Ot("\r"),Ot("\u2028"),Ot("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Yc;break;case"D":t=Yc,n=!0;break;case"s":t=Jg;break;case"S":t=Jg,n=!0;break;case"w":t=Vc;break;case"W":t=Vc,n=!0;break}if(ro(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Ot("\f");break;case"n":t=Ot(`
`);break;case"r":t=Ot("\r");break;case"t":t=Ot("	");break;case"v":t=Ot("\v");break}if(ro(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ot("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Ot(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Ot(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,qg(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,qg(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else Ph(r.value,t),t.push(Ot("-")),Ph(i.value,t)}else Ph(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ot("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(tO.test(t)===!1)throw Error("Expecting a positive integer");for(;Xc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Xc.test(t)===!1)throw Error("Expecting an integer");for(;Xc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ot(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Xc.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(QI.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class Dh{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let qc={};const nO=new eO;function Jc(e){const t=e.toString();if(qc.hasOwnProperty(t))return qc[t];{const n=nO.pattern(t);return qc[t]=n,n}}function rO(){qc={}}const Zg="Complement Sets are not supported for first char optimization",Zc=`Unable to use "first char" lexer optimizations:
`;function iO(e,t=!1){try{const n=Jc(e);return $h(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Zg)t&&Gg(`${Zc}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Bh(`${Zc}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function $h(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)$h(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Qc(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(Zg);It(o.value,c=>{if(typeof c=="number")Qc(c,t,n);else{const u=c;if(n===!0)for(let l=u.from;l<=u.to;l++)Qc(l,t,n);else{for(let l=u.from;l<=u.to&&l<ia;l++)Qc(l,t,n);if(u.to>=ia){const l=u.from>=ia?u.from:ia,h=u.to,f=Di(l),d=Di(h);for(let p=f;p<=d;p++)t[p]=p}}}});break;case"Group":$h(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&jh(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Be(t)}function Qc(e,t,n){const r=Di(e);t[r]=r,n===!0&&sO(e,t)}function sO(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Di(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Di(i.charCodeAt(0));t[s]=s}}}function Qg(e,t){return eo(e.value,n=>{if(typeof n=="number")return yn(t,n);{const r=n;return eo(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function jh(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?Qt(e.value)?fr(e.value,jh):jh(e.value):!1}class oO extends Dh{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){yn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?Qg(t,this.targetCharCodes)===void 0&&(this.found=!0):Qg(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function zh(e,t){if(t instanceof RegExp){const n=Jc(t),r=new oO(e);return r.visit(n),r.found}else return eo(t,n=>yn(e,n.charCodeAt(0)))!==void 0}const us="PATTERN",ra="defaultMode",tl="modes";let ty=typeof new RegExp("(?:)").sticky=="boolean";function aO(e,t){t=Uh(t,{useSticky:ty,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(x,A)=>A()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{OO()});let r;n("Reject Lexer.NA",()=>{r=zc(e,x=>x[us]===Ge.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=kt(r,x=>{const A=x[us];if(mi(A)){const I=A.source;return I.length===1&&I!=="^"&&I!=="$"&&I!=="."&&!A.ignoreCase?I:I.length===2&&I[0]==="\\"&&!yn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],I[1])?I[1]:t.useSticky?ny(A):ey(A)}else{if(fi(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const I=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),U=new RegExp(I);return t.useSticky?ny(U):ey(U)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;n("misc mapping",()=>{o=kt(r,x=>x.tokenTypeIdx),a=kt(r,x=>{const A=x.GROUP;if(A!==Ge.SKIPPED){if(vn(A))return A;if(gi(A))return!1;throw Error("non exhaustive match")}}),c=kt(r,x=>{const A=x.LONGER_ALT;if(A)return Qt(A)?kt(A,U=>Wg(r,U)):[Wg(r,A)]}),u=kt(r,x=>x.PUSH_MODE),l=kt(r,x=>Rt(x,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const x=sy(t.lineTerminatorCharacters);h=kt(r,A=>!1),t.positionTracking!=="onlyOffset"&&(h=kt(r,A=>Rt(A,"LINE_BREAKS")?!!A.LINE_BREAKS:iy(A,x)===!1&&zh(x,A.PATTERN)))});let f,d,p,m;n("Misc Mapping #2",()=>{f=kt(r,ry),d=kt(s,SO),p=Sn(r,(x,A)=>{const I=A.GROUP;return vn(I)&&I!==Ge.SKIPPED&&(x[I]=[]),x},{}),m=kt(s,(x,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:h[A],isCustom:f[A],short:d[A],group:a[A],push:u[A],pop:l[A],tokenTypeIdx:o[A],tokenType:r[A]}))});let w=!0,E=[];return t.safeMode||n("First Char Optimization",()=>{E=Sn(r,(x,A,I)=>{if(typeof A.PATTERN=="string"){const U=A.PATTERN.charCodeAt(0),S=Di(U);Wh(x,S,m[I])}else if(Qt(A.START_CHARS_HINT)){let U;It(A.START_CHARS_HINT,S=>{const O=typeof S=="string"?S.charCodeAt(0):S,B=Di(O);U!==B&&(U=B,Wh(x,B,m[I]))})}else if(mi(A.PATTERN))if(A.PATTERN.unicode)w=!1,t.ensureOptimizations&&Bh(`${Zc}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const U=iO(A.PATTERN,t.ensureOptimizations);pe(U)&&(w=!1),It(U,S=>{Wh(x,S,m[I])})}else t.ensureOptimizations&&Bh(`${Zc}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),w=!1;return x},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:E,hasCustom:i,canBeOptimized:w}}function cO(e,t){let n=[];const r=uO(e);n=n.concat(r.errors);const i=hO(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(lO(s)),n=n.concat(bO(s)),n=n.concat(EO(s,t)),n=n.concat(wO(s)),n}function lO(e){let t=[];const n=ir(e,r=>mi(r[us]));return t=t.concat(dO(n)),t=t.concat(gO(n)),t=t.concat(yO(n)),t=t.concat(_O(n)),t=t.concat(pO(n)),t}function uO(e){const t=ir(e,i=>!Rt(i,us)),n=kt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Re.MISSING_PATTERN,tokenTypes:[i]})),r=jc(e,t);return{errors:n,valid:r}}function hO(e){const t=ir(e,i=>{const s=i[us];return!mi(s)&&!fi(s)&&!Rt(s,"exec")&&!vn(s)}),n=kt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Re.INVALID_PATTERN,tokenTypes:[i]})),r=jc(e,t);return{errors:n,valid:r}}const fO=/[^\\][$]/;function dO(e){class t extends Dh{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=ir(e,i=>{const s=i.PATTERN;try{const o=Jc(s),a=new t;return a.visit(o),a.found}catch{return fO.test(s.source)}});return kt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Re.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function pO(e){const t=ir(e,r=>r.PATTERN.test(""));return kt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Re.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const mO=/[^\\[][\^]|^\^/;function gO(e){class t extends Dh{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=ir(e,i=>{const s=i.PATTERN;try{const o=Jc(s),a=new t;return a.visit(o),a.found}catch{return mO.test(s.source)}});return kt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Re.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function yO(e){const t=ir(e,r=>{const i=r[us];return i instanceof RegExp&&(i.multiline||i.global)});return kt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Re.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function _O(e){const t=[];let n=kt(e,s=>Sn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!yn(t,a)&&a.PATTERN!==Ge.NA&&(t.push(a),o.push(a)),o),[]));n=Qo(n);const r=ir(n,s=>s.length>1);return kt(r,s=>{const o=kt(s,c=>c.name);return{message:`The same RegExp pattern ->${dr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Re.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function bO(e){const t=ir(e,r=>{if(!Rt(r,"GROUP"))return!1;const i=r.GROUP;return i!==Ge.SKIPPED&&i!==Ge.NA&&!vn(i)});return kt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Re.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function EO(e,t){const n=ir(e,i=>i.PUSH_MODE!==void 0&&!yn(t,i.PUSH_MODE));return kt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Re.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function wO(e){const t=[],n=Sn(e,(r,i,s)=>{const o=i.PATTERN;return o===Ge.NA||(vn(o)?r.push({str:o,idx:s,tokenType:i}):mi(o)&&xO(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return It(e,(r,i)=>{It(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&kO(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Re.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function kO(e,t){if(mi(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(fi(t))return t(e,0,[],{});if(Rt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function xO(e){return eo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function ey(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function ny(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function TO(e,t,n){const r=[];return Rt(e,ra)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ra+`> property in its definition
`,type:Re.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Rt(e,tl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+tl+`> property in its definition
`,type:Re.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Rt(e,tl)&&Rt(e,ra)&&!Rt(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${ra}: <${e.defaultMode}>which does not exist
`,type:Re.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Rt(e,tl)&&It(e.modes,(i,s)=>{It(i,(o,a)=>{if(gi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Re.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Rt(o,"LONGER_ALT")){const c=Qt(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];It(c,u=>{!gi(u)&&!yn(i,u)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:Re.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function AO(e,t,n){const r=[];let i=!1;const s=Qo(Dn(Be(e.modes))),o=zc(s,c=>c[us]===Ge.NA),a=sy(n);return t&&It(o,c=>{const u=iy(c,a);if(u!==!1){const h={message:IO(c,u),type:u.issue,tokenType:c};r.push(h)}else Rt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):zh(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Re.NO_LINE_BREAKS_FLAGS}),r}function vO(e){const t={},n=nr(e);return It(n,r=>{const i=e[r];if(Qt(i))t[r]=[];else throw Error("non exhaustive match")}),t}function ry(e){const t=e.PATTERN;if(mi(t))return!1;if(fi(t))return!0;if(Rt(t,"exec"))return!0;if(vn(t))return!1;throw Error("non exhaustive match")}function SO(e){return vn(e)&&e.length===1?e.charCodeAt(0):!1}const RO={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function iy(e,t){if(Rt(e,"LINE_BREAKS"))return!1;if(mi(e.PATTERN)){try{zh(t,e.PATTERN)}catch(n){return{issue:Re.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(vn(e.PATTERN))return!1;if(ry(e))return{issue:Re.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function IO(e,t){if(t.issue===Re.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Re.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function sy(e){return kt(e,n=>vn(n)?n.charCodeAt(0):n)}function Wh(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const ia=256;let el=[];function Di(e){return e<ia?e:el[e]}function OO(){if(pe(el)){el=new Array(65536);for(let e=0;e<65536;e++)el[e]=e>255?255+~~(e/255):e}}function sa(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function nl(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let oy=1;const ay={};function oa(e){const t=NO(e);CO(t),MO(t),LO(t),It(t,n=>{n.isParent=n.categoryMatches.length>0})}function NO(e){let t=nn(e),n=e,r=!0;for(;r;){n=Qo(Dn(kt(n,s=>s.CATEGORIES)));const i=jc(n,t);t=t.concat(i),pe(i)?r=!1:n=i}return t}function CO(e){It(e,t=>{ly(t)||(ay[oy]=t,t.tokenTypeIdx=oy++),uy(t)&&!Qt(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),uy(t)||(t.CATEGORIES=[]),UO(t)||(t.categoryMatches=[]),FO(t)||(t.categoryMatchesMap={})})}function LO(e){It(e,t=>{t.categoryMatches=[],It(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(ay[r].tokenTypeIdx)})})}function MO(e){It(e,t=>{cy([],t)})}function cy(e,t){It(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),It(t.CATEGORIES,n=>{const r=e.concat(t);yn(r,n)||cy(r,n)})}function ly(e){return Rt(e,"tokenTypeIdx")}function uy(e){return Rt(e,"CATEGORIES")}function UO(e){return Rt(e,"categoryMatches")}function FO(e){return Rt(e,"categoryMatchesMap")}function BO(e){return Rt(e,"tokenTypeIdx")}const PO={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Re;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Re||(Re={}));const aa={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:PO,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(aa);let Ge=class{constructor(t,n=aa){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Hg(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=An({},aa,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===aa.lineTerminatorsPattern)this.config.lineTerminatorsPattern=RO;else if(this.config.lineTerminatorCharacters===aa.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Qt(t)?i={modes:{defaultMode:nn(t)},defaultMode:ra}:(s=!1,i=nn(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(TO(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(AO(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},It(i.modes,(a,c)=>{i.modes[c]=zc(a,u=>gi(u))});const o=nr(i.modes);if(It(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(cO(a,o))}),pe(this.lexerDefinitionErrors)){oa(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=aO(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=An({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!pe(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=kt(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}It(this.lexerDefinitionWarning,a=>{Gg(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(ty?(this.chopInput=Js,this.match=this.matchWithTest):(this.updateLastIndex=We,this.match=this.matchWithExec),s&&(this.handleModes=We),this.trackStartLines===!1&&(this.computeNewColumn=Js),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=We),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Sn(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(n.ensureOptimizations&&!pe(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{rO()}),this.TRACE_INIT("toFastProperties",()=>{Yg(this)})})}tokenize(t,n=this.defaultMode){if(!pe(this.lexerDefinitionErrors)){const i=kt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,u,l,h,f,d,p,m,w,E;const x=t,A=x.length;let I=0,U=0;const S=this.hasCustom?0:Math.floor(t.length/10),O=new Array(S),B=[];let C=this.trackStartLines?1:void 0,G=this.trackStartLines?1:void 0;const tt=vO(this.emptyGroups),L=this.trackStartLines,R=this.config.lineTerminatorsPattern;let _=0,P=[],Z=[];const $=[],lt=[];Object.freeze(lt);let et;function ft(){return P}function H(Lt){const te=Di(Lt),At=Z[te];return At===void 0?lt:At}const W=Lt=>{if($.length===1&&Lt.tokenType.PUSH_MODE===void 0){const te=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Lt);B.push({offset:Lt.startOffset,line:Lt.startLine,column:Lt.startColumn,length:Lt.image.length,message:te})}else{$.pop();const te=to($);P=this.patternIdxToConfig[te],Z=this.charCodeToPatternIdxToConfig[te],_=P.length;const At=this.canModeBeOptimized[te]&&this.config.safeMode===!1;Z&&At?et=H:et=ft}};function bt(Lt){$.push(Lt),Z=this.charCodeToPatternIdxToConfig[Lt],P=this.patternIdxToConfig[Lt],_=P.length,_=P.length;const te=this.canModeBeOptimized[Lt]&&this.config.safeMode===!1;Z&&te?et=H:et=ft}bt.call(this,n);let ot;const ct=this.config.recoveryEnabled;for(;I<A;){c=null;const Lt=x.charCodeAt(I),te=et(Lt),At=te.length;for(r=0;r<At;r++){ot=te[r];const xt=ot.pattern;u=null;const $t=ot.short;if($t!==!1?Lt===$t&&(c=xt):ot.isCustom===!0?(E=xt.exec(x,I,O,tt),E!==null?(c=E[0],E.payload!==void 0&&(u=E.payload)):c=null):(this.updateLastIndex(xt,I),c=this.match(xt,t,I)),c!==null){if(a=ot.longerAlt,a!==void 0){const Gt=a.length;for(s=0;s<Gt;s++){const be=P[a[s]],Oe=be.pattern;if(l=null,be.isCustom===!0?(E=Oe.exec(x,I,O,tt),E!==null?(o=E[0],E.payload!==void 0&&(l=E.payload)):o=null):(this.updateLastIndex(Oe,I),o=this.match(Oe,t,I)),o&&o.length>c.length){c=o,u=l,ot=be;break}}}break}}if(c!==null){if(h=c.length,f=ot.group,f!==void 0&&(d=ot.tokenTypeIdx,p=this.createTokenInstance(c,I,d,ot.tokenType,C,G,h),this.handlePayload(p,u),f===!1?U=this.addToken(O,U,p):tt[f].push(p)),t=this.chopInput(t,h),I=I+h,G=this.computeNewColumn(G,h),L===!0&&ot.canLineTerminator===!0){let xt=0,$t,Gt;R.lastIndex=0;do $t=R.test(c),$t===!0&&(Gt=R.lastIndex-1,xt++);while($t===!0);xt!==0&&(C=C+xt,G=h-Gt,this.updateTokenEndLineColumnLocation(p,f,Gt,xt,C,G,h))}this.handleModes(ot,W,bt,p)}else{const xt=I,$t=C,Gt=G;let be=ct===!1;for(;be===!1&&I<A;)for(t=this.chopInput(t,1),I++,i=0;i<_;i++){const Oe=P[i],b=Oe.pattern,st=Oe.short;if(st!==!1?x.charCodeAt(I)===st&&(be=!0):Oe.isCustom===!0?be=b.exec(x,I,O,tt)!==null:(this.updateLastIndex(b,I),be=b.exec(t)!==null),be===!0)break}if(m=I-xt,G=this.computeNewColumn(G,m),w=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(x,xt,m,$t,Gt),B.push({offset:xt,line:$t,column:Gt,length:m,message:w}),ct===!1)break}}return this.hasCustom||(O.length=U),{tokens:O,groups:tt,errors:B}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,u;n!==void 0&&(c=r===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1+-u))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};Ge.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Ge.NA=/NOT_APPLICABLE/;function ca(e){return hy(e)?e.LABEL:e.name}function hy(e){return vn(e.LABEL)&&e.LABEL!==""}const DO="parent",fy="categories",dy="label",py="group",my="push_mode",gy="pop_mode",yy="longer_alt",_y="line_breaks",by="start_chars_hint";function $n(e){return $O(e)}function $O(e){const t=e.pattern,n={};if(n.name=e.name,gi(t)||(n.PATTERN=t),Rt(e,DO))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Rt(e,fy)&&(n.CATEGORIES=e[fy]),oa([n]),Rt(e,dy)&&(n.LABEL=e[dy]),Rt(e,py)&&(n.GROUP=e[py]),Rt(e,gy)&&(n.POP_MODE=e[gy]),Rt(e,my)&&(n.PUSH_MODE=e[my]),Rt(e,yy)&&(n.LONGER_ALT=e[yy]),Rt(e,_y)&&(n.LINE_BREAKS=e[_y]),Rt(e,by)&&(n.START_CHARS_HINT=e[by]),n}const hs=$n({name:"EOF",pattern:Ge.NA});oa([hs]);function rl(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function jO(e,t){return sa(e,t)}const Ey={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${hy(e)?`--> ${ca(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+dr(t).image+"'";if(r)return s+r+a;{const c=Sn(e,(f,d)=>f.concat(d),[]),u=kt(c,f=>`[${kt(f,d=>ca(d)).join(", ")}]`),h=`one of these possible Token sequences:
${kt(u,(f,d)=>`  ${d+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+dr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${kt(e,u=>`[${kt(u,l=>ca(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Ey);const zO={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},fs={buildDuplicateFoundError(e,t){function n(l){return l instanceof Ae?l.terminalType.name:l instanceof Rn?l.nonTerminalName:""}const r=e.name,i=dr(t),s=i.idx,o=Wr(i),a=n(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=kt(e.prefixPath,i=>ca(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=kt(e.prefixPath,i=>ca(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Wr(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=kt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof no?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function WO(e,t){const n=new KO(e,t);return n.resolveRefs(),n.errors}class KO extends ls{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){It(Be(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:_n.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class GO extends Hc{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=nn(this.path.ruleStack).reverse(),this.occurrenceStack=nn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){pe(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class HO extends GO{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new In({definition:i});this.possibleTokTypes=ea(s),this.found=!0}}}class il extends Hc{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class YO extends il{walkMany(t,n,r){if(t.idx===this.occurrence){const i=dr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class wy extends il{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=dr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class VO extends il{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=dr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class ky extends il{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=dr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function Kh(e,t,n=[]){n=nn(n);let r=[],i=0;function s(a){return a.concat(rn(e,i+1))}function o(a){const c=Kh(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof In)return o(a.definition);if(a instanceof Rn)return o(a.definition);if(a instanceof On)r=o(a.definition);else if(a instanceof jr){const c=a.definition.concat([new Ke({definition:a.definition})]);return o(c)}else if(a instanceof zr){const c=[new In({definition:a.definition}),new Ke({definition:[new Ae({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof mr){const c=a.definition.concat([new Ke({definition:[new Ae({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Ke){const c=a.definition.concat([new Ke({definition:a.definition})]);r=o(c)}else{if(a instanceof gr)return It(a.definition,c=>{pe(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ae)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:rn(e,i)}),r}function xy(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-r-1,l=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!pe(h);){const f=h.pop();if(f===o){a&&to(h).idx<=u&&h.pop();continue}const d=f.def,p=f.idx,m=f.ruleStack,w=f.occurrenceStack;if(pe(d))continue;const E=d[0];if(E===i){const x={idx:p,def:rn(d),ruleStack:ta(m),occurrenceStack:ta(w)};h.push(x)}else if(E instanceof Ae)if(p<c-1){const x=p+1,A=t[x];if(n(A,E.terminalType)){const I={idx:x,def:rn(d),ruleStack:m,occurrenceStack:w};h.push(I)}}else if(p===c-1)l.push({nextTokenType:E.terminalType,nextTokenOccurrence:E.idx,ruleStack:m,occurrenceStack:w}),a=!0;else throw Error("non exhaustive match");else if(E instanceof Rn){const x=nn(m);x.push(E.nonTerminalName);const A=nn(w);A.push(E.idx);const I={idx:p,def:E.definition.concat(s,rn(d)),ruleStack:x,occurrenceStack:A};h.push(I)}else if(E instanceof On){const x={idx:p,def:rn(d),ruleStack:m,occurrenceStack:w};h.push(x),h.push(o);const A={idx:p,def:E.definition.concat(rn(d)),ruleStack:m,occurrenceStack:w};h.push(A)}else if(E instanceof jr){const x=new Ke({definition:E.definition,idx:E.idx}),A=E.definition.concat([x],rn(d)),I={idx:p,def:A,ruleStack:m,occurrenceStack:w};h.push(I)}else if(E instanceof zr){const x=new Ae({terminalType:E.separator}),A=new Ke({definition:[x].concat(E.definition),idx:E.idx}),I=E.definition.concat([A],rn(d)),U={idx:p,def:I,ruleStack:m,occurrenceStack:w};h.push(U)}else if(E instanceof mr){const x={idx:p,def:rn(d),ruleStack:m,occurrenceStack:w};h.push(x),h.push(o);const A=new Ae({terminalType:E.separator}),I=new Ke({definition:[A].concat(E.definition),idx:E.idx}),U=E.definition.concat([I],rn(d)),S={idx:p,def:U,ruleStack:m,occurrenceStack:w};h.push(S)}else if(E instanceof Ke){const x={idx:p,def:rn(d),ruleStack:m,occurrenceStack:w};h.push(x),h.push(o);const A=new Ke({definition:E.definition,idx:E.idx}),I=E.definition.concat([A],rn(d)),U={idx:p,def:I,ruleStack:m,occurrenceStack:w};h.push(U)}else if(E instanceof gr)for(let x=E.definition.length-1;x>=0;x--){const A=E.definition[x],I={idx:p,def:A.definition.concat(rn(d)),ruleStack:m,occurrenceStack:w};h.push(I),h.push(o)}else if(E instanceof In)h.push({idx:p,def:E.definition.concat(rn(d)),ruleStack:m,occurrenceStack:w});else if(E instanceof no)h.push(XO(E,p,m,w));else throw Error("non exhaustive match")}return l}function XO(e,t,n,r){const i=nn(n);i.push(e.name);const s=nn(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Ie;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Ie||(Ie={}));function Ty(e){if(e instanceof On||e==="Option")return Ie.OPTION;if(e instanceof Ke||e==="Repetition")return Ie.REPETITION;if(e instanceof jr||e==="RepetitionMandatory")return Ie.REPETITION_MANDATORY;if(e instanceof zr||e==="RepetitionMandatoryWithSeparator")return Ie.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof mr||e==="RepetitionWithSeparator")return Ie.REPETITION_WITH_SEPARATOR;if(e instanceof gr||e==="Alternation")return Ie.ALTERNATION;throw Error("non exhaustive match")}function qO(e,t,n,r,i,s){const o=Hh(e,t,n),a=Ry(o)?nl:sa;return s(o,r,a,i)}function JO(e,t,n,r,i,s){const o=Yh(e,t,i,n),a=Ry(o)?nl:sa;return s(o[0],a,r)}function ZO(e,t,n,r){const i=e.length,s=fr(e,o=>fr(o,a=>a.length===1));if(t)return function(o){const a=kt(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let f=0;f<l;f++){const d=u[f],p=d.length;for(let m=0;m<p;m++){const w=this.LA(m+1);if(n(w,d[m])===!1)continue t}return c}}};if(s&&!r){const o=kt(e,c=>Dn(c)),a=Sn(o,(c,u,l)=>(It(u,h=>{Rt(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),It(h.categoryMatches,f=>{Rt(c,f)||(c[f]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let f=0;f<h;f++){const d=this.LA(f+1);if(n(d,l[f])===!1)continue t}return o}}}}function QO(e,t,n){const r=fr(e,s=>s.length===1),i=e.length;if(r&&!n){const s=Dn(e);if(s.length===1&&pe(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Sn(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,It(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue t}return!0}return!1}}class tN extends Hc{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Ie.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Ie.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Ie.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Ie.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Ie.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class Ay extends ls{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Ie.OPTION)}visitRepetition(t){this.checkIsTarget(t,Ie.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Ie.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Ie.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Ie.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Ie.ALTERNATION)}}function vy(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function Gh(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function eN(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function Sy(e,t){const n=kt(e,o=>Kh([o],1)),r=vy(n.length),i=kt(n,o=>{const a={};return It(o,c=>{const u=Gh(c.partialPath);It(u,l=>{a[l]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=vy(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,f=u[l].suffixDef,d=Gh(h);if(eN(i,d,c)||pe(f)||h.length===t){const m=r[c];if(Vh(m,h)===!1){m.push(h);for(let w=0;w<d.length;w++){const E=d[w];i[c][E]=!0}}}else{const m=Kh(f,o+1,h);s[c]=s[c].concat(m),It(m,w=>{const E=Gh(w.partialPath);It(E,x=>{i[c][x]=!0})})}}}}return r}function Hh(e,t,n,r){const i=new Ay(e,Ie.ALTERNATION,r);return t.accept(i),Sy(i.result,n)}function Yh(e,t,n,r){const i=new Ay(e,n);t.accept(i);const s=i.result,a=new tN(t,e,n).startWalking(),c=new In({definition:s}),u=new In({definition:a});return Sy([c,u],r)}function Vh(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function nN(e,t){return e.length<t.length&&fr(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function Ry(e){return fr(e,t=>fr(t,n=>fr(n,r=>pe(r.categoryMatches))))}function rN(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return kt(t,n=>Object.assign({type:_n.CUSTOM_LOOKAHEAD_VALIDATION},n))}function iN(e,t,n,r){const i=sr(e,c=>sN(c,n)),s=yN(e,t,n),o=sr(e,c=>dN(c,n)),a=sr(e,c=>cN(c,e,r,n));return i.concat(s,o,a)}function sN(e,t){const n=new aN;e.accept(n);const r=n.allProductions,i=zg(r,oN),s=pr(i,a=>a.length>1);return kt(Be(s),a=>{const c=dr(a),u=t.buildDuplicateFoundError(e,a),l=Wr(c),h={message:u,type:_n.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:c.idx},f=Iy(c);return f&&(h.parameter=f),h})}function oN(e){return`${Wr(e)}_#_${e.idx}_#_${Iy(e)}`}function Iy(e){return e instanceof Ae?e.terminalType.name:e instanceof Rn?e.nonTerminalName:""}class aN extends ls{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function cN(e,t,n,r){const i=[];if(Sn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:_n.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function lN(e,t,n){const r=[];let i;return yn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:_n.INVALID_RULE_OVERRIDE,ruleName:e})),r}function Oy(e,t,n,r=[]){const i=[],s=sl(t.definition);if(pe(s))return[];{const o=e.name;yn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:_n.LEFT_RECURSION,ruleName:o});const c=jc(s,r.concat([e])),u=sr(c,l=>{const h=nn(r);return h.push(l),Oy(e,l,n,h)});return i.concat(u)}}function sl(e){let t=[];if(pe(e))return t;const n=dr(e);if(n instanceof Rn)t.push(n.referencedRule);else if(n instanceof In||n instanceof On||n instanceof jr||n instanceof zr||n instanceof mr||n instanceof Ke)t=t.concat(sl(n.definition));else if(n instanceof gr)t=Dn(kt(n.definition,s=>sl(s.definition)));else if(!(n instanceof Ae))throw Error("non exhaustive match");const r=Gc(n),i=e.length>1;if(r&&i){const s=rn(e);return t.concat(sl(s))}else return t}class Xh extends ls{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function uN(e,t){const n=new Xh;e.accept(n);const r=n.alternations;return sr(r,s=>{const o=ta(s.definition);return sr(o,(a,c)=>{const u=xy([a],[],sa,1);return pe(u)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:_n.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function hN(e,t,n){const r=new Xh;e.accept(r);let i=r.alternations;return i=zc(i,o=>o.ignoreAmbiguities===!0),sr(i,o=>{const a=o.idx,c=o.maxLookahead||t,u=Hh(a,e,c,o),l=mN(u,o,e,n),h=gN(u,o,e,n);return l.concat(h)})}class fN extends ls{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function dN(e,t){const n=new Xh;e.accept(n);const r=n.alternations;return sr(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:_n.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function pN(e,t,n){const r=[];return It(e,i=>{const s=new fN;i.accept(s);const o=s.allProductions;It(o,a=>{const c=Ty(a),u=a.maxLookahead||t,l=a.idx,f=Yh(l,i,c,u)[0];if(pe(Dn(f))){const d=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:d,type:_n.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function mN(e,t,n,r){const i=[],s=Sn(e,(a,c,u)=>(t.definition[u].ignoreAmbiguities===!0||It(c,l=>{const h=[u];It(e,(f,d)=>{u!==d&&Vh(f,l)&&t.definition[d].ignoreAmbiguities!==!0&&h.push(d)}),h.length>1&&!Vh(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return kt(s,a=>{const c=kt(a.alts,l=>l+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:_n.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function gN(e,t,n,r){const i=Sn(e,(o,a,c)=>{const u=kt(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return Qo(sr(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=ir(i,f=>t.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&nN(f.path,u));return kt(l,f=>{const d=[f.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:d,prefixPath:f.path}),type:_n.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:d}})}))}function yN(e,t,n){const r=[],i=kt(t,s=>s.name);return It(e,s=>{const o=s.name;if(yn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:_n.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function _N(e){const t=Uh(e,{errMsgProvider:zO}),n={};return It(e.rules,r=>{n[r.name]=r}),WO(n,t.errMsgProvider)}function bN(e){return e=Uh(e,{errMsgProvider:fs}),iN(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const Ny="MismatchedTokenException",Cy="NoViableAltException",Ly="EarlyExitException",My="NotAllInputParsedException",Uy=[Ny,Cy,Ly,My];Object.freeze(Uy);function ol(e){return yn(Uy,e.name)}class al extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Fy extends al{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Ny}}class EN extends al{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Cy}}class wN extends al{constructor(t,n){super(t,n),this.name=My}}class kN extends al{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Ly}}const qh={},By="InRuleRecoveryException";class xN extends Error{constructor(t){super(t),this.name=By}}class TN{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Rt(t,"recoveryEnabled")?t.recoveryEnabled:yi.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=AN)}getTokenToInsert(t){const n=rl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const f=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:f,ruleName:this.getCurrRuleFullName()}),p=new Fy(d,u,this.LA(0));p.resyncedTokens=ta(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new xN("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||pe(n))return!1;const r=this.LA(1);return eo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return yn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=eo(t,s=>jO(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return qh;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return kt(t,(r,i)=>i===0?qh:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=kt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return Dn(t)}getFollowSetFromFollowKey(t){if(t===qh)return[hs];const n=t.ruleName+t.idxInCallingRule+Xg+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,hs)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return ta(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=nn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return kt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function AN(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),d=this.getGAstProductions()[f];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=hs,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,n,u)}const vN=4,$i=8,Py=1<<$i,Dy=2<<$i,Jh=3<<$i,Zh=4<<$i,Qh=5<<$i,cl=6<<$i;function tf(e,t,n){return n|t|e}class SN{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:yi.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(pe(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return sr(t,n=>Oy(n,n,fs))}validateEmptyOrAlternatives(t){return sr(t,n=>uN(n,fs))}validateAmbiguousAlternationAlternatives(t,n){return sr(t,r=>hN(r,n,fs))}validateSomeNonEmptyLookaheadPath(t,n){return pN(t,n,fs)}buildLookaheadForAlternation(t){return qO(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,ZO)}buildLookaheadForOptional(t){return JO(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Ty(t.prodType),QO)}}class RN{initLooksAhead(t){this.dynamicTokensEnabled=Rt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:yi.dynamicTokensEnabled,this.maxLookahead=Rt(t,"maxLookahead")?t.maxLookahead:yi.maxLookahead,this.lookaheadStrategy=Rt(t,"lookaheadStrategy")?t.lookaheadStrategy:new SN({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){It(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=ON(n);It(r,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${Wr(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:n,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=tf(this.fullRuleNameToShort[n.name],Py,u.idx);this.setLaFuncCache(f,h)})}),It(i,u=>{this.computeLookaheadFunc(n,u.idx,Jh,"Repetition",u.maxLookahead,Wr(u))}),It(s,u=>{this.computeLookaheadFunc(n,u.idx,Dy,"Option",u.maxLookahead,Wr(u))}),It(o,u=>{this.computeLookaheadFunc(n,u.idx,Zh,"RepetitionMandatory",u.maxLookahead,Wr(u))}),It(a,u=>{this.computeLookaheadFunc(n,u.idx,cl,"RepetitionMandatoryWithSeparator",u.maxLookahead,Wr(u))}),It(c,u=>{this.computeLookaheadFunc(n,u.idx,Qh,"RepetitionWithSeparator",u.maxLookahead,Wr(u))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=tf(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return tf(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class IN extends ls{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const ll=new IN;function ON(e){ll.reset(),e.accept(ll);const t=ll.dslMethods;return ll.reset(),t}function $y(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function jy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function NN(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function CN(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const LN="name";function zy(e,t){Object.defineProperty(e,LN,{enumerable:!1,configurable:!0,writable:!1,value:t})}function MN(e,t){const n=nr(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,t)}}}function UN(e,t){const n=function(){};zy(n,e+"BaseSemantics");const r={visit:function(i,s){if(Qt(i)&&(i=i[0]),!gi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=BN(this,t);if(!pe(i)){const s=kt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function FN(e,t,n){const r=function(){};zy(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return It(t,s=>{i[s]=MN}),r.prototype=i,r.prototype.constructor=r,r}var ef;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(ef||(ef={}));function BN(e,t){return PN(e,t)}function PN(e,t){const n=ir(t,i=>fi(e[i])===!1),r=kt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:ef.MISSING_METHOD,methodName:i}));return Qo(r)}class DN{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Rt(t,"nodeLocationTracking")?t.nodeLocationTracking:yi.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=We,this.cstFinallyStateUpdate=We,this.cstPostTerminal=We,this.cstPostNonTerminal=We,this.cstPostRule=We;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=jy,this.setNodeLocationFromNode=jy,this.cstPostRule=We,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=$y,this.setNodeLocationFromNode=$y,this.cstPostRule=We,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=We,this.setInitialNodeLocation=We;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];NN(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];CN(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(gi(this.baseCstVisitorConstructor)){const t=UN(this.className,nr(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(gi(this.baseCstVisitorWithDefaultsConstructor)){const t=FN(this.className,nr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class $N{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):fl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?fl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class jN{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=dl){if(yn(this.definedRulesNames,t)){const o={message:fs.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:_n.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=dl){const i=lN(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(ol(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return WI(Be(this.gastProductionsCache))}}class zN{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=nl,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Rt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Qt(t)){if(pe(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Qt(t))this.tokensMap=Sn(t,(s,o)=>(s[o.name]=o,s),{});else if(Rt(t,"modes")&&fr(Dn(Be(t.modes)),BO)){const s=Dn(Be(t.modes)),o=Wc(s);this.tokensMap=Sn(o,(a,c)=>(a[c.name]=c,a),{})}else if(er(t))this.tokensMap=nn(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=hs;const r=Rt(t,"modes")?Dn(Be(t.modes)):Be(t),i=fr(r,s=>pe(s.categoryMatches));this.tokenMatcher=i?nl:sa,oa(Be(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Rt(r,"resyncEnabled")?r.resyncEnabled:dl.resyncEnabled,s=Rt(r,"recoveryValueFunc")?r.recoveryValueFunc:dl.recoveryValueFunc,o=this.ruleShortNameIdx<<vN+$i;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(ol(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Dy,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(Zh,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Ie.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,Zh,t,VO)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(cl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,ky],a,cl,t,ky)}else throw this.raiseEarlyExitException(t,Ie.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(Jh,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,Jh,t,YO,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(Qh,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,wy],a,Qh,t,wy)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,cl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(Py,n),i=Qt(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new wN(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw ol(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Fy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===By?r:s}}else throw r}saveRecogState(){const t=this.errors,n=nn(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),hs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class WN{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Rt(t,"errorMessageProvider")?t.errorMessageProvider:yi.errorMessageProvider}SAVE_ERROR(t){if(ol(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:nn(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return nn(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Yh(t,s,n,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new kN(u,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Hh(t,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new EN(c,this.LA(1),a))}}class KN{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(gi(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return xy([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=dr(t.ruleStack),i=this.getGAstProductions()[n];return new HO(i,t).startWalking()}}const ul={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(ul);const Wy=!0,Ky=Math.pow(2,$i)-1,Gy=$n({name:"RECORDING_PHASE_TOKEN",pattern:Ge.NA});oa([Gy]);const Hy=rl(Gy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Hy);const GN={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class HN{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return fl}topLevelRuleRecord(t,n){try{const r=new no({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return la.call(this,On,t,n)}atLeastOneInternalRecord(t,n){la.call(this,jr,n,t)}atLeastOneSepFirstInternalRecord(t,n){la.call(this,zr,n,t,Wy)}manyInternalRecord(t,n){la.call(this,Ke,n,t)}manySepFirstInternalRecord(t,n){la.call(this,mr,n,t,Wy)}orInternalRecord(t,n){return YN.call(this,t,n)}subruleInternalRecord(t,n,r){if(hl(n),!t||Rt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Yy(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=to(this.recordingProdStack),s=t.ruleName,o=new Rn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?GN:ul}consumeInternalRecord(t,n,r){if(hl(n),!ly(t)){const o=new Error(`<CONSUME${Yy(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=to(this.recordingProdStack),s=new Ae({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Hy}}function la(e,t,n,r=!1){hl(n);const i=to(this.recordingProdStack),s=fi(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Rt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),ul}function YN(e,t){hl(t);const n=to(this.recordingProdStack),r=Qt(e)===!1,i=r===!1?e:e.DEF,s=new gr({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Rt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Fh(i,a=>fi(a.GATE));return s.hasPredicates=o,n.definition.push(s),It(i,a=>{const c=new In({definition:[]});s.definition.push(c),Rt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Rt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),ul}function Yy(e){return e===0?"":`${e}`}function hl(e){if(e<0||e>Ky){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${Ky+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class VN{initPerformanceTracer(t){if(Rt(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=yi.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=Hg(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function XN(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const fl=rl(hs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(fl);const yi=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Ey,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),dl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var _n;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(_n||(_n={}));let nf=class eb{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Yg(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),It(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=_N({rules:Be(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(pe(r)&&this.skipValidations===!1){const i=bN({rules:Be(this.gastProductionsCache),tokenTypes:Be(this.tokensMap),errMsgProvider:fs,grammarName:n}),s=rN({lookaheadStrategy:this.lookaheadStrategy,rules:Be(this.gastProductionsCache),tokenTypes:Be(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),pe(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=qI(Be(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Be(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Be(this.gastProductionsCache))})),!eb.DEFER_DEFINITION_ERRORS_HANDLING&&!pe(this.definitionErrors))throw t=kt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Rt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Rt(n,"skipValidations")?n.skipValidations:yi.skipValidations}};nf.DEFER_DEFINITION_ERRORS_HANDLING=!1,XN(nf,[TN,RN,DN,$N,zN,jN,WN,KN,HN,VN]);class qN extends nf{constructor(t,n=yi){const r=nn(n);r.outputCst=!0,super(t,r)}}function JN(e){const t=new ZN,n=Be(e);return kt(n,r=>t.visitRule(r))}class ZN extends ls{visitRule(t){const n=this.visitEach(t.definition),r=zg(n,s=>s.propertyName),i=kt(r,(s,o)=>{const a=!Fh(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=kt(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:pl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:pl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:pl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:pl(t)}]}visitEachAndOverrideWith(t,n){return kt(this.visitEach(t),r=>An({},r,n))}visitEach(t){return Dn(kt(t,n=>this.visit(n)))}}function pl(e){return e instanceof Rn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function QN(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(Dn(kt(e,r=>tC(r)))),t.includeVisitorInterface&&(n=n.concat(iC(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function tC(e){const t=eC(e),n=nC(e);return[t,n]}function eC(e){const t=Xy(e.name),n=rf(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function nC(e){return`export type ${rf(e.name)} = {
  ${kt(e.properties,n=>rC(n)).join(`
  `)}
};`}function rC(e){const t=oC(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function iC(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${kt(t,n=>sC(n)).join(`
  `)}
}`}function sC(e){const t=rf(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function oC(e){if(Qt(e)){const t=Wc(kt(e,r=>Vy(r)));return"("+Sn(t,(r,i)=>r+" | "+i)+")"}else return Vy(e)}function Vy(e){return e.kind==="token"?"IToken":Xy(e.name)}function Xy(e){return ug(e)+"CstNode"}function rf(e){return ug(e)+"CstChildren"}const aC={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function cC(e,t){const n=Object.assign(Object.assign({},aC),t),r=JN(e);return QN(r,n)}const sf=L0(32,126).map(e=>String.fromCharCode(e));function Kt(e){return $n({...e,name:`token_${e.name}`})}function Kr(e,t=!1){return Kt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:ln,group:Ge.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:ln})}const ua=Kt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),lC=Kt({name:"whitespace",pattern:/ +/,group:Ge.SKIPPED}),uC=Kt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Ge.SKIPPED}),of=Kt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),io=Kt({name:"command",pattern:/#/,start_chars_hint:["#"]});let qy=!1;function hC(e,t,n){if(!qy)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==ua)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const Jy=Kt({name:"text",pattern:hC,line_breaks:!1,start_chars_hint:sf.filter(e=>"@#/?':!".includes(e)===!1)}),Zy=Kt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Qy=Kt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),t_=Kt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),e_=Kt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),ln=Kt({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:sf}),n_=Kt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),r_=Kt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),i_=Kt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:ln}),s_=Kt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:ln}),o_=Kt({name:"islessthan",pattern:/<|below/,longer_alt:ln}),a_=Kt({name:"isgreaterthan",pattern:/>|above/,longer_alt:ln}),c_=Kt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:ln}),l_=Kt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:ln}),af=Kt({name:"or",pattern:/or/i,longer_alt:ln}),cf=Kt({name:"not",pattern:/not/i,longer_alt:ln}),lf=Kt({name:"and",pattern:/and/i,longer_alt:ln}),uf=Kt({name:"plus",pattern:/\+/}),hf=Kt({name:"minus",pattern:/-/}),u_=Kt({name:"power",pattern:/\*\*/}),h_=Kt({name:"multiply",pattern:/\*/}),ff=Kt({name:"divide",pattern:/\//}),f_=Kt({name:"moddivide",pattern:/%/}),d_=Kt({name:"floordivide",pattern:/%%/}),p_=Kt({name:"query",pattern:/\?/}),m_=Kt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),g_=Kt({name:"rparen",pattern:/\)/,pop_mode:!0}),y_=Kt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:sf,longer_alt:ln}),df=Kt({name:"if",pattern:/if|try|take|give/,longer_alt:ln}),ml=Kr("do"),fC=Kr("to",!0),pf=Kr("done"),dC=Kr("then",!0),mf=Kr("else"),__=Kr("while"),b_=Kr("repeat"),E_=Kr("waitfor"),w_=Kt({name:"foreach",pattern:/foreach|for/,longer_alt:ln}),k_=Kr("break"),x_=Kr("continue");function T_(e){return[...e,r_,i_,s_,c_,o_,l_,a_,af,cf,lf,uf,hf,u_,h_,ff,d_,f_,p_,m_,g_,n_,ln]}const A_=T_([Jy,of,y_,io,Zy,Qy,t_,e_,ua,lC,k_,x_,pf,ml,mf,w_,df,b_,dC,fC,E_,__]),pC=new Ge({defaultMode:"use_newlines",modes:{use_newlines:A_,ignore_newlines:T_([uC])}},{skipValidations:!Lr,ensureOptimizations:Lr});function v_(e){qy=!0;const t=pC.tokenize(e||` 
`),[n]=(re(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(rl(ua,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function mC(e,t,n=!0){if(n){const[r,...i]=t;switch(Mt(r??"")){default:return{type:wt.OBJECT,values:t};case"loader":return{type:wt.LOADER,values:i};case"board":return{type:wt.BOARD,values:i};case"object":return{type:wt.OBJECT,values:i};case"terrain":return{type:wt.TERRAIN,values:i};case"charset":return{type:wt.CHARSET,values:i};case"palette":return{type:wt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Mt(i??""),a=[r,e,...s];switch(o){default:return{type:wt.CONST,values:t};case"rn":case"range":return{type:wt.RANGE,values:a};case"sl":case"select":return{type:wt.SELECT,values:a};case"nm":case"number":return{type:wt.NUMBER,values:a};case"tx":case"text":return{type:wt.TEXT,values:a};case"ln":case"link":return{type:wt.LINK,values:a};case"hk":case"hotkey":return{type:wt.HOTKEY,values:a};case"copyit":return{type:wt.COPYIT,values:a};case"openit":return{type:wt.OPENIT,values:a};case"zssedit":return{type:wt.ZSSEDIT,values:a};case"charedit":return{type:wt.CHAREDIT,values:a};case"coloredit":return{type:wt.COLOREDIT,values:a}}}}function jn(e){switch(e){case wt.LOADER:return"loader";case wt.BOARD:return"board";case wt.OBJECT:return"object";case wt.TERRAIN:return"terrain";case wt.CHARSET:return"charset";case wt.PALETTE:return"palette";case wt.CONST:return"const";case wt.RANGE:return"range";case wt.SELECT:return"select";case wt.NUMBER:return"number";case wt.TEXT:return"text";case wt.LINK:return"link";case wt.HOTKEY:return"hotkey";case wt.COPYIT:return"copyit";case wt.OPENIT:return"openit";case wt.ZSSEDIT:return"zssedit";case wt.CHAREDIT:return"charedit";case wt.COLOREDIT:return"coloredit"}}var gf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(gf||{});function S_(e){return qs(e,gf,{bits:t=>Array.from(t)})}function R_(e){return Ko(e,gf,{bits:t=>new Uint8Array(t)})}function gC(e,t){return{id:Ne(),code:e,...t}}var yf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(yf||{});function yC(e){return qs(e,yf,{board:KL,object:xc,terrain:xc,charset:S_,palette:S_,stats:Me})}function _C(e){return Ko(e,yf,{board:GL,object:Tc,terrain:Tc,charset:R_,palette:R_})}function ha(e){const t={...ds(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function bC(e){return k(e)?(e.stats=void 0,ds(e)):{}}function I_(e){const t=v_(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===of){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),u=a.split(" "),l=mC(St(c)?c:"",u,r),h=Mt(l.values.join(" "));switch(r=!1,l.type){case wt.LOADER:n.type=Et.LOADER,n.name=h;break;case wt.BOARD:n.type=Et.BOARD,n.name=h;break;case wt.OBJECT:n.type=Et.OBJECT,n.name=h||"object";break;case wt.TERRAIN:n.type=Et.TERRAIN,n.name=h;break;case wt.CHARSET:n.type=Et.CHARSET,n.name=h;break;case wt.PALETTE:n.type=Et.PALETTE,n.name=h;break;case wt.CONST:{const[f,d]=l.values;if(St(f)){const p=Mt(f);if(St(d)){const m=parseFloat(d);n[p]=Ct(m)?m:d}else Ct(d)?n[p]=d:n[p]=1}break}case wt.RANGE:case wt.SELECT:case wt.NUMBER:case wt.TEXT:case wt.LINK:case wt.HOTKEY:case wt.ZSSEDIT:case wt.CHAREDIT:case wt.COLOREDIT:{const[f,...d]=l.values;if(St(f)){const p=Mt(f);n[p]=[jn(l.type),...d]}break}}}}return n}function ds(e){var t;return k(e)?(k((t=e.stats)==null?void 0:t.type)||(e.stats=I_(e.code),k(e.stats.type)||(e.stats.type=Et.OBJECT)),e.stats):{}}function O_(e){switch(e){default:case Et.ERROR:return"error";case Et.LOADER:return jn(wt.LOADER);case Et.BOARD:return jn(wt.BOARD);case Et.OBJECT:return jn(wt.OBJECT);case Et.TERRAIN:return jn(wt.TERRAIN);case Et.CHARSET:return jn(wt.CHARSET);case Et.PALETTE:return jn(wt.PALETTE)}}function Gr(e){return ds(e).type??Et.ERROR}function ps(e){return O_(Gr(e))}function Ue(e){return ds(e).name??""}function N_(e,t){return ds(e)[t]}const gl=new Xu;function _f(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!re(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Ht.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Ht.ISSWIM;break;case"issolid":t.collision=Ht.ISSOLID;break;case"isbullet":t.collision=Ht.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function un(e){var t;if(k(e))switch(Gr(e)){default:return;case Et.ERROR:return e.code??"";case Et.LOADER:return e.code??"";case Et.BOARD:{k(e.board)||(e.board=WL()),e.board.id=e.id;const n=ha(e);return e.board.isdark=n.isdark??e.board.isdark?1:0,e.board.startx=n.startx??e.board.startx,e.board.starty=n.starty??e.board.starty,e.board.over=n.over??e.board.over,e.board.under=n.under??e.board.under,e.board.exitnorth=n.exitnorth??e.board.exitnorth,e.board.exitsouth=n.exitsouth??e.board.exitsouth,e.board.exitwest=n.exitwest??e.board.exitwest,e.board.exiteast=n.exiteast??e.board.exiteast,e.board.timelimit=n.timelimit??e.board.timelimit,e.board.restartonzap=n.restartonzap??e.board.restartonzap,e.board.maxplayershots=n.maxplayershots??e.board.maxplayershots,e.board}case Et.OBJECT:return k(e.object)||(e.object=Tm()),e.object.name=Ue(e),e.object.category=Gn.ISOBJECT,_f(ha(e),e.object),e.object;case Et.TERRAIN:return k(e.terrain)||(e.terrain=Tm()),e.terrain.name=Ue(e),e.terrain.category=Gn.ISTERRAIN,_f(ha(e),e.terrain),e.terrain;case Et.PALETTE:{if(k(e.palette)||(e.palette=vm(DT)),k((t=e.palette)==null?void 0:t.bits)){const n=ha(e),r=Kn(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&St(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){gl.set(o);const c=a*lc,u=gl.r*63,l=gl.g*63,h=gl.b*63;e.palette.bits[c+0]=Bn(u,0,63),e.palette.bits[c+1]=Bn(l,0,63),e.palette.bits[c+2]=Bn(h,0,63)}}}}return e.palette}case Et.CHARSET:return k(e.charset)||(e.charset=Sm(PT)),e.charset}}function C_(e){return{id:Ne(),name:yb(),timestamp:0,activelist:[],pages:e,flags:{}}}var bf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e))(bf||{});function EC(e){return qs(e,bf,{pages:t=>t.map(yC),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function wC(e){return Ko(e,bf,{pages:t=>t.map(_C)})}function ji(e,t){if(!k(e))return;const n=Mt(t);return e.pages.find(i=>i.id===t||n===Ue(i))}function Nn(e,t,n){if(!k(e))return;const r=Mt(n);return e.pages.find(s=>Gr(s)===t&&(s.id===n||r===Ue(s)))}function Ef(e,t,n){let r=Nn(e,t,n);if(!k(r)){const i=O_(t);r=gC(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),L_(e,r)}return r}function ms(e,t){return k(e)?e.pages.filter(n=>Gr(n)===t):[]}function Hr(e,t,n){if(!k(e))return[];const r=Mt(n);return e.pages.filter(s=>Gr(s)===t).filter(s=>{const o=ds(s),a=Mt(Ue(s));return r===a||k(o[n])})}function L_(e,t){if(!k(e)||!k(t))return!1;const n=ji(e,t.id);return k(n)?!1:(e.pages.push(t),!0)}function M_(e,t){const n=ji(e,t);if(k(e)&&k(n)){const r=Mt(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Ue(i)),n}}function _i(e,t){if(k(t)&&k(t.kind))return k(t.kinddata)||(t.kinddata=k(t.id)?fa(e,t.kind):wf(e,t.kind)),t.kinddata}function U_(e,t,n){const r=_i(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function F_(e,t,n,r,i){const s=_i(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function fa(e,t){const n=t??"",r=Nn(e,Et.OBJECT,n);if(k(r)){const i=un(r);return{...Xe(i),name:n,code:r.code}}}function wf(e,t){const n=t??"",r=Nn(e,Et.TERRAIN,n);if(k(r)){const i=un(r);return{...Xe(i),name:n,code:r.code}}}function so(e,t){const n=ji(e,t);return un(n)}function bi(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function B_(e,t){e&&delete e.flags[t]}function P_(e,t,n){const r=bi(e,t);return r==null?void 0:r[n]}function kC(e,t,n,r){const i=bi(e,t);return i&&(i[n]=r),r}function gs(e,t){const n=P_(e,t,"board");return so(e,St(n)?n:"")}function xC(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function yl(e,t,n){if(!k(e))return;kC(e,t,"board",n);const r=so(e,n);k(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function da(e,t,n,r){if(!k(e))return;const i=gs(e,t);if(!k(i))return;const s=Ln(i,t);if(!Ac(s)||!(s!=null&&s.id))return;const o=so(e,n);if(!k(o)||(yr(e,o),xf(e,o,Ht.ISWALK,r)))return;delete i.objects[s.id];const a=Zr(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Zr(o,s);o.lookup&&(o.lookup[c]=s.id),yl(e,t,o.id)}function TC(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=P_(e,r,"board");return St(i)?i:""});return Fx(n)}function kf(e){return TC(e).map(n=>so(e,n)).filter(k)}function xf(e,t,n,r){if(!k(e)||!k(t)||!k(t.lookup)||r.x<0||r.x>=Wt||r.y<0||r.y>=xe)return!0;const i=r.x+r.y*Wt,s=Ln(t,t.lookup[i]??"404");if(k(s))return!0;const o=t.terrain[i];if(k(o)){const a=_i(e,o),c=o.collision??(a==null?void 0:a.collision);return th(n,c)}return!1}function AC(e,t,n,r){const i=Ln(t,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=U_(e,i,"collision");return xf(e,t,a,r)}function D_(e,t,n,r){var l,h;const i=Ln(t,(n==null?void 0:n.id)??"");if(!k(e)||!k(t)||!k(i)||!k(i.x)||!k(i.y)||!k(t.lookup)||r.x<0||r.x>=Wt||r.y<0||r.y>=xe)return{name:"edge",kind:"edge",collision:Ht.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Zr(t,i),o=Zr(t,r),a=i.collision??((l=i==null?void 0:i.kinddata)==null?void 0:l.collision)??Ht.ISWALK,c=Ln(t,t.lookup[o]??"");if(k(c))return{...c};const u=t.terrain[o];if(k(u)){const f=u.collision??((h=u==null?void 0:u.kinddata)==null?void 0:h.collision)??Ht.ISWALK;if(th(a,f))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,k(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function Tf(e,t,n,r){var s;if(!k(e)||!k(t)||!k(t.named)||!k(n))return;const i=Mt(n.name??((s=n.kinddata)==null?void 0:s.name)??"");t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function vC(e,t,n){if(!(!k(e)||!k(t)||!k(t.lookup)||!k(n==null?void 0:n.id))&&!k(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*Wt]=n.id}}function yr(e,t){var a;if(!k(e)||!k(t)||k(t.lookup)&&k(t.named))return;const n=new Array(Wt*xe).fill(void 0),r={},i=Object.values(t.objects);for(let c=0;c<i.length;++c){const u=i[c];if(k(u.x)&&k(u.y)&&k(u.id)&&!k(u.removed)){u.category=Gn.ISOBJECT,n[u.x+u.y*Wt]=u.id;const l=Mt(u.name??((a=u.kinddata)==null?void 0:a.name)??"");r[l]||(r[l]=new Set),r[l].add(u.id)}}let s=0,o=0;for(let c=0;c<t.terrain.length;++c){const u=t.terrain[c];if(k(u)){u.x=s,u.y=o,u.category=Gn.ISTERRAIN;const l=Ur(u);r[l]||(r[l]=new Set),r[l].add(c)}++s,s>=Wt&&(s=0,++o)}t.lookup=n,t.named=r}function Yr(e,t,n,r){return!k(n)||Ur(n)==="player"?!1:(n.id?(n.removed=r,Af(e,t,n)):(kr(t,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),SC(e,t,n)),!0)}function SC(e,t,n){var r;if(k(e)&&k(t)&&k(n==null?void 0:n.x)&&k(n.y)){const i=Ur(n),s=Zr(t,n);k((r=t.named)==null?void 0:r[i])&&t.named[i].delete(s)}}function Af(e,t,n){var r;if(k(e)&&k(t)&&k(n==null?void 0:n.id)){if(k(t.lookup)&&k(n.x)&&k(n.y)){const s=n.x+n.y*Wt;t.lookup[s]===n.id&&(t.lookup[s]=void 0)}const i=Ur(n);k((r=t.named)==null?void 0:r[i])&&k(n.id)&&t.named[i].delete(n.id)}}function RC(e,t,n){const r=[];if(!k(e)||!k(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];k(o.id)&&k(o.removed)&&n-o.removed>Oa*5&&(r.push(o.id),j1(t,o.id))}return r}function IC(e,t,n){const r=[];if(!k(e)||!k(t))return r;t.lookup=void 0,yr(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!k(a.id))continue;a.lx=a.x,a.ly=a.y;const c=_i(e,a),u=a.code??(c==null?void 0:c.code)??"";u&&r.push({id:a.id,type:Et.OBJECT,code:u,object:a,terrain:void 0})}const s=RC(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:Et.ERROR,code:"",object:void 0,terrain:void 0});return r}function OC(e,t,n,r){if(k(e)&&k(t)&&k(n)){const[i,s]=n,o=fa(e,i);if(k(o)&&k(o.name)){const a=ed(t,r,i);return vc(a,s),a}}}function pa(e,t,n,r,i){if(k(e)&&k(t)&&k(n)){const[s,o]=n,a=wf(e,s);if(k(a)){const u=YL(t,r,s);if(k(u)){vc(u,o);const l=ac(r,Wt);return Tf(e,t,u,l),u}}const c=fa(e,s);if(k(c)&&k(c.name)){const u=ed(t,r,s,i);if(k(u))return vc(u,o),vC(e,t,u),Tf(e,t,u),u}}}const zi="$dkpurple",NC="$196",CC="$205";function bn(e,t){return`$${e}${t}$blue`}function $_(e,t){return`$${e}${t}$ondkblue`}function zt(e,t){xr(e,t)}function LC(e,t){const n=NC.repeat(t);zt(e,`${zi}${n}`)}function vf(e,t){const n=CC.repeat(t);zt(e,`${zi}${n}`)}function ys(e,t){zt(e,`${zi} ${" ".repeat(t.length)} `),LC(e,t.length+2),zt(e,`${zi} $white${t} `),vf(e,t.length+2)}function Vr(e,t){zt(e,`${zi} ${" ".repeat(t.length)} `),zt(e,`${zi} $gray${t} `),vf(e,t.length+2)}function ee(e,t,n){zt(e,`${zi} $white${t} $blue${n}`)}function se(e,t){zt(e,`${zi}$blue${t}`)}function j_(e){return`zss_snapshot_${e}`}function z_(e){const t=Kn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Ur(r)==="player"&&delete e[t[n]]}return e}function MC(e){const t=Kn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Ur(r)!=="player"&&delete e[t[n]]}return e}function UC(e){const t=Nn(T.book,Et.BOARD,e),n=un(t);if(!k(n))return;const r=j_(n.id);M_(T.book,r);const i=Gi(Dt.CONTENT,r,Et.BOARD),s=un(i);k(s)&&(s.terrain=Xe(n.terrain),s.objects=z_(Xe(n.objects)),zt(z,`snapshot of ${Ue(t)} created as ${Ue(i)}`))}function FC(e){const t=Nn(T.book,Et.BOARD,e),n=un(t);if(!k(n))return;const r=j_(n.id),i=Nn(T.book,Et.BOARD,r),s=un(i);k(s)&&(n.terrain=Xe(s.terrain),n.objects={...z_(Xe(s.objects)),...MC(Xe(n.objects))})}function W_(e,t,n=3,r=1,i=64){const s=Nn(T.book,Et.BOARD,e),o=Nn(T.book,Et.BOARD,t),a=un(s),c=un(o);if(!k(a)||!k(c))return;yr(T.book,a),yr(T.book,c);let u=0;const l=new Map,h=new Map;let f=0;const d=32,p=new Uint8Array(pT*4);for(let x=0;x<xe;++x)for(let A=0;A<Wt;++A){const I=or(c,{x:A,y:x}),U=(I==null?void 0:I.char)??0,S=(I==null?void 0:I.color)??d,O=(I==null?void 0:I.bg)??d;p[f++]=U,p[f++]=S,p[f++]=O;const B=_i(T.book,I),C=Mt((B==null?void 0:B.name)??"empty"),G=l.get(C);Ct(G)?p[f++]=G:(l.set(C,u),h.set(u,C),p[f++]=u++)}const m=new aT.OverlappingModel(p,Wt,xe,n,Wt,xe,!1,!1,r,0);let w=0;for(;w<i&&!m.generate();++w);if(w===i){ae(z,"boardremix",`failed to generate after ${i} tries`);return}f=0;const E=m.graphics();for(let x=0;x<xe;++x)for(let A=0;A<Wt;++A){const I=E[f++],U=E[f++],S=E[f++];u=E[f++];const O=or(a,{x:A,y:x});Yr(T.book,a,O,T.timestamp),kr(a,{x:A,y:x});const B=h.get(u)??"",C=pa(T.book,a,[B],{x:A,y:x});if(k(C)&&(I>0&&(C.char=I),U<d&&(C.color=U),S<d&&(C.bg=S),Ac(C))){const G=cn(Vs(c,B));if(k(G)){const tt=Qf(c,G.x??0,G.y??0);kr(a,{...tt,x:A,y:x}),C.p1=G.p1,C.p2=G.p2,C.p3=G.p3,C.code=G.code,C.cycle=G.cycle,C.light=G.light,C.stepx=G.stepx,C.stepy=G.stepy,C.pushable=G.pushable,C.collision=G.collision,C.destructible=G.destructible}}}}const BC=L0(32,126).map(e=>String.fromCharCode(e)),PC=$n({name:"Whitespace",pattern:/ +/}),DC=$n({name:"WhitespaceSkipped",pattern:/ +/,group:Ge.SKIPPED}),Sf=$n({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),K_=$n({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:BC}),Rf=$n({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),If=$n({name:"EscapedDollar",pattern:"$$"}),Of=$n({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Nf=$n({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),G_=$n({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function $C(e,t=""){return $n({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const H_=Object.keys($o).map(e=>$C(`\\$(${e})`,e)),jC=[PC,Sf,...H_,Rf,K_,Nf,If,G_,Of],zC=new Ge(jC,{skipValidations:!Lr,ensureOptimizations:Lr}),WC=new Ge([DC,Sf,...H_,Rf,K_,Nf,If,G_,Of],{skipValidations:!Lr,ensureOptimizations:Lr});function Cf(e,t=!1){return t?WC.tokenize(e):zC.tokenize(e)}function Lf(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function Y_(e){e.active={...e.reset}}function V_(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case If:s("$");break;case Nf:if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r();break;case Rf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Sf:{t.x=t.active.leftedge??0,++t.y;break}default:{const u=c.tokenType.name,l=$o[u],h=cT(jt[l]),f=lT(jt[l]);l==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):k(h)?t.active.color=h:k(f)?t.active.bg=f:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(k(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){Y_(t);const u=String.fromCharCode(t.writefullwidth).repeat(c),l=t.x+t.y*t.width;GC(l,l+u.length,t.active.color,t.active.bg,t),KC(l,u,t)}}}function X_(e,t,n){const r=Cf(e);r.tokens&&(V_(r.tokens,t),n&&Y_(t),t.changed())}function q_(e,t,n){const r=Cf(e);if(!r.tokens)return;const i=Lf(t,n,jt.WHITE,jt.BLACK);return i.measureonly=!0,V_(r.tokens,i),i.x>0&&++i.y,i}function KC(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function GC(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function J_(e,t,n){if(!mo(T.element))return 0;const[r,i]=it(t,0,[V.DIR,V.MAYBE_KIND]),s=i??["bullet"],o=OC(T.book,T.board,s,{x:T.element.x,y:T.element.y});if(k(o)){k(n)&&(o.arg=n),o.party=T.elementid,o.collision=Ht.ISBULLET,o.destructible=1,o.stepx=r.x-T.element.x,o.stepy=r.y-T.element.y,o.bg=jt.ONCLEAR;const a=_i(T.book,o),c=o.code??(a==null?void 0:a.code)??"";F1(T.book,T.board,o,c,1)}return e.yield(),0}function _l(e,t,n,r){var h,f;if(!mo(T.element)||!k(T.book)||!k(T.board)||!k(T.element))return 0;yr(T.book,T.board);const[i,s]=it(t,0,[V.DIR,V.KIND]),o=or(T.board,i);if((o==null?void 0:o.category)===Gn.ISOBJECT&&(o!=null&&o.pushable)){const d={x:((h=T.element)==null?void 0:h.x)??0,y:((f=T.element)==null?void 0:f.y)??0},p=Ye(i,Hi(d,i));D_(T.book,T.board,o,p)}const[a]=s,c=fa(T.book,a)??wf(T.book,a),u=(c==null?void 0:c.collision)??Ht.ISWALK;if(!xf(T.book,T.board,u,i)){const d=pa(T.book,T.board,s,i,n);k(d)&&k(r)&&(d.arg=r)}return 0}const HC=li().command("remix",(e,t)=>{if(!k(T.book)||!k(T.board))return 0;const[n,r,i,s]=it(t,0,[V.NAME,V.MAYBE_NUMBER,V.MAYBE_NUMBER,V.MAYBE_NUMBER]),o=Hr(T.book,Et.BOARD,n),a=cn(...o);return k(a)&&W_(T.board.id,a.id,r,i,s),0}).command("remixonly",(e,t)=>{if(!k(T.book)||!k(T.board))return 0;const[n,r,i,s,o,a,c,u]=it(t,0,[V.NAME,V.NUMBER,V.NUMBER,V.NUMBER,V.NUMBER,V.MAYBE_NUMBER,V.MAYBE_NUMBER,V.MAYBE_NUMBER]),l=Hr(T.book,Et.BOARD,n),h=cn(...l);return k(h)&&W_(T.board.id,h.id),0}).command("board",(e,t)=>{if(!k(T.book)||!k(T.board))return 0;const[n,r]=it(t,0,[V.NAME]);switch(Mt(n)){case"snapshot":UC(T.board.id);break;case"restart":FC(T.board.id);break;default:{const[i,s]=it(t,r,[V.MAYBE_NUMBER,V.MAYBE_NUMBER]),o=Hr(T.book,Et.BOARD,n);if(o.length){const a=cn(...o);k(a)&&da(T.book,T.elementfocus,a.id,{x:i??Math.round(Wt*.5),y:s??Math.round(xe*.5)})}break}}return 0}).command("edge",(e,t)=>{var s,o;if(!k(T.book)||!k(T.board)||!k(T.element))return 0;const[n,r]=it(t,0,[V.DIR,V.NAME]),i=Hr(T.book,Et.BOARD,r);if(i.length){const a={x:((s=T.element)==null?void 0:s.x)??0,y:((o=T.element)==null?void 0:o.y)??0},c=Hi(a,n),u=cn(...i);switch(c){case yt.NORTH:T.board.exitnorth=u.id;break;case yt.SOUTH:T.board.exitsouth=u.id;break;case yt.WEST:T.board.exitwest=u.id;break;case yt.EAST:T.board.exiteast=u.id;break}}return 0}).command("shove",(e,t)=>{if(!k(T.book)||!k(T.board))return 0;yr(T.book,T.board);const[n,r]=it(t,0,[V.DIR,V.DIR]),i=or(T.board,n);return Ac(i)&&Vf(T.book,T.board,i,r),0}).command("duplicate",()=>(!k(T.book)||!k(T.board),0)).command("replace",(e,t)=>{if(!k(T.book)||!k(T.board))return 0;yr(T.book,T.board);const[n,r]=it(t,0,[V.DIR,V.KIND]),i=or(T.board,n);return Ac(i)&&Yr(T.book,T.board,i,T.timestamp),pa(T.book,T.board,r,n),0}).command("write",(e,t)=>{var u;if(!k(T.book)||!k(T.board))return 0;yr(T.book,T.board);const[n,r,i]=it(t,0,[V.DIR,V.COLOR,V.STRING]),{color:s,bg:o}=H0(r),a=((u=q_(i,256,1))==null?void 0:u.measuredwidth)??1,c=Lf(256,1,s??jt.WHITE,o??jt.BLACK);X_(i,c,!1);for(let l=0;l<a;++l){const h=kr(T.board,{x:n.x+l,y:n.y,char:c.char[l],color:c.color[l],bg:c.bg[l]});if(k(h)){const f=(h.x??0)+(h.y??0)*Wt;Tf(T.book,T.board,h,f)}}return 0}).command("change",(e,t)=>{if(!k(T.book)||!k(T.board))return 0;yr(T.book,T.board);const[n,r]=it(t,0,[V.KIND,V.KIND]),i=mc(n)??"",s=Vs(T.board,i),o=q0(s,n),a=mc(r),c=V0(r),u=X0(r);return o.forEach(l=>{if(Ur(l)===a)k(c)&&(l.color=c),k(u)&&(l.bg=u);else{if(k(l.id)&&Yr(T.book,T.board,l,T.timestamp))return 0;mo(l)&&pa(T.book,T.board,r,l)}}),0}).command("putwith",(e,t)=>{const[n,r]=it(t,0,[V.ANY]);return _l(e,t.slice(r),void 0,n)}).command("put",(e,t)=>_l(e,t)).command("oneof",(e,t)=>{const[n,r]=it(t,0,[V.ANY]);return k(T.board)&&Ln(T.board,n)?0:_l(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=it(t,0,[V.ANY,V.ANY]);return k(T.board)&&Ln(T.board,r)?0:_l(e,t.slice(i),r,n)}).command("shootwith",(e,t)=>{const[n,r]=it(t,0,[V.ANY]);return J_(e,t.slice(r),n)}).command("shoot",J_);function Z_(e){const[t,n]=e.split(":"),r=k(n);return[r?t:"self",r?n:e]}const YC=navigator.userAgent.includes("Mac")?"cmd":"ctrl";function ma(){vd(z,ki())}const VC=li().command("send",(e,t)=>{const[n,r]=it(t,0,[V.NAME,V.ANY]);switch(Mt(n)){case"helpmenu":ys(z,"H E L P"),zt(z,""),ee(z,"#help controls","zss controls and inputs"),zt(z,"!helpcontrols;read help controls"),zt(z,""),ee(z,"#help text","text formatting"),zt(z,"!helptext;read help text"),zt(z,""),ee(z,"#help developer","developer commands"),zt(z,"!helpdeveloper;read help developer"),zt(z,""),ee(z,"#help player","player settings"),zt(z,"!helpplayer;read help player"),Vr(z,"keyboard input"),ee(z,"?","open console"),ee(z,"esc","close console"),ee(z,"tab","move console"),ee(z,"up / down arrow keys","navigate console items"),ee(z,"left / right arrow keys","change console items"),ee(z,"enter","interact with console items"),ee(z,"alt + arrow keys","skip words and console lines"),ee(z,`${YC} + up / down arrow keys`,"input history");break;case"helpcontrols":ys(z,"zss controls and inputs"),Vr(z,"keyboard input"),ee(z,"arrow keys","move"),ee(z,"shift + arrow keys","shoot"),ee(z,"enter","ok / accept"),ee(z,"escape","cancel / close"),ee(z,"tab","menu / action"),Vr(z,"controller input"),ee(z,"left stick","move"),ee(z,"right stick","aim"),ee(z,"a","ok / accept"),ee(z,"b","cancel / close"),ee(z,"y","menu / action"),ee(z,"x","shoot"),ee(z,"triggers","shoot");break;case"helptext":ys(z,"text formatting"),Vr(z,"typography"),se(z,"plain text"),se(z,"$centering text"),se(z,'"\\"@quoted strings for special chars\\""'),se(z,"$$0-255 for ascii chars $159$176$240"),se(z,`use color names like ${bn("red","$$red")} to change foreground color`),se(z,`use color names like ${$_("ongreen","$$ongreen")} to change background color`),se(z,`use clear ${$_("onclear","to change background to")} transparent`),Vr(z,"hyperlinks"),se(z,`${bn("white",'"!hotkey"')} message shortcut;${bn("gray","Label")}`),se(z,`${bn("white",'"!range"')} flag [labelmin] [labelmax];${bn("gray","Input Label")}`),se(z,`${bn("white",'"!select"')} flag ...list of values;${bn("gray","Input Label")}`),se(z,`${bn("white",'"!number"')} flag [minvalue] [maxvalue];${bn("gray","Input Label")}`),se(z,`${bn("white",'"!text"')} flag;${bn("gray","Input Label")}`),se(z,`${bn("white",'"!copyit"')} flag;${bn("gray","Input Label")}`),se(z,`${bn("white",'"!openit"')} flag;${bn("gray","Input Label")}`);break;case"helpdeveloper":ys(z,"developer commands"),ee(z,"#books","list books in memory"),ee(z,"#pages","list pages in opened book"),ee(z,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),ee(z,"#trash","list books and pages from open book you can delete"),ee(z,"#save","flush state to register"),ee(z,"#share","creates a click to copy share url and QR code");break;case"helpplayer":ys(z,"player settings"),se(z,"todo");break;default:{const[i,s]=Z_(n);Xf(i==="self"&&T.elementisplayer?`${T.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(ke),s=i.join(" ");switch(Mt(r)){case jn(wt.LOADER):n=Gi(Dt.CONTENT,s,Et.LOADER);break;default:n=Gi(Dt.CONTENT,[r,...i].join(" "),Et.OBJECT);break;case jn(wt.BOARD):n=Gi(Dt.CONTENT,s,Et.BOARD);break;case jn(wt.OBJECT):n=Gi(Dt.CONTENT,s,Et.OBJECT);break;case jn(wt.TERRAIN):n=Gi(Dt.CONTENT,s,Et.TERRAIN);break;case jn(wt.CHARSET):n=Gi(Dt.CONTENT,s,Et.CHARSET);break;case jn(wt.PALETTE):n=Gi(Dt.CONTENT,s,Et.PALETTE);break}return k(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(ke).join(" ");return xr(z,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=ke(n),s=r.map(ke).join(" ");return xr(z,`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=it(t,0,[V.MAYBE_NAME]),r=L1(n);return k(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=br(n);return k(r)?(se(z,`opened [book] ${r.name}`),Nl(Dt.MAIN,r.id),e.command("pages")):ae(z,"bookopen",`book ${n} not found`,T.elementfocus),0}).command("booktrash",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=me(Dt.MAIN),i=br(n);return k(i)&&(r===i&&Nl(Dt.MAIN,""),OL(n),se(z,`trashed [book] ${i.name}`),ma(),e.command("pages")),0}).command("pageopen",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=Wn(Dt.MAIN);if(!k(r))return 0;const i=ji(r,n);if(k(i)){const s=Ue(i),o=ps(i);se(z,`opened [${o}] ${s}`),Ku(Ia(r.id,[i.id]),i.code);const a=ps(i);Td(z,r.id,[i.id],a,`${s} - ${r.name}`,T.elementfocus)}else ae(z,"pageopen",`page ${n} not found`,T.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=Wn(Dt.MAIN),i=M_(r,n);if(k(n)){const s=Ue(i),o=ps(i);se(z,`trashed [${o}] ${s}`),ma(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(ke).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Vr(z,"books");const e=me(Dt.MAIN);ee(z,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=me(Dt.CONTENT);ee(z,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),vf(z,7);const n=po();return n.length?n.forEach(r=>{zt(z,`!bookopen ${r.id};${r.name}`)}):se(z,"no books found"),zt(z,"!bookcreate;create a new book"),0}).command("pages",()=>{Vr(z,"pages");const e=Wn(Dt.MAIN);return k(e)&&(ee(z,"main",`${e.name} $GREEN${e.id}`),e.pages.length?[...e.pages].sort((n,r)=>{const i=Gr(n),s=Gr(r);return i===s?Ue(n).localeCompare(Ue(r)):s-i}).forEach(n=>{const r=Ue(n),i=ps(n);zt(z,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(zt(z,""),se(z,"no pages found"),se(z,"use @ to create a page"),se(z,"@board name of board"),se(z,"@object name of object"),se(z,"@terrain name of terrain"),se(z,"You can omit the type and it will default to object"),se(z,"@object name of object"),se(z,"@name of object"))),0}).command("trash",()=>{Vr(z,"$REDTRASH"),se(z,"books");const e=po();e.length&&(e.forEach(n=>{zt(z,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),zt(z,""));const t=me(Dt.MAIN);return k(t)&&(se(z,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Ue(n);zt(z,`!pagetrash ${n.id};$REDTRASH ${r}`)}),zt(z,"")),0}).command("dev",()=>(ma(),nE(z,T.elementfocus),0)).command("share",()=>(ma(),rE(z,T.elementfocus),0)).command("save",()=>(ma(),0)).command("fork",()=>(mE(z,T.elementfocus),0)).command("nuke",()=>(iE(z,T.elementfocus),0)).command("restart",()=>(pE(z,T.elementfocus),0)).command("export",()=>{ys(z,"E X P O R T"),Vr(z,"books");const e=po();return e.length&&e.forEach(t=>zt(z,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=br(n);return k(r)&&(ys(z,"E X P O R T"),Vr(z,"pages"),setTimeout(()=>{if(r.pages.length){const i=Xe(r.pages).sort((s,o)=>{const a=Gr(s),c=Gr(o);return a===c?Ue(s).localeCompare(Ue(o)):c-a});zt(z,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Ue(s),a=ps(s);zt(z,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=br(n);return k(r)&&wd(z,Xe(r),`${r.name}.book.json`,T.elementfocus),0}).command("pageexport",(e,t)=>{const[n]=it(t,0,[V.NAME]),{target:r,path:i}=Xi(n),s=br(r),o=ji(s,i);return k(o)&&wd(z,Xe(o),`${Ue(o)}.${ps(o)}.json`,T.elementfocus),0}).command("gadget",()=>(fE(z,void 0,T.elementfocus),0)).command("joincode",(e,t)=>{const[n]=it(t,0,[V.MAYBE_NAME]);return Xb(z,!!n,T.elementfocus),0}).command("jointab",(e,t)=>{const[n]=it(t,0,[V.MAYBE_NAME]);return qb(z,!!n,T.elementfocus),0}).command("twitchbroadcast",(e,t)=>{const[n]=it(t,0,[V.NAME]);switch(Mt(n)){default:jb(z,n,T.elementfocus);break;case"stop":zb(z,T.elementfocus);break}return 0}),XC=li().command("palette",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=M1(),i=Nn(T.book,Et.PALETTE,n);return k(i)?(r.palette=i.id,zt(z,`loaded palette ${n}`)):ae(z,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=M1(),i=Nn(T.book,Et.CHARSET,n);return k(i)?(r.charset=i.id,zt(z,`loaded charset ${n}`)):ae(z,"not-found",`unabled to find charset ${n}`),0}),Mf={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Xr(e){return re(e)&&Q_(e[0])}function Q_(e){return k(Gn[e])&&St(e)}function t1(e){if(St(e))return Mf[Mt(e)]}function e1(e){if(Xr(e))return e;if(Q_(e))return[e];const t=t1(e);if(k(t))return[t]}function bl(e){const t=T.words[e],n=e1(t);if(Xr(n))return[n,e+1];const[r,i]=fn(e),s=e1(r);return Xr(s)?[s,i]:[void 0,e]}const Uf={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Ht.ISSOLID,Ht.ISWALK,Ht.ISSWIM,Ht.ISBULLET,Ht.ISWALK,Ht.ISSWIM;function Ei(e){return re(e)&&Ff(e[0])}function Ff(e){return k(Ht[e])&&St(e)}function qC(e){if(St(e))return Uf[Mt(e)]}function n1(e){const t=T.words[e];if(Ei(t))return[t,e+1];if(Ff(t))return[[t],e+1];const[n,r]=fn(e);return Ei(n)?[n,r]:Ff(n)?[[n],r]:[void 0,e]}const JC=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),r1=new Set(["party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),ZC=["NORTH","SOUTH","WEST","EAST"];function QC(e){const t=Es(e);if(Ct(t.inputcurrent)||(t.inputcurrent=0),re(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=mn.NONE,i=0]=n??[mn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&Vx?1:0,t.inputctrl=i&Xx?1:0,t.inputshift=i&qx?1:0,r){case mn.MOVE_UP:case mn.MOVE_DOWN:case mn.MOVE_LEFT:case mn.MOVE_RIGHT:t.inputmove=[ZC[r-mn.MOVE_UP]];break;case mn.OK_BUTTON:t.inputok=1;break;case mn.CANCEL_BUTTON:t.inputcancel=1;break;case mn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==mn.NONE&&o!==r}),t}function t4(e){const t=Mf[e];if(k(t))return t;const n=Uf[e];if(k(n))return n;const r=$o[e];if(k(r))return r;const i=qf[e];if(k(i))return i}const e4=li({get(e,t){var o,a,c,u,l,h,f,d,p,m,w,E,x,A,I,U,S;const n=t4(t);if(k(n))return[!0,n];if(T.elementisplayer&&JC.has(t)){const O=QC(T.elementid)[t];return[k(O),O]}const r=gc(T.board,T.element,T.elementfocus),i=(r==null?void 0:r.id)??T.elementfocus;switch(t){case"isdark":return[!0,(o=T.board)!=null&&o.isdark?1:0];case"startx":return[!0,((a=T.board)==null?void 0:a.startx)??0];case"starty":return[!0,((c=T.board)==null?void 0:c.starty)??0];case"over":return[!0,((u=T.board)==null?void 0:u.over)??""];case"under":return[!0,((l=T.board)==null?void 0:l.under)??""];case"exitnorth":return[!0,((h=T.board)==null?void 0:h.exitnorth)??""];case"exitsouth":return[!0,((f=T.board)==null?void 0:f.exitsouth)??""];case"exitwest":return[!0,((d=T.board)==null?void 0:d.exitwest)??""];case"exiteast":return[!0,((p=T.board)==null?void 0:p.exiteast)??""];case"timelimit":return[!0,((m=T.board)==null?void 0:m.timelimit)??0];case"restartonzap":return[!0,((w=T.board)==null?void 0:w.restartonzap)??0];case"maxplayershots":return[!0,((E=T.board)==null?void 0:E.maxplayershots)??0];case"boardid":return[!0,((x=T.board)==null?void 0:x.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((A=T.element)==null?void 0:A.id)??""];case"thisx":return[!0,((I=T.element)==null?void 0:I.x)??-1];case"thisy":return[!0,((U=T.element)==null?void 0:U.y)??-1];default:{const O=(S=T.element)==null?void 0:S[t];if(r1.has(t))return[!0,O];break}}const s=Es(i)[t];return[k(s),s]},set(e,t,n){const r=gc(T.board,T.element,T.elementfocus),i=(r==null?void 0:r.id)??T.elementfocus;switch(t){case"isdark":k(T.board)&&(T.board.isdark=n?1:0);break;case"startx":k(T.board)&&(T.board.startx=Do(n,0));break;case"starty":k(T.board)&&(T.board.starty=Do(n,0));break;case"over":k(T.board)&&(T.board.over=ke(n));break;case"under":k(T.board)&&(T.board.under=ke(n));break;case"exitnorth":k(T.board)&&(T.board.exitnorth=ke(n));break;case"exitsouth":k(T.board)&&(T.board.exitsouth=ke(n));break;case"exitwest":k(T.board)&&(T.board.exitwest=ke(n));break;case"exiteast":k(T.board)&&(T.board.exiteast=ke(n));break;case"timelimit":k(T.board)&&(T.board.timelimit=Do(n,0));break;case"restartonzap":k(T.board)&&(T.board.restartonzap=n?1:0);break;case"maxplayershots":k(T.board)&&(T.board.maxplayershots=Do(n,0));break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(r1.has(t))return k(T.element)&&(T.element[t]=n),[!0,n];break}}const s=Es(i);return k(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=T.element)!=null&&e.removed)&&(k((t=T.element)==null?void 0:t.stepx)||k((n=T.element)==null?void 0:n.stepy))){const s={x:((r=T.element)==null?void 0:r.x)??0,y:((i=T.element)==null?void 0:i.y)??0};Vf(T.book,T.board,T.element,{x:s.x+(T.element.stepx??0),y:s.y+(T.element.stepy??0)})===!1&&(T.element.stepx=0,T.element.stepy=0,U_(T.book,T.element,"destructible")&&Yr(T.book,T.board,T.element,T.timestamp))}}}).command("clear",(e,t)=>(t.forEach(n=>e.set(ke(n),0)),0)).command("set",(e,t)=>{const[n,r]=it(t,0,[V.NAME,V.ANY]);return e.set(n,r),0}).command("become",(e,t)=>{var r,i;const[n]=it(t,0,[V.KIND]);if(yr(T.book,T.board),Af(T.book,T.board,T.element),Yr(T.book,T.board,T.element,T.timestamp)){const s={x:((r=T.element)==null?void 0:r.x)??0,y:((i=T.element)==null?void 0:i.y)??0};pa(T.book,T.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return k(T.element)&&(T.element.char=n),0}).command("color",(e,t)=>{const[n]=it(t,0,[V.COLOR]);return k(T.element)&&k(n)&&vc(T.element,n),0}).command("go",(e,t)=>{if(k(T.element)){const[n]=it(t,0,[V.DIR]);if(Vf(T.book,T.board,T.element,n),e.yield(),T.element.x===n.x&&T.element.y===n.y)return 0}return 1}).command("walk",(e,t)=>{if(!k(T.element))return 0;const[n]=it(t,0,[V.DIR]),r=T.element.x??0,i=T.element.y??0;return T.element.stepx=n.x-r,T.element.stepy=n.y-i,0}),n4=li().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=it(t,0,[V.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(ke(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(ke(t[0])),0)).command("cycle",(e,t)=>{if(k(T.element)){const[n]=it(t,0,[V.NUMBER]);T.element.cycle=Bn(Math.round(n),1,255)}return 0}).command("die",e=>(Yr(T.book,T.board,T.element,T.timestamp),e.endofprogram(),0)).command("endgame",()=>(T.elementisplayer&&Ad(z,T.elementid),0)).command("run",(e,t)=>{const[n]=it(t,0,[V.NAME]);return Cl(n),0}).command("runwith",(e,t)=>{const[n,r]=it(t,0,[V.ANY,V.NAME]);return e.set("arg",n),Cl(r),0}),El={};function r4(e){var t;return(t=El[e])==null?void 0:t.arg}function i4(e){var t;return(t=El[e])==null?void 0:t.format}function oo(e){var t;return(t=El[e])==null?void 0:t.content}function s4(e,t,n,r,i){const s=me(Dt.MAIN);if(!k(s))return;const o=ms(s,Et.LOADER).filter(a=>{const c=ds(a),u=c.format,l=St(u)?new RegExp(u).test(t):!1,h=c.event,f=St(h)?new RegExp(h).test(n):!1;return St(u)&&St(h)?l&&f:St(u)?l:St(h)?f:!1});for(let a=0;a<o.length;++a){const c=`${Ne()}_loader`;El[c]={arg:e,format:t,content:r,player:i},UL(c,o[a].code)}}function i1(e,t){if(!k(e))return;const n=Mt(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const o4=(e,t)=>{const n=oo(e.id());if(!k(n))return 0;const[r,i]=it(t,0,[V.NAME]),s=Mt(r);switch(s){case"seek":{const[o]=it(t,i,[V.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=it(t,i,[V.NAME]);e.set(o,i1(n,s));break}case"text":{const[o,a]=it(t,i,[V.NAME,V.NAME]),c=i1(n,o);if(Ct(c)&&St(a)){const u=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(u);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=it(t,i,[V.NAME]),a=Ef(T.book,Et.PALETTE,o),c=un(a);if(k(c)){const u=jx*lc,l=vm(new Uint8Array(n.bytes.buffer,n.cursor,u));k(l)&&(c.bits=l.bits),n.cursor+=u}break}case"charset":{const[o]=it(t,i,[V.NAME]),a=Ef(T.book,Et.CHARSET,o),c=un(a);if(k(c)){const u=fc*$x*Zu,l=Sm(new Uint8Array(n.bytes.buffer,n.cursor,u));k(l)&&(c.bits=l.bits),n.cursor+=u}break}}return 0},ao=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",wl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!wl(e[n],t[n]))return!1;return!0}if(ao(e)&&ao(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!wl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},kl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(ao(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},a4=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",s1=e=>e>="0"&&e<="9"||e==="-",c4=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var X;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(X||(X={}));const o1={"(":X.TOK_LPAREN,")":X.TOK_RPAREN,"*":X.TOK_STAR,",":X.TOK_COMMA,".":X.TOK_DOT,":":X.TOK_COLON,"@":X.TOK_CURRENT,$:X.TOK_ROOT,"]":X.TOK_RBRACKET,"{":X.TOK_LBRACE,"}":X.TOK_RBRACE},l4={"!":!0,"<":!0,"=":!0,">":!0},u4={"	":!0,"\n":!0,"\r":!0," ":!0};class h4{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(a4(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:X.TOK_UNQUOTEDIDENTIFIER,value:i});else if(o1[t[this._current]]!==void 0)n.push({start:this._current,type:o1[t[this._current]],value:t[this._current]}),this._current+=1;else if(s1(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:X.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:X.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:X.TOK_LITERAL,value:o})}else if(l4[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(u4[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:X.TOK_AND,value:"&&"})):n.push({start:r,type:X.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:X.TOK_OR,value:"||"})):n.push({start:r,type:X.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&c4(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;s1(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:X.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:X.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:X.TOK_FLATTEN,value:"[]"}):{start:n,type:X.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_NE,value:"!="}):{start:n,type:X.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_LTE,value:"<="}):{start:n,type:X.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_GTE,value:">="}):{start:n,type:X.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:X.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const f4=new h4,hn={[X.TOK_EOF]:0,[X.TOK_UNQUOTEDIDENTIFIER]:0,[X.TOK_QUOTEDIDENTIFIER]:0,[X.TOK_RBRACKET]:0,[X.TOK_RPAREN]:0,[X.TOK_COMMA]:0,[X.TOK_RBRACE]:0,[X.TOK_NUMBER]:0,[X.TOK_CURRENT]:0,[X.TOK_EXPREF]:0,[X.TOK_ROOT]:0,[X.TOK_PIPE]:1,[X.TOK_OR]:2,[X.TOK_AND]:3,[X.TOK_EQ]:5,[X.TOK_GT]:5,[X.TOK_LT]:5,[X.TOK_GTE]:5,[X.TOK_LTE]:5,[X.TOK_NE]:5,[X.TOK_FLATTEN]:9,[X.TOK_STAR]:20,[X.TOK_FILTER]:21,[X.TOK_DOT]:40,[X.TOK_NOT]:45,[X.TOK_LBRACE]:50,[X.TOK_LBRACKET]:55,[X.TOK_LPAREN]:60};class d4{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==X.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...f4.tokenize(t),{type:X.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<hn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case X.TOK_LITERAL:return{type:"Literal",value:t.value};case X.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case X.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===X.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case X.TOK_NOT:return r=this.expression(hn.Not),{type:"NotExpression",children:[r]};case X.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===X.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(hn.Star),{type:"ValueProjection",children:[n,r]};case X.TOK_FILTER:return this.led(t.type,{type:"Identity"});case X.TOK_LBRACE:return this.parseMultiselectHash();case X.TOK_FLATTEN:return n={type:X.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(hn.Flatten),{type:"Projection",children:[n,r]};case X.TOK_LBRACKET:return this.lookahead(0)===X.TOK_NUMBER||this.lookahead(0)===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===X.TOK_STAR&&this.lookahead(1)===X.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(hn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case X.TOK_CURRENT:return{type:X.TOK_CURRENT};case X.TOK_ROOT:return{type:X.TOK_ROOT};case X.TOK_EXPREF:return i=this.expression(hn.Expref),{type:"ExpressionReference",children:[i]};case X.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(i={type:X.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(X.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case X.TOK_DOT:const i=hn.Dot;return this.lookahead(0)!==X.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case X.TOK_PIPE:return r=this.expression(hn.Pipe),{type:X.TOK_PIPE,children:[n,r]};case X.TOK_OR:return r=this.expression(hn.Or),{type:"OrExpression",children:[n,r]};case X.TOK_AND:return r=this.expression(hn.And),{type:"AndExpression",children:[n,r]};case X.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(a={type:X.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===X.TOK_COMMA&&this.match(X.TOK_COMMA),o.push(a);return this.match(X.TOK_RPAREN),{name:s,type:"Function",children:o};case X.TOK_FILTER:const u=this.expression(0);return this.match(X.TOK_RBRACKET),r=this.lookahead(0)===X.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(hn.Filter),{type:"FilterProjection",children:[n,r,u]};case X.TOK_FLATTEN:const l={type:X.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(hn.Flatten);return{type:"Projection",children:[l,h]};case X.TOK_EQ:case X.TOK_NE:case X.TOK_GT:case X.TOK_GTE:case X.TOK_LT:case X.TOK_LTE:return this.parseComparator(n,t);case X.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===X.TOK_NUMBER||f.type===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(X.TOK_STAR),this.match(X.TOK_RBRACKET),r=this.parseProjectionRHS(hn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===X.TOK_COLON||this.lookahead(1)===X.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(X.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(hn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==X.TOK_RBRACKET&&n<3;){if(r===X.TOK_COLON)n+=1,this.advance();else if(r===X.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(X.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(hn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER,X.TOK_STAR].includes(n))return this.expression(t);if(n===X.TOK_LBRACKET)return this.match(X.TOK_LBRACKET),this.parseMultiselectList();if(n===X.TOK_LBRACE)return this.match(X.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(hn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===X.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===X.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===X.TOK_DOT)return this.match(X.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==X.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===X.TOK_COMMA&&(this.match(X.TOK_COMMA),this.lookahead(0)===X.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(X.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(X.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===X.TOK_COMMA)this.match(X.TOK_COMMA);else if(this.lookahead(0)===X.TOK_RBRACE){this.match(X.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const p4=new d4;var ut;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class m4{constructor(t){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>ao(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c>o&&(o=c,a=i[u]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c<o&&(o=c,a=i[u]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,u)=>{const l=i.visit(s,c[1]),h=i.visit(s,u[1]);if(this.getTypeName(l)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(l)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return l>h?1:l<h?-1:c[0]-u[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(m=>{var w;return(w=!m.optional)!==null&&w!==void 0?w:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,u=n.length<a,l=n.length>r.length,h=u&&(!c&&a>1||c)?"at least ":"";if(c&&u||!c&&(u||l))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let f,d,p;for(let m=0;m<r.length;m+=1){p=!1,f=r[m].types,d=this.getTypeName(n[m]);let w;for(w=0;w<f.length;w+=1)if(d!==void 0&&this.typeMatches(d,f[w],n[m])){p=!0;break}if(!p&&d!==void 0){const E=f.map(x=>this.TYPE_NAME_TABLE[x]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${m+1} to be type (${E}) but received type ${this.TYPE_NAME_TABLE[d]} instead.`)}}}typeMatches(t,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return t===ut.TYPE_ARRAY;if(t===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return t.jmespathType===X.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class g4{constructor(){this._rootValue=null,this.runtime=new m4(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,u,l,h,f,d;switch(t.type){case"Field":return n===null?null:ao(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),f=1;f<t.children.length;f+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return u=this.visit(t.children[0],n),l=this.visit(t.children[1],u),l;case"Index":if(!Array.isArray(n))return null;let p=t.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...t.children],w=this.computeSliceParams(n.length,m),[E,x,A]=w;if(s=[],A>0)for(f=E;f<x;f+=A)s.push(n[f]);else for(f=E;f>x;f+=A)s.push(n[f]);return s;case"Projection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;for(h=[],f=0;f<d.length;f+=1)i=this.visit(t.children[1],d[f]),i!==null&&h.push(i);return h;case"ValueProjection":if(d=this.visit(t.children[0],n),!ao(d))return null;h=[];const I=Object.values(d);for(f=0;f<I.length;f+=1)i=this.visit(t.children[1],I[f]),i!==null&&h.push(i);return h;case"FilterProjection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;const U=[],S=[];for(f=0;f<d.length;f+=1)r=this.visit(t.children[2],d[f]),kl(r)||U.push(d[f]);for(let L=0;L<U.length;L+=1)i=this.visit(t.children[1],U[L]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case X.TOK_EQ:s=wl(o,a);break;case X.TOK_NE:s=!wl(o,a);break;case X.TOK_GT:s=o>a;break;case X.TOK_GTE:s=o>=a;break;case X.TOK_LT:s=o<a;break;case X.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case X.TOK_FLATTEN:const O=this.visit(t.children[0],n);if(!Array.isArray(O))return null;let B=[];for(f=0;f<O.length;f+=1)i=O[f],Array.isArray(i)?B=[...B,...i]:B.push(i);return B;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],f=0;f<t.children.length;f+=1)h.push(this.visit(t.children[f],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let C;for(f=0;f<t.children.length;f+=1)C=t.children[f],h[C.name]=this.visit(C.value,n);return h;case"OrExpression":return r=this.visit(t.children[0],n),kl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),kl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),kl(o);case"Literal":return t.value;case X.TOK_PIPE:return u=this.visit(t.children[0],n),this.visit(t.children[1],u);case X.TOK_CURRENT:return n;case X.TOK_ROOT:return this._rootValue;case"Function":const G=[];for(let L=0;L<t.children.length;L+=1)G.push(this.visit(t.children[L],n));return this.runtime.callFunction(t.name,G);case"ExpressionReference":const tt=t.children[0];return tt.jmespathType=X.TOK_EXPREF,tt;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const y4=new g4;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function _4(e,t){const n=p4.parse(t);return y4.search(n,e)}const b4=(e,t)=>{const n=oo(e.id());if(!k(n))return 0;const[r,i]=it(t,0,[V.NAME,V.NAME]),s=_4(n.json,r);return e.set(i,s),0},E4=(e,t)=>{const n=oo(e.id());if(!k(n))return 0;const[r,i]=it(t,0,[V.NAME]);switch(Mt(r)){case"seek":{const[o]=it(t,i,[V.NUMBER]);n.cursor=Bn(o,0,n.lines.length-1);break}case"line":n.cursor=Bn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let u=1;for(let l=i;l<t.length;){const[h,f]=it(t,l,[V.NAME]);e.set(h,c[u]??0),++u,l=f}break}}return 0},w4=li({get(e,t){const n=i4(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=oo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=oo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=oo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=it(t,0,[V.NAME,V.ANY]);return Xf(n,r),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(ke).join(" ");return xr(z,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=ke(n),s=r.map(ke).join(" ");return xr(z,"$175",`!${s};${i}`),0}).command("txt",E4).command("json",b4).command("bin",o4).command("with",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=Hr(T.book,Et.BOARD,n);if(r.length){const i=cn(...r);k(i)&&(T.board=un(i),T.element={x:Li(0,Wt-1),y:Li(0,xe-1)})}return 0});function a1(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,u]=it(i,a,[V.ANY]);re(c)&&!wr(c)&&!Xr(c)&&!Ei(c)&&!Pn(c)?o.push(...c):o.push(c),a=u}switch(Mt(r)){case"get":case"post:json":Vb(z,e,t,n,r,o,T.elementfocus);break}return 0}const k4=li().command("fetch",(e,t)=>{const[n,r,i="get",s]=it(t,0,[V.NAME,V.NAME,V.MAYBE_STRING]);return a1(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=it(t,0,[V.ANY,V.NAME,V.NAME,V.MAYBE_STRING]);return a1(n,r,i,s,t,o),0}).command("twitchchat",(e,t)=>{const[n]=it(t,0,[V.ANY]);switch(Mt(n)){default:Wb(z,n,T.elementfocus);break;case"close":Kb(z,T.elementfocus);break}return 0}),x4=li({set(e,t,n){return tM(e,t,n),[!1,void 0]},everytick(){const e=Qr(T.elementid),[t]=e;if(e.length===1&&St(t)){if(k(T.element))if(t.trim().length===0){const n=wn(T.elementid);n.sidebar=[]}else T.element.tickertext=t,T.element.tickertime=T.timestamp}else if(e.length>1)if(T.elementisplayer){const n=wn(T.elementid);n.sidebar=e}else{const n=wn(T.elementfocus);n.scroll=e}}}).command("send",(e,t)=>{var c,u;const[n,r]=it(t,0,[V.NAME,V.ANY]),[i,s]=Z_(n);function o(l){for(let h=0;h<l.length;++h){const f=l[h];k(f.id)&&e.send(f.id,s,r)}}switch(Mt(i)){case"all":for(const l of Object.keys(((c=T.board)==null?void 0:c.objects)??{}))e.send(l,s,r);break;case"self":e.message({session:z.session(),id:Ne(),sender:e.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((u=T.board)==null?void 0:u.objects)??{}))l!==e.id()&&e.send(l,s,r);break;default:{o(J0(T.board,[i]));break}}return 0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(ke).join("");return ce(T.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=ke(n);return ne(T.elementid,e.id(),i,r,e.get,e.set),0});var Wi=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Wi||{});const T4={audio:Qu,board:HC,cli:VC,display:XC,element:e4,runtime:x4,lifecycle:n4,loader:w4,network:k4},Bf=["audio","board","display","network","lifecycle","element"],A4={0:[],1:["cli",...Bf],2:["loader",...Bf],3:["runtime",...Bf]},v4={0:new Map,1:new Map,2:new Map,3:new Map};function co(e){return(A4[e]??[]).map(n=>T4[n]).filter(k)}function Pf(e){const t=[],n=co(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function S4(e,t){const n=v4[e];if(!n.has(t)){let r;const i=co(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!k(r));++s);n.set(t,r)}return n.get(t)}function R4(e,t,n){const r=co(e);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(t,n);if(s)return[s,o]}return[!1,void 0]}function I4(e,t,n,r){const i=co(e);for(let s=0;s<i.length;++s){const[o]=i[s].set(t,n,r);if(o)return[o,r]}return[!1,void 0]}function O4(e,t){const n=co(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function c1(e,t){const n=co(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var l1={},u1={},h1={};const f1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");h1.encode=function(e){if(0<=e&&e<f1.length)return f1[e];throw new TypeError("Must be between 0 and 63: "+e)};const N4=h1,d1=5,p1=1<<d1,C4=p1-1,L4=p1;function M4(e){return e<0?(-e<<1)+1:(e<<1)+0}u1.encode=function(t){let n="",r,i=M4(t);do r=i&C4,i>>>=d1,i>0&&(r|=L4),n+=N4.encode(r);while(i>0);return n};var ga={};(function(e){function t(S,O,B){if(O in S)return S[O];if(arguments.length===3)return B;throw new Error('"'+O+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(S){const O=S.match(n);return O?{scheme:O[1],auth:O[2],host:O[3],port:O[4],path:O[5]}:null}e.urlParse=i;function s(S){let O="";return S.scheme&&(O+=S.scheme+":"),O+="//",S.auth&&(O+=S.auth+"@"),S.host&&(O+=S.host),S.port&&(O+=":"+S.port),S.path&&(O+=S.path),O}e.urlGenerate=s;const o=32;function a(S){const O=[];return function(B){for(let G=0;G<O.length;G++)if(O[G].input===B){const tt=O[0];return O[0]=O[G],O[G]=tt,O[0].result}const C=S(B);return O.unshift({input:B,result:C}),O.length>o&&O.pop(),C}}const c=a(function(O){let B=O;const C=i(O);if(C){if(!C.path)return O;B=C.path}const G=e.isAbsolute(B),tt=[];let L=0,R=0;for(;;)if(L=R,R=B.indexOf("/",L),R===-1){tt.push(B.slice(L));break}else for(tt.push(B.slice(L,R));R<B.length&&B[R]==="/";)R++;let _=0;for(R=tt.length-1;R>=0;R--){const P=tt[R];P==="."?tt.splice(R,1):P===".."?_++:_>0&&(P===""?(tt.splice(R+1,_),_=0):(tt.splice(R,2),_--))}return B=tt.join("/"),B===""&&(B=G?"/":"."),C?(C.path=B,s(C)):B});e.normalize=c;function u(S,O){S===""&&(S="."),O===""&&(O=".");const B=i(O),C=i(S);if(C&&(S=C.path||"/"),B&&!B.scheme)return C&&(B.scheme=C.scheme),s(B);if(B||O.match(r))return O;if(C&&!C.host&&!C.path)return C.host=O,s(C);const G=O.charAt(0)==="/"?O:c(S.replace(/\/+$/,"")+"/"+O);return C?(C.path=G,s(C)):G}e.join=u,e.isAbsolute=function(S){return S.charAt(0)==="/"||n.test(S)};function l(S,O){S===""&&(S="."),S=S.replace(/\/$/,"");let B=0;for(;O.indexOf(S+"/")!==0;){const C=S.lastIndexOf("/");if(C<0||(S=S.slice(0,C),S.match(/^([^\/]+:\/)?\/*$/)))return O;++B}return Array(B+1).join("../")+O.substr(S.length+1)}e.relative=l;const h=function(){return!("__proto__"in Object.create(null))}();function f(S){return S}function d(S){return m(S)?"$"+S:S}e.toSetString=h?f:d;function p(S){return m(S)?S.slice(1):S}e.fromSetString=h?f:p;function m(S){if(!S)return!1;const O=S.length;if(O<9||S.charCodeAt(O-1)!==95||S.charCodeAt(O-2)!==95||S.charCodeAt(O-3)!==111||S.charCodeAt(O-4)!==116||S.charCodeAt(O-5)!==111||S.charCodeAt(O-6)!==114||S.charCodeAt(O-7)!==112||S.charCodeAt(O-8)!==95||S.charCodeAt(O-9)!==95)return!1;for(let B=O-10;B>=0;B--)if(S.charCodeAt(B)!==36)return!1;return!0}function w(S,O,B){let C=x(S.source,O.source);return C!==0||(C=S.originalLine-O.originalLine,C!==0)||(C=S.originalColumn-O.originalColumn,C!==0||B)||(C=S.generatedColumn-O.generatedColumn,C!==0)||(C=S.generatedLine-O.generatedLine,C!==0)?C:x(S.name,O.name)}e.compareByOriginalPositions=w;function E(S,O,B){let C=S.generatedLine-O.generatedLine;return C!==0||(C=S.generatedColumn-O.generatedColumn,C!==0||B)||(C=x(S.source,O.source),C!==0)||(C=S.originalLine-O.originalLine,C!==0)||(C=S.originalColumn-O.originalColumn,C!==0)?C:x(S.name,O.name)}e.compareByGeneratedPositionsDeflated=E;function x(S,O){return S===O?0:S===null?1:O===null?-1:S>O?1:-1}function A(S,O){let B=S.generatedLine-O.generatedLine;return B!==0||(B=S.generatedColumn-O.generatedColumn,B!==0)||(B=x(S.source,O.source),B!==0)||(B=S.originalLine-O.originalLine,B!==0)||(B=S.originalColumn-O.originalColumn,B!==0)?B:x(S.name,O.name)}e.compareByGeneratedPositionsInflated=A;function I(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=I;function U(S,O,B){if(O=O||"",S&&(S[S.length-1]!=="/"&&O[0]!=="/"&&(S+="/"),O=S+O),B){const C=i(B);if(!C)throw new Error("sourceMapURL could not be parsed");if(C.path){const G=C.path.lastIndexOf("/");G>=0&&(C.path=C.path.substring(0,G+1))}O=u(s(C),O)}return c(O)}e.computeSourceURL=U})(ga);var Df={};let U4=class nb{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new nb;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Df.ArraySet=U4;var m1={};const g1=ga;function F4(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||g1.compareByGeneratedPositionsInflated(e,t)<=0}let B4=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){F4(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(g1.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};m1.MappingList=B4;const ya=u1,Pe=ga,xl=Df.ArraySet,P4=m1.MappingList;let y1=class rb{constructor(t){t||(t={}),this._file=Pe.getArg(t,"file",null),this._sourceRoot=Pe.getArg(t,"sourceRoot",null),this._skipValidation=Pe.getArg(t,"skipValidation",!1),this._sources=new xl,this._names=new xl,this._mappings=new P4,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new rb({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Pe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=Pe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=Pe.getArg(t,"generated"),r=Pe.getArg(t,"original",null);let i=Pe.getArg(t,"source",null),s=Pe.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=Pe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Pe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Pe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Pe.relative(s,i));const o=this._mappings.toArray().length>0?new xl:this._sources,a=new xl;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=Pe.join(r,c.source)),s!=null&&(c.source=Pe.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const u=t.sourceContentFor(c);u!=null&&(r!=null&&(c=Pe.join(r,c)),s!=null&&(c=Pe.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,u,l,h;const f=this._mappings.toArray();for(let d=0,p=f.length;d<p;d++){if(u=f[d],c="",u.generatedLine!==n)for(t=0;u.generatedLine!==n;)c+=";",n++;else if(d>0){if(!Pe.compareByGeneratedPositionsInflated(u,f[d-1]))continue;c+=","}c+=ya.encode(u.generatedColumn-t),t=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=ya.encode(h-o),o=h,c+=ya.encode(u.originalLine-1-i),i=u.originalLine-1,c+=ya.encode(u.originalColumn-r),r=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=ya.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Pe.relative(n,r));const i=Pe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};y1.prototype._version=3,l1.SourceMapGenerator=y1;var _1={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,u=o(i,s[c],!0);return u===0?c:u>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(_1);var _a={exports:{}},D4={},$4=Object.freeze({__proto__:null,default:D4}),b1=ib($4);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;_a.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},_a.exports.initialize=t=>e=t}else{const e=b1,t=b1;_a.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},_a.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var E1=_a.exports;const j4=E1;function z4(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let ba=null;var W4=function(){if(ba)return ba;const t=[];return ba=j4().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,u,l,h,f){const d=new z4;d.generatedLine=r+1,d.generatedColumn=i,s&&(d.lastGeneratedColumn=o-1),a&&(d.source=c,d.originalLine=u+1,d.originalColumn=l,h&&(d.name=f)),t[t.length-1](d)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw ba=null,n}),ba};const Tt=ga,$f=_1,Tl=Df.ArraySet,K4=E1,G4=W4,jf=Symbol("smcInternal");class Fe{constructor(t,n){return t==jf?Promise.resolve(this):Y4(t,n)}static initialize(t){K4.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return V4(t,n)}static async with(t,n,r){const i=await new Fe(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Fe.prototype._version=3,Fe.GENERATED_ORDER=1,Fe.ORIGINAL_ORDER=2,Fe.GREATEST_LOWER_BOUND=1,Fe.LEAST_UPPER_BOUND=2;class Ea extends Fe{constructor(t,n){return super(jf).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version");let o=Tt.getArg(i,"sources");const a=Tt.getArg(i,"names",[]);let c=Tt.getArg(i,"sourceRoot",null);const u=Tt.getArg(i,"sourcesContent",null),l=Tt.getArg(i,"mappings"),h=Tt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Tt.normalize(c)),o=o.map(String).map(Tt.normalize).map(function(f){return c&&Tt.isAbsolute(c)&&Tt.isAbsolute(f)?Tt.relative(c,f):f}),r._names=Tl.fromArray(a.map(String),!0),r._sources=Tl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(f){return Tt.computeSourceURL(c,f,n)}),r.sourceRoot=c,r.sourcesContent=u,r._mappings=l,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,G4().then(f=>(r._wasm=f,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Tt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Ea(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Fe.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Tt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Fe.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Fe.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Tt.getArg(t,"source");const r=Tt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Tt.getArg(t,"bias",Fe.GREATEST_LOWER_BOUND);r==null&&(r=Fe.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Tt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Tt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Tt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Tt.getArg(i,"originalLine",null),column:Tt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Tt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Tt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Tt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Tt.getArg(t,"line"),originalColumn:Tt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Tt.getArg(t,"bias",Fe.GREATEST_LOWER_BOUND);i==null&&(i=Fe.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Tt.getArg(s,"generatedLine",null),column:Tt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Ea.prototype.consumer=Fe;class H4 extends Fe{constructor(t,n){return super(jf).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version"),o=Tt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Tl,r._names=new Tl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=Tt.getArg(c,"offset"),l=Tt.getArg(u,"line"),h=Tt.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new Fe(Tt.getArg(c,"map"),n).then(d=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:d}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Tt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Tt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")},r=$f.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Tt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const u=a[c];let l=Tt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(l),l=this._sources.indexOf(l);let h=null;u.name&&(this._names.add(u.name),h=this._names.indexOf(u.name));const f={source:l,generatedLine:u.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(o.generatedOffset.generatedLine===u.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:h};r.push(f),typeof f.originalLine=="number"&&i.push(f)}}}eachMapping(t,n,r){const i=n||null,s=r||Fe.GENERATED_ORDER;let o;switch(s){case Fe.GENERATED_ORDER:o=this._generatedMappings;break;case Fe.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let u=null;return c.source!==null&&(u=this._sources.at(c.source),u=Tt.computeSourceURL(a,u,this._sourceMapURL)),{source:u,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return $f.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Tt.getArg(t,"line"),r={source:Tt.getArg(t,"source"),originalLine:n,originalColumn:Tt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Tt.compareByOriginalPositions,$f.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function Y4(e,t){let n=e;typeof e=="string"&&(n=Tt.parseSourceMapInput(e));const r=n.sections!=null?new H4(n,t):new Ea(n,t);return Promise.resolve(r)}function V4(e,t){return Ea.fromSourceMap(e,t)}var w1={};const X4=l1.SourceMapGenerator,Al=ga,q4=/(\r?\n)/,J4=10,lo="$$$isSourceNode$$$";let Z4=class cd{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[lo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new cd,s=t.split(q4);let o=0;const a=function(){const d=m(),p=m()||"";return d+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return n.eachMapping(function(d){if(l!==null)if(c<d.generatedLine)f(l,a()),c++,u=0;else{h=s[o]||"";const p=h.substr(0,d.generatedColumn-u);s[o]=h.substr(d.generatedColumn-u),u=d.generatedColumn,f(l,p),l=d;return}for(;c<d.generatedLine;)i.add(a()),c++;u<d.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,d.generatedColumn)),s[o]=h.substr(d.generatedColumn),u=d.generatedColumn),l=d},this),o<s.length&&(l&&f(l,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(d){const p=n.sourceContentFor(d);p!=null&&(r!=null&&(d=Al.join(r,d)),i.setSourceContent(d,p))}),i;function f(d,p){if(d===null||d.source===void 0)i.add(p);else{const m=r?Al.join(r,d.source):d.source;i.add(new cd(d.originalLine,d.originalColumn,m,p,d.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[lo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[lo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[lo]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[lo]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Al.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][lo]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Al.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new X4(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){n.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,f=u.length;h<f;h++)u.charCodeAt(h)===J4?(n.line++,n.column=0,h+1===f?(s=null,i=!1):i&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name})):n.column++}),this.walkSourceContents(function(u,l){r.setSourceContent(u,l)}),{code:n.code,map:r}}};w1.SourceNode=Z4;var Q4=w1.SourceNode;let k1=0;const x1=Lr,tL=["Command","lines"];class eL extends qN{constructor(){super(A_,{traceInitPerf:Lr,skipValidations:!Lr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Nt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Nt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(ua)}])}));Nt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Nt(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Nt(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Nt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Qy)}));Nt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(of)}));Nt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Jy)}])}));Nt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Zy)}));Nt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(t_),this.SUBRULE(this.words),this.CONSUME(e_)}));Nt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(io),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Nt(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Nt(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Nt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Nt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(ff),this.SUBRULE(this.words)}));Nt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(p_),this.SUBRULE(this.words)}));Nt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(df),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Nt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ml),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(ua)),this.CONSUME4(io),this.CONSUME4(pf)}}])}));Nt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ml),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(io),this.CONSUME(pf)}}])}));Nt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ml),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Nt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(io),this.CONSUME(mf),this.CONSUME(df),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Nt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(io),this.CONSUME(mf),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Nt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(__),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Nt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(b_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Nt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(E_),this.SUBRULE(this.words)}));Nt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(w_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Nt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(k_)}));Nt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(x_)}));Nt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(y_)}));Nt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(af),this.SUBRULE2(this.and_test)})}));Nt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(lf),this.SUBRULE2(this.not_test)})}));Nt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(cf),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Nt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Nt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(i_)},{ALT:()=>this.CONSUME(s_)},{ALT:()=>this.CONSUME(o_)},{ALT:()=>this.CONSUME(a_)},{ALT:()=>this.CONSUME(c_)},{ALT:()=>this.CONSUME(l_)}])}));Nt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(af),this.SUBRULE2(this.and_test_value)})}));Nt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(lf),this.SUBRULE2(this.not_test_value)})}));Nt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(cf),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Nt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Nt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(uf)},{ALT:()=>this.CONSUME(hf)}]),this.SUBRULE(this.term)}));Nt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Nt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(h_)},{ALT:()=>this.CONSUME(ff)},{ALT:()=>this.CONSUME(f_)},{ALT:()=>this.CONSUME(d_)}]),this.SUBRULE(this.factor)}));Nt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(uf)},{ALT:()=>this.CONSUME(hf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Nt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(u_),this.SUBRULE(this.factor)})}));Nt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Nt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(n_)},{ALT:()=>this.CONSUME(ln)},{ALT:()=>this.CONSUME(r_)},{ALT:()=>{this.CONSUME(m_),this.SUBRULE(this.expr),this.CONSUME(g_)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=tL.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(k1++).toString().padStart(3),c=s?"font-weight: bold;":"";if(x1&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${u.join(" ")}`,c)}r(),x1&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),k1--},i)}}const uo=new eL;if(Jx){const e=uo.getGAstProductions(),t=cC(e);console.info(t)}const nL=uo.getBaseCstVisitorConstructor();var gt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(gt||{}),_s=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(_s||{}),qr=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(qr||{}),vl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(vl||{});function rL(e){return!!(e!=null&&e.tokenType)}function _r(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class iL extends nL{constructor(){super();Nt(this,"unique",0);Lr&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&rL(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():k(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:_r(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:_r(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:_r(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:_r(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:_r(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,_r(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Ne(),i=Ne();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Ne(),i=Ne();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,_r(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Ne(),i=Ne();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Ne(),i=Ne(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Ne(),i=Ne(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Ne();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=_r(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=_r(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=_r(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(_r(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const sL=new iL,Cn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Sl="zss.js";function Zt(e,t){return new Q4(e.startLine??1,e.startColumn??1,Sl,t)}function zf(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Wf(e){return`'${zf(e)}'`}function Rl(e){if(e.startsWith('"'))return Rl(e.replaceAll(/(^"|"$)/g,""));const t=Cf(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===Of?`', api.get('${zf(r.image.substring(1))}'), '`:zf(r.image)).join("")}'].join('')`}function ho(e){return e.filter(t=>t!==void 0).map(ie)}function T1(e){return Zt(e,"")}function oL(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function He(e,t,n){return Zt(e,[`api.${t}(`,...oL(n,", "),")"])}function aL(e){if(e.type===gt.COMPARE&&e.compare.type===gt.COMPARE_ITEM)switch(e.compare.method){case _s.IS_EQ:return He(e,"isEq",[ie(e.lhs),ie(e.rhs)]);case _s.IS_NOT_EQ:return He(e,"isNotEq",[ie(e.lhs),ie(e.rhs)]);case _s.IS_LESS_THAN:return He(e,"isLessThan",[ie(e.lhs),ie(e.rhs)]);case _s.IS_GREATER_THAN:return He(e,"isGreaterThan",[ie(e.lhs),ie(e.rhs)]);case _s.IS_LESS_THAN_OR_EQ:return He(e,"isLessThanOrEq",[ie(e.lhs),ie(e.rhs)]);case _s.IS_GREATER_THAN_OR_EQ:return He(e,"isGreaterThanOrEq",[ie(e.lhs),ie(e.rhs)])}return Zt(e,"")}function bs(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ie(n),")"])}function A1(e,t,n){return e.prepend(`api.${t}(`),e.add([ie(n),")"])}function cL(e,t){if(e.type===gt.OPERATOR_ITEM)switch(e.operator){case qr.PLUS:return bs(t,"opPlus",e.rhs);case qr.MINUS:return bs(t,"opMinus",e.rhs);case qr.POWER:return bs(t,"opPower",e.rhs);case qr.MULTIPLY:return bs(t,"opMultiply",e.rhs);case qr.DIVIDE:return bs(t,"opDivide",e.rhs);case qr.MOD_DIVIDE:return bs(t,"opModDivide",e.rhs);case qr.FLOOR_DIVIDE:return bs(t,"opFloorDivide",e.rhs);case qr.UNI_PLUS:return A1(t,"opUniPlus",e.rhs);case qr.UNI_MINUS:return A1(t,"opUniMinus",e.rhs)}return Zt(e,"")}function lL(e){if(e.type===gt.OPERATOR){const t=e.lhs?ie(e.lhs):Zt(e,"");return e.items.forEach(n=>cL(n,t)),t}return Zt(e,"")}function Il(e,t){return Zt(e,[He(e,"jump",[`${t}`]),"; continue;"])}function wi(e){return Cn.linelookup[e??""]??-1}function Kf(e,t){Cn.linelookup[e]=t}function fo(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&(i.done=n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&(i.skip=n);break;case gt.LINE:fo(i.stmts,t,n);break}}}function v1(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&Kf(i.done,n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&Kf(i.skip,n);break;case gt.LINE:v1(i.stmts,t,n);break}}}function ie(e){var t;switch(e.type){case gt.PROGRAM:return Zt(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ie).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Sl}`]);case gt.API:return Zt(e,["  ",He(e,e.method,ho(e.words)),`;
`]);case gt.LINE:return Zt(e,[`case ${e.lineindex}:
`,...e.stmts.map(ie).flat(),`  break;
`]);case gt.MARK:return Zt(e,`  // ${e.comment}
`);case gt.GOTO:{const n=wi(e.id);return Zt(e,["  ",Il(e,n),`
`])}case gt.COUNT:return Zt(e,`${e.index}`);case gt.LITERAL:switch(e.literal){case vl.NUMBER:return Zt(e,`${e.value}`);case vl.STRING:return Zt(e,Wf(e.value));case vl.TEMPLATE:return Zt(e,Rl(e.value))}return T1(e);case gt.TEXT:return Zt(e,["  ",He(e,"text",[Rl(e.value)]),`;
`]);case gt.STAT:if(Cn.isfirststat){Cn.isfirststat=!1;const n=e.value.trim().split(" ").map(Wf);return Zt(e,["  ",He(e,"stat",n),`;
`])}return Zt(e,`  // skipped ${e.value}
`);case gt.LABEL:{const n=Mt(e.name),r=e.active?"label":"comment";Cn.labels[n]||(Cn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Cn.labels[n].push(i),Zt(e,`  // ${i} '${n}' ${r}
`)}case gt.HYPERLINK:return Zt(e,["  ",He(e,"hyperlink",[Rl(e.text),...ho(e.link)]),`;
`]);case gt.MOVE:{const n=He(e,"command",[Wf("go"),ho(e.words)].flat());return e.wait?Zt(e,["  if (",n,`) { continue; };
`]):Zt(e,["  ",n,`;
`])}case gt.COMMAND:return Zt(e,["  if (",He(e,"command",ho(e.words)),`) { continue; };
`]);case gt.IF:{const n=((t=e.block)==null?void 0:t.type)===gt.IF_BLOCK?e.block:void 0;if(k(n)){fo([e.check],gt.IF_CHECK,n.skip);const r=Zt(e,ie(e.check));return n.lines.forEach(i=>r.add(ie(i))),v1(n.altlines,gt.ELSE_IF,wi(n.done)),n.altlines.forEach(i=>r.add(ie(i))),r}return Zt(e,ie(e.check))}case gt.IF_CHECK:{const n=wi(e.skip);return n===-1?Zt(e,["  ",He(e,e.method,ho(e.words)),`;
`]):Zt(e,["  if (!",He(e,e.method,ho(e.words)),") { ",Il(e,n),` }
`])}case gt.ELSE_IF:case gt.ELSE:{const n=Zt(e,"");return e.lines.forEach(r=>n.add(ie(r))),n}case gt.WHILE:{const n=wi(e.loop),r=wi(e.done),i=Zt(e,"");return fo(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.REPEAT:{const n=wi(e.loop),r=wi(e.done),i=Zt(e,"");return fo(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.WAITFOR:{const n=Zt(e,"");return fo(e.lines,gt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ie(r))}),n}case gt.FOREACH:{const n=wi(e.loop),r=wi(e.done),i=Zt(e,"");return fo(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.BREAK:return Zt(e,["  ",Il(e,e.goto),`
`]);case gt.CONTINUE:return Zt(e,["  ",Il(e,e.goto),`
`]);case gt.OR:return He(e,"or",e.items.map(ie));case gt.AND:return He(e,"and",e.items.map(ie));case gt.NOT:return He(e,"not",e.items.map(ie));case gt.COMPARE:return aL(e);case gt.OPERATOR:return lL(e);case gt.EXPR:return He(e,"expr",e.words.map(ie));default:return console.error("<unsupported node>",e.type,e),T1(e)}}function Jr(e){if(k(e))switch(e.type===gt.LINE&&++Cn.lineindex,e.lineindex=Cn.lineindex,e.type){case gt.PROGRAM:e.lines.forEach(Jr);break;case gt.LINE:e.stmts.forEach(Jr);break;case gt.MARK:Kf(e.id,e.lineindex);break;case gt.IF:Jr(e.check),Jr(e.block);break;case gt.IF_BLOCK:e.lines.forEach(Jr),e.altlines.forEach(Jr);break;case gt.ELSE_IF:e.lines.forEach(Jr);break;case gt.ELSE:case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.WAITFOR:e.lines.forEach(Jr);break;case gt.MOVE:case gt.COMMAND:case gt.IF_CHECK:e.words.forEach(Jr);break}}function uL(e){return Cn.labels={},Cn.internal=1,Cn.lineindex=0,Cn.isfirststat=!0,Jr(e),{...ie(e).toStringWithSourceMap({file:`${Sl}.map`}),...Cn}}function S1(e){return re(e)?e.length>0?1:0:e??0}function hL(e){return`${e}_chip`}function R1(e=""){return`vm:${e??""}`}function fL(e,t,n){var u,l;const r=hL(e),i=Es(r);let s;const o=Xe(Object.entries(n.labels??{}));(!re(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((u=n.errors)==null?void 0:u.length)??0)!==0?1:0);function a(h,f){T.words=f;const d=S4(t,h);return k(d)?d(c,f):h!=="send"?a("send",[h,...f]):0}const c={halt(){RL(r)},id(){return e},set(h,f){const[d,p]=I4(t,c,h,f);if(d)return p},get(h){const[f,d]=R4(t,c,h);if(f)return d},tick(h){const f=Ct(i.ps)?i.ps:0,d=f%h===0;if(i.ps=f+1,d===!1)return!1;if(c.shouldtick()===!1)return c1(t,c),!1;i.lc=0,i.ys=0,T.get=c.get,O4(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){ae(z,"crash",p.message),i.es=1}return c1(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Ct(i.lc)?++i.lc>ci.HALT_AT_COUNT:!0},hm(){if(re(i.mg)&&re(i.lb)){const[h]=i.mg;if(k(h))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)return p.find(m=>Ct(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,f,d,p){z.emit(`${R1(h)}:${f}`,d,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(re(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h){const m=p.findIndex(w=>w>0);m>=0&&(p[m]*=-1)}}},restore(h){if(re(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)for(let m=0;m<p.length;m++)p[f]=Math.abs(p[f])}},getcase(){i.ec=Ct(i.ec)?i.ec:1;const h=c.hm();if(h&&re(i.mg)){const[,f,d,p]=i.mg;c.set("sender",d),k(f)&&c.set("arg",f),St(p)&&(c.set("player",p),T.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=Ct(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const f=Dx.parse(h),[d]=f.filter(p=>p.fileName===Sl);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[f,...d]=h;return a(Mt(ke(f)),d)},if(...h){const[f,d]=it(h,0,[V.ANY]),p=S1(f);return p&&d<h.length&&c.command(...h.slice(d)),p?1:0},try(...h){const[,f]=it(h,0,[V.DIR]),d=c.command("go",...h);return d&&f<h.length&&c.command(...h.slice(f)),d?1:0},take(...h){const[f,d,p]=it(h,0,[V.NAME,V.ANY]),m=Ct(d),w=m?p:1,E=c.get(f),x=m?d:1;if(!Ct(E))return w<h.length&&c.command(...h.slice(w)),1;const A=E-x;return A<0?(w<h.length&&c.command(...h.slice(w)),1):(c.set(f,A),0)},give(...h){const[f,d,p]=it(h,0,[V.NAME,V.ANY]),m=Ct(d),w=m?p:1,E=c.get(f),x=m?d:1,A=E===void 0?1:0;return A&&w<h.length&&c.command(...h.slice(w)),c.set(f,Do(E,0)+x),A},repeatstart(h,...f){const[d,p]=it(f,0,[V.NUMBER]),m=`repeatcount${h}`,w=`repeatwords${h}`;i[m]=d,i[w]=p<f.length?f.slice(p):void 0},repeat(h){const f=`repeatcount${h}`,d=`repeatwords${h}`;if(!Ct(i[f]))return 0;const p=i[f];i[f]=p-1;const m=p>0,w=i[d];return m&&re(w)&&c.command(...w),m?1:0},foreachstart(h,...f){const[d,p,m,w]=it(f,0,[V.NAME,V.NUMBER,V.NUMBER,V.MAYBE_NUMBER]);let E=Math.min(p,m),x=Math.max(p,m);const A=(w??0)||1;if(A<0){const I=E;E=x,x=I}return c.set(d,E-A),0},foreach(h,...f){const[d,p,m,w,E]=it(f,0,[V.NAME,V.NUMBER,V.NUMBER,V.MAYBE_NUMBER]);let x=Math.min(p,m),A=Math.max(p,m);const I=(w??0)||1;if(I<0){const O=x;x=A,A=O}let U=c.get(d);!Ct(U)||U<x||U>A?U=x:U+=I;const S=U<=A?1:0;return S&&(c.set(d,U),E<f.length&&c.command(...f.slice(E))),S},waitfor(...h){const[f]=it(h,0,[V.ANY]),d=S1(f);return d||c.yield(),d?1:0},or(...h){let f=0;for(let d=0;d<h.length;){const[p,m]=it(h,d,[V.ANY]);if(f=p,f)break;d=m}return f},and(...h){let f=0;for(let d=0;d<h.length;){const[p,m]=it(h,d,[V.ANY]);if(f=p,!f)break;d=m}return f},not(...h){const[f]=it(h,0,[V.ANY]);return f?0:1},expr(...h){const[f]=it(h,0,[V.ANY]);return f},isEq(h,f){const[d]=it([h],0,[V.ANY]),[p]=it([f],0,[V.ANY]);return typeof d=="object"||typeof p=="object"?Bb(d,p)?1:0:d===p?1:0},isNotEq(h,f){return this.isEq(h,f)?0:1},isLessThan(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d<p?1:0},isGreaterThan(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d>p?1:0},isLessThanOrEq(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d<=p?1:0},isGreaterThanOrEq(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d>=p?1:0},opPlus(h,f){const[d]=it([h],0,[V.ANY]),[p]=it([f],0,[V.ANY]);return d+p},opMinus(h,f){const[d]=it([h],0,[V.ANY]),[p]=it([f],0,[V.ANY]);return d-p},opPower(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return Math.pow(d,p)},opMultiply(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d*p},opDivide(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d/p},opModDivide(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d%p},opFloorDivide(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return Math.floor(d/p)},opUniPlus(h){const[f]=it([h],0,[V.NUMBER]);return+f},opUniMinus(h){const[f]=it([h],0,[V.NUMBER]);return-f}};return s=(l=n.code)==null?void 0:l.call(n,c),c}function Gf(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];re(r)?r.forEach(i=>{t.push(Gf(i))}):t.push(Gf(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function dL(e){const t=v_(`${e}
`);if(t.errors.length>0)return t;uo.input=t.tokens;const n=uo.program();if(uo.errors.length>0)return{tokens:t.tokens,errors:uo.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=sL.go(n);return r?(Gf(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Hf=Object.getPrototypeOf(function*(){}).constructor;function pL(e,t){const n=`compile-${e}`;console.time(n);const r=dL(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=uL(r.ast);if(i.code){Zx&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Hf("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Hf("api"," ")}}}return{...r,...i,source:"",code:new Hf("api"," ")}}function mL(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=pL(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return k(s)?s.isended():!0},halt(i){const s=t[i];return k(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];k(o)&&o.set("arg",s)},tick(i,s,o,a,c){var l;let u=t[i];if(!k(t[i])){const h=n(a,c);if(u=t[i]=fL(i,s,h),(l=h.errors)!=null&&l.length){const[f]=h.errors,d=((f==null?void 0:f.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((E,x)=>[E,x]);p.slice(d-5,d).forEach(([E,x])=>{ae(z,"build",`$grey${x+1} $grey${E}`)});const[m,w]=p[d]??[];if(St(m)&&k(w)){const E=(f.column??1)-1,x=E+f.length,A=E<m.length?m:`${m}*`,I=A.substring(0,E),U=A.substring(E,x),S=A.substring(x);ae(z,"build",`$red${w+1} $grey${I}$red${U}$grey${S}`)}return f.message.split(`
`).forEach(E=>{ae(z,"build",E)}),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Xi(i.target),a=t[s];if(k(a)){const c={...i,target:o};a.message(c)}}};return r}let I1=0;function gL(){switch(I1++){case 0:return jt.BLUE;case 1:return jt.GREEN;case 2:return jt.CYAN;case 3:return jt.RED;case 4:return jt.PURPLE;case 5:return jt.YELLOW;default:return I1=0,jt.WHITE}}const De=new Bo,En={},Ol={};function O1(e,t,n,r,i=0){const s=`tiles:${e}:${t}`;return k(En[s])||(En[s]=zx(e,t,n,r,i)),En[s]}function yL(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return k(Ol[s])||(Ol[s]=Wx(e,t,n)),Ol[s].id=i,Ol[s]}function _L(e,t){const n=`sprites:${e}:${t}`;return k(En[n])||(En[n]=Kx(e,t)),En[n]}function bL(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return k(En[s])||(En[s]=Gx(e,t,n,r,i)),En[s]}function N1(e,t,n,r){const i=`media:${e}:${t}`;k(En[i])||(En[i]=Hx(e,t,n,r));const s=En[i];return s.mime=n,s.media=r,s}function EL(e,t){const n=`control:${e}:${t}`;return k(En[n])||(En[n]=Yx(e,t)),En[n]}const Ki=.4;function C1(e,t){const n=[];De.x=e-Ki,De.y=t-Ki,n.push(De.angle()),De.x=e+Ki,De.y=t-Ki,n.push(De.angle()),De.x=e-Ki,De.y=t+Ki,n.push(De.angle()),De.x=e+Ki,De.y=t+Ki,n.push(De.angle());const r=Math.round(qu(Math.min(...n))),i=Math.round(qu(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function wL(e,t,n,r,i){var S;if(!k(r)||!k(r.terrain)||!k(r.objects))return[];const s=[];let o=t;const a=o===0,c=Wt,u=xe,l=a?jt.BLACK:jt.ONCLEAR,h=O1(e,o++,c,u,l);s.push(h);const f=o++,d=_L(e,f);d.sprites=[],s.push(d);const p=r.isdark?1:0,m=bL(e,o++,c,u,p);s.push(m),m.alphas.fill(p);const w=O1(e,o++,c,u,jt.ONCLEAR);s.push(w),w.char.fill(0);const E={...Lf(Wt,xe,gL(),jt.ONCLEAR),...w},x=EL(e,o++);i&&s.push(x);for(let O=0;O<r.terrain.length;++O){const B=r.terrain[O],C=F_(n,B,0,jt.BLACK,jt.ONCLEAR);h.char[O]=C.char,h.color[O]=C.color,h.bg[O]=C.bg}const A=Object.values(r.objects??{});for(let O=0;O<A.length;++O){const B=A[O];if(k(B.removed))continue;const C=B.id??"",G=F_(n,B,1,jt.WHITE,jt.BLACK),tt=yL(e,f,C,O);if(tt.x=B.x??0,tt.y=B.y??0,tt.char=G.char,tt.color=G.color,tt.bg=G.bg,d.sprites.push(tt),p){if(G.light>0){const L=[],R=Bn(Math.round(G.light),1,10),_=R*.5,P=Zr(r,tt),Z=1/_;if(m.alphas[P]=0,R>1)for(let $=1;$<=R;++$)for(let lt=tt.y-$;lt<=tt.y+$;++lt)for(let et=tt.x-$;et<=tt.x+$;++et){if(et===tt.x&&lt===tt.y)continue;De.x=et-tt.x,De.y=lt-tt.y;const ft=De.length();if(ft>R)continue;const H=Zr(r,{x:et,y:lt});if(H===-1)continue;const W=Math.round(qu(De.angle()));let bt=0;for(let At=0;At<L.length;++At){const xt=L[At];W>=xt[0]&&W<=xt[1]&&(bt=Math.max(bt,xt[2]))}m.alphas[H]=Math.min(m.alphas[H],bt+(ft<_?0:(ft-_)*Z)),m.alphas[H]=Bn(m.alphas[H],0,1);const ot=Ln(r,((S=r.lookup)==null?void 0:S[H])??"");if(k(ot)){const At=[...C1(De.x,De.y),.25];L.push(At)}const ct=r.terrain[H],Lt=_i(n,ct),te=(ct==null?void 0:ct.collision)??(Lt==null?void 0:Lt.collision);if(th(Ht.ISBULLET,te)){const At=[...C1(De.x,De.y),1];let xt=0;for(xt=0;xt<L.length;++xt){const $t=L[xt];if($t[1]>$t[0]&&At[1]>=$t[0]&&At[0]<=$t[1]&&At[2]>=1&&$t[2]>=1){L[xt]=[Math.min(At[0],$t[0]),Math.max(At[1],$t[1]),1];break}}xt===L.length&&L.push(At)}}}else if(Ts(C)){const L=Zr(r,tt);m.alphas[L]=0}}if(St(B.tickertext)&&Ct(B.tickertime)&&B.tickertext.length){const L=Wt,R=q_(B.tickertext,L,xe-1),_=(R==null?void 0:R.measuredwidth)??1,P=B.x??0,Z=B.y??0,$=Z<xe*.5;E.x=P-Math.floor(_*.5),E.y=Z+($?1:-1),E.x+_>Wt&&(E.x=Wt-_),E.x<0&&(E.x=0),X_(B.tickertext,E,!0)}C===e&&(x.focusx=tt.x,x.focusy=tt.y,x.focusid=C)}const I=me(Dt.MAIN),U=bi(I,Dt.MAIN);if(St(U.palette)){const O=Nn(I,Et.PALETTE,U.palette),B=un(O);k(B==null?void 0:B.bits)&&s.push(N1(e,o++,"image/palette",Array.from(B.bits)))}if(St(U.charset)){const O=Nn(I,Et.CHARSET,U.charset),B=un(O);k(B==null?void 0:B.bits)&&s.push(N1(e,o++,"image/charset",Array.from(B.bits)))}return s}const zn=mL();var Dt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Dt||{});const ve={halt:!1,session:Ne(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function kL(){return ve.session}function ki(){return ve.operator}function xL(e){ve.operator=e}function TL(e){ve.halt=e}function AL(){return ve.halt}function po(){return[...ve.books.values()]}function vL(){const[e]=ve.books.values();return e}function br(e){const t=Mt(e);return ve.books.get(e)??po().find(n=>n.name===t)}function Nl(e,t){k(br(t))&&(ve.software[e]=t)}function me(e){return br(ve.software[e])}function L1(e){const t=C_([]);return St(e)&&(t.name=e),Yf(t),xr(z,`created [book] ${t.name}`),t}function SL(e){let t=br(e);return k(t)||(t=C_([]),t.name=e),Yf(t),xr(z,`created [book] ${t.name}`),t}function Wn(e,t){let n=k(t)?SL(t):me(e);return k(n)||(k(n)||(n=vL()),k(n)||(n=L1(t)),k(n)&&xr(z,`opened [book] ${n.name} for ${e}`)),Nl(e,n.id),n}function Gi(e,t,n){return Ef(Wn(e),n,t)}function Es(e){const t=Wn("main");return bi(t,e)}function M1(){const e=Wn("main");return bi(e,"main")}function RL(e){const t=Wn("main");return B_(t,e)}function IL(e,t){ve.books.clear(),e.forEach(r=>{ve.books.set(r.id,r),r.name==="main"&&(ve.software.main=r.id)});const n=br(t);if(k(n)&&Nl("main",n.id),!ve.software.main){const r=ve.books.values().next();r.value&&(ve.software.main=r.value.id)}}function Yf(e){return ve.books.set(e.id,e),e.id}function OL(e){const t=br(e);t&&ve.books.delete(t.id)}function NL(e){if(!St(e)||!e)return ae(z,"login",`failed for playerid ==>${e}<==`,e);const t=me("main");if(!k(t))return ae(z,"login:main","login failed to find book 'main'",e);const n=gs(t,e);if(k(n))return!0;const r=Hr(t,Et.BOARD,"title");if(r.length===0)return ae(z,"login:title","login failed to find board with 'title' stat",e);const i=fa(t,"player");if(!k(i))return ae(z,"login:player","login failed to find object type 'player'",e);const s=M0(e,r),o=un(s);if(k(o)){const a=N_(s,"startx"),c=N_(s,"starty"),u=Ct(a)?a:Math.round(Wt*.5),l=Ct(c)?c:Math.round(xe*.5),h=i.name??"player",f=ed(o,{x:u,y:l},h,e);if(k(f==null?void 0:f.id))return f.player=e,yl(t,e,o.id),!0}return!1}function CL(e){const t=me("main"),n=gs(t,e);yl(t,e,""),Af(t,n,Ln(n,e)),j1(n,e),zn.halt(e),B_(t,e)}function Er(e){const t=me("main");return gs(t,e)}function LL(e){const t=me("main"),n=xC(t,e),r=gs(t,e),i=Ln(r,e);return n&&k(i)}function ML(e){const t=me("main"),n=kf(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Ts(c)&&k(e[c])===!1&&(e[c]=0,yl(t,c,i.id))}}}function U1(e){zn.message(e)}function wa(e,t,n,r){const i=Ur(e);St(t.id)&&z.emit("vm:touched",[t.id,i,n],r)}function Vf(e,t,n,r){if(!k(n))return!1;const i=D_(e,t,n,r);if(k(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=Hr(e,Et.BOARD,(t==null?void 0:t.exitwest)??"");if(o.length){const a=cn(o);da(e,n.id??"",a.id,{x:Wt-1,y:r.y})}}else if(r.x>=Wt){const o=Hr(e,Et.BOARD,(t==null?void 0:t.exiteast)??"");if(o.length){const a=cn(o);da(e,n.id??"",a.id,{x:0,y:r.y})}}else if(r.y<0){const o=Hr(e,Et.BOARD,(t==null?void 0:t.exitnorth)??"");if(o.length){const a=cn(o);da(e,n.id??"",a.id,{x:r.x,y:xe-1})}}else if(r.y>=xe){const o=Hr(e,Et.BOARD,(t==null?void 0:t.exitsouth)??"");if(o.length){const a=cn(o);da(e,n.id??"",a.id,{x:r.x,y:0})}}}else wa(i,n,"thud",void 0);if(n.kind==="player")wa(n,i,"touch",n.id);else if(n.collision===Ht.ISBULLET){const o=Ts(n.party),a=Ts(i.id);o!==a?wa(n,i,"shot",n.party):wa(i,n,"thud",void 0)}else wa(n,i,"bump",void 0);const s=_i(e,i);return i.destructible??(s==null?void 0:s.destructible)?(k(i==null?void 0:i.id)?Yr(T.book,T.board,i,T.timestamp):kr(t,{x:r.x,y:r.y}),!0):!1}return!0}function F1(e,t,n,r,i=EE){var h;if(!k(e)||!k(t)||!k(n))return;const s={...T};T.book=e,T.board=t,T.element=n,T.elementid=n.id??"",T.elementisplayer=Ts(T.elementid);const o=T.element.player??ve.operator;T.elementfocus=T.elementisplayer?T.elementid:o;const a=_i(e,n),c=n.cycle??(a==null?void 0:a.cycle)??i,u=n.id??"",l=Mt(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(zn.tick(u,Wi.RUNTIME,Ct(c)?c:i,l,r),Ct(n==null?void 0:n.tickertime)&&T.timestamp-n.tickertime>Oa*5&&(n.tickertime=0,n.tickertext=""),T.elementisplayer){const f=Es(T.elementid);Ct(f.inputcurrent)&&(f.inputcurrent=0)}Kn(s).forEach(f=>{T[f]=s[f]})}function UL(e,t){ve.loaders.set(e,t)}function FL(e){zn.halt(e)}function BL(){const e=zn.ids();for(let n=0;n<e.length;++n)zn.halt(e[n]);const t=me("main");k(t)&&(t.flags={})}function PL(){const e=me("main");if(!k(e))return;const t=e.timestamp+1,n=ci.HALT_AT_COUNT;ci.HALT_AT_COUNT=n*2,ve.loaders.forEach((i,s)=>{const o={...T};T.timestamp=e.timestamp,T.book=e,T.board=void 0,T.element=void 0,T.elementid=s,T.elementisplayer=!1,T.elementfocus=ve.operator;const a=r4(s);k(a)&&zn.arg(s,a),zn.tick(s,Wi.LOADER,1,"loader",i),zn.isended(s)&&(zn.halt(s),ve.loaders.delete(s)),Kn(o).forEach(c=>{T[c]=o[c]})}),ci.HALT_AT_COUNT=n,e.timestamp=t,T.timestamp=t;const r=kf(e);for(let i=0;i<r.length;++i){const s=r[i],o=IC(e,s,t);for(let a=0;a<o.length;++a){const{id:c,type:u,code:l,object:h}=o[a];u===Et.ERROR?zn.halt(c):F1(e,s,h,l)}}}function Xf(e,t){const n=me("main");if(!k(n))return;function r(a,c){for(let u=0;u<a.length;++u){const l=a[u];if(k(l.id)){const h=`${R1(l.id)}:${c}`;z.emit(h,t)}}}const{target:i,path:s}=Xi(e),o=kf(n);for(let a=0;a<o.length;++a){const c=o[a];switch(Mt(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(J0(c,[i]),s);break}}}}function DL(e,t=""){var s;const n=Wn("main");if(!k(n))return;const r=`${e}_cli`;T.timestamp=n.timestamp,T.book=n,T.board=gs(n,e),T.element=Ln(T.board,e),T.elementid=((s=T.element)==null?void 0:s.id)??"",T.elementisplayer=!0,T.elementfocus=T.elementid||e;const i=ci.HALT_AT_COUNT;ci.HALT_AT_COUNT=i*8,xd(z,"running",n.timestamp,r,t),zn.once(r,Wi.CLI,"cli",t),ci.HALT_AT_COUNT=i}function Cl(e){var o;const t=Wn("main"),n=ji(t,e);if(!k(t)||!k(n)||!k(T.element))return;const r=`${e}_run`,i=Mt(T.element.name??((o=T.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";zn.once(r,Wi.RUNTIME,i,s)}function $L(e){const t=me("main"),n=gs(t,e),r=[];if(!k(t)||!k(n))return r;const i=so(t,n.over??""),s=so(t,n.under??""),o=[i,n,s];let a=0;for(let c=0;c<o.length;++c){const u=o[c],l=wL(e,a,t,u,u===n);a+=l.length,r.push(...l)}return r}function fn(e){var r,i,s,o,a;const t=T.words[e],n=e+1;if(t1(t)){const[c,u]=bl(e);if(k(c))return[c,u]}if(qC(t)){const[c,u]=n1(e);if(k(c))return[c,u]}if(K0(t)){const[c,u]=pc(e);if(k(c))return[c,u]}if(St(t)&&Mt(t)==="rnd"){const[c,u]=fn(n),[l,h]=fn(u);return Ct(c)&&Ct(l)?[Li(c,l),h]:Ct(c)?[Li(0,c),u]:[Li(0,1),n]}if(P1(t)){const[c,u]=Jf(e);if(k(c))return[c,u]}if(!k(t))return[void 0,e];if(Ct(t)||re(t))return[t,n];if(St(t)){const c=Mt(t),u=(r=T.get)==null?void 0:r.call(T,t);if(k(u))return[u,n];switch(c){case"aligned":case"alligned":{const l=gc(T.board,T.element,T.elementfocus);return!k(T.element)||!k(l)?[0,n]:[T.element.x===l.x||T.element.y===l.y?1:0,n]}case"contact":{const l=gc(T.board,T.element,T.elementfocus);if(!k(T.element)||!k(l))return[0,n];const h=(l.x??0)-(((i=T.element)==null?void 0:i.x)??0),f=(l.y??0)-(((s=T.element)==null?void 0:s.y)??0);return[h===0&&Math.abs(f)<2||f===0&&Math.abs(h)<2?1:0,n]}case"blocked":{const[l,h]=it(T.words,n,[V.DIR]);return[AC(T.book,T.board,T.element,l)?1:0,h]}case"any":{const[l,h]=it(T.words,n,[V.KIND]),f=mc(l)??"",d=Vs(T.board,f);return[q0(d,l).length?1:0,h]}case"rnd":return[Li(0,1),n];case"abs":{const[l,h]=it(T.words,n,[V.NUMBER]);return[Math.abs(l),h]}case"ceil":{const[l,h]=it(T.words,n,[V.NUMBER]);return[Math.ceil(l),h]}case"floor":{const[l,h]=it(T.words,n,[V.NUMBER]);return[Math.floor(l),h]}case"round":{const[l,h]=it(T.words,n,[V.NUMBER]);return[Math.round(l),h]}case"clamp":{const[l,h,f,d]=it(T.words,n,[V.NUMBER,V.NUMBER,V.NUMBER]);return[Bn(l,h,f),d]}case"min":{const l=[];for(let h=n;h<T.words.length;){const[f,d]=fn(h);re(f)&&!wr(f)&&!Xr(f)&&!Ei(f)&&!Pn(f)&&l.push(...f),h=d,l.push(f)}return[Math.min(...l),T.words.length]}case"max":{const l=[];for(let h=n;h<T.words.length;){const[f,d]=fn(h);re(f)&&!wr(f)&&!Xr(f)&&!Ei(f)&&!Pn(f)&&l.push(...f),h=d,l.push(f)}return[Math.max(...l),T.words.length]}case"pick":{const l=[];for(let h=n;h<T.words.length;){const[f,d]=fn(h);re(f)&&!wr(f)&&!Xr(f)&&!Ei(f)&&!Pn(f)&&l.push(...f),h=d,l.push(f)}return[cn(l),T.words.length]}case"pickwith":{const l=[],[h,f]=it(T.words,n,[V.NUMBER_OR_STRING]);for(let d=f;d<T.words.length;){const[p,m]=fn(d);re(p)&&!wr(p)&&!Xr(p)&&!Ei(p)&&!Pn(p)&&l.push(...p),d=m,l.push(p)}return[M0(`${h}`,l),T.words.length]}case"random":{const[l,h,f]=it(T.words,n,[V.NUMBER,V.MAYBE_NUMBER]);return[Li(l,h??0),f]}case"randomwith":{const[l,h,f,d]=it(T.words,n,[V.NUMBER_OR_STRING,V.NUMBER,V.MAYBE_NUMBER]);return[C0(`${l}`,h,f??0),d]}case"run":{const[l,h]=it(T.words,n,[V.NAME]);return Cl(l),[(o=T.get)==null?void 0:o.call(T,"arg"),h]}case"runwith":{const[l,h,f]=it(T.words,n,[V.ANY,V.NAME]);return k(T.element)&&(T.element.arg=l),Cl(h),[(a=T.get)==null?void 0:a.call(T,"arg"),f]}}}return[t,n]}function mo(e){return k(e)&&k(e.x)&&k(e.y)}function Ye(e,t){switch(t){case yt.NORTH:--e.y;break;case yt.SOUTH:++e.y;break;case yt.WEST:--e.x;break;case yt.EAST:++e.x;break}return e}function Hi(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return yt.WEST;if(n>0)return yt.EAST;if(r<0)return yt.NORTH;if(r>0)return yt.SOUTH}const qf={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST"};function wr(e){return re(e)&&B1(e[0])}function B1(e){return k(yt[e])&&St(e)}function jL(e){const t=yt[e];return k(t)?t:yt.IDLE}function P1(e){if(St(e))return qf[Mt(e)]}function D1(e){if(wr(e))return e;if(B1(e))return[e];const t=P1(e);if(k(t))return[t]}function $1(e){const t=T.words[e],n=D1(t);if(wr(n))return[n,e+1];const[r,i]=fn(e),s=D1(r);return wr(s)?[s,i]:[void 0,e]}function Jf(e){const t=[];let[n,r]=$1(e);for(;wr(n);){if(t.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=it(T.words,r,[V.NUMBER,V.NUMBER]);t.push(o,a),r=c}const[i,s]=$1(r);n=i,r=s}return t.length?[t,r]:[void 0,e]}function zL(){return new Array(Wt*xe).map(()=>{})}function WL(e=Hl){const t={terrain:zL(),objects:{},id:""};return e(t)}var Zf=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e))(Zf||{});function KL(e){return qs(e,Zf,{terrain:t=>t.map(xc),objects:t=>Object.values(t).filter(n=>!n.removed).map(xc),id:Me,named:Me,lookup:Me,codepage:Me})}function GL(e){return Ko(e,Zf,{terrain:t=>t.map(Tc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=Tc(t[r]);k(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Zr(e,t){return!k(e)||!k(t==null?void 0:t.x)||!k(t==null?void 0:t.y)||t.x<0||t.x>=Wt||t.y<0||t.y>=xe?-1:t.x+t.y*Wt}function or(e,t){const n=Zr(e,t);if(n<0||!k(e==null?void 0:e.lookup))return;const r=Ln(e,e.lookup[n]??"");return k(r)?r:e.terrain[n]}function HL(e,t){const n=Ln(e,t);if(k(n))return n;const r=parseFloat(t),i=E0(isNaN(r)?-1:r,Wt);return Qf(e,i.x,i.y)}function Qf(e,t,n){return(t>=0&&t<Wt)??(n>=0&&n<xe)?e==null?void 0:e.terrain[t+n*Wt]:void 0}function kr(e,t){if(!k(e)||!k(t)||!k(t.x)||!k(t.y)||t.x<0||t.x>=Wt||t.y<0||t.y>=xe)return;const n=Xe(t),r=t.x+t.y*Wt;return e.terrain[r]=n,e.terrain[r]}function td(e,t){if(!k(e)||!k(t))return;const n=Xe(t);return n.id=n.id??Ne(),e.objects[n.id]=n,e.objects[n.id]}function YL(e,t,n){return kr(e,{...t,kind:n})}function ed(e,t,n,r){return td(e,{...t,kind:n,id:r})}function Ln(e,t){if(e)return e.objects[t]}function nd(e,t,n,r,i){if(!k(e)||!k(t))return{x:0,y:0};const s={x:t.x??0,y:t.y??0},o={x:t.lx??s.x,y:t.ly??s.y},a=Hi(o,s),c=Wt-1,u=xe-1;for(let l=0;l<r.length;++l){const h=jL(r[l]);switch(h){case yt.IDLE:break;case yt.NORTH:case yt.SOUTH:case yt.WEST:case yt.EAST:Ye(s,h);break;case yt.BY:{const[f,d]=r.slice(l+1);Ct(f)&&Ct(d)&&(s.x=Bn(s.x+f,0,c),s.y=Bn(s.y+d,0,u)),l+=2;break}case yt.AT:{const[f,d]=r.slice(l+1);Ct(f)&&Ct(d)&&(s.x=Bn(f,0,c),s.y=Bn(d,0,u)),l+=2;break}case yt.FLOW:Ye(s,a);break;case yt.SEEK:{const f=VL(e,t,n);mo(f)&&Ye(s,Hi(i,f));break}case yt.RNDNS:Ye(s,cn(yt.NORTH,yt.SOUTH));break;case yt.RNDNE:Ye(s,cn(yt.NORTH,yt.EAST));break;case yt.RND:Ye(s,cn(yt.NORTH,yt.SOUTH,yt.WEST,yt.EAST));break;case yt.CW:case yt.CCW:case yt.OPP:case yt.RNDP:{const f=nd(e,t,n,r.slice(l+1),i);switch(s.x=i.x,s.y=i.y,h){case yt.CW:switch(Hi(i,f)){case yt.NORTH:Ye(s,yt.EAST);break;case yt.SOUTH:Ye(s,yt.WEST);break;case yt.EAST:Ye(s,yt.SOUTH);break;case yt.WEST:Ye(s,yt.NORTH);break}break;case yt.CCW:switch(Hi(i,f)){case yt.NORTH:Ye(s,yt.WEST);break;case yt.SOUTH:Ye(s,yt.EAST);break;case yt.EAST:Ye(s,yt.NORTH);break;case yt.WEST:Ye(s,yt.SOUTH);break}break;case yt.OPP:switch(Hi(i,f)){case yt.NORTH:Ye(s,yt.SOUTH);break;case yt.SOUTH:Ye(s,yt.NORTH);break;case yt.EAST:Ye(s,yt.WEST);break;case yt.WEST:Ye(s,yt.EAST);break}break;case yt.RNDP:switch(Hi(i,f)){case yt.NORTH:case yt.SOUTH:s.x+=cn(-1,1);break;case yt.WEST:case yt.EAST:s.y+=cn(-1,1);break}break}break}}}return s}function j1(e,t){return k(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function VL(e,t,n){if(!k(e)||!k(t))return;const r=e.objects[n];if(k(r))return r;if(mo(t))return Z0(t,Vs(e,"player"))}const T={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var V=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NAME=5]="NAME",e[e.NUMBER=6]="NUMBER",e[e.STRING=7]="STRING",e[e.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=10]="MAYBE_COLLISION",e[e.MAYBE_COLOR=11]="MAYBE_COLOR",e[e.MAYBE_KIND=12]="MAYBE_KIND",e[e.MAYBE_DIR=13]="MAYBE_DIR",e[e.MAYBE_NAME=14]="MAYBE_NAME",e[e.MAYBE_NUMBER=15]="MAYBE_NUMBER",e[e.MAYBE_STRING=16]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",e[e.ANY=18]="ANY",e))(V||{});function $e(e,t,n){throw console.info(n,T.element,T.elementid,T.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function it(e,t,n){var o,a,c,u;const r=T.words;T.words=e;const i=[];let s=t;for(let l=0;l<n.length;++l)switch(n[l]){case 0:{const[h,f]=bl(s);Xr(h)||$e("terrain or object",h,e),s=f,i.push(h);break}case 1:{const[h,f]=n1(s);Ei(h)||$e("solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 2:{const[h,f]=pc(s);Pn(h)||$e("color",h,e),s=f,i.push(h);break}case 3:{const[h,f]=Y0(s);Ys(h)?(s=f,i.push(h)):$e("kind",h,e);break}case 4:{const[h,f]=Jf(s);if(wr(h)){const d={x:((o=T.element)==null?void 0:o.x)??0,y:((a=T.element)==null?void 0:a.y)??0},p=k(T.board)&&k(T.element)?nd(T.board,T.element,T.elementfocus,h,d):d;s=f,i.push(p)}else $e("direction",h,e);break}case 5:{const h=T.words[s];St(h)||$e("string",h,e),++s,i.push(h);break}case 6:{const[h,f]=fn(s);if(St(h)){const d=parseFloat(h);Ct(d)?i.push(d):$e("number",h,e)}else Ct(h)?i.push(h):$e("number",h,e);s=f;break}case 7:{const[h,f]=fn(s);St(h)||$e("string",h,e),s=f,i.push(h);break}case 8:{const[h,f]=fn(s);let d=h;if(St(d)){const p=parseFloat(d);Ct(p)&&(d=p)}else Ct(d)||$e("number or string",d,e);s=f,i.push(d);break}case 9:{const[h,f]=bl(s);h!==void 0&&!Xr(h)&&$e("optional terrain or object",h,e),s=f,i.push(h);break}case 10:{const[h,f]=bl(s);h!==void 0&&!Ei(h)&&$e("optional solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 11:{const[h,f]=pc(s);h!==void 0&&!Pn(h)&&$e("optional color",h,e),s=f,i.push(h);break}case 12:{const[h,f]=Y0(s);h!==void 0&&!Ys(h)&&$e("optional kind",h,e),s=f,i.push(h);break}case 13:{const[h,f]=Jf(s);if(wr(h)){const d=((c=T.element)==null?void 0:c.x)??0,p=((u=T.element)==null?void 0:u.y)??0,m={x:d,y:p},w=T.board?nd(T.board,T.element,T.elementfocus,h,m):m;s=f,i.push(w)}else h===void 0?(s=f,i.push(void 0)):$e("optional direction",h,e);break}case 14:{const h=T.words[s];h!==void 0&&!St(h)&&$e("optional string",h,e),++s,i.push(h);break}case 15:{const[h,f]=fn(s);if(St(h)){const d=parseFloat(h);Ct(d)?i.push(d):$e("optional number",h,e)}else Ct(h)||h===void 0?i.push(h):$e("optional number",h,e);s=f;break}case 16:{const[h,f]=fn(s);h!==void 0&&!St(h)&&$e("optional string",h,e),s=f,i.push(h);break}case 17:{const[h,f]=fn(s);let d=h;if(St(d)){const p=parseFloat(d);Ct(p)&&(d=p)}else d!==void 0&&!Ct(d)&&$e("number or string",d,e);s=f,i.push(d);break}case 18:{const[h,f]=fn(s);s=f,i.push(h);break}}return T.words=r,[...i,s]}const Ll={},go={};function rd(){return{id:Ne(),layers:[],scroll:[],sidebar:[]}}const XL=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),qL=new Set(["tx","text"]),JL={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},z1={};let W1=e=>{let t=z1[e];return k(t)||(z1[e]=t=rd()),t};function ZL(e){W1=e}function wn(e){return W1(e)}function id(e){return k(Ll[e])||(Ll[e]=[]),Ll[e]}function QL(e){const t=wn(e);t.scroll=[]}function tM(e,t,n){Object.values(go).forEach(r=>{if(r[t]!==void 0){const i=B0(e.id(),t);Ct(n)&&Tx(i,n),St(n)&&Ax(i,n)}})}function Qr(e){const t=id(e);return Ll[e]=[],t}function ce(e,t){id(e).push(t)}function ne(e,t,n,r,i=()=>0,s=Hl){const o=[t,n,...r],a=Mt(`${o[3]}`),c={...T};function u(l,h){k(h)&&h!==i(l)&&(T.board=c.board,T.element=c.element,T.elementfocus=c.elementfocus,s(l,h))}if(XL.has(a)){const l=`${o[2]}`;go[t]=go[t]??{};const h=i(l)??JL[a];if(go[t][l]===void 0){const f=B0(t,l);Ct(h)&&xx(f,h),St(h)&&Ku(f,h),qL.has(a)?go[t][l]=_0(f,d=>{u(l,d)}):go[t][l]=vx(f,d=>{u(l,d)})}}id(e).push(o)}ZL(e=>{if(Ts(e)){const t=me(Dt.MAIN),n=bi(t,Dt.GADGETSTORE);let r=n[e];return k(r)||(n[e]=r=rd()),r}return rd()});const sd=vs("gadgetserver",["tock"],e=>{if(!sd.session(e))return;const t=me(Dt.MAIN),n=(t==null?void 0:t.activelist)??[],r=bi(t,Dt.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=wn(s);o.layers=$L(s);const a=r[s]??{},c=Ed(a,o);c.length&&(r[s]=Xe(o),Hb(sd,c,s))}break;case"desync":e.player&&Gb(sd,wn(e.player),e.player);break;case"clearscroll":e.player&&QL(e.player);break;case"clearplayer":if(e.player){const i=me(Dt.MAIN),s=bi(i,Dt.GADGETSTORE);delete s[e.player];const o=bi(i,Dt.GADGETSYNC);delete o[e.player]}break}});function Ml(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var K1={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(u,l){if(!i[u]){if(!r[u]){var h=typeof Ml=="function"&&Ml;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[u]={exports:{}};r[u][0].call(d.exports,function(p){var m=r[u][1][p];return o(m||p)},d,d.exports,n,r,i,s)}return i[u].exports}for(var a=typeof Ml=="function"&&Ml,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,f,d,p,m,w=[],E=0,x=c.length,A=x,I=s.getTypeOf(c)!=="string";E<c.length;)A=x-E,h=I?(u=c[E++],l=E<x?c[E++]:0,E<x?c[E++]:0):(u=c.charCodeAt(E++),l=E<x?c.charCodeAt(E++):0,E<x?c.charCodeAt(E++):0),f=u>>2,d=(3&u)<<4|l>>4,p=1<A?(15&l)<<2|h>>6:64,m=2<A?63&h:64,w.push(a.charAt(f)+a.charAt(d)+a.charAt(p)+a.charAt(m));return w.join("")},i.decode=function(c){var u,l,h,f,d,p,m=0,w=0,E="data:";if(c.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var x,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=o.uint8array?new Uint8Array(0|A):new Array(0|A);m<c.length;)u=a.indexOf(c.charAt(m++))<<2|(f=a.indexOf(c.charAt(m++)))>>4,l=(15&f)<<4|(d=a.indexOf(c.charAt(m++)))>>2,h=(3&d)<<6|(p=a.indexOf(c.charAt(m++))),x[w++]=u,d!==64&&(x[w++]=l),p!==64&&(x[w++]=h);return x}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function u(l,h,f,d,p){this.compressedSize=l,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=p}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,f){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var m=f;m<p;m++)u=u>>>8^d[255&(u^l[m])];return-1^u}(0|c,a,a.length,0):function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var m=f;m<p;m++)u=u>>>8^d[255&(u^l.charCodeAt(m))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,f){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(d,p){var m,w="";for(m=0;m<p;m++)w+=String.fromCharCode(255&d),d>>>=8;return w}function o(d,p,m,w,E,x){var A,I,U=d.file,S=d.compression,O=x!==u.utf8encode,B=a.transformTo("string",x(U.name)),C=a.transformTo("string",u.utf8encode(U.name)),G=U.comment,tt=a.transformTo("string",x(G)),L=a.transformTo("string",u.utf8encode(G)),R=C.length!==U.name.length,_=L.length!==G.length,P="",Z="",$="",lt=U.dir,et=U.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ft.crc32=d.crc32,ft.compressedSize=d.compressedSize,ft.uncompressedSize=d.uncompressedSize);var H=0;p&&(H|=8),O||!R&&!_||(H|=2048);var W=0,bt=0;lt&&(W|=16),E==="UNIX"?(bt=798,W|=function(ct,Lt){var te=ct;return ct||(te=Lt?16893:33204),(65535&te)<<16}(U.unixPermissions,lt)):(bt=20,W|=function(ct){return 63&(ct||0)}(U.dosPermissions)),A=et.getUTCHours(),A<<=6,A|=et.getUTCMinutes(),A<<=5,A|=et.getUTCSeconds()/2,I=et.getUTCFullYear()-1980,I<<=4,I|=et.getUTCMonth()+1,I<<=5,I|=et.getUTCDate(),R&&(Z=s(1,1)+s(l(B),4)+C,P+="up"+s(Z.length,2)+Z),_&&($=s(1,1)+s(l(tt),4)+L,P+="uc"+s($.length,2)+$);var ot="";return ot+=`
\0`,ot+=s(H,2),ot+=S.magic,ot+=s(A,2),ot+=s(I,2),ot+=s(ft.crc32,4),ot+=s(ft.compressedSize,4),ot+=s(ft.uncompressedSize,4),ot+=s(B.length,2),ot+=s(P.length,2),{fileRecord:h.LOCAL_FILE_HEADER+ot+B+P,dirRecord:h.CENTRAL_FILE_HEADER+s(bt,2)+ot+s(tt.length,2)+"\0\0\0\0"+s(W,4)+s(w,4)+B+P+tt}}var a=n("../utils"),c=n("../stream/GenericWorker"),u=n("../utf8"),l=n("../crc32"),h=n("../signature");function f(d,p,m,w){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=w,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(d){var p=d.meta.percent||0,m=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-w-1))/m:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var p=this.streamFiles&&!d.file.dir;if(p){var m=o(d,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var p=this.streamFiles&&!d.file.dir,m=o(d,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(w){return h.DATA_DESCRIPTOR+s(w.crc32,4)+s(w.compressedSize,4)+s(w.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-d,w=function(E,x,A,I,U){var S=a.transformTo("string",U(I));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(E,2)+s(E,2)+s(x,4)+s(A,4)+s(S.length,2)+S}(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var p=this;return d.on("data",function(m){p.processChunk(m)}),d.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),d.on("error",function(m){p.error(m)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var p=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var m=0;m<p.length;m++)try{p[m].error(d)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,p=0;p<d.length;p++)d[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(f,d){h++;var p=function(x,A){var I=x||A,U=s[I];if(!U)throw new Error(I+" is not a valid compression method !");return U}(d.options.compression,c.compression),m=d.options.compressionOptions||c.compressionOptions||{},w=d.dir,E=d.date;d._compressWorker(p,m).withStreamInfo("file",{name:f,dir:w,date:E,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(f){l.error(f)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),u=n("./stream/Crc32Probe"),l=n("./nodejsUtils");function h(f){return new o.Promise(function(d,p){var m=f.decompressed.getContentWorker().pipe(new u);m.on("error",function(w){p(w)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var p=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(m){var w=new c(d);return w.load(m),w}).then(function(m){var w=[o.Promise.resolve(m)],E=m.files;if(d.checkCRC32)for(var x=0;x<E.length;x++)w.push(h(E[x]));return o.Promise.all(w)}).then(function(m){for(var w=m.shift(),E=w.files,x=0;x<E.length;x++){var A=E[x],I=A.fileNameStr,U=s.resolve(A.fileNameStr);p.file(U,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:d.createFolders}),A.dir||(p.file(U).unsafeOriginalName=I)}return w.zipComment.length&&(p.comment=w.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,f){l.push(h)||l._helper.pause(),u&&u(f)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof tn<"u",newBufferFrom:function(s,o){if(tn.from&&tn.from!==Uint8Array.from)return tn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new tn(s,o)},allocBuffer:function(s){if(tn.alloc)return tn.alloc(s);var o=new tn(s);return o.fill(0),o},isBuffer:function(s){return tn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(U,S,O){var B,C=a.getTypeOf(S),G=a.extend(O||{},l);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(U=E(U)),G.createFolders&&(B=w(U))&&x.call(this,B,!0);var tt=C==="string"&&G.binary===!1&&G.base64===!1;O&&O.binary!==void 0||(G.binary=!tt),(S instanceof h&&S.uncompressedSize===0||G.dir||!S||S.length===0)&&(G.base64=!1,G.binary=!0,S="",G.compression="STORE",C="string");var L=null;L=S instanceof h||S instanceof c?S:p.isNode&&p.isStream(S)?new m(U,S):a.prepareContent(U,S,G.binary,G.optimizedBinaryString,G.base64);var R=new f(U,L,G);this.files[U]=R}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),l=n("./defaults"),h=n("./compressedObject"),f=n("./zipObject"),d=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),w=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var S=U.lastIndexOf("/");return 0<S?U.substring(0,S):""},E=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},x=function(U,S){return S=S!==void 0?S:l.createFolders,U=E(U),this.files[U]||s.call(this,U,null,{dir:!0,createFolders:S}),this.files[U]};function A(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var S,O,B;for(S in this.files)B=this.files[S],(O=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&U(O,B)},filter:function(U){var S=[];return this.forEach(function(O,B){U(O,B)&&S.push(B)}),S},file:function(U,S,O){if(arguments.length!==1)return U=this.root+U,s.call(this,U,S,O),this;if(A(U)){var B=U;return this.filter(function(G,tt){return!tt.dir&&B.test(G)})}var C=this.files[this.root+U];return C&&!C.dir?C:null},folder:function(U){if(!U)return this;if(A(U))return this.filter(function(C,G){return G.dir&&U.test(C)});var S=this.root+U,O=x.call(this,S),B=this.clone();return B.root=O.name,B},remove:function(U){U=this.root+U;var S=this.files[U];if(S||(U.slice(-1)!=="/"&&(U+="/"),S=this.files[U]),S&&!S.dir)delete this.files[U];else for(var O=this.filter(function(C,G){return G.name.slice(0,U.length)===U}),B=0;B<O.length;B++)delete this.files[O[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var S,O={};try{if((O=a.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");a.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var B=O.comment||this.comment||"";S=d.generateWorker(this,O,B)}catch(C){(S=new c("error")).error(C)}return new u(S,O.type||"string",O.mimeType)},generateAsync:function(U,S){return this.generateInternalStream(U).accumulate(S)},generateNodeStream:function(U,S){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(S)}};r.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===u&&this.data[f+2]===l&&this.data[f+3]===h)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&u===f[1]&&l===f[2]&&h===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),u=n("./NodeBufferReader"),l=n("./Uint8ArrayReader");r.exports=function(h){var f=s.getTypeOf(h);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),u=n("../support"),l=n("../external"),h=null;if(u.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,m){return new l.Promise(function(w,E){var x=[],A=p._internalType,I=p._outputType,U=p._mimeType;p.on("data",function(S,O){x.push(S),m&&m(O)}).on("error",function(S){x=[],E(S)}).on("end",function(){try{var S=function(O,B,C){switch(O){case"blob":return s.newBlob(s.transformTo("arraybuffer",B),C);case"base64":return c.encode(B);default:return s.transformTo(O,B)}}(I,function(O,B){var C,G=0,tt=null,L=0;for(C=0;C<B.length;C++)L+=B[C].length;switch(O){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(tt=new Uint8Array(L),C=0;C<B.length;C++)tt.set(B[C],G),G+=B[C].length;return tt;case"nodebuffer":return tn.concat(B);default:throw new Error("concat : unsupported type '"+O+"'")}}(A,x),U);w(S)}catch(O){E(O)}x=[]}).resume()})}function d(p,m,w){var E=m;switch(m){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=m,this._mimeType=w,s.checkSupport(E),this._worker=p.pipe(new o(E)),p.lock()}catch(x){this._worker=new a("error"),this._worker.error(x)}}d.prototype={accumulate:function(p){return f(this,p)},on:function(p,m){var w=this;return p==="data"?this._worker.on(p,function(E){m.call(w,E.data,E.meta)}):this._worker.on(p,function(){s.delay(m,arguments,w)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof tn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):function(p){var m,w,E,x,A,I=p.length,U=0;for(x=0;x<I;x++)(64512&(w=p.charCodeAt(x)))==55296&&x+1<I&&(64512&(E=p.charCodeAt(x+1)))==56320&&(w=65536+(w-55296<<10)+(E-56320),x++),U+=w<128?1:w<2048?2:w<65536?3:4;for(m=o.uint8array?new Uint8Array(U):new Array(U),x=A=0;A<U;x++)(64512&(w=p.charCodeAt(x)))==55296&&x+1<I&&(64512&(E=p.charCodeAt(x+1)))==56320&&(w=65536+(w-55296<<10)+(E-56320),x++),w<128?m[A++]=w:(w<2048?m[A++]=192|w>>>6:(w<65536?m[A++]=224|w>>>12:(m[A++]=240|w>>>18,m[A++]=128|w>>>12&63),m[A++]=128|w>>>6&63),m[A++]=128|63&w);return m}(d)},i.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):function(p){var m,w,E,x,A=p.length,I=new Array(2*A);for(m=w=0;m<A;)if((E=p[m++])<128)I[w++]=E;else if(4<(x=u[E]))I[w++]=65533,m+=x-1;else{for(E&=x===2?31:x===3?15:7;1<x&&m<A;)E=E<<6|63&p[m++],x--;1<x?I[w++]=65533:E<65536?I[w++]=E:(E-=65536,I[w++]=55296|E>>10&1023,I[w++]=56320|1023&E)}return I.length!==w&&(I.subarray?I=I.subarray(0,w):I.length=w),s.applyFromCharCode(I)}(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var p=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var w=function(x,A){var I;for((A=A||x.length)>x.length&&(A=x.length),I=A-1;0<=I&&(192&x[I])==128;)I--;return I<0||I===0?A:I+u[x[I]]>A?I:A}(p),E=p;w!==p.length&&(o.uint8array?(E=p.subarray(0,w),this.leftOver=p.subarray(w,p.length)):(E=p.slice(0,w),this.leftOver=p.slice(w,p.length))),this.push({data:i.utf8decode(E),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(f,c),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function u(m){return m}function l(m,w){for(var E=0;E<m.length;++E)w[E]=255&m.charCodeAt(E);return w}n("setimmediate"),i.newBlob=function(m,w){i.checkSupport("blob");try{return new Blob([m],{type:w})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(m),E.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,w,E){var x=[],A=0,I=m.length;if(I<=E)return String.fromCharCode.apply(null,m);for(;A<I;)w==="array"||w==="nodebuffer"?x.push(String.fromCharCode.apply(null,m.slice(A,Math.min(A+E,I)))):x.push(String.fromCharCode.apply(null,m.subarray(A,Math.min(A+E,I)))),A+=E;return x.join("")},stringifyByChar:function(m){for(var w="",E=0;E<m.length;E++)w+=String.fromCharCode(m[E]);return w},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(m){var w=65536,E=i.getTypeOf(m),x=!0;if(E==="uint8array"?x=h.applyCanBeUsed.uint8array:E==="nodebuffer"&&(x=h.applyCanBeUsed.nodebuffer),x)for(;1<w;)try{return h.stringifyByChunk(m,E,w)}catch{w=Math.floor(w/2)}return h.stringifyByChar(m)}function d(m,w){for(var E=0;E<m.length;E++)w[E]=m[E];return w}i.applyFromCharCode=f;var p={};p.string={string:u,array:function(m){return l(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return l(m,new Uint8Array(m.length))},nodebuffer:function(m){return l(m,a.allocBuffer(m.length))}},p.array={string:f,array:u,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:u,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:u,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:u},i.transformTo=function(m,w){if(w=w||"",!m)return w;i.checkSupport(m);var E=i.getTypeOf(w);return p[E][m](w)},i.resolve=function(m){for(var w=m.split("/"),E=[],x=0;x<w.length;x++){var A=w[x];A==="."||A===""&&x!==0&&x!==w.length-1||(A===".."?E.pop():E.push(A))}return E.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var w,E,x="";for(E=0;E<(m||"").length;E++)x+="\\x"+((w=m.charCodeAt(E))<16?"0":"")+w.toString(16).toUpperCase();return x},i.delay=function(m,w,E){setImmediate(function(){m.apply(E||null,w||[])})},i.inherits=function(m,w){function E(){}E.prototype=w.prototype,m.prototype=new E},i.extend=function(){var m,w,E={};for(m=0;m<arguments.length;m++)for(w in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],w)&&E[w]===void 0&&(E[w]=arguments[m][w]);return E},i.prepareContent=function(m,w,E,x,A){return c.Promise.resolve(w).then(function(I){return s.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new c.Promise(function(U,S){var O=new FileReader;O.onload=function(B){U(B.target.result)},O.onerror=function(B){S(B.target.error)},O.readAsArrayBuffer(I)}):I}).then(function(I){var U=i.getTypeOf(I);return U?(U==="arraybuffer"?I=i.transformTo("uint8array",I):U==="string"&&(A?I=o.decode(I):E&&x!==!0&&(I=function(S){return l(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(I))),I):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),u=n("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===f;return this.reader.setIndex(d),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",d=o.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var p=f-d;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),u=n("./utf8"),l=n("./compressions"),h=n("./support");function f(d,p){this.options=d,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var p,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(w){for(var E in l)if(Object.prototype.hasOwnProperty.call(l,E)&&l[E].magic===w)return l[E];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var p=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(p),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var p,m,w,E=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<E;)p=d.readInt(2),m=d.readInt(2),w=d.readData(m),this.extraFields[p]={id:p,length:m,value:w};d.setIndex(E)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var E=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,w){this.name=p,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=m,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),u=n("./compressedObject"),l=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,w="string";try{if(!p)throw new Error("No output type specified.");var E=(w=p.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),m=this._decompressWorker();var x=!this._dataBinary;x&&!E&&(m=m.pipe(new c.Utf8EncodeWorker)),!x&&E&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(A){(m=new l("error")).error(A)}return new o(m,w,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(w,p,m)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(p),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var d=[];function p(){var m,w;a=!0;for(var E=d.length;E;){for(w=d,d=[],m=-1;++m<E;)w[m]();E=d.length}a=!1}r.exports=function(m){d.push(m)!==1||a||o()}}).call(this,typeof kn<"u"?kn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,E!==o&&m(this,E)}function f(E,x,A){this.promise=E,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function d(E,x,A){s(function(){var I;try{I=x(A)}catch(U){return a.reject(E,U)}I===E?a.reject(E,new TypeError("Cannot resolve promise with itself")):a.resolve(E,I)})}function p(E){var x=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof x=="function")return function(){x.apply(E,arguments)}}function m(E,x){var A=!1;function I(O){A||(A=!0,a.reject(E,O))}function U(O){A||(A=!0,a.resolve(E,O))}var S=w(function(){x(U,I)});S.status==="error"&&I(S.value)}function w(E,x){var A={};try{A.value=E(x),A.status="success"}catch(I){A.status="error",A.value=I}return A}(r.exports=h).prototype.finally=function(E){if(typeof E!="function")return this;var x=this.constructor;return this.then(function(A){return x.resolve(E()).then(function(){return A})},function(A){return x.resolve(E()).then(function(){throw A})})},h.prototype.catch=function(E){return this.then(null,E)},h.prototype.then=function(E,x){if(typeof E!="function"&&this.state===u||typeof x!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==l?d(A,this.state===u?E:x,this.outcome):this.queue.push(new f(A,E,x)),A},f.prototype.callFulfilled=function(E){a.resolve(this.promise,E)},f.prototype.otherCallFulfilled=function(E){d(this.promise,this.onFulfilled,E)},f.prototype.callRejected=function(E){a.reject(this.promise,E)},f.prototype.otherCallRejected=function(E){d(this.promise,this.onRejected,E)},a.resolve=function(E,x){var A=w(p,x);if(A.status==="error")return a.reject(E,A.value);var I=A.value;if(I)m(E,I);else{E.state=u,E.outcome=x;for(var U=-1,S=E.queue.length;++U<S;)E.queue[U].callFulfilled(x)}return E},a.reject=function(E,x){E.state=c,E.outcome=x;for(var A=-1,I=E.queue.length;++A<I;)E.queue[A].callRejected(x);return E},h.resolve=function(E){return E instanceof this?E:a.resolve(new this(o),E)},h.reject=function(E){var x=new this(o);return a.reject(x,E)},h.all=function(E){var x=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=E.length,I=!1;if(!A)return this.resolve([]);for(var U=new Array(A),S=0,O=-1,B=new this(o);++O<A;)C(E[O],O);return B;function C(G,tt){x.resolve(G).then(function(L){U[tt]=L,++S!==A||I||(I=!0,a.resolve(B,U))},function(L){I||(I=!0,a.reject(B,L))})}},h.race=function(E){var x=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=E.length,I=!1;if(!A)return this.resolve([]);for(var U=-1,S=new this(o);++U<A;)O=E[U],x.resolve(O).then(function(B){I||(I=!0,a.resolve(S,B))},function(B){I||(I=!0,a.reject(S,B))});var O;return S}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),u=n("./zlib/zstream"),l=Object.prototype.toString,h=0,f=-1,d=0,p=8;function m(E){if(!(this instanceof m))return new m(E);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},E||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(A!==h)throw new Error(c[A]);if(x.header&&s.deflateSetHeader(this.strm,x.header),x.dictionary){var I;if(I=typeof x.dictionary=="string"?a.string2buf(x.dictionary):l.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(A=s.deflateSetDictionary(this.strm,I))!==h)throw new Error(c[A]);this._dict_set=!0}}function w(E,x){var A=new m(x);if(A.push(E,!0),A.err)throw A.msg||c[A.err];return A.result}m.prototype.push=function(E,x){var A,I,U=this.strm,S=this.options.chunkSize;if(this.ended)return!1;I=x===~~x?x:x===!0?4:0,typeof E=="string"?U.input=a.string2buf(E):l.call(E)==="[object ArrayBuffer]"?U.input=new Uint8Array(E):U.input=E,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new o.Buf8(S),U.next_out=0,U.avail_out=S),(A=s.deflate(U,I))!==1&&A!==h)return this.onEnd(A),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(U.output,U.next_out))):this.onData(o.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&A!==1);return I===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===h):I!==2||(this.onEnd(h),!(U.avail_out=0))},m.prototype.onData=function(E){this.chunks.push(E)},m.prototype.onEnd=function(E){E===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},i.Deflate=m,i.deflate=w,i.deflateRaw=function(E,x){return(x=x||{}).raw=!0,w(E,x)},i.gzip=function(E,x){return(x=x||{}).gzip=!0,w(E,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),u=n("./zlib/messages"),l=n("./zlib/zstream"),h=n("./zlib/gzheader"),f=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||m&&m.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var E=s.inflateInit2(this.strm,w.windowBits);if(E!==c.Z_OK)throw new Error(u[E]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,w){var E=new d(w);if(E.push(m,!0),E.err)throw E.msg||u[E.err];return E.result}d.prototype.push=function(m,w){var E,x,A,I,U,S,O=this.strm,B=this.options.chunkSize,C=this.options.dictionary,G=!1;if(this.ended)return!1;x=w===~~w?w:w===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?O.input=a.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?O.input=new Uint8Array(m):O.input=m,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new o.Buf8(B),O.next_out=0,O.avail_out=B),(E=s.inflate(O,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&C&&(S=typeof C=="string"?a.string2buf(C):f.call(C)==="[object ArrayBuffer]"?new Uint8Array(C):C,E=s.inflateSetDictionary(this.strm,S)),E===c.Z_BUF_ERROR&&G===!0&&(E=c.Z_OK,G=!1),E!==c.Z_STREAM_END&&E!==c.Z_OK)return this.onEnd(E),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&E!==c.Z_STREAM_END&&(O.avail_in!==0||x!==c.Z_FINISH&&x!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(O.output,O.next_out),I=O.next_out-A,U=a.buf2string(O.output,A),O.next_out=I,O.avail_out=B-I,I&&o.arraySet(O.output,O.output,A,I,0),this.onData(U)):this.onData(o.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(G=!0)}while((0<O.avail_in||O.avail_out===0)&&E!==c.Z_STREAM_END);return E===c.Z_STREAM_END&&(x=c.Z_FINISH),x===c.Z_FINISH?(E=s.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===c.Z_OK):x!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(O.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=d,i.inflate=p,i.inflateRaw=function(m,w){return(w=w||{}).raw=!0,p(m,w)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,f){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),f);else for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){var u,l,h,f,d,p;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(p=new Uint8Array(h),u=f=0,l=c.length;u<l;u++)d=c[u],p.set(d,f),f+=d.length;return p}},a={arraySet:function(c,u,l,h,f){for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,f));for(var d="",p=0;p<f;p++)d+=String.fromCharCode(h[p]);return d}c[254]=c[254]=1,i.string2buf=function(h){var f,d,p,m,w,E=h.length,x=0;for(m=0;m<E;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<E&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),x+=d<128?1:d<2048?2:d<65536?3:4;for(f=new s.Buf8(x),m=w=0;w<x;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<E&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),d<128?f[w++]=d:(d<2048?f[w++]=192|d>>>6:(d<65536?f[w++]=224|d>>>12:(f[w++]=240|d>>>18,f[w++]=128|d>>>12&63),f[w++]=128|d>>>6&63),f[w++]=128|63&d);return f},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var f=new s.Buf8(h.length),d=0,p=f.length;d<p;d++)f[d]=h.charCodeAt(d);return f},i.buf2string=function(h,f){var d,p,m,w,E=f||h.length,x=new Array(2*E);for(d=p=0;d<E;)if((m=h[d++])<128)x[p++]=m;else if(4<(w=c[m]))x[p++]=65533,d+=w-1;else{for(m&=w===2?31:w===3?15:7;1<w&&d<E;)m=m<<6|63&h[d++],w--;1<w?x[p++]=65533:m<65536?x[p++]=m:(m-=65536,x[p++]=55296|m>>10&1023,x[p++]=56320|1023&m)}return l(x,p)},i.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+c[h[d]]>f?d:f}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var f=u;f<h;f++)o=o>>>8^l[255&(o^a[f])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),u=n("./crc32"),l=n("./messages"),h=0,f=4,d=0,p=-2,m=-1,w=4,E=2,x=8,A=9,I=286,U=30,S=19,O=2*I+1,B=15,C=3,G=258,tt=G+C+1,L=42,R=113,_=1,P=2,Z=3,$=4;function lt(b,st){return b.msg=l[st],st}function et(b){return(b<<1)-(4<b?9:0)}function ft(b){for(var st=b.length;0<=--st;)b[st]=0}function H(b){var st=b.state,nt=st.pending;nt>b.avail_out&&(nt=b.avail_out),nt!==0&&(o.arraySet(b.output,st.pending_buf,st.pending_out,nt,b.next_out),b.next_out+=nt,st.pending_out+=nt,b.total_out+=nt,b.avail_out-=nt,st.pending-=nt,st.pending===0&&(st.pending_out=0))}function W(b,st){a._tr_flush_block(b,0<=b.block_start?b.block_start:-1,b.strstart-b.block_start,st),b.block_start=b.strstart,H(b.strm)}function bt(b,st){b.pending_buf[b.pending++]=st}function ot(b,st){b.pending_buf[b.pending++]=st>>>8&255,b.pending_buf[b.pending++]=255&st}function ct(b,st){var nt,F,M=b.max_chain_length,Y=b.strstart,at=b.prev_length,ht=b.nice_match,J=b.strstart>b.w_size-tt?b.strstart-(b.w_size-tt):0,pt=b.window,_t=b.w_mask,dt=b.prev,vt=b.strstart+G,le=pt[Y+at-1],Ut=pt[Y+at];b.prev_length>=b.good_match&&(M>>=2),ht>b.lookahead&&(ht=b.lookahead);do if(pt[(nt=st)+at]===Ut&&pt[nt+at-1]===le&&pt[nt]===pt[Y]&&pt[++nt]===pt[Y+1]){Y+=2,nt++;do;while(pt[++Y]===pt[++nt]&&pt[++Y]===pt[++nt]&&pt[++Y]===pt[++nt]&&pt[++Y]===pt[++nt]&&pt[++Y]===pt[++nt]&&pt[++Y]===pt[++nt]&&pt[++Y]===pt[++nt]&&pt[++Y]===pt[++nt]&&Y<vt);if(F=G-(vt-Y),Y=vt-G,at<F){if(b.match_start=st,ht<=(at=F))break;le=pt[Y+at-1],Ut=pt[Y+at]}}while((st=dt[st&_t])>J&&--M!=0);return at<=b.lookahead?at:b.lookahead}function Lt(b){var st,nt,F,M,Y,at,ht,J,pt,_t,dt=b.w_size;do{if(M=b.window_size-b.lookahead-b.strstart,b.strstart>=dt+(dt-tt)){for(o.arraySet(b.window,b.window,dt,dt,0),b.match_start-=dt,b.strstart-=dt,b.block_start-=dt,st=nt=b.hash_size;F=b.head[--st],b.head[st]=dt<=F?F-dt:0,--nt;);for(st=nt=dt;F=b.prev[--st],b.prev[st]=dt<=F?F-dt:0,--nt;);M+=dt}if(b.strm.avail_in===0)break;if(at=b.strm,ht=b.window,J=b.strstart+b.lookahead,pt=M,_t=void 0,_t=at.avail_in,pt<_t&&(_t=pt),nt=_t===0?0:(at.avail_in-=_t,o.arraySet(ht,at.input,at.next_in,_t,J),at.state.wrap===1?at.adler=c(at.adler,ht,_t,J):at.state.wrap===2&&(at.adler=u(at.adler,ht,_t,J)),at.next_in+=_t,at.total_in+=_t,_t),b.lookahead+=nt,b.lookahead+b.insert>=C)for(Y=b.strstart-b.insert,b.ins_h=b.window[Y],b.ins_h=(b.ins_h<<b.hash_shift^b.window[Y+1])&b.hash_mask;b.insert&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[Y+C-1])&b.hash_mask,b.prev[Y&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=Y,Y++,b.insert--,!(b.lookahead+b.insert<C)););}while(b.lookahead<tt&&b.strm.avail_in!==0)}function te(b,st){for(var nt,F;;){if(b.lookahead<tt){if(Lt(b),b.lookahead<tt&&st===h)return _;if(b.lookahead===0)break}if(nt=0,b.lookahead>=C&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+C-1])&b.hash_mask,nt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),nt!==0&&b.strstart-nt<=b.w_size-tt&&(b.match_length=ct(b,nt)),b.match_length>=C)if(F=a._tr_tally(b,b.strstart-b.match_start,b.match_length-C),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&b.lookahead>=C){for(b.match_length--;b.strstart++,b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+C-1])&b.hash_mask,nt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart,--b.match_length!=0;);b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+1])&b.hash_mask;else F=a._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(F&&(W(b,!1),b.strm.avail_out===0))return _}return b.insert=b.strstart<C-1?b.strstart:C-1,st===f?(W(b,!0),b.strm.avail_out===0?Z:$):b.last_lit&&(W(b,!1),b.strm.avail_out===0)?_:P}function At(b,st){for(var nt,F,M;;){if(b.lookahead<tt){if(Lt(b),b.lookahead<tt&&st===h)return _;if(b.lookahead===0)break}if(nt=0,b.lookahead>=C&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+C-1])&b.hash_mask,nt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=C-1,nt!==0&&b.prev_length<b.max_lazy_match&&b.strstart-nt<=b.w_size-tt&&(b.match_length=ct(b,nt),b.match_length<=5&&(b.strategy===1||b.match_length===C&&4096<b.strstart-b.match_start)&&(b.match_length=C-1)),b.prev_length>=C&&b.match_length<=b.prev_length){for(M=b.strstart+b.lookahead-C,F=a._tr_tally(b,b.strstart-1-b.prev_match,b.prev_length-C),b.lookahead-=b.prev_length-1,b.prev_length-=2;++b.strstart<=M&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+C-1])&b.hash_mask,nt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),--b.prev_length!=0;);if(b.match_available=0,b.match_length=C-1,b.strstart++,F&&(W(b,!1),b.strm.avail_out===0))return _}else if(b.match_available){if((F=a._tr_tally(b,0,b.window[b.strstart-1]))&&W(b,!1),b.strstart++,b.lookahead--,b.strm.avail_out===0)return _}else b.match_available=1,b.strstart++,b.lookahead--}return b.match_available&&(F=a._tr_tally(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=b.strstart<C-1?b.strstart:C-1,st===f?(W(b,!0),b.strm.avail_out===0?Z:$):b.last_lit&&(W(b,!1),b.strm.avail_out===0)?_:P}function xt(b,st,nt,F,M){this.good_length=b,this.max_lazy=st,this.nice_length=nt,this.max_chain=F,this.func=M}function $t(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*O),this.dyn_dtree=new o.Buf16(2*(2*U+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(B+1),this.heap=new o.Buf16(2*I+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*I+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Gt(b){var st;return b&&b.state?(b.total_in=b.total_out=0,b.data_type=E,(st=b.state).pending=0,st.pending_out=0,st.wrap<0&&(st.wrap=-st.wrap),st.status=st.wrap?L:R,b.adler=st.wrap===2?0:1,st.last_flush=h,a._tr_init(st),d):lt(b,p)}function be(b){var st=Gt(b);return st===d&&function(nt){nt.window_size=2*nt.w_size,ft(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=C-1,nt.match_available=0,nt.ins_h=0}(b.state),st}function Oe(b,st,nt,F,M,Y){if(!b)return p;var at=1;if(st===m&&(st=6),F<0?(at=0,F=-F):15<F&&(at=2,F-=16),M<1||A<M||nt!==x||F<8||15<F||st<0||9<st||Y<0||w<Y)return lt(b,p);F===8&&(F=9);var ht=new $t;return(b.state=ht).strm=b,ht.wrap=at,ht.gzhead=null,ht.w_bits=F,ht.w_size=1<<ht.w_bits,ht.w_mask=ht.w_size-1,ht.hash_bits=M+7,ht.hash_size=1<<ht.hash_bits,ht.hash_mask=ht.hash_size-1,ht.hash_shift=~~((ht.hash_bits+C-1)/C),ht.window=new o.Buf8(2*ht.w_size),ht.head=new o.Buf16(ht.hash_size),ht.prev=new o.Buf16(ht.w_size),ht.lit_bufsize=1<<M+6,ht.pending_buf_size=4*ht.lit_bufsize,ht.pending_buf=new o.Buf8(ht.pending_buf_size),ht.d_buf=1*ht.lit_bufsize,ht.l_buf=3*ht.lit_bufsize,ht.level=st,ht.strategy=Y,ht.method=nt,be(b)}s=[new xt(0,0,0,0,function(b,st){var nt=65535;for(nt>b.pending_buf_size-5&&(nt=b.pending_buf_size-5);;){if(b.lookahead<=1){if(Lt(b),b.lookahead===0&&st===h)return _;if(b.lookahead===0)break}b.strstart+=b.lookahead,b.lookahead=0;var F=b.block_start+nt;if((b.strstart===0||b.strstart>=F)&&(b.lookahead=b.strstart-F,b.strstart=F,W(b,!1),b.strm.avail_out===0)||b.strstart-b.block_start>=b.w_size-tt&&(W(b,!1),b.strm.avail_out===0))return _}return b.insert=0,st===f?(W(b,!0),b.strm.avail_out===0?Z:$):(b.strstart>b.block_start&&(W(b,!1),b.strm.avail_out),_)}),new xt(4,4,8,4,te),new xt(4,5,16,8,te),new xt(4,6,32,32,te),new xt(4,4,16,16,At),new xt(8,16,32,32,At),new xt(8,16,128,128,At),new xt(8,32,128,256,At),new xt(32,128,258,1024,At),new xt(32,258,258,4096,At)],i.deflateInit=function(b,st){return Oe(b,st,x,15,8,0)},i.deflateInit2=Oe,i.deflateReset=be,i.deflateResetKeep=Gt,i.deflateSetHeader=function(b,st){return b&&b.state?b.state.wrap!==2?p:(b.state.gzhead=st,d):p},i.deflate=function(b,st){var nt,F,M,Y;if(!b||!b.state||5<st||st<0)return b?lt(b,p):p;if(F=b.state,!b.output||!b.input&&b.avail_in!==0||F.status===666&&st!==f)return lt(b,b.avail_out===0?-5:p);if(F.strm=b,nt=F.last_flush,F.last_flush=st,F.status===L)if(F.wrap===2)b.adler=0,bt(F,31),bt(F,139),bt(F,8),F.gzhead?(bt(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),bt(F,255&F.gzhead.time),bt(F,F.gzhead.time>>8&255),bt(F,F.gzhead.time>>16&255),bt(F,F.gzhead.time>>24&255),bt(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),bt(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(bt(F,255&F.gzhead.extra.length),bt(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(b.adler=u(b.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(bt(F,0),bt(F,0),bt(F,0),bt(F,0),bt(F,0),bt(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),bt(F,3),F.status=R);else{var at=x+(F.w_bits-8<<4)<<8;at|=(2<=F.strategy||F.level<2?0:F.level<6?1:F.level===6?2:3)<<6,F.strstart!==0&&(at|=32),at+=31-at%31,F.status=R,ot(F,at),F.strstart!==0&&(ot(F,b.adler>>>16),ot(F,65535&b.adler)),b.adler=1}if(F.status===69)if(F.gzhead.extra){for(M=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),H(b),M=F.pending,F.pending!==F.pending_buf_size));)bt(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),H(b),M=F.pending,F.pending===F.pending_buf_size)){Y=1;break}Y=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,bt(F,Y)}while(Y!==0);F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),Y===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),H(b),M=F.pending,F.pending===F.pending_buf_size)){Y=1;break}Y=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,bt(F,Y)}while(Y!==0);F.gzhead.hcrc&&F.pending>M&&(b.adler=u(b.adler,F.pending_buf,F.pending-M,M)),Y===0&&(F.status=103)}else F.status=103;if(F.status===103&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&H(b),F.pending+2<=F.pending_buf_size&&(bt(F,255&b.adler),bt(F,b.adler>>8&255),b.adler=0,F.status=R)):F.status=R),F.pending!==0){if(H(b),b.avail_out===0)return F.last_flush=-1,d}else if(b.avail_in===0&&et(st)<=et(nt)&&st!==f)return lt(b,-5);if(F.status===666&&b.avail_in!==0)return lt(b,-5);if(b.avail_in!==0||F.lookahead!==0||st!==h&&F.status!==666){var ht=F.strategy===2?function(J,pt){for(var _t;;){if(J.lookahead===0&&(Lt(J),J.lookahead===0)){if(pt===h)return _;break}if(J.match_length=0,_t=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++,_t&&(W(J,!1),J.strm.avail_out===0))return _}return J.insert=0,pt===f?(W(J,!0),J.strm.avail_out===0?Z:$):J.last_lit&&(W(J,!1),J.strm.avail_out===0)?_:P}(F,st):F.strategy===3?function(J,pt){for(var _t,dt,vt,le,Ut=J.window;;){if(J.lookahead<=G){if(Lt(J),J.lookahead<=G&&pt===h)return _;if(J.lookahead===0)break}if(J.match_length=0,J.lookahead>=C&&0<J.strstart&&(dt=Ut[vt=J.strstart-1])===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]){le=J.strstart+G;do;while(dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&vt<le);J.match_length=G-(le-vt),J.match_length>J.lookahead&&(J.match_length=J.lookahead)}if(J.match_length>=C?(_t=a._tr_tally(J,1,J.match_length-C),J.lookahead-=J.match_length,J.strstart+=J.match_length,J.match_length=0):(_t=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++),_t&&(W(J,!1),J.strm.avail_out===0))return _}return J.insert=0,pt===f?(W(J,!0),J.strm.avail_out===0?Z:$):J.last_lit&&(W(J,!1),J.strm.avail_out===0)?_:P}(F,st):s[F.level].func(F,st);if(ht!==Z&&ht!==$||(F.status=666),ht===_||ht===Z)return b.avail_out===0&&(F.last_flush=-1),d;if(ht===P&&(st===1?a._tr_align(F):st!==5&&(a._tr_stored_block(F,0,0,!1),st===3&&(ft(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),H(b),b.avail_out===0))return F.last_flush=-1,d}return st!==f?d:F.wrap<=0?1:(F.wrap===2?(bt(F,255&b.adler),bt(F,b.adler>>8&255),bt(F,b.adler>>16&255),bt(F,b.adler>>24&255),bt(F,255&b.total_in),bt(F,b.total_in>>8&255),bt(F,b.total_in>>16&255),bt(F,b.total_in>>24&255)):(ot(F,b.adler>>>16),ot(F,65535&b.adler)),H(b),0<F.wrap&&(F.wrap=-F.wrap),F.pending!==0?d:1)},i.deflateEnd=function(b){var st;return b&&b.state?(st=b.state.status)!==L&&st!==69&&st!==73&&st!==91&&st!==103&&st!==R&&st!==666?lt(b,p):(b.state=null,st===R?lt(b,-3):d):p},i.deflateSetDictionary=function(b,st){var nt,F,M,Y,at,ht,J,pt,_t=st.length;if(!b||!b.state||(Y=(nt=b.state).wrap)===2||Y===1&&nt.status!==L||nt.lookahead)return p;for(Y===1&&(b.adler=c(b.adler,st,_t,0)),nt.wrap=0,_t>=nt.w_size&&(Y===0&&(ft(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),pt=new o.Buf8(nt.w_size),o.arraySet(pt,st,_t-nt.w_size,nt.w_size,0),st=pt,_t=nt.w_size),at=b.avail_in,ht=b.next_in,J=b.input,b.avail_in=_t,b.next_in=0,b.input=st,Lt(nt);nt.lookahead>=C;){for(F=nt.strstart,M=nt.lookahead-(C-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[F+C-1])&nt.hash_mask,nt.prev[F&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=F,F++,--M;);nt.strstart=F,nt.lookahead=C-1,Lt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=C-1,nt.match_available=0,b.next_in=ht,b.input=J,b.avail_in=at,nt.wrap=Y,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,u,l,h,f,d,p,m,w,E,x,A,I,U,S,O,B,C,G,tt,L,R,_,P;a=s.state,c=s.next_in,_=s.input,u=c+(s.avail_in-5),l=s.next_out,P=s.output,h=l-(o-s.avail_out),f=l+(s.avail_out-257),d=a.dmax,p=a.wsize,m=a.whave,w=a.wnext,E=a.window,x=a.hold,A=a.bits,I=a.lencode,U=a.distcode,S=(1<<a.lenbits)-1,O=(1<<a.distbits)-1;t:do{A<15&&(x+=_[c++]<<A,A+=8,x+=_[c++]<<A,A+=8),B=I[x&S];e:for(;;){if(x>>>=C=B>>>24,A-=C,(C=B>>>16&255)===0)P[l++]=65535&B;else{if(!(16&C)){if(!(64&C)){B=I[(65535&B)+(x&(1<<C)-1)];continue e}if(32&C){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}G=65535&B,(C&=15)&&(A<C&&(x+=_[c++]<<A,A+=8),G+=x&(1<<C)-1,x>>>=C,A-=C),A<15&&(x+=_[c++]<<A,A+=8,x+=_[c++]<<A,A+=8),B=U[x&O];n:for(;;){if(x>>>=C=B>>>24,A-=C,!(16&(C=B>>>16&255))){if(!(64&C)){B=U[(65535&B)+(x&(1<<C)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(tt=65535&B,A<(C&=15)&&(x+=_[c++]<<A,(A+=8)<C&&(x+=_[c++]<<A,A+=8)),d<(tt+=x&(1<<C)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(x>>>=C,A-=C,(C=l-h)<tt){if(m<(C=tt-C)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(R=E,(L=0)===w){if(L+=p-C,C<G){for(G-=C;P[l++]=E[L++],--C;);L=l-tt,R=P}}else if(w<C){if(L+=p+w-C,(C-=w)<G){for(G-=C;P[l++]=E[L++],--C;);if(L=0,w<G){for(G-=C=w;P[l++]=E[L++],--C;);L=l-tt,R=P}}}else if(L+=w-C,C<G){for(G-=C;P[l++]=E[L++],--C;);L=l-tt,R=P}for(;2<G;)P[l++]=R[L++],P[l++]=R[L++],P[l++]=R[L++],G-=3;G&&(P[l++]=R[L++],1<G&&(P[l++]=R[L++]))}else{for(L=l-tt;P[l++]=P[L++],P[l++]=P[L++],P[l++]=P[L++],2<(G-=3););G&&(P[l++]=P[L++],1<G&&(P[l++]=P[L++]))}break}}break}}while(c<u&&l<f);c-=G=A>>3,x&=(1<<(A-=G<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<f?f-l+257:257-(l-f),a.hold=x,a.bits=A}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),u=n("./inftrees"),l=1,h=2,f=0,d=-2,p=1,m=852,w=592;function E(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(L){var R;return L&&L.state?(R=L.state,L.total_in=L.total_out=R.total=0,L.msg="",R.wrap&&(L.adler=1&R.wrap),R.mode=p,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new s.Buf32(m),R.distcode=R.distdyn=new s.Buf32(w),R.sane=1,R.back=-1,f):d}function I(L){var R;return L&&L.state?((R=L.state).wsize=0,R.whave=0,R.wnext=0,A(L)):d}function U(L,R){var _,P;return L&&L.state?(P=L.state,R<0?(_=0,R=-R):(_=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?d:(P.window!==null&&P.wbits!==R&&(P.window=null),P.wrap=_,P.wbits=R,I(L))):d}function S(L,R){var _,P;return L?(P=new x,(L.state=P).window=null,(_=U(L,R))!==f&&(L.state=null),_):d}var O,B,C=!0;function G(L){if(C){var R;for(O=new s.Buf32(512),B=new s.Buf32(32),R=0;R<144;)L.lens[R++]=8;for(;R<256;)L.lens[R++]=9;for(;R<280;)L.lens[R++]=7;for(;R<288;)L.lens[R++]=8;for(u(l,L.lens,0,288,O,0,L.work,{bits:9}),R=0;R<32;)L.lens[R++]=5;u(h,L.lens,0,32,B,0,L.work,{bits:5}),C=!1}L.lencode=O,L.lenbits=9,L.distcode=B,L.distbits=5}function tt(L,R,_,P){var Z,$=L.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new s.Buf8($.wsize)),P>=$.wsize?(s.arraySet($.window,R,_-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(P<(Z=$.wsize-$.wnext)&&(Z=P),s.arraySet($.window,R,_-P,Z,$.wnext),(P-=Z)?(s.arraySet($.window,R,_-P,P,0),$.wnext=P,$.whave=$.wsize):($.wnext+=Z,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=Z))),0}i.inflateReset=I,i.inflateReset2=U,i.inflateResetKeep=A,i.inflateInit=function(L){return S(L,15)},i.inflateInit2=S,i.inflate=function(L,R){var _,P,Z,$,lt,et,ft,H,W,bt,ot,ct,Lt,te,At,xt,$t,Gt,be,Oe,b,st,nt,F,M=0,Y=new s.Buf8(4),at=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return d;(_=L.state).mode===12&&(_.mode=13),lt=L.next_out,Z=L.output,ft=L.avail_out,$=L.next_in,P=L.input,et=L.avail_in,H=_.hold,W=_.bits,bt=et,ot=ft,st=f;t:for(;;)switch(_.mode){case p:if(_.wrap===0){_.mode=13;break}for(;W<16;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}if(2&_.wrap&&H===35615){Y[_.check=0]=255&H,Y[1]=H>>>8&255,_.check=a(_.check,Y,2,0),W=H=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&H)<<8)+(H>>8))%31){L.msg="incorrect header check",_.mode=30;break}if((15&H)!=8){L.msg="unknown compression method",_.mode=30;break}if(W-=4,b=8+(15&(H>>>=4)),_.wbits===0)_.wbits=b;else if(b>_.wbits){L.msg="invalid window size",_.mode=30;break}_.dmax=1<<b,L.adler=_.check=1,_.mode=512&H?10:12,W=H=0;break;case 2:for(;W<16;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}if(_.flags=H,(255&_.flags)!=8){L.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){L.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=H>>8&1),512&_.flags&&(Y[0]=255&H,Y[1]=H>>>8&255,_.check=a(_.check,Y,2,0)),W=H=0,_.mode=3;case 3:for(;W<32;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}_.head&&(_.head.time=H),512&_.flags&&(Y[0]=255&H,Y[1]=H>>>8&255,Y[2]=H>>>16&255,Y[3]=H>>>24&255,_.check=a(_.check,Y,4,0)),W=H=0,_.mode=4;case 4:for(;W<16;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}_.head&&(_.head.xflags=255&H,_.head.os=H>>8),512&_.flags&&(Y[0]=255&H,Y[1]=H>>>8&255,_.check=a(_.check,Y,2,0)),W=H=0,_.mode=5;case 5:if(1024&_.flags){for(;W<16;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}_.length=H,_.head&&(_.head.extra_len=H),512&_.flags&&(Y[0]=255&H,Y[1]=H>>>8&255,_.check=a(_.check,Y,2,0)),W=H=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(et<(ct=_.length)&&(ct=et),ct&&(_.head&&(b=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),s.arraySet(_.head.extra,P,$,ct,b)),512&_.flags&&(_.check=a(_.check,P,ct,$)),et-=ct,$+=ct,_.length-=ct),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(et===0)break t;for(ct=0;b=P[$+ct++],_.head&&b&&_.length<65536&&(_.head.name+=String.fromCharCode(b)),b&&ct<et;);if(512&_.flags&&(_.check=a(_.check,P,ct,$)),et-=ct,$+=ct,b)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(et===0)break t;for(ct=0;b=P[$+ct++],_.head&&b&&_.length<65536&&(_.head.comment+=String.fromCharCode(b)),b&&ct<et;);if(512&_.flags&&(_.check=a(_.check,P,ct,$)),et-=ct,$+=ct,b)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;W<16;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}if(H!==(65535&_.check)){L.msg="header crc mismatch",_.mode=30;break}W=H=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),L.adler=_.check=0,_.mode=12;break;case 10:for(;W<32;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}L.adler=_.check=E(H),W=H=0,_.mode=11;case 11:if(_.havedict===0)return L.next_out=lt,L.avail_out=ft,L.next_in=$,L.avail_in=et,_.hold=H,_.bits=W,2;L.adler=_.check=1,_.mode=12;case 12:if(R===5||R===6)break t;case 13:if(_.last){H>>>=7&W,W-=7&W,_.mode=27;break}for(;W<3;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}switch(_.last=1&H,W-=1,3&(H>>>=1)){case 0:_.mode=14;break;case 1:if(G(_),_.mode=20,R!==6)break;H>>>=2,W-=2;break t;case 2:_.mode=17;break;case 3:L.msg="invalid block type",_.mode=30}H>>>=2,W-=2;break;case 14:for(H>>>=7&W,W-=7&W;W<32;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}if((65535&H)!=(H>>>16^65535)){L.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&H,W=H=0,_.mode=15,R===6)break t;case 15:_.mode=16;case 16:if(ct=_.length){if(et<ct&&(ct=et),ft<ct&&(ct=ft),ct===0)break t;s.arraySet(Z,P,$,ct,lt),et-=ct,$+=ct,ft-=ct,lt+=ct,_.length-=ct;break}_.mode=12;break;case 17:for(;W<14;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}if(_.nlen=257+(31&H),H>>>=5,W-=5,_.ndist=1+(31&H),H>>>=5,W-=5,_.ncode=4+(15&H),H>>>=4,W-=4,286<_.nlen||30<_.ndist){L.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;W<3;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}_.lens[at[_.have++]]=7&H,H>>>=3,W-=3}for(;_.have<19;)_.lens[at[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,nt={bits:_.lenbits},st=u(0,_.lens,0,19,_.lencode,0,_.work,nt),_.lenbits=nt.bits,st){L.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;xt=(M=_.lencode[H&(1<<_.lenbits)-1])>>>16&255,$t=65535&M,!((At=M>>>24)<=W);){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}if($t<16)H>>>=At,W-=At,_.lens[_.have++]=$t;else{if($t===16){for(F=At+2;W<F;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}if(H>>>=At,W-=At,_.have===0){L.msg="invalid bit length repeat",_.mode=30;break}b=_.lens[_.have-1],ct=3+(3&H),H>>>=2,W-=2}else if($t===17){for(F=At+3;W<F;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}W-=At,b=0,ct=3+(7&(H>>>=At)),H>>>=3,W-=3}else{for(F=At+7;W<F;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}W-=At,b=0,ct=11+(127&(H>>>=At)),H>>>=7,W-=7}if(_.have+ct>_.nlen+_.ndist){L.msg="invalid bit length repeat",_.mode=30;break}for(;ct--;)_.lens[_.have++]=b}}if(_.mode===30)break;if(_.lens[256]===0){L.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,nt={bits:_.lenbits},st=u(l,_.lens,0,_.nlen,_.lencode,0,_.work,nt),_.lenbits=nt.bits,st){L.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,nt={bits:_.distbits},st=u(h,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,nt),_.distbits=nt.bits,st){L.msg="invalid distances set",_.mode=30;break}if(_.mode=20,R===6)break t;case 20:_.mode=21;case 21:if(6<=et&&258<=ft){L.next_out=lt,L.avail_out=ft,L.next_in=$,L.avail_in=et,_.hold=H,_.bits=W,c(L,ot),lt=L.next_out,Z=L.output,ft=L.avail_out,$=L.next_in,P=L.input,et=L.avail_in,H=_.hold,W=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;xt=(M=_.lencode[H&(1<<_.lenbits)-1])>>>16&255,$t=65535&M,!((At=M>>>24)<=W);){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}if(xt&&!(240&xt)){for(Gt=At,be=xt,Oe=$t;xt=(M=_.lencode[Oe+((H&(1<<Gt+be)-1)>>Gt)])>>>16&255,$t=65535&M,!(Gt+(At=M>>>24)<=W);){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}H>>>=Gt,W-=Gt,_.back+=Gt}if(H>>>=At,W-=At,_.back+=At,_.length=$t,xt===0){_.mode=26;break}if(32&xt){_.back=-1,_.mode=12;break}if(64&xt){L.msg="invalid literal/length code",_.mode=30;break}_.extra=15&xt,_.mode=22;case 22:if(_.extra){for(F=_.extra;W<F;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}_.length+=H&(1<<_.extra)-1,H>>>=_.extra,W-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;xt=(M=_.distcode[H&(1<<_.distbits)-1])>>>16&255,$t=65535&M,!((At=M>>>24)<=W);){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}if(!(240&xt)){for(Gt=At,be=xt,Oe=$t;xt=(M=_.distcode[Oe+((H&(1<<Gt+be)-1)>>Gt)])>>>16&255,$t=65535&M,!(Gt+(At=M>>>24)<=W);){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}H>>>=Gt,W-=Gt,_.back+=Gt}if(H>>>=At,W-=At,_.back+=At,64&xt){L.msg="invalid distance code",_.mode=30;break}_.offset=$t,_.extra=15&xt,_.mode=24;case 24:if(_.extra){for(F=_.extra;W<F;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}_.offset+=H&(1<<_.extra)-1,H>>>=_.extra,W-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){L.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ft===0)break t;if(ct=ot-ft,_.offset>ct){if((ct=_.offset-ct)>_.whave&&_.sane){L.msg="invalid distance too far back",_.mode=30;break}Lt=ct>_.wnext?(ct-=_.wnext,_.wsize-ct):_.wnext-ct,ct>_.length&&(ct=_.length),te=_.window}else te=Z,Lt=lt-_.offset,ct=_.length;for(ft<ct&&(ct=ft),ft-=ct,_.length-=ct;Z[lt++]=te[Lt++],--ct;);_.length===0&&(_.mode=21);break;case 26:if(ft===0)break t;Z[lt++]=_.length,ft--,_.mode=21;break;case 27:if(_.wrap){for(;W<32;){if(et===0)break t;et--,H|=P[$++]<<W,W+=8}if(ot-=ft,L.total_out+=ot,_.total+=ot,ot&&(L.adler=_.check=_.flags?a(_.check,Z,ot,lt-ot):o(_.check,Z,ot,lt-ot)),ot=ft,(_.flags?H:E(H))!==_.check){L.msg="incorrect data check",_.mode=30;break}W=H=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;W<32;){if(et===0)break t;et--,H+=P[$++]<<W,W+=8}if(H!==(4294967295&_.total)){L.msg="incorrect length check",_.mode=30;break}W=H=0}_.mode=29;case 29:st=1;break t;case 30:st=-3;break t;case 31:return-4;case 32:default:return d}return L.next_out=lt,L.avail_out=ft,L.next_in=$,L.avail_in=et,_.hold=H,_.bits=W,(_.wsize||ot!==L.avail_out&&_.mode<30&&(_.mode<27||R!==4))&&tt(L,L.output,L.next_out,ot-L.avail_out)?(_.mode=31,-4):(bt-=L.avail_in,ot-=L.avail_out,L.total_in+=bt,L.total_out+=ot,_.total+=ot,_.wrap&&ot&&(L.adler=_.check=_.flags?a(_.check,Z,ot,L.next_out-ot):o(_.check,Z,ot,L.next_out-ot)),L.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(bt==0&&ot===0||R===4)&&st===f&&(st=-5),st)},i.inflateEnd=function(L){if(!L||!L.state)return d;var R=L.state;return R.window&&(R.window=null),L.state=null,f},i.inflateGetHeader=function(L,R){var _;return L&&L.state&&2&(_=L.state).wrap?((_.head=R).done=!1,f):d},i.inflateSetDictionary=function(L,R){var _,P=R.length;return L&&L.state?(_=L.state).wrap!==0&&_.mode!==11?d:_.mode===11&&o(1,R,P,0)!==_.check?-3:tt(L,R,P,P)?(_.mode=31,-4):(_.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(l,h,f,d,p,m,w,E){var x,A,I,U,S,O,B,C,G,tt=E.bits,L=0,R=0,_=0,P=0,Z=0,$=0,lt=0,et=0,ft=0,H=0,W=null,bt=0,ot=new s.Buf16(16),ct=new s.Buf16(16),Lt=null,te=0;for(L=0;L<=15;L++)ot[L]=0;for(R=0;R<d;R++)ot[h[f+R]]++;for(Z=tt,P=15;1<=P&&ot[P]===0;P--);if(P<Z&&(Z=P),P===0)return p[m++]=20971520,p[m++]=20971520,E.bits=1,0;for(_=1;_<P&&ot[_]===0;_++);for(Z<_&&(Z=_),L=et=1;L<=15;L++)if(et<<=1,(et-=ot[L])<0)return-1;if(0<et&&(l===0||P!==1))return-1;for(ct[1]=0,L=1;L<15;L++)ct[L+1]=ct[L]+ot[L];for(R=0;R<d;R++)h[f+R]!==0&&(w[ct[h[f+R]]++]=R);if(O=l===0?(W=Lt=w,19):l===1?(W=o,bt-=257,Lt=a,te-=257,256):(W=c,Lt=u,-1),L=_,S=m,lt=R=H=0,I=-1,U=(ft=1<<($=Z))-1,l===1&&852<ft||l===2&&592<ft)return 1;for(;;){for(B=L-lt,G=w[R]<O?(C=0,w[R]):w[R]>O?(C=Lt[te+w[R]],W[bt+w[R]]):(C=96,0),x=1<<L-lt,_=A=1<<$;p[S+(H>>lt)+(A-=x)]=B<<24|C<<16|G|0,A!==0;);for(x=1<<L-1;H&x;)x>>=1;if(x!==0?(H&=x-1,H+=x):H=0,R++,--ot[L]==0){if(L===P)break;L=h[f+w[R]]}if(Z<L&&(H&U)!==I){for(lt===0&&(lt=Z),S+=_,et=1<<($=L-lt);$+lt<P&&!((et-=ot[$+lt])<=0);)$++,et<<=1;if(ft+=1<<$,l===1&&852<ft||l===2&&592<ft)return 1;p[I=H&U]=Z<<24|$<<16|S-m|0}}return H!==0&&(p[S+H]=L-lt<<24|64<<16|0),E.bits=Z,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(M){for(var Y=M.length;0<=--Y;)M[Y]=0}var u=0,l=29,h=256,f=h+1+l,d=30,p=19,m=2*f+1,w=15,E=16,x=7,A=256,I=16,U=17,S=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],tt=new Array(2*(f+2));c(tt);var L=new Array(2*d);c(L);var R=new Array(512);c(R);var _=new Array(256);c(_);var P=new Array(l);c(P);var Z,$,lt,et=new Array(d);function ft(M,Y,at,ht,J){this.static_tree=M,this.extra_bits=Y,this.extra_base=at,this.elems=ht,this.max_length=J,this.has_stree=M&&M.length}function H(M,Y){this.dyn_tree=M,this.max_code=0,this.stat_desc=Y}function W(M){return M<256?R[M]:R[256+(M>>>7)]}function bt(M,Y){M.pending_buf[M.pending++]=255&Y,M.pending_buf[M.pending++]=Y>>>8&255}function ot(M,Y,at){M.bi_valid>E-at?(M.bi_buf|=Y<<M.bi_valid&65535,bt(M,M.bi_buf),M.bi_buf=Y>>E-M.bi_valid,M.bi_valid+=at-E):(M.bi_buf|=Y<<M.bi_valid&65535,M.bi_valid+=at)}function ct(M,Y,at){ot(M,at[2*Y],at[2*Y+1])}function Lt(M,Y){for(var at=0;at|=1&M,M>>>=1,at<<=1,0<--Y;);return at>>>1}function te(M,Y,at){var ht,J,pt=new Array(w+1),_t=0;for(ht=1;ht<=w;ht++)pt[ht]=_t=_t+at[ht-1]<<1;for(J=0;J<=Y;J++){var dt=M[2*J+1];dt!==0&&(M[2*J]=Lt(pt[dt]++,dt))}}function At(M){var Y;for(Y=0;Y<f;Y++)M.dyn_ltree[2*Y]=0;for(Y=0;Y<d;Y++)M.dyn_dtree[2*Y]=0;for(Y=0;Y<p;Y++)M.bl_tree[2*Y]=0;M.dyn_ltree[2*A]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0}function xt(M){8<M.bi_valid?bt(M,M.bi_buf):0<M.bi_valid&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0}function $t(M,Y,at,ht){var J=2*Y,pt=2*at;return M[J]<M[pt]||M[J]===M[pt]&&ht[Y]<=ht[at]}function Gt(M,Y,at){for(var ht=M.heap[at],J=at<<1;J<=M.heap_len&&(J<M.heap_len&&$t(Y,M.heap[J+1],M.heap[J],M.depth)&&J++,!$t(Y,ht,M.heap[J],M.depth));)M.heap[at]=M.heap[J],at=J,J<<=1;M.heap[at]=ht}function be(M,Y,at){var ht,J,pt,_t,dt=0;if(M.last_lit!==0)for(;ht=M.pending_buf[M.d_buf+2*dt]<<8|M.pending_buf[M.d_buf+2*dt+1],J=M.pending_buf[M.l_buf+dt],dt++,ht===0?ct(M,J,Y):(ct(M,(pt=_[J])+h+1,Y),(_t=O[pt])!==0&&ot(M,J-=P[pt],_t),ct(M,pt=W(--ht),at),(_t=B[pt])!==0&&ot(M,ht-=et[pt],_t)),dt<M.last_lit;);ct(M,A,Y)}function Oe(M,Y){var at,ht,J,pt=Y.dyn_tree,_t=Y.stat_desc.static_tree,dt=Y.stat_desc.has_stree,vt=Y.stat_desc.elems,le=-1;for(M.heap_len=0,M.heap_max=m,at=0;at<vt;at++)pt[2*at]!==0?(M.heap[++M.heap_len]=le=at,M.depth[at]=0):pt[2*at+1]=0;for(;M.heap_len<2;)pt[2*(J=M.heap[++M.heap_len]=le<2?++le:0)]=1,M.depth[J]=0,M.opt_len--,dt&&(M.static_len-=_t[2*J+1]);for(Y.max_code=le,at=M.heap_len>>1;1<=at;at--)Gt(M,pt,at);for(J=vt;at=M.heap[1],M.heap[1]=M.heap[M.heap_len--],Gt(M,pt,1),ht=M.heap[1],M.heap[--M.heap_max]=at,M.heap[--M.heap_max]=ht,pt[2*J]=pt[2*at]+pt[2*ht],M.depth[J]=(M.depth[at]>=M.depth[ht]?M.depth[at]:M.depth[ht])+1,pt[2*at+1]=pt[2*ht+1]=J,M.heap[1]=J++,Gt(M,pt,1),2<=M.heap_len;);M.heap[--M.heap_max]=M.heap[1],function(Ut,Mn){var v,g,y,N,D,Q,rt=Mn.dyn_tree,Ft=Mn.max_code,Ee=Mn.stat_desc.static_tree,ye=Mn.stat_desc.has_stree,we=Mn.stat_desc.extra_bits,oe=Mn.stat_desc.extra_base,Aa=Mn.stat_desc.max_length,Fl=0;for(N=0;N<=w;N++)Ut.bl_count[N]=0;for(rt[2*Ut.heap[Ut.heap_max]+1]=0,v=Ut.heap_max+1;v<m;v++)Aa<(N=rt[2*rt[2*(g=Ut.heap[v])+1]+1]+1)&&(N=Aa,Fl++),rt[2*g+1]=N,Ft<g||(Ut.bl_count[N]++,D=0,oe<=g&&(D=we[g-oe]),Q=rt[2*g],Ut.opt_len+=Q*(N+D),ye&&(Ut.static_len+=Q*(Ee[2*g+1]+D)));if(Fl!==0){do{for(N=Aa-1;Ut.bl_count[N]===0;)N--;Ut.bl_count[N]--,Ut.bl_count[N+1]+=2,Ut.bl_count[Aa]--,Fl-=2}while(0<Fl);for(N=Aa;N!==0;N--)for(g=Ut.bl_count[N];g!==0;)Ft<(y=Ut.heap[--v])||(rt[2*y+1]!==N&&(Ut.opt_len+=(N-rt[2*y+1])*rt[2*y],rt[2*y+1]=N),g--)}}(M,Y),te(pt,le,M.bl_count)}function b(M,Y,at){var ht,J,pt=-1,_t=Y[1],dt=0,vt=7,le=4;for(_t===0&&(vt=138,le=3),Y[2*(at+1)+1]=65535,ht=0;ht<=at;ht++)J=_t,_t=Y[2*(ht+1)+1],++dt<vt&&J===_t||(dt<le?M.bl_tree[2*J]+=dt:J!==0?(J!==pt&&M.bl_tree[2*J]++,M.bl_tree[2*I]++):dt<=10?M.bl_tree[2*U]++:M.bl_tree[2*S]++,pt=J,le=(dt=0)===_t?(vt=138,3):J===_t?(vt=6,3):(vt=7,4))}function st(M,Y,at){var ht,J,pt=-1,_t=Y[1],dt=0,vt=7,le=4;for(_t===0&&(vt=138,le=3),ht=0;ht<=at;ht++)if(J=_t,_t=Y[2*(ht+1)+1],!(++dt<vt&&J===_t)){if(dt<le)for(;ct(M,J,M.bl_tree),--dt!=0;);else J!==0?(J!==pt&&(ct(M,J,M.bl_tree),dt--),ct(M,I,M.bl_tree),ot(M,dt-3,2)):dt<=10?(ct(M,U,M.bl_tree),ot(M,dt-3,3)):(ct(M,S,M.bl_tree),ot(M,dt-11,7));pt=J,le=(dt=0)===_t?(vt=138,3):J===_t?(vt=6,3):(vt=7,4)}}c(et);var nt=!1;function F(M,Y,at,ht){ot(M,(u<<1)+(ht?1:0),3),function(J,pt,_t,dt){xt(J),bt(J,_t),bt(J,~_t),s.arraySet(J.pending_buf,J.window,pt,_t,J.pending),J.pending+=_t}(M,Y,at)}i._tr_init=function(M){nt||(function(){var Y,at,ht,J,pt,_t=new Array(w+1);for(J=ht=0;J<l-1;J++)for(P[J]=ht,Y=0;Y<1<<O[J];Y++)_[ht++]=J;for(_[ht-1]=J,J=pt=0;J<16;J++)for(et[J]=pt,Y=0;Y<1<<B[J];Y++)R[pt++]=J;for(pt>>=7;J<d;J++)for(et[J]=pt<<7,Y=0;Y<1<<B[J]-7;Y++)R[256+pt++]=J;for(at=0;at<=w;at++)_t[at]=0;for(Y=0;Y<=143;)tt[2*Y+1]=8,Y++,_t[8]++;for(;Y<=255;)tt[2*Y+1]=9,Y++,_t[9]++;for(;Y<=279;)tt[2*Y+1]=7,Y++,_t[7]++;for(;Y<=287;)tt[2*Y+1]=8,Y++,_t[8]++;for(te(tt,f+1,_t),Y=0;Y<d;Y++)L[2*Y+1]=5,L[2*Y]=Lt(Y,5);Z=new ft(tt,O,h+1,f,w),$=new ft(L,B,0,d,w),lt=new ft(new Array(0),C,0,p,x)}(),nt=!0),M.l_desc=new H(M.dyn_ltree,Z),M.d_desc=new H(M.dyn_dtree,$),M.bl_desc=new H(M.bl_tree,lt),M.bi_buf=0,M.bi_valid=0,At(M)},i._tr_stored_block=F,i._tr_flush_block=function(M,Y,at,ht){var J,pt,_t=0;0<M.level?(M.strm.data_type===2&&(M.strm.data_type=function(dt){var vt,le=4093624447;for(vt=0;vt<=31;vt++,le>>>=1)if(1&le&&dt.dyn_ltree[2*vt]!==0)return o;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return a;for(vt=32;vt<h;vt++)if(dt.dyn_ltree[2*vt]!==0)return a;return o}(M)),Oe(M,M.l_desc),Oe(M,M.d_desc),_t=function(dt){var vt;for(b(dt,dt.dyn_ltree,dt.l_desc.max_code),b(dt,dt.dyn_dtree,dt.d_desc.max_code),Oe(dt,dt.bl_desc),vt=p-1;3<=vt&&dt.bl_tree[2*G[vt]+1]===0;vt--);return dt.opt_len+=3*(vt+1)+5+5+4,vt}(M),J=M.opt_len+3+7>>>3,(pt=M.static_len+3+7>>>3)<=J&&(J=pt)):J=pt=at+5,at+4<=J&&Y!==-1?F(M,Y,at,ht):M.strategy===4||pt===J?(ot(M,2+(ht?1:0),3),be(M,tt,L)):(ot(M,4+(ht?1:0),3),function(dt,vt,le,Ut){var Mn;for(ot(dt,vt-257,5),ot(dt,le-1,5),ot(dt,Ut-4,4),Mn=0;Mn<Ut;Mn++)ot(dt,dt.bl_tree[2*G[Mn]+1],3);st(dt,dt.dyn_ltree,vt-1),st(dt,dt.dyn_dtree,le-1)}(M,M.l_desc.max_code+1,M.d_desc.max_code+1,_t+1),be(M,M.dyn_ltree,M.dyn_dtree)),At(M),ht&&xt(M)},i._tr_tally=function(M,Y,at){return M.pending_buf[M.d_buf+2*M.last_lit]=Y>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&Y,M.pending_buf[M.l_buf+M.last_lit]=255&at,M.last_lit++,Y===0?M.dyn_ltree[2*at]++:(M.matches++,Y--,M.dyn_ltree[2*(_[at]+h+1)]++,M.dyn_dtree[2*W(Y)]++),M.last_lit===M.lit_bufsize-1},i._tr_align=function(M){ot(M,2,3),ct(M,A,tt),function(Y){Y.bi_valid===16?(bt(Y,Y.bi_buf),Y.bi_buf=0,Y.bi_valid=0):8<=Y.bi_valid&&(Y.pending_buf[Y.pending++]=255&Y.bi_buf,Y.bi_buf>>=8,Y.bi_valid-=8)}(M)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,f=1,d={},p=!1,m=o.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(o);w=w&&w.setTimeout?w:o,c={}.toString.call(o.process)==="[object process]"?function(I){Ri.nextTick(function(){x(I)})}:function(){if(o.postMessage&&!o.importScripts){var I=!0,U=o.onmessage;return o.onmessage=function(){I=!1},o.postMessage("","*"),o.onmessage=U,I}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(I){o.postMessage(h+I,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(I){x(I.data)},function(I){l.port2.postMessage(I)}):m&&"onreadystatechange"in m.createElement("script")?(u=m.documentElement,function(I){var U=m.createElement("script");U.onreadystatechange=function(){x(I),U.onreadystatechange=null,u.removeChild(U),U=null},u.appendChild(U)}):function(I){setTimeout(x,0,I)},w.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var U=new Array(arguments.length-1),S=0;S<U.length;S++)U[S]=arguments[S+1];var O={callback:I,args:U};return d[f]=O,c(f),f++},w.clearImmediate=E}function E(I){delete d[I]}function x(I){if(p)setTimeout(x,0,I);else{var U=d[I];if(U){p=!0;try{(function(S){var O=S.callback,B=S.args;switch(B.length){case 0:O();break;case 1:O(B[0]);break;case 2:O(B[0],B[1]);break;case 3:O(B[0],B[1],B[2]);break;default:O.apply(a,B)}})(U)}finally{E(I),p=!1}}}}function A(I){I.source===o&&typeof I.data=="string"&&I.data.indexOf(h)===0&&x(+I.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof kn<"u"?kn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(K1);var eM=K1.exports,od=xs(eM);const G1={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(G1);var ar=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},yo,ka,ws;class nM{constructor(...t){yo.set(this,new Map),ka.set(this,new Map),ws.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),ar(this,ws,"f").has(r)||ar(this,ws,"f").set(r,new Set);const s=ar(this,ws,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&ar(this,ka,"f").set(r,a),o=!1,c)continue;const u=ar(this,yo,"f").get(a);if(u&&u!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${u} -> ${a}". Pass \`force=true\` to override this definition.`);ar(this,yo,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:ar(this,yo,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&ar(this,ka,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:ar(this,ws,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of ar(this,ws,"f").values())Object.freeze(t);return this}_getTestState(){return{types:ar(this,yo,"f"),extensions:ar(this,ka,"f")}}}yo=new WeakMap,ka=new WeakMap,ws=new WeakMap;var rM=new nM(G1)._freeze();function H1(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return rM.getType(e)??"application/octet-stream"}async function iM(e,t){try{xr(z,e.name);const n=await e.arrayBuffer();(await new od().loadAsync(n)).forEach((s,o)=>{o.async("uint8array").then(a=>{const c=H1(s,a),u=new File([a],o.name,{type:c});t(u)}).catch(a=>{ae(z,"crash",a.message)})})}catch(n){ae(z,"crash",n.message)}}async function sM(e,t){try{xr(z,e.name);const n=await e.arrayBuffer();t(new Uint8Array(n))}catch(n){ae(z,"crash",n.message)}}function Y1(e,t){function n(r){if(k(t))switch(r){case"text/plain":t.text().then(i=>Xl(z,void 0,"text",`file:${t.name}`,i,e)).catch(i=>ae(z,"crash",i.message));break;case"application/json":t.text().then(i=>Xl(z,void 0,"json",`file:${t.name}`,i,e)).catch(i=>ae(z,"crash",i.message));break;case"application/zip":iM(t,i=>Y1(e,i)).catch(i=>ae(z,"crash",i.message));break;case"application/octet-stream":sM(t,i=>Xl(z,void 0,"binary",`file:${t.name}`,i,e)).catch(i=>ae(z,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=H1(t.name,new Uint8Array(i));if(s)n(s);else return ae(z,"parsewebfile",`unsupported file ${t.name}`)}).catch(i=>ae(z,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function xa(e,t){function n(r){ae(e,"crash",r.message)}t().catch(n)}function oM(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function aM(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const cM=new Date("1980/09/02");async function V1(e){return console.info("saved",e),new Promise((t,n)=>{const r=new od;for(let i=0;i<e.length;++i){const s=e[i],o=EC(s);if(o){const a=UT(o);k(a)&&r.file(s.id,a,{date:cM})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(aM(i))}).catch(n)})}async function lM(e){return new Promise((t,n)=>{const r=new od;r.loadAsync(oM(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),u=wC(FT(c));k(u)&&i.push(u)}t(i)}).catch(n)})}const X1="$yellow$205$205$205$196";function q1(e,t){return`${e.x},${e.y},${t.x},${t.y}`}let Ve;function uM(){return!!Ve}function hM(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,u=[],l=[];for(let h=i;h<=o;++h)for(let f=r;f<=s;++f){const d={x:f-r,y:h-i},p=or(e,{x:f,y:h});(p==null?void 0:p.category)===Gn.ISOBJECT?(u.push(Xe(Qf(e,f,h))),Ur(p)!=="player"&&l.push({...Xe(p),...d,id:"blank"})):u.push({...Xe(p),...d})}return{board:e.id,width:a,height:c,terrain:u,objects:l}}function fM(e,t,n,r){const i=Er(e);if(k(i))switch(Ve=hM(i,t,n),r){case"copyobjects":Ve.terrain=[];break;case"copyterrain":Ve.objects=[];break}}function dM(e,t,n){const r=q1(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,X1),ne(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),ne(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),ne(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=wn(e);i.scroll=Qr(e)}function pM(e,t,n,r){const i=Er(e);if(!k(i)||!k(Ve))return;const s=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),c=Math.max(t.y,n.y),u=a-s+1,l=c-o+1,h=Math.min(Ve.width,u),f=Math.min(Ve.height,l);switch(r){case"pasteall":{for(let d=0;d<f;++d)for(let p=0;p<h;++p){const m=ac({x:p,y:d},Ve.width);kr(i,{...Ve.terrain[m],x:s+p,y:o+d})}for(let d=0;d<Ve.objects.length;++d){const p=Ve.objects[d];k(p.x)&&k(p.y)&&w0(p.x,p.y,0,u-1,l-1,0)&&td(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let d=0;d<Ve.objects.length;++d){const p=Ve.objects[d];k(p.x)&&k(p.y)&&w0(p.x,p.y,0,u-1,l-1,0)&&td(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let d=0;d<f;++d)for(let p=0;p<h;++p){const m=ac({x:p,y:d},Ve.width);kr(i,{...Ve.terrain[m],x:s+p,y:o+d})}break;case"pasteterraintiled":for(let d=o;d<=c;++d)for(let p=s;p<=a;++p){const m=(p-s)%Ve.width,w=(d-o)%Ve.height,E=ac({x:m,y:w},Ve.width);kr(i,{...Ve.terrain[E],x:p,y:d})}break}}function mM(e,t,n){const r=q1(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,X1),ne(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),ne(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),ne(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),ne(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=wn(e);i.scroll=Qr(e)}const _o="$yellow$205$205$205$196";function Ul(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function gM(e,t,n,r){const i=Er(e);if(!k(i))return;let s=0;function o(){return s}function a(u,l){Ct(l)&&(s=l,k0(t.x,t.y,n.x,n.y).forEach(h=>{const f=or(i,h);k(f)&&(f[u]=l)}))}ce(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,_o),ne(e,`batch:${Ul(t,n)}`,"char",[r,"charedit"],o,a);const c=wn(e);c.scroll=Qr(e)}function yM(e,t,n,r){const i=Er(e);if(!k(i))return;let s=0;function o(){return s}function a(u,l){if(console.info("memoryinspectcolorarea",u,l),Ct(l)){s=l;for(let h=t.y;h<=n.y;++h)for(let f=t.x;f<=n.x;++f){const d=or(i,{x:f,y:h});k(d)&&(d[u]=l)}}}ce(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,_o),ne(e,`batch:${Ul(t,n)}`,"color",[r,"coloredit"],o,a);const c=wn(e);c.scroll=Qr(e)}function _M(e,t,n,r){const i=Er(e);if(!k(i))return;let s=0;function o(){return s}function a(u,l){Ct(l)&&(s=l,k0(t.x,t.y,n.x,n.y).forEach(h=>{const f=or(i,h);k(f)&&(f[u]=l)}))}ce(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,_o),ne(e,`batch:${Ul(t,n)}`,"color",[r,"coloredit"],o,a);const c=wn(e);c.scroll=Qr(e)}function bM(e,t,n){const r=Ul(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,_o),ne(e,"batch","copy elements",[`copy:${r}`,"hk","1"," 1 ","next"]),uM()&&ne(e,"batch","paste elements",[`paste:${r}`,"hk","2"," 2 ","next"]),ne(e,"batch","copy coords",[`copycoords:${r}`,"hk","5"," 5 "]),ce(e,_o),ne(e,"batch","set chars:",[`chars:${r}`,"hk","a"," A ","next"]),ne(e,"batch","set colors:",[`colors:${r}`,"hk","c"," C ","next"]),ne(e,"batch","set bgs:",[`bgs:${r}`,"hk","b"," B ","next"]),ce(e,_o),ne(e,"batch","make empty",[`empty:${r}`,"hk","0"," 0 ","next"])}const Ta="$yellow$205$205$205$196";function ad(e,t){return`inspect:${t!=null&&t.id?t.id:Zr(e,t)}`}function EM(e,t,n){const r=Wn(Dt.MAIN);if(!k(r))return;const i=Er(e);if(!k(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){k(t)&&(t[f]=d)}const a=t.category===Gn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=ad(i,t);ce(e,`${a}: ${c} ${u}`),ce(e,Ta),ne(e,l,"color",[n,"coloredit"],s,o);const h=wn(e);h.scroll=Qr(e)}function wM(e,t,n){const r=Wn(Dt.MAIN);if(!k(r))return;const i=Er(e);if(!k(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){k(t)&&(t[f]=d)}const a=t.category===Gn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=ad(i,t);ce(e,`${a}: ${c} ${u}`),ce(e,Ta),ne(e,l,"char",[n,"charedit"],s,o);const h=wn(e);h.scroll=Qr(e)}function J1(e,t,n,r,i,s){var h,f,d;function o(p){var w;const m=(r==null?void 0:r[p])??((w=r==null?void 0:r.kinddata)==null?void 0:w[p]);if(!k(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Ht.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){k(r)&&(r[p]=m)}s?ce(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):ce(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),ce(e,Ta);const c=ad(t,r);s?(ne(e,c,"cycle",["cycle","number","1","255"],o,a),ne(e,c,"collision",["collision","select","iswalking",`${Ht.ISWALK}`,"isswimming",`${Ht.ISSWIM}`],o,a)):ne(e,c,"collision",["collision","select","iswalkable",`${Ht.ISWALK}`,"isswimable",`${Ht.ISSWIM}`,"issolid",`${Ht.ISSOLID}`],o,a),s&&ne(e,c,"pushable",["pushable","select","no","0","yes","1"],o,a),ne(e,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const u=ha(n),l=Kn(u);for(let p=0;p<l.length;++p){const m=l[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(re(u[m])){const[w,E,...x]=u[m];St(E)&&ne(e,c,E||m,[m,w,...x],o,a)}break}}ce(e,Ta),ne(e,c,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],o,a),ne(e,c,`color: ${r.color??((f=r.kinddata)==null?void 0:f.color)??15}`,["color","hk","c"," C ","next"],o,a),ne(e,c,`bg: ${r.bg??((d=r.kinddata)==null?void 0:d.bg)??0}`,["bg","hk","b"," B ","next"],o,a),ce(e,Ta),ne(e,c,"make empty",["empty","hk","0"],o,a)}const Z1="$yellow$205$205$205$196";function kM(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function xM(e,t,n,r){const i=Wn(Dt.MAIN);if(!k(i))return;const s=Er(e);if(k(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=or(s,{x:a,y:o});(c==null?void 0:c.category)===Gn.ISOBJECT&&Yr(i,s,c,i.timestamp),kr(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=or(s,{x:a,y:o});(c==null?void 0:c.category)===Gn.ISOBJECT&&Yr(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)kr(s,{x:a,y:o});break}}}function TM(e,t,n){const r=kM(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,Z1),ne(e,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),ne(e,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),ne(e,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=wn(e);i.scroll=Qr(e)}function AM(e,t,n){const r=Wn(Dt.MAIN);if(!k(r))return;const i=Er(e);if(!k(i))return;if(yr(r,i),t.x===n.x&&t.y===n.y){const o=or(i,t);if(k(o)){const a=Nn(r,Et.TERRAIN,o.kind??"");k(a)&&J1(e,i,a,o,t,!1);const c=Nn(r,Et.OBJECT,o.kind??"");k(c)&&J1(e,i,c,o,t,!0)}else ce(e,`empty: ${t.x}, ${t.y}`),ce(e,Z1)}else bM(e,t,n);const s=wn(e);s.scroll=Qr(e)}function vM(e,t){const n=me(Dt.MAIN);if(!k(n))return;const r=Er(t);if(!k(r))return;const i=Xi(e),s=HL(r,i.target);if(k(s))switch(i.path){case"bg":case"color":EM(t,s,i.path);break;case"char":wM(t,s,i.path);break;case"empty":Yr(n,r,s,n.timestamp);break;case"code":xa(z,async()=>{if(!k(t))return;const o=Ur(s),a="object";se(z,`opened [${a}] ${o}`);const c=[r.id,s.id??""];Ku(Ia(n.id,c),s.code??""),Yb(z,t),await wE(800),Td(z,n.id,[r.id,s.id??""],a,`${o} - ${n.name}`,t)});break;default:console.info("unknown inspect",i);break}}function SM(e,t){const n=Er(t);if(!k(n))return;const r=Xi(e),[i,s,o,a]=r.path.split(",").map(l=>parseFloat(l)),c={x:i,y:s},u={x:o,y:a};switch(r.target){case"copy":dM(t,c,u);break;case"copyall":case"copyobjects":case"copyterrain":fM(t,c,u,r.target);break;case"paste":mM(t,c,u);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":pM(t,c,u,r.target);break;case"empty":TM(t,c,u);break;case"emptyall":case"emptyobjects":case"emptyterrain":xM(t,c,u,r.target);break;case"chars":gM(t,c,u,"char");break;case"colors":yM(t,c,u,"color");break;case"bgs":_M(t,c,u,"bg");break;case"copycoords":{tE(z,r.path,ki());break}default:console.info("unknown batch",r);break}}const RM=16,ks={},IM=15*60*5;let Q1=0;const bo={},Eo={};async function tb(e){const t=po(),n=me(Dt.MAIN);if(t.length&&k(n)){const r=await V1(t),i=e?"autosave":`${new Date().toISOString()} ${n.name} ${r.length} chars`;Zb(ge,i,r,ki())}}async function OM(){const e=po(),t=me(Dt.MAIN);if(e.length&&k(t)){const n=await V1(e);Qb(ge,n,ki())}}const ge=vs("vm",["tick","second"],e=>{var t;if(ge.session(e))switch(e.target){case"operator":k(e.player)&&(xL(e.player),zt(ge,`operator set to ${e.player}`),ge.replynext(e,"ackoperator",!0,e.player));break;case"zsswords":if(e.player===ki()){const n=me(Dt.MAIN);ge.replynext(e,"ackzsswords",{cli:Pf(Wi.CLI),loader:Pf(Wi.LOADER),runtime:Pf(Wi.RUNTIME),flags:[...Kn(Es(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...ms(n,Et.OBJECT).map(r=>Ue(r)),...Kn(Mf)],altkinds:[...ms(n,Et.TERRAIN),...ms(n,Et.BOARD),...ms(n,Et.PALETTE),...ms(n,Et.CHARSET),...ms(n,Et.LOADER)].map(r=>Ue(r)),colors:[...Kn($o)],dirs:[...Kn(qf).filter(r=>["cw","ccw","oop","rndp"].includes(r)===!1)],dirmods:["cw","ccw","oop","rndp",...Kn(Uf)]},e.player)}break;case"books":e.player===ki()&&xa(ge,async()=>{if(e.player&&re(e.data)){const[n,r]=e.data,i=await lM(n),s=i.map(o=>o.name);IL(i,r),zt(ge,`loading ${s.join(", ")}`),Yl(ge,e.player)}});break;case"joinack":k(e.player)&&!LL(e.player)&&Yl(ge,e.player);break;case"logout":k(e.player)&&(CL(e.player),delete ks[e.player],zt(ge,`player ${e.player} logout`),Yl(ge,e.player));break;case"login":k(e.player)&&NL(e.player)&&(ks[e.player]=0,zt(ge,`login from ${e.player}`),ge.replynext(e,"acklogin",!0,e.player));break;case"doot":k(e.player)&&(ks[e.player]=0,xd(ge,"active",e.player));break;case"input":if(k(e.player)){const n=Es(e.player),[r=mn.NONE,i=0]=e.data??[mn.NONE,0];re(n.inputqueue)||(n.inputqueue=[]),r!==mn.NONE&&n.inputqueue.push([r,i])}break;case"codewatch":if(k(e.player)&&re(e.data)){const[n,r]=e.data,i=Ia(n,r);k(Eo[i])||(Eo[i]=_0(i,s=>{const[o,a]=r,c=br(n),u=ji(c,o);if(k(u))if(Gr(u)===Et.BOARD&&k(a)){const l=un(u),h=Ln(l,a);k(h)&&(h.code=s,_f(I_(s),h))}else u.code=s,bC(u)})),bo[i]=bo[i]??new Set,bo[i].add(e.player)}break;case"coderelease":if(e.player&&re(e.data)){const[n,r]=e.data,[,i]=r,s=Ia(n,r);k(bo[s])&&(bo[s].delete(e.player),bo[s].size===0&&((t=Eo[s])==null||t.call(Eo),Eo[s]=void 0,St(i)&&FL(i)))}break;case"halt":e.player===ki()&&Pb(e.data)&&TL(e.data);break;case"tick":AL()||PL();break;case"synthsend":St(e.data)&&Xf(e.data,void 0);break;case"second":{ML(ks);const n=Object.keys(ks);for(let r=0;r<n.length;++r)++ks[n[r]];for(let r=0;r<n.length;++r){const i=n[r];ks[i]>=RM&&Ad(ge,i)}++Q1>=IM&&(Q1=0,xa(ge,async()=>{await tb(!0)}));break}case"copyjsonfile":{const n=me(Dt.MAIN);if(k(n)&&re(e.data)){const[r]=e.data,i=ji(n,r);k(i)&&eE(ge,i,`${Ue(i)}.${ps(i)}.json`,ki())}break}case"fork":xa(ge,async()=>{await OM()});break;case"flush":xa(ge,async()=>{await tb()});break;case"cli":k(e.player)&&DL(e.player,e.data);break;case"restart":e.player===ki()&&(BL(),vd(ge,e.player));break;case"inspect":if(k(e.player)&&re(e.data)){const[n,r]=e.data;AM(e.player,n,r)}break;case"loader":if(k(e.player)&&re(e.data)){const[n,r,i,s]=e.data;if(r==="file")Y1(e.player,s);else if(r==="json"&&/file:.*\.book.json/.test(i)){zt(ge,`loading ${i}`);const o=JSON.parse(s.json),a=me(Dt.MAIN);k(a)&&k(o.data)&&St(o.exported)&&(Yf(o.data),zt(ge,`loaded ${o.exported}`))}else if(r==="json"&&/file:.*\..*\.json/.test(i)){zt(ge,`loading ${i}`);const o=JSON.parse(s.json),a=me(Dt.MAIN);k(a)&&k(o.data)&&St(o.exported)&&(L_(a,o.data),zt(ge,`loaded ${o.exported}`))}else s4(n,r,i,s,e.player)}break;default:{const{target:n,path:r}=Xi(e.target);switch(Mt(n)){case"batch":k(e.player)&&SM(r,e.player);break;case"inspect":k(e.player)&&vM(r,e.player);break;case"touched":if(re(e.data)){const[i,s,o]=e.data;U1({...e,target:`${i}:${o}`,data:void 0,sender:s})}break;default:U1(e);break}break}}},kL());function NM(){Jb(ge)}const{forward:CM}=bE(e=>postMessage(e));onmessage=function(t){CM(t.data)},setTimeout(NM,100)})();

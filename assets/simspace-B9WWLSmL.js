var tM=Object.defineProperty;var eM=(Fr,Rn,gn)=>Rn in Fr?tM(Fr,Rn,{enumerable:!0,configurable:!0,writable:!0,value:gn}):Fr[Rn]=gn;var Ct=(Fr,Rn,gn)=>eM(Fr,typeof Rn!="symbol"?Rn+"":Rn,gn);(function(){"use strict";const Fr=new Set,Rn={emit(e,t,n,r,i){Rn.invoke(mE(e,t,n,r,i))},invoke(e){switch(e.target){}Fr.forEach(t=>t.handle(e))},connect(e){Fr.add(e)},disconnect(e){Fr.delete(e)}};var gn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function so(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function M1(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var Xf={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(gn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=r();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Xf);var U1=Xf.exports,Jf=so(U1),Zf={};(function(e){var t=gn&&gn.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var f=0,d=l.length,p;f<d;f++)(p||!(f in l))&&(p||(p=Array.prototype.slice.call(l,0,f)),p[f]=l[f]);return u.concat(p||Array.prototype.slice.call(l))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(u){return u[Math.floor(Math.random()*u.length)]}function r(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,f=u.capitalize,d=f===void 0?!0:f,p=u.adjectiveCount,g=p===void 0?1:p,w=u.addAdverb,b=w===void 0?!1:w,k=t(t(t([],t([],Array(g),!0).map(function(v){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),b?[n(e.adverbs)]:[],!0);return d&&(k=k.map(function(v){return v.charAt(0).toUpperCase()+v.substr(1)})),k.join(h)}e.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(d?e.adverbs.length:1)}e.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,g=p===void 0?"":p;return r(e.adjectives).length*h+h*g.length+r(e.nouns).length+g.length+r(e.verbs).length+(d?r(e.adverbs).length+g.length:0)}e.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,g=p===void 0?"":p;return i(e.adjectives).length*h+h*g.length+i(e.nouns).length+g.length+i(e.verbs).length+(d?i(e.adverbs).length+g.length:0)}e.minLength=c,e.default=s})(Zf);var P1=so(Zf);const B1="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let F1=e=>crypto.getRandomValues(new Uint8Array(e)),D1=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},Qf=(e,t=21)=>D1(e,t,F1),$1=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=B1[n[e]&63];return t};var td="abcdefghijklmnopqrstuvwxyz",ed="ABCDEFGHIJKLMNOPQRSTUVWXYZ",nd="0123456789",j1="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",z1="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const K1=nd,W1=td,G1=ed;var H1=K1+W1+G1,Al={lowercase:td,uppercase:ed,numbers:nd,nolookalikes:j1,nolookalikesSafe:z1,alphanumeric:H1};function Re(){return`sid_${$1(12).replaceAll("-",".")}`}Qf(Al.numbers,4),Qf(`${Al.numbers}${Al.lowercase}`,16);function fs(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function Y1(){return P1({capitalize:!1,adjectiveCount:1})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var V1=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),q1=Object.prototype.hasOwnProperty;function vl(e,t){return q1.call(e,t)}function Sl(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)vl(e,i)&&r.push(i);return r}function yn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Rl(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Di(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function rd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Il(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Il(e[t]))return!0}else if(typeof e=="object"){for(var r=Sl(e),i=r.length,s=0;s<i;s++)if(Il(e[r[s]]))return!0}}return!1}function id(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var sd=function(e){V1(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,id(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=id(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),xe=sd,X1=yn,ds={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=fa(n,this.path);r&&(r=yn(r));var i=$i(n,{op:"remove",path:this.from}).removed;return $i(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=fa(n,this.from);return $i(n,{op:"add",path:this.path,value:yn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:oo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},J1={add:function(e,t,n){return Rl(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:ds.move,copy:ds.copy,test:ds.test,_get:ds._get};function fa(e,t){if(t=="")return e;var n={op:"_get",path:t};return $i(e,n),n.value}function $i(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):da(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=fa(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=oo(e,t.value),o.test===!1)throw new xe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new xe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=yn(e));var a=t.path||"",c=a.split("/"),u=e,l=1,h=c.length,f=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=da;;){if(d=c[l],d&&d.indexOf("~")!=-1&&(d=rd(d)),i&&(d=="__proto__"||d=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&f===void 0&&(u[d]===void 0?f=c.slice(0,l).join("/"):l==h-1&&(f=t.path),f!==void 0&&p(t,0,e,f)),l++,Array.isArray(u)){if(d==="-")d=u.length;else{if(n&&!Rl(d))throw new xe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Rl(d)&&(d=~~d)}if(l>=h){if(n&&t.op==="add"&&d>u.length)throw new xe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=J1[t.op].call(t,u,d,e);if(o.test===!1)throw new xe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(l>=h){var o=ds[t.op].call(t,u,d,e);if(o.test===!1)throw new xe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(u=u[d],n&&l<h&&(!u||typeof u!="object"))throw new xe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Nl(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new xe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=yn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=$i(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function Z1(e,t,n){var r=$i(e,t);if(r.test===!1)throw new xe("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function da(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new xe("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(ds[e.op]){if(typeof e.path!="string")throw new xe("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new xe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new xe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new xe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Il(e.value))throw new xe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new xe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new xe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=od([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new xe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new xe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function od(e,t,n){try{if(!Array.isArray(e))throw new xe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Nl(yn(t),yn(e),n||!0);else{n=n||da;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof xe)return i;throw i}}function oo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!oo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!oo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var Q1=Object.freeze({__proto__:null,JsonPatchError:xe,_areEquals:oo,applyOperation:$i,applyPatch:Nl,applyReducer:Z1,deepClone:X1,getValueByPointer:fa,validate:od,validator:da});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Ol=new WeakMap,tE=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),eE=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function nE(e){return Ol.get(e)}function rE(e,t){return e.observers.get(t)}function iE(e,t){e.observers.delete(t.callback)}function sE(e,t){t.unobserve()}function oE(e,t){var n=[],r,i=nE(e);if(!i)i=new tE(e),Ol.set(e,i);else{var s=rE(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=yn(e),t){r.callback=t,r.next=null;var o=function(){Cl(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){Cl(r),clearTimeout(r.next),iE(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new eE(t,r)),r}function Cl(e,t){t===void 0&&(t=!1);var n=Ol.get(e.object);Ll(n.value,e.object,e.patches,"",t),e.patches.length&&Nl(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Ll(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Sl(t),o=Sl(e),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=e[u];if(vl(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var h=t[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?Ll(l,h,n,r+"/"+Di(u),i):l!==h&&(i&&n.push({op:"test",path:r+"/"+Di(u),value:yn(l)}),n.push({op:"replace",path:r+"/"+Di(u),value:yn(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Di(u),value:yn(l)}),n.push({op:"remove",path:r+"/"+Di(u)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!vl(e,u)&&t[u]!==void 0&&n.push({op:"add",path:r+"/"+Di(u),value:yn(t[u])})}}}function ad(e,t,n){n===void 0&&(n=!1);var r=[];return Ll(e,t,r,"",n),r}var aE=Object.freeze({__proto__:null,compare:ad,generate:Cl,observe:oE,unobserve:sE});Object.assign({},Q1,aE,{JsonPatchError:sd,deepClone:yn,escapePathComponent:Di,unescapePathComponent:rd});var cE=typeof Element<"u",lE=typeof Map=="function",uE=typeof Set=="function",hE=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function pa(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!pa(e[r],t[r]))return!1;return!0}var s;if(lE&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!pa(r.value[1],t.get(r.value[0])))return!1;return!0}if(uE&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(hE&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(cE&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!pa(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var fE=function(t,n){try{return pa(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},dE=so(fE);function T(e){return e!=null}const Dr=Object.keys;function ur(e){return yn(e)}function pE(e){return typeof e=="boolean"}function Lt(e){return typeof e=="number"&&isNaN(e)===!1}function At(e){return typeof e=="string"}function ie(e){return Array.isArray(e)}function Ml(e){return e}var jt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(jt||{}),Gt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Gt||{}),Dn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Dn||{}),_t=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(_t||{}),bt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.COPYIT=13]="COPYIT",e[e.OPENIT=14]="OPENIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(bt||{});function Bt(e){return e.toLowerCase().trim()}function mE(e,t,n,r,i){return{session:e,id:Re(),target:t,sender:n,data:r,player:i}}function ps(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function ms(e,t=[],n=Ml,r=""){const i=Re(),s=Bt(e),o=t.map(Bt);let a=r;const c={id(){return i},name(){return e},session(u){return T(u)?u.session===a?u.session:"":a},topics(){return t},emit(u,l,h){Rn.emit(a,u,i,l,h)},reply(u,l,h,f){c.emit(`${u.sender}:${l}`,h,f)},replynext(u,l,h,f){setTimeout(()=>c.emit(`${u.sender}:${l}`,h,f),64)},handle(u){const{target:l,path:h}=ps(u.target),f=Bt(l);!a&&f==="ready"&&(a=u.session),f==="bridge"&&T(u.session)&&(a=u.session),o.findIndex(d=>d==="all"||d===f)!==-1&&n(u),(i===l||f==="all"||s===f)&&n({...u,target:h})}};return Rn.connect(c),c}function gE(e){return T(e)&&typeof e=="object"&&At(e.id)&&At(e.target)&&At(e.sender)}function ae(e,t,n,r){const i=r??"";return e.emit(`error:${t}`,n,i),zE(e,n,i)}function yE(e,t,n){e.emit("broadcast:startstream",t,n)}function _E(e,t){e.emit("broadcast:stopstream",void 0,t)}function EE(e,t,n){e.emit("chat:connect",t,n)}function bE(e,t){e.emit("chat:disconnect",void 0,t)}function wE(e,t,n){e.emit("gadgetclient:paint",t,n)}function TE(e,t,n){e.emit("gadgetclient:patch",t,n)}function kE(e,t){e.emit("gadgetserver:clearscroll",void 0,t)}function xE(e,t,n,r,i,s,o){e.emit("network:fetch",[t,n,r,i,s],o)}function AE(e,t,n){e.emit("network:start",t,n)}function vE(e){e.emit("ready")}function Ul(e,t){e.emit("register:loginready",!0,t)}function SE(e,t,n,r){e.emit("register:savemem",[t,n],r)}function RE(e,t,n){e.emit("register:forkmem",[t],n)}function IE(e,t,n){e.emit("register:copy",t,n)}function NE(e,t){e.emit("register:dev",void 0,t)}function OE(e,t){e.emit("register:share",void 0,t)}function CE(e,t){e.emit("register:nuke",void 0,t)}function LE(e,t,n){e.emit("synth:tts",[t,n])}function ME(e,t){e.emit("synth:tta",[t])}function UE(e,t,n){e.emit("synth:play",[t,n])}function PE(e,t){e.emit("synth:bpm",t)}function BE(e,t){e.emit("synth:playvolume",t)}function FE(e,t){e.emit("synth:bgplayvolume",t)}function DE(e,t){e.emit("synth:ttsvolume",t)}function Pl(e,t,n,r){e.emit("synth:voice",[t,n,r])}function $E(e,t,n,r,i){e.emit("synth:voicefx",[t,n,r,i])}function hr(e,...t){return e.emit("tape:info",t),!0}function cd(e,...t){return e.emit("tape:debug",t),!0}function jE(e,t,n){e.emit("tape:inspector",t,n)}function zE(e,...t){return e.emit("tape:error",t),!1}function ld(e,t,n,r,i,s){e.emit("tape:editor:open",[t,n,r,i],s)}function ud(e,t){e.emit("vm:logout",void 0,t)}function ma(e,t){return`${e}:${t.join(":")}`}function KE(e,t){e.emit("vm:restart",void 0,t)}function Bl(e,t){e.emit("vm:flush",void 0,t)}function WE(e,t){e.emit("vm:fork",void 0,t)}function GE(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function HE(e,t){return{filename:e,json:t}}function YE(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function Fl(e,t,n,r,i,s){let o;switch(n){case"file":o=i;break;case"text":o=GE(r,i);break;case"json":o=HE(r,i);break;case"binary":o=YE(r,i);break}setTimeout(()=>{e.emit("vm:loader",[t,n,r,o],s)},1)}function VE(e){const t=new Set;function n(s){gE(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Rn.invoke(s))}const r=ms("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Rn.disconnect(r)}return{forward:n,disconnect:i}}const Dl=66.666,ga=Math.round(1e3/Dl),qE=3;function XE(e){return new Promise(t=>setTimeout(t,e))}const $l=ms("clock");let jl=0,ya=0,zl=0,hd=performance.now();function fd(){const e=performance.now(),t=e-hd;zl+=t,zl>=Dl&&(zl%=Dl,$l.emit("tick",ya),$l.emit("tock",ya),++jl,++ya,jl>=ga&&(jl%=ga,$l.emit("second",ya))),hd=e,setTimeout(fd,2)}fd();const dd=1,pd=2,Kl=4,Wl=8,ao=32,$r=64,In=128,_a=31,Gl=63,ji=127,JE=2147483647,di=Math.floor,Ea=Math.abs,md=(e,t)=>e<t?e:t,zi=(e,t)=>e>t?e:t,gd=e=>e!==0?e<0:1/e<0,yd=Number.MAX_SAFE_INTEGER,ZE=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&di(e)===e),gs=()=>new Set,Hl=e=>e[e.length-1],QE=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},pi=Array.from,tb=Array.isArray,eb=e=>e.toLowerCase(),nb=/^\s*/g,rb=e=>e.replace(nb,""),ib=/([A-Z])/g,_d=(e,t)=>rb(e.replace(ib,n=>`${t}${eb(n)}`)),sb=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},co=typeof TextEncoder<"u"?new TextEncoder:null,ob=co?e=>co.encode(e):sb;let lo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});lo&&lo.decode(new Uint8Array).length===1&&(lo=null);const mi=e=>new Error(e),fr=()=>{throw mi("Method unimplemented")},dr=()=>{throw mi("Unexpected case")};class uo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const gi=()=>new uo,ab=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Qn=e=>{const t=new Uint8Array(ab(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},cb=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(zi(n,t)*2),e.cpos=0)},He=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Yl=He,Dt=(e,t)=>{for(;t>ji;)He(e,In|ji&t),t=di(t/128);He(e,ji&t)},Vl=(e,t)=>{const n=gd(t);for(n&&(t=-t),He(e,(t>Gl?In:0)|(n?$r:0)|Gl&t),t=di(t/64);t>0;)He(e,(t>ji?In:0)|ji&t),t=di(t/128)},ql=new Uint8Array(3e4),lb=ql.length/3,ub=(e,t)=>{if(t.length<lb){const n=co.encodeInto(t,ql).written||0;Dt(e,n);for(let r=0;r<n;r++)He(e,ql[r])}else en(e,ob(t))},hb=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;Dt(e,r);for(let i=0;i<r;i++)He(e,n.codePointAt(i))},ys=co&&co.encodeInto?ub:hb,ba=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=md(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(zi(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},en=(e,t)=>{Dt(e,t.byteLength),ba(e,t)},Xl=(e,t)=>{cb(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},fb=(e,t)=>Xl(e,4).setFloat32(0,t,!1),db=(e,t)=>Xl(e,8).setFloat64(0,t,!1),pb=(e,t)=>Xl(e,8).setBigInt64(0,t,!1),Ed=new DataView(new ArrayBuffer(4)),mb=e=>(Ed.setFloat32(0,e),Ed.getFloat32(0)===e),ho=(e,t)=>{switch(typeof t){case"string":He(e,119),ys(e,t);break;case"number":ZE(t)&&Ea(t)<=JE?(He(e,125),Vl(e,t)):mb(t)?(He(e,124),fb(e,t)):(He(e,123),db(e,t));break;case"bigint":He(e,122),pb(e,t);break;case"object":if(t===null)He(e,126);else if(tb(t)){He(e,117),Dt(e,t.length);for(let n=0;n<t.length;n++)ho(e,t[n])}else if(t instanceof Uint8Array)He(e,116),en(e,t);else{He(e,118);const n=Object.keys(t);Dt(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];ys(e,i),ho(e,t[i])}}break;case"boolean":He(e,t?120:121);break;default:He(e,127)}};class bd extends uo{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&Dt(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const wd=e=>{e.count>0&&(Vl(e.encoder,e.count===1?e.s:-e.s),e.count>1&&Dt(e.encoder,e.count-2))};class wa{constructor(){this.encoder=new uo,this.s=0,this.count=0}write(t){this.s===t?this.count++:(wd(this),this.count=1,this.s=t)}toUint8Array(){return wd(this),Qn(this.encoder)}}const Td=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Vl(e.encoder,t),e.count>1&&Dt(e.encoder,e.count-2)}};class Jl{constructor(){this.encoder=new uo,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Td(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Td(this),Qn(this.encoder)}}class gb{constructor(){this.sarr=[],this.s="",this.lensE=new wa}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new uo;return this.sarr.push(this.s),this.s="",ys(t,this.sarr.join("")),ba(t,this.lensE.toUint8Array()),Qn(t)}}const kd=mi("Unexpected end of array"),xd=mi("Integer out of Range");class Ta{constructor(t){this.arr=t,this.pos=0}}const Ki=e=>new Ta(e),yb=e=>e.pos!==e.arr.length,_b=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},an=e=>_b(e,$t(e)),_s=e=>e.arr[e.pos++],$t=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&ji)*n,n*=128,i<In)return t;if(t>yd)throw xd}throw kd},Zl=e=>{let t=e.arr[e.pos++],n=t&Gl,r=64;const i=(t&$r)>0?-1:1;if(!(t&In))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&ji)*r,r*=128,t<In)return i*n;if(n>yd)throw xd}throw kd},Es=lo?e=>lo.decode(an(e)):e=>{let t=$t(e);if(t===0)return"";{let n=String.fromCodePoint(_s(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(_s(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},Ql=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Eb=[e=>{},e=>null,Zl,e=>Ql(e,4).getFloat32(0,!1),e=>Ql(e,8).getFloat64(0,!1),e=>Ql(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Es,e=>{const t=$t(e),n={};for(let r=0;r<t;r++){const i=Es(e);n[i]=fo(e)}return n},e=>{const t=$t(e),n=[];for(let r=0;r<t;r++)n.push(fo(e));return n},an],fo=e=>Eb[127-_s(e)](e);class Ad extends Ta{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),yb(this)?this.count=$t(this)+1:this.count=-1),this.count--,this.s}}class ka extends Ta{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Zl(this);const t=gd(this.s);this.count=1,t&&(this.s=-this.s,this.count=$t(this)+2)}return this.count--,this.s}}class tu extends Ta{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Zl(this),n=t&1;this.diff=di(t/2),this.count=1,n&&(this.count=$t(this)+2)}return this.s+=this.diff,this.count--,this.s}}class bb{constructor(t){this.decoder=new ka(t),this.str=Es(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}var Ht={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var po=Symbol.for("react.element"),wb=Symbol.for("react.portal"),Tb=Symbol.for("react.fragment"),kb=Symbol.for("react.strict_mode"),xb=Symbol.for("react.profiler"),Ab=Symbol.for("react.provider"),vb=Symbol.for("react.context"),Sb=Symbol.for("react.forward_ref"),Rb=Symbol.for("react.suspense"),Ib=Symbol.for("react.memo"),Nb=Symbol.for("react.lazy"),vd=Symbol.iterator;function Ob(e){return e===null||typeof e!="object"?null:(e=vd&&e[vd]||e["@@iterator"],typeof e=="function"?e:null)}var Sd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Rd=Object.assign,Id={};function bs(e,t,n){this.props=e,this.context=t,this.refs=Id,this.updater=n||Sd}bs.prototype.isReactComponent={},bs.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},bs.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Nd(){}Nd.prototype=bs.prototype;function eu(e,t,n){this.props=e,this.context=t,this.refs=Id,this.updater=n||Sd}var nu=eu.prototype=new Nd;nu.constructor=eu,Rd(nu,bs.prototype),nu.isPureReactComponent=!0;var Od=Array.isArray,Cd=Object.prototype.hasOwnProperty,ru={current:null},Ld={key:!0,ref:!0,__self:!0,__source:!0};function Md(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)Cd.call(t,r)&&!Ld.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:po,type:e,key:s,ref:o,props:i,_owner:ru.current}}function Cb(e,t){return{$$typeof:po,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function iu(e){return typeof e=="object"&&e!==null&&e.$$typeof===po}function Lb(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Ud=/\/+/g;function su(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Lb(""+e.key):t.toString(36)}function xa(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case po:case wb:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+su(o,0):r,Od(i)?(n="",e!=null&&(n=e.replace(Ud,"$&/")+"/"),xa(i,t,n,"",function(u){return u})):i!=null&&(iu(i)&&(i=Cb(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Ud,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",Od(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+su(s,a);o+=xa(s,t,n,c,i)}else if(c=Ob(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+su(s,a++),o+=xa(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Aa(e,t,n){if(e==null)return e;var r=[],i=0;return xa(e,r,"","",function(s){return t.call(n,s,i++)}),r}function Mb(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var cn={current:null},va={transition:null},Ub={ReactCurrentDispatcher:cn,ReactCurrentBatchConfig:va,ReactCurrentOwner:ru};function Pd(){throw Error("act(...) is not supported in production builds of React.")}Ht.Children={map:Aa,forEach:function(e,t,n){Aa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Aa(e,function(){t++}),t},toArray:function(e){return Aa(e,function(t){return t})||[]},only:function(e){if(!iu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Ht.Component=bs,Ht.Fragment=Tb,Ht.Profiler=xb,Ht.PureComponent=eu,Ht.StrictMode=kb,Ht.Suspense=Rb,Ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ub,Ht.act=Pd,Ht.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Rd({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=ru.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)Cd.call(t,c)&&!Ld.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:po,type:e.type,key:i,ref:s,props:r,_owner:o}},Ht.createContext=function(e){return e={$$typeof:vb,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Ab,_context:e},e.Consumer=e},Ht.createElement=Md,Ht.createFactory=function(e){var t=Md.bind(null,e);return t.type=e,t},Ht.createRef=function(){return{current:null}},Ht.forwardRef=function(e){return{$$typeof:Sb,render:e}},Ht.isValidElement=iu,Ht.lazy=function(e){return{$$typeof:Nb,_payload:{_status:-1,_result:e},_init:Mb}},Ht.memo=function(e,t){return{$$typeof:Ib,type:e,compare:t===void 0?null:t}},Ht.startTransition=function(e){var t=va.transition;va.transition={};try{e()}finally{va.transition=t}},Ht.unstable_act=Pd,Ht.useCallback=function(e,t){return cn.current.useCallback(e,t)},Ht.useContext=function(e){return cn.current.useContext(e)},Ht.useDebugValue=function(){},Ht.useDeferredValue=function(e){return cn.current.useDeferredValue(e)},Ht.useEffect=function(e,t){return cn.current.useEffect(e,t)},Ht.useId=function(){return cn.current.useId()},Ht.useImperativeHandle=function(e,t,n){return cn.current.useImperativeHandle(e,t,n)},Ht.useInsertionEffect=function(e,t){return cn.current.useInsertionEffect(e,t)},Ht.useLayoutEffect=function(e,t){return cn.current.useLayoutEffect(e,t)},Ht.useMemo=function(e,t){return cn.current.useMemo(e,t)},Ht.useReducer=function(e,t,n){return cn.current.useReducer(e,t,n)},Ht.useRef=function(e){return cn.current.useRef(e)},Ht.useState=function(e){return cn.current.useState(e)},Ht.useSyncExternalStore=function(e,t,n){return cn.current.useSyncExternalStore(e,t,n)},Ht.useTransition=function(){return cn.current.useTransition()},Ht.version="18.3.1";const ws=globalThis||void 0||self,tr=()=>new Map,ou=e=>{const t=tr();return e.forEach((n,r)=>{t.set(r,n)}),t},yi=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},Pb=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},Bb=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1};class Fb{constructor(){this._observers=tr()}on(t,n){return yi(this._observers,t,gs).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return pi((this._observers.get(t)||tr()).values()).forEach(r=>r(...n))}destroy(){this._observers=tr()}}const Db=crypto.getRandomValues.bind(crypto),Bd=()=>Db(new Uint32Array(1))[0],$b="10000000-1000-4000-8000"+-1e11,jb=()=>$b.replace(/[018]/g,e=>(e^Bd()&15>>e/4).toString(16)),Fd=e=>new Promise(e);Promise.all.bind(Promise);var Dd={},Sa={};Sa.byteLength=Wb,Sa.toByteArray=Hb,Sa.fromByteArray=qb;for(var pr=[],$n=[],zb=typeof Uint8Array<"u"?Uint8Array:Array,au="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ts=0,Kb=au.length;Ts<Kb;++Ts)pr[Ts]=au[Ts],$n[au.charCodeAt(Ts)]=Ts;$n[45]=62,$n[95]=63;function $d(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function Wb(e){var t=$d(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Gb(e,t,n){return(t+n)*3/4-n}function Hb(e){var t,n=$d(e),r=n[0],i=n[1],s=new zb(Gb(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=$n[e.charCodeAt(c)]<<18|$n[e.charCodeAt(c+1)]<<12|$n[e.charCodeAt(c+2)]<<6|$n[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=$n[e.charCodeAt(c)]<<2|$n[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=$n[e.charCodeAt(c)]<<10|$n[e.charCodeAt(c+1)]<<4|$n[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Yb(e){return pr[e>>18&63]+pr[e>>12&63]+pr[e>>6&63]+pr[e&63]}function Vb(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Yb(r));return i.join("")}function qb(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Vb(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(pr[t>>2]+pr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(pr[t>>10]+pr[t>>4&63]+pr[t<<2&63]+"=")),i.join("")}var cu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */cu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,u=c>>1,l=-7,h=n?i-1:0,f=n?-1:1,d=e[t+h];for(h+=f,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=s*256+e[t+h],h+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=o*256+e[t+h],h+=f,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-u}return(d?-1:1)*o*Math.pow(2,s-r)},cu.write=function(e,t,n,r,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,h=l>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,g=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=f/c:t+=f*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+d]=a&255,d+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+d]=o&255,d+=p,o/=256,u-=8);e[n+d-p]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Sa,n=cu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=P,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const A=new s(1),m={foo:function(){return 42}};return Object.setPrototypeOf(m,s.prototype),Object.setPrototypeOf(A,m),A.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(A){if(A>i)throw new RangeError('The value "'+A+'" is invalid for option "size"');const m=new s(A);return Object.setPrototypeOf(m,l.prototype),m}function l(A,m,y){if(typeof A=="number"){if(typeof m=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(A)}return h(A,m,y)}l.poolSize=8192;function h(A,m,y){if(typeof A=="string")return g(A,m);if(o.isView(A))return b(A);if(A==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A);if(ft(A,o)||A&&ft(A.buffer,o)||typeof a<"u"&&(ft(A,a)||A&&ft(A.buffer,a)))return k(A,m,y);if(typeof A=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const R=A.valueOf&&A.valueOf();if(R!=null&&R!==A)return l.from(R,m,y);const F=v(A);if(F)return F;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof A[Symbol.toPrimitive]=="function")return l.from(A[Symbol.toPrimitive]("string"),m,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A)}l.from=function(A,m,y){return h(A,m,y)},Object.setPrototypeOf(l.prototype,s.prototype),Object.setPrototypeOf(l,s);function f(A){if(typeof A!="number")throw new TypeError('"size" argument must be of type number');if(A<0)throw new RangeError('The value "'+A+'" is invalid for option "size"')}function d(A,m,y){return f(A),A<=0?u(A):m!==void 0?typeof y=="string"?u(A).fill(m,y):u(A).fill(m):u(A)}l.alloc=function(A,m,y){return d(A,m,y)};function p(A){return f(A),u(A<0?0:N(A)|0)}l.allocUnsafe=function(A){return p(A)},l.allocUnsafeSlow=function(A){return p(A)};function g(A,m){if((typeof m!="string"||m==="")&&(m="utf8"),!l.isEncoding(m))throw new TypeError("Unknown encoding: "+m);const y=L(A,m)|0;let R=u(y);const F=R.write(A,m);return F!==y&&(R=R.slice(0,F)),R}function w(A){const m=A.length<0?0:N(A.length)|0,y=u(m);for(let R=0;R<m;R+=1)y[R]=A[R]&255;return y}function b(A){if(ft(A,s)){const m=new s(A);return k(m.buffer,m.byteOffset,m.byteLength)}return w(A)}function k(A,m,y){if(m<0||A.byteLength<m)throw new RangeError('"offset" is outside of buffer bounds');if(A.byteLength<m+(y||0))throw new RangeError('"length" is outside of buffer bounds');let R;return m===void 0&&y===void 0?R=new s(A):y===void 0?R=new s(A,m):R=new s(A,m,y),Object.setPrototypeOf(R,l.prototype),R}function v(A){if(l.isBuffer(A)){const m=N(A.length)|0,y=u(m);return y.length===0||A.copy(y,0,0,m),y}if(A.length!==void 0)return typeof A.length!="number"||xt(A.length)?u(0):w(A);if(A.type==="Buffer"&&Array.isArray(A.data))return w(A.data)}function N(A){if(A>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return A|0}function P(A){return+A!=A&&(A=0),l.alloc(+A)}l.isBuffer=function(m){return m!=null&&m._isBuffer===!0&&m!==l.prototype},l.compare=function(m,y){if(ft(m,s)&&(m=l.from(m,m.offset,m.byteLength)),ft(y,s)&&(y=l.from(y,y.offset,y.byteLength)),!l.isBuffer(m)||!l.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(m===y)return 0;let R=m.length,F=y.length;for(let Z=0,nt=Math.min(R,F);Z<nt;++Z)if(m[Z]!==y[Z]){R=m[Z],F=y[Z];break}return R<F?-1:F<R?1:0},l.isEncoding=function(m){switch(String(m).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(m,y){if(!Array.isArray(m))throw new TypeError('"list" argument must be an Array of Buffers');if(m.length===0)return l.alloc(0);let R;if(y===void 0)for(y=0,R=0;R<m.length;++R)y+=m[R].length;const F=l.allocUnsafe(y);let Z=0;for(R=0;R<m.length;++R){let nt=m[R];if(ft(nt,s))Z+nt.length>F.length?(l.isBuffer(nt)||(nt=l.from(nt)),nt.copy(F,Z)):s.prototype.set.call(F,nt,Z);else if(l.isBuffer(nt))nt.copy(F,Z);else throw new TypeError('"list" argument must be an Array of Buffers');Z+=nt.length}return F};function L(A,m){if(l.isBuffer(A))return A.length;if(o.isView(A)||ft(A,o))return A.byteLength;if(typeof A!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof A);const y=A.length,R=arguments.length>2&&arguments[2]===!0;if(!R&&y===0)return 0;let F=!1;for(;;)switch(m){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return ot(A).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return dt(A).length;default:if(F)return R?-1:ot(A).length;m=(""+m).toLowerCase(),F=!0}}l.byteLength=L;function C(A,m,y){let R=!1;if((m===void 0||m<0)&&(m=0),m>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,m>>>=0,y<=m))return"";for(A||(A="utf8");;)switch(A){case"hex":return $(this,m,y);case"utf8":case"utf-8":return j(this,m,y);case"ascii":return ut(this,m,y);case"latin1":case"binary":return G(this,m,y);case"base64":return J(this,m,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return yt(this,m,y);default:if(R)throw new TypeError("Unknown encoding: "+A);A=(A+"").toLowerCase(),R=!0}}l.prototype._isBuffer=!0;function W(A,m,y){const R=A[m];A[m]=A[y],A[y]=R}l.prototype.swap16=function(){const m=this.length;if(m%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<m;y+=2)W(this,y,y+1);return this},l.prototype.swap32=function(){const m=this.length;if(m%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<m;y+=4)W(this,y,y+3),W(this,y+1,y+2);return this},l.prototype.swap64=function(){const m=this.length;if(m%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<m;y+=8)W(this,y,y+7),W(this,y+1,y+6),W(this,y+2,y+5),W(this,y+3,y+4);return this},l.prototype.toString=function(){const m=this.length;return m===0?"":arguments.length===0?j(this,0,m):C.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(m){if(!l.isBuffer(m))throw new TypeError("Argument must be a Buffer");return this===m?!0:l.compare(this,m)===0},l.prototype.inspect=function(){let m="";const y=e.INSPECT_MAX_BYTES;return m=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(m+=" ... "),"<Buffer "+m+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(m,y,R,F,Z){if(ft(m,s)&&(m=l.from(m,m.offset,m.byteLength)),!l.isBuffer(m))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof m);if(y===void 0&&(y=0),R===void 0&&(R=m?m.length:0),F===void 0&&(F=0),Z===void 0&&(Z=this.length),y<0||R>m.length||F<0||Z>this.length)throw new RangeError("out of range index");if(F>=Z&&y>=R)return 0;if(F>=Z)return-1;if(y>=R)return 1;if(y>>>=0,R>>>=0,F>>>=0,Z>>>=0,this===m)return 0;let nt=Z-F,Ft=R-y;const ye=Math.min(nt,Ft),me=this.slice(F,Z),_e=m.slice(y,R);for(let oe=0;oe<ye;++oe)if(me[oe]!==_e[oe]){nt=me[oe],Ft=_e[oe];break}return nt<Ft?-1:Ft<nt?1:0};function M(A,m,y,R,F){if(A.length===0)return-1;if(typeof y=="string"?(R=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,xt(y)&&(y=F?0:A.length-1),y<0&&(y=A.length+y),y>=A.length){if(F)return-1;y=A.length-1}else if(y<0)if(F)y=0;else return-1;if(typeof m=="string"&&(m=l.from(m,R)),l.isBuffer(m))return m.length===0?-1:et(A,m,y,R,F);if(typeof m=="number")return m=m&255,typeof s.prototype.indexOf=="function"?F?s.prototype.indexOf.call(A,m,y):s.prototype.lastIndexOf.call(A,m,y):et(A,[m],y,R,F);throw new TypeError("val must be string, number or Buffer")}function et(A,m,y,R,F){let Z=1,nt=A.length,Ft=m.length;if(R!==void 0&&(R=String(R).toLowerCase(),R==="ucs2"||R==="ucs-2"||R==="utf16le"||R==="utf-16le")){if(A.length<2||m.length<2)return-1;Z=2,nt/=2,Ft/=2,y/=2}function ye(_e,oe){return Z===1?_e[oe]:_e.readUInt16BE(oe*Z)}let me;if(F){let _e=-1;for(me=y;me<nt;me++)if(ye(A,me)===ye(m,_e===-1?0:me-_e)){if(_e===-1&&(_e=me),me-_e+1===Ft)return _e*Z}else _e!==-1&&(me-=me-_e),_e=-1}else for(y+Ft>nt&&(y=nt-Ft),me=y;me>=0;me--){let _e=!0;for(let oe=0;oe<Ft;oe++)if(ye(A,me+oe)!==ye(m,oe)){_e=!1;break}if(_e)return me}return-1}l.prototype.includes=function(m,y,R){return this.indexOf(m,y,R)!==-1},l.prototype.indexOf=function(m,y,R){return M(this,m,y,R,!0)},l.prototype.lastIndexOf=function(m,y,R){return M(this,m,y,R,!1)};function pt(A,m,y,R){y=Number(y)||0;const F=A.length-y;R?(R=Number(R),R>F&&(R=F)):R=F;const Z=m.length;R>Z/2&&(R=Z/2);let nt;for(nt=0;nt<R;++nt){const Ft=parseInt(m.substr(nt*2,2),16);if(xt(Ft))return nt;A[y+nt]=Ft}return nt}function U(A,m,y,R){return Et(ot(m,A.length-y),A,y,R)}function S(A,m,y,R){return Et(lt(m),A,y,R)}function _(A,m,y,R){return Et(dt(m),A,y,R)}function B(A,m,y,R){return Et(X(m,A.length-y),A,y,R)}l.prototype.write=function(m,y,R,F){if(y===void 0)F="utf8",R=this.length,y=0;else if(R===void 0&&typeof y=="string")F=y,R=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(R)?(R=R>>>0,F===void 0&&(F="utf8")):(F=R,R=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Z=this.length-y;if((R===void 0||R>Z)&&(R=Z),m.length>0&&(R<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");F||(F="utf8");let nt=!1;for(;;)switch(F){case"hex":return pt(this,m,y,R);case"utf8":case"utf-8":return U(this,m,y,R);case"ascii":case"latin1":case"binary":return S(this,m,y,R);case"base64":return _(this,m,y,R);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,m,y,R);default:if(nt)throw new TypeError("Unknown encoding: "+F);F=(""+F).toLowerCase(),nt=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function J(A,m,y){return m===0&&y===A.length?t.fromByteArray(A):t.fromByteArray(A.slice(m,y))}function j(A,m,y){y=Math.min(A.length,y);const R=[];let F=m;for(;F<y;){const Z=A[F];let nt=null,Ft=Z>239?4:Z>223?3:Z>191?2:1;if(F+Ft<=y){let ye,me,_e,oe;switch(Ft){case 1:Z<128&&(nt=Z);break;case 2:ye=A[F+1],(ye&192)===128&&(oe=(Z&31)<<6|ye&63,oe>127&&(nt=oe));break;case 3:ye=A[F+1],me=A[F+2],(ye&192)===128&&(me&192)===128&&(oe=(Z&15)<<12|(ye&63)<<6|me&63,oe>2047&&(oe<55296||oe>57343)&&(nt=oe));break;case 4:ye=A[F+1],me=A[F+2],_e=A[F+3],(ye&192)===128&&(me&192)===128&&(_e&192)===128&&(oe=(Z&15)<<18|(ye&63)<<12|(me&63)<<6|_e&63,oe>65535&&oe<1114112&&(nt=oe))}}nt===null?(nt=65533,Ft=1):nt>65535&&(nt-=65536,R.push(nt>>>10&1023|55296),nt=56320|nt&1023),R.push(nt),F+=Ft}return Q(R)}const ht=4096;function Q(A){const m=A.length;if(m<=ht)return String.fromCharCode.apply(String,A);let y="",R=0;for(;R<m;)y+=String.fromCharCode.apply(String,A.slice(R,R+=ht));return y}function ut(A,m,y){let R="";y=Math.min(A.length,y);for(let F=m;F<y;++F)R+=String.fromCharCode(A[F]&127);return R}function G(A,m,y){let R="";y=Math.min(A.length,y);for(let F=m;F<y;++F)R+=String.fromCharCode(A[F]);return R}function $(A,m,y){const R=A.length;(!m||m<0)&&(m=0),(!y||y<0||y>R)&&(y=R);let F="";for(let Z=m;Z<y;++Z)F+=le[A[Z]];return F}function yt(A,m,y){const R=A.slice(m,y);let F="";for(let Z=0;Z<R.length-1;Z+=2)F+=String.fromCharCode(R[Z]+R[Z+1]*256);return F}l.prototype.slice=function(m,y){const R=this.length;m=~~m,y=y===void 0?R:~~y,m<0?(m+=R,m<0&&(m=0)):m>R&&(m=R),y<0?(y+=R,y<0&&(y=0)):y>R&&(y=R),y<m&&(y=m);const F=this.subarray(m,y);return Object.setPrototypeOf(F,l.prototype),F};function st(A,m,y){if(A%1!==0||A<0)throw new RangeError("offset is not uint");if(A+m>y)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(m,y,R){m=m>>>0,y=y>>>0,R||st(m,y,this.length);let F=this[m],Z=1,nt=0;for(;++nt<y&&(Z*=256);)F+=this[m+nt]*Z;return F},l.prototype.readUintBE=l.prototype.readUIntBE=function(m,y,R){m=m>>>0,y=y>>>0,R||st(m,y,this.length);let F=this[m+--y],Z=1;for(;y>0&&(Z*=256);)F+=this[m+--y]*Z;return F},l.prototype.readUint8=l.prototype.readUInt8=function(m,y){return m=m>>>0,y||st(m,1,this.length),this[m]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(m,y){return m=m>>>0,y||st(m,2,this.length),this[m]|this[m+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(m,y){return m=m>>>0,y||st(m,2,this.length),this[m]<<8|this[m+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(m,y){return m=m>>>0,y||st(m,4,this.length),(this[m]|this[m+1]<<8|this[m+2]<<16)+this[m+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]*16777216+(this[m+1]<<16|this[m+2]<<8|this[m+3])},l.prototype.readBigUInt64LE=Pt(function(m){m=m>>>0,tt(m,"offset");const y=this[m],R=this[m+7];(y===void 0||R===void 0)&&O(m,this.length-8);const F=y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24,Z=this[++m]+this[++m]*2**8+this[++m]*2**16+R*2**24;return BigInt(F)+(BigInt(Z)<<BigInt(32))}),l.prototype.readBigUInt64BE=Pt(function(m){m=m>>>0,tt(m,"offset");const y=this[m],R=this[m+7];(y===void 0||R===void 0)&&O(m,this.length-8);const F=y*2**24+this[++m]*2**16+this[++m]*2**8+this[++m],Z=this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+R;return(BigInt(F)<<BigInt(32))+BigInt(Z)}),l.prototype.readIntLE=function(m,y,R){m=m>>>0,y=y>>>0,R||st(m,y,this.length);let F=this[m],Z=1,nt=0;for(;++nt<y&&(Z*=256);)F+=this[m+nt]*Z;return Z*=128,F>=Z&&(F-=Math.pow(2,8*y)),F},l.prototype.readIntBE=function(m,y,R){m=m>>>0,y=y>>>0,R||st(m,y,this.length);let F=y,Z=1,nt=this[m+--F];for(;F>0&&(Z*=256);)nt+=this[m+--F]*Z;return Z*=128,nt>=Z&&(nt-=Math.pow(2,8*y)),nt},l.prototype.readInt8=function(m,y){return m=m>>>0,y||st(m,1,this.length),this[m]&128?(255-this[m]+1)*-1:this[m]},l.prototype.readInt16LE=function(m,y){m=m>>>0,y||st(m,2,this.length);const R=this[m]|this[m+1]<<8;return R&32768?R|4294901760:R},l.prototype.readInt16BE=function(m,y){m=m>>>0,y||st(m,2,this.length);const R=this[m+1]|this[m]<<8;return R&32768?R|4294901760:R},l.prototype.readInt32LE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]|this[m+1]<<8|this[m+2]<<16|this[m+3]<<24},l.prototype.readInt32BE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]<<24|this[m+1]<<16|this[m+2]<<8|this[m+3]},l.prototype.readBigInt64LE=Pt(function(m){m=m>>>0,tt(m,"offset");const y=this[m],R=this[m+7];(y===void 0||R===void 0)&&O(m,this.length-8);const F=this[m+4]+this[m+5]*2**8+this[m+6]*2**16+(R<<24);return(BigInt(F)<<BigInt(32))+BigInt(y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24)}),l.prototype.readBigInt64BE=Pt(function(m){m=m>>>0,tt(m,"offset");const y=this[m],R=this[m+7];(y===void 0||R===void 0)&&O(m,this.length-8);const F=(y<<24)+this[++m]*2**16+this[++m]*2**8+this[++m];return(BigInt(F)<<BigInt(32))+BigInt(this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+R)}),l.prototype.readFloatLE=function(m,y){return m=m>>>0,y||st(m,4,this.length),n.read(this,m,!0,23,4)},l.prototype.readFloatBE=function(m,y){return m=m>>>0,y||st(m,4,this.length),n.read(this,m,!1,23,4)},l.prototype.readDoubleLE=function(m,y){return m=m>>>0,y||st(m,8,this.length),n.read(this,m,!0,52,8)},l.prototype.readDoubleBE=function(m,y){return m=m>>>0,y||st(m,8,this.length),n.read(this,m,!1,52,8)};function at(A,m,y,R,F,Z){if(!l.isBuffer(A))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>F||m<Z)throw new RangeError('"value" argument is out of bounds');if(y+R>A.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(m,y,R,F){if(m=+m,y=y>>>0,R=R>>>0,!F){const Ft=Math.pow(2,8*R)-1;at(this,m,y,R,Ft,0)}let Z=1,nt=0;for(this[y]=m&255;++nt<R&&(Z*=256);)this[y+nt]=m/Z&255;return y+R},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(m,y,R,F){if(m=+m,y=y>>>0,R=R>>>0,!F){const Ft=Math.pow(2,8*R)-1;at(this,m,y,R,Ft,0)}let Z=R-1,nt=1;for(this[y+Z]=m&255;--Z>=0&&(nt*=256);)this[y+Z]=m/nt&255;return y+R},l.prototype.writeUint8=l.prototype.writeUInt8=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,1,255,0),this[y]=m&255,y+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,2,65535,0),this[y]=m&255,this[y+1]=m>>>8,y+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,2,65535,0),this[y]=m>>>8,this[y+1]=m&255,y+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,4,4294967295,0),this[y+3]=m>>>24,this[y+2]=m>>>16,this[y+1]=m>>>8,this[y]=m&255,y+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,4,4294967295,0),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4};function Ut(A,m,y,R,F){rt(m,R,F,A,y,7);let Z=Number(m&BigInt(4294967295));A[y++]=Z,Z=Z>>8,A[y++]=Z,Z=Z>>8,A[y++]=Z,Z=Z>>8,A[y++]=Z;let nt=Number(m>>BigInt(32)&BigInt(4294967295));return A[y++]=nt,nt=nt>>8,A[y++]=nt,nt=nt>>8,A[y++]=nt,nt=nt>>8,A[y++]=nt,y}function Wt(A,m,y,R,F){rt(m,R,F,A,y,7);let Z=Number(m&BigInt(4294967295));A[y+7]=Z,Z=Z>>8,A[y+6]=Z,Z=Z>>8,A[y+5]=Z,Z=Z>>8,A[y+4]=Z;let nt=Number(m>>BigInt(32)&BigInt(4294967295));return A[y+3]=nt,nt=nt>>8,A[y+2]=nt,nt=nt>>8,A[y+1]=nt,nt=nt>>8,A[y]=nt,y+8}l.prototype.writeBigUInt64LE=Pt(function(m,y=0){return Ut(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Pt(function(m,y=0){return Wt(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(m,y,R,F){if(m=+m,y=y>>>0,!F){const ye=Math.pow(2,8*R-1);at(this,m,y,R,ye-1,-ye)}let Z=0,nt=1,Ft=0;for(this[y]=m&255;++Z<R&&(nt*=256);)m<0&&Ft===0&&this[y+Z-1]!==0&&(Ft=1),this[y+Z]=(m/nt>>0)-Ft&255;return y+R},l.prototype.writeIntBE=function(m,y,R,F){if(m=+m,y=y>>>0,!F){const ye=Math.pow(2,8*R-1);at(this,m,y,R,ye-1,-ye)}let Z=R-1,nt=1,Ft=0;for(this[y+Z]=m&255;--Z>=0&&(nt*=256);)m<0&&Ft===0&&this[y+Z+1]!==0&&(Ft=1),this[y+Z]=(m/nt>>0)-Ft&255;return y+R},l.prototype.writeInt8=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,1,127,-128),m<0&&(m=255+m+1),this[y]=m&255,y+1},l.prototype.writeInt16LE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,2,32767,-32768),this[y]=m&255,this[y+1]=m>>>8,y+2},l.prototype.writeInt16BE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,2,32767,-32768),this[y]=m>>>8,this[y+1]=m&255,y+2},l.prototype.writeInt32LE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,4,2147483647,-2147483648),this[y]=m&255,this[y+1]=m>>>8,this[y+2]=m>>>16,this[y+3]=m>>>24,y+4},l.prototype.writeInt32BE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,4,2147483647,-2147483648),m<0&&(m=4294967295+m+1),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4},l.prototype.writeBigInt64LE=Pt(function(m,y=0){return Ut(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Pt(function(m,y=0){return Wt(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Nt(A,m,y,R,F,Z){if(y+R>A.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function Rt(A,m,y,R,F){return m=+m,y=y>>>0,F||Nt(A,m,y,4),n.write(A,m,y,R,23,4),y+4}l.prototype.writeFloatLE=function(m,y,R){return Rt(this,m,y,!0,R)},l.prototype.writeFloatBE=function(m,y,R){return Rt(this,m,y,!1,R)};function Mt(A,m,y,R,F){return m=+m,y=y>>>0,F||Nt(A,m,y,8),n.write(A,m,y,R,52,8),y+8}l.prototype.writeDoubleLE=function(m,y,R){return Mt(this,m,y,!0,R)},l.prototype.writeDoubleBE=function(m,y,R){return Mt(this,m,y,!1,R)},l.prototype.copy=function(m,y,R,F){if(!l.isBuffer(m))throw new TypeError("argument should be a Buffer");if(R||(R=0),!F&&F!==0&&(F=this.length),y>=m.length&&(y=m.length),y||(y=0),F>0&&F<R&&(F=R),F===R||m.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(R<0||R>=this.length)throw new RangeError("Index out of range");if(F<0)throw new RangeError("sourceEnd out of bounds");F>this.length&&(F=this.length),m.length-y<F-R&&(F=m.length-y+R);const Z=F-R;return this===m&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,R,F):s.prototype.set.call(m,this.subarray(R,F),y),Z},l.prototype.fill=function(m,y,R,F){if(typeof m=="string"){if(typeof y=="string"?(F=y,y=0,R=this.length):typeof R=="string"&&(F=R,R=this.length),F!==void 0&&typeof F!="string")throw new TypeError("encoding must be a string");if(typeof F=="string"&&!l.isEncoding(F))throw new TypeError("Unknown encoding: "+F);if(m.length===1){const nt=m.charCodeAt(0);(F==="utf8"&&nt<128||F==="latin1")&&(m=nt)}}else typeof m=="number"?m=m&255:typeof m=="boolean"&&(m=Number(m));if(y<0||this.length<y||this.length<R)throw new RangeError("Out of range index");if(R<=y)return this;y=y>>>0,R=R===void 0?this.length:R>>>0,m||(m=0);let Z;if(typeof m=="number")for(Z=y;Z<R;++Z)this[Z]=m;else{const nt=l.isBuffer(m)?m:l.from(m,F),Ft=nt.length;if(Ft===0)throw new TypeError('The value "'+m+'" is invalid for argument "value"');for(Z=0;Z<R-y;++Z)this[Z+y]=nt[Z%Ft]}return this};const Ot={};function re(A,m,y){Ot[A]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:m.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${A}]`,this.stack,delete this.name}get code(){return A}set code(F){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:F,writable:!0})}toString(){return`${this.name} [${A}]: ${this.message}`}}}re("ERR_BUFFER_OUT_OF_BOUNDS",function(A){return A?`${A} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),re("ERR_INVALID_ARG_TYPE",function(A,m){return`The "${A}" argument must be of type number. Received type ${typeof m}`},TypeError),re("ERR_OUT_OF_RANGE",function(A,m,y){let R=`The value of "${A}" is out of range.`,F=y;return Number.isInteger(y)&&Math.abs(y)>2**32?F=Se(String(y)):typeof y=="bigint"&&(F=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&(F=Se(F)),F+="n"),R+=` It must be ${m}. Received ${F}`,R},RangeError);function Se(A){let m="",y=A.length;const R=A[0]==="-"?1:0;for(;y>=R+4;y-=3)m=`_${A.slice(y-3,y)}${m}`;return`${A.slice(0,y)}${m}`}function E(A,m,y){tt(m,"offset"),(A[m]===void 0||A[m+y]===void 0)&&O(m,A.length-(y+1))}function rt(A,m,y,R,F,Z){if(A>y||A<m){const nt=typeof m=="bigint"?"n":"";let Ft;throw m===0||m===BigInt(0)?Ft=`>= 0${nt} and < 2${nt} ** ${(Z+1)*8}${nt}`:Ft=`>= -(2${nt} ** ${(Z+1)*8-1}${nt}) and < 2 ** ${(Z+1)*8-1}${nt}`,new Ot.ERR_OUT_OF_RANGE("value",Ft,A)}E(R,F,Z)}function tt(A,m){if(typeof A!="number")throw new Ot.ERR_INVALID_ARG_TYPE(m,"number",A)}function O(A,m,y){throw Math.floor(A)!==A?(tt(A,y),new Ot.ERR_OUT_OF_RANGE("offset","an integer",A)):m<0?new Ot.ERR_BUFFER_OUT_OF_BOUNDS:new Ot.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${m}`,A)}const I=/[^+/0-9A-Za-z-_]/g;function K(A){if(A=A.split("=")[0],A=A.trim().replace(I,""),A.length<2)return"";for(;A.length%4!==0;)A=A+"=";return A}function ot(A,m){m=m||1/0;let y;const R=A.length;let F=null;const Z=[];for(let nt=0;nt<R;++nt){if(y=A.charCodeAt(nt),y>55295&&y<57344){if(!F){if(y>56319){(m-=3)>-1&&Z.push(239,191,189);continue}else if(nt+1===R){(m-=3)>-1&&Z.push(239,191,189);continue}F=y;continue}if(y<56320){(m-=3)>-1&&Z.push(239,191,189),F=y;continue}y=(F-55296<<10|y-56320)+65536}else F&&(m-=3)>-1&&Z.push(239,191,189);if(F=null,y<128){if((m-=1)<0)break;Z.push(y)}else if(y<2048){if((m-=2)<0)break;Z.push(y>>6|192,y&63|128)}else if(y<65536){if((m-=3)<0)break;Z.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((m-=4)<0)break;Z.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return Z}function lt(A){const m=[];for(let y=0;y<A.length;++y)m.push(A.charCodeAt(y)&255);return m}function X(A,m){let y,R,F;const Z=[];for(let nt=0;nt<A.length&&!((m-=2)<0);++nt)y=A.charCodeAt(nt),R=y>>8,F=y%256,Z.push(F),Z.push(R);return Z}function dt(A){return t.toByteArray(K(A))}function Et(A,m,y,R){let F;for(F=0;F<R&&!(F+y>=m.length||F>=A.length);++F)m[F+y]=A[F];return F}function ft(A,m){return A instanceof m||A!=null&&A.constructor!=null&&A.constructor.name!=null&&A.constructor.name===m.name}function xt(A){return A!==A}const le=function(){const A="0123456789abcdef",m=new Array(256);for(let y=0;y<16;++y){const R=y*16;for(let F=0;F<16;++F)m[R+F]=A[y]+A[F]}return m}();function Pt(A){return typeof BigInt>"u"?Sn:A}function Sn(){throw new Error("BigInt not supported")}})(Dd);const Je=Dd.Buffer;function Xb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jd={exports:{}},Ie=jd.exports={},mr,gr;function lu(){throw new Error("setTimeout has not been defined")}function uu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?mr=setTimeout:mr=lu}catch{mr=lu}try{typeof clearTimeout=="function"?gr=clearTimeout:gr=uu}catch{gr=uu}})();function zd(e){if(mr===setTimeout)return setTimeout(e,0);if((mr===lu||!mr)&&setTimeout)return mr=setTimeout,setTimeout(e,0);try{return mr(e,0)}catch{try{return mr.call(null,e,0)}catch{return mr.call(this,e,0)}}}function Jb(e){if(gr===clearTimeout)return clearTimeout(e);if((gr===uu||!gr)&&clearTimeout)return gr=clearTimeout,clearTimeout(e);try{return gr(e)}catch{try{return gr.call(null,e)}catch{return gr.call(this,e)}}}var jr=[],ks=!1,Wi,Ra=-1;function Zb(){!ks||!Wi||(ks=!1,Wi.length?jr=Wi.concat(jr):Ra=-1,jr.length&&Kd())}function Kd(){if(!ks){var e=zd(Zb);ks=!0;for(var t=jr.length;t;){for(Wi=jr,jr=[];++Ra<t;)Wi&&Wi[Ra].run();Ra=-1,t=jr.length}Wi=null,ks=!1,Jb(e)}}Ie.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];jr.push(new Wd(e,t)),jr.length===1&&!ks&&zd(Kd)};function Wd(e,t){this.fun=e,this.array=t}Wd.prototype.run=function(){this.fun.apply(null,this.array)},Ie.title="browser",Ie.browser=!0,Ie.env={},Ie.argv=[],Ie.version="",Ie.versions={};function zr(){}Ie.on=zr,Ie.addListener=zr,Ie.once=zr,Ie.off=zr,Ie.removeListener=zr,Ie.removeAllListeners=zr,Ie.emit=zr,Ie.prependListener=zr,Ie.prependOnceListener=zr,Ie.listeners=function(e){return[]},Ie.binding=function(e){throw new Error("process.binding is not supported")},Ie.cwd=function(){return"/"},Ie.chdir=function(e){throw new Error("process.chdir is not supported")},Ie.umask=function(){return 0};var Qb=jd.exports;const _i=Xb(Qb),Gd=e=>e===void 0?null:e;class tw{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let Hd=new tw,ew=!0;try{typeof localStorage<"u"&&localStorage&&(Hd=localStorage,ew=!1)}catch{}const nw=Hd,rw=Object.assign,iw=Object.keys,sw=(e,t)=>{for(const n in e)t(e[n],n)},Yd=e=>iw(e).length,ow=e=>{for(const t in e)return!1;return!0},aw=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},cw=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),lw=(e,t)=>e===t||Yd(e)===Yd(t)&&aw(e,(n,r)=>(n!==void 0||cw(t,r))&&t[r]===n),uw=Object.freeze,Vd=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&Vd(e[t])}return uw(e)},hu=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&hu(e,t,n+1)}},hw=e=>e,fw=(e,t)=>t.includes(e);var qd={};const mo=typeof _i<"u"&&_i.release&&/node|io\.js/.test(_i.release.name)&&Object.prototype.toString.call(typeof _i<"u"?_i:0)==="[object process]";let yr;const dw=()=>{if(yr===void 0)if(mo){yr=tr();const e=_i.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&yr.set(t,""),t=r):t!==null&&(yr.set(t,r),t=null)}t!==null&&yr.set(t,"")}else typeof location=="object"?(yr=tr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");yr.set(`--${_d(t,"-")}`,n),yr.set(`-${_d(t,"-")}`,n)}})):yr=tr();return yr},fu=e=>dw().has(e),Ia=e=>Gd(mo?qd[e.toUpperCase().replaceAll("-","_")]:nw.getItem(e)),Xd=e=>fu("--"+e)||Ia(e)!==null;Xd("production");const pw=mo&&fw(qd.FORCE_COLOR,["true","1","2"])||!fu("--no-colors")&&!Xd("no-color")&&(!mo||_i.stdout.isTTY)&&(!mo||fu("--color")||Ia("COLORTERM")!==null||(Ia("TERM")||"").includes("color")),mw=e=>new Uint8Array(e),gw=e=>{const t=mw(e.byteLength);return t.set(e),t};class yw{constructor(t,n){this.left=t,this.right=n}}const Kr=(e,t)=>new yw(e,t);typeof DOMParser<"u"&&new DOMParser;const _w=e=>Pb(e,(t,n)=>`${n}:${t};`).join(""),Wr=Symbol,Jd=Wr(),Zd=Wr(),Ew=Wr(),bw=Wr(),ww=Wr(),Qd=Wr(),Tw=Wr(),du=Wr(),kw=Wr(),xw=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},Aw={[Jd]:Kr("font-weight","bold"),[Zd]:Kr("font-weight","normal"),[Ew]:Kr("color","blue"),[ww]:Kr("color","green"),[bw]:Kr("color","grey"),[Qd]:Kr("color","red"),[Tw]:Kr("color","purple"),[du]:Kr("color","orange"),[kw]:Kr("color","black")},tp=pw?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=tr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=Aw[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=_w(r);s>0||u.length>0?(t.push("%c"+a),n.push(u)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:xw,vw=(...e)=>{console.log(...tp(e)),ep.forEach(t=>t.print(e))},Sw=(...e)=>{console.warn(...tp(e)),e.unshift(du),ep.forEach(t=>t.print(e))},ep=gs(),np=e=>({[Symbol.iterator](){return this},next:e}),Rw=(e,t)=>np(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),pu=(e,t)=>np(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class mu{constructor(t,n){this.clock=t,this.len=n}}class go{constructor(){this.clients=new Map}}const rp=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];wp(e,s,a.clock,a.len,n)}}),Iw=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=di((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},ip=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&Iw(n,t.clock)!==null},gu=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=zi(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},Nw=e=>{const t=new go;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)QE(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return gu(t),t},Na=(e,t,n,r)=>{yi(e.clients,t,()=>[]).push(new mu(n,r))},Ow=()=>new go,Cw=e=>{const t=Ow();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let u=n[s+1];s+1<n.length&&u.deleted;u=n[++s+1])c+=u.length;i.push(new mu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},xs=(e,t)=>{Dt(e.restEncoder,t.clients.size),pi(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),Dt(e.restEncoder,n);const i=r.length;Dt(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},yu=e=>{const t=new go,n=$t(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=$t(e.restDecoder),s=$t(e.restDecoder);if(s>0){const o=yi(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new mu(e.readDsClock(),e.readDsLen()))}}return t},sp=(e,t,n)=>{const r=new go,i=$t(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=$t(e.restDecoder),a=$t(e.restDecoder),c=n.clients.get(o)||[],u=Ye(n,o);for(let l=0;l<a;l++){const h=e.readDsClock(),f=h+e.readDsLen();if(h<u){u<f&&Na(r,o,u,f-u);let d=_r(c,h),p=c[d];for(!p.deleted&&p.id.clock<h&&(c.splice(d+1,0,Ga(t,p,h-p.id.clock)),d++);d<c.length&&(p=c[d++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(d,0,Ga(t,p,f-p.id.clock)),p.delete(t))}else Na(r,o,h,f-h)}}if(r.clients.size>0){const s=new Gi;return Dt(s.restEncoder,0),xs(s,r),s.toUint8Array()}return null},op=Bd;class As extends Fb{constructor({guid:t=jb(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=op(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new _p,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Fd(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>Fd(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&ue(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(pi(this.subdocs).map(t=>t.guid))}transact(t,n=null){return ue(this,t,n)}get(t,n=Ze){const r=yi(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==Ze&&i!==n)if(i===Ze){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Is)}getText(t=""){return this.get(t,Gr)}getMap(t=""){return this.get(t,Ns)}getXmlElement(t=""){return this.get(t,Cs)}getXmlFragment(t=""){return this.get(t,Hi)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,pi(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new As({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,ue(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class ap{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return $t(this.restDecoder)}readDsLen(){return $t(this.restDecoder)}}class cp extends ap{readLeftID(){return Vt($t(this.restDecoder),$t(this.restDecoder))}readRightID(){return Vt($t(this.restDecoder),$t(this.restDecoder))}readClient(){return $t(this.restDecoder)}readInfo(){return _s(this.restDecoder)}readString(){return Es(this.restDecoder)}readParentInfo(){return $t(this.restDecoder)===1}readTypeRef(){return $t(this.restDecoder)}readLen(){return $t(this.restDecoder)}readAny(){return fo(this.restDecoder)}readBuf(){return gw(an(this.restDecoder))}readJSON(){return JSON.parse(Es(this.restDecoder))}readKey(){return Es(this.restDecoder)}}class Lw{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=$t(this.restDecoder),this.dsCurrVal}readDsLen(){const t=$t(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class vs extends Lw{constructor(t){super(t),this.keys=[],$t(t),this.keyClockDecoder=new tu(an(t)),this.clientDecoder=new ka(an(t)),this.leftClockDecoder=new tu(an(t)),this.rightClockDecoder=new tu(an(t)),this.infoDecoder=new Ad(an(t),_s),this.stringDecoder=new bb(an(t)),this.parentInfoDecoder=new Ad(an(t),_s),this.typeRefDecoder=new ka(an(t)),this.lenDecoder=new ka(an(t))}readLeftID(){return new Ss(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ss(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return fo(this.restDecoder)}readBuf(){return an(this.restDecoder)}readJSON(){return fo(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class lp{constructor(){this.restEncoder=gi()}toUint8Array(){return Qn(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){Dt(this.restEncoder,t)}writeDsLen(t){Dt(this.restEncoder,t)}}class yo extends lp{writeLeftID(t){Dt(this.restEncoder,t.client),Dt(this.restEncoder,t.clock)}writeRightID(t){Dt(this.restEncoder,t.client),Dt(this.restEncoder,t.clock)}writeClient(t){Dt(this.restEncoder,t)}writeInfo(t){Yl(this.restEncoder,t)}writeString(t){ys(this.restEncoder,t)}writeParentInfo(t){Dt(this.restEncoder,t?1:0)}writeTypeRef(t){Dt(this.restEncoder,t)}writeLen(t){Dt(this.restEncoder,t)}writeAny(t){ho(this.restEncoder,t)}writeBuf(t){en(this.restEncoder,t)}writeJSON(t){ys(this.restEncoder,JSON.stringify(t))}writeKey(t){ys(this.restEncoder,t)}}class up{constructor(){this.restEncoder=gi(),this.dsCurrVal=0}toUint8Array(){return Qn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,Dt(this.restEncoder,n)}writeDsLen(t){t===0&&dr(),Dt(this.restEncoder,t-1),this.dsCurrVal+=t}}class Gi extends up{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Jl,this.clientEncoder=new wa,this.leftClockEncoder=new Jl,this.rightClockEncoder=new Jl,this.infoEncoder=new bd(Yl),this.stringEncoder=new gb,this.parentInfoEncoder=new bd(Yl),this.typeRefEncoder=new wa,this.lenEncoder=new wa}toUint8Array(){const t=gi();return Dt(t,0),en(t,this.keyClockEncoder.toUint8Array()),en(t,this.clientEncoder.toUint8Array()),en(t,this.leftClockEncoder.toUint8Array()),en(t,this.rightClockEncoder.toUint8Array()),en(t,Qn(this.infoEncoder)),en(t,this.stringEncoder.toUint8Array()),en(t,Qn(this.parentInfoEncoder)),en(t,this.typeRefEncoder.toUint8Array()),en(t,this.lenEncoder.toUint8Array()),ba(t,Qn(this.restEncoder)),Qn(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){ho(this.restEncoder,t)}writeBuf(t){en(this.restEncoder,t)}writeJSON(t){ho(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Mw=(e,t,n,r)=>{r=zi(r,t[0].id.clock);const i=_r(t,r);Dt(e.restEncoder,t.length-i),e.writeClient(n),Dt(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},_u=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{Ye(t,s)>i&&r.set(s,i)}),Ca(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Dt(e.restEncoder,r.size),pi(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Mw(e,t.clients.get(i),i,s)})},Uw=(e,t)=>{const n=tr(),r=$t(e.restDecoder);for(let i=0;i<r;i++){const s=$t(e.restDecoder),o=new Array(s),a=e.readClient();let c=$t(e.restDecoder);n.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=e.readInfo();switch(_a&l){case 0:{const h=e.readLen();o[u]=new jn(Vt(a,c),h),c+=h;break}case 10:{const h=$t(e.restDecoder);o[u]=new zn(Vt(a,c),h),c+=h;break}default:{const h=(l&($r|In))===0,f=new De(Vt(a,c),null,(l&In)===In?e.readLeftID():null,null,(l&$r)===$r?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(l&ao)===ao?e.readString():null,Hp(e,l));o[u]=f,c+=f.length}}}}return n},Pw=(e,t,n)=>{const r=[];let i=pi(n.keys()).sort((d,p)=>d-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let d=n.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=n.get(i[i.length-1]);else return null;return d};let o=s();if(o===null)return null;const a=new _p,c=new Map,u=(d,p)=>{const g=c.get(d);(g==null||g>p)&&c.set(d,p)};let l=o.refs[o.i++];const h=new Map,f=()=>{for(const d of r){const p=d.id.client,g=n.get(p);g?(g.i--,a.clients.set(p,g.refs.slice(g.i)),n.delete(p),g.i=0,g.refs=[]):a.clients.set(p,[d]),i=i.filter(w=>w!==p)}r.length=0};for(;;){if(l.constructor!==zn){const p=yi(h,l.id.client,()=>Ye(t,l.id.client))-l.id.clock;if(p<0)r.push(l),u(l.id.client,l.id.clock-1),f();else{const g=l.getMissing(e,t);if(g!==null){r.push(l);const w=n.get(g)||{refs:[],i:0};if(w.refs.length===w.i)u(g,Ye(t,g)),f();else{l=w.refs[w.i++];continue}}else(p===0||p<l.length)&&(l.integrate(e,p),h.set(l.id.client,l.id.clock+l.length))}}if(r.length>0)l=r.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const d=new Gi;return _u(d,a,new Map),Dt(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},Bw=(e,t)=>_u(e,t.doc.store,t.beforeState),Fw=(e,t,n,r=new vs(e))=>ue(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=Uw(r,o),u=Pw(i,a,c),l=a.pendingStructs;if(l){for(const[f,d]of l.missing)if(d<Ye(a,f)){s=!0;break}if(u){for(const[f,d]of u.missing){const p=l.missing.get(f);(p==null||p>d)&&l.missing.set(f,d)}l.update=Ma([l.update,u.update])}}else a.pendingStructs=u;const h=sp(r,i,a);if(a.pendingDs){const f=new vs(Ki(a.pendingDs));$t(f.restDecoder);const d=sp(f,i,a);h&&d?a.pendingDs=Ma([h,d]):a.pendingDs=h||d}else a.pendingDs=h;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,hp(i.doc,f)}},n,!1),hp=(e,t,n,r=vs)=>{const i=Ki(t);Fw(i,e,n,new r(i))},Dw=(e,t,n)=>hp(e,t,n,cp),$w=(e,t,n=new Map)=>{_u(e,t.store,n),xs(e,Cw(t.store))},jw=(e,t=new Uint8Array([0]),n=new Gi)=>{const r=fp(t);$w(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(nT(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===yo)return tT(i.map((s,o)=>o===0?s:iT(s)));if(n.constructor===Gi)return Ma(i)}return i[0]},zw=(e,t)=>jw(e,t,new yo),Kw=e=>{const t=new Map,n=$t(e.restDecoder);for(let r=0;r<n;r++){const i=$t(e.restDecoder),s=$t(e.restDecoder);t.set(i,s)}return t},fp=e=>Kw(new ap(Ki(e))),dp=(e,t)=>(Dt(e.restEncoder,t.size),pi(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{Dt(e.restEncoder,n),Dt(e.restEncoder,r)}),e),Ww=(e,t)=>dp(e,Ca(t.store)),Gw=(e,t=new up)=>(e instanceof Map?dp(t,e):Ww(t,e),t.toUint8Array()),Hw=e=>Gw(e,new lp);class Yw{constructor(){this.l=[]}}const pp=()=>new Yw,mp=(e,t)=>e.l.push(t),gp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},yp=(e,t,n)=>hu(e.l,[t,n]);class Ss{constructor(t,n){this.client=t,this.clock=n}}const Oa=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Vt=(e,t)=>new Ss(e,t),Vw=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw dr()},Rs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!ip(t.ds,e.id),Eu=(e,t)=>{const n=yi(e.meta,Eu,gs),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<Ye(r,s)&&Ei(e,Vt(s,i))}),rp(e,t.ds,i=>{}),n.add(t))};class _p{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ca=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},Ye=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Ep=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw dr()}n.push(t)},_r=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=di(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=di((n+r)/2)}throw dr()},bu=(e,t)=>{const n=e.clients.get(t.client);return n[_r(n,t.clock)]},wu=(e,t,n)=>{const r=_r(t,n),i=t[r];return i.id.clock<n&&i instanceof De?(t.splice(r+1,0,Ga(e,i,n-i.id.clock)),r+1):r},Ei=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[wu(e,n,t.clock)]},bp=(e,t,n)=>{const r=t.clients.get(n.client),i=_r(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==jn&&r.splice(i+1,0,Ga(e,s,n.clock-s.id.clock+1)),s},qw=(e,t,n)=>{const r=e.clients.get(t.id.client);r[_r(r,t.id.clock)]=n},wp=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=wu(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&wu(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class Xw{constructor(t,n,r){this.doc=t,this.deleteSet=new go,this.beforeState=Ca(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Tp=(e,t)=>t.deleteSet.clients.size===0&&!Bb(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(gu(t.deleteSet),Bw(e,t),xs(e,t.deleteSet),!0),kp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&yi(e.changed,t,gs).add(n)},La=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof De&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},Jw=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=_r(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof De&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},Zw=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=md(i.length-1,1+_r(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+La(i,c)}})},xp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{gu(s),n.afterState=Ca(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),yp(u._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),hu(a,[]),n._needFormattingCleanup&&_T(n)}finally{r.gc&&Jw(s,i,r.gcFilter),Zw(s,i),n.afterState.forEach((l,h)=>{const f=n.beforeState.get(h)||0;if(f!==l){const d=i.clients.get(h),p=zi(_r(d,f),1);for(let g=d.length-1;g>=p;)g-=1+La(d,g)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:f}=o[l].id,d=i.clients.get(h),p=_r(d,f);p+1<d.length&&La(d,p+1)>1||p>0&&La(d,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(vw(du,Jd,"[yjs] ",Zd,Qd,"Changed the client-id because another client seems to be using it."),r.clientID=op()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const l=new yo;Tp(l,n)&&r.emit("update",[l.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const l=new Gi;Tp(l,n)&&r.emit("updateV2",[l.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=n;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=r.clientID,l.collectionid==null&&(l.collectionid=r.collectionid),r.subdocs.add(l)}),u.forEach(l=>r.subdocs.delete(l)),r.emit("subdocs",[{loaded:c,added:a,removed:u},r,n]),u.forEach(l=>l.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):xp(e,t+1)}}},ue=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new Xw(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&xp(i,0)}}return o};function*Qw(e){const t=$t(e.restDecoder);for(let n=0;n<t;n++){const r=$t(e.restDecoder),i=e.readClient();let s=$t(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=$t(e.restDecoder);yield new zn(Vt(i,s),c),s+=c}else if(_a&a){const c=(a&($r|In))===0,u=new De(Vt(i,s),null,(a&In)===In?e.readLeftID():null,null,(a&$r)===$r?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&ao)===ao?e.readString():null,Hp(e,a));yield u,s+=u.length}else{const c=e.readLen();yield new jn(Vt(i,s),c),s+=c}}}}class Tu{constructor(t,n){this.gen=Qw(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===zn);return this.curr}}class ku{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const tT=e=>Ma(e,cp,yo),eT=(e,t)=>{if(e.constructor===jn){const{client:n,clock:r}=e.id;return new jn(Vt(n,r+t),e.length-t)}else if(e.constructor===zn){const{client:n,clock:r}=e.id;return new zn(Vt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new De(Vt(r,i+t),null,Vt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Ma=(e,t=vs,n=Gi)=>{if(e.length===1)return e[0];const r=e.map(l=>new t(Ki(l)));let i=r.map(l=>new Tu(l,!0)),s=null;const o=new n,a=new ku(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){const p=f.curr.id.clock-d.curr.id.clock;return p===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===zn?1:-1:p}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let f=l.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=l.next(),d=!0;if(f===null||f.id.client!==h||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)bi(a,s.struct,s.offset),s={struct:f,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===zn)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{bi(a,s.struct,s.offset);const p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new zn(Vt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===zn?s.struct.length-=p:f=eT(f,p)),s.struct.mergeWith(f)||(bi(a,s.struct,s.offset),s={struct:f,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let f=l.curr;f!==null&&f.id.client===h&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==zn;f=l.next())bi(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(bi(a,s.struct,s.offset),s=null),xu(a);const c=r.map(l=>yu(l)),u=Nw(c);return xs(o,u),o.toUint8Array()},nT=(e,t,n=vs,r=Gi)=>{const i=fp(t),s=new r,o=new ku(s),a=new n(Ki(e)),c=new Tu(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,f=i.get(h)||0;if(c.curr.constructor===zn){c.next();continue}if(l.id.clock+l.length>f)for(bi(o,l,zi(f-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)bi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=f;)c.next()}xu(o);const u=yu(a);return xs(s,u),s.toUint8Array()},Ap=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Qn(e.encoder.restEncoder)}),e.encoder.restEncoder=gi(),e.written=0)},bi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Ap(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),Dt(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},xu=e=>{Ap(e);const t=e.encoder.restEncoder;Dt(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];Dt(t,r.written),ba(t,r.restEncoder)}},rT=(e,t,n,r)=>{const i=new n(Ki(e)),s=new Tu(i,!1),o=new r,a=new ku(o);for(let u=s.curr;u!==null;u=s.next())bi(a,t(u),0);xu(a);const c=yu(i);return xs(o,c),o.toUint8Array()},iT=e=>rT(e,hw,vs,yo),vp="You must not compute changes after the event-handler fired.";class Ua{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=sT(this.currentTarget,this.target))}deletes(t){return ip(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw mi(vp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Hl(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Hl(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Hl(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw mi(vp);const n=this.target,r=gs(),i=gs(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const sT=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},nn=()=>{Sw("Invalid access: Add Yjs type to a document before reading data.")},Sp=80;let Au=0;class oT{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Au++}}const aT=e=>{e.timestamp=Au++},Rp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Au++},cT=(e,t,n)=>{if(e.length>=Sp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Rp(r,t,n),r}else{const r=new oT(t,n);return e.push(r),r}},Pa=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Ea(t-s.index)<Ea(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,aT(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Ea(n.index-i)<r.parent.length/Sp?(Rp(n,r,i),n):cT(e._searchMarker,r,i)},_o=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=zi(t,i.index+n))}},Ba=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;yi(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;yp(r._eH,n,t)};class Ze{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=pp(),this._dEH=pp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw fr()}clone(){throw fr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){mp(this._eH,t)}observeDeep(t){mp(this._dEH,t)}unobserve(t){gp(this._eH,t)}unobserveDeep(t){gp(this._dEH,t)}toJSON(){}}const Ip=(e,t,n)=>{e.doc??nn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},Np=e=>{e.doc??nn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Eo=(e,t)=>{let n=0,r=e._start;for(e.doc??nn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},Op=(e,t)=>{const n=[];return Eo(e,(r,i)=>{n.push(t(r,i,e))}),n},lT=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Cp=(e,t)=>{e.doc??nn();const n=Pa(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Fa=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let u=[];const l=()=>{u.length>0&&(i=new De(Vt(o,Ye(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Vi(u)),i.integrate(e,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new De(Vt(o,Ye(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new bo(new Uint8Array(h))),i.integrate(e,0);break;case As:i=new De(Vt(o,Ye(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new To(h)),i.integrate(e,0);break;default:if(h instanceof Ze)i=new De(Vt(o,Ye(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Hr(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},Lp=()=>mi("Length exceeded!"),Mp=(e,t,n,r)=>{if(n>t._length)throw Lp();if(n===0)return t._searchMarker&&_o(t._searchMarker,n,r.length),Fa(e,t,null,r);const i=n,s=Pa(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ei(e,Vt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&_o(t._searchMarker,i,r.length),Fa(e,t,o,r)},uT=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Fa(e,t,i,n)},Up=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=Pa(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ei(e,Vt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ei(e,Vt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Lp();t._searchMarker&&_o(t._searchMarker,i,-s+r)},Da=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},vu=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new Vi([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Vi([r]);break;case Uint8Array:a=new bo(r);break;case As:a=new To(r);break;default:if(r instanceof Ze)a=new Hr(r);else throw new Error("Unexpected content type")}new De(Vt(o,Ye(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},Su=(e,t)=>{e.doc??nn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Pp=e=>{const t={};return e.doc??nn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Bp=(e,t)=>{e.doc??nn();const n=e._map.get(t);return n!==void 0&&!n.deleted},hT=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Rs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},$a=e=>(e.doc??nn(),Rw(e._map.entries(),t=>!t[1].deleted));class fT extends Ua{}class Is extends Ze{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Is;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Is}clone(){const t=new Is;return t.insert(0,this.toArray().map(n=>n instanceof Ze?n.clone():n)),t}get length(){return this.doc??nn(),this._length}_callObserver(t,n){super._callObserver(t,n),Ba(this,t,new fT(this,t))}insert(t,n){this.doc!==null?ue(this.doc,r=>{Mp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?ue(this.doc,n=>{uT(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?ue(this.doc,r=>{Up(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Cp(this,t)}toArray(){return Np(this)}slice(t=0,n=this.length){return Ip(this,t,n)}toJSON(){return this.map(t=>t instanceof Ze?t.toJSON():t)}map(t){return Op(this,t)}forEach(t){Eo(this,t)}[Symbol.iterator](){return lT(this)}_write(t){t.writeTypeRef(BT)}}const dT=e=>new Is;class pT extends Ua{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Ns extends Ze{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Ns}clone(){const t=new Ns;return this.forEach((n,r)=>{t.set(r,n instanceof Ze?n.clone():n)}),t}_callObserver(t,n){Ba(this,t,new pT(this,t,n))}toJSON(){this.doc??nn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof Ze?i.toJSON():i}}),t}get size(){return[...$a(this)].length}keys(){return pu($a(this),t=>t[0])}values(){return pu($a(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return pu($a(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??nn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?ue(this.doc,n=>{Da(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?ue(this.doc,r=>{vu(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Su(this,t)}has(t){return Bp(this,t)}clear(){this.doc!==null?ue(this.doc,t=>{this.forEach(function(n,r,i){Da(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(FT)}}const mT=e=>new Ns,wi=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&lw(e,t);class Ru{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&dr(),this.right.content.constructor){case Fe:this.right.deleted||Os(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Fp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Fe:t.right.deleted||Os(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Ei(e,Vt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},ja=(e,t,n,r)=>{const i=new Map,s=r?Pa(t,n):null;if(s){const o=new Ru(s.p.left,s.p,s.index,i);return Fp(e,o,n-s.index)}else{const o=new Ru(null,t._start,0,i);return Fp(e,o,n)}},Dp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Fe&&wi(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,u=n.right,l=new De(Vt(s,Ye(i.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,new Fe(a,o));l.integrate(e,0),n.right=l,n.forward()})},Os=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},$p=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Fe&&wi(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},jp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],u=n.currentAttributes.get(a)??null;if(!wi(u,c)){o.set(a,u);const{left:l,right:h}=n;n.right=new De(Vt(s,Ye(i.store,s)),l,l&&l.lastId,h,h&&h.id,t,null,new Fe(a,c)),n.right.integrate(e,0),n.forward()}}return o},Iu=(e,t,n,r,i)=>{n.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});const s=e.doc,o=s.clientID;$p(n,i);const a=jp(e,t,n,i),c=r.constructor===String?new Er(r):r instanceof Ze?new Hr(r):new Yi(r);let{left:u,right:l,index:h}=n;t._searchMarker&&_o(t._searchMarker,n.index,c.getLength()),l=new De(Vt(o,Ye(s.store,o)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),n.right=l,n.index=h,n.forward(),Dp(e,t,n,a)},zp=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;$p(n,i);const a=jp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Fe));){if(!n.right.deleted)switch(n.right.content.constructor){case Fe:{const{key:c,value:u}=n.right.content,l=i[c];if(l!==void 0){if(wi(l,u))a.delete(c);else{if(r===0)break t;a.set(c,u)}n.right.delete(e)}else n.currentAttributes.set(c,u);break}default:r<n.right.length&&Ei(e,Vt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new De(Vt(o,Ye(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Er(c)),n.right.integrate(e,0),n.forward()}Dp(e,t,n,a)},Kp=(e,t,n,r,i)=>{let s=t;const o=tr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Fe){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case Fe:{const{key:l,value:h}=u,f=r.get(l)??null;(o.get(l)!==u||f===h)&&(t.delete(e),a++,!c&&(i.get(l)??null)===h&&f!==h&&(f===null?i.delete(l):i.set(l,f))),!c&&!t.deleted&&Os(i,u);break}}}t=t.right}return a},gT=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Fe){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},yT=e=>{let t=0;return ue(e.doc,n=>{let r=e._start,i=e._start,s=tr();const o=ou(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Fe:Os(o,i.content);break;default:t+=Kp(n,r,i,s,o),s=ou(o),r=i;break}i=i.right}}),t},_T=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&wp(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Fe&&o.constructor!==jn&&t.add(o.parent)})}ue(n,r=>{rp(e,e.deleteSet,i=>{if(i instanceof jn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===Fe?t.add(s):gT(r,i)});for(const i of t)yT(i)})},Wp=(e,t,n)=>{const r=n,i=ou(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Hr:case Yi:case Er:n<t.right.length&&Ei(e,Vt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&Kp(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&_o(o._searchMarker,t.index,-r+n),t};class ET extends Ua{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];ue(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const f=()=>{if(a!==null){let d=null;switch(a){case"delete":h>0&&(d={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(d={insert:u},i.size>0&&(d.attributes={},i.forEach((p,g)=>{p!==null&&(d.attributes[g]=p)}))),u="";break;case"retain":l>0&&(d={retain:l},ow(c)||(d.attributes=rw({},c))),l=0;break}d&&n.push(d),a=null}};for(;o!==null;){switch(o.content.constructor){case Hr:case Yi:this.adds(o)?this.deletes(o)||(f(),a="insert",u=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=1);break;case Er:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=o.length);break;case Fe:{const{key:d,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const g=i.get(d)??null;wi(g,p)?p!==null&&o.delete(r):(a==="retain"&&f(),wi(p,s.get(d)??null)?delete c[d]:c[d]=p)}}else if(this.deletes(o)){s.set(d,p);const g=i.get(d)??null;wi(g,p)||(a==="retain"&&f(),c[d]=g)}else if(!o.deleted){s.set(d,p);const g=c[d];g!==void 0&&(wi(g,p)?g!==null&&o.delete(r):(a==="retain"&&f(),p===null?delete c[d]:c[d]=p))}o.deleted||(a==="insert"&&f(),Os(i,o.content));break}}o=o.right}for(f();n.length>0;){const d=n[n.length-1];if(d.retain!==void 0&&d.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Gr extends Ze{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??nn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Gr}clone(){const t=new Gr;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new ET(this,t,n);Ba(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??nn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Er&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?ue(this.doc,r=>{const i=new Ru(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Iu(r,this,i,a,o.attributes||{})}else o.retain!==void 0?zp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Wp(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??nn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let f=!1;s.forEach((p,g)=>{f=!0,h[g]=p});const d={insert:a};f&&(d.attributes=h),i.push(d),a=""}}const l=()=>{for(;c!==null;){if(Rs(c,t)||n!==void 0&&Rs(c,n))switch(c.content.constructor){case Er:{const h=s.get("ychange");t!==void 0&&!Rs(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Rs(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case Hr:case Yi:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const f={};h.attributes=f,s.forEach((d,p)=>{f[p]=d})}i.push(h);break}case Fe:Rs(c,t)&&(u(),Os(s,c.content));break}c=c.right}u()};return t||n?ue(o,h=>{t&&Eu(h,t),n&&Eu(h,n),l()},"cleanup"):l(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?ue(i,s=>{const o=ja(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Iu(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?ue(i,s=>{const o=ja(s,this,t,!r);Iu(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?ue(r,i=>{Wp(i,ja(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?ue(i,s=>{const o=ja(s,this,t,!1);o.right!==null&&zp(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?ue(this.doc,n=>{Da(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?ue(this.doc,r=>{vu(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Su(this,t)}getAttributes(){return Pp(this)}_write(t){t.writeTypeRef(DT)}}const bT=e=>new Gr;class Nu{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??nn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Cs||n.constructor===Hi)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Hi extends Ze{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Hi}clone(){const t=new Hi;return t.insert(0,this.toArray().map(n=>n instanceof Ze?n.clone():n)),t}get length(){return this.doc??nn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Nu(this,t)}querySelector(t){t=t.toUpperCase();const r=new Nu(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),pi(new Nu(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Ba(this,t,new kT(this,n,t))}toString(){return Op(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Eo(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?ue(this.doc,r=>{Mp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)ue(this.doc,r=>{const i=t&&t instanceof Ze?t._item:t;Fa(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw mi("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?ue(this.doc,r=>{Up(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Np(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Cp(this,t)}slice(t=0,n=this.length){return Ip(this,t,n)}forEach(t){Eo(this,t)}_write(t){t.writeTypeRef(jT)}}const wT=e=>new Hi;class Cs extends Hi{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Cs(this.nodeName)}clone(){const t=new Cs(this.nodeName),n=this.getAttributes();return sw(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof Ze?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?ue(this.doc,n=>{Da(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?ue(this.doc,r=>{vu(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Su(this,t)}hasAttribute(t){return Bp(this,t)}getAttributes(t){return t?hT(this,t):Pp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Eo(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef($T),t.writeKey(this.nodeName)}}const TT=e=>new Cs(e.readKey());class kT extends Ua{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class za extends Ns{constructor(t){super(),this.hookName=t}_copy(){return new za(this.hookName)}clone(){const t=new za(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(zT),t.writeKey(this.hookName)}}const xT=e=>new za(e.readKey());class Ka extends Gr{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Ka}clone(){const t=new Ka;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(KT)}}const AT=e=>new Ka;class Ou{constructor(t,n){this.id=t,this.length=n}get deleted(){throw fr()}mergeWith(t){return!1}write(t,n,r){throw fr()}integrate(t,n){throw fr()}}const vT=0;class jn extends Ou{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Ep(t.doc.store,this)}write(t,n){t.writeInfo(vT),t.writeLen(this.length-n)}getMissing(t,n){return null}}class bo{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new bo(this.content)}splice(t){throw fr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const ST=e=>new bo(e.readBuf());class wo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new wo(this.len)}splice(t){const n=new wo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Na(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const RT=e=>new wo(e.readLen()),Gp=(e,t)=>new As({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class To{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new To(Gp(this.doc.guid,this.opts))}splice(t){throw fr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const IT=e=>new To(Gp(e.readString(),e.readAny()));class Yi{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Yi(this.embed)}splice(t){throw fr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const NT=e=>new Yi(e.readJSON());class Fe{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Fe(this.key,this.value)}splice(t){throw fr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const OT=e=>new Fe(e.readKey(),e.readJSON());class Wa{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Wa(this.arr)}splice(t){const n=new Wa(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const CT=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Wa(n)},LT=Ia("node_env")==="development";class Vi{constructor(t){this.arr=t,LT&&Vd(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Vi(this.arr)}splice(t){const n=new Vi(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const MT=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Vi(n)};class Er{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Er(this.str)}splice(t){const n=new Er(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const UT=e=>new Er(e.readString()),PT=[dT,mT,bT,TT,wT,xT,AT],BT=0,FT=1,DT=2,$T=3,jT=4,zT=5,KT=6;class Hr{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Hr(this.type._copy())}splice(t){throw fr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const WT=e=>new Hr(PT[e.readTypeRef()](e)),Ga=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new De(Vt(r,i+n),t,Vt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=Vt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class De extends Ou{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?pd:0}set marker(t){(this.info&Wl)>0!==t&&(this.info^=Wl)}get marker(){return(this.info&Wl)>0}get keep(){return(this.info&dd)>0}set keep(t){this.keep!==t&&(this.info^=dd)}get countable(){return(this.info&pd)>0}get deleted(){return(this.info&Kl)>0}set deleted(t){this.deleted!==t&&(this.info^=Kl)}markDeleted(){this.info|=Kl}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Ye(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Ye(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ss&&this.id.client!==this.parent.client&&this.parent.clock>=Ye(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=bp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ei(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===jn||this.right&&this.right.constructor===jn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===De?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===De&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ss){const r=bu(n,this.parent);r.constructor===jn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=bp(t,t.doc.store,Vt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Oa(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Oa(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(bu(t.doc.store,i.origin)))s.has(bu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ep(t.doc.store,this),this.content.integrate(t,this),kp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new jn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Vt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Oa(t.origin,this.lastId)&&this.right===t&&Oa(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Na(t.deleteSet,this.id.client,this.id.clock,this.length),kp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw dr();this.content.gc(t),n?qw(t,this,new jn(this.id,this.length)):this.content=new wo(this.length)}write(t,n){const r=n>0?Vt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&_a|(r===null?0:In)|(i===null?0:$r)|(s===null?0:ao);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=Vw(a);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Ss?(t.writeParentInfo(!1),t.writeLeftID(a)):dr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const Hp=(e,t)=>GT[t&_a](e),GT=[()=>{dr()},RT,CT,ST,UT,NT,OT,WT,MT,IT,()=>{dr()}],HT=10;class zn extends Ou{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){dr()}write(t,n){t.writeInfo(HT),Dt(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Yp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ws<"u"?ws:{},Vp="__ $YJS$ __";Yp[Vp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Yp[Vp]=!0;const Cu=0,qp=1,Xp=2,YT=(e,t)=>{Dt(e,Cu);const n=Hw(t);en(e,n)},Jp=(e,t,n)=>{Dt(e,qp),en(e,zw(t,n))},VT=(e,t,n)=>Jp(t,n,an(e)),Zp=(e,t,n)=>{try{Dw(t,an(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},qT=(e,t)=>{Dt(e,Xp),en(e,t)},XT=Zp,JT=(e,t,n,r)=>{const i=$t(e);switch(i){case Cu:VT(e,t,n);break;case qp:Zp(e,n,r);break;case Xp:XT(e,n,r);break;default:throw new Error("Unknown message type")}return i};let Qp=!1;const br=new As;function t0(e,t,n){const r=br.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function ZT(e,t){t0(e,0,t)}function Lu(e,t){const n=new Gr(t);t0(e,1,n)}function QT(e,t){br.getMap().set(e,t)}function tk(e,t){const n=br.getMap(),r=new Gr(t);n.set(e,r)}function e0(e,t){const n=br.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function ek(e,t){return e0(e,n=>{Lt(n)&&t(n)})}function n0(e,t){return e0(e,n=>{n instanceof Gr&&t(n.toJSON())})}function Ha(e){return Qn(e)}const Kn=ms("modem",["second"],e=>{if(Kn.session(e))switch(e.target){case"second":!Qp&&e.data%2===0&&Kn.emit("modem:join");break;case"join":if(e.sender!==Kn.id()){Kn.reply(e,"joinack");const t=gi();YT(t,br),Kn.reply(e,"sync",Ha(t));const n=gi();Jp(n,br),Kn.reply(e,"sync",Ha(n))}break;case"joinack":e.sender!==Kn.id()&&(Qp=!0);break;case"sync":{if(e.sender!==Kn.id()&&T(e.data))try{const t=Ki(e.data),n=gi();JT(t,n,br,Kn)===Cu&&Kn.emit("modem:sync",Ha(n))}catch(t){ae(Kn,"sync",t.message)}break}}});function r0(e){const t=gi();qT(t,e),Kn.emit("modem:sync",Ha(t))}br.on("update",r0),br.on("destroy",()=>{br.off("update",r0)});function nk(e,t){return e%t}function rk(e,t){return Math.floor(e/t)}function i0(e,t){return{x:nk(e,t),y:rk(e,t)}}function Ya(e,t){return e.x+e.y*t}function s0(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function o0(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let u=a;u<=c;++u)for(let l=s;l<=o;++l)i.push({x:l,y:u});return i}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const a0="170",ik="",Va="srgb",c0="srgb-linear",l0="linear",Mu="srgb";function sk(e,t,n){return Math.max(t,Math.min(n,e))}class ko{constructor(t=0,n=0){ko.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(sk(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class xo{constructor(t,n,r,i,s,o,a,c,u){xo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,u)}set(t,n,r,i,s,o,a,c,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=n,l[4]=s,l[5]=c,l[6]=r,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],u=r[1],l=r[4],h=r[7],f=r[2],d=r[5],p=r[8],g=i[0],w=i[3],b=i[6],k=i[1],v=i[4],N=i[7],P=i[2],L=i[5],C=i[8];return s[0]=o*g+a*k+c*P,s[3]=o*w+a*v+c*L,s[6]=o*b+a*N+c*C,s[1]=u*g+l*k+h*P,s[4]=u*w+l*v+h*L,s[7]=u*b+l*N+h*C,s[2]=f*g+d*k+p*P,s[5]=f*w+d*v+p*L,s[8]=f*b+d*N+p*C,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8];return n*o*l-n*a*u-r*s*l+r*a*c+i*s*u-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,f=a*c-l*s,d=u*s-o*c,p=n*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/p;return t[0]=h*g,t[1]=(i*u-l*r)*g,t[2]=(a*r-i*o)*g,t[3]=f*g,t[4]=(l*n-i*c)*g,t[5]=(i*s-a*n)*g,t[6]=d*g,t[7]=(r*c-u*n)*g,t[8]=(o*n-r*s)*g,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(r*c,r*u,-r*(c*o+u*a)+o+t,-i*u,i*c,-i*(-u*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(Uu.makeScale(t,n)),this}rotate(t){return this.premultiply(Uu.makeRotation(-t)),this}translate(t,n){return this.premultiply(Uu.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Uu=new xo,ok={enabled:!0,workingColorSpace:c0,spaces:{},convert:function(e,t,n){return this.enabled===!1||t===n||!t||!n||(this.spaces[t].transfer===Mu&&(e.r=Pu(e.r),e.g=Pu(e.g),e.b=Pu(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Mu&&(e.r=Bu(e.r),e.g=Bu(e.g),e.b=Bu(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===ik?l0:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function Pu(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function Bu(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const u0=[.64,.33,.3,.6,.15,.06],h0=[.2126,.7152,.0722],f0=[.3127,.329],d0=new xo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),p0=new xo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);ok.define({[c0]:{primaries:u0,whitePoint:f0,transfer:l0,toXYZ:d0,fromXYZ:p0,luminanceCoefficients:h0,workingColorSpaceConfig:{unpackColorSpace:Va},outputColorSpaceConfig:{drawingBufferColorSpace:Va}},[Va]:{primaries:u0,whitePoint:f0,transfer:Mu,toXYZ:d0,fromXYZ:p0,luminanceCoefficients:h0,outputColorSpaceConfig:{drawingBufferColorSpace:Va}}}),typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:a0}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=a0),new ko,new ko;function Nn(e,t,n){return Math.max(t,Math.min(n,e))}function Fu(e){return e*180/Math.PI}const ak=Jf("089fad0j9awfem09wavefc09uwaef");function ck(){return ak()}function lk(e){return Jf(e)()}function Ti(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(ck()*i)}function m0(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(lk(e)*s)}function g0(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function uk(e){return e[Ti(0,e.length-1)]}function hk(e,t){return t[m0(e,0,t.length-1)]}function On(...e){return uk(e.flat())}function y0(e,...t){return hk(e,t.flat())}function fk(e){return[...new Set(e)].filter(T)}var _0={exports:{}},Du={exports:{}},E0;function dk(){return E0||(E0=1,function(e,t){(function(n,r){e.exports=r()})(gn,function(){function n(g){return!isNaN(parseFloat(g))&&isFinite(g)}function r(g){return g.charAt(0).toUpperCase()+g.substring(1)}function i(g){return function(){return this[g]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(g){if(g)for(var w=0;w<l.length;w++)g[l[w]]!==void 0&&this["set"+r(l[w])](g[l[w]])}h.prototype={getArgs:function(){return this.args},setArgs:function(g){if(Object.prototype.toString.call(g)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=g},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(g){if(g instanceof h)this.evalOrigin=g;else if(g instanceof Object)this.evalOrigin=new h(g);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var g=this.getFileName()||"",w=this.getLineNumber()||"",b=this.getColumnNumber()||"",k=this.getFunctionName()||"";return this.getIsEval()?g?"[eval] ("+g+":"+w+":"+b+")":"[eval]:"+w+":"+b:k?k+" ("+g+":"+w+":"+b+")":g+":"+w+":"+b}},h.fromString=function(w){var b=w.indexOf("("),k=w.lastIndexOf(")"),v=w.substring(0,b),N=w.substring(b+1,k).split(","),P=w.substring(k+1);if(P.indexOf("@")===0)var L=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(P,""),C=L[1],W=L[2],M=L[3];return new h({functionName:v,args:N||void 0,fileName:C,lineNumber:W||void 0,columnNumber:M||void 0})};for(var f=0;f<s.length;f++)h.prototype["get"+r(s[f])]=i(s[f]),h.prototype["set"+r(s[f])]=function(g){return function(w){this[g]=!!w}}(s[f]);for(var d=0;d<o.length;d++)h.prototype["get"+r(o[d])]=i(o[d]),h.prototype["set"+r(o[d])]=function(g){return function(w){if(!n(w))throw new TypeError(g+" must be a Number");this[g]=Number(w)}}(o[d]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(g){return function(w){this[g]=String(w)}}(a[p]);return h})}(Du)),Du.exports}(function(e,t){(function(n,r){e.exports=r(dk())})(gn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=h.match(/ (\(.+\)$)/);h=f?h.replace(f[0],""):h;var d=this.extractLocation(f?f[1]:h),p=f&&h||void 0,g=["eval","<anonymous>"].indexOf(d[0])>-1?void 0:d[0];return new r({functionName:p,fileName:g,lineNumber:d[1],columnNumber:d[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new r({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=l.match(h),d=f&&f[1]?f[1]:void 0,p=this.extractLocation(l.replace(h,""));return new r({functionName:d,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],f=2,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],f=0,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),f=this.extractLocation(h.pop()),d=h.shift()||"",p=d.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,g;d.match(/\(([^)]*)\)/)&&(g=d.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var w=g===void 0||g==="[arguments not available]"?void 0:g.split(",");return new r({functionName:p,args:w,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:l})},this)}}})})(_0);var pk=_0.exports,mk=so(pk);const $u=14,qa=3,Xa=8,Ja=14,Za=16,gk=16,yk=16;function Qa(e,t){return new Array(e).fill(t)}function _k(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:Qa(s,0),color:Qa(s,0),bg:Qa(s,i)}}function Ek(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:jt.ONCLEAR}}function bk(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function wk(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:Qa(s,i)}}function Tk(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function kk(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5}}function b0(e,t){return`${e}:${t}`}const xk=1,Ak=16,vk=256;var ln=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(ln||{});const wr=!!JSON.parse("false"),Sk=!!JSON.parse("false");JSON.parse("false");const Rk=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Yr={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Xa*Yr.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Ja*Yr.DRAW_CHAR_SCALE}},H=ms("SOFTWARE");function Vr(e){const t={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},listcommands(){return Dr(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function Ee(e){return`${e??""}`}function Ao(e,t){const n=parseFloat(Ee(e));return isNaN(n)?t:n}const Ik=["echo","reverb","chorus","phaser","distortion","vibrato"];function w0(e,t){const[n]=it(e,0,[q.NAME]);UE(H,n,t)}function qr(e,t){const[n,r]=it(t,0,[q.NUMBER_OR_STRING]);if(Lt(n))Pl(H,e,"volume",n);else if(Ik.includes(Bt(n))){const[i,s]=it(t,r,[q.NUMBER_OR_STRING,q.MAYBE_NUMBER_OR_STRING]);$E(H,e,n,i,s)}else{const[i]=it(t,r,[q.MAYBE_NUMBER_OR_STRING]);if(Lt(i)){const s=t.length-r,o=new Array(s).fill(q.NUMBER),a=it(t,r,o).slice(0,s),c=a.length===1?a[0]:a;Pl(H,e,n,c)}else{const[s]=it(t,r,[q.MAYBE_NUMBER_OR_STRING]);Pl(H,e,n,s)}}}const Nk=Vr().command("tts",(e,t)=>{const[n,r]=it(t,0,[q.STRING]),i=t.slice(r).map(Ee).join("");return LE(H,n,i),0}).command("tta",(e,t)=>{const n=t.map(Ee).join("");return ME(H,n),0}).command("bpm",(e,t)=>{const[n]=it(t,0,[q.NUMBER]);return PE(H,n),0}).command("vol",(e,t)=>{const[n]=it(t,0,[q.NUMBER]);return BE(H,n),0}).command("bgvol",(e,t)=>{const[n]=it(t,0,[q.NUMBER]);return FE(H,n),0}).command("ttsvol",(e,t)=>{const[n]=it(t,0,[q.NUMBER]);return DE(H,n),0}).command("play",(e,t)=>(w0(t,!1),0)).command("bgplay",(e,t)=>(w0(t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)qr(n,t);return 0}).command("synth1",(e,t)=>(qr(0,t),0)).command("synth2",(e,t)=>(qr(1,t),0)).command("synth3",(e,t)=>(qr(2,t),0)).command("synth4",(e,t)=>(qr(3,t),0)).command("synth5",(e,t)=>(qr(4,t),0)).command("synth6",(e,t)=>(qr(5,t),0)).command("synth7",(e,t)=>(qr(6,t),0)).command("synth8",(e,t)=>(qr(7,t),0));function Ok(e){return T(e)&&e<jt.ONBLACK?e:void 0}function Ck(e){return T(e)&&e>jt.WHITE&&e<jt.ONCLEAR?e-jt.ONBLACK:void 0}const vo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Cn(e){return ie(e)&&k0(e[0])}function T0(e){return Cn(e)&&e[0].startsWith("ON")}function k0(e){return T(jt[e])&&At(e)}function ju(e){if(At(e))return vo[Bt(e)]}function x0(e){return e.map(t=>jt[t]).find(t=>T(t)&&t<jt.ONBLACK)}function Lk(e){return e.map(t=>jt[t]).find(t=>T(t)&&t>=jt.ONBLACK)}function Mk(e){if(Cn(e))return e;if(k0(e))return[e];const t=ju(e);if(T(t))return[t]}function A0(e){const t=x.words[e],n=Mk(t);return Cn(n)?[n,e+1]:[void 0,e]}function tc(e){const t=[];let n=e;const[r,i]=A0(e);if(Cn(r)&&(t.push(...r),n=i),Cn(t)&&!T0(t)){const[s,o]=A0(i);T0(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function v0(e){const t={};return e.every(n=>{const r=jt[n];T(r)&&(r<jt.ONBLACK?t.color=r:t.bg=r-jt.ONBLACK)}),t}function Ls(e){return ie(e)&&typeof e[0]=="string"}function Uk(e){const t=x.words[e];return At(t)?[t,e+1]:[void 0,e]}function S0(e){const t=x.words[e];if(Ls(t))return[t,e+1];const[n,r]=tc(e),[i,s]=Uk(r);return At(i)?[[i,n],s]:[void 0,e]}function ec(e){if(!Ls(e))return;const[t]=e;return t}function R0(e){if(!Ls(e))return;const[,t]=e,n=T(t)?x0(t):void 0;return T(n)?n:void 0}function I0(e){if(!Ls(e))return;const[,t]=e,n=T(t)?Lk(t):void 0;return T(n)?n:void 0}const Qt=60,Ve=25;var Tt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(Tt||{});function zu(e,t){const n=e??Gt.ISWALK,r=t??Gt.ISWALK;switch(n){case Gt.ISWALK:return r!==Gt.ISWALK;case Gt.ISSWIM:return r!==Gt.ISSWIM;case Gt.ISSOLID:return!0;case Gt.ISBULLET:return r!==Gt.ISWALK&&r!==Gt.ISSWIM}}function nc(e,t,n){const r=e==null?void 0:e.objects[n];if(T(r))return r;if(T(t)){const i=So(e,"player"),s={x:t.x??0,y:t.y??0};C0(s,i)}}function So(e,t){var r,i;return t==="empty"?[...(e==null?void 0:e.terrain)??[]].map((o,a)=>{if(!(o!=null&&o.name)&&!(o!=null&&o.kind))return{...i0(a,Qt),name:"empty"}}).filter(T):[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(T)}function N0(e,t){const n=ec(t),r=R0(t),i=I0(t);return e.filter(s=>{var o,a,c;return!(T(n)&&Bt((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||T(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??jt.WHITE)!==r||T(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??jt.BLACK)!==i)}).filter(T)}function O0(e,t){return T(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(T(i))return i;const s=So(e,Bt(n));if(s.length)return s}else if(Qs(n)&&n.x>=0&&n.x<Qt&&n.y>=0&&n.y<Ve){const i=n.x+n.y*Qt,s=(r=e.lookup)==null?void 0:r[i];return T(s)?e.objects[s]:e.terrain[i]}}).flat().filter(T):[]}function C0(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var Ku;try{Ku=new TextDecoder}catch{}var mt,Wn,D=0,he={},qt,ki,Gn=0,Tr=0,qe,Xr,_n=[],Yt,L0={useRecords:!1,mapsAsObjects:!0};class M0{}const U0=new M0;U0.name="MessagePack 0xC1";var xi=!1,P0=2,B0;try{new Function("")}catch{P0=1/0}class Ro{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(mt)return X0(()=>(Vu(),this?this.unpack(t,n):Ro.prototype.unpack.call(L0,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Je<"u"?Je.from(t):new Uint8Array(t)),typeof n=="object"?(Wn=n.end||t.length,D=n.start||0):(D=0,Wn=n>-1?n:t.length),Tr=0,ki=null,qe=null,mt=t;try{Yt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw mt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Ro){if(he=this,this.structures)return qt=this.structures,rc(n);(!qt||qt.length>0)&&(qt=[])}else he=L0,(!qt||qt.length>0)&&(qt=[]);return rc(n)}unpackMultiple(t,n){let r,i=0;try{xi=!0;let s=t.length,o=this?this.unpack(t,s):ic.unpack(t,s);if(n){if(n(o,i,D)===!1)return;for(;D<s;)if(i=D,n(rc(),i,D)===!1)return}else{for(r=[o];D<s;)i=D,r.push(rc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{xi=!1,Vu()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function rc(e){try{if(!he.trusted&&!xi){let n=qt.sharedLength||0;n<qt.length&&(qt.length=n)}let t;if(he.randomAccessStructure&&mt[D]<64&&mt[D]>=32&&B0?(t=B0(mt,D,Wn,he),mt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),D=Wn):t=Ne(),qe&&(D=qe.postBundlePosition,qe=null),xi&&(qt.restoreStructures=null),D==Wn)qt&&qt.restoreStructures&&F0(),qt=null,mt=null,Xr&&(Xr=null);else{if(D>Wn)throw new Error("Unexpected end of MessagePack data");if(!xi){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw qt&&qt.restoreStructures&&F0(),Vu(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||D>Wn)&&(t.incomplete=!0),t}}function F0(){for(let e in qt.restoreStructures)qt[e]=qt.restoreStructures[e];qt.restoreStructures=null}function Ne(){let e=mt[D++];if(e<160)if(e<128){if(e<64)return e;{let t=qt[e&63]||he.getStructures&&$0()[e&63];return t?(t.read||(t.read=Wu(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,he.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=H0();r==="__proto__"&&(r="__proto_"),t[r]=Ne()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ne(),Ne());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ne();return he.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Tr>=D)return ki.slice(D-Gn,(D+=t)-Gn);if(Tr==0&&Wn<140){let n=t<16?Hu(t):K0(t);if(n!=null)return n}return Gu(t)}else{let t;switch(e){case 192:return null;case 193:return qe?(t=Ne(),t>0?qe[1].slice(qe.position1,qe.position1+=t):qe[0].slice(qe.position0,qe.position0-=t)):U0;case 194:return!1;case 195:return!0;case 196:if(t=mt[D++],t===void 0)throw new Error("Unexpected end of buffer");return Yu(t);case 197:return t=Yt.getUint16(D),D+=2,Yu(t);case 198:return t=Yt.getUint32(D),D+=4,Yu(t);case 199:return qi(mt[D++]);case 200:return t=Yt.getUint16(D),D+=2,qi(t);case 201:return t=Yt.getUint32(D),D+=4,qi(t);case 202:if(t=Yt.getFloat32(D),he.useFloat32>2){let n=qu[(mt[D]&127)<<1|mt[D+1]>>7];return D+=4,(n*t+(t>0?.5:-.5)>>0)/n}return D+=4,t;case 203:return t=Yt.getFloat64(D),D+=8,t;case 204:return mt[D++];case 205:return t=Yt.getUint16(D),D+=2,t;case 206:return t=Yt.getUint32(D),D+=4,t;case 207:return he.int64AsType==="number"?(t=Yt.getUint32(D)*4294967296,t+=Yt.getUint32(D+4)):he.int64AsType==="string"?t=Yt.getBigUint64(D).toString():he.int64AsType==="auto"?(t=Yt.getBigUint64(D),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Yt.getBigUint64(D),D+=8,t;case 208:return Yt.getInt8(D++);case 209:return t=Yt.getInt16(D),D+=2,t;case 210:return t=Yt.getInt32(D),D+=4,t;case 211:return he.int64AsType==="number"?(t=Yt.getInt32(D)*4294967296,t+=Yt.getUint32(D+4)):he.int64AsType==="string"?t=Yt.getBigInt64(D).toString():he.int64AsType==="auto"?(t=Yt.getBigInt64(D),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Yt.getBigInt64(D),D+=8,t;case 212:if(t=mt[D++],t==114)return V0(mt[D++]&63);{let n=_n[t];if(n)return n.read?(D++,n.read(Ne())):n.noBuffer?(D++,n()):n(mt.subarray(D,++D));throw new Error("Unknown extension "+t)}case 213:return t=mt[D],t==114?(D++,V0(mt[D++]&63,mt[D++])):qi(2);case 214:return qi(4);case 215:return qi(8);case 216:return qi(16);case 217:return t=mt[D++],Tr>=D?ki.slice(D-Gn,(D+=t)-Gn):Bk(t);case 218:return t=Yt.getUint16(D),D+=2,Tr>=D?ki.slice(D-Gn,(D+=t)-Gn):Fk(t);case 219:return t=Yt.getUint32(D),D+=4,Tr>=D?ki.slice(D-Gn,(D+=t)-Gn):Dk(t);case 220:return t=Yt.getUint16(D),D+=2,j0(t);case 221:return t=Yt.getUint32(D),D+=4,j0(t);case 222:return t=Yt.getUint16(D),D+=2,z0(t);case 223:return t=Yt.getUint32(D),D+=4,z0(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const Pk=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Wu(e,t){function n(){if(n.count++>P0){let i=e.read=new Function("r","return function(){return "+(he.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":Pk.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Ne);return e.highByte===0&&(e.read=D0(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Ne()}return he.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?D0(t,n):n}const D0=(e,t)=>function(){let n=mt[D++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=qt[r]||$0()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Wu(i,e)),i.read()};function $0(){let e=X0(()=>(mt=null,he.getStructures()));return qt=he._mergeStructures(e,qt)}var Gu=Io,Bk=Io,Fk=Io,Dk=Io;function Io(e){let t;if(e<16&&(t=Hu(e)))return t;if(e>64&&Ku)return Ku.decode(mt.subarray(D,D+=e));const n=D+e,r=[];for(t="";D<n;){const i=mt[D++];if(!(i&128))r.push(i);else if((i&224)===192){const s=mt[D++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=mt[D++]&63,o=mt[D++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=mt[D++]&63,o=mt[D++]&63,a=mt[D++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=Xe.apply(String,r),r.length=0)}return r.length>0&&(t+=Xe.apply(String,r)),t}function j0(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ne();return he.freezeData?Object.freeze(t):t}function z0(e){if(he.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=H0();r==="__proto__"&&(r="__proto_"),t[r]=Ne()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ne(),Ne());return t}}var Xe=String.fromCharCode;function K0(e){let t=D,n=new Array(e);for(let r=0;r<e;r++){const i=mt[D++];if((i&128)>0){D=t;return}n[r]=i}return Xe.apply(String,n)}function Hu(e){if(e<4)if(e<2){if(e===0)return"";{let t=mt[D++];if((t&128)>1){D-=1;return}return Xe(t)}}else{let t=mt[D++],n=mt[D++];if((t&128)>0||(n&128)>0){D-=2;return}if(e<3)return Xe(t,n);let r=mt[D++];if((r&128)>0){D-=3;return}return Xe(t,n,r)}else{let t=mt[D++],n=mt[D++],r=mt[D++],i=mt[D++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){D-=4;return}if(e<6){if(e===4)return Xe(t,n,r,i);{let s=mt[D++];if((s&128)>0){D-=5;return}return Xe(t,n,r,i,s)}}else if(e<8){let s=mt[D++],o=mt[D++];if((s&128)>0||(o&128)>0){D-=6;return}if(e<7)return Xe(t,n,r,i,s,o);let a=mt[D++];if((a&128)>0){D-=7;return}return Xe(t,n,r,i,s,o,a)}else{let s=mt[D++],o=mt[D++],a=mt[D++],c=mt[D++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){D-=8;return}if(e<10){if(e===8)return Xe(t,n,r,i,s,o,a,c);{let u=mt[D++];if((u&128)>0){D-=9;return}return Xe(t,n,r,i,s,o,a,c,u)}}else if(e<12){let u=mt[D++],l=mt[D++];if((u&128)>0||(l&128)>0){D-=10;return}if(e<11)return Xe(t,n,r,i,s,o,a,c,u,l);let h=mt[D++];if((h&128)>0){D-=11;return}return Xe(t,n,r,i,s,o,a,c,u,l,h)}else{let u=mt[D++],l=mt[D++],h=mt[D++],f=mt[D++];if((u&128)>0||(l&128)>0||(h&128)>0||(f&128)>0){D-=12;return}if(e<14){if(e===12)return Xe(t,n,r,i,s,o,a,c,u,l,h,f);{let d=mt[D++];if((d&128)>0){D-=13;return}return Xe(t,n,r,i,s,o,a,c,u,l,h,f,d)}}else{let d=mt[D++],p=mt[D++];if((d&128)>0||(p&128)>0){D-=14;return}if(e<15)return Xe(t,n,r,i,s,o,a,c,u,l,h,f,d,p);let g=mt[D++];if((g&128)>0){D-=15;return}return Xe(t,n,r,i,s,o,a,c,u,l,h,f,d,p,g)}}}}}function W0(){let e=mt[D++],t;if(e<192)t=e-160;else switch(e){case 217:t=mt[D++];break;case 218:t=Yt.getUint16(D),D+=2;break;case 219:t=Yt.getUint32(D),D+=4;break;default:throw new Error("Expected string")}return Io(t)}function Yu(e){return he.copyBuffers?Uint8Array.prototype.slice.call(mt,D,D+=e):mt.subarray(D,D+=e)}function qi(e){let t=mt[D++];if(_n[t]){let n;return _n[t](mt.subarray(D,n=D+=e),r=>{D=r;try{return Ne()}finally{D=n}})}else throw new Error("Unknown extension type "+t)}var G0=new Array(4096);function H0(){let e=mt[D++];if(e>=160&&e<192){if(e=e-160,Tr>=D)return ki.slice(D-Gn,(D+=e)-Gn);if(!(Tr==0&&Wn<180))return Gu(e)}else return D--,Y0(Ne());let t=(e<<5^(e>1?Yt.getUint16(D):e>0?mt[D]:0))&4095,n=G0[t],r=D,i=D+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Yt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=mt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return D=r,n.string;i-=3,r=D}for(n=[],G0[t]=n,n.bytes=e;r<i;)s=Yt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=mt[r++],n.push(s);let a=e<16?Hu(e):K0(e);return a!=null?n.string=a:n.string=Gu(e)}function Y0(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const V0=(e,t)=>{let n=Ne().map(Y0),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=qt[e];return i&&(i.isShared||xi)&&((qt.restoreStructures||(qt.restoreStructures=[]))[e]=i),qt[e]=n,n.read=Wu(n,r),n.read()};_n[0]=()=>{},_n[0].noBuffer=!0,_n[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let $k={Error,TypeError,ReferenceError};_n[101]=()=>{let e=Ne();return($k[e[0]]||Error)(e[1],{cause:e[2]})},_n[105]=e=>{if(he.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Yt.getUint32(D-4);Xr||(Xr=new Map);let n=mt[D],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Xr.set(t,i);let s=Ne();return i.used?Object.assign(r,s):(i.target=s,s)},_n[112]=e=>{if(he.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Yt.getUint32(D-4),n=Xr.get(t);return n.used=!0,n.target},_n[115]=()=>new Set(Ne());const q0=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let jk=typeof globalThis=="object"?globalThis:window;_n[116]=e=>{let t=e[0],n=q0[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new jk[n](Uint8Array.prototype.slice.call(e,1).buffer)},_n[120]=()=>{let e=Ne();return new RegExp(e[0],e[1])};const zk=[];_n[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=D;return D+=t-e.length,qe=zk,qe=[W0(),W0()],qe.position0=0,qe.position1=0,qe.postBundlePosition=D,D=n,Ne()},_n[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function X0(e){let t=Wn,n=D,r=Gn,i=Tr,s=ki,o=Xr,a=qe,c=new Uint8Array(mt.slice(0,Wn)),u=qt,l=qt.slice(0,qt.length),h=he,f=xi,d=e();return Wn=t,D=n,Gn=r,Tr=i,ki=s,Xr=o,qe=a,mt=c,xi=f,qt=u,qt.splice(0,qt.length,...l),he=h,Yt=new DataView(mt.buffer,mt.byteOffset,mt.byteLength),d}function Vu(){mt=null,Xr=null,qt=null}const qu=new Array(147);for(let e=0;e<256;e++)qu[e]=+("1e"+Math.floor(45.15-e*.30103));var ic=new Ro({useRecords:!1});const Kk=ic.unpack;ic.unpackMultiple,ic.unpack;let Wk=new Float32Array(1);new Uint8Array(Wk.buffer,0,4);let sc;try{sc=new TextEncoder}catch{}let Xu,J0;const oc=typeof Je<"u",ac=oc?function(e){return Je.allocUnsafeSlow(e)}:Uint8Array,Z0=oc?Je:Uint8Array,Q0=oc?4294967296:2144337920;let V,No,fe,z=0,un,be=null,Gk;const Hk=21760,Yk=/[\u0080-\uFFFF]/,Ms=Symbol("record-id");class Vk extends Ro{constructor(t){super(t),this.offset=0;let n,r,i,s,o=Z0.prototype.utf8Write?function(S,_){return V.utf8Write(S,_,V.byteLength-_)}:sc&&sc.encodeInto?function(S,_){return sc.encodeInto(S,V.subarray(_)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let f=l>32||h+l>64,d=l+64,p=l+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],w=0,b=0;this.pack=this.encode=function(S,_){if(V||(V=new ac(8192),fe=V.dataView||(V.dataView=new DataView(V.buffer,0,8192)),z=0),un=V.length-10,un-z<2048?(V=new ac(V.length),fe=V.dataView||(V.dataView=new DataView(V.buffer,0,V.length)),un=V.length-10,z=0):z=z+7&2147483640,n=z,_&ex&&(z+=_&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof S!="string"?(be=[],be.size=1/0):be=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let J=i.sharedLength||0;if(J>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let j=0;j<J;j++){let ht=i[j];if(!ht)continue;let Q,ut=i.transitions;for(let G=0,$=ht.length;G<$;G++){let yt=ht[G];Q=ut[yt],Q||(Q=ut[yt]=Object.create(null)),ut=Q}ut[Ms]=j+64}this.lastNamedStructuresLength=J}c||(i.nextId=J+64)}r&&(r=!1);let B;try{a.randomAccessStructure&&S&&S.constructor&&S.constructor===Object?U(S):N(S);let J=be;if(be&&nm(n,N,0),s&&s.idsToInsert){let j=s.idsToInsert.sort((G,$)=>G.offset>$.offset?1:-1),ht=j.length,Q=-1;for(;J&&ht>0;){let G=j[--ht].offset+n;G<J.stringsPosition+n&&Q===-1&&(Q=0),G>J.position+n?Q>=0&&(Q+=6):(Q>=0&&(fe.setUint32(J.position+n,fe.getUint32(J.position+n)+Q),Q=-1),J=J.previous,ht++)}Q>=0&&J&&fe.setUint32(J.position+n,fe.getUint32(J.position+n)+Q),z+=j.length*6,z>un&&M(z),a.offset=z;let ut=Xk(V.subarray(n,z),j);return s=null,ut}return a.offset=z,_&Qk?(V.start=n,V.end=z,V):V.subarray(n,z)}catch(J){throw B=J,J}finally{if(i&&(k(),r&&a.saveStructures)){let J=i.sharedLength||0,j=V.subarray(n,z),ht=Jk(i,a);if(!B)return a.saveStructures(ht,ht.isCompatible)===!1?a.pack(S,_):(a.lastNamedStructuresLength=J,V.length>1073741824&&(V=null),j)}V.length>1073741824&&(V=null),_&tx&&(z=n)}};const k=()=>{b<10&&b++;let S=i.sharedLength||0;if(i.length>S&&!c&&(i.length=S),w>1e4)i.transitions=null,b=0,w=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let _=0,B=g.length;_<B;_++)g[_][Ms]=0;g=[]}},v=S=>{var _=S.length;_<16?V[z++]=144|_:_<65536?(V[z++]=220,V[z++]=_>>8,V[z++]=_&255):(V[z++]=221,fe.setUint32(z,_),z+=4);for(let B=0;B<_;B++)N(S[B])},N=S=>{z>un&&(V=M(z));var _=typeof S,B;if(_==="string"){let J=S.length;if(be&&J>=4&&J<4096){if((be.size+=J)>Hk){let ut,G=(be[0]?be[0].length*3+be[1].length:0)+10;z+G>un&&(V=M(z+G));let $;be.position?($=be,V[z]=200,z+=3,V[z++]=98,ut=z-n,z+=4,nm(n,N,0),fe.setUint16(ut+n-3,z-n-ut)):(V[z++]=214,V[z++]=98,ut=z-n,z+=4),be=["",""],be.previous=$,be.size=0,be.position=ut}let Q=Yk.test(S);be[Q?0:1]+=S,V[z++]=193,N(Q?-J:J);return}let j;J<32?j=1:J<256?j=2:J<65536?j=3:j=5;let ht=J*3;if(z+ht>un&&(V=M(z+ht)),J<64||!o){let Q,ut,G,$=z+j;for(Q=0;Q<J;Q++)ut=S.charCodeAt(Q),ut<128?V[$++]=ut:ut<2048?(V[$++]=ut>>6|192,V[$++]=ut&63|128):(ut&64512)===55296&&((G=S.charCodeAt(Q+1))&64512)===56320?(ut=65536+((ut&1023)<<10)+(G&1023),Q++,V[$++]=ut>>18|240,V[$++]=ut>>12&63|128,V[$++]=ut>>6&63|128,V[$++]=ut&63|128):(V[$++]=ut>>12|224,V[$++]=ut>>6&63|128,V[$++]=ut&63|128);B=$-z-j}else B=o(S,z+j);B<32?V[z++]=160|B:B<256?(j<2&&V.copyWithin(z+2,z+1,z+1+B),V[z++]=217,V[z++]=B):B<65536?(j<3&&V.copyWithin(z+3,z+2,z+2+B),V[z++]=218,V[z++]=B>>8,V[z++]=B&255):(j<5&&V.copyWithin(z+5,z+3,z+3+B),V[z++]=219,fe.setUint32(z,B),z+=4),z+=B}else if(_==="number")if(S>>>0===S)S<32||S<128&&this.useRecords===!1||S<64&&!this.randomAccessStructure?V[z++]=S:S<256?(V[z++]=204,V[z++]=S):S<65536?(V[z++]=205,V[z++]=S>>8,V[z++]=S&255):(V[z++]=206,fe.setUint32(z,S),z+=4);else if(S>>0===S)S>=-32?V[z++]=256+S:S>=-128?(V[z++]=208,V[z++]=S+256):S>=-32768?(V[z++]=209,fe.setInt16(z,S),z+=2):(V[z++]=210,fe.setInt32(z,S),z+=4);else{let J;if((J=this.useFloat32)>0&&S<4294967296&&S>=-2147483648){V[z++]=202,fe.setFloat32(z,S);let j;if(J<4||(j=S*qu[(V[z]&127)<<1|V[z+1]>>7])>>0===j){z+=4;return}else z--}V[z++]=203,fe.setFloat64(z,S),z+=8}else if(_==="object"||_==="function")if(!S)V[z++]=192;else{if(s){let j=s.get(S);if(j){if(!j.id){let ht=s.idsToInsert||(s.idsToInsert=[]);j.id=ht.push(j)}V[z++]=214,V[z++]=112,fe.setUint32(z,j.id),z+=4;return}else s.set(S,{offset:z-n})}let J=S.constructor;if(J===Object)W(S);else if(J===Array)v(S);else if(J===Map)if(this.mapAsEmptyObject)V[z++]=128;else{B=S.size,B<16?V[z++]=128|B:B<65536?(V[z++]=222,V[z++]=B>>8,V[z++]=B&255):(V[z++]=223,fe.setUint32(z,B),z+=4);for(let[j,ht]of S)N(j),N(ht)}else{for(let j=0,ht=Xu.length;j<ht;j++){let Q=J0[j];if(S instanceof Q){let ut=Xu[j];if(ut.write){ut.type&&(V[z++]=212,V[z++]=ut.type,V[z++]=0);let at=ut.write.call(this,S);at===S?Array.isArray(S)?v(S):W(S):N(at);return}let G=V,$=fe,yt=z;V=null;let st;try{st=ut.pack.call(this,S,at=>(V=G,G=null,z+=at,z>un&&M(z),{target:V,targetView:fe,position:z-at}),N)}finally{G&&(V=G,fe=$,z=yt,un=V.length-10)}st&&(st.length+z>un&&M(st.length+z),z=qk(st,V,z,ut.type));return}}if(Array.isArray(S))v(S);else{if(S.toJSON){const j=S.toJSON();if(j!==S)return N(j)}if(_==="function")return N(this.writeFunction&&this.writeFunction(S));W(S)}}}else if(_==="boolean")V[z++]=S?195:194;else if(_==="bigint"){if(S<BigInt(1)<<BigInt(63)&&S>=-(BigInt(1)<<BigInt(63)))V[z++]=211,fe.setBigInt64(z,S);else if(S<BigInt(1)<<BigInt(64)&&S>0)V[z++]=207,fe.setBigUint64(z,S);else if(this.largeBigIntToFloat)V[z++]=203,fe.setFloat64(z,Number(S));else{if(this.largeBigIntToString)return N(S.toString());if(this.useBigIntExtension&&S<BigInt(2)**BigInt(1023)&&S>-(BigInt(2)**BigInt(1023))){V[z++]=199,z++,V[z++]=66;let J=[],j;do{let ht=S&BigInt(255);j=(ht&BigInt(128))===(S<BigInt(0)?BigInt(128):BigInt(0)),J.push(ht),S>>=BigInt(8)}while(!((S===BigInt(0)||S===BigInt(-1))&&j));V[z-2]=J.length;for(let ht=J.length;ht>0;)V[z++]=Number(J[--ht]);return}else throw new RangeError(S+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}z+=8}else if(_==="undefined")this.encodeUndefinedAsNil?V[z++]=192:(V[z++]=212,V[z++]=0,V[z++]=0);else throw new Error("Unknown type: "+_)},P=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?S=>{let _;if(this.skipValues){_=[];for(let j in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(j))&&!this.skipValues.includes(S[j])&&_.push(j)}else _=Object.keys(S);let B=_.length;B<16?V[z++]=128|B:B<65536?(V[z++]=222,V[z++]=B>>8,V[z++]=B&255):(V[z++]=223,fe.setUint32(z,B),z+=4);let J;if(this.coercibleKeyAsNumber)for(let j=0;j<B;j++){J=_[j];let ht=Number(J);N(isNaN(ht)?J:ht),N(S[J])}else for(let j=0;j<B;j++)N(J=_[j]),N(S[J])}:S=>{V[z++]=222;let _=z-n;z+=2;let B=0;for(let J in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(J))&&(N(J),N(S[J]),B++);if(B>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');V[_+++n]=B>>8,V[_+n]=B&255},L=this.useRecords===!1?P:t.progressiveRecords&&!f?S=>{let _,B=i.transitions||(i.transitions=Object.create(null)),J=z++-n,j;for(let ht in S)if(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ht)){if(_=B[ht],_)B=_;else{let Q=Object.keys(S),ut=B;B=i.transitions;let G=0;for(let $=0,yt=Q.length;$<yt;$++){let st=Q[$];_=B[st],_||(_=B[st]=Object.create(null),G++),B=_}J+n+1==z?(z--,et(B,Q,G)):pt(B,Q,J,G),j=!0,B=ut[ht]}N(S[ht])}if(!j){let ht=B[Ms];ht?V[J+n]=ht:pt(B,Object.keys(S),J,0)}}:S=>{let _,B=i.transitions||(i.transitions=Object.create(null)),J=0;for(let ht in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ht))&&(_=B[ht],_||(_=B[ht]=Object.create(null),J++),B=_);let j=B[Ms];j?j>=96&&f?(V[z++]=((j-=96)&31)+96,V[z++]=j>>5):V[z++]=j:et(B,B.__keys__||Object.keys(S),J);for(let ht in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ht))&&N(S[ht])},C=typeof this.useRecords=="function"&&this.useRecords,W=C?S=>{C(S)?L(S):P(S)}:L,M=S=>{let _;if(S>16777216){if(S-n>Q0)throw new Error("Packed buffer would be larger than maximum buffer size");_=Math.min(Q0,Math.round(Math.max((S-n)*(S>67108864?1.25:2),4194304)/4096)*4096)}else _=(Math.max(S-n<<2,V.length-1)>>12)+1<<12;let B=new ac(_);return fe=B.dataView||(B.dataView=new DataView(B.buffer,0,_)),S=Math.min(S,V.length),V.copy?V.copy(B,0,n,S):B.set(V.slice(n,S)),z-=n,n=0,un=B.length-10,V=B},et=(S,_,B)=>{let J=i.nextId;J||(J=64),J<d&&this.shouldShareStructure&&!this.shouldShareStructure(_)?(J=i.nextOwnId,J<p||(J=d),i.nextOwnId=J+1):(J>=p&&(J=d),i.nextId=J+1);let j=_.highByte=J>=96&&f?J-96>>5:-1;S[Ms]=J,S.__keys__=_,i[J-64]=_,J<d?(_.isShared=!0,i.sharedLength=J-63,r=!0,j>=0?(V[z++]=(J&31)+96,V[z++]=j):V[z++]=J):(j>=0?(V[z++]=213,V[z++]=114,V[z++]=(J&31)+96,V[z++]=j):(V[z++]=212,V[z++]=114,V[z++]=J),B&&(w+=b*B),g.length>=h&&(g.shift()[Ms]=0),g.push(S),N(_))},pt=(S,_,B,J)=>{let j=V,ht=z,Q=un,ut=n;V=No,z=0,n=0,V||(No=V=new ac(8192)),un=V.length-10,et(S,_,J),No=V;let G=z;if(V=j,z=ht,un=Q,n=ut,G>1){let $=z+G-1;$>un&&M($);let yt=B+n;V.copyWithin(yt+G,yt+1,z),V.set(No.slice(0,G),yt),z=$}else V[B+n]=No[0]},U=S=>{let _=Gk(S,V,n,z,i,M,(B,J,j)=>{if(j)return r=!0;z=J;let ht=V;return N(B),k(),ht!==V?{position:z,targetView:fe,target:V}:z},this);if(_===0)return W(S);z=_}}useBuffer(t){V=t,V.dataView||(V.dataView=new DataView(V.buffer,V.byteOffset,V.byteLength)),z=0}set position(t){z=t}get position(){return z}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}J0=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,M0],Xu=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?tm(e,16,t):em(oc?Je.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==Z0&&this.moreTypes?tm(e,q0.indexOf(n.name),t):em(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function tm(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function em(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function qk(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function Xk(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function nm(e,t,n){if(be.length>0){fe.setUint32(be.position+e,z+n-be.position-e),be.stringsPosition=z-e;let r=be;be=null,t(r[0]),t(r[1])}}function Jk(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let rm=new Vk({useRecords:!1});const Zk=rm.pack;rm.pack;const Qk=512,tx=1024,ex=2048;function Oe(){return null}function Us(e,t,n={}){if(!T(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];T(c)&&(a=c(a));const u=t[o];T(u)&&(o=u),a!==null&&r.push(o,a)}return r}function Oo(e,t,n={}){if(T(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];T(a)&&(s=a);const c=n[s];T(c)&&(o=c(o)),r[s]=o}return r}catch(r){ae(H,"binary",r.message)}}function nx(e){try{const t=ur(e);return Zk(t)}catch(t){ae(H,"binary",t.message)}}function rx(e){try{return Kk(e)}catch(t){ae(H,"binary",t.message)}}function im(){return{id:Re()}}var cc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e))(cc||{});function lc(e){return T(e==null?void 0:e.id)?Us(e,cc,{category:Oe,kinddata:Oe,stopped:Oe,removed:Oe,bucket:Oe}):Us(e,cc,{id:Oe,x:Oe,y:Oe,lx:Oe,ly:Oe,code:Oe,category:Oe,kinddata:Oe,stopped:Oe,removed:Oe,bucket:Oe})}function uc(e){return Oo(e,cc)}function Ju(e){var t;return((t=e==null?void 0:e.id)==null?void 0:t.length)??!1}function hc(e,t){if(!T(e)||!Cn(t))return;const{color:n,bg:r}=v0(t);T(n)&&(e.color=n),T(r)&&(e.bg=r)}function Ai(e){var t;return Bt((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function sm(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function om(e){const t=Math.floor(e.length/qa);if(t*qa!==e.length){ae(H,"size","wrong number of bytes for a palette");return}const n=sm(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function ix(e,t){return e&1<<t?255:0}function am(e){const t=Math.floor(e.length/$u);if(t*$u!==e.length){ae(H,"size","wrong number of bytes for a charset");return}const n=Math.ceil(t/Za),r=Xa*Za,i=sm(r,Ja*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const u=o*Ja+a,l=e[c];for(let h=0;h<Xa;++h){const f=s*Xa+h;i.bits[f+u*r]=ix(l,7-h)}++a,a===Ja&&(a=0,++s,s===Za&&(s=0,++o))}return i}const sx=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,126,0,0,0,0,0,126,255,219,255,255,195,231,255,126,0,0,0,0,0,0,108,254,254,254,254,124,56,16,0,0,0,0,0,0,16,56,124,254,124,56,16,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,30,14,26,50,120,204,204,204,120,0,0,0,0,0,60,102,102,102,60,24,126,24,24,0,0,0,0,0,63,51,63,48,48,48,112,240,224,0,0,0,0,0,127,99,127,99,99,99,103,231,230,192,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,128,192,224,248,254,248,224,192,128,0,0,0,0,0,2,6,14,62,254,62,14,6,2,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,102,102,102,102,102,102,0,102,102,0,0,0,0,0,127,219,219,219,123,27,27,27,27,0,0,0,0,124,198,96,56,108,198,198,108,56,12,198,124,0,0,0,0,0,0,0,0,0,254,254,254,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,24,60,126,24,24,24,24,24,24,0,0,0,0,0,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,24,12,254,12,24,0,0,0,0,0,0,0,0,0,48,96,254,96,48,0,0,0,0,0,0,0,0,0,0,192,192,192,254,0,0,0,0,0,0,0,0,0,40,108,254,108,40,0,0,0,0,0,0,0,0,16,56,56,124,124,254,254,0,0,0,0,0,0,0,254,254,124,124,56,56,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,24,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,108,108,254,108,108,0,0,0,24,24,124,198,194,192,124,6,134,198,124,24,24,0,0,0,0,0,194,198,12,24,48,102,198,0,0,0,0,0,56,108,108,56,118,220,204,204,118,0,0,0,0,48,48,48,96,0,0,0,0,0,0,0,0,0,0,0,12,24,48,48,48,48,48,24,12,0,0,0,0,0,48,24,12,12,12,12,12,24,48,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,48,0,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,2,6,12,24,48,96,192,128,0,0,0,0,0,0,124,198,206,222,246,230,198,198,124,0,0,0,0,0,24,56,120,24,24,24,24,24,126,0,0,0,0,0,124,198,6,12,24,48,96,198,254,0,0,0,0,0,124,198,6,6,60,6,6,198,124,0,0,0,0,0,12,28,60,108,204,254,12,12,30,0,0,0,0,0,254,192,192,192,252,6,6,198,124,0,0,0,0,0,56,96,192,192,252,198,198,198,124,0,0,0,0,0,254,198,6,12,24,48,48,48,48,0,0,0,0,0,124,198,198,198,124,198,198,198,124,0,0,0,0,0,124,198,198,198,126,6,6,12,120,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,24,24,0,0,0,24,24,48,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,124,198,198,12,24,24,0,24,24,0,0,0,0,0,124,198,198,222,222,222,220,192,124,0,0,0,0,0,16,56,108,198,198,254,198,198,198,0,0,0,0,0,252,102,102,102,124,102,102,102,252,0,0,0,0,0,60,102,194,192,192,192,194,102,60,0,0,0,0,0,248,108,102,102,102,102,102,108,248,0,0,0,0,0,254,102,98,104,120,104,98,102,254,0,0,0,0,0,254,102,98,104,120,104,96,96,240,0,0,0,0,0,60,102,194,192,192,222,198,102,58,0,0,0,0,0,198,198,198,198,254,198,198,198,198,0,0,0,0,0,60,24,24,24,24,24,24,24,60,0,0,0,0,0,30,12,12,12,12,12,204,204,120,0,0,0,0,0,230,102,108,108,120,108,108,102,230,0,0,0,0,0,240,96,96,96,96,96,98,102,254,0,0,0,0,0,198,238,254,254,214,198,198,198,198,0,0,0,0,0,198,230,246,254,222,206,198,198,198,0,0,0,0,0,56,108,198,198,198,198,198,108,56,0,0,0,0,0,252,102,102,102,124,96,96,96,240,0,0,0,0,0,124,198,198,198,198,214,222,124,12,14,0,0,0,0,252,102,102,102,124,108,102,102,230,0,0,0,0,0,124,198,198,96,56,12,198,198,124,0,0,0,0,0,126,126,90,24,24,24,24,24,60,0,0,0,0,0,198,198,198,198,198,198,198,198,124,0,0,0,0,0,198,198,198,198,198,198,108,56,16,0,0,0,0,0,198,198,198,198,214,214,254,124,108,0,0,0,0,0,198,198,108,56,56,56,108,198,198,0,0,0,0,0,102,102,102,102,60,24,24,24,60,0,0,0,0,0,254,198,140,24,48,96,194,198,254,0,0,0,0,0,60,48,48,48,48,48,48,48,60,0,0,0,0,0,128,192,224,112,56,28,14,6,2,0,0,0,0,0,60,12,12,12,12,12,12,12,60,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,12,124,204,204,118,0,0,0,0,0,224,96,96,120,108,102,102,102,124,0,0,0,0,0,0,0,0,124,198,192,192,198,124,0,0,0,0,0,28,12,12,60,108,204,204,204,118,0,0,0,0,0,0,0,0,124,198,254,192,198,124,0,0,0,0,0,56,108,100,96,240,96,96,96,240,0,0,0,0,0,0,0,0,118,204,204,204,124,12,204,120,0,0,0,224,96,96,108,118,102,102,102,230,0,0,0,0,0,24,24,0,56,24,24,24,24,60,0,0,0,0,0,6,6,0,14,6,6,6,6,102,102,60,0,0,0,224,96,96,102,108,120,108,102,230,0,0,0,0,0,56,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,236,254,214,214,214,198,0,0,0,0,0,0,0,0,220,102,102,102,102,102,0,0,0,0,0,0,0,0,124,198,198,198,198,124,0,0,0,0,0,0,0,0,220,102,102,102,124,96,96,240,0,0,0,0,0,0,118,204,204,204,124,12,12,30,0,0,0,0,0,0,220,118,102,96,96,240,0,0,0,0,0,0,0,0,124,198,112,28,198,124,0,0,0,0,0,16,48,48,252,48,48,48,54,28,0,0,0,0,0,0,0,0,204,204,204,204,204,118,0,0,0,0,0,0,0,0,102,102,102,102,60,24,0,0,0,0,0,0,0,0,198,198,214,214,254,108,0,0,0,0,0,0,0,0,198,108,56,56,108,198,0,0,0,0,0,0,0,0,198,198,198,198,126,6,12,248,0,0,0,0,0,0,254,204,24,48,102,254,0,0,0,0,0,14,24,24,24,112,24,24,24,14,0,0,0,0,0,24,24,24,24,0,24,24,24,24,0,0,0,0,0,112,24,24,24,14,24,24,24,112,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,60,102,194,192,192,194,102,60,12,6,124,0,0,0,204,204,0,204,204,204,204,204,118,0,0,0,0,12,24,48,0,124,198,254,192,198,124,0,0,0,0,16,56,108,0,120,12,124,204,204,118,0,0,0,0,0,204,204,0,120,12,124,204,204,118,0,0,0,0,96,48,24,0,120,12,124,204,204,118,0,0,0,0,56,108,56,0,120,12,124,204,204,118,0,0,0,0,0,0,0,60,102,96,102,60,12,6,60,0,0,0,16,56,108,0,124,198,254,192,198,124,0,0,0,0,0,204,204,0,124,198,254,192,198,124,0,0,0,0,96,48,24,0,124,198,254,192,198,124,0,0,0,0,0,102,102,0,56,24,24,24,24,60,0,0,0,0,24,60,102,0,56,24,24,24,24,60,0,0,0,0,96,48,24,0,56,24,24,24,24,60,0,0,0,0,198,198,16,56,108,198,198,254,198,198,0,0,0,56,108,56,0,56,108,198,198,254,198,198,0,0,0,24,48,96,0,254,102,96,124,96,102,254,0,0,0,0,0,0,0,204,118,54,126,216,216,110,0,0,0,0,0,62,108,204,204,254,204,204,204,206,0,0,0,0,16,56,108,0,124,198,198,198,198,124,0,0,0,0,0,198,198,0,124,198,198,198,198,124,0,0,0,0,96,48,24,0,124,198,198,198,198,124,0,0,0,0,48,120,204,0,204,204,204,204,204,118,0,0,0,0,96,48,24,0,204,204,204,204,204,118,0,0,0,0,0,198,198,0,198,198,198,198,126,6,12,120,0,0,198,198,56,108,198,198,198,198,108,56,0,0,0,0,198,198,0,198,198,198,198,198,198,124,0,0,0,0,24,24,60,102,96,96,102,60,24,24,0,0,0,0,56,108,100,96,240,96,96,96,230,252,0,0,0,0,0,102,102,60,24,126,24,126,24,24,0,0,0,0,248,204,204,248,196,204,222,204,204,198,0,0,0,0,14,27,24,24,24,126,24,24,24,24,216,112,0,0,24,48,96,0,120,12,124,204,204,118,0,0,0,0,12,24,48,0,56,24,24,24,24,60,0,0,0,0,24,48,96,0,124,198,198,198,198,124,0,0,0,0,24,48,96,0,204,204,204,204,204,118,0,0,0,0,0,118,220,0,220,102,102,102,102,102,0,0,0,118,220,0,198,230,246,254,222,206,198,198,0,0,0,0,60,108,108,62,0,126,0,0,0,0,0,0,0,0,56,108,108,56,0,124,0,0,0,0,0,0,0,0,0,48,48,0,48,48,96,198,198,124,0,0,0,0,0,0,0,0,0,254,192,192,192,0,0,0,0,0,0,0,0,0,0,254,6,6,6,0,0,0,0,0,192,192,198,204,216,48,96,220,134,12,24,62,0,0,192,192,198,204,216,48,102,206,158,62,6,6,0,0,0,24,24,0,24,24,60,60,60,24,0,0,0,0,0,0,0,54,108,216,108,54,0,0,0,0,0,0,0,0,0,216,108,54,108,216,0,0,0,0,0,17,68,17,68,17,68,17,68,17,68,17,68,17,68,85,170,85,170,85,170,85,170,85,170,85,170,85,170,221,119,221,119,221,119,221,119,221,119,221,119,221,119,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,248,24,24,24,24,24,24,24,24,24,24,24,248,24,248,24,24,24,24,24,24,54,54,54,54,54,54,54,246,54,54,54,54,54,54,0,0,0,0,0,0,0,254,54,54,54,54,54,54,0,0,0,0,0,248,24,248,24,24,24,24,24,24,54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54,54,54,54,246,6,254,0,0,0,0,0,0,54,54,54,54,54,54,54,254,0,0,0,0,0,0,24,24,24,24,24,248,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,248,24,24,24,24,24,24,24,24,24,24,24,24,24,31,0,0,0,0,0,0,24,24,24,24,24,24,24,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,24,24,24,24,24,24,24,24,24,24,24,24,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,255,0,0,0,0,0,0,24,24,24,24,24,24,24,255,24,24,24,24,24,24,24,24,24,24,24,31,24,31,24,24,24,24,24,24,54,54,54,54,54,54,54,55,54,54,54,54,54,54,54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54,54,54,54,55,48,55,54,54,54,54,54,54,0,0,0,0,0,255,0,255,0,0,0,0,0,0,54,54,54,54,54,247,0,247,54,54,54,54,54,54,24,24,24,24,24,255,0,255,0,0,0,0,0,0,54,54,54,54,54,54,54,255,0,0,0,0,0,0,0,0,0,0,0,255,0,255,24,24,24,24,24,24,0,0,0,0,0,0,0,255,54,54,54,54,54,54,54,54,54,54,54,54,54,63,0,0,0,0,0,0,24,24,24,24,24,31,24,31,0,0,0,0,0,0,0,0,0,0,0,31,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,63,54,54,54,54,54,54,54,54,54,54,54,54,54,255,54,54,54,54,54,54,24,24,24,24,24,255,24,255,24,24,24,24,24,24,24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,31,24,24,24,24,24,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,118,220,216,216,220,118,0,0,0,0,0,0,0,124,198,252,198,198,252,192,192,64,0,0,0,254,198,198,192,192,192,192,192,192,0,0,0,0,0,0,0,254,108,108,108,108,108,108,0,0,0,0,0,254,198,96,48,24,48,96,198,254,0,0,0,0,0,0,0,0,126,216,216,216,216,112,0,0,0,0,0,0,0,102,102,102,102,124,96,96,192,0,0,0,0,0,0,118,220,24,24,24,24,24,0,0,0,0,0,126,24,60,102,102,102,60,24,126,0,0,0,0,0,56,108,198,198,254,198,198,108,56,0,0,0,0,0,56,108,198,198,198,108,108,108,238,0,0,0,0,0,30,48,24,12,62,102,102,102,60,0,0,0,0,0,0,0,0,126,219,219,126,0,0,0,0,0,0,0,3,6,126,219,219,243,126,96,192,0,0,0,0,0,28,48,96,96,124,96,96,48,28,0,0,0,0,0,0,124,198,198,198,198,198,198,198,0,0,0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,216,216,112,0,0,0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0,56,108,108,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,15,12,12,12,12,12,236,108,60,28,0,0,0,0,216,108,108,108,108,108,0,0,0,0,0,0,0,0,112,216,48,96,200,248,0,0,0,0,0,0,0,0,0,0,0,124,124,124,124,124,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),ox=new Uint8Array([0,0,0,0,0,42,0,42,0,0,42,42,42,0,0,42,0,42,42,21,0,42,42,42,21,21,21,21,21,63,21,63,21,21,63,63,63,21,21,63,21,63,63,63,21,63,63,63]);var cm=typeof ws=="object"&&ws&&ws.Object===Object&&ws,ax=typeof self=="object"&&self&&self.Object===Object&&self,kr=cm||ax||Function("return this")(),Hn=kr.Symbol,lm=Object.prototype,cx=lm.hasOwnProperty,lx=lm.toString,Co=Hn?Hn.toStringTag:void 0;function ux(e){var t=cx.call(e,Co),n=e[Co];try{e[Co]=void 0;var r=!0}catch{}var i=lx.call(e);return r&&(t?e[Co]=n:delete e[Co]),i}var hx=Object.prototype,fx=hx.toString;function dx(e){return fx.call(e)}var px="[object Null]",mx="[object Undefined]",um=Hn?Hn.toStringTag:void 0;function vi(e){return e==null?e===void 0?mx:px:um&&um in Object(e)?ux(e):dx(e)}function er(e){return e!=null&&typeof e=="object"}var gx="[object Symbol]";function fc(e){return typeof e=="symbol"||er(e)&&vi(e)==gx}function dc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var Jt=Array.isArray,yx=1/0,hm=Hn?Hn.prototype:void 0,fm=hm?hm.toString:void 0;function dm(e){if(typeof e=="string")return e;if(Jt(e))return dc(e,dm)+"";if(fc(e))return fm?fm.call(e):"";var t=e+"";return t=="0"&&1/e==-yx?"-0":t}var _x=/\s/;function Ex(e){for(var t=e.length;t--&&_x.test(e.charAt(t)););return t}var bx=/^\s+/;function wx(e){return e&&e.slice(0,Ex(e)+1).replace(bx,"")}function Yn(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var pm=NaN,Tx=/^[-+]0x[0-9a-f]+$/i,kx=/^0b[01]+$/i,xx=/^0o[0-7]+$/i,Ax=parseInt;function vx(e){if(typeof e=="number")return e;if(fc(e))return pm;if(Yn(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Yn(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=wx(e);var n=kx.test(e);return n||xx.test(e)?Ax(e.slice(2),n?2:8):Tx.test(e)?pm:+e}var mm=1/0,Sx=17976931348623157e292;function Rx(e){if(!e)return e===0?e:0;if(e=vx(e),e===mm||e===-mm){var t=e<0?-1:1;return t*Sx}return e===e?e:0}function pc(e){var t=Rx(e),n=t%1;return t===t?n?t-n:t:0}function Ps(e){return e}var Ix="[object AsyncFunction]",Nx="[object Function]",Ox="[object GeneratorFunction]",Cx="[object Proxy]";function Jr(e){if(!Yn(e))return!1;var t=vi(e);return t==Nx||t==Ox||t==Ix||t==Cx}var Zu=kr["__core-js_shared__"],gm=function(){var e=/[^.]+$/.exec(Zu&&Zu.keys&&Zu.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Lx(e){return!!gm&&gm in e}var Mx=Function.prototype,Ux=Mx.toString;function Xi(e){if(e!=null){try{return Ux.call(e)}catch{}try{return e+""}catch{}}return""}var Px=/[\\^$.*+?()[\]{}|]/g,Bx=/^\[object .+?Constructor\]$/,Fx=Function.prototype,Dx=Object.prototype,$x=Fx.toString,jx=Dx.hasOwnProperty,zx=RegExp("^"+$x.call(jx).replace(Px,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Kx(e){if(!Yn(e)||Lx(e))return!1;var t=Jr(e)?zx:Bx;return t.test(Xi(e))}function Wx(e,t){return e==null?void 0:e[t]}function Ji(e,t){var n=Wx(e,t);return Kx(n)?n:void 0}var Qu=Ji(kr,"WeakMap"),ym=Object.create,Gx=function(){function e(){}return function(t){if(!Yn(t))return{};if(ym)return ym(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function Hx(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function $e(){}function Yx(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var Vx=800,qx=16,Xx=Date.now;function Jx(e){var t=0,n=0;return function(){var r=Xx(),i=qx-(r-n);if(n=r,i>0){if(++t>=Vx)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function Zx(e){return function(){return e}}var mc=function(){try{var e=Ji(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Qx=mc?function(e,t){return mc(e,"toString",{configurable:!0,enumerable:!1,value:Zx(t),writable:!0})}:Ps,tA=Jx(Qx);function _m(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Em(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function eA(e){return e!==e}function nA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function th(e,t,n){return t===t?nA(e,t,n):Em(e,eA,n)}function bm(e,t){var n=e==null?0:e.length;return!!n&&th(e,t,0)>-1}var rA=9007199254740991,iA=/^(?:0|[1-9]\d*)$/;function gc(e,t){var n=typeof e;return t=t??rA,!!t&&(n=="number"||n!="symbol"&&iA.test(e))&&e>-1&&e%1==0&&e<t}function eh(e,t,n){t=="__proto__"&&mc?mc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Lo(e,t){return e===t||e!==e&&t!==t}var sA=Object.prototype,oA=sA.hasOwnProperty;function yc(e,t,n){var r=e[t];(!(oA.call(e,t)&&Lo(r,n))||n===void 0&&!(t in e))&&eh(e,t,n)}function nh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?eh(n,a,c):yc(n,a,c)}return n}var wm=Math.max;function aA(e,t,n){return t=wm(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=wm(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),Hx(e,this,a)}}function rh(e,t){return tA(aA(e,t,Ps),e+"")}var cA=9007199254740991;function ih(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=cA}function xr(e){return e!=null&&ih(e.length)&&!Jr(e)}function Tm(e,t,n){if(!Yn(n))return!1;var r=typeof t;return(r=="number"?xr(n)&&gc(t,n.length):r=="string"&&t in n)?Lo(n[t],e):!1}function lA(e){return rh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&Tm(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var uA=Object.prototype;function Mo(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||uA;return e===n}function hA(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var fA="[object Arguments]";function km(e){return er(e)&&vi(e)==fA}var xm=Object.prototype,dA=xm.hasOwnProperty,pA=xm.propertyIsEnumerable,_c=km(function(){return arguments}())?km:function(e){return er(e)&&dA.call(e,"callee")&&!pA.call(e,"callee")};function mA(){return!1}var Am=typeof exports=="object"&&exports&&!exports.nodeType&&exports,vm=Am&&typeof module=="object"&&module&&!module.nodeType&&module,gA=vm&&vm.exports===Am,Sm=gA?kr.Buffer:void 0,yA=Sm?Sm.isBuffer:void 0,Uo=yA||mA,_A="[object Arguments]",EA="[object Array]",bA="[object Boolean]",wA="[object Date]",TA="[object Error]",kA="[object Function]",xA="[object Map]",AA="[object Number]",vA="[object Object]",SA="[object RegExp]",RA="[object Set]",IA="[object String]",NA="[object WeakMap]",OA="[object ArrayBuffer]",CA="[object DataView]",LA="[object Float32Array]",MA="[object Float64Array]",UA="[object Int8Array]",PA="[object Int16Array]",BA="[object Int32Array]",FA="[object Uint8Array]",DA="[object Uint8ClampedArray]",$A="[object Uint16Array]",jA="[object Uint32Array]",ge={};ge[LA]=ge[MA]=ge[UA]=ge[PA]=ge[BA]=ge[FA]=ge[DA]=ge[$A]=ge[jA]=!0,ge[_A]=ge[EA]=ge[OA]=ge[bA]=ge[CA]=ge[wA]=ge[TA]=ge[kA]=ge[xA]=ge[AA]=ge[vA]=ge[SA]=ge[RA]=ge[IA]=ge[NA]=!1;function zA(e){return er(e)&&ih(e.length)&&!!ge[vi(e)]}function Ec(e){return function(t){return e(t)}}var Rm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Po=Rm&&typeof module=="object"&&module&&!module.nodeType&&module,KA=Po&&Po.exports===Rm,sh=KA&&cm.process,Si=function(){try{var e=Po&&Po.require&&Po.require("util").types;return e||sh&&sh.binding&&sh.binding("util")}catch{}}(),Im=Si&&Si.isTypedArray,oh=Im?Ec(Im):zA,WA=Object.prototype,GA=WA.hasOwnProperty;function Nm(e,t){var n=Jt(e),r=!n&&_c(e),i=!n&&!r&&Uo(e),s=!n&&!r&&!i&&oh(e),o=n||r||i||s,a=o?hA(e.length,String):[],c=a.length;for(var u in e)(t||GA.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||gc(u,c)))&&a.push(u);return a}function Om(e,t){return function(n){return e(t(n))}}var HA=Om(Object.keys,Object),YA=Object.prototype,VA=YA.hasOwnProperty;function Cm(e){if(!Mo(e))return HA(e);var t=[];for(var n in Object(e))VA.call(e,n)&&n!="constructor"&&t.push(n);return t}function Vn(e){return xr(e)?Nm(e):Cm(e)}var qA=Object.prototype,XA=qA.hasOwnProperty,En=lA(function(e,t){if(Mo(t)||xr(t)){nh(t,Vn(t),e);return}for(var n in t)XA.call(t,n)&&yc(e,n,t[n])});function JA(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var ZA=Object.prototype,QA=ZA.hasOwnProperty;function tv(e){if(!Yn(e))return JA(e);var t=Mo(e),n=[];for(var r in e)r=="constructor"&&(t||!QA.call(e,r))||n.push(r);return n}function Lm(e){return xr(e)?Nm(e,!0):tv(e)}var ev=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nv=/^\w*$/;function ah(e,t){if(Jt(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||fc(e)?!0:nv.test(e)||!ev.test(e)||t!=null&&e in Object(t)}var Bo=Ji(Object,"create");function rv(){this.__data__=Bo?Bo(null):{},this.size=0}function iv(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var sv="__lodash_hash_undefined__",ov=Object.prototype,av=ov.hasOwnProperty;function cv(e){var t=this.__data__;if(Bo){var n=t[e];return n===sv?void 0:n}return av.call(t,e)?t[e]:void 0}var lv=Object.prototype,uv=lv.hasOwnProperty;function hv(e){var t=this.__data__;return Bo?t[e]!==void 0:uv.call(t,e)}var fv="__lodash_hash_undefined__";function dv(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Bo&&t===void 0?fv:t,this}function Zi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Zi.prototype.clear=rv,Zi.prototype.delete=iv,Zi.prototype.get=cv,Zi.prototype.has=hv,Zi.prototype.set=dv;function pv(){this.__data__=[],this.size=0}function bc(e,t){for(var n=e.length;n--;)if(Lo(e[n][0],t))return n;return-1}var mv=Array.prototype,gv=mv.splice;function yv(e){var t=this.__data__,n=bc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():gv.call(t,n,1),--this.size,!0}function _v(e){var t=this.__data__,n=bc(t,e);return n<0?void 0:t[n][1]}function Ev(e){return bc(this.__data__,e)>-1}function bv(e,t){var n=this.__data__,r=bc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function Zr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Zr.prototype.clear=pv,Zr.prototype.delete=yv,Zr.prototype.get=_v,Zr.prototype.has=Ev,Zr.prototype.set=bv;var Fo=Ji(kr,"Map");function wv(){this.size=0,this.__data__={hash:new Zi,map:new(Fo||Zr),string:new Zi}}function Tv(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function wc(e,t){var n=e.__data__;return Tv(t)?n[typeof t=="string"?"string":"hash"]:n.map}function kv(e){var t=wc(this,e).delete(e);return this.size-=t?1:0,t}function xv(e){return wc(this,e).get(e)}function Av(e){return wc(this,e).has(e)}function vv(e,t){var n=wc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function Qr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Qr.prototype.clear=wv,Qr.prototype.delete=kv,Qr.prototype.get=xv,Qr.prototype.has=Av,Qr.prototype.set=vv;var Sv="Expected a function";function ch(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Sv);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(ch.Cache||Qr),n}ch.Cache=Qr;var Rv=500;function Iv(e){var t=ch(e,function(r){return n.size===Rv&&n.clear(),r}),n=t.cache;return t}var Nv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ov=/\\(\\)?/g,Cv=Iv(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Nv,function(n,r,i,s){t.push(i?s.replace(Ov,"$1"):r||n)}),t});function Mm(e){return e==null?"":dm(e)}function Tc(e,t){return Jt(e)?e:ah(e,t)?[e]:Cv(Mm(e))}var Lv=1/0;function Do(e){if(typeof e=="string"||fc(e))return e;var t=e+"";return t=="0"&&1/e==-Lv?"-0":t}function lh(e,t){t=Tc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Do(t[n++])];return n&&n==r?e:void 0}function Mv(e,t,n){var r=e==null?void 0:lh(e,t);return r===void 0?n:r}function uh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Um=Hn?Hn.isConcatSpreadable:void 0;function Uv(e){return Jt(e)||_c(e)||!!(Um&&e&&e[Um])}function hh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=Uv),i||(i=[]);++s<o;){var a=e[s];n(a)?uh(i,a):r||(i[i.length]=a)}return i}function Ln(e){var t=e==null?0:e.length;return t?hh(e):[]}var Pm=Om(Object.getPrototypeOf,Object);function fh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function Pv(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:fh(e,t,n)}var Bv="\\ud800-\\udfff",Fv="\\u0300-\\u036f",Dv="\\ufe20-\\ufe2f",$v="\\u20d0-\\u20ff",jv=Fv+Dv+$v,zv="\\ufe0e\\ufe0f",Kv="\\u200d",Wv=RegExp("["+Kv+Bv+jv+zv+"]");function Bm(e){return Wv.test(e)}function Gv(e){return e.split("")}var Fm="\\ud800-\\udfff",Hv="\\u0300-\\u036f",Yv="\\ufe20-\\ufe2f",Vv="\\u20d0-\\u20ff",qv=Hv+Yv+Vv,Xv="\\ufe0e\\ufe0f",Jv="["+Fm+"]",dh="["+qv+"]",ph="\\ud83c[\\udffb-\\udfff]",Zv="(?:"+dh+"|"+ph+")",Dm="[^"+Fm+"]",$m="(?:\\ud83c[\\udde6-\\uddff]){2}",jm="[\\ud800-\\udbff][\\udc00-\\udfff]",Qv="\\u200d",zm=Zv+"?",Km="["+Xv+"]?",t2="(?:"+Qv+"(?:"+[Dm,$m,jm].join("|")+")"+Km+zm+")*",e2=Km+zm+t2,n2="(?:"+[Dm+dh+"?",dh,$m,jm,Jv].join("|")+")",r2=RegExp(ph+"(?="+ph+")|"+n2+e2,"g");function i2(e){return e.match(r2)||[]}function s2(e){return Bm(e)?i2(e):Gv(e)}function o2(e){return function(t){t=Mm(t);var n=Bm(t)?s2(t):void 0,r=n?n[0]:t.charAt(0),i=n?Pv(n,1).join(""):t.slice(1);return r[e]()+i}}var Wm=o2("toUpperCase");function a2(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function c2(){this.__data__=new Zr,this.size=0}function l2(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function u2(e){return this.__data__.get(e)}function h2(e){return this.__data__.has(e)}var f2=200;function d2(e,t){var n=this.__data__;if(n instanceof Zr){var r=n.__data__;if(!Fo||r.length<f2-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Qr(r)}return n.set(e,t),this.size=n.size,this}function Ar(e){var t=this.__data__=new Zr(e);this.size=t.size}Ar.prototype.clear=c2,Ar.prototype.delete=l2,Ar.prototype.get=u2,Ar.prototype.has=h2,Ar.prototype.set=d2;function p2(e,t){return e&&nh(t,Vn(t),e)}var Gm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Hm=Gm&&typeof module=="object"&&module&&!module.nodeType&&module,m2=Hm&&Hm.exports===Gm,Ym=m2?kr.Buffer:void 0,Vm=Ym?Ym.allocUnsafe:void 0;function g2(e,t){var n=e.length,r=Vm?Vm(n):new e.constructor(n);return e.copy(r),r}function mh(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function qm(){return[]}var y2=Object.prototype,_2=y2.propertyIsEnumerable,Xm=Object.getOwnPropertySymbols,gh=Xm?function(e){return e==null?[]:(e=Object(e),mh(Xm(e),function(t){return _2.call(e,t)}))}:qm;function E2(e,t){return nh(e,gh(e),t)}var b2=Object.getOwnPropertySymbols,w2=b2?function(e){for(var t=[];e;)uh(t,gh(e)),e=Pm(e);return t}:qm;function Jm(e,t,n){var r=t(e);return Jt(e)?r:uh(r,n(e))}function yh(e){return Jm(e,Vn,gh)}function T2(e){return Jm(e,Lm,w2)}var _h=Ji(kr,"DataView"),Eh=Ji(kr,"Promise"),Bs=Ji(kr,"Set"),Zm="[object Map]",k2="[object Object]",Qm="[object Promise]",tg="[object Set]",eg="[object WeakMap]",ng="[object DataView]",x2=Xi(_h),A2=Xi(Fo),v2=Xi(Eh),S2=Xi(Bs),R2=Xi(Qu),qn=vi;(_h&&qn(new _h(new ArrayBuffer(1)))!=ng||Fo&&qn(new Fo)!=Zm||Eh&&qn(Eh.resolve())!=Qm||Bs&&qn(new Bs)!=tg||Qu&&qn(new Qu)!=eg)&&(qn=function(e){var t=vi(e),n=t==k2?e.constructor:void 0,r=n?Xi(n):"";if(r)switch(r){case x2:return ng;case A2:return Zm;case v2:return Qm;case S2:return tg;case R2:return eg}return t});var I2=Object.prototype,N2=I2.hasOwnProperty;function O2(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&N2.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var kc=kr.Uint8Array;function C2(e){var t=new e.constructor(e.byteLength);return new kc(t).set(new kc(e)),t}function L2(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var M2=/\w*$/;function U2(e){var t=new e.constructor(e.source,M2.exec(e));return t.lastIndex=e.lastIndex,t}var rg=Hn?Hn.prototype:void 0,ig=rg?rg.valueOf:void 0;function P2(e){return ig?Object(ig.call(e)):{}}function B2(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var F2="[object Boolean]",D2="[object Date]",$2="[object Map]",j2="[object Number]",z2="[object RegExp]",K2="[object Set]",W2="[object String]",G2="[object Symbol]",H2="[object ArrayBuffer]",Y2="[object DataView]",V2="[object Float32Array]",q2="[object Float64Array]",X2="[object Int8Array]",J2="[object Int16Array]",Z2="[object Int32Array]",Q2="[object Uint8Array]",tS="[object Uint8ClampedArray]",eS="[object Uint16Array]",nS="[object Uint32Array]";function rS(e,t,n){var r=e.constructor;switch(t){case H2:return C2(e);case F2:case D2:return new r(+e);case Y2:return L2(e);case V2:case q2:case X2:case J2:case Z2:case Q2:case tS:case eS:case nS:return B2(e);case $2:return new r;case j2:case W2:return new r(e);case z2:return U2(e);case K2:return new r;case G2:return P2(e)}}function iS(e){return typeof e.constructor=="function"&&!Mo(e)?Gx(Pm(e)):{}}var sS="[object Map]";function oS(e){return er(e)&&qn(e)==sS}var sg=Si&&Si.isMap,aS=sg?Ec(sg):oS,cS="[object Set]";function lS(e){return er(e)&&qn(e)==cS}var og=Si&&Si.isSet,uS=og?Ec(og):lS,ag="[object Arguments]",hS="[object Array]",fS="[object Boolean]",dS="[object Date]",pS="[object Error]",cg="[object Function]",mS="[object GeneratorFunction]",gS="[object Map]",yS="[object Number]",lg="[object Object]",_S="[object RegExp]",ES="[object Set]",bS="[object String]",wS="[object Symbol]",TS="[object WeakMap]",kS="[object ArrayBuffer]",xS="[object DataView]",AS="[object Float32Array]",vS="[object Float64Array]",SS="[object Int8Array]",RS="[object Int16Array]",IS="[object Int32Array]",NS="[object Uint8Array]",OS="[object Uint8ClampedArray]",CS="[object Uint16Array]",LS="[object Uint32Array]",de={};de[ag]=de[hS]=de[kS]=de[xS]=de[fS]=de[dS]=de[AS]=de[vS]=de[SS]=de[RS]=de[IS]=de[gS]=de[yS]=de[lg]=de[_S]=de[ES]=de[bS]=de[wS]=de[NS]=de[OS]=de[CS]=de[LS]=!0,de[pS]=de[cg]=de[TS]=!1;function xc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!Yn(e))return e;var a=Jt(e);if(a)return o=O2(e),Yx(e,o);var c=qn(e),u=c==cg||c==mS;if(Uo(e))return g2(e);if(c==lg||c==ag||u&&!i)return o=u?{}:iS(e),E2(e,p2(o,e));if(!de[c])return i?e:{};o=rS(e,c),s||(s=new Ar);var l=s.get(e);if(l)return l;s.set(e,o),uS(e)?e.forEach(function(d){o.add(xc(d,t,n,d,e,s))}):aS(e)&&e.forEach(function(d,p){o.set(p,xc(d,t,n,p,e,s))});var h=yh,f=a?void 0:h(e);return _m(f||e,function(d,p){f&&(p=d,d=e[p]),yc(o,p,xc(d,t,n,p,e,s))}),o}var MS=4;function Qe(e){return xc(e,MS)}function $o(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var US="__lodash_hash_undefined__";function PS(e){return this.__data__.set(e,US),this}function BS(e){return this.__data__.has(e)}function Fs(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Qr;++t<n;)this.add(e[t])}Fs.prototype.add=Fs.prototype.push=PS,Fs.prototype.has=BS;function ug(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function bh(e,t){return e.has(t)}var FS=1,DS=2;function hg(e,t,n,r,i,s){var o=n&FS,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var h=-1,f=!0,d=n&DS?new Fs:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],g=t[h];if(r)var w=o?r(g,p,h,t,e,s):r(p,g,h,e,t,s);if(w!==void 0){if(w)continue;f=!1;break}if(d){if(!ug(t,function(b,k){if(!bh(d,k)&&(p===b||i(p,b,n,r,s)))return d.push(k)})){f=!1;break}}else if(!(p===g||i(p,g,n,r,s))){f=!1;break}}return s.delete(e),s.delete(t),f}function $S(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function wh(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var jS=1,zS=2,KS="[object Boolean]",WS="[object Date]",GS="[object Error]",HS="[object Map]",YS="[object Number]",VS="[object RegExp]",qS="[object Set]",XS="[object String]",JS="[object Symbol]",ZS="[object ArrayBuffer]",QS="[object DataView]",fg=Hn?Hn.prototype:void 0,Th=fg?fg.valueOf:void 0;function tR(e,t,n,r,i,s,o){switch(n){case QS:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ZS:return!(e.byteLength!=t.byteLength||!s(new kc(e),new kc(t)));case KS:case WS:case YS:return Lo(+e,+t);case GS:return e.name==t.name&&e.message==t.message;case VS:case XS:return e==t+"";case HS:var a=$S;case qS:var c=r&jS;if(a||(a=wh),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=zS,o.set(e,t);var l=hg(a(e),a(t),r,i,s,o);return o.delete(e),l;case JS:if(Th)return Th.call(e)==Th.call(t)}return!1}var eR=1,nR=Object.prototype,rR=nR.hasOwnProperty;function iR(e,t,n,r,i,s){var o=n&eR,a=yh(e),c=a.length,u=yh(t),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var f=a[h];if(!(o?f in t:rR.call(t,f)))return!1}var d=s.get(e),p=s.get(t);if(d&&p)return d==t&&p==e;var g=!0;s.set(e,t),s.set(t,e);for(var w=o;++h<c;){f=a[h];var b=e[f],k=t[f];if(r)var v=o?r(k,b,f,t,e,s):r(b,k,f,e,t,s);if(!(v===void 0?b===k||i(b,k,n,r,s):v)){g=!1;break}w||(w=f=="constructor")}if(g&&!w){var N=e.constructor,P=t.constructor;N!=P&&"constructor"in e&&"constructor"in t&&!(typeof N=="function"&&N instanceof N&&typeof P=="function"&&P instanceof P)&&(g=!1)}return s.delete(e),s.delete(t),g}var sR=1,dg="[object Arguments]",pg="[object Array]",Ac="[object Object]",oR=Object.prototype,mg=oR.hasOwnProperty;function aR(e,t,n,r,i,s){var o=Jt(e),a=Jt(t),c=o?pg:qn(e),u=a?pg:qn(t);c=c==dg?Ac:c,u=u==dg?Ac:u;var l=c==Ac,h=u==Ac,f=c==u;if(f&&Uo(e)){if(!Uo(t))return!1;o=!0,l=!1}if(f&&!l)return s||(s=new Ar),o||oh(e)?hg(e,t,n,r,i,s):tR(e,t,c,n,r,i,s);if(!(n&sR)){var d=l&&mg.call(e,"__wrapped__"),p=h&&mg.call(t,"__wrapped__");if(d||p){var g=d?e.value():e,w=p?t.value():t;return s||(s=new Ar),i(g,w,n,r,s)}}return f?(s||(s=new Ar),iR(e,t,n,r,i,s)):!1}function kh(e,t,n,r,i){return e===t?!0:e==null||t==null||!er(e)&&!er(t)?e!==e&&t!==t:aR(e,t,n,r,kh,i)}var cR=1,lR=2;function uR(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],u=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var l=new Ar,h;if(!(h===void 0?kh(u,c,cR|lR,r,l):h))return!1}}return!0}function gg(e){return e===e&&!Yn(e)}function hR(e){for(var t=Vn(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,gg(i)]}return t}function yg(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function fR(e){var t=hR(e);return t.length==1&&t[0][2]?yg(t[0][0],t[0][1]):function(n){return n===e||uR(n,e,t)}}function dR(e,t){return e!=null&&t in Object(e)}function _g(e,t,n){t=Tc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=Do(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&ih(i)&&gc(o,i)&&(Jt(e)||_c(e)))}function pR(e,t){return e!=null&&_g(e,t,dR)}var mR=1,gR=2;function yR(e,t){return ah(e)&&gg(t)?yg(Do(e),t):function(n){var r=Mv(n,e);return r===void 0&&r===t?pR(n,e):kh(t,r,mR|gR)}}function _R(e){return function(t){return t==null?void 0:t[e]}}function ER(e){return function(t){return lh(t,e)}}function bR(e){return ah(e)?_R(Do(e)):ER(e)}function vr(e){return typeof e=="function"?e:e==null?Ps:typeof e=="object"?Jt(e)?yR(e[0],e[1]):fR(e):bR(e)}function wR(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function TR(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var kR=TR();function xR(e,t){return e&&kR(e,t,Vn)}function AR(e,t){return function(n,r){if(n==null)return n;if(!xr(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var Qi=AR(xR);function vR(e,t,n,r){return Qi(e,function(i,s,o){t(r,i,n(i),o)}),r}function SR(e,t){return function(n,r){var i=Jt(n)?wR:vR,s=t?t():{};return i(n,e,vr(r),s)}}var Eg=Object.prototype,RR=Eg.hasOwnProperty,xh=rh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Tm(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Lm(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||Lo(l,Eg[u])&&!RR.call(e,u))&&(e[u]=s[u])}return e});function bg(e){return er(e)&&xr(e)}var IR=200;function NR(e,t,n,r){var i=-1,s=bm,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;t.length>=IR&&(s=bh,o=!1,t=new Fs(t));t:for(;++i<a;){var l=e[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=u;f--;)if(t[f]===h)continue t;c.push(l)}else s(t,h,r)||c.push(l)}return c}var vc=rh(function(e,t){return bg(e)?NR(e,hh(t,1,bg,!0)):[]});function Ds(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function tn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:pc(t),fh(e,t<0?0:t,r)):[]}function jo(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:pc(t),t=r-t,fh(e,0,t<0?0:t)):[]}function OR(e){return typeof e=="function"?e:Ps}function St(e,t){var n=Jt(e)?_m:Qi;return n(e,OR(t))}function CR(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function LR(e,t){var n=!0;return Qi(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function nr(e,t,n){var r=Jt(e)?CR:LR;return r(e,vr(t))}function wg(e,t){var n=[];return Qi(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function Xn(e,t){var n=Jt(e)?mh:wg;return n(e,vr(t))}function MR(e){return function(t,n,r){var i=Object(t);if(!xr(t)){var s=vr(n);t=Vn(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var UR=Math.max;function PR(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:pc(n);return i<0&&(i=UR(r+i,0)),Em(e,vr(t),i)}var $s=MR(PR);function rr(e){return e&&e.length?e[0]:void 0}function BR(e,t){var n=-1,r=xr(e)?Array(e.length):[];return Qi(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function wt(e,t){var n=Jt(e)?dc:BR;return n(e,vr(t))}function Jn(e,t){return hh(wt(e,t))}var FR=Object.prototype,DR=FR.hasOwnProperty,Tg=SR(function(e,t,n){DR.call(e,n)?e[n].push(t):eh(e,n,[t])}),$R=Object.prototype,jR=$R.hasOwnProperty;function zR(e,t){return e!=null&&jR.call(e,t)}function vt(e,t){return e!=null&&_g(e,t,zR)}var KR="[object String]";function bn(e){return typeof e=="string"||!Jt(e)&&er(e)&&vi(e)==KR}function WR(e,t){return dc(t,function(n){return e[n]})}function Me(e){return e==null?[]:WR(e,Vn(e))}var GR=Math.max;function hn(e,t,n,r){e=xr(e)?e:Me(e),n=n&&!r?pc(n):0;var i=e.length;return n<0&&(n=GR(i+n,0)),bn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&th(e,t,n)>-1}function kg(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return th(e,t,i)}var HR="[object Map]",YR="[object Set]",VR=Object.prototype,qR=VR.hasOwnProperty;function pe(e){if(e==null)return!0;if(xr(e)&&(Jt(e)||typeof e=="string"||typeof e.splice=="function"||Uo(e)||oh(e)||_c(e)))return!e.length;var t=qn(e);if(t==HR||t==YR)return!e.size;if(Mo(e))return!Cm(e).length;for(var n in e)if(qR.call(e,n))return!1;return!0}var XR="[object RegExp]";function JR(e){return er(e)&&vi(e)==XR}var xg=Si&&Si.isRegExp,ti=xg?Ec(xg):JR;function ei(e){return e===void 0}var ZR="Expected a function";function QR(e){if(typeof e!="function")throw new TypeError(ZR);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function tI(e,t,n,r){if(!Yn(e))return e;t=Tc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=Do(t[i]),u=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=Yn(l)?l:gc(t[i+1])?[]:{})}yc(a,c,u),a=a[c]}return e}function eI(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=lh(e,o);n(a,o)&&tI(s,Tc(o,e),a)}return s}function ir(e,t){if(e==null)return{};var n=dc(T2(e),function(r){return[r]});return t=vr(t),eI(e,n,function(r,i){return t(r,i[0])})}function nI(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function wn(e,t,n){var r=Jt(e)?a2:nI,i=arguments.length<3;return r(e,vr(t),n,i,Qi)}function Sc(e,t){var n=Jt(e)?mh:wg;return n(e,QR(vr(t)))}function rI(e,t){var n;return Qi(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function Ah(e,t,n){var r=Jt(e)?ug:rI;return r(e,vr(t))}var iI=1/0,sI=Bs&&1/wh(new Bs([,-0]))[1]==iI?function(e){return new Bs(e)}:$e,oI=200;function aI(e,t,n){var r=-1,i=bm,s=e.length,o=!0,a=[],c=a;if(s>=oI){var u=sI(e);if(u)return wh(u);o=!1,i=bh,c=new Fs}else c=a;t:for(;++r<s;){var l=e[r],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=c.length;f--;)if(c[f]===h)continue t;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}function Rc(e){return e&&e.length?aI(e):[]}function vh(e){console&&console.error&&console.error(`Error: ${e}`)}function Ag(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function vg(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function Sg(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function cI(e){return lI(e)?e.LABEL:e.name}function lI(e){return bn(e.LABEL)&&e.LABEL!==""}class Sr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),St(this.definition,n=>{n.accept(t)})}}class Tn extends Sr{constructor(t){super([]),this.idx=1,En(this,ir(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class js extends Sr{constructor(t){super(t.definition),this.orgText="",En(this,ir(t,n=>n!==void 0))}}class kn extends Sr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,En(this,ir(t,n=>n!==void 0))}}class xn extends Sr{constructor(t){super(t.definition),this.idx=1,En(this,ir(t,n=>n!==void 0))}}class Rr extends Sr{constructor(t){super(t.definition),this.idx=1,En(this,ir(t,n=>n!==void 0))}}class Ir extends Sr{constructor(t){super(t.definition),this.idx=1,En(this,ir(t,n=>n!==void 0))}}class je extends Sr{constructor(t){super(t.definition),this.idx=1,En(this,ir(t,n=>n!==void 0))}}class sr extends Sr{constructor(t){super(t.definition),this.idx=1,En(this,ir(t,n=>n!==void 0))}}class or extends Sr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,En(this,ir(t,n=>n!==void 0))}}class we{constructor(t){this.idx=1,En(this,ir(t,n=>n!==void 0))}accept(t){t.visit(this)}}function uI(e){return wt(e,Ic)}function Ic(e){function t(n){return wt(n,Ic)}if(e instanceof Tn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return bn(e.label)&&(n.label=e.label),n}else{if(e instanceof kn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof xn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof Rr)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Ir)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Ic(new we({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof sr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Ic(new we({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof je)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof or)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof we){const n={type:"Terminal",name:e.terminalType.name,label:cI(e.terminalType),idx:e.idx};bn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=ti(r)?r.source:r),n}else{if(e instanceof js)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class ts{visit(t){const n=t;switch(n.constructor){case Tn:return this.visitNonTerminal(n);case kn:return this.visitAlternative(n);case xn:return this.visitOption(n);case Rr:return this.visitRepetitionMandatory(n);case Ir:return this.visitRepetitionMandatoryWithSeparator(n);case sr:return this.visitRepetitionWithSeparator(n);case je:return this.visitRepetition(n);case or:return this.visitAlternation(n);case we:return this.visitTerminal(n);case js:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function hI(e){return e instanceof kn||e instanceof xn||e instanceof je||e instanceof Rr||e instanceof Ir||e instanceof sr||e instanceof we||e instanceof js}function Nc(e,t=[]){return e instanceof xn||e instanceof je||e instanceof sr?!0:e instanceof or?Ah(e.definition,r=>Nc(r,t)):e instanceof Tn&&hn(t,e)?!1:e instanceof Sr?(e instanceof Tn&&t.push(e),nr(e.definition,r=>Nc(r,t))):!1}function fI(e){return e instanceof or}function Nr(e){if(e instanceof Tn)return"SUBRULE";if(e instanceof xn)return"OPTION";if(e instanceof or)return"OR";if(e instanceof Rr)return"AT_LEAST_ONE";if(e instanceof Ir)return"AT_LEAST_ONE_SEP";if(e instanceof sr)return"MANY_SEP";if(e instanceof je)return"MANY";if(e instanceof we)return"CONSUME";throw Error("non exhaustive match")}class Oc{walk(t,n=[]){St(t.definition,(r,i)=>{const s=tn(t.definition,i+1);if(r instanceof Tn)this.walkProdRef(r,s,n);else if(r instanceof we)this.walkTerminal(r,s,n);else if(r instanceof kn)this.walkFlat(r,s,n);else if(r instanceof xn)this.walkOption(r,s,n);else if(r instanceof Rr)this.walkAtLeastOne(r,s,n);else if(r instanceof Ir)this.walkAtLeastOneSep(r,s,n);else if(r instanceof sr)this.walkManySep(r,s,n);else if(r instanceof je)this.walkMany(r,s,n);else if(r instanceof or)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new xn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=Rg(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new xn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=Rg(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);St(t.definition,s=>{const o=new kn({definition:[s]});this.walk(o,i)})}}function Rg(e,t,n){return[new xn({definition:[new we({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function zo(e){if(e instanceof Tn)return zo(e.referencedRule);if(e instanceof we)return mI(e);if(hI(e))return dI(e);if(fI(e))return pI(e);throw Error("non exhaustive match")}function dI(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Nc(s),t=t.concat(zo(s)),r=r+1,i=n.length>r;return Rc(t)}function pI(e){const t=wt(e.definition,n=>zo(n));return Rc(Ln(t))}function mI(e){return[e.terminalType]}const Ig="_~IN~_";class gI extends Oc{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=_I(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new kn({definition:s}),a=zo(o);this.follows[i]=a}}function yI(e){const t={};return St(e,n=>{const r=new gI(n).startWalking();En(t,r)}),t}function _I(e,t){return e.name+t+Ig}function It(e){return e.charCodeAt(0)}function Sh(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function Ko(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function zs(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function EI(){throw Error("Internal Error - Should never get here!")}function Ng(e){return e.type==="Character"}const Cc=[];for(let e=It("0");e<=It("9");e++)Cc.push(e);const Lc=[It("_")].concat(Cc);for(let e=It("a");e<=It("z");e++)Lc.push(e);for(let e=It("A");e<=It("Z");e++)Lc.push(e);const Og=[It(" "),It("\f"),It(`
`),It("\r"),It("	"),It("\v"),It("	"),It(" "),It(" "),It(" "),It(" "),It(" "),It(" "),It(" "),It(" "),It(" "),It(" "),It(" "),It(" "),It(" "),It("\u2028"),It("\u2029"),It(" "),It(" "),It("　"),It("\uFEFF")],bI=/[0-9a-fA-F]/,Mc=/[0-9]/,wI=/[1-9]/;class TI{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Ko(r,"global");break;case"i":Ko(r,"ignoreCase");break;case"m":Ko(r,"multiLine");break;case"u":Ko(r,"unicode");break;case"y":Ko(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}zs(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return EI()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;zs(n);break}if(!(t===!0&&n===void 0)&&zs(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),zs(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[It(`
`),It("\r"),It("\u2028"),It("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Cc;break;case"D":t=Cc,n=!0;break;case"s":t=Og;break;case"S":t=Og,n=!0;break;case"w":t=Lc;break;case"W":t=Lc,n=!0;break}if(zs(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=It("\f");break;case"n":t=It(`
`);break;case"r":t=It("\r");break;case"t":t=It("	");break;case"v":t=It("\v");break}if(zs(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:It("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:It(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:It(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,Ng(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,Ng(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else Sh(r.value,t),t.push(It("-")),Sh(i.value,t)}else Sh(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:It("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(wI.test(t)===!1)throw Error("Expecting a positive integer");for(;Mc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Mc.test(t)===!1)throw Error("Expecting an integer");for(;Mc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:It(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Mc.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(bI.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class Rh{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let Uc={};const kI=new TI;function Pc(e){const t=e.toString();if(Uc.hasOwnProperty(t))return Uc[t];{const n=kI.pattern(t);return Uc[t]=n,n}}function xI(){Uc={}}const Cg="Complement Sets are not supported for first char optimization",Bc=`Unable to use "first char" lexer optimizations:
`;function AI(e,t=!1){try{const n=Pc(e);return Ih(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Cg)t&&Ag(`${Bc}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),vh(`${Bc}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Ih(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Ih(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Fc(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(Cg);St(o.value,c=>{if(typeof c=="number")Fc(c,t,n);else{const u=c;if(n===!0)for(let l=u.from;l<=u.to;l++)Fc(l,t,n);else{for(let l=u.from;l<=u.to&&l<Go;l++)Fc(l,t,n);if(u.to>=Go){const l=u.from>=Go?u.from:Go,h=u.to,f=Ri(l),d=Ri(h);for(let p=f;p<=d;p++)t[p]=p}}}});break;case"Group":Ih(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Nh(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Me(t)}function Fc(e,t,n){const r=Ri(e);t[r]=r,n===!0&&vI(e,t)}function vI(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Ri(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Ri(i.charCodeAt(0));t[s]=s}}}function Lg(e,t){return $s(e.value,n=>{if(typeof n=="number")return hn(t,n);{const r=n;return $s(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function Nh(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?Jt(e.value)?nr(e.value,Nh):Nh(e.value):!1}class SI extends Rh{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){hn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?Lg(t,this.targetCharCodes)===void 0&&(this.found=!0):Lg(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Oh(e,t){if(t instanceof RegExp){const n=Pc(t),r=new SI(e);return r.visit(n),r.found}else return $s(t,n=>hn(e,n.charCodeAt(0)))!==void 0}const es="PATTERN",Wo="defaultMode",Dc="modes";let Mg=typeof new RegExp("(?:)").sticky=="boolean";function RI(e,t){t=xh(t,{useSticky:Mg,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(k,v)=>v()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{JI()});let r;n("Reject Lexer.NA",()=>{r=Sc(e,k=>k[es]===ze.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=wt(r,k=>{const v=k[es];if(ti(v)){const N=v.source;return N.length===1&&N!=="^"&&N!=="$"&&N!=="."&&!v.ignoreCase?N:N.length===2&&N[0]==="\\"&&!hn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],N[1])?N[1]:t.useSticky?Pg(v):Ug(v)}else{if(Jr(v))return i=!0,{exec:v};if(typeof v=="object")return i=!0,v;if(typeof v=="string"){if(v.length===1)return v;{const N=v.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),P=new RegExp(N);return t.useSticky?Pg(P):Ug(P)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;n("misc mapping",()=>{o=wt(r,k=>k.tokenTypeIdx),a=wt(r,k=>{const v=k.GROUP;if(v!==ze.SKIPPED){if(bn(v))return v;if(ei(v))return!1;throw Error("non exhaustive match")}}),c=wt(r,k=>{const v=k.LONGER_ALT;if(v)return Jt(v)?wt(v,P=>kg(r,P)):[kg(r,v)]}),u=wt(r,k=>k.PUSH_MODE),l=wt(r,k=>vt(k,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const k=Dg(t.lineTerminatorCharacters);h=wt(r,v=>!1),t.positionTracking!=="onlyOffset"&&(h=wt(r,v=>vt(v,"LINE_BREAKS")?!!v.LINE_BREAKS:Fg(v,k)===!1&&Oh(k,v.PATTERN)))});let f,d,p,g;n("Misc Mapping #2",()=>{f=wt(r,Bg),d=wt(s,VI),p=wn(r,(k,v)=>{const N=v.GROUP;return bn(N)&&N!==ze.SKIPPED&&(k[N]=[]),k},{}),g=wt(s,(k,v)=>({pattern:s[v],longerAlt:c[v],canLineTerminator:h[v],isCustom:f[v],short:d[v],group:a[v],push:u[v],pop:l[v],tokenTypeIdx:o[v],tokenType:r[v]}))});let w=!0,b=[];return t.safeMode||n("First Char Optimization",()=>{b=wn(r,(k,v,N)=>{if(typeof v.PATTERN=="string"){const P=v.PATTERN.charCodeAt(0),L=Ri(P);Ch(k,L,g[N])}else if(Jt(v.START_CHARS_HINT)){let P;St(v.START_CHARS_HINT,L=>{const C=typeof L=="string"?L.charCodeAt(0):L,W=Ri(C);P!==W&&(P=W,Ch(k,W,g[N]))})}else if(ti(v.PATTERN))if(v.PATTERN.unicode)w=!1,t.ensureOptimizations&&vh(`${Bc}	Unable to analyze < ${v.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const P=AI(v.PATTERN,t.ensureOptimizations);pe(P)&&(w=!1),St(P,L=>{Ch(k,L,g[N])})}else t.ensureOptimizations&&vh(`${Bc}	TokenType: <${v.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),w=!1;return k},[])}),{emptyGroups:p,patternIdxToConfig:g,charCodeToPatternIdxToConfig:b,hasCustom:i,canBeOptimized:w}}function II(e,t){let n=[];const r=OI(e);n=n.concat(r.errors);const i=CI(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(NI(s)),n=n.concat($I(s)),n=n.concat(jI(s,t)),n=n.concat(zI(s)),n}function NI(e){let t=[];const n=Xn(e,r=>ti(r[es]));return t=t.concat(MI(n)),t=t.concat(BI(n)),t=t.concat(FI(n)),t=t.concat(DI(n)),t=t.concat(UI(n)),t}function OI(e){const t=Xn(e,i=>!vt(i,es)),n=wt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Ae.MISSING_PATTERN,tokenTypes:[i]})),r=vc(e,t);return{errors:n,valid:r}}function CI(e){const t=Xn(e,i=>{const s=i[es];return!ti(s)&&!Jr(s)&&!vt(s,"exec")&&!bn(s)}),n=wt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ae.INVALID_PATTERN,tokenTypes:[i]})),r=vc(e,t);return{errors:n,valid:r}}const LI=/[^\\][$]/;function MI(e){class t extends Rh{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Xn(e,i=>{const s=i.PATTERN;try{const o=Pc(s),a=new t;return a.visit(o),a.found}catch{return LI.test(s.source)}});return wt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ae.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function UI(e){const t=Xn(e,r=>r.PATTERN.test(""));return wt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Ae.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const PI=/[^\\[][\^]|^\^/;function BI(e){class t extends Rh{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Xn(e,i=>{const s=i.PATTERN;try{const o=Pc(s),a=new t;return a.visit(o),a.found}catch{return PI.test(s.source)}});return wt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ae.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function FI(e){const t=Xn(e,r=>{const i=r[es];return i instanceof RegExp&&(i.multiline||i.global)});return wt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ae.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function DI(e){const t=[];let n=wt(e,s=>wn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!hn(t,a)&&a.PATTERN!==ze.NA&&(t.push(a),o.push(a)),o),[]));n=$o(n);const r=Xn(n,s=>s.length>1);return wt(r,s=>{const o=wt(s,c=>c.name);return{message:`The same RegExp pattern ->${rr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Ae.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function $I(e){const t=Xn(e,r=>{if(!vt(r,"GROUP"))return!1;const i=r.GROUP;return i!==ze.SKIPPED&&i!==ze.NA&&!bn(i)});return wt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ae.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function jI(e,t){const n=Xn(e,i=>i.PUSH_MODE!==void 0&&!hn(t,i.PUSH_MODE));return wt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Ae.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function zI(e){const t=[],n=wn(e,(r,i,s)=>{const o=i.PATTERN;return o===ze.NA||(bn(o)?r.push({str:o,idx:s,tokenType:i}):ti(o)&&WI(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return St(e,(r,i)=>{St(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&KI(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Ae.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function KI(e,t){if(ti(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(Jr(t))return t(e,0,[],{});if(vt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function WI(e){return $s([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function Ug(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function Pg(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function GI(e,t,n){const r=[];return vt(e,Wo)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Wo+`> property in its definition
`,type:Ae.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),vt(e,Dc)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Dc+`> property in its definition
`,type:Ae.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),vt(e,Dc)&&vt(e,Wo)&&!vt(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Wo}: <${e.defaultMode}>which does not exist
`,type:Ae.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),vt(e,Dc)&&St(e.modes,(i,s)=>{St(i,(o,a)=>{if(ei(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Ae.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(vt(o,"LONGER_ALT")){const c=Jt(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];St(c,u=>{!ei(u)&&!hn(i,u)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:Ae.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function HI(e,t,n){const r=[];let i=!1;const s=$o(Ln(Me(e.modes))),o=Sc(s,c=>c[es]===ze.NA),a=Dg(n);return t&&St(o,c=>{const u=Fg(c,a);if(u!==!1){const h={message:XI(c,u),type:u.issue,tokenType:c};r.push(h)}else vt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Oh(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ae.NO_LINE_BREAKS_FLAGS}),r}function YI(e){const t={},n=Vn(e);return St(n,r=>{const i=e[r];if(Jt(i))t[r]=[];else throw Error("non exhaustive match")}),t}function Bg(e){const t=e.PATTERN;if(ti(t))return!1;if(Jr(t))return!0;if(vt(t,"exec"))return!0;if(bn(t))return!1;throw Error("non exhaustive match")}function VI(e){return bn(e)&&e.length===1?e.charCodeAt(0):!1}const qI={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Fg(e,t){if(vt(e,"LINE_BREAKS"))return!1;if(ti(e.PATTERN)){try{Oh(t,e.PATTERN)}catch(n){return{issue:Ae.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(bn(e.PATTERN))return!1;if(Bg(e))return{issue:Ae.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function XI(e,t){if(t.issue===Ae.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Ae.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Dg(e){return wt(e,n=>bn(n)?n.charCodeAt(0):n)}function Ch(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const Go=256;let $c=[];function Ri(e){return e<Go?e:$c[e]}function JI(){if(pe($c)){$c=new Array(65536);for(let e=0;e<65536;e++)$c[e]=e>255?255+~~(e/255):e}}function Ho(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function jc(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let $g=1;const jg={};function Yo(e){const t=ZI(e);QI(t),eN(t),tN(t),St(t,n=>{n.isParent=n.categoryMatches.length>0})}function ZI(e){let t=Qe(e),n=e,r=!0;for(;r;){n=$o(Ln(wt(n,s=>s.CATEGORIES)));const i=vc(n,t);t=t.concat(i),pe(i)?r=!1:n=i}return t}function QI(e){St(e,t=>{Kg(t)||(jg[$g]=t,t.tokenTypeIdx=$g++),Wg(t)&&!Jt(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),Wg(t)||(t.CATEGORIES=[]),nN(t)||(t.categoryMatches=[]),rN(t)||(t.categoryMatchesMap={})})}function tN(e){St(e,t=>{t.categoryMatches=[],St(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(jg[r].tokenTypeIdx)})})}function eN(e){St(e,t=>{zg([],t)})}function zg(e,t){St(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),St(t.CATEGORIES,n=>{const r=e.concat(t);hn(r,n)||zg(r,n)})}function Kg(e){return vt(e,"tokenTypeIdx")}function Wg(e){return vt(e,"CATEGORIES")}function nN(e){return vt(e,"categoryMatches")}function rN(e){return vt(e,"categoryMatchesMap")}function iN(e){return vt(e,"tokenTypeIdx")}const sN={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Ae;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Ae||(Ae={}));const Vo={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:sN,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Vo);let ze=class{constructor(t,n=Vo){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=vg(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=En({},Vo,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Vo.lineTerminatorsPattern)this.config.lineTerminatorsPattern=qI;else if(this.config.lineTerminatorCharacters===Vo.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Jt(t)?i={modes:{defaultMode:Qe(t)},defaultMode:Wo}:(s=!1,i=Qe(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(GI(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(HI(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},St(i.modes,(a,c)=>{i.modes[c]=Sc(a,u=>ei(u))});const o=Vn(i.modes);if(St(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(II(a,o))}),pe(this.lexerDefinitionErrors)){Yo(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=RI(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=En({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!pe(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=wt(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}St(this.lexerDefinitionWarning,a=>{Ag(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Mg?(this.chopInput=Ps,this.match=this.matchWithTest):(this.updateLastIndex=$e,this.match=this.matchWithExec),s&&(this.handleModes=$e),this.trackStartLines===!1&&(this.computeNewColumn=Ps),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=$e),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=wn(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(n.ensureOptimizations&&!pe(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{xI()}),this.TRACE_INIT("toFastProperties",()=>{Sg(this)})})}tokenize(t,n=this.defaultMode){if(!pe(this.lexerDefinitionErrors)){const i=wt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,u,l,h,f,d,p,g,w,b;const k=t,v=k.length;let N=0,P=0;const L=this.hasCustom?0:Math.floor(t.length/10),C=new Array(L),W=[];let M=this.trackStartLines?1:void 0,et=this.trackStartLines?1:void 0;const pt=YI(this.emptyGroups),U=this.trackStartLines,S=this.config.lineTerminatorsPattern;let _=0,B=[],J=[];const j=[],ht=[];Object.freeze(ht);let Q;function ut(){return B}function G(Ut){const Wt=Ri(Ut),Nt=J[Wt];return Nt===void 0?ht:Nt}const $=Ut=>{if(j.length===1&&Ut.tokenType.PUSH_MODE===void 0){const Wt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ut);W.push({offset:Ut.startOffset,line:Ut.startLine,column:Ut.startColumn,length:Ut.image.length,message:Wt})}else{j.pop();const Wt=Ds(j);B=this.patternIdxToConfig[Wt],J=this.charCodeToPatternIdxToConfig[Wt],_=B.length;const Nt=this.canModeBeOptimized[Wt]&&this.config.safeMode===!1;J&&Nt?Q=G:Q=ut}};function yt(Ut){j.push(Ut),J=this.charCodeToPatternIdxToConfig[Ut],B=this.patternIdxToConfig[Ut],_=B.length,_=B.length;const Wt=this.canModeBeOptimized[Ut]&&this.config.safeMode===!1;J&&Wt?Q=G:Q=ut}yt.call(this,n);let st;const at=this.config.recoveryEnabled;for(;N<v;){c=null;const Ut=k.charCodeAt(N),Wt=Q(Ut),Nt=Wt.length;for(r=0;r<Nt;r++){st=Wt[r];const Rt=st.pattern;u=null;const Mt=st.short;if(Mt!==!1?Ut===Mt&&(c=Rt):st.isCustom===!0?(b=Rt.exec(k,N,C,pt),b!==null?(c=b[0],b.payload!==void 0&&(u=b.payload)):c=null):(this.updateLastIndex(Rt,N),c=this.match(Rt,t,N)),c!==null){if(a=st.longerAlt,a!==void 0){const Ot=a.length;for(s=0;s<Ot;s++){const re=B[a[s]],Se=re.pattern;if(l=null,re.isCustom===!0?(b=Se.exec(k,N,C,pt),b!==null?(o=b[0],b.payload!==void 0&&(l=b.payload)):o=null):(this.updateLastIndex(Se,N),o=this.match(Se,t,N)),o&&o.length>c.length){c=o,u=l,st=re;break}}}break}}if(c!==null){if(h=c.length,f=st.group,f!==void 0&&(d=st.tokenTypeIdx,p=this.createTokenInstance(c,N,d,st.tokenType,M,et,h),this.handlePayload(p,u),f===!1?P=this.addToken(C,P,p):pt[f].push(p)),t=this.chopInput(t,h),N=N+h,et=this.computeNewColumn(et,h),U===!0&&st.canLineTerminator===!0){let Rt=0,Mt,Ot;S.lastIndex=0;do Mt=S.test(c),Mt===!0&&(Ot=S.lastIndex-1,Rt++);while(Mt===!0);Rt!==0&&(M=M+Rt,et=h-Ot,this.updateTokenEndLineColumnLocation(p,f,Ot,Rt,M,et,h))}this.handleModes(st,$,yt,p)}else{const Rt=N,Mt=M,Ot=et;let re=at===!1;for(;re===!1&&N<v;)for(t=this.chopInput(t,1),N++,i=0;i<_;i++){const Se=B[i],E=Se.pattern,rt=Se.short;if(rt!==!1?k.charCodeAt(N)===rt&&(re=!0):Se.isCustom===!0?re=E.exec(k,N,C,pt)!==null:(this.updateLastIndex(E,N),re=E.exec(t)!==null),re===!0)break}if(g=N-Rt,et=this.computeNewColumn(et,g),w=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(k,Rt,g,Mt,Ot),W.push({offset:Rt,line:Mt,column:Ot,length:g,message:w}),at===!1)break}}return this.hasCustom||(C.length=P),{tokens:C,groups:pt,errors:W}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,u;n!==void 0&&(c=r===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1+-u))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};ze.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",ze.NA=/NOT_APPLICABLE/;function qo(e){return Gg(e)?e.LABEL:e.name}function Gg(e){return bn(e.LABEL)&&e.LABEL!==""}const oN="parent",Hg="categories",Yg="label",Vg="group",qg="push_mode",Xg="pop_mode",Jg="longer_alt",Zg="line_breaks",Qg="start_chars_hint";function Mn(e){return aN(e)}function aN(e){const t=e.pattern,n={};if(n.name=e.name,ei(t)||(n.PATTERN=t),vt(e,oN))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return vt(e,Hg)&&(n.CATEGORIES=e[Hg]),Yo([n]),vt(e,Yg)&&(n.LABEL=e[Yg]),vt(e,Vg)&&(n.GROUP=e[Vg]),vt(e,Xg)&&(n.POP_MODE=e[Xg]),vt(e,qg)&&(n.PUSH_MODE=e[qg]),vt(e,Jg)&&(n.LONGER_ALT=e[Jg]),vt(e,Zg)&&(n.LINE_BREAKS=e[Zg]),vt(e,Qg)&&(n.START_CHARS_HINT=e[Qg]),n}const ns=Mn({name:"EOF",pattern:ze.NA});Yo([ns]);function zc(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function cN(e,t){return Ho(e,t)}const ty={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${Gg(e)?`--> ${qo(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+rr(t).image+"'";if(r)return s+r+a;{const c=wn(e,(f,d)=>f.concat(d),[]),u=wt(c,f=>`[${wt(f,d=>qo(d)).join(", ")}]`),h=`one of these possible Token sequences:
${wt(u,(f,d)=>`  ${d+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+rr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${wt(e,u=>`[${wt(u,l=>qo(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(ty);const lN={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},rs={buildDuplicateFoundError(e,t){function n(l){return l instanceof we?l.terminalType.name:l instanceof Tn?l.nonTerminalName:""}const r=e.name,i=rr(t),s=i.idx,o=Nr(i),a=n(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=wt(e.prefixPath,i=>qo(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=wt(e.prefixPath,i=>qo(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Nr(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=wt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof js?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function uN(e,t){const n=new hN(e,t);return n.resolveRefs(),n.errors}class hN extends ts{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){St(Me(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:fn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class fN extends Oc{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Qe(this.path.ruleStack).reverse(),this.occurrenceStack=Qe(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){pe(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class dN extends fN{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new kn({definition:i});this.possibleTokTypes=zo(s),this.found=!0}}}class Kc extends Oc{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class pN extends Kc{walkMany(t,n,r){if(t.idx===this.occurrence){const i=rr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof we&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class ey extends Kc{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=rr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof we&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class mN extends Kc{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=rr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof we&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class ny extends Kc{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=rr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof we&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function Lh(e,t,n=[]){n=Qe(n);let r=[],i=0;function s(a){return a.concat(tn(e,i+1))}function o(a){const c=Lh(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof kn)return o(a.definition);if(a instanceof Tn)return o(a.definition);if(a instanceof xn)r=o(a.definition);else if(a instanceof Rr){const c=a.definition.concat([new je({definition:a.definition})]);return o(c)}else if(a instanceof Ir){const c=[new kn({definition:a.definition}),new je({definition:[new we({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof sr){const c=a.definition.concat([new je({definition:[new we({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof je){const c=a.definition.concat([new je({definition:a.definition})]);r=o(c)}else{if(a instanceof or)return St(a.definition,c=>{pe(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof we)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:tn(e,i)}),r}function ry(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-r-1,l=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!pe(h);){const f=h.pop();if(f===o){a&&Ds(h).idx<=u&&h.pop();continue}const d=f.def,p=f.idx,g=f.ruleStack,w=f.occurrenceStack;if(pe(d))continue;const b=d[0];if(b===i){const k={idx:p,def:tn(d),ruleStack:jo(g),occurrenceStack:jo(w)};h.push(k)}else if(b instanceof we)if(p<c-1){const k=p+1,v=t[k];if(n(v,b.terminalType)){const N={idx:k,def:tn(d),ruleStack:g,occurrenceStack:w};h.push(N)}}else if(p===c-1)l.push({nextTokenType:b.terminalType,nextTokenOccurrence:b.idx,ruleStack:g,occurrenceStack:w}),a=!0;else throw Error("non exhaustive match");else if(b instanceof Tn){const k=Qe(g);k.push(b.nonTerminalName);const v=Qe(w);v.push(b.idx);const N={idx:p,def:b.definition.concat(s,tn(d)),ruleStack:k,occurrenceStack:v};h.push(N)}else if(b instanceof xn){const k={idx:p,def:tn(d),ruleStack:g,occurrenceStack:w};h.push(k),h.push(o);const v={idx:p,def:b.definition.concat(tn(d)),ruleStack:g,occurrenceStack:w};h.push(v)}else if(b instanceof Rr){const k=new je({definition:b.definition,idx:b.idx}),v=b.definition.concat([k],tn(d)),N={idx:p,def:v,ruleStack:g,occurrenceStack:w};h.push(N)}else if(b instanceof Ir){const k=new we({terminalType:b.separator}),v=new je({definition:[k].concat(b.definition),idx:b.idx}),N=b.definition.concat([v],tn(d)),P={idx:p,def:N,ruleStack:g,occurrenceStack:w};h.push(P)}else if(b instanceof sr){const k={idx:p,def:tn(d),ruleStack:g,occurrenceStack:w};h.push(k),h.push(o);const v=new we({terminalType:b.separator}),N=new je({definition:[v].concat(b.definition),idx:b.idx}),P=b.definition.concat([N],tn(d)),L={idx:p,def:P,ruleStack:g,occurrenceStack:w};h.push(L)}else if(b instanceof je){const k={idx:p,def:tn(d),ruleStack:g,occurrenceStack:w};h.push(k),h.push(o);const v=new je({definition:b.definition,idx:b.idx}),N=b.definition.concat([v],tn(d)),P={idx:p,def:N,ruleStack:g,occurrenceStack:w};h.push(P)}else if(b instanceof or)for(let k=b.definition.length-1;k>=0;k--){const v=b.definition[k],N={idx:p,def:v.definition.concat(tn(d)),ruleStack:g,occurrenceStack:w};h.push(N),h.push(o)}else if(b instanceof kn)h.push({idx:p,def:b.definition.concat(tn(d)),ruleStack:g,occurrenceStack:w});else if(b instanceof js)h.push(gN(b,p,g,w));else throw Error("non exhaustive match")}return l}function gN(e,t,n,r){const i=Qe(n);i.push(e.name);const s=Qe(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var ve;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(ve||(ve={}));function iy(e){if(e instanceof xn||e==="Option")return ve.OPTION;if(e instanceof je||e==="Repetition")return ve.REPETITION;if(e instanceof Rr||e==="RepetitionMandatory")return ve.REPETITION_MANDATORY;if(e instanceof Ir||e==="RepetitionMandatoryWithSeparator")return ve.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof sr||e==="RepetitionWithSeparator")return ve.REPETITION_WITH_SEPARATOR;if(e instanceof or||e==="Alternation")return ve.ALTERNATION;throw Error("non exhaustive match")}function yN(e,t,n,r,i,s){const o=Uh(e,t,n),a=cy(o)?jc:Ho;return s(o,r,a,i)}function _N(e,t,n,r,i,s){const o=Ph(e,t,i,n),a=cy(o)?jc:Ho;return s(o[0],a,r)}function EN(e,t,n,r){const i=e.length,s=nr(e,o=>nr(o,a=>a.length===1));if(t)return function(o){const a=wt(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let f=0;f<l;f++){const d=u[f],p=d.length;for(let g=0;g<p;g++){const w=this.LA(g+1);if(n(w,d[g])===!1)continue t}return c}}};if(s&&!r){const o=wt(e,c=>Ln(c)),a=wn(o,(c,u,l)=>(St(u,h=>{vt(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),St(h.categoryMatches,f=>{vt(c,f)||(c[f]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let f=0;f<h;f++){const d=this.LA(f+1);if(n(d,l[f])===!1)continue t}return o}}}}function bN(e,t,n){const r=nr(e,s=>s.length===1),i=e.length;if(r&&!n){const s=Ln(e);if(s.length===1&&pe(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=wn(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,St(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue t}return!0}return!1}}class wN extends Oc{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,ve.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,ve.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,ve.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,ve.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,ve.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class sy extends ts{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,ve.OPTION)}visitRepetition(t){this.checkIsTarget(t,ve.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,ve.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,ve.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,ve.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,ve.ALTERNATION)}}function oy(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function Mh(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function TN(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function ay(e,t){const n=wt(e,o=>Lh([o],1)),r=oy(n.length),i=wt(n,o=>{const a={};return St(o,c=>{const u=Mh(c.partialPath);St(u,l=>{a[l]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=oy(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,f=u[l].suffixDef,d=Mh(h);if(TN(i,d,c)||pe(f)||h.length===t){const g=r[c];if(Bh(g,h)===!1){g.push(h);for(let w=0;w<d.length;w++){const b=d[w];i[c][b]=!0}}}else{const g=Lh(f,o+1,h);s[c]=s[c].concat(g),St(g,w=>{const b=Mh(w.partialPath);St(b,k=>{i[c][k]=!0})})}}}}return r}function Uh(e,t,n,r){const i=new sy(e,ve.ALTERNATION,r);return t.accept(i),ay(i.result,n)}function Ph(e,t,n,r){const i=new sy(e,n);t.accept(i);const s=i.result,a=new wN(t,e,n).startWalking(),c=new kn({definition:s}),u=new kn({definition:a});return ay([c,u],r)}function Bh(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function kN(e,t){return e.length<t.length&&nr(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function cy(e){return nr(e,t=>nr(t,n=>nr(n,r=>pe(r.categoryMatches))))}function xN(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return wt(t,n=>Object.assign({type:fn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function AN(e,t,n,r){const i=Jn(e,c=>vN(c,n)),s=FN(e,t,n),o=Jn(e,c=>MN(c,n)),a=Jn(e,c=>IN(c,e,r,n));return i.concat(s,o,a)}function vN(e,t){const n=new RN;e.accept(n);const r=n.allProductions,i=Tg(r,SN),s=ir(i,a=>a.length>1);return wt(Me(s),a=>{const c=rr(a),u=t.buildDuplicateFoundError(e,a),l=Nr(c),h={message:u,type:fn.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:c.idx},f=ly(c);return f&&(h.parameter=f),h})}function SN(e){return`${Nr(e)}_#_${e.idx}_#_${ly(e)}`}function ly(e){return e instanceof we?e.terminalType.name:e instanceof Tn?e.nonTerminalName:""}class RN extends ts{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function IN(e,t,n,r){const i=[];if(wn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:fn.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function NN(e,t,n){const r=[];let i;return hn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:fn.INVALID_RULE_OVERRIDE,ruleName:e})),r}function uy(e,t,n,r=[]){const i=[],s=Wc(t.definition);if(pe(s))return[];{const o=e.name;hn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:fn.LEFT_RECURSION,ruleName:o});const c=vc(s,r.concat([e])),u=Jn(c,l=>{const h=Qe(r);return h.push(l),uy(e,l,n,h)});return i.concat(u)}}function Wc(e){let t=[];if(pe(e))return t;const n=rr(e);if(n instanceof Tn)t.push(n.referencedRule);else if(n instanceof kn||n instanceof xn||n instanceof Rr||n instanceof Ir||n instanceof sr||n instanceof je)t=t.concat(Wc(n.definition));else if(n instanceof or)t=Ln(wt(n.definition,s=>Wc(s.definition)));else if(!(n instanceof we))throw Error("non exhaustive match");const r=Nc(n),i=e.length>1;if(r&&i){const s=tn(e);return t.concat(Wc(s))}else return t}class Fh extends ts{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function ON(e,t){const n=new Fh;e.accept(n);const r=n.alternations;return Jn(r,s=>{const o=jo(s.definition);return Jn(o,(a,c)=>{const u=ry([a],[],Ho,1);return pe(u)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:fn.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function CN(e,t,n){const r=new Fh;e.accept(r);let i=r.alternations;return i=Sc(i,o=>o.ignoreAmbiguities===!0),Jn(i,o=>{const a=o.idx,c=o.maxLookahead||t,u=Uh(a,e,c,o),l=PN(u,o,e,n),h=BN(u,o,e,n);return l.concat(h)})}class LN extends ts{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function MN(e,t){const n=new Fh;e.accept(n);const r=n.alternations;return Jn(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:fn.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function UN(e,t,n){const r=[];return St(e,i=>{const s=new LN;i.accept(s);const o=s.allProductions;St(o,a=>{const c=iy(a),u=a.maxLookahead||t,l=a.idx,f=Ph(l,i,c,u)[0];if(pe(Ln(f))){const d=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:d,type:fn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function PN(e,t,n,r){const i=[],s=wn(e,(a,c,u)=>(t.definition[u].ignoreAmbiguities===!0||St(c,l=>{const h=[u];St(e,(f,d)=>{u!==d&&Bh(f,l)&&t.definition[d].ignoreAmbiguities!==!0&&h.push(d)}),h.length>1&&!Bh(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return wt(s,a=>{const c=wt(a.alts,l=>l+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:fn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function BN(e,t,n,r){const i=wn(e,(o,a,c)=>{const u=wt(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return $o(Jn(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=Xn(i,f=>t.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&kN(f.path,u));return wt(l,f=>{const d=[f.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:d,prefixPath:f.path}),type:fn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:d}})}))}function FN(e,t,n){const r=[],i=wt(t,s=>s.name);return St(e,s=>{const o=s.name;if(hn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:fn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function DN(e){const t=xh(e,{errMsgProvider:lN}),n={};return St(e.rules,r=>{n[r.name]=r}),uN(n,t.errMsgProvider)}function $N(e){return e=xh(e,{errMsgProvider:rs}),AN(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const hy="MismatchedTokenException",fy="NoViableAltException",dy="EarlyExitException",py="NotAllInputParsedException",my=[hy,fy,dy,py];Object.freeze(my);function Gc(e){return hn(my,e.name)}class Hc extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class gy extends Hc{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=hy}}class jN extends Hc{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=fy}}class zN extends Hc{constructor(t,n){super(t,n),this.name=py}}class KN extends Hc{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=dy}}const Dh={},yy="InRuleRecoveryException";class WN extends Error{constructor(t){super(t),this.name=yy}}class GN{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=vt(t,"recoveryEnabled")?t.recoveryEnabled:ni.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=HN)}getTokenToInsert(t){const n=zc(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const f=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:f,ruleName:this.getCurrRuleFullName()}),p=new gy(d,u,this.LA(0));p.resyncedTokens=jo(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new WN("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||pe(n))return!1;const r=this.LA(1);return $s(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return hn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=$s(t,s=>cN(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Dh;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return wt(t,(r,i)=>i===0?Dh:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=wt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return Ln(t)}getFollowSetFromFollowKey(t){if(t===Dh)return[ns];const n=t.ruleName+t.idxInCallingRule+Ig+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,ns)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return jo(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=Qe(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return wt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function HN(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),d=this.getGAstProductions()[f];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=ns,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,n,u)}const YN=4,Ii=8,_y=1<<Ii,Ey=2<<Ii,$h=3<<Ii,jh=4<<Ii,zh=5<<Ii,Yc=6<<Ii;function Kh(e,t,n){return n|t|e}class VN{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:ni.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(pe(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return Jn(t,n=>uy(n,n,rs))}validateEmptyOrAlternatives(t){return Jn(t,n=>ON(n,rs))}validateAmbiguousAlternationAlternatives(t,n){return Jn(t,r=>CN(r,n,rs))}validateSomeNonEmptyLookaheadPath(t,n){return UN(t,n,rs)}buildLookaheadForAlternation(t){return yN(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,EN)}buildLookaheadForOptional(t){return _N(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,iy(t.prodType),bN)}}class qN{initLooksAhead(t){this.dynamicTokensEnabled=vt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:ni.dynamicTokensEnabled,this.maxLookahead=vt(t,"maxLookahead")?t.maxLookahead:ni.maxLookahead,this.lookaheadStrategy=vt(t,"lookaheadStrategy")?t.lookaheadStrategy:new VN({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){St(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=JN(n);St(r,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${Nr(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:n,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=Kh(this.fullRuleNameToShort[n.name],_y,u.idx);this.setLaFuncCache(f,h)})}),St(i,u=>{this.computeLookaheadFunc(n,u.idx,$h,"Repetition",u.maxLookahead,Nr(u))}),St(s,u=>{this.computeLookaheadFunc(n,u.idx,Ey,"Option",u.maxLookahead,Nr(u))}),St(o,u=>{this.computeLookaheadFunc(n,u.idx,jh,"RepetitionMandatory",u.maxLookahead,Nr(u))}),St(a,u=>{this.computeLookaheadFunc(n,u.idx,Yc,"RepetitionMandatoryWithSeparator",u.maxLookahead,Nr(u))}),St(c,u=>{this.computeLookaheadFunc(n,u.idx,zh,"RepetitionWithSeparator",u.maxLookahead,Nr(u))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Kh(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return Kh(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class XN extends ts{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const Vc=new XN;function JN(e){Vc.reset(),e.accept(Vc);const t=Vc.dslMethods;return Vc.reset(),t}function by(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function wy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function ZN(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function QN(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const tO="name";function Ty(e,t){Object.defineProperty(e,tO,{enumerable:!1,configurable:!0,writable:!1,value:t})}function eO(e,t){const n=Vn(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,t)}}}function nO(e,t){const n=function(){};Ty(n,e+"BaseSemantics");const r={visit:function(i,s){if(Jt(i)&&(i=i[0]),!ei(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=iO(this,t);if(!pe(i)){const s=wt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function rO(e,t,n){const r=function(){};Ty(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return St(t,s=>{i[s]=eO}),r.prototype=i,r.prototype.constructor=r,r}var Wh;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Wh||(Wh={}));function iO(e,t){return sO(e,t)}function sO(e,t){const n=Xn(t,i=>Jr(e[i])===!1),r=wt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:Wh.MISSING_METHOD,methodName:i}));return $o(r)}class oO{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=vt(t,"nodeLocationTracking")?t.nodeLocationTracking:ni.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=$e,this.cstFinallyStateUpdate=$e,this.cstPostTerminal=$e,this.cstPostNonTerminal=$e,this.cstPostRule=$e;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=wy,this.setNodeLocationFromNode=wy,this.cstPostRule=$e,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=$e,this.setNodeLocationFromNode=$e,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=by,this.setNodeLocationFromNode=by,this.cstPostRule=$e,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=$e,this.setNodeLocationFromNode=$e,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=$e,this.setNodeLocationFromNode=$e,this.cstPostRule=$e,this.setInitialNodeLocation=$e;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];ZN(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];QN(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(ei(this.baseCstVisitorConstructor)){const t=nO(this.className,Vn(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(ei(this.baseCstVisitorWithDefaultsConstructor)){const t=rO(this.className,Vn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class aO{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Jc}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?Jc:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class cO{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=Zc){if(hn(this.definedRulesNames,t)){const o={message:rs.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:fn.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=Zc){const i=NN(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(Gc(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return uI(Me(this.gastProductionsCache))}}class lO{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=jc,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},vt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Jt(t)){if(pe(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Jt(t))this.tokensMap=wn(t,(s,o)=>(s[o.name]=o,s),{});else if(vt(t,"modes")&&nr(Ln(Me(t.modes)),iN)){const s=Ln(Me(t.modes)),o=Rc(s);this.tokensMap=wn(o,(a,c)=>(a[c.name]=c,a),{})}else if(Yn(t))this.tokensMap=Qe(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=ns;const r=vt(t,"modes")?Ln(Me(t.modes)):Me(t),i=nr(r,s=>pe(s.categoryMatches));this.tokenMatcher=i?jc:Ho,Yo(Me(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=vt(r,"resyncEnabled")?r.resyncEnabled:Zc.resyncEnabled,s=vt(r,"recoveryValueFunc")?r.recoveryValueFunc:Zc.recoveryValueFunc,o=this.ruleShortNameIdx<<YN+Ii;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Gc(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Ey,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(jh,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,ve.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,jh,t,mN)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(Yc,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,ny],a,Yc,t,ny)}else throw this.raiseEarlyExitException(t,ve.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead($h,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,$h,t,pN,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(zh,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,ey],a,zh,t,ey)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,Yc,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(_y,n),i=Jt(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new zN(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw Gc(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new gy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===yy?r:s}}else throw r}saveRecogState(){const t=this.errors,n=Qe(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),ns)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class uO{initErrorHandler(t){this._errors=[],this.errorMessageProvider=vt(t,"errorMessageProvider")?t.errorMessageProvider:ni.errorMessageProvider}SAVE_ERROR(t){if(Gc(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Qe(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Qe(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Ph(t,s,n,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new KN(u,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Uh(t,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new jN(c,this.LA(1),a))}}class hO{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(ei(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return ry([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=rr(t.ruleStack),i=this.getGAstProductions()[n];return new dN(i,t).startWalking()}}const qc={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(qc);const ky=!0,xy=Math.pow(2,Ii)-1,Ay=Mn({name:"RECORDING_PHASE_TOKEN",pattern:ze.NA});Yo([Ay]);const vy=zc(Ay,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(vy);const fO={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class dO{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return Jc}topLevelRuleRecord(t,n){try{const r=new js({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return Xo.call(this,xn,t,n)}atLeastOneInternalRecord(t,n){Xo.call(this,Rr,n,t)}atLeastOneSepFirstInternalRecord(t,n){Xo.call(this,Ir,n,t,ky)}manyInternalRecord(t,n){Xo.call(this,je,n,t)}manySepFirstInternalRecord(t,n){Xo.call(this,sr,n,t,ky)}orInternalRecord(t,n){return pO.call(this,t,n)}subruleInternalRecord(t,n,r){if(Xc(n),!t||vt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Sy(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Ds(this.recordingProdStack),s=t.ruleName,o=new Tn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?fO:qc}consumeInternalRecord(t,n,r){if(Xc(n),!Kg(t)){const o=new Error(`<CONSUME${Sy(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Ds(this.recordingProdStack),s=new we({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),vy}}function Xo(e,t,n,r=!1){Xc(n);const i=Ds(this.recordingProdStack),s=Jr(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),vt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),qc}function pO(e,t){Xc(t);const n=Ds(this.recordingProdStack),r=Jt(e)===!1,i=r===!1?e:e.DEF,s=new or({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});vt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Ah(i,a=>Jr(a.GATE));return s.hasPredicates=o,n.definition.push(s),St(i,a=>{const c=new kn({definition:[]});s.definition.push(c),vt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:vt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),qc}function Sy(e){return e===0?"":`${e}`}function Xc(e){if(e<0||e>xy){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${xy+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class mO{initPerformanceTracer(t){if(vt(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=ni.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=vg(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function gO(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const Jc=zc(ns,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Jc);const ni=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:ty,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Zc=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var fn;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(fn||(fn={}));let Gh=class O1{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Sg(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),St(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=DN({rules:Me(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(pe(r)&&this.skipValidations===!1){const i=$N({rules:Me(this.gastProductionsCache),tokenTypes:Me(this.tokensMap),errMsgProvider:rs,grammarName:n}),s=xN({lookaheadStrategy:this.lookaheadStrategy,rules:Me(this.gastProductionsCache),tokenTypes:Me(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),pe(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=yI(Me(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Me(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Me(this.gastProductionsCache))})),!O1.DEFER_DEFINITION_ERRORS_HANDLING&&!pe(this.definitionErrors))throw t=wt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),vt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=vt(n,"skipValidations")?n.skipValidations:ni.skipValidations}};Gh.DEFER_DEFINITION_ERRORS_HANDLING=!1,gO(Gh,[GN,qN,oO,aO,lO,cO,uO,hO,dO,mO]);class yO extends Gh{constructor(t,n=ni){const r=Qe(n);r.outputCst=!0,super(t,r)}}function _O(e){const t=new EO,n=Me(e);return wt(n,r=>t.visitRule(r))}class EO extends ts{visitRule(t){const n=this.visitEach(t.definition),r=Tg(n,s=>s.propertyName),i=wt(r,(s,o)=>{const a=!Ah(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=wt(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:Qc(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:Qc(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:Qc(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:Qc(t)}]}visitEachAndOverrideWith(t,n){return wt(this.visitEach(t),r=>En({},r,n))}visitEach(t){return Ln(wt(t,n=>this.visit(n)))}}function Qc(e){return e instanceof Tn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function bO(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(Ln(wt(e,r=>wO(r)))),t.includeVisitorInterface&&(n=n.concat(AO(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function wO(e){const t=TO(e),n=kO(e);return[t,n]}function TO(e){const t=Iy(e.name),n=Hh(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function kO(e){return`export type ${Hh(e.name)} = {
  ${wt(e.properties,n=>xO(n)).join(`
  `)}
};`}function xO(e){const t=SO(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function AO(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${wt(t,n=>vO(n)).join(`
  `)}
}`}function vO(e){const t=Hh(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function SO(e){if(Jt(e)){const t=Rc(wt(e,r=>Ry(r)));return"("+wn(t,(r,i)=>r+" | "+i)+")"}else return Ry(e)}function Ry(e){return e.kind==="token"?"IToken":Iy(e.name)}function Iy(e){return Wm(e)+"CstNode"}function Hh(e){return Wm(e)+"CstChildren"}const RO={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function IO(e,t){const n=Object.assign(Object.assign({},RO),t),r=_O(e);return bO(r,n)}const Yh=g0(32,126).map(e=>String.fromCharCode(e));function zt(e){return Mn({...e,name:`token_${e.name}`})}function Or(e,t=!1){return zt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:rn,group:ze.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:rn})}const Jo=zt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),NO=zt({name:"whitespace",pattern:/ +/,group:ze.SKIPPED}),OO=zt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:ze.SKIPPED}),Vh=zt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Ks=zt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Ny=!1;function CO(e,t,n){if(!Ny)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Jo)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const Oy=zt({name:"text",pattern:CO,line_breaks:!1,start_chars_hint:Yh.filter(e=>"@#/?':!".includes(e)===!1)}),Cy=zt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Ly=zt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),My=zt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Uy=zt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),rn=zt({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:Yh}),Py=zt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),By=zt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Fy=zt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:rn}),Dy=zt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:rn}),$y=zt({name:"islessthan",pattern:/<|below/,longer_alt:rn}),jy=zt({name:"isgreaterthan",pattern:/>|above/,longer_alt:rn}),zy=zt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:rn}),Ky=zt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:rn}),qh=zt({name:"or",pattern:/or/i,longer_alt:rn}),Xh=zt({name:"not",pattern:/not/i,longer_alt:rn}),Jh=zt({name:"and",pattern:/and/i,longer_alt:rn}),Zh=zt({name:"plus",pattern:/\+/}),Qh=zt({name:"minus",pattern:/-/}),Wy=zt({name:"power",pattern:/\*\*/}),Gy=zt({name:"multiply",pattern:/\*/}),tf=zt({name:"divide",pattern:/\//}),Hy=zt({name:"moddivide",pattern:/%/}),Yy=zt({name:"floordivide",pattern:/%%/}),Vy=zt({name:"query",pattern:/\?/}),qy=zt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),Xy=zt({name:"rparen",pattern:/\)/,pop_mode:!0}),Jy=zt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Yh,longer_alt:rn}),ef=zt({name:"if",pattern:/if|try|take|give/,longer_alt:rn}),tl=Or("do"),LO=Or("to",!0),nf=Or("done"),MO=Or("then",!0),rf=Or("else"),Zy=Or("while"),Qy=Or("repeat"),t_=Or("waitfor"),e_=zt({name:"foreach",pattern:/foreach|for/,longer_alt:rn}),n_=Or("break"),r_=Or("continue");function i_(e){return[...e,By,Fy,Dy,zy,$y,Ky,jy,qh,Xh,Jh,Zh,Qh,Wy,Gy,tf,Yy,Hy,Vy,qy,Xy,Py,rn]}const s_=i_([Oy,Vh,Jy,Ks,Cy,Ly,My,Uy,Jo,NO,n_,r_,nf,tl,rf,e_,ef,Qy,MO,LO,t_,Zy]),UO=new ze({defaultMode:"use_newlines",modes:{use_newlines:s_,ignore_newlines:i_([OO])}},{skipValidations:!wr,ensureOptimizations:wr});function o_(e){Ny=!0;const t=UO.tokenize(e||` 
`),[n]=(ie(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(zc(Jo,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function PO(e,t,n=!0){if(n){const[r,...i]=t;switch(Bt(r??"")){default:return{type:bt.OBJECT,values:t};case"loader":return{type:bt.LOADER,values:i};case"board":return{type:bt.BOARD,values:i};case"object":return{type:bt.OBJECT,values:i};case"terrain":return{type:bt.TERRAIN,values:i};case"charset":return{type:bt.CHARSET,values:i};case"palette":return{type:bt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Bt(i??""),a=[r,e,...s];switch(o){default:return{type:bt.CONST,values:t};case"rn":case"range":return{type:bt.RANGE,values:a};case"sl":case"select":return{type:bt.SELECT,values:a};case"nm":case"number":return{type:bt.NUMBER,values:a};case"tx":case"text":return{type:bt.TEXT,values:a};case"ln":case"link":return{type:bt.LINK,values:a};case"hk":case"hotkey":return{type:bt.HOTKEY,values:a};case"copyit":return{type:bt.COPYIT,values:a};case"openit":return{type:bt.OPENIT,values:a};case"zssedit":return{type:bt.ZSSEDIT,values:a};case"charedit":return{type:bt.CHAREDIT,values:a};case"coloredit":return{type:bt.COLOREDIT,values:a}}}}function Un(e){switch(e){case bt.LOADER:return"loader";case bt.BOARD:return"board";case bt.OBJECT:return"object";case bt.TERRAIN:return"terrain";case bt.CHARSET:return"charset";case bt.PALETTE:return"palette";case bt.CONST:return"const";case bt.RANGE:return"range";case bt.SELECT:return"select";case bt.NUMBER:return"number";case bt.TEXT:return"text";case bt.LINK:return"link";case bt.HOTKEY:return"hotkey";case bt.COPYIT:return"copyit";case bt.OPENIT:return"openit";case bt.ZSSEDIT:return"zssedit";case bt.CHAREDIT:return"charedit";case bt.COLOREDIT:return"coloredit"}}var sf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(sf||{});function a_(e){return Us(e,sf,{bits:t=>Array.from(t)})}function c_(e){return Oo(e,sf,{bits:t=>new Uint8Array(t)})}function BO(e,t){return{id:Re(),code:e,...t}}var of=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(of||{});function FO(e){return Us(e,of,{board:u4,object:lc,terrain:lc,charset:a_,palette:a_,stats:Oe})}function DO(e){return Oo(e,of,{board:h4,object:uc,terrain:uc,charset:c_,palette:c_})}function el(e){const t={...is(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function $O(e){return T(e)?(e.stats=void 0,is(e)):{}}function l_(e){const t=o_(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===Vh){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),u=a.split(" "),l=PO(At(c)?c:"",u,r),h=Bt(l.values.join(" "));switch(r=!1,l.type){case bt.LOADER:n.type=Tt.LOADER,n.name=h;break;case bt.BOARD:n.type=Tt.BOARD,n.name=h;break;case bt.OBJECT:n.type=Tt.OBJECT,n.name=h||"object";break;case bt.TERRAIN:n.type=Tt.TERRAIN,n.name=h;break;case bt.CHARSET:n.type=Tt.CHARSET,n.name=h;break;case bt.PALETTE:n.type=Tt.PALETTE,n.name=h;break;case bt.CONST:{const[f,d]=l.values;if(At(f)){const p=Bt(f);if(At(d)){const g=parseFloat(d);n[p]=Lt(g)?g:d}else Lt(d)?n[p]=d:n[p]=1}break}case bt.RANGE:case bt.SELECT:case bt.NUMBER:case bt.TEXT:case bt.LINK:case bt.HOTKEY:case bt.ZSSEDIT:case bt.CHAREDIT:case bt.COLOREDIT:{const[f,...d]=l.values;if(At(f)){const p=Bt(f);n[p]=[Un(l.type),...d]}break}}}}return n}function is(e){var t;return T(e)?(T((t=e.stats)==null?void 0:t.type)||(e.stats=l_(e.code),T(e.stats.type)||(e.stats.type=Tt.OBJECT)),e.stats):{}}function u_(e){switch(e){default:case Tt.ERROR:return"error";case Tt.LOADER:return Un(bt.LOADER);case Tt.BOARD:return Un(bt.BOARD);case Tt.OBJECT:return Un(bt.OBJECT);case Tt.TERRAIN:return Un(bt.TERRAIN);case Tt.CHARSET:return Un(bt.CHARSET);case Tt.PALETTE:return Un(bt.PALETTE)}}function Ni(e){return is(e).type??Tt.ERROR}function nl(e){return u_(Ni(e))}function Pn(e){return is(e).name??""}function h_(e,t){return is(e)[t]}function af(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ie(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Gt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Gt.ISSWIM;break;case"issolid":t.collision=Gt.ISSOLID;break;case"isbullet":t.collision=Gt.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function ri(e){if(T(e))switch(Ni(e)){default:return;case Tt.ERROR:return e.code??"";case Tt.LOADER:return e.code??"";case Tt.BOARD:{T(e.board)||(e.board=l4()),e.board.id=e.id;const t=el(e);return e.board.isdark=t.isdark??e.board.isdark?1:0,e.board.startx=t.startx??e.board.startx,e.board.starty=t.starty??e.board.starty,e.board.over=t.over??e.board.over,e.board.under=t.under??e.board.under,e.board.exitnorth=t.exitnorth??e.board.exitnorth,e.board.exitsouth=t.exitsouth??e.board.exitsouth,e.board.exitwest=t.exitwest??e.board.exitwest,e.board.exiteast=t.exiteast??e.board.exiteast,e.board.timelimit=t.timelimit??e.board.timelimit,e.board.restartonzap=t.restartonzap??e.board.restartonzap,e.board.maxplayershots=t.maxplayershots??e.board.maxplayershots,e.board}case Tt.OBJECT:return T(e.object)||(e.object=im()),e.object.name=Pn(e),e.object.category=Dn.ISOBJECT,af(el(e),e.object),e.object;case Tt.TERRAIN:return T(e.terrain)||(e.terrain=im()),e.terrain.name=Pn(e),e.terrain.category=Dn.ISTERRAIN,af(el(e),e.terrain),e.terrain;case Tt.PALETTE:return T(e.palette)||(e.palette=om(ox)),e.palette;case Tt.CHARSET:return T(e.charset)||(e.charset=am(sx)),e.charset}}function f_(e){return{id:Re(),name:Y1(),timestamp:0,activelist:[],pages:e,flags:{}}}var cf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e))(cf||{});function jO(e){return Us(e,cf,{pages:t=>t.map(FO),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function zO(e){return Oo(e,cf,{pages:t=>t.map(DO)})}function Ws(e,t){if(!T(e))return;const n=Bt(t);return e.pages.find(i=>i.id===t||n===Pn(i))}function ii(e,t,n){if(!T(e))return;const r=Bt(n);return e.pages.find(s=>Ni(s)===t&&(s.id===n||r===Pn(s)))}function lf(e,t,n){let r=ii(e,t,n);if(!T(r)){const i=u_(t);r=BO(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),KO(e,r)}return r}function ss(e,t){return T(e)?e.pages.filter(n=>Ni(n)===t):[]}function Oi(e,t,n){return T(e)?e.pages.filter(r=>Ni(r)===t).filter(r=>{const i=is(r);return T(i[n])}):[]}function KO(e,t){if(!T(e)||!T(t))return!1;const n=Ws(e,t.id);return T(n)?!1:(e.pages.push(t),!0)}function WO(e,t){const n=Ws(e,t);if(T(e)&&T(n)){const r=Bt(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Pn(i)),n}}function Ci(e,t){if(T(t)&&T(t.kind))return T(t.kinddata)||(t.kinddata=T(t.id)?Zo(e,t.kind):uf(e,t.kind)),t.kinddata}function d_(e,t,n){const r=Ci(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function p_(e,t,n,r,i){const s=Ci(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function Zo(e,t){const n=t??"",r=ii(e,Tt.OBJECT,n);if(T(r)){const i=ri(r);return{...ur(i),name:n,code:r.code}}}function uf(e,t){const n=t??"",r=ii(e,Tt.TERRAIN,n);if(T(r)){const i=ri(r);return{...ur(i),name:n,code:r.code}}}function Gs(e,t){const n=Ws(e,t);return ri(n)}function si(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function m_(e,t){e&&delete e.flags[t]}function g_(e,t,n){const r=si(e,t);return r==null?void 0:r[n]}function GO(e,t,n,r){const i=si(e,t);return i&&(i[n]=r),r}function os(e,t){const n=g_(e,t,"board");return Gs(e,At(n)?n:"")}function HO(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function rl(e,t,n){if(!T(e))return;GO(e,t,"board",n);const r=Gs(e,n);T(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function Qo(e,t,n,r){if(!T(e))return;const i=os(e,t);if(!T(i))return;const s=vn(i,t);if(!Ju(s)||!(s!=null&&s.id))return;const o=Gs(e,n);if(!T(o)||(oi(e,o),ff(e,o,Gt.ISWALK,r)))return;delete i.objects[s.id];const a=Ur(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Ur(o,s);o.lookup&&(o.lookup[c]=s.id),rl(e,t,o.id)}function YO(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=g_(e,r,"board");return At(i)?i:""});return fk(n)}function hf(e){return YO(e).map(n=>Gs(e,n)).filter(T)}function ff(e,t,n,r){if(!T(e)||!T(t)||!T(t.lookup)||r.x<0||r.x>=Qt||r.y<0||r.y>=Ve)return!0;const i=r.x+r.y*Qt,s=vn(t,t.lookup[i]??"404");if(T(s))return!0;const o=t.terrain[i];if(T(o)){const a=Ci(e,o),c=o.collision??(a==null?void 0:a.collision);return zu(n,c)}return!1}function VO(e,t,n,r){const i=vn(t,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=d_(e,i,"collision");return ff(e,t,a,r)}function y_(e,t,n,r){var l,h;const i=vn(t,(n==null?void 0:n.id)??"");if(!T(e)||!T(t)||!T(i)||!T(i.x)||!T(i.y)||!T(t.lookup)||r.x<0||r.x>=Qt||r.y<0||r.y>=Ve)return{name:"edge",kind:"edge",collision:Gt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Ur(t,i),o=Ur(t,r),a=i.collision??((l=i==null?void 0:i.kinddata)==null?void 0:l.collision)??Gt.ISWALK,c=vn(t,t.lookup[o]??"");if(T(c))return{...c};const u=t.terrain[o];if(T(u)){const f=u.collision??((h=u==null?void 0:u.kinddata)==null?void 0:h.collision)??Gt.ISWALK;if(zu(a,f))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,T(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function df(e,t,n,r){var s;if(!T(e)||!T(t)||!T(t.named)||!T(n))return;const i=Bt(n.name??((s=n.kinddata)==null?void 0:s.name)??"");t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function qO(e,t,n){if(!(!T(e)||!T(t)||!T(t.lookup)||!T(n==null?void 0:n.id))&&!T(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*Qt]=n.id}}function oi(e,t){var a;if(!T(e)||!T(t)||T(t.lookup)&&T(t.named))return;const n=new Array(Qt*Ve).fill(void 0),r={},i=Object.values(t.objects);for(let c=0;c<i.length;++c){const u=i[c];if(T(u.x)&&T(u.y)&&T(u.id)&&!T(u.removed)){u.category=Dn.ISOBJECT,n[u.x+u.y*Qt]=u.id;const l=Bt(u.name??((a=u.kinddata)==null?void 0:a.name)??"");r[l]||(r[l]=new Set),r[l].add(u.id)}}let s=0,o=0;for(let c=0;c<t.terrain.length;++c){const u=t.terrain[c];if(T(u)){u.x=s,u.y=o,u.category=Dn.ISTERRAIN;const l=Ai(u);r[l]||(r[l]=new Set),r[l].add(c)}++s,s>=Qt&&(s=0,++o)}t.lookup=n,t.named=r}function ai(e,t,n,r){return!T(n)||Ai(n)==="player"?!1:(n.id?(n.removed=r,pf(e,t,n)):(fi(t,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),XO(e,t,n)),!0)}function XO(e,t,n){var r;if(T(e)&&T(t)&&T(n==null?void 0:n.x)&&T(n.y)){const i=Ai(n),s=Ur(t,n);T((r=t.named)==null?void 0:r[i])&&t.named[i].delete(s)}}function pf(e,t,n){var r;if(T(e)&&T(t)&&T(n==null?void 0:n.id)){if(T(t.lookup)&&T(n.x)&&T(n.y)){const s=n.x+n.y*Qt;t.lookup[s]===n.id&&(t.lookup[s]=void 0)}const i=Ai(n);T((r=t.named)==null?void 0:r[i])&&T(n.id)&&t.named[i].delete(n.id)}}function JO(e,t,n){const r=[];if(!T(e)||!T(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];T(o.id)&&T(o.removed)&&n-o.removed>ga*5&&(r.push(o.id),_1(t,o.id))}return r}function ZO(e,t,n){const r=[];if(!T(e)||!T(t))return r;t.lookup=void 0,oi(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!T(a.id))continue;a.lx=a.x,a.ly=a.y;const c=Ci(e,a),u=a.code??(c==null?void 0:c.code)??"";u&&r.push({id:a.id,type:Tt.OBJECT,code:u,object:a,terrain:void 0})}const s=JO(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:Tt.ERROR,code:"",object:void 0,terrain:void 0});return r}function QO(e,t,n,r){if(T(e)&&T(t)&&T(n)){const[i,s]=n,o=Zo(e,i);if(T(o)&&T(o.name)){const a=zf(t,r,i);return hc(a,s),a}}}function il(e,t,n,r,i){if(T(e)&&T(t)&&T(n)){const[s,o]=n,a=uf(e,s);if(T(a)){const u=d4(t,r,s);if(T(u)){hc(u,o);const l=Ya(r,Qt);return df(e,t,u,l),u}}const c=Zo(e,s);if(T(c)&&T(c.name)){const u=zf(t,r,s,i);if(T(u))return hc(u,o),qO(e,t,u),df(e,t,u),u}}}const tC=g0(32,126).map(e=>String.fromCharCode(e)),eC=Mn({name:"Whitespace",pattern:/ +/}),nC=Mn({name:"WhitespaceSkipped",pattern:/ +/,group:ze.SKIPPED}),mf=Mn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),__=Mn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:tC}),gf=Mn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),yf=Mn({name:"EscapedDollar",pattern:"$$"}),_f=Mn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Ef=Mn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),E_=Mn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function rC(e,t=""){return Mn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const b_=Object.keys(vo).map(e=>rC(`\\$(${e})`,e)),iC=[eC,mf,...b_,gf,__,Ef,yf,E_,_f],sC=new ze(iC,{skipValidations:!wr,ensureOptimizations:wr}),oC=new ze([nC,mf,...b_,gf,__,Ef,yf,E_,_f],{skipValidations:!wr,ensureOptimizations:wr});function bf(e,t=!1){return t?oC.tokenize(e):sC.tokenize(e)}function wf(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function w_(e){e.active={...e.reset}}function T_(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case yf:s("$");break;case Ef:if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r();break;case gf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case mf:{t.x=t.active.leftedge??0,++t.y;break}default:{const u=c.tokenType.name,l=vo[u],h=Ok(jt[l]),f=Ck(jt[l]);l==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):T(h)?t.active.color=h:T(f)?t.active.bg=f:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(T(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){w_(t);const u=String.fromCharCode(t.writefullwidth).repeat(c),l=t.x+t.y*t.width;cC(l,l+u.length,t.active.color,t.active.bg,t),aC(l,u,t)}}}function k_(e,t,n){const r=bf(e);r.tokens&&(T_(r.tokens,t),n&&w_(t),t.changed())}function x_(e,t,n){const r=bf(e);if(!r.tokens)return;const i=wf(t,n,jt.WHITE,jt.BLACK);return i.measureonly=!0,T_(r.tokens,i),i.x>0&&++i.y,i}function aC(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function cC(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function A_(e,t,n){if(!Qs(x.element))return 0;const[r,i]=it(t,0,[q.DIR,q.MAYBE_KIND]),s=i??["bullet"],o=QO(x.book,x.board,s,{x:x.element.x,y:x.element.y});if(T(o)){T(n)&&(o.arg=n),o.party=x.elementid,o.collision=Gt.ISBULLET,o.destructible=1,o.stepx=r.x-x.element.x,o.stepy=r.y-x.element.y,o.bg=jt.ONCLEAR;const a=Ci(x.book,o),c=o.code??(a==null?void 0:a.code)??"";f1(x.book,x.board,o,c,1)}return e.yield(),0}function sl(e,t,n,r){var h,f;if(!Qs(x.element)||!T(x.book)||!T(x.board)||!T(x.element))return 0;oi(x.book,x.board);const[i,s]=it(t,0,[q.DIR,q.KIND]),o=Pr(x.board,i);if((o==null?void 0:o.category)===Dn.ISOBJECT&&(o!=null&&o.pushable)){const d={x:((h=x.element)==null?void 0:h.x)??0,y:((f=x.element)==null?void 0:f.y)??0},p=We(i,Fi(d,i));y_(x.book,x.board,o,p)}const[a]=s,c=Zo(x.book,a)??uf(x.book,a),u=(c==null?void 0:c.collision)??Gt.ISWALK;if(!ff(x.book,x.board,u,i)){const d=il(x.book,x.board,s,i,n);T(d)&&T(r)&&(d.arg=r)}return 0}const lC=Vr().command("board",(e,t)=>{if(!T(x.book))return 0;const[n,r,i]=it(t,0,[q.NAME,q.MAYBE_NUMBER,q.MAYBE_NUMBER]),s=Oi(x.book,Tt.BOARD,n);if(s.length){const o=On(...s);T(o)&&Qo(x.book,x.elementfocus,o.id,{x:r??Math.round(Qt*.5),y:i??Math.round(Ve*.5)})}return 0}).command("edge",(e,t)=>{var s,o;if(!T(x.book)||!T(x.board)||!T(x.element))return 0;const[n,r]=it(t,0,[q.DIR,q.NAME]),i=Oi(x.book,Tt.BOARD,r);if(i.length){const a={x:((s=x.element)==null?void 0:s.x)??0,y:((o=x.element)==null?void 0:o.y)??0},c=Fi(a,n),u=On(...i);switch(c){case _t.NORTH:x.board.exitnorth=u.id;break;case _t.SOUTH:x.board.exitsouth=u.id;break;case _t.WEST:x.board.exitwest=u.id;break;case _t.EAST:x.board.exiteast=u.id;break}}return 0}).command("shove",(e,t)=>{if(!T(x.book)||!T(x.board))return 0;oi(x.book,x.board);const[n,r]=it(t,0,[q.DIR,q.DIR]),i=Pr(x.board,n);return Ju(i)&&Pf(x.book,x.board,i,r),0}).command("duplicate",()=>(!T(x.book)||!T(x.board),0)).command("replace",(e,t)=>{if(!T(x.book)||!T(x.board))return 0;oi(x.book,x.board);const[n,r]=it(t,0,[q.DIR,q.KIND]),i=Pr(x.board,n);return Ju(i)&&ai(x.book,x.board,i,x.timestamp),il(x.book,x.board,r,n),0}).command("write",(e,t)=>{var u;if(!T(x.book)||!T(x.board))return 0;oi(x.book,x.board);const[n,r,i]=it(t,0,[q.DIR,q.COLOR,q.STRING]),{color:s,bg:o}=v0(r),a=((u=x_(i,256,1))==null?void 0:u.measuredwidth)??1,c=wf(256,1,s??jt.WHITE,o??jt.BLACK);k_(i,c,!1);for(let l=0;l<a;++l){const h=fi(x.board,{x:n.x+l,y:n.y,char:c.char[l],color:c.color[l],bg:c.bg[l]});if(T(h)){const f=(h.x??0)+(h.y??0)*Qt;df(x.book,x.board,h,f)}}return 0}).command("change",(e,t)=>{if(!T(x.book)||!T(x.board))return 0;oi(x.book,x.board);const[n,r]=it(t,0,[q.KIND,q.KIND]),i=ec(n)??"",s=So(x.board,i),o=N0(s,n),a=ec(r),c=R0(r),u=I0(r);return o.forEach(l=>{if(Ai(l)===a)T(c)&&(l.color=c),T(u)&&(l.bg=u);else{if(T(l.id)&&ai(x.book,x.board,l,x.timestamp))return 0;Qs(l)&&il(x.book,x.board,r,l)}}),0}).command("putwith",(e,t)=>{const[n,r]=it(t,0,[q.ANY]);return sl(e,t.slice(r),void 0,n)}).command("put",(e,t)=>sl(e,t)).command("oneof",(e,t)=>{const[n,r]=it(t,0,[q.ANY]);return T(x.board)&&vn(x.board,n)?0:sl(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=it(t,0,[q.ANY,q.ANY]);return T(x.board)&&vn(x.board,r)?0:sl(e,t.slice(i),r,n)}).command("shootwith",(e,t)=>{const[n,r]=it(t,0,[q.ANY]);return A_(e,t.slice(r),n)}).command("shoot",A_),Li="$dkpurple",uC="$196",hC="$205";function dn(e,t){return`$${e}${t}$blue`}function v_(e,t){return`$${e}${t}$ondkblue`}function se(e,t){hr(e,t)}function fC(e,t){const n=uC.repeat(t);se(e,`${Li}${n}`)}function Tf(e,t){const n=hC.repeat(t);se(e,`${Li}${n}`)}function ta(e,t){se(e,`${Li} ${" ".repeat(t.length)} `),fC(e,t.length+2),se(e,`${Li} $white${t} `),Tf(e,t.length+2)}function ci(e,t){se(e,`${Li} ${" ".repeat(t.length)} `),se(e,`${Li} $gray${t} `),Tf(e,t.length+2)}function te(e,t,n){se(e,`${Li} $white${t} $blue${n}`)}function ee(e,t){se(e,`${Li}$blue${t}`)}function S_(e){const[t,n]=e.split(":"),r=T(n);return[r?t:"self",r?n:e]}const dC=navigator.userAgent.includes("Mac")?"cmd":"ctrl";function ea(){Bl(H,hi())}const pC=Vr().command("send",(e,t)=>{const[n,r]=it(t,0,[q.NAME,q.ANY]);switch(Bt(n)){case"helpmenu":ta(H,"H E L P"),se(H,""),te(H,"#help controls","zss controls and inputs"),se(H,"!helpcontrols;read help controls"),se(H,""),te(H,"#help text","text formatting"),se(H,"!helptext;read help text"),se(H,""),te(H,"#help developer","developer commands"),se(H,"!helpdeveloper;read help developer"),se(H,""),te(H,"#help player","player settings"),se(H,"!helpplayer;read help player"),ci(H,"keyboard input"),te(H,"?","open console"),te(H,"esc","close console"),te(H,"tab","move console"),te(H,"up / down arrow keys","navigate console items"),te(H,"left / right arrow keys","change console items"),te(H,"enter","interact with console items"),te(H,"alt + arrow keys","skip words and console lines"),te(H,`${dC} + up / down arrow keys`,"input history");break;case"helpcontrols":ta(H,"zss controls and inputs"),ci(H,"keyboard input"),te(H,"arrow keys","move"),te(H,"shift + arrow keys","shoot"),te(H,"enter","ok / accept"),te(H,"escape","cancel / close"),te(H,"tab","menu / action"),ci(H,"mouse input"),ee(H,"todo ???"),ci(H,"controller input"),te(H,"left stick","move"),te(H,"right stick","aim"),te(H,"a","ok / accept"),te(H,"b","cancel / close"),te(H,"y","menu / action"),te(H,"x","shoot"),te(H,"triggers","shoot");break;case"helptext":ta(H,"text formatting"),ci(H,"typography"),ee(H,"plain text"),ee(H,"$centering text"),ee(H,'"\\"@quoted strings for special chars\\""'),ee(H,"$$0-255 for ascii chars $159$176$240"),ee(H,`use color names like ${dn("red","$$red")} to change foreground color`),ee(H,`use color names like ${v_("ongreen","$$ongreen")} to change background color`),ee(H,`use clear ${v_("onclear","to change background to")} transparent`),ci(H,"hyperlinks"),ee(H,`${dn("white",'"!hotkey"')} message shortcut;${dn("gray","Label")}`),ee(H,`${dn("white",'"!range"')} flag [labelmin] [labelmax];${dn("gray","Input Label")}`),ee(H,`${dn("white",'"!select"')} flag ...list of values;${dn("gray","Input Label")}`),ee(H,`${dn("white",'"!number"')} flag [minvalue] [maxvalue];${dn("gray","Input Label")}`),ee(H,`${dn("white",'"!text"')} flag;${dn("gray","Input Label")}`),ee(H,`${dn("white",'"!copyit"')} flag;${dn("gray","Input Label")}`),ee(H,`${dn("white",'"!openit"')} flag;${dn("gray","Input Label")}`);break;case"helpdeveloper":ta(H,"developer commands"),te(H,"#books","list books in memory"),te(H,"#pages","list pages in opened book"),te(H,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),te(H,"#trash","list books and pages from open book you can delete"),te(H,"#save","flush state to register");break;case"helpplayer":ta(H,"player settings"),ee(H,"todo");break;default:{const[i,s]=S_(n);Bf(i==="self"&&x.elementisplayer?`${x.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(Ee),s=i.join(" ");switch(Bt(r)){case Un(bt.LOADER):n=Bi(Kt.CONTENT,s,Tt.LOADER);break;default:n=Bi(Kt.CONTENT,[r,...i].join(" "),Tt.OBJECT);break;case Un(bt.BOARD):n=Bi(Kt.CONTENT,s,Tt.BOARD);break;case Un(bt.OBJECT):n=Bi(Kt.CONTENT,s,Tt.OBJECT);break;case Un(bt.TERRAIN):n=Bi(Kt.CONTENT,s,Tt.TERRAIN);break;case Un(bt.CHARSET):n=Bi(Kt.CONTENT,s,Tt.CHARSET);break;case Un(bt.PALETTE):n=Bi(Kt.CONTENT,s,Tt.PALETTE);break}return T(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(Ee).join(" ");return hr(H,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Ee(n),s=r.map(Ee).join(" ");return hr(H,`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=it(t,0,[q.MAYBE_NAME]),r=c1(n);return T(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=Pi(n);return T(r)?(ee(H,`opened [book] ${r.name}`),_l(Kt.MAIN,r.id),e.command("pages")):ae(H,"bookopen",`book ${n} not found`,x.elementfocus),0}).command("booktrash",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=ke(Kt.MAIN),i=Pi(n);return T(i)&&(r===i&&_l(Kt.MAIN,""),XL(n),ee(H,`trashed [book] ${i.name}`),ea(),e.command("pages")),0}).command("pageopen",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=Fn(Kt.MAIN);if(!T(r))return 0;const i=Ws(r,n);if(T(i)){const s=Pn(i),o=nl(i);ee(H,`opened [${o}] ${s}`),Lu(ma(r.id,[i.id]),i.code);const a=nl(i);ld(H,r.id,[i.id],a,`${s} - ${r.name}`,x.elementfocus)}else ae(H,"pageopen",`page ${n} not found`,x.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=Fn(Kt.MAIN),i=WO(r,n);if(T(n)){const s=Pn(i),o=nl(i);ee(H,`trashed [${o}] ${s}`),ea(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(Ee).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{ci(H,"books");const e=ke(Kt.MAIN);te(H,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=ke(Kt.CONTENT);te(H,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Tf(H,7);const n=aa();return n.length?n.forEach(r=>{se(H,`!bookopen ${r.id};${r.name}`)}):ee(H,"no books found"),se(H,"!bookcreate;create a new book"),0}).command("pages",()=>{ci(H,"pages");const e=Fn(Kt.MAIN);return T(e)&&(te(H,"main",`${e.name} $GREEN${e.id}`),e.pages.length?[...e.pages].sort((n,r)=>{const i=Ni(n),s=Ni(r);return i===s?Pn(n).localeCompare(Pn(r)):s-i}).forEach(n=>{const r=Pn(n),i=nl(n);se(H,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(se(H,""),ee(H,"no pages found"),ee(H,"use @ to create a page"),ee(H,"@board name of board"),ee(H,"@object name of object"),ee(H,"@terrain name of terrain"),ee(H,"You can omit the type and it will default to object"),ee(H,"@object name of object"),ee(H,"@name of object"))),0}).command("trash",()=>{ci(H,"$REDTRASH"),ee(H,"books");const e=aa();e.length&&(e.forEach(n=>{se(H,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),se(H,""));const t=ke(Kt.MAIN);return T(t)&&(ee(H,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Pn(n);se(H,`!pagetrash ${n.id};$REDTRASH ${r}`)}),se(H,"")),0}).command("dev",()=>(ea(),NE(H,x.elementfocus),0)).command("share",()=>(ea(),OE(H,x.elementfocus),0)).command("save",()=>(ea(),0)).command("fork",()=>(WE(H,x.elementfocus),0)).command("nuke",()=>(CE(H,x.elementfocus),0)).command("restart",()=>(KE(H,x.elementfocus),0)).command("gadget",()=>(jE(H,void 0,x.elementfocus),0)).command("joincode",(e,t)=>{const[n]=it(t,0,[q.MAYBE_NAME]);return AE(H,!!n,x.elementfocus),0}).command("twitchbroadcast",(e,t)=>{const[n]=it(t,0,[q.NAME]);switch(Bt(n)){default:yE(H,n,x.elementfocus);break;case"stop":_E(H,x.elementfocus);break}return 0}),mC=Vr().command("palette",(e,t)=>{const[n,r]=it(t,0,[q.NAME]),i=l1(),s=ju(Bt(n));if(T(s)){const o=x0([s]);if(!T(o))return 0;const[a,c,u]=it(t,r,[q.NUMBER,q.NUMBER,q.NUMBER]),l=Bi(Kt.MAIN,At(i.palette)?i.palette:Kt.MAIN,Tt.PALETTE),h=ri(l);if(T(h)&&o>=0&&o<=16){const f=o*qa;h.bits[f+0]=Nn(a,0,63),h.bits[f+1]=Nn(c,0,63),h.bits[f+2]=Nn(u,0,63)}T(l)&&(i.palette=l.id)}else{const o=ii(x.book,Tt.PALETTE,n);T(o)?(i.palette=o.id,se(H,`loaded palette ${n}`)):ae(H,"not-found",`unabled to find palette ${n}`)}return 0}).command("charset",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=l1(),i=ii(x.book,Tt.CHARSET,n);return T(i)?(r.charset=i.id,se(H,`loaded charset ${n}`)):ae(H,"not-found",`unabled to find charset ${n}`),0}),kf={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Cr(e){return ie(e)&&R_(e[0])}function R_(e){return T(Dn[e])&&At(e)}function I_(e){if(At(e))return kf[Bt(e)]}function N_(e){if(Cr(e))return e;if(R_(e))return[e];const t=I_(e);if(T(t))return[t]}function ol(e){const t=x.words[e],n=N_(t);if(Cr(n))return[n,e+1];const[r,i]=on(e),s=N_(r);return Cr(s)?[s,i]:[void 0,e]}const xf={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Gt.ISSOLID,Gt.ISWALK,Gt.ISSWIM,Gt.ISBULLET,Gt.ISWALK,Gt.ISSWIM;function li(e){return ie(e)&&Af(e[0])}function Af(e){return T(Gt[e])&&At(e)}function gC(e){if(At(e))return xf[Bt(e)]}function O_(e){const t=x.words[e];if(li(t))return[t,e+1];if(Af(t))return[[t],e+1];const[n,r]=on(e);return li(n)?[n,r]:Af(n)?[[n],r]:[void 0,e]}const yC=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),C_=new Set(["party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),_C=["NORTH","SOUTH","WEST","EAST"];function EC(e){const t=ls(e);if(Lt(t.inputcurrent)||(t.inputcurrent=0),ie(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=ln.NONE,i=0]=n??[ln.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&xk?1:0,t.inputctrl=i&Ak?1:0,t.inputshift=i&vk?1:0,r){case ln.MOVE_UP:case ln.MOVE_DOWN:case ln.MOVE_LEFT:case ln.MOVE_RIGHT:t.inputmove=[_C[r-ln.MOVE_UP]];break;case ln.OK_BUTTON:t.inputok=1;break;case ln.CANCEL_BUTTON:t.inputcancel=1;break;case ln.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==ln.NONE&&o!==r}),t}function bC(e){const t=kf[e];if(T(t))return t;const n=xf[e];if(T(n))return n;const r=vo[e];if(T(r))return r;const i=Ff[e];if(T(i))return i}const wC=Vr({get(e,t){var o,a,c,u,l,h,f,d,p,g,w,b,k,v,N,P,L;const n=bC(t);if(T(n))return[!0,n];if(x.elementisplayer&&yC.has(t)){const C=EC(x.elementid)[t];return[T(C),C]}const r=nc(x.board,x.element,x.elementfocus),i=(r==null?void 0:r.id)??x.elementfocus;switch(t){case"isdark":return[!0,(o=x.board)!=null&&o.isdark?1:0];case"startx":return[!0,((a=x.board)==null?void 0:a.startx)??0];case"starty":return[!0,((c=x.board)==null?void 0:c.starty)??0];case"over":return[!0,((u=x.board)==null?void 0:u.over)??""];case"under":return[!0,((l=x.board)==null?void 0:l.under)??""];case"exitnorth":return[!0,((h=x.board)==null?void 0:h.exitnorth)??""];case"exitsouth":return[!0,((f=x.board)==null?void 0:f.exitsouth)??""];case"exitwest":return[!0,((d=x.board)==null?void 0:d.exitwest)??""];case"exiteast":return[!0,((p=x.board)==null?void 0:p.exiteast)??""];case"timelimit":return[!0,((g=x.board)==null?void 0:g.timelimit)??0];case"restartonzap":return[!0,((w=x.board)==null?void 0:w.restartonzap)??0];case"maxplayershots":return[!0,((b=x.board)==null?void 0:b.maxplayershots)??0];case"boardid":return[!0,((k=x.board)==null?void 0:k.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((v=x.element)==null?void 0:v.id)??""];case"thisx":return[!0,((N=x.element)==null?void 0:N.x)??-1];case"thisy":return[!0,((P=x.element)==null?void 0:P.y)??-1];default:{const C=(L=x.element)==null?void 0:L[t];if(C_.has(t))return[!0,C];break}}const s=ls(i)[t];return[T(s),s]},set(e,t,n){const r=nc(x.board,x.element,x.elementfocus),i=(r==null?void 0:r.id)??x.elementfocus;switch(t){case"isdark":T(x.board)&&(x.board.isdark=n?1:0);break;case"startx":T(x.board)&&(x.board.startx=Ao(n,0));break;case"starty":T(x.board)&&(x.board.starty=Ao(n,0));break;case"over":T(x.board)&&(x.board.over=Ee(n));break;case"under":T(x.board)&&(x.board.under=Ee(n));break;case"exitnorth":T(x.board)&&(x.board.exitnorth=Ee(n));break;case"exitsouth":T(x.board)&&(x.board.exitsouth=Ee(n));break;case"exitwest":T(x.board)&&(x.board.exitwest=Ee(n));break;case"exiteast":T(x.board)&&(x.board.exiteast=Ee(n));break;case"timelimit":T(x.board)&&(x.board.timelimit=Ao(n,0));break;case"restartonzap":T(x.board)&&(x.board.restartonzap=n?1:0);break;case"maxplayershots":T(x.board)&&(x.board.maxplayershots=Ao(n,0));break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(C_.has(t))return T(x.element)&&(x.element[t]=n),[!0,n];break}}const s=ls(i);return T(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r;if((e=x.element)!=null&&e.stepx||(t=x.element)!=null&&t.stepy){const i={x:((n=x.element)==null?void 0:n.x)??0,y:((r=x.element)==null?void 0:r.y)??0};Pf(x.book,x.board,x.element,{x:i.x+(x.element.stepx??0),y:i.y+(x.element.stepy??0)})===!1&&(x.element.stepx=0,x.element.stepy=0,d_(x.book,x.element,"destructible")&&ai(x.book,x.board,x.element,x.timestamp))}}}).command("clear",(e,t)=>(t.forEach(n=>e.set(Ee(n),0)),0)).command("set",(e,t)=>{const[n,r]=it(t,0,[q.NAME,q.ANY]);return e.set(n,r),0}).command("become",(e,t)=>{var r,i;const[n]=it(t,0,[q.KIND]);if(oi(x.book,x.board),pf(x.book,x.board,x.element),ai(x.book,x.board,x.element,x.timestamp)){const s={x:((r=x.element)==null?void 0:r.x)??0,y:((i=x.element)==null?void 0:i.y)??0};il(x.book,x.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=it(t,0,[q.NUMBER]);return T(x.element)&&(x.element.char=n),0}).command("color",(e,t)=>{const[n]=it(t,0,[q.COLOR]);return T(x.element)&&T(n)&&hc(x.element,n),0}).command("go",(e,t)=>{if(T(x.element)){const[n]=it(t,0,[q.DIR]);if(Pf(x.book,x.board,x.element,n),e.yield(),x.element.x===n.x&&x.element.y===n.y)return 0}return 1}).command("walk",(e,t)=>{if(!T(x.element))return 0;const[n]=it(t,0,[q.DIR]),r=x.element.x??0,i=x.element.y??0;return x.element.stepx=n.x-r,x.element.stepy=n.y-i,0}),TC=Vr().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=it(t,0,[q.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Ee(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Ee(t[0])),0)).command("cycle",(e,t)=>{if(T(x.element)){const[n]=it(t,0,[q.NUMBER]);x.element.cycle=Nn(Math.round(n),1,255)}return 0}).command("die",e=>(ai(x.book,x.board,x.element,x.timestamp),e.endofprogram(),0)).command("endgame",()=>(x.elementisplayer&&ud(H,x.elementid),0)).command("run",(e,t)=>{const[n]=it(t,0,[q.NAME]);return El(n),0}).command("runwith",(e,t)=>{const[n,r]=it(t,0,[q.ANY,q.NAME]);return e.set("arg",n),El(r),0}),al={};function kC(e){var t;return(t=al[e])==null?void 0:t.arg}function xC(e){var t;return(t=al[e])==null?void 0:t.format}function Hs(e){var t;return(t=al[e])==null?void 0:t.content}function AC(e,t,n,r,i){const s=ke(Kt.MAIN);if(!T(s))return;const o=ss(s,Tt.LOADER).filter(a=>{const c=is(a),u=c.format,l=At(u)?new RegExp(u).test(t):!1,h=c.event,f=At(h)?new RegExp(h).test(n):!1;return At(u)&&At(h)?l&&f:At(u)?l:At(h)?f:!1});for(let a=0;a<o.length;++a){const c=`${Re()}_loader`;al[c]={arg:e,format:t,content:r,player:i},e4(c,o[a].code)}}function L_(e,t){if(!T(e))return;const n=Bt(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const vC=(e,t)=>{const n=Hs(e.id());if(!T(n))return 0;const[r,i]=it(t,0,[q.NAME]),s=Bt(r);switch(s){case"seek":{const[o]=it(t,i,[q.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=it(t,i,[q.NAME]);e.set(o,L_(n,s));break}case"text":{const[o,a]=it(t,i,[q.NAME,q.NAME]),c=L_(n,o);if(Lt(c)&&At(a)){const u=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(u);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=it(t,i,[q.NAME]),a=lf(x.book,Tt.PALETTE,o),c=ri(a);if(T(c)){const u=yk*qa,l=om(new Uint8Array(n.bytes.buffer,n.cursor,u));T(l)&&(c.bits=l.bits),n.cursor+=u}break}case"charset":{const[o]=it(t,i,[q.NAME]),a=lf(x.book,Tt.CHARSET,o),c=ri(a);if(T(c)){const u=Za*gk*$u,l=am(new Uint8Array(n.bytes.buffer,n.cursor,u));T(l)&&(c.bits=l.bits),n.cursor+=u}break}}return 0},Ys=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",cl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!cl(e[n],t[n]))return!1;return!0}if(Ys(e)&&Ys(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!cl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},ll=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(Ys(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},SC=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",M_=e=>e>="0"&&e<="9"||e==="-",RC=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var Y;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(Y||(Y={}));const U_={"(":Y.TOK_LPAREN,")":Y.TOK_RPAREN,"*":Y.TOK_STAR,",":Y.TOK_COMMA,".":Y.TOK_DOT,":":Y.TOK_COLON,"@":Y.TOK_CURRENT,$:Y.TOK_ROOT,"]":Y.TOK_RBRACKET,"{":Y.TOK_LBRACE,"}":Y.TOK_RBRACE},IC={"!":!0,"<":!0,"=":!0,">":!0},NC={"	":!0,"\n":!0,"\r":!0," ":!0};class OC{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(SC(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:Y.TOK_UNQUOTEDIDENTIFIER,value:i});else if(U_[t[this._current]]!==void 0)n.push({start:this._current,type:U_[t[this._current]],value:t[this._current]}),this._current+=1;else if(M_(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:Y.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:Y.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:Y.TOK_LITERAL,value:o})}else if(IC[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(NC[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:Y.TOK_AND,value:"&&"})):n.push({start:r,type:Y.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:Y.TOK_OR,value:"||"})):n.push({start:r,type:Y.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&RC(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;M_(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:Y.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:Y.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:Y.TOK_FLATTEN,value:"[]"}):{start:n,type:Y.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_NE,value:"!="}):{start:n,type:Y.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_LTE,value:"<="}):{start:n,type:Y.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_GTE,value:">="}):{start:n,type:Y.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:Y.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const CC=new OC,sn={[Y.TOK_EOF]:0,[Y.TOK_UNQUOTEDIDENTIFIER]:0,[Y.TOK_QUOTEDIDENTIFIER]:0,[Y.TOK_RBRACKET]:0,[Y.TOK_RPAREN]:0,[Y.TOK_COMMA]:0,[Y.TOK_RBRACE]:0,[Y.TOK_NUMBER]:0,[Y.TOK_CURRENT]:0,[Y.TOK_EXPREF]:0,[Y.TOK_ROOT]:0,[Y.TOK_PIPE]:1,[Y.TOK_OR]:2,[Y.TOK_AND]:3,[Y.TOK_EQ]:5,[Y.TOK_GT]:5,[Y.TOK_LT]:5,[Y.TOK_GTE]:5,[Y.TOK_LTE]:5,[Y.TOK_NE]:5,[Y.TOK_FLATTEN]:9,[Y.TOK_STAR]:20,[Y.TOK_FILTER]:21,[Y.TOK_DOT]:40,[Y.TOK_NOT]:45,[Y.TOK_LBRACE]:50,[Y.TOK_LBRACKET]:55,[Y.TOK_LPAREN]:60};class LC{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==Y.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...CC.tokenize(t),{type:Y.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<sn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case Y.TOK_LITERAL:return{type:"Literal",value:t.value};case Y.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case Y.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===Y.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case Y.TOK_NOT:return r=this.expression(sn.Not),{type:"NotExpression",children:[r]};case Y.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===Y.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(sn.Star),{type:"ValueProjection",children:[n,r]};case Y.TOK_FILTER:return this.led(t.type,{type:"Identity"});case Y.TOK_LBRACE:return this.parseMultiselectHash();case Y.TOK_FLATTEN:return n={type:Y.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(sn.Flatten),{type:"Projection",children:[n,r]};case Y.TOK_LBRACKET:return this.lookahead(0)===Y.TOK_NUMBER||this.lookahead(0)===Y.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===Y.TOK_STAR&&this.lookahead(1)===Y.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(sn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case Y.TOK_CURRENT:return{type:Y.TOK_CURRENT};case Y.TOK_ROOT:return{type:Y.TOK_ROOT};case Y.TOK_EXPREF:return i=this.expression(sn.Expref),{type:"ExpressionReference",children:[i]};case Y.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==Y.TOK_RPAREN;)this.lookahead(0)===Y.TOK_CURRENT?(i={type:Y.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(Y.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case Y.TOK_DOT:const i=sn.Dot;return this.lookahead(0)!==Y.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case Y.TOK_PIPE:return r=this.expression(sn.Pipe),{type:Y.TOK_PIPE,children:[n,r]};case Y.TOK_OR:return r=this.expression(sn.Or),{type:"OrExpression",children:[n,r]};case Y.TOK_AND:return r=this.expression(sn.And),{type:"AndExpression",children:[n,r]};case Y.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==Y.TOK_RPAREN;)this.lookahead(0)===Y.TOK_CURRENT?(a={type:Y.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===Y.TOK_COMMA&&this.match(Y.TOK_COMMA),o.push(a);return this.match(Y.TOK_RPAREN),{name:s,type:"Function",children:o};case Y.TOK_FILTER:const u=this.expression(0);return this.match(Y.TOK_RBRACKET),r=this.lookahead(0)===Y.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(sn.Filter),{type:"FilterProjection",children:[n,r,u]};case Y.TOK_FLATTEN:const l={type:Y.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(sn.Flatten);return{type:"Projection",children:[l,h]};case Y.TOK_EQ:case Y.TOK_NE:case Y.TOK_GT:case Y.TOK_GTE:case Y.TOK_LT:case Y.TOK_LTE:return this.parseComparator(n,t);case Y.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===Y.TOK_NUMBER||f.type===Y.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(Y.TOK_STAR),this.match(Y.TOK_RBRACKET),r=this.parseProjectionRHS(sn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===Y.TOK_COLON||this.lookahead(1)===Y.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(Y.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(sn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==Y.TOK_RBRACKET&&n<3;){if(r===Y.TOK_COLON)n+=1,this.advance();else if(r===Y.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(Y.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(sn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([Y.TOK_UNQUOTEDIDENTIFIER,Y.TOK_QUOTEDIDENTIFIER,Y.TOK_STAR].includes(n))return this.expression(t);if(n===Y.TOK_LBRACKET)return this.match(Y.TOK_LBRACKET),this.parseMultiselectList();if(n===Y.TOK_LBRACE)return this.match(Y.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(sn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===Y.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===Y.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===Y.TOK_DOT)return this.match(Y.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==Y.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===Y.TOK_COMMA&&(this.match(Y.TOK_COMMA),this.lookahead(0)===Y.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(Y.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[Y.TOK_UNQUOTEDIDENTIFIER,Y.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(Y.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===Y.TOK_COMMA)this.match(Y.TOK_COMMA);else if(this.lookahead(0)===Y.TOK_RBRACE){this.match(Y.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const MC=new LC;var ct;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ct||(ct={}));class UC{constructor(t){this.TYPE_NAME_TABLE={[ct.TYPE_NUMBER]:"number",[ct.TYPE_ANY]:"any",[ct.TYPE_STRING]:"string",[ct.TYPE_ARRAY]:"array",[ct.TYPE_OBJECT]:"object",[ct.TYPE_BOOLEAN]:"boolean",[ct.TYPE_EXPREF]:"expression",[ct.TYPE_NULL]:"null",[ct.TYPE_ARRAY_NUMBER]:"Array<number>",[ct.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>Ys(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ct.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ct.TYPE_NUMBER,ct.TYPE_STRING]);let o=-1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c>o&&(o=c,a=i[u]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ct.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ct.TYPE_NUMBER,ct.TYPE_STRING]);let o=1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c<o&&(o=c,a=i[u]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ct.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ct.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ct.TYPE_NUMBER,ct.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,u)=>{const l=i.visit(s,c[1]),h=i.visit(s,u[1]);if(this.getTypeName(l)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(l)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return l>h?1:l<h?-1:c[0]-u[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ct.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ct.TYPE_NUMBER?n:r===ct.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ct.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ct.TYPE_NUMBER:return"number";case ct.TYPE_STRING:return"string";case ct.TYPE_ARRAY:return"array";case ct.TYPE_OBJECT:return"object";case ct.TYPE_BOOLEAN:return"boolean";case ct.TYPE_EXPREF:return"expref";case ct.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ct.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ct.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ct.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ct.TYPE_STRING,ct.TYPE_ARRAY]},{types:[ct.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ct.TYPE_STRING]},{types:[ct.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ct.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ct.TYPE_STRING]},{types:[ct.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ct.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ct.TYPE_STRING,ct.TYPE_ARRAY,ct.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ct.TYPE_EXPREF]},{types:[ct.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ct.TYPE_ARRAY_NUMBER,ct.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ct.TYPE_ARRAY]},{types:[ct.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ct.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ct.TYPE_ARRAY_NUMBER,ct.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ct.TYPE_ARRAY]},{types:[ct.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ct.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ct.TYPE_STRING,ct.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ct.TYPE_ARRAY_STRING,ct.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ct.TYPE_ARRAY]},{types:[ct.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ct.TYPE_STRING]},{types:[ct.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ct.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ct.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ct.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ct.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ct.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ct.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(g=>{var w;return(w=!g.optional)!==null&&w!==void 0?w:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,u=n.length<a,l=n.length>r.length,h=u&&(!c&&a>1||c)?"at least ":"";if(c&&u||!c&&(u||l))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let f,d,p;for(let g=0;g<r.length;g+=1){p=!1,f=r[g].types,d=this.getTypeName(n[g]);let w;for(w=0;w<f.length;w+=1)if(d!==void 0&&this.typeMatches(d,f[w],n[g])){p=!0;break}if(!p&&d!==void 0){const b=f.map(k=>this.TYPE_NAME_TABLE[k]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${g+1} to be type (${b}) but received type ${this.TYPE_NAME_TABLE[d]} instead.`)}}}typeMatches(t,n,r){if(n===ct.TYPE_ANY)return!0;if(n===ct.TYPE_ARRAY_STRING||n===ct.TYPE_ARRAY_NUMBER||n===ct.TYPE_ARRAY){if(n===ct.TYPE_ARRAY)return t===ct.TYPE_ARRAY;if(t===ct.TYPE_ARRAY){let i;n===ct.TYPE_ARRAY_NUMBER?i=ct.TYPE_NUMBER:n===ct.TYPE_ARRAY_STRING&&(i=ct.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ct.TYPE_STRING;case"[object Number]":return ct.TYPE_NUMBER;case"[object Array]":return ct.TYPE_ARRAY;case"[object Boolean]":return ct.TYPE_BOOLEAN;case"[object Null]":return ct.TYPE_NULL;case"[object Object]":return t.jmespathType===Y.TOK_EXPREF?ct.TYPE_EXPREF:ct.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class PC{constructor(){this._rootValue=null,this.runtime=new UC(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,u,l,h,f,d;switch(t.type){case"Field":return n===null?null:Ys(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),f=1;f<t.children.length;f+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return u=this.visit(t.children[0],n),l=this.visit(t.children[1],u),l;case"Index":if(!Array.isArray(n))return null;let p=t.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const g=[...t.children],w=this.computeSliceParams(n.length,g),[b,k,v]=w;if(s=[],v>0)for(f=b;f<k;f+=v)s.push(n[f]);else for(f=b;f>k;f+=v)s.push(n[f]);return s;case"Projection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;for(h=[],f=0;f<d.length;f+=1)i=this.visit(t.children[1],d[f]),i!==null&&h.push(i);return h;case"ValueProjection":if(d=this.visit(t.children[0],n),!Ys(d))return null;h=[];const N=Object.values(d);for(f=0;f<N.length;f+=1)i=this.visit(t.children[1],N[f]),i!==null&&h.push(i);return h;case"FilterProjection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;const P=[],L=[];for(f=0;f<d.length;f+=1)r=this.visit(t.children[2],d[f]),ll(r)||P.push(d[f]);for(let U=0;U<P.length;U+=1)i=this.visit(t.children[1],P[U]),i!==null&&L.push(i);return L;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case Y.TOK_EQ:s=cl(o,a);break;case Y.TOK_NE:s=!cl(o,a);break;case Y.TOK_GT:s=o>a;break;case Y.TOK_GTE:s=o>=a;break;case Y.TOK_LT:s=o<a;break;case Y.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case Y.TOK_FLATTEN:const C=this.visit(t.children[0],n);if(!Array.isArray(C))return null;let W=[];for(f=0;f<C.length;f+=1)i=C[f],Array.isArray(i)?W=[...W,...i]:W.push(i);return W;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],f=0;f<t.children.length;f+=1)h.push(this.visit(t.children[f],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let M;for(f=0;f<t.children.length;f+=1)M=t.children[f],h[M.name]=this.visit(M.value,n);return h;case"OrExpression":return r=this.visit(t.children[0],n),ll(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),ll(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),ll(o);case"Literal":return t.value;case Y.TOK_PIPE:return u=this.visit(t.children[0],n),this.visit(t.children[1],u);case Y.TOK_CURRENT:return n;case Y.TOK_ROOT:return this._rootValue;case"Function":const et=[];for(let U=0;U<t.children.length;U+=1)et.push(this.visit(t.children[U],n));return this.runtime.callFunction(t.name,et);case"ExpressionReference":const pt=t.children[0];return pt.jmespathType=Y.TOK_EXPREF,pt;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const BC=new PC;ct.TYPE_ANY,ct.TYPE_ARRAY,ct.TYPE_ARRAY_NUMBER,ct.TYPE_ARRAY_STRING,ct.TYPE_BOOLEAN,ct.TYPE_EXPREF,ct.TYPE_NULL,ct.TYPE_NUMBER,ct.TYPE_OBJECT,ct.TYPE_STRING;function FC(e,t){const n=MC.parse(t);return BC.search(n,e)}const DC=(e,t)=>{const n=Hs(e.id());if(!T(n))return 0;const[r,i]=it(t,0,[q.NAME,q.NAME]),s=FC(n.json,r);return e.set(i,s),0},$C=(e,t)=>{const n=Hs(e.id());if(!T(n))return 0;const[r,i]=it(t,0,[q.NAME]);switch(Bt(r)){case"seek":{const[o]=it(t,i,[q.NUMBER]);n.cursor=Nn(o,0,n.lines.length-1);break}case"line":n.cursor=Nn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let u=1;for(let l=i;l<t.length;){const[h,f]=it(t,l,[q.NAME]);e.set(h,c[u]??0),++u,l=f}break}}return 0},jC=Vr({get(e,t){const n=xC(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=Hs(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=Hs(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=Hs(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=it(t,0,[q.NAME,q.ANY]);return Bf(n,r),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Ee).join(" ");return hr(H,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Ee(n),s=r.map(Ee).join(" ");return hr(H,"$175",`!${s};${i}`),0}).command("txt",$C).command("json",DC).command("bin",vC).command("with",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=Oi(x.book,Tt.BOARD,n);if(r.length){const i=On(...r);T(i)&&(x.board=ri(i),x.element={x:Ti(0,Qt-1),y:Ti(0,Ve-1)})}return 0});function P_(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,u]=it(i,a,[q.ANY]);ie(c)&&!lr(c)&&!Cr(c)&&!li(c)&&!Cn(c)?o.push(...c):o.push(c),a=u}switch(Bt(r)){case"get":case"post:json":xE(H,e,t,n,r,o,x.elementfocus);break}return 0}const zC=Vr().command("fetch",(e,t)=>{const[n,r,i="get",s]=it(t,0,[q.NAME,q.NAME,q.MAYBE_STRING]);return P_(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=it(t,0,[q.ANY,q.NAME,q.NAME,q.MAYBE_STRING]);return P_(n,r,i,s,t,o),0}).command("twitchchat",(e,t)=>{const[n]=it(t,0,[q.ANY]);switch(Bt(n)){default:EE(H,n,x.elementfocus);break;case"close":bE(H,x.elementfocus);break}return 0}),KC=Vr({set(e,t,n){return b4(e,t,n),[!1,void 0]},everytick(){const e=Br(x.elementid),[t]=e;if(e.length===1&&At(t)){if(T(x.element))if(t.trim().length===0){const n=mn(x.elementid);n.sidebar=[]}else x.element.tickertext=t,x.element.tickertime=x.timestamp}else if(e.length>1)if(x.elementisplayer){const n=mn(x.elementid);n.sidebar=e}else{const n=mn(x.elementfocus);n.scroll=e}}}).command("send",(e,t)=>{var c,u;const[n,r]=it(t,0,[q.NAME,q.ANY]),[i,s]=S_(n);function o(l){for(let h=0;h<l.length;++h){const f=l[h];T(f.id)&&e.send(f.id,s,r)}}switch(Bt(i)){case"all":for(const l of Object.keys(((c=x.board)==null?void 0:c.objects)??{}))e.send(l,s,r);break;case"self":e.message({session:H.session(),id:Re(),sender:e.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((u=x.board)==null?void 0:u.objects)??{}))l!==e.id()&&e.send(l,s,r);break;default:{o(O0(x.board,[i]));break}}return 0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Ee).join("");return ce(x.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Ee(n);return Zt(x.elementid,e.id(),i,r,e.get,e.set),0});var Mi=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Mi||{});const WC={audio:Nk,board:lC,cli:pC,display:mC,element:wC,runtime:KC,lifecycle:TC,loader:jC,network:zC},vf=["audio","board","display","network","lifecycle","element"],GC={0:[],1:["cli",...vf],2:["loader",...vf],3:["runtime",...vf]},HC={0:new Map,1:new Map,2:new Map,3:new Map};function Vs(e){return(GC[e]??[]).map(n=>WC[n]).filter(T)}function Sf(e){const t=[],n=Vs(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function YC(e,t){const n=HC[e];if(!n.has(t)){let r;const i=Vs(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!T(r));++s);n.set(t,r)}return n.get(t)}function VC(e,t,n){const r=Vs(e);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(t,n);if(s)return[s,o]}return[!1,void 0]}function qC(e,t,n,r){const i=Vs(e);for(let s=0;s<i.length;++s){const[o]=i[s].set(t,n,r);if(o)return[o,r]}return[!1,void 0]}function XC(e,t){const n=Vs(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function B_(e,t){const n=Vs(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var F_={},D_={},$_={};const j_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");$_.encode=function(e){if(0<=e&&e<j_.length)return j_[e];throw new TypeError("Must be between 0 and 63: "+e)};const JC=$_,z_=5,K_=1<<z_,ZC=K_-1,QC=K_;function tL(e){return e<0?(-e<<1)+1:(e<<1)+0}D_.encode=function(t){let n="",r,i=tL(t);do r=i&ZC,i>>>=z_,i>0&&(r|=QC),n+=JC.encode(r);while(i>0);return n};var na={};(function(e){function t(L,C,W){if(C in L)return L[C];if(arguments.length===3)return W;throw new Error('"'+C+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(L){const C=L.match(n);return C?{scheme:C[1],auth:C[2],host:C[3],port:C[4],path:C[5]}:null}e.urlParse=i;function s(L){let C="";return L.scheme&&(C+=L.scheme+":"),C+="//",L.auth&&(C+=L.auth+"@"),L.host&&(C+=L.host),L.port&&(C+=":"+L.port),L.path&&(C+=L.path),C}e.urlGenerate=s;const o=32;function a(L){const C=[];return function(W){for(let et=0;et<C.length;et++)if(C[et].input===W){const pt=C[0];return C[0]=C[et],C[et]=pt,C[0].result}const M=L(W);return C.unshift({input:W,result:M}),C.length>o&&C.pop(),M}}const c=a(function(C){let W=C;const M=i(C);if(M){if(!M.path)return C;W=M.path}const et=e.isAbsolute(W),pt=[];let U=0,S=0;for(;;)if(U=S,S=W.indexOf("/",U),S===-1){pt.push(W.slice(U));break}else for(pt.push(W.slice(U,S));S<W.length&&W[S]==="/";)S++;let _=0;for(S=pt.length-1;S>=0;S--){const B=pt[S];B==="."?pt.splice(S,1):B===".."?_++:_>0&&(B===""?(pt.splice(S+1,_),_=0):(pt.splice(S,2),_--))}return W=pt.join("/"),W===""&&(W=et?"/":"."),M?(M.path=W,s(M)):W});e.normalize=c;function u(L,C){L===""&&(L="."),C===""&&(C=".");const W=i(C),M=i(L);if(M&&(L=M.path||"/"),W&&!W.scheme)return M&&(W.scheme=M.scheme),s(W);if(W||C.match(r))return C;if(M&&!M.host&&!M.path)return M.host=C,s(M);const et=C.charAt(0)==="/"?C:c(L.replace(/\/+$/,"")+"/"+C);return M?(M.path=et,s(M)):et}e.join=u,e.isAbsolute=function(L){return L.charAt(0)==="/"||n.test(L)};function l(L,C){L===""&&(L="."),L=L.replace(/\/$/,"");let W=0;for(;C.indexOf(L+"/")!==0;){const M=L.lastIndexOf("/");if(M<0||(L=L.slice(0,M),L.match(/^([^\/]+:\/)?\/*$/)))return C;++W}return Array(W+1).join("../")+C.substr(L.length+1)}e.relative=l;const h=function(){return!("__proto__"in Object.create(null))}();function f(L){return L}function d(L){return g(L)?"$"+L:L}e.toSetString=h?f:d;function p(L){return g(L)?L.slice(1):L}e.fromSetString=h?f:p;function g(L){if(!L)return!1;const C=L.length;if(C<9||L.charCodeAt(C-1)!==95||L.charCodeAt(C-2)!==95||L.charCodeAt(C-3)!==111||L.charCodeAt(C-4)!==116||L.charCodeAt(C-5)!==111||L.charCodeAt(C-6)!==114||L.charCodeAt(C-7)!==112||L.charCodeAt(C-8)!==95||L.charCodeAt(C-9)!==95)return!1;for(let W=C-10;W>=0;W--)if(L.charCodeAt(W)!==36)return!1;return!0}function w(L,C,W){let M=k(L.source,C.source);return M!==0||(M=L.originalLine-C.originalLine,M!==0)||(M=L.originalColumn-C.originalColumn,M!==0||W)||(M=L.generatedColumn-C.generatedColumn,M!==0)||(M=L.generatedLine-C.generatedLine,M!==0)?M:k(L.name,C.name)}e.compareByOriginalPositions=w;function b(L,C,W){let M=L.generatedLine-C.generatedLine;return M!==0||(M=L.generatedColumn-C.generatedColumn,M!==0||W)||(M=k(L.source,C.source),M!==0)||(M=L.originalLine-C.originalLine,M!==0)||(M=L.originalColumn-C.originalColumn,M!==0)?M:k(L.name,C.name)}e.compareByGeneratedPositionsDeflated=b;function k(L,C){return L===C?0:L===null?1:C===null?-1:L>C?1:-1}function v(L,C){let W=L.generatedLine-C.generatedLine;return W!==0||(W=L.generatedColumn-C.generatedColumn,W!==0)||(W=k(L.source,C.source),W!==0)||(W=L.originalLine-C.originalLine,W!==0)||(W=L.originalColumn-C.originalColumn,W!==0)?W:k(L.name,C.name)}e.compareByGeneratedPositionsInflated=v;function N(L){return JSON.parse(L.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=N;function P(L,C,W){if(C=C||"",L&&(L[L.length-1]!=="/"&&C[0]!=="/"&&(L+="/"),C=L+C),W){const M=i(W);if(!M)throw new Error("sourceMapURL could not be parsed");if(M.path){const et=M.path.lastIndexOf("/");et>=0&&(M.path=M.path.substring(0,et+1))}C=u(s(M),C)}return c(C)}e.computeSourceURL=P})(na);var Rf={};let eL=class C1{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new C1;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Rf.ArraySet=eL;var W_={};const G_=na;function nL(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||G_.compareByGeneratedPositionsInflated(e,t)<=0}let rL=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){nL(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(G_.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};W_.MappingList=rL;const ra=D_,Ue=na,ul=Rf.ArraySet,iL=W_.MappingList;let H_=class L1{constructor(t){t||(t={}),this._file=Ue.getArg(t,"file",null),this._sourceRoot=Ue.getArg(t,"sourceRoot",null),this._skipValidation=Ue.getArg(t,"skipValidation",!1),this._sources=new ul,this._names=new ul,this._mappings=new iL,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new L1({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Ue.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=Ue.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=Ue.getArg(t,"generated"),r=Ue.getArg(t,"original",null);let i=Ue.getArg(t,"source",null),s=Ue.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=Ue.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Ue.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Ue.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Ue.relative(s,i));const o=this._mappings.toArray().length>0?new ul:this._sources,a=new ul;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=Ue.join(r,c.source)),s!=null&&(c.source=Ue.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const u=t.sourceContentFor(c);u!=null&&(r!=null&&(c=Ue.join(r,c)),s!=null&&(c=Ue.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,u,l,h;const f=this._mappings.toArray();for(let d=0,p=f.length;d<p;d++){if(u=f[d],c="",u.generatedLine!==n)for(t=0;u.generatedLine!==n;)c+=";",n++;else if(d>0){if(!Ue.compareByGeneratedPositionsInflated(u,f[d-1]))continue;c+=","}c+=ra.encode(u.generatedColumn-t),t=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=ra.encode(h-o),o=h,c+=ra.encode(u.originalLine-1-i),i=u.originalLine-1,c+=ra.encode(u.originalColumn-r),r=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=ra.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Ue.relative(n,r));const i=Ue.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};H_.prototype._version=3,F_.SourceMapGenerator=H_;var Y_={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,u=o(i,s[c],!0);return u===0?c:u>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(Y_);var ia={exports:{}},sL={},oL=Object.freeze({__proto__:null,default:sL}),V_=M1(oL);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;ia.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},ia.exports.initialize=t=>e=t}else{const e=V_,t=V_;ia.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},ia.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var q_=ia.exports;const aL=q_;function cL(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let sa=null;var lL=function(){if(sa)return sa;const t=[];return sa=aL().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,u,l,h,f){const d=new cL;d.generatedLine=r+1,d.generatedColumn=i,s&&(d.lastGeneratedColumn=o-1),a&&(d.source=c,d.originalLine=u+1,d.originalColumn=l,h&&(d.name=f)),t[t.length-1](d)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw sa=null,n}),sa};const kt=na,If=Y_,hl=Rf.ArraySet,uL=q_,hL=lL,Nf=Symbol("smcInternal");class Ce{constructor(t,n){return t==Nf?Promise.resolve(this):dL(t,n)}static initialize(t){uL.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return pL(t,n)}static async with(t,n,r){const i=await new Ce(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Ce.prototype._version=3,Ce.GENERATED_ORDER=1,Ce.ORIGINAL_ORDER=2,Ce.GREATEST_LOWER_BOUND=1,Ce.LEAST_UPPER_BOUND=2;class oa extends Ce{constructor(t,n){return super(Nf).then(r=>{let i=t;typeof t=="string"&&(i=kt.parseSourceMapInput(t));const s=kt.getArg(i,"version");let o=kt.getArg(i,"sources");const a=kt.getArg(i,"names",[]);let c=kt.getArg(i,"sourceRoot",null);const u=kt.getArg(i,"sourcesContent",null),l=kt.getArg(i,"mappings"),h=kt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=kt.normalize(c)),o=o.map(String).map(kt.normalize).map(function(f){return c&&kt.isAbsolute(c)&&kt.isAbsolute(f)?kt.relative(c,f):f}),r._names=hl.fromArray(a.map(String),!0),r._sources=hl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(f){return kt.computeSourceURL(c,f,n)}),r.sourceRoot=c,r.sourcesContent=u,r._mappings=l,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,hL().then(f=>(r._wasm=f,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=kt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new oa(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Ce.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=kt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Ce.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Ce.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=kt.getArg(t,"source");const r=kt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:kt.getArg(t,"line"),generatedColumn:kt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=kt.getArg(t,"bias",Ce.GREATEST_LOWER_BOUND);r==null&&(r=Ce.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=kt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=kt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=kt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:kt.getArg(i,"originalLine",null),column:kt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=kt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=kt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=kt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:kt.getArg(t,"line"),originalColumn:kt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=kt.getArg(t,"bias",Ce.GREATEST_LOWER_BOUND);i==null&&(i=Ce.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:kt.getArg(s,"generatedLine",null),column:kt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}oa.prototype.consumer=Ce;class fL extends Ce{constructor(t,n){return super(Nf).then(r=>{let i=t;typeof t=="string"&&(i=kt.parseSourceMapInput(t));const s=kt.getArg(i,"version"),o=kt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new hl,r._names=new hl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=kt.getArg(c,"offset"),l=kt.getArg(u,"line"),h=kt.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new Ce(kt.getArg(c,"map"),n).then(d=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:d}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(kt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(kt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:kt.getArg(t,"line"),generatedColumn:kt.getArg(t,"column")},r=If.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(kt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const u=a[c];let l=kt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(l),l=this._sources.indexOf(l);let h=null;u.name&&(this._names.add(u.name),h=this._names.indexOf(u.name));const f={source:l,generatedLine:u.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(o.generatedOffset.generatedLine===u.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:h};r.push(f),typeof f.originalLine=="number"&&i.push(f)}}}eachMapping(t,n,r){const i=n||null,s=r||Ce.GENERATED_ORDER;let o;switch(s){case Ce.GENERATED_ORDER:o=this._generatedMappings;break;case Ce.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let u=null;return c.source!==null&&(u=this._sources.at(c.source),u=kt.computeSourceURL(a,u,this._sourceMapURL)),{source:u,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return If.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=kt.getArg(t,"line"),r={source:kt.getArg(t,"source"),originalLine:n,originalColumn:kt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",kt.compareByOriginalPositions,If.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:kt.getArg(o,"generatedLine",null),column:kt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:kt.getArg(o,"generatedLine",null),column:kt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function dL(e,t){let n=e;typeof e=="string"&&(n=kt.parseSourceMapInput(e));const r=n.sections!=null?new fL(n,t):new oa(n,t);return Promise.resolve(r)}function pL(e,t){return oa.fromSourceMap(e,t)}var X_={};const mL=F_.SourceMapGenerator,fl=na,gL=/(\r?\n)/,yL=10,qs="$$$isSourceNode$$$";let _L=class qf{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[qs]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new qf,s=t.split(gL);let o=0;const a=function(){const d=g(),p=g()||"";return d+p;function g(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return n.eachMapping(function(d){if(l!==null)if(c<d.generatedLine)f(l,a()),c++,u=0;else{h=s[o]||"";const p=h.substr(0,d.generatedColumn-u);s[o]=h.substr(d.generatedColumn-u),u=d.generatedColumn,f(l,p),l=d;return}for(;c<d.generatedLine;)i.add(a()),c++;u<d.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,d.generatedColumn)),s[o]=h.substr(d.generatedColumn),u=d.generatedColumn),l=d},this),o<s.length&&(l&&f(l,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(d){const p=n.sourceContentFor(d);p!=null&&(r!=null&&(d=fl.join(r,d)),i.setSourceContent(d,p))}),i;function f(d,p){if(d===null||d.source===void 0)i.add(p);else{const g=r?fl.join(r,d.source):d.source;i.add(new qf(d.originalLine,d.originalColumn,g,p,d.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[qs]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[qs]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[qs]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[qs]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[fl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][qs]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(fl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new mL(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){n.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,f=u.length;h<f;h++)u.charCodeAt(h)===yL?(n.line++,n.column=0,h+1===f?(s=null,i=!1):i&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name})):n.column++}),this.walkSourceContents(function(u,l){r.setSourceContent(u,l)}),{code:n.code,map:r}}};X_.SourceNode=_L;var EL=X_.SourceNode;let J_=0;const Z_=wr,bL=["Command","lines"];class wL extends yO{constructor(){super(s_,{traceInitPerf:wr,skipValidations:!wr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Ct(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Ct(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Jo)}])}));Ct(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Ct(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Ct(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Ct(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Ly)}));Ct(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Vh)}));Ct(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Oy)}])}));Ct(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Cy)}));Ct(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(My),this.SUBRULE(this.words),this.CONSUME(Uy)}));Ct(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Ks),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Ct(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Ct(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Ct(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Ct(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(tf),this.SUBRULE(this.words)}));Ct(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(Vy),this.SUBRULE(this.words)}));Ct(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(ef),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Ct(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(tl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Jo)),this.CONSUME4(Ks),this.CONSUME4(nf)}}])}));Ct(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(tl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Ks),this.CONSUME(nf)}}])}));Ct(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(tl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Ct(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Ks),this.CONSUME(rf),this.CONSUME(ef),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ct(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Ks),this.CONSUME(rf),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ct(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(Zy),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ct(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(Qy),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ct(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(t_),this.SUBRULE(this.words)}));Ct(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(e_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ct(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(n_)}));Ct(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(r_)}));Ct(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(Jy)}));Ct(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(qh),this.SUBRULE2(this.and_test)})}));Ct(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Jh),this.SUBRULE2(this.not_test)})}));Ct(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Xh),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Ct(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Ct(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Fy)},{ALT:()=>this.CONSUME(Dy)},{ALT:()=>this.CONSUME($y)},{ALT:()=>this.CONSUME(jy)},{ALT:()=>this.CONSUME(zy)},{ALT:()=>this.CONSUME(Ky)}])}));Ct(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(qh),this.SUBRULE2(this.and_test_value)})}));Ct(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Jh),this.SUBRULE2(this.not_test_value)})}));Ct(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Xh),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Ct(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Ct(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Zh)},{ALT:()=>this.CONSUME(Qh)}]),this.SUBRULE(this.term)}));Ct(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Ct(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Gy)},{ALT:()=>this.CONSUME(tf)},{ALT:()=>this.CONSUME(Hy)},{ALT:()=>this.CONSUME(Yy)}]),this.SUBRULE(this.factor)}));Ct(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Zh)},{ALT:()=>this.CONSUME(Qh)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Ct(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Wy),this.SUBRULE(this.factor)})}));Ct(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Ct(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Py)},{ALT:()=>this.CONSUME(rn)},{ALT:()=>this.CONSUME(By)},{ALT:()=>{this.CONSUME(qy),this.SUBRULE(this.expr),this.CONSUME(Xy)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=bL.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(J_++).toString().padStart(3),c=s?"font-weight: bold;":"";if(Z_&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${u.join(" ")}`,c)}r(),Z_&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),J_--},i)}}const Xs=new wL;if(Sk){const e=Xs.getGAstProductions(),t=IO(e);console.info(t)}const TL=Xs.getBaseCstVisitorConstructor();var gt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(gt||{}),as=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(as||{}),Lr=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(Lr||{}),dl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(dl||{});function kL(e){return!!(e!=null&&e.tokenType)}function ar(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class xL extends TL{constructor(){super();Ct(this,"unique",0);wr&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&kL(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():T(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:ar(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:ar(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:ar(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:ar(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:ar(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,ar(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Re(),i=Re();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Re(),i=Re();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,ar(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Re(),i=Re();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Re(),i=Re(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Re(),i=Re(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Re();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=ar(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=ar(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=ar(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(ar(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const AL=new xL,An={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},pl="zss.js";function Xt(e,t){return new EL(e.startLine??1,e.startColumn??1,pl,t)}function Of(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Cf(e){return`'${Of(e)}'`}function ml(e){if(e.startsWith('"'))return ml(e.replaceAll(/(^"|"$)/g,""));const t=bf(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===_f?`', api.get('${Of(r.image.substring(1))}'), '`:Of(r.image)).join("")}'].join('')`}function Js(e){return e.filter(t=>t!==void 0).map(ne)}function Q_(e){return Xt(e,"")}function vL(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function Ke(e,t,n){return Xt(e,[`api.${t}(`,...vL(n,", "),")"])}function SL(e){if(e.type===gt.COMPARE&&e.compare.type===gt.COMPARE_ITEM)switch(e.compare.method){case as.IS_EQ:return Ke(e,"isEq",[ne(e.lhs),ne(e.rhs)]);case as.IS_NOT_EQ:return Ke(e,"isNotEq",[ne(e.lhs),ne(e.rhs)]);case as.IS_LESS_THAN:return Ke(e,"isLessThan",[ne(e.lhs),ne(e.rhs)]);case as.IS_GREATER_THAN:return Ke(e,"isGreaterThan",[ne(e.lhs),ne(e.rhs)]);case as.IS_LESS_THAN_OR_EQ:return Ke(e,"isLessThanOrEq",[ne(e.lhs),ne(e.rhs)]);case as.IS_GREATER_THAN_OR_EQ:return Ke(e,"isGreaterThanOrEq",[ne(e.lhs),ne(e.rhs)])}return Xt(e,"")}function cs(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ne(n),")"])}function t1(e,t,n){return e.prepend(`api.${t}(`),e.add([ne(n),")"])}function RL(e,t){if(e.type===gt.OPERATOR_ITEM)switch(e.operator){case Lr.PLUS:return cs(t,"opPlus",e.rhs);case Lr.MINUS:return cs(t,"opMinus",e.rhs);case Lr.POWER:return cs(t,"opPower",e.rhs);case Lr.MULTIPLY:return cs(t,"opMultiply",e.rhs);case Lr.DIVIDE:return cs(t,"opDivide",e.rhs);case Lr.MOD_DIVIDE:return cs(t,"opModDivide",e.rhs);case Lr.FLOOR_DIVIDE:return cs(t,"opFloorDivide",e.rhs);case Lr.UNI_PLUS:return t1(t,"opUniPlus",e.rhs);case Lr.UNI_MINUS:return t1(t,"opUniMinus",e.rhs)}return Xt(e,"")}function IL(e){if(e.type===gt.OPERATOR){const t=e.lhs?ne(e.lhs):Xt(e,"");return e.items.forEach(n=>RL(n,t)),t}return Xt(e,"")}function gl(e,t){return Xt(e,[Ke(e,"jump",[`${t}`]),"; continue;"])}function ui(e){return An.linelookup[e??""]??-1}function Lf(e,t){An.linelookup[e]=t}function Zs(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&(i.done=n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&(i.skip=n);break;case gt.LINE:Zs(i.stmts,t,n);break}}}function e1(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&Lf(i.done,n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&Lf(i.skip,n);break;case gt.LINE:e1(i.stmts,t,n);break}}}function ne(e){var t;switch(e.type){case gt.PROGRAM:return Xt(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ne).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${pl}`]);case gt.API:return Xt(e,["  ",Ke(e,e.method,Js(e.words)),`;
`]);case gt.LINE:return Xt(e,[`case ${e.lineindex}:
`,...e.stmts.map(ne).flat(),`  break;
`]);case gt.MARK:return Xt(e,`  // ${e.comment}
`);case gt.GOTO:{const n=ui(e.id);return Xt(e,["  ",gl(e,n),`
`])}case gt.COUNT:return Xt(e,`${e.index}`);case gt.LITERAL:switch(e.literal){case dl.NUMBER:return Xt(e,`${e.value}`);case dl.STRING:return Xt(e,Cf(e.value));case dl.TEMPLATE:return Xt(e,ml(e.value))}return Q_(e);case gt.TEXT:return Xt(e,["  ",Ke(e,"text",[ml(e.value)]),`;
`]);case gt.STAT:if(An.isfirststat){An.isfirststat=!1;const n=e.value.trim().split(" ").map(Cf);return Xt(e,["  ",Ke(e,"stat",n),`;
`])}return Xt(e,`  // skipped ${e.value}
`);case gt.LABEL:{const n=Bt(e.name),r=e.active?"label":"comment";An.labels[n]||(An.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return An.labels[n].push(i),Xt(e,`  // ${i} '${n}' ${r}
`)}case gt.HYPERLINK:return Xt(e,["  ",Ke(e,"hyperlink",[ml(e.text),...Js(e.link)]),`;
`]);case gt.MOVE:{const n=Ke(e,"command",[Cf("go"),Js(e.words)].flat());return e.wait?Xt(e,["  if (",n,`) { continue; };
`]):Xt(e,["  ",n,`;
`])}case gt.COMMAND:return Xt(e,["  if (",Ke(e,"command",Js(e.words)),`) { continue; };
`]);case gt.IF:{const n=((t=e.block)==null?void 0:t.type)===gt.IF_BLOCK?e.block:void 0;if(T(n)){Zs([e.check],gt.IF_CHECK,n.skip);const r=Xt(e,ne(e.check));return n.lines.forEach(i=>r.add(ne(i))),e1(n.altlines,gt.ELSE_IF,ui(n.done)),n.altlines.forEach(i=>r.add(ne(i))),r}return Xt(e,ne(e.check))}case gt.IF_CHECK:{const n=ui(e.skip);return n===-1?Xt(e,["  ",Ke(e,e.method,Js(e.words)),`;
`]):Xt(e,["  if (!",Ke(e,e.method,Js(e.words)),") { ",gl(e,n),` }
`])}case gt.ELSE_IF:case gt.ELSE:{const n=Xt(e,"");return e.lines.forEach(r=>n.add(ne(r))),n}case gt.WHILE:{const n=ui(e.loop),r=ui(e.done),i=Xt(e,"");return Zs(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ne(s))}),i}case gt.REPEAT:{const n=ui(e.loop),r=ui(e.done),i=Xt(e,"");return Zs(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ne(s))}),i}case gt.WAITFOR:{const n=Xt(e,"");return Zs(e.lines,gt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ne(r))}),n}case gt.FOREACH:{const n=ui(e.loop),r=ui(e.done),i=Xt(e,"");return Zs(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ne(s))}),i}case gt.BREAK:return Xt(e,["  ",gl(e,e.goto),`
`]);case gt.CONTINUE:return Xt(e,["  ",gl(e,e.goto),`
`]);case gt.OR:return Ke(e,"or",e.items.map(ne));case gt.AND:return Ke(e,"and",e.items.map(ne));case gt.NOT:return Ke(e,"not",e.items.map(ne));case gt.COMPARE:return SL(e);case gt.OPERATOR:return IL(e);case gt.EXPR:return Ke(e,"expr",e.words.map(ne));default:return console.error("<unsupported node>",e.type,e),Q_(e)}}function Mr(e){if(T(e))switch(e.type===gt.LINE&&++An.lineindex,e.lineindex=An.lineindex,e.type){case gt.PROGRAM:e.lines.forEach(Mr);break;case gt.LINE:e.stmts.forEach(Mr);break;case gt.MARK:Lf(e.id,e.lineindex);break;case gt.IF:Mr(e.check),Mr(e.block);break;case gt.IF_BLOCK:e.lines.forEach(Mr),e.altlines.forEach(Mr);break;case gt.ELSE_IF:e.lines.forEach(Mr);break;case gt.ELSE:case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.WAITFOR:e.lines.forEach(Mr);break;case gt.MOVE:case gt.COMMAND:case gt.IF_CHECK:e.words.forEach(Mr);break}}function NL(e){return An.labels={},An.internal=1,An.lineindex=0,An.isfirststat=!0,Mr(e),{...ne(e).toStringWithSourceMap({file:`${pl}.map`}),...An}}function n1(e){return ie(e)?e.length>0?1:0:e??0}function OL(e){return`${e}_chip`}function r1(e=""){return`vm:${e??""}`}function CL(e,t,n){var u,l;const r=OL(e),i=ls(r);let s;const o=ur(Object.entries(n.labels??{}));(!ie(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((u=n.errors)==null?void 0:u.length)??0)!==0?1:0);function a(h,f){x.words=f;const d=YC(t,h);return T(d)?d(c,f):h!=="send"?a("send",[h,...f]):0}const c={halt(){VL(r)},id(){return e},set(h,f){const[d,p]=qC(t,c,h,f);if(d)return p},get(h){const[f,d]=VC(t,c,h);if(f)return d},tick(h){const f=Lt(i.ps)?i.ps:0,d=f%h===0;if(i.ps=f+1,d===!1)return!1;if(c.shouldtick()===!1)return B_(t,c),!1;i.lc=0,i.ys=0,x.get=c.get,XC(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){ae(H,"crash",p.message),i.es=1}return B_(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Lt(i.lc)?++i.lc>Yr.HALT_AT_COUNT:!0},hm(){if(ie(i.mg)&&ie(i.lb)){const[h]=i.mg;if(T(h))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)return p.find(g=>Lt(g)&&g>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,f,d,p){H.emit(`${r1(h)}:${f}`,d,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(ie(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h){const g=p.findIndex(w=>w>0);g>=0&&(p[g]*=-1)}}},restore(h){if(ie(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)for(let g=0;g<p.length;g++)p[f]=Math.abs(p[f])}},getcase(){i.ec=Lt(i.ec)?i.ec:1;const h=c.hm();if(h&&ie(i.mg)){const[,f,d,p]=i.mg;c.set("sender",d),T(f)&&c.set("arg",f),At(p)&&(c.set("player",p),x.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=Lt(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const f=mk.parse(h),[d]=f.filter(p=>p.fileName===pl);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[f,...d]=h;return a(Bt(Ee(f)),d)},if(...h){const[f,d]=it(h,0,[q.ANY]),p=n1(f);return p&&d<h.length&&c.command(...h.slice(d)),p?1:0},try(...h){const[,f]=it(h,0,[q.DIR]),d=c.command("go",...h);return d&&f<h.length&&c.command(...h.slice(f)),d?1:0},take(...h){const[f,d,p]=it(h,0,[q.NAME,q.ANY]),g=Lt(d),w=g?p:1,b=c.get(f),k=g?d:1;if(!Lt(b))return w<h.length&&c.command(...h.slice(w)),1;const v=b-k;return v<0?(w<h.length&&c.command(...h.slice(w)),1):(c.set(f,v),0)},give(...h){const[f,d,p]=it(h,0,[q.NAME,q.ANY]),g=Lt(d),w=g?p:1,b=c.get(f),k=g?d:1,v=b===void 0?1:0;return v&&w<h.length&&c.command(...h.slice(w)),c.set(f,Ao(b,0)+k),v},repeatstart(h,...f){const[d,p]=it(f,0,[q.NUMBER]),g=`repeatcount${h}`,w=`repeatwords${h}`;i[g]=d,i[w]=p<f.length?f.slice(p):void 0},repeat(h){const f=`repeatcount${h}`,d=`repeatwords${h}`;if(!Lt(i[f]))return 0;const p=i[f];i[f]=p-1;const g=p>0,w=i[d];return g&&ie(w)&&c.command(...w),g?1:0},foreachstart(h,...f){const[d,p,g,w]=it(f,0,[q.NAME,q.NUMBER,q.NUMBER,q.MAYBE_NUMBER]);let b=Math.min(p,g),k=Math.max(p,g);const v=(w??0)||1;if(v<0){const N=b;b=k,k=N}return c.set(d,b-v),0},foreach(h,...f){const[d,p,g,w,b]=it(f,0,[q.NAME,q.NUMBER,q.NUMBER,q.MAYBE_NUMBER]);let k=Math.min(p,g),v=Math.max(p,g);const N=(w??0)||1;if(N<0){const C=k;k=v,v=C}let P=c.get(d);!Lt(P)||P<k||P>v?P=k:P+=N;const L=P<=v?1:0;return L&&(c.set(d,P),b<f.length&&c.command(...f.slice(b))),L},waitfor(...h){const[f]=it(h,0,[q.ANY]),d=n1(f);return d||c.yield(),d?1:0},or(...h){let f=0;for(let d=0;d<h.length;){const[p,g]=it(h,d,[q.ANY]);if(f=p,f)break;d=g}return f},and(...h){let f=0;for(let d=0;d<h.length;){const[p,g]=it(h,d,[q.ANY]);if(f=p,!f)break;d=g}return f},not(...h){const[f]=it(h,0,[q.ANY]);return f?0:1},expr(...h){const[f]=it(h,0,[q.ANY]);return f},isEq(h,f){const[d]=it([h],0,[q.ANY]),[p]=it([f],0,[q.ANY]);return typeof d=="object"||typeof p=="object"?dE(d,p)?1:0:d===p?1:0},isNotEq(h,f){return this.isEq(h,f)?0:1},isLessThan(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d<p?1:0},isGreaterThan(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d>p?1:0},isLessThanOrEq(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d<=p?1:0},isGreaterThanOrEq(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d>=p?1:0},opPlus(h,f){const[d]=it([h],0,[q.ANY]),[p]=it([f],0,[q.ANY]);return d+p},opMinus(h,f){const[d]=it([h],0,[q.ANY]),[p]=it([f],0,[q.ANY]);return d-p},opPower(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return Math.pow(d,p)},opMultiply(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d*p},opDivide(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d/p},opModDivide(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d%p},opFloorDivide(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return Math.floor(d/p)},opUniPlus(h){const[f]=it([h],0,[q.NUMBER]);return+f},opUniMinus(h){const[f]=it([h],0,[q.NUMBER]);return-f}};return s=(l=n.code)==null?void 0:l.call(n,c),c}function Mf(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ie(r)?r.forEach(i=>{t.push(Mf(i))}):t.push(Mf(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function LL(e){const t=o_(`${e}
`);if(t.errors.length>0)return t;Xs.input=t.tokens;const n=Xs.program();if(Xs.errors.length>0)return{tokens:t.tokens,errors:Xs.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=AL.go(n);return r?(Mf(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Uf=Object.getPrototypeOf(function*(){}).constructor;function ML(e,t){const n=`compile-${e}`;console.time(n);const r=LL(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=NL(r.ast);if(i.code){Rk&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Uf("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Uf("api"," ")}}}return{...r,...i,source:"",code:new Uf("api"," ")}}function UL(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=ML(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return T(s)?s.isended():!0},halt(i){const s=t[i];return T(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];T(o)&&o.set("arg",s)},tick(i,s,o,a,c){var l;let u=t[i];if(!T(t[i])){const h=n(a,c);if(u=t[i]=CL(i,s,h),(l=h.errors)!=null&&l.length){const[f]=h.errors,d=((f==null?void 0:f.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((b,k)=>[b,k]);p.slice(d-5,d).forEach(([b,k])=>{ae(H,"build",`$grey${k+1} $grey${b}`)});const[g,w]=p[d]??[];if(At(g)&&T(w)){const b=(f.column??1)-1,k=b+f.length,v=b<g.length?g:`${g}*`,N=v.substring(0,b),P=v.substring(b,k),L=v.substring(k);ae(H,"build",`$red${w+1} $grey${N}$red${P}$grey${L}`)}return f.message.split(`
`).forEach(b=>{ae(H,"build",b)}),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=ps(i.target),a=t[s];if(T(a)){const c={...i,target:o};a.message(c)}}};return r}let i1=0;function PL(){switch(i1++){case 0:return jt.BLUE;case 1:return jt.GREEN;case 2:return jt.CYAN;case 3:return jt.RED;case 4:return jt.PURPLE;case 5:return jt.YELLOW;default:return i1=0,jt.WHITE}}const Pe=new ko,pn={},yl={};function s1(e,t,n,r,i=0){const s=`tiles:${e}:${t}`;return T(pn[s])||(pn[s]=_k(e,t,n,r,i)),pn[s]}function BL(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return T(yl[s])||(yl[s]=Ek(e,t,n)),yl[s].id=i,yl[s]}function FL(e,t){const n=`sprites:${e}:${t}`;return T(pn[n])||(pn[n]=bk(e,t)),pn[n]}function DL(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return T(pn[s])||(pn[s]=wk(e,t,n,r,i)),pn[s]}function o1(e,t,n,r){const i=`media:${e}:${t}`;return T(pn[i])||(pn[i]=Tk(e,t,n,r)),pn[i]}function $L(e,t){const n=`control:${e}:${t}`;return T(pn[n])||(pn[n]=kk(e,t)),pn[n]}const Ui=.4;function a1(e,t){const n=[];Pe.x=e-Ui,Pe.y=t-Ui,n.push(Pe.angle()),Pe.x=e+Ui,Pe.y=t-Ui,n.push(Pe.angle()),Pe.x=e-Ui,Pe.y=t+Ui,n.push(Pe.angle()),Pe.x=e+Ui,Pe.y=t+Ui,n.push(Pe.angle());const r=Math.round(Fu(Math.min(...n))),i=Math.round(Fu(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function jL(e,t,n,r,i){var L,C,W;if(!T(r)||!T(r.terrain)||!T(r.objects))return[];const s=[];let o=t;const a=o===0,c=Qt,u=Ve,l=a?jt.BLACK:jt.ONCLEAR,h=s1(e,o++,c,u,l);s.push(h);const f=o++,d=FL(e,f);d.sprites=[],s.push(d);const p=r.isdark?1:0,g=DL(e,o++,c,u,p);s.push(g),g.alphas.fill(p);const w=s1(e,o++,c,u,jt.ONCLEAR);s.push(w),w.char.fill(0);const b={...wf(Qt,Ve,PL(),jt.ONCLEAR),...w},k=$L(e,o++);i&&s.push(k);for(let M=0;M<r.terrain.length;++M){const et=r.terrain[M],pt=p_(n,et,0,jt.BLACK,jt.ONCLEAR);h.char[M]=pt.char,h.color[M]=pt.color,h.bg[M]=pt.bg}const v=Object.values(r.objects??{});for(let M=0;M<v.length;++M){const et=v[M];if(T(et.removed))continue;const pt=et.id??"",U=p_(n,et,1,jt.WHITE,jt.BLACK),S=BL(e,f,pt,M);if(S.x=et.x??0,S.y=et.y??0,S.char=U.char,S.color=U.color,S.bg=U.bg,d.sprites.push(S),p){if(U.light>0){const _=[],B=Nn(Math.round(U.light),1,10),J=B*.5,j=Ur(r,S),ht=1/J;if(g.alphas[j]=0,B>1)for(let Q=1;Q<=B;++Q)for(let ut=S.y-Q;ut<=S.y+Q;++ut)for(let G=S.x-Q;G<=S.x+Q;++G){if(G===S.x&&ut===S.y)continue;Pe.x=G-S.x,Pe.y=ut-S.y;const $=Pe.length();if($>B)continue;const yt=Ur(r,{x:G,y:ut});if(yt===-1)continue;const st=Math.round(Fu(Pe.angle()));let at=0;for(let Mt=0;Mt<_.length;++Mt){const Ot=_[Mt];st>=Ot[0]&&st<=Ot[1]&&(at=Math.max(at,Ot[2]))}g.alphas[yt]=Math.min(g.alphas[yt],at+($<J?0:($-J)*ht)),g.alphas[yt]=Nn(g.alphas[yt],0,1);const Ut=vn(r,((L=r.lookup)==null?void 0:L[yt])??"");if(T(Ut)){const Mt=[...a1(Pe.x,Pe.y),.25];_.push(Mt)}const Wt=r.terrain[yt],Nt=Ci(n,Wt),Rt=(Wt==null?void 0:Wt.collision)??(Nt==null?void 0:Nt.collision);if(zu(Gt.ISBULLET,Rt)){const Mt=[...a1(Pe.x,Pe.y),1];let Ot=0;for(Ot=0;Ot<_.length;++Ot){const re=_[Ot];if(re[1]>re[0]&&Mt[1]>=re[0]&&Mt[0]<=re[1]&&Mt[2]>=1&&re[2]>=1){_[Ot]=[Math.min(Mt[0],re[0]),Math.max(Mt[1],re[1]),1];break}}Ot===_.length&&_.push(Mt)}}}else if(fs(pt)){const _=Ur(r,S);g.alphas[_]=0}}if(At(et.tickertext)&&Lt(et.tickertime)&&et.tickertext.length){const _=Qt,B=x_(et.tickertext,_,Ve-1),J=(B==null?void 0:B.measuredwidth)??1,j=et.x??0,ht=et.y??0,Q=ht<Ve*.5;b.x=j-Math.floor(J*.5),b.y=ht+(Q?1:-1),b.x+J>Qt&&(b.x=Qt-J),b.x<0&&(b.x=0),k_(et.tickertext,b,!0)}pt===e&&(k.focusx=S.x,k.focusy=S.y,k.focusid=pt)}const N=ke(Kt.MAIN),P=si(N,Kt.MAIN);if(At(P.palette)){const M=ii(N,Tt.PALETTE,P.palette);T((C=M==null?void 0:M.palette)==null?void 0:C.bits)&&s.push(o1(e,o++,"image/palette",Array.from(M.palette.bits)))}if(At(P.charset)){const M=ii(N,Tt.CHARSET,P.charset);T((W=M==null?void 0:M.charset)==null?void 0:W.bits)&&s.push(o1(e,o++,"image/charset",Array.from(M.charset.bits)))}return s}const Bn=UL();var Kt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Kt||{});const Te={halt:!1,session:Re(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function zL(){return Te.session}function hi(){return Te.operator}function KL(e){Te.operator=e}function WL(e){Te.halt=e}function GL(){return Te.halt}function aa(){return[...Te.books.values()]}function HL(){const[e]=Te.books.values();return e}function Pi(e){const t=Bt(e);return Te.books.get(e)??aa().find(n=>n.name===t)}function _l(e,t){T(Pi(t))&&(Te.software[e]=t)}function ke(e){return Pi(Te.software[e])}function c1(e){const t=f_([]);return At(e)&&(t.name=e),u1(t),hr(H,`created [book] ${t.name}`),t}function YL(e){let t=Pi(e);return T(t)||(t=f_([]),t.name=e),u1(t),hr(H,`created [book] ${t.name}`),t}function Fn(e,t){let n=T(t)?YL(t):ke(e);return T(n)||(T(n)||(n=HL()),T(n)||(n=c1(t)),T(n)&&hr(H,`opened [book] ${n.name} for ${e}`)),_l(e,n.id),n}function Bi(e,t,n){return lf(Fn(e),n,t)}function ls(e){const t=Fn("main");return si(t,e)}function l1(){const e=Fn("main");return si(e,"main")}function VL(e){const t=Fn("main");return m_(t,e)}function qL(e,t){Te.books.clear(),e.forEach(r=>{Te.books.set(r.id,r),r.name==="main"&&(Te.software.main=r.id)});const n=Pi(t);if(T(n)&&_l("main",n.id),!Te.software.main){const r=Te.books.values().next();r.value&&(Te.software.main=r.value.id)}}function u1(e){return Te.books.set(e.id,e),e.id}function XL(e){const t=Pi(e);t&&Te.books.delete(t.id)}function JL(e){if(!At(e)||!e)return ae(H,"login",`failed for playerid ==>${e}<==`,e);const t=ke("main");if(!T(t))return ae(H,"login:main","login failed to find book 'main'",e);const n=os(t,e);if(T(n))return!0;const r=Oi(t,Tt.BOARD,"title");if(r.length===0)return ae(H,"login:title","login failed to find board with 'title' stat",e);const i=Zo(t,"player");if(!T(i))return ae(H,"login:player","login failed to find object type 'player'",e);const s=y0(e,r),o=ri(s);if(T(o)){const a=h_(s,"startx"),c=h_(s,"starty"),u=Lt(a)?a:Math.round(Qt*.5),l=Lt(c)?c:Math.round(Ve*.5),h=i.name??"player",f=zf(o,{x:u,y:l},h,e);if(T(f==null?void 0:f.id))return f.player=e,rl(t,e,o.id),!0}return!1}function ZL(e){const t=ke("main"),n=os(t,e);rl(t,e,""),pf(t,n,vn(n,e)),_1(n,e),Bn.halt(e),m_(t,e)}function cr(e){const t=ke("main");return os(t,e)}function QL(e){const t=ke("main"),n=HO(t,e),r=os(t,e),i=vn(r,e);return n&&T(i)}function t4(e){const t=ke("main"),n=hf(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;fs(c)&&T(e[c])===!1&&(e[c]=0,rl(t,c,i.id))}}}function h1(e){Bn.message(e)}function ca(e,t,n,r){const i=Ai(e);At(t.id)&&H.emit("vm:touched",[t.id,i,n],r)}function Pf(e,t,n,r){if(!T(n))return!1;const i=y_(e,t,n,r);if(T(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=Oi(e,Tt.BOARD,(t==null?void 0:t.exitwest)??"");if(o.length){const a=On(o);Qo(e,n.id??"",a.id,{x:Qt-1,y:r.y})}}else if(r.x>=Qt){const o=Oi(e,Tt.BOARD,(t==null?void 0:t.exiteast)??"");if(o.length){const a=On(o);Qo(e,n.id??"",a.id,{x:0,y:r.y})}}else if(r.y<0){const o=Oi(e,Tt.BOARD,(t==null?void 0:t.exitnorth)??"");if(o.length){const a=On(o);Qo(e,n.id??"",a.id,{x:r.x,y:Ve-1})}}else if(r.y>=Ve){const o=Oi(e,Tt.BOARD,(t==null?void 0:t.exitsouth)??"");if(o.length){const a=On(o);Qo(e,n.id??"",a.id,{x:r.x,y:0})}}}else ca(i,n,"thud",void 0);if(n.kind==="player")ca(n,i,"touch",n.id);else if(n.collision===Gt.ISBULLET){const o=fs(n.party),a=fs(i.id);o!==a?ca(n,i,"shot",n.party):ca(i,n,"thud",void 0)}else ca(n,i,"bump",void 0);const s=Ci(e,i);return i.destructible??(s==null?void 0:s.destructible)?(T(i==null?void 0:i.id)?ai(x.book,x.board,i,x.timestamp):fi(t,{x:r.x,y:r.y}),!0):!1}return!0}function f1(e,t,n,r,i=qE){var h;if(!T(e)||!T(t)||!T(n))return;const s={...x};x.book=e,x.board=t,x.element=n,x.elementid=n.id??"",x.elementisplayer=fs(x.elementid);const o=x.element.player??Te.operator;x.elementfocus=x.elementisplayer?x.elementid:o;const a=Ci(e,n),c=n.cycle??(a==null?void 0:a.cycle)??i,u=n.id??"",l=Bt(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(Bn.tick(u,Mi.RUNTIME,Lt(c)?c:i,l,r),Lt(n==null?void 0:n.tickertime)&&x.timestamp-n.tickertime>ga*5&&(n.tickertime=0,n.tickertext=""),x.elementisplayer){const f=ls(x.elementid);Lt(f.inputcurrent)&&(f.inputcurrent=0)}Dr(s).forEach(f=>{x[f]=s[f]})}function e4(e,t){Te.loaders.set(e,t)}function n4(e){Bn.halt(e)}function r4(){const e=Bn.ids();for(let n=0;n<e.length;++n)Bn.halt(e[n]);const t=ke("main");T(t)&&(t.flags={})}function i4(){const e=ke("main");if(!T(e))return;const t=e.timestamp+1,n=Yr.HALT_AT_COUNT;Yr.HALT_AT_COUNT=n*2,Te.loaders.forEach((i,s)=>{const o={...x};x.timestamp=e.timestamp,x.book=e,x.board=void 0,x.element=void 0,x.elementid=s,x.elementisplayer=!1,x.elementfocus=Te.operator;const a=kC(s);T(a)&&Bn.arg(s,a),Bn.tick(s,Mi.LOADER,1,"loader",i),Bn.isended(s)&&(Bn.halt(s),Te.loaders.delete(s)),Dr(o).forEach(c=>{x[c]=o[c]})}),Yr.HALT_AT_COUNT=n,e.timestamp=t,x.timestamp=t;const r=hf(e);for(let i=0;i<r.length;++i){const s=r[i],o=ZO(e,s,t);for(let a=0;a<o.length;++a){const{id:c,type:u,code:l,object:h}=o[a];u===Tt.ERROR?Bn.halt(c):f1(e,s,h,l)}}}function Bf(e,t){const n=ke("main");if(!T(n))return;function r(a,c){for(let u=0;u<a.length;++u){const l=a[u];if(T(l.id)){const h=`${r1(l.id)}:${c}`;H.emit(h,t)}}}const{target:i,path:s}=ps(e),o=hf(n);for(let a=0;a<o.length;++a){const c=o[a];switch(Bt(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(O0(c,[i]),s);break}}}}function s4(e,t=""){var s;const n=Fn("main");if(!T(n))return;const r=`${e}_cli`;x.timestamp=n.timestamp,x.book=n,x.board=os(n,e),x.element=vn(x.board,e),x.elementid=((s=x.element)==null?void 0:s.id)??"",x.elementisplayer=!0,x.elementfocus=x.elementid||e;const i=Yr.HALT_AT_COUNT;Yr.HALT_AT_COUNT=i*8,cd(H,"running",n.timestamp,r,t),Bn.once(r,Mi.CLI,"cli",t),Yr.HALT_AT_COUNT=i}function El(e){var o;const t=Fn("main"),n=Ws(t,e);if(!T(t)||!T(n)||!T(x.element))return;const r=`${e}_run`,i=Bt(x.element.name??((o=x.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";Bn.once(r,Mi.RUNTIME,i,s)}function o4(e){const t=ke("main"),n=os(t,e),r=[];if(!T(t)||!T(n))return r;const i=Gs(t,n.over??""),s=Gs(t,n.under??""),o=[i,n,s];let a=0;for(let c=0;c<o.length;++c){const u=o[c],l=jL(e,a,t,u,u===n);a+=l.length,r.push(...l)}return r}function on(e){var r,i,s,o,a;const t=x.words[e],n=e+1;if(I_(t)){const[c,u]=ol(e);if(T(c))return[c,u]}if(gC(t)){const[c,u]=O_(e);if(T(c))return[c,u]}if(ju(t)){const[c,u]=tc(e);if(T(c))return[c,u]}if(At(t)&&Bt(t)==="rnd"){const[c,u]=on(n),[l,h]=on(u);return Lt(c)&&Lt(l)?[Ti(c,l),h]:Lt(c)?[Ti(0,c),u]:[Ti(0,1),n]}if(p1(t)){const[c,u]=Df(e);if(T(c))return[c,u]}if(!T(t))return[void 0,e];if(Lt(t)||ie(t))return[t,n];if(At(t)){const c=Bt(t),u=(r=x.get)==null?void 0:r.call(x,t);if(T(u))return[u,n];switch(c){case"aligned":case"alligned":{const l=nc(x.board,x.element,x.elementfocus);return!T(x.element)||!T(l)?[0,n]:[x.element.x===l.x||x.element.y===l.y?1:0,n]}case"contact":{const l=nc(x.board,x.element,x.elementfocus);if(!T(x.element)||!T(l))return[0,n];const h=(l.x??0)-(((i=x.element)==null?void 0:i.x)??0),f=(l.y??0)-(((s=x.element)==null?void 0:s.y)??0);return[h===0&&Math.abs(f)<2||f===0&&Math.abs(h)<2?1:0,n]}case"blocked":{const[l,h]=it(x.words,n,[q.DIR]);return[VO(x.book,x.board,x.element,l)?1:0,h]}case"any":{const[l,h]=it(x.words,n,[q.KIND]),f=ec(l)??"",d=So(x.board,f);return[N0(d,l).length?1:0,h]}case"rnd":return[Ti(0,1),n];case"abs":{const[l,h]=it(x.words,n,[q.NUMBER]);return[Math.abs(l),h]}case"ceil":{const[l,h]=it(x.words,n,[q.NUMBER]);return[Math.ceil(l),h]}case"floor":{const[l,h]=it(x.words,n,[q.NUMBER]);return[Math.floor(l),h]}case"round":{const[l,h]=it(x.words,n,[q.NUMBER]);return[Math.round(l),h]}case"clamp":{const[l,h,f,d]=it(x.words,n,[q.NUMBER,q.NUMBER,q.NUMBER]);return[Nn(l,h,f),d]}case"min":{const l=[];for(let h=n;h<x.words.length;){const[f,d]=on(h);ie(f)&&!lr(f)&&!Cr(f)&&!li(f)&&!Cn(f)&&l.push(...f),h=d,l.push(f)}return[Math.min(...l),x.words.length]}case"max":{const l=[];for(let h=n;h<x.words.length;){const[f,d]=on(h);ie(f)&&!lr(f)&&!Cr(f)&&!li(f)&&!Cn(f)&&l.push(...f),h=d,l.push(f)}return[Math.max(...l),x.words.length]}case"pick":{const l=[];for(let h=n;h<x.words.length;){const[f,d]=on(h);ie(f)&&!lr(f)&&!Cr(f)&&!li(f)&&!Cn(f)&&l.push(...f),h=d,l.push(f)}return[On(l),x.words.length]}case"pickwith":{const l=[],[h,f]=it(x.words,n,[q.NUMBER_OR_STRING]);for(let d=f;d<x.words.length;){const[p,g]=on(d);ie(p)&&!lr(p)&&!Cr(p)&&!li(p)&&!Cn(p)&&l.push(...p),d=g,l.push(p)}return[y0(`${h}`,l),x.words.length]}case"random":{const[l,h,f]=it(x.words,n,[q.NUMBER,q.MAYBE_NUMBER]);return[Ti(l,h??0),f]}case"randomwith":{const[l,h,f,d]=it(x.words,n,[q.NUMBER_OR_STRING,q.NUMBER,q.MAYBE_NUMBER]);return[m0(`${l}`,h,f??0),d]}case"run":{const[l,h]=it(x.words,n,[q.NAME]);return El(l),[(o=x.get)==null?void 0:o.call(x,"arg"),h]}case"runwith":{const[l,h,f]=it(x.words,n,[q.ANY,q.NAME]);return T(x.element)&&(x.element.arg=l),El(h),[(a=x.get)==null?void 0:a.call(x,"arg"),f]}}}return[t,n]}function Qs(e){return T(e)&&T(e.x)&&T(e.y)}function We(e,t){switch(t){case _t.NORTH:--e.y;break;case _t.SOUTH:++e.y;break;case _t.WEST:--e.x;break;case _t.EAST:++e.x;break}return e}function Fi(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return _t.WEST;if(n>0)return _t.EAST;if(r<0)return _t.NORTH;if(r>0)return _t.SOUTH}const Ff={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST"};function lr(e){return ie(e)&&d1(e[0])}function d1(e){return T(_t[e])&&At(e)}function a4(e){const t=_t[e];return T(t)?t:_t.IDLE}function p1(e){if(At(e))return Ff[Bt(e)]}function m1(e){if(lr(e))return e;if(d1(e))return[e];const t=p1(e);if(T(t))return[t]}function g1(e){const t=x.words[e],n=m1(t);if(lr(n))return[n,e+1];const[r,i]=on(e),s=m1(r);return lr(s)?[s,i]:[void 0,e]}function Df(e){const t=[];let[n,r]=g1(e);for(;lr(n);){if(t.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=it(x.words,r,[q.NUMBER,q.NUMBER]);t.push(o,a),r=c}const[i,s]=g1(r);n=i,r=s}return t.length?[t,r]:[void 0,e]}function c4(){return new Array(Qt*Ve).map(()=>{})}function l4(e=Ml){const t={terrain:c4(),objects:{},id:""};return e(t)}var $f=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e))($f||{});function u4(e){return Us(e,$f,{terrain:t=>t.map(lc),objects:t=>Object.values(t).filter(n=>!n.removed).map(lc),id:Oe,named:Oe,lookup:Oe,codepage:Oe})}function h4(e){return Oo(e,$f,{terrain:t=>t.map(uc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=uc(t[r]);T(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Ur(e,t){return!T(e)||!T(t==null?void 0:t.x)||!T(t==null?void 0:t.y)||t.x<0||t.x>=Qt||t.y<0||t.y>=Ve?-1:t.x+t.y*Qt}function Pr(e,t){const n=Ur(e,t);if(n<0||!T(e==null?void 0:e.lookup))return;const r=vn(e,e.lookup[n]??"");return T(r)?r:e.terrain[n]}function f4(e,t){const n=vn(e,t);if(T(n))return n;const r=parseFloat(t),i=i0(isNaN(r)?-1:r,Qt);return y1(e,i.x,i.y)}function y1(e,t,n){return(t>=0&&t<Qt)??(n>=0&&n<Ve)?e==null?void 0:e.terrain[t+n*Qt]:void 0}function fi(e,t){if(!T(e)||!T(t)||!T(t.x)||!T(t.y)||t.x<0||t.x>=Qt||t.y<0||t.y>=Ve)return;const n=ur(t),r=t.x+t.y*Qt;return e.terrain[r]=n,e.terrain[r]}function jf(e,t){if(!T(e)||!T(t))return;const n=ur(t);return n.id=n.id??Re(),e.objects[n.id]=n,e.objects[n.id]}function d4(e,t,n){return fi(e,{...t,kind:n})}function zf(e,t,n,r){return jf(e,{...t,kind:n,id:r})}function vn(e,t){if(e)return e.objects[t]}function Kf(e,t,n,r,i){if(!T(e)||!T(t))return{x:0,y:0};const s={x:t.x??0,y:t.y??0},o={x:t.lx??s.x,y:t.ly??s.y},a=Fi(o,s),c=Qt-1,u=Ve-1;for(let l=0;l<r.length;++l){const h=a4(r[l]);switch(h){case _t.IDLE:break;case _t.NORTH:case _t.SOUTH:case _t.WEST:case _t.EAST:We(s,h);break;case _t.BY:{const[f,d]=r.slice(l+1);Lt(f)&&Lt(d)&&(s.x=Nn(s.x+f,0,c),s.y=Nn(s.y+d,0,u)),l+=2;break}case _t.AT:{const[f,d]=r.slice(l+1);Lt(f)&&Lt(d)&&(s.x=Nn(f,0,c),s.y=Nn(d,0,u)),l+=2;break}case _t.FLOW:We(s,a);break;case _t.SEEK:{const f=p4(e,t,n);Qs(f)&&We(s,Fi(i,f));break}case _t.RNDNS:We(s,On(_t.NORTH,_t.SOUTH));break;case _t.RNDNE:We(s,On(_t.NORTH,_t.EAST));break;case _t.RND:We(s,On(_t.NORTH,_t.SOUTH,_t.WEST,_t.EAST));break;case _t.CW:case _t.CCW:case _t.OPP:case _t.RNDP:{const f=Kf(e,t,n,r.slice(l+1),i);switch(s.x=i.x,s.y=i.y,h){case _t.CW:switch(Fi(i,f)){case _t.NORTH:We(s,_t.EAST);break;case _t.SOUTH:We(s,_t.WEST);break;case _t.EAST:We(s,_t.SOUTH);break;case _t.WEST:We(s,_t.NORTH);break}break;case _t.CCW:switch(Fi(i,f)){case _t.NORTH:We(s,_t.WEST);break;case _t.SOUTH:We(s,_t.EAST);break;case _t.EAST:We(s,_t.NORTH);break;case _t.WEST:We(s,_t.SOUTH);break}break;case _t.OPP:switch(Fi(i,f)){case _t.NORTH:We(s,_t.SOUTH);break;case _t.SOUTH:We(s,_t.NORTH);break;case _t.EAST:We(s,_t.WEST);break;case _t.WEST:We(s,_t.EAST);break}break;case _t.RNDP:switch(Fi(i,f)){case _t.NORTH:case _t.SOUTH:s.x+=On(-1,1);break;case _t.WEST:case _t.EAST:s.y+=On(-1,1);break}break}break}}}return s}function _1(e,t){return T(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function p4(e,t,n){if(!T(e)||!T(t))return;const r=e.objects[n];if(T(r))return r;if(Qs(t))return C0(t,So(e,"player"))}const x={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var q=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NAME=5]="NAME",e[e.NUMBER=6]="NUMBER",e[e.STRING=7]="STRING",e[e.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=10]="MAYBE_COLLISION",e[e.MAYBE_COLOR=11]="MAYBE_COLOR",e[e.MAYBE_KIND=12]="MAYBE_KIND",e[e.MAYBE_DIR=13]="MAYBE_DIR",e[e.MAYBE_NAME=14]="MAYBE_NAME",e[e.MAYBE_NUMBER=15]="MAYBE_NUMBER",e[e.MAYBE_STRING=16]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",e[e.ANY=18]="ANY",e))(q||{});function Be(e,t,n){throw console.info(n,x.element,x.elementid,x.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function it(e,t,n){var o,a,c,u;const r=x.words;x.words=e;const i=[];let s=t;for(let l=0;l<n.length;++l)switch(n[l]){case 0:{const[h,f]=ol(s);Cr(h)||Be("terrain or object",h,e),s=f,i.push(h);break}case 1:{const[h,f]=O_(s);li(h)||Be("solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 2:{const[h,f]=tc(s);Cn(h)||Be("color",h,e),s=f,i.push(h);break}case 3:{const[h,f]=S0(s);Ls(h)?(s=f,i.push(h)):Be("kind",h,e);break}case 4:{const[h,f]=Df(s);if(lr(h)){const d={x:((o=x.element)==null?void 0:o.x)??0,y:((a=x.element)==null?void 0:a.y)??0},p=T(x.board)&&T(x.element)?Kf(x.board,x.element,x.elementfocus,h,d):d;s=f,i.push(p)}else Be("direction",h,e);break}case 5:{const h=x.words[s];At(h)||Be("string",h,e),++s,i.push(h);break}case 6:{const[h,f]=on(s);if(At(h)){const d=parseFloat(h);Lt(d)?i.push(d):Be("number",h,e)}else Lt(h)?i.push(h):Be("number",h,e);s=f;break}case 7:{const[h,f]=on(s);At(h)||Be("string",h,e),s=f,i.push(h);break}case 8:{const[h,f]=on(s);let d=h;if(At(d)){const p=parseFloat(d);Lt(p)&&(d=p)}else Lt(d)||Be("number or string",d,e);s=f,i.push(d);break}case 9:{const[h,f]=ol(s);h!==void 0&&!Cr(h)&&Be("optional terrain or object",h,e),s=f,i.push(h);break}case 10:{const[h,f]=ol(s);h!==void 0&&!li(h)&&Be("optional solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 11:{const[h,f]=tc(s);h!==void 0&&!Cn(h)&&Be("optional color",h,e),s=f,i.push(h);break}case 12:{const[h,f]=S0(s);h!==void 0&&!Ls(h)&&Be("optional kind",h,e),s=f,i.push(h);break}case 13:{const[h,f]=Df(s);if(lr(h)){const d=((c=x.element)==null?void 0:c.x)??0,p=((u=x.element)==null?void 0:u.y)??0,g={x:d,y:p},w=x.board?Kf(x.board,x.element,x.elementfocus,h,g):g;s=f,i.push(w)}else h===void 0?(s=f,i.push(void 0)):Be("optional direction",h,e);break}case 14:{const h=x.words[s];h!==void 0&&!At(h)&&Be("optional string",h,e),++s,i.push(h);break}case 15:{const[h,f]=on(s);if(At(h)){const d=parseFloat(h);Lt(d)?i.push(d):Be("optional number",h,e)}else Lt(h)||h===void 0?i.push(h):Be("optional number",h,e);s=f;break}case 16:{const[h,f]=on(s);h!==void 0&&!At(h)&&Be("optional string",h,e),s=f,i.push(h);break}case 17:{const[h,f]=on(s);let d=h;if(At(d)){const p=parseFloat(d);Lt(p)&&(d=p)}else d!==void 0&&!Lt(d)&&Be("number or string",d,e);s=f,i.push(d);break}case 18:{const[h,f]=on(s);s=f,i.push(h);break}}return x.words=r,[...i,s]}const bl={},to={};function Wf(){return{id:Re(),layers:[],scroll:[],sidebar:[]}}const m4=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),g4=new Set(["tx","text"]),y4={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},E1={};let b1=e=>{let t=E1[e];return T(t)||(E1[e]=t=Wf()),t};function _4(e){b1=e}function mn(e){return b1(e)}function Gf(e){return T(bl[e])||(bl[e]=[]),bl[e]}function E4(e){const t=mn(e);t.scroll=[]}function b4(e,t,n){Object.values(to).forEach(r=>{if(r[t]!==void 0){const i=b0(e.id(),t);Lt(n)&&QT(i,n),At(n)&&tk(i,n)}})}function Br(e){const t=Gf(e);return bl[e]=[],t}function ce(e,t){Gf(e).push(t)}function Zt(e,t,n,r,i=()=>0,s=Ml){const o=[t,n,...r],a=Bt(`${o[3]}`),c={...x};function u(l,h){T(h)&&h!==i(l)&&(x.board=c.board,x.element=c.element,x.elementfocus=c.elementfocus,s(l,h))}if(m4.has(a)){const l=`${o[2]}`;to[t]=to[t]??{};const h=i(l)??y4[a];if(to[t][l]===void 0){const f=b0(t,l);Lt(h)&&ZT(f,h),At(h)&&Lu(f,h),g4.has(a)?to[t][l]=n0(f,d=>{u(l,d)}):to[t][l]=ek(f,d=>{u(l,d)})}}Gf(e).push(o)}_4(e=>{if(fs(e)){const t=ke(Kt.MAIN),n=si(t,Kt.GADGETSTORE);let r=n[e];return T(r)||(n[e]=r=Wf()),r}return Wf()});const Hf=ms("gadgetserver",["tock"],e=>{if(!Hf.session(e))return;const t=ke(Kt.MAIN),n=(t==null?void 0:t.activelist)??[],r=si(t,Kt.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=mn(s);o.layers=o4(s);const a=r[s]??{},c=ad(a,o);c.length&&(r[s]=ur(o),TE(Hf,c,s))}break;case"desync":e.player&&wE(Hf,mn(e.player),e.player);break;case"clearscroll":e.player&&E4(e.player);break;case"clearplayer":if(e.player){const i=ke(Kt.MAIN),s=si(i,Kt.GADGETSTORE);delete s[e.player];const o=si(i,Kt.GADGETSYNC);delete o[e.player]}break}});function wl(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var w1={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(u,l){if(!i[u]){if(!r[u]){var h=typeof wl=="function"&&wl;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[u]={exports:{}};r[u][0].call(d.exports,function(p){var g=r[u][1][p];return o(g||p)},d,d.exports,n,r,i,s)}return i[u].exports}for(var a=typeof wl=="function"&&wl,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,f,d,p,g,w=[],b=0,k=c.length,v=k,N=s.getTypeOf(c)!=="string";b<c.length;)v=k-b,h=N?(u=c[b++],l=b<k?c[b++]:0,b<k?c[b++]:0):(u=c.charCodeAt(b++),l=b<k?c.charCodeAt(b++):0,b<k?c.charCodeAt(b++):0),f=u>>2,d=(3&u)<<4|l>>4,p=1<v?(15&l)<<2|h>>6:64,g=2<v?63&h:64,w.push(a.charAt(f)+a.charAt(d)+a.charAt(p)+a.charAt(g));return w.join("")},i.decode=function(c){var u,l,h,f,d,p,g=0,w=0,b="data:";if(c.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var k,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&v--,c.charAt(c.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(k=o.uint8array?new Uint8Array(0|v):new Array(0|v);g<c.length;)u=a.indexOf(c.charAt(g++))<<2|(f=a.indexOf(c.charAt(g++)))>>4,l=(15&f)<<4|(d=a.indexOf(c.charAt(g++)))>>2,h=(3&d)<<6|(p=a.indexOf(c.charAt(g++))),k[w++]=u,d!==64&&(k[w++]=l),p!==64&&(k[w++]=h);return k}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function u(l,h,f,d,p){this.compressedSize=l,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=p}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,f){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var g=f;g<p;g++)u=u>>>8^d[255&(u^l[g])];return-1^u}(0|c,a,a.length,0):function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var g=f;g<p;g++)u=u>>>8^d[255&(u^l.charCodeAt(g))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,f){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(d,p){var g,w="";for(g=0;g<p;g++)w+=String.fromCharCode(255&d),d>>>=8;return w}function o(d,p,g,w,b,k){var v,N,P=d.file,L=d.compression,C=k!==u.utf8encode,W=a.transformTo("string",k(P.name)),M=a.transformTo("string",u.utf8encode(P.name)),et=P.comment,pt=a.transformTo("string",k(et)),U=a.transformTo("string",u.utf8encode(et)),S=M.length!==P.name.length,_=U.length!==et.length,B="",J="",j="",ht=P.dir,Q=P.date,ut={crc32:0,compressedSize:0,uncompressedSize:0};p&&!g||(ut.crc32=d.crc32,ut.compressedSize=d.compressedSize,ut.uncompressedSize=d.uncompressedSize);var G=0;p&&(G|=8),C||!S&&!_||(G|=2048);var $=0,yt=0;ht&&($|=16),b==="UNIX"?(yt=798,$|=function(at,Ut){var Wt=at;return at||(Wt=Ut?16893:33204),(65535&Wt)<<16}(P.unixPermissions,ht)):(yt=20,$|=function(at){return 63&(at||0)}(P.dosPermissions)),v=Q.getUTCHours(),v<<=6,v|=Q.getUTCMinutes(),v<<=5,v|=Q.getUTCSeconds()/2,N=Q.getUTCFullYear()-1980,N<<=4,N|=Q.getUTCMonth()+1,N<<=5,N|=Q.getUTCDate(),S&&(J=s(1,1)+s(l(W),4)+M,B+="up"+s(J.length,2)+J),_&&(j=s(1,1)+s(l(pt),4)+U,B+="uc"+s(j.length,2)+j);var st="";return st+=`
\0`,st+=s(G,2),st+=L.magic,st+=s(v,2),st+=s(N,2),st+=s(ut.crc32,4),st+=s(ut.compressedSize,4),st+=s(ut.uncompressedSize,4),st+=s(W.length,2),st+=s(B.length,2),{fileRecord:h.LOCAL_FILE_HEADER+st+W+B,dirRecord:h.CENTRAL_FILE_HEADER+s(yt,2)+st+s(pt.length,2)+"\0\0\0\0"+s($,4)+s(w,4)+W+B+pt}}var a=n("../utils"),c=n("../stream/GenericWorker"),u=n("../utf8"),l=n("../crc32"),h=n("../signature");function f(d,p,g,w){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=g,this.encodeFileName=w,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(d){var p=d.meta.percent||0,g=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:g?(p+100*(g-w-1))/g:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var p=this.streamFiles&&!d.file.dir;if(p){var g=o(d,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var p=this.streamFiles&&!d.file.dir,g=o(d,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),p)this.push({data:function(w){return h.DATA_DESCRIPTOR+s(w.crc32,4)+s(w.compressedSize,4)+s(w.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var g=this.bytesWritten-d,w=function(b,k,v,N,P){var L=a.transformTo("string",P(N));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(b,2)+s(b,2)+s(k,4)+s(v,4)+s(L.length,2)+L}(this.dirRecords.length,g,d,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var p=this;return d.on("data",function(g){p.processChunk(g)}),d.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),d.on("error",function(g){p.error(g)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var p=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var g=0;g<p.length;g++)try{p[g].error(d)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,p=0;p<d.length;p++)d[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(f,d){h++;var p=function(k,v){var N=k||v,P=s[N];if(!P)throw new Error(N+" is not a valid compression method !");return P}(d.options.compression,c.compression),g=d.options.compressionOptions||c.compressionOptions||{},w=d.dir,b=d.date;d._compressWorker(p,g).withStreamInfo("file",{name:f,dir:w,date:b,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(f){l.error(f)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),u=n("./stream/Crc32Probe"),l=n("./nodejsUtils");function h(f){return new o.Promise(function(d,p){var g=f.decompressed.getContentWorker().pipe(new u);g.on("error",function(w){p(w)}).on("end",function(){g.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var p=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(g){var w=new c(d);return w.load(g),w}).then(function(g){var w=[o.Promise.resolve(g)],b=g.files;if(d.checkCRC32)for(var k=0;k<b.length;k++)w.push(h(b[k]));return o.Promise.all(w)}).then(function(g){for(var w=g.shift(),b=w.files,k=0;k<b.length;k++){var v=b[k],N=v.fileNameStr,P=s.resolve(v.fileNameStr);p.file(P,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:d.createFolders}),v.dir||(p.file(P).unsafeOriginalName=N)}return w.zipComment.length&&(p.comment=w.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,f){l.push(h)||l._helper.pause(),u&&u(f)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Je<"u",newBufferFrom:function(s,o){if(Je.from&&Je.from!==Uint8Array.from)return Je.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Je(s,o)},allocBuffer:function(s){if(Je.alloc)return Je.alloc(s);var o=new Je(s);return o.fill(0),o},isBuffer:function(s){return Je.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(P,L,C){var W,M=a.getTypeOf(L),et=a.extend(C||{},l);et.date=et.date||new Date,et.compression!==null&&(et.compression=et.compression.toUpperCase()),typeof et.unixPermissions=="string"&&(et.unixPermissions=parseInt(et.unixPermissions,8)),et.unixPermissions&&16384&et.unixPermissions&&(et.dir=!0),et.dosPermissions&&16&et.dosPermissions&&(et.dir=!0),et.dir&&(P=b(P)),et.createFolders&&(W=w(P))&&k.call(this,W,!0);var pt=M==="string"&&et.binary===!1&&et.base64===!1;C&&C.binary!==void 0||(et.binary=!pt),(L instanceof h&&L.uncompressedSize===0||et.dir||!L||L.length===0)&&(et.base64=!1,et.binary=!0,L="",et.compression="STORE",M="string");var U=null;U=L instanceof h||L instanceof c?L:p.isNode&&p.isStream(L)?new g(P,L):a.prepareContent(P,L,et.binary,et.optimizedBinaryString,et.base64);var S=new f(P,U,et);this.files[P]=S}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),l=n("./defaults"),h=n("./compressedObject"),f=n("./zipObject"),d=n("./generate"),p=n("./nodejsUtils"),g=n("./nodejs/NodejsStreamInputAdapter"),w=function(P){P.slice(-1)==="/"&&(P=P.substring(0,P.length-1));var L=P.lastIndexOf("/");return 0<L?P.substring(0,L):""},b=function(P){return P.slice(-1)!=="/"&&(P+="/"),P},k=function(P,L){return L=L!==void 0?L:l.createFolders,P=b(P),this.files[P]||s.call(this,P,null,{dir:!0,createFolders:L}),this.files[P]};function v(P){return Object.prototype.toString.call(P)==="[object RegExp]"}var N={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(P){var L,C,W;for(L in this.files)W=this.files[L],(C=L.slice(this.root.length,L.length))&&L.slice(0,this.root.length)===this.root&&P(C,W)},filter:function(P){var L=[];return this.forEach(function(C,W){P(C,W)&&L.push(W)}),L},file:function(P,L,C){if(arguments.length!==1)return P=this.root+P,s.call(this,P,L,C),this;if(v(P)){var W=P;return this.filter(function(et,pt){return!pt.dir&&W.test(et)})}var M=this.files[this.root+P];return M&&!M.dir?M:null},folder:function(P){if(!P)return this;if(v(P))return this.filter(function(M,et){return et.dir&&P.test(M)});var L=this.root+P,C=k.call(this,L),W=this.clone();return W.root=C.name,W},remove:function(P){P=this.root+P;var L=this.files[P];if(L||(P.slice(-1)!=="/"&&(P+="/"),L=this.files[P]),L&&!L.dir)delete this.files[P];else for(var C=this.filter(function(M,et){return et.name.slice(0,P.length)===P}),W=0;W<C.length;W++)delete this.files[C[W].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(P){var L,C={};try{if((C=a.extend(P||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=C.type.toLowerCase(),C.compression=C.compression.toUpperCase(),C.type==="binarystring"&&(C.type="string"),!C.type)throw new Error("No output type specified.");a.checkSupport(C.type),C.platform!=="darwin"&&C.platform!=="freebsd"&&C.platform!=="linux"&&C.platform!=="sunos"||(C.platform="UNIX"),C.platform==="win32"&&(C.platform="DOS");var W=C.comment||this.comment||"";L=d.generateWorker(this,C,W)}catch(M){(L=new c("error")).error(M)}return new u(L,C.type||"string",C.mimeType)},generateAsync:function(P,L){return this.generateInternalStream(P).accumulate(L)},generateNodeStream:function(P,L){return(P=P||{}).type||(P.type="nodebuffer"),this.generateInternalStream(P).toNodejsStream(L)}};r.exports=N},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===u&&this.data[f+2]===l&&this.data[f+3]===h)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&u===f[1]&&l===f[2]&&h===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),u=n("./NodeBufferReader"),l=n("./Uint8ArrayReader");r.exports=function(h){var f=s.getTypeOf(h);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),u=n("../support"),l=n("../external"),h=null;if(u.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,g){return new l.Promise(function(w,b){var k=[],v=p._internalType,N=p._outputType,P=p._mimeType;p.on("data",function(L,C){k.push(L),g&&g(C)}).on("error",function(L){k=[],b(L)}).on("end",function(){try{var L=function(C,W,M){switch(C){case"blob":return s.newBlob(s.transformTo("arraybuffer",W),M);case"base64":return c.encode(W);default:return s.transformTo(C,W)}}(N,function(C,W){var M,et=0,pt=null,U=0;for(M=0;M<W.length;M++)U+=W[M].length;switch(C){case"string":return W.join("");case"array":return Array.prototype.concat.apply([],W);case"uint8array":for(pt=new Uint8Array(U),M=0;M<W.length;M++)pt.set(W[M],et),et+=W[M].length;return pt;case"nodebuffer":return Je.concat(W);default:throw new Error("concat : unsupported type '"+C+"'")}}(v,k),P);w(L)}catch(C){b(C)}k=[]}).resume()})}function d(p,g,w){var b=g;switch(g){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=g,this._mimeType=w,s.checkSupport(b),this._worker=p.pipe(new o(b)),p.lock()}catch(k){this._worker=new a("error"),this._worker.error(k)}}d.prototype={accumulate:function(p){return f(this,p)},on:function(p,g){var w=this;return p==="data"?this._worker.on(p,function(b){g.call(w,b.data,b.meta)}):this._worker.on(p,function(){s.delay(g,arguments,w)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Je<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):function(p){var g,w,b,k,v,N=p.length,P=0;for(k=0;k<N;k++)(64512&(w=p.charCodeAt(k)))==55296&&k+1<N&&(64512&(b=p.charCodeAt(k+1)))==56320&&(w=65536+(w-55296<<10)+(b-56320),k++),P+=w<128?1:w<2048?2:w<65536?3:4;for(g=o.uint8array?new Uint8Array(P):new Array(P),k=v=0;v<P;k++)(64512&(w=p.charCodeAt(k)))==55296&&k+1<N&&(64512&(b=p.charCodeAt(k+1)))==56320&&(w=65536+(w-55296<<10)+(b-56320),k++),w<128?g[v++]=w:(w<2048?g[v++]=192|w>>>6:(w<65536?g[v++]=224|w>>>12:(g[v++]=240|w>>>18,g[v++]=128|w>>>12&63),g[v++]=128|w>>>6&63),g[v++]=128|63&w);return g}(d)},i.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):function(p){var g,w,b,k,v=p.length,N=new Array(2*v);for(g=w=0;g<v;)if((b=p[g++])<128)N[w++]=b;else if(4<(k=u[b]))N[w++]=65533,g+=k-1;else{for(b&=k===2?31:k===3?15:7;1<k&&g<v;)b=b<<6|63&p[g++],k--;1<k?N[w++]=65533:b<65536?N[w++]=b:(b-=65536,N[w++]=55296|b>>10&1023,N[w++]=56320|1023&b)}return N.length!==w&&(N.subarray?N=N.subarray(0,w):N.length=w),s.applyFromCharCode(N)}(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var p=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var g=p;(p=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),p.set(g,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var w=function(k,v){var N;for((v=v||k.length)>k.length&&(v=k.length),N=v-1;0<=N&&(192&k[N])==128;)N--;return N<0||N===0?v:N+u[k[N]]>v?N:v}(p),b=p;w!==p.length&&(o.uint8array?(b=p.subarray(0,w),this.leftOver=p.subarray(w,p.length)):(b=p.slice(0,w),this.leftOver=p.slice(w,p.length))),this.push({data:i.utf8decode(b),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(f,c),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function u(g){return g}function l(g,w){for(var b=0;b<g.length;++b)w[b]=255&g.charCodeAt(b);return w}n("setimmediate"),i.newBlob=function(g,w){i.checkSupport("blob");try{return new Blob([g],{type:w})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(g),b.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(g,w,b){var k=[],v=0,N=g.length;if(N<=b)return String.fromCharCode.apply(null,g);for(;v<N;)w==="array"||w==="nodebuffer"?k.push(String.fromCharCode.apply(null,g.slice(v,Math.min(v+b,N)))):k.push(String.fromCharCode.apply(null,g.subarray(v,Math.min(v+b,N)))),v+=b;return k.join("")},stringifyByChar:function(g){for(var w="",b=0;b<g.length;b++)w+=String.fromCharCode(g[b]);return w},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(g){var w=65536,b=i.getTypeOf(g),k=!0;if(b==="uint8array"?k=h.applyCanBeUsed.uint8array:b==="nodebuffer"&&(k=h.applyCanBeUsed.nodebuffer),k)for(;1<w;)try{return h.stringifyByChunk(g,b,w)}catch{w=Math.floor(w/2)}return h.stringifyByChar(g)}function d(g,w){for(var b=0;b<g.length;b++)w[b]=g[b];return w}i.applyFromCharCode=f;var p={};p.string={string:u,array:function(g){return l(g,new Array(g.length))},arraybuffer:function(g){return p.string.uint8array(g).buffer},uint8array:function(g){return l(g,new Uint8Array(g.length))},nodebuffer:function(g){return l(g,a.allocBuffer(g.length))}},p.array={string:f,array:u,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(g)}},p.arraybuffer={string:function(g){return f(new Uint8Array(g))},array:function(g){return d(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:u,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(new Uint8Array(g))}},p.uint8array={string:f,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:u,nodebuffer:function(g){return a.newBufferFrom(g)}},p.nodebuffer={string:f,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return p.nodebuffer.uint8array(g).buffer},uint8array:function(g){return d(g,new Uint8Array(g.length))},nodebuffer:u},i.transformTo=function(g,w){if(w=w||"",!g)return w;i.checkSupport(g);var b=i.getTypeOf(w);return p[b][g](w)},i.resolve=function(g){for(var w=g.split("/"),b=[],k=0;k<w.length;k++){var v=w[k];v==="."||v===""&&k!==0&&k!==w.length-1||(v===".."?b.pop():b.push(v))}return b.join("/")},i.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(g)?"nodebuffer":s.uint8array&&g instanceof Uint8Array?"uint8array":s.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(g){if(!s[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(g){var w,b,k="";for(b=0;b<(g||"").length;b++)k+="\\x"+((w=g.charCodeAt(b))<16?"0":"")+w.toString(16).toUpperCase();return k},i.delay=function(g,w,b){setImmediate(function(){g.apply(b||null,w||[])})},i.inherits=function(g,w){function b(){}b.prototype=w.prototype,g.prototype=new b},i.extend=function(){var g,w,b={};for(g=0;g<arguments.length;g++)for(w in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],w)&&b[w]===void 0&&(b[w]=arguments[g][w]);return b},i.prepareContent=function(g,w,b,k,v){return c.Promise.resolve(w).then(function(N){return s.blob&&(N instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(N))!==-1)&&typeof FileReader<"u"?new c.Promise(function(P,L){var C=new FileReader;C.onload=function(W){P(W.target.result)},C.onerror=function(W){L(W.target.error)},C.readAsArrayBuffer(N)}):N}).then(function(N){var P=i.getTypeOf(N);return P?(P==="arraybuffer"?N=i.transformTo("uint8array",N):P==="string"&&(v?N=o.decode(N):b&&k!==!0&&(N=function(L){return l(L,s.uint8array?new Uint8Array(L.length):new Array(L.length))}(N))),N):c.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),u=n("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===f;return this.reader.setIndex(d),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",d=o.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var p=f-d;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),u=n("./utf8"),l=n("./compressions"),h=n("./support");function f(d,p){this.options=d,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var p,g;if(d.skip(22),this.fileNameLength=d.readInt(2),g=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(w){for(var b in l)if(Object.prototype.hasOwnProperty.call(l,b)&&l[b].magic===w)return l[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var p=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(p),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var p,g,w,b=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<b;)p=d.readInt(2),g=d.readInt(2),w=d.readData(g),this.extraFields[p]={id:p,length:g,value:w};d.setIndex(b)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var g=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var b=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,g,w){this.name=p,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=g,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),u=n("./compressedObject"),l=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var g=null,w="string";try{if(!p)throw new Error("No output type specified.");var b=(w=p.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),g=this._decompressWorker();var k=!this._dataBinary;k&&!b&&(g=g.pipe(new c.Utf8EncodeWorker)),!k&&b&&(g=g.pipe(new c.Utf8DecodeWorker))}catch(v){(g=new l("error")).error(v)}return new o(g,w,"")},async:function(p,g){return this.internalStream(p).accumulate(g)},nodeStream:function(p,g){return this.internalStream(p||"nodebuffer").toNodejsStream(g)},_compressWorker:function(p,g){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(w,p,g)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(p),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var g=s.document.createElement("script");g.onreadystatechange=function(){p(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},s.document.documentElement.appendChild(g)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var d=[];function p(){var g,w;a=!0;for(var b=d.length;b;){for(w=d,d=[],g=-1;++g<b;)w[g]();b=d.length}a=!1}r.exports=function(g){d.push(g)!==1||a||o()}}).call(this,typeof gn<"u"?gn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,b!==o&&g(this,b)}function f(b,k,v){this.promise=b,typeof k=="function"&&(this.onFulfilled=k,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function d(b,k,v){s(function(){var N;try{N=k(v)}catch(P){return a.reject(b,P)}N===b?a.reject(b,new TypeError("Cannot resolve promise with itself")):a.resolve(b,N)})}function p(b){var k=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof k=="function")return function(){k.apply(b,arguments)}}function g(b,k){var v=!1;function N(C){v||(v=!0,a.reject(b,C))}function P(C){v||(v=!0,a.resolve(b,C))}var L=w(function(){k(P,N)});L.status==="error"&&N(L.value)}function w(b,k){var v={};try{v.value=b(k),v.status="success"}catch(N){v.status="error",v.value=N}return v}(r.exports=h).prototype.finally=function(b){if(typeof b!="function")return this;var k=this.constructor;return this.then(function(v){return k.resolve(b()).then(function(){return v})},function(v){return k.resolve(b()).then(function(){throw v})})},h.prototype.catch=function(b){return this.then(null,b)},h.prototype.then=function(b,k){if(typeof b!="function"&&this.state===u||typeof k!="function"&&this.state===c)return this;var v=new this.constructor(o);return this.state!==l?d(v,this.state===u?b:k,this.outcome):this.queue.push(new f(v,b,k)),v},f.prototype.callFulfilled=function(b){a.resolve(this.promise,b)},f.prototype.otherCallFulfilled=function(b){d(this.promise,this.onFulfilled,b)},f.prototype.callRejected=function(b){a.reject(this.promise,b)},f.prototype.otherCallRejected=function(b){d(this.promise,this.onRejected,b)},a.resolve=function(b,k){var v=w(p,k);if(v.status==="error")return a.reject(b,v.value);var N=v.value;if(N)g(b,N);else{b.state=u,b.outcome=k;for(var P=-1,L=b.queue.length;++P<L;)b.queue[P].callFulfilled(k)}return b},a.reject=function(b,k){b.state=c,b.outcome=k;for(var v=-1,N=b.queue.length;++v<N;)b.queue[v].callRejected(k);return b},h.resolve=function(b){return b instanceof this?b:a.resolve(new this(o),b)},h.reject=function(b){var k=new this(o);return a.reject(k,b)},h.all=function(b){var k=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=b.length,N=!1;if(!v)return this.resolve([]);for(var P=new Array(v),L=0,C=-1,W=new this(o);++C<v;)M(b[C],C);return W;function M(et,pt){k.resolve(et).then(function(U){P[pt]=U,++L!==v||N||(N=!0,a.resolve(W,P))},function(U){N||(N=!0,a.reject(W,U))})}},h.race=function(b){var k=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=b.length,N=!1;if(!v)return this.resolve([]);for(var P=-1,L=new this(o);++P<v;)C=b[P],k.resolve(C).then(function(W){N||(N=!0,a.resolve(L,W))},function(W){N||(N=!0,a.reject(L,W))});var C;return L}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),u=n("./zlib/zstream"),l=Object.prototype.toString,h=0,f=-1,d=0,p=8;function g(b){if(!(this instanceof g))return new g(b);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},b||{});var k=this.options;k.raw&&0<k.windowBits?k.windowBits=-k.windowBits:k.gzip&&0<k.windowBits&&k.windowBits<16&&(k.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,k.level,k.method,k.windowBits,k.memLevel,k.strategy);if(v!==h)throw new Error(c[v]);if(k.header&&s.deflateSetHeader(this.strm,k.header),k.dictionary){var N;if(N=typeof k.dictionary=="string"?a.string2buf(k.dictionary):l.call(k.dictionary)==="[object ArrayBuffer]"?new Uint8Array(k.dictionary):k.dictionary,(v=s.deflateSetDictionary(this.strm,N))!==h)throw new Error(c[v]);this._dict_set=!0}}function w(b,k){var v=new g(k);if(v.push(b,!0),v.err)throw v.msg||c[v.err];return v.result}g.prototype.push=function(b,k){var v,N,P=this.strm,L=this.options.chunkSize;if(this.ended)return!1;N=k===~~k?k:k===!0?4:0,typeof b=="string"?P.input=a.string2buf(b):l.call(b)==="[object ArrayBuffer]"?P.input=new Uint8Array(b):P.input=b,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new o.Buf8(L),P.next_out=0,P.avail_out=L),(v=s.deflate(P,N))!==1&&v!==h)return this.onEnd(v),!(this.ended=!0);P.avail_out!==0&&(P.avail_in!==0||N!==4&&N!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(P.output,P.next_out))):this.onData(o.shrinkBuf(P.output,P.next_out)))}while((0<P.avail_in||P.avail_out===0)&&v!==1);return N===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===h):N!==2||(this.onEnd(h),!(P.avail_out=0))},g.prototype.onData=function(b){this.chunks.push(b)},g.prototype.onEnd=function(b){b===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},i.Deflate=g,i.deflate=w,i.deflateRaw=function(b,k){return(k=k||{}).raw=!0,w(b,k)},i.gzip=function(b,k){return(k=k||{}).gzip=!0,w(b,k)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),u=n("./zlib/messages"),l=n("./zlib/zstream"),h=n("./zlib/gzheader"),f=Object.prototype.toString;function d(g){if(!(this instanceof d))return new d(g);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},g||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||g&&g.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var b=s.inflateInit2(this.strm,w.windowBits);if(b!==c.Z_OK)throw new Error(u[b]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(g,w){var b=new d(w);if(b.push(g,!0),b.err)throw b.msg||u[b.err];return b.result}d.prototype.push=function(g,w){var b,k,v,N,P,L,C=this.strm,W=this.options.chunkSize,M=this.options.dictionary,et=!1;if(this.ended)return!1;k=w===~~w?w:w===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof g=="string"?C.input=a.binstring2buf(g):f.call(g)==="[object ArrayBuffer]"?C.input=new Uint8Array(g):C.input=g,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(W),C.next_out=0,C.avail_out=W),(b=s.inflate(C,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&M&&(L=typeof M=="string"?a.string2buf(M):f.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,b=s.inflateSetDictionary(this.strm,L)),b===c.Z_BUF_ERROR&&et===!0&&(b=c.Z_OK,et=!1),b!==c.Z_STREAM_END&&b!==c.Z_OK)return this.onEnd(b),!(this.ended=!0);C.next_out&&(C.avail_out!==0&&b!==c.Z_STREAM_END&&(C.avail_in!==0||k!==c.Z_FINISH&&k!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(C.output,C.next_out),N=C.next_out-v,P=a.buf2string(C.output,v),C.next_out=N,C.avail_out=W-N,N&&o.arraySet(C.output,C.output,v,N,0),this.onData(P)):this.onData(o.shrinkBuf(C.output,C.next_out)))),C.avail_in===0&&C.avail_out===0&&(et=!0)}while((0<C.avail_in||C.avail_out===0)&&b!==c.Z_STREAM_END);return b===c.Z_STREAM_END&&(k=c.Z_FINISH),k===c.Z_FINISH?(b=s.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===c.Z_OK):k!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(C.avail_out=0))},d.prototype.onData=function(g){this.chunks.push(g)},d.prototype.onEnd=function(g){g===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Inflate=d,i.inflate=p,i.inflateRaw=function(g,w){return(w=w||{}).raw=!0,p(g,w)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,f){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),f);else for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){var u,l,h,f,d,p;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(p=new Uint8Array(h),u=f=0,l=c.length;u<l;u++)d=c[u],p.set(d,f),f+=d.length;return p}},a={arraySet:function(c,u,l,h,f){for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,f));for(var d="",p=0;p<f;p++)d+=String.fromCharCode(h[p]);return d}c[254]=c[254]=1,i.string2buf=function(h){var f,d,p,g,w,b=h.length,k=0;for(g=0;g<b;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<b&&(64512&(p=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),g++),k+=d<128?1:d<2048?2:d<65536?3:4;for(f=new s.Buf8(k),g=w=0;w<k;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<b&&(64512&(p=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),g++),d<128?f[w++]=d:(d<2048?f[w++]=192|d>>>6:(d<65536?f[w++]=224|d>>>12:(f[w++]=240|d>>>18,f[w++]=128|d>>>12&63),f[w++]=128|d>>>6&63),f[w++]=128|63&d);return f},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var f=new s.Buf8(h.length),d=0,p=f.length;d<p;d++)f[d]=h.charCodeAt(d);return f},i.buf2string=function(h,f){var d,p,g,w,b=f||h.length,k=new Array(2*b);for(d=p=0;d<b;)if((g=h[d++])<128)k[p++]=g;else if(4<(w=c[g]))k[p++]=65533,d+=w-1;else{for(g&=w===2?31:w===3?15:7;1<w&&d<b;)g=g<<6|63&h[d++],w--;1<w?k[p++]=65533:g<65536?k[p++]=g:(g-=65536,k[p++]=55296|g>>10&1023,k[p++]=56320|1023&g)}return l(k,p)},i.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+c[h[d]]>f?d:f}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var f=u;f<h;f++)o=o>>>8^l[255&(o^a[f])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),u=n("./crc32"),l=n("./messages"),h=0,f=4,d=0,p=-2,g=-1,w=4,b=2,k=8,v=9,N=286,P=30,L=19,C=2*N+1,W=15,M=3,et=258,pt=et+M+1,U=42,S=113,_=1,B=2,J=3,j=4;function ht(E,rt){return E.msg=l[rt],rt}function Q(E){return(E<<1)-(4<E?9:0)}function ut(E){for(var rt=E.length;0<=--rt;)E[rt]=0}function G(E){var rt=E.state,tt=rt.pending;tt>E.avail_out&&(tt=E.avail_out),tt!==0&&(o.arraySet(E.output,rt.pending_buf,rt.pending_out,tt,E.next_out),E.next_out+=tt,rt.pending_out+=tt,E.total_out+=tt,E.avail_out-=tt,rt.pending-=tt,rt.pending===0&&(rt.pending_out=0))}function $(E,rt){a._tr_flush_block(E,0<=E.block_start?E.block_start:-1,E.strstart-E.block_start,rt),E.block_start=E.strstart,G(E.strm)}function yt(E,rt){E.pending_buf[E.pending++]=rt}function st(E,rt){E.pending_buf[E.pending++]=rt>>>8&255,E.pending_buf[E.pending++]=255&rt}function at(E,rt){var tt,O,I=E.max_chain_length,K=E.strstart,ot=E.prev_length,lt=E.nice_match,X=E.strstart>E.w_size-pt?E.strstart-(E.w_size-pt):0,dt=E.window,Et=E.w_mask,ft=E.prev,xt=E.strstart+et,le=dt[K+ot-1],Pt=dt[K+ot];E.prev_length>=E.good_match&&(I>>=2),lt>E.lookahead&&(lt=E.lookahead);do if(dt[(tt=rt)+ot]===Pt&&dt[tt+ot-1]===le&&dt[tt]===dt[K]&&dt[++tt]===dt[K+1]){K+=2,tt++;do;while(dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&K<xt);if(O=et-(xt-K),K=xt-et,ot<O){if(E.match_start=rt,lt<=(ot=O))break;le=dt[K+ot-1],Pt=dt[K+ot]}}while((rt=ft[rt&Et])>X&&--I!=0);return ot<=E.lookahead?ot:E.lookahead}function Ut(E){var rt,tt,O,I,K,ot,lt,X,dt,Et,ft=E.w_size;do{if(I=E.window_size-E.lookahead-E.strstart,E.strstart>=ft+(ft-pt)){for(o.arraySet(E.window,E.window,ft,ft,0),E.match_start-=ft,E.strstart-=ft,E.block_start-=ft,rt=tt=E.hash_size;O=E.head[--rt],E.head[rt]=ft<=O?O-ft:0,--tt;);for(rt=tt=ft;O=E.prev[--rt],E.prev[rt]=ft<=O?O-ft:0,--tt;);I+=ft}if(E.strm.avail_in===0)break;if(ot=E.strm,lt=E.window,X=E.strstart+E.lookahead,dt=I,Et=void 0,Et=ot.avail_in,dt<Et&&(Et=dt),tt=Et===0?0:(ot.avail_in-=Et,o.arraySet(lt,ot.input,ot.next_in,Et,X),ot.state.wrap===1?ot.adler=c(ot.adler,lt,Et,X):ot.state.wrap===2&&(ot.adler=u(ot.adler,lt,Et,X)),ot.next_in+=Et,ot.total_in+=Et,Et),E.lookahead+=tt,E.lookahead+E.insert>=M)for(K=E.strstart-E.insert,E.ins_h=E.window[K],E.ins_h=(E.ins_h<<E.hash_shift^E.window[K+1])&E.hash_mask;E.insert&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[K+M-1])&E.hash_mask,E.prev[K&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=K,K++,E.insert--,!(E.lookahead+E.insert<M)););}while(E.lookahead<pt&&E.strm.avail_in!==0)}function Wt(E,rt){for(var tt,O;;){if(E.lookahead<pt){if(Ut(E),E.lookahead<pt&&rt===h)return _;if(E.lookahead===0)break}if(tt=0,E.lookahead>=M&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+M-1])&E.hash_mask,tt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),tt!==0&&E.strstart-tt<=E.w_size-pt&&(E.match_length=at(E,tt)),E.match_length>=M)if(O=a._tr_tally(E,E.strstart-E.match_start,E.match_length-M),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=M){for(E.match_length--;E.strstart++,E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+M-1])&E.hash_mask,tt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart,--E.match_length!=0;);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+1])&E.hash_mask;else O=a._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(O&&($(E,!1),E.strm.avail_out===0))return _}return E.insert=E.strstart<M-1?E.strstart:M-1,rt===f?($(E,!0),E.strm.avail_out===0?J:j):E.last_lit&&($(E,!1),E.strm.avail_out===0)?_:B}function Nt(E,rt){for(var tt,O,I;;){if(E.lookahead<pt){if(Ut(E),E.lookahead<pt&&rt===h)return _;if(E.lookahead===0)break}if(tt=0,E.lookahead>=M&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+M-1])&E.hash_mask,tt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=M-1,tt!==0&&E.prev_length<E.max_lazy_match&&E.strstart-tt<=E.w_size-pt&&(E.match_length=at(E,tt),E.match_length<=5&&(E.strategy===1||E.match_length===M&&4096<E.strstart-E.match_start)&&(E.match_length=M-1)),E.prev_length>=M&&E.match_length<=E.prev_length){for(I=E.strstart+E.lookahead-M,O=a._tr_tally(E,E.strstart-1-E.prev_match,E.prev_length-M),E.lookahead-=E.prev_length-1,E.prev_length-=2;++E.strstart<=I&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+M-1])&E.hash_mask,tt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),--E.prev_length!=0;);if(E.match_available=0,E.match_length=M-1,E.strstart++,O&&($(E,!1),E.strm.avail_out===0))return _}else if(E.match_available){if((O=a._tr_tally(E,0,E.window[E.strstart-1]))&&$(E,!1),E.strstart++,E.lookahead--,E.strm.avail_out===0)return _}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(O=a._tr_tally(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<M-1?E.strstart:M-1,rt===f?($(E,!0),E.strm.avail_out===0?J:j):E.last_lit&&($(E,!1),E.strm.avail_out===0)?_:B}function Rt(E,rt,tt,O,I){this.good_length=E,this.max_lazy=rt,this.nice_length=tt,this.max_chain=O,this.func=I}function Mt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*C),this.dyn_dtree=new o.Buf16(2*(2*P+1)),this.bl_tree=new o.Buf16(2*(2*L+1)),ut(this.dyn_ltree),ut(this.dyn_dtree),ut(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(W+1),this.heap=new o.Buf16(2*N+1),ut(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*N+1),ut(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ot(E){var rt;return E&&E.state?(E.total_in=E.total_out=0,E.data_type=b,(rt=E.state).pending=0,rt.pending_out=0,rt.wrap<0&&(rt.wrap=-rt.wrap),rt.status=rt.wrap?U:S,E.adler=rt.wrap===2?0:1,rt.last_flush=h,a._tr_init(rt),d):ht(E,p)}function re(E){var rt=Ot(E);return rt===d&&function(tt){tt.window_size=2*tt.w_size,ut(tt.head),tt.max_lazy_match=s[tt.level].max_lazy,tt.good_match=s[tt.level].good_length,tt.nice_match=s[tt.level].nice_length,tt.max_chain_length=s[tt.level].max_chain,tt.strstart=0,tt.block_start=0,tt.lookahead=0,tt.insert=0,tt.match_length=tt.prev_length=M-1,tt.match_available=0,tt.ins_h=0}(E.state),rt}function Se(E,rt,tt,O,I,K){if(!E)return p;var ot=1;if(rt===g&&(rt=6),O<0?(ot=0,O=-O):15<O&&(ot=2,O-=16),I<1||v<I||tt!==k||O<8||15<O||rt<0||9<rt||K<0||w<K)return ht(E,p);O===8&&(O=9);var lt=new Mt;return(E.state=lt).strm=E,lt.wrap=ot,lt.gzhead=null,lt.w_bits=O,lt.w_size=1<<lt.w_bits,lt.w_mask=lt.w_size-1,lt.hash_bits=I+7,lt.hash_size=1<<lt.hash_bits,lt.hash_mask=lt.hash_size-1,lt.hash_shift=~~((lt.hash_bits+M-1)/M),lt.window=new o.Buf8(2*lt.w_size),lt.head=new o.Buf16(lt.hash_size),lt.prev=new o.Buf16(lt.w_size),lt.lit_bufsize=1<<I+6,lt.pending_buf_size=4*lt.lit_bufsize,lt.pending_buf=new o.Buf8(lt.pending_buf_size),lt.d_buf=1*lt.lit_bufsize,lt.l_buf=3*lt.lit_bufsize,lt.level=rt,lt.strategy=K,lt.method=tt,re(E)}s=[new Rt(0,0,0,0,function(E,rt){var tt=65535;for(tt>E.pending_buf_size-5&&(tt=E.pending_buf_size-5);;){if(E.lookahead<=1){if(Ut(E),E.lookahead===0&&rt===h)return _;if(E.lookahead===0)break}E.strstart+=E.lookahead,E.lookahead=0;var O=E.block_start+tt;if((E.strstart===0||E.strstart>=O)&&(E.lookahead=E.strstart-O,E.strstart=O,$(E,!1),E.strm.avail_out===0)||E.strstart-E.block_start>=E.w_size-pt&&($(E,!1),E.strm.avail_out===0))return _}return E.insert=0,rt===f?($(E,!0),E.strm.avail_out===0?J:j):(E.strstart>E.block_start&&($(E,!1),E.strm.avail_out),_)}),new Rt(4,4,8,4,Wt),new Rt(4,5,16,8,Wt),new Rt(4,6,32,32,Wt),new Rt(4,4,16,16,Nt),new Rt(8,16,32,32,Nt),new Rt(8,16,128,128,Nt),new Rt(8,32,128,256,Nt),new Rt(32,128,258,1024,Nt),new Rt(32,258,258,4096,Nt)],i.deflateInit=function(E,rt){return Se(E,rt,k,15,8,0)},i.deflateInit2=Se,i.deflateReset=re,i.deflateResetKeep=Ot,i.deflateSetHeader=function(E,rt){return E&&E.state?E.state.wrap!==2?p:(E.state.gzhead=rt,d):p},i.deflate=function(E,rt){var tt,O,I,K;if(!E||!E.state||5<rt||rt<0)return E?ht(E,p):p;if(O=E.state,!E.output||!E.input&&E.avail_in!==0||O.status===666&&rt!==f)return ht(E,E.avail_out===0?-5:p);if(O.strm=E,tt=O.last_flush,O.last_flush=rt,O.status===U)if(O.wrap===2)E.adler=0,yt(O,31),yt(O,139),yt(O,8),O.gzhead?(yt(O,(O.gzhead.text?1:0)+(O.gzhead.hcrc?2:0)+(O.gzhead.extra?4:0)+(O.gzhead.name?8:0)+(O.gzhead.comment?16:0)),yt(O,255&O.gzhead.time),yt(O,O.gzhead.time>>8&255),yt(O,O.gzhead.time>>16&255),yt(O,O.gzhead.time>>24&255),yt(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),yt(O,255&O.gzhead.os),O.gzhead.extra&&O.gzhead.extra.length&&(yt(O,255&O.gzhead.extra.length),yt(O,O.gzhead.extra.length>>8&255)),O.gzhead.hcrc&&(E.adler=u(E.adler,O.pending_buf,O.pending,0)),O.gzindex=0,O.status=69):(yt(O,0),yt(O,0),yt(O,0),yt(O,0),yt(O,0),yt(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),yt(O,3),O.status=S);else{var ot=k+(O.w_bits-8<<4)<<8;ot|=(2<=O.strategy||O.level<2?0:O.level<6?1:O.level===6?2:3)<<6,O.strstart!==0&&(ot|=32),ot+=31-ot%31,O.status=S,st(O,ot),O.strstart!==0&&(st(O,E.adler>>>16),st(O,65535&E.adler)),E.adler=1}if(O.status===69)if(O.gzhead.extra){for(I=O.pending;O.gzindex<(65535&O.gzhead.extra.length)&&(O.pending!==O.pending_buf_size||(O.gzhead.hcrc&&O.pending>I&&(E.adler=u(E.adler,O.pending_buf,O.pending-I,I)),G(E),I=O.pending,O.pending!==O.pending_buf_size));)yt(O,255&O.gzhead.extra[O.gzindex]),O.gzindex++;O.gzhead.hcrc&&O.pending>I&&(E.adler=u(E.adler,O.pending_buf,O.pending-I,I)),O.gzindex===O.gzhead.extra.length&&(O.gzindex=0,O.status=73)}else O.status=73;if(O.status===73)if(O.gzhead.name){I=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>I&&(E.adler=u(E.adler,O.pending_buf,O.pending-I,I)),G(E),I=O.pending,O.pending===O.pending_buf_size)){K=1;break}K=O.gzindex<O.gzhead.name.length?255&O.gzhead.name.charCodeAt(O.gzindex++):0,yt(O,K)}while(K!==0);O.gzhead.hcrc&&O.pending>I&&(E.adler=u(E.adler,O.pending_buf,O.pending-I,I)),K===0&&(O.gzindex=0,O.status=91)}else O.status=91;if(O.status===91)if(O.gzhead.comment){I=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>I&&(E.adler=u(E.adler,O.pending_buf,O.pending-I,I)),G(E),I=O.pending,O.pending===O.pending_buf_size)){K=1;break}K=O.gzindex<O.gzhead.comment.length?255&O.gzhead.comment.charCodeAt(O.gzindex++):0,yt(O,K)}while(K!==0);O.gzhead.hcrc&&O.pending>I&&(E.adler=u(E.adler,O.pending_buf,O.pending-I,I)),K===0&&(O.status=103)}else O.status=103;if(O.status===103&&(O.gzhead.hcrc?(O.pending+2>O.pending_buf_size&&G(E),O.pending+2<=O.pending_buf_size&&(yt(O,255&E.adler),yt(O,E.adler>>8&255),E.adler=0,O.status=S)):O.status=S),O.pending!==0){if(G(E),E.avail_out===0)return O.last_flush=-1,d}else if(E.avail_in===0&&Q(rt)<=Q(tt)&&rt!==f)return ht(E,-5);if(O.status===666&&E.avail_in!==0)return ht(E,-5);if(E.avail_in!==0||O.lookahead!==0||rt!==h&&O.status!==666){var lt=O.strategy===2?function(X,dt){for(var Et;;){if(X.lookahead===0&&(Ut(X),X.lookahead===0)){if(dt===h)return _;break}if(X.match_length=0,Et=a._tr_tally(X,0,X.window[X.strstart]),X.lookahead--,X.strstart++,Et&&($(X,!1),X.strm.avail_out===0))return _}return X.insert=0,dt===f?($(X,!0),X.strm.avail_out===0?J:j):X.last_lit&&($(X,!1),X.strm.avail_out===0)?_:B}(O,rt):O.strategy===3?function(X,dt){for(var Et,ft,xt,le,Pt=X.window;;){if(X.lookahead<=et){if(Ut(X),X.lookahead<=et&&dt===h)return _;if(X.lookahead===0)break}if(X.match_length=0,X.lookahead>=M&&0<X.strstart&&(ft=Pt[xt=X.strstart-1])===Pt[++xt]&&ft===Pt[++xt]&&ft===Pt[++xt]){le=X.strstart+et;do;while(ft===Pt[++xt]&&ft===Pt[++xt]&&ft===Pt[++xt]&&ft===Pt[++xt]&&ft===Pt[++xt]&&ft===Pt[++xt]&&ft===Pt[++xt]&&ft===Pt[++xt]&&xt<le);X.match_length=et-(le-xt),X.match_length>X.lookahead&&(X.match_length=X.lookahead)}if(X.match_length>=M?(Et=a._tr_tally(X,1,X.match_length-M),X.lookahead-=X.match_length,X.strstart+=X.match_length,X.match_length=0):(Et=a._tr_tally(X,0,X.window[X.strstart]),X.lookahead--,X.strstart++),Et&&($(X,!1),X.strm.avail_out===0))return _}return X.insert=0,dt===f?($(X,!0),X.strm.avail_out===0?J:j):X.last_lit&&($(X,!1),X.strm.avail_out===0)?_:B}(O,rt):s[O.level].func(O,rt);if(lt!==J&&lt!==j||(O.status=666),lt===_||lt===J)return E.avail_out===0&&(O.last_flush=-1),d;if(lt===B&&(rt===1?a._tr_align(O):rt!==5&&(a._tr_stored_block(O,0,0,!1),rt===3&&(ut(O.head),O.lookahead===0&&(O.strstart=0,O.block_start=0,O.insert=0))),G(E),E.avail_out===0))return O.last_flush=-1,d}return rt!==f?d:O.wrap<=0?1:(O.wrap===2?(yt(O,255&E.adler),yt(O,E.adler>>8&255),yt(O,E.adler>>16&255),yt(O,E.adler>>24&255),yt(O,255&E.total_in),yt(O,E.total_in>>8&255),yt(O,E.total_in>>16&255),yt(O,E.total_in>>24&255)):(st(O,E.adler>>>16),st(O,65535&E.adler)),G(E),0<O.wrap&&(O.wrap=-O.wrap),O.pending!==0?d:1)},i.deflateEnd=function(E){var rt;return E&&E.state?(rt=E.state.status)!==U&&rt!==69&&rt!==73&&rt!==91&&rt!==103&&rt!==S&&rt!==666?ht(E,p):(E.state=null,rt===S?ht(E,-3):d):p},i.deflateSetDictionary=function(E,rt){var tt,O,I,K,ot,lt,X,dt,Et=rt.length;if(!E||!E.state||(K=(tt=E.state).wrap)===2||K===1&&tt.status!==U||tt.lookahead)return p;for(K===1&&(E.adler=c(E.adler,rt,Et,0)),tt.wrap=0,Et>=tt.w_size&&(K===0&&(ut(tt.head),tt.strstart=0,tt.block_start=0,tt.insert=0),dt=new o.Buf8(tt.w_size),o.arraySet(dt,rt,Et-tt.w_size,tt.w_size,0),rt=dt,Et=tt.w_size),ot=E.avail_in,lt=E.next_in,X=E.input,E.avail_in=Et,E.next_in=0,E.input=rt,Ut(tt);tt.lookahead>=M;){for(O=tt.strstart,I=tt.lookahead-(M-1);tt.ins_h=(tt.ins_h<<tt.hash_shift^tt.window[O+M-1])&tt.hash_mask,tt.prev[O&tt.w_mask]=tt.head[tt.ins_h],tt.head[tt.ins_h]=O,O++,--I;);tt.strstart=O,tt.lookahead=M-1,Ut(tt)}return tt.strstart+=tt.lookahead,tt.block_start=tt.strstart,tt.insert=tt.lookahead,tt.lookahead=0,tt.match_length=tt.prev_length=M-1,tt.match_available=0,E.next_in=lt,E.input=X,E.avail_in=ot,tt.wrap=K,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,u,l,h,f,d,p,g,w,b,k,v,N,P,L,C,W,M,et,pt,U,S,_,B;a=s.state,c=s.next_in,_=s.input,u=c+(s.avail_in-5),l=s.next_out,B=s.output,h=l-(o-s.avail_out),f=l+(s.avail_out-257),d=a.dmax,p=a.wsize,g=a.whave,w=a.wnext,b=a.window,k=a.hold,v=a.bits,N=a.lencode,P=a.distcode,L=(1<<a.lenbits)-1,C=(1<<a.distbits)-1;t:do{v<15&&(k+=_[c++]<<v,v+=8,k+=_[c++]<<v,v+=8),W=N[k&L];e:for(;;){if(k>>>=M=W>>>24,v-=M,(M=W>>>16&255)===0)B[l++]=65535&W;else{if(!(16&M)){if(!(64&M)){W=N[(65535&W)+(k&(1<<M)-1)];continue e}if(32&M){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}et=65535&W,(M&=15)&&(v<M&&(k+=_[c++]<<v,v+=8),et+=k&(1<<M)-1,k>>>=M,v-=M),v<15&&(k+=_[c++]<<v,v+=8,k+=_[c++]<<v,v+=8),W=P[k&C];n:for(;;){if(k>>>=M=W>>>24,v-=M,!(16&(M=W>>>16&255))){if(!(64&M)){W=P[(65535&W)+(k&(1<<M)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(pt=65535&W,v<(M&=15)&&(k+=_[c++]<<v,(v+=8)<M&&(k+=_[c++]<<v,v+=8)),d<(pt+=k&(1<<M)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(k>>>=M,v-=M,(M=l-h)<pt){if(g<(M=pt-M)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(S=b,(U=0)===w){if(U+=p-M,M<et){for(et-=M;B[l++]=b[U++],--M;);U=l-pt,S=B}}else if(w<M){if(U+=p+w-M,(M-=w)<et){for(et-=M;B[l++]=b[U++],--M;);if(U=0,w<et){for(et-=M=w;B[l++]=b[U++],--M;);U=l-pt,S=B}}}else if(U+=w-M,M<et){for(et-=M;B[l++]=b[U++],--M;);U=l-pt,S=B}for(;2<et;)B[l++]=S[U++],B[l++]=S[U++],B[l++]=S[U++],et-=3;et&&(B[l++]=S[U++],1<et&&(B[l++]=S[U++]))}else{for(U=l-pt;B[l++]=B[U++],B[l++]=B[U++],B[l++]=B[U++],2<(et-=3););et&&(B[l++]=B[U++],1<et&&(B[l++]=B[U++]))}break}}break}}while(c<u&&l<f);c-=et=v>>3,k&=(1<<(v-=et<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<f?f-l+257:257-(l-f),a.hold=k,a.bits=v}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),u=n("./inftrees"),l=1,h=2,f=0,d=-2,p=1,g=852,w=592;function b(U){return(U>>>24&255)+(U>>>8&65280)+((65280&U)<<8)+((255&U)<<24)}function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(U){var S;return U&&U.state?(S=U.state,U.total_in=U.total_out=S.total=0,U.msg="",S.wrap&&(U.adler=1&S.wrap),S.mode=p,S.last=0,S.havedict=0,S.dmax=32768,S.head=null,S.hold=0,S.bits=0,S.lencode=S.lendyn=new s.Buf32(g),S.distcode=S.distdyn=new s.Buf32(w),S.sane=1,S.back=-1,f):d}function N(U){var S;return U&&U.state?((S=U.state).wsize=0,S.whave=0,S.wnext=0,v(U)):d}function P(U,S){var _,B;return U&&U.state?(B=U.state,S<0?(_=0,S=-S):(_=1+(S>>4),S<48&&(S&=15)),S&&(S<8||15<S)?d:(B.window!==null&&B.wbits!==S&&(B.window=null),B.wrap=_,B.wbits=S,N(U))):d}function L(U,S){var _,B;return U?(B=new k,(U.state=B).window=null,(_=P(U,S))!==f&&(U.state=null),_):d}var C,W,M=!0;function et(U){if(M){var S;for(C=new s.Buf32(512),W=new s.Buf32(32),S=0;S<144;)U.lens[S++]=8;for(;S<256;)U.lens[S++]=9;for(;S<280;)U.lens[S++]=7;for(;S<288;)U.lens[S++]=8;for(u(l,U.lens,0,288,C,0,U.work,{bits:9}),S=0;S<32;)U.lens[S++]=5;u(h,U.lens,0,32,W,0,U.work,{bits:5}),M=!1}U.lencode=C,U.lenbits=9,U.distcode=W,U.distbits=5}function pt(U,S,_,B){var J,j=U.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new s.Buf8(j.wsize)),B>=j.wsize?(s.arraySet(j.window,S,_-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(B<(J=j.wsize-j.wnext)&&(J=B),s.arraySet(j.window,S,_-B,J,j.wnext),(B-=J)?(s.arraySet(j.window,S,_-B,B,0),j.wnext=B,j.whave=j.wsize):(j.wnext+=J,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=J))),0}i.inflateReset=N,i.inflateReset2=P,i.inflateResetKeep=v,i.inflateInit=function(U){return L(U,15)},i.inflateInit2=L,i.inflate=function(U,S){var _,B,J,j,ht,Q,ut,G,$,yt,st,at,Ut,Wt,Nt,Rt,Mt,Ot,re,Se,E,rt,tt,O,I=0,K=new s.Buf8(4),ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!U||!U.state||!U.output||!U.input&&U.avail_in!==0)return d;(_=U.state).mode===12&&(_.mode=13),ht=U.next_out,J=U.output,ut=U.avail_out,j=U.next_in,B=U.input,Q=U.avail_in,G=_.hold,$=_.bits,yt=Q,st=ut,rt=f;t:for(;;)switch(_.mode){case p:if(_.wrap===0){_.mode=13;break}for(;$<16;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(2&_.wrap&&G===35615){K[_.check=0]=255&G,K[1]=G>>>8&255,_.check=a(_.check,K,2,0),$=G=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&G)<<8)+(G>>8))%31){U.msg="incorrect header check",_.mode=30;break}if((15&G)!=8){U.msg="unknown compression method",_.mode=30;break}if($-=4,E=8+(15&(G>>>=4)),_.wbits===0)_.wbits=E;else if(E>_.wbits){U.msg="invalid window size",_.mode=30;break}_.dmax=1<<E,U.adler=_.check=1,_.mode=512&G?10:12,$=G=0;break;case 2:for(;$<16;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(_.flags=G,(255&_.flags)!=8){U.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){U.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=G>>8&1),512&_.flags&&(K[0]=255&G,K[1]=G>>>8&255,_.check=a(_.check,K,2,0)),$=G=0,_.mode=3;case 3:for(;$<32;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.head&&(_.head.time=G),512&_.flags&&(K[0]=255&G,K[1]=G>>>8&255,K[2]=G>>>16&255,K[3]=G>>>24&255,_.check=a(_.check,K,4,0)),$=G=0,_.mode=4;case 4:for(;$<16;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.head&&(_.head.xflags=255&G,_.head.os=G>>8),512&_.flags&&(K[0]=255&G,K[1]=G>>>8&255,_.check=a(_.check,K,2,0)),$=G=0,_.mode=5;case 5:if(1024&_.flags){for(;$<16;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.length=G,_.head&&(_.head.extra_len=G),512&_.flags&&(K[0]=255&G,K[1]=G>>>8&255,_.check=a(_.check,K,2,0)),$=G=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(Q<(at=_.length)&&(at=Q),at&&(_.head&&(E=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),s.arraySet(_.head.extra,B,j,at,E)),512&_.flags&&(_.check=a(_.check,B,at,j)),Q-=at,j+=at,_.length-=at),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(Q===0)break t;for(at=0;E=B[j+at++],_.head&&E&&_.length<65536&&(_.head.name+=String.fromCharCode(E)),E&&at<Q;);if(512&_.flags&&(_.check=a(_.check,B,at,j)),Q-=at,j+=at,E)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(Q===0)break t;for(at=0;E=B[j+at++],_.head&&E&&_.length<65536&&(_.head.comment+=String.fromCharCode(E)),E&&at<Q;);if(512&_.flags&&(_.check=a(_.check,B,at,j)),Q-=at,j+=at,E)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;$<16;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(G!==(65535&_.check)){U.msg="header crc mismatch",_.mode=30;break}$=G=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),U.adler=_.check=0,_.mode=12;break;case 10:for(;$<32;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}U.adler=_.check=b(G),$=G=0,_.mode=11;case 11:if(_.havedict===0)return U.next_out=ht,U.avail_out=ut,U.next_in=j,U.avail_in=Q,_.hold=G,_.bits=$,2;U.adler=_.check=1,_.mode=12;case 12:if(S===5||S===6)break t;case 13:if(_.last){G>>>=7&$,$-=7&$,_.mode=27;break}for(;$<3;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}switch(_.last=1&G,$-=1,3&(G>>>=1)){case 0:_.mode=14;break;case 1:if(et(_),_.mode=20,S!==6)break;G>>>=2,$-=2;break t;case 2:_.mode=17;break;case 3:U.msg="invalid block type",_.mode=30}G>>>=2,$-=2;break;case 14:for(G>>>=7&$,$-=7&$;$<32;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if((65535&G)!=(G>>>16^65535)){U.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&G,$=G=0,_.mode=15,S===6)break t;case 15:_.mode=16;case 16:if(at=_.length){if(Q<at&&(at=Q),ut<at&&(at=ut),at===0)break t;s.arraySet(J,B,j,at,ht),Q-=at,j+=at,ut-=at,ht+=at,_.length-=at;break}_.mode=12;break;case 17:for(;$<14;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(_.nlen=257+(31&G),G>>>=5,$-=5,_.ndist=1+(31&G),G>>>=5,$-=5,_.ncode=4+(15&G),G>>>=4,$-=4,286<_.nlen||30<_.ndist){U.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;$<3;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.lens[ot[_.have++]]=7&G,G>>>=3,$-=3}for(;_.have<19;)_.lens[ot[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,tt={bits:_.lenbits},rt=u(0,_.lens,0,19,_.lencode,0,_.work,tt),_.lenbits=tt.bits,rt){U.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;Rt=(I=_.lencode[G&(1<<_.lenbits)-1])>>>16&255,Mt=65535&I,!((Nt=I>>>24)<=$);){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(Mt<16)G>>>=Nt,$-=Nt,_.lens[_.have++]=Mt;else{if(Mt===16){for(O=Nt+2;$<O;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(G>>>=Nt,$-=Nt,_.have===0){U.msg="invalid bit length repeat",_.mode=30;break}E=_.lens[_.have-1],at=3+(3&G),G>>>=2,$-=2}else if(Mt===17){for(O=Nt+3;$<O;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}$-=Nt,E=0,at=3+(7&(G>>>=Nt)),G>>>=3,$-=3}else{for(O=Nt+7;$<O;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}$-=Nt,E=0,at=11+(127&(G>>>=Nt)),G>>>=7,$-=7}if(_.have+at>_.nlen+_.ndist){U.msg="invalid bit length repeat",_.mode=30;break}for(;at--;)_.lens[_.have++]=E}}if(_.mode===30)break;if(_.lens[256]===0){U.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,tt={bits:_.lenbits},rt=u(l,_.lens,0,_.nlen,_.lencode,0,_.work,tt),_.lenbits=tt.bits,rt){U.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,tt={bits:_.distbits},rt=u(h,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,tt),_.distbits=tt.bits,rt){U.msg="invalid distances set",_.mode=30;break}if(_.mode=20,S===6)break t;case 20:_.mode=21;case 21:if(6<=Q&&258<=ut){U.next_out=ht,U.avail_out=ut,U.next_in=j,U.avail_in=Q,_.hold=G,_.bits=$,c(U,st),ht=U.next_out,J=U.output,ut=U.avail_out,j=U.next_in,B=U.input,Q=U.avail_in,G=_.hold,$=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;Rt=(I=_.lencode[G&(1<<_.lenbits)-1])>>>16&255,Mt=65535&I,!((Nt=I>>>24)<=$);){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(Rt&&!(240&Rt)){for(Ot=Nt,re=Rt,Se=Mt;Rt=(I=_.lencode[Se+((G&(1<<Ot+re)-1)>>Ot)])>>>16&255,Mt=65535&I,!(Ot+(Nt=I>>>24)<=$);){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}G>>>=Ot,$-=Ot,_.back+=Ot}if(G>>>=Nt,$-=Nt,_.back+=Nt,_.length=Mt,Rt===0){_.mode=26;break}if(32&Rt){_.back=-1,_.mode=12;break}if(64&Rt){U.msg="invalid literal/length code",_.mode=30;break}_.extra=15&Rt,_.mode=22;case 22:if(_.extra){for(O=_.extra;$<O;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.length+=G&(1<<_.extra)-1,G>>>=_.extra,$-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;Rt=(I=_.distcode[G&(1<<_.distbits)-1])>>>16&255,Mt=65535&I,!((Nt=I>>>24)<=$);){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(!(240&Rt)){for(Ot=Nt,re=Rt,Se=Mt;Rt=(I=_.distcode[Se+((G&(1<<Ot+re)-1)>>Ot)])>>>16&255,Mt=65535&I,!(Ot+(Nt=I>>>24)<=$);){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}G>>>=Ot,$-=Ot,_.back+=Ot}if(G>>>=Nt,$-=Nt,_.back+=Nt,64&Rt){U.msg="invalid distance code",_.mode=30;break}_.offset=Mt,_.extra=15&Rt,_.mode=24;case 24:if(_.extra){for(O=_.extra;$<O;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.offset+=G&(1<<_.extra)-1,G>>>=_.extra,$-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){U.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ut===0)break t;if(at=st-ut,_.offset>at){if((at=_.offset-at)>_.whave&&_.sane){U.msg="invalid distance too far back",_.mode=30;break}Ut=at>_.wnext?(at-=_.wnext,_.wsize-at):_.wnext-at,at>_.length&&(at=_.length),Wt=_.window}else Wt=J,Ut=ht-_.offset,at=_.length;for(ut<at&&(at=ut),ut-=at,_.length-=at;J[ht++]=Wt[Ut++],--at;);_.length===0&&(_.mode=21);break;case 26:if(ut===0)break t;J[ht++]=_.length,ut--,_.mode=21;break;case 27:if(_.wrap){for(;$<32;){if(Q===0)break t;Q--,G|=B[j++]<<$,$+=8}if(st-=ut,U.total_out+=st,_.total+=st,st&&(U.adler=_.check=_.flags?a(_.check,J,st,ht-st):o(_.check,J,st,ht-st)),st=ut,(_.flags?G:b(G))!==_.check){U.msg="incorrect data check",_.mode=30;break}$=G=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;$<32;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(G!==(4294967295&_.total)){U.msg="incorrect length check",_.mode=30;break}$=G=0}_.mode=29;case 29:rt=1;break t;case 30:rt=-3;break t;case 31:return-4;case 32:default:return d}return U.next_out=ht,U.avail_out=ut,U.next_in=j,U.avail_in=Q,_.hold=G,_.bits=$,(_.wsize||st!==U.avail_out&&_.mode<30&&(_.mode<27||S!==4))&&pt(U,U.output,U.next_out,st-U.avail_out)?(_.mode=31,-4):(yt-=U.avail_in,st-=U.avail_out,U.total_in+=yt,U.total_out+=st,_.total+=st,_.wrap&&st&&(U.adler=_.check=_.flags?a(_.check,J,st,U.next_out-st):o(_.check,J,st,U.next_out-st)),U.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(yt==0&&st===0||S===4)&&rt===f&&(rt=-5),rt)},i.inflateEnd=function(U){if(!U||!U.state)return d;var S=U.state;return S.window&&(S.window=null),U.state=null,f},i.inflateGetHeader=function(U,S){var _;return U&&U.state&&2&(_=U.state).wrap?((_.head=S).done=!1,f):d},i.inflateSetDictionary=function(U,S){var _,B=S.length;return U&&U.state?(_=U.state).wrap!==0&&_.mode!==11?d:_.mode===11&&o(1,S,B,0)!==_.check?-3:pt(U,S,B,B)?(_.mode=31,-4):(_.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(l,h,f,d,p,g,w,b){var k,v,N,P,L,C,W,M,et,pt=b.bits,U=0,S=0,_=0,B=0,J=0,j=0,ht=0,Q=0,ut=0,G=0,$=null,yt=0,st=new s.Buf16(16),at=new s.Buf16(16),Ut=null,Wt=0;for(U=0;U<=15;U++)st[U]=0;for(S=0;S<d;S++)st[h[f+S]]++;for(J=pt,B=15;1<=B&&st[B]===0;B--);if(B<J&&(J=B),B===0)return p[g++]=20971520,p[g++]=20971520,b.bits=1,0;for(_=1;_<B&&st[_]===0;_++);for(J<_&&(J=_),U=Q=1;U<=15;U++)if(Q<<=1,(Q-=st[U])<0)return-1;if(0<Q&&(l===0||B!==1))return-1;for(at[1]=0,U=1;U<15;U++)at[U+1]=at[U]+st[U];for(S=0;S<d;S++)h[f+S]!==0&&(w[at[h[f+S]]++]=S);if(C=l===0?($=Ut=w,19):l===1?($=o,yt-=257,Ut=a,Wt-=257,256):($=c,Ut=u,-1),U=_,L=g,ht=S=G=0,N=-1,P=(ut=1<<(j=J))-1,l===1&&852<ut||l===2&&592<ut)return 1;for(;;){for(W=U-ht,et=w[S]<C?(M=0,w[S]):w[S]>C?(M=Ut[Wt+w[S]],$[yt+w[S]]):(M=96,0),k=1<<U-ht,_=v=1<<j;p[L+(G>>ht)+(v-=k)]=W<<24|M<<16|et|0,v!==0;);for(k=1<<U-1;G&k;)k>>=1;if(k!==0?(G&=k-1,G+=k):G=0,S++,--st[U]==0){if(U===B)break;U=h[f+w[S]]}if(J<U&&(G&P)!==N){for(ht===0&&(ht=J),L+=_,Q=1<<(j=U-ht);j+ht<B&&!((Q-=st[j+ht])<=0);)j++,Q<<=1;if(ut+=1<<j,l===1&&852<ut||l===2&&592<ut)return 1;p[N=G&P]=J<<24|j<<16|L-g|0}}return G!==0&&(p[L+G]=U-ht<<24|64<<16|0),b.bits=J,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(I){for(var K=I.length;0<=--K;)I[K]=0}var u=0,l=29,h=256,f=h+1+l,d=30,p=19,g=2*f+1,w=15,b=16,k=7,v=256,N=16,P=17,L=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],W=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],et=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],pt=new Array(2*(f+2));c(pt);var U=new Array(2*d);c(U);var S=new Array(512);c(S);var _=new Array(256);c(_);var B=new Array(l);c(B);var J,j,ht,Q=new Array(d);function ut(I,K,ot,lt,X){this.static_tree=I,this.extra_bits=K,this.extra_base=ot,this.elems=lt,this.max_length=X,this.has_stree=I&&I.length}function G(I,K){this.dyn_tree=I,this.max_code=0,this.stat_desc=K}function $(I){return I<256?S[I]:S[256+(I>>>7)]}function yt(I,K){I.pending_buf[I.pending++]=255&K,I.pending_buf[I.pending++]=K>>>8&255}function st(I,K,ot){I.bi_valid>b-ot?(I.bi_buf|=K<<I.bi_valid&65535,yt(I,I.bi_buf),I.bi_buf=K>>b-I.bi_valid,I.bi_valid+=ot-b):(I.bi_buf|=K<<I.bi_valid&65535,I.bi_valid+=ot)}function at(I,K,ot){st(I,ot[2*K],ot[2*K+1])}function Ut(I,K){for(var ot=0;ot|=1&I,I>>>=1,ot<<=1,0<--K;);return ot>>>1}function Wt(I,K,ot){var lt,X,dt=new Array(w+1),Et=0;for(lt=1;lt<=w;lt++)dt[lt]=Et=Et+ot[lt-1]<<1;for(X=0;X<=K;X++){var ft=I[2*X+1];ft!==0&&(I[2*X]=Ut(dt[ft]++,ft))}}function Nt(I){var K;for(K=0;K<f;K++)I.dyn_ltree[2*K]=0;for(K=0;K<d;K++)I.dyn_dtree[2*K]=0;for(K=0;K<p;K++)I.bl_tree[2*K]=0;I.dyn_ltree[2*v]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0}function Rt(I){8<I.bi_valid?yt(I,I.bi_buf):0<I.bi_valid&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0}function Mt(I,K,ot,lt){var X=2*K,dt=2*ot;return I[X]<I[dt]||I[X]===I[dt]&&lt[K]<=lt[ot]}function Ot(I,K,ot){for(var lt=I.heap[ot],X=ot<<1;X<=I.heap_len&&(X<I.heap_len&&Mt(K,I.heap[X+1],I.heap[X],I.depth)&&X++,!Mt(K,lt,I.heap[X],I.depth));)I.heap[ot]=I.heap[X],ot=X,X<<=1;I.heap[ot]=lt}function re(I,K,ot){var lt,X,dt,Et,ft=0;if(I.last_lit!==0)for(;lt=I.pending_buf[I.d_buf+2*ft]<<8|I.pending_buf[I.d_buf+2*ft+1],X=I.pending_buf[I.l_buf+ft],ft++,lt===0?at(I,X,K):(at(I,(dt=_[X])+h+1,K),(Et=C[dt])!==0&&st(I,X-=B[dt],Et),at(I,dt=$(--lt),ot),(Et=W[dt])!==0&&st(I,lt-=Q[dt],Et)),ft<I.last_lit;);at(I,v,K)}function Se(I,K){var ot,lt,X,dt=K.dyn_tree,Et=K.stat_desc.static_tree,ft=K.stat_desc.has_stree,xt=K.stat_desc.elems,le=-1;for(I.heap_len=0,I.heap_max=g,ot=0;ot<xt;ot++)dt[2*ot]!==0?(I.heap[++I.heap_len]=le=ot,I.depth[ot]=0):dt[2*ot+1]=0;for(;I.heap_len<2;)dt[2*(X=I.heap[++I.heap_len]=le<2?++le:0)]=1,I.depth[X]=0,I.opt_len--,ft&&(I.static_len-=Et[2*X+1]);for(K.max_code=le,ot=I.heap_len>>1;1<=ot;ot--)Ot(I,dt,ot);for(X=xt;ot=I.heap[1],I.heap[1]=I.heap[I.heap_len--],Ot(I,dt,1),lt=I.heap[1],I.heap[--I.heap_max]=ot,I.heap[--I.heap_max]=lt,dt[2*X]=dt[2*ot]+dt[2*lt],I.depth[X]=(I.depth[ot]>=I.depth[lt]?I.depth[ot]:I.depth[lt])+1,dt[2*ot+1]=dt[2*lt+1]=X,I.heap[1]=X++,Ot(I,dt,1),2<=I.heap_len;);I.heap[--I.heap_max]=I.heap[1],function(Pt,Sn){var A,m,y,R,F,Z,nt=Sn.dyn_tree,Ft=Sn.max_code,ye=Sn.stat_desc.static_tree,me=Sn.stat_desc.has_stree,_e=Sn.stat_desc.extra_bits,oe=Sn.stat_desc.extra_base,ha=Sn.stat_desc.max_length,xl=0;for(R=0;R<=w;R++)Pt.bl_count[R]=0;for(nt[2*Pt.heap[Pt.heap_max]+1]=0,A=Pt.heap_max+1;A<g;A++)ha<(R=nt[2*nt[2*(m=Pt.heap[A])+1]+1]+1)&&(R=ha,xl++),nt[2*m+1]=R,Ft<m||(Pt.bl_count[R]++,F=0,oe<=m&&(F=_e[m-oe]),Z=nt[2*m],Pt.opt_len+=Z*(R+F),me&&(Pt.static_len+=Z*(ye[2*m+1]+F)));if(xl!==0){do{for(R=ha-1;Pt.bl_count[R]===0;)R--;Pt.bl_count[R]--,Pt.bl_count[R+1]+=2,Pt.bl_count[ha]--,xl-=2}while(0<xl);for(R=ha;R!==0;R--)for(m=Pt.bl_count[R];m!==0;)Ft<(y=Pt.heap[--A])||(nt[2*y+1]!==R&&(Pt.opt_len+=(R-nt[2*y+1])*nt[2*y],nt[2*y+1]=R),m--)}}(I,K),Wt(dt,le,I.bl_count)}function E(I,K,ot){var lt,X,dt=-1,Et=K[1],ft=0,xt=7,le=4;for(Et===0&&(xt=138,le=3),K[2*(ot+1)+1]=65535,lt=0;lt<=ot;lt++)X=Et,Et=K[2*(lt+1)+1],++ft<xt&&X===Et||(ft<le?I.bl_tree[2*X]+=ft:X!==0?(X!==dt&&I.bl_tree[2*X]++,I.bl_tree[2*N]++):ft<=10?I.bl_tree[2*P]++:I.bl_tree[2*L]++,dt=X,le=(ft=0)===Et?(xt=138,3):X===Et?(xt=6,3):(xt=7,4))}function rt(I,K,ot){var lt,X,dt=-1,Et=K[1],ft=0,xt=7,le=4;for(Et===0&&(xt=138,le=3),lt=0;lt<=ot;lt++)if(X=Et,Et=K[2*(lt+1)+1],!(++ft<xt&&X===Et)){if(ft<le)for(;at(I,X,I.bl_tree),--ft!=0;);else X!==0?(X!==dt&&(at(I,X,I.bl_tree),ft--),at(I,N,I.bl_tree),st(I,ft-3,2)):ft<=10?(at(I,P,I.bl_tree),st(I,ft-3,3)):(at(I,L,I.bl_tree),st(I,ft-11,7));dt=X,le=(ft=0)===Et?(xt=138,3):X===Et?(xt=6,3):(xt=7,4)}}c(Q);var tt=!1;function O(I,K,ot,lt){st(I,(u<<1)+(lt?1:0),3),function(X,dt,Et,ft){Rt(X),yt(X,Et),yt(X,~Et),s.arraySet(X.pending_buf,X.window,dt,Et,X.pending),X.pending+=Et}(I,K,ot)}i._tr_init=function(I){tt||(function(){var K,ot,lt,X,dt,Et=new Array(w+1);for(X=lt=0;X<l-1;X++)for(B[X]=lt,K=0;K<1<<C[X];K++)_[lt++]=X;for(_[lt-1]=X,X=dt=0;X<16;X++)for(Q[X]=dt,K=0;K<1<<W[X];K++)S[dt++]=X;for(dt>>=7;X<d;X++)for(Q[X]=dt<<7,K=0;K<1<<W[X]-7;K++)S[256+dt++]=X;for(ot=0;ot<=w;ot++)Et[ot]=0;for(K=0;K<=143;)pt[2*K+1]=8,K++,Et[8]++;for(;K<=255;)pt[2*K+1]=9,K++,Et[9]++;for(;K<=279;)pt[2*K+1]=7,K++,Et[7]++;for(;K<=287;)pt[2*K+1]=8,K++,Et[8]++;for(Wt(pt,f+1,Et),K=0;K<d;K++)U[2*K+1]=5,U[2*K]=Ut(K,5);J=new ut(pt,C,h+1,f,w),j=new ut(U,W,0,d,w),ht=new ut(new Array(0),M,0,p,k)}(),tt=!0),I.l_desc=new G(I.dyn_ltree,J),I.d_desc=new G(I.dyn_dtree,j),I.bl_desc=new G(I.bl_tree,ht),I.bi_buf=0,I.bi_valid=0,Nt(I)},i._tr_stored_block=O,i._tr_flush_block=function(I,K,ot,lt){var X,dt,Et=0;0<I.level?(I.strm.data_type===2&&(I.strm.data_type=function(ft){var xt,le=4093624447;for(xt=0;xt<=31;xt++,le>>>=1)if(1&le&&ft.dyn_ltree[2*xt]!==0)return o;if(ft.dyn_ltree[18]!==0||ft.dyn_ltree[20]!==0||ft.dyn_ltree[26]!==0)return a;for(xt=32;xt<h;xt++)if(ft.dyn_ltree[2*xt]!==0)return a;return o}(I)),Se(I,I.l_desc),Se(I,I.d_desc),Et=function(ft){var xt;for(E(ft,ft.dyn_ltree,ft.l_desc.max_code),E(ft,ft.dyn_dtree,ft.d_desc.max_code),Se(ft,ft.bl_desc),xt=p-1;3<=xt&&ft.bl_tree[2*et[xt]+1]===0;xt--);return ft.opt_len+=3*(xt+1)+5+5+4,xt}(I),X=I.opt_len+3+7>>>3,(dt=I.static_len+3+7>>>3)<=X&&(X=dt)):X=dt=ot+5,ot+4<=X&&K!==-1?O(I,K,ot,lt):I.strategy===4||dt===X?(st(I,2+(lt?1:0),3),re(I,pt,U)):(st(I,4+(lt?1:0),3),function(ft,xt,le,Pt){var Sn;for(st(ft,xt-257,5),st(ft,le-1,5),st(ft,Pt-4,4),Sn=0;Sn<Pt;Sn++)st(ft,ft.bl_tree[2*et[Sn]+1],3);rt(ft,ft.dyn_ltree,xt-1),rt(ft,ft.dyn_dtree,le-1)}(I,I.l_desc.max_code+1,I.d_desc.max_code+1,Et+1),re(I,I.dyn_ltree,I.dyn_dtree)),Nt(I),lt&&Rt(I)},i._tr_tally=function(I,K,ot){return I.pending_buf[I.d_buf+2*I.last_lit]=K>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&K,I.pending_buf[I.l_buf+I.last_lit]=255&ot,I.last_lit++,K===0?I.dyn_ltree[2*ot]++:(I.matches++,K--,I.dyn_ltree[2*(_[ot]+h+1)]++,I.dyn_dtree[2*$(K)]++),I.last_lit===I.lit_bufsize-1},i._tr_align=function(I){st(I,2,3),at(I,v,pt),function(K){K.bi_valid===16?(yt(K,K.bi_buf),K.bi_buf=0,K.bi_valid=0):8<=K.bi_valid&&(K.pending_buf[K.pending++]=255&K.bi_buf,K.bi_buf>>=8,K.bi_valid-=8)}(I)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,f=1,d={},p=!1,g=o.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(o);w=w&&w.setTimeout?w:o,c={}.toString.call(o.process)==="[object process]"?function(N){_i.nextTick(function(){k(N)})}:function(){if(o.postMessage&&!o.importScripts){var N=!0,P=o.onmessage;return o.onmessage=function(){N=!1},o.postMessage("","*"),o.onmessage=P,N}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(N){o.postMessage(h+N,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(N){k(N.data)},function(N){l.port2.postMessage(N)}):g&&"onreadystatechange"in g.createElement("script")?(u=g.documentElement,function(N){var P=g.createElement("script");P.onreadystatechange=function(){k(N),P.onreadystatechange=null,u.removeChild(P),P=null},u.appendChild(P)}):function(N){setTimeout(k,0,N)},w.setImmediate=function(N){typeof N!="function"&&(N=new Function(""+N));for(var P=new Array(arguments.length-1),L=0;L<P.length;L++)P[L]=arguments[L+1];var C={callback:N,args:P};return d[f]=C,c(f),f++},w.clearImmediate=b}function b(N){delete d[N]}function k(N){if(p)setTimeout(k,0,N);else{var P=d[N];if(P){p=!0;try{(function(L){var C=L.callback,W=L.args;switch(W.length){case 0:C();break;case 1:C(W[0]);break;case 2:C(W[0],W[1]);break;case 3:C(W[0],W[1],W[2]);break;default:C.apply(a,W)}})(P)}finally{b(N),p=!1}}}}function v(N){N.source===o&&typeof N.data=="string"&&N.data.indexOf(h)===0&&k(+N.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof gn<"u"?gn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(w1);var w4=w1.exports,Yf=so(w4);const T1={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(T1);var Zn=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},eo,la,us;class T4{constructor(...t){eo.set(this,new Map),la.set(this,new Map),us.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Zn(this,us,"f").has(r)||Zn(this,us,"f").set(r,new Set);const s=Zn(this,us,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Zn(this,la,"f").set(r,a),o=!1,c)continue;const u=Zn(this,eo,"f").get(a);if(u&&u!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${u} -> ${a}". Pass \`force=true\` to override this definition.`);Zn(this,eo,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:Zn(this,eo,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&Zn(this,la,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:Zn(this,us,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of Zn(this,us,"f").values())Object.freeze(t);return this}_getTestState(){return{types:Zn(this,eo,"f"),extensions:Zn(this,la,"f")}}}eo=new WeakMap,la=new WeakMap,us=new WeakMap;var k4=new T4(T1)._freeze();function k1(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return k4.getType(e)??"application/octet-stream"}async function x4(e,t){try{hr(H,e.name);const n=await e.arrayBuffer();(await new Yf().loadAsync(n)).forEach((s,o)=>{o.async("uint8array").then(a=>{const c=k1(s,a),u=new File([a],o.name,{type:c});t(u)}).catch(a=>{ae(H,"crash",a.message)})})}catch(n){ae(H,"crash",n.message)}}async function A4(e,t){try{hr(H,e.name);const n=await e.arrayBuffer();t(new Uint8Array(n))}catch(n){ae(H,"crash",n.message)}}function x1(e,t){function n(r){if(T(t))switch(r){case"text/plain":t.text().then(i=>Fl(H,void 0,"text",`file:${t.name}`,i,e)).catch(i=>ae(H,"crash",i.message));break;case"application/json":t.text().then(i=>Fl(H,void 0,"json",`file:${t.name}`,i,e)).catch(i=>ae(H,"crash",i.message));break;case"application/zip":x4(t,i=>x1(e,i)).catch(i=>ae(H,"crash",i.message));break;case"application/octet-stream":A4(t,i=>Fl(H,void 0,"binary",`file:${t.name}`,i,e)).catch(i=>ae(H,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=k1(t.name,new Uint8Array(i));if(s)n(s);else return ae(H,"parsewebfile",`unsupported file ${t.name}`)}).catch(i=>ae(H,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function Tl(e,t){function n(r){ae(e,"crash",r.message)}t().catch(n)}function v4(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function S4(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const R4=new Date("1980/09/02");async function A1(e){return console.info("saved",e),new Promise((t,n)=>{const r=new Yf;for(let i=0;i<e.length;++i){const s=e[i],o=jO(s);if(o){const a=nx(o);T(a)&&r.file(s.id,a,{date:R4})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(S4(i))}).catch(n)})}async function I4(e){return new Promise((t,n)=>{const r=new Yf;r.loadAsync(v4(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),u=zO(rx(c));T(u)&&i.push(u)}t(i)}).catch(n)})}const v1="$yellow$205$205$205$196";function S1(e,t){return`${e.x},${e.y},${t.x},${t.y}`}let Ge;function N4(){return!!Ge}function O4(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,u=[],l=[];for(let h=i;h<=o;++h)for(let f=r;f<=s;++f){const d={x:f-r,y:h-i},p=Pr(e,{x:f,y:h});(p==null?void 0:p.category)===Dn.ISOBJECT?(u.push(ur(y1(e,f,h))),Ai(p)!=="player"&&l.push({...ur(p),...d,id:"blank"})):u.push({...ur(p),...d})}return{board:e.id,width:a,height:c,terrain:u,objects:l}}function C4(e,t,n,r){const i=cr(e);if(T(i))switch(Ge=O4(i,t,n),r){case"copyobjects":Ge.terrain=[];break;case"copyterrain":Ge.objects=[];break}}function L4(e,t,n){const r=S1(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,v1),Zt(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Zt(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Zt(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=mn(e);i.scroll=Br(e)}function M4(e,t,n,r){const i=cr(e);if(!T(i)||!T(Ge))return;const s=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),c=Math.max(t.y,n.y),u=a-s+1,l=c-o+1,h=Math.min(Ge.width,u),f=Math.min(Ge.height,l);switch(r){case"pasteall":{for(let d=0;d<f;++d)for(let p=0;p<h;++p){const g=Ya({x:p,y:d},Ge.width);fi(i,{...Ge.terrain[g],x:s+p,y:o+d})}for(let d=0;d<Ge.objects.length;++d){const p=Ge.objects[d];T(p.x)&&T(p.y)&&s0(p.x,p.y,0,u-1,l-1,0)&&jf(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let d=0;d<Ge.objects.length;++d){const p=Ge.objects[d];T(p.x)&&T(p.y)&&s0(p.x,p.y,0,u-1,l-1,0)&&jf(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let d=0;d<f;++d)for(let p=0;p<h;++p){const g=Ya({x:p,y:d},Ge.width);fi(i,{...Ge.terrain[g],x:s+p,y:o+d})}break;case"pasteterraintiled":for(let d=o;d<=c;++d)for(let p=s;p<=a;++p){const g=(p-s)%Ge.width,w=(d-o)%Ge.height,b=Ya({x:g,y:w},Ge.width);fi(i,{...Ge.terrain[b],x:p,y:d})}break}}function U4(e,t,n){const r=S1(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,v1),Zt(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Zt(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Zt(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Zt(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=mn(e);i.scroll=Br(e)}const no="$yellow$205$205$205$196";function kl(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function P4(e,t,n,r){const i=cr(e);if(!T(i))return;let s=0;function o(){return s}function a(u,l){Lt(l)&&(s=l,o0(t.x,t.y,n.x,n.y).forEach(h=>{const f=Pr(i,h);T(f)&&(f[u]=l)}))}ce(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,no),Zt(e,`batch:${kl(t,n)}`,"char",[r,"charedit"],o,a);const c=mn(e);c.scroll=Br(e)}function B4(e,t,n,r){const i=cr(e);if(!T(i))return;let s=0;function o(){return s}function a(u,l){if(console.info("memoryinspectcolorarea",u,l),Lt(l)){s=l;for(let h=t.y;h<=n.y;++h)for(let f=t.x;f<=n.x;++f){const d=Pr(i,{x:f,y:h});T(d)&&(d[u]=l)}}}ce(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,no),Zt(e,`batch:${kl(t,n)}`,"color",[r,"coloredit"],o,a);const c=mn(e);c.scroll=Br(e)}function F4(e,t,n,r){const i=cr(e);if(!T(i))return;let s=0;function o(){return s}function a(u,l){Lt(l)&&(s=l,o0(t.x,t.y,n.x,n.y).forEach(h=>{const f=Pr(i,h);T(f)&&(f[u]=l)}))}ce(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,no),Zt(e,`batch:${kl(t,n)}`,"color",[r,"coloredit"],o,a);const c=mn(e);c.scroll=Br(e)}function D4(e,t,n){const r=kl(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,no),Zt(e,"batch","copy elements",[`copy:${r}`,"hk","1"," 1 ","next"]),N4()&&Zt(e,"batch","paste elements",[`paste:${r}`,"hk","2"," 2 ","next"]),Zt(e,"batch","copy coords",[`copycoords:${r}`,"hk","5"," 5 "]),ce(e,no),Zt(e,"batch","set chars:",[`chars:${r}`,"hk","a"," A ","next"]),Zt(e,"batch","set colors:",[`colors:${r}`,"hk","c"," C ","next"]),Zt(e,"batch","set bgs:",[`bgs:${r}`,"hk","b"," B ","next"]),ce(e,no),Zt(e,"batch","make empty",[`empty:${r}`,"hk","0"," 0 ","next"])}const ua="$yellow$205$205$205$196";function Vf(e,t){return`inspect:${t!=null&&t.id?t.id:Ur(e,t)}`}function $4(e,t,n){const r=Fn(Kt.MAIN);if(!T(r))return;const i=cr(e);if(!T(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){T(t)&&(t[f]=d)}const a=t.category===Dn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=Vf(i,t);ce(e,`${a}: ${c} ${u}`),ce(e,ua),Zt(e,l,"color",[n,"coloredit"],s,o);const h=mn(e);h.scroll=Br(e)}function j4(e,t,n){const r=Fn(Kt.MAIN);if(!T(r))return;const i=cr(e);if(!T(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){T(t)&&(t[f]=d)}const a=t.category===Dn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=Vf(i,t);ce(e,`${a}: ${c} ${u}`),ce(e,ua),Zt(e,l,"char",[n,"charedit"],s,o);const h=mn(e);h.scroll=Br(e)}function R1(e,t,n,r,i,s){var h,f,d;function o(p){var w;const g=(r==null?void 0:r[p])??((w=r==null?void 0:r.kinddata)==null?void 0:w[p]);if(!T(g))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Gt.ISWALK;case"pushable":return 0;case"destructible":return 0}return g}function a(p,g){T(r)&&(r[p]=g)}s?ce(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):ce(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),ce(e,ua);const c=Vf(t,r);s?(Zt(e,c,"cycle",["cycle","number","1","255"],o,a),Zt(e,c,"collision",["collision","select","iswalking",`${Gt.ISWALK}`,"isswimming",`${Gt.ISSWIM}`],o,a)):Zt(e,c,"collision",["collision","select","iswalkable",`${Gt.ISWALK}`,"isswimable",`${Gt.ISSWIM}`,"issolid",`${Gt.ISSOLID}`],o,a),s&&Zt(e,c,"pushable",["pushable","select","no","0","yes","1"],o,a),Zt(e,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const u=el(n),l=Dr(u);for(let p=0;p<l.length;++p){const g=l[p];switch(g){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(ie(u[g])){const[w,b,...k]=u[g];At(b)&&Zt(e,c,b||g,[g,w,...k],o,a)}break}}ce(e,ua),Zt(e,c,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],o,a),Zt(e,c,`color: ${r.color??((f=r.kinddata)==null?void 0:f.color)??15}`,["color","hk","c"," C ","next"],o,a),Zt(e,c,`bg: ${r.bg??((d=r.kinddata)==null?void 0:d.bg)??0}`,["bg","hk","b"," B ","next"],o,a),ce(e,ua),Zt(e,c,"make empty",["empty","hk","0"],o,a)}const I1="$yellow$205$205$205$196";function z4(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function K4(e,t,n,r){const i=Fn(Kt.MAIN);if(!T(i))return;const s=cr(e);if(T(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Pr(s,{x:a,y:o});(c==null?void 0:c.category)===Dn.ISOBJECT&&ai(i,s,c,i.timestamp),fi(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Pr(s,{x:a,y:o});(c==null?void 0:c.category)===Dn.ISOBJECT&&ai(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)fi(s,{x:a,y:o});break}}}function W4(e,t,n){const r=z4(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,I1),Zt(e,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),Zt(e,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),Zt(e,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=mn(e);i.scroll=Br(e)}function G4(e,t,n){const r=Fn(Kt.MAIN);if(!T(r))return;const i=cr(e);if(!T(i))return;if(oi(r,i),t.x===n.x&&t.y===n.y){const o=Pr(i,t);if(T(o)){const a=ii(r,Tt.TERRAIN,o.kind??"");T(a)&&R1(e,i,a,o,t,!1);const c=ii(r,Tt.OBJECT,o.kind??"");T(c)&&R1(e,i,c,o,t,!0)}else ce(e,`empty: ${t.x}, ${t.y}`),ce(e,I1)}else D4(e,t,n);const s=mn(e);s.scroll=Br(e)}function H4(e,t){const n=ke(Kt.MAIN);if(!T(n))return;const r=cr(t);if(!T(r))return;const i=ps(e),s=f4(r,i.target);if(T(s))switch(i.path){case"bg":case"color":$4(t,s,i.path);break;case"char":j4(t,s,i.path);break;case"empty":ai(n,r,s,n.timestamp);break;case"code":Tl(H,async()=>{if(!T(t))return;const o=Ai(s),a="object";ee(H,`opened [${a}] ${o}`);const c=[r.id,s.id??""];Lu(ma(n.id,c),s.code??""),kE(H,t),await XE(800),ld(H,n.id,[r.id,s.id??""],a,`${o} - ${n.name}`,t)});break;default:console.info("unknown inspect",i);break}}function Y4(e,t){const n=cr(t);if(!T(n))return;const r=ps(e),[i,s,o,a]=r.path.split(",").map(l=>parseFloat(l)),c={x:i,y:s},u={x:o,y:a};switch(r.target){case"copy":L4(t,c,u);break;case"copyall":case"copyobjects":case"copyterrain":C4(t,c,u,r.target);break;case"paste":U4(t,c,u);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":M4(t,c,u,r.target);break;case"empty":W4(t,c,u);break;case"emptyall":case"emptyobjects":case"emptyterrain":K4(t,c,u,r.target);break;case"chars":P4(t,c,u,"char");break;case"colors":B4(t,c,u,"color");break;case"bgs":F4(t,c,u,"bg");break;case"copycoords":{IE(H,r.path,hi());break}default:console.info("unknown batch",r);break}}const V4=16,hs={},q4=64;let N1=0;const ro={},io={};async function X4(){const e=aa(),t=ke(Kt.MAIN);if(e.length&&T(t)){const n=await A1(e),r=`${new Date().toISOString()} ${t.name} ${n.length} chars`;SE(Le,r,n,hi())}}async function J4(){const e=aa(),t=ke(Kt.MAIN);if(e.length&&T(t)){const n=await A1(e);RE(Le,n,hi())}}const Le=ms("vm",["tick","second"],e=>{var t;if(Le.session(e))switch(e.target){case"operator":T(e.player)&&(KL(e.player),se(Le,`operator set to ${e.player}`),Le.replynext(e,"ackoperator",!0,e.player));break;case"zsswords":if(e.player===hi()){const n=ke(Kt.MAIN);Le.replynext(e,"ackzsswords",{cli:Sf(Mi.CLI),loader:Sf(Mi.LOADER),runtime:Sf(Mi.RUNTIME),flags:[...Dr(ls(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...ss(n,Tt.OBJECT).map(r=>Pn(r)),...Dr(kf)],altkinds:[...ss(n,Tt.TERRAIN),...ss(n,Tt.BOARD),...ss(n,Tt.PALETTE),...ss(n,Tt.CHARSET),...ss(n,Tt.LOADER)].map(r=>Pn(r)),colors:[...Dr(vo)],dirs:[...Dr(Ff).filter(r=>["cw","ccw","oop","rndp"].includes(r)===!1)],dirmods:["cw","ccw","oop","rndp",...Dr(xf)]},e.player)}break;case"books":e.player===hi()&&Tl(Le,async()=>{if(e.player&&ie(e.data)){const[n,r]=e.data,i=await I4(n),s=i.map(o=>o.name);qL(i,r),se(Le,`loading ${s.join(", ")}`),Ul(Le,e.player)}});break;case"joinack":T(e.player)&&!QL(e.player)&&Ul(Le,e.player);break;case"logout":T(e.player)&&(ZL(e.player),delete hs[e.player],se(Le,`player ${e.player} logout`),Ul(Le,e.player));break;case"login":T(e.player)&&JL(e.player)&&(hs[e.player]=0,se(Le,`login from ${e.player}`),Le.replynext(e,"acklogin",!0,e.player));break;case"doot":T(e.player)&&(hs[e.player]=0,cd(Le,"active",e.player));break;case"input":if(T(e.player)){const n=ls(e.player),[r=ln.NONE,i=0]=e.data??[ln.NONE,0];ie(n.inputqueue)||(n.inputqueue=[]),r!==ln.NONE&&n.inputqueue.push([r,i])}break;case"codewatch":if(T(e.player)&&ie(e.data)){const[n,r]=e.data,i=ma(n,r);T(io[i])||(io[i]=n0(i,s=>{const[o,a]=r,c=Pi(n),u=Ws(c,o);if(T(u))if(Ni(u)===Tt.BOARD&&T(a)){const l=ri(u),h=vn(l,a);T(h)&&(h.code=s,af(l_(s),h))}else u.code=s,$O(u)})),ro[i]=ro[i]??new Set,ro[i].add(e.player)}break;case"coderelease":if(e.player&&ie(e.data)){const[n,r]=e.data,[,i]=r,s=ma(n,r);T(ro[s])&&(ro[s].delete(e.player),ro[s].size===0&&((t=io[s])==null||t.call(io),io[s]=void 0,At(i)&&n4(i)))}break;case"halt":e.player===hi()&&pE(e.data)&&WL(e.data);break;case"tick":GL()||i4();break;case"synthsend":At(e.data)&&Bf(e.data,void 0);break;case"second":{t4(hs);const n=Object.keys(hs);for(let r=0;r<n.length;++r)++hs[n[r]];for(let r=0;r<n.length;++r){const i=n[r];hs[i]>=V4&&ud(Le,i)}++N1>=q4&&(N1=0,Bl(Le,hi()));break}case"fork":Tl(Le,async()=>{await J4()});break;case"flush":Tl(Le,async()=>{await X4()});break;case"cli":T(e.player)&&s4(e.player,e.data);break;case"restart":e.player===hi()&&(r4(),Bl(Le,e.player));break;case"inspect":if(T(e.player)&&ie(e.data)){const[n,r]=e.data;G4(e.player,n,r)}break;case"loader":if(T(e.player)&&ie(e.data)){const[n,r,i,s]=e.data;r==="file"?x1(e.player,s):AC(n,r,i,s,e.player)}break;default:{const{target:n,path:r}=ps(e.target);switch(Bt(n)){case"batch":T(e.player)&&Y4(r,e.player);break;case"inspect":T(e.player)&&H4(r,e.player);break;case"touched":if(ie(e.data)){const[i,s,o]=e.data;h1({...e,target:`${i}:${o}`,data:void 0,sender:s})}break;default:h1(e);break}break}}},zL());function Z4(){vE(Le)}const{forward:Q4}=VE(e=>postMessage(e));onmessage=function(t){Q4(t.data)},setTimeout(Z4,100)})();

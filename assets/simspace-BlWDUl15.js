var $M=Object.defineProperty;var jM=(Qr,Un,xn)=>Un in Qr?$M(Qr,Un,{enumerable:!0,configurable:!0,writable:!0,value:xn}):Qr[Un]=xn;var Ot=(Qr,Un,xn)=>jM(Qr,typeof Un!="symbol"?Un+"":Un,xn);(function(){"use strict";const Qr=new Set,Un={emit(e,t,n,r,i){Un.invoke(Wb(e,t,n,r,i))},invoke(e){Qr.forEach(t=>t.handle(e))},connect(e){Qr.add(e)},disconnect(e){Qr.delete(e)}};var xn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ts(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function cb(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var pd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(xn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=r();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(pd);var lb=pd.exports,md=Ts(lb),gd={};(function(e){var t=xn&&xn.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var f=0,d=l.length,p;f<d;f++)(p||!(f in l))&&(p||(p=Array.prototype.slice.call(l,0,f)),p[f]=l[f]);return u.concat(p||Array.prototype.slice.call(l))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(u){return u[Math.floor(Math.random()*u.length)]}function r(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,f=u.capitalize,d=f===void 0?!0:f,p=u.adjectiveCount,m=p===void 0?1:p,x=u.addAdverb,w=x===void 0?!1:x,T=t(t(t([],t([],Array(m),!0).map(function(v){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),w?[n(e.adverbs)]:[],!0);return d&&(T=T.map(function(v){return v.charAt(0).toUpperCase()+v.substr(1)})),T.join(h)}e.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(d?e.adverbs.length:1)}e.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,m=p===void 0?"":p;return r(e.adjectives).length*h+h*m.length+r(e.nouns).length+m.length+r(e.verbs).length+(d?r(e.adverbs).length+m.length:0)}e.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,m=p===void 0?"":p;return i(e.adjectives).length*h+h*m.length+i(e.nouns).length+m.length+i(e.verbs).length+(d?i(e.adverbs).length+m.length:0)}e.minLength=c,e.default=s})(gd);var ub=Ts(gd);const hb="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let fb=e=>crypto.getRandomValues(new Uint8Array(e)),db=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},yd=(e,t=21)=>db(e,t,fb),pb=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=hb[n[e]&63];return t};var _d="abcdefghijklmnopqrstuvwxyz",bd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Ed="0123456789",mb="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",gb="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const yb=Ed,_b=_d,bb=bd;var Eb=yb+_b+bb,Dl={lowercase:_d,uppercase:bd,numbers:Ed,nolookalikes:mb,nolookalikesSafe:gb,alphanumeric:Eb};function Ne(){return`sid_${pb(12).replaceAll("-",".")}`}yd(Dl.numbers,4),yd(`${Dl.numbers}${Dl.lowercase}`,16);function Vi(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function wb(){return ub({capitalize:!1,adjectiveCount:1})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var xb=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),kb=Object.prototype.hasOwnProperty;function $l(e,t){return kb.call(e,t)}function jl(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)$l(e,i)&&r.push(i);return r}function kn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function zl(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Xi(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function wd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Wl(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Wl(e[t]))return!0}else if(typeof e=="object"){for(var r=jl(e),i=r.length,s=0;s<i;s++)if(Wl(e[r[s]]))return!0}}return!1}function xd(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var kd=function(e){xb(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,xd(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=xd(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),ve=kd,Tb=kn,As={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Sa(n,this.path);r&&(r=kn(r));var i=qi(n,{op:"remove",path:this.from}).removed;return qi(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Sa(n,this.from);return qi(n,{op:"add",path:this.path,value:kn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:ko(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Ab={add:function(e,t,n){return zl(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:As.move,copy:As.copy,test:As.test,_get:As._get};function Sa(e,t){if(t=="")return e;var n={op:"_get",path:t};return qi(e,n),n.value}function qi(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Ra(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Sa(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=ko(e,t.value),o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=kn(e));var a=t.path||"",c=a.split("/"),u=e,l=1,h=c.length,f=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=Ra;;){if(d=c[l],d&&d.indexOf("~")!=-1&&(d=wd(d)),i&&(d=="__proto__"||d=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&f===void 0&&(u[d]===void 0?f=c.slice(0,l).join("/"):l==h-1&&(f=t.path),f!==void 0&&p(t,0,e,f)),l++,Array.isArray(u)){if(d==="-")d=u.length;else{if(n&&!zl(d))throw new ve("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);zl(d)&&(d=~~d)}if(l>=h){if(n&&t.op==="add"&&d>u.length)throw new ve("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=Ab[t.op].call(t,u,d,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(l>=h){var o=As[t.op].call(t,u,d,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(u=u[d],n&&l<h&&(!u||typeof u!="object"))throw new ve("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Kl(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=kn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=qi(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function vb(e,t,n){var r=qi(e,t);if(r.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Ra(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new ve("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(As[e.op]){if(typeof e.path!="string")throw new ve("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new ve('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new ve("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Wl(e.value))throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new ve("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new ve("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Td([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ve("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function Td(e,t,n){try{if(!Array.isArray(e))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Kl(kn(t),kn(e),n||!0);else{n=n||Ra;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof ve)return i;throw i}}function ko(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!ko(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ko(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var Sb=Object.freeze({__proto__:null,JsonPatchError:ve,_areEquals:ko,applyOperation:qi,applyPatch:Kl,applyReducer:vb,deepClone:Tb,getValueByPointer:Sa,validate:Td,validator:Ra});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Gl=new WeakMap,Rb=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Ib=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function Nb(e){return Gl.get(e)}function Ob(e,t){return e.observers.get(t)}function Cb(e,t){e.observers.delete(t.callback)}function Lb(e,t){t.unobserve()}function Mb(e,t){var n=[],r,i=Nb(e);if(!i)i=new Rb(e),Gl.set(e,i);else{var s=Ob(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=kn(e),t){r.callback=t,r.next=null;var o=function(){Hl(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){Hl(r),clearTimeout(r.next),Cb(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new Ib(t,r)),r}function Hl(e,t){t===void 0&&(t=!1);var n=Gl.get(e.object);Yl(n.value,e.object,e.patches,"",t),e.patches.length&&Kl(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Yl(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=jl(t),o=jl(e),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=e[u];if($l(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var h=t[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?Yl(l,h,n,r+"/"+Xi(u),i):l!==h&&(i&&n.push({op:"test",path:r+"/"+Xi(u),value:kn(l)}),n.push({op:"replace",path:r+"/"+Xi(u),value:kn(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Xi(u),value:kn(l)}),n.push({op:"remove",path:r+"/"+Xi(u)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!$l(e,u)&&t[u]!==void 0&&n.push({op:"add",path:r+"/"+Xi(u),value:kn(t[u])})}}}function Ad(e,t,n){n===void 0&&(n=!1);var r=[];return Yl(e,t,r,"",n),r}var Ub=Object.freeze({__proto__:null,compare:Ad,generate:Hl,observe:Mb,unobserve:Lb});Object.assign({},Sb,Ub,{JsonPatchError:kd,deepClone:kn,escapePathComponent:Xi,unescapePathComponent:wd});var Fb=typeof Element<"u",Bb=typeof Map=="function",Pb=typeof Set=="function",Db=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ia(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ia(e[r],t[r]))return!1;return!0}var s;if(Bb&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ia(r.value[1],t.get(r.value[0])))return!1;return!0}if(Pb&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(Db&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(Fb&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ia(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var $b=function(t,n){try{return Ia(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},jb=Ts($b);function k(e){return e!=null}const Kn=Object.keys;function Xe(e){return kn(e)}function zb(e){return typeof e=="boolean"}function Ct(e){return typeof e=="number"&&isNaN(e)===!1}function St(e){return typeof e=="string"}function re(e){return Array.isArray(e)}function Vl(e){return e}var Wt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Wt||{}),Yt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Yt||{}),Gn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Gn||{}),yt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(yt||{}),wt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.COPYIT=13]="COPYIT",e[e.OPENIT=14]="OPENIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(wt||{});function Mt(e){return e.toLowerCase().trim()}function Wb(e,t,n,r,i){return{session:e,player:t,id:Ne(),sender:n,target:r,data:i}}function lr(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function vs(e,t=[],n=Vl,r=""){const i=Ne(),s=Mt(e),o=t.map(Mt);let a=r;const c={id(){return i},name(){return e},session(u){return k(u)?u.session===a?u.session:"":a},topics(){return t},emit(u,l,h){Un.emit(a,u,i,l,h)},reply(u,l,h){c.emit(u.player,`${u.sender}:${l}`,h)},replynext(u,l,h){setTimeout(()=>c.emit(u.player,`${u.sender}:${l}`,h),64)},handle(u){const{target:l,path:h}=lr(u.target),f=Mt(l);!a&&f==="ready"&&(a=u.session),f==="bridge"&&k(u.session)&&(a=u.session),o.findIndex(d=>d==="all"||d===f)!==-1&&n(u),(i===l||f==="all"||s===f)&&n({...u,target:h})}};return Un.connect(c),c}function Kb(e){return typeof e=="object"&&St(e.session)&&St(e.player)&&St(e.id)&&St(e.sender)&&St(e.target)}function ue(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function ti(e,t,...n){return e.emit(t,"info",n),!0}function vd(e,t,...n){return e.emit(t,"debug",n),!0}function Gb(e,t,n){e.emit(t,"toast",n)}function Hb(e,t,n){e.emit(t,"bridge:startstream",n)}function Yb(e,t){e.emit(t,"bridge:stopstream",void 0)}function Vb(e,t,n){e.emit(t,"bridge:chatconnect",n)}function Xb(e,t){e.emit(t,"bridge:chatdisconnect")}function qb(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function Jb(e,t,n){e.emit(t,"bridge:start",n)}function Zb(e,t,n){e.emit(t,"bridge:tab",n)}function Qb(e,t,n){e.emit(t,"gadgetclient:paint",n)}function tE(e,t,n){e.emit(t,"gadgetclient:patch",n)}function eE(e,t){e.emit(t,"gadgetserver:clearscroll")}function nE(e){e.emit("","ready")}function rE(e,t){e.emit(t,"register:loginfail")}function Xl(e,t){e.emit(t,"register:loginready",!0)}function iE(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function sE(e,t,n){e.emit(t,"register:forkmem",[n])}function ql(e,t,n){e.emit(t,"register:copy",n)}function oE(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function Sd(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function aE(e,t){e.emit(t,"register:dev",void 0)}function cE(e,t){e.emit(t,"register:share",void 0)}function lE(e,t){e.emit(t,"register:nuke",void 0)}function uE(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function hE(e,t,n){e.emit(t,"synth:tta",[n])}function fE(e,t,n,r){e.emit(t,"synth:play",[n,r])}function dE(e,t,n){e.emit(t,"synth:bpm",n)}function pE(e,t,n){e.emit(t,"synth:playvolume",n)}function mE(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function gE(e,t,n){e.emit(t,"synth:ttsvolume",n)}function Jl(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function Rd(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function yE(e,t){e.emit(t,"register:inspector")}function Id(e,t,n,r,i,s,o){e.emit(t,"register:editor:open",[n,r,i,s,o])}function _E(e,t){e.emit(t,"register:editor:close")}function Nd(e,t){e.emit(t,"vm:logout")}function Na(e,t){const[n,r]=t;return`${e}:${[n,r].filter(k).join(":")}`}function bE(e,t,n){e.emit(t,"vm:cli",n)}function EE(e,t){e.emit(t,"vm:restart")}function Od(e,t){e.emit(t,"vm:flush")}function wE(e,t){e.emit(t,"vm:fork")}function xE(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function kE(e,t){return{filename:e,json:t}}function TE(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function Zl(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=xE(i,s);break;case"json":o=kE(i,s);break;case"binary":o=TE(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function AE(e){const t=new Set;function n(s){Kb(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Un.invoke(s))}const r=vs("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Un.disconnect(r)}return{forward:n,disconnect:i}}function vE(e){switch(e.target){case"info":case"debug":case"error":case"tick":case"tock":case"ready":case"second":return!0;default:{const t=lr(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const Ql=66.666,Oa=Math.round(1e3/Ql),SE=3;function Cd(e){return new Promise(t=>setTimeout(t,e))}const tu=vs("clock");let eu=0,Ca=0,nu=0,Ld=performance.now();function Md(){const e=performance.now(),t=e-Ld;nu+=t,nu>=Ql&&(nu%=Ql,tu.emit("","tick",Ca),tu.emit("","tock",Ca),++eu,++Ca,eu>=Oa&&(eu%=Oa,tu.emit("","second",Ca))),Ld=e,setTimeout(Md,2)}Md();const Ud=1,Fd=2,ru=4,iu=8,To=32,ei=64,Fn=128,La=31,su=63,Ji=127,RE=2147483647,vi=Math.floor,Ma=Math.abs,Bd=(e,t)=>e<t?e:t,Zi=(e,t)=>e>t?e:t,Pd=e=>e!==0?e<0:1/e<0,Dd=Number.MAX_SAFE_INTEGER,IE=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&vi(e)===e),Ss=()=>new Set,ou=e=>e[e.length-1],NE=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Si=Array.from,OE=Array.isArray,CE=e=>e.toLowerCase(),LE=/^\s*/g,ME=e=>e.replace(LE,""),UE=/([A-Z])/g,$d=(e,t)=>ME(e.replace(UE,n=>`${t}${CE(n)}`)),FE=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Ao=typeof TextEncoder<"u"?new TextEncoder:null,BE=Ao?e=>Ao.encode(e):FE;let vo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});vo&&vo.decode(new Uint8Array).length===1&&(vo=null);const Ri=e=>new Error(e),Tr=()=>{throw Ri("Method unimplemented")},Ar=()=>{throw Ri("Unexpected case")};class So{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Ii=()=>new So,PE=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},ur=e=>{const t=new Uint8Array(PE(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},DE=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Zi(n,t)*2),e.cpos=0)},qe=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},au=qe,$t=(e,t)=>{for(;t>Ji;)qe(e,Fn|Ji&t),t=vi(t/128);qe(e,Ji&t)},cu=(e,t)=>{const n=Pd(t);for(n&&(t=-t),qe(e,(t>su?Fn:0)|(n?ei:0)|su&t),t=vi(t/64);t>0;)qe(e,(t>Ji?Fn:0)|Ji&t),t=vi(t/128)},lu=new Uint8Array(3e4),$E=lu.length/3,jE=(e,t)=>{if(t.length<$E){const n=Ao.encodeInto(t,lu).written||0;$t(e,n);for(let r=0;r<n;r++)qe(e,lu[r])}else an(e,BE(t))},zE=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;$t(e,r);for(let i=0;i<r;i++)qe(e,n.codePointAt(i))},Rs=Ao&&Ao.encodeInto?jE:zE,Ua=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=Bd(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Zi(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},an=(e,t)=>{$t(e,t.byteLength),Ua(e,t)},uu=(e,t)=>{DE(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},WE=(e,t)=>uu(e,4).setFloat32(0,t,!1),KE=(e,t)=>uu(e,8).setFloat64(0,t,!1),GE=(e,t)=>uu(e,8).setBigInt64(0,t,!1),jd=new DataView(new ArrayBuffer(4)),HE=e=>(jd.setFloat32(0,e),jd.getFloat32(0)===e),Ro=(e,t)=>{switch(typeof t){case"string":qe(e,119),Rs(e,t);break;case"number":IE(t)&&Ma(t)<=RE?(qe(e,125),cu(e,t)):HE(t)?(qe(e,124),WE(e,t)):(qe(e,123),KE(e,t));break;case"bigint":qe(e,122),GE(e,t);break;case"object":if(t===null)qe(e,126);else if(OE(t)){qe(e,117),$t(e,t.length);for(let n=0;n<t.length;n++)Ro(e,t[n])}else if(t instanceof Uint8Array)qe(e,116),an(e,t);else{qe(e,118);const n=Object.keys(t);$t(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Rs(e,i),Ro(e,t[i])}}break;case"boolean":qe(e,t?120:121);break;default:qe(e,127)}};class zd extends So{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&$t(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Wd=e=>{e.count>0&&(cu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&$t(e.encoder,e.count-2))};class Fa{constructor(){this.encoder=new So,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Wd(this),this.count=1,this.s=t)}toUint8Array(){return Wd(this),ur(this.encoder)}}const Kd=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);cu(e.encoder,t),e.count>1&&$t(e.encoder,e.count-2)}};class hu{constructor(){this.encoder=new So,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Kd(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Kd(this),ur(this.encoder)}}class YE{constructor(){this.sarr=[],this.s="",this.lensE=new Fa}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new So;return this.sarr.push(this.s),this.s="",Rs(t,this.sarr.join("")),Ua(t,this.lensE.toUint8Array()),ur(t)}}const Gd=Ri("Unexpected end of array"),Hd=Ri("Integer out of Range");class Ba{constructor(t){this.arr=t,this.pos=0}}const Qi=e=>new Ba(e),VE=e=>e.pos!==e.arr.length,XE=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},dn=e=>XE(e,jt(e)),Is=e=>e.arr[e.pos++],jt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&Ji)*n,n*=128,i<Fn)return t;if(t>Dd)throw Hd}throw Gd},fu=e=>{let t=e.arr[e.pos++],n=t&su,r=64;const i=(t&ei)>0?-1:1;if(!(t&Fn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&Ji)*r,r*=128,t<Fn)return i*n;if(n>Dd)throw Hd}throw Gd},Ns=vo?e=>vo.decode(dn(e)):e=>{let t=jt(e);if(t===0)return"";{let n=String.fromCodePoint(Is(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Is(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},du=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},qE=[e=>{},e=>null,fu,e=>du(e,4).getFloat32(0,!1),e=>du(e,8).getFloat64(0,!1),e=>du(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Ns,e=>{const t=jt(e),n={};for(let r=0;r<t;r++){const i=Ns(e);n[i]=Io(e)}return n},e=>{const t=jt(e),n=[];for(let r=0;r<t;r++)n.push(Io(e));return n},dn],Io=e=>qE[127-Is(e)](e);class Yd extends Ba{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),VE(this)?this.count=jt(this)+1:this.count=-1),this.count--,this.s}}class Pa extends Ba{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=fu(this);const t=Pd(this.s);this.count=1,t&&(this.s=-this.s,this.count=jt(this)+2)}return this.count--,this.s}}class pu extends Ba{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=fu(this),n=t&1;this.diff=vi(t/2),this.count=1,n&&(this.count=jt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class JE{constructor(t){this.decoder=new Pa(t),this.str=Ns(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}var Vt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var No=Symbol.for("react.element"),ZE=Symbol.for("react.portal"),QE=Symbol.for("react.fragment"),tw=Symbol.for("react.strict_mode"),ew=Symbol.for("react.profiler"),nw=Symbol.for("react.provider"),rw=Symbol.for("react.context"),iw=Symbol.for("react.forward_ref"),sw=Symbol.for("react.suspense"),ow=Symbol.for("react.memo"),aw=Symbol.for("react.lazy"),Vd=Symbol.iterator;function cw(e){return e===null||typeof e!="object"?null:(e=Vd&&e[Vd]||e["@@iterator"],typeof e=="function"?e:null)}var Xd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qd=Object.assign,Jd={};function Os(e,t,n){this.props=e,this.context=t,this.refs=Jd,this.updater=n||Xd}Os.prototype.isReactComponent={},Os.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Os.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Zd(){}Zd.prototype=Os.prototype;function mu(e,t,n){this.props=e,this.context=t,this.refs=Jd,this.updater=n||Xd}var gu=mu.prototype=new Zd;gu.constructor=mu,qd(gu,Os.prototype),gu.isPureReactComponent=!0;var Qd=Array.isArray,tp=Object.prototype.hasOwnProperty,yu={current:null},ep={key:!0,ref:!0,__self:!0,__source:!0};function np(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)tp.call(t,r)&&!ep.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:No,type:e,key:s,ref:o,props:i,_owner:yu.current}}function lw(e,t){return{$$typeof:No,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function _u(e){return typeof e=="object"&&e!==null&&e.$$typeof===No}function uw(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var rp=/\/+/g;function bu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?uw(""+e.key):t.toString(36)}function Da(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case No:case ZE:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+bu(o,0):r,Qd(i)?(n="",e!=null&&(n=e.replace(rp,"$&/")+"/"),Da(i,t,n,"",function(u){return u})):i!=null&&(_u(i)&&(i=lw(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(rp,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",Qd(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+bu(s,a);o+=Da(s,t,n,c,i)}else if(c=cw(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+bu(s,a++),o+=Da(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function $a(e,t,n){if(e==null)return e;var r=[],i=0;return Da(e,r,"","",function(s){return t.call(n,s,i++)}),r}function hw(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var pn={current:null},ja={transition:null},fw={ReactCurrentDispatcher:pn,ReactCurrentBatchConfig:ja,ReactCurrentOwner:yu};function ip(){throw Error("act(...) is not supported in production builds of React.")}Vt.Children={map:$a,forEach:function(e,t,n){$a(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return $a(e,function(){t++}),t},toArray:function(e){return $a(e,function(t){return t})||[]},only:function(e){if(!_u(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Vt.Component=Os,Vt.Fragment=QE,Vt.Profiler=ew,Vt.PureComponent=mu,Vt.StrictMode=tw,Vt.Suspense=sw,Vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fw,Vt.act=ip,Vt.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=qd({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=yu.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)tp.call(t,c)&&!ep.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:No,type:e.type,key:i,ref:s,props:r,_owner:o}},Vt.createContext=function(e){return e={$$typeof:rw,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:nw,_context:e},e.Consumer=e},Vt.createElement=np,Vt.createFactory=function(e){var t=np.bind(null,e);return t.type=e,t},Vt.createRef=function(){return{current:null}},Vt.forwardRef=function(e){return{$$typeof:iw,render:e}},Vt.isValidElement=_u,Vt.lazy=function(e){return{$$typeof:aw,_payload:{_status:-1,_result:e},_init:hw}},Vt.memo=function(e,t){return{$$typeof:ow,type:e,compare:t===void 0?null:t}},Vt.startTransition=function(e){var t=ja.transition;ja.transition={};try{e()}finally{ja.transition=t}},Vt.unstable_act=ip,Vt.useCallback=function(e,t){return pn.current.useCallback(e,t)},Vt.useContext=function(e){return pn.current.useContext(e)},Vt.useDebugValue=function(){},Vt.useDeferredValue=function(e){return pn.current.useDeferredValue(e)},Vt.useEffect=function(e,t){return pn.current.useEffect(e,t)},Vt.useId=function(){return pn.current.useId()},Vt.useImperativeHandle=function(e,t,n){return pn.current.useImperativeHandle(e,t,n)},Vt.useInsertionEffect=function(e,t){return pn.current.useInsertionEffect(e,t)},Vt.useLayoutEffect=function(e,t){return pn.current.useLayoutEffect(e,t)},Vt.useMemo=function(e,t){return pn.current.useMemo(e,t)},Vt.useReducer=function(e,t,n){return pn.current.useReducer(e,t,n)},Vt.useRef=function(e){return pn.current.useRef(e)},Vt.useState=function(e){return pn.current.useState(e)},Vt.useSyncExternalStore=function(e,t,n){return pn.current.useSyncExternalStore(e,t,n)},Vt.useTransition=function(){return pn.current.useTransition()},Vt.version="18.3.1";const Cs=globalThis||void 0||self,hr=()=>new Map,Eu=e=>{const t=hr();return e.forEach((n,r)=>{t.set(r,n)}),t},Ni=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},dw=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},pw=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1};class mw{constructor(){this._observers=hr()}on(t,n){return Ni(this._observers,t,Ss).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Si((this._observers.get(t)||hr()).values()).forEach(r=>r(...n))}destroy(){this._observers=hr()}}const gw=crypto.getRandomValues.bind(crypto),sp=()=>gw(new Uint32Array(1))[0],yw="10000000-1000-4000-8000"+-1e11,_w=()=>yw.replace(/[018]/g,e=>(e^sp()&15>>e/4).toString(16)),op=e=>new Promise(e);Promise.all.bind(Promise);var ap={},za={};za.byteLength=ww,za.toByteArray=kw,za.fromByteArray=vw;for(var vr=[],Hn=[],bw=typeof Uint8Array<"u"?Uint8Array:Array,wu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ls=0,Ew=wu.length;Ls<Ew;++Ls)vr[Ls]=wu[Ls],Hn[wu.charCodeAt(Ls)]=Ls;Hn[45]=62,Hn[95]=63;function cp(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function ww(e){var t=cp(e),n=t[0],r=t[1];return(n+r)*3/4-r}function xw(e,t,n){return(t+n)*3/4-n}function kw(e){var t,n=cp(e),r=n[0],i=n[1],s=new bw(xw(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=Hn[e.charCodeAt(c)]<<18|Hn[e.charCodeAt(c+1)]<<12|Hn[e.charCodeAt(c+2)]<<6|Hn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=Hn[e.charCodeAt(c)]<<2|Hn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=Hn[e.charCodeAt(c)]<<10|Hn[e.charCodeAt(c+1)]<<4|Hn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Tw(e){return vr[e>>18&63]+vr[e>>12&63]+vr[e>>6&63]+vr[e&63]}function Aw(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Tw(r));return i.join("")}function vw(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Aw(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(vr[t>>2]+vr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(vr[t>>10]+vr[t>>4&63]+vr[t<<2&63]+"=")),i.join("")}var xu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */xu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,u=c>>1,l=-7,h=n?i-1:0,f=n?-1:1,d=e[t+h];for(h+=f,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=s*256+e[t+h],h+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=o*256+e[t+h],h+=f,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-u}return(d?-1:1)*o*Math.pow(2,s-r)},xu.write=function(e,t,n,r,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,h=l>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,m=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=f/c:t+=f*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+d]=a&255,d+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+d]=o&255,d+=p,o/=256,u-=8);e[n+d-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=za,n=xu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=U,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const A=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(A,g),A.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(A){if(A>i)throw new RangeError('The value "'+A+'" is invalid for option "size"');const g=new s(A);return Object.setPrototypeOf(g,l.prototype),g}function l(A,g,y){if(typeof A=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(A)}return h(A,g,y)}l.poolSize=8192;function h(A,g,y){if(typeof A=="string")return m(A,g);if(o.isView(A))return w(A);if(A==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A);if(dt(A,o)||A&&dt(A.buffer,o)||typeof a<"u"&&(dt(A,a)||A&&dt(A.buffer,a)))return T(A,g,y);if(typeof A=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const O=A.valueOf&&A.valueOf();if(O!=null&&O!==A)return l.from(O,g,y);const $=v(A);if($)return $;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof A[Symbol.toPrimitive]=="function")return l.from(A[Symbol.toPrimitive]("string"),g,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A)}l.from=function(A,g,y){return h(A,g,y)},Object.setPrototypeOf(l.prototype,s.prototype),Object.setPrototypeOf(l,s);function f(A){if(typeof A!="number")throw new TypeError('"size" argument must be of type number');if(A<0)throw new RangeError('The value "'+A+'" is invalid for option "size"')}function d(A,g,y){return f(A),A<=0?u(A):g!==void 0?typeof y=="string"?u(A).fill(g,y):u(A).fill(g):u(A)}l.alloc=function(A,g,y){return d(A,g,y)};function p(A){return f(A),u(A<0?0:I(A)|0)}l.allocUnsafe=function(A){return p(A)},l.allocUnsafeSlow=function(A){return p(A)};function m(A,g){if((typeof g!="string"||g==="")&&(g="utf8"),!l.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const y=S(A,g)|0;let O=u(y);const $=O.write(A,g);return $!==y&&(O=O.slice(0,$)),O}function x(A){const g=A.length<0?0:I(A.length)|0,y=u(g);for(let O=0;O<g;O+=1)y[O]=A[O]&255;return y}function w(A){if(dt(A,s)){const g=new s(A);return T(g.buffer,g.byteOffset,g.byteLength)}return x(A)}function T(A,g,y){if(g<0||A.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(A.byteLength<g+(y||0))throw new RangeError('"length" is outside of buffer bounds');let O;return g===void 0&&y===void 0?O=new s(A):y===void 0?O=new s(A,g):O=new s(A,g,y),Object.setPrototypeOf(O,l.prototype),O}function v(A){if(l.isBuffer(A)){const g=I(A.length)|0,y=u(g);return y.length===0||A.copy(y,0,0,g),y}if(A.length!==void 0)return typeof A.length!="number"||vt(A.length)?u(0):x(A);if(A.type==="Buffer"&&Array.isArray(A.data))return x(A.data)}function I(A){if(A>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return A|0}function U(A){return+A!=A&&(A=0),l.alloc(+A)}l.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==l.prototype},l.compare=function(g,y){if(dt(g,s)&&(g=l.from(g,g.offset,g.byteLength)),dt(y,s)&&(y=l.from(y,y.offset,y.byteLength)),!l.isBuffer(g)||!l.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===y)return 0;let O=g.length,$=y.length;for(let tt=0,rt=Math.min(O,$);tt<rt;++tt)if(g[tt]!==y[tt]){O=g[tt],$=y[tt];break}return O<$?-1:$<O?1:0},l.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(g,y){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return l.alloc(0);let O;if(y===void 0)for(y=0,O=0;O<g.length;++O)y+=g[O].length;const $=l.allocUnsafe(y);let tt=0;for(O=0;O<g.length;++O){let rt=g[O];if(dt(rt,s))tt+rt.length>$.length?(l.isBuffer(rt)||(rt=l.from(rt)),rt.copy($,tt)):s.prototype.set.call($,rt,tt);else if(l.isBuffer(rt))rt.copy($,tt);else throw new TypeError('"list" argument must be an Array of Buffers');tt+=rt.length}return $};function S(A,g){if(l.isBuffer(A))return A.length;if(o.isView(A)||dt(A,o))return A.byteLength;if(typeof A!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof A);const y=A.length,O=arguments.length>2&&arguments[2]===!0;if(!O&&y===0)return 0;let $=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return at(A).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return pt(A).length;default:if($)return O?-1:at(A).length;g=(""+g).toLowerCase(),$=!0}}l.byteLength=S;function N(A,g,y){let O=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,g>>>=0,y<=g))return"";for(A||(A="utf8");;)switch(A){case"hex":return z(this,g,y);case"utf8":case"utf-8":return D(this,g,y);case"ascii":return ft(this,g,y);case"latin1":case"binary":return K(this,g,y);case"base64":return X(this,g,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,g,y);default:if(O)throw new TypeError("Unknown encoding: "+A);A=(A+"").toLowerCase(),O=!0}}l.prototype._isBuffer=!0;function P(A,g,y){const O=A[g];A[g]=A[y],A[y]=O}l.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<g;y+=2)P(this,y,y+1);return this},l.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<g;y+=4)P(this,y,y+3),P(this,y+1,y+2);return this},l.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<g;y+=8)P(this,y,y+7),P(this,y+1,y+6),P(this,y+2,y+5),P(this,y+3,y+4);return this},l.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?D(this,0,g):N.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(g){if(!l.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:l.compare(this,g)===0},l.prototype.inspect=function(){let g="";const y=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(g+=" ... "),"<Buffer "+g+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(g,y,O,$,tt){if(dt(g,s)&&(g=l.from(g,g.offset,g.byteLength)),!l.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(y===void 0&&(y=0),O===void 0&&(O=g?g.length:0),$===void 0&&($=0),tt===void 0&&(tt=this.length),y<0||O>g.length||$<0||tt>this.length)throw new RangeError("out of range index");if($>=tt&&y>=O)return 0;if($>=tt)return-1;if(y>=O)return 1;if(y>>>=0,O>>>=0,$>>>=0,tt>>>=0,this===g)return 0;let rt=tt-$,Dt=O-y;const we=Math.min(rt,Dt),ye=this.slice($,tt),xe=g.slice(y,O);for(let ae=0;ae<we;++ae)if(ye[ae]!==xe[ae]){rt=ye[ae],Dt=xe[ae];break}return rt<Dt?-1:Dt<rt?1:0};function L(A,g,y,O,$){if(A.length===0)return-1;if(typeof y=="string"?(O=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,vt(y)&&(y=$?0:A.length-1),y<0&&(y=A.length+y),y>=A.length){if($)return-1;y=A.length-1}else if(y<0)if($)y=0;else return-1;if(typeof g=="string"&&(g=l.from(g,O)),l.isBuffer(g))return g.length===0?-1:V(A,g,y,O,$);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?$?s.prototype.indexOf.call(A,g,y):s.prototype.lastIndexOf.call(A,g,y):V(A,[g],y,O,$);throw new TypeError("val must be string, number or Buffer")}function V(A,g,y,O,$){let tt=1,rt=A.length,Dt=g.length;if(O!==void 0&&(O=String(O).toLowerCase(),O==="ucs2"||O==="ucs-2"||O==="utf16le"||O==="utf-16le")){if(A.length<2||g.length<2)return-1;tt=2,rt/=2,Dt/=2,y/=2}function we(xe,ae){return tt===1?xe[ae]:xe.readUInt16BE(ae*tt)}let ye;if($){let xe=-1;for(ye=y;ye<rt;ye++)if(we(A,ye)===we(g,xe===-1?0:ye-xe)){if(xe===-1&&(xe=ye),ye-xe+1===Dt)return xe*tt}else xe!==-1&&(ye-=ye-xe),xe=-1}else for(y+Dt>rt&&(y=rt-Dt),ye=y;ye>=0;ye--){let xe=!0;for(let ae=0;ae<Dt;ae++)if(we(A,ye+ae)!==we(g,ae)){xe=!1;break}if(xe)return ye}return-1}l.prototype.includes=function(g,y,O){return this.indexOf(g,y,O)!==-1},l.prototype.indexOf=function(g,y,O){return L(this,g,y,O,!0)},l.prototype.lastIndexOf=function(g,y,O){return L(this,g,y,O,!1)};function Z(A,g,y,O){y=Number(y)||0;const $=A.length-y;O?(O=Number(O),O>$&&(O=$)):O=$;const tt=g.length;O>tt/2&&(O=tt/2);let rt;for(rt=0;rt<O;++rt){const Dt=parseInt(g.substr(rt*2,2),16);if(vt(Dt))return rt;A[y+rt]=Dt}return rt}function C(A,g,y,O){return _t(at(g,A.length-y),A,y,O)}function R(A,g,y,O){return _t(ht(g),A,y,O)}function b(A,g,y,O){return _t(pt(g),A,y,O)}function B(A,g,y,O){return _t(Q(g,A.length-y),A,y,O)}l.prototype.write=function(g,y,O,$){if(y===void 0)$="utf8",O=this.length,y=0;else if(O===void 0&&typeof y=="string")$=y,O=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(O)?(O=O>>>0,$===void 0&&($="utf8")):($=O,O=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const tt=this.length-y;if((O===void 0||O>tt)&&(O=tt),g.length>0&&(O<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");$||($="utf8");let rt=!1;for(;;)switch($){case"hex":return Z(this,g,y,O);case"utf8":case"utf-8":return C(this,g,y,O);case"ascii":case"latin1":case"binary":return R(this,g,y,O);case"base64":return b(this,g,y,O);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,g,y,O);default:if(rt)throw new TypeError("Unknown encoding: "+$);$=(""+$).toLowerCase(),rt=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(A,g,y){return g===0&&y===A.length?t.fromByteArray(A):t.fromByteArray(A.slice(g,y))}function D(A,g,y){y=Math.min(A.length,y);const O=[];let $=g;for(;$<y;){const tt=A[$];let rt=null,Dt=tt>239?4:tt>223?3:tt>191?2:1;if($+Dt<=y){let we,ye,xe,ae;switch(Dt){case 1:tt<128&&(rt=tt);break;case 2:we=A[$+1],(we&192)===128&&(ae=(tt&31)<<6|we&63,ae>127&&(rt=ae));break;case 3:we=A[$+1],ye=A[$+2],(we&192)===128&&(ye&192)===128&&(ae=(tt&15)<<12|(we&63)<<6|ye&63,ae>2047&&(ae<55296||ae>57343)&&(rt=ae));break;case 4:we=A[$+1],ye=A[$+2],xe=A[$+3],(we&192)===128&&(ye&192)===128&&(xe&192)===128&&(ae=(tt&15)<<18|(we&63)<<12|(ye&63)<<6|xe&63,ae>65535&&ae<1114112&&(rt=ae))}}rt===null?(rt=65533,Dt=1):rt>65535&&(rt-=65536,O.push(rt>>>10&1023|55296),rt=56320|rt&1023),O.push(rt),$+=Dt}return et(O)}const lt=4096;function et(A){const g=A.length;if(g<=lt)return String.fromCharCode.apply(String,A);let y="",O=0;for(;O<g;)y+=String.fromCharCode.apply(String,A.slice(O,O+=lt));return y}function ft(A,g,y){let O="";y=Math.min(A.length,y);for(let $=g;$<y;++$)O+=String.fromCharCode(A[$]&127);return O}function K(A,g,y){let O="";y=Math.min(A.length,y);for(let $=g;$<y;++$)O+=String.fromCharCode(A[$]);return O}function z(A,g,y){const O=A.length;(!g||g<0)&&(g=0),(!y||y<0||y>O)&&(y=O);let $="";for(let tt=g;tt<y;++tt)$+=ce[A[tt]];return $}function bt(A,g,y){const O=A.slice(g,y);let $="";for(let tt=0;tt<O.length-1;tt+=2)$+=String.fromCharCode(O[tt]+O[tt+1]*256);return $}l.prototype.slice=function(g,y){const O=this.length;g=~~g,y=y===void 0?O:~~y,g<0?(g+=O,g<0&&(g=0)):g>O&&(g=O),y<0?(y+=O,y<0&&(y=0)):y>O&&(y=O),y<g&&(y=g);const $=this.subarray(g,y);return Object.setPrototypeOf($,l.prototype),$};function ot(A,g,y){if(A%1!==0||A<0)throw new RangeError("offset is not uint");if(A+g>y)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(g,y,O){g=g>>>0,y=y>>>0,O||ot(g,y,this.length);let $=this[g],tt=1,rt=0;for(;++rt<y&&(tt*=256);)$+=this[g+rt]*tt;return $},l.prototype.readUintBE=l.prototype.readUIntBE=function(g,y,O){g=g>>>0,y=y>>>0,O||ot(g,y,this.length);let $=this[g+--y],tt=1;for(;y>0&&(tt*=256);)$+=this[g+--y]*tt;return $},l.prototype.readUint8=l.prototype.readUInt8=function(g,y){return g=g>>>0,y||ot(g,1,this.length),this[g]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(g,y){return g=g>>>0,y||ot(g,2,this.length),this[g]|this[g+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(g,y){return g=g>>>0,y||ot(g,2,this.length),this[g]<<8|this[g+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},l.prototype.readBigUInt64LE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],O=this[g+7];(y===void 0||O===void 0)&&F(g,this.length-8);const $=y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,tt=this[++g]+this[++g]*2**8+this[++g]*2**16+O*2**24;return BigInt($)+(BigInt(tt)<<BigInt(32))}),l.prototype.readBigUInt64BE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],O=this[g+7];(y===void 0||O===void 0)&&F(g,this.length-8);const $=y*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],tt=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+O;return(BigInt($)<<BigInt(32))+BigInt(tt)}),l.prototype.readIntLE=function(g,y,O){g=g>>>0,y=y>>>0,O||ot(g,y,this.length);let $=this[g],tt=1,rt=0;for(;++rt<y&&(tt*=256);)$+=this[g+rt]*tt;return tt*=128,$>=tt&&($-=Math.pow(2,8*y)),$},l.prototype.readIntBE=function(g,y,O){g=g>>>0,y=y>>>0,O||ot(g,y,this.length);let $=y,tt=1,rt=this[g+--$];for(;$>0&&(tt*=256);)rt+=this[g+--$]*tt;return tt*=128,rt>=tt&&(rt-=Math.pow(2,8*y)),rt},l.prototype.readInt8=function(g,y){return g=g>>>0,y||ot(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},l.prototype.readInt16LE=function(g,y){g=g>>>0,y||ot(g,2,this.length);const O=this[g]|this[g+1]<<8;return O&32768?O|4294901760:O},l.prototype.readInt16BE=function(g,y){g=g>>>0,y||ot(g,2,this.length);const O=this[g+1]|this[g]<<8;return O&32768?O|4294901760:O},l.prototype.readInt32LE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},l.prototype.readInt32BE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},l.prototype.readBigInt64LE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],O=this[g+7];(y===void 0||O===void 0)&&F(g,this.length-8);const $=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(O<<24);return(BigInt($)<<BigInt(32))+BigInt(y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),l.prototype.readBigInt64BE=Ut(function(g){g=g>>>0,nt(g,"offset");const y=this[g],O=this[g+7];(y===void 0||O===void 0)&&F(g,this.length-8);const $=(y<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt($)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+O)}),l.prototype.readFloatLE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),n.read(this,g,!0,23,4)},l.prototype.readFloatBE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),n.read(this,g,!1,23,4)},l.prototype.readDoubleLE=function(g,y){return g=g>>>0,y||ot(g,8,this.length),n.read(this,g,!0,52,8)},l.prototype.readDoubleBE=function(g,y){return g=g>>>0,y||ot(g,8,this.length),n.read(this,g,!1,52,8)};function ct(A,g,y,O,$,tt){if(!l.isBuffer(A))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>$||g<tt)throw new RangeError('"value" argument is out of bounds');if(y+O>A.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(g,y,O,$){if(g=+g,y=y>>>0,O=O>>>0,!$){const Dt=Math.pow(2,8*O)-1;ct(this,g,y,O,Dt,0)}let tt=1,rt=0;for(this[y]=g&255;++rt<O&&(tt*=256);)this[y+rt]=g/tt&255;return y+O},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(g,y,O,$){if(g=+g,y=y>>>0,O=O>>>0,!$){const Dt=Math.pow(2,8*O)-1;ct(this,g,y,O,Dt,0)}let tt=O-1,rt=1;for(this[y+tt]=g&255;--tt>=0&&(rt*=256);)this[y+tt]=g/rt&255;return y+O},l.prototype.writeUint8=l.prototype.writeUInt8=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,1,255,0),this[y]=g&255,y+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,2,65535,0),this[y]=g&255,this[y+1]=g>>>8,y+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,2,65535,0),this[y]=g>>>8,this[y+1]=g&255,y+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,4,4294967295,0),this[y+3]=g>>>24,this[y+2]=g>>>16,this[y+1]=g>>>8,this[y]=g&255,y+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,4,4294967295,0),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4};function Lt(A,g,y,O,$){st(g,O,$,A,y,7);let tt=Number(g&BigInt(4294967295));A[y++]=tt,tt=tt>>8,A[y++]=tt,tt=tt>>8,A[y++]=tt,tt=tt>>8,A[y++]=tt;let rt=Number(g>>BigInt(32)&BigInt(4294967295));return A[y++]=rt,rt=rt>>8,A[y++]=rt,rt=rt>>8,A[y++]=rt,rt=rt>>8,A[y++]=rt,y}function ne(A,g,y,O,$){st(g,O,$,A,y,7);let tt=Number(g&BigInt(4294967295));A[y+7]=tt,tt=tt>>8,A[y+6]=tt,tt=tt>>8,A[y+5]=tt,tt=tt>>8,A[y+4]=tt;let rt=Number(g>>BigInt(32)&BigInt(4294967295));return A[y+3]=rt,rt=rt>>8,A[y+2]=rt,rt=rt>>8,A[y+1]=rt,rt=rt>>8,A[y]=rt,y+8}l.prototype.writeBigUInt64LE=Ut(function(g,y=0){return Lt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Ut(function(g,y=0){return ne(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(g,y,O,$){if(g=+g,y=y>>>0,!$){const we=Math.pow(2,8*O-1);ct(this,g,y,O,we-1,-we)}let tt=0,rt=1,Dt=0;for(this[y]=g&255;++tt<O&&(rt*=256);)g<0&&Dt===0&&this[y+tt-1]!==0&&(Dt=1),this[y+tt]=(g/rt>>0)-Dt&255;return y+O},l.prototype.writeIntBE=function(g,y,O,$){if(g=+g,y=y>>>0,!$){const we=Math.pow(2,8*O-1);ct(this,g,y,O,we-1,-we)}let tt=O-1,rt=1,Dt=0;for(this[y+tt]=g&255;--tt>=0&&(rt*=256);)g<0&&Dt===0&&this[y+tt+1]!==0&&(Dt=1),this[y+tt]=(g/rt>>0)-Dt&255;return y+O},l.prototype.writeInt8=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,1,127,-128),g<0&&(g=255+g+1),this[y]=g&255,y+1},l.prototype.writeInt16LE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,2,32767,-32768),this[y]=g&255,this[y+1]=g>>>8,y+2},l.prototype.writeInt16BE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,2,32767,-32768),this[y]=g>>>8,this[y+1]=g&255,y+2},l.prototype.writeInt32LE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,4,2147483647,-2147483648),this[y]=g&255,this[y+1]=g>>>8,this[y+2]=g>>>16,this[y+3]=g>>>24,y+4},l.prototype.writeInt32BE=function(g,y,O){return g=+g,y=y>>>0,O||ct(this,g,y,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4},l.prototype.writeBigInt64LE=Ut(function(g,y=0){return Lt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Ut(function(g,y=0){return ne(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function At(A,g,y,O,$,tt){if(y+O>A.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function kt(A,g,y,O,$){return g=+g,y=y>>>0,$||At(A,g,y,4),n.write(A,g,y,O,23,4),y+4}l.prototype.writeFloatLE=function(g,y,O){return kt(this,g,y,!0,O)},l.prototype.writeFloatBE=function(g,y,O){return kt(this,g,y,!1,O)};function zt(A,g,y,O,$){return g=+g,y=y>>>0,$||At(A,g,y,8),n.write(A,g,y,O,52,8),y+8}l.prototype.writeDoubleLE=function(g,y,O){return zt(this,g,y,!0,O)},l.prototype.writeDoubleBE=function(g,y,O){return zt(this,g,y,!1,O)},l.prototype.copy=function(g,y,O,$){if(!l.isBuffer(g))throw new TypeError("argument should be a Buffer");if(O||(O=0),!$&&$!==0&&($=this.length),y>=g.length&&(y=g.length),y||(y=0),$>0&&$<O&&($=O),$===O||g.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(O<0||O>=this.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("sourceEnd out of bounds");$>this.length&&($=this.length),g.length-y<$-O&&($=g.length-y+O);const tt=$-O;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,O,$):s.prototype.set.call(g,this.subarray(O,$),y),tt},l.prototype.fill=function(g,y,O,$){if(typeof g=="string"){if(typeof y=="string"?($=y,y=0,O=this.length):typeof O=="string"&&($=O,O=this.length),$!==void 0&&typeof $!="string")throw new TypeError("encoding must be a string");if(typeof $=="string"&&!l.isEncoding($))throw new TypeError("Unknown encoding: "+$);if(g.length===1){const rt=g.charCodeAt(0);($==="utf8"&&rt<128||$==="latin1")&&(g=rt)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(y<0||this.length<y||this.length<O)throw new RangeError("Out of range index");if(O<=y)return this;y=y>>>0,O=O===void 0?this.length:O>>>0,g||(g=0);let tt;if(typeof g=="number")for(tt=y;tt<O;++tt)this[tt]=g;else{const rt=l.isBuffer(g)?g:l.from(g,$),Dt=rt.length;if(Dt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(tt=0;tt<O-y;++tt)this[tt+y]=rt[tt%Dt]}return this};const Ht={};function Ee(A,g,y){Ht[A]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${A}]`,this.stack,delete this.name}get code(){return A}set code($){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:$,writable:!0})}toString(){return`${this.name} [${A}]: ${this.message}`}}}Ee("ERR_BUFFER_OUT_OF_BOUNDS",function(A){return A?`${A} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ee("ERR_INVALID_ARG_TYPE",function(A,g){return`The "${A}" argument must be of type number. Received type ${typeof g}`},TypeError),Ee("ERR_OUT_OF_RANGE",function(A,g,y){let O=`The value of "${A}" is out of range.`,$=y;return Number.isInteger(y)&&Math.abs(y)>2**32?$=Ie(String(y)):typeof y=="bigint"&&($=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&($=Ie($)),$+="n"),O+=` It must be ${g}. Received ${$}`,O},RangeError);function Ie(A){let g="",y=A.length;const O=A[0]==="-"?1:0;for(;y>=O+4;y-=3)g=`_${A.slice(y-3,y)}${g}`;return`${A.slice(0,y)}${g}`}function E(A,g,y){nt(g,"offset"),(A[g]===void 0||A[g+y]===void 0)&&F(g,A.length-(y+1))}function st(A,g,y,O,$,tt){if(A>y||A<g){const rt=typeof g=="bigint"?"n":"";let Dt;throw g===0||g===BigInt(0)?Dt=`>= 0${rt} and < 2${rt} ** ${(tt+1)*8}${rt}`:Dt=`>= -(2${rt} ** ${(tt+1)*8-1}${rt}) and < 2 ** ${(tt+1)*8-1}${rt}`,new Ht.ERR_OUT_OF_RANGE("value",Dt,A)}E(O,$,tt)}function nt(A,g){if(typeof A!="number")throw new Ht.ERR_INVALID_ARG_TYPE(g,"number",A)}function F(A,g,y){throw Math.floor(A)!==A?(nt(A,y),new Ht.ERR_OUT_OF_RANGE("offset","an integer",A)):g<0?new Ht.ERR_BUFFER_OUT_OF_BOUNDS:new Ht.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,A)}const M=/[^+/0-9A-Za-z-_]/g;function G(A){if(A=A.split("=")[0],A=A.trim().replace(M,""),A.length<2)return"";for(;A.length%4!==0;)A=A+"=";return A}function at(A,g){g=g||1/0;let y;const O=A.length;let $=null;const tt=[];for(let rt=0;rt<O;++rt){if(y=A.charCodeAt(rt),y>55295&&y<57344){if(!$){if(y>56319){(g-=3)>-1&&tt.push(239,191,189);continue}else if(rt+1===O){(g-=3)>-1&&tt.push(239,191,189);continue}$=y;continue}if(y<56320){(g-=3)>-1&&tt.push(239,191,189),$=y;continue}y=($-55296<<10|y-56320)+65536}else $&&(g-=3)>-1&&tt.push(239,191,189);if($=null,y<128){if((g-=1)<0)break;tt.push(y)}else if(y<2048){if((g-=2)<0)break;tt.push(y>>6|192,y&63|128)}else if(y<65536){if((g-=3)<0)break;tt.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((g-=4)<0)break;tt.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return tt}function ht(A){const g=[];for(let y=0;y<A.length;++y)g.push(A.charCodeAt(y)&255);return g}function Q(A,g){let y,O,$;const tt=[];for(let rt=0;rt<A.length&&!((g-=2)<0);++rt)y=A.charCodeAt(rt),O=y>>8,$=y%256,tt.push($),tt.push(O);return tt}function pt(A){return t.toByteArray(G(A))}function _t(A,g,y,O){let $;for($=0;$<O&&!($+y>=g.length||$>=A.length);++$)g[$+y]=A[$];return $}function dt(A,g){return A instanceof g||A!=null&&A.constructor!=null&&A.constructor.name!=null&&A.constructor.name===g.name}function vt(A){return A!==A}const ce=function(){const A="0123456789abcdef",g=new Array(256);for(let y=0;y<16;++y){const O=y*16;for(let $=0;$<16;++$)g[O+$]=A[y]+A[$]}return g}();function Ut(A){return typeof BigInt>"u"?Mn:A}function Mn(){throw new Error("BigInt not supported")}})(ap);const tn=ap.Buffer;function Sw(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var lp={exports:{}},Oe=lp.exports={},Sr,Rr;function ku(){throw new Error("setTimeout has not been defined")}function Tu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Sr=setTimeout:Sr=ku}catch{Sr=ku}try{typeof clearTimeout=="function"?Rr=clearTimeout:Rr=Tu}catch{Rr=Tu}})();function up(e){if(Sr===setTimeout)return setTimeout(e,0);if((Sr===ku||!Sr)&&setTimeout)return Sr=setTimeout,setTimeout(e,0);try{return Sr(e,0)}catch{try{return Sr.call(null,e,0)}catch{return Sr.call(this,e,0)}}}function Rw(e){if(Rr===clearTimeout)return clearTimeout(e);if((Rr===Tu||!Rr)&&clearTimeout)return Rr=clearTimeout,clearTimeout(e);try{return Rr(e)}catch{try{return Rr.call(null,e)}catch{return Rr.call(this,e)}}}var ni=[],Ms=!1,ts,Wa=-1;function Iw(){!Ms||!ts||(Ms=!1,ts.length?ni=ts.concat(ni):Wa=-1,ni.length&&hp())}function hp(){if(!Ms){var e=up(Iw);Ms=!0;for(var t=ni.length;t;){for(ts=ni,ni=[];++Wa<t;)ts&&ts[Wa].run();Wa=-1,t=ni.length}ts=null,Ms=!1,Rw(e)}}Oe.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ni.push(new fp(e,t)),ni.length===1&&!Ms&&up(hp)};function fp(e,t){this.fun=e,this.array=t}fp.prototype.run=function(){this.fun.apply(null,this.array)},Oe.title="browser",Oe.browser=!0,Oe.env={},Oe.argv=[],Oe.version="",Oe.versions={};function ri(){}Oe.on=ri,Oe.addListener=ri,Oe.once=ri,Oe.off=ri,Oe.removeListener=ri,Oe.removeAllListeners=ri,Oe.emit=ri,Oe.prependListener=ri,Oe.prependOnceListener=ri,Oe.listeners=function(e){return[]},Oe.binding=function(e){throw new Error("process.binding is not supported")},Oe.cwd=function(){return"/"},Oe.chdir=function(e){throw new Error("process.chdir is not supported")},Oe.umask=function(){return 0};var Nw=lp.exports;const Oi=Sw(Nw),dp=e=>e===void 0?null:e;class Ow{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let pp=new Ow,Cw=!0;try{typeof localStorage<"u"&&localStorage&&(pp=localStorage,Cw=!1)}catch{}const Lw=pp,Mw=Object.assign,Uw=Object.keys,Fw=(e,t)=>{for(const n in e)t(e[n],n)},mp=e=>Uw(e).length,Bw=e=>{for(const t in e)return!1;return!0},Pw=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Dw=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),$w=(e,t)=>e===t||mp(e)===mp(t)&&Pw(e,(n,r)=>(n!==void 0||Dw(t,r))&&t[r]===n),jw=Object.freeze,gp=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&gp(e[t])}return jw(e)},Au=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Au(e,t,n+1)}},zw=e=>e,Ww=(e,t)=>t.includes(e);var yp={};const Oo=typeof Oi<"u"&&Oi.release&&/node|io\.js/.test(Oi.release.name)&&Object.prototype.toString.call(typeof Oi<"u"?Oi:0)==="[object process]";let Ir;const Kw=()=>{if(Ir===void 0)if(Oo){Ir=hr();const e=Oi.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Ir.set(t,""),t=r):t!==null&&(Ir.set(t,r),t=null)}t!==null&&Ir.set(t,"")}else typeof location=="object"?(Ir=hr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Ir.set(`--${$d(t,"-")}`,n),Ir.set(`-${$d(t,"-")}`,n)}})):Ir=hr();return Ir},vu=e=>Kw().has(e),Ka=e=>dp(Oo?yp[e.toUpperCase().replaceAll("-","_")]:Lw.getItem(e)),_p=e=>vu("--"+e)||Ka(e)!==null;_p("production");const Gw=Oo&&Ww(yp.FORCE_COLOR,["true","1","2"])||!vu("--no-colors")&&!_p("no-color")&&(!Oo||Oi.stdout.isTTY)&&(!Oo||vu("--color")||Ka("COLORTERM")!==null||(Ka("TERM")||"").includes("color")),Hw=e=>new Uint8Array(e),Yw=e=>{const t=Hw(e.byteLength);return t.set(e),t};class Vw{constructor(t,n){this.left=t,this.right=n}}const ii=(e,t)=>new Vw(e,t);typeof DOMParser<"u"&&new DOMParser;const Xw=e=>dw(e,(t,n)=>`${n}:${t};`).join(""),si=Symbol,bp=si(),Ep=si(),qw=si(),Jw=si(),Zw=si(),wp=si(),Qw=si(),Su=si(),tx=si(),ex=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},nx={[bp]:ii("font-weight","bold"),[Ep]:ii("font-weight","normal"),[qw]:ii("color","blue"),[Zw]:ii("color","green"),[Jw]:ii("color","grey"),[wp]:ii("color","red"),[Qw]:ii("color","purple"),[Su]:ii("color","orange"),[tx]:ii("color","black")},xp=Gw?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=hr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=nx[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=Xw(r);s>0||u.length>0?(t.push("%c"+a),n.push(u)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:ex,rx=(...e)=>{console.log(...xp(e)),kp.forEach(t=>t.print(e))},ix=(...e)=>{console.warn(...xp(e)),e.unshift(Su),kp.forEach(t=>t.print(e))},kp=Ss(),Tp=e=>({[Symbol.iterator](){return this},next:e}),sx=(e,t)=>Tp(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Ru=(e,t)=>Tp(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Iu{constructor(t,n){this.clock=t,this.len=n}}class Co{constructor(){this.clients=new Map}}const Ap=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Wp(e,s,a.clock,a.len,n)}}),ox=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=vi((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},vp=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&ox(n,t.clock)!==null},Nu=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=Zi(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},ax=e=>{const t=new Co;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)NE(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Nu(t),t},Ga=(e,t,n,r)=>{Ni(e.clients,t,()=>[]).push(new Iu(n,r))},cx=()=>new Co,lx=e=>{const t=cx();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let u=n[s+1];s+1<n.length&&u.deleted;u=n[++s+1])c+=u.length;i.push(new Iu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Us=(e,t)=>{$t(e.restEncoder,t.clients.size),Si(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),$t(e.restEncoder,n);const i=r.length;$t(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Ou=e=>{const t=new Co,n=jt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=jt(e.restDecoder),s=jt(e.restDecoder);if(s>0){const o=Ni(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Iu(e.readDsClock(),e.readDsLen()))}}return t},Sp=(e,t,n)=>{const r=new Co,i=jt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=jt(e.restDecoder),a=jt(e.restDecoder),c=n.clients.get(o)||[],u=Je(n,o);for(let l=0;l<a;l++){const h=e.readDsClock(),f=h+e.readDsLen();if(h<u){u<f&&Ga(r,o,u,f-u);let d=Nr(c,h),p=c[d];for(!p.deleted&&p.id.clock<h&&(c.splice(d+1,0,oc(t,p,h-p.id.clock)),d++);d<c.length&&(p=c[d++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(d,0,oc(t,p,f-p.id.clock)),p.delete(t))}else Ga(r,o,h,f-h)}}if(r.clients.size>0){const s=new es;return $t(s.restEncoder,0),Us(s,r),s.toUint8Array()}return null},Rp=sp;class Fs extends mw{constructor({guid:t=_w(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Rp(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new $p,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=op(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>op(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&he(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Si(this.subdocs).map(t=>t.guid))}transact(t,n=null){return he(this,t,n)}get(t,n=en){const r=Ni(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==en&&i!==n)if(i===en){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,$s)}getText(t=""){return this.get(t,oi)}getMap(t=""){return this.get(t,js)}getXmlElement(t=""){return this.get(t,Ws)}getXmlFragment(t=""){return this.get(t,ns)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Si(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Fs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,he(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Ip{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return jt(this.restDecoder)}readDsLen(){return jt(this.restDecoder)}}class Np extends Ip{readLeftID(){return qt(jt(this.restDecoder),jt(this.restDecoder))}readRightID(){return qt(jt(this.restDecoder),jt(this.restDecoder))}readClient(){return jt(this.restDecoder)}readInfo(){return Is(this.restDecoder)}readString(){return Ns(this.restDecoder)}readParentInfo(){return jt(this.restDecoder)===1}readTypeRef(){return jt(this.restDecoder)}readLen(){return jt(this.restDecoder)}readAny(){return Io(this.restDecoder)}readBuf(){return Yw(dn(this.restDecoder))}readJSON(){return JSON.parse(Ns(this.restDecoder))}readKey(){return Ns(this.restDecoder)}}class ux{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=jt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=jt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Bs extends ux{constructor(t){super(t),this.keys=[],jt(t),this.keyClockDecoder=new pu(dn(t)),this.clientDecoder=new Pa(dn(t)),this.leftClockDecoder=new pu(dn(t)),this.rightClockDecoder=new pu(dn(t)),this.infoDecoder=new Yd(dn(t),Is),this.stringDecoder=new JE(dn(t)),this.parentInfoDecoder=new Yd(dn(t),Is),this.typeRefDecoder=new Pa(dn(t)),this.lenDecoder=new Pa(dn(t))}readLeftID(){return new Ps(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ps(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Io(this.restDecoder)}readBuf(){return dn(this.restDecoder)}readJSON(){return Io(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Op{constructor(){this.restEncoder=Ii()}toUint8Array(){return ur(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){$t(this.restEncoder,t)}writeDsLen(t){$t(this.restEncoder,t)}}class Lo extends Op{writeLeftID(t){$t(this.restEncoder,t.client),$t(this.restEncoder,t.clock)}writeRightID(t){$t(this.restEncoder,t.client),$t(this.restEncoder,t.clock)}writeClient(t){$t(this.restEncoder,t)}writeInfo(t){au(this.restEncoder,t)}writeString(t){Rs(this.restEncoder,t)}writeParentInfo(t){$t(this.restEncoder,t?1:0)}writeTypeRef(t){$t(this.restEncoder,t)}writeLen(t){$t(this.restEncoder,t)}writeAny(t){Ro(this.restEncoder,t)}writeBuf(t){an(this.restEncoder,t)}writeJSON(t){Rs(this.restEncoder,JSON.stringify(t))}writeKey(t){Rs(this.restEncoder,t)}}class Cp{constructor(){this.restEncoder=Ii(),this.dsCurrVal=0}toUint8Array(){return ur(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,$t(this.restEncoder,n)}writeDsLen(t){t===0&&Ar(),$t(this.restEncoder,t-1),this.dsCurrVal+=t}}class es extends Cp{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new hu,this.clientEncoder=new Fa,this.leftClockEncoder=new hu,this.rightClockEncoder=new hu,this.infoEncoder=new zd(au),this.stringEncoder=new YE,this.parentInfoEncoder=new zd(au),this.typeRefEncoder=new Fa,this.lenEncoder=new Fa}toUint8Array(){const t=Ii();return $t(t,0),an(t,this.keyClockEncoder.toUint8Array()),an(t,this.clientEncoder.toUint8Array()),an(t,this.leftClockEncoder.toUint8Array()),an(t,this.rightClockEncoder.toUint8Array()),an(t,ur(this.infoEncoder)),an(t,this.stringEncoder.toUint8Array()),an(t,ur(this.parentInfoEncoder)),an(t,this.typeRefEncoder.toUint8Array()),an(t,this.lenEncoder.toUint8Array()),Ua(t,ur(this.restEncoder)),ur(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Ro(this.restEncoder,t)}writeBuf(t){an(this.restEncoder,t)}writeJSON(t){Ro(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const hx=(e,t,n,r)=>{r=Zi(r,t[0].id.clock);const i=Nr(t,r);$t(e.restEncoder,t.length-i),e.writeClient(n),$t(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},Cu=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{Je(t,s)>i&&r.set(s,i)}),Ya(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),$t(e.restEncoder,r.size),Si(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{hx(e,t.clients.get(i),i,s)})},fx=(e,t)=>{const n=hr(),r=jt(e.restDecoder);for(let i=0;i<r;i++){const s=jt(e.restDecoder),o=new Array(s),a=e.readClient();let c=jt(e.restDecoder);n.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=e.readInfo();switch(La&l){case 0:{const h=e.readLen();o[u]=new Yn(qt(a,c),h),c+=h;break}case 10:{const h=jt(e.restDecoder);o[u]=new Vn(qt(a,c),h),c+=h;break}default:{const h=(l&(ei|Fn))===0,f=new ze(qt(a,c),null,(l&Fn)===Fn?e.readLeftID():null,null,(l&ei)===ei?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(l&To)===To?e.readString():null,p0(e,l));o[u]=f,c+=f.length}}}}return n},dx=(e,t,n)=>{const r=[];let i=Si(n.keys()).sort((d,p)=>d-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let d=n.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=n.get(i[i.length-1]);else return null;return d};let o=s();if(o===null)return null;const a=new $p,c=new Map,u=(d,p)=>{const m=c.get(d);(m==null||m>p)&&c.set(d,p)};let l=o.refs[o.i++];const h=new Map,f=()=>{for(const d of r){const p=d.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[d]),i=i.filter(x=>x!==p)}r.length=0};for(;;){if(l.constructor!==Vn){const p=Ni(h,l.id.client,()=>Je(t,l.id.client))-l.id.clock;if(p<0)r.push(l),u(l.id.client,l.id.clock-1),f();else{const m=l.getMissing(e,t);if(m!==null){r.push(l);const x=n.get(m)||{refs:[],i:0};if(x.refs.length===x.i)u(m,Je(t,m)),f();else{l=x.refs[x.i++];continue}}else(p===0||p<l.length)&&(l.integrate(e,p),h.set(l.id.client,l.id.clock+l.length))}}if(r.length>0)l=r.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const d=new es;return Cu(d,a,new Map),$t(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},px=(e,t)=>Cu(e,t.doc.store,t.beforeState),mx=(e,t,n,r=new Bs(e))=>he(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=fx(r,o),u=dx(i,a,c),l=a.pendingStructs;if(l){for(const[f,d]of l.missing)if(d<Je(a,f)){s=!0;break}if(u){for(const[f,d]of u.missing){const p=l.missing.get(f);(p==null||p>d)&&l.missing.set(f,d)}l.update=Xa([l.update,u.update])}}else a.pendingStructs=u;const h=Sp(r,i,a);if(a.pendingDs){const f=new Bs(Qi(a.pendingDs));jt(f.restDecoder);const d=Sp(f,i,a);h&&d?a.pendingDs=Xa([h,d]):a.pendingDs=h||d}else a.pendingDs=h;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,Lp(i.doc,f)}},n,!1),Lp=(e,t,n,r=Bs)=>{const i=Qi(t);mx(i,e,n,new r(i))},gx=(e,t,n)=>Lp(e,t,n,Np),yx=(e,t,n=new Map)=>{Cu(e,t.store,n),Us(e,lx(t.store))},_x=(e,t=new Uint8Array([0]),n=new es)=>{const r=Mp(t);yx(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Lx(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===Lo)return Ox(i.map((s,o)=>o===0?s:Ux(s)));if(n.constructor===es)return Xa(i)}return i[0]},bx=(e,t)=>_x(e,t,new Lo),Ex=e=>{const t=new Map,n=jt(e.restDecoder);for(let r=0;r<n;r++){const i=jt(e.restDecoder),s=jt(e.restDecoder);t.set(i,s)}return t},Mp=e=>Ex(new Ip(Qi(e))),Up=(e,t)=>($t(e.restEncoder,t.size),Si(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{$t(e.restEncoder,n),$t(e.restEncoder,r)}),e),wx=(e,t)=>Up(e,Ya(t.store)),xx=(e,t=new Cp)=>(e instanceof Map?Up(t,e):wx(t,e),t.toUint8Array()),kx=e=>xx(e,new Op);class Tx{constructor(){this.l=[]}}const Fp=()=>new Tx,Bp=(e,t)=>e.l.push(t),Pp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Dp=(e,t,n)=>Au(e.l,[t,n]);class Ps{constructor(t,n){this.client=t,this.clock=n}}const Ha=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,qt=(e,t)=>new Ps(e,t),Ax=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Ar()},Ds=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!vp(t.ds,e.id),Lu=(e,t)=>{const n=Ni(e.meta,Lu,Ss),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<Je(r,s)&&Ci(e,qt(s,i))}),Ap(e,t.ds,i=>{}),n.add(t))};class $p{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ya=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},Je=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},jp=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Ar()}n.push(t)},Nr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=vi(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=vi((n+r)/2)}throw Ar()},Mu=(e,t)=>{const n=e.clients.get(t.client);return n[Nr(n,t.clock)]},Uu=(e,t,n)=>{const r=Nr(t,n),i=t[r];return i.id.clock<n&&i instanceof ze?(t.splice(r+1,0,oc(e,i,n-i.id.clock)),r+1):r},Ci=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Uu(e,n,t.clock)]},zp=(e,t,n)=>{const r=t.clients.get(n.client),i=Nr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Yn&&r.splice(i+1,0,oc(e,s,n.clock-s.id.clock+1)),s},vx=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Nr(r,t.id.clock)]=n},Wp=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Uu(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Uu(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class Sx{constructor(t,n,r){this.doc=t,this.deleteSet=new Co,this.beforeState=Ya(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Kp=(e,t)=>t.deleteSet.clients.size===0&&!pw(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Nu(t.deleteSet),px(e,t),Us(e,t.deleteSet),!0),Gp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Ni(e.changed,t,Ss).add(n)},Va=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},Rx=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=Nr(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof ze&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},Ix=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Bd(i.length-1,1+Nr(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+Va(i,c)}})},Hp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Nu(s),n.afterState=Ya(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),Dp(u._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Au(a,[]),n._needFormattingCleanup&&Xx(n)}finally{r.gc&&Rx(s,i,r.gcFilter),Ix(s,i),n.afterState.forEach((l,h)=>{const f=n.beforeState.get(h)||0;if(f!==l){const d=i.clients.get(h),p=Zi(Nr(d,f),1);for(let m=d.length-1;m>=p;)m-=1+Va(d,m)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:f}=o[l].id,d=i.clients.get(h),p=Nr(d,f);p+1<d.length&&Va(d,p+1)>1||p>0&&Va(d,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(rx(Su,bp,"[yjs] ",Ep,wp,"Changed the client-id because another client seems to be using it."),r.clientID=Rp()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const l=new Lo;Kp(l,n)&&r.emit("update",[l.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const l=new es;Kp(l,n)&&r.emit("updateV2",[l.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=n;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=r.clientID,l.collectionid==null&&(l.collectionid=r.collectionid),r.subdocs.add(l)}),u.forEach(l=>r.subdocs.delete(l)),r.emit("subdocs",[{loaded:c,added:a,removed:u},r,n]),u.forEach(l=>l.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Hp(e,t+1)}}},he=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new Sx(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Hp(i,0)}}return o};function*Nx(e){const t=jt(e.restDecoder);for(let n=0;n<t;n++){const r=jt(e.restDecoder),i=e.readClient();let s=jt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=jt(e.restDecoder);yield new Vn(qt(i,s),c),s+=c}else if(La&a){const c=(a&(ei|Fn))===0,u=new ze(qt(i,s),null,(a&Fn)===Fn?e.readLeftID():null,null,(a&ei)===ei?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&To)===To?e.readString():null,p0(e,a));yield u,s+=u.length}else{const c=e.readLen();yield new Yn(qt(i,s),c),s+=c}}}}class Fu{constructor(t,n){this.gen=Nx(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Vn);return this.curr}}class Bu{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Ox=e=>Xa(e,Np,Lo),Cx=(e,t)=>{if(e.constructor===Yn){const{client:n,clock:r}=e.id;return new Yn(qt(n,r+t),e.length-t)}else if(e.constructor===Vn){const{client:n,clock:r}=e.id;return new Vn(qt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new ze(qt(r,i+t),null,qt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Xa=(e,t=Bs,n=es)=>{if(e.length===1)return e[0];const r=e.map(l=>new t(Qi(l)));let i=r.map(l=>new Fu(l,!0)),s=null;const o=new n,a=new Bu(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){const p=f.curr.id.clock-d.curr.id.clock;return p===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===Vn?1:-1:p}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let f=l.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=l.next(),d=!0;if(f===null||f.id.client!==h||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Li(a,s.struct,s.offset),s={struct:f,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===Vn)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{Li(a,s.struct,s.offset);const p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Vn(qt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===Vn?s.struct.length-=p:f=Cx(f,p)),s.struct.mergeWith(f)||(Li(a,s.struct,s.offset),s={struct:f,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let f=l.curr;f!==null&&f.id.client===h&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==Vn;f=l.next())Li(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(Li(a,s.struct,s.offset),s=null),Pu(a);const c=r.map(l=>Ou(l)),u=ax(c);return Us(o,u),o.toUint8Array()},Lx=(e,t,n=Bs,r=es)=>{const i=Mp(t),s=new r,o=new Bu(s),a=new n(Qi(e)),c=new Fu(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,f=i.get(h)||0;if(c.curr.constructor===Vn){c.next();continue}if(l.id.clock+l.length>f)for(Li(o,l,Zi(f-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Li(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=f;)c.next()}Pu(o);const u=Ou(a);return Us(s,u),s.toUint8Array()},Yp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:ur(e.encoder.restEncoder)}),e.encoder.restEncoder=Ii(),e.written=0)},Li=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Yp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),$t(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Pu=e=>{Yp(e);const t=e.encoder.restEncoder;$t(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];$t(t,r.written),Ua(t,r.restEncoder)}},Mx=(e,t,n,r)=>{const i=new n(Qi(e)),s=new Fu(i,!1),o=new r,a=new Bu(o);for(let u=s.curr;u!==null;u=s.next())Li(a,t(u),0);Pu(a);const c=Ou(i);return Us(o,c),o.toUint8Array()},Ux=e=>Mx(e,zw,Bs,Lo),Vp="You must not compute changes after the event-handler fired.";class qa{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Fx(this.currentTarget,this.target))}deletes(t){return vp(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ri(Vp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=ou(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=ou(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=ou(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ri(Vp);const n=this.target,r=Ss(),i=Ss(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const Fx=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},cn=()=>{ix("Invalid access: Add Yjs type to a document before reading data.")},Xp=80;let Du=0;class Bx{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Du++}}const Px=e=>{e.timestamp=Du++},qp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Du++},Dx=(e,t,n)=>{if(e.length>=Xp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return qp(r,t,n),r}else{const r=new Bx(t,n);return e.push(r),r}},Ja=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Ma(t-s.index)<Ma(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Px(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Ma(n.index-i)<r.parent.length/Xp?(qp(n,r,i),n):Dx(e._searchMarker,r,i)},Mo=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=Zi(t,i.index+n))}},Za=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Ni(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Dp(r._eH,n,t)};class en{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Fp(),this._dEH=Fp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Tr()}clone(){throw Tr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Bp(this._eH,t)}observeDeep(t){Bp(this._dEH,t)}unobserve(t){Pp(this._eH,t)}unobserveDeep(t){Pp(this._dEH,t)}toJSON(){}}const Jp=(e,t,n)=>{e.doc??cn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},Zp=e=>{e.doc??cn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Uo=(e,t)=>{let n=0,r=e._start;for(e.doc??cn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},Qp=(e,t)=>{const n=[];return Uo(e,(r,i)=>{n.push(t(r,i,e))}),n},$x=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},t0=(e,t)=>{e.doc??cn();const n=Ja(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Qa=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let u=[];const l=()=>{u.length>0&&(i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new is(u)),i.integrate(e,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Fo(new Uint8Array(h))),i.integrate(e,0);break;case Fs:i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Po(h)),i.integrate(e,0);break;default:if(h instanceof en)i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ai(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},e0=()=>Ri("Length exceeded!"),n0=(e,t,n,r)=>{if(n>t._length)throw e0();if(n===0)return t._searchMarker&&Mo(t._searchMarker,n,r.length),Qa(e,t,null,r);const i=n,s=Ja(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ci(e,qt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Mo(t._searchMarker,i,r.length),Qa(e,t,o,r)},jx=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Qa(e,t,i,n)},r0=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=Ja(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ci(e,qt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ci(e,qt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw e0();t._searchMarker&&Mo(t._searchMarker,i,-s+r)},tc=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},$u=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new is([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new is([r]);break;case Uint8Array:a=new Fo(r);break;case Fs:a=new Po(r);break;default:if(r instanceof en)a=new ai(r);else throw new Error("Unexpected content type")}new ze(qt(o,Je(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},ju=(e,t)=>{e.doc??cn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},i0=e=>{const t={};return e.doc??cn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},s0=(e,t)=>{e.doc??cn();const n=e._map.get(t);return n!==void 0&&!n.deleted},zx=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Ds(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},ec=e=>(e.doc??cn(),sx(e._map.entries(),t=>!t[1].deleted));class Wx extends qa{}class $s extends en{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new $s;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $s}clone(){const t=new $s;return t.insert(0,this.toArray().map(n=>n instanceof en?n.clone():n)),t}get length(){return this.doc??cn(),this._length}_callObserver(t,n){super._callObserver(t,n),Za(this,t,new Wx(this,t))}insert(t,n){this.doc!==null?he(this.doc,r=>{n0(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?he(this.doc,n=>{jx(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?he(this.doc,r=>{r0(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return t0(this,t)}toArray(){return Zp(this)}slice(t=0,n=this.length){return Jp(this,t,n)}toJSON(){return this.map(t=>t instanceof en?t.toJSON():t)}map(t){return Qp(this,t)}forEach(t){Uo(this,t)}[Symbol.iterator](){return $x(this)}_write(t){t.writeTypeRef(pk)}}const Kx=e=>new $s;class Gx extends qa{constructor(t,n,r){super(t,n),this.keysChanged=r}}class js extends en{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new js}clone(){const t=new js;return this.forEach((n,r)=>{t.set(r,n instanceof en?n.clone():n)}),t}_callObserver(t,n){Za(this,t,new Gx(this,t,n))}toJSON(){this.doc??cn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof en?i.toJSON():i}}),t}get size(){return[...ec(this)].length}keys(){return Ru(ec(this),t=>t[0])}values(){return Ru(ec(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Ru(ec(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??cn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?he(this.doc,n=>{tc(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?he(this.doc,r=>{$u(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return ju(this,t)}has(t){return s0(this,t)}clear(){this.doc!==null?he(this.doc,t=>{this.forEach(function(n,r,i){tc(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(mk)}}const Hx=e=>new js,Mi=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&$w(e,t);class zu{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Ar(),this.right.content.constructor){case je:this.right.deleted||zs(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const o0=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case je:t.right.deleted||zs(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Ci(e,qt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},nc=(e,t,n,r)=>{const i=new Map,s=r?Ja(t,n):null;if(s){const o=new zu(s.p.left,s.p,s.index,i);return o0(e,o,n-s.index)}else{const o=new zu(null,t._start,0,i);return o0(e,o,n)}},a0=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===je&&Mi(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,u=n.right,l=new ze(qt(s,Je(i.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,new je(a,o));l.integrate(e,0),n.right=l,n.forward()})},zs=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},c0=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===je&&Mi(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},l0=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],u=n.currentAttributes.get(a)??null;if(!Mi(u,c)){o.set(a,u);const{left:l,right:h}=n;n.right=new ze(qt(s,Je(i.store,s)),l,l&&l.lastId,h,h&&h.id,t,null,new je(a,c)),n.right.integrate(e,0),n.forward()}}return o},Wu=(e,t,n,r,i)=>{n.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});const s=e.doc,o=s.clientID;c0(n,i);const a=l0(e,t,n,i),c=r.constructor===String?new Or(r):r instanceof en?new ai(r):new rs(r);let{left:u,right:l,index:h}=n;t._searchMarker&&Mo(t._searchMarker,n.index,c.getLength()),l=new ze(qt(o,Je(s.store,o)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),n.right=l,n.index=h,n.forward(),a0(e,t,n,a)},u0=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;c0(n,i);const a=l0(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===je));){if(!n.right.deleted)switch(n.right.content.constructor){case je:{const{key:c,value:u}=n.right.content,l=i[c];if(l!==void 0){if(Mi(l,u))a.delete(c);else{if(r===0)break t;a.set(c,u)}n.right.delete(e)}else n.currentAttributes.set(c,u);break}default:r<n.right.length&&Ci(e,qt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new ze(qt(o,Je(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Or(c)),n.right.integrate(e,0),n.forward()}a0(e,t,n,a)},h0=(e,t,n,r,i)=>{let s=t;const o=hr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===je){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case je:{const{key:l,value:h}=u,f=r.get(l)??null;(o.get(l)!==u||f===h)&&(t.delete(e),a++,!c&&(i.get(l)??null)===h&&f!==h&&(f===null?i.delete(l):i.set(l,f))),!c&&!t.deleted&&zs(i,u);break}}}t=t.right}return a},Yx=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===je){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Vx=e=>{let t=0;return he(e.doc,n=>{let r=e._start,i=e._start,s=hr();const o=Eu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case je:zs(o,i.content);break;default:t+=h0(n,r,i,s,o),s=Eu(o),r=i;break}i=i.right}}),t},Xx=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Wp(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===je&&o.constructor!==Yn&&t.add(o.parent)})}he(n,r=>{Ap(e,e.deleteSet,i=>{if(i instanceof Yn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===je?t.add(s):Yx(r,i)});for(const i of t)Vx(i)})},f0=(e,t,n)=>{const r=n,i=Eu(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case ai:case rs:case Or:n<t.right.length&&Ci(e,qt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&h0(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Mo(o._searchMarker,t.index,-r+n),t};class qx extends qa{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];he(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const f=()=>{if(a!==null){let d=null;switch(a){case"delete":h>0&&(d={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(d={insert:u},i.size>0&&(d.attributes={},i.forEach((p,m)=>{p!==null&&(d.attributes[m]=p)}))),u="";break;case"retain":l>0&&(d={retain:l},Bw(c)||(d.attributes=Mw({},c))),l=0;break}d&&n.push(d),a=null}};for(;o!==null;){switch(o.content.constructor){case ai:case rs:this.adds(o)?this.deletes(o)||(f(),a="insert",u=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=1);break;case Or:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=o.length);break;case je:{const{key:d,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(d)??null;Mi(m,p)?p!==null&&o.delete(r):(a==="retain"&&f(),Mi(p,s.get(d)??null)?delete c[d]:c[d]=p)}}else if(this.deletes(o)){s.set(d,p);const m=i.get(d)??null;Mi(m,p)||(a==="retain"&&f(),c[d]=m)}else if(!o.deleted){s.set(d,p);const m=c[d];m!==void 0&&(Mi(m,p)?m!==null&&o.delete(r):(a==="retain"&&f(),p===null?delete c[d]:c[d]=p))}o.deleted||(a==="insert"&&f(),zs(i,o.content));break}}o=o.right}for(f();n.length>0;){const d=n[n.length-1];if(d.retain!==void 0&&d.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class oi extends en{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??cn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new oi}clone(){const t=new oi;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new qx(this,t,n);Za(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??cn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Or&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?he(this.doc,r=>{const i=new zu(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Wu(r,this,i,a,o.attributes||{})}else o.retain!==void 0?u0(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&f0(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??cn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let f=!1;s.forEach((p,m)=>{f=!0,h[m]=p});const d={insert:a};f&&(d.attributes=h),i.push(d),a=""}}const l=()=>{for(;c!==null;){if(Ds(c,t)||n!==void 0&&Ds(c,n))switch(c.content.constructor){case Or:{const h=s.get("ychange");t!==void 0&&!Ds(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Ds(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case ai:case rs:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const f={};h.attributes=f,s.forEach((d,p)=>{f[p]=d})}i.push(h);break}case je:Ds(c,t)&&(u(),zs(s,c.content));break}c=c.right}u()};return t||n?he(o,h=>{t&&Lu(h,t),n&&Lu(h,n),l()},"cleanup"):l(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?he(i,s=>{const o=nc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Wu(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?he(i,s=>{const o=nc(s,this,t,!r);Wu(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?he(r,i=>{f0(i,nc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?he(i,s=>{const o=nc(s,this,t,!1);o.right!==null&&u0(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?he(this.doc,n=>{tc(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?he(this.doc,r=>{$u(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return ju(this,t)}getAttributes(){return i0(this)}_write(t){t.writeTypeRef(gk)}}const Jx=e=>new oi;class Ku{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??cn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Ws||n.constructor===ns)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class ns extends en{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ns}clone(){const t=new ns;return t.insert(0,this.toArray().map(n=>n instanceof en?n.clone():n)),t}get length(){return this.doc??cn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Ku(this,t)}querySelector(t){t=t.toUpperCase();const r=new Ku(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Si(new Ku(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Za(this,t,new tk(this,n,t))}toString(){return Qp(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Uo(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?he(this.doc,r=>{n0(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)he(this.doc,r=>{const i=t&&t instanceof en?t._item:t;Qa(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Ri("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?he(this.doc,r=>{r0(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Zp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return t0(this,t)}slice(t=0,n=this.length){return Jp(this,t,n)}forEach(t){Uo(this,t)}_write(t){t.writeTypeRef(_k)}}const Zx=e=>new ns;class Ws extends ns{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Ws(this.nodeName)}clone(){const t=new Ws(this.nodeName),n=this.getAttributes();return Fw(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof en?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?he(this.doc,n=>{tc(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?he(this.doc,r=>{$u(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return ju(this,t)}hasAttribute(t){return s0(this,t)}getAttributes(t){return t?zx(this,t):i0(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Uo(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(yk),t.writeKey(this.nodeName)}}const Qx=e=>new Ws(e.readKey());class tk extends qa{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class rc extends js{constructor(t){super(),this.hookName=t}_copy(){return new rc(this.hookName)}clone(){const t=new rc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(bk),t.writeKey(this.hookName)}}const ek=e=>new rc(e.readKey());class ic extends oi{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new ic}clone(){const t=new ic;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Ek)}}const nk=e=>new ic;class Gu{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Tr()}mergeWith(t){return!1}write(t,n,r){throw Tr()}integrate(t,n){throw Tr()}}const rk=0;class Yn extends Gu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),jp(t.doc.store,this)}write(t,n){t.writeInfo(rk),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Fo{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Fo(this.content)}splice(t){throw Tr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const ik=e=>new Fo(e.readBuf());class Bo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Bo(this.len)}splice(t){const n=new Bo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Ga(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const sk=e=>new Bo(e.readLen()),d0=(e,t)=>new Fs({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Po{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Po(d0(this.doc.guid,this.opts))}splice(t){throw Tr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const ok=e=>new Po(d0(e.readString(),e.readAny()));class rs{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new rs(this.embed)}splice(t){throw Tr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const ak=e=>new rs(e.readJSON());class je{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new je(this.key,this.value)}splice(t){throw Tr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const ck=e=>new je(e.readKey(),e.readJSON());class sc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new sc(this.arr)}splice(t){const n=new sc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const lk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new sc(n)},uk=Ka("node_env")==="development";class is{constructor(t){this.arr=t,uk&&gp(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new is(this.arr)}splice(t){const n=new is(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const hk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new is(n)};class Or{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Or(this.str)}splice(t){const n=new Or(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const fk=e=>new Or(e.readString()),dk=[Kx,Hx,Jx,Qx,Zx,ek,nk],pk=0,mk=1,gk=2,yk=3,_k=4,bk=5,Ek=6;class ai{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ai(this.type._copy())}splice(t){throw Tr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const wk=e=>new ai(dk[e.readTypeRef()](e)),oc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new ze(qt(r,i+n),t,qt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=qt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class ze extends Gu{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Fd:0}set marker(t){(this.info&iu)>0!==t&&(this.info^=iu)}get marker(){return(this.info&iu)>0}get keep(){return(this.info&Ud)>0}set keep(t){this.keep!==t&&(this.info^=Ud)}get countable(){return(this.info&Fd)>0}get deleted(){return(this.info&ru)>0}set deleted(t){this.deleted!==t&&(this.info^=ru)}markDeleted(){this.info|=ru}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Je(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Je(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ps&&this.id.client!==this.parent.client&&this.parent.clock>=Je(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=zp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ci(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Yn||this.right&&this.right.constructor===Yn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ps){const r=Mu(n,this.parent);r.constructor===Yn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=zp(t,t.doc.store,qt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Ha(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Ha(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Mu(t.doc.store,i.origin)))s.has(Mu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),jp(t.doc.store,this),this.content.integrate(t,this),Gp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Yn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:qt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ha(t.origin,this.lastId)&&this.right===t&&Ha(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Ga(t.deleteSet,this.id.client,this.id.clock,this.length),Gp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Ar();this.content.gc(t),n?vx(t,this,new Yn(this.id,this.length)):this.content=new Bo(this.length)}write(t,n){const r=n>0?qt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&La|(r===null?0:Fn)|(i===null?0:ei)|(s===null?0:To);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=Ax(a);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Ps?(t.writeParentInfo(!1),t.writeLeftID(a)):Ar();s!==null&&t.writeString(s)}this.content.write(t,n)}}const p0=(e,t)=>xk[t&La](e),xk=[()=>{Ar()},sk,lk,ik,fk,ak,ck,wk,hk,ok,()=>{Ar()}],kk=10;class Vn extends Gu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Ar()}write(t,n){t.writeInfo(kk),$t(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const m0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Cs<"u"?Cs:{},g0="__ $YJS$ __";m0[g0]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),m0[g0]=!0;const Hu=0,y0=1,_0=2,Tk=(e,t)=>{$t(e,Hu);const n=kx(t);an(e,n)},b0=(e,t,n)=>{$t(e,y0),an(e,bx(t,n))},Ak=(e,t,n)=>b0(t,n,dn(e)),E0=(e,t,n)=>{try{gx(t,dn(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},vk=(e,t)=>{$t(e,_0),an(e,t)},Sk=E0,Rk=(e,t,n,r)=>{const i=jt(e);switch(i){case Hu:Ak(e,t,n);break;case y0:E0(e,n,r);break;case _0:Sk(e,n,r);break;default:throw new Error("Unknown message type")}return i};let w0=!1;const Cr=new Fs;function x0(e,t,n){const r=Cr.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function Ik(e,t){x0(e,0,t)}function Yu(e,t){const n=new oi(t);x0(e,1,n)}function Nk(e,t){Cr.getMap().set(e,t)}function Ok(e,t){const n=Cr.getMap(),r=new oi(t);n.set(e,r)}function k0(e,t){const n=Cr.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function Ck(e,t){return k0(e,n=>{Ct(n)&&t(n)})}function T0(e,t){return k0(e,n=>{n instanceof oi&&t(n.toJSON())})}function ac(e){return ur(e)}const Xn=vs("modem",["second"],e=>{if(Xn.session(e))switch(e.target){case"second":!w0&&e.data%2===0&&Xn.emit(e.player,"modem:join");break;case"join":if(e.sender!==Xn.id()){Xn.reply(e,"joinack");const t=Ii();Tk(t,Cr),Xn.reply(e,"sync",ac(t));const n=Ii();b0(n,Cr),Xn.reply(e,"sync",ac(n))}break;case"joinack":e.sender!==Xn.id()&&(w0=!0);break;case"sync":{if(e.sender!==Xn.id()&&k(e.data))try{const t=Qi(e.data),n=Ii();Rk(t,n,Cr,Xn)===Hu&&Xn.emit("","modem:sync",ac(n))}catch(t){ue(Xn,e.player,"sync",t.message)}break}}});function A0(e){const t=Ii();vk(t,e),Xn.emit("","modem:sync",ac(t))}Cr.on("update",A0),Cr.on("destroy",()=>{Cr.off("update",A0)});function Lk(e,t){return e%t}function Mk(e,t){return Math.floor(e/t)}function v0(e,t){return{x:Lk(e,t),y:Mk(e,t)}}function cc(e,t){return e.x+e.y*t}function S0(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function R0(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let u=a;u<=c;++u)for(let l=s;l<=o;++l)i.push({x:l,y:u});return i}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const I0="170",Uk="",fr="srgb",N0="srgb-linear",O0="linear",Vu="srgb";function Ks(e,t,n){return Math.max(t,Math.min(n,e))}function Fk(e,t){return(e%t+t)%t}function Xu(e,t,n){return(1-n)*e+n*t}class Do{constructor(t=0,n=0){Do.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Ks(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class $o{constructor(t,n,r,i,s,o,a,c,u){$o.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,u)}set(t,n,r,i,s,o,a,c,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=n,l[4]=s,l[5]=c,l[6]=r,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],u=r[1],l=r[4],h=r[7],f=r[2],d=r[5],p=r[8],m=i[0],x=i[3],w=i[6],T=i[1],v=i[4],I=i[7],U=i[2],S=i[5],N=i[8];return s[0]=o*m+a*T+c*U,s[3]=o*x+a*v+c*S,s[6]=o*w+a*I+c*N,s[1]=u*m+l*T+h*U,s[4]=u*x+l*v+h*S,s[7]=u*w+l*I+h*N,s[2]=f*m+d*T+p*U,s[5]=f*x+d*v+p*S,s[8]=f*w+d*I+p*N,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8];return n*o*l-n*a*u-r*s*l+r*a*c+i*s*u-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,f=a*c-l*s,d=u*s-o*c,p=n*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(i*u-l*r)*m,t[2]=(a*r-i*o)*m,t[3]=f*m,t[4]=(l*n-i*c)*m,t[5]=(i*s-a*n)*m,t[6]=d*m,t[7]=(r*c-u*n)*m,t[8]=(o*n-r*s)*m,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(r*c,r*u,-r*(c*o+u*a)+o+t,-i*u,i*c,-i*(-u*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(qu.makeScale(t,n)),this}rotate(t){return this.premultiply(qu.makeRotation(-t)),this}translate(t,n){return this.premultiply(qu.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const qu=new $o,qn={enabled:!0,workingColorSpace:N0,spaces:{},convert:function(e,t,n){return this.enabled===!1||t===n||!t||!n||(this.spaces[t].transfer===Vu&&(e.r=Gs(e.r),e.g=Gs(e.g),e.b=Gs(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Vu&&(e.r=Hs(e.r),e.g=Hs(e.g),e.b=Hs(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Uk?O0:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function Gs(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function Hs(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const C0=[.64,.33,.3,.6,.15,.06],L0=[.2126,.7152,.0722],M0=[.3127,.329],U0=new $o().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),F0=new $o().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);qn.define({[N0]:{primaries:C0,whitePoint:M0,transfer:O0,toXYZ:U0,fromXYZ:F0,luminanceCoefficients:L0,workingColorSpaceConfig:{unpackColorSpace:fr},outputColorSpaceConfig:{drawingBufferColorSpace:fr}},[fr]:{primaries:C0,whitePoint:M0,transfer:Vu,toXYZ:U0,fromXYZ:F0,luminanceCoefficients:L0,outputColorSpaceConfig:{drawingBufferColorSpace:fr}}});const B0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ui={h:0,s:0,l:0},lc={h:0,s:0,l:0};function Ju(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class Zu{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=fr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,qn.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=qn.workingColorSpace){return this.r=t,this.g=n,this.b=r,qn.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=qn.workingColorSpace){if(t=Fk(t,1),n=Ks(n,0,1),r=Ks(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=Ju(o,s,t+1/3),this.g=Ju(o,s,t),this.b=Ju(o,s,t-1/3)}return qn.toWorkingColorSpace(this,i),this}setStyle(t,n=fr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=fr){const r=B0[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Gs(t.r),this.g=Gs(t.g),this.b=Gs(t.b),this}copyLinearToSRGB(t){return this.r=Hs(t.r),this.g=Hs(t.g),this.b=Hs(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=fr){return qn.fromWorkingColorSpace(ln.copy(this),t),Math.round(Ks(ln.r*255,0,255))*65536+Math.round(Ks(ln.g*255,0,255))*256+Math.round(Ks(ln.b*255,0,255))}getHexString(t=fr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=qn.workingColorSpace){qn.fromWorkingColorSpace(ln.copy(this),n);const r=ln.r,i=ln.g,s=ln.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,u;const l=(a+o)/2;if(a===o)c=0,u=0;else{const h=o-a;switch(u=l<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return t.h=c,t.s=u,t.l=l,t}getRGB(t,n=qn.workingColorSpace){return qn.fromWorkingColorSpace(ln.copy(this),n),t.r=ln.r,t.g=ln.g,t.b=ln.b,t}getStyle(t=fr){qn.fromWorkingColorSpace(ln.copy(this),t);const n=ln.r,r=ln.g,i=ln.b;return t!==fr?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Ui),this.setHSL(Ui.h+t,Ui.s+n,Ui.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Ui),t.getHSL(lc);const r=Xu(Ui.h,lc.h,n),i=Xu(Ui.s,lc.s,n),s=Xu(Ui.l,lc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ln=new Zu;Zu.NAMES=B0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:I0}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=I0),new Do,new Do;function Bn(e,t,n){return Math.max(t,Math.min(n,e))}function Qu(e){return e*180/Math.PI}const Bk=md("089fad0j9awfem09wavefc09uwaef");function Pk(){return Bk()}function Dk(e){return md(e)()}function Lr(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(Pk()*i)}function P0(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(Dk(e)*s)}function D0(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function $k(e){return e[Lr(0,e.length-1)]}function jk(e,t){return t[P0(e,0,t.length-1)]}function nn(...e){return $k(e.flat())}function $0(e,...t){return jk(e,t.flat())}function zk(e){return[...new Set(e)].filter(k)}var j0={exports:{}},th={exports:{}},z0;function Wk(){return z0||(z0=1,function(e,t){(function(n,r){e.exports=r()})(xn,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(m){if(m)for(var x=0;x<l.length;x++)m[l[x]]!==void 0&&this["set"+r(l[x])](m[l[x]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",x=this.getLineNumber()||"",w=this.getColumnNumber()||"",T=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+x+":"+w+")":"[eval]:"+x+":"+w:T?T+" ("+m+":"+x+":"+w+")":m+":"+x+":"+w}},h.fromString=function(x){var w=x.indexOf("("),T=x.lastIndexOf(")"),v=x.substring(0,w),I=x.substring(w+1,T).split(","),U=x.substring(T+1);if(U.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(U,""),N=S[1],P=S[2],L=S[3];return new h({functionName:v,args:I||void 0,fileName:N,lineNumber:P||void 0,columnNumber:L||void 0})};for(var f=0;f<s.length;f++)h.prototype["get"+r(s[f])]=i(s[f]),h.prototype["set"+r(s[f])]=function(m){return function(x){this[m]=!!x}}(s[f]);for(var d=0;d<o.length;d++)h.prototype["get"+r(o[d])]=i(o[d]),h.prototype["set"+r(o[d])]=function(m){return function(x){if(!n(x))throw new TypeError(m+" must be a Number");this[m]=Number(x)}}(o[d]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(x){this[m]=String(x)}}(a[p]);return h})}(th)),th.exports}(function(e,t){(function(n,r){e.exports=r(Wk())})(xn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=h.match(/ (\(.+\)$)/);h=f?h.replace(f[0],""):h;var d=this.extractLocation(f?f[1]:h),p=f&&h||void 0,m=["eval","<anonymous>"].indexOf(d[0])>-1?void 0:d[0];return new r({functionName:p,fileName:m,lineNumber:d[1],columnNumber:d[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new r({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=l.match(h),d=f&&f[1]?f[1]:void 0,p=this.extractLocation(l.replace(h,""));return new r({functionName:d,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],f=2,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],f=0,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),f=this.extractLocation(h.pop()),d=h.shift()||"",p=d.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;d.match(/\(([^)]*)\)/)&&(m=d.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var x=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:x,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:l})},this)}}})})(j0);var Kk=j0.exports,Gk=Ts(Kk);const eh=14,uc=3,hc=8,fc=14,dc=16,Hk=16,Yk=16;function pc(e,t){return new Array(e).fill(t)}function Vk(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:pc(s,0),color:pc(s,0),bg:pc(s,i)}}function Xk(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Wt.ONCLEAR}}function qk(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function Jk(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:pc(s,i)}}function Zk(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function Qk(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5}}function W0(e,t){return`${e}:${t}`}const tT=1,eT=16,nT=256;var mn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(mn||{});const Mr=!!JSON.parse("false"),rT=!!JSON.parse("false");JSON.parse("false");const iT=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const ci={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return hc*ci.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return fc*ci.DRAW_CHAR_SCALE}},Y=vs("SOFTWARE");function li(e){const t={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},listcommands(){return Kn(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function be(e){return`${e??""}`}function jo(e,t){const n=parseFloat(be(e));return isNaN(n)?t:n}function K0(e,t,n){const[r]=it(t,0,[H.MAYBE_NAME]);fE(Y,e,r??"",n)}function Jn(e,t,n,r){const[i,s]=it(r,0,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);Rd(Y,e,t,n,i,s)}const sT=["echo","reverb","phaser","distortion","vibrato","fc"];function G0(e,t,n){const[r,i]=it(n,0,[H.NUMBER_OR_STRING]);if(Ct(r))Jl(Y,e,t,"volume",r);else if(sT.includes(Mt(r))){const[s,o]=it(n,i,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);Rd(Y,e,t,r,s,o)}else{const[s]=it(n,i,[H.MAYBE_NUMBER_OR_STRING]);if(Ct(s)){const o=n.length-i,a=new Array(o).fill(H.NUMBER),c=it(n,i,a).slice(0,o),u=c.length===1?c[0]:c;Jl(Y,e,t,r,u)}else{const[o]=it(n,i,[H.MAYBE_NUMBER_OR_STRING]);Jl(Y,e,t,r,o)}}}const nh=li().command("tts",(e,t)=>{const[n,r]=it(t,0,[H.STRING]),i=t.slice(r).map(be).join("");return uE(Y,_.elementfocus,n,i),0}).command("tta",(e,t)=>{const n=t.map(be).join("");return hE(Y,_.elementfocus,n),0}).command("bpm",(e,t)=>{const[n]=it(t,0,[H.NUMBER]);return dE(Y,_.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=it(t,0,[H.NUMBER]);return pE(Y,_.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=it(t,0,[H.NUMBER]);return mE(Y,_.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=it(t,0,[H.NUMBER]);return gE(Y,_.elementfocus,n),0}).command("play",(e,t)=>(K0(_.elementfocus,t,!1),0)).command("bgplay",(e,t)=>(K0(_.elementfocus,t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)G0(_.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)Jn(_.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)Jn(_.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)Jn(_.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)Jn(_.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)Jn(_.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)Jn(_.elementfocus,n,"vibrato",t);return 0});for(let e=0;e<8;++e)nh.command(`synth${e+1}`,(t,n)=>(G0(_.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;nh.command(`echo${t}`,(n,r)=>(Jn(_.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(Jn(_.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(Jn(_.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(Jn(_.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(Jn(_.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(Jn(_.elementfocus,e,"vibrato",r),0))}function oT(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var aT=oT;const cT=aT,Jt=function(){};Jt.prototype.FMX=0,Jt.prototype.FMY=0,Jt.prototype.FMXxFMY=0,Jt.prototype.T=0,Jt.prototype.N=0,Jt.prototype.initiliazedField=!1,Jt.prototype.generationComplete=!1,Jt.prototype.wave=null,Jt.prototype.compatible=null,Jt.prototype.weightLogWeights=null,Jt.prototype.sumOfWeights=0,Jt.prototype.sumOfWeightLogWeights=0,Jt.prototype.startingEntropy=0,Jt.prototype.sumsOfOnes=null,Jt.prototype.sumsOfWeights=null,Jt.prototype.sumsOfWeightLogWeights=null,Jt.prototype.entropies=null,Jt.prototype.propagator=null,Jt.prototype.observed=null,Jt.prototype.distribution=null,Jt.prototype.stack=null,Jt.prototype.stackSize=0,Jt.prototype.DX=[-1,0,1,0],Jt.prototype.DY=[0,1,0,-1],Jt.prototype.opposite=[2,3,0,1],Jt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},Jt.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=cT(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},Jt.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const u=a+c*this.FMX,l=this.propagator[i][e[1]],h=this.compatible[u];for(let f=0;f<l.length;f++){const d=l[f],p=h[d];p[i]--,p[i]==0&&this.ban(u,d)}}}},Jt.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},Jt.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},Jt.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},Jt.prototype.isGenerationComplete=function(){return this.generationComplete},Jt.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},Jt.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var H0=Jt;const Y0=H0,ui=function(t,n,r,i,s,o,a,c,u,l){l=l||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const h=n,f=new Array(h);for(let L=0;L<h;L++)f[L]=new Array(r);this.colors=[];const d={};for(let L=0;L<r;L++)for(let V=0;V<n;V++){const Z=(L*n+V)*4,C=[t[Z],t[Z+1],t[Z+2],t[Z+3]],R=C.join("-");d.hasOwnProperty(R)||(d[R]=this.colors.length,this.colors.push(C)),f[V][L]=d[R]}const p=this.colors.length,m=Math.pow(p,i*i),x=function(V){let Z=new Array(i*i);for(let C=0;C<i;C++)for(let R=0;R<i;R++)Z[R+C*i]=V(R,C);return Z},w=function(V,Z){return x(function(C,R){return f[(V+C)%n][(Z+R)%r]})},T=function(V){return x(function(Z,C){return V[i-1-C+Z*i]})},v=function(V){return x(function(Z,C){return V[i-1-Z+C*i]})},I=function(V){let Z=0,C=1;for(let R=0;R<V.length;R++)Z+=V[V.length-1-R]*C,C*=p;return Z},U=function(V){let Z=V,C=m;const R=new Array(i*i);for(let b=0;b<R.length;b++){C/=p;let B=0;for(;Z>=C;)Z-=C,B++;R[b]=B}return R},S={},N=[];for(let L=0;L<(a?r:r-i+1);L++)for(let V=0;V<(a?n:n-i+1);V++){const Z=new Array(8);Z[0]=w(V,L),Z[1]=v(Z[0]),Z[2]=T(Z[0]),Z[3]=v(Z[2]),Z[4]=T(Z[2]),Z[5]=v(Z[4]),Z[6]=T(Z[4]),Z[7]=v(Z[6]);for(let C=0;C<u;C++){const R=I(Z[C]);S[R]?S[R]++:(N.push(R),S[R]=1)}}this.T=N.length,this.ground=(l+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let L=0;L<this.T;L++){const V=parseInt(N[L],10);this.patterns[L]=U(V),this.weights[L]=S[V]}const P=function(V,Z,C,R){const b=C<0?0:C,B=C<0?C+i:i,X=R<0?0:R,D=R<0?R+i:i;for(let lt=X;lt<D;lt++)for(let et=b;et<B;et++)if(V[et+i*lt]!=Z[et-C+i*(lt-R)])return!1;return!0};this.propagator=new Array(4);for(let L=0;L<4;L++){this.propagator[L]=new Array(this.T);for(let V=0;V<this.T;V++){const Z=[];for(let C=0;C<this.T;C++)P(this.patterns[V],this.patterns[C],this.DX[L],this.DY[L])&&Z.push(C);this.propagator[L][V]=Z}}};ui.prototype=Object.create(Y0.prototype),ui.prototype.constructor=ui,ui.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},ui.prototype.clear=function(){if(Y0.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},ui.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},ui.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},ui.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let l=0;l<this.N;l++)for(let h=0;h<this.N;h++){let f=n-h;f<0&&(f+=this.FMX);let d=r-l;if(d<0&&(d+=this.FMY),this.onBoundary(f,d))continue;const p=f+d*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const x=this.colors[this.patterns[m][h+l*this.N]];s+=x[0],o+=x[1],a+=x[2],c+=x[3]}}const u=t*4;e[u]=s/i,e[u+1]=o/i,e[u+2]=a/i,e[u+3]=c/i}};var lT=ui;const uT=H0,Fi=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const u=function(I){const U=new Array(o*o);for(let S=0;S<o;S++)for(let N=0;N<o;N++)U[N+S*o]=I(N,S);return U},l=function(I){return u(function(U,S){return I[o-1-S+U*o]})},h=function(I){return u(function(U,S){return I[o-1-U+S*o]})};this.tiles=[];const f=[],d=[],p={};let m,x,w;for(let v=0;v<t.tiles.length;v++){const I=t.tiles[v];if(c!==null&&c.indexOf(I.name)===-1)continue;switch(I.symmetry){case"L":w=4,m=function(S){return(S+1)%4},x=function(S){return S%2===0?S+1:S-1};break;case"T":w=4,m=function(S){return(S+1)%4},x=function(S){return S%2===0?S:4-S};break;case"I":w=2,m=function(S){return 1-S},x=function(S){return S};break;case"\\":w=2,m=function(S){return 1-S},x=function(S){return 1-S};break;case"F":w=8,m=function(S){return S<4?(S+1)%4:4+(S-1)%4},x=function(S){return S<4?S+4:S-4};break;default:w=1,m=function(S){return S},x=function(S){return S};break}this.T=d.length,p[I.name]=this.T;for(let S=0;S<w;S++)d.push([this.T+S,this.T+m(S),this.T+m(m(S)),this.T+m(m(m(S))),this.T+x(S),this.T+x(m(S)),this.T+x(m(m(S))),this.T+x(m(m(m(S))))]);let U;if(a)for(let S=0;S<w;S++)U=I.bitmap[S],this.tiles.push(u(function(N,P){return[U[(o*P+N)*4],U[(o*P+N)*4+1],U[(o*P+N)*4+2],U[(o*P+N)*4+3]]}));else{U=I.bitmap,this.tiles.push(u(function(S,N){return[U[(o*N+S)*4],U[(o*N+S)*4+1],U[(o*N+S)*4+2],U[(o*N+S)*4+3]]}));for(let S=1;S<w;S++)this.tiles.push(S<4?l(this.tiles[this.T+S-1]):h(this.tiles[this.T+S-4]))}for(let S=0;S<w;S++)f.push(I.weight||1)}this.T=d.length,this.weights=f,this.propagator=new Array(4);const T=new Array(4);for(let v=0;v<4;v++){this.propagator[v]=new Array(this.T),T[v]=new Array(this.T);for(let I=0;I<this.T;I++){T[v][I]=new Array(this.T);for(let U=0;U<this.T;U++)T[v][I][U]=!1}}for(let v=0;v<t.neighbors.length;v++){const I=t.neighbors[v],U=I.left.split(" ").filter(function(Z){return Z.length}),S=I.right.split(" ").filter(function(Z){return Z.length});if(c!==null&&(c.indexOf(U[0])===-1||c.indexOf(S[0])===-1))continue;const N=d[p[U[0]]][U.length==1?0:parseInt(U[1],10)],P=d[N][1],L=d[p[S[0]]][S.length==1?0:parseInt(S[1],10)],V=d[L][1];T[0][L][N]=!0,T[0][d[L][6]][d[N][6]]=!0,T[0][d[N][4]][d[L][4]]=!0,T[0][d[N][2]][d[L][2]]=!0,T[1][V][P]=!0,T[1][d[P][6]][d[V][6]]=!0,T[1][d[V][4]][d[P][4]]=!0,T[1][d[P][2]][d[V][2]]=!0}for(let v=0;v<this.T;v++)for(let I=0;I<this.T;I++)T[2][v][I]=T[0][I][v],T[3][v][I]=T[1][I][v];for(let v=0;v<4;v++)for(let I=0;I<this.T;I++){const U=[],S=T[v][I];for(let N=0;N<this.T;N++)S[N]&&U.push(N);this.propagator[v][I]=U}};Fi.prototype=Object.create(uT.prototype),Fi.prototype.constructor=Fi,Fi.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},Fi.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},Fi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},Fi.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let u=0;u<this.tilesize;u++){const l=(n*this.tilesize+u+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];else{let h=0,f=0,d=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const x=this.tiles[m][u+c*this.tilesize],w=this.weights[m]*a;h+=x[0]*w,f+=x[1]*w,d+=x[2]*w,p+=x[3]*w}e[l]=h,e[l+1]=f,e[l+2]=d,e[l+3]=p}}}};var hT=Fi,fT={OverlappingModel:lT,SimpleTiledModel:hT},dT=Ts(fT);function pT(e){return k(e)&&e<Wt.ONBLACK?e:void 0}function mT(e){return k(e)&&e>Wt.WHITE&&e<Wt.ONCLEAR?e-Wt.ONBLACK:void 0}const zo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Pn(e){return re(e)&&X0(e[0])}function V0(e){return Pn(e)&&e[0].startsWith("ON")}function X0(e){return k(Wt[e])&&St(e)}function q0(e){if(St(e))return zo[Mt(e)]}function gT(e){return e.map(t=>Wt[t]).find(t=>k(t)&&t<Wt.ONBLACK)}function yT(e){return e.map(t=>Wt[t]).find(t=>k(t)&&t>=Wt.ONBLACK)}function _T(e){if(Pn(e))return e;if(X0(e))return[e];const t=q0(e);if(k(t))return[t]}function J0(e){const t=_.words[e],n=_T(t);return Pn(n)?[n,e+1]:[void 0,e]}function mc(e){const t=[];let n=e;const[r,i]=J0(e);if(Pn(r)&&(t.push(...r),n=i),Pn(t)&&!V0(t)){const[s,o]=J0(i);V0(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function Z0(e){const t={};return e.every(n=>{const r=Wt[n];k(r)&&(r<Wt.ONBLACK?t.color=r:t.bg=r-Wt.ONBLACK)}),t}function Ys(e){return re(e)&&typeof e[0]=="string"}function bT(e){const t=_.words[e];return St(t)?[t,e+1]:[void 0,e]}function Q0(e){const t=_.words[e];if(Ys(t))return[t,e+1];const[n,r]=mc(e),[i,s]=bT(r);return St(i)?[[i,n],s]:[void 0,e]}function gc(e){if(!Ys(e))return;const[t]=e;return t}function tm(e){if(!Ys(e))return;const[,t]=e,n=k(t)?gT(t):void 0;return k(n)?n:void 0}function em(e){if(!Ys(e))return;const[,t]=e,n=k(t)?yT(t):void 0;return k(n)?n:void 0}const Gt=60,ke=25,ET=Gt*ke;var Et=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(Et||{});function rh(e,t){const n=e??Yt.ISWALK,r=t??Yt.ISWALK;switch(n){case Yt.ISWALK:return r!==Yt.ISWALK;case Yt.ISSWIM:return r!==Yt.ISSWIM;case Yt.ISSOLID:return!0;case Yt.ISBULLET:return r!==Yt.ISWALK&&r!==Yt.ISSWIM}}function yc(e,t,n){const r=e==null?void 0:e.objects[n];if(k(r))return r;if(k(t)){const i=Vs(e,"player"),s={x:t.x??0,y:t.y??0};im(s,i)}}function Vs(e,t){var r,i;return t==="empty"?[...(e==null?void 0:e.terrain)??[]].map((o,a)=>{if(!(o!=null&&o.name)&&!(o!=null&&o.kind))return{...v0(a,Gt),name:"empty"}}).filter(k):[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(k)}function nm(e,t){const n=gc(t),r=tm(t),i=em(t);return e.filter(s=>{var o,a,c;return!(k(n)&&Mt((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||k(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??Wt.WHITE)!==r||k(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Wt.BLACK)!==i)}).filter(k)}function rm(e,t){return k(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(k(i))return i;const s=Vs(e,Mt(n));if(s.length)return s}else if(go(n)&&n.x>=0&&n.x<Gt&&n.y>=0&&n.y<ke){const i=n.x+n.y*Gt,s=(r=e.lookup)==null?void 0:r[i];return k(s)?e.objects[s]:e.terrain[i]}}).flat().filter(k):[]}function im(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var ih;try{ih=new TextDecoder}catch{}var mt,Zn,j=0,fe={},Zt,Bi,Qn=0,Ur=0,Ze,hi,Tn=[],Xt,sm={useRecords:!1,mapsAsObjects:!0};class om{}const am=new om;am.name="MessagePack 0xC1";var Pi=!1,cm=2,lm;try{new Function("")}catch{cm=1/0}class Wo{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(mt)return xm(()=>(lh(),this?this.unpack(t,n):Wo.prototype.unpack.call(sm,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof tn<"u"?tn.from(t):new Uint8Array(t)),typeof n=="object"?(Zn=n.end||t.length,j=n.start||0):(j=0,Zn=n>-1?n:t.length),Ur=0,Bi=null,Ze=null,mt=t;try{Xt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw mt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Wo){if(fe=this,this.structures)return Zt=this.structures,_c(n);(!Zt||Zt.length>0)&&(Zt=[])}else fe=sm,(!Zt||Zt.length>0)&&(Zt=[]);return _c(n)}unpackMultiple(t,n){let r,i=0;try{Pi=!0;let s=t.length,o=this?this.unpack(t,s):bc.unpack(t,s);if(n){if(n(o,i,j)===!1)return;for(;j<s;)if(i=j,n(_c(),i,j)===!1)return}else{for(r=[o];j<s;)i=j,r.push(_c());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Pi=!1,lh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function _c(e){try{if(!fe.trusted&&!Pi){let n=Zt.sharedLength||0;n<Zt.length&&(Zt.length=n)}let t;if(fe.randomAccessStructure&&mt[j]<64&&mt[j]>=32&&lm?(t=lm(mt,j,Zn,fe),mt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),j=Zn):t=Ce(),Ze&&(j=Ze.postBundlePosition,Ze=null),Pi&&(Zt.restoreStructures=null),j==Zn)Zt&&Zt.restoreStructures&&um(),Zt=null,mt=null,hi&&(hi=null);else{if(j>Zn)throw new Error("Unexpected end of MessagePack data");if(!Pi){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Zt&&Zt.restoreStructures&&um(),lh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||j>Zn)&&(t.incomplete=!0),t}}function um(){for(let e in Zt.restoreStructures)Zt[e]=Zt.restoreStructures[e];Zt.restoreStructures=null}function Ce(){let e=mt[j++];if(e<160)if(e<128){if(e<64)return e;{let t=Zt[e&63]||fe.getStructures&&fm()[e&63];return t?(t.read||(t.read=sh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,fe.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=_m();r==="__proto__"&&(r="__proto_"),t[r]=Ce()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ce(),Ce());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ce();return fe.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Ur>=j)return Bi.slice(j-Qn,(j+=t)-Qn);if(Ur==0&&Zn<140){let n=t<16?ah(t):mm(t);if(n!=null)return n}return oh(t)}else{let t;switch(e){case 192:return null;case 193:return Ze?(t=Ce(),t>0?Ze[1].slice(Ze.position1,Ze.position1+=t):Ze[0].slice(Ze.position0,Ze.position0-=t)):am;case 194:return!1;case 195:return!0;case 196:if(t=mt[j++],t===void 0)throw new Error("Unexpected end of buffer");return ch(t);case 197:return t=Xt.getUint16(j),j+=2,ch(t);case 198:return t=Xt.getUint32(j),j+=4,ch(t);case 199:return ss(mt[j++]);case 200:return t=Xt.getUint16(j),j+=2,ss(t);case 201:return t=Xt.getUint32(j),j+=4,ss(t);case 202:if(t=Xt.getFloat32(j),fe.useFloat32>2){let n=uh[(mt[j]&127)<<1|mt[j+1]>>7];return j+=4,(n*t+(t>0?.5:-.5)>>0)/n}return j+=4,t;case 203:return t=Xt.getFloat64(j),j+=8,t;case 204:return mt[j++];case 205:return t=Xt.getUint16(j),j+=2,t;case 206:return t=Xt.getUint32(j),j+=4,t;case 207:return fe.int64AsType==="number"?(t=Xt.getUint32(j)*4294967296,t+=Xt.getUint32(j+4)):fe.int64AsType==="string"?t=Xt.getBigUint64(j).toString():fe.int64AsType==="auto"?(t=Xt.getBigUint64(j),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Xt.getBigUint64(j),j+=8,t;case 208:return Xt.getInt8(j++);case 209:return t=Xt.getInt16(j),j+=2,t;case 210:return t=Xt.getInt32(j),j+=4,t;case 211:return fe.int64AsType==="number"?(t=Xt.getInt32(j)*4294967296,t+=Xt.getUint32(j+4)):fe.int64AsType==="string"?t=Xt.getBigInt64(j).toString():fe.int64AsType==="auto"?(t=Xt.getBigInt64(j),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Xt.getBigInt64(j),j+=8,t;case 212:if(t=mt[j++],t==114)return Em(mt[j++]&63);{let n=Tn[t];if(n)return n.read?(j++,n.read(Ce())):n.noBuffer?(j++,n()):n(mt.subarray(j,++j));throw new Error("Unknown extension "+t)}case 213:return t=mt[j],t==114?(j++,Em(mt[j++]&63,mt[j++])):ss(2);case 214:return ss(4);case 215:return ss(8);case 216:return ss(16);case 217:return t=mt[j++],Ur>=j?Bi.slice(j-Qn,(j+=t)-Qn):xT(t);case 218:return t=Xt.getUint16(j),j+=2,Ur>=j?Bi.slice(j-Qn,(j+=t)-Qn):kT(t);case 219:return t=Xt.getUint32(j),j+=4,Ur>=j?Bi.slice(j-Qn,(j+=t)-Qn):TT(t);case 220:return t=Xt.getUint16(j),j+=2,dm(t);case 221:return t=Xt.getUint32(j),j+=4,dm(t);case 222:return t=Xt.getUint16(j),j+=2,pm(t);case 223:return t=Xt.getUint32(j),j+=4,pm(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const wT=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function sh(e,t){function n(){if(n.count++>cm){let i=e.read=new Function("r","return function(){return "+(fe.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":wT.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Ce);return e.highByte===0&&(e.read=hm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Ce()}return fe.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?hm(t,n):n}const hm=(e,t)=>function(){let n=mt[j++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Zt[r]||fm()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=sh(i,e)),i.read()};function fm(){let e=xm(()=>(mt=null,fe.getStructures()));return Zt=fe._mergeStructures(e,Zt)}var oh=Ko,xT=Ko,kT=Ko,TT=Ko;function Ko(e){let t;if(e<16&&(t=ah(e)))return t;if(e>64&&ih)return ih.decode(mt.subarray(j,j+=e));const n=j+e,r=[];for(t="";j<n;){const i=mt[j++];if(!(i&128))r.push(i);else if((i&224)===192){const s=mt[j++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=mt[j++]&63,o=mt[j++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=mt[j++]&63,o=mt[j++]&63,a=mt[j++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=Qe.apply(String,r),r.length=0)}return r.length>0&&(t+=Qe.apply(String,r)),t}function dm(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ce();return fe.freezeData?Object.freeze(t):t}function pm(e){if(fe.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=_m();r==="__proto__"&&(r="__proto_"),t[r]=Ce()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ce(),Ce());return t}}var Qe=String.fromCharCode;function mm(e){let t=j,n=new Array(e);for(let r=0;r<e;r++){const i=mt[j++];if((i&128)>0){j=t;return}n[r]=i}return Qe.apply(String,n)}function ah(e){if(e<4)if(e<2){if(e===0)return"";{let t=mt[j++];if((t&128)>1){j-=1;return}return Qe(t)}}else{let t=mt[j++],n=mt[j++];if((t&128)>0||(n&128)>0){j-=2;return}if(e<3)return Qe(t,n);let r=mt[j++];if((r&128)>0){j-=3;return}return Qe(t,n,r)}else{let t=mt[j++],n=mt[j++],r=mt[j++],i=mt[j++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){j-=4;return}if(e<6){if(e===4)return Qe(t,n,r,i);{let s=mt[j++];if((s&128)>0){j-=5;return}return Qe(t,n,r,i,s)}}else if(e<8){let s=mt[j++],o=mt[j++];if((s&128)>0||(o&128)>0){j-=6;return}if(e<7)return Qe(t,n,r,i,s,o);let a=mt[j++];if((a&128)>0){j-=7;return}return Qe(t,n,r,i,s,o,a)}else{let s=mt[j++],o=mt[j++],a=mt[j++],c=mt[j++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){j-=8;return}if(e<10){if(e===8)return Qe(t,n,r,i,s,o,a,c);{let u=mt[j++];if((u&128)>0){j-=9;return}return Qe(t,n,r,i,s,o,a,c,u)}}else if(e<12){let u=mt[j++],l=mt[j++];if((u&128)>0||(l&128)>0){j-=10;return}if(e<11)return Qe(t,n,r,i,s,o,a,c,u,l);let h=mt[j++];if((h&128)>0){j-=11;return}return Qe(t,n,r,i,s,o,a,c,u,l,h)}else{let u=mt[j++],l=mt[j++],h=mt[j++],f=mt[j++];if((u&128)>0||(l&128)>0||(h&128)>0||(f&128)>0){j-=12;return}if(e<14){if(e===12)return Qe(t,n,r,i,s,o,a,c,u,l,h,f);{let d=mt[j++];if((d&128)>0){j-=13;return}return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d)}}else{let d=mt[j++],p=mt[j++];if((d&128)>0||(p&128)>0){j-=14;return}if(e<15)return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d,p);let m=mt[j++];if((m&128)>0){j-=15;return}return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d,p,m)}}}}}function gm(){let e=mt[j++],t;if(e<192)t=e-160;else switch(e){case 217:t=mt[j++];break;case 218:t=Xt.getUint16(j),j+=2;break;case 219:t=Xt.getUint32(j),j+=4;break;default:throw new Error("Expected string")}return Ko(t)}function ch(e){return fe.copyBuffers?Uint8Array.prototype.slice.call(mt,j,j+=e):mt.subarray(j,j+=e)}function ss(e){let t=mt[j++];if(Tn[t]){let n;return Tn[t](mt.subarray(j,n=j+=e),r=>{j=r;try{return Ce()}finally{j=n}})}else throw new Error("Unknown extension type "+t)}var ym=new Array(4096);function _m(){let e=mt[j++];if(e>=160&&e<192){if(e=e-160,Ur>=j)return Bi.slice(j-Qn,(j+=e)-Qn);if(!(Ur==0&&Zn<180))return oh(e)}else return j--,bm(Ce());let t=(e<<5^(e>1?Xt.getUint16(j):e>0?mt[j]:0))&4095,n=ym[t],r=j,i=j+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Xt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=mt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return j=r,n.string;i-=3,r=j}for(n=[],ym[t]=n,n.bytes=e;r<i;)s=Xt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=mt[r++],n.push(s);let a=e<16?ah(e):mm(e);return a!=null?n.string=a:n.string=oh(e)}function bm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const Em=(e,t)=>{let n=Ce().map(bm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Zt[e];return i&&(i.isShared||Pi)&&((Zt.restoreStructures||(Zt.restoreStructures=[]))[e]=i),Zt[e]=n,n.read=sh(n,r),n.read()};Tn[0]=()=>{},Tn[0].noBuffer=!0,Tn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let AT={Error,TypeError,ReferenceError};Tn[101]=()=>{let e=Ce();return(AT[e[0]]||Error)(e[1],{cause:e[2]})},Tn[105]=e=>{if(fe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Xt.getUint32(j-4);hi||(hi=new Map);let n=mt[j],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};hi.set(t,i);let s=Ce();return i.used?Object.assign(r,s):(i.target=s,s)},Tn[112]=e=>{if(fe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Xt.getUint32(j-4),n=hi.get(t);return n.used=!0,n.target},Tn[115]=()=>new Set(Ce());const wm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let vT=typeof globalThis=="object"?globalThis:window;Tn[116]=e=>{let t=e[0],n=wm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new vT[n](Uint8Array.prototype.slice.call(e,1).buffer)},Tn[120]=()=>{let e=Ce();return new RegExp(e[0],e[1])};const ST=[];Tn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=j;return j+=t-e.length,Ze=ST,Ze=[gm(),gm()],Ze.position0=0,Ze.position1=0,Ze.postBundlePosition=j,j=n,Ce()},Tn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function xm(e){let t=Zn,n=j,r=Qn,i=Ur,s=Bi,o=hi,a=Ze,c=new Uint8Array(mt.slice(0,Zn)),u=Zt,l=Zt.slice(0,Zt.length),h=fe,f=Pi,d=e();return Zn=t,j=n,Qn=r,Ur=i,Bi=s,hi=o,Ze=a,mt=c,Pi=f,Zt=u,Zt.splice(0,Zt.length,...l),fe=h,Xt=new DataView(mt.buffer,mt.byteOffset,mt.byteLength),d}function lh(){mt=null,hi=null,Zt=null}const uh=new Array(147);for(let e=0;e<256;e++)uh[e]=+("1e"+Math.floor(45.15-e*.30103));var bc=new Wo({useRecords:!1});const RT=bc.unpack;bc.unpackMultiple,bc.unpack;let IT=new Float32Array(1);new Uint8Array(IT.buffer,0,4);let Ec;try{Ec=new TextEncoder}catch{}let hh,km;const wc=typeof tn<"u",xc=wc?function(e){return tn.allocUnsafeSlow(e)}:Uint8Array,Tm=wc?tn:Uint8Array,Am=wc?4294967296:2144337920;let J,Go,de,W=0,gn,Te=null,NT;const OT=21760,CT=/[\u0080-\uFFFF]/,Xs=Symbol("record-id");class LT extends Wo{constructor(t){super(t),this.offset=0;let n,r,i,s,o=Tm.prototype.utf8Write?function(R,b){return J.utf8Write(R,b,J.byteLength-b)}:Ec&&Ec.encodeInto?function(R,b){return Ec.encodeInto(R,J.subarray(b)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let f=l>32||h+l>64,d=l+64,p=l+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],x=0,w=0;this.pack=this.encode=function(R,b){if(J||(J=new xc(8192),de=J.dataView||(J.dataView=new DataView(J.buffer,0,8192)),W=0),gn=J.length-10,gn-W<2048?(J=new xc(J.length),de=J.dataView||(J.dataView=new DataView(J.buffer,0,J.length)),gn=J.length-10,W=0):W=W+7&2147483640,n=W,b&$T&&(W+=b&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof R!="string"?(Te=[],Te.size=1/0):Te=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let X=i.sharedLength||0;if(X>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let D=0;D<X;D++){let lt=i[D];if(!lt)continue;let et,ft=i.transitions;for(let K=0,z=lt.length;K<z;K++){let bt=lt[K];et=ft[bt],et||(et=ft[bt]=Object.create(null)),ft=et}ft[Xs]=D+64}this.lastNamedStructuresLength=X}c||(i.nextId=X+64)}r&&(r=!1);let B;try{a.randomAccessStructure&&R&&R.constructor&&R.constructor===Object?C(R):I(R);let X=Te;if(Te&&Rm(n,I,0),s&&s.idsToInsert){let D=s.idsToInsert.sort((K,z)=>K.offset>z.offset?1:-1),lt=D.length,et=-1;for(;X&&lt>0;){let K=D[--lt].offset+n;K<X.stringsPosition+n&&et===-1&&(et=0),K>X.position+n?et>=0&&(et+=6):(et>=0&&(de.setUint32(X.position+n,de.getUint32(X.position+n)+et),et=-1),X=X.previous,lt++)}et>=0&&X&&de.setUint32(X.position+n,de.getUint32(X.position+n)+et),W+=D.length*6,W>gn&&L(W),a.offset=W;let ft=UT(J.subarray(n,W),D);return s=null,ft}return a.offset=W,b&PT?(J.start=n,J.end=W,J):J.subarray(n,W)}catch(X){throw B=X,X}finally{if(i&&(T(),r&&a.saveStructures)){let X=i.sharedLength||0,D=J.subarray(n,W),lt=FT(i,a);if(!B)return a.saveStructures(lt,lt.isCompatible)===!1?a.pack(R,b):(a.lastNamedStructuresLength=X,J.length>1073741824&&(J=null),D)}J.length>1073741824&&(J=null),b&DT&&(W=n)}};const T=()=>{w<10&&w++;let R=i.sharedLength||0;if(i.length>R&&!c&&(i.length=R),x>1e4)i.transitions=null,w=0,x=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let b=0,B=m.length;b<B;b++)m[b][Xs]=0;m=[]}},v=R=>{var b=R.length;b<16?J[W++]=144|b:b<65536?(J[W++]=220,J[W++]=b>>8,J[W++]=b&255):(J[W++]=221,de.setUint32(W,b),W+=4);for(let B=0;B<b;B++)I(R[B])},I=R=>{W>gn&&(J=L(W));var b=typeof R,B;if(b==="string"){let X=R.length;if(Te&&X>=4&&X<4096){if((Te.size+=X)>OT){let ft,K=(Te[0]?Te[0].length*3+Te[1].length:0)+10;W+K>gn&&(J=L(W+K));let z;Te.position?(z=Te,J[W]=200,W+=3,J[W++]=98,ft=W-n,W+=4,Rm(n,I,0),de.setUint16(ft+n-3,W-n-ft)):(J[W++]=214,J[W++]=98,ft=W-n,W+=4),Te=["",""],Te.previous=z,Te.size=0,Te.position=ft}let et=CT.test(R);Te[et?0:1]+=R,J[W++]=193,I(et?-X:X);return}let D;X<32?D=1:X<256?D=2:X<65536?D=3:D=5;let lt=X*3;if(W+lt>gn&&(J=L(W+lt)),X<64||!o){let et,ft,K,z=W+D;for(et=0;et<X;et++)ft=R.charCodeAt(et),ft<128?J[z++]=ft:ft<2048?(J[z++]=ft>>6|192,J[z++]=ft&63|128):(ft&64512)===55296&&((K=R.charCodeAt(et+1))&64512)===56320?(ft=65536+((ft&1023)<<10)+(K&1023),et++,J[z++]=ft>>18|240,J[z++]=ft>>12&63|128,J[z++]=ft>>6&63|128,J[z++]=ft&63|128):(J[z++]=ft>>12|224,J[z++]=ft>>6&63|128,J[z++]=ft&63|128);B=z-W-D}else B=o(R,W+D);B<32?J[W++]=160|B:B<256?(D<2&&J.copyWithin(W+2,W+1,W+1+B),J[W++]=217,J[W++]=B):B<65536?(D<3&&J.copyWithin(W+3,W+2,W+2+B),J[W++]=218,J[W++]=B>>8,J[W++]=B&255):(D<5&&J.copyWithin(W+5,W+3,W+3+B),J[W++]=219,de.setUint32(W,B),W+=4),W+=B}else if(b==="number")if(R>>>0===R)R<32||R<128&&this.useRecords===!1||R<64&&!this.randomAccessStructure?J[W++]=R:R<256?(J[W++]=204,J[W++]=R):R<65536?(J[W++]=205,J[W++]=R>>8,J[W++]=R&255):(J[W++]=206,de.setUint32(W,R),W+=4);else if(R>>0===R)R>=-32?J[W++]=256+R:R>=-128?(J[W++]=208,J[W++]=R+256):R>=-32768?(J[W++]=209,de.setInt16(W,R),W+=2):(J[W++]=210,de.setInt32(W,R),W+=4);else{let X;if((X=this.useFloat32)>0&&R<4294967296&&R>=-2147483648){J[W++]=202,de.setFloat32(W,R);let D;if(X<4||(D=R*uh[(J[W]&127)<<1|J[W+1]>>7])>>0===D){W+=4;return}else W--}J[W++]=203,de.setFloat64(W,R),W+=8}else if(b==="object"||b==="function")if(!R)J[W++]=192;else{if(s){let D=s.get(R);if(D){if(!D.id){let lt=s.idsToInsert||(s.idsToInsert=[]);D.id=lt.push(D)}J[W++]=214,J[W++]=112,de.setUint32(W,D.id),W+=4;return}else s.set(R,{offset:W-n})}let X=R.constructor;if(X===Object)P(R);else if(X===Array)v(R);else if(X===Map)if(this.mapAsEmptyObject)J[W++]=128;else{B=R.size,B<16?J[W++]=128|B:B<65536?(J[W++]=222,J[W++]=B>>8,J[W++]=B&255):(J[W++]=223,de.setUint32(W,B),W+=4);for(let[D,lt]of R)I(D),I(lt)}else{for(let D=0,lt=hh.length;D<lt;D++){let et=km[D];if(R instanceof et){let ft=hh[D];if(ft.write){ft.type&&(J[W++]=212,J[W++]=ft.type,J[W++]=0);let ct=ft.write.call(this,R);ct===R?Array.isArray(R)?v(R):P(R):I(ct);return}let K=J,z=de,bt=W;J=null;let ot;try{ot=ft.pack.call(this,R,ct=>(J=K,K=null,W+=ct,W>gn&&L(W),{target:J,targetView:de,position:W-ct}),I)}finally{K&&(J=K,de=z,W=bt,gn=J.length-10)}ot&&(ot.length+W>gn&&L(ot.length+W),W=MT(ot,J,W,ft.type));return}}if(Array.isArray(R))v(R);else{if(R.toJSON){const D=R.toJSON();if(D!==R)return I(D)}if(b==="function")return I(this.writeFunction&&this.writeFunction(R));P(R)}}}else if(b==="boolean")J[W++]=R?195:194;else if(b==="bigint"){if(R<BigInt(1)<<BigInt(63)&&R>=-(BigInt(1)<<BigInt(63)))J[W++]=211,de.setBigInt64(W,R);else if(R<BigInt(1)<<BigInt(64)&&R>0)J[W++]=207,de.setBigUint64(W,R);else if(this.largeBigIntToFloat)J[W++]=203,de.setFloat64(W,Number(R));else{if(this.largeBigIntToString)return I(R.toString());if(this.useBigIntExtension&&R<BigInt(2)**BigInt(1023)&&R>-(BigInt(2)**BigInt(1023))){J[W++]=199,W++,J[W++]=66;let X=[],D;do{let lt=R&BigInt(255);D=(lt&BigInt(128))===(R<BigInt(0)?BigInt(128):BigInt(0)),X.push(lt),R>>=BigInt(8)}while(!((R===BigInt(0)||R===BigInt(-1))&&D));J[W-2]=X.length;for(let lt=X.length;lt>0;)J[W++]=Number(X[--lt]);return}else throw new RangeError(R+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}W+=8}else if(b==="undefined")this.encodeUndefinedAsNil?J[W++]=192:(J[W++]=212,J[W++]=0,J[W++]=0);else throw new Error("Unknown type: "+b)},U=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?R=>{let b;if(this.skipValues){b=[];for(let D in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(D))&&!this.skipValues.includes(R[D])&&b.push(D)}else b=Object.keys(R);let B=b.length;B<16?J[W++]=128|B:B<65536?(J[W++]=222,J[W++]=B>>8,J[W++]=B&255):(J[W++]=223,de.setUint32(W,B),W+=4);let X;if(this.coercibleKeyAsNumber)for(let D=0;D<B;D++){X=b[D];let lt=Number(X);I(isNaN(lt)?X:lt),I(R[X])}else for(let D=0;D<B;D++)I(X=b[D]),I(R[X])}:R=>{J[W++]=222;let b=W-n;W+=2;let B=0;for(let X in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(X))&&(I(X),I(R[X]),B++);if(B>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');J[b+++n]=B>>8,J[b+n]=B&255},S=this.useRecords===!1?U:t.progressiveRecords&&!f?R=>{let b,B=i.transitions||(i.transitions=Object.create(null)),X=W++-n,D;for(let lt in R)if(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(lt)){if(b=B[lt],b)B=b;else{let et=Object.keys(R),ft=B;B=i.transitions;let K=0;for(let z=0,bt=et.length;z<bt;z++){let ot=et[z];b=B[ot],b||(b=B[ot]=Object.create(null),K++),B=b}X+n+1==W?(W--,V(B,et,K)):Z(B,et,X,K),D=!0,B=ft[lt]}I(R[lt])}if(!D){let lt=B[Xs];lt?J[X+n]=lt:Z(B,Object.keys(R),X,0)}}:R=>{let b,B=i.transitions||(i.transitions=Object.create(null)),X=0;for(let lt in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(lt))&&(b=B[lt],b||(b=B[lt]=Object.create(null),X++),B=b);let D=B[Xs];D?D>=96&&f?(J[W++]=((D-=96)&31)+96,J[W++]=D>>5):J[W++]=D:V(B,B.__keys__||Object.keys(R),X);for(let lt in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(lt))&&I(R[lt])},N=typeof this.useRecords=="function"&&this.useRecords,P=N?R=>{N(R)?S(R):U(R)}:S,L=R=>{let b;if(R>16777216){if(R-n>Am)throw new Error("Packed buffer would be larger than maximum buffer size");b=Math.min(Am,Math.round(Math.max((R-n)*(R>67108864?1.25:2),4194304)/4096)*4096)}else b=(Math.max(R-n<<2,J.length-1)>>12)+1<<12;let B=new xc(b);return de=B.dataView||(B.dataView=new DataView(B.buffer,0,b)),R=Math.min(R,J.length),J.copy?J.copy(B,0,n,R):B.set(J.slice(n,R)),W-=n,n=0,gn=B.length-10,J=B},V=(R,b,B)=>{let X=i.nextId;X||(X=64),X<d&&this.shouldShareStructure&&!this.shouldShareStructure(b)?(X=i.nextOwnId,X<p||(X=d),i.nextOwnId=X+1):(X>=p&&(X=d),i.nextId=X+1);let D=b.highByte=X>=96&&f?X-96>>5:-1;R[Xs]=X,R.__keys__=b,i[X-64]=b,X<d?(b.isShared=!0,i.sharedLength=X-63,r=!0,D>=0?(J[W++]=(X&31)+96,J[W++]=D):J[W++]=X):(D>=0?(J[W++]=213,J[W++]=114,J[W++]=(X&31)+96,J[W++]=D):(J[W++]=212,J[W++]=114,J[W++]=X),B&&(x+=w*B),m.length>=h&&(m.shift()[Xs]=0),m.push(R),I(b))},Z=(R,b,B,X)=>{let D=J,lt=W,et=gn,ft=n;J=Go,W=0,n=0,J||(Go=J=new xc(8192)),gn=J.length-10,V(R,b,X),Go=J;let K=W;if(J=D,W=lt,gn=et,n=ft,K>1){let z=W+K-1;z>gn&&L(z);let bt=B+n;J.copyWithin(bt+K,bt+1,W),J.set(Go.slice(0,K),bt),W=z}else J[B+n]=Go[0]},C=R=>{let b=NT(R,J,n,W,i,L,(B,X,D)=>{if(D)return r=!0;W=X;let lt=J;return I(B),T(),lt!==J?{position:W,targetView:de,target:J}:W},this);if(b===0)return P(R);W=b}}useBuffer(t){J=t,J.dataView||(J.dataView=new DataView(J.buffer,J.byteOffset,J.byteLength)),W=0}set position(t){W=t}get position(){return W}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}km=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,om],hh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?vm(e,16,t):Sm(wc?tn.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==Tm&&this.moreTypes?vm(e,wm.indexOf(n.name),t):Sm(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function vm(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Sm(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function MT(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function UT(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function Rm(e,t,n){if(Te.length>0){de.setUint32(Te.position+e,W+n-Te.position-e),Te.stringsPosition=W-e;let r=Te;Te=null,t(r[0]),t(r[1])}}function FT(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let Im=new LT({useRecords:!1});const BT=Im.pack;Im.pack;const PT=512,DT=1024,$T=2048;function Le(){return null}function qs(e,t,n={}){if(!k(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];k(c)&&(a=c(a));const u=t[o];k(u)&&(o=u),a!==null&&r.push(o,a)}return r}function Ho(e,t,n={}){if(k(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];k(a)&&(s=a);const c=n[s];k(c)&&(o=c(o)),r[s]=o}return r}catch(r){ue(Y,"","binary",r.message)}}function jT(e){try{const t=Xe(e);return BT(t)}catch(t){ue(Y,"","binary",t.message)}}function zT(e){try{return RT(e)}catch(t){ue(Y,"","binary",t.message)}}function Nm(){return{id:Ne()}}var kc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e))(kc||{});function Tc(e){return k(e==null?void 0:e.id)?qs(e,kc,{category:Le,kinddata:Le,stopped:Le,removed:Le,bucket:Le}):qs(e,kc,{id:Le,x:Le,y:Le,lx:Le,ly:Le,code:Le,category:Le,kinddata:Le,stopped:Le,removed:Le,bucket:Le})}function Ac(e){return Ho(e,kc)}function Yo(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function vc(e,t){if(!k(e)||!Pn(t))return;const{color:n,bg:r}=Z0(t);k(n)&&(e.color=n),k(r)&&(e.bg=r)}function Fr(e){var t;return Mt((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function Om(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function Cm(e){const t=Math.floor(e.length/uc);if(t*uc!==e.length)return;const n=Om(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function WT(e,t){return e&1<<t?255:0}function Lm(e){const t=Math.floor(e.length/eh);if(t*eh!==e.length)return;const n=Math.ceil(t/dc),r=hc*dc,i=Om(r,fc*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const u=o*fc+a,l=e[c];for(let h=0;h<hc;++h){const f=s*hc+h;i.bits[f+u*r]=WT(l,7-h)}++a,a===fc&&(a=0,++s,s===dc&&(s=0,++o))}return i}const KT=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,126,0,0,0,0,0,126,255,219,255,255,195,231,255,126,0,0,0,0,0,0,108,254,254,254,254,124,56,16,0,0,0,0,0,0,16,56,124,254,124,56,16,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,30,14,26,50,120,204,204,204,120,0,0,0,0,0,60,102,102,102,60,24,126,24,24,0,0,0,0,0,63,51,63,48,48,48,112,240,224,0,0,0,0,0,127,99,127,99,99,99,103,231,230,192,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,128,192,224,248,254,248,224,192,128,0,0,0,0,0,2,6,14,62,254,62,14,6,2,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,102,102,102,102,102,102,0,102,102,0,0,0,0,0,127,219,219,219,123,27,27,27,27,0,0,0,0,124,198,96,56,108,198,198,108,56,12,198,124,0,0,0,0,0,0,0,0,0,254,254,254,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,24,60,126,24,24,24,24,24,24,0,0,0,0,0,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,24,12,254,12,24,0,0,0,0,0,0,0,0,0,48,96,254,96,48,0,0,0,0,0,0,0,0,0,0,192,192,192,254,0,0,0,0,0,0,0,0,0,40,108,254,108,40,0,0,0,0,0,0,0,0,16,56,56,124,124,254,254,0,0,0,0,0,0,0,254,254,124,124,56,56,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,24,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,108,108,254,108,108,0,0,0,24,24,124,198,194,192,124,6,134,198,124,24,24,0,0,0,0,0,194,198,12,24,48,102,198,0,0,0,0,0,56,108,108,56,118,220,204,204,118,0,0,0,0,48,48,48,96,0,0,0,0,0,0,0,0,0,0,0,12,24,48,48,48,48,48,24,12,0,0,0,0,0,48,24,12,12,12,12,12,24,48,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,48,0,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,2,6,12,24,48,96,192,128,0,0,0,0,0,0,124,198,206,222,246,230,198,198,124,0,0,0,0,0,24,56,120,24,24,24,24,24,126,0,0,0,0,0,124,198,6,12,24,48,96,198,254,0,0,0,0,0,124,198,6,6,60,6,6,198,124,0,0,0,0,0,12,28,60,108,204,254,12,12,30,0,0,0,0,0,254,192,192,192,252,6,6,198,124,0,0,0,0,0,56,96,192,192,252,198,198,198,124,0,0,0,0,0,254,198,6,12,24,48,48,48,48,0,0,0,0,0,124,198,198,198,124,198,198,198,124,0,0,0,0,0,124,198,198,198,126,6,6,12,120,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,24,24,0,0,0,24,24,48,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,124,198,198,12,24,24,0,24,24,0,0,0,0,0,124,198,198,222,222,222,220,192,124,0,0,0,0,0,16,56,108,198,198,254,198,198,198,0,0,0,0,0,252,102,102,102,124,102,102,102,252,0,0,0,0,0,60,102,194,192,192,192,194,102,60,0,0,0,0,0,248,108,102,102,102,102,102,108,248,0,0,0,0,0,254,102,98,104,120,104,98,102,254,0,0,0,0,0,254,102,98,104,120,104,96,96,240,0,0,0,0,0,60,102,194,192,192,222,198,102,58,0,0,0,0,0,198,198,198,198,254,198,198,198,198,0,0,0,0,0,60,24,24,24,24,24,24,24,60,0,0,0,0,0,30,12,12,12,12,12,204,204,120,0,0,0,0,0,230,102,108,108,120,108,108,102,230,0,0,0,0,0,240,96,96,96,96,96,98,102,254,0,0,0,0,0,198,238,254,254,214,198,198,198,198,0,0,0,0,0,198,230,246,254,222,206,198,198,198,0,0,0,0,0,56,108,198,198,198,198,198,108,56,0,0,0,0,0,252,102,102,102,124,96,96,96,240,0,0,0,0,0,124,198,198,198,198,214,222,124,12,14,0,0,0,0,252,102,102,102,124,108,102,102,230,0,0,0,0,0,124,198,198,96,56,12,198,198,124,0,0,0,0,0,126,126,90,24,24,24,24,24,60,0,0,0,0,0,198,198,198,198,198,198,198,198,124,0,0,0,0,0,198,198,198,198,198,198,108,56,16,0,0,0,0,0,198,198,198,198,214,214,254,124,108,0,0,0,0,0,198,198,108,56,56,56,108,198,198,0,0,0,0,0,102,102,102,102,60,24,24,24,60,0,0,0,0,0,254,198,140,24,48,96,194,198,254,0,0,0,0,0,60,48,48,48,48,48,48,48,60,0,0,0,0,0,128,192,224,112,56,28,14,6,2,0,0,0,0,0,60,12,12,12,12,12,12,12,60,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,12,124,204,204,118,0,0,0,0,0,224,96,96,120,108,102,102,102,124,0,0,0,0,0,0,0,0,124,198,192,192,198,124,0,0,0,0,0,28,12,12,60,108,204,204,204,118,0,0,0,0,0,0,0,0,124,198,254,192,198,124,0,0,0,0,0,56,108,100,96,240,96,96,96,240,0,0,0,0,0,0,0,0,118,204,204,204,124,12,204,120,0,0,0,224,96,96,108,118,102,102,102,230,0,0,0,0,0,24,24,0,56,24,24,24,24,60,0,0,0,0,0,6,6,0,14,6,6,6,6,102,102,60,0,0,0,224,96,96,102,108,120,108,102,230,0,0,0,0,0,56,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,236,254,214,214,214,198,0,0,0,0,0,0,0,0,220,102,102,102,102,102,0,0,0,0,0,0,0,0,124,198,198,198,198,124,0,0,0,0,0,0,0,0,220,102,102,102,124,96,96,240,0,0,0,0,0,0,118,204,204,204,124,12,12,30,0,0,0,0,0,0,220,118,102,96,96,240,0,0,0,0,0,0,0,0,124,198,112,28,198,124,0,0,0,0,0,16,48,48,252,48,48,48,54,28,0,0,0,0,0,0,0,0,204,204,204,204,204,118,0,0,0,0,0,0,0,0,102,102,102,102,60,24,0,0,0,0,0,0,0,0,198,198,214,214,254,108,0,0,0,0,0,0,0,0,198,108,56,56,108,198,0,0,0,0,0,0,0,0,198,198,198,198,126,6,12,248,0,0,0,0,0,0,254,204,24,48,102,254,0,0,0,0,0,14,24,24,24,112,24,24,24,14,0,0,0,0,0,24,24,24,24,0,24,24,24,24,0,0,0,0,0,112,24,24,24,14,24,24,24,112,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,60,102,194,192,192,194,102,60,12,6,124,0,0,0,204,204,0,204,204,204,204,204,118,0,0,0,0,12,24,48,0,124,198,254,192,198,124,0,0,0,0,16,56,108,0,120,12,124,204,204,118,0,0,0,0,0,204,204,0,120,12,124,204,204,118,0,0,0,0,96,48,24,0,120,12,124,204,204,118,0,0,0,0,56,108,56,0,120,12,124,204,204,118,0,0,0,0,0,0,0,60,102,96,102,60,12,6,60,0,0,0,16,56,108,0,124,198,254,192,198,124,0,0,0,0,0,204,204,0,124,198,254,192,198,124,0,0,0,0,96,48,24,0,124,198,254,192,198,124,0,0,0,0,0,102,102,0,56,24,24,24,24,60,0,0,0,0,24,60,102,0,56,24,24,24,24,60,0,0,0,0,96,48,24,0,56,24,24,24,24,60,0,0,0,0,198,198,16,56,108,198,198,254,198,198,0,0,0,56,108,56,0,56,108,198,198,254,198,198,0,0,0,24,48,96,0,254,102,96,124,96,102,254,0,0,0,0,0,0,0,204,118,54,126,216,216,110,0,0,0,0,0,62,108,204,204,254,204,204,204,206,0,0,0,0,16,56,108,0,124,198,198,198,198,124,0,0,0,0,0,198,198,0,124,198,198,198,198,124,0,0,0,0,96,48,24,0,124,198,198,198,198,124,0,0,0,0,48,120,204,0,204,204,204,204,204,118,0,0,0,0,96,48,24,0,204,204,204,204,204,118,0,0,0,0,0,198,198,0,198,198,198,198,126,6,12,120,0,0,198,198,56,108,198,198,198,198,108,56,0,0,0,0,198,198,0,198,198,198,198,198,198,124,0,0,0,0,24,24,60,102,96,96,102,60,24,24,0,0,0,0,56,108,100,96,240,96,96,96,230,252,0,0,0,0,0,102,102,60,24,126,24,126,24,24,0,0,0,0,248,204,204,248,196,204,222,204,204,198,0,0,0,0,14,27,24,24,24,126,24,24,24,24,216,112,0,0,24,48,96,0,120,12,124,204,204,118,0,0,0,0,12,24,48,0,56,24,24,24,24,60,0,0,0,0,24,48,96,0,124,198,198,198,198,124,0,0,0,0,24,48,96,0,204,204,204,204,204,118,0,0,0,0,0,118,220,0,220,102,102,102,102,102,0,0,0,118,220,0,198,230,246,254,222,206,198,198,0,0,0,0,60,108,108,62,0,126,0,0,0,0,0,0,0,0,56,108,108,56,0,124,0,0,0,0,0,0,0,0,0,48,48,0,48,48,96,198,198,124,0,0,0,0,0,0,0,0,0,254,192,192,192,0,0,0,0,0,0,0,0,0,0,254,6,6,6,0,0,0,0,0,192,192,198,204,216,48,96,220,134,12,24,62,0,0,192,192,198,204,216,48,102,206,158,62,6,6,0,0,0,24,24,0,24,24,60,60,60,24,0,0,0,0,0,0,0,54,108,216,108,54,0,0,0,0,0,0,0,0,0,216,108,54,108,216,0,0,0,0,0,17,68,17,68,17,68,17,68,17,68,17,68,17,68,85,170,85,170,85,170,85,170,85,170,85,170,85,170,221,119,221,119,221,119,221,119,221,119,221,119,221,119,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,248,24,24,24,24,24,24,24,24,24,24,24,248,24,248,24,24,24,24,24,24,54,54,54,54,54,54,54,246,54,54,54,54,54,54,0,0,0,0,0,0,0,254,54,54,54,54,54,54,0,0,0,0,0,248,24,248,24,24,24,24,24,24,54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54,54,54,54,246,6,254,0,0,0,0,0,0,54,54,54,54,54,54,54,254,0,0,0,0,0,0,24,24,24,24,24,248,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,248,24,24,24,24,24,24,24,24,24,24,24,24,24,31,0,0,0,0,0,0,24,24,24,24,24,24,24,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,24,24,24,24,24,24,24,24,24,24,24,24,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,255,0,0,0,0,0,0,24,24,24,24,24,24,24,255,24,24,24,24,24,24,24,24,24,24,24,31,24,31,24,24,24,24,24,24,54,54,54,54,54,54,54,55,54,54,54,54,54,54,54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54,54,54,54,55,48,55,54,54,54,54,54,54,0,0,0,0,0,255,0,255,0,0,0,0,0,0,54,54,54,54,54,247,0,247,54,54,54,54,54,54,24,24,24,24,24,255,0,255,0,0,0,0,0,0,54,54,54,54,54,54,54,255,0,0,0,0,0,0,0,0,0,0,0,255,0,255,24,24,24,24,24,24,0,0,0,0,0,0,0,255,54,54,54,54,54,54,54,54,54,54,54,54,54,63,0,0,0,0,0,0,24,24,24,24,24,31,24,31,0,0,0,0,0,0,0,0,0,0,0,31,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,63,54,54,54,54,54,54,54,54,54,54,54,54,54,255,54,54,54,54,54,54,24,24,24,24,24,255,24,255,24,24,24,24,24,24,24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,31,24,24,24,24,24,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,118,220,216,216,220,118,0,0,0,0,0,0,0,124,198,252,198,198,252,192,192,64,0,0,0,254,198,198,192,192,192,192,192,192,0,0,0,0,0,0,0,254,108,108,108,108,108,108,0,0,0,0,0,254,198,96,48,24,48,96,198,254,0,0,0,0,0,0,0,0,126,216,216,216,216,112,0,0,0,0,0,0,0,102,102,102,102,124,96,96,192,0,0,0,0,0,0,118,220,24,24,24,24,24,0,0,0,0,0,126,24,60,102,102,102,60,24,126,0,0,0,0,0,56,108,198,198,254,198,198,108,56,0,0,0,0,0,56,108,198,198,198,108,108,108,238,0,0,0,0,0,30,48,24,12,62,102,102,102,60,0,0,0,0,0,0,0,0,126,219,219,126,0,0,0,0,0,0,0,3,6,126,219,219,243,126,96,192,0,0,0,0,0,28,48,96,96,124,96,96,48,28,0,0,0,0,0,0,124,198,198,198,198,198,198,198,0,0,0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,216,216,112,0,0,0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0,56,108,108,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,15,12,12,12,12,12,236,108,60,28,0,0,0,0,216,108,108,108,108,108,0,0,0,0,0,0,0,0,112,216,48,96,200,248,0,0,0,0,0,0,0,0,0,0,0,124,124,124,124,124,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),GT=new Uint8Array([0,0,0,0,0,42,0,42,0,0,42,42,42,0,0,42,0,42,42,21,0,42,42,42,21,21,21,21,21,63,21,63,21,21,63,63,63,21,21,63,21,63,63,63,21,63,63,63]);var Mm=typeof Cs=="object"&&Cs&&Cs.Object===Object&&Cs,HT=typeof self=="object"&&self&&self.Object===Object&&self,Br=Mm||HT||Function("return this")(),tr=Br.Symbol,Um=Object.prototype,YT=Um.hasOwnProperty,VT=Um.toString,Vo=tr?tr.toStringTag:void 0;function XT(e){var t=YT.call(e,Vo),n=e[Vo];try{e[Vo]=void 0;var r=!0}catch{}var i=VT.call(e);return r&&(t?e[Vo]=n:delete e[Vo]),i}var qT=Object.prototype,JT=qT.toString;function ZT(e){return JT.call(e)}var QT="[object Null]",tA="[object Undefined]",Fm=tr?tr.toStringTag:void 0;function Di(e){return e==null?e===void 0?tA:QT:Fm&&Fm in Object(e)?XT(e):ZT(e)}function dr(e){return e!=null&&typeof e=="object"}var eA="[object Symbol]";function Sc(e){return typeof e=="symbol"||dr(e)&&Di(e)==eA}function Rc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var te=Array.isArray,nA=1/0,Bm=tr?tr.prototype:void 0,Pm=Bm?Bm.toString:void 0;function Dm(e){if(typeof e=="string")return e;if(te(e))return Rc(e,Dm)+"";if(Sc(e))return Pm?Pm.call(e):"";var t=e+"";return t=="0"&&1/e==-nA?"-0":t}var rA=/\s/;function iA(e){for(var t=e.length;t--&&rA.test(e.charAt(t)););return t}var sA=/^\s+/;function oA(e){return e&&e.slice(0,iA(e)+1).replace(sA,"")}function er(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var $m=NaN,aA=/^[-+]0x[0-9a-f]+$/i,cA=/^0b[01]+$/i,lA=/^0o[0-7]+$/i,uA=parseInt;function hA(e){if(typeof e=="number")return e;if(Sc(e))return $m;if(er(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=er(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=oA(e);var n=cA.test(e);return n||lA.test(e)?uA(e.slice(2),n?2:8):aA.test(e)?$m:+e}var jm=1/0,fA=17976931348623157e292;function dA(e){if(!e)return e===0?e:0;if(e=hA(e),e===jm||e===-jm){var t=e<0?-1:1;return t*fA}return e===e?e:0}function Ic(e){var t=dA(e),n=t%1;return t===t?n?t-n:t:0}function Js(e){return e}var pA="[object AsyncFunction]",mA="[object Function]",gA="[object GeneratorFunction]",yA="[object Proxy]";function fi(e){if(!er(e))return!1;var t=Di(e);return t==mA||t==gA||t==pA||t==yA}var fh=Br["__core-js_shared__"],zm=function(){var e=/[^.]+$/.exec(fh&&fh.keys&&fh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function _A(e){return!!zm&&zm in e}var bA=Function.prototype,EA=bA.toString;function os(e){if(e!=null){try{return EA.call(e)}catch{}try{return e+""}catch{}}return""}var wA=/[\\^$.*+?()[\]{}|]/g,xA=/^\[object .+?Constructor\]$/,kA=Function.prototype,TA=Object.prototype,AA=kA.toString,vA=TA.hasOwnProperty,SA=RegExp("^"+AA.call(vA).replace(wA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function RA(e){if(!er(e)||_A(e))return!1;var t=fi(e)?SA:xA;return t.test(os(e))}function IA(e,t){return e==null?void 0:e[t]}function as(e,t){var n=IA(e,t);return RA(n)?n:void 0}var dh=as(Br,"WeakMap"),Wm=Object.create,NA=function(){function e(){}return function(t){if(!er(t))return{};if(Wm)return Wm(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function OA(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function We(){}function CA(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var LA=800,MA=16,UA=Date.now;function FA(e){var t=0,n=0;return function(){var r=UA(),i=MA-(r-n);if(n=r,i>0){if(++t>=LA)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function BA(e){return function(){return e}}var Nc=function(){try{var e=as(Object,"defineProperty");return e({},"",{}),e}catch{}}(),PA=Nc?function(e,t){return Nc(e,"toString",{configurable:!0,enumerable:!1,value:BA(t),writable:!0})}:Js,DA=FA(PA);function Km(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Gm(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function $A(e){return e!==e}function jA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function ph(e,t,n){return t===t?jA(e,t,n):Gm(e,$A,n)}function Hm(e,t){var n=e==null?0:e.length;return!!n&&ph(e,t,0)>-1}var zA=9007199254740991,WA=/^(?:0|[1-9]\d*)$/;function Oc(e,t){var n=typeof e;return t=t??zA,!!t&&(n=="number"||n!="symbol"&&WA.test(e))&&e>-1&&e%1==0&&e<t}function mh(e,t,n){t=="__proto__"&&Nc?Nc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Xo(e,t){return e===t||e!==e&&t!==t}var KA=Object.prototype,GA=KA.hasOwnProperty;function Cc(e,t,n){var r=e[t];(!(GA.call(e,t)&&Xo(r,n))||n===void 0&&!(t in e))&&mh(e,t,n)}function gh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?mh(n,a,c):Cc(n,a,c)}return n}var Ym=Math.max;function HA(e,t,n){return t=Ym(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=Ym(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),OA(e,this,a)}}function yh(e,t){return DA(HA(e,t,Js),e+"")}var YA=9007199254740991;function _h(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=YA}function Pr(e){return e!=null&&_h(e.length)&&!fi(e)}function Vm(e,t,n){if(!er(n))return!1;var r=typeof t;return(r=="number"?Pr(n)&&Oc(t,n.length):r=="string"&&t in n)?Xo(n[t],e):!1}function VA(e){return yh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&Vm(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var XA=Object.prototype;function qo(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||XA;return e===n}function qA(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var JA="[object Arguments]";function Xm(e){return dr(e)&&Di(e)==JA}var qm=Object.prototype,ZA=qm.hasOwnProperty,QA=qm.propertyIsEnumerable,Lc=Xm(function(){return arguments}())?Xm:function(e){return dr(e)&&ZA.call(e,"callee")&&!QA.call(e,"callee")};function tv(){return!1}var Jm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Zm=Jm&&typeof module=="object"&&module&&!module.nodeType&&module,ev=Zm&&Zm.exports===Jm,Qm=ev?Br.Buffer:void 0,nv=Qm?Qm.isBuffer:void 0,Jo=nv||tv,rv="[object Arguments]",iv="[object Array]",sv="[object Boolean]",ov="[object Date]",av="[object Error]",cv="[object Function]",lv="[object Map]",uv="[object Number]",hv="[object Object]",fv="[object RegExp]",dv="[object Set]",pv="[object String]",mv="[object WeakMap]",gv="[object ArrayBuffer]",yv="[object DataView]",_v="[object Float32Array]",bv="[object Float64Array]",Ev="[object Int8Array]",wv="[object Int16Array]",xv="[object Int32Array]",kv="[object Uint8Array]",Tv="[object Uint8ClampedArray]",Av="[object Uint16Array]",vv="[object Uint32Array]",_e={};_e[_v]=_e[bv]=_e[Ev]=_e[wv]=_e[xv]=_e[kv]=_e[Tv]=_e[Av]=_e[vv]=!0,_e[rv]=_e[iv]=_e[gv]=_e[sv]=_e[yv]=_e[ov]=_e[av]=_e[cv]=_e[lv]=_e[uv]=_e[hv]=_e[fv]=_e[dv]=_e[pv]=_e[mv]=!1;function Sv(e){return dr(e)&&_h(e.length)&&!!_e[Di(e)]}function Mc(e){return function(t){return e(t)}}var tg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Zo=tg&&typeof module=="object"&&module&&!module.nodeType&&module,Rv=Zo&&Zo.exports===tg,bh=Rv&&Mm.process,$i=function(){try{var e=Zo&&Zo.require&&Zo.require("util").types;return e||bh&&bh.binding&&bh.binding("util")}catch{}}(),eg=$i&&$i.isTypedArray,Eh=eg?Mc(eg):Sv,Iv=Object.prototype,Nv=Iv.hasOwnProperty;function ng(e,t){var n=te(e),r=!n&&Lc(e),i=!n&&!r&&Jo(e),s=!n&&!r&&!i&&Eh(e),o=n||r||i||s,a=o?qA(e.length,String):[],c=a.length;for(var u in e)(t||Nv.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Oc(u,c)))&&a.push(u);return a}function rg(e,t){return function(n){return e(t(n))}}var Ov=rg(Object.keys,Object),Cv=Object.prototype,Lv=Cv.hasOwnProperty;function ig(e){if(!qo(e))return Ov(e);var t=[];for(var n in Object(e))Lv.call(e,n)&&n!="constructor"&&t.push(n);return t}function nr(e){return Pr(e)?ng(e):ig(e)}var Mv=Object.prototype,Uv=Mv.hasOwnProperty,An=VA(function(e,t){if(qo(t)||Pr(t)){gh(t,nr(t),e);return}for(var n in t)Uv.call(t,n)&&Cc(e,n,t[n])});function Fv(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var Bv=Object.prototype,Pv=Bv.hasOwnProperty;function Dv(e){if(!er(e))return Fv(e);var t=qo(e),n=[];for(var r in e)r=="constructor"&&(t||!Pv.call(e,r))||n.push(r);return n}function sg(e){return Pr(e)?ng(e,!0):Dv(e)}var $v=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,jv=/^\w*$/;function wh(e,t){if(te(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Sc(e)?!0:jv.test(e)||!$v.test(e)||t!=null&&e in Object(t)}var Qo=as(Object,"create");function zv(){this.__data__=Qo?Qo(null):{},this.size=0}function Wv(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Kv="__lodash_hash_undefined__",Gv=Object.prototype,Hv=Gv.hasOwnProperty;function Yv(e){var t=this.__data__;if(Qo){var n=t[e];return n===Kv?void 0:n}return Hv.call(t,e)?t[e]:void 0}var Vv=Object.prototype,Xv=Vv.hasOwnProperty;function qv(e){var t=this.__data__;return Qo?t[e]!==void 0:Xv.call(t,e)}var Jv="__lodash_hash_undefined__";function Zv(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Qo&&t===void 0?Jv:t,this}function cs(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}cs.prototype.clear=zv,cs.prototype.delete=Wv,cs.prototype.get=Yv,cs.prototype.has=qv,cs.prototype.set=Zv;function Qv(){this.__data__=[],this.size=0}function Uc(e,t){for(var n=e.length;n--;)if(Xo(e[n][0],t))return n;return-1}var t2=Array.prototype,e2=t2.splice;function n2(e){var t=this.__data__,n=Uc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():e2.call(t,n,1),--this.size,!0}function r2(e){var t=this.__data__,n=Uc(t,e);return n<0?void 0:t[n][1]}function i2(e){return Uc(this.__data__,e)>-1}function s2(e,t){var n=this.__data__,r=Uc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function di(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}di.prototype.clear=Qv,di.prototype.delete=n2,di.prototype.get=r2,di.prototype.has=i2,di.prototype.set=s2;var ta=as(Br,"Map");function o2(){this.size=0,this.__data__={hash:new cs,map:new(ta||di),string:new cs}}function a2(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Fc(e,t){var n=e.__data__;return a2(t)?n[typeof t=="string"?"string":"hash"]:n.map}function c2(e){var t=Fc(this,e).delete(e);return this.size-=t?1:0,t}function l2(e){return Fc(this,e).get(e)}function u2(e){return Fc(this,e).has(e)}function h2(e,t){var n=Fc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function pi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}pi.prototype.clear=o2,pi.prototype.delete=c2,pi.prototype.get=l2,pi.prototype.has=u2,pi.prototype.set=h2;var f2="Expected a function";function xh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(f2);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(xh.Cache||pi),n}xh.Cache=pi;var d2=500;function p2(e){var t=xh(e,function(r){return n.size===d2&&n.clear(),r}),n=t.cache;return t}var m2=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,g2=/\\(\\)?/g,y2=p2(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(m2,function(n,r,i,s){t.push(i?s.replace(g2,"$1"):r||n)}),t});function og(e){return e==null?"":Dm(e)}function Bc(e,t){return te(e)?e:wh(e,t)?[e]:y2(og(e))}var _2=1/0;function ea(e){if(typeof e=="string"||Sc(e))return e;var t=e+"";return t=="0"&&1/e==-_2?"-0":t}function kh(e,t){t=Bc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ea(t[n++])];return n&&n==r?e:void 0}function b2(e,t,n){var r=e==null?void 0:kh(e,t);return r===void 0?n:r}function Th(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var ag=tr?tr.isConcatSpreadable:void 0;function E2(e){return te(e)||Lc(e)||!!(ag&&e&&e[ag])}function Ah(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=E2),i||(i=[]);++s<o;){var a=e[s];n(a)?Th(i,a):r||(i[i.length]=a)}return i}function Dn(e){var t=e==null?0:e.length;return t?Ah(e):[]}var cg=rg(Object.getPrototypeOf,Object);function vh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function w2(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:vh(e,t,n)}var x2="\\ud800-\\udfff",k2="\\u0300-\\u036f",T2="\\ufe20-\\ufe2f",A2="\\u20d0-\\u20ff",v2=k2+T2+A2,S2="\\ufe0e\\ufe0f",R2="\\u200d",I2=RegExp("["+R2+x2+v2+S2+"]");function lg(e){return I2.test(e)}function N2(e){return e.split("")}var ug="\\ud800-\\udfff",O2="\\u0300-\\u036f",C2="\\ufe20-\\ufe2f",L2="\\u20d0-\\u20ff",M2=O2+C2+L2,U2="\\ufe0e\\ufe0f",F2="["+ug+"]",Sh="["+M2+"]",Rh="\\ud83c[\\udffb-\\udfff]",B2="(?:"+Sh+"|"+Rh+")",hg="[^"+ug+"]",fg="(?:\\ud83c[\\udde6-\\uddff]){2}",dg="[\\ud800-\\udbff][\\udc00-\\udfff]",P2="\\u200d",pg=B2+"?",mg="["+U2+"]?",D2="(?:"+P2+"(?:"+[hg,fg,dg].join("|")+")"+mg+pg+")*",$2=mg+pg+D2,j2="(?:"+[hg+Sh+"?",Sh,fg,dg,F2].join("|")+")",z2=RegExp(Rh+"(?="+Rh+")|"+j2+$2,"g");function W2(e){return e.match(z2)||[]}function K2(e){return lg(e)?W2(e):N2(e)}function G2(e){return function(t){t=og(t);var n=lg(t)?K2(t):void 0,r=n?n[0]:t.charAt(0),i=n?w2(n,1).join(""):t.slice(1);return r[e]()+i}}var gg=G2("toUpperCase");function H2(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function Y2(){this.__data__=new di,this.size=0}function V2(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function X2(e){return this.__data__.get(e)}function q2(e){return this.__data__.has(e)}var J2=200;function Z2(e,t){var n=this.__data__;if(n instanceof di){var r=n.__data__;if(!ta||r.length<J2-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new pi(r)}return n.set(e,t),this.size=n.size,this}function Dr(e){var t=this.__data__=new di(e);this.size=t.size}Dr.prototype.clear=Y2,Dr.prototype.delete=V2,Dr.prototype.get=X2,Dr.prototype.has=q2,Dr.prototype.set=Z2;function Q2(e,t){return e&&gh(t,nr(t),e)}var yg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,_g=yg&&typeof module=="object"&&module&&!module.nodeType&&module,tS=_g&&_g.exports===yg,bg=tS?Br.Buffer:void 0,Eg=bg?bg.allocUnsafe:void 0;function eS(e,t){var n=e.length,r=Eg?Eg(n):new e.constructor(n);return e.copy(r),r}function Ih(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function wg(){return[]}var nS=Object.prototype,rS=nS.propertyIsEnumerable,xg=Object.getOwnPropertySymbols,Nh=xg?function(e){return e==null?[]:(e=Object(e),Ih(xg(e),function(t){return rS.call(e,t)}))}:wg;function iS(e,t){return gh(e,Nh(e),t)}var sS=Object.getOwnPropertySymbols,oS=sS?function(e){for(var t=[];e;)Th(t,Nh(e)),e=cg(e);return t}:wg;function kg(e,t,n){var r=t(e);return te(e)?r:Th(r,n(e))}function Oh(e){return kg(e,nr,Nh)}function aS(e){return kg(e,sg,oS)}var Ch=as(Br,"DataView"),Lh=as(Br,"Promise"),Zs=as(Br,"Set"),Tg="[object Map]",cS="[object Object]",Ag="[object Promise]",vg="[object Set]",Sg="[object WeakMap]",Rg="[object DataView]",lS=os(Ch),uS=os(ta),hS=os(Lh),fS=os(Zs),dS=os(dh),rr=Di;(Ch&&rr(new Ch(new ArrayBuffer(1)))!=Rg||ta&&rr(new ta)!=Tg||Lh&&rr(Lh.resolve())!=Ag||Zs&&rr(new Zs)!=vg||dh&&rr(new dh)!=Sg)&&(rr=function(e){var t=Di(e),n=t==cS?e.constructor:void 0,r=n?os(n):"";if(r)switch(r){case lS:return Rg;case uS:return Tg;case hS:return Ag;case fS:return vg;case dS:return Sg}return t});var pS=Object.prototype,mS=pS.hasOwnProperty;function gS(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&mS.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Pc=Br.Uint8Array;function yS(e){var t=new e.constructor(e.byteLength);return new Pc(t).set(new Pc(e)),t}function _S(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var bS=/\w*$/;function ES(e){var t=new e.constructor(e.source,bS.exec(e));return t.lastIndex=e.lastIndex,t}var Ig=tr?tr.prototype:void 0,Ng=Ig?Ig.valueOf:void 0;function wS(e){return Ng?Object(Ng.call(e)):{}}function xS(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var kS="[object Boolean]",TS="[object Date]",AS="[object Map]",vS="[object Number]",SS="[object RegExp]",RS="[object Set]",IS="[object String]",NS="[object Symbol]",OS="[object ArrayBuffer]",CS="[object DataView]",LS="[object Float32Array]",MS="[object Float64Array]",US="[object Int8Array]",FS="[object Int16Array]",BS="[object Int32Array]",PS="[object Uint8Array]",DS="[object Uint8ClampedArray]",$S="[object Uint16Array]",jS="[object Uint32Array]";function zS(e,t,n){var r=e.constructor;switch(t){case OS:return yS(e);case kS:case TS:return new r(+e);case CS:return _S(e);case LS:case MS:case US:case FS:case BS:case PS:case DS:case $S:case jS:return xS(e);case AS:return new r;case vS:case IS:return new r(e);case SS:return ES(e);case RS:return new r;case NS:return wS(e)}}function WS(e){return typeof e.constructor=="function"&&!qo(e)?NA(cg(e)):{}}var KS="[object Map]";function GS(e){return dr(e)&&rr(e)==KS}var Og=$i&&$i.isMap,HS=Og?Mc(Og):GS,YS="[object Set]";function VS(e){return dr(e)&&rr(e)==YS}var Cg=$i&&$i.isSet,XS=Cg?Mc(Cg):VS,Lg="[object Arguments]",qS="[object Array]",JS="[object Boolean]",ZS="[object Date]",QS="[object Error]",Mg="[object Function]",tR="[object GeneratorFunction]",eR="[object Map]",nR="[object Number]",Ug="[object Object]",rR="[object RegExp]",iR="[object Set]",sR="[object String]",oR="[object Symbol]",aR="[object WeakMap]",cR="[object ArrayBuffer]",lR="[object DataView]",uR="[object Float32Array]",hR="[object Float64Array]",fR="[object Int8Array]",dR="[object Int16Array]",pR="[object Int32Array]",mR="[object Uint8Array]",gR="[object Uint8ClampedArray]",yR="[object Uint16Array]",_R="[object Uint32Array]",pe={};pe[Lg]=pe[qS]=pe[cR]=pe[lR]=pe[JS]=pe[ZS]=pe[uR]=pe[hR]=pe[fR]=pe[dR]=pe[pR]=pe[eR]=pe[nR]=pe[Ug]=pe[rR]=pe[iR]=pe[sR]=pe[oR]=pe[mR]=pe[gR]=pe[yR]=pe[_R]=!0,pe[QS]=pe[Mg]=pe[aR]=!1;function Dc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!er(e))return e;var a=te(e);if(a)return o=gS(e),CA(e,o);var c=rr(e),u=c==Mg||c==tR;if(Jo(e))return eS(e);if(c==Ug||c==Lg||u&&!i)return o=u?{}:WS(e),iS(e,Q2(o,e));if(!pe[c])return i?e:{};o=zS(e,c),s||(s=new Dr);var l=s.get(e);if(l)return l;s.set(e,o),XS(e)?e.forEach(function(d){o.add(Dc(d,t,n,d,e,s))}):HS(e)&&e.forEach(function(d,p){o.set(p,Dc(d,t,n,p,e,s))});var h=Oh,f=a?void 0:h(e);return Km(f||e,function(d,p){f&&(p=d,d=e[p]),Cc(o,p,Dc(d,t,n,p,e,s))}),o}var bR=4;function rn(e){return Dc(e,bR)}function na(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var ER="__lodash_hash_undefined__";function wR(e){return this.__data__.set(e,ER),this}function xR(e){return this.__data__.has(e)}function Qs(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new pi;++t<n;)this.add(e[t])}Qs.prototype.add=Qs.prototype.push=wR,Qs.prototype.has=xR;function Fg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Mh(e,t){return e.has(t)}var kR=1,TR=2;function Bg(e,t,n,r,i,s){var o=n&kR,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var h=-1,f=!0,d=n&TR?new Qs:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],m=t[h];if(r)var x=o?r(m,p,h,t,e,s):r(p,m,h,e,t,s);if(x!==void 0){if(x)continue;f=!1;break}if(d){if(!Fg(t,function(w,T){if(!Mh(d,T)&&(p===w||i(p,w,n,r,s)))return d.push(T)})){f=!1;break}}else if(!(p===m||i(p,m,n,r,s))){f=!1;break}}return s.delete(e),s.delete(t),f}function AR(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Uh(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var vR=1,SR=2,RR="[object Boolean]",IR="[object Date]",NR="[object Error]",OR="[object Map]",CR="[object Number]",LR="[object RegExp]",MR="[object Set]",UR="[object String]",FR="[object Symbol]",BR="[object ArrayBuffer]",PR="[object DataView]",Pg=tr?tr.prototype:void 0,Fh=Pg?Pg.valueOf:void 0;function DR(e,t,n,r,i,s,o){switch(n){case PR:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case BR:return!(e.byteLength!=t.byteLength||!s(new Pc(e),new Pc(t)));case RR:case IR:case CR:return Xo(+e,+t);case NR:return e.name==t.name&&e.message==t.message;case LR:case UR:return e==t+"";case OR:var a=AR;case MR:var c=r&vR;if(a||(a=Uh),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=SR,o.set(e,t);var l=Bg(a(e),a(t),r,i,s,o);return o.delete(e),l;case FR:if(Fh)return Fh.call(e)==Fh.call(t)}return!1}var $R=1,jR=Object.prototype,zR=jR.hasOwnProperty;function WR(e,t,n,r,i,s){var o=n&$R,a=Oh(e),c=a.length,u=Oh(t),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var f=a[h];if(!(o?f in t:zR.call(t,f)))return!1}var d=s.get(e),p=s.get(t);if(d&&p)return d==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var x=o;++h<c;){f=a[h];var w=e[f],T=t[f];if(r)var v=o?r(T,w,f,t,e,s):r(w,T,f,e,t,s);if(!(v===void 0?w===T||i(w,T,n,r,s):v)){m=!1;break}x||(x=f=="constructor")}if(m&&!x){var I=e.constructor,U=t.constructor;I!=U&&"constructor"in e&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof U=="function"&&U instanceof U)&&(m=!1)}return s.delete(e),s.delete(t),m}var KR=1,Dg="[object Arguments]",$g="[object Array]",$c="[object Object]",GR=Object.prototype,jg=GR.hasOwnProperty;function HR(e,t,n,r,i,s){var o=te(e),a=te(t),c=o?$g:rr(e),u=a?$g:rr(t);c=c==Dg?$c:c,u=u==Dg?$c:u;var l=c==$c,h=u==$c,f=c==u;if(f&&Jo(e)){if(!Jo(t))return!1;o=!0,l=!1}if(f&&!l)return s||(s=new Dr),o||Eh(e)?Bg(e,t,n,r,i,s):DR(e,t,c,n,r,i,s);if(!(n&KR)){var d=l&&jg.call(e,"__wrapped__"),p=h&&jg.call(t,"__wrapped__");if(d||p){var m=d?e.value():e,x=p?t.value():t;return s||(s=new Dr),i(m,x,n,r,s)}}return f?(s||(s=new Dr),WR(e,t,n,r,i,s)):!1}function Bh(e,t,n,r,i){return e===t?!0:e==null||t==null||!dr(e)&&!dr(t)?e!==e&&t!==t:HR(e,t,n,r,Bh,i)}var YR=1,VR=2;function XR(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],u=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var l=new Dr,h;if(!(h===void 0?Bh(u,c,YR|VR,r,l):h))return!1}}return!0}function zg(e){return e===e&&!er(e)}function qR(e){for(var t=nr(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,zg(i)]}return t}function Wg(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function JR(e){var t=qR(e);return t.length==1&&t[0][2]?Wg(t[0][0],t[0][1]):function(n){return n===e||XR(n,e,t)}}function ZR(e,t){return e!=null&&t in Object(e)}function Kg(e,t,n){t=Bc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=ea(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&_h(i)&&Oc(o,i)&&(te(e)||Lc(e)))}function QR(e,t){return e!=null&&Kg(e,t,ZR)}var tI=1,eI=2;function nI(e,t){return wh(e)&&zg(t)?Wg(ea(e),t):function(n){var r=b2(n,e);return r===void 0&&r===t?QR(n,e):Bh(t,r,tI|eI)}}function rI(e){return function(t){return t==null?void 0:t[e]}}function iI(e){return function(t){return kh(t,e)}}function sI(e){return wh(e)?rI(ea(e)):iI(e)}function $r(e){return typeof e=="function"?e:e==null?Js:typeof e=="object"?te(e)?nI(e[0],e[1]):JR(e):sI(e)}function oI(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function aI(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var cI=aI();function lI(e,t){return e&&cI(e,t,nr)}function uI(e,t){return function(n,r){if(n==null)return n;if(!Pr(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var ls=uI(lI);function hI(e,t,n,r){return ls(e,function(i,s,o){t(r,i,n(i),o)}),r}function fI(e,t){return function(n,r){var i=te(n)?oI:hI,s=t?t():{};return i(n,e,$r(r),s)}}var Gg=Object.prototype,dI=Gg.hasOwnProperty,Ph=yh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Vm(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=sg(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||Xo(l,Gg[u])&&!dI.call(e,u))&&(e[u]=s[u])}return e});function Hg(e){return dr(e)&&Pr(e)}var pI=200;function mI(e,t,n,r){var i=-1,s=Hm,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;t.length>=pI&&(s=Mh,o=!1,t=new Qs(t));t:for(;++i<a;){var l=e[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=u;f--;)if(t[f]===h)continue t;c.push(l)}else s(t,h,r)||c.push(l)}return c}var jc=yh(function(e,t){return Hg(e)?mI(e,Ah(t,1,Hg,!0)):[]});function to(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function sn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Ic(t),vh(e,t<0?0:t,r)):[]}function ra(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Ic(t),t=r-t,vh(e,0,t<0?0:t)):[]}function gI(e){return typeof e=="function"?e:Js}function It(e,t){var n=te(e)?Km:ls;return n(e,gI(t))}function yI(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function _I(e,t){var n=!0;return ls(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function pr(e,t,n){var r=te(e)?yI:_I;return r(e,$r(t))}function Yg(e,t){var n=[];return ls(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function ir(e,t){var n=te(e)?Ih:Yg;return n(e,$r(t))}function bI(e){return function(t,n,r){var i=Object(t);if(!Pr(t)){var s=$r(n);t=nr(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var EI=Math.max;function wI(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Ic(n);return i<0&&(i=EI(r+i,0)),Gm(e,$r(t),i)}var eo=bI(wI);function mr(e){return e&&e.length?e[0]:void 0}function xI(e,t){var n=-1,r=Pr(e)?Array(e.length):[];return ls(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function xt(e,t){var n=te(e)?Rc:xI;return n(e,$r(t))}function sr(e,t){return Ah(xt(e,t))}var kI=Object.prototype,TI=kI.hasOwnProperty,Vg=fI(function(e,t,n){TI.call(e,n)?e[n].push(t):mh(e,n,[t])}),AI=Object.prototype,vI=AI.hasOwnProperty;function SI(e,t){return e!=null&&vI.call(e,t)}function Rt(e,t){return e!=null&&Kg(e,t,SI)}var RI="[object String]";function vn(e){return typeof e=="string"||!te(e)&&dr(e)&&Di(e)==RI}function II(e,t){return Rc(t,function(n){return e[n]})}function Fe(e){return e==null?[]:II(e,nr(e))}var NI=Math.max;function yn(e,t,n,r){e=Pr(e)?e:Fe(e),n=n&&!r?Ic(n):0;var i=e.length;return n<0&&(n=NI(i+n,0)),vn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&ph(e,t,n)>-1}function Xg(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return ph(e,t,i)}var OI="[object Map]",CI="[object Set]",LI=Object.prototype,MI=LI.hasOwnProperty;function me(e){if(e==null)return!0;if(Pr(e)&&(te(e)||typeof e=="string"||typeof e.splice=="function"||Jo(e)||Eh(e)||Lc(e)))return!e.length;var t=rr(e);if(t==OI||t==CI)return!e.size;if(qo(e))return!ig(e).length;for(var n in e)if(MI.call(e,n))return!1;return!0}var UI="[object RegExp]";function FI(e){return dr(e)&&Di(e)==UI}var qg=$i&&$i.isRegExp,mi=qg?Mc(qg):FI;function gi(e){return e===void 0}var BI="Expected a function";function PI(e){if(typeof e!="function")throw new TypeError(BI);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function DI(e,t,n,r){if(!er(e))return e;t=Bc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=ea(t[i]),u=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=er(l)?l:Oc(t[i+1])?[]:{})}Cc(a,c,u),a=a[c]}return e}function $I(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=kh(e,o);n(a,o)&&DI(s,Bc(o,e),a)}return s}function gr(e,t){if(e==null)return{};var n=Rc(aS(e),function(r){return[r]});return t=$r(t),$I(e,n,function(r,i){return t(r,i[0])})}function jI(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Sn(e,t,n){var r=te(e)?H2:jI,i=arguments.length<3;return r(e,$r(t),n,i,ls)}function zc(e,t){var n=te(e)?Ih:Yg;return n(e,PI($r(t)))}function zI(e,t){var n;return ls(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function Dh(e,t,n){var r=te(e)?Fg:zI;return r(e,$r(t))}var WI=1/0,KI=Zs&&1/Uh(new Zs([,-0]))[1]==WI?function(e){return new Zs(e)}:We,GI=200;function HI(e,t,n){var r=-1,i=Hm,s=e.length,o=!0,a=[],c=a;if(s>=GI){var u=KI(e);if(u)return Uh(u);o=!1,i=Mh,c=new Qs}else c=a;t:for(;++r<s;){var l=e[r],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=c.length;f--;)if(c[f]===h)continue t;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}function Wc(e){return e&&e.length?HI(e):[]}function $h(e){console&&console.error&&console.error(`Error: ${e}`)}function Jg(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function Zg(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function Qg(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function YI(e){return VI(e)?e.LABEL:e.name}function VI(e){return vn(e.LABEL)&&e.LABEL!==""}class jr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),It(this.definition,n=>{n.accept(t)})}}class Rn extends jr{constructor(t){super([]),this.idx=1,An(this,gr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class no extends jr{constructor(t){super(t.definition),this.orgText="",An(this,gr(t,n=>n!==void 0))}}class In extends jr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,An(this,gr(t,n=>n!==void 0))}}class Nn extends jr{constructor(t){super(t.definition),this.idx=1,An(this,gr(t,n=>n!==void 0))}}class zr extends jr{constructor(t){super(t.definition),this.idx=1,An(this,gr(t,n=>n!==void 0))}}class Wr extends jr{constructor(t){super(t.definition),this.idx=1,An(this,gr(t,n=>n!==void 0))}}class Ke extends jr{constructor(t){super(t.definition),this.idx=1,An(this,gr(t,n=>n!==void 0))}}class yr extends jr{constructor(t){super(t.definition),this.idx=1,An(this,gr(t,n=>n!==void 0))}}class _r extends jr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,An(this,gr(t,n=>n!==void 0))}}class Ae{constructor(t){this.idx=1,An(this,gr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function XI(e){return xt(e,Kc)}function Kc(e){function t(n){return xt(n,Kc)}if(e instanceof Rn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return vn(e.label)&&(n.label=e.label),n}else{if(e instanceof In)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Nn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof zr)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Wr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Kc(new Ae({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof yr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Kc(new Ae({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Ke)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof _r)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Ae){const n={type:"Terminal",name:e.terminalType.name,label:YI(e.terminalType),idx:e.idx};vn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=mi(r)?r.source:r),n}else{if(e instanceof no)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class us{visit(t){const n=t;switch(n.constructor){case Rn:return this.visitNonTerminal(n);case In:return this.visitAlternative(n);case Nn:return this.visitOption(n);case zr:return this.visitRepetitionMandatory(n);case Wr:return this.visitRepetitionMandatoryWithSeparator(n);case yr:return this.visitRepetitionWithSeparator(n);case Ke:return this.visitRepetition(n);case _r:return this.visitAlternation(n);case Ae:return this.visitTerminal(n);case no:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function qI(e){return e instanceof In||e instanceof Nn||e instanceof Ke||e instanceof zr||e instanceof Wr||e instanceof yr||e instanceof Ae||e instanceof no}function Gc(e,t=[]){return e instanceof Nn||e instanceof Ke||e instanceof yr?!0:e instanceof _r?Dh(e.definition,r=>Gc(r,t)):e instanceof Rn&&yn(t,e)?!1:e instanceof jr?(e instanceof Rn&&t.push(e),pr(e.definition,r=>Gc(r,t))):!1}function JI(e){return e instanceof _r}function Kr(e){if(e instanceof Rn)return"SUBRULE";if(e instanceof Nn)return"OPTION";if(e instanceof _r)return"OR";if(e instanceof zr)return"AT_LEAST_ONE";if(e instanceof Wr)return"AT_LEAST_ONE_SEP";if(e instanceof yr)return"MANY_SEP";if(e instanceof Ke)return"MANY";if(e instanceof Ae)return"CONSUME";throw Error("non exhaustive match")}class Hc{walk(t,n=[]){It(t.definition,(r,i)=>{const s=sn(t.definition,i+1);if(r instanceof Rn)this.walkProdRef(r,s,n);else if(r instanceof Ae)this.walkTerminal(r,s,n);else if(r instanceof In)this.walkFlat(r,s,n);else if(r instanceof Nn)this.walkOption(r,s,n);else if(r instanceof zr)this.walkAtLeastOne(r,s,n);else if(r instanceof Wr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof yr)this.walkManySep(r,s,n);else if(r instanceof Ke)this.walkMany(r,s,n);else if(r instanceof _r)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Nn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=ty(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Nn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=ty(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);It(t.definition,s=>{const o=new In({definition:[s]});this.walk(o,i)})}}function ty(e,t,n){return[new Nn({definition:[new Ae({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function ia(e){if(e instanceof Rn)return ia(e.referencedRule);if(e instanceof Ae)return tN(e);if(qI(e))return ZI(e);if(JI(e))return QI(e);throw Error("non exhaustive match")}function ZI(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Gc(s),t=t.concat(ia(s)),r=r+1,i=n.length>r;return Wc(t)}function QI(e){const t=xt(e.definition,n=>ia(n));return Wc(Dn(t))}function tN(e){return[e.terminalType]}const ey="_~IN~_";class eN extends Hc{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=rN(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new In({definition:s}),a=ia(o);this.follows[i]=a}}function nN(e){const t={};return It(e,n=>{const r=new eN(n).startWalking();An(t,r)}),t}function rN(e,t){return e.name+t+ey}function Nt(e){return e.charCodeAt(0)}function jh(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function sa(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function ro(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function iN(){throw Error("Internal Error - Should never get here!")}function ny(e){return e.type==="Character"}const Yc=[];for(let e=Nt("0");e<=Nt("9");e++)Yc.push(e);const Vc=[Nt("_")].concat(Yc);for(let e=Nt("a");e<=Nt("z");e++)Vc.push(e);for(let e=Nt("A");e<=Nt("Z");e++)Vc.push(e);const ry=[Nt(" "),Nt("\f"),Nt(`
`),Nt("\r"),Nt("	"),Nt("\v"),Nt("	"),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt("\u2028"),Nt("\u2029"),Nt(""),Nt(""),Nt(""),Nt("\uFEFF")],sN=/[0-9a-fA-F]/,Xc=/[0-9]/,oN=/[1-9]/;class aN{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":sa(r,"global");break;case"i":sa(r,"ignoreCase");break;case"m":sa(r,"multiLine");break;case"u":sa(r,"unicode");break;case"y":sa(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}ro(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return iN()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;ro(n);break}if(!(t===!0&&n===void 0)&&ro(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),ro(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Nt(`
`),Nt("\r"),Nt("\u2028"),Nt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Yc;break;case"D":t=Yc,n=!0;break;case"s":t=ry;break;case"S":t=ry,n=!0;break;case"w":t=Vc;break;case"W":t=Vc,n=!0;break}if(ro(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Nt("\f");break;case"n":t=Nt(`
`);break;case"r":t=Nt("\r");break;case"t":t=Nt("	");break;case"v":t=Nt("\v");break}if(ro(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Nt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Nt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Nt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,ny(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,ny(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else jh(r.value,t),t.push(Nt("-")),jh(i.value,t)}else jh(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Nt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(oN.test(t)===!1)throw Error("Expecting a positive integer");for(;Xc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Xc.test(t)===!1)throw Error("Expecting an integer");for(;Xc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Nt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Xc.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(sN.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class zh{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let qc={};const cN=new aN;function Jc(e){const t=e.toString();if(qc.hasOwnProperty(t))return qc[t];{const n=cN.pattern(t);return qc[t]=n,n}}function lN(){qc={}}const iy="Complement Sets are not supported for first char optimization",Zc=`Unable to use "first char" lexer optimizations:
`;function uN(e,t=!1){try{const n=Jc(e);return Wh(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===iy)t&&Jg(`${Zc}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),$h(`${Zc}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Wh(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Wh(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Qc(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(iy);It(o.value,c=>{if(typeof c=="number")Qc(c,t,n);else{const u=c;if(n===!0)for(let l=u.from;l<=u.to;l++)Qc(l,t,n);else{for(let l=u.from;l<=u.to&&l<aa;l++)Qc(l,t,n);if(u.to>=aa){const l=u.from>=aa?u.from:aa,h=u.to,f=ji(l),d=ji(h);for(let p=f;p<=d;p++)t[p]=p}}}});break;case"Group":Wh(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Kh(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Fe(t)}function Qc(e,t,n){const r=ji(e);t[r]=r,n===!0&&hN(e,t)}function hN(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=ji(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=ji(i.charCodeAt(0));t[s]=s}}}function sy(e,t){return eo(e.value,n=>{if(typeof n=="number")return yn(t,n);{const r=n;return eo(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function Kh(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?te(e.value)?pr(e.value,Kh):Kh(e.value):!1}class fN extends zh{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){yn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?sy(t,this.targetCharCodes)===void 0&&(this.found=!0):sy(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Gh(e,t){if(t instanceof RegExp){const n=Jc(t),r=new fN(e);return r.visit(n),r.found}else return eo(t,n=>yn(e,n.charCodeAt(0)))!==void 0}const hs="PATTERN",oa="defaultMode",tl="modes";let oy=typeof new RegExp("(?:)").sticky=="boolean";function dN(e,t){t=Ph(t,{useSticky:oy,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(T,v)=>v()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{FN()});let r;n("Reject Lexer.NA",()=>{r=zc(e,T=>T[hs]===Ge.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=xt(r,T=>{const v=T[hs];if(mi(v)){const I=v.source;return I.length===1&&I!=="^"&&I!=="$"&&I!=="."&&!v.ignoreCase?I:I.length===2&&I[0]==="\\"&&!yn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],I[1])?I[1]:t.useSticky?cy(v):ay(v)}else{if(fi(v))return i=!0,{exec:v};if(typeof v=="object")return i=!0,v;if(typeof v=="string"){if(v.length===1)return v;{const I=v.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),U=new RegExp(I);return t.useSticky?cy(U):ay(U)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;n("misc mapping",()=>{o=xt(r,T=>T.tokenTypeIdx),a=xt(r,T=>{const v=T.GROUP;if(v!==Ge.SKIPPED){if(vn(v))return v;if(gi(v))return!1;throw Error("non exhaustive match")}}),c=xt(r,T=>{const v=T.LONGER_ALT;if(v)return te(v)?xt(v,U=>Xg(r,U)):[Xg(r,v)]}),u=xt(r,T=>T.PUSH_MODE),l=xt(r,T=>Rt(T,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const T=hy(t.lineTerminatorCharacters);h=xt(r,v=>!1),t.positionTracking!=="onlyOffset"&&(h=xt(r,v=>Rt(v,"LINE_BREAKS")?!!v.LINE_BREAKS:uy(v,T)===!1&&Gh(T,v.PATTERN)))});let f,d,p,m;n("Misc Mapping #2",()=>{f=xt(r,ly),d=xt(s,LN),p=Sn(r,(T,v)=>{const I=v.GROUP;return vn(I)&&I!==Ge.SKIPPED&&(T[I]=[]),T},{}),m=xt(s,(T,v)=>({pattern:s[v],longerAlt:c[v],canLineTerminator:h[v],isCustom:f[v],short:d[v],group:a[v],push:u[v],pop:l[v],tokenTypeIdx:o[v],tokenType:r[v]}))});let x=!0,w=[];return t.safeMode||n("First Char Optimization",()=>{w=Sn(r,(T,v,I)=>{if(typeof v.PATTERN=="string"){const U=v.PATTERN.charCodeAt(0),S=ji(U);Hh(T,S,m[I])}else if(te(v.START_CHARS_HINT)){let U;It(v.START_CHARS_HINT,S=>{const N=typeof S=="string"?S.charCodeAt(0):S,P=ji(N);U!==P&&(U=P,Hh(T,P,m[I]))})}else if(mi(v.PATTERN))if(v.PATTERN.unicode)x=!1,t.ensureOptimizations&&$h(`${Zc}	Unable to analyze < ${v.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const U=uN(v.PATTERN,t.ensureOptimizations);me(U)&&(x=!1),It(U,S=>{Hh(T,S,m[I])})}else t.ensureOptimizations&&$h(`${Zc}	TokenType: <${v.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),x=!1;return T},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:w,hasCustom:i,canBeOptimized:x}}function pN(e,t){let n=[];const r=gN(e);n=n.concat(r.errors);const i=yN(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(mN(s)),n=n.concat(AN(s)),n=n.concat(vN(s,t)),n=n.concat(SN(s)),n}function mN(e){let t=[];const n=ir(e,r=>mi(r[hs]));return t=t.concat(bN(n)),t=t.concat(xN(n)),t=t.concat(kN(n)),t=t.concat(TN(n)),t=t.concat(EN(n)),t}function gN(e){const t=ir(e,i=>!Rt(i,hs)),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Se.MISSING_PATTERN,tokenTypes:[i]})),r=jc(e,t);return{errors:n,valid:r}}function yN(e){const t=ir(e,i=>{const s=i[hs];return!mi(s)&&!fi(s)&&!Rt(s,"exec")&&!vn(s)}),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Se.INVALID_PATTERN,tokenTypes:[i]})),r=jc(e,t);return{errors:n,valid:r}}const _N=/[^\\][$]/;function bN(e){class t extends zh{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=ir(e,i=>{const s=i.PATTERN;try{const o=Jc(s),a=new t;return a.visit(o),a.found}catch{return _N.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Se.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function EN(e){const t=ir(e,r=>r.PATTERN.test(""));return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Se.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const wN=/[^\\[][\^]|^\^/;function xN(e){class t extends zh{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=ir(e,i=>{const s=i.PATTERN;try{const o=Jc(s),a=new t;return a.visit(o),a.found}catch{return wN.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Se.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function kN(e){const t=ir(e,r=>{const i=r[hs];return i instanceof RegExp&&(i.multiline||i.global)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Se.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function TN(e){const t=[];let n=xt(e,s=>Sn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!yn(t,a)&&a.PATTERN!==Ge.NA&&(t.push(a),o.push(a)),o),[]));n=na(n);const r=ir(n,s=>s.length>1);return xt(r,s=>{const o=xt(s,c=>c.name);return{message:`The same RegExp pattern ->${mr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Se.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function AN(e){const t=ir(e,r=>{if(!Rt(r,"GROUP"))return!1;const i=r.GROUP;return i!==Ge.SKIPPED&&i!==Ge.NA&&!vn(i)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Se.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function vN(e,t){const n=ir(e,i=>i.PUSH_MODE!==void 0&&!yn(t,i.PUSH_MODE));return xt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Se.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function SN(e){const t=[],n=Sn(e,(r,i,s)=>{const o=i.PATTERN;return o===Ge.NA||(vn(o)?r.push({str:o,idx:s,tokenType:i}):mi(o)&&IN(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return It(e,(r,i)=>{It(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&RN(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Se.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function RN(e,t){if(mi(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(fi(t))return t(e,0,[],{});if(Rt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function IN(e){return eo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function ay(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function cy(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function NN(e,t,n){const r=[];return Rt(e,oa)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+oa+`> property in its definition
`,type:Se.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Rt(e,tl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+tl+`> property in its definition
`,type:Se.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Rt(e,tl)&&Rt(e,oa)&&!Rt(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${oa}: <${e.defaultMode}>which does not exist
`,type:Se.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Rt(e,tl)&&It(e.modes,(i,s)=>{It(i,(o,a)=>{if(gi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Se.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Rt(o,"LONGER_ALT")){const c=te(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];It(c,u=>{!gi(u)&&!yn(i,u)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:Se.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function ON(e,t,n){const r=[];let i=!1;const s=na(Dn(Fe(e.modes))),o=zc(s,c=>c[hs]===Ge.NA),a=hy(n);return t&&It(o,c=>{const u=uy(c,a);if(u!==!1){const h={message:UN(c,u),type:u.issue,tokenType:c};r.push(h)}else Rt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Gh(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Se.NO_LINE_BREAKS_FLAGS}),r}function CN(e){const t={},n=nr(e);return It(n,r=>{const i=e[r];if(te(i))t[r]=[];else throw Error("non exhaustive match")}),t}function ly(e){const t=e.PATTERN;if(mi(t))return!1;if(fi(t))return!0;if(Rt(t,"exec"))return!0;if(vn(t))return!1;throw Error("non exhaustive match")}function LN(e){return vn(e)&&e.length===1?e.charCodeAt(0):!1}const MN={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function uy(e,t){if(Rt(e,"LINE_BREAKS"))return!1;if(mi(e.PATTERN)){try{Gh(t,e.PATTERN)}catch(n){return{issue:Se.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(vn(e.PATTERN))return!1;if(ly(e))return{issue:Se.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function UN(e,t){if(t.issue===Se.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Se.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function hy(e){return xt(e,n=>vn(n)?n.charCodeAt(0):n)}function Hh(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const aa=256;let el=[];function ji(e){return e<aa?e:el[e]}function FN(){if(me(el)){el=new Array(65536);for(let e=0;e<65536;e++)el[e]=e>255?255+~~(e/255):e}}function ca(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function nl(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let fy=1;const dy={};function la(e){const t=BN(e);PN(t),$N(t),DN(t),It(t,n=>{n.isParent=n.categoryMatches.length>0})}function BN(e){let t=rn(e),n=e,r=!0;for(;r;){n=na(Dn(xt(n,s=>s.CATEGORIES)));const i=jc(n,t);t=t.concat(i),me(i)?r=!1:n=i}return t}function PN(e){It(e,t=>{my(t)||(dy[fy]=t,t.tokenTypeIdx=fy++),gy(t)&&!te(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),gy(t)||(t.CATEGORIES=[]),jN(t)||(t.categoryMatches=[]),zN(t)||(t.categoryMatchesMap={})})}function DN(e){It(e,t=>{t.categoryMatches=[],It(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(dy[r].tokenTypeIdx)})})}function $N(e){It(e,t=>{py([],t)})}function py(e,t){It(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),It(t.CATEGORIES,n=>{const r=e.concat(t);yn(r,n)||py(r,n)})}function my(e){return Rt(e,"tokenTypeIdx")}function gy(e){return Rt(e,"CATEGORIES")}function jN(e){return Rt(e,"categoryMatches")}function zN(e){return Rt(e,"categoryMatchesMap")}function WN(e){return Rt(e,"tokenTypeIdx")}const KN={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Se;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Se||(Se={}));const ua={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:KN,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(ua);let Ge=class{constructor(t,n=ua){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Zg(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=An({},ua,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===ua.lineTerminatorsPattern)this.config.lineTerminatorsPattern=MN;else if(this.config.lineTerminatorCharacters===ua.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),te(t)?i={modes:{defaultMode:rn(t)},defaultMode:oa}:(s=!1,i=rn(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(NN(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(ON(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},It(i.modes,(a,c)=>{i.modes[c]=zc(a,u=>gi(u))});const o=nr(i.modes);if(It(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(pN(a,o))}),me(this.lexerDefinitionErrors)){la(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=dN(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=An({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!me(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=xt(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}It(this.lexerDefinitionWarning,a=>{Jg(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(oy?(this.chopInput=Js,this.match=this.matchWithTest):(this.updateLastIndex=We,this.match=this.matchWithExec),s&&(this.handleModes=We),this.trackStartLines===!1&&(this.computeNewColumn=Js),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=We),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Sn(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(n.ensureOptimizations&&!me(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{lN()}),this.TRACE_INIT("toFastProperties",()=>{Qg(this)})})}tokenize(t,n=this.defaultMode){if(!me(this.lexerDefinitionErrors)){const i=xt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,u,l,h,f,d,p,m,x,w;const T=t,v=T.length;let I=0,U=0;const S=this.hasCustom?0:Math.floor(t.length/10),N=new Array(S),P=[];let L=this.trackStartLines?1:void 0,V=this.trackStartLines?1:void 0;const Z=CN(this.emptyGroups),C=this.trackStartLines,R=this.config.lineTerminatorsPattern;let b=0,B=[],X=[];const D=[],lt=[];Object.freeze(lt);let et;function ft(){return B}function K(Lt){const ne=ji(Lt),At=X[ne];return At===void 0?lt:At}const z=Lt=>{if(D.length===1&&Lt.tokenType.PUSH_MODE===void 0){const ne=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Lt);P.push({offset:Lt.startOffset,line:Lt.startLine,column:Lt.startColumn,length:Lt.image.length,message:ne})}else{D.pop();const ne=to(D);B=this.patternIdxToConfig[ne],X=this.charCodeToPatternIdxToConfig[ne],b=B.length;const At=this.canModeBeOptimized[ne]&&this.config.safeMode===!1;X&&At?et=K:et=ft}};function bt(Lt){D.push(Lt),X=this.charCodeToPatternIdxToConfig[Lt],B=this.patternIdxToConfig[Lt],b=B.length,b=B.length;const ne=this.canModeBeOptimized[Lt]&&this.config.safeMode===!1;X&&ne?et=K:et=ft}bt.call(this,n);let ot;const ct=this.config.recoveryEnabled;for(;I<v;){c=null;const Lt=T.charCodeAt(I),ne=et(Lt),At=ne.length;for(r=0;r<At;r++){ot=ne[r];const kt=ot.pattern;u=null;const zt=ot.short;if(zt!==!1?Lt===zt&&(c=kt):ot.isCustom===!0?(w=kt.exec(T,I,N,Z),w!==null?(c=w[0],w.payload!==void 0&&(u=w.payload)):c=null):(this.updateLastIndex(kt,I),c=this.match(kt,t,I)),c!==null){if(a=ot.longerAlt,a!==void 0){const Ht=a.length;for(s=0;s<Ht;s++){const Ee=B[a[s]],Ie=Ee.pattern;if(l=null,Ee.isCustom===!0?(w=Ie.exec(T,I,N,Z),w!==null?(o=w[0],w.payload!==void 0&&(l=w.payload)):o=null):(this.updateLastIndex(Ie,I),o=this.match(Ie,t,I)),o&&o.length>c.length){c=o,u=l,ot=Ee;break}}}break}}if(c!==null){if(h=c.length,f=ot.group,f!==void 0&&(d=ot.tokenTypeIdx,p=this.createTokenInstance(c,I,d,ot.tokenType,L,V,h),this.handlePayload(p,u),f===!1?U=this.addToken(N,U,p):Z[f].push(p)),t=this.chopInput(t,h),I=I+h,V=this.computeNewColumn(V,h),C===!0&&ot.canLineTerminator===!0){let kt=0,zt,Ht;R.lastIndex=0;do zt=R.test(c),zt===!0&&(Ht=R.lastIndex-1,kt++);while(zt===!0);kt!==0&&(L=L+kt,V=h-Ht,this.updateTokenEndLineColumnLocation(p,f,Ht,kt,L,V,h))}this.handleModes(ot,z,bt,p)}else{const kt=I,zt=L,Ht=V;let Ee=ct===!1;for(;Ee===!1&&I<v;)for(t=this.chopInput(t,1),I++,i=0;i<b;i++){const Ie=B[i],E=Ie.pattern,st=Ie.short;if(st!==!1?T.charCodeAt(I)===st&&(Ee=!0):Ie.isCustom===!0?Ee=E.exec(T,I,N,Z)!==null:(this.updateLastIndex(E,I),Ee=E.exec(t)!==null),Ee===!0)break}if(m=I-kt,V=this.computeNewColumn(V,m),x=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(T,kt,m,zt,Ht),P.push({offset:kt,line:zt,column:Ht,length:m,message:x}),ct===!1)break}}return this.hasCustom||(N.length=U),{tokens:N,groups:Z,errors:P}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,u;n!==void 0&&(c=r===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1+-u))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};Ge.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Ge.NA=/NOT_APPLICABLE/;function ha(e){return yy(e)?e.LABEL:e.name}function yy(e){return vn(e.LABEL)&&e.LABEL!==""}const GN="parent",_y="categories",by="label",Ey="group",wy="push_mode",xy="pop_mode",ky="longer_alt",Ty="line_breaks",Ay="start_chars_hint";function $n(e){return HN(e)}function HN(e){const t=e.pattern,n={};if(n.name=e.name,gi(t)||(n.PATTERN=t),Rt(e,GN))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Rt(e,_y)&&(n.CATEGORIES=e[_y]),la([n]),Rt(e,by)&&(n.LABEL=e[by]),Rt(e,Ey)&&(n.GROUP=e[Ey]),Rt(e,xy)&&(n.POP_MODE=e[xy]),Rt(e,wy)&&(n.PUSH_MODE=e[wy]),Rt(e,ky)&&(n.LONGER_ALT=e[ky]),Rt(e,Ty)&&(n.LINE_BREAKS=e[Ty]),Rt(e,Ay)&&(n.START_CHARS_HINT=e[Ay]),n}const fs=$n({name:"EOF",pattern:Ge.NA});la([fs]);function rl(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function YN(e,t){return ca(e,t)}const vy={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${yy(e)?`--> ${ha(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+mr(t).image+"'";if(r)return s+r+a;{const c=Sn(e,(f,d)=>f.concat(d),[]),u=xt(c,f=>`[${xt(f,d=>ha(d)).join(", ")}]`),h=`one of these possible Token sequences:
${xt(u,(f,d)=>`  ${d+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+mr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${xt(e,u=>`[${xt(u,l=>ha(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(vy);const VN={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},ds={buildDuplicateFoundError(e,t){function n(l){return l instanceof Ae?l.terminalType.name:l instanceof Rn?l.nonTerminalName:""}const r=e.name,i=mr(t),s=i.idx,o=Kr(i),a=n(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=xt(e.prefixPath,i=>ha(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=xt(e.prefixPath,i=>ha(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Kr(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=xt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof no?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function XN(e,t){const n=new qN(e,t);return n.resolveRefs(),n.errors}class qN extends us{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){It(Fe(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:_n.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class JN extends Hc{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=rn(this.path.ruleStack).reverse(),this.occurrenceStack=rn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){me(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class ZN extends JN{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new In({definition:i});this.possibleTokTypes=ia(s),this.found=!0}}}class il extends Hc{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class QN extends il{walkMany(t,n,r){if(t.idx===this.occurrence){const i=mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class Sy extends il{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class tO extends il{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class Ry extends il{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function Yh(e,t,n=[]){n=rn(n);let r=[],i=0;function s(a){return a.concat(sn(e,i+1))}function o(a){const c=Yh(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof In)return o(a.definition);if(a instanceof Rn)return o(a.definition);if(a instanceof Nn)r=o(a.definition);else if(a instanceof zr){const c=a.definition.concat([new Ke({definition:a.definition})]);return o(c)}else if(a instanceof Wr){const c=[new In({definition:a.definition}),new Ke({definition:[new Ae({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof yr){const c=a.definition.concat([new Ke({definition:[new Ae({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Ke){const c=a.definition.concat([new Ke({definition:a.definition})]);r=o(c)}else{if(a instanceof _r)return It(a.definition,c=>{me(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ae)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:sn(e,i)}),r}function Iy(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-r-1,l=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!me(h);){const f=h.pop();if(f===o){a&&to(h).idx<=u&&h.pop();continue}const d=f.def,p=f.idx,m=f.ruleStack,x=f.occurrenceStack;if(me(d))continue;const w=d[0];if(w===i){const T={idx:p,def:sn(d),ruleStack:ra(m),occurrenceStack:ra(x)};h.push(T)}else if(w instanceof Ae)if(p<c-1){const T=p+1,v=t[T];if(n(v,w.terminalType)){const I={idx:T,def:sn(d),ruleStack:m,occurrenceStack:x};h.push(I)}}else if(p===c-1)l.push({nextTokenType:w.terminalType,nextTokenOccurrence:w.idx,ruleStack:m,occurrenceStack:x}),a=!0;else throw Error("non exhaustive match");else if(w instanceof Rn){const T=rn(m);T.push(w.nonTerminalName);const v=rn(x);v.push(w.idx);const I={idx:p,def:w.definition.concat(s,sn(d)),ruleStack:T,occurrenceStack:v};h.push(I)}else if(w instanceof Nn){const T={idx:p,def:sn(d),ruleStack:m,occurrenceStack:x};h.push(T),h.push(o);const v={idx:p,def:w.definition.concat(sn(d)),ruleStack:m,occurrenceStack:x};h.push(v)}else if(w instanceof zr){const T=new Ke({definition:w.definition,idx:w.idx}),v=w.definition.concat([T],sn(d)),I={idx:p,def:v,ruleStack:m,occurrenceStack:x};h.push(I)}else if(w instanceof Wr){const T=new Ae({terminalType:w.separator}),v=new Ke({definition:[T].concat(w.definition),idx:w.idx}),I=w.definition.concat([v],sn(d)),U={idx:p,def:I,ruleStack:m,occurrenceStack:x};h.push(U)}else if(w instanceof yr){const T={idx:p,def:sn(d),ruleStack:m,occurrenceStack:x};h.push(T),h.push(o);const v=new Ae({terminalType:w.separator}),I=new Ke({definition:[v].concat(w.definition),idx:w.idx}),U=w.definition.concat([I],sn(d)),S={idx:p,def:U,ruleStack:m,occurrenceStack:x};h.push(S)}else if(w instanceof Ke){const T={idx:p,def:sn(d),ruleStack:m,occurrenceStack:x};h.push(T),h.push(o);const v=new Ke({definition:w.definition,idx:w.idx}),I=w.definition.concat([v],sn(d)),U={idx:p,def:I,ruleStack:m,occurrenceStack:x};h.push(U)}else if(w instanceof _r)for(let T=w.definition.length-1;T>=0;T--){const v=w.definition[T],I={idx:p,def:v.definition.concat(sn(d)),ruleStack:m,occurrenceStack:x};h.push(I),h.push(o)}else if(w instanceof In)h.push({idx:p,def:w.definition.concat(sn(d)),ruleStack:m,occurrenceStack:x});else if(w instanceof no)h.push(eO(w,p,m,x));else throw Error("non exhaustive match")}return l}function eO(e,t,n,r){const i=rn(n);i.push(e.name);const s=rn(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Re;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Re||(Re={}));function Ny(e){if(e instanceof Nn||e==="Option")return Re.OPTION;if(e instanceof Ke||e==="Repetition")return Re.REPETITION;if(e instanceof zr||e==="RepetitionMandatory")return Re.REPETITION_MANDATORY;if(e instanceof Wr||e==="RepetitionMandatoryWithSeparator")return Re.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof yr||e==="RepetitionWithSeparator")return Re.REPETITION_WITH_SEPARATOR;if(e instanceof _r||e==="Alternation")return Re.ALTERNATION;throw Error("non exhaustive match")}function nO(e,t,n,r,i,s){const o=Xh(e,t,n),a=My(o)?nl:ca;return s(o,r,a,i)}function rO(e,t,n,r,i,s){const o=qh(e,t,i,n),a=My(o)?nl:ca;return s(o[0],a,r)}function iO(e,t,n,r){const i=e.length,s=pr(e,o=>pr(o,a=>a.length===1));if(t)return function(o){const a=xt(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let f=0;f<l;f++){const d=u[f],p=d.length;for(let m=0;m<p;m++){const x=this.LA(m+1);if(n(x,d[m])===!1)continue t}return c}}};if(s&&!r){const o=xt(e,c=>Dn(c)),a=Sn(o,(c,u,l)=>(It(u,h=>{Rt(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),It(h.categoryMatches,f=>{Rt(c,f)||(c[f]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let f=0;f<h;f++){const d=this.LA(f+1);if(n(d,l[f])===!1)continue t}return o}}}}function sO(e,t,n){const r=pr(e,s=>s.length===1),i=e.length;if(r&&!n){const s=Dn(e);if(s.length===1&&me(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Sn(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,It(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue t}return!0}return!1}}class oO extends Hc{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Re.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Re.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Re.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Re.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Re.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class Oy extends us{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Re.OPTION)}visitRepetition(t){this.checkIsTarget(t,Re.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Re.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Re.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Re.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Re.ALTERNATION)}}function Cy(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function Vh(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function aO(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function Ly(e,t){const n=xt(e,o=>Yh([o],1)),r=Cy(n.length),i=xt(n,o=>{const a={};return It(o,c=>{const u=Vh(c.partialPath);It(u,l=>{a[l]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=Cy(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,f=u[l].suffixDef,d=Vh(h);if(aO(i,d,c)||me(f)||h.length===t){const m=r[c];if(Jh(m,h)===!1){m.push(h);for(let x=0;x<d.length;x++){const w=d[x];i[c][w]=!0}}}else{const m=Yh(f,o+1,h);s[c]=s[c].concat(m),It(m,x=>{const w=Vh(x.partialPath);It(w,T=>{i[c][T]=!0})})}}}}return r}function Xh(e,t,n,r){const i=new Oy(e,Re.ALTERNATION,r);return t.accept(i),Ly(i.result,n)}function qh(e,t,n,r){const i=new Oy(e,n);t.accept(i);const s=i.result,a=new oO(t,e,n).startWalking(),c=new In({definition:s}),u=new In({definition:a});return Ly([c,u],r)}function Jh(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function cO(e,t){return e.length<t.length&&pr(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function My(e){return pr(e,t=>pr(t,n=>pr(n,r=>me(r.categoryMatches))))}function lO(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return xt(t,n=>Object.assign({type:_n.CUSTOM_LOOKAHEAD_VALIDATION},n))}function uO(e,t,n,r){const i=sr(e,c=>hO(c,n)),s=kO(e,t,n),o=sr(e,c=>bO(c,n)),a=sr(e,c=>pO(c,e,r,n));return i.concat(s,o,a)}function hO(e,t){const n=new dO;e.accept(n);const r=n.allProductions,i=Vg(r,fO),s=gr(i,a=>a.length>1);return xt(Fe(s),a=>{const c=mr(a),u=t.buildDuplicateFoundError(e,a),l=Kr(c),h={message:u,type:_n.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:c.idx},f=Uy(c);return f&&(h.parameter=f),h})}function fO(e){return`${Kr(e)}_#_${e.idx}_#_${Uy(e)}`}function Uy(e){return e instanceof Ae?e.terminalType.name:e instanceof Rn?e.nonTerminalName:""}class dO extends us{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function pO(e,t,n,r){const i=[];if(Sn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:_n.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function mO(e,t,n){const r=[];let i;return yn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:_n.INVALID_RULE_OVERRIDE,ruleName:e})),r}function Fy(e,t,n,r=[]){const i=[],s=sl(t.definition);if(me(s))return[];{const o=e.name;yn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:_n.LEFT_RECURSION,ruleName:o});const c=jc(s,r.concat([e])),u=sr(c,l=>{const h=rn(r);return h.push(l),Fy(e,l,n,h)});return i.concat(u)}}function sl(e){let t=[];if(me(e))return t;const n=mr(e);if(n instanceof Rn)t.push(n.referencedRule);else if(n instanceof In||n instanceof Nn||n instanceof zr||n instanceof Wr||n instanceof yr||n instanceof Ke)t=t.concat(sl(n.definition));else if(n instanceof _r)t=Dn(xt(n.definition,s=>sl(s.definition)));else if(!(n instanceof Ae))throw Error("non exhaustive match");const r=Gc(n),i=e.length>1;if(r&&i){const s=sn(e);return t.concat(sl(s))}else return t}class Zh extends us{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function gO(e,t){const n=new Zh;e.accept(n);const r=n.alternations;return sr(r,s=>{const o=ra(s.definition);return sr(o,(a,c)=>{const u=Iy([a],[],ca,1);return me(u)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:_n.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function yO(e,t,n){const r=new Zh;e.accept(r);let i=r.alternations;return i=zc(i,o=>o.ignoreAmbiguities===!0),sr(i,o=>{const a=o.idx,c=o.maxLookahead||t,u=Xh(a,e,c,o),l=wO(u,o,e,n),h=xO(u,o,e,n);return l.concat(h)})}class _O extends us{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function bO(e,t){const n=new Zh;e.accept(n);const r=n.alternations;return sr(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:_n.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function EO(e,t,n){const r=[];return It(e,i=>{const s=new _O;i.accept(s);const o=s.allProductions;It(o,a=>{const c=Ny(a),u=a.maxLookahead||t,l=a.idx,f=qh(l,i,c,u)[0];if(me(Dn(f))){const d=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:d,type:_n.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function wO(e,t,n,r){const i=[],s=Sn(e,(a,c,u)=>(t.definition[u].ignoreAmbiguities===!0||It(c,l=>{const h=[u];It(e,(f,d)=>{u!==d&&Jh(f,l)&&t.definition[d].ignoreAmbiguities!==!0&&h.push(d)}),h.length>1&&!Jh(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return xt(s,a=>{const c=xt(a.alts,l=>l+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:_n.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function xO(e,t,n,r){const i=Sn(e,(o,a,c)=>{const u=xt(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return na(sr(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=ir(i,f=>t.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&cO(f.path,u));return xt(l,f=>{const d=[f.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:d,prefixPath:f.path}),type:_n.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:d}})}))}function kO(e,t,n){const r=[],i=xt(t,s=>s.name);return It(e,s=>{const o=s.name;if(yn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:_n.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function TO(e){const t=Ph(e,{errMsgProvider:VN}),n={};return It(e.rules,r=>{n[r.name]=r}),XN(n,t.errMsgProvider)}function AO(e){return e=Ph(e,{errMsgProvider:ds}),uO(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const By="MismatchedTokenException",Py="NoViableAltException",Dy="EarlyExitException",$y="NotAllInputParsedException",jy=[By,Py,Dy,$y];Object.freeze(jy);function ol(e){return yn(jy,e.name)}class al extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class zy extends al{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=By}}class vO extends al{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Py}}class SO extends al{constructor(t,n){super(t,n),this.name=$y}}class RO extends al{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Dy}}const Qh={},Wy="InRuleRecoveryException";class IO extends Error{constructor(t){super(t),this.name=Wy}}class NO{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Rt(t,"recoveryEnabled")?t.recoveryEnabled:yi.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=OO)}getTokenToInsert(t){const n=rl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const f=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:f,ruleName:this.getCurrRuleFullName()}),p=new zy(d,u,this.LA(0));p.resyncedTokens=ra(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new IO("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||me(n))return!1;const r=this.LA(1);return eo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return yn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=eo(t,s=>YN(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Qh;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return xt(t,(r,i)=>i===0?Qh:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=xt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return Dn(t)}getFollowSetFromFollowKey(t){if(t===Qh)return[fs];const n=t.ruleName+t.idxInCallingRule+ey+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,fs)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return ra(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=rn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return xt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function OO(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),d=this.getGAstProductions()[f];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=fs,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,n,u)}const CO=4,zi=8,Ky=1<<zi,Gy=2<<zi,tf=3<<zi,ef=4<<zi,nf=5<<zi,cl=6<<zi;function rf(e,t,n){return n|t|e}class LO{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:yi.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(me(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return sr(t,n=>Fy(n,n,ds))}validateEmptyOrAlternatives(t){return sr(t,n=>gO(n,ds))}validateAmbiguousAlternationAlternatives(t,n){return sr(t,r=>yO(r,n,ds))}validateSomeNonEmptyLookaheadPath(t,n){return EO(t,n,ds)}buildLookaheadForAlternation(t){return nO(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,iO)}buildLookaheadForOptional(t){return rO(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Ny(t.prodType),sO)}}class MO{initLooksAhead(t){this.dynamicTokensEnabled=Rt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:yi.dynamicTokensEnabled,this.maxLookahead=Rt(t,"maxLookahead")?t.maxLookahead:yi.maxLookahead,this.lookaheadStrategy=Rt(t,"lookaheadStrategy")?t.lookaheadStrategy:new LO({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){It(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=FO(n);It(r,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${Kr(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:n,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=rf(this.fullRuleNameToShort[n.name],Ky,u.idx);this.setLaFuncCache(f,h)})}),It(i,u=>{this.computeLookaheadFunc(n,u.idx,tf,"Repetition",u.maxLookahead,Kr(u))}),It(s,u=>{this.computeLookaheadFunc(n,u.idx,Gy,"Option",u.maxLookahead,Kr(u))}),It(o,u=>{this.computeLookaheadFunc(n,u.idx,ef,"RepetitionMandatory",u.maxLookahead,Kr(u))}),It(a,u=>{this.computeLookaheadFunc(n,u.idx,cl,"RepetitionMandatoryWithSeparator",u.maxLookahead,Kr(u))}),It(c,u=>{this.computeLookaheadFunc(n,u.idx,nf,"RepetitionWithSeparator",u.maxLookahead,Kr(u))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=rf(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return rf(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class UO extends us{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const ll=new UO;function FO(e){ll.reset(),e.accept(ll);const t=ll.dslMethods;return ll.reset(),t}function Hy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function Yy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function BO(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function PO(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const DO="name";function Vy(e,t){Object.defineProperty(e,DO,{enumerable:!1,configurable:!0,writable:!1,value:t})}function $O(e,t){const n=nr(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,t)}}}function jO(e,t){const n=function(){};Vy(n,e+"BaseSemantics");const r={visit:function(i,s){if(te(i)&&(i=i[0]),!gi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=WO(this,t);if(!me(i)){const s=xt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function zO(e,t,n){const r=function(){};Vy(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return It(t,s=>{i[s]=$O}),r.prototype=i,r.prototype.constructor=r,r}var sf;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(sf||(sf={}));function WO(e,t){return KO(e,t)}function KO(e,t){const n=ir(t,i=>fi(e[i])===!1),r=xt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:sf.MISSING_METHOD,methodName:i}));return na(r)}class GO{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Rt(t,"nodeLocationTracking")?t.nodeLocationTracking:yi.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=We,this.cstFinallyStateUpdate=We,this.cstPostTerminal=We,this.cstPostNonTerminal=We,this.cstPostRule=We;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Yy,this.setNodeLocationFromNode=Yy,this.cstPostRule=We,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Hy,this.setNodeLocationFromNode=Hy,this.cstPostRule=We,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=We,this.setInitialNodeLocation=We;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];BO(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];PO(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(gi(this.baseCstVisitorConstructor)){const t=jO(this.className,nr(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(gi(this.baseCstVisitorWithDefaultsConstructor)){const t=zO(this.className,nr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class HO{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):fl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?fl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class YO{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=dl){if(yn(this.definedRulesNames,t)){const o={message:ds.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:_n.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=dl){const i=mO(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(ol(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return XI(Fe(this.gastProductionsCache))}}class VO{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=nl,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Rt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(te(t)){if(me(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(te(t))this.tokensMap=Sn(t,(s,o)=>(s[o.name]=o,s),{});else if(Rt(t,"modes")&&pr(Dn(Fe(t.modes)),WN)){const s=Dn(Fe(t.modes)),o=Wc(s);this.tokensMap=Sn(o,(a,c)=>(a[c.name]=c,a),{})}else if(er(t))this.tokensMap=rn(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=fs;const r=Rt(t,"modes")?Dn(Fe(t.modes)):Fe(t),i=pr(r,s=>me(s.categoryMatches));this.tokenMatcher=i?nl:ca,la(Fe(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Rt(r,"resyncEnabled")?r.resyncEnabled:dl.resyncEnabled,s=Rt(r,"recoveryValueFunc")?r.recoveryValueFunc:dl.recoveryValueFunc,o=this.ruleShortNameIdx<<CO+zi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(ol(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Gy,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(ef,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Re.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,ef,t,tO)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(cl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Ry],a,cl,t,Ry)}else throw this.raiseEarlyExitException(t,Re.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(tf,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,tf,t,QN,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(nf,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Sy],a,nf,t,Sy)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,cl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(Ky,n),i=te(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new SO(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw ol(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new zy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===Wy?r:s}}else throw r}saveRecogState(){const t=this.errors,n=rn(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),fs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class XO{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Rt(t,"errorMessageProvider")?t.errorMessageProvider:yi.errorMessageProvider}SAVE_ERROR(t){if(ol(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:rn(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return rn(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=qh(t,s,n,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new RO(u,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Xh(t,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new vO(c,this.LA(1),a))}}class qO{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(gi(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Iy([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=mr(t.ruleStack),i=this.getGAstProductions()[n];return new ZN(i,t).startWalking()}}const ul={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(ul);const Xy=!0,qy=Math.pow(2,zi)-1,Jy=$n({name:"RECORDING_PHASE_TOKEN",pattern:Ge.NA});la([Jy]);const Zy=rl(Jy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Zy);const JO={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class ZO{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return fl}topLevelRuleRecord(t,n){try{const r=new no({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return fa.call(this,Nn,t,n)}atLeastOneInternalRecord(t,n){fa.call(this,zr,n,t)}atLeastOneSepFirstInternalRecord(t,n){fa.call(this,Wr,n,t,Xy)}manyInternalRecord(t,n){fa.call(this,Ke,n,t)}manySepFirstInternalRecord(t,n){fa.call(this,yr,n,t,Xy)}orInternalRecord(t,n){return QO.call(this,t,n)}subruleInternalRecord(t,n,r){if(hl(n),!t||Rt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Qy(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=to(this.recordingProdStack),s=t.ruleName,o=new Rn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?JO:ul}consumeInternalRecord(t,n,r){if(hl(n),!my(t)){const o=new Error(`<CONSUME${Qy(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=to(this.recordingProdStack),s=new Ae({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Zy}}function fa(e,t,n,r=!1){hl(n);const i=to(this.recordingProdStack),s=fi(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Rt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),ul}function QO(e,t){hl(t);const n=to(this.recordingProdStack),r=te(e)===!1,i=r===!1?e:e.DEF,s=new _r({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Rt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Dh(i,a=>fi(a.GATE));return s.hasPredicates=o,n.definition.push(s),It(i,a=>{const c=new In({definition:[]});s.definition.push(c),Rt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Rt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),ul}function Qy(e){return e===0?"":`${e}`}function hl(e){if(e<0||e>qy){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${qy+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class tC{initPerformanceTracer(t){if(Rt(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=yi.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=Zg(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function eC(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const fl=rl(fs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(fl);const yi=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:vy,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),dl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var _n;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(_n||(_n={}));let of=class sb{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Qg(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),It(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=TO({rules:Fe(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(me(r)&&this.skipValidations===!1){const i=AO({rules:Fe(this.gastProductionsCache),tokenTypes:Fe(this.tokensMap),errMsgProvider:ds,grammarName:n}),s=lO({lookaheadStrategy:this.lookaheadStrategy,rules:Fe(this.gastProductionsCache),tokenTypes:Fe(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),me(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=nN(Fe(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Fe(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Fe(this.gastProductionsCache))})),!sb.DEFER_DEFINITION_ERRORS_HANDLING&&!me(this.definitionErrors))throw t=xt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Rt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Rt(n,"skipValidations")?n.skipValidations:yi.skipValidations}};of.DEFER_DEFINITION_ERRORS_HANDLING=!1,eC(of,[NO,MO,GO,HO,VO,YO,XO,qO,ZO,tC]);class nC extends of{constructor(t,n=yi){const r=rn(n);r.outputCst=!0,super(t,r)}}function rC(e){const t=new iC,n=Fe(e);return xt(n,r=>t.visitRule(r))}class iC extends us{visitRule(t){const n=this.visitEach(t.definition),r=Vg(n,s=>s.propertyName),i=xt(r,(s,o)=>{const a=!Dh(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=xt(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:pl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:pl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:pl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:pl(t)}]}visitEachAndOverrideWith(t,n){return xt(this.visitEach(t),r=>An({},r,n))}visitEach(t){return Dn(xt(t,n=>this.visit(n)))}}function pl(e){return e instanceof Rn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function sC(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(Dn(xt(e,r=>oC(r)))),t.includeVisitorInterface&&(n=n.concat(uC(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function oC(e){const t=aC(e),n=cC(e);return[t,n]}function aC(e){const t=e_(e.name),n=af(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function cC(e){return`export type ${af(e.name)} = {
  ${xt(e.properties,n=>lC(n)).join(`
  `)}
};`}function lC(e){const t=fC(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function uC(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${xt(t,n=>hC(n)).join(`
  `)}
}`}function hC(e){const t=af(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function fC(e){if(te(e)){const t=Wc(xt(e,r=>t_(r)));return"("+Sn(t,(r,i)=>r+" | "+i)+")"}else return t_(e)}function t_(e){return e.kind==="token"?"IToken":e_(e.name)}function e_(e){return gg(e)+"CstNode"}function af(e){return gg(e)+"CstChildren"}const dC={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function pC(e,t){const n=Object.assign(Object.assign({},dC),t),r=rC(e);return sC(r,n)}const ml=D0(32,126).map(e=>String.fromCharCode(e));function Kt(e){return $n({...e,name:`token_${e.name}`})}function Gr(e,t=!1){return Kt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on,group:Ge.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on})}const da=Kt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),mC=Kt({name:"whitespace",pattern:/ +/,group:Ge.SKIPPED}),gC=Kt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Ge.SKIPPED}),cf=Kt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),io=Kt({name:"command",pattern:/#/,start_chars_hint:["#"]});let n_=!1;function yC(e,t,n){if(!n_)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==da)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const lf=Kt({name:"text",pattern:yC,line_breaks:!1,start_chars_hint:ml.filter(e=>"@#/?':!".includes(e)===!1)}),r_=Kt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),i_=Kt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),s_=Kt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),o_=Kt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),on=Kt({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:ml}),a_=Kt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),c_=Kt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),l_=Kt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:on}),u_=Kt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:on}),h_=Kt({name:"islessthan",pattern:/<|below/,longer_alt:on}),f_=Kt({name:"isgreaterthan",pattern:/>|above/,longer_alt:on}),d_=Kt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:on}),p_=Kt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:on}),uf=Kt({name:"or",pattern:/or/i,longer_alt:on}),hf=Kt({name:"not",pattern:/not/i,longer_alt:on}),ff=Kt({name:"and",pattern:/and/i,longer_alt:on}),df=Kt({name:"plus",pattern:/\+/}),pf=Kt({name:"minus",pattern:/-/}),m_=Kt({name:"power",pattern:/\*\*/}),g_=Kt({name:"multiply",pattern:/\*/}),mf=Kt({name:"divide",pattern:/\//}),y_=Kt({name:"moddivide",pattern:/%/}),__=Kt({name:"floordivide",pattern:/%%/}),b_=Kt({name:"query",pattern:/\?/}),E_=Kt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),w_=Kt({name:"rparen",pattern:/\)/,pop_mode:!0}),x_=Kt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:ml,longer_alt:on}),k_=Kt({name:"command_toast",pattern:/toast .*/,start_chars_hint:ml,longer_alt:on}),gf=Kt({name:"if",pattern:/if|try|take|give/,longer_alt:on}),gl=Gr("do"),_C=Gr("to",!0),yf=Gr("done"),bC=Gr("then",!0),_f=Gr("else"),T_=Gr("while"),A_=Gr("repeat"),v_=Gr("waitfor"),S_=Kt({name:"foreach",pattern:/foreach|for/,longer_alt:on}),R_=Gr("break"),I_=Gr("continue");function N_(e){return[...e,c_,l_,u_,d_,h_,p_,f_,uf,hf,ff,df,pf,m_,g_,mf,__,y_,b_,E_,w_,a_,on]}const O_=N_([lf,cf,x_,k_,io,r_,i_,s_,o_,da,mC,R_,I_,yf,gl,_f,S_,gf,A_,bC,_C,v_,T_]),EC=new Ge({defaultMode:"use_newlines",modes:{use_newlines:O_,ignore_newlines:N_([gC])}},{skipValidations:!Mr,ensureOptimizations:Mr});function bf(e){n_=!0;const t=EC.tokenize(e||` 
`),[n]=(re(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(rl(da,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function wC(e,t,n=!0){if(n){const[r,...i]=t;switch(Mt(r??"")){default:return{type:wt.OBJECT,values:t};case"loader":return{type:wt.LOADER,values:i};case"board":return{type:wt.BOARD,values:i};case"object":return{type:wt.OBJECT,values:i};case"terrain":return{type:wt.TERRAIN,values:i};case"charset":return{type:wt.CHARSET,values:i};case"palette":return{type:wt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Mt(i??""),a=[r,e,...s];switch(o){default:return{type:wt.CONST,values:t};case"rn":case"range":return{type:wt.RANGE,values:a};case"sl":case"select":return{type:wt.SELECT,values:a};case"nm":case"number":return{type:wt.NUMBER,values:a};case"tx":case"text":return{type:wt.TEXT,values:a};case"ln":case"link":return{type:wt.LINK,values:a};case"hk":case"hotkey":return{type:wt.HOTKEY,values:a};case"copyit":return{type:wt.COPYIT,values:a};case"openit":return{type:wt.OPENIT,values:a};case"zssedit":return{type:wt.ZSSEDIT,values:a};case"charedit":return{type:wt.CHAREDIT,values:a};case"coloredit":return{type:wt.COLOREDIT,values:a}}}}function jn(e){switch(e){case wt.LOADER:return"loader";case wt.BOARD:return"board";case wt.OBJECT:return"object";case wt.TERRAIN:return"terrain";case wt.CHARSET:return"charset";case wt.PALETTE:return"palette";case wt.CONST:return"const";case wt.RANGE:return"range";case wt.SELECT:return"select";case wt.NUMBER:return"number";case wt.TEXT:return"text";case wt.LINK:return"link";case wt.HOTKEY:return"hotkey";case wt.COPYIT:return"copyit";case wt.OPENIT:return"openit";case wt.ZSSEDIT:return"zssedit";case wt.CHAREDIT:return"charedit";case wt.COLOREDIT:return"coloredit"}}var Ef=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Ef||{});function C_(e){return qs(e,Ef,{bits:t=>Array.from(t)})}function L_(e){return Ho(e,Ef,{bits:t=>new Uint8Array(t)})}function xC(e,t){return{id:Ne(),code:e,...t}}var wf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(wf||{});function kC(e){return qs(e,wf,{board:qL,object:Tc,terrain:Tc,charset:C_,palette:C_,stats:Le})}function TC(e){return Ho(e,wf,{board:JL,object:Ac,terrain:Ac,charset:L_,palette:L_})}function pa(e){const t={...ps(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function AC(e){return k(e)?(e.stats=void 0,ps(e)):{}}function M_(e){const t=bf(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===cf){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),u=a.split(" "),l=wC(St(c)?c:"",u,r),h=Mt(l.values.join(" "));switch(r=!1,l.type){case wt.LOADER:n.type=Et.LOADER,n.name=h;break;case wt.BOARD:n.type=Et.BOARD,n.name=h;break;case wt.OBJECT:n.type=Et.OBJECT,n.name=h||"object";break;case wt.TERRAIN:n.type=Et.TERRAIN,n.name=h;break;case wt.CHARSET:n.type=Et.CHARSET,n.name=h;break;case wt.PALETTE:n.type=Et.PALETTE,n.name=h;break;case wt.CONST:{const[f,d]=l.values;if(St(f)){const p=Mt(f);if(St(d)){const m=parseFloat(d);n[p]=Ct(m)?m:d}else Ct(d)?n[p]=d:n[p]=1}break}case wt.RANGE:case wt.SELECT:case wt.NUMBER:case wt.TEXT:case wt.LINK:case wt.HOTKEY:case wt.ZSSEDIT:case wt.CHAREDIT:case wt.COLOREDIT:{const[f,...d]=l.values;if(St(f)){const p=Mt(f);n[p]=[jn(l.type),...d]}break}}}}return n}function ps(e){var t;return k(e)?(k((t=e.stats)==null?void 0:t.type)||(e.stats=M_(e.code),k(e.stats.type)||(e.stats.type=Et.OBJECT)),e.stats):{}}function U_(e){switch(e){default:case Et.ERROR:return"error";case Et.LOADER:return jn(wt.LOADER);case Et.BOARD:return jn(wt.BOARD);case Et.OBJECT:return jn(wt.OBJECT);case Et.TERRAIN:return jn(wt.TERRAIN);case Et.CHARSET:return jn(wt.CHARSET);case Et.PALETTE:return jn(wt.PALETTE)}}function _i(e){return ps(e).type??Et.ERROR}function bi(e){return U_(_i(e))}function Me(e){return ps(e).name??""}function F_(e,t){return ps(e)[t]}const yl=new Zu;function xf(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!re(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Yt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Yt.ISSWIM;break;case"issolid":t.collision=Yt.ISSOLID;break;case"isbullet":t.collision=Yt.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function un(e){var t;if(k(e))switch(_i(e)){default:return;case Et.ERROR:return e.code??"";case Et.LOADER:return e.code??"";case Et.BOARD:{k(e.board)||(e.board=XL()),e.board.id=e.id;const n=pa(e);return e.board.isdark=n.isdark??e.board.isdark?1:0,e.board.startx=n.startx??e.board.startx,e.board.starty=n.starty??e.board.starty,e.board.over=n.over??e.board.over,e.board.under=n.under??e.board.under,e.board.exitnorth=n.exitnorth??e.board.exitnorth,e.board.exitsouth=n.exitsouth??e.board.exitsouth,e.board.exitwest=n.exitwest??e.board.exitwest,e.board.exiteast=n.exiteast??e.board.exiteast,e.board.timelimit=n.timelimit??e.board.timelimit,e.board.restartonzap=n.restartonzap??e.board.restartonzap,e.board.maxplayershots=n.maxplayershots??e.board.maxplayershots,e.board}case Et.OBJECT:return k(e.object)||(e.object=Nm()),e.object.name=Me(e),e.object.category=Gn.ISOBJECT,xf(pa(e),e.object),e.object;case Et.TERRAIN:return k(e.terrain)||(e.terrain=Nm()),e.terrain.name=Me(e),e.terrain.category=Gn.ISTERRAIN,xf(pa(e),e.terrain),e.terrain;case Et.PALETTE:{if(k(e.palette)||(e.palette=Cm(GT)),k((t=e.palette)==null?void 0:t.bits)){const n=pa(e),r=Kn(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&St(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){yl.set(o);const c=a*uc,u=yl.r*63,l=yl.g*63,h=yl.b*63;e.palette.bits[c+0]=Bn(u,0,63),e.palette.bits[c+1]=Bn(l,0,63),e.palette.bits[c+2]=Bn(h,0,63)}}}}return e.palette}case Et.CHARSET:return k(e.charset)||(e.charset=Lm(KT)),e.charset}}function B_(e){return{id:Ne(),name:wb(),timestamp:0,activelist:[],pages:e,flags:{}}}var kf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e))(kf||{});function vC(e){return qs(e,kf,{pages:t=>t.map(kC),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function SC(e){return Ho(e,kf,{pages:t=>t.map(TC)})}function Ei(e,t){if(!k(e))return;const n=Mt(t);return e.pages.find(i=>i.id===t||n===Me(i))}function On(e,t,n){if(!k(e))return;const r=Mt(n);return e.pages.find(s=>_i(s)===t&&(s.id===n||r===Me(s)))}function Tf(e,t,n){let r=On(e,t,n);if(!k(r)){const i=U_(t);r=xC(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),D_(e,r)}return r}function ms(e,t){return k(e)?e.pages.filter(n=>_i(n)===t):[]}function br(e,t,n){if(!k(e))return[];const r=Mt(n);return e.pages.filter(s=>_i(s)===t).filter(s=>{const o=ps(s),a=Mt(Me(s));return s.id===n||r===a||k(o[n])})}function _l(e){return k(e)?Xe(e.pages).sort((n,r)=>{const i=_i(n),s=_i(r);return i===s?Me(n).localeCompare(Me(r)):s-i}):[]}function P_(e,t){if(k(t)){const n=On(e,Et.TERRAIN,t.kind??"");if(k(n))return n;const r=On(e,Et.OBJECT,t.kind??"");if(k(r))return r}}function D_(e,t){if(!k(e)||!k(t))return!1;const n=Ei(e,t.id);return k(n)?!1:(e.pages.push(t),!0)}function $_(e,t){const n=Ei(e,t);if(k(e)&&k(n)){const r=Mt(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Me(i)),n}}function wi(e,t){if(k(t)&&k(t.kind))return k(t.kinddata)||(t.kinddata=k(t.id)?ma(e,t.kind):Af(e,t.kind)),t.kinddata}function j_(e,t,n){const r=wi(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function z_(e,t,n,r,i){const s=wi(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function ma(e,t){const n=t??"",r=On(e,Et.OBJECT,n);if(k(r)){const i=un(r);return{...Xe(i),name:n,code:r.code}}}function Af(e,t){const n=t??"",r=On(e,Et.TERRAIN,n);if(k(r)){const i=un(r);return{...Xe(i),name:n,code:r.code}}}function so(e,t){const n=Ei(e,t);return un(n)}function xi(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function W_(e,t){e&&delete e.flags[t]}function K_(e,t,n){const r=xi(e,t);return r==null?void 0:r[n]}function RC(e,t,n,r){const i=xi(e,t);return i&&(i[n]=r),r}function gs(e,t){const n=K_(e,t,"board");return so(e,St(n)?n:"")}function IC(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function bl(e,t,n){if(!k(e))return;RC(e,t,"board",n);const r=so(e,n);k(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function oo(e,t,n,r){if(!k(e))return;const i=gs(e,t);if(!k(i))return;const s=Ln(i,t);if(!Yo(s)||!(s!=null&&s.id))return;const o=so(e,n);if(!k(o)||(Er(e,o),Sf(e,o,Yt.ISWALK,r)))return;delete i.objects[s.id];const a=Jr(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Jr(o,s);o.lookup&&(o.lookup[c]=s.id),bl(e,t,o.id)}function NC(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=K_(e,r,"board");return St(i)?i:""});return zk(n)}function vf(e){return NC(e).map(n=>so(e,n)).filter(k)}function Sf(e,t,n,r){if(!k(e)||!k(t)||!k(t.lookup)||r.x<0||r.x>=Gt||r.y<0||r.y>=ke)return!0;const i=r.x+r.y*Gt,s=Ln(t,t.lookup[i]??"404");if(k(s))return!0;const o=t.terrain[i];if(k(o)){const a=wi(e,o),c=o.collision??(a==null?void 0:a.collision);return rh(n,c)}return!1}function OC(e,t,n,r){const i=Ln(t,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=j_(e,i,"collision");return Sf(e,t,a,r)}function G_(e,t,n,r){var l,h;const i=Ln(t,(n==null?void 0:n.id)??"");if(!k(e)||!k(t)||!k(i)||!k(i.x)||!k(i.y)||!k(t.lookup)||r.x<0||r.x>=Gt||r.y<0||r.y>=ke)return{name:"edge",kind:"edge",collision:Yt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Jr(t,i),o=Jr(t,r),a=i.collision??((l=i==null?void 0:i.kinddata)==null?void 0:l.collision)??Yt.ISWALK,c=Ln(t,t.lookup[o]??"");if(k(c))return{...c};const u=t.terrain[o];if(k(u)){const f=u.collision??((h=u==null?void 0:u.kinddata)==null?void 0:h.collision)??Yt.ISWALK;if(rh(a,f))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,k(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function Rf(e,t,n,r){var s;if(!k(e)||!k(t)||!k(t.named)||!k(n))return;const i=Mt(n.name??((s=n.kinddata)==null?void 0:s.name)??"");t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function CC(e,t,n){if(!(!k(e)||!k(t)||!k(t.lookup)||!k(n==null?void 0:n.id))&&!k(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*Gt]=n.id}}function Er(e,t){var a;if(!k(e)||!k(t)||k(t.lookup)&&k(t.named))return;const n=new Array(Gt*ke).fill(void 0),r={},i=Object.values(t.objects);for(let c=0;c<i.length;++c){const u=i[c];if(k(u.x)&&k(u.y)&&k(u.id)&&!k(u.removed)){u.category=Gn.ISOBJECT,n[u.x+u.y*Gt]=u.id;const l=Mt(u.name??((a=u.kinddata)==null?void 0:a.name)??"");r[l]||(r[l]=new Set),r[l].add(u.id)}}let s=0,o=0;for(let c=0;c<t.terrain.length;++c){const u=t.terrain[c];if(k(u)){u.x=s,u.y=o,u.category=Gn.ISTERRAIN;const l=Fr(u);r[l]||(r[l]=new Set),r[l].add(c)}++s,s>=Gt&&(s=0,++o)}t.lookup=n,t.named=r}function Hr(e,t,n,r){return!k(n)||Fr(n)==="player"?!1:(n.id?(n.removed=r,If(e,t,n)):(kr(t,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),LC(e,t,n)),!0)}function LC(e,t,n){var r;if(k(e)&&k(t)&&k(n==null?void 0:n.x)&&k(n.y)){const i=Fr(n),s=Jr(t,n);k((r=t.named)==null?void 0:r[i])&&t.named[i].delete(s)}}function If(e,t,n){var r;if(k(e)&&k(t)&&k(n==null?void 0:n.id)){if(k(t.lookup)&&k(n.x)&&k(n.y)){const s=n.x+n.y*Gt;t.lookup[s]===n.id&&(t.lookup[s]=void 0)}const i=Fr(n);k((r=t.named)==null?void 0:r[i])&&k(n.id)&&t.named[i].delete(n.id)}}function MC(e,t,n){const r=[];if(!k(e)||!k(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];k(o.id)&&k(o.removed)&&n-o.removed>Oa*5&&(r.push(o.id),H1(t,o.id))}return r}function UC(e,t,n){const r=[];if(!k(e)||!k(t))return r;t.lookup=void 0,Er(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!k(a.id))continue;a.lx=a.x,a.ly=a.y;const c=wi(e,a),u=a.code??(c==null?void 0:c.code)??"";u&&r.push({id:a.id,type:Et.OBJECT,code:u,object:a,terrain:void 0})}const s=MC(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:Et.ERROR,code:"",object:void 0,terrain:void 0});return r}function FC(e,t,n,r){if(k(e)&&k(t)&&k(n)){const[i,s]=n,o=ma(e,i);if(k(o)&&k(o.name)){const a=od(t,r,i);return vc(a,s),a}}}function ga(e,t,n,r,i){if(k(e)&&k(t)&&k(n)){const[s,o]=n,a=Af(e,s);if(k(a)){const u=QL(t,r,s);if(k(u)){vc(u,o);const l=cc(r,Gt);return Rf(e,t,u,l),u}}const c=ma(e,s);if(k(c)&&k(c.name)){const u=od(t,r,s,i);if(k(u))return vc(u,o),CC(e,t,u),Rf(e,t,u),u}}}function H_(e){return`zss_snapshot_${e}`}function Y_(e){const t=Kn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Fr(r)==="player"&&delete e[t[n]]}return e}function BC(e){const t=Kn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Fr(r)!=="player"&&delete e[t[n]]}return e}function PC(e){const t=On(_.book,Et.BOARD,e),n=un(t);if(!k(n))return;const r=H_(n.id);$_(_.book,r);const i=Hi(Ft.CONTENT,r,Et.BOARD),s=un(i);if(k(s))return s.terrain=Xe(n.terrain),s.objects=Y_(Xe(n.objects)),s}function DC(e){const t=On(_.book,Et.BOARD,e),n=un(t);if(!k(n))return;const r=H_(n.id),i=On(_.book,Et.BOARD,r),s=un(i);k(s)&&(n.terrain=Xe(s.terrain),n.objects={...Y_(Xe(s.objects)),...BC(Xe(n.objects))})}const V_=5;function Nf(e,t,n=2,r=1,i={x:0,y:0},s={x:Gt-1,y:ke-1}){const o=On(_.book,Et.BOARD,e),a=On(_.book,Et.BOARD,t),c=un(o),u=un(a);if(!k(c)||!k(u))return!1;Er(_.book,c),Er(_.book,u);let l=0;const h=new Map,f=new Map;let d=0;const p=32,m=new Uint8Array(ET*4);for(let L=0;L<ke;++L)for(let V=0;V<Gt;++V){const Z=Wn(u,{x:V,y:L}),C=(Z==null?void 0:Z.char)??0,R=(Z==null?void 0:Z.color)??p,b=(Z==null?void 0:Z.bg)??p;m[d++]=C,m[d++]=R,m[d++]=b;const B=wi(_.book,Z),X=Mt((B==null?void 0:B.name)??"empty"),D=h.get(X);Ct(D)?m[d++]=D:(h.set(X,l),f.set(l,X),m[d++]=l++)}const x=Math.min(i.x,s.x),w=Math.min(i.y,s.y),T=Math.max(i.x,s.x),v=Math.max(i.y,s.y),I=T-x+1,U=v-w+1,S=new dT.OverlappingModel(m,Gt,ke,n,I,U,!1,!1,r,0);let N=0;for(;N<V_&&!S.generate();++N);if(N===V_)return!1;d=0;const P=S.graphics();for(let L=w;L<=v;++L)for(let V=x;V<=T;++V){const Z=P[d++],C=P[d++],R=P[d++];l=P[d++];const b=Wn(c,{x:V,y:L});Hr(_.book,c,b,_.timestamp),kr(c,{x:V,y:L});const B=f.get(l)??"",X=ga(_.book,c,[B],{x:V,y:L});if(k(X)&&(Z>0&&(X.char=Z),C<p&&(X.color=C),R<p&&(X.bg=R),Yo(X))){const D=nn(Vs(u,B));k(D)&&(kr(c,{...id(u,D.x??0,D.y??0),x:V,y:L}),X.p1=D.p1,X.p2=D.p2,X.p3=D.p3,X.code=D.code,X.cycle=D.cycle,X.light=D.light,X.stepx=D.stepx,X.stepy=D.stepy,X.pushable=D.pushable,X.collision=D.collision,X.destructible=D.destructible)}}return!0}const $C=D0(32,126).map(e=>String.fromCharCode(e)),jC=$n({name:"Whitespace",pattern:/ +/}),zC=$n({name:"WhitespaceSkipped",pattern:/ +/,group:Ge.SKIPPED}),Of=$n({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),X_=$n({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:$C}),Cf=$n({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Lf=$n({name:"EscapedDollar",pattern:"$$"}),Mf=$n({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Uf=$n({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),q_=$n({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function WC(e,t=""){return $n({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const J_=Object.keys(zo).map(e=>WC(`\\$(${e})`,e)),KC=[jC,Of,...J_,Cf,X_,Uf,Lf,q_,Mf],GC=new Ge(KC,{skipValidations:!Mr,ensureOptimizations:Mr}),HC=new Ge([zC,Of,...J_,Cf,X_,Uf,Lf,q_,Mf],{skipValidations:!Mr,ensureOptimizations:Mr});function Ff(e,t=!1){return t?HC.tokenize(e):GC.tokenize(e)}function Bf(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function Z_(e){e.active={...e.reset}}function Q_(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case Lf:s("$");break;case Uf:if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r();break;case Cf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Of:{t.x=t.active.leftedge??0,++t.y;break}default:{const u=c.tokenType.name,l=zo[u],h=pT(Wt[l]),f=mT(Wt[l]);l==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):k(h)?t.active.color=h:k(f)?t.active.bg=f:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(k(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){Z_(t);const u=String.fromCharCode(t.writefullwidth).repeat(c),l=t.x+t.y*t.width;VC(l,l+u.length,t.active.color,t.active.bg,t),YC(l,u,t)}}}function t1(e,t,n){const r=Ff(e);r.tokens&&(Q_(r.tokens,t),n&&Z_(t),t.changed())}function e1(e,t,n){const r=Ff(e);if(!r.tokens)return;const i=Bf(t,n,Wt.WHITE,Wt.BLACK);return i.measureonly=!0,Q_(r.tokens,i),i.x>0&&++i.y,i}function YC(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function VC(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function n1(e,t,n){if(!go(_.element))return 0;const[r,i]=it(t,0,[H.DIR,H.MAYBE_KIND]),s=i??["bullet"],o=FC(_.book,_.board,s,{x:_.element.x,y:_.element.y});if(k(o)){k(n)&&(o.arg=n),o.party=_.elementid,o.collision=Yt.ISBULLET,o.destructible=1,o.stepx=r.x-_.element.x,o.stepy=r.y-_.element.y,o.bg=Wt.ONCLEAR;const a=wi(_.book,o),c=o.code??(a==null?void 0:a.code)??"";j1(_.book,_.board,o,c,1)}return e.yield(),0}function El(e,t,n,r){var h,f;if(!go(_.element)||!k(_.book)||!k(_.board)||!k(_.element))return 0;Er(_.book,_.board);const[i,s]=it(t,0,[H.DIR,H.KIND]),o=Wn(_.board,i);if((o==null?void 0:o.category)===Gn.ISOBJECT&&(o!=null&&o.pushable)){const d={x:((h=_.element)==null?void 0:h.x)??0,y:((f=_.element)==null?void 0:f.y)??0},p=Ye(i,Yi(d,i));G_(_.book,_.board,o,p)}const[a]=s,c=ma(_.book,a)??Af(_.book,a),u=(c==null?void 0:c.collision)??Yt.ISWALK;if(!Sf(_.book,_.board,u,i)){const d=ga(_.book,_.board,s,i,n);k(d)&&k(r)&&(d.arg=r)}return 0}const XC=li().command("remix",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;const[n,r,i]=it(t,0,[H.NAME,H.MAYBE_NUMBER,H.MAYBE_NUMBER]),s=br(_.book,Et.BOARD,n),o=nn(...s);return k(o)&&Nf(_.board.id,o.id,r,i),0}).command("remixonly",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;const[n,r,i,s,o,a,c]=it(t,0,[H.NAME,H.NUMBER,H.NUMBER,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER,H.MAYBE_NUMBER]),u=br(_.book,Et.BOARD,n),l=nn(...u);return k(l)&&Nf(_.board.id,l.id,a,c,{x:r,y:i},{x:s,y:o}),0}).command("board",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;const[n,r]=it(t,0,[H.NAME]);switch(Mt(n)){case"snapshot":PC(_.board.id);break;case"restart":DC(_.board.id);break;default:{const[i,s]=it(t,r,[H.MAYBE_NUMBER,H.MAYBE_NUMBER]),o=br(_.book,Et.BOARD,n);if(o.length){const a=nn(...o);k(a)&&oo(_.book,_.elementfocus,a.id,{x:i??Math.round(Gt*.5),y:s??Math.round(ke*.5)})}break}}return 0}).command("edge",(e,t)=>{var s,o;if(!k(_.book)||!k(_.board)||!k(_.element))return 0;const[n,r]=it(t,0,[H.DIR,H.NAME]),i=br(_.book,Et.BOARD,r);if(i.length){const a={x:((s=_.element)==null?void 0:s.x)??0,y:((o=_.element)==null?void 0:o.y)??0},c=Yi(a,n),u=nn(...i);switch(c){case yt.NORTH:_.board.exitnorth=u.id;break;case yt.SOUTH:_.board.exitsouth=u.id;break;case yt.WEST:_.board.exitwest=u.id;break;case yt.EAST:_.board.exiteast=u.id;break}}return 0}).command("shove",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;Er(_.book,_.board);const[n,r]=it(t,0,[H.DIR,H.DIR]),i=Wn(_.board,n);return Yo(i)&&Qf(_.book,_.board,i,r),0}).command("duplicate",()=>(!k(_.book)||!k(_.board),0)).command("replace",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;Er(_.book,_.board);const[n,r]=it(t,0,[H.DIR,H.KIND]),i=Wn(_.board,n);return Yo(i)&&Hr(_.book,_.board,i,_.timestamp),ga(_.book,_.board,r,n),0}).command("write",(e,t)=>{var u;if(!k(_.book)||!k(_.board))return 0;Er(_.book,_.board);const[n,r,i]=it(t,0,[H.DIR,H.COLOR,H.STRING]),{color:s,bg:o}=Z0(r),a=((u=e1(i,256,1))==null?void 0:u.measuredwidth)??1,c=Bf(256,1,s??Wt.WHITE,o??Wt.BLACK);t1(i,c,!1);for(let l=0;l<a;++l){const h=kr(_.board,{x:n.x+l,y:n.y,char:c.char[l],color:c.color[l],bg:c.bg[l]});if(k(h)){const f=(h.x??0)+(h.y??0)*Gt;Rf(_.book,_.board,h,f)}}return 0}).command("change",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;Er(_.book,_.board);const[n,r]=it(t,0,[H.KIND,H.KIND]),i=gc(n)??"",s=Vs(_.board,i),o=nm(s,n),a=gc(r),c=tm(r),u=em(r);return o.forEach(l=>{if(Fr(l)===a)k(c)&&(l.color=c),k(u)&&(l.bg=u);else{if(k(l.id)&&Hr(_.book,_.board,l,_.timestamp))return 0;go(l)&&ga(_.book,_.board,r,l)}}),0}).command("putwith",(e,t)=>{const[n,r]=it(t,0,[H.ANY]);return El(e,t.slice(r),void 0,n)}).command("put",(e,t)=>El(e,t)).command("oneof",(e,t)=>{const[n,r]=it(t,0,[H.ANY]);return k(_.board)&&Ln(_.board,n)?0:El(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=it(t,0,[H.ANY,H.ANY]);return k(_.board)&&Ln(_.board,r)?0:El(e,t.slice(i),r,n)}).command("shootwith",(e,t)=>{const[n,r]=it(t,0,[H.ANY]);return n1(e,t.slice(r),n)}).command("shoot",n1),Wi="$dkpurple",qC="$196",JC="$205";function Pt(e,t,n){ti(e,t,n)}function ZC(e,t,n){const r=qC.repeat(n);Pt(e,t,`${Wi}${r}`)}function Pf(e,t,n){const r=JC.repeat(n);Pt(e,t,`${Wi}${r}`)}function ys(e,t,n){Pt(e,t,`${Wi} ${" ".repeat(n.length)} `),ZC(e,t,n.length+2),Pt(e,t,`${Wi} $white${n} `),Pf(e,t,n.length+2)}function ki(e,t,n){Pt(e,t,`${Wi} ${" ".repeat(n.length)} `),Pt(e,t,`${Wi} $gray${n} `),Pf(e,t,n.length+2)}function ee(e,t,n,r){Pt(e,t,`${Wi} $white${n} $blue${r}`)}function Be(e,t,n){Pt(e,t,`${Wi}$blue${n}`)}function r1(e){const[t,n]=e.split(":"),r=k(n);return[r?t:"self",r?n:e]}const QC=navigator.userAgent.includes("Mac")?"cmd":"ctrl";function ya(){Od(Y,qr())}const t4=li().command("send",(e,t)=>{const[n,r]=it(t,0,[H.NAME,H.ANY]);switch(Mt(n)){case"helpmenu":ys(Y,_.elementfocus,"H E L P"),Pt(Y,_.elementfocus,""),ee(Y,_.elementfocus,"#help controls","zss controls and inputs"),Pt(Y,_.elementfocus,"!helpcontrols;read help controls"),Pt(Y,_.elementfocus,""),ee(Y,_.elementfocus,"#help text","text formatting"),Pt(Y,_.elementfocus,"!helptext;read help text"),Pt(Y,_.elementfocus,""),ee(Y,_.elementfocus,"#help developer","developer commands"),Pt(Y,_.elementfocus,"!helpdeveloper;read help developer"),Pt(Y,_.elementfocus,""),ee(Y,_.elementfocus,"#help player","player settings"),Pt(Y,_.elementfocus,"!helpplayer;read help player"),ki(Y,_.elementfocus,"keyboard input"),ee(Y,_.elementfocus,"?","open console"),ee(Y,_.elementfocus,"esc","close console"),ee(Y,_.elementfocus,"tab","move console"),ee(Y,_.elementfocus,"up / down arrow keys","navigate console items"),ee(Y,_.elementfocus,"left / right arrow keys","change console items"),ee(Y,_.elementfocus,"enter","interact with console items"),ee(Y,_.elementfocus,"alt + arrow keys","skip words and console lines"),ee(Y,_.elementfocus,`${QC} + up / down arrow keys`,"input history");break;case"helpcontrols":ys(Y,_.elementfocus,"zss controls and inputs"),ki(Y,_.elementfocus,"keyboard input"),ee(Y,_.elementfocus,"arrow keys","move"),ee(Y,_.elementfocus,"shift + arrow keys","shoot"),ee(Y,_.elementfocus,"enter","ok / accept"),ee(Y,_.elementfocus,"escape","cancel / close"),ee(Y,_.elementfocus,"tab","menu / action"),ki(Y,_.elementfocus,"controller input"),ee(Y,_.elementfocus,"left stick","move"),ee(Y,_.elementfocus,"right stick","aim"),ee(Y,_.elementfocus,"a","ok / accept"),ee(Y,_.elementfocus,"b","cancel / close"),ee(Y,_.elementfocus,"y","menu / action"),ee(Y,_.elementfocus,"x","shoot"),ee(Y,_.elementfocus,"triggers","shoot");break;case"helptext":break;case"helpdeveloper":ys(Y,_.elementfocus,"developer commands"),ee(Y,_.elementfocus,"#books","list books in memory"),ee(Y,_.elementfocus,"#pages","list pages in opened book"),ee(Y,_.elementfocus,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),ee(Y,_.elementfocus,"#trash","list books and pages from open book you can delete"),ee(Y,_.elementfocus,"#save","flush state to register"),ee(Y,_.elementfocus,"#share","creates a click to copy share url and QR code");break;case"helpplayer":ys(Y,_.elementfocus,"player settings"),Be(Y,_.elementfocus,"todo");break;default:{const[i,s]=r1(n);td(i==="self"&&_.elementisplayer?`${_.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(be),s=i.join(" ");switch(Mt(r)){case jn(wt.LOADER):n=Hi(Ft.CONTENT,s,Et.LOADER);break;default:n=Hi(Ft.CONTENT,[r,...i].join(" "),Et.OBJECT);break;case jn(wt.BOARD):n=Hi(Ft.CONTENT,s,Et.BOARD);break;case jn(wt.OBJECT):n=Hi(Ft.CONTENT,s,Et.OBJECT);break;case jn(wt.TERRAIN):n=Hi(Ft.CONTENT,s,Et.TERRAIN);break;case jn(wt.CHARSET):n=Hi(Ft.CONTENT,s,Et.CHARSET);break;case jn(wt.PALETTE):n=Hi(Ft.CONTENT,s,Et.PALETTE);break}return k(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(be).join(" ");return k(_.element)&&(_.element.tickertext=n,_.element.tickertime=_.timestamp),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n),s=r.map(be).join(" ");return ti(Y,_.elementfocus,`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=it(t,0,[H.MAYBE_NAME]),r=P1(n);return k(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=wr(n);return k(r)?(Be(Y,_.elementfocus,`opened [book] ${r.name}`),Ll(Ft.MAIN,r.id),e.command("pages")):ue(Y,_.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=le(Ft.MAIN),i=wr(n);return k(i)&&(r===i&&Ll(Ft.MAIN,""),FL(n),Be(Y,_.elementfocus,`trashed [book] ${i.name}`),ya(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=br(_.book,Et.BOARD,n);if(r.length){const i=nn(...r);k(i)&&oo(_.book,_.elementfocus,i.id,{x:Lr(0,Gt-1),y:Lr(0,ke-1)})}return 0}).command("pageopenwith",(e,t)=>{const[n,r,i]=it(t,0,[H.NAME,H.MAYBE_NAME,H.MAYBE_NAME]);return e.command("pageopen",r,i,n)}).command("pageopen",(e,t)=>{const[n,r,i]=it(t,0,[H.NAME,H.MAYBE_NAME,H.MAYBE_NAME]),s=En(Ft.MAIN);if(!k(s))return 0;const o=Ei(s,n);if(k(o)){const a=Me(o),c=bi(o);Be(Y,_.elementfocus,`opened [${c}] ${a}`);const u=[],l=Ei(s,i??""),h=k(l)?bf(l.code):void 0;if(k(h))for(let p=0;p<h.tokens.length;++p){const m=h.tokens[p];m.tokenType===lf&&u.push(m.image.startsWith('"')?m.image.slice(1):m.image)}const f=[o.id,r];Yu(Na(s.id,f),o.code);const d=bi(o);Id(Y,_.elementfocus,s.id,f,d,`${a} - ${s.name}`,u)}else ue(Y,"pageopen",`page ${n} not found`,_.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=En(Ft.MAIN),i=$_(r,n);if(k(n)){const s=Me(i),o=bi(i);Be(Y,_.elementfocus,`trashed [${o}] ${s}`),ya(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(be).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{ki(Y,_.elementfocus,"books");const e=le(Ft.MAIN);ee(Y,_.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=le(Ft.CONTENT);ee(Y,_.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Pf(Y,_.elementfocus,7);const n=mo();return n.length?n.forEach(r=>{Pt(Y,_.elementfocus,`!bookopen ${r.id};${r.name}`)}):Be(Y,_.elementfocus,"no books found"),Pt(Y,_.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=En(Ft.MAIN);return k(e)&&(ki(Y,_.elementfocus,"pages"),ee(Y,_.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?_l(e).forEach(n=>{const r=Me(n),i=bi(n);Pt(Y,_.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(Pt(Y,_.elementfocus,""),Be(Y,_.elementfocus,"$white no pages found"),Be(Y,_.elementfocus,"$white use @ to create a page"),Be(Y,_.elementfocus,"$white @board name of board"),Be(Y,_.elementfocus,"$white @object name of object"),Be(Y,_.elementfocus,"$white @terrain name of terrain"),Be(Y,_.elementfocus,"$white You can omit the type and it will default to object"),Be(Y,_.elementfocus,"$white @object name of object"),Be(Y,_.elementfocus,"$white @name of object"))),0}).command("boards",()=>{ki(Y,_.elementfocus,"boards");const e=En(Ft.MAIN);if(k(e)){ee(Y,_.elementfocus,"main",`${e.name} $GREEN${e.id}`);const t=_l(e);t.filter(n=>_i(n)===Et.BOARD).forEach(n=>{const r=Me(n),i=bi(n);Pt(Y,_.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),t.length===0&&(Pt(Y,_.elementfocus,""),Be(Y,_.elementfocus,"$white no boards found"),Be(Y,_.elementfocus,"$white use @ to create a board"),Be(Y,_.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{ki(Y,_.elementfocus,"$REDTRASH"),Be(Y,_.elementfocus,"books");const e=mo();e.length&&(e.forEach(n=>{Pt(Y,_.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Pt(Y,_.elementfocus,""));const t=le(Ft.MAIN);return k(t)&&(Be(Y,_.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Me(n);Pt(Y,_.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Pt(Y,_.elementfocus,"")),0}).command("dev",()=>(ya(),aE(Y,_.elementfocus),0)).command("share",()=>(ya(),cE(Y,_.elementfocus),0)).command("save",()=>(ya(),0)).command("fork",()=>(wE(Y,_.elementfocus),0)).command("nuke",()=>(lE(Y,_.elementfocus),0)).command("restart",()=>(EE(Y,_.elementfocus),0)).command("export",()=>{ys(Y,_.elementfocus,"E X P O R T"),ki(Y,_.elementfocus,"books");const e=mo();return e.length&&e.forEach(t=>Pt(Y,_.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=wr(n);return k(r)&&(ys(Y,_.elementfocus,"E X P O R T"),ki(Y,_.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=_l(r);Pt(Y,_.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Me(s),a=bi(s);Pt(Y,_.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=wr(n);return k(r)&&Sd(Y,_.elementfocus,Xe(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=it(t,0,[H.NAME]),{target:r,path:i}=lr(n),s=wr(r),o=Ei(s,i);return k(o)&&Sd(Y,_.elementfocus,Xe(o),`${Me(o)}.${bi(o)}.json`),0}).command("gadget",()=>(yE(Y,_.elementfocus),0)).command("joincode",(e,t)=>{const[n]=it(t,0,[H.MAYBE_NAME]);return Jb(Y,_.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=it(t,0,[H.MAYBE_NAME]);return Zb(Y,_.elementfocus,!!n),0}),e4=li().command("toast",(e,t)=>{const n=t.map(be).join("");return Gb(Y,_.elementfocus,n),0}).command("palette",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=D1(),i=On(_.book,Et.PALETTE,n);return k(i)?(r.palette=i.id,Pt(Y,_.elementfocus,`loaded palette ${n}`)):ue(Y,_.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=D1(),i=On(_.book,Et.CHARSET,n);return k(i)?(r.charset=i.id,Pt(Y,_.elementfocus,`loaded charset ${n}`)):ue(Y,_.elementfocus,"not-found",`unabled to find charset ${n}`),0}),Df={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Yr(e){return re(e)&&i1(e[0])}function i1(e){return k(Gn[e])&&St(e)}function s1(e){if(St(e))return Df[Mt(e)]}function o1(e){if(Yr(e))return e;if(i1(e))return[e];const t=s1(e);if(k(t))return[t]}function wl(e){const t=_.words[e],n=o1(t);if(Yr(n))return[n,e+1];const[r,i]=fn(e),s=o1(r);return Yr(s)?[s,i]:[void 0,e]}const $f={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Yt.ISSOLID,Yt.ISWALK,Yt.ISSWIM,Yt.ISBULLET,Yt.ISWALK,Yt.ISSWIM;function Ti(e){return re(e)&&jf(e[0])}function jf(e){return k(Yt[e])&&St(e)}function n4(e){if(St(e))return $f[Mt(e)]}function a1(e){const t=_.words[e];if(Ti(t))return[t,e+1];if(jf(t))return[[t],e+1];const[n,r]=fn(e);return Ti(n)?[n,r]:jf(n)?[[n],r]:[void 0,e]}const r4=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),c1=new Set(["party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),i4=["NORTH","SOUTH","WEST","EAST"];function s4(e){const t=Es(e);if(Ct(t.inputcurrent)||(t.inputcurrent=0),re(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=mn.NONE,i=0]=n??[mn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&tT?1:0,t.inputctrl=i&eT?1:0,t.inputshift=i&nT?1:0,r){case mn.MOVE_UP:case mn.MOVE_DOWN:case mn.MOVE_LEFT:case mn.MOVE_RIGHT:t.inputmove=[i4[r-mn.MOVE_UP]];break;case mn.OK_BUTTON:t.inputok=1;break;case mn.CANCEL_BUTTON:t.inputcancel=1;break;case mn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==mn.NONE&&o!==r}),t}function o4(e){const t=Df[e];if(k(t))return t;const n=$f[e];if(k(n))return n;const r=zo[e];if(k(r))return r;const i=ed[e];if(k(i))return i}const a4=li({get(e,t){var o,a,c,u,l,h,f,d,p,m,x,w,T,v,I,U,S;const n=o4(t);if(k(n))return[!0,n];if(_.elementisplayer&&r4.has(t)){const N=s4(_.elementid)[t];return[k(N),N]}const r=yc(_.board,_.element,_.elementfocus),i=(r==null?void 0:r.id)??_.elementfocus;switch(t){case"isdark":return[!0,(o=_.board)!=null&&o.isdark?1:0];case"startx":return[!0,((a=_.board)==null?void 0:a.startx)??0];case"starty":return[!0,((c=_.board)==null?void 0:c.starty)??0];case"over":return[!0,((u=_.board)==null?void 0:u.over)??""];case"under":return[!0,((l=_.board)==null?void 0:l.under)??""];case"exitnorth":return[!0,((h=_.board)==null?void 0:h.exitnorth)??""];case"exitsouth":return[!0,((f=_.board)==null?void 0:f.exitsouth)??""];case"exitwest":return[!0,((d=_.board)==null?void 0:d.exitwest)??""];case"exiteast":return[!0,((p=_.board)==null?void 0:p.exiteast)??""];case"timelimit":return[!0,((m=_.board)==null?void 0:m.timelimit)??0];case"restartonzap":return[!0,((x=_.board)==null?void 0:x.restartonzap)??0];case"maxplayershots":return[!0,((w=_.board)==null?void 0:w.maxplayershots)??0];case"boardid":return[!0,((T=_.board)==null?void 0:T.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((v=_.element)==null?void 0:v.id)??""];case"thisx":return[!0,((I=_.element)==null?void 0:I.x)??-1];case"thisy":return[!0,((U=_.element)==null?void 0:U.y)??-1];default:{const N=(S=_.element)==null?void 0:S[t];if(c1.has(t))return[!0,N];break}}const s=Es(i)[t];return[k(s),s]},set(e,t,n){const r=yc(_.board,_.element,_.elementfocus),i=(r==null?void 0:r.id)??_.elementfocus;switch(t){case"isdark":k(_.board)&&(_.board.isdark=n?1:0);break;case"startx":k(_.board)&&(_.board.startx=jo(n,0));break;case"starty":k(_.board)&&(_.board.starty=jo(n,0));break;case"over":k(_.board)&&(_.board.over=be(n));break;case"under":k(_.board)&&(_.board.under=be(n));break;case"exitnorth":k(_.board)&&(_.board.exitnorth=be(n));break;case"exitsouth":k(_.board)&&(_.board.exitsouth=be(n));break;case"exitwest":k(_.board)&&(_.board.exitwest=be(n));break;case"exiteast":k(_.board)&&(_.board.exiteast=be(n));break;case"timelimit":k(_.board)&&(_.board.timelimit=jo(n,0));break;case"restartonzap":k(_.board)&&(_.board.restartonzap=n?1:0);break;case"maxplayershots":k(_.board)&&(_.board.maxplayershots=jo(n,0));break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(c1.has(t))return k(_.element)&&(_.element[t]=n),[!0,n];break}}const s=Es(i);return k(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=_.element)!=null&&e.removed)&&(k((t=_.element)==null?void 0:t.stepx)||k((n=_.element)==null?void 0:n.stepy))){const s={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};Qf(_.book,_.board,_.element,{x:s.x+(_.element.stepx??0),y:s.y+(_.element.stepy??0)})===!1&&(_.element.stepx=0,_.element.stepy=0,j_(_.book,_.element,"destructible")&&Hr(_.book,_.board,_.element,_.timestamp))}}}).command("clear",(e,t)=>(t.forEach(n=>e.set(be(n),0)),0)).command("set",(e,t)=>{const[n,r]=it(t,0,[H.NAME,H.ANY]);return e.set(n,r),0}).command("become",(e,t)=>{var r,i;const[n]=it(t,0,[H.KIND]);if(Er(_.book,_.board),If(_.book,_.board,_.element),Hr(_.book,_.board,_.element,_.timestamp)){const s={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};ga(_.book,_.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=it(t,0,[H.NUMBER]);return k(_.element)&&(_.element.char=n),0}).command("color",(e,t)=>{const[n]=it(t,0,[H.COLOR]);return k(_.element)&&k(n)&&vc(_.element,n),0}).command("go",(e,t)=>{if(k(_.element)){const[n]=it(t,0,[H.DIR]);if(Qf(_.book,_.board,_.element,n),e.yield(),_.element.x===n.x&&_.element.y===n.y)return 0}return 1}).command("walk",(e,t)=>{if(!k(_.element))return 0;const[n]=it(t,0,[H.DIR]),r=_.element.x??0,i=_.element.y??0;return _.element.stepx=n.x-r,_.element.stepy=n.y-i,0}),c4=li().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=it(t,0,[H.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(be(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(be(t[0])),0)).command("cycle",(e,t)=>{if(k(_.element)){const[n]=it(t,0,[H.NUMBER]);_.element.cycle=Bn(Math.round(n),1,255)}return 0}).command("die",e=>(Hr(_.book,_.board,_.element,_.timestamp),e.endofprogram(),0)).command("endgame",()=>(Nd(Y,_.elementfocus),0)).command("run",(e,t)=>{const[n]=it(t,0,[H.NAME]);return Ml(n),0}).command("runwith",(e,t)=>{const[n,r]=it(t,0,[H.ANY,H.NAME]);return e.set("arg",n),Ml(r),0}),xl={};function l4(e){var t;return(t=xl[e])==null?void 0:t.arg}function u4(e){var t;return(t=xl[e])==null?void 0:t.format}function ao(e){var t;return(t=xl[e])==null?void 0:t.content}function h4(e,t,n,r,i){const s=le(Ft.MAIN);if(!k(s))return;const o=ms(s,Et.LOADER).filter(a=>{const c=ps(a),u=c.format,l=St(u)?new RegExp(u).test(t):!1,h=c.event,f=St(h)?new RegExp(h).test(n):!1;return St(u)&&St(h)?l&&f:St(u)?l:St(h)?f:!1});for(let a=0;a<o.length;++a){const c=`${Ne()}_loader`;xl[c]={arg:e,format:t,content:r,player:i},jL(c,o[a].code)}}function l1(e,t){if(!k(e))return;const n=Mt(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const f4=(e,t)=>{const n=ao(e.id());if(!k(n))return 0;const[r,i]=it(t,0,[H.NAME]),s=Mt(r);switch(s){case"seek":{const[o]=it(t,i,[H.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=it(t,i,[H.NAME]);e.set(o,l1(n,s));break}case"text":{const[o,a]=it(t,i,[H.NAME,H.NAME]),c=l1(n,o);if(Ct(c)&&St(a)){const u=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(u);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=it(t,i,[H.NAME]),a=Tf(_.book,Et.PALETTE,o),c=un(a);if(k(c)){const u=Yk*uc,l=Cm(new Uint8Array(n.bytes.buffer,n.cursor,u));k(l)&&(c.bits=l.bits),n.cursor+=u}break}case"charset":{const[o]=it(t,i,[H.NAME]),a=Tf(_.book,Et.CHARSET,o),c=un(a);if(k(c)){const u=dc*Hk*eh,l=Lm(new Uint8Array(n.bytes.buffer,n.cursor,u));k(l)&&(c.bits=l.bits),n.cursor+=u}break}}return 0},co=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",kl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!kl(e[n],t[n]))return!1;return!0}if(co(e)&&co(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!kl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},Tl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(co(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},d4=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",u1=e=>e>="0"&&e<="9"||e==="-",p4=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var q;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(q||(q={}));const h1={"(":q.TOK_LPAREN,")":q.TOK_RPAREN,"*":q.TOK_STAR,",":q.TOK_COMMA,".":q.TOK_DOT,":":q.TOK_COLON,"@":q.TOK_CURRENT,$:q.TOK_ROOT,"]":q.TOK_RBRACKET,"{":q.TOK_LBRACE,"}":q.TOK_RBRACE},m4={"!":!0,"<":!0,"=":!0,">":!0},g4={"	":!0,"\n":!0,"\r":!0," ":!0};class y4{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(d4(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:q.TOK_UNQUOTEDIDENTIFIER,value:i});else if(h1[t[this._current]]!==void 0)n.push({start:this._current,type:h1[t[this._current]],value:t[this._current]}),this._current+=1;else if(u1(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:q.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:q.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:q.TOK_LITERAL,value:o})}else if(m4[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(g4[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:q.TOK_AND,value:"&&"})):n.push({start:r,type:q.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:q.TOK_OR,value:"||"})):n.push({start:r,type:q.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&p4(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;u1(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:q.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:q.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:q.TOK_FLATTEN,value:"[]"}):{start:n,type:q.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_NE,value:"!="}):{start:n,type:q.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_LTE,value:"<="}):{start:n,type:q.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_GTE,value:">="}):{start:n,type:q.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:q.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const _4=new y4,hn={[q.TOK_EOF]:0,[q.TOK_UNQUOTEDIDENTIFIER]:0,[q.TOK_QUOTEDIDENTIFIER]:0,[q.TOK_RBRACKET]:0,[q.TOK_RPAREN]:0,[q.TOK_COMMA]:0,[q.TOK_RBRACE]:0,[q.TOK_NUMBER]:0,[q.TOK_CURRENT]:0,[q.TOK_EXPREF]:0,[q.TOK_ROOT]:0,[q.TOK_PIPE]:1,[q.TOK_OR]:2,[q.TOK_AND]:3,[q.TOK_EQ]:5,[q.TOK_GT]:5,[q.TOK_LT]:5,[q.TOK_GTE]:5,[q.TOK_LTE]:5,[q.TOK_NE]:5,[q.TOK_FLATTEN]:9,[q.TOK_STAR]:20,[q.TOK_FILTER]:21,[q.TOK_DOT]:40,[q.TOK_NOT]:45,[q.TOK_LBRACE]:50,[q.TOK_LBRACKET]:55,[q.TOK_LPAREN]:60};class b4{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==q.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[..._4.tokenize(t),{type:q.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<hn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case q.TOK_LITERAL:return{type:"Literal",value:t.value};case q.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case q.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===q.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case q.TOK_NOT:return r=this.expression(hn.Not),{type:"NotExpression",children:[r]};case q.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===q.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(hn.Star),{type:"ValueProjection",children:[n,r]};case q.TOK_FILTER:return this.led(t.type,{type:"Identity"});case q.TOK_LBRACE:return this.parseMultiselectHash();case q.TOK_FLATTEN:return n={type:q.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(hn.Flatten),{type:"Projection",children:[n,r]};case q.TOK_LBRACKET:return this.lookahead(0)===q.TOK_NUMBER||this.lookahead(0)===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===q.TOK_STAR&&this.lookahead(1)===q.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(hn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case q.TOK_CURRENT:return{type:q.TOK_CURRENT};case q.TOK_ROOT:return{type:q.TOK_ROOT};case q.TOK_EXPREF:return i=this.expression(hn.Expref),{type:"ExpressionReference",children:[i]};case q.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(i={type:q.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(q.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case q.TOK_DOT:const i=hn.Dot;return this.lookahead(0)!==q.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case q.TOK_PIPE:return r=this.expression(hn.Pipe),{type:q.TOK_PIPE,children:[n,r]};case q.TOK_OR:return r=this.expression(hn.Or),{type:"OrExpression",children:[n,r]};case q.TOK_AND:return r=this.expression(hn.And),{type:"AndExpression",children:[n,r]};case q.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(a={type:q.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===q.TOK_COMMA&&this.match(q.TOK_COMMA),o.push(a);return this.match(q.TOK_RPAREN),{name:s,type:"Function",children:o};case q.TOK_FILTER:const u=this.expression(0);return this.match(q.TOK_RBRACKET),r=this.lookahead(0)===q.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(hn.Filter),{type:"FilterProjection",children:[n,r,u]};case q.TOK_FLATTEN:const l={type:q.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(hn.Flatten);return{type:"Projection",children:[l,h]};case q.TOK_EQ:case q.TOK_NE:case q.TOK_GT:case q.TOK_GTE:case q.TOK_LT:case q.TOK_LTE:return this.parseComparator(n,t);case q.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===q.TOK_NUMBER||f.type===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(q.TOK_STAR),this.match(q.TOK_RBRACKET),r=this.parseProjectionRHS(hn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===q.TOK_COLON||this.lookahead(1)===q.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(q.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(hn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==q.TOK_RBRACKET&&n<3;){if(r===q.TOK_COLON)n+=1,this.advance();else if(r===q.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(q.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(hn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER,q.TOK_STAR].includes(n))return this.expression(t);if(n===q.TOK_LBRACKET)return this.match(q.TOK_LBRACKET),this.parseMultiselectList();if(n===q.TOK_LBRACE)return this.match(q.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(hn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===q.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===q.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===q.TOK_DOT)return this.match(q.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==q.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===q.TOK_COMMA&&(this.match(q.TOK_COMMA),this.lookahead(0)===q.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(q.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(q.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===q.TOK_COMMA)this.match(q.TOK_COMMA);else if(this.lookahead(0)===q.TOK_RBRACE){this.match(q.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const E4=new b4;var ut;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class w4{constructor(t){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>co(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c>o&&(o=c,a=i[u]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c<o&&(o=c,a=i[u]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,u)=>{const l=i.visit(s,c[1]),h=i.visit(s,u[1]);if(this.getTypeName(l)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(l)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return l>h?1:l<h?-1:c[0]-u[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(m=>{var x;return(x=!m.optional)!==null&&x!==void 0?x:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,u=n.length<a,l=n.length>r.length,h=u&&(!c&&a>1||c)?"at least ":"";if(c&&u||!c&&(u||l))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let f,d,p;for(let m=0;m<r.length;m+=1){p=!1,f=r[m].types,d=this.getTypeName(n[m]);let x;for(x=0;x<f.length;x+=1)if(d!==void 0&&this.typeMatches(d,f[x],n[m])){p=!0;break}if(!p&&d!==void 0){const w=f.map(T=>this.TYPE_NAME_TABLE[T]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${m+1} to be type (${w}) but received type ${this.TYPE_NAME_TABLE[d]} instead.`)}}}typeMatches(t,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return t===ut.TYPE_ARRAY;if(t===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return t.jmespathType===q.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class x4{constructor(){this._rootValue=null,this.runtime=new w4(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,u,l,h,f,d;switch(t.type){case"Field":return n===null?null:co(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),f=1;f<t.children.length;f+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return u=this.visit(t.children[0],n),l=this.visit(t.children[1],u),l;case"Index":if(!Array.isArray(n))return null;let p=t.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...t.children],x=this.computeSliceParams(n.length,m),[w,T,v]=x;if(s=[],v>0)for(f=w;f<T;f+=v)s.push(n[f]);else for(f=w;f>T;f+=v)s.push(n[f]);return s;case"Projection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;for(h=[],f=0;f<d.length;f+=1)i=this.visit(t.children[1],d[f]),i!==null&&h.push(i);return h;case"ValueProjection":if(d=this.visit(t.children[0],n),!co(d))return null;h=[];const I=Object.values(d);for(f=0;f<I.length;f+=1)i=this.visit(t.children[1],I[f]),i!==null&&h.push(i);return h;case"FilterProjection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;const U=[],S=[];for(f=0;f<d.length;f+=1)r=this.visit(t.children[2],d[f]),Tl(r)||U.push(d[f]);for(let C=0;C<U.length;C+=1)i=this.visit(t.children[1],U[C]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case q.TOK_EQ:s=kl(o,a);break;case q.TOK_NE:s=!kl(o,a);break;case q.TOK_GT:s=o>a;break;case q.TOK_GTE:s=o>=a;break;case q.TOK_LT:s=o<a;break;case q.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case q.TOK_FLATTEN:const N=this.visit(t.children[0],n);if(!Array.isArray(N))return null;let P=[];for(f=0;f<N.length;f+=1)i=N[f],Array.isArray(i)?P=[...P,...i]:P.push(i);return P;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],f=0;f<t.children.length;f+=1)h.push(this.visit(t.children[f],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let L;for(f=0;f<t.children.length;f+=1)L=t.children[f],h[L.name]=this.visit(L.value,n);return h;case"OrExpression":return r=this.visit(t.children[0],n),Tl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),Tl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),Tl(o);case"Literal":return t.value;case q.TOK_PIPE:return u=this.visit(t.children[0],n),this.visit(t.children[1],u);case q.TOK_CURRENT:return n;case q.TOK_ROOT:return this._rootValue;case"Function":const V=[];for(let C=0;C<t.children.length;C+=1)V.push(this.visit(t.children[C],n));return this.runtime.callFunction(t.name,V);case"ExpressionReference":const Z=t.children[0];return Z.jmespathType=q.TOK_EXPREF,Z;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const k4=new x4;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function T4(e,t){const n=E4.parse(t);return k4.search(n,e)}const A4=(e,t)=>{const n=ao(e.id());if(!k(n))return 0;const[r,i]=it(t,0,[H.NAME,H.NAME]),s=T4(n.json,r);return e.set(i,s),0},v4=(e,t)=>{const n=ao(e.id());if(!k(n))return 0;const[r,i]=it(t,0,[H.NAME]);switch(Mt(r)){case"seek":{const[o]=it(t,i,[H.NUMBER]);n.cursor=Bn(o,0,n.lines.length-1);break}case"line":n.cursor=Bn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let u=1;for(let l=i;l<t.length;){const[h,f]=it(t,l,[H.NAME]);e.set(h,c[u]??0),++u,l=f}break}}return 0},S4=li({get(e,t){const n=u4(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=ao(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=ao(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=ao(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=it(t,0,[H.NAME,H.ANY]);return td(n,r),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(be).join(" ");return ti(Y,_.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n),s=r.map(be).join(" ");return ti(Y,_.elementfocus,"$175",`!${s};${i}`),0}).command("txt",v4).command("json",A4).command("bin",f4).command("with",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=br(_.book,Et.BOARD,n);if(r.length){const i=nn(...r);k(i)&&(_.board=un(i),_.element={x:Lr(0,Gt-1),y:Lr(0,ke-1)})}return 0});function f1(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,u]=it(i,a,[H.ANY]);re(c)&&!xr(c)&&!Yr(c)&&!Ti(c)&&!Pn(c)?o.push(...c):o.push(c),a=u}switch(Mt(r)){case"get":case"post:json":qb(Y,_.elementfocus,e,t,n,r,o);break}return 0}const R4=li().command("fetch",(e,t)=>{const[n,r,i="get",s]=it(t,0,[H.NAME,H.NAME,H.MAYBE_STRING]);return f1(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=it(t,0,[H.ANY,H.NAME,H.NAME,H.MAYBE_STRING]);return f1(n,r,i,s,t,o),0}).command("twitchchat",(e,t)=>{const[n]=it(t,0,[H.ANY]);switch(Mt(n)){default:Vb(Y,_.elementfocus,n);break;case"close":Xb(Y,_.elementfocus);break}return 0}).command("twitchbroadcast",(e,t)=>{const[n]=it(t,0,[H.NAME]);switch(Mt(n)){default:Hb(Y,_.elementfocus,n);break;case"stop":Yb(Y,_.elementfocus);break}return 0}),I4=li({set(e,t,n){return oM(e,t,n),[!1,void 0]},everytick(){const e=Zr(_.elementid),[t]=e;if(e.length===1&&St(t)){if(k(_.element))if(t.trim().length===0){const n=wn(_.elementid);n.sidebar=[]}else _.element.tickertext=t,_.element.tickertime=_.timestamp}else if(e.length>1)if(_.elementisplayer){const n=wn(_.elementid);n.sidebar=e}else{const n=wn(_.elementfocus);n.scroll=e}}}).command("send",(e,t)=>{var c,u;const[n,r]=it(t,0,[H.NAME,H.ANY]),[i,s]=r1(n);function o(l){for(let h=0;h<l.length;++h){const f=l[h];k(f.id)&&e.send(f.id,s,r)}}switch(Mt(i)){case"all":for(const l of Object.keys(((c=_.board)==null?void 0:c.objects)??{}))e.send(l,s,r);break;case"self":e.message({session:Y.session(),player:_.elementfocus,id:Ne(),sender:e.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((u=_.board)==null?void 0:u.objects)??{}))l!==e.id()&&e.send(l,s,r);break;default:{o(rm(_.board,[i]));break}}return 0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(be).join("");return se(_.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n);return Bt(_.elementid,e.id(),i,r,e.get,e.set),0});var Ki=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Ki||{});const N4={audio:nh,board:XC,cli:t4,display:e4,element:a4,runtime:I4,lifecycle:c4,loader:S4,network:R4},zf=["audio","board","display","network","lifecycle","element"],O4={0:[],1:["cli",...zf],2:["loader",...zf],3:["runtime",...zf]},C4={0:new Map,1:new Map,2:new Map,3:new Map};function lo(e){return(O4[e]??[]).map(n=>N4[n]).filter(k)}function Wf(e){const t=[],n=lo(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function L4(e,t){const n=C4[e];if(!n.has(t)){let r;const i=lo(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!k(r));++s);n.set(t,r)}return n.get(t)}function M4(e,t,n){const r=lo(e);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(t,n);if(s)return[s,o]}return[!1,void 0]}function U4(e,t,n,r){const i=lo(e);for(let s=0;s<i.length;++s){const[o]=i[s].set(t,n,r);if(o)return[o,r]}return[!1,void 0]}function F4(e,t){const n=lo(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function d1(e,t){const n=lo(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var p1={},m1={},g1={};const y1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");g1.encode=function(e){if(0<=e&&e<y1.length)return y1[e];throw new TypeError("Must be between 0 and 63: "+e)};const B4=g1,_1=5,b1=1<<_1,P4=b1-1,D4=b1;function $4(e){return e<0?(-e<<1)+1:(e<<1)+0}m1.encode=function(t){let n="",r,i=$4(t);do r=i&P4,i>>>=_1,i>0&&(r|=D4),n+=B4.encode(r);while(i>0);return n};var _a={};(function(e){function t(S,N,P){if(N in S)return S[N];if(arguments.length===3)return P;throw new Error('"'+N+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(S){const N=S.match(n);return N?{scheme:N[1],auth:N[2],host:N[3],port:N[4],path:N[5]}:null}e.urlParse=i;function s(S){let N="";return S.scheme&&(N+=S.scheme+":"),N+="//",S.auth&&(N+=S.auth+"@"),S.host&&(N+=S.host),S.port&&(N+=":"+S.port),S.path&&(N+=S.path),N}e.urlGenerate=s;const o=32;function a(S){const N=[];return function(P){for(let V=0;V<N.length;V++)if(N[V].input===P){const Z=N[0];return N[0]=N[V],N[V]=Z,N[0].result}const L=S(P);return N.unshift({input:P,result:L}),N.length>o&&N.pop(),L}}const c=a(function(N){let P=N;const L=i(N);if(L){if(!L.path)return N;P=L.path}const V=e.isAbsolute(P),Z=[];let C=0,R=0;for(;;)if(C=R,R=P.indexOf("/",C),R===-1){Z.push(P.slice(C));break}else for(Z.push(P.slice(C,R));R<P.length&&P[R]==="/";)R++;let b=0;for(R=Z.length-1;R>=0;R--){const B=Z[R];B==="."?Z.splice(R,1):B===".."?b++:b>0&&(B===""?(Z.splice(R+1,b),b=0):(Z.splice(R,2),b--))}return P=Z.join("/"),P===""&&(P=V?"/":"."),L?(L.path=P,s(L)):P});e.normalize=c;function u(S,N){S===""&&(S="."),N===""&&(N=".");const P=i(N),L=i(S);if(L&&(S=L.path||"/"),P&&!P.scheme)return L&&(P.scheme=L.scheme),s(P);if(P||N.match(r))return N;if(L&&!L.host&&!L.path)return L.host=N,s(L);const V=N.charAt(0)==="/"?N:c(S.replace(/\/+$/,"")+"/"+N);return L?(L.path=V,s(L)):V}e.join=u,e.isAbsolute=function(S){return S.charAt(0)==="/"||n.test(S)};function l(S,N){S===""&&(S="."),S=S.replace(/\/$/,"");let P=0;for(;N.indexOf(S+"/")!==0;){const L=S.lastIndexOf("/");if(L<0||(S=S.slice(0,L),S.match(/^([^\/]+:\/)?\/*$/)))return N;++P}return Array(P+1).join("../")+N.substr(S.length+1)}e.relative=l;const h=function(){return!("__proto__"in Object.create(null))}();function f(S){return S}function d(S){return m(S)?"$"+S:S}e.toSetString=h?f:d;function p(S){return m(S)?S.slice(1):S}e.fromSetString=h?f:p;function m(S){if(!S)return!1;const N=S.length;if(N<9||S.charCodeAt(N-1)!==95||S.charCodeAt(N-2)!==95||S.charCodeAt(N-3)!==111||S.charCodeAt(N-4)!==116||S.charCodeAt(N-5)!==111||S.charCodeAt(N-6)!==114||S.charCodeAt(N-7)!==112||S.charCodeAt(N-8)!==95||S.charCodeAt(N-9)!==95)return!1;for(let P=N-10;P>=0;P--)if(S.charCodeAt(P)!==36)return!1;return!0}function x(S,N,P){let L=T(S.source,N.source);return L!==0||(L=S.originalLine-N.originalLine,L!==0)||(L=S.originalColumn-N.originalColumn,L!==0||P)||(L=S.generatedColumn-N.generatedColumn,L!==0)||(L=S.generatedLine-N.generatedLine,L!==0)?L:T(S.name,N.name)}e.compareByOriginalPositions=x;function w(S,N,P){let L=S.generatedLine-N.generatedLine;return L!==0||(L=S.generatedColumn-N.generatedColumn,L!==0||P)||(L=T(S.source,N.source),L!==0)||(L=S.originalLine-N.originalLine,L!==0)||(L=S.originalColumn-N.originalColumn,L!==0)?L:T(S.name,N.name)}e.compareByGeneratedPositionsDeflated=w;function T(S,N){return S===N?0:S===null?1:N===null?-1:S>N?1:-1}function v(S,N){let P=S.generatedLine-N.generatedLine;return P!==0||(P=S.generatedColumn-N.generatedColumn,P!==0)||(P=T(S.source,N.source),P!==0)||(P=S.originalLine-N.originalLine,P!==0)||(P=S.originalColumn-N.originalColumn,P!==0)?P:T(S.name,N.name)}e.compareByGeneratedPositionsInflated=v;function I(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=I;function U(S,N,P){if(N=N||"",S&&(S[S.length-1]!=="/"&&N[0]!=="/"&&(S+="/"),N=S+N),P){const L=i(P);if(!L)throw new Error("sourceMapURL could not be parsed");if(L.path){const V=L.path.lastIndexOf("/");V>=0&&(L.path=L.path.substring(0,V+1))}N=u(s(L),N)}return c(N)}e.computeSourceURL=U})(_a);var Kf={};let j4=class ob{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new ob;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Kf.ArraySet=j4;var E1={};const w1=_a;function z4(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||w1.compareByGeneratedPositionsInflated(e,t)<=0}let W4=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){z4(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(w1.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};E1.MappingList=W4;const ba=m1,Pe=_a,Al=Kf.ArraySet,K4=E1.MappingList;let x1=class ab{constructor(t){t||(t={}),this._file=Pe.getArg(t,"file",null),this._sourceRoot=Pe.getArg(t,"sourceRoot",null),this._skipValidation=Pe.getArg(t,"skipValidation",!1),this._sources=new Al,this._names=new Al,this._mappings=new K4,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new ab({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Pe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=Pe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=Pe.getArg(t,"generated"),r=Pe.getArg(t,"original",null);let i=Pe.getArg(t,"source",null),s=Pe.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=Pe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Pe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Pe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Pe.relative(s,i));const o=this._mappings.toArray().length>0?new Al:this._sources,a=new Al;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=Pe.join(r,c.source)),s!=null&&(c.source=Pe.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const u=t.sourceContentFor(c);u!=null&&(r!=null&&(c=Pe.join(r,c)),s!=null&&(c=Pe.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,u,l,h;const f=this._mappings.toArray();for(let d=0,p=f.length;d<p;d++){if(u=f[d],c="",u.generatedLine!==n)for(t=0;u.generatedLine!==n;)c+=";",n++;else if(d>0){if(!Pe.compareByGeneratedPositionsInflated(u,f[d-1]))continue;c+=","}c+=ba.encode(u.generatedColumn-t),t=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=ba.encode(h-o),o=h,c+=ba.encode(u.originalLine-1-i),i=u.originalLine-1,c+=ba.encode(u.originalColumn-r),r=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=ba.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Pe.relative(n,r));const i=Pe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};x1.prototype._version=3,p1.SourceMapGenerator=x1;var k1={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,u=o(i,s[c],!0);return u===0?c:u>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(k1);var Ea={exports:{}},G4={},H4=Object.freeze({__proto__:null,default:G4}),T1=cb(H4);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;Ea.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Ea.exports.initialize=t=>e=t}else{const e=T1,t=T1;Ea.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Ea.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var A1=Ea.exports;const Y4=A1;function V4(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let wa=null;var X4=function(){if(wa)return wa;const t=[];return wa=Y4().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,u,l,h,f){const d=new V4;d.generatedLine=r+1,d.generatedColumn=i,s&&(d.lastGeneratedColumn=o-1),a&&(d.source=c,d.originalLine=u+1,d.originalColumn=l,h&&(d.name=f)),t[t.length-1](d)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw wa=null,n}),wa};const Tt=_a,Gf=k1,vl=Kf.ArraySet,q4=A1,J4=X4,Hf=Symbol("smcInternal");class Ue{constructor(t,n){return t==Hf?Promise.resolve(this):Q4(t,n)}static initialize(t){q4.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return tL(t,n)}static async with(t,n,r){const i=await new Ue(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Ue.prototype._version=3,Ue.GENERATED_ORDER=1,Ue.ORIGINAL_ORDER=2,Ue.GREATEST_LOWER_BOUND=1,Ue.LEAST_UPPER_BOUND=2;class xa extends Ue{constructor(t,n){return super(Hf).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version");let o=Tt.getArg(i,"sources");const a=Tt.getArg(i,"names",[]);let c=Tt.getArg(i,"sourceRoot",null);const u=Tt.getArg(i,"sourcesContent",null),l=Tt.getArg(i,"mappings"),h=Tt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Tt.normalize(c)),o=o.map(String).map(Tt.normalize).map(function(f){return c&&Tt.isAbsolute(c)&&Tt.isAbsolute(f)?Tt.relative(c,f):f}),r._names=vl.fromArray(a.map(String),!0),r._sources=vl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(f){return Tt.computeSourceURL(c,f,n)}),r.sourceRoot=c,r.sourcesContent=u,r._mappings=l,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,J4().then(f=>(r._wasm=f,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Tt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new xa(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Ue.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Tt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Ue.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Ue.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Tt.getArg(t,"source");const r=Tt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Tt.getArg(t,"bias",Ue.GREATEST_LOWER_BOUND);r==null&&(r=Ue.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Tt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Tt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Tt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Tt.getArg(i,"originalLine",null),column:Tt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Tt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Tt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Tt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Tt.getArg(t,"line"),originalColumn:Tt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Tt.getArg(t,"bias",Ue.GREATEST_LOWER_BOUND);i==null&&(i=Ue.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Tt.getArg(s,"generatedLine",null),column:Tt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}xa.prototype.consumer=Ue;class Z4 extends Ue{constructor(t,n){return super(Hf).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version"),o=Tt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new vl,r._names=new vl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=Tt.getArg(c,"offset"),l=Tt.getArg(u,"line"),h=Tt.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new Ue(Tt.getArg(c,"map"),n).then(d=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:d}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Tt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Tt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")},r=Gf.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Tt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const u=a[c];let l=Tt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(l),l=this._sources.indexOf(l);let h=null;u.name&&(this._names.add(u.name),h=this._names.indexOf(u.name));const f={source:l,generatedLine:u.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(o.generatedOffset.generatedLine===u.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:h};r.push(f),typeof f.originalLine=="number"&&i.push(f)}}}eachMapping(t,n,r){const i=n||null,s=r||Ue.GENERATED_ORDER;let o;switch(s){case Ue.GENERATED_ORDER:o=this._generatedMappings;break;case Ue.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let u=null;return c.source!==null&&(u=this._sources.at(c.source),u=Tt.computeSourceURL(a,u,this._sourceMapURL)),{source:u,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return Gf.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Tt.getArg(t,"line"),r={source:Tt.getArg(t,"source"),originalLine:n,originalColumn:Tt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Tt.compareByOriginalPositions,Gf.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function Q4(e,t){let n=e;typeof e=="string"&&(n=Tt.parseSourceMapInput(e));const r=n.sections!=null?new Z4(n,t):new xa(n,t);return Promise.resolve(r)}function tL(e,t){return xa.fromSourceMap(e,t)}var v1={};const eL=p1.SourceMapGenerator,Sl=_a,nL=/(\r?\n)/,rL=10,uo="$$$isSourceNode$$$";let iL=class dd{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[uo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new dd,s=t.split(nL);let o=0;const a=function(){const d=m(),p=m()||"";return d+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return n.eachMapping(function(d){if(l!==null)if(c<d.generatedLine)f(l,a()),c++,u=0;else{h=s[o]||"";const p=h.substr(0,d.generatedColumn-u);s[o]=h.substr(d.generatedColumn-u),u=d.generatedColumn,f(l,p),l=d;return}for(;c<d.generatedLine;)i.add(a()),c++;u<d.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,d.generatedColumn)),s[o]=h.substr(d.generatedColumn),u=d.generatedColumn),l=d},this),o<s.length&&(l&&f(l,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(d){const p=n.sourceContentFor(d);p!=null&&(r!=null&&(d=Sl.join(r,d)),i.setSourceContent(d,p))}),i;function f(d,p){if(d===null||d.source===void 0)i.add(p);else{const m=r?Sl.join(r,d.source):d.source;i.add(new dd(d.originalLine,d.originalColumn,m,p,d.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[uo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[uo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[uo]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[uo]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Sl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][uo]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Sl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new eL(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){n.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,f=u.length;h<f;h++)u.charCodeAt(h)===rL?(n.line++,n.column=0,h+1===f?(s=null,i=!1):i&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name})):n.column++}),this.walkSourceContents(function(u,l){r.setSourceContent(u,l)}),{code:n.code,map:r}}};v1.SourceNode=iL;var sL=v1.SourceNode;let S1=0;const R1=Mr,oL=["Command","lines"];class aL extends nC{constructor(){super(O_,{traceInitPerf:Mr,skipValidations:!Mr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Ot(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Ot(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(da)}])}));Ot(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Ot(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Ot(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Ot(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(i_)}));Ot(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(cf)}));Ot(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(lf)}])}));Ot(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(r_)}));Ot(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(s_),this.SUBRULE(this.words),this.CONSUME(o_)}));Ot(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(io),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Ot(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Ot(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Ot(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Ot(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(mf),this.SUBRULE(this.words)}));Ot(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(b_),this.SUBRULE(this.words)}));Ot(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(gf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Ot(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(gl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(da)),this.CONSUME4(io),this.CONSUME4(yf)}}])}));Ot(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(gl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(io),this.CONSUME(yf)}}])}));Ot(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(gl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Ot(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(io),this.CONSUME(_f),this.CONSUME(gf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ot(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(io),this.CONSUME(_f),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ot(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(T_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(A_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(v_),this.SUBRULE(this.words)}));Ot(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(S_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(R_)}));Ot(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(I_)}));Ot(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(x_)}));Ot(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(k_)}));Ot(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(uf),this.SUBRULE2(this.and_test)})}));Ot(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(ff),this.SUBRULE2(this.not_test)})}));Ot(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(hf),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Ot(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Ot(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(l_)},{ALT:()=>this.CONSUME(u_)},{ALT:()=>this.CONSUME(h_)},{ALT:()=>this.CONSUME(f_)},{ALT:()=>this.CONSUME(d_)},{ALT:()=>this.CONSUME(p_)}])}));Ot(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(uf),this.SUBRULE2(this.and_test_value)})}));Ot(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(ff),this.SUBRULE2(this.not_test_value)})}));Ot(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(hf),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Ot(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Ot(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(df)},{ALT:()=>this.CONSUME(pf)}]),this.SUBRULE(this.term)}));Ot(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Ot(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(g_)},{ALT:()=>this.CONSUME(mf)},{ALT:()=>this.CONSUME(y_)},{ALT:()=>this.CONSUME(__)}]),this.SUBRULE(this.factor)}));Ot(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(df)},{ALT:()=>this.CONSUME(pf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Ot(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(m_),this.SUBRULE(this.factor)})}));Ot(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Ot(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(a_)},{ALT:()=>this.CONSUME(on)},{ALT:()=>this.CONSUME(c_)},{ALT:()=>{this.CONSUME(E_),this.SUBRULE(this.expr),this.CONSUME(w_)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=oL.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(S1++).toString().padStart(3),c=s?"font-weight: bold;":"";if(R1&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${u.join(" ")}`,c)}r(),R1&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),S1--},i)}}const ho=new aL;if(rT){const e=ho.getGAstProductions(),t=pC(e);console.info(t)}const cL=ho.getBaseCstVisitorConstructor();var gt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(gt||{}),_s=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(_s||{}),Vr=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(Vr||{}),Rl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Rl||{});function lL(e){return!!(e!=null&&e.tokenType)}function or(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class uL extends cL{constructor(){super();Ot(this,"unique",0);Mr&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&lL(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():k(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:or(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:or(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:or(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:or(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:or(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,or(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Ne(),i=Ne();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Ne(),i=Ne();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,or(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Ne(),i=Ne();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Ne(),i=Ne(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Ne(),i=Ne(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Ne();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=or(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}command_toast(n){const i=or(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,"toast"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=or(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=or(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(or(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const hL=new uL,Cn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Il="zss.js";function Qt(e,t){return new sL(e.startLine??1,e.startColumn??1,Il,t)}function Yf(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Vf(e){return`'${Yf(e)}'`}function Nl(e){if(e.startsWith('"'))return Nl(e.replaceAll(/(^"|"$)/g,""));const t=Ff(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===Mf?`', api.get('${Yf(r.image.substring(1))}'), '`:Yf(r.image)).join("")}'].join('')`}function fo(e){return e.filter(t=>t!==void 0).map(ie)}function I1(e){return Qt(e,"")}function fL(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function He(e,t,n){return Qt(e,[`api.${t}(`,...fL(n,", "),")"])}function dL(e){if(e.type===gt.COMPARE&&e.compare.type===gt.COMPARE_ITEM)switch(e.compare.method){case _s.IS_EQ:return He(e,"isEq",[ie(e.lhs),ie(e.rhs)]);case _s.IS_NOT_EQ:return He(e,"isNotEq",[ie(e.lhs),ie(e.rhs)]);case _s.IS_LESS_THAN:return He(e,"isLessThan",[ie(e.lhs),ie(e.rhs)]);case _s.IS_GREATER_THAN:return He(e,"isGreaterThan",[ie(e.lhs),ie(e.rhs)]);case _s.IS_LESS_THAN_OR_EQ:return He(e,"isLessThanOrEq",[ie(e.lhs),ie(e.rhs)]);case _s.IS_GREATER_THAN_OR_EQ:return He(e,"isGreaterThanOrEq",[ie(e.lhs),ie(e.rhs)])}return Qt(e,"")}function bs(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ie(n),")"])}function N1(e,t,n){return e.prepend(`api.${t}(`),e.add([ie(n),")"])}function pL(e,t){if(e.type===gt.OPERATOR_ITEM)switch(e.operator){case Vr.PLUS:return bs(t,"opPlus",e.rhs);case Vr.MINUS:return bs(t,"opMinus",e.rhs);case Vr.POWER:return bs(t,"opPower",e.rhs);case Vr.MULTIPLY:return bs(t,"opMultiply",e.rhs);case Vr.DIVIDE:return bs(t,"opDivide",e.rhs);case Vr.MOD_DIVIDE:return bs(t,"opModDivide",e.rhs);case Vr.FLOOR_DIVIDE:return bs(t,"opFloorDivide",e.rhs);case Vr.UNI_PLUS:return N1(t,"opUniPlus",e.rhs);case Vr.UNI_MINUS:return N1(t,"opUniMinus",e.rhs)}return Qt(e,"")}function mL(e){if(e.type===gt.OPERATOR){const t=e.lhs?ie(e.lhs):Qt(e,"");return e.items.forEach(n=>pL(n,t)),t}return Qt(e,"")}function Ol(e,t){return Qt(e,[He(e,"jump",[`${t}`]),"; continue;"])}function Ai(e){return Cn.linelookup[e??""]??-1}function Xf(e,t){Cn.linelookup[e]=t}function po(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&(i.done=n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&(i.skip=n);break;case gt.LINE:po(i.stmts,t,n);break}}}function O1(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&Xf(i.done,n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&Xf(i.skip,n);break;case gt.LINE:O1(i.stmts,t,n);break}}}function ie(e){var t;switch(e.type){case gt.PROGRAM:return Qt(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ie).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Il}`]);case gt.API:return Qt(e,["  ",He(e,e.method,fo(e.words)),`;
`]);case gt.LINE:return Qt(e,[`case ${e.lineindex}:
`,...e.stmts.map(ie).flat(),`  break;
`]);case gt.MARK:return Qt(e,`  // ${e.comment}
`);case gt.GOTO:{const n=Ai(e.id);return Qt(e,["  ",Ol(e,n),`
`])}case gt.COUNT:return Qt(e,`${e.index}`);case gt.LITERAL:switch(e.literal){case Rl.NUMBER:return Qt(e,`${e.value}`);case Rl.STRING:return Qt(e,Vf(e.value));case Rl.TEMPLATE:return Qt(e,Nl(e.value))}return I1(e);case gt.TEXT:return Qt(e,["  ",He(e,"text",[Nl(e.value)]),`;
`]);case gt.STAT:if(Cn.isfirststat){Cn.isfirststat=!1;const n=e.value.trim().split(" ").map(Vf);return Qt(e,["  ",He(e,"stat",n),`;
`])}return Qt(e,`  // skipped ${e.value}
`);case gt.LABEL:{const n=Mt(e.name),r=e.active?"label":"comment";Cn.labels[n]||(Cn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Cn.labels[n].push(i),Qt(e,`  // ${i} '${n}' ${r}
`)}case gt.HYPERLINK:return Qt(e,["  ",He(e,"hyperlink",[Nl(e.text),...fo(e.link)]),`;
`]);case gt.MOVE:{const n=He(e,"command",[Vf("go"),fo(e.words)].flat());return e.wait?Qt(e,["  if (",n,`) { continue; };
`]):Qt(e,["  ",n,`;
`])}case gt.COMMAND:return Qt(e,["  if (",He(e,"command",fo(e.words)),`) { continue; };
`]);case gt.IF:{const n=((t=e.block)==null?void 0:t.type)===gt.IF_BLOCK?e.block:void 0;if(k(n)){po([e.check],gt.IF_CHECK,n.skip);const r=Qt(e,ie(e.check));return n.lines.forEach(i=>r.add(ie(i))),O1(n.altlines,gt.ELSE_IF,Ai(n.done)),n.altlines.forEach(i=>r.add(ie(i))),r}return Qt(e,ie(e.check))}case gt.IF_CHECK:{const n=Ai(e.skip);return n===-1?Qt(e,["  ",He(e,e.method,fo(e.words)),`;
`]):Qt(e,["  if (!",He(e,e.method,fo(e.words)),") { ",Ol(e,n),` }
`])}case gt.ELSE_IF:case gt.ELSE:{const n=Qt(e,"");return e.lines.forEach(r=>n.add(ie(r))),n}case gt.WHILE:{const n=Ai(e.loop),r=Ai(e.done),i=Qt(e,"");return po(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.REPEAT:{const n=Ai(e.loop),r=Ai(e.done),i=Qt(e,"");return po(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.WAITFOR:{const n=Qt(e,"");return po(e.lines,gt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ie(r))}),n}case gt.FOREACH:{const n=Ai(e.loop),r=Ai(e.done),i=Qt(e,"");return po(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.BREAK:return Qt(e,["  ",Ol(e,e.goto),`
`]);case gt.CONTINUE:return Qt(e,["  ",Ol(e,e.goto),`
`]);case gt.OR:return He(e,"or",e.items.map(ie));case gt.AND:return He(e,"and",e.items.map(ie));case gt.NOT:return He(e,"not",e.items.map(ie));case gt.COMPARE:return dL(e);case gt.OPERATOR:return mL(e);case gt.EXPR:return He(e,"expr",e.words.map(ie));default:return console.error("<unsupported node>",e.type,e),I1(e)}}function Xr(e){if(k(e))switch(e.type===gt.LINE&&++Cn.lineindex,e.lineindex=Cn.lineindex,e.type){case gt.PROGRAM:e.lines.forEach(Xr);break;case gt.LINE:e.stmts.forEach(Xr);break;case gt.MARK:Xf(e.id,e.lineindex);break;case gt.IF:Xr(e.check),Xr(e.block);break;case gt.IF_BLOCK:e.lines.forEach(Xr),e.altlines.forEach(Xr);break;case gt.ELSE_IF:e.lines.forEach(Xr);break;case gt.ELSE:case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.WAITFOR:e.lines.forEach(Xr);break;case gt.MOVE:case gt.COMMAND:case gt.IF_CHECK:e.words.forEach(Xr);break}}function gL(e){return Cn.labels={},Cn.internal=1,Cn.lineindex=0,Cn.isfirststat=!0,Xr(e),{...ie(e).toStringWithSourceMap({file:`${Il}.map`}),...Cn}}function C1(e){return re(e)?e.length>0?1:0:e??0}function yL(e){return`${e}_chip`}function L1(e=""){return`vm:${e??""}`}function _L(e,t,n){var u,l;const r=yL(e),i=Es(r);let s;const o=Xe(Object.entries(n.labels??{}));(!re(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((u=n.errors)==null?void 0:u.length)??0)!==0?1:0);function a(h,f){_.words=f;const d=L4(t,h);return k(d)?d(c,f):h!=="send"?a("send",[h,...f]):0}const c={halt(){ML(r)},id(){return e},set(h,f){const[d,p]=U4(t,c,h,f);if(d)return p},get(h){const[f,d]=M4(t,c,h);if(f)return d},tick(h){const f=Ct(i.ps)?i.ps:0,d=f%h===0;if(i.ps=f+1,d===!1)return!1;if(c.shouldtick()===!1)return d1(t,c),!1;i.lc=0,i.ys=0,_.get=c.get,F4(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){ue(Y,_.elementfocus,"crash",p.message),i.es=1}return d1(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Ct(i.lc)?++i.lc>ci.HALT_AT_COUNT:!0},hm(){if(re(i.mg)&&re(i.lb)){const[h]=i.mg;if(k(h))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)return p.find(m=>Ct(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,f,d,p){Y.emit(h,`${L1(f)}:${d}`,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(re(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h){const m=p.findIndex(x=>x>0);m>=0&&(p[m]*=-1)}}},restore(h){if(re(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)for(let m=0;m<p.length;m++)p[f]=Math.abs(p[f])}},getcase(){i.ec=Ct(i.ec)?i.ec:1;const h=c.hm();if(h&&re(i.mg)){const[,f,d,p]=i.mg;c.set("sender",d),k(f)&&c.set("arg",f),p&&(c.set("player",p),_.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=Ct(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const f=Gk.parse(h),[d]=f.filter(p=>p.fileName===Il);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[f,...d]=h;return a(Mt(be(f)),d)},if(...h){const[f,d]=it(h,0,[H.ANY]),p=C1(f);return p&&d<h.length&&c.command(...h.slice(d)),p?1:0},try(...h){const[,f]=it(h,0,[H.DIR]),d=c.command("go",...h);return d&&f<h.length&&c.command(...h.slice(f)),d?1:0},take(...h){const[f,d,p]=it(h,0,[H.NAME,H.ANY]),m=Ct(d),x=m?p:1,w=c.get(f),T=m?d:1;if(!Ct(w))return x<h.length&&c.command(...h.slice(x)),1;const v=w-T;return v<0?(x<h.length&&c.command(...h.slice(x)),1):(c.set(f,v),0)},give(...h){const[f,d,p]=it(h,0,[H.NAME,H.ANY]),m=Ct(d),x=m?p:1,w=c.get(f),T=m?d:1,v=w===void 0?1:0;return v&&x<h.length&&c.command(...h.slice(x)),c.set(f,jo(w,0)+T),v},repeatstart(h,...f){const[d,p]=it(f,0,[H.NUMBER]),m=`repeatcount${h}`,x=`repeatwords${h}`;i[m]=d,i[x]=p<f.length?f.slice(p):void 0},repeat(h){const f=`repeatcount${h}`,d=`repeatwords${h}`;if(!Ct(i[f]))return 0;const p=i[f];i[f]=p-1;const m=p>0,x=i[d];return m&&re(x)&&c.command(...x),m?1:0},foreachstart(h,...f){const[d,p,m,x]=it(f,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let w=Math.min(p,m),T=Math.max(p,m);const v=(x??0)||1;if(v<0){const I=w;w=T,T=I}return c.set(d,w-v),0},foreach(h,...f){const[d,p,m,x,w]=it(f,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let T=Math.min(p,m),v=Math.max(p,m);const I=(x??0)||1;if(I<0){const N=T;T=v,v=N}let U=c.get(d);!Ct(U)||U<T||U>v?U=T:U+=I;const S=U<=v?1:0;return S&&(c.set(d,U),w<f.length&&c.command(...f.slice(w))),S},waitfor(...h){const[f]=it(h,0,[H.ANY]),d=C1(f);return d||c.yield(),d?1:0},or(...h){let f=0;for(let d=0;d<h.length;){const[p,m]=it(h,d,[H.ANY]);if(f=p,f)break;d=m}return f},and(...h){let f=0;for(let d=0;d<h.length;){const[p,m]=it(h,d,[H.ANY]);if(f=p,!f)break;d=m}return f},not(...h){const[f]=it(h,0,[H.ANY]);return f?0:1},expr(...h){const[f]=it(h,0,[H.ANY]);return f},isEq(h,f){const[d]=it([h],0,[H.ANY]),[p]=it([f],0,[H.ANY]);return typeof d=="object"||typeof p=="object"?jb(d,p)?1:0:d===p?1:0},isNotEq(h,f){return this.isEq(h,f)?0:1},isLessThan(h,f){const[d]=it([h],0,[H.NUMBER]),[p]=it([f],0,[H.NUMBER]);return d<p?1:0},isGreaterThan(h,f){const[d]=it([h],0,[H.NUMBER]),[p]=it([f],0,[H.NUMBER]);return d>p?1:0},isLessThanOrEq(h,f){const[d]=it([h],0,[H.NUMBER]),[p]=it([f],0,[H.NUMBER]);return d<=p?1:0},isGreaterThanOrEq(h,f){const[d]=it([h],0,[H.NUMBER]),[p]=it([f],0,[H.NUMBER]);return d>=p?1:0},opPlus(h,f){const[d]=it([h],0,[H.ANY]),[p]=it([f],0,[H.ANY]);return d+p},opMinus(h,f){const[d]=it([h],0,[H.ANY]),[p]=it([f],0,[H.ANY]);return d-p},opPower(h,f){const[d]=it([h],0,[H.NUMBER]),[p]=it([f],0,[H.NUMBER]);return Math.pow(d,p)},opMultiply(h,f){const[d]=it([h],0,[H.NUMBER]),[p]=it([f],0,[H.NUMBER]);return d*p},opDivide(h,f){const[d]=it([h],0,[H.NUMBER]),[p]=it([f],0,[H.NUMBER]);return d/p},opModDivide(h,f){const[d]=it([h],0,[H.NUMBER]),[p]=it([f],0,[H.NUMBER]);return d%p},opFloorDivide(h,f){const[d]=it([h],0,[H.NUMBER]),[p]=it([f],0,[H.NUMBER]);return Math.floor(d/p)},opUniPlus(h){const[f]=it([h],0,[H.NUMBER]);return+f},opUniMinus(h){const[f]=it([h],0,[H.NUMBER]);return-f}};return s=(l=n.code)==null?void 0:l.call(n,c),c}function qf(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];re(r)?r.forEach(i=>{t.push(qf(i))}):t.push(qf(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function bL(e){const t=bf(`${e}
`);if(t.errors.length>0)return t;ho.input=t.tokens;const n=ho.program();if(ho.errors.length>0)return{tokens:t.tokens,errors:ho.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=hL.go(n);return r?(qf(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Jf=Object.getPrototypeOf(function*(){}).constructor;function EL(e,t){const n=`compile-${e}`;console.time(n);const r=bL(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=gL(r.ast);if(i.code){iT&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Jf("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Jf("api"," ")}}}return{...r,...i,source:"",code:new Jf("api"," ")}}function wL(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=EL(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return k(s)?s.isended():!0},halt(i){const s=t[i];return k(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];k(o)&&o.set("arg",s)},tick(i,s,o,a,c){var l;let u=t[i];if(!k(t[i])){const h=n(a,c);if(u=t[i]=_L(i,s,h),(l=h.errors)!=null&&l.length){const[f]=h.errors,d=((f==null?void 0:f.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((w,T)=>[w,T]);p.slice(d-5,d).forEach(([w,T])=>{ue(Y,qr(),"build",`$grey${T+1} $grey${w}`)});const[m,x]=p[d]??[];if(St(m)&&k(x)){const w=(f.column??1)-1,T=w+f.length,v=w<m.length?m:`${m}*`,I=v.substring(0,w),U=v.substring(w,T),S=v.substring(T);ue(Y,qr(),"build",`$red${x+1} $grey${I}$red${U}$grey${S}`)}return f.message.split(`
`).forEach(w=>{ue(Y,qr(),"build",w)}),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=lr(i.target),a=t[s];if(k(a)){const c={...i,target:o};a.message(c)}}};return r}let M1=0;function xL(){switch(M1++){case 0:return Wt.BLUE;case 1:return Wt.GREEN;case 2:return Wt.CYAN;case 3:return Wt.RED;case 4:return Wt.PURPLE;case 5:return Wt.YELLOW;default:return M1=0,Wt.WHITE}}const De=new Do,bn={},Cl={};function U1(e,t,n,r,i=0){const s=`tiles:${e}:${t}`;return k(bn[s])||(bn[s]=Vk(e,t,n,r,i)),bn[s]}function kL(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return k(Cl[s])||(Cl[s]=Xk(e,t,n)),Cl[s].id=i,Cl[s]}function TL(e,t){const n=`sprites:${e}:${t}`;return k(bn[n])||(bn[n]=qk(e,t)),bn[n]}function AL(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return k(bn[s])||(bn[s]=Jk(e,t,n,r,i)),bn[s]}function F1(e,t,n,r){const i=`media:${e}:${t}`;k(bn[i])||(bn[i]=Zk(e,t,n,r));const s=bn[i];return s.mime=n,s.media=r,s}function vL(e,t){const n=`control:${e}:${t}`;return k(bn[n])||(bn[n]=Qk(e,t)),bn[n]}const Gi=.4;function B1(e,t){const n=[];De.x=e-Gi,De.y=t-Gi,n.push(De.angle()),De.x=e+Gi,De.y=t-Gi,n.push(De.angle()),De.x=e-Gi,De.y=t+Gi,n.push(De.angle()),De.x=e+Gi,De.y=t+Gi,n.push(De.angle());const r=Math.round(Qu(Math.min(...n))),i=Math.round(Qu(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function SL(e,t,n,r,i){var S;if(!k(r)||!k(r.terrain)||!k(r.objects))return[];const s=[];let o=t;const a=o===0,c=Gt,u=ke,l=a?Wt.BLACK:Wt.ONCLEAR,h=U1(e,o++,c,u,l);s.push(h);const f=o++,d=TL(e,f);d.sprites=[],s.push(d);const p=r.isdark?1:0,m=AL(e,o++,c,u,p);s.push(m),m.alphas.fill(p);const x=U1(e,o++,c,u,Wt.ONCLEAR);s.push(x),x.char.fill(0);const w={...Bf(Gt,ke,xL(),Wt.ONCLEAR),...x},T=vL(e,o++);i&&s.push(T);for(let N=0;N<r.terrain.length;++N){const P=r.terrain[N],L=z_(n,P,0,Wt.BLACK,Wt.ONCLEAR);h.char[N]=L.char,h.color[N]=L.color,h.bg[N]=L.bg}const v=Object.values(r.objects??{});for(let N=0;N<v.length;++N){const P=v[N];if(k(P.removed))continue;const L=P.id??"",V=z_(n,P,1,Wt.WHITE,Wt.BLACK),Z=kL(e,f,L,N);if(Z.x=P.x??0,Z.y=P.y??0,Z.char=V.char,Z.color=V.color,Z.bg=V.bg,d.sprites.push(Z),p){if(V.light>0){const C=[],R=Bn(Math.round(V.light),1,10),b=R*.5,B=Jr(r,Z),X=1/b;if(m.alphas[B]=0,R>1)for(let D=1;D<=R;++D)for(let lt=Z.y-D;lt<=Z.y+D;++lt)for(let et=Z.x-D;et<=Z.x+D;++et){if(et===Z.x&&lt===Z.y)continue;De.x=et-Z.x,De.y=lt-Z.y;const ft=De.length();if(ft>R)continue;const K=Jr(r,{x:et,y:lt});if(K===-1)continue;const z=Math.round(Qu(De.angle()));let bt=0;for(let At=0;At<C.length;++At){const kt=C[At];z>=kt[0]&&z<=kt[1]&&(bt=Math.max(bt,kt[2]))}m.alphas[K]=Math.min(m.alphas[K],bt+(ft<b?0:(ft-b)*X)),m.alphas[K]=Bn(m.alphas[K],0,1);const ot=Ln(r,((S=r.lookup)==null?void 0:S[K])??"");if(k(ot)){const At=[...B1(De.x,De.y),.25];C.push(At)}const ct=r.terrain[K],Lt=wi(n,ct),ne=(ct==null?void 0:ct.collision)??(Lt==null?void 0:Lt.collision);if(rh(Yt.ISBULLET,ne)){const At=[...B1(De.x,De.y),1];let kt=0;for(kt=0;kt<C.length;++kt){const zt=C[kt];if(zt[1]>zt[0]&&At[1]>=zt[0]&&At[0]<=zt[1]&&At[2]>=1&&zt[2]>=1){C[kt]=[Math.min(At[0],zt[0]),Math.max(At[1],zt[1]),1];break}}kt===C.length&&C.push(At)}}}else if(Vi(L)){const C=Jr(r,Z);m.alphas[C]=0}}if(St(P.tickertext)&&Ct(P.tickertime)&&P.tickertext.length){const C=Gt,R=e1(P.tickertext,C,ke-1),b=(R==null?void 0:R.measuredwidth)??1,B=P.x??0,X=P.y??0,D=X<ke*.5;w.x=B-Math.floor(b*.5),w.y=X+(D?1:-1),w.x+b>Gt&&(w.x=Gt-b),w.x<0&&(w.x=0),t1(P.tickertext,w,!0)}L===e&&(T.focusx=Z.x,T.focusy=Z.y,T.focusid=L)}const I=le(Ft.MAIN),U=xi(I,Ft.MAIN);if(St(U.palette)){const N=On(I,Et.PALETTE,U.palette),P=un(N);k(P==null?void 0:P.bits)&&s.push(F1(e,o++,"image/palette",Array.from(P.bits)))}if(St(U.charset)){const N=On(I,Et.CHARSET,U.charset),P=un(N);k(P==null?void 0:P.bits)&&s.push(F1(e,o++,"image/charset",Array.from(P.bits)))}return s}const zn=wL();var Ft=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Ft||{});const ge={halt:!1,session:Ne(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function RL(){return ge.session}function qr(){return ge.operator}function IL(e){ge.operator=e}function NL(e){ge.halt=e}function OL(){return ge.halt}function mo(){return[...ge.books.values()]}function CL(){const[e]=ge.books.values();return e}function wr(e){const t=Mt(e);return ge.books.get(e)??mo().find(n=>n.name===t)}function Ll(e,t){k(wr(t))&&(ge.software[e]=t)}function le(e){return wr(ge.software[e])}function P1(e){const t=B_([]);return St(e)&&(t.name=e),Zf(t),ti(Y,ge.operator,`created [book] ${t.name}`),t}function LL(e){let t=wr(e);return k(t)||(t=B_([]),t.name=e),Zf(t),ti(Y,ge.operator,`created [book] ${t.name}`),t}function En(e,t){let n=k(t)?LL(t):le(e);return k(n)||(k(n)||(n=CL()),k(n)||(n=P1(t)),k(n)&&ti(Y,ge.operator,`opened [book] ${n.name} for ${e}`)),Ll(e,n.id),n}function Hi(e,t,n){return Tf(En(e),n,t)}function Es(e){const t=En("main");return xi(t,e)}function D1(){const e=En("main");return xi(e,"main")}function ML(e){const t=En("main");return W_(t,e)}function UL(e,t){ge.books.clear(),e.forEach(r=>{ge.books.set(r.id,r),r.name==="main"&&(ge.software.main=r.id)});const n=wr(t);if(k(n)&&Ll("main",n.id),!ge.software.main){const r=ge.books.values().next();r.value&&(ge.software.main=r.value.id)}}function Zf(e){return ge.books.set(e.id,e),e.id}function FL(e){const t=wr(e);t&&ge.books.delete(t.id)}function BL(e){if(!St(e)||!e)return ue(Y,e,"login",`failed for playerid ==>${e}<==`);const t=le("main");if(!k(t))return ue(Y,e,"login:main","login failed to find book 'main'");const n=gs(t,e);if(k(n))return!0;const r=br(t,Et.BOARD,"title");if(r.length===0)return ue(Y,e,"login:title","login failed to find board with 'title' stat");const i=ma(t,"player");if(!k(i))return ue(Y,e,"login:player","login failed to find object type 'player'");const s=$0(e,r),o=un(s);if(k(o)){const a=F_(s,"startx"),c=F_(s,"starty"),u=Ct(a)?a:Math.round(Gt*.5),l=Ct(c)?c:Math.round(ke*.5),h=i.name??"player",f=od(o,{x:u,y:l},h,e);if(k(f==null?void 0:f.id))return f.player=e,bl(t,e,o.id),!0}return!1}function PL(e){const t=le("main"),n=gs(t,e);bl(t,e,""),If(t,n,Ln(n,e)),H1(n,e),zn.halt(e),W_(t,e)}function ar(e){const t=le("main");return gs(t,e)}function DL(e){const t=le("main"),n=IC(t,e),r=gs(t,e),i=Ln(r,e);return n&&k(i)}function $L(e){const t=le("main"),n=vf(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Vi(c)&&k(e[c])===!1&&(e[c]=0,bl(t,c,i.id))}}}function $1(e){zn.message(e)}function ka(e,t,n,r){const i=Fr(t);St(n.id)&&Y.emit(e,"vm:touched",[n.id,i,r])}function Qf(e,t,n,r){if(!k(n==null?void 0:n.id))return!1;const i=G_(e,t,n,r);if(k(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=br(e,Et.BOARD,(t==null?void 0:t.exitwest)??"");if(o.length){const a=nn(o);oo(e,n.id,a.id,{x:Gt-1,y:r.y})}}else if(r.x>=Gt){const o=br(e,Et.BOARD,(t==null?void 0:t.exiteast)??"");if(o.length){const a=nn(o);oo(e,n.id,a.id,{x:0,y:r.y})}}else if(r.y<0){const o=br(e,Et.BOARD,(t==null?void 0:t.exitnorth)??"");if(o.length){const a=nn(o);oo(e,n.id,a.id,{x:r.x,y:ke-1})}}else if(r.y>=ke){const o=br(e,Et.BOARD,(t==null?void 0:t.exitsouth)??"");if(o.length){const a=nn(o);oo(e,n.id,a.id,{x:r.x,y:0})}}}else ka("",i,n,"thud");if(n.kind==="player"){const o=Vi(i.id);ka(n.id,n,i,o?"bump":"touch")}else if(n.collision===Yt.ISBULLET){const o=Vi(n.party),a=Vi(i.id);o!==a?ka(n.party??"",n,i,"shot"):ka("",n,i,"thud")}else ka("",n,i,"bump");const s=wi(e,i);return i.destructible??(s==null?void 0:s.destructible)?(k(i==null?void 0:i.id)?Hr(_.book,_.board,i,_.timestamp):kr(t,{x:r.x,y:r.y}),!0):!1}return!0}function j1(e,t,n,r,i=SE){var h;if(!k(e)||!k(t)||!k(n))return;const s={..._};_.book=e,_.board=t,_.element=n,_.elementid=n.id??"",_.elementisplayer=Vi(_.elementid);const o=_.element.player??ge.operator;_.elementfocus=_.elementisplayer?_.elementid:o;const a=wi(e,n),c=n.cycle??(a==null?void 0:a.cycle)??i,u=n.id??"",l=Mt(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(zn.tick(u,Ki.RUNTIME,Ct(c)?c:i,l,r),Ct(n==null?void 0:n.tickertime)&&_.timestamp-n.tickertime>Oa*5&&(n.tickertime=0,n.tickertext=""),_.elementisplayer){const f=Es(_.elementid);Ct(f.inputcurrent)&&(f.inputcurrent=0)}Kn(s).forEach(f=>{_[f]=s[f]})}function jL(e,t){ge.loaders.set(e,t)}function zL(e){zn.halt(e)}function WL(){const e=zn.ids();for(let n=0;n<e.length;++n)zn.halt(e[n]);const t=le("main");k(t)&&(t.flags={})}function KL(){const e=le("main");if(!k(e))return;const t=e.timestamp+1,n=ci.HALT_AT_COUNT;ci.HALT_AT_COUNT=n*2,ge.loaders.forEach((i,s)=>{const o={..._};_.timestamp=e.timestamp,_.book=e,_.board=void 0,_.element=void 0,_.elementid=s,_.elementisplayer=!1,_.elementfocus=ge.operator;const a=l4(s);k(a)&&zn.arg(s,a),zn.tick(s,Ki.LOADER,1,"loader",i),zn.isended(s)&&(zn.halt(s),ge.loaders.delete(s)),Kn(o).forEach(c=>{_[c]=o[c]})}),ci.HALT_AT_COUNT=n,e.timestamp=t,_.timestamp=t;const r=vf(e);for(let i=0;i<r.length;++i){const s=r[i],o=UC(e,s,t);for(let a=0;a<o.length;++a){const{id:c,type:u,code:l,object:h}=o[a];u===Et.ERROR?zn.halt(c):j1(e,s,h,l)}}}function td(e,t){const n=le("main");if(!k(n))return;function r(a,c){for(let u=0;u<a.length;++u){const l=a[u];if(k(l.id)){const h=`${L1(l.id)}:${c}`;Y.emit(h,t)}}}const{target:i,path:s}=lr(e),o=vf(n);for(let a=0;a<o.length;++a){const c=o[a];switch(Mt(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(rm(c,[i]),s);break}}}}function GL(e,t=""){var s;const n=En("main");if(!k(n))return;const r=`${e}_cli`;_.timestamp=n.timestamp,_.book=n,_.board=gs(n,e),_.element=Ln(_.board,e),_.elementid=((s=_.element)==null?void 0:s.id)??"",_.elementisplayer=!0,_.elementfocus=_.elementid||e;const i=ci.HALT_AT_COUNT;ci.HALT_AT_COUNT=i*8,vd(Y,e,"running",n.timestamp,r,t),zn.once(r,Ki.CLI,"cli",t),ci.HALT_AT_COUNT=i}function Ml(e){var o;const t=En("main"),n=Ei(t,e);if(!k(t)||!k(n)||!k(_.element))return;const r=`${e}_run`,i=Mt(_.element.name??((o=_.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";zn.once(r,Ki.RUNTIME,i,s)}function HL(e){const t=le("main"),n=gs(t,e),r=[];if(!k(t)||!k(n))return r;const i=so(t,n.over??""),s=so(t,n.under??""),o=[i,n,s];let a=0;for(let c=0;c<o.length;++c){const u=o[c],l=SL(e,a,t,u,u===n);a+=l.length,r.push(...l)}return r}function fn(e){var r,i,s,o,a;const t=_.words[e],n=e+1;if(s1(t)){const[c,u]=wl(e);if(k(c))return[c,u]}if(n4(t)){const[c,u]=a1(e);if(k(c))return[c,u]}if(q0(t)){const[c,u]=mc(e);if(k(c))return[c,u]}if(St(t)&&Mt(t)==="rnd"){const[c,u]=fn(n),[l,h]=fn(u);return Ct(c)&&Ct(l)?[Lr(c,l),h]:Ct(c)?[Lr(0,c),u]:[Lr(0,1),n]}if(W1(t)){const[c,u]=nd(e);if(k(c))return[c,u]}if(!k(t))return[void 0,e];if(Ct(t)||re(t))return[t,n];if(St(t)){const c=Mt(t),u=(r=_.get)==null?void 0:r.call(_,t);if(k(u))return[u,n];switch(c){case"aligned":case"alligned":{const l=yc(_.board,_.element,_.elementfocus);return!k(_.element)||!k(l)?[0,n]:[_.element.x===l.x||_.element.y===l.y?1:0,n]}case"contact":{const l=yc(_.board,_.element,_.elementfocus);if(!k(_.element)||!k(l))return[0,n];const h=(l.x??0)-(((i=_.element)==null?void 0:i.x)??0),f=(l.y??0)-(((s=_.element)==null?void 0:s.y)??0);return[h===0&&Math.abs(f)<2||f===0&&Math.abs(h)<2?1:0,n]}case"blocked":{const[l,h]=it(_.words,n,[H.DIR]);return[OC(_.book,_.board,_.element,l)?1:0,h]}case"any":{const[l,h]=it(_.words,n,[H.KIND]),f=gc(l)??"",d=Vs(_.board,f);return[nm(d,l).length?1:0,h]}case"rnd":return[Lr(0,1),n];case"abs":{const[l,h]=it(_.words,n,[H.NUMBER]);return[Math.abs(l),h]}case"ceil":{const[l,h]=it(_.words,n,[H.NUMBER]);return[Math.ceil(l),h]}case"floor":{const[l,h]=it(_.words,n,[H.NUMBER]);return[Math.floor(l),h]}case"round":{const[l,h]=it(_.words,n,[H.NUMBER]);return[Math.round(l),h]}case"clamp":{const[l,h,f,d]=it(_.words,n,[H.NUMBER,H.NUMBER,H.NUMBER]);return[Bn(l,h,f),d]}case"min":{const l=[];for(let h=n;h<_.words.length;){const[f,d]=fn(h);re(f)&&!xr(f)&&!Yr(f)&&!Ti(f)&&!Pn(f)&&l.push(...f),h=d,l.push(f)}return[Math.min(...l),_.words.length]}case"max":{const l=[];for(let h=n;h<_.words.length;){const[f,d]=fn(h);re(f)&&!xr(f)&&!Yr(f)&&!Ti(f)&&!Pn(f)&&l.push(...f),h=d,l.push(f)}return[Math.max(...l),_.words.length]}case"pick":{const l=[];for(let h=n;h<_.words.length;){const[f,d]=fn(h);re(f)&&!xr(f)&&!Yr(f)&&!Ti(f)&&!Pn(f)&&l.push(...f),h=d,l.push(f)}return[nn(l),_.words.length]}case"pickwith":{const l=[],[h,f]=it(_.words,n,[H.NUMBER_OR_STRING]);for(let d=f;d<_.words.length;){const[p,m]=fn(d);re(p)&&!xr(p)&&!Yr(p)&&!Ti(p)&&!Pn(p)&&l.push(...p),d=m,l.push(p)}return[$0(`${h}`,l),_.words.length]}case"random":{const[l,h,f]=it(_.words,n,[H.NUMBER,H.MAYBE_NUMBER]);return[Lr(l,h??0),f]}case"randomwith":{const[l,h,f,d]=it(_.words,n,[H.NUMBER_OR_STRING,H.NUMBER,H.MAYBE_NUMBER]);return[P0(`${l}`,h,f??0),d]}case"run":{const[l,h]=it(_.words,n,[H.NAME]);return Ml(l),[(o=_.get)==null?void 0:o.call(_,"arg"),h]}case"runwith":{const[l,h,f]=it(_.words,n,[H.ANY,H.NAME]);return k(_.element)&&(_.element.arg=l),Ml(h),[(a=_.get)==null?void 0:a.call(_,"arg"),f]}}}return[t,n]}function go(e){return k(e)&&k(e.x)&&k(e.y)}function Ye(e,t){switch(t){case yt.NORTH:--e.y;break;case yt.SOUTH:++e.y;break;case yt.WEST:--e.x;break;case yt.EAST:++e.x;break}return e}function Yi(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return yt.WEST;if(n>0)return yt.EAST;if(r<0)return yt.NORTH;if(r>0)return yt.SOUTH}const ed={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST"};function xr(e){return re(e)&&z1(e[0])}function z1(e){return k(yt[e])&&St(e)}function YL(e){const t=yt[e];return k(t)?t:yt.IDLE}function W1(e){if(St(e))return ed[Mt(e)]}function K1(e){if(xr(e))return e;if(z1(e))return[e];const t=W1(e);if(k(t))return[t]}function G1(e){const t=_.words[e],n=K1(t);if(xr(n))return[n,e+1];const[r,i]=fn(e),s=K1(r);return xr(s)?[s,i]:[void 0,e]}function nd(e){const t=[];let[n,r]=G1(e);for(;xr(n);){if(t.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=it(_.words,r,[H.NUMBER,H.NUMBER]);t.push(o,a),r=c}const[i,s]=G1(r);n=i,r=s}return t.length?[t,r]:[void 0,e]}function VL(){return new Array(Gt*ke).map(()=>{})}function XL(e=Vl){const t={terrain:VL(),objects:{},id:""};return e(t)}var rd=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e))(rd||{});function qL(e){return qs(e,rd,{terrain:t=>t.map(Tc),objects:t=>Object.values(t).filter(n=>!n.removed).map(Tc),id:Le,named:Le,lookup:Le,codepage:Le})}function JL(e){return Ho(e,rd,{terrain:t=>t.map(Ac),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=Ac(t[r]);k(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Jr(e,t){return!k(e)||!k(t==null?void 0:t.x)||!k(t==null?void 0:t.y)||t.x<0||t.x>=Gt||t.y<0||t.y>=ke?-1:t.x+t.y*Gt}function Wn(e,t){const n=Jr(e,t);if(n<0||!k(e==null?void 0:e.lookup))return;const r=Ln(e,e.lookup[n]??"");return k(r)?r:e.terrain[n]}function ZL(e,t){const n=Ln(e,t);if(k(n))return n;const r=parseFloat(t),i=v0(isNaN(r)?-1:r,Gt);return id(e,i.x,i.y)}function id(e,t,n){return(t>=0&&t<Gt)??(n>=0&&n<ke)?e==null?void 0:e.terrain[t+n*Gt]:void 0}function kr(e,t){if(!k(e)||!k(t)||!k(t.x)||!k(t.y)||t.x<0||t.x>=Gt||t.y<0||t.y>=ke)return;const n=Xe(t),r=t.x+t.y*Gt;return e.terrain[r]=n,e.terrain[r]}function sd(e,t){if(!k(e)||!k(t))return;const n=Xe(t);return n.id=n.id??Ne(),e.objects[n.id]=n,e.objects[n.id]}function QL(e,t,n){return kr(e,{...t,kind:n})}function od(e,t,n,r){return sd(e,{...t,kind:n,id:r})}function Ln(e,t){if(e)return e.objects[t]}function ad(e,t,n,r,i){if(!k(e)||!k(t))return{x:0,y:0};const s={x:t.x??0,y:t.y??0},o={x:t.lx??s.x,y:t.ly??s.y},a=Yi(o,s),c=Gt-1,u=ke-1;for(let l=0;l<r.length;++l){const h=YL(r[l]);switch(h){case yt.IDLE:break;case yt.NORTH:case yt.SOUTH:case yt.WEST:case yt.EAST:Ye(s,h);break;case yt.BY:{const[f,d]=r.slice(l+1);Ct(f)&&Ct(d)&&(s.x=Bn(s.x+f,0,c),s.y=Bn(s.y+d,0,u)),l+=2;break}case yt.AT:{const[f,d]=r.slice(l+1);Ct(f)&&Ct(d)&&(s.x=Bn(f,0,c),s.y=Bn(d,0,u)),l+=2;break}case yt.FLOW:Ye(s,a);break;case yt.SEEK:{const f=tM(e,t,n);go(f)&&Ye(s,Yi(i,f));break}case yt.RNDNS:Ye(s,nn(yt.NORTH,yt.SOUTH));break;case yt.RNDNE:Ye(s,nn(yt.NORTH,yt.EAST));break;case yt.RND:Ye(s,nn(yt.NORTH,yt.SOUTH,yt.WEST,yt.EAST));break;case yt.CW:case yt.CCW:case yt.OPP:case yt.RNDP:{const f=ad(e,t,n,r.slice(l+1),i);switch(s.x=i.x,s.y=i.y,h){case yt.CW:switch(Yi(i,f)){case yt.NORTH:Ye(s,yt.EAST);break;case yt.SOUTH:Ye(s,yt.WEST);break;case yt.EAST:Ye(s,yt.SOUTH);break;case yt.WEST:Ye(s,yt.NORTH);break}break;case yt.CCW:switch(Yi(i,f)){case yt.NORTH:Ye(s,yt.WEST);break;case yt.SOUTH:Ye(s,yt.EAST);break;case yt.EAST:Ye(s,yt.NORTH);break;case yt.WEST:Ye(s,yt.SOUTH);break}break;case yt.OPP:switch(Yi(i,f)){case yt.NORTH:Ye(s,yt.SOUTH);break;case yt.SOUTH:Ye(s,yt.NORTH);break;case yt.EAST:Ye(s,yt.WEST);break;case yt.WEST:Ye(s,yt.EAST);break}break;case yt.RNDP:switch(Yi(i,f)){case yt.NORTH:case yt.SOUTH:s.x+=nn(-1,1);break;case yt.WEST:case yt.EAST:s.y+=nn(-1,1);break}break}break}}}return s}function H1(e,t){return k(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function tM(e,t,n){if(!k(e)||!k(t))return;const r=e.objects[n];if(k(r))return r;if(go(t))return im(t,Vs(e,"player"))}const _={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var H=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NAME=5]="NAME",e[e.NUMBER=6]="NUMBER",e[e.STRING=7]="STRING",e[e.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=10]="MAYBE_COLLISION",e[e.MAYBE_COLOR=11]="MAYBE_COLOR",e[e.MAYBE_KIND=12]="MAYBE_KIND",e[e.MAYBE_DIR=13]="MAYBE_DIR",e[e.MAYBE_NAME=14]="MAYBE_NAME",e[e.MAYBE_NUMBER=15]="MAYBE_NUMBER",e[e.MAYBE_STRING=16]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",e[e.ANY=18]="ANY",e))(H||{});function $e(e,t,n){throw console.info(n,_.element,_.elementid,_.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function it(e,t,n){var o,a,c,u;const r=_.words;_.words=e;const i=[];let s=t;for(let l=0;l<n.length;++l)switch(n[l]){case 0:{const[h,f]=wl(s);Yr(h)||$e("terrain or object",h,e),s=f,i.push(h);break}case 1:{const[h,f]=a1(s);Ti(h)||$e("solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 2:{const[h,f]=mc(s);Pn(h)||$e("color",h,e),s=f,i.push(h);break}case 3:{const[h,f]=Q0(s);Ys(h)?(s=f,i.push(h)):$e("kind",h,e);break}case 4:{const[h,f]=nd(s);if(xr(h)){const d={x:((o=_.element)==null?void 0:o.x)??0,y:((a=_.element)==null?void 0:a.y)??0},p=k(_.board)&&k(_.element)?ad(_.board,_.element,_.elementfocus,h,d):d;s=f,i.push(p)}else $e("direction",h,e);break}case 5:{const h=_.words[s];St(h)||$e("string",h,e),++s,i.push(h);break}case 6:{const[h,f]=fn(s);if(St(h)){const d=parseFloat(h);Ct(d)?i.push(d):$e("number",h,e)}else Ct(h)?i.push(h):$e("number",h,e);s=f;break}case 7:{const[h,f]=fn(s);St(h)||$e("string",h,e),s=f,i.push(h);break}case 8:{const[h,f]=fn(s);let d=h;if(St(d)){const p=parseFloat(d);Ct(p)&&(d=p)}else Ct(d)||$e("number or string",d,e);s=f,i.push(d);break}case 9:{const[h,f]=wl(s);h!==void 0&&!Yr(h)&&$e("optional terrain or object",h,e),s=f,i.push(h);break}case 10:{const[h,f]=wl(s);h!==void 0&&!Ti(h)&&$e("optional solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 11:{const[h,f]=mc(s);h!==void 0&&!Pn(h)&&$e("optional color",h,e),s=f,i.push(h);break}case 12:{const[h,f]=Q0(s);h!==void 0&&!Ys(h)&&$e("optional kind",h,e),s=f,i.push(h);break}case 13:{const[h,f]=nd(s);if(xr(h)){const d=((c=_.element)==null?void 0:c.x)??0,p=((u=_.element)==null?void 0:u.y)??0,m={x:d,y:p},x=_.board?ad(_.board,_.element,_.elementfocus,h,m):m;s=f,i.push(x)}else h===void 0?(s=f,i.push(void 0)):$e("optional direction",h,e);break}case 14:{const h=_.words[s];h!==void 0&&!St(h)&&$e("optional string",h,e),++s,i.push(h);break}case 15:{const[h,f]=fn(s);if(St(h)){const d=parseFloat(h);Ct(d)?i.push(d):$e("optional number",h,e)}else Ct(h)||h===void 0?i.push(h):$e("optional number",h,e);s=f;break}case 16:{const[h,f]=fn(s);h!==void 0&&!St(h)&&$e("optional string",h,e),s=f,i.push(h);break}case 17:{const[h,f]=fn(s);let d=h;if(St(d)){const p=parseFloat(d);Ct(p)&&(d=p)}else d!==void 0&&!Ct(d)&&$e("number or string",d,e);s=f,i.push(d);break}case 18:{const[h,f]=fn(s);s=f,i.push(h);break}}return _.words=r,[...i,s]}const Ul={},yo={};function cd(){return{id:Ne(),layers:[],scroll:[],sidebar:[]}}const eM=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),nM=new Set(["tx","text"]),rM={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Y1={};let V1=e=>{let t=Y1[e];return k(t)||(Y1[e]=t=cd()),t};function iM(e){V1=e}function wn(e){return V1(e)}function ld(e){return k(Ul[e])||(Ul[e]=[]),Ul[e]}function sM(e){const t=wn(e);t.scroll=[]}function oM(e,t,n){Object.values(yo).forEach(r=>{if(r[t]!==void 0){const i=W0(e.id(),t);Ct(n)&&Nk(i,n),St(n)&&Ok(i,n)}})}function Zr(e){const t=ld(e);return Ul[e]=[],t}function se(e,t){ld(e).push(t)}function Bt(e,t,n,r,i=()=>0,s=Vl){const o=[t,n,...r],a=Mt(`${o[3]}`),c={..._};function u(l,h){k(h)&&h!==i(l)&&(_.board=c.board,_.element=c.element,_.elementfocus=c.elementfocus,s(l,h))}if(eM.has(a)){const l=`${o[2]}`;yo[t]=yo[t]??{};const h=i(l)??rM[a];if(yo[t][l]===void 0){const f=W0(t,l);Ct(h)&&Ik(f,h),St(h)&&Yu(f,h),nM.has(a)?yo[t][l]=T0(f,d=>{u(l,d)}):yo[t][l]=Ck(f,d=>{u(l,d)})}}ld(e).push(o)}iM(e=>{if(Vi(e)){const t=le(Ft.MAIN),n=xi(t,Ft.GADGETSTORE);let r=n[e];return k(r)||(n[e]=r=cd()),r}return cd()});const ud=vs("gadgetserver",["tock"],e=>{if(!ud.session(e))return;const t=le(Ft.MAIN),n=(t==null?void 0:t.activelist)??[],r=xi(t,Ft.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=wn(s);o.layers=HL(s);const a=r[s]??{},c=Ad(a,o);c.length&&(r[s]=Xe(o),tE(ud,s,c))}break;case"desync":Qb(ud,e.player,wn(e.player));break;case"clearscroll":sM(e.player);break;case"clearplayer":{const i=le(Ft.MAIN),s=xi(i,Ft.GADGETSTORE);delete s[e.player];const o=xi(i,Ft.GADGETSYNC);delete o[e.player];break}}});function Fl(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var X1={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(u,l){if(!i[u]){if(!r[u]){var h=typeof Fl=="function"&&Fl;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[u]={exports:{}};r[u][0].call(d.exports,function(p){var m=r[u][1][p];return o(m||p)},d,d.exports,n,r,i,s)}return i[u].exports}for(var a=typeof Fl=="function"&&Fl,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,f,d,p,m,x=[],w=0,T=c.length,v=T,I=s.getTypeOf(c)!=="string";w<c.length;)v=T-w,h=I?(u=c[w++],l=w<T?c[w++]:0,w<T?c[w++]:0):(u=c.charCodeAt(w++),l=w<T?c.charCodeAt(w++):0,w<T?c.charCodeAt(w++):0),f=u>>2,d=(3&u)<<4|l>>4,p=1<v?(15&l)<<2|h>>6:64,m=2<v?63&h:64,x.push(a.charAt(f)+a.charAt(d)+a.charAt(p)+a.charAt(m));return x.join("")},i.decode=function(c){var u,l,h,f,d,p,m=0,x=0,w="data:";if(c.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var T,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&v--,c.charAt(c.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=o.uint8array?new Uint8Array(0|v):new Array(0|v);m<c.length;)u=a.indexOf(c.charAt(m++))<<2|(f=a.indexOf(c.charAt(m++)))>>4,l=(15&f)<<4|(d=a.indexOf(c.charAt(m++)))>>2,h=(3&d)<<6|(p=a.indexOf(c.charAt(m++))),T[x++]=u,d!==64&&(T[x++]=l),p!==64&&(T[x++]=h);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function u(l,h,f,d,p){this.compressedSize=l,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=p}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,f){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var m=f;m<p;m++)u=u>>>8^d[255&(u^l[m])];return-1^u}(0|c,a,a.length,0):function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var m=f;m<p;m++)u=u>>>8^d[255&(u^l.charCodeAt(m))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,f){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(d,p){var m,x="";for(m=0;m<p;m++)x+=String.fromCharCode(255&d),d>>>=8;return x}function o(d,p,m,x,w,T){var v,I,U=d.file,S=d.compression,N=T!==u.utf8encode,P=a.transformTo("string",T(U.name)),L=a.transformTo("string",u.utf8encode(U.name)),V=U.comment,Z=a.transformTo("string",T(V)),C=a.transformTo("string",u.utf8encode(V)),R=L.length!==U.name.length,b=C.length!==V.length,B="",X="",D="",lt=U.dir,et=U.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ft.crc32=d.crc32,ft.compressedSize=d.compressedSize,ft.uncompressedSize=d.uncompressedSize);var K=0;p&&(K|=8),N||!R&&!b||(K|=2048);var z=0,bt=0;lt&&(z|=16),w==="UNIX"?(bt=798,z|=function(ct,Lt){var ne=ct;return ct||(ne=Lt?16893:33204),(65535&ne)<<16}(U.unixPermissions,lt)):(bt=20,z|=function(ct){return 63&(ct||0)}(U.dosPermissions)),v=et.getUTCHours(),v<<=6,v|=et.getUTCMinutes(),v<<=5,v|=et.getUTCSeconds()/2,I=et.getUTCFullYear()-1980,I<<=4,I|=et.getUTCMonth()+1,I<<=5,I|=et.getUTCDate(),R&&(X=s(1,1)+s(l(P),4)+L,B+="up"+s(X.length,2)+X),b&&(D=s(1,1)+s(l(Z),4)+C,B+="uc"+s(D.length,2)+D);var ot="";return ot+=`
\0`,ot+=s(K,2),ot+=S.magic,ot+=s(v,2),ot+=s(I,2),ot+=s(ft.crc32,4),ot+=s(ft.compressedSize,4),ot+=s(ft.uncompressedSize,4),ot+=s(P.length,2),ot+=s(B.length,2),{fileRecord:h.LOCAL_FILE_HEADER+ot+P+B,dirRecord:h.CENTRAL_FILE_HEADER+s(bt,2)+ot+s(Z.length,2)+"\0\0\0\0"+s(z,4)+s(x,4)+P+B+Z}}var a=n("../utils"),c=n("../stream/GenericWorker"),u=n("../utf8"),l=n("../crc32"),h=n("../signature");function f(d,p,m,x){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=x,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(d){var p=d.meta.percent||0,m=this.entriesCount,x=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-x-1))/m:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var p=this.streamFiles&&!d.file.dir;if(p){var m=o(d,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var p=this.streamFiles&&!d.file.dir,m=o(d,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(x){return h.DATA_DESCRIPTOR+s(x.crc32,4)+s(x.compressedSize,4)+s(x.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-d,x=function(w,T,v,I,U){var S=a.transformTo("string",U(I));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(T,4)+s(v,4)+s(S.length,2)+S}(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:x,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var p=this;return d.on("data",function(m){p.processChunk(m)}),d.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),d.on("error",function(m){p.error(m)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var p=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var m=0;m<p.length;m++)try{p[m].error(d)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,p=0;p<d.length;p++)d[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(f,d){h++;var p=function(T,v){var I=T||v,U=s[I];if(!U)throw new Error(I+" is not a valid compression method !");return U}(d.options.compression,c.compression),m=d.options.compressionOptions||c.compressionOptions||{},x=d.dir,w=d.date;d._compressWorker(p,m).withStreamInfo("file",{name:f,dir:x,date:w,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(f){l.error(f)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),u=n("./stream/Crc32Probe"),l=n("./nodejsUtils");function h(f){return new o.Promise(function(d,p){var m=f.decompressed.getContentWorker().pipe(new u);m.on("error",function(x){p(x)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var p=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(m){var x=new c(d);return x.load(m),x}).then(function(m){var x=[o.Promise.resolve(m)],w=m.files;if(d.checkCRC32)for(var T=0;T<w.length;T++)x.push(h(w[T]));return o.Promise.all(x)}).then(function(m){for(var x=m.shift(),w=x.files,T=0;T<w.length;T++){var v=w[T],I=v.fileNameStr,U=s.resolve(v.fileNameStr);p.file(U,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:d.createFolders}),v.dir||(p.file(U).unsafeOriginalName=I)}return x.zipComment.length&&(p.comment=x.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,f){l.push(h)||l._helper.pause(),u&&u(f)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof tn<"u",newBufferFrom:function(s,o){if(tn.from&&tn.from!==Uint8Array.from)return tn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new tn(s,o)},allocBuffer:function(s){if(tn.alloc)return tn.alloc(s);var o=new tn(s);return o.fill(0),o},isBuffer:function(s){return tn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(U,S,N){var P,L=a.getTypeOf(S),V=a.extend(N||{},l);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(U=w(U)),V.createFolders&&(P=x(U))&&T.call(this,P,!0);var Z=L==="string"&&V.binary===!1&&V.base64===!1;N&&N.binary!==void 0||(V.binary=!Z),(S instanceof h&&S.uncompressedSize===0||V.dir||!S||S.length===0)&&(V.base64=!1,V.binary=!0,S="",V.compression="STORE",L="string");var C=null;C=S instanceof h||S instanceof c?S:p.isNode&&p.isStream(S)?new m(U,S):a.prepareContent(U,S,V.binary,V.optimizedBinaryString,V.base64);var R=new f(U,C,V);this.files[U]=R}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),l=n("./defaults"),h=n("./compressedObject"),f=n("./zipObject"),d=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),x=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var S=U.lastIndexOf("/");return 0<S?U.substring(0,S):""},w=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},T=function(U,S){return S=S!==void 0?S:l.createFolders,U=w(U),this.files[U]||s.call(this,U,null,{dir:!0,createFolders:S}),this.files[U]};function v(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var S,N,P;for(S in this.files)P=this.files[S],(N=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&U(N,P)},filter:function(U){var S=[];return this.forEach(function(N,P){U(N,P)&&S.push(P)}),S},file:function(U,S,N){if(arguments.length!==1)return U=this.root+U,s.call(this,U,S,N),this;if(v(U)){var P=U;return this.filter(function(V,Z){return!Z.dir&&P.test(V)})}var L=this.files[this.root+U];return L&&!L.dir?L:null},folder:function(U){if(!U)return this;if(v(U))return this.filter(function(L,V){return V.dir&&U.test(L)});var S=this.root+U,N=T.call(this,S),P=this.clone();return P.root=N.name,P},remove:function(U){U=this.root+U;var S=this.files[U];if(S||(U.slice(-1)!=="/"&&(U+="/"),S=this.files[U]),S&&!S.dir)delete this.files[U];else for(var N=this.filter(function(L,V){return V.name.slice(0,U.length)===U}),P=0;P<N.length;P++)delete this.files[N[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var S,N={};try{if((N=a.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=N.type.toLowerCase(),N.compression=N.compression.toUpperCase(),N.type==="binarystring"&&(N.type="string"),!N.type)throw new Error("No output type specified.");a.checkSupport(N.type),N.platform!=="darwin"&&N.platform!=="freebsd"&&N.platform!=="linux"&&N.platform!=="sunos"||(N.platform="UNIX"),N.platform==="win32"&&(N.platform="DOS");var P=N.comment||this.comment||"";S=d.generateWorker(this,N,P)}catch(L){(S=new c("error")).error(L)}return new u(S,N.type||"string",N.mimeType)},generateAsync:function(U,S){return this.generateInternalStream(U).accumulate(S)},generateNodeStream:function(U,S){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(S)}};r.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===u&&this.data[f+2]===l&&this.data[f+3]===h)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&u===f[1]&&l===f[2]&&h===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),u=n("./NodeBufferReader"),l=n("./Uint8ArrayReader");r.exports=function(h){var f=s.getTypeOf(h);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),u=n("../support"),l=n("../external"),h=null;if(u.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,m){return new l.Promise(function(x,w){var T=[],v=p._internalType,I=p._outputType,U=p._mimeType;p.on("data",function(S,N){T.push(S),m&&m(N)}).on("error",function(S){T=[],w(S)}).on("end",function(){try{var S=function(N,P,L){switch(N){case"blob":return s.newBlob(s.transformTo("arraybuffer",P),L);case"base64":return c.encode(P);default:return s.transformTo(N,P)}}(I,function(N,P){var L,V=0,Z=null,C=0;for(L=0;L<P.length;L++)C+=P[L].length;switch(N){case"string":return P.join("");case"array":return Array.prototype.concat.apply([],P);case"uint8array":for(Z=new Uint8Array(C),L=0;L<P.length;L++)Z.set(P[L],V),V+=P[L].length;return Z;case"nodebuffer":return tn.concat(P);default:throw new Error("concat : unsupported type '"+N+"'")}}(v,T),U);x(S)}catch(N){w(N)}T=[]}).resume()})}function d(p,m,x){var w=m;switch(m){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=m,this._mimeType=x,s.checkSupport(w),this._worker=p.pipe(new o(w)),p.lock()}catch(T){this._worker=new a("error"),this._worker.error(T)}}d.prototype={accumulate:function(p){return f(this,p)},on:function(p,m){var x=this;return p==="data"?this._worker.on(p,function(w){m.call(x,w.data,w.meta)}):this._worker.on(p,function(){s.delay(m,arguments,x)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof tn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):function(p){var m,x,w,T,v,I=p.length,U=0;for(T=0;T<I;T++)(64512&(x=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(w=p.charCodeAt(T+1)))==56320&&(x=65536+(x-55296<<10)+(w-56320),T++),U+=x<128?1:x<2048?2:x<65536?3:4;for(m=o.uint8array?new Uint8Array(U):new Array(U),T=v=0;v<U;T++)(64512&(x=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(w=p.charCodeAt(T+1)))==56320&&(x=65536+(x-55296<<10)+(w-56320),T++),x<128?m[v++]=x:(x<2048?m[v++]=192|x>>>6:(x<65536?m[v++]=224|x>>>12:(m[v++]=240|x>>>18,m[v++]=128|x>>>12&63),m[v++]=128|x>>>6&63),m[v++]=128|63&x);return m}(d)},i.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):function(p){var m,x,w,T,v=p.length,I=new Array(2*v);for(m=x=0;m<v;)if((w=p[m++])<128)I[x++]=w;else if(4<(T=u[w]))I[x++]=65533,m+=T-1;else{for(w&=T===2?31:T===3?15:7;1<T&&m<v;)w=w<<6|63&p[m++],T--;1<T?I[x++]=65533:w<65536?I[x++]=w:(w-=65536,I[x++]=55296|w>>10&1023,I[x++]=56320|1023&w)}return I.length!==x&&(I.subarray?I=I.subarray(0,x):I.length=x),s.applyFromCharCode(I)}(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var p=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var x=function(T,v){var I;for((v=v||T.length)>T.length&&(v=T.length),I=v-1;0<=I&&(192&T[I])==128;)I--;return I<0||I===0?v:I+u[T[I]]>v?I:v}(p),w=p;x!==p.length&&(o.uint8array?(w=p.subarray(0,x),this.leftOver=p.subarray(x,p.length)):(w=p.slice(0,x),this.leftOver=p.slice(x,p.length))),this.push({data:i.utf8decode(w),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(f,c),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function u(m){return m}function l(m,x){for(var w=0;w<m.length;++w)x[w]=255&m.charCodeAt(w);return x}n("setimmediate"),i.newBlob=function(m,x){i.checkSupport("blob");try{return new Blob([m],{type:x})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(m),w.getBlob(x)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,x,w){var T=[],v=0,I=m.length;if(I<=w)return String.fromCharCode.apply(null,m);for(;v<I;)x==="array"||x==="nodebuffer"?T.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+w,I)))):T.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+w,I)))),v+=w;return T.join("")},stringifyByChar:function(m){for(var x="",w=0;w<m.length;w++)x+=String.fromCharCode(m[w]);return x},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(m){var x=65536,w=i.getTypeOf(m),T=!0;if(w==="uint8array"?T=h.applyCanBeUsed.uint8array:w==="nodebuffer"&&(T=h.applyCanBeUsed.nodebuffer),T)for(;1<x;)try{return h.stringifyByChunk(m,w,x)}catch{x=Math.floor(x/2)}return h.stringifyByChar(m)}function d(m,x){for(var w=0;w<m.length;w++)x[w]=m[w];return x}i.applyFromCharCode=f;var p={};p.string={string:u,array:function(m){return l(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return l(m,new Uint8Array(m.length))},nodebuffer:function(m){return l(m,a.allocBuffer(m.length))}},p.array={string:f,array:u,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:u,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:u,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:u},i.transformTo=function(m,x){if(x=x||"",!m)return x;i.checkSupport(m);var w=i.getTypeOf(x);return p[w][m](x)},i.resolve=function(m){for(var x=m.split("/"),w=[],T=0;T<x.length;T++){var v=x[T];v==="."||v===""&&T!==0&&T!==x.length-1||(v===".."?w.pop():w.push(v))}return w.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var x,w,T="";for(w=0;w<(m||"").length;w++)T+="\\x"+((x=m.charCodeAt(w))<16?"0":"")+x.toString(16).toUpperCase();return T},i.delay=function(m,x,w){setImmediate(function(){m.apply(w||null,x||[])})},i.inherits=function(m,x){function w(){}w.prototype=x.prototype,m.prototype=new w},i.extend=function(){var m,x,w={};for(m=0;m<arguments.length;m++)for(x in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],x)&&w[x]===void 0&&(w[x]=arguments[m][x]);return w},i.prepareContent=function(m,x,w,T,v){return c.Promise.resolve(x).then(function(I){return s.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new c.Promise(function(U,S){var N=new FileReader;N.onload=function(P){U(P.target.result)},N.onerror=function(P){S(P.target.error)},N.readAsArrayBuffer(I)}):I}).then(function(I){var U=i.getTypeOf(I);return U?(U==="arraybuffer"?I=i.transformTo("uint8array",I):U==="string"&&(v?I=o.decode(I):w&&T!==!0&&(I=function(S){return l(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(I))),I):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),u=n("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===f;return this.reader.setIndex(d),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",d=o.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var p=f-d;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),u=n("./utf8"),l=n("./compressions"),h=n("./support");function f(d,p){this.options=d,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var p,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(x){for(var w in l)if(Object.prototype.hasOwnProperty.call(l,w)&&l[w].magic===x)return l[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var p=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(p),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var p,m,x,w=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<w;)p=d.readInt(2),m=d.readInt(2),x=d.readData(m),this.extraFields[p]={id:p,length:m,value:x};d.setIndex(w)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var x=this.findExtraFieldUnicodeComment();if(x!==null)this.fileCommentStr=x;else{var w=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,x){this.name=p,this.dir=x.dir,this.date=x.date,this.comment=x.comment,this.unixPermissions=x.unixPermissions,this.dosPermissions=x.dosPermissions,this._data=m,this._dataBinary=x.binary,this.options={compression:x.compression,compressionOptions:x.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),u=n("./compressedObject"),l=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,x="string";try{if(!p)throw new Error("No output type specified.");var w=(x=p.toLowerCase())==="string"||x==="text";x!=="binarystring"&&x!=="text"||(x="string"),m=this._decompressWorker();var T=!this._dataBinary;T&&!w&&(m=m.pipe(new c.Utf8EncodeWorker)),!T&&w&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(v){(m=new l("error")).error(v)}return new o(m,x,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var x=this._decompressWorker();return this._dataBinary||(x=x.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(x,p,m)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(p),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var d=[];function p(){var m,x;a=!0;for(var w=d.length;w;){for(x=d,d=[],m=-1;++m<w;)x[m]();w=d.length}a=!1}r.exports=function(m){d.push(m)!==1||a||o()}}).call(this,typeof xn<"u"?xn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,w!==o&&m(this,w)}function f(w,T,v){this.promise=w,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function d(w,T,v){s(function(){var I;try{I=T(v)}catch(U){return a.reject(w,U)}I===w?a.reject(w,new TypeError("Cannot resolve promise with itself")):a.resolve(w,I)})}function p(w){var T=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof T=="function")return function(){T.apply(w,arguments)}}function m(w,T){var v=!1;function I(N){v||(v=!0,a.reject(w,N))}function U(N){v||(v=!0,a.resolve(w,N))}var S=x(function(){T(U,I)});S.status==="error"&&I(S.value)}function x(w,T){var v={};try{v.value=w(T),v.status="success"}catch(I){v.status="error",v.value=I}return v}(r.exports=h).prototype.finally=function(w){if(typeof w!="function")return this;var T=this.constructor;return this.then(function(v){return T.resolve(w()).then(function(){return v})},function(v){return T.resolve(w()).then(function(){throw v})})},h.prototype.catch=function(w){return this.then(null,w)},h.prototype.then=function(w,T){if(typeof w!="function"&&this.state===u||typeof T!="function"&&this.state===c)return this;var v=new this.constructor(o);return this.state!==l?d(v,this.state===u?w:T,this.outcome):this.queue.push(new f(v,w,T)),v},f.prototype.callFulfilled=function(w){a.resolve(this.promise,w)},f.prototype.otherCallFulfilled=function(w){d(this.promise,this.onFulfilled,w)},f.prototype.callRejected=function(w){a.reject(this.promise,w)},f.prototype.otherCallRejected=function(w){d(this.promise,this.onRejected,w)},a.resolve=function(w,T){var v=x(p,T);if(v.status==="error")return a.reject(w,v.value);var I=v.value;if(I)m(w,I);else{w.state=u,w.outcome=T;for(var U=-1,S=w.queue.length;++U<S;)w.queue[U].callFulfilled(T)}return w},a.reject=function(w,T){w.state=c,w.outcome=T;for(var v=-1,I=w.queue.length;++v<I;)w.queue[v].callRejected(T);return w},h.resolve=function(w){return w instanceof this?w:a.resolve(new this(o),w)},h.reject=function(w){var T=new this(o);return a.reject(T,w)},h.all=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=w.length,I=!1;if(!v)return this.resolve([]);for(var U=new Array(v),S=0,N=-1,P=new this(o);++N<v;)L(w[N],N);return P;function L(V,Z){T.resolve(V).then(function(C){U[Z]=C,++S!==v||I||(I=!0,a.resolve(P,U))},function(C){I||(I=!0,a.reject(P,C))})}},h.race=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=w.length,I=!1;if(!v)return this.resolve([]);for(var U=-1,S=new this(o);++U<v;)N=w[U],T.resolve(N).then(function(P){I||(I=!0,a.resolve(S,P))},function(P){I||(I=!0,a.reject(S,P))});var N;return S}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),u=n("./zlib/zstream"),l=Object.prototype.toString,h=0,f=-1,d=0,p=8;function m(w){if(!(this instanceof m))return new m(w);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},w||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(v!==h)throw new Error(c[v]);if(T.header&&s.deflateSetHeader(this.strm,T.header),T.dictionary){var I;if(I=typeof T.dictionary=="string"?a.string2buf(T.dictionary):l.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(v=s.deflateSetDictionary(this.strm,I))!==h)throw new Error(c[v]);this._dict_set=!0}}function x(w,T){var v=new m(T);if(v.push(w,!0),v.err)throw v.msg||c[v.err];return v.result}m.prototype.push=function(w,T){var v,I,U=this.strm,S=this.options.chunkSize;if(this.ended)return!1;I=T===~~T?T:T===!0?4:0,typeof w=="string"?U.input=a.string2buf(w):l.call(w)==="[object ArrayBuffer]"?U.input=new Uint8Array(w):U.input=w,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new o.Buf8(S),U.next_out=0,U.avail_out=S),(v=s.deflate(U,I))!==1&&v!==h)return this.onEnd(v),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(U.output,U.next_out))):this.onData(o.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&v!==1);return I===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===h):I!==2||(this.onEnd(h),!(U.avail_out=0))},m.prototype.onData=function(w){this.chunks.push(w)},m.prototype.onEnd=function(w){w===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},i.Deflate=m,i.deflate=x,i.deflateRaw=function(w,T){return(T=T||{}).raw=!0,x(w,T)},i.gzip=function(w,T){return(T=T||{}).gzip=!0,x(w,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),u=n("./zlib/messages"),l=n("./zlib/zstream"),h=n("./zlib/gzheader"),f=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var x=this.options;x.raw&&0<=x.windowBits&&x.windowBits<16&&(x.windowBits=-x.windowBits,x.windowBits===0&&(x.windowBits=-15)),!(0<=x.windowBits&&x.windowBits<16)||m&&m.windowBits||(x.windowBits+=32),15<x.windowBits&&x.windowBits<48&&!(15&x.windowBits)&&(x.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,x.windowBits);if(w!==c.Z_OK)throw new Error(u[w]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,x){var w=new d(x);if(w.push(m,!0),w.err)throw w.msg||u[w.err];return w.result}d.prototype.push=function(m,x){var w,T,v,I,U,S,N=this.strm,P=this.options.chunkSize,L=this.options.dictionary,V=!1;if(this.ended)return!1;T=x===~~x?x:x===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?N.input=a.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?N.input=new Uint8Array(m):N.input=m,N.next_in=0,N.avail_in=N.input.length;do{if(N.avail_out===0&&(N.output=new o.Buf8(P),N.next_out=0,N.avail_out=P),(w=s.inflate(N,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&L&&(S=typeof L=="string"?a.string2buf(L):f.call(L)==="[object ArrayBuffer]"?new Uint8Array(L):L,w=s.inflateSetDictionary(this.strm,S)),w===c.Z_BUF_ERROR&&V===!0&&(w=c.Z_OK,V=!1),w!==c.Z_STREAM_END&&w!==c.Z_OK)return this.onEnd(w),!(this.ended=!0);N.next_out&&(N.avail_out!==0&&w!==c.Z_STREAM_END&&(N.avail_in!==0||T!==c.Z_FINISH&&T!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(N.output,N.next_out),I=N.next_out-v,U=a.buf2string(N.output,v),N.next_out=I,N.avail_out=P-I,I&&o.arraySet(N.output,N.output,v,I,0),this.onData(U)):this.onData(o.shrinkBuf(N.output,N.next_out)))),N.avail_in===0&&N.avail_out===0&&(V=!0)}while((0<N.avail_in||N.avail_out===0)&&w!==c.Z_STREAM_END);return w===c.Z_STREAM_END&&(T=c.Z_FINISH),T===c.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===c.Z_OK):T!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(N.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=d,i.inflate=p,i.inflateRaw=function(m,x){return(x=x||{}).raw=!0,p(m,x)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,f){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),f);else for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){var u,l,h,f,d,p;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(p=new Uint8Array(h),u=f=0,l=c.length;u<l;u++)d=c[u],p.set(d,f),f+=d.length;return p}},a={arraySet:function(c,u,l,h,f){for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,f));for(var d="",p=0;p<f;p++)d+=String.fromCharCode(h[p]);return d}c[254]=c[254]=1,i.string2buf=function(h){var f,d,p,m,x,w=h.length,T=0;for(m=0;m<w;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),T+=d<128?1:d<2048?2:d<65536?3:4;for(f=new s.Buf8(T),m=x=0;x<T;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),d<128?f[x++]=d:(d<2048?f[x++]=192|d>>>6:(d<65536?f[x++]=224|d>>>12:(f[x++]=240|d>>>18,f[x++]=128|d>>>12&63),f[x++]=128|d>>>6&63),f[x++]=128|63&d);return f},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var f=new s.Buf8(h.length),d=0,p=f.length;d<p;d++)f[d]=h.charCodeAt(d);return f},i.buf2string=function(h,f){var d,p,m,x,w=f||h.length,T=new Array(2*w);for(d=p=0;d<w;)if((m=h[d++])<128)T[p++]=m;else if(4<(x=c[m]))T[p++]=65533,d+=x-1;else{for(m&=x===2?31:x===3?15:7;1<x&&d<w;)m=m<<6|63&h[d++],x--;1<x?T[p++]=65533:m<65536?T[p++]=m:(m-=65536,T[p++]=55296|m>>10&1023,T[p++]=56320|1023&m)}return l(T,p)},i.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+c[h[d]]>f?d:f}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var f=u;f<h;f++)o=o>>>8^l[255&(o^a[f])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),u=n("./crc32"),l=n("./messages"),h=0,f=4,d=0,p=-2,m=-1,x=4,w=2,T=8,v=9,I=286,U=30,S=19,N=2*I+1,P=15,L=3,V=258,Z=V+L+1,C=42,R=113,b=1,B=2,X=3,D=4;function lt(E,st){return E.msg=l[st],st}function et(E){return(E<<1)-(4<E?9:0)}function ft(E){for(var st=E.length;0<=--st;)E[st]=0}function K(E){var st=E.state,nt=st.pending;nt>E.avail_out&&(nt=E.avail_out),nt!==0&&(o.arraySet(E.output,st.pending_buf,st.pending_out,nt,E.next_out),E.next_out+=nt,st.pending_out+=nt,E.total_out+=nt,E.avail_out-=nt,st.pending-=nt,st.pending===0&&(st.pending_out=0))}function z(E,st){a._tr_flush_block(E,0<=E.block_start?E.block_start:-1,E.strstart-E.block_start,st),E.block_start=E.strstart,K(E.strm)}function bt(E,st){E.pending_buf[E.pending++]=st}function ot(E,st){E.pending_buf[E.pending++]=st>>>8&255,E.pending_buf[E.pending++]=255&st}function ct(E,st){var nt,F,M=E.max_chain_length,G=E.strstart,at=E.prev_length,ht=E.nice_match,Q=E.strstart>E.w_size-Z?E.strstart-(E.w_size-Z):0,pt=E.window,_t=E.w_mask,dt=E.prev,vt=E.strstart+V,ce=pt[G+at-1],Ut=pt[G+at];E.prev_length>=E.good_match&&(M>>=2),ht>E.lookahead&&(ht=E.lookahead);do if(pt[(nt=st)+at]===Ut&&pt[nt+at-1]===ce&&pt[nt]===pt[G]&&pt[++nt]===pt[G+1]){G+=2,nt++;do;while(pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&G<vt);if(F=V-(vt-G),G=vt-V,at<F){if(E.match_start=st,ht<=(at=F))break;ce=pt[G+at-1],Ut=pt[G+at]}}while((st=dt[st&_t])>Q&&--M!=0);return at<=E.lookahead?at:E.lookahead}function Lt(E){var st,nt,F,M,G,at,ht,Q,pt,_t,dt=E.w_size;do{if(M=E.window_size-E.lookahead-E.strstart,E.strstart>=dt+(dt-Z)){for(o.arraySet(E.window,E.window,dt,dt,0),E.match_start-=dt,E.strstart-=dt,E.block_start-=dt,st=nt=E.hash_size;F=E.head[--st],E.head[st]=dt<=F?F-dt:0,--nt;);for(st=nt=dt;F=E.prev[--st],E.prev[st]=dt<=F?F-dt:0,--nt;);M+=dt}if(E.strm.avail_in===0)break;if(at=E.strm,ht=E.window,Q=E.strstart+E.lookahead,pt=M,_t=void 0,_t=at.avail_in,pt<_t&&(_t=pt),nt=_t===0?0:(at.avail_in-=_t,o.arraySet(ht,at.input,at.next_in,_t,Q),at.state.wrap===1?at.adler=c(at.adler,ht,_t,Q):at.state.wrap===2&&(at.adler=u(at.adler,ht,_t,Q)),at.next_in+=_t,at.total_in+=_t,_t),E.lookahead+=nt,E.lookahead+E.insert>=L)for(G=E.strstart-E.insert,E.ins_h=E.window[G],E.ins_h=(E.ins_h<<E.hash_shift^E.window[G+1])&E.hash_mask;E.insert&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[G+L-1])&E.hash_mask,E.prev[G&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=G,G++,E.insert--,!(E.lookahead+E.insert<L)););}while(E.lookahead<Z&&E.strm.avail_in!==0)}function ne(E,st){for(var nt,F;;){if(E.lookahead<Z){if(Lt(E),E.lookahead<Z&&st===h)return b;if(E.lookahead===0)break}if(nt=0,E.lookahead>=L&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+L-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),nt!==0&&E.strstart-nt<=E.w_size-Z&&(E.match_length=ct(E,nt)),E.match_length>=L)if(F=a._tr_tally(E,E.strstart-E.match_start,E.match_length-L),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=L){for(E.match_length--;E.strstart++,E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+L-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart,--E.match_length!=0;);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+1])&E.hash_mask;else F=a._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(F&&(z(E,!1),E.strm.avail_out===0))return b}return E.insert=E.strstart<L-1?E.strstart:L-1,st===f?(z(E,!0),E.strm.avail_out===0?X:D):E.last_lit&&(z(E,!1),E.strm.avail_out===0)?b:B}function At(E,st){for(var nt,F,M;;){if(E.lookahead<Z){if(Lt(E),E.lookahead<Z&&st===h)return b;if(E.lookahead===0)break}if(nt=0,E.lookahead>=L&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+L-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=L-1,nt!==0&&E.prev_length<E.max_lazy_match&&E.strstart-nt<=E.w_size-Z&&(E.match_length=ct(E,nt),E.match_length<=5&&(E.strategy===1||E.match_length===L&&4096<E.strstart-E.match_start)&&(E.match_length=L-1)),E.prev_length>=L&&E.match_length<=E.prev_length){for(M=E.strstart+E.lookahead-L,F=a._tr_tally(E,E.strstart-1-E.prev_match,E.prev_length-L),E.lookahead-=E.prev_length-1,E.prev_length-=2;++E.strstart<=M&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+L-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),--E.prev_length!=0;);if(E.match_available=0,E.match_length=L-1,E.strstart++,F&&(z(E,!1),E.strm.avail_out===0))return b}else if(E.match_available){if((F=a._tr_tally(E,0,E.window[E.strstart-1]))&&z(E,!1),E.strstart++,E.lookahead--,E.strm.avail_out===0)return b}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(F=a._tr_tally(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<L-1?E.strstart:L-1,st===f?(z(E,!0),E.strm.avail_out===0?X:D):E.last_lit&&(z(E,!1),E.strm.avail_out===0)?b:B}function kt(E,st,nt,F,M){this.good_length=E,this.max_lazy=st,this.nice_length=nt,this.max_chain=F,this.func=M}function zt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*N),this.dyn_dtree=new o.Buf16(2*(2*U+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(P+1),this.heap=new o.Buf16(2*I+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*I+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ht(E){var st;return E&&E.state?(E.total_in=E.total_out=0,E.data_type=w,(st=E.state).pending=0,st.pending_out=0,st.wrap<0&&(st.wrap=-st.wrap),st.status=st.wrap?C:R,E.adler=st.wrap===2?0:1,st.last_flush=h,a._tr_init(st),d):lt(E,p)}function Ee(E){var st=Ht(E);return st===d&&function(nt){nt.window_size=2*nt.w_size,ft(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=L-1,nt.match_available=0,nt.ins_h=0}(E.state),st}function Ie(E,st,nt,F,M,G){if(!E)return p;var at=1;if(st===m&&(st=6),F<0?(at=0,F=-F):15<F&&(at=2,F-=16),M<1||v<M||nt!==T||F<8||15<F||st<0||9<st||G<0||x<G)return lt(E,p);F===8&&(F=9);var ht=new zt;return(E.state=ht).strm=E,ht.wrap=at,ht.gzhead=null,ht.w_bits=F,ht.w_size=1<<ht.w_bits,ht.w_mask=ht.w_size-1,ht.hash_bits=M+7,ht.hash_size=1<<ht.hash_bits,ht.hash_mask=ht.hash_size-1,ht.hash_shift=~~((ht.hash_bits+L-1)/L),ht.window=new o.Buf8(2*ht.w_size),ht.head=new o.Buf16(ht.hash_size),ht.prev=new o.Buf16(ht.w_size),ht.lit_bufsize=1<<M+6,ht.pending_buf_size=4*ht.lit_bufsize,ht.pending_buf=new o.Buf8(ht.pending_buf_size),ht.d_buf=1*ht.lit_bufsize,ht.l_buf=3*ht.lit_bufsize,ht.level=st,ht.strategy=G,ht.method=nt,Ee(E)}s=[new kt(0,0,0,0,function(E,st){var nt=65535;for(nt>E.pending_buf_size-5&&(nt=E.pending_buf_size-5);;){if(E.lookahead<=1){if(Lt(E),E.lookahead===0&&st===h)return b;if(E.lookahead===0)break}E.strstart+=E.lookahead,E.lookahead=0;var F=E.block_start+nt;if((E.strstart===0||E.strstart>=F)&&(E.lookahead=E.strstart-F,E.strstart=F,z(E,!1),E.strm.avail_out===0)||E.strstart-E.block_start>=E.w_size-Z&&(z(E,!1),E.strm.avail_out===0))return b}return E.insert=0,st===f?(z(E,!0),E.strm.avail_out===0?X:D):(E.strstart>E.block_start&&(z(E,!1),E.strm.avail_out),b)}),new kt(4,4,8,4,ne),new kt(4,5,16,8,ne),new kt(4,6,32,32,ne),new kt(4,4,16,16,At),new kt(8,16,32,32,At),new kt(8,16,128,128,At),new kt(8,32,128,256,At),new kt(32,128,258,1024,At),new kt(32,258,258,4096,At)],i.deflateInit=function(E,st){return Ie(E,st,T,15,8,0)},i.deflateInit2=Ie,i.deflateReset=Ee,i.deflateResetKeep=Ht,i.deflateSetHeader=function(E,st){return E&&E.state?E.state.wrap!==2?p:(E.state.gzhead=st,d):p},i.deflate=function(E,st){var nt,F,M,G;if(!E||!E.state||5<st||st<0)return E?lt(E,p):p;if(F=E.state,!E.output||!E.input&&E.avail_in!==0||F.status===666&&st!==f)return lt(E,E.avail_out===0?-5:p);if(F.strm=E,nt=F.last_flush,F.last_flush=st,F.status===C)if(F.wrap===2)E.adler=0,bt(F,31),bt(F,139),bt(F,8),F.gzhead?(bt(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),bt(F,255&F.gzhead.time),bt(F,F.gzhead.time>>8&255),bt(F,F.gzhead.time>>16&255),bt(F,F.gzhead.time>>24&255),bt(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),bt(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(bt(F,255&F.gzhead.extra.length),bt(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(E.adler=u(E.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(bt(F,0),bt(F,0),bt(F,0),bt(F,0),bt(F,0),bt(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),bt(F,3),F.status=R);else{var at=T+(F.w_bits-8<<4)<<8;at|=(2<=F.strategy||F.level<2?0:F.level<6?1:F.level===6?2:3)<<6,F.strstart!==0&&(at|=32),at+=31-at%31,F.status=R,ot(F,at),F.strstart!==0&&(ot(F,E.adler>>>16),ot(F,65535&E.adler)),E.adler=1}if(F.status===69)if(F.gzhead.extra){for(M=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),K(E),M=F.pending,F.pending!==F.pending_buf_size));)bt(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),K(E),M=F.pending,F.pending===F.pending_buf_size)){G=1;break}G=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,bt(F,G)}while(G!==0);F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),G===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),K(E),M=F.pending,F.pending===F.pending_buf_size)){G=1;break}G=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,bt(F,G)}while(G!==0);F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),G===0&&(F.status=103)}else F.status=103;if(F.status===103&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&K(E),F.pending+2<=F.pending_buf_size&&(bt(F,255&E.adler),bt(F,E.adler>>8&255),E.adler=0,F.status=R)):F.status=R),F.pending!==0){if(K(E),E.avail_out===0)return F.last_flush=-1,d}else if(E.avail_in===0&&et(st)<=et(nt)&&st!==f)return lt(E,-5);if(F.status===666&&E.avail_in!==0)return lt(E,-5);if(E.avail_in!==0||F.lookahead!==0||st!==h&&F.status!==666){var ht=F.strategy===2?function(Q,pt){for(var _t;;){if(Q.lookahead===0&&(Lt(Q),Q.lookahead===0)){if(pt===h)return b;break}if(Q.match_length=0,_t=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++,_t&&(z(Q,!1),Q.strm.avail_out===0))return b}return Q.insert=0,pt===f?(z(Q,!0),Q.strm.avail_out===0?X:D):Q.last_lit&&(z(Q,!1),Q.strm.avail_out===0)?b:B}(F,st):F.strategy===3?function(Q,pt){for(var _t,dt,vt,ce,Ut=Q.window;;){if(Q.lookahead<=V){if(Lt(Q),Q.lookahead<=V&&pt===h)return b;if(Q.lookahead===0)break}if(Q.match_length=0,Q.lookahead>=L&&0<Q.strstart&&(dt=Ut[vt=Q.strstart-1])===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]){ce=Q.strstart+V;do;while(dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&dt===Ut[++vt]&&vt<ce);Q.match_length=V-(ce-vt),Q.match_length>Q.lookahead&&(Q.match_length=Q.lookahead)}if(Q.match_length>=L?(_t=a._tr_tally(Q,1,Q.match_length-L),Q.lookahead-=Q.match_length,Q.strstart+=Q.match_length,Q.match_length=0):(_t=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++),_t&&(z(Q,!1),Q.strm.avail_out===0))return b}return Q.insert=0,pt===f?(z(Q,!0),Q.strm.avail_out===0?X:D):Q.last_lit&&(z(Q,!1),Q.strm.avail_out===0)?b:B}(F,st):s[F.level].func(F,st);if(ht!==X&&ht!==D||(F.status=666),ht===b||ht===X)return E.avail_out===0&&(F.last_flush=-1),d;if(ht===B&&(st===1?a._tr_align(F):st!==5&&(a._tr_stored_block(F,0,0,!1),st===3&&(ft(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),K(E),E.avail_out===0))return F.last_flush=-1,d}return st!==f?d:F.wrap<=0?1:(F.wrap===2?(bt(F,255&E.adler),bt(F,E.adler>>8&255),bt(F,E.adler>>16&255),bt(F,E.adler>>24&255),bt(F,255&E.total_in),bt(F,E.total_in>>8&255),bt(F,E.total_in>>16&255),bt(F,E.total_in>>24&255)):(ot(F,E.adler>>>16),ot(F,65535&E.adler)),K(E),0<F.wrap&&(F.wrap=-F.wrap),F.pending!==0?d:1)},i.deflateEnd=function(E){var st;return E&&E.state?(st=E.state.status)!==C&&st!==69&&st!==73&&st!==91&&st!==103&&st!==R&&st!==666?lt(E,p):(E.state=null,st===R?lt(E,-3):d):p},i.deflateSetDictionary=function(E,st){var nt,F,M,G,at,ht,Q,pt,_t=st.length;if(!E||!E.state||(G=(nt=E.state).wrap)===2||G===1&&nt.status!==C||nt.lookahead)return p;for(G===1&&(E.adler=c(E.adler,st,_t,0)),nt.wrap=0,_t>=nt.w_size&&(G===0&&(ft(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),pt=new o.Buf8(nt.w_size),o.arraySet(pt,st,_t-nt.w_size,nt.w_size,0),st=pt,_t=nt.w_size),at=E.avail_in,ht=E.next_in,Q=E.input,E.avail_in=_t,E.next_in=0,E.input=st,Lt(nt);nt.lookahead>=L;){for(F=nt.strstart,M=nt.lookahead-(L-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[F+L-1])&nt.hash_mask,nt.prev[F&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=F,F++,--M;);nt.strstart=F,nt.lookahead=L-1,Lt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=L-1,nt.match_available=0,E.next_in=ht,E.input=Q,E.avail_in=at,nt.wrap=G,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,u,l,h,f,d,p,m,x,w,T,v,I,U,S,N,P,L,V,Z,C,R,b,B;a=s.state,c=s.next_in,b=s.input,u=c+(s.avail_in-5),l=s.next_out,B=s.output,h=l-(o-s.avail_out),f=l+(s.avail_out-257),d=a.dmax,p=a.wsize,m=a.whave,x=a.wnext,w=a.window,T=a.hold,v=a.bits,I=a.lencode,U=a.distcode,S=(1<<a.lenbits)-1,N=(1<<a.distbits)-1;t:do{v<15&&(T+=b[c++]<<v,v+=8,T+=b[c++]<<v,v+=8),P=I[T&S];e:for(;;){if(T>>>=L=P>>>24,v-=L,(L=P>>>16&255)===0)B[l++]=65535&P;else{if(!(16&L)){if(!(64&L)){P=I[(65535&P)+(T&(1<<L)-1)];continue e}if(32&L){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}V=65535&P,(L&=15)&&(v<L&&(T+=b[c++]<<v,v+=8),V+=T&(1<<L)-1,T>>>=L,v-=L),v<15&&(T+=b[c++]<<v,v+=8,T+=b[c++]<<v,v+=8),P=U[T&N];n:for(;;){if(T>>>=L=P>>>24,v-=L,!(16&(L=P>>>16&255))){if(!(64&L)){P=U[(65535&P)+(T&(1<<L)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(Z=65535&P,v<(L&=15)&&(T+=b[c++]<<v,(v+=8)<L&&(T+=b[c++]<<v,v+=8)),d<(Z+=T&(1<<L)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(T>>>=L,v-=L,(L=l-h)<Z){if(m<(L=Z-L)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(R=w,(C=0)===x){if(C+=p-L,L<V){for(V-=L;B[l++]=w[C++],--L;);C=l-Z,R=B}}else if(x<L){if(C+=p+x-L,(L-=x)<V){for(V-=L;B[l++]=w[C++],--L;);if(C=0,x<V){for(V-=L=x;B[l++]=w[C++],--L;);C=l-Z,R=B}}}else if(C+=x-L,L<V){for(V-=L;B[l++]=w[C++],--L;);C=l-Z,R=B}for(;2<V;)B[l++]=R[C++],B[l++]=R[C++],B[l++]=R[C++],V-=3;V&&(B[l++]=R[C++],1<V&&(B[l++]=R[C++]))}else{for(C=l-Z;B[l++]=B[C++],B[l++]=B[C++],B[l++]=B[C++],2<(V-=3););V&&(B[l++]=B[C++],1<V&&(B[l++]=B[C++]))}break}}break}}while(c<u&&l<f);c-=V=v>>3,T&=(1<<(v-=V<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<f?f-l+257:257-(l-f),a.hold=T,a.bits=v}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),u=n("./inftrees"),l=1,h=2,f=0,d=-2,p=1,m=852,x=592;function w(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(C){var R;return C&&C.state?(R=C.state,C.total_in=C.total_out=R.total=0,C.msg="",R.wrap&&(C.adler=1&R.wrap),R.mode=p,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new s.Buf32(m),R.distcode=R.distdyn=new s.Buf32(x),R.sane=1,R.back=-1,f):d}function I(C){var R;return C&&C.state?((R=C.state).wsize=0,R.whave=0,R.wnext=0,v(C)):d}function U(C,R){var b,B;return C&&C.state?(B=C.state,R<0?(b=0,R=-R):(b=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?d:(B.window!==null&&B.wbits!==R&&(B.window=null),B.wrap=b,B.wbits=R,I(C))):d}function S(C,R){var b,B;return C?(B=new T,(C.state=B).window=null,(b=U(C,R))!==f&&(C.state=null),b):d}var N,P,L=!0;function V(C){if(L){var R;for(N=new s.Buf32(512),P=new s.Buf32(32),R=0;R<144;)C.lens[R++]=8;for(;R<256;)C.lens[R++]=9;for(;R<280;)C.lens[R++]=7;for(;R<288;)C.lens[R++]=8;for(u(l,C.lens,0,288,N,0,C.work,{bits:9}),R=0;R<32;)C.lens[R++]=5;u(h,C.lens,0,32,P,0,C.work,{bits:5}),L=!1}C.lencode=N,C.lenbits=9,C.distcode=P,C.distbits=5}function Z(C,R,b,B){var X,D=C.state;return D.window===null&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new s.Buf8(D.wsize)),B>=D.wsize?(s.arraySet(D.window,R,b-D.wsize,D.wsize,0),D.wnext=0,D.whave=D.wsize):(B<(X=D.wsize-D.wnext)&&(X=B),s.arraySet(D.window,R,b-B,X,D.wnext),(B-=X)?(s.arraySet(D.window,R,b-B,B,0),D.wnext=B,D.whave=D.wsize):(D.wnext+=X,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=X))),0}i.inflateReset=I,i.inflateReset2=U,i.inflateResetKeep=v,i.inflateInit=function(C){return S(C,15)},i.inflateInit2=S,i.inflate=function(C,R){var b,B,X,D,lt,et,ft,K,z,bt,ot,ct,Lt,ne,At,kt,zt,Ht,Ee,Ie,E,st,nt,F,M=0,G=new s.Buf8(4),at=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return d;(b=C.state).mode===12&&(b.mode=13),lt=C.next_out,X=C.output,ft=C.avail_out,D=C.next_in,B=C.input,et=C.avail_in,K=b.hold,z=b.bits,bt=et,ot=ft,st=f;t:for(;;)switch(b.mode){case p:if(b.wrap===0){b.mode=13;break}for(;z<16;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}if(2&b.wrap&&K===35615){G[b.check=0]=255&K,G[1]=K>>>8&255,b.check=a(b.check,G,2,0),z=K=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&K)<<8)+(K>>8))%31){C.msg="incorrect header check",b.mode=30;break}if((15&K)!=8){C.msg="unknown compression method",b.mode=30;break}if(z-=4,E=8+(15&(K>>>=4)),b.wbits===0)b.wbits=E;else if(E>b.wbits){C.msg="invalid window size",b.mode=30;break}b.dmax=1<<E,C.adler=b.check=1,b.mode=512&K?10:12,z=K=0;break;case 2:for(;z<16;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}if(b.flags=K,(255&b.flags)!=8){C.msg="unknown compression method",b.mode=30;break}if(57344&b.flags){C.msg="unknown header flags set",b.mode=30;break}b.head&&(b.head.text=K>>8&1),512&b.flags&&(G[0]=255&K,G[1]=K>>>8&255,b.check=a(b.check,G,2,0)),z=K=0,b.mode=3;case 3:for(;z<32;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}b.head&&(b.head.time=K),512&b.flags&&(G[0]=255&K,G[1]=K>>>8&255,G[2]=K>>>16&255,G[3]=K>>>24&255,b.check=a(b.check,G,4,0)),z=K=0,b.mode=4;case 4:for(;z<16;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}b.head&&(b.head.xflags=255&K,b.head.os=K>>8),512&b.flags&&(G[0]=255&K,G[1]=K>>>8&255,b.check=a(b.check,G,2,0)),z=K=0,b.mode=5;case 5:if(1024&b.flags){for(;z<16;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}b.length=K,b.head&&(b.head.extra_len=K),512&b.flags&&(G[0]=255&K,G[1]=K>>>8&255,b.check=a(b.check,G,2,0)),z=K=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(et<(ct=b.length)&&(ct=et),ct&&(b.head&&(E=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Array(b.head.extra_len)),s.arraySet(b.head.extra,B,D,ct,E)),512&b.flags&&(b.check=a(b.check,B,ct,D)),et-=ct,D+=ct,b.length-=ct),b.length))break t;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(et===0)break t;for(ct=0;E=B[D+ct++],b.head&&E&&b.length<65536&&(b.head.name+=String.fromCharCode(E)),E&&ct<et;);if(512&b.flags&&(b.check=a(b.check,B,ct,D)),et-=ct,D+=ct,E)break t}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(et===0)break t;for(ct=0;E=B[D+ct++],b.head&&E&&b.length<65536&&(b.head.comment+=String.fromCharCode(E)),E&&ct<et;);if(512&b.flags&&(b.check=a(b.check,B,ct,D)),et-=ct,D+=ct,E)break t}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;z<16;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}if(K!==(65535&b.check)){C.msg="header crc mismatch",b.mode=30;break}z=K=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),C.adler=b.check=0,b.mode=12;break;case 10:for(;z<32;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}C.adler=b.check=w(K),z=K=0,b.mode=11;case 11:if(b.havedict===0)return C.next_out=lt,C.avail_out=ft,C.next_in=D,C.avail_in=et,b.hold=K,b.bits=z,2;C.adler=b.check=1,b.mode=12;case 12:if(R===5||R===6)break t;case 13:if(b.last){K>>>=7&z,z-=7&z,b.mode=27;break}for(;z<3;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}switch(b.last=1&K,z-=1,3&(K>>>=1)){case 0:b.mode=14;break;case 1:if(V(b),b.mode=20,R!==6)break;K>>>=2,z-=2;break t;case 2:b.mode=17;break;case 3:C.msg="invalid block type",b.mode=30}K>>>=2,z-=2;break;case 14:for(K>>>=7&z,z-=7&z;z<32;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}if((65535&K)!=(K>>>16^65535)){C.msg="invalid stored block lengths",b.mode=30;break}if(b.length=65535&K,z=K=0,b.mode=15,R===6)break t;case 15:b.mode=16;case 16:if(ct=b.length){if(et<ct&&(ct=et),ft<ct&&(ct=ft),ct===0)break t;s.arraySet(X,B,D,ct,lt),et-=ct,D+=ct,ft-=ct,lt+=ct,b.length-=ct;break}b.mode=12;break;case 17:for(;z<14;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}if(b.nlen=257+(31&K),K>>>=5,z-=5,b.ndist=1+(31&K),K>>>=5,z-=5,b.ncode=4+(15&K),K>>>=4,z-=4,286<b.nlen||30<b.ndist){C.msg="too many length or distance symbols",b.mode=30;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;z<3;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}b.lens[at[b.have++]]=7&K,K>>>=3,z-=3}for(;b.have<19;)b.lens[at[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,nt={bits:b.lenbits},st=u(0,b.lens,0,19,b.lencode,0,b.work,nt),b.lenbits=nt.bits,st){C.msg="invalid code lengths set",b.mode=30;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;kt=(M=b.lencode[K&(1<<b.lenbits)-1])>>>16&255,zt=65535&M,!((At=M>>>24)<=z);){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}if(zt<16)K>>>=At,z-=At,b.lens[b.have++]=zt;else{if(zt===16){for(F=At+2;z<F;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}if(K>>>=At,z-=At,b.have===0){C.msg="invalid bit length repeat",b.mode=30;break}E=b.lens[b.have-1],ct=3+(3&K),K>>>=2,z-=2}else if(zt===17){for(F=At+3;z<F;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}z-=At,E=0,ct=3+(7&(K>>>=At)),K>>>=3,z-=3}else{for(F=At+7;z<F;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}z-=At,E=0,ct=11+(127&(K>>>=At)),K>>>=7,z-=7}if(b.have+ct>b.nlen+b.ndist){C.msg="invalid bit length repeat",b.mode=30;break}for(;ct--;)b.lens[b.have++]=E}}if(b.mode===30)break;if(b.lens[256]===0){C.msg="invalid code -- missing end-of-block",b.mode=30;break}if(b.lenbits=9,nt={bits:b.lenbits},st=u(l,b.lens,0,b.nlen,b.lencode,0,b.work,nt),b.lenbits=nt.bits,st){C.msg="invalid literal/lengths set",b.mode=30;break}if(b.distbits=6,b.distcode=b.distdyn,nt={bits:b.distbits},st=u(h,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,nt),b.distbits=nt.bits,st){C.msg="invalid distances set",b.mode=30;break}if(b.mode=20,R===6)break t;case 20:b.mode=21;case 21:if(6<=et&&258<=ft){C.next_out=lt,C.avail_out=ft,C.next_in=D,C.avail_in=et,b.hold=K,b.bits=z,c(C,ot),lt=C.next_out,X=C.output,ft=C.avail_out,D=C.next_in,B=C.input,et=C.avail_in,K=b.hold,z=b.bits,b.mode===12&&(b.back=-1);break}for(b.back=0;kt=(M=b.lencode[K&(1<<b.lenbits)-1])>>>16&255,zt=65535&M,!((At=M>>>24)<=z);){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}if(kt&&!(240&kt)){for(Ht=At,Ee=kt,Ie=zt;kt=(M=b.lencode[Ie+((K&(1<<Ht+Ee)-1)>>Ht)])>>>16&255,zt=65535&M,!(Ht+(At=M>>>24)<=z);){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}K>>>=Ht,z-=Ht,b.back+=Ht}if(K>>>=At,z-=At,b.back+=At,b.length=zt,kt===0){b.mode=26;break}if(32&kt){b.back=-1,b.mode=12;break}if(64&kt){C.msg="invalid literal/length code",b.mode=30;break}b.extra=15&kt,b.mode=22;case 22:if(b.extra){for(F=b.extra;z<F;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}b.length+=K&(1<<b.extra)-1,K>>>=b.extra,z-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;kt=(M=b.distcode[K&(1<<b.distbits)-1])>>>16&255,zt=65535&M,!((At=M>>>24)<=z);){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}if(!(240&kt)){for(Ht=At,Ee=kt,Ie=zt;kt=(M=b.distcode[Ie+((K&(1<<Ht+Ee)-1)>>Ht)])>>>16&255,zt=65535&M,!(Ht+(At=M>>>24)<=z);){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}K>>>=Ht,z-=Ht,b.back+=Ht}if(K>>>=At,z-=At,b.back+=At,64&kt){C.msg="invalid distance code",b.mode=30;break}b.offset=zt,b.extra=15&kt,b.mode=24;case 24:if(b.extra){for(F=b.extra;z<F;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}b.offset+=K&(1<<b.extra)-1,K>>>=b.extra,z-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){C.msg="invalid distance too far back",b.mode=30;break}b.mode=25;case 25:if(ft===0)break t;if(ct=ot-ft,b.offset>ct){if((ct=b.offset-ct)>b.whave&&b.sane){C.msg="invalid distance too far back",b.mode=30;break}Lt=ct>b.wnext?(ct-=b.wnext,b.wsize-ct):b.wnext-ct,ct>b.length&&(ct=b.length),ne=b.window}else ne=X,Lt=lt-b.offset,ct=b.length;for(ft<ct&&(ct=ft),ft-=ct,b.length-=ct;X[lt++]=ne[Lt++],--ct;);b.length===0&&(b.mode=21);break;case 26:if(ft===0)break t;X[lt++]=b.length,ft--,b.mode=21;break;case 27:if(b.wrap){for(;z<32;){if(et===0)break t;et--,K|=B[D++]<<z,z+=8}if(ot-=ft,C.total_out+=ot,b.total+=ot,ot&&(C.adler=b.check=b.flags?a(b.check,X,ot,lt-ot):o(b.check,X,ot,lt-ot)),ot=ft,(b.flags?K:w(K))!==b.check){C.msg="incorrect data check",b.mode=30;break}z=K=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;z<32;){if(et===0)break t;et--,K+=B[D++]<<z,z+=8}if(K!==(4294967295&b.total)){C.msg="incorrect length check",b.mode=30;break}z=K=0}b.mode=29;case 29:st=1;break t;case 30:st=-3;break t;case 31:return-4;case 32:default:return d}return C.next_out=lt,C.avail_out=ft,C.next_in=D,C.avail_in=et,b.hold=K,b.bits=z,(b.wsize||ot!==C.avail_out&&b.mode<30&&(b.mode<27||R!==4))&&Z(C,C.output,C.next_out,ot-C.avail_out)?(b.mode=31,-4):(bt-=C.avail_in,ot-=C.avail_out,C.total_in+=bt,C.total_out+=ot,b.total+=ot,b.wrap&&ot&&(C.adler=b.check=b.flags?a(b.check,X,ot,C.next_out-ot):o(b.check,X,ot,C.next_out-ot)),C.data_type=b.bits+(b.last?64:0)+(b.mode===12?128:0)+(b.mode===20||b.mode===15?256:0),(bt==0&&ot===0||R===4)&&st===f&&(st=-5),st)},i.inflateEnd=function(C){if(!C||!C.state)return d;var R=C.state;return R.window&&(R.window=null),C.state=null,f},i.inflateGetHeader=function(C,R){var b;return C&&C.state&&2&(b=C.state).wrap?((b.head=R).done=!1,f):d},i.inflateSetDictionary=function(C,R){var b,B=R.length;return C&&C.state?(b=C.state).wrap!==0&&b.mode!==11?d:b.mode===11&&o(1,R,B,0)!==b.check?-3:Z(C,R,B,B)?(b.mode=31,-4):(b.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(l,h,f,d,p,m,x,w){var T,v,I,U,S,N,P,L,V,Z=w.bits,C=0,R=0,b=0,B=0,X=0,D=0,lt=0,et=0,ft=0,K=0,z=null,bt=0,ot=new s.Buf16(16),ct=new s.Buf16(16),Lt=null,ne=0;for(C=0;C<=15;C++)ot[C]=0;for(R=0;R<d;R++)ot[h[f+R]]++;for(X=Z,B=15;1<=B&&ot[B]===0;B--);if(B<X&&(X=B),B===0)return p[m++]=20971520,p[m++]=20971520,w.bits=1,0;for(b=1;b<B&&ot[b]===0;b++);for(X<b&&(X=b),C=et=1;C<=15;C++)if(et<<=1,(et-=ot[C])<0)return-1;if(0<et&&(l===0||B!==1))return-1;for(ct[1]=0,C=1;C<15;C++)ct[C+1]=ct[C]+ot[C];for(R=0;R<d;R++)h[f+R]!==0&&(x[ct[h[f+R]]++]=R);if(N=l===0?(z=Lt=x,19):l===1?(z=o,bt-=257,Lt=a,ne-=257,256):(z=c,Lt=u,-1),C=b,S=m,lt=R=K=0,I=-1,U=(ft=1<<(D=X))-1,l===1&&852<ft||l===2&&592<ft)return 1;for(;;){for(P=C-lt,V=x[R]<N?(L=0,x[R]):x[R]>N?(L=Lt[ne+x[R]],z[bt+x[R]]):(L=96,0),T=1<<C-lt,b=v=1<<D;p[S+(K>>lt)+(v-=T)]=P<<24|L<<16|V|0,v!==0;);for(T=1<<C-1;K&T;)T>>=1;if(T!==0?(K&=T-1,K+=T):K=0,R++,--ot[C]==0){if(C===B)break;C=h[f+x[R]]}if(X<C&&(K&U)!==I){for(lt===0&&(lt=X),S+=b,et=1<<(D=C-lt);D+lt<B&&!((et-=ot[D+lt])<=0);)D++,et<<=1;if(ft+=1<<D,l===1&&852<ft||l===2&&592<ft)return 1;p[I=K&U]=X<<24|D<<16|S-m|0}}return K!==0&&(p[S+K]=C-lt<<24|64<<16|0),w.bits=X,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(M){for(var G=M.length;0<=--G;)M[G]=0}var u=0,l=29,h=256,f=h+1+l,d=30,p=19,m=2*f+1,x=15,w=16,T=7,v=256,I=16,U=17,S=18,N=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=new Array(2*(f+2));c(Z);var C=new Array(2*d);c(C);var R=new Array(512);c(R);var b=new Array(256);c(b);var B=new Array(l);c(B);var X,D,lt,et=new Array(d);function ft(M,G,at,ht,Q){this.static_tree=M,this.extra_bits=G,this.extra_base=at,this.elems=ht,this.max_length=Q,this.has_stree=M&&M.length}function K(M,G){this.dyn_tree=M,this.max_code=0,this.stat_desc=G}function z(M){return M<256?R[M]:R[256+(M>>>7)]}function bt(M,G){M.pending_buf[M.pending++]=255&G,M.pending_buf[M.pending++]=G>>>8&255}function ot(M,G,at){M.bi_valid>w-at?(M.bi_buf|=G<<M.bi_valid&65535,bt(M,M.bi_buf),M.bi_buf=G>>w-M.bi_valid,M.bi_valid+=at-w):(M.bi_buf|=G<<M.bi_valid&65535,M.bi_valid+=at)}function ct(M,G,at){ot(M,at[2*G],at[2*G+1])}function Lt(M,G){for(var at=0;at|=1&M,M>>>=1,at<<=1,0<--G;);return at>>>1}function ne(M,G,at){var ht,Q,pt=new Array(x+1),_t=0;for(ht=1;ht<=x;ht++)pt[ht]=_t=_t+at[ht-1]<<1;for(Q=0;Q<=G;Q++){var dt=M[2*Q+1];dt!==0&&(M[2*Q]=Lt(pt[dt]++,dt))}}function At(M){var G;for(G=0;G<f;G++)M.dyn_ltree[2*G]=0;for(G=0;G<d;G++)M.dyn_dtree[2*G]=0;for(G=0;G<p;G++)M.bl_tree[2*G]=0;M.dyn_ltree[2*v]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0}function kt(M){8<M.bi_valid?bt(M,M.bi_buf):0<M.bi_valid&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0}function zt(M,G,at,ht){var Q=2*G,pt=2*at;return M[Q]<M[pt]||M[Q]===M[pt]&&ht[G]<=ht[at]}function Ht(M,G,at){for(var ht=M.heap[at],Q=at<<1;Q<=M.heap_len&&(Q<M.heap_len&&zt(G,M.heap[Q+1],M.heap[Q],M.depth)&&Q++,!zt(G,ht,M.heap[Q],M.depth));)M.heap[at]=M.heap[Q],at=Q,Q<<=1;M.heap[at]=ht}function Ee(M,G,at){var ht,Q,pt,_t,dt=0;if(M.last_lit!==0)for(;ht=M.pending_buf[M.d_buf+2*dt]<<8|M.pending_buf[M.d_buf+2*dt+1],Q=M.pending_buf[M.l_buf+dt],dt++,ht===0?ct(M,Q,G):(ct(M,(pt=b[Q])+h+1,G),(_t=N[pt])!==0&&ot(M,Q-=B[pt],_t),ct(M,pt=z(--ht),at),(_t=P[pt])!==0&&ot(M,ht-=et[pt],_t)),dt<M.last_lit;);ct(M,v,G)}function Ie(M,G){var at,ht,Q,pt=G.dyn_tree,_t=G.stat_desc.static_tree,dt=G.stat_desc.has_stree,vt=G.stat_desc.elems,ce=-1;for(M.heap_len=0,M.heap_max=m,at=0;at<vt;at++)pt[2*at]!==0?(M.heap[++M.heap_len]=ce=at,M.depth[at]=0):pt[2*at+1]=0;for(;M.heap_len<2;)pt[2*(Q=M.heap[++M.heap_len]=ce<2?++ce:0)]=1,M.depth[Q]=0,M.opt_len--,dt&&(M.static_len-=_t[2*Q+1]);for(G.max_code=ce,at=M.heap_len>>1;1<=at;at--)Ht(M,pt,at);for(Q=vt;at=M.heap[1],M.heap[1]=M.heap[M.heap_len--],Ht(M,pt,1),ht=M.heap[1],M.heap[--M.heap_max]=at,M.heap[--M.heap_max]=ht,pt[2*Q]=pt[2*at]+pt[2*ht],M.depth[Q]=(M.depth[at]>=M.depth[ht]?M.depth[at]:M.depth[ht])+1,pt[2*at+1]=pt[2*ht+1]=Q,M.heap[1]=Q++,Ht(M,pt,1),2<=M.heap_len;);M.heap[--M.heap_max]=M.heap[1],function(Ut,Mn){var A,g,y,O,$,tt,rt=Mn.dyn_tree,Dt=Mn.max_code,we=Mn.stat_desc.static_tree,ye=Mn.stat_desc.has_stree,xe=Mn.stat_desc.extra_bits,ae=Mn.stat_desc.extra_base,va=Mn.stat_desc.max_length,Pl=0;for(O=0;O<=x;O++)Ut.bl_count[O]=0;for(rt[2*Ut.heap[Ut.heap_max]+1]=0,A=Ut.heap_max+1;A<m;A++)va<(O=rt[2*rt[2*(g=Ut.heap[A])+1]+1]+1)&&(O=va,Pl++),rt[2*g+1]=O,Dt<g||(Ut.bl_count[O]++,$=0,ae<=g&&($=xe[g-ae]),tt=rt[2*g],Ut.opt_len+=tt*(O+$),ye&&(Ut.static_len+=tt*(we[2*g+1]+$)));if(Pl!==0){do{for(O=va-1;Ut.bl_count[O]===0;)O--;Ut.bl_count[O]--,Ut.bl_count[O+1]+=2,Ut.bl_count[va]--,Pl-=2}while(0<Pl);for(O=va;O!==0;O--)for(g=Ut.bl_count[O];g!==0;)Dt<(y=Ut.heap[--A])||(rt[2*y+1]!==O&&(Ut.opt_len+=(O-rt[2*y+1])*rt[2*y],rt[2*y+1]=O),g--)}}(M,G),ne(pt,ce,M.bl_count)}function E(M,G,at){var ht,Q,pt=-1,_t=G[1],dt=0,vt=7,ce=4;for(_t===0&&(vt=138,ce=3),G[2*(at+1)+1]=65535,ht=0;ht<=at;ht++)Q=_t,_t=G[2*(ht+1)+1],++dt<vt&&Q===_t||(dt<ce?M.bl_tree[2*Q]+=dt:Q!==0?(Q!==pt&&M.bl_tree[2*Q]++,M.bl_tree[2*I]++):dt<=10?M.bl_tree[2*U]++:M.bl_tree[2*S]++,pt=Q,ce=(dt=0)===_t?(vt=138,3):Q===_t?(vt=6,3):(vt=7,4))}function st(M,G,at){var ht,Q,pt=-1,_t=G[1],dt=0,vt=7,ce=4;for(_t===0&&(vt=138,ce=3),ht=0;ht<=at;ht++)if(Q=_t,_t=G[2*(ht+1)+1],!(++dt<vt&&Q===_t)){if(dt<ce)for(;ct(M,Q,M.bl_tree),--dt!=0;);else Q!==0?(Q!==pt&&(ct(M,Q,M.bl_tree),dt--),ct(M,I,M.bl_tree),ot(M,dt-3,2)):dt<=10?(ct(M,U,M.bl_tree),ot(M,dt-3,3)):(ct(M,S,M.bl_tree),ot(M,dt-11,7));pt=Q,ce=(dt=0)===_t?(vt=138,3):Q===_t?(vt=6,3):(vt=7,4)}}c(et);var nt=!1;function F(M,G,at,ht){ot(M,(u<<1)+(ht?1:0),3),function(Q,pt,_t,dt){kt(Q),bt(Q,_t),bt(Q,~_t),s.arraySet(Q.pending_buf,Q.window,pt,_t,Q.pending),Q.pending+=_t}(M,G,at)}i._tr_init=function(M){nt||(function(){var G,at,ht,Q,pt,_t=new Array(x+1);for(Q=ht=0;Q<l-1;Q++)for(B[Q]=ht,G=0;G<1<<N[Q];G++)b[ht++]=Q;for(b[ht-1]=Q,Q=pt=0;Q<16;Q++)for(et[Q]=pt,G=0;G<1<<P[Q];G++)R[pt++]=Q;for(pt>>=7;Q<d;Q++)for(et[Q]=pt<<7,G=0;G<1<<P[Q]-7;G++)R[256+pt++]=Q;for(at=0;at<=x;at++)_t[at]=0;for(G=0;G<=143;)Z[2*G+1]=8,G++,_t[8]++;for(;G<=255;)Z[2*G+1]=9,G++,_t[9]++;for(;G<=279;)Z[2*G+1]=7,G++,_t[7]++;for(;G<=287;)Z[2*G+1]=8,G++,_t[8]++;for(ne(Z,f+1,_t),G=0;G<d;G++)C[2*G+1]=5,C[2*G]=Lt(G,5);X=new ft(Z,N,h+1,f,x),D=new ft(C,P,0,d,x),lt=new ft(new Array(0),L,0,p,T)}(),nt=!0),M.l_desc=new K(M.dyn_ltree,X),M.d_desc=new K(M.dyn_dtree,D),M.bl_desc=new K(M.bl_tree,lt),M.bi_buf=0,M.bi_valid=0,At(M)},i._tr_stored_block=F,i._tr_flush_block=function(M,G,at,ht){var Q,pt,_t=0;0<M.level?(M.strm.data_type===2&&(M.strm.data_type=function(dt){var vt,ce=4093624447;for(vt=0;vt<=31;vt++,ce>>>=1)if(1&ce&&dt.dyn_ltree[2*vt]!==0)return o;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return a;for(vt=32;vt<h;vt++)if(dt.dyn_ltree[2*vt]!==0)return a;return o}(M)),Ie(M,M.l_desc),Ie(M,M.d_desc),_t=function(dt){var vt;for(E(dt,dt.dyn_ltree,dt.l_desc.max_code),E(dt,dt.dyn_dtree,dt.d_desc.max_code),Ie(dt,dt.bl_desc),vt=p-1;3<=vt&&dt.bl_tree[2*V[vt]+1]===0;vt--);return dt.opt_len+=3*(vt+1)+5+5+4,vt}(M),Q=M.opt_len+3+7>>>3,(pt=M.static_len+3+7>>>3)<=Q&&(Q=pt)):Q=pt=at+5,at+4<=Q&&G!==-1?F(M,G,at,ht):M.strategy===4||pt===Q?(ot(M,2+(ht?1:0),3),Ee(M,Z,C)):(ot(M,4+(ht?1:0),3),function(dt,vt,ce,Ut){var Mn;for(ot(dt,vt-257,5),ot(dt,ce-1,5),ot(dt,Ut-4,4),Mn=0;Mn<Ut;Mn++)ot(dt,dt.bl_tree[2*V[Mn]+1],3);st(dt,dt.dyn_ltree,vt-1),st(dt,dt.dyn_dtree,ce-1)}(M,M.l_desc.max_code+1,M.d_desc.max_code+1,_t+1),Ee(M,M.dyn_ltree,M.dyn_dtree)),At(M),ht&&kt(M)},i._tr_tally=function(M,G,at){return M.pending_buf[M.d_buf+2*M.last_lit]=G>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&G,M.pending_buf[M.l_buf+M.last_lit]=255&at,M.last_lit++,G===0?M.dyn_ltree[2*at]++:(M.matches++,G--,M.dyn_ltree[2*(b[at]+h+1)]++,M.dyn_dtree[2*z(G)]++),M.last_lit===M.lit_bufsize-1},i._tr_align=function(M){ot(M,2,3),ct(M,v,Z),function(G){G.bi_valid===16?(bt(G,G.bi_buf),G.bi_buf=0,G.bi_valid=0):8<=G.bi_valid&&(G.pending_buf[G.pending++]=255&G.bi_buf,G.bi_buf>>=8,G.bi_valid-=8)}(M)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,f=1,d={},p=!1,m=o.document,x=Object.getPrototypeOf&&Object.getPrototypeOf(o);x=x&&x.setTimeout?x:o,c={}.toString.call(o.process)==="[object process]"?function(I){Oi.nextTick(function(){T(I)})}:function(){if(o.postMessage&&!o.importScripts){var I=!0,U=o.onmessage;return o.onmessage=function(){I=!1},o.postMessage("","*"),o.onmessage=U,I}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(I){o.postMessage(h+I,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(I){T(I.data)},function(I){l.port2.postMessage(I)}):m&&"onreadystatechange"in m.createElement("script")?(u=m.documentElement,function(I){var U=m.createElement("script");U.onreadystatechange=function(){T(I),U.onreadystatechange=null,u.removeChild(U),U=null},u.appendChild(U)}):function(I){setTimeout(T,0,I)},x.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var U=new Array(arguments.length-1),S=0;S<U.length;S++)U[S]=arguments[S+1];var N={callback:I,args:U};return d[f]=N,c(f),f++},x.clearImmediate=w}function w(I){delete d[I]}function T(I){if(p)setTimeout(T,0,I);else{var U=d[I];if(U){p=!0;try{(function(S){var N=S.callback,P=S.args;switch(P.length){case 0:N();break;case 1:N(P[0]);break;case 2:N(P[0],P[1]);break;case 3:N(P[0],P[1],P[2]);break;default:N.apply(a,P)}})(U)}finally{w(I),p=!1}}}}function v(I){I.source===o&&typeof I.data=="string"&&I.data.indexOf(h)===0&&T(+I.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof xn<"u"?xn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(X1);var aM=X1.exports,hd=Ts(aM);const q1={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(q1);var cr=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},_o,Ta,ws;class cM{constructor(...t){_o.set(this,new Map),Ta.set(this,new Map),ws.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),cr(this,ws,"f").has(r)||cr(this,ws,"f").set(r,new Set);const s=cr(this,ws,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&cr(this,Ta,"f").set(r,a),o=!1,c)continue;const u=cr(this,_o,"f").get(a);if(u&&u!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${u} -> ${a}". Pass \`force=true\` to override this definition.`);cr(this,_o,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:cr(this,_o,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&cr(this,Ta,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:cr(this,ws,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of cr(this,ws,"f").values())Object.freeze(t);return this}_getTestState(){return{types:cr(this,_o,"f"),extensions:cr(this,Ta,"f")}}}_o=new WeakMap,Ta=new WeakMap,ws=new WeakMap;var lM=new cM(q1)._freeze();function J1(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return lM.getType(e)??"application/octet-stream"}async function uM(e,t,n){try{ti(Y,e,t.name);const r=await t.arrayBuffer();(await new hd().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const u=J1(o,c),l=new File([c],a.name,{type:u});n(l)}).catch(c=>{ue(Y,e,"crash",c.message)})})}catch(r){ue(Y,e,"crash",r.message)}}async function hM(e,t,n){try{ti(Y,t,e.name);const r=await e.arrayBuffer();n(new Uint8Array(r))}catch(r){ue(Y,t,"crash",r.message)}}function Z1(e,t){function n(r){if(k(t))switch(r){case"text/plain":t.text().then(i=>Zl(Y,e,void 0,"text",`file:${t.name}`,i)).catch(i=>ue(Y,e,"crash",i.message));break;case"application/json":t.text().then(i=>Zl(Y,e,void 0,"json",`file:${t.name}`,i)).catch(i=>ue(Y,e,"crash",i.message));break;case"application/zip":uM(e,t,i=>Z1(e,i)).catch(i=>ue(Y,e,"crash",i.message));break;case"application/octet-stream":hM(t,e,i=>Zl(Y,e,void 0,"binary",`file:${t.name}`,i)).catch(i=>ue(Y,e,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=J1(t.name,new Uint8Array(i));if(s)n(s);else return ue(Y,e,"parsewebfile",`unsupported file ${t.name}`)}).catch(i=>ue(Y,e,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function bo(e,t,n){function r(i){ue(e,t,"crash",i.message)}n().catch(r)}function fM(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function dM(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const pM=new Date("1980/09/02");async function Q1(e){return console.info("saved",e),new Promise((t,n)=>{const r=new hd;for(let i=0;i<e.length;++i){const s=e[i],o=vC(s);if(o){const a=jT(o);k(a)&&r.file(s.id,a,{date:pM})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(dM(i))}).catch(n)})}async function mM(e){return new Promise((t,n)=>{const r=new hd;r.loadAsync(fM(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),u=SC(zT(c));k(u)&&i.push(u)}t(i)}).catch(n)})}const tb="$yellow$205$205$205$196";function eb(e,t){return`${e.x},${e.y},${t.x},${t.y}`}let Ve;function gM(){return!!Ve}function yM(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,u=[],l=[];for(let h=i;h<=o;++h)for(let f=r;f<=s;++f){const d={x:f-r,y:h-i},p=Wn(e,{x:f,y:h});(p==null?void 0:p.category)===Gn.ISOBJECT?(u.push(Xe(id(e,f,h))),Fr(p)!=="player"&&l.push({...Xe(p),...d,id:"blank"})):u.push({...Xe(p),...d})}return{board:e.id,width:a,height:c,terrain:u,objects:l}}function _M(e,t,n,r){const i=ar(e);if(k(i))switch(Ve=yM(i,t,n),r){case"copyobjects":Ve.terrain=[];break;case"copyterrain":Ve.objects=[];break}}function bM(e,t,n){const r=eb(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,tb),Bt(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Bt(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Bt(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=wn(e);i.scroll=Zr(e)}function EM(e,t,n,r){const i=ar(e);if(!k(i)||!k(Ve))return;const s=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),c=Math.max(t.y,n.y),u=a-s+1,l=c-o+1,h=Math.min(Ve.width,u),f=Math.min(Ve.height,l);switch(r){case"pasteall":{for(let d=0;d<f;++d)for(let p=0;p<h;++p){const m=cc({x:p,y:d},Ve.width);kr(i,{...Ve.terrain[m],x:s+p,y:o+d})}for(let d=0;d<Ve.objects.length;++d){const p=Ve.objects[d];k(p.x)&&k(p.y)&&S0(p.x,p.y,0,u-1,l-1,0)&&sd(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let d=0;d<Ve.objects.length;++d){const p=Ve.objects[d];k(p.x)&&k(p.y)&&S0(p.x,p.y,0,u-1,l-1,0)&&sd(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let d=0;d<f;++d)for(let p=0;p<h;++p){const m=cc({x:p,y:d},Ve.width);kr(i,{...Ve.terrain[m],x:s+p,y:o+d})}break;case"pasteterraintiled":for(let d=o;d<=c;++d)for(let p=s;p<=a;++p){const m=(p-s)%Ve.width,x=(d-o)%Ve.height,w=cc({x:m,y:x},Ve.width);kr(i,{...Ve.terrain[w],x:p,y:d})}break}}function wM(e,t,n){const r=eb(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,tb),Bt(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Bt(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Bt(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Bt(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=wn(e);i.scroll=Zr(e)}const xs="$yellow$205$205$205$196";function Bl(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function xM(e,t,n,r){const i=ar(e);if(!k(i))return;let s=0;function o(){return s}function a(u,l){Ct(l)&&(s=l,R0(t.x,t.y,n.x,n.y).forEach(h=>{const f=Wn(i,h);k(f)&&(f[u]=l)}))}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,xs),Bt(e,`batch:${Bl(t,n)}`,"char",[r,"charedit"],o,a);const c=wn(e);c.scroll=Zr(e)}function kM(e,t,n,r){const i=ar(e);if(!k(i))return;let s=0;function o(){return s}function a(u,l){if(console.info("memoryinspectcolorarea",u,l),Ct(l)){s=l;for(let h=t.y;h<=n.y;++h)for(let f=t.x;f<=n.x;++f){const d=Wn(i,{x:f,y:h});k(d)&&(d[u]=l)}}}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,xs),Bt(e,`batch:${Bl(t,n)}`,"color",[r,"coloredit"],o,a);const c=wn(e);c.scroll=Zr(e)}function TM(e,t,n,r){const i=ar(e);if(!k(i))return;let s=0;function o(){return s}function a(u,l){Ct(l)&&(s=l,R0(t.x,t.y,n.x,n.y).forEach(h=>{const f=Wn(i,h);k(f)&&(f[u]=l)}))}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,xs),Bt(e,`batch:${Bl(t,n)}`,"color",[r,"coloredit"],o,a);const c=wn(e);c.scroll=Zr(e)}const Aa={stat:"",patternsize:2,mirror:1};function AM(e,t,n){const r=En(Ft.MAIN);if(!k(r))return;const i=ar(e);if(!k(i))return;const s=Bl(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,xs),Bt(e,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),gM()&&Bt(e,"batch","paste elements",[`paste:${s}`,"hk","2"," 2 ","next"]),Bt(e,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(d){const{target:p}=lr(d);return Aa[p]}function a(d,p){if(Ct(p)||St(p)){const{target:m}=lr(d);Aa[m]=p}}Bt(e,"batch","remix",[`stat:${s}`,"text"],o,a),Bt(e,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),Bt(e,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),Bt(e,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),se(e,xs),Bt(e,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),Bt(e,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),Bt(e,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),se(e,xs),Bt(e,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),se(e,xs),se(e,"codepages:");const c=Math.min(t.x,n.x),u=Math.min(t.y,n.y),l=Math.max(t.x,n.x),h=Math.max(t.y,n.y),f=new Set;for(let d=u;d<=h;++d)for(let p=c;p<=l;++p){const m=Wn(i,{x:p,y:d}),x=P_(r,m);k(x)&&!f.has(x.id)&&(f.add(x.id),Bt(e,"batch",`edit @${Me(x)}`,[`pageopen:${x.id}`]))}}const Eo="$yellow$205$205$205$196";function fd(e,t){return`inspect:${t!=null&&t.id?t.id:Jr(e,t)}`}function vM(e,t,n){const r=En(Ft.MAIN);if(!k(r))return;const i=ar(e);if(!k(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){k(t)&&(t[f]=d)}const a=t.category===Gn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=fd(i,t);se(e,`${a}: ${c} ${u}`),se(e,Eo),Bt(e,l,"color",[n,"coloredit"],s,o);const h=wn(e);h.scroll=Zr(e)}function SM(e,t,n){const r=En(Ft.MAIN);if(!k(r))return;const i=ar(e);if(!k(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){k(t)&&(t[f]=d)}const a=t.category===Gn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=fd(i,t);se(e,`${a}: ${c} ${u}`),se(e,Eo),Bt(e,l,"char",[n,"charedit"],s,o);const h=wn(e);h.scroll=Zr(e)}function RM(e,t,n,r,i,s){var h,f,d;function o(p){var x;const m=(r==null?void 0:r[p])??((x=r==null?void 0:r.kinddata)==null?void 0:x[p]);if(!k(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Yt.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){k(r)&&(r[p]=m)}s?se(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):se(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),se(e,Eo);const c=fd(t,r);s?(Bt(e,c,"cycle",["cycle","number","1","255"],o,a),Bt(e,c,"collision",["collision","select","iswalking",`${Yt.ISWALK}`,"isswimming",`${Yt.ISSWIM}`],o,a)):Bt(e,c,"collision",["collision","select","iswalkable",`${Yt.ISWALK}`,"isswimable",`${Yt.ISSWIM}`,"issolid",`${Yt.ISSOLID}`],o,a),s&&Bt(e,c,"pushable",["pushable","select","no","0","yes","1"],o,a),Bt(e,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const u=pa(n),l=Kn(u);for(let p=0;p<l.length;++p){const m=l[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(re(u[m])){const[x,w,...T]=u[m];St(w)&&Bt(e,c,w||m,[m,x,...T],o,a)}break}}Bt(e,c,"copy coords",["copycoords","hk","5"," 5 "]),se(e,Eo),Bt(e,c,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],o,a),Bt(e,c,`color: ${r.color??((f=r.kinddata)==null?void 0:f.color)??15}`,["color","hk","c"," C ","next"],o,a),Bt(e,c,`bg: ${r.bg??((d=r.kinddata)==null?void 0:d.bg)??0}`,["bg","hk","b"," B ","next"],o,a),se(e,Eo),Bt(e,c,"make empty",["empty","hk","0"],o,a),se(e,Eo),Bt(e,"batch",`edit @${Me(n)}`,[`pageopen:${n.id}`])}const nb="$yellow$205$205$205$196";function IM(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function NM(e,t,n,r){const i=En(Ft.MAIN);if(!k(i))return;const s=ar(e);if(k(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Wn(s,{x:a,y:o});(c==null?void 0:c.category)===Gn.ISOBJECT&&Hr(i,s,c,i.timestamp),kr(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Wn(s,{x:a,y:o});(c==null?void 0:c.category)===Gn.ISOBJECT&&Hr(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)kr(s,{x:a,y:o});break}}}function OM(e,t,n){const r=IM(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,nb),Bt(e,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),Bt(e,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),Bt(e,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=wn(e);i.scroll=Zr(e)}function CM(e,t,n){const r=En(Ft.MAIN);if(!k(r))return;const i=ar(e);if(!k(i))return;if(Er(r,i),t.x===n.x&&t.y===n.y){const o=Wn(i,t),a=P_(r,o);k(o)&&k(a)&&RM(e,i,a,o,t,Yo(o)),o!=null&&o.kind||(se(e,`empty: ${t.x}, ${t.y}`),se(e,nb),Bt(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]))}else AM(e,t,n);const s=wn(e);s.scroll=Zr(e)}function LM(e,t){const n=le(Ft.MAIN);if(!k(n))return;const r=ar(t);if(!k(r))return;const i=lr(e),s=ZL(r,i.target);if(k(s))switch(i.path){case"copycoords":ql(Y,qr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":vM(t,s,i.path);break;case"char":SM(t,s,i.path);break;case"empty":Hr(n,r,s,n.timestamp);break;case"code":bo(Y,t,async()=>{const o=Fr(s),a="object";Be(Y,t,`opened [${a}] ${o}`);const c=[r.id,s.id];Yu(Na(n.id,c),s.code??""),eE(Y,t),await Cd(800),Id(Y,t,n.id,c,a,`${o} - ${n.name}`,[])});break;default:console.info("unknown inspect",i);break}}function MM(e,t){const n=ar(t);if(!k(n))return;const r=lr(e),[i,s,o,a]=r.path.split(",").map(l=>parseFloat(l)),c={x:i,y:s},u={x:o,y:a};switch(r.target){case"copy":bM(t,c,u);break;case"copyall":case"copyobjects":case"copyterrain":_M(t,c,u,r.target);break;case"paste":wM(t,c,u);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":EM(t,c,u,r.target);break;case"empty":OM(t,c,u);break;case"emptyall":case"emptyobjects":case"emptyterrain":NM(t,c,u,r.target);break;case"chars":xM(t,c,u,"char");break;case"colors":kM(t,c,u,"color");break;case"bgs":TM(t,c,u,"bg");break;case"copycoords":ql(Y,t,[i,s,o,a].join(" "));break;case"remixrun":Nf(n.id,Aa.stat,Aa.patternsize,Aa.mirror,c,u);break;case"pageopen":bo(Y,t,async()=>{await Cd(800),bE(Y,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const UM=16,ks={},FM=15*60*5;let rb=0;const wo={},xo={};async function ib(e){const t=mo(),n=le(Ft.MAIN);if(t.length&&k(n)){const r=await Q1(t),i=e?"autosave":`${new Date().toISOString()} ${n.name} ${r.length} chars`;iE(oe,qr(),i,r)}}async function BM(){const e=mo(),t=le(Ft.MAIN);if(e.length&&k(t)){const n=await Q1(e);sE(oe,qr(),n)}}const oe=vs("vm",["tick","second"],e=>{var n;if(!oe.session(e))return;const t=qr();switch(e.target){case"operator":IL(e.player),Pt(oe,e.player,`operator set to ${e.player}`),oe.replynext(e,"ackoperator",!0);break;case"zsswords":if(e.player===t){const r=le(Ft.MAIN);oe.replynext(e,"ackzsswords",{cli:Wf(Ki.CLI),loader:Wf(Ki.LOADER),runtime:Wf(Ki.RUNTIME),flags:[...Kn(Es(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...ms(r,Et.OBJECT).map(i=>Me(i)),...Kn(Df)],altkinds:[...ms(r,Et.TERRAIN),...ms(r,Et.BOARD),...ms(r,Et.PALETTE),...ms(r,Et.CHARSET),...ms(r,Et.LOADER)].map(i=>Me(i)),colors:[...Kn(zo)],dirs:[...Kn(ed).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Kn($f)]})}break;case"books":e.player===t&&bo(oe,e.player,async()=>{if(re(e.data)){const[r,i]=e.data,s=await mM(r),o=s.map(a=>a.name);UL(s,i),Pt(oe,e.player,`loading ${o.join(", ")}`),Xl(oe,e.player)}});break;case"search":DL(e.player)||Xl(oe,e.player);break;case"logout":PL(e.player),delete ks[e.player],Pt(oe,t,`player ${e.player} logout`),Xl(oe,e.player);break;case"login":BL(e.player)?(ks[e.player]=0,Pt(oe,qr(),`login from ${e.player}`),oe.replynext(e,"acklogin",!0)):rE(oe,e.player);break;case"doot":ks[e.player]=0,vd(oe,e.player,"active");break;case"input":{const r=Es(e.player),[i=mn.NONE,s=0]=e.data??[mn.NONE,0];re(r.inputqueue)||(r.inputqueue=[]),i!==mn.NONE&&r.inputqueue.push([i,s]);break}case"codewatch":if(re(e.data)){const[r,i]=e.data,s=Na(r,i);k(xo[s])||(xo[s]=T0(s,o=>{const[a,c]=i,u=wr(r),l=Ei(u,a);if(k(l))if(_i(l)===Et.BOARD&&k(c)){const h=un(l),f=Ln(h,c);k(f)&&(f.code=o,xf(M_(o),f))}else l.code=o,AC(l)})),wo[s]=wo[s]??new Set,wo[s].add(e.player)}break;case"coderelease":if(re(e.data)){const[r,i]=e.data,[,s]=i,o=Na(r,i);k(wo[o])&&(wo[o].delete(e.player),wo[o].size===0&&((n=xo[o])==null||n.call(xo),xo[o]=void 0,St(s)&&zL(s)))}break;case"halt":e.player===t&&zb(e.data)&&NL(e.data);break;case"tick":OL()||KL();break;case"synthsend":St(e.data)&&td(e.data,void 0);break;case"second":{$L(ks);const r=Object.keys(ks);for(let i=0;i<r.length;++i)++ks[r[i]];for(let i=0;i<r.length;++i){const s=r[i];ks[s]>=UM&&Nd(oe,s)}++rb>=FM&&(rb=0,bo(oe,e.player,async()=>{await ib(!0)}));break}case"copyjsonfile":if(e.player===t){const r=le(Ft.MAIN);if(k(r)&&re(e.data)){const[i]=e.data,s=Ei(r,i);k(s)&&oE(oe,t,s,`${Me(s)}.${bi(s)}.json`)}}break;case"refsheet":{if(e.player===t){const r=le(Ft.MAIN),i=_l(r);k(r)&&re(e.data)&&(_E(oe,e.player),ys(oe,e.player,"use as refsheet"),i.forEach(s=>{const o=Me(s),a=bi(s);Pt(oe,e.player,`!pageopenwith ${s.id} ${e.data.join(" ")};$blue[${a}]$white ${o}`)}))}break}case"fork":e.player===t&&bo(oe,e.player,async()=>{await BM()});break;case"flush":e.player===t&&bo(oe,e.player,async()=>{await ib()});break;case"cli":GL(e.player,e.data);break;case"restart":e.player===t&&(WL(),Od(oe,e.player));break;case"inspect":if(re(e.data)){const[r,i]=e.data;CM(e.player,r,i)}break;case"loader":if(re(e.data)){const[r,i,s,o]=e.data;if(i==="file")Z1(e.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){Pt(oe,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=le(Ft.MAIN);k(c)&&k(a.data)&&St(a.exported)&&(Zf(a.data),Pt(oe,e.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){Pt(oe,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=le(Ft.MAIN);k(c)&&k(a.data)&&St(a.exported)&&(D_(c,a.data),Pt(oe,e.player,`loaded ${a.exported}`))}else h4(r,i,s,o,e.player)}break;default:{const{target:r,path:i}=lr(e.target);switch(Mt(r)){case"batch":MM(i,e.player);break;case"empty":{const s=lr(i);switch(s.target){case"copycoords":ql(oe,qr(),s.path.split(",").join(" "));break}break}case"inspect":LM(i,e.player);break;case"touched":if(re(e.data)){const[s,o,a]=e.data;$1({...e,target:`${s}:${a}`,data:void 0,sender:o})}break;default:$1(e);break}break}}},RL());function PM(){nE(oe)}const{forward:DM}=AE(e=>{vE(e)&&postMessage(e)});onmessage=function(t){DM(t.data)},setTimeout(PM,100)})();

var iC=Object.defineProperty;var oC=($e,nt,Tn)=>nt in $e?iC($e,nt,{enumerable:!0,configurable:!0,writable:!0,value:Tn}):$e[nt]=Tn;var P=($e,nt,Tn)=>(oC($e,typeof nt!="symbol"?nt+"":nt,Tn),Tn);(function(){"use strict";const $e=new Set,nt={emit(e,t,n,r){nt.invoke(cg(e,t,n,r))},invoke(e){$e.forEach(t=>t.handle(e))},connect(e){$e.add(e)},disconnect(e){$e.delete(e)}},Tn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ig=e=>crypto.getRandomValues(new Uint8Array(e)),og=(e,t,n)=>{let r=(2<<Math.log(e.length-1)/Math.LN2)-1,s=-~(1.6*r*t/e.length);return(i=t)=>{let o="";for(;;){let a=n(s),c=s;for(;c--;)if(o+=e[a[c]&r]||"",o.length===i)return o}}},qc=(e,t=21)=>og(e,t,ig),ag=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=Tn[n[e]&63];return t};function Sn(){return ag()}function cg(e,t,n,r){return{id:Sn(),target:e,sender:t,data:n,player:r}}function Xc(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Nr(e,t,n){const r=Sn(),s=e.toLowerCase(),i=t.map(a=>a.toLowerCase()),o={id(){return r},name(){return e},tags(){return t},emit(a,c,l){nt.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=Xc(a.target),u=c.toLowerCase();i.findIndex(h=>h==="all"||h===u)!==-1&&n(a),(r===c||u==="all"||s===u)&&n({...a,target:l})}};return nt.connect(o),o}function lg(e){const t=new Set;function n(r){t.has(r.id)||(t.add(r.id),nt.invoke(r))}return Nr("forward",["all"],r=>{t.has(r.id)||(t.add(r.id),e(r))}),n}var Rs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ao(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ug(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}),n}var Jc="abcdefghijklmnopqrstuvwxyz",Qc="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Zc="0123456789",hg="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",fg="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const dg=Zc,pg=Jc,gg=Qc;var mg=dg+pg+gg,co={lowercase:Jc,uppercase:Qc,numbers:Zc,nolookalikes:hg,nolookalikesSafe:fg,alphanumeric:mg},Et=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.CLEAR=32]="CLEAR",e[e.SHADOW=33]="SHADOW",e[e.BORROW=34]="BORROW",e))(Et||{});function vs(e,t){return new Array(e).fill(t)}function Eg(e,t,n,r,s=0){const i=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:vs(i,0),color:vs(i,0),bg:vs(i,s)}}function _g(e,t,n,r=1,s=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:s,bg:32}}function yg(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function Tg(e,t,n,r,s=0){const i=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:vs(i,s)}}function Sg(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:2}}var Vt=(e=>(e[e.START=0]="START",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM",e[e.SCROLL=5]="SCROLL",e))(Vt||{});const Ag={start:0,left:1,right:2,top:3,bottom:4,scroll:5},wg={0:1,1:20,2:20,3:1,4:1,5:40},Rg=1,vg=16,Ng=256;var ht=(e=>(e[e.NONE=0]="NONE",e[e.MOVE_UP=1]="MOVE_UP",e[e.MOVE_DOWN=2]="MOVE_DOWN",e[e.MOVE_LEFT=3]="MOVE_LEFT",e[e.MOVE_RIGHT=4]="MOVE_RIGHT",e[e.OK_BUTTON=5]="OK_BUTTON",e[e.CANCEL_BUTTON=6]="CANCEL_BUTTON",e[e.MENU_BUTTON=7]="MENU_BUTTON",e))(ht||{});function Vn(e,t,n,r){const s=r??"anon";return nt.emit(`error:${t}`,e,n,s),Og(e,n,s)}function Ig(e,t,n){nt.emit("gadgetclient:reset",e,t,n)}function Cg(e,t,n){nt.emit("gadgetclient:patch",e,t,n)}function bg(e,t,n){nt.emit("register:read",e,[t],n)}function Lg(e,t,n,r){nt.emit("register:write",e,[t,n],r)}function Ns(e,...t){return nt.emit("tape:info",e,t),!0}function tl(e,...t){return nt.emit("tape:debug",e,t),!0}function Og(e,...t){return nt.emit("tape:error",e,t),!1}var el={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Rs,function(){return n.importState=function(s){var i=new n;return i.importState(s),i},n;function n(){return function(s){var i=0,o=0,a=0,c=1;s.length==0&&(s=[+new Date]);var l=r();i=l(" "),o=l(" "),a=l(" ");for(var u=0;u<s.length;u++)i-=l(s[u]),i<0&&(i+=1),o-=l(s[u]),o<0&&(o+=1),a-=l(s[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*i+c*23283064365386963e-26;return i=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=s,h.exportState=function(){return[i,o,a,c]},h.importState=function(d){i=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,i=function(o){o=o.toString();for(var a=0;a<o.length;a++){s+=o.charCodeAt(a);var c=.02519603282416938*s;s=c>>>0,c-=s,c*=s,s=c>>>0,c-=s,s+=c*4294967296}return(s>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})})(el);var kg=el.exports,Mg=ao(kg);const xg=Mg("089fad0j9awfem09wavefc09uwaef");function An(e,t=0,n=1){return Math.max(t,Math.min(n,e))}function Ug(){return xg()}function Is(e,t){const n=Math.min(e,t),s=Math.max(e,t)-n+1;return n+Math.floor(Ug()*s)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Pg=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)s.hasOwnProperty(i)&&(r[i]=s[i])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Dg=Object.prototype.hasOwnProperty;function lo(e,t){return Dg.call(e,t)}function uo(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var s in e)lo(e,s)&&r.push(s);return r}function Lt(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ho(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function wn(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function nl(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function fo(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(fo(e[t]))return!0}else if(typeof e=="object"){for(var r=uo(e),s=r.length,i=0;i<s;i++)if(fo(e[r[i]]))return!0}}return!1}function rl(e,t){var n=[e];for(var r in t){var s=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof s<"u"&&n.push(r+": "+s)}return n.join(`
`)}var sl=function(e){Pg(t,e);function t(n,r,s,i,o){var a=this.constructor,c=e.call(this,rl(n,{name:r,index:s,operation:i,tree:o}))||this;return c.name=r,c.index=s,c.operation=i,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=rl(n,{name:r,index:s,operation:i,tree:o}),c}return t}(Error),rt=sl,Fg=Lt,zn={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Cs(n,this.path);r&&(r=Lt(r));var s=Rn(n,{op:"remove",path:this.from}).removed;return Rn(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Cs(n,this.from);return Rn(n,{op:"add",path:this.path,value:Lt(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Ir(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},$g={add:function(e,t,n){return ho(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:zn.move,copy:zn.copy,test:zn.test,_get:zn._get};function Cs(e,t){if(t=="")return e;var n={op:"_get",path:t};return Rn(e,n),n.value}function Rn(e,t,n,r,s,i){if(n===void 0&&(n=!1),r===void 0&&(r=!0),s===void 0&&(s=!0),i===void 0&&(i=0),n&&(typeof n=="function"?n(t,0,e,t.path):bs(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Cs(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Ir(e,t.value),o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new rt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,t,e);return o}}else{r||(e=Lt(e));var a=t.path||"",c=a.split("/"),l=e,u=1,h=c.length,d=void 0,f=void 0,m=void 0;for(typeof n=="function"?m=n:m=bs;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=nl(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!ho(f))throw new rt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,t,e);ho(f)&&(f=~~f)}if(u>=h){if(n&&t.op==="add"&&f>l.length)throw new rt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,t,e);var o=$g[t.op].call(t,l,f,e);if(o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o}}else if(u>=h){var o=zn[t.op].call(t,l,f,e);if(o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new rt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,t,e)}}}function po(e,t,n,r,s){if(r===void 0&&(r=!0),s===void 0&&(s=!0),n&&!Array.isArray(t))throw new rt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Lt(e));for(var i=new Array(t.length),o=0,a=t.length;o<a;o++)i[o]=Rn(e,t[o],n,!0,s,o),e=i[o].newDocument;return i.newDocument=e,i}function Bg(e,t,n){var r=Rn(e,t);if(r.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function bs(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new rt("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(zn[e.op]){if(typeof e.path!="string")throw new rt("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new rt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new rt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new rt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&fo(e.value))throw new rt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var s=e.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new rt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new rt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=il([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new rt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new rt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function il(e,t,n){try{if(!Array.isArray(e))throw new rt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)po(Lt(t),Lt(e),n||!0);else{n=n||bs;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(s){if(s instanceof rt)return s;throw s}}function Ir(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),s,i,o;if(n&&r){if(i=e.length,i!=t.length)return!1;for(s=i;s--!==0;)if(!Ir(e[s],t[s]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(i=a.length,i!==Object.keys(t).length)return!1;for(s=i;s--!==0;)if(!t.hasOwnProperty(a[s]))return!1;for(s=i;s--!==0;)if(o=a[s],!Ir(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var Gg=Object.freeze({__proto__:null,JsonPatchError:rt,_areEquals:Ir,applyOperation:Rn,applyPatch:po,applyReducer:Bg,deepClone:Fg,getValueByPointer:Cs,validate:il,validator:bs});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var go=new WeakMap,jg=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Wg=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function Kg(e){return go.get(e)}function Hg(e,t){return e.observers.get(t)}function Vg(e,t){e.observers.delete(t.callback)}function zg(e,t){t.unobserve()}function Yg(e,t){var n=[],r,s=Kg(e);if(!s)s=new jg(e),go.set(e,s);else{var i=Hg(s,t);r=i&&i.observer}if(r)return r;if(r={},s.value=Lt(e),t){r.callback=t,r.next=null;var o=function(){mo(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){mo(r),clearTimeout(r.next),Vg(s,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},s.observers.set(t,new Wg(t,r)),r}function mo(e,t){t===void 0&&(t=!1);var n=go.get(e.object);Eo(n.value,e.object,e.patches,"",t),e.patches.length&&po(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Eo(e,t,n,r,s){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var i=uo(t),o=uo(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(lo(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var h=t[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?Eo(u,h,n,r+"/"+wn(l),s):u!==h&&(s&&n.push({op:"test",path:r+"/"+wn(l),value:Lt(u)}),n.push({op:"replace",path:r+"/"+wn(l),value:Lt(h)}))}else Array.isArray(e)===Array.isArray(t)?(s&&n.push({op:"test",path:r+"/"+wn(l),value:Lt(u)}),n.push({op:"remove",path:r+"/"+wn(l)}),a=!0):(s&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&i.length==o.length))for(var c=0;c<i.length;c++){var l=i[c];!lo(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+wn(l),value:Lt(t[l])})}}}function _o(e,t,n){n===void 0&&(n=!1);var r=[];return Eo(e,t,r,"",n),r}var qg=Object.freeze({__proto__:null,compare:_o,generate:mo,observe:Yg,unobserve:zg});Object.assign({},Gg,qg,{JsonPatchError:sl,deepClone:Lt,escapePathComponent:wn,unescapePathComponent:nl});function E(e){return e!=null}function Xg(e,t){return _o(e,t).length===0}function Jg(e){return Lt(e)}function vt(e){return typeof e=="number"}function st(e){return typeof e=="string"}function Be(e){return Array.isArray(e)}function yo(e,t,n){typeof e!="number"&&(e=0,t=0,n=1),typeof t!="number"&&(t=e,e=0,n=1),typeof n!="number"&&(n=1);const r=[],s=Math.min(e,t),i=Math.max(e,t);for(let o=s;o<=i;o+=n)r.push(o);return r}function Qg(e){return e[Is(0,e.length-1)]}function Ge(...e){return Qg(e.flat())}function Zg(e){return[...new Set(e)].filter(E)}function tm(...e){const t=e.flat().filter(E);return t.reduce((n,r)=>n+r,0)/t.length}function ol(e,t){const n=e??Nt.WALK,r=t??Nt.WALK;switch(n){case Nt.WALK:return r!==Nt.WALK;case Nt.SWIM:return r!==Nt.SWIM;case Nt.SOLID:return!0;case Nt.BULLET:return r!==Nt.WALK&&r!==Nt.SWIM}}function To(e,t){var r,s;return[...((s=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:s.values())??[]].map(i=>typeof i=="string"?e==null?void 0:e.objects[i]:e==null?void 0:e.terrain[i]).filter(E)}function em(e,t){const n=No(t),r=vl(t),s=Nl(t);return e.filter(i=>!(E(n)&&am(i)!==n||E(r)&&cm(i)!==r||E(s)&&lm(i)!==s)).filter(E)}function So(e,t){return E(e)?t.map(n=>{var r;if(typeof n=="string"){const s=e.objects[n];if(E(s))return s;const i=To(e,n.toLowerCase());if(i.length)return i}else if(ye(n)&&n.x>=0&&n.x<e.width&&n.y>=0&&n.y<e.height){const s=n.x+n.y*e.width,i=(r=e.lookup)==null?void 0:r[s];return E(i)?e.objects[i]:e.terrain[s]}}).flat().filter(E):[]}function nm(e,t){let n=0,r;for(let s=0;s<t.length;++s){const i=t[s];if(i){const o=e.x-(i.x??0),a=e.y-(i.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=i)}}return r}const rm=60,sm=25;new Array(rm*sm);function im(e,t){return!E(e)||t.x<0||t.x>=e.width||t.y<0||t.y>=e.height?-1:t.x+t.y*e.width}function om(e,t){const n=im(e,t);if(n<0||!E(e==null?void 0:e.lookup))return;const r=Ao(e,e.lookup[n]??"");return E(r)?r:e.terrain[n]}function am(e){var t;return((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"object").toLowerCase()}function cm(e){var t;return(e==null?void 0:e.color)??((t=e==null?void 0:e.kinddata)==null?void 0:t.color)??Et.BLACK}function lm(e){var t;return(e==null?void 0:e.bg)??((t=e==null?void 0:e.kinddata)==null?void 0:t.bg)??Et.BLACK}function Ls(e,t){if(!E(e)||!Yt(t))return;const n=Tl(t);E(n)&&(e.color=n);const r=Sl(t);E(r)&&(e.bg=r)}function um(e,t){if(!E(e)||!E(t)||!E(t.x)||!E(t.y)||t.x<0||t.x>=e.width||t.y<0||t.y>=e.height)return;const n={...t},r=t.x+t.y*e.width;return e.terrain[r]=n,t}function al(e,t){if(!E(e)||!E(t))return;const n={...t,id:t.id??Sn()};return e.objects[n.id]=n,n}function cl(e,t,n){return um(e,{...t,kind:n})}function ll(e,t,n){return al(e,{...t,kind:n})}function Ao(e,t){if(e)return e.objects[t]}function Yn(e,t,n){if(!E(e)||!E(t))return{x:0,y:0};const r={x:t.x??0,y:t.y??0},s={x:t.lx??r.x,y:t.ly??r.y},i={...r},o=rn(s,r),a=e.width-1,c=e.height-1;for(let l=0;l<n.length;++l){const u=dm(n[l]);switch(u){case K.IDLE:break;case K.NORTH:case K.SOUTH:case K.WEST:case K.EAST:zt(r,u);break;case K.BY:{const[h,d]=n.slice(l+1);vt(h)&&vt(d)&&(r.x=An(r.x+h,0,a),r.y=An(r.y+d,0,c)),l+=2;break}case K.AT:{const[h,d]=n.slice(l+1);vt(h)&&vt(d)&&(r.x=An(h,0,a),r.y=An(d,0,c)),l+=2;break}case K.FLOW:zt(r,o);break;case K.SEEK:{const h=Ro(e,t);ye(h)&&zt(r,rn(i,h));break}case K.RNDNS:zt(r,Ge(K.NORTH,K.SOUTH));break;case K.RNDNE:zt(r,Ge(K.NORTH,K.EAST));break;case K.RND:zt(r,Ge(K.NORTH,K.SOUTH,K.WEST,K.EAST));break;case K.CW:{const h=Yn(e,t,n.slice(l+1));zt(r,rn(i,h));break}case K.CCW:{const h=Yn(e,t,n.slice(l+1));zt(r,rn(i,h));break}case K.OPP:{const h=Yn(e,t,n.slice(l+1));zt(r,rn(i,h));break}case K.RNDP:{const h=Yn(e,t,n.slice(l+1));switch(rn(i,h)){case K.NORTH:case K.SOUTH:r.x+=Ge(-1,1);break;case K.WEST:case K.EAST:r.y+=Ge(-1,1);break}break}}}return r}function wo(e,t){return E(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function Ro(e,t){var s;if(!E(e)||!E(t))return;const n=((s=t.stats)==null?void 0:s.player)??"",r=e.objects[n];if(E(r))return r;if(ye(t))return nm(t,To(e,"player"))}function hm(e,t,n){return{book:e.book,board:e.board,object:e.object,terrain:e.terrain,charset:e.charset,palette:e.palette,words:t,get:n}}var K=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(K||{}),Nt=(e=>(e[e.SOLID=0]="SOLID",e[e.WALK=1]="WALK",e[e.SWIM=2]="SWIM",e[e.BULLET=3]="BULLET",e))(Nt||{}),Os=(e=>(e[e.TERRAIN=0]="TERRAIN",e[e.OBJECT=1]="OBJECT",e))(Os||{});function ye(e){return E(e)&&E(e.x)&&E(e.y)}function zt(e,t){switch(t){case 1:--e.y;break;case 2:++e.y;break;case 3:--e.x;break;case 4:++e.x;break}return e}function rn(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return 3;if(n>0)return 4;if(r<0)return 1;if(r>0)return 2}const ul={terrain:"TERRAIN",object:"OBJECT"};function sn(e){return Be(e)&&hl(e[0])}function hl(e){return E(Os[e])&&st(e)}function fl(e){if(st(e))return ul[e.toLowerCase()]}function dl(e){if(sn(e))return e;if(hl(e))return[e];const t=fl(e);if(E(t))return[t]}function ks(e,t){const n=e.words[t],r=dl(n);if(sn(r))return[r,t+1];const[s,i]=Ot(e,t),o=dl(s);return sn(o)?[o,i]:[void 0,t]}const pl={solid:"SOLID",walk:"WALK",swim:"SWIM",bullet:"BULLET",walkable:"WALK",swimmable:"SWIM"};function vn(e){return Be(e)&&vo(e[0])}function vo(e){return E(Nt[e])&&st(e)}function fm(e){if(st(e))return pl[e.toLowerCase()]}function gl(e,t){const n=e.words[t];if(vn(n))return[n,t+1];if(vo(n))return[[n],t+1];const[r,s]=Ot(e,t);return vn(r)?[r,s]:vo(r)?[[r],s]:[void 0,t]}const ml={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",clear:"CLEAR",shadow:"SHADOW",borrow:"BORROW",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY"};function Yt(e){return Be(e)&&_l(e[0])}function El(e){return Yt(e)&&e[0].startsWith("ON")}function _l(e){return E(Et[e])&&st(e)}function yl(e){if(st(e))return ml[e.toLowerCase()]}function Tl(e){return e.map(t=>Et[t]).find(t=>E(t)&&t<Et.ONBLACK)}function Sl(e){return e.map(t=>Et[t]).find(t=>E(t)&&t>=Et.ONBLACK)}function Al(e){if(Yt(e))return e;if(_l(e))return[e];const t=yl(e);if(E(t))return[t]}function wl(e,t){const n=e.words[t],r=Al(n);if(Yt(r))return[r,t+1];const[s,i]=Ot(e,t),o=Al(s);return Yt(o)?[o,i]:[void 0,t]}function Ms(e,t){const n=[];let r=t;const[s,i]=wl(e,t);if(Yt(s)&&(n.push(...s),r=i),Yt(n)&&!El(n)){const[o,a]=wl(e,i);El(o)&&(r=a)}return n.length?[n,r]:[void 0,t]}function qn(e){return Be(e)&&typeof e[0]=="string"}function Rl(e,t){const n=e.words[t];if(qn(n))return[n,t+1];const[r,s]=Ms(e,t),[i,o]=Ot(e,s,!1);return st(i)?[[i,r],o]:[void 0,t]}function No(e){if(!qn(e))return;const[t]=e;return t}function vl(e){if(!qn(e))return;const[,t]=e,n=E(t)?Tl(t):void 0;return E(n)?n:void 0}function Nl(e){if(!qn(e))return;const[,t]=e,n=E(t)?Sl(t):void 0;return E(n)?n:void 0}const Il={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function je(e){return Be(e)&&Cl(e[0])}function Cl(e){return E(K[e])&&st(e)}function dm(e){const t=K[e];return E(t)?t:0}function bl(e){if(st(e))return Il[e.toLowerCase()]}function Ll(e){if(je(e))return e;if(Cl(e))return[e];const t=bl(e);if(E(t))return[t]}function Ol(e,t){const n=e.words[t],r=Ll(n);if(je(r))return[r,t+1];const[s,i]=Ot(e,t),o=Ll(s);return je(o)?[o,i]:[void 0,t]}function Io(e,t){const n=[];let[r,s]=Ol(e,t);for(;je(r);){if(n.push(...r),r[0]==="AT"||r[0]==="BY"){const[a,c,l]=C(e,s,[5,5]);n.push(a,c),s=l}const[i,o]=Ol(e,s);r=i,s=o}return n.length?[n,s]:[void 0,t]}function Ot(e,t,n=!0){const r=e.words[t];if(fl(r)){const[s,i]=ks(e,t);if(E(s))return[s,i]}if(fm(r)){const[s,i]=gl(e,t);if(E(s))return[s,i]}if(yl(r)){const[s,i]=Ms(e,t);if(E(s))return[s,i]}if(st(r)&&r.toLowerCase()==="rnd"){const[s,i]=Ot(e,t+1),[o,a]=Ot(e,i);return vt(s)&&vt(o)?[Is(s,o),a]:vt(s)?[Is(0,s),i]:[Is(0,1),t+1]}if(bl(r)){const[s,i]=Io(e,t);if(E(s))return[s,i]}if(!E(r))return[void 0,t];if(ye(r)||vt(r)||Be(r))return[r,t+1];if(st(r)){const s=r.toLowerCase();if(n){const i=e.get(r);if(E(i))return[i,t+1]}switch(s){case"aligned":case"alligned":break;case"contact":break;case"blocked":break;case"any":break;case"abs":{const[i,o]=C(e,t+1,[5]);return[Math.abs(i),o]}case"ceil":{const[i,o]=C(e,t+1,[5]);return[Math.ceil(i),o]}case"floor":{const[i,o]=C(e,t+1,[5]);return[Math.floor(i),o]}case"round":{const[i,o]=C(e,t+1,[5]);return[Math.round(i),o]}case"min":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=Ot(e,o);if(Be(a)&&!ye(a)&&!je(a)&&!sn(a)&&!vn(a)&&!Yt(a))return[Ge(a),c];o=c,i.push(a)}return[Math.min(...i),e.words.length]}case"max":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=Ot(e,o);if(Be(a)&&!ye(a)&&!je(a)&&!sn(a)&&!vn(a)&&!Yt(a))return[Ge(a),c];o=c,i.push(a)}return[Math.max(...i),e.words.length]}case"clamp":{const[i,o,a,c]=C(e,t+1,[5,5,5]);return[An(i,o,a),c]}case"pick":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=Ot(e,o);if(Be(a)&&!ye(a)&&!je(a)&&!sn(a)&&!vn(a)&&!Yt(a))return[Ge(a),c];o=c,i.push(a)}return[Ge(i),e.words.length]}case"range":{const[i,o,a,c]=C(e,t+1,[5,13,13]);return[yo(i,o,a),c]}}}return[r,t+1]}var N=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NUMBER=5]="NUMBER",e[e.STRING=6]="STRING",e[e.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=9]="MAYBE_COLLISION",e[e.MAYBE_COLOR=10]="MAYBE_COLOR",e[e.MAYBE_KIND=11]="MAYBE_KIND",e[e.MAYBE_DIR=12]="MAYBE_DIR",e[e.MAYBE_NUMBER=13]="MAYBE_NUMBER",e[e.MAYBE_STRING=14]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",e[e.ANY=16]="ANY",e))(N||{});function It(e,t){throw new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function C(e,t,n){const r=[];let s=t;for(let i=0;i<n.length;++i)switch(n[i]){case 0:{const[o,a]=ks(e,s);sn(o)||It("terrain or object",o),s=a,r.push(o);break}case 1:{const[o,a]=gl(e,s);vn(o)||It("solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 2:{const[o,a]=Ms(e,s);Yt(o)||It("color",o),s=a,r.push(o);break}case 3:{const[o,a]=Rl(e,s);qn(o)?(s=a,r.push(o)):It("kind",o);break}case 4:{const[o,a]=Io(e,s);if(je(o)){const c=e.board?Yn(e.board,e.object,o):{x:0,y:0};s=a,r.push(c)}else It("direction",o);break}case 5:{const[o,a]=Ot(e,s);vt(o)||It("number",o),s=a,r.push(o);break}case 6:{const o=e.words[s];st(o)||It("string",o),++s,r.push(o);break}case 7:{const[o,a]=Ot(e,s,!1);!vt(o)&&!st(o)&&It("number or string",o),s=a,r.push(o);break}case 8:{const[o,a]=ks(e,s);o!==void 0&&!sn(o)&&It("optional terrain or object",o),s=a,r.push(o);break}case 9:{const[o,a]=ks(e,s);o!==void 0&&!vn(o)&&It("optional solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 10:{const[o,a]=Ms(e,s);o!==void 0&&!Yt(o)&&It("optional color",o),s=a,r.push(o);break}case 11:{const[o,a]=Rl(e,s);o!==void 0&&!qn(o)&&It("optional kind",o),s=a,r.push(o);break}case 12:{const[o,a]=Io(e,s);if(je(o)){const c=e.board?Yn(e.board,e.object,o):{x:0,y:0};s=a,r.push(c)}else o===void 0?(s=a,r.push(void 0)):It("optional direction",o);break}case 13:{const[o,a]=Ot(e,s);o!==void 0&&!vt(o)&&It("optional number",o),s=a,r.push(o);break}case 14:{const o=e.words[s];o!==void 0&&!st(o)&&It("optional string",o),++s,r.push(o);break}case 15:{const[o,a]=Ot(e,s,!1);o!==void 0&&!vt(o)&&!st(o)&&It("optional number or string",o),s=a,r.push(o);break}case 16:{const[o,a]=Ot(e,s);s=a,r.push(o);break}}return[...r,s]}const Co=40,bo=Math.round(1e3/Co),pm=3;var kl=typeof global=="object"&&global&&global.Object===Object&&global,gm=typeof self=="object"&&self&&self.Object===Object&&self,Te=kl||gm||Function("return this")(),qt=Te.Symbol,Ml=Object.prototype,mm=Ml.hasOwnProperty,Em=Ml.toString,Cr=qt?qt.toStringTag:void 0;function _m(e){var t=mm.call(e,Cr),n=e[Cr];try{e[Cr]=void 0;var r=!0}catch{}var s=Em.call(e);return r&&(t?e[Cr]=n:delete e[Cr]),s}var ym=Object.prototype,Tm=ym.toString;function Sm(e){return Tm.call(e)}var Am="[object Null]",wm="[object Undefined]",xl=qt?qt.toStringTag:void 0;function on(e){return e==null?e===void 0?wm:Am:xl&&xl in Object(e)?_m(e):Sm(e)}function ae(e){return e!=null&&typeof e=="object"}var Rm="[object Symbol]";function xs(e){return typeof e=="symbol"||ae(e)&&on(e)==Rm}function Us(e,t){for(var n=-1,r=e==null?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s}var j=Array.isArray,vm=1/0,Ul=qt?qt.prototype:void 0,Pl=Ul?Ul.toString:void 0;function Dl(e){if(typeof e=="string")return e;if(j(e))return Us(e,Dl)+"";if(xs(e))return Pl?Pl.call(e):"";var t=e+"";return t=="0"&&1/e==-vm?"-0":t}var Nm=/\s/;function Im(e){for(var t=e.length;t--&&Nm.test(e.charAt(t)););return t}var Cm=/^\s+/;function bm(e){return e&&e.slice(0,Im(e)+1).replace(Cm,"")}function Xt(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Fl=NaN,Lm=/^[-+]0x[0-9a-f]+$/i,Om=/^0b[01]+$/i,km=/^0o[0-7]+$/i,Mm=parseInt;function xm(e){if(typeof e=="number")return e;if(xs(e))return Fl;if(Xt(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Xt(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=bm(e);var n=Om.test(e);return n||km.test(e)?Mm(e.slice(2),n?2:8):Lm.test(e)?Fl:+e}var $l=1/0,Um=17976931348623157e292;function Pm(e){if(!e)return e===0?e:0;if(e=xm(e),e===$l||e===-$l){var t=e<0?-1:1;return t*Um}return e===e?e:0}function Ps(e){var t=Pm(e),n=t%1;return t===t?n?t-n:t:0}function Xn(e){return e}var Dm="[object AsyncFunction]",Fm="[object Function]",$m="[object GeneratorFunction]",Bm="[object Proxy]";function We(e){if(!Xt(e))return!1;var t=on(e);return t==Fm||t==$m||t==Dm||t==Bm}var Lo=Te["__core-js_shared__"],Bl=function(){var e=/[^.]+$/.exec(Lo&&Lo.keys&&Lo.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Gm(e){return!!Bl&&Bl in e}var jm=Function.prototype,Wm=jm.toString;function Nn(e){if(e!=null){try{return Wm.call(e)}catch{}try{return e+""}catch{}}return""}var Km=/[\\^$.*+?()[\]{}|]/g,Hm=/^\[object .+?Constructor\]$/,Vm=Function.prototype,zm=Object.prototype,Ym=Vm.toString,qm=zm.hasOwnProperty,Xm=RegExp("^"+Ym.call(qm).replace(Km,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Jm(e){if(!Xt(e)||Gm(e))return!1;var t=We(e)?Xm:Hm;return t.test(Nn(e))}function Qm(e,t){return e==null?void 0:e[t]}function In(e,t){var n=Qm(e,t);return Jm(n)?n:void 0}var Oo=In(Te,"WeakMap"),Gl=Object.create,Zm=function(){function e(){}return function(t){if(!Xt(t))return{};if(Gl)return Gl(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function tE(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function ft(){}function eE(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var nE=800,rE=16,sE=Date.now;function iE(e){var t=0,n=0;return function(){var r=sE(),s=rE-(r-n);if(n=r,s>0){if(++t>=nE)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function oE(e){return function(){return e}}var Ds=function(){try{var e=In(Object,"defineProperty");return e({},"",{}),e}catch{}}(),aE=Ds?function(e,t){return Ds(e,"toString",{configurable:!0,enumerable:!1,value:oE(t),writable:!0})}:Xn,cE=iE(aE);function jl(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Wl(e,t,n,r){for(var s=e.length,i=n+-1;++i<s;)if(t(e[i],i,e))return i;return-1}function lE(e){return e!==e}function uE(e,t,n){for(var r=n-1,s=e.length;++r<s;)if(e[r]===t)return r;return-1}function ko(e,t,n){return t===t?uE(e,t,n):Wl(e,lE,n)}function Kl(e,t){var n=e==null?0:e.length;return!!n&&ko(e,t,0)>-1}var hE=9007199254740991,fE=/^(?:0|[1-9]\d*)$/;function Fs(e,t){var n=typeof e;return t=t??hE,!!t&&(n=="number"||n!="symbol"&&fE.test(e))&&e>-1&&e%1==0&&e<t}function Mo(e,t,n){t=="__proto__"&&Ds?Ds(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function br(e,t){return e===t||e!==e&&t!==t}var dE=Object.prototype,pE=dE.hasOwnProperty;function $s(e,t,n){var r=e[t];(!(pE.call(e,t)&&br(r,n))||n===void 0&&!(t in e))&&Mo(e,t,n)}function xo(e,t,n,r){var s=!n;n||(n={});for(var i=-1,o=t.length;++i<o;){var a=t[i],c=void 0;c===void 0&&(c=e[a]),s?Mo(n,a,c):$s(n,a,c)}return n}var Hl=Math.max;function gE(e,t,n){return t=Hl(t===void 0?e.length-1:t,0),function(){for(var r=arguments,s=-1,i=Hl(r.length-t,0),o=Array(i);++s<i;)o[s]=r[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=r[s];return a[t]=n(o),tE(e,this,a)}}function Uo(e,t){return cE(gE(e,t,Xn),e+"")}var mE=9007199254740991;function Po(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=mE}function Se(e){return e!=null&&Po(e.length)&&!We(e)}function Vl(e,t,n){if(!Xt(n))return!1;var r=typeof t;return(r=="number"?Se(n)&&Fs(t,n.length):r=="string"&&t in n)?br(n[t],e):!1}function EE(e){return Uo(function(t,n){var r=-1,s=n.length,i=s>1?n[s-1]:void 0,o=s>2?n[2]:void 0;for(i=e.length>3&&typeof i=="function"?(s--,i):void 0,o&&Vl(n[0],n[1],o)&&(i=s<3?void 0:i,s=1),t=Object(t);++r<s;){var a=n[r];a&&e(t,a,r,i)}return t})}var _E=Object.prototype;function Lr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||_E;return e===n}function yE(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var TE="[object Arguments]";function zl(e){return ae(e)&&on(e)==TE}var Yl=Object.prototype,SE=Yl.hasOwnProperty,AE=Yl.propertyIsEnumerable,Bs=zl(function(){return arguments}())?zl:function(e){return ae(e)&&SE.call(e,"callee")&&!AE.call(e,"callee")};function wE(){return!1}var ql=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Xl=ql&&typeof module=="object"&&module&&!module.nodeType&&module,RE=Xl&&Xl.exports===ql,Jl=RE?Te.Buffer:void 0,vE=Jl?Jl.isBuffer:void 0,Or=vE||wE,NE="[object Arguments]",IE="[object Array]",CE="[object Boolean]",bE="[object Date]",LE="[object Error]",OE="[object Function]",kE="[object Map]",ME="[object Number]",xE="[object Object]",UE="[object RegExp]",PE="[object Set]",DE="[object String]",FE="[object WeakMap]",$E="[object ArrayBuffer]",BE="[object DataView]",GE="[object Float32Array]",jE="[object Float64Array]",WE="[object Int8Array]",KE="[object Int16Array]",HE="[object Int32Array]",VE="[object Uint8Array]",zE="[object Uint8ClampedArray]",YE="[object Uint16Array]",qE="[object Uint32Array]",X={};X[GE]=X[jE]=X[WE]=X[KE]=X[HE]=X[VE]=X[zE]=X[YE]=X[qE]=!0,X[NE]=X[IE]=X[$E]=X[CE]=X[BE]=X[bE]=X[LE]=X[OE]=X[kE]=X[ME]=X[xE]=X[UE]=X[PE]=X[DE]=X[FE]=!1;function XE(e){return ae(e)&&Po(e.length)&&!!X[on(e)]}function Gs(e){return function(t){return e(t)}}var Ql=typeof exports=="object"&&exports&&!exports.nodeType&&exports,kr=Ql&&typeof module=="object"&&module&&!module.nodeType&&module,JE=kr&&kr.exports===Ql,Do=JE&&kl.process,an=function(){try{var e=kr&&kr.require&&kr.require("util").types;return e||Do&&Do.binding&&Do.binding("util")}catch{}}(),Zl=an&&an.isTypedArray,Fo=Zl?Gs(Zl):XE,QE=Object.prototype,ZE=QE.hasOwnProperty;function tu(e,t){var n=j(e),r=!n&&Bs(e),s=!n&&!r&&Or(e),i=!n&&!r&&!s&&Fo(e),o=n||r||s||i,a=o?yE(e.length,String):[],c=a.length;for(var l in e)(t||ZE.call(e,l))&&!(o&&(l=="length"||s&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Fs(l,c)))&&a.push(l);return a}function eu(e,t){return function(n){return e(t(n))}}var t_=eu(Object.keys,Object),e_=Object.prototype,n_=e_.hasOwnProperty;function nu(e){if(!Lr(e))return t_(e);var t=[];for(var n in Object(e))n_.call(e,n)&&n!="constructor"&&t.push(n);return t}function Jt(e){return Se(e)?tu(e):nu(e)}var r_=Object.prototype,s_=r_.hasOwnProperty,Bt=EE(function(e,t){if(Lr(t)||Se(t)){xo(t,Jt(t),e);return}for(var n in t)s_.call(t,n)&&$s(e,n,t[n])});function i_(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var o_=Object.prototype,a_=o_.hasOwnProperty;function c_(e){if(!Xt(e))return i_(e);var t=Lr(e),n=[];for(var r in e)r=="constructor"&&(t||!a_.call(e,r))||n.push(r);return n}function ru(e){return Se(e)?tu(e,!0):c_(e)}var l_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,u_=/^\w*$/;function $o(e,t){if(j(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||xs(e)?!0:u_.test(e)||!l_.test(e)||t!=null&&e in Object(t)}var Mr=In(Object,"create");function h_(){this.__data__=Mr?Mr(null):{},this.size=0}function f_(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var d_="__lodash_hash_undefined__",p_=Object.prototype,g_=p_.hasOwnProperty;function m_(e){var t=this.__data__;if(Mr){var n=t[e];return n===d_?void 0:n}return g_.call(t,e)?t[e]:void 0}var E_=Object.prototype,__=E_.hasOwnProperty;function y_(e){var t=this.__data__;return Mr?t[e]!==void 0:__.call(t,e)}var T_="__lodash_hash_undefined__";function S_(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Mr&&t===void 0?T_:t,this}function Cn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Cn.prototype.clear=h_,Cn.prototype.delete=f_,Cn.prototype.get=m_,Cn.prototype.has=y_,Cn.prototype.set=S_;function A_(){this.__data__=[],this.size=0}function js(e,t){for(var n=e.length;n--;)if(br(e[n][0],t))return n;return-1}var w_=Array.prototype,R_=w_.splice;function v_(e){var t=this.__data__,n=js(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():R_.call(t,n,1),--this.size,!0}function N_(e){var t=this.__data__,n=js(t,e);return n<0?void 0:t[n][1]}function I_(e){return js(this.__data__,e)>-1}function C_(e,t){var n=this.__data__,r=js(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function Ke(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ke.prototype.clear=A_,Ke.prototype.delete=v_,Ke.prototype.get=N_,Ke.prototype.has=I_,Ke.prototype.set=C_;var xr=In(Te,"Map");function b_(){this.size=0,this.__data__={hash:new Cn,map:new(xr||Ke),string:new Cn}}function L_(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Ws(e,t){var n=e.__data__;return L_(t)?n[typeof t=="string"?"string":"hash"]:n.map}function O_(e){var t=Ws(this,e).delete(e);return this.size-=t?1:0,t}function k_(e){return Ws(this,e).get(e)}function M_(e){return Ws(this,e).has(e)}function x_(e,t){var n=Ws(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function He(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}He.prototype.clear=b_,He.prototype.delete=O_,He.prototype.get=k_,He.prototype.has=M_,He.prototype.set=x_;var U_="Expected a function";function Bo(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(U_);var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var o=e.apply(this,r);return n.cache=i.set(s,o)||i,o};return n.cache=new(Bo.Cache||He),n}Bo.Cache=He;var P_=500;function D_(e){var t=Bo(e,function(r){return n.size===P_&&n.clear(),r}),n=t.cache;return t}var F_=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$_=/\\(\\)?/g,B_=D_(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(F_,function(n,r,s,i){t.push(s?i.replace($_,"$1"):r||n)}),t});function G_(e){return e==null?"":Dl(e)}function Ks(e,t){return j(e)?e:$o(e,t)?[e]:B_(G_(e))}var j_=1/0;function Ur(e){if(typeof e=="string"||xs(e))return e;var t=e+"";return t=="0"&&1/e==-j_?"-0":t}function Go(e,t){t=Ks(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Ur(t[n++])];return n&&n==r?e:void 0}function W_(e,t,n){var r=e==null?void 0:Go(e,t);return r===void 0?n:r}function jo(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e}var su=qt?qt.isConcatSpreadable:void 0;function K_(e){return j(e)||Bs(e)||!!(su&&e&&e[su])}function Wo(e,t,n,r,s){var i=-1,o=e.length;for(n||(n=K_),s||(s=[]);++i<o;){var a=e[i];n(a)?jo(s,a):r||(s[s.length]=a)}return s}function ce(e){var t=e==null?0:e.length;return t?Wo(e):[]}var iu=eu(Object.getPrototypeOf,Object);function ou(e,t,n){var r=-1,s=e.length;t<0&&(t=-t>s?0:s+t),n=n>s?s:n,n<0&&(n+=s),s=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(s);++r<s;)i[r]=e[r+t];return i}function H_(e,t,n,r){var s=-1,i=e==null?0:e.length;for(r&&i&&(n=e[++s]);++s<i;)n=t(n,e[s],s,e);return n}function V_(){this.__data__=new Ke,this.size=0}function z_(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Y_(e){return this.__data__.get(e)}function q_(e){return this.__data__.has(e)}var X_=200;function J_(e,t){var n=this.__data__;if(n instanceof Ke){var r=n.__data__;if(!xr||r.length<X_-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new He(r)}return n.set(e,t),this.size=n.size,this}function Ae(e){var t=this.__data__=new Ke(e);this.size=t.size}Ae.prototype.clear=V_,Ae.prototype.delete=z_,Ae.prototype.get=Y_,Ae.prototype.has=q_,Ae.prototype.set=J_;function Q_(e,t){return e&&xo(t,Jt(t),e)}var au=typeof exports=="object"&&exports&&!exports.nodeType&&exports,cu=au&&typeof module=="object"&&module&&!module.nodeType&&module,Z_=cu&&cu.exports===au,lu=Z_?Te.Buffer:void 0,uu=lu?lu.allocUnsafe:void 0;function ty(e,t){var n=e.length,r=uu?uu(n):new e.constructor(n);return e.copy(r),r}function Ko(e,t){for(var n=-1,r=e==null?0:e.length,s=0,i=[];++n<r;){var o=e[n];t(o,n,e)&&(i[s++]=o)}return i}function hu(){return[]}var ey=Object.prototype,ny=ey.propertyIsEnumerable,fu=Object.getOwnPropertySymbols,Ho=fu?function(e){return e==null?[]:(e=Object(e),Ko(fu(e),function(t){return ny.call(e,t)}))}:hu;function ry(e,t){return xo(e,Ho(e),t)}var sy=Object.getOwnPropertySymbols,iy=sy?function(e){for(var t=[];e;)jo(t,Ho(e)),e=iu(e);return t}:hu;function du(e,t,n){var r=t(e);return j(e)?r:jo(r,n(e))}function Vo(e){return du(e,Jt,Ho)}function oy(e){return du(e,ru,iy)}var zo=In(Te,"DataView"),Yo=In(Te,"Promise"),Jn=In(Te,"Set"),pu="[object Map]",ay="[object Object]",gu="[object Promise]",mu="[object Set]",Eu="[object WeakMap]",_u="[object DataView]",cy=Nn(zo),ly=Nn(xr),uy=Nn(Yo),hy=Nn(Jn),fy=Nn(Oo),Qt=on;(zo&&Qt(new zo(new ArrayBuffer(1)))!=_u||xr&&Qt(new xr)!=pu||Yo&&Qt(Yo.resolve())!=gu||Jn&&Qt(new Jn)!=mu||Oo&&Qt(new Oo)!=Eu)&&(Qt=function(e){var t=on(e),n=t==ay?e.constructor:void 0,r=n?Nn(n):"";if(r)switch(r){case cy:return _u;case ly:return pu;case uy:return gu;case hy:return mu;case fy:return Eu}return t});var dy=Object.prototype,py=dy.hasOwnProperty;function gy(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&py.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Hs=Te.Uint8Array;function my(e){var t=new e.constructor(e.byteLength);return new Hs(t).set(new Hs(e)),t}function Ey(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var _y=/\w*$/;function yy(e){var t=new e.constructor(e.source,_y.exec(e));return t.lastIndex=e.lastIndex,t}var yu=qt?qt.prototype:void 0,Tu=yu?yu.valueOf:void 0;function Ty(e){return Tu?Object(Tu.call(e)):{}}function Sy(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var Ay="[object Boolean]",wy="[object Date]",Ry="[object Map]",vy="[object Number]",Ny="[object RegExp]",Iy="[object Set]",Cy="[object String]",by="[object Symbol]",Ly="[object ArrayBuffer]",Oy="[object DataView]",ky="[object Float32Array]",My="[object Float64Array]",xy="[object Int8Array]",Uy="[object Int16Array]",Py="[object Int32Array]",Dy="[object Uint8Array]",Fy="[object Uint8ClampedArray]",$y="[object Uint16Array]",By="[object Uint32Array]";function Gy(e,t,n){var r=e.constructor;switch(t){case Ly:return my(e);case Ay:case wy:return new r(+e);case Oy:return Ey(e);case ky:case My:case xy:case Uy:case Py:case Dy:case Fy:case $y:case By:return Sy(e);case Ry:return new r;case vy:case Cy:return new r(e);case Ny:return yy(e);case Iy:return new r;case by:return Ty(e)}}function jy(e){return typeof e.constructor=="function"&&!Lr(e)?Zm(iu(e)):{}}var Wy="[object Map]";function Ky(e){return ae(e)&&Qt(e)==Wy}var Su=an&&an.isMap,Hy=Su?Gs(Su):Ky,Vy="[object Set]";function zy(e){return ae(e)&&Qt(e)==Vy}var Au=an&&an.isSet,Yy=Au?Gs(Au):zy,wu="[object Arguments]",qy="[object Array]",Xy="[object Boolean]",Jy="[object Date]",Qy="[object Error]",Ru="[object Function]",Zy="[object GeneratorFunction]",tT="[object Map]",eT="[object Number]",vu="[object Object]",nT="[object RegExp]",rT="[object Set]",sT="[object String]",iT="[object Symbol]",oT="[object WeakMap]",aT="[object ArrayBuffer]",cT="[object DataView]",lT="[object Float32Array]",uT="[object Float64Array]",hT="[object Int8Array]",fT="[object Int16Array]",dT="[object Int32Array]",pT="[object Uint8Array]",gT="[object Uint8ClampedArray]",mT="[object Uint16Array]",ET="[object Uint32Array]",V={};V[wu]=V[qy]=V[aT]=V[cT]=V[Xy]=V[Jy]=V[lT]=V[uT]=V[hT]=V[fT]=V[dT]=V[tT]=V[eT]=V[vu]=V[nT]=V[rT]=V[sT]=V[iT]=V[pT]=V[gT]=V[mT]=V[ET]=!0,V[Qy]=V[Ru]=V[oT]=!1;function Vs(e,t,n,r,s,i){var o;if(o!==void 0)return o;if(!Xt(e))return e;var a=j(e);if(a)return o=gy(e),eE(e,o);var c=Qt(e),l=c==Ru||c==Zy;if(Or(e))return ty(e);if(c==vu||c==wu||l&&!s)return o=l?{}:jy(e),ry(e,Q_(o,e));if(!V[c])return s?e:{};o=Gy(e,c),i||(i=new Ae);var u=i.get(e);if(u)return u;i.set(e,o),Yy(e)?e.forEach(function(f){o.add(Vs(f,t,n,f,e,i))}):Hy(e)&&e.forEach(function(f,m){o.set(m,Vs(f,t,n,m,e,i))});var h=Vo,d=a?void 0:h(e);return jl(d||e,function(f,m){d&&(m=f,f=e[m]),$s(o,m,Vs(f,t,n,m,e,i))}),o}var _T=4;function At(e){return Vs(e,_T)}function Pr(e){for(var t=-1,n=e==null?0:e.length,r=0,s=[];++t<n;){var i=e[t];i&&(s[r++]=i)}return s}var yT="__lodash_hash_undefined__";function TT(e){return this.__data__.set(e,yT),this}function ST(e){return this.__data__.has(e)}function Qn(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new He;++t<n;)this.add(e[t])}Qn.prototype.add=Qn.prototype.push=TT,Qn.prototype.has=ST;function Nu(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function qo(e,t){return e.has(t)}var AT=1,wT=2;function Iu(e,t,n,r,s,i){var o=n&AT,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=i.get(e),u=i.get(t);if(l&&u)return l==t&&u==e;var h=-1,d=!0,f=n&wT?new Qn:void 0;for(i.set(e,t),i.set(t,e);++h<a;){var m=e[h],_=t[h];if(r)var w=o?r(_,m,h,t,e,i):r(m,_,h,e,t,i);if(w!==void 0){if(w)continue;d=!1;break}if(f){if(!Nu(t,function(R,A){if(!qo(f,A)&&(m===R||s(m,R,n,r,i)))return f.push(A)})){d=!1;break}}else if(!(m===_||s(m,_,n,r,i))){d=!1;break}}return i.delete(e),i.delete(t),d}function RT(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n}function Xo(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var vT=1,NT=2,IT="[object Boolean]",CT="[object Date]",bT="[object Error]",LT="[object Map]",OT="[object Number]",kT="[object RegExp]",MT="[object Set]",xT="[object String]",UT="[object Symbol]",PT="[object ArrayBuffer]",DT="[object DataView]",Cu=qt?qt.prototype:void 0,Jo=Cu?Cu.valueOf:void 0;function FT(e,t,n,r,s,i,o){switch(n){case DT:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case PT:return!(e.byteLength!=t.byteLength||!i(new Hs(e),new Hs(t)));case IT:case CT:case OT:return br(+e,+t);case bT:return e.name==t.name&&e.message==t.message;case kT:case xT:return e==t+"";case LT:var a=RT;case MT:var c=r&vT;if(a||(a=Xo),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=NT,o.set(e,t);var u=Iu(a(e),a(t),r,s,i,o);return o.delete(e),u;case UT:if(Jo)return Jo.call(e)==Jo.call(t)}return!1}var $T=1,BT=Object.prototype,GT=BT.hasOwnProperty;function jT(e,t,n,r,s,i){var o=n&$T,a=Vo(e),c=a.length,l=Vo(t),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in t:GT.call(t,d)))return!1}var f=i.get(e),m=i.get(t);if(f&&m)return f==t&&m==e;var _=!0;i.set(e,t),i.set(t,e);for(var w=o;++h<c;){d=a[h];var R=e[d],A=t[d];if(r)var T=o?r(A,R,d,t,e,i):r(R,A,d,e,t,i);if(!(T===void 0?R===A||s(R,A,n,r,i):T)){_=!1;break}w||(w=d=="constructor")}if(_&&!w){var I=e.constructor,y=t.constructor;I!=y&&"constructor"in e&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof y=="function"&&y instanceof y)&&(_=!1)}return i.delete(e),i.delete(t),_}var WT=1,bu="[object Arguments]",Lu="[object Array]",zs="[object Object]",KT=Object.prototype,Ou=KT.hasOwnProperty;function HT(e,t,n,r,s,i){var o=j(e),a=j(t),c=o?Lu:Qt(e),l=a?Lu:Qt(t);c=c==bu?zs:c,l=l==bu?zs:l;var u=c==zs,h=l==zs,d=c==l;if(d&&Or(e)){if(!Or(t))return!1;o=!0,u=!1}if(d&&!u)return i||(i=new Ae),o||Fo(e)?Iu(e,t,n,r,s,i):FT(e,t,c,n,r,s,i);if(!(n&WT)){var f=u&&Ou.call(e,"__wrapped__"),m=h&&Ou.call(t,"__wrapped__");if(f||m){var _=f?e.value():e,w=m?t.value():t;return i||(i=new Ae),s(_,w,n,r,i)}}return d?(i||(i=new Ae),jT(e,t,n,r,s,i)):!1}function Qo(e,t,n,r,s){return e===t?!0:e==null||t==null||!ae(e)&&!ae(t)?e!==e&&t!==t:HT(e,t,n,r,Qo,s)}var VT=1,zT=2;function YT(e,t,n,r){var s=n.length,i=s;if(e==null)return!i;for(e=Object(e);s--;){var o=n[s];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++s<i;){o=n[s];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new Ae,h;if(!(h===void 0?Qo(l,c,VT|zT,r,u):h))return!1}}return!0}function ku(e){return e===e&&!Xt(e)}function qT(e){for(var t=Jt(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,ku(s)]}return t}function Mu(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function XT(e){var t=qT(e);return t.length==1&&t[0][2]?Mu(t[0][0],t[0][1]):function(n){return n===e||YT(n,e,t)}}function JT(e,t){return e!=null&&t in Object(e)}function xu(e,t,n){t=Ks(t,e);for(var r=-1,s=t.length,i=!1;++r<s;){var o=Ur(t[r]);if(!(i=e!=null&&n(e,o)))break;e=e[o]}return i||++r!=s?i:(s=e==null?0:e.length,!!s&&Po(s)&&Fs(o,s)&&(j(e)||Bs(e)))}function QT(e,t){return e!=null&&xu(e,t,JT)}var ZT=1,tS=2;function eS(e,t){return $o(e)&&ku(t)?Mu(Ur(e),t):function(n){var r=W_(n,e);return r===void 0&&r===t?QT(n,e):Qo(t,r,ZT|tS)}}function nS(e){return function(t){return t==null?void 0:t[e]}}function rS(e){return function(t){return Go(t,e)}}function sS(e){return $o(e)?nS(Ur(e)):rS(e)}function we(e){return typeof e=="function"?e:e==null?Xn:typeof e=="object"?j(e)?eS(e[0],e[1]):XT(e):sS(e)}function iS(e,t,n,r){for(var s=-1,i=e==null?0:e.length;++s<i;){var o=e[s];t(r,o,n(o),e)}return r}function oS(e){return function(t,n,r){for(var s=-1,i=Object(t),o=r(t),a=o.length;a--;){var c=o[++s];if(n(i[c],c,i)===!1)break}return t}}var aS=oS();function cS(e,t){return e&&aS(e,t,Jt)}function lS(e,t){return function(n,r){if(n==null)return n;if(!Se(n))return e(n,r);for(var s=n.length,i=-1,o=Object(n);++i<s&&r(o[i],i,o)!==!1;);return n}}var bn=lS(cS);function uS(e,t,n,r){return bn(e,function(s,i,o){t(r,s,n(s),o)}),r}function hS(e,t){return function(n,r){var s=j(n)?iS:uS,i=t?t():{};return s(n,e,we(r),i)}}var Uu=Object.prototype,fS=Uu.hasOwnProperty,Zo=Uo(function(e,t){e=Object(e);var n=-1,r=t.length,s=r>2?t[2]:void 0;for(s&&Vl(t[0],t[1],s)&&(r=1);++n<r;)for(var i=t[n],o=ru(i),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||br(u,Uu[l])&&!fS.call(e,l))&&(e[l]=i[l])}return e});function Pu(e){return ae(e)&&Se(e)}var dS=200;function pS(e,t,n,r){var s=-1,i=Kl,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=dS&&(i=qo,o=!1,t=new Qn(t));t:for(;++s<a;){var u=e[s],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(t[d]===h)continue t;c.push(u)}else i(t,h,r)||c.push(u)}return c}var Ys=Uo(function(e,t){return Pu(e)?pS(e,Wo(t,1,Pu,!0)):[]});function Zn(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function wt(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Ps(t),ou(e,t<0?0:t,r)):[]}function Dr(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Ps(t),t=r-t,ou(e,0,t<0?0:t)):[]}function gS(e){return typeof e=="function"?e:Xn}function M(e,t){var n=j(e)?jl:bn;return n(e,gS(t))}function mS(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function ES(e,t){var n=!0;return bn(e,function(r,s,i){return n=!!t(r,s,i),n}),n}function le(e,t,n){var r=j(e)?mS:ES;return r(e,we(t))}function Du(e,t){var n=[];return bn(e,function(r,s,i){t(r,s,i)&&n.push(r)}),n}function Zt(e,t){var n=j(e)?Ko:Du;return n(e,we(t))}function _S(e){return function(t,n,r){var s=Object(t);if(!Se(t)){var i=we(n);t=Jt(t),n=function(a){return i(s[a],a,s)}}var o=e(t,n,r);return o>-1?s[i?t[o]:o]:void 0}}var yS=Math.max;function TS(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var s=n==null?0:Ps(n);return s<0&&(s=yS(r+s,0)),Wl(e,we(t),s)}var tr=_S(TS);function ue(e){return e&&e.length?e[0]:void 0}function SS(e,t){var n=-1,r=Se(e)?Array(e.length):[];return bn(e,function(s,i,o){r[++n]=t(s,i,o)}),r}function b(e,t){var n=j(e)?Us:SS;return n(e,we(t))}function te(e,t){return Wo(b(e,t))}var AS=Object.prototype,wS=AS.hasOwnProperty,RS=hS(function(e,t,n){wS.call(e,n)?e[n].push(t):Mo(e,n,[t])}),vS=Object.prototype,NS=vS.hasOwnProperty;function IS(e,t){return e!=null&&NS.call(e,t)}function k(e,t){return e!=null&&xu(e,t,IS)}var CS="[object String]";function Pt(e){return typeof e=="string"||!j(e)&&ae(e)&&on(e)==CS}function bS(e,t){return Us(t,function(n){return e[n]})}function dt(e){return e==null?[]:bS(e,Jt(e))}var LS=Math.max;function kt(e,t,n,r){e=Se(e)?e:dt(e),n=n&&!r?Ps(n):0;var s=e.length;return n<0&&(n=LS(s+n,0)),Pt(e)?n<=s&&e.indexOf(t,n)>-1:!!s&&ko(e,t,n)>-1}function Fu(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var s=0;return ko(e,t,s)}var OS="[object Map]",kS="[object Set]",MS=Object.prototype,xS=MS.hasOwnProperty;function z(e){if(e==null)return!0;if(Se(e)&&(j(e)||typeof e=="string"||typeof e.splice=="function"||Or(e)||Fo(e)||Bs(e)))return!e.length;var t=Qt(e);if(t==OS||t==kS)return!e.size;if(Lr(e))return!nu(e).length;for(var n in e)if(xS.call(e,n))return!1;return!0}var US="[object RegExp]";function PS(e){return ae(e)&&on(e)==US}var $u=an&&an.isRegExp,Ve=$u?Gs($u):PS;function ze(e){return e===void 0}var DS="Expected a function";function FS(e){if(typeof e!="function")throw new TypeError(DS);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function $S(e,t,n,r){if(!Xt(e))return e;t=Ks(t,e);for(var s=-1,i=t.length,o=i-1,a=e;a!=null&&++s<i;){var c=Ur(t[s]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(s!=o){var u=a[c];l=void 0,l===void 0&&(l=Xt(u)?u:Fs(t[s+1])?[]:{})}$s(a,c,l),a=a[c]}return e}function BS(e,t,n){for(var r=-1,s=t.length,i={};++r<s;){var o=t[r],a=Go(e,o);n(a,o)&&$S(i,Ks(o,e),a)}return i}function he(e,t){if(e==null)return{};var n=Us(oy(e),function(r){return[r]});return t=we(t),BS(e,n,function(r,s){return t(r,s[0])})}function GS(e,t,n,r,s){return s(e,function(i,o,a){n=r?(r=!1,i):t(n,i,o,a)}),n}function Gt(e,t,n){var r=j(e)?H_:GS,s=arguments.length<3;return r(e,we(t),n,s,bn)}function qs(e,t){var n=j(e)?Ko:Du;return n(e,FS(we(t)))}function jS(e,t){var n;return bn(e,function(r,s,i){return n=t(r,s,i),!n}),!!n}function Bu(e,t,n){var r=j(e)?Nu:jS;return r(e,we(t))}var WS=1/0,KS=Jn&&1/Xo(new Jn([,-0]))[1]==WS?function(e){return new Jn(e)}:ft,HS=200;function VS(e,t,n){var r=-1,s=Kl,i=e.length,o=!0,a=[],c=a;if(i>=HS){var l=KS(e);if(l)return Xo(l);o=!1,s=qo,c=new Qn}else c=a;t:for(;++r<i;){var u=e[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(u)}else s(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function ta(e){return e&&e.length?VS(e):[]}function ea(e){console&&console.error&&console.error(`Error: ${e}`)}function Gu(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function ju(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function Wu(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function zS(e){return YS(e)?e.LABEL:e.name}function YS(e){return Pt(e.LABEL)&&e.LABEL!==""}class Re{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),M(this.definition,n=>{n.accept(t)})}}class jt extends Re{constructor(t){super([]),this.idx=1,Bt(this,he(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class er extends Re{constructor(t){super(t.definition),this.orgText="",Bt(this,he(t,n=>n!==void 0))}}class Dt extends Re{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Bt(this,he(t,n=>n!==void 0))}}class Ft extends Re{constructor(t){super(t.definition),this.idx=1,Bt(this,he(t,n=>n!==void 0))}}class ve extends Re{constructor(t){super(t.definition),this.idx=1,Bt(this,he(t,n=>n!==void 0))}}class Ne extends Re{constructor(t){super(t.definition),this.idx=1,Bt(this,he(t,n=>n!==void 0))}}class pt extends Re{constructor(t){super(t.definition),this.idx=1,Bt(this,he(t,n=>n!==void 0))}}class fe extends Re{constructor(t){super(t.definition),this.idx=1,Bt(this,he(t,n=>n!==void 0))}}class de extends Re{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Bt(this,he(t,n=>n!==void 0))}}class J{constructor(t){this.idx=1,Bt(this,he(t,n=>n!==void 0))}accept(t){t.visit(this)}}function qS(e){return b(e,Xs)}function Xs(e){function t(n){return b(n,Xs)}if(e instanceof jt){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Pt(e.label)&&(n.label=e.label),n}else{if(e instanceof Dt)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Ft)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof ve)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Ne)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Xs(new J({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof fe)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Xs(new J({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof pt)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof de)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof J){const n={type:"Terminal",name:e.terminalType.name,label:zS(e.terminalType),idx:e.idx};Pt(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Ve(r)?r.source:r),n}else{if(e instanceof er)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class nr{visit(t){const n=t;switch(n.constructor){case jt:return this.visitNonTerminal(n);case Dt:return this.visitAlternative(n);case Ft:return this.visitOption(n);case ve:return this.visitRepetitionMandatory(n);case Ne:return this.visitRepetitionMandatoryWithSeparator(n);case fe:return this.visitRepetitionWithSeparator(n);case pt:return this.visitRepetition(n);case de:return this.visitAlternation(n);case J:return this.visitTerminal(n);case er:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function XS(e){return e instanceof Dt||e instanceof Ft||e instanceof pt||e instanceof ve||e instanceof Ne||e instanceof fe||e instanceof J||e instanceof er}function Js(e,t=[]){return e instanceof Ft||e instanceof pt||e instanceof fe?!0:e instanceof de?Bu(e.definition,r=>Js(r,t)):e instanceof jt&&kt(t,e)?!1:e instanceof Re?(e instanceof jt&&t.push(e),le(e.definition,r=>Js(r,t))):!1}function JS(e){return e instanceof de}function Ie(e){if(e instanceof jt)return"SUBRULE";if(e instanceof Ft)return"OPTION";if(e instanceof de)return"OR";if(e instanceof ve)return"AT_LEAST_ONE";if(e instanceof Ne)return"AT_LEAST_ONE_SEP";if(e instanceof fe)return"MANY_SEP";if(e instanceof pt)return"MANY";if(e instanceof J)return"CONSUME";throw Error("non exhaustive match")}class Qs{walk(t,n=[]){M(t.definition,(r,s)=>{const i=wt(t.definition,s+1);if(r instanceof jt)this.walkProdRef(r,i,n);else if(r instanceof J)this.walkTerminal(r,i,n);else if(r instanceof Dt)this.walkFlat(r,i,n);else if(r instanceof Ft)this.walkOption(r,i,n);else if(r instanceof ve)this.walkAtLeastOne(r,i,n);else if(r instanceof Ne)this.walkAtLeastOneSep(r,i,n);else if(r instanceof fe)this.walkManySep(r,i,n);else if(r instanceof pt)this.walkMany(r,i,n);else if(r instanceof de)this.walkOr(r,i,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const s=n.concat(r);this.walk(t,s)}walkOption(t,n,r){const s=n.concat(r);this.walk(t,s)}walkAtLeastOne(t,n,r){const s=[new Ft({definition:t.definition})].concat(n,r);this.walk(t,s)}walkAtLeastOneSep(t,n,r){const s=Ku(t,n,r);this.walk(t,s)}walkMany(t,n,r){const s=[new Ft({definition:t.definition})].concat(n,r);this.walk(t,s)}walkManySep(t,n,r){const s=Ku(t,n,r);this.walk(t,s)}walkOr(t,n,r){const s=n.concat(r);M(t.definition,i=>{const o=new Dt({definition:[i]});this.walk(o,s)})}}function Ku(e,t,n){return[new Ft({definition:[new J({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function Fr(e){if(e instanceof jt)return Fr(e.referencedRule);if(e instanceof J)return tA(e);if(XS(e))return QS(e);if(JS(e))return ZS(e);throw Error("non exhaustive match")}function QS(e){let t=[];const n=e.definition;let r=0,s=n.length>r,i,o=!0;for(;s&&o;)i=n[r],o=Js(i),t=t.concat(Fr(i)),r=r+1,s=n.length>r;return ta(t)}function ZS(e){const t=b(e.definition,n=>Fr(n));return ta(ce(t))}function tA(e){return[e.terminalType]}const Hu="_~IN~_";class eA extends Qs{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const s=rA(t.referencedRule,t.idx)+this.topProd.name,i=n.concat(r),o=new Dt({definition:i}),a=Fr(o);this.follows[s]=a}}function nA(e){const t={};return M(e,n=>{const r=new eA(n).startWalking();Bt(t,r)}),t}function rA(e,t){return e.name+t+Hu}function x(e){return e.charCodeAt(0)}function na(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function $r(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function rr(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function sA(){throw Error("Internal Error - Should never get here!")}function Vu(e){return e.type==="Character"}const Zs=[];for(let e=x("0");e<=x("9");e++)Zs.push(e);const ti=[x("_")].concat(Zs);for(let e=x("a");e<=x("z");e++)ti.push(e);for(let e=x("A");e<=x("Z");e++)ti.push(e);const zu=[x(" "),x("\f"),x(`
`),x("\r"),x("	"),x("\v"),x("	"),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x("\u2028"),x("\u2029"),x(""),x(""),x(""),x("\uFEFF")],iA=/[0-9a-fA-F]/,ei=/[0-9]/,oA=/[1-9]/;class aA{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":$r(r,"global");break;case"i":$r(r,"ignoreCase");break;case"m":$r(r,"multiLine");break;case"u":$r(r,"unicode");break;case"y":$r(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}rr(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return sA()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const s=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:s,atMost:s};break;case",":let i;this.isDigit()?(i=this.integerIncludingZero(),n={atLeast:s,atMost:i}):n={atLeast:s,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;rr(n);break}if(!(t===!0&&n===void 0)&&rr(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),rr(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[x(`
`),x("\r"),x("\u2028"),x("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Zs;break;case"D":t=Zs,n=!0;break;case"s":t=zu;break;case"S":t=zu,n=!0;break;case"w":t=ti;break;case"W":t=ti,n=!0;break}if(rr(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=x("\f");break;case"n":t=x(`
`);break;case"r":t=x("\r");break;case"t":t=x("	");break;case"v":t=x("\v");break}if(rr(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:x("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:x(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:x(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,Vu(r)&&this.isRangeDash()){this.consumeChar("-");const s=this.classAtom();if(s.type,Vu(s)){if(s.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:s.value})}else na(r.value,t),t.push(x("-")),na(s.value,t)}else na(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:x("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(oA.test(t)===!1)throw Error("Expecting a positive integer");for(;ei.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(ei.test(t)===!1)throw Error("Expecting an integer");for(;ei.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:x(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return ei.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let s=0;s<t;s++){const i=this.popChar();if(iA.test(i)===!1)throw Error("Expecting a HexDecimal digits");n+=i}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class ra{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(s=>{this.visit(s)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let ni={};const cA=new aA;function ri(e){const t=e.toString();if(ni.hasOwnProperty(t))return ni[t];{const n=cA.pattern(t);return ni[t]=n,n}}function lA(){ni={}}const Yu="Complement Sets are not supported for first char optimization",si=`Unable to use "first char" lexer optimizations:
`;function uA(e,t=!1){try{const n=ri(e);return sa(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Yu)t&&Gu(`${si}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),ea(`${si}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function sa(e,t,n){switch(e.type){case"Disjunction":for(let s=0;s<e.value.length;s++)sa(e.value[s],t,n);break;case"Alternative":const r=e.value;for(let s=0;s<r.length;s++){const i=r[s];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=i;switch(o.type){case"Character":ii(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(Yu);M(o.value,c=>{if(typeof c=="number")ii(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)ii(u,t,n);else{for(let u=l.from;u<=l.to&&u<Gr;u++)ii(u,t,n);if(l.to>=Gr){const u=l.from>=Gr?l.from:Gr,h=l.to,d=cn(u),f=cn(h);for(let m=d;m<=f;m++)t[m]=m}}}});break;case"Group":sa(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&ia(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return dt(t)}function ii(e,t,n){const r=cn(e);t[r]=r,n===!0&&hA(e,t)}function hA(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const s=cn(r.charCodeAt(0));t[s]=s}else{const s=n.toLowerCase();if(s!==n){const i=cn(s.charCodeAt(0));t[i]=i}}}function qu(e,t){return tr(e.value,n=>{if(typeof n=="number")return kt(t,n);{const r=n;return tr(t,s=>r.from<=s&&s<=r.to)!==void 0}})}function ia(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?j(e.value)?le(e.value,ia):ia(e.value):!1}class fA extends ra{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){kt(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?qu(t,this.targetCharCodes)===void 0&&(this.found=!0):qu(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function oa(e,t){if(t instanceof RegExp){const n=ri(t),r=new fA(e);return r.visit(n),r.found}else return tr(t,n=>kt(e,n.charCodeAt(0)))!==void 0}const Ln="PATTERN",Br="defaultMode",oi="modes";let Xu=typeof new RegExp("(?:)").sticky=="boolean";function dA(e,t){t=Zo(t,{useSticky:Xu,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(A,T)=>T()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{PA()});let r;n("Reject Lexer.NA",()=>{r=qs(e,A=>A[Ln]===_t.NA)});let s=!1,i;n("Transform Patterns",()=>{s=!1,i=b(r,A=>{const T=A[Ln];if(Ve(T)){const I=T.source;return I.length===1&&I!=="^"&&I!=="$"&&I!=="."&&!T.ignoreCase?I:I.length===2&&I[0]==="\\"&&!kt(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],I[1])?I[1]:t.useSticky?Qu(T):Ju(T)}else{if(We(T))return s=!0,{exec:T};if(typeof T=="object")return s=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const I=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),y=new RegExp(I);return t.useSticky?Qu(y):Ju(y)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=b(r,A=>A.tokenTypeIdx),a=b(r,A=>{const T=A.GROUP;if(T!==_t.SKIPPED){if(Pt(T))return T;if(ze(T))return!1;throw Error("non exhaustive match")}}),c=b(r,A=>{const T=A.LONGER_ALT;if(T)return j(T)?b(T,y=>Fu(r,y)):[Fu(r,T)]}),l=b(r,A=>A.PUSH_MODE),u=b(r,A=>k(A,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const A=eh(t.lineTerminatorCharacters);h=b(r,T=>!1),t.positionTracking!=="onlyOffset"&&(h=b(r,T=>k(T,"LINE_BREAKS")?!!T.LINE_BREAKS:th(T,A)===!1&&oa(A,T.PATTERN)))});let d,f,m,_;n("Misc Mapping #2",()=>{d=b(r,Zu),f=b(i,MA),m=Gt(r,(A,T)=>{const I=T.GROUP;return Pt(I)&&I!==_t.SKIPPED&&(A[I]=[]),A},{}),_=b(i,(A,T)=>({pattern:i[T],longerAlt:c[T],canLineTerminator:h[T],isCustom:d[T],short:f[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let w=!0,R=[];return t.safeMode||n("First Char Optimization",()=>{R=Gt(r,(A,T,I)=>{if(typeof T.PATTERN=="string"){const y=T.PATTERN.charCodeAt(0),g=cn(y);aa(A,g,_[I])}else if(j(T.START_CHARS_HINT)){let y;M(T.START_CHARS_HINT,g=>{const p=typeof g=="string"?g.charCodeAt(0):g,S=cn(p);y!==S&&(y=S,aa(A,S,_[I]))})}else if(Ve(T.PATTERN))if(T.PATTERN.unicode)w=!1,t.ensureOptimizations&&ea(`${si}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const y=uA(T.PATTERN,t.ensureOptimizations);z(y)&&(w=!1),M(y,g=>{aa(A,g,_[I])})}else t.ensureOptimizations&&ea(`${si}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),w=!1;return A},[])}),{emptyGroups:m,patternIdxToConfig:_,charCodeToPatternIdxToConfig:R,hasCustom:s,canBeOptimized:w}}function pA(e,t){let n=[];const r=mA(e);n=n.concat(r.errors);const s=EA(r.valid),i=s.valid;return n=n.concat(s.errors),n=n.concat(gA(i)),n=n.concat(vA(i)),n=n.concat(NA(i,t)),n=n.concat(IA(i)),n}function gA(e){let t=[];const n=Zt(e,r=>Ve(r[Ln]));return t=t.concat(yA(n)),t=t.concat(AA(n)),t=t.concat(wA(n)),t=t.concat(RA(n)),t=t.concat(TA(n)),t}function mA(e){const t=Zt(e,s=>!k(s,Ln)),n=b(t,s=>({message:"Token Type: ->"+s.name+"<- missing static 'PATTERN' property",type:it.MISSING_PATTERN,tokenTypes:[s]})),r=Ys(e,t);return{errors:n,valid:r}}function EA(e){const t=Zt(e,s=>{const i=s[Ln];return!Ve(i)&&!We(i)&&!k(i,"exec")&&!Pt(i)}),n=b(t,s=>({message:"Token Type: ->"+s.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:it.INVALID_PATTERN,tokenTypes:[s]})),r=Ys(e,t);return{errors:n,valid:r}}const _A=/[^\\][$]/;function yA(e){class t extends ra{constructor(){super(...arguments),this.found=!1}visitEndAnchor(i){this.found=!0}}const n=Zt(e,s=>{const i=s.PATTERN;try{const o=ri(i),a=new t;return a.visit(o),a.found}catch{return _A.test(i.source)}});return b(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:it.EOI_ANCHOR_FOUND,tokenTypes:[s]}))}function TA(e){const t=Zt(e,r=>r.PATTERN.test(""));return b(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:it.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const SA=/[^\\[][\^]|^\^/;function AA(e){class t extends ra{constructor(){super(...arguments),this.found=!1}visitStartAnchor(i){this.found=!0}}const n=Zt(e,s=>{const i=s.PATTERN;try{const o=ri(i),a=new t;return a.visit(o),a.found}catch{return SA.test(i.source)}});return b(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:it.SOI_ANCHOR_FOUND,tokenTypes:[s]}))}function wA(e){const t=Zt(e,r=>{const s=r[Ln];return s instanceof RegExp&&(s.multiline||s.global)});return b(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:it.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function RA(e){const t=[];let n=b(e,i=>Gt(e,(o,a)=>(i.PATTERN.source===a.PATTERN.source&&!kt(t,a)&&a.PATTERN!==_t.NA&&(t.push(a),o.push(a)),o),[]));n=Pr(n);const r=Zt(n,i=>i.length>1);return b(r,i=>{const o=b(i,c=>c.name);return{message:`The same RegExp pattern ->${ue(i).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:it.DUPLICATE_PATTERNS_FOUND,tokenTypes:i}})}function vA(e){const t=Zt(e,r=>{if(!k(r,"GROUP"))return!1;const s=r.GROUP;return s!==_t.SKIPPED&&s!==_t.NA&&!Pt(s)});return b(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:it.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function NA(e,t){const n=Zt(e,s=>s.PUSH_MODE!==void 0&&!kt(t,s.PUSH_MODE));return b(n,s=>({message:`Token Type: ->${s.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${s.PUSH_MODE}<-which does not exist`,type:it.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[s]}))}function IA(e){const t=[],n=Gt(e,(r,s,i)=>{const o=s.PATTERN;return o===_t.NA||(Pt(o)?r.push({str:o,idx:i,tokenType:s}):Ve(o)&&bA(o)&&r.push({str:o.source,idx:i,tokenType:s})),r},[]);return M(e,(r,s)=>{M(n,({str:i,idx:o,tokenType:a})=>{if(s<o&&CA(i,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:it.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function CA(e,t){if(Ve(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(We(t))return t(e,0,[],{});if(k(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function bA(e){return tr([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function Ju(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function Qu(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function LA(e,t,n){const r=[];return k(e,Br)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Br+`> property in its definition
`,type:it.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),k(e,oi)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+oi+`> property in its definition
`,type:it.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),k(e,oi)&&k(e,Br)&&!k(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Br}: <${e.defaultMode}>which does not exist
`,type:it.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),k(e,oi)&&M(e.modes,(s,i)=>{M(s,(o,a)=>{if(ze(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${i}> at index: <${a}>
`,type:it.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(k(o,"LONGER_ALT")){const c=j(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];M(c,l=>{!ze(l)&&!kt(s,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${i}>
`,type:it.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function OA(e,t,n){const r=[];let s=!1;const i=Pr(ce(dt(e.modes))),o=qs(i,c=>c[Ln]===_t.NA),a=eh(n);return t&&M(o,c=>{const l=th(c,a);if(l!==!1){const h={message:UA(c,l),type:l.issue,tokenType:c};r.push(h)}else k(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(s=!0):oa(a,c.PATTERN)&&(s=!0)}),t&&!s&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:it.NO_LINE_BREAKS_FLAGS}),r}function kA(e){const t={},n=Jt(e);return M(n,r=>{const s=e[r];if(j(s))t[r]=[];else throw Error("non exhaustive match")}),t}function Zu(e){const t=e.PATTERN;if(Ve(t))return!1;if(We(t))return!0;if(k(t,"exec"))return!0;if(Pt(t))return!1;throw Error("non exhaustive match")}function MA(e){return Pt(e)&&e.length===1?e.charCodeAt(0):!1}const xA={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function th(e,t){if(k(e,"LINE_BREAKS"))return!1;if(Ve(e.PATTERN)){try{oa(t,e.PATTERN)}catch(n){return{issue:it.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Pt(e.PATTERN))return!1;if(Zu(e))return{issue:it.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function UA(e,t){if(t.issue===it.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===it.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function eh(e){return b(e,n=>Pt(n)?n.charCodeAt(0):n)}function aa(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const Gr=256;let ai=[];function cn(e){return e<Gr?e:ai[e]}function PA(){if(z(ai)){ai=new Array(65536);for(let e=0;e<65536;e++)ai[e]=e>255?255+~~(e/255):e}}function jr(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function ci(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let nh=1;const rh={};function Wr(e){const t=DA(e);FA(t),BA(t),$A(t),M(t,n=>{n.isParent=n.categoryMatches.length>0})}function DA(e){let t=At(e),n=e,r=!0;for(;r;){n=Pr(ce(b(n,i=>i.CATEGORIES)));const s=Ys(n,t);t=t.concat(s),z(s)?r=!1:n=s}return t}function FA(e){M(e,t=>{ih(t)||(rh[nh]=t,t.tokenTypeIdx=nh++),oh(t)&&!j(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),oh(t)||(t.CATEGORIES=[]),GA(t)||(t.categoryMatches=[]),jA(t)||(t.categoryMatchesMap={})})}function $A(e){M(e,t=>{t.categoryMatches=[],M(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(rh[r].tokenTypeIdx)})})}function BA(e){M(e,t=>{sh([],t)})}function sh(e,t){M(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),M(t.CATEGORIES,n=>{const r=e.concat(t);kt(r,n)||sh(r,n)})}function ih(e){return k(e,"tokenTypeIdx")}function oh(e){return k(e,"CATEGORIES")}function GA(e){return k(e,"categoryMatches")}function jA(e){return k(e,"categoryMatchesMap")}function WA(e){return k(e,"tokenTypeIdx")}const KA={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,s){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var it;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(it||(it={}));const Kr={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:KA,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Kr);class _t{constructor(t,n=Kr){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(s,i)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${s}>`);const{time:a,value:c}=ju(i),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${s}> time: ${a}ms`),this.traceInitIndent--,c}else return i()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Bt({},Kr,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let s,i=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Kr.lineTerminatorsPattern)this.config.lineTerminatorsPattern=xA;else if(this.config.lineTerminatorCharacters===Kr.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),j(t)?s={modes:{defaultMode:At(t)},defaultMode:Br}:(i=!1,s=At(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(LA(s,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(OA(s,this.trackStartLines,this.config.lineTerminatorCharacters))})),s.modes=s.modes?s.modes:{},M(s.modes,(a,c)=>{s.modes[c]=qs(a,l=>ze(l))});const o=Jt(s.modes);if(M(s.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(pA(a,o))}),z(this.lexerDefinitionErrors)){Wr(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=dA(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Bt({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=s.defaultMode,!z(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=b(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}M(this.lexerDefinitionWarning,a=>{Gu(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Xu?(this.chopInput=Xn,this.match=this.matchWithTest):(this.updateLastIndex=ft,this.match=this.matchWithExec),i&&(this.handleModes=ft),this.trackStartLines===!1&&(this.computeNewColumn=Xn),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=ft),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Gt(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!z(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{lA()}),this.TRACE_INIT("toFastProperties",()=>{Wu(this)})})}tokenize(t,n=this.defaultMode){if(!z(this.lexerDefinitionErrors)){const s=b(this.lexerDefinitionErrors,i=>i.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+s)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,s,i,o,a,c,l,u,h,d,f,m,_,w,R;const A=t,T=A.length;let I=0,y=0;const g=this.hasCustom?0:Math.floor(t.length/10),p=new Array(g),S=[];let v=this.trackStartLines?1:void 0,W=this.trackStartLines?1:void 0;const lt=kA(this.emptyGroups),Rr=this.trackStartLines,St=this.config.lineTerminatorsPattern;let Fe=0,ie=[],As=[];const oo=[],Jp=[];Object.freeze(Jp);let ws;function Qp(){return ie}function Zp(bt){const oe=cn(bt),vr=As[oe];return vr===void 0?Jp:vr}const sC=bt=>{if(oo.length===1&&bt.tokenType.PUSH_MODE===void 0){const oe=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(bt);S.push({offset:bt.startOffset,line:bt.startLine,column:bt.startColumn,length:bt.image.length,message:oe})}else{oo.pop();const oe=Zn(oo);ie=this.patternIdxToConfig[oe],As=this.charCodeToPatternIdxToConfig[oe],Fe=ie.length;const vr=this.canModeBeOptimized[oe]&&this.config.safeMode===!1;As&&vr?ws=Zp:ws=Qp}};function tg(bt){oo.push(bt),As=this.charCodeToPatternIdxToConfig[bt],ie=this.patternIdxToConfig[bt],Fe=ie.length,Fe=ie.length;const oe=this.canModeBeOptimized[bt]&&this.config.safeMode===!1;As&&oe?ws=Zp:ws=Qp}tg.call(this,n);let _e;const eg=this.config.recoveryEnabled;for(;I<T;){c=null;const bt=A.charCodeAt(I),oe=ws(bt),vr=oe.length;for(r=0;r<vr;r++){_e=oe[r];const Ht=_e.pattern;l=null;const en=_e.short;if(en!==!1?bt===en&&(c=Ht):_e.isCustom===!0?(R=Ht.exec(A,I,p,lt),R!==null?(c=R[0],R.payload!==void 0&&(l=R.payload)):c=null):(this.updateLastIndex(Ht,I),c=this.match(Ht,t,I)),c!==null){if(a=_e.longerAlt,a!==void 0){const yn=a.length;for(i=0;i<yn;i++){const nn=ie[a[i]],Hn=nn.pattern;if(u=null,nn.isCustom===!0?(R=Hn.exec(A,I,p,lt),R!==null?(o=R[0],R.payload!==void 0&&(u=R.payload)):o=null):(this.updateLastIndex(Hn,I),o=this.match(Hn,t,I)),o&&o.length>c.length){c=o,l=u,_e=nn;break}}}break}}if(c!==null){if(h=c.length,d=_e.group,d!==void 0&&(f=_e.tokenTypeIdx,m=this.createTokenInstance(c,I,f,_e.tokenType,v,W,h),this.handlePayload(m,l),d===!1?y=this.addToken(p,y,m):lt[d].push(m)),t=this.chopInput(t,h),I=I+h,W=this.computeNewColumn(W,h),Rr===!0&&_e.canLineTerminator===!0){let Ht=0,en,yn;St.lastIndex=0;do en=St.test(c),en===!0&&(yn=St.lastIndex-1,Ht++);while(en===!0);Ht!==0&&(v=v+Ht,W=h-yn,this.updateTokenEndLineColumnLocation(m,d,yn,Ht,v,W,h))}this.handleModes(_e,sC,tg,m)}else{const Ht=I,en=v,yn=W;let nn=eg===!1;for(;nn===!1&&I<T;)for(t=this.chopInput(t,1),I++,s=0;s<Fe;s++){const Hn=ie[s],zc=Hn.pattern,ng=Hn.short;if(ng!==!1?A.charCodeAt(I)===ng&&(nn=!0):Hn.isCustom===!0?nn=zc.exec(A,I,p,lt)!==null:(this.updateLastIndex(zc,I),nn=zc.exec(t)!==null),nn===!0)break}if(_=I-Ht,W=this.computeNewColumn(W,_),w=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(A,Ht,_,en,yn),S.push({offset:Ht,line:en,column:yn,length:_,message:w}),eg===!1)break}}return this.hasCustom||(p.length=y),{tokens:p,groups:lt,errors:S}}handleModes(t,n,r,s){if(t.pop===!0){const i=t.push;n(s),i!==void 0&&r.call(this,i)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,s,i,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,s===1&&c===!0||(t.endLine=i+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,s){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:s}}createStartOnlyToken(t,n,r,s,i,o){return{image:t,startOffset:n,startLine:i,startColumn:o,tokenTypeIdx:r,tokenType:s}}createFullToken(t,n,r,s,i,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:i,endLine:i,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:s}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}}_t.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",_t.NA=/NOT_APPLICABLE/;function Hr(e){return ah(e)?e.LABEL:e.name}function ah(e){return Pt(e.LABEL)&&e.LABEL!==""}const HA="parent",ch="categories",lh="label",uh="group",hh="push_mode",fh="pop_mode",dh="longer_alt",ph="line_breaks",gh="start_chars_hint";function U(e){return VA(e)}function VA(e){const t=e.pattern,n={};if(n.name=e.name,ze(t)||(n.PATTERN=t),k(e,HA))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return k(e,ch)&&(n.CATEGORIES=e[ch]),Wr([n]),k(e,lh)&&(n.LABEL=e[lh]),k(e,uh)&&(n.GROUP=e[uh]),k(e,fh)&&(n.POP_MODE=e[fh]),k(e,hh)&&(n.PUSH_MODE=e[hh]),k(e,dh)&&(n.LONGER_ALT=e[dh]),k(e,ph)&&(n.LINE_BREAKS=e[ph]),k(e,gh)&&(n.START_CHARS_HINT=e[gh]),n}const On=U({name:"EOF",pattern:_t.NA});Wr([On]);function li(e,t,n,r,s,i,o,a){return{image:t,startOffset:n,endOffset:r,startLine:s,endLine:i,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function zA(e,t){return jr(e,t)}const mh={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${ah(e)?`--> ${Hr(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:s}){const i="Expecting: ",a=`
but found: '`+ue(t).image+"'";if(r)return i+r+a;{const c=Gt(e,(d,f)=>d.concat(f),[]),l=b(c,d=>`[${b(d,f=>Hr(f)).join(", ")}]`),h=`one of these possible Token sequences:
${b(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return i+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const s="Expecting: ",o=`
but found: '`+ue(t).image+"'";if(n)return s+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${b(e,l=>`[${b(l,u=>Hr(u)).join(",")}]`).join(" ,")}>`;return s+c+o}}};Object.freeze(mh);const YA={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},kn={buildDuplicateFoundError(e,t){function n(u){return u instanceof J?u.terminalType.name:u instanceof jt?u.nonTerminalName:""}const r=e.name,s=ue(t),i=s.idx,o=Ie(s),a=n(s),c=i>0;let l=`->${o}${c?i:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=b(e.prefixPath,s=>Hr(s)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=b(e.prefixPath,s=>Hr(s)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Ie(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=b(e.leftRecursionPath,i=>i.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof er?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function qA(e,t){const n=new XA(e,t);return n.resolveRefs(),n.errors}class XA extends nr{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){M(dt(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:Mt.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class JA extends Qs{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=At(this.path.ruleStack).reverse(),this.occurrenceStack=At(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const s=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,s)}}updateExpectedNext(){z(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class QA extends JA{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const s=n.concat(r),i=new Dt({definition:s});this.possibleTokTypes=Fr(i),this.found=!0}}}class ui extends Qs{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class ZA extends ui{walkMany(t,n,r){if(t.idx===this.occurrence){const s=ue(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof J&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkMany(t,n,r)}}class Eh extends ui{walkManySep(t,n,r){if(t.idx===this.occurrence){const s=ue(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof J&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkManySep(t,n,r)}}class tw extends ui{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const s=ue(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof J&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOne(t,n,r)}}class _h extends ui{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const s=ue(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof J&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOneSep(t,n,r)}}function ca(e,t,n=[]){n=At(n);let r=[],s=0;function i(a){return a.concat(wt(e,s+1))}function o(a){const c=ca(i(a),t,n);return r.concat(c)}for(;n.length<t&&s<e.length;){const a=e[s];if(a instanceof Dt)return o(a.definition);if(a instanceof jt)return o(a.definition);if(a instanceof Ft)r=o(a.definition);else if(a instanceof ve){const c=a.definition.concat([new pt({definition:a.definition})]);return o(c)}else if(a instanceof Ne){const c=[new Dt({definition:a.definition}),new pt({definition:[new J({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof fe){const c=a.definition.concat([new pt({definition:[new J({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof pt){const c=a.definition.concat([new pt({definition:a.definition})]);r=o(c)}else{if(a instanceof de)return M(a.definition,c=>{z(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof J)n.push(a.terminalType);else throw Error("non exhaustive match")}s++}return r.push({partialPath:n,suffixDef:wt(e,s)}),r}function yh(e,t,n,r){const s="EXIT_NONE_TERMINAL",i=[s],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!z(h);){const d=h.pop();if(d===o){a&&Zn(h).idx<=l&&h.pop();continue}const f=d.def,m=d.idx,_=d.ruleStack,w=d.occurrenceStack;if(z(f))continue;const R=f[0];if(R===s){const A={idx:m,def:wt(f),ruleStack:Dr(_),occurrenceStack:Dr(w)};h.push(A)}else if(R instanceof J)if(m<c-1){const A=m+1,T=t[A];if(n(T,R.terminalType)){const I={idx:A,def:wt(f),ruleStack:_,occurrenceStack:w};h.push(I)}}else if(m===c-1)u.push({nextTokenType:R.terminalType,nextTokenOccurrence:R.idx,ruleStack:_,occurrenceStack:w}),a=!0;else throw Error("non exhaustive match");else if(R instanceof jt){const A=At(_);A.push(R.nonTerminalName);const T=At(w);T.push(R.idx);const I={idx:m,def:R.definition.concat(i,wt(f)),ruleStack:A,occurrenceStack:T};h.push(I)}else if(R instanceof Ft){const A={idx:m,def:wt(f),ruleStack:_,occurrenceStack:w};h.push(A),h.push(o);const T={idx:m,def:R.definition.concat(wt(f)),ruleStack:_,occurrenceStack:w};h.push(T)}else if(R instanceof ve){const A=new pt({definition:R.definition,idx:R.idx}),T=R.definition.concat([A],wt(f)),I={idx:m,def:T,ruleStack:_,occurrenceStack:w};h.push(I)}else if(R instanceof Ne){const A=new J({terminalType:R.separator}),T=new pt({definition:[A].concat(R.definition),idx:R.idx}),I=R.definition.concat([T],wt(f)),y={idx:m,def:I,ruleStack:_,occurrenceStack:w};h.push(y)}else if(R instanceof fe){const A={idx:m,def:wt(f),ruleStack:_,occurrenceStack:w};h.push(A),h.push(o);const T=new J({terminalType:R.separator}),I=new pt({definition:[T].concat(R.definition),idx:R.idx}),y=R.definition.concat([I],wt(f)),g={idx:m,def:y,ruleStack:_,occurrenceStack:w};h.push(g)}else if(R instanceof pt){const A={idx:m,def:wt(f),ruleStack:_,occurrenceStack:w};h.push(A),h.push(o);const T=new pt({definition:R.definition,idx:R.idx}),I=R.definition.concat([T],wt(f)),y={idx:m,def:I,ruleStack:_,occurrenceStack:w};h.push(y)}else if(R instanceof de)for(let A=R.definition.length-1;A>=0;A--){const T=R.definition[A],I={idx:m,def:T.definition.concat(wt(f)),ruleStack:_,occurrenceStack:w};h.push(I),h.push(o)}else if(R instanceof Dt)h.push({idx:m,def:R.definition.concat(wt(f)),ruleStack:_,occurrenceStack:w});else if(R instanceof er)h.push(ew(R,m,_,w));else throw Error("non exhaustive match")}return u}function ew(e,t,n,r){const s=At(n);s.push(e.name);const i=At(r);return i.push(1),{idx:t,def:e.definition,ruleStack:s,occurrenceStack:i}}var ot;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(ot||(ot={}));function Th(e){if(e instanceof Ft||e==="Option")return ot.OPTION;if(e instanceof pt||e==="Repetition")return ot.REPETITION;if(e instanceof ve||e==="RepetitionMandatory")return ot.REPETITION_MANDATORY;if(e instanceof Ne||e==="RepetitionMandatoryWithSeparator")return ot.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof fe||e==="RepetitionWithSeparator")return ot.REPETITION_WITH_SEPARATOR;if(e instanceof de||e==="Alternation")return ot.ALTERNATION;throw Error("non exhaustive match")}function nw(e,t,n,r,s,i){const o=ua(e,t,n),a=Rh(o)?ci:jr;return i(o,r,a,s)}function rw(e,t,n,r,s,i){const o=ha(e,t,s,n),a=Rh(o)?ci:jr;return i(o[0],a,r)}function sw(e,t,n,r){const s=e.length,i=le(e,o=>le(o,a=>a.length===1));if(t)return function(o){const a=b(o,c=>c.GATE);for(let c=0;c<s;c++){const l=e[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let d=0;d<u;d++){const f=l[d],m=f.length;for(let _=0;_<m;_++){const w=this.LA(_+1);if(n(w,f[_])===!1)continue t}return c}}};if(i&&!r){const o=b(e,c=>ce(c)),a=Gt(o,(c,l,u)=>(M(l,h=>{k(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),M(h.categoryMatches,d=>{k(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<s;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue t}return o}}}}function iw(e,t,n){const r=le(e,i=>i.length===1),s=e.length;if(r&&!n){const i=ce(e);if(i.length===1&&z(i[0].categoryMatches)){const a=i[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Gt(i,(a,c,l)=>(a[c.tokenTypeIdx]=!0,M(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let i=0;i<s;i++){const o=e[i],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class ow extends Qs{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,s){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(s),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,ot.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,ot.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,ot.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,ot.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,ot.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class Sh extends nr{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,ot.OPTION)}visitRepetition(t){this.checkIsTarget(t,ot.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,ot.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,ot.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,ot.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,ot.ALTERNATION)}}function Ah(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function la(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],s=[];for(let i=0;i<t.length;i++){const o=t[i];s.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];s.push(o+c)}}t=s}return t}function aw(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const s=e[r];for(let i=0;i<t.length;i++){const o=t[i];if(s[o]===!0)return!1}}return!0}function wh(e,t){const n=b(e,o=>ca([o],1)),r=Ah(n.length),s=b(n,o=>{const a={};return M(o,c=>{const l=la(c.partialPath);M(l,u=>{a[u]=!0})}),a});let i=n;for(let o=1;o<=t;o++){const a=i;i=Ah(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=la(h);if(aw(s,f,c)||z(d)||h.length===t){const _=r[c];if(fa(_,h)===!1){_.push(h);for(let w=0;w<f.length;w++){const R=f[w];s[c][R]=!0}}}else{const _=ca(d,o+1,h);i[c]=i[c].concat(_),M(_,w=>{const R=la(w.partialPath);M(R,A=>{s[c][A]=!0})})}}}}return r}function ua(e,t,n,r){const s=new Sh(e,ot.ALTERNATION,r);return t.accept(s),wh(s.result,n)}function ha(e,t,n,r){const s=new Sh(e,n);t.accept(s);const i=s.result,a=new ow(t,e,n).startWalking(),c=new Dt({definition:i}),l=new Dt({definition:a});return wh([c,l],r)}function fa(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let s=0;s<r.length;s++){const i=t[s],o=r[s];if((i===o||o.categoryMatchesMap[i.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function cw(e,t){return e.length<t.length&&le(e,(n,r)=>{const s=t[r];return n===s||s.categoryMatchesMap[n.tokenTypeIdx]})}function Rh(e){return le(e,t=>le(t,n=>le(n,r=>z(r.categoryMatches))))}function lw(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return b(t,n=>Object.assign({type:Mt.CUSTOM_LOOKAHEAD_VALIDATION},n))}function uw(e,t,n,r){const s=te(e,c=>hw(c,n)),i=ww(e,t,n),o=te(e,c=>yw(c,n)),a=te(e,c=>pw(c,e,r,n));return s.concat(i,o,a)}function hw(e,t){const n=new dw;e.accept(n);const r=n.allProductions,s=RS(r,fw),i=he(s,a=>a.length>1);return b(dt(i),a=>{const c=ue(a),l=t.buildDuplicateFoundError(e,a),u=Ie(c),h={message:l,type:Mt.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=vh(c);return d&&(h.parameter=d),h})}function fw(e){return`${Ie(e)}_#_${e.idx}_#_${vh(e)}`}function vh(e){return e instanceof J?e.terminalType.name:e instanceof jt?e.nonTerminalName:""}class dw extends nr{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function pw(e,t,n,r){const s=[];if(Gt(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});s.push({message:o,type:Mt.DUPLICATE_RULE_NAME,ruleName:e.name})}return s}function gw(e,t,n){const r=[];let s;return kt(t,e)||(s=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:s,type:Mt.INVALID_RULE_OVERRIDE,ruleName:e})),r}function Nh(e,t,n,r=[]){const s=[],i=hi(t.definition);if(z(i))return[];{const o=e.name;kt(i,e)&&s.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:Mt.LEFT_RECURSION,ruleName:o});const c=Ys(i,r.concat([e])),l=te(c,u=>{const h=At(r);return h.push(u),Nh(e,u,n,h)});return s.concat(l)}}function hi(e){let t=[];if(z(e))return t;const n=ue(e);if(n instanceof jt)t.push(n.referencedRule);else if(n instanceof Dt||n instanceof Ft||n instanceof ve||n instanceof Ne||n instanceof fe||n instanceof pt)t=t.concat(hi(n.definition));else if(n instanceof de)t=ce(b(n.definition,i=>hi(i.definition)));else if(!(n instanceof J))throw Error("non exhaustive match");const r=Js(n),s=e.length>1;if(r&&s){const i=wt(e);return t.concat(hi(i))}else return t}class da extends nr{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function mw(e,t){const n=new da;e.accept(n);const r=n.alternations;return te(r,i=>{const o=Dr(i.definition);return te(o,(a,c)=>{const l=yh([a],[],jr,1);return z(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:i,emptyChoiceIdx:c}),type:Mt.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:i.idx,alternative:c+1}]:[]})})}function Ew(e,t,n){const r=new da;e.accept(r);let s=r.alternations;return s=qs(s,o=>o.ignoreAmbiguities===!0),te(s,o=>{const a=o.idx,c=o.maxLookahead||t,l=ua(a,e,c,o),u=Sw(l,o,e,n),h=Aw(l,o,e,n);return u.concat(h)})}class _w extends nr{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function yw(e,t){const n=new da;e.accept(n);const r=n.alternations;return te(r,i=>i.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:i}),type:Mt.TOO_MANY_ALTS,ruleName:e.name,occurrence:i.idx}]:[])}function Tw(e,t,n){const r=[];return M(e,s=>{const i=new _w;s.accept(i);const o=i.allProductions;M(o,a=>{const c=Th(a),l=a.maxLookahead||t,u=a.idx,d=ha(u,s,c,l)[0];if(z(ce(d))){const f=n.buildEmptyRepetitionError({topLevelRule:s,repetition:a});r.push({message:f,type:Mt.NO_NON_EMPTY_LOOKAHEAD,ruleName:s.name})}})}),r}function Sw(e,t,n,r){const s=[],i=Gt(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||M(c,u=>{const h=[l];M(e,(d,f)=>{l!==f&&fa(d,u)&&t.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!fa(s,u)&&(s.push(u),a.push({alts:h,path:u}))}),a),[]);return b(i,a=>{const c=b(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:Mt.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function Aw(e,t,n,r){const s=Gt(e,(o,a,c)=>{const l=b(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Pr(te(s,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Zt(s,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&cw(d.path,l));return b(u,d=>{const f=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:f,prefixPath:d.path}),type:Mt.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:m,alternatives:f}})}))}function ww(e,t,n){const r=[],s=b(t,i=>i.name);return M(e,i=>{const o=i.name;if(kt(s,o)){const a=n.buildNamespaceConflictError(i);r.push({message:a,type:Mt.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function Rw(e){const t=Zo(e,{errMsgProvider:YA}),n={};return M(e.rules,r=>{n[r.name]=r}),qA(n,t.errMsgProvider)}function vw(e){return e=Zo(e,{errMsgProvider:kn}),uw(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const Ih="MismatchedTokenException",Ch="NoViableAltException",bh="EarlyExitException",Lh="NotAllInputParsedException",Oh=[Ih,Ch,bh,Lh];Object.freeze(Oh);function fi(e){return kt(Oh,e.name)}class di extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class kh extends di{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Ih}}class Nw extends di{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Ch}}class Iw extends di{constructor(t,n){super(t,n),this.name=Lh}}class Cw extends di{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=bh}}const pa={},Mh="InRuleRecoveryException";class bw extends Error{constructor(t){super(t),this.name=Mh}}class Lw{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=k(t,"recoveryEnabled")?t.recoveryEnabled:Ye.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Ow)}getTokenToInsert(t){const n=li(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,s){const i=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:s,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new kh(f,l,this.LA(0));m.resyncedTokens=Dr(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,s)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(u,i)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new bw("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||z(n))return!1;const r=this.LA(1);return tr(n,i=>this.tokenMatcher(r,i))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return kt(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const s=tr(t,i=>zA(n,i));if(s!==void 0)return s;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return pa;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return b(t,(r,s)=>s===0?pa:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[s],inRule:this.shortRuleNameToFullName(t[s-1])})}flattenFollowSet(){const t=b(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return ce(t)}getFollowSetFromFollowKey(t){if(t===pa)return[On];const n=t.ruleName+t.idxInCallingRule+Hu+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,On)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Dr(n)}attemptInRepetitionRecovery(t,n,r,s,i,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),s=At(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:s,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return b(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function Ow(e,t,n,r,s,i,o){const a=this.getKeyForAutomaticLookahead(r,s);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new i(f,s).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=On,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const kw=4,ln=8,xh=1<<ln,Uh=2<<ln,ga=3<<ln,ma=4<<ln,Ea=5<<ln,pi=6<<ln;function _a(e,t,n){return n|t|e}class Mw{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Ye.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(z(n)){const r=this.validateEmptyOrAlternatives(t.rules),s=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),i=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...s,...i]}return n}validateNoLeftRecursion(t){return te(t,n=>Nh(n,n,kn))}validateEmptyOrAlternatives(t){return te(t,n=>mw(n,kn))}validateAmbiguousAlternationAlternatives(t,n){return te(t,r=>Ew(r,n,kn))}validateSomeNonEmptyLookaheadPath(t,n){return Tw(t,n,kn)}buildLookaheadForAlternation(t){return nw(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,sw)}buildLookaheadForOptional(t){return rw(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Th(t.prodType),iw)}}class xw{initLooksAhead(t){this.dynamicTokensEnabled=k(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Ye.dynamicTokensEnabled,this.maxLookahead=k(t,"maxLookahead")?t.maxLookahead:Ye.maxLookahead,this.lookaheadStrategy=k(t,"lookaheadStrategy")?t.lookaheadStrategy:new Mw({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){M(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:s,option:i,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=Pw(n);M(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Ie(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=_a(this.fullRuleNameToShort[n.name],xh,l.idx);this.setLaFuncCache(d,h)})}),M(s,l=>{this.computeLookaheadFunc(n,l.idx,ga,"Repetition",l.maxLookahead,Ie(l))}),M(i,l=>{this.computeLookaheadFunc(n,l.idx,Uh,"Option",l.maxLookahead,Ie(l))}),M(o,l=>{this.computeLookaheadFunc(n,l.idx,ma,"RepetitionMandatory",l.maxLookahead,Ie(l))}),M(a,l=>{this.computeLookaheadFunc(n,l.idx,pi,"RepetitionMandatoryWithSeparator",l.maxLookahead,Ie(l))}),M(c,l=>{this.computeLookaheadFunc(n,l.idx,Ea,"RepetitionWithSeparator",l.maxLookahead,Ie(l))})})})}computeLookaheadFunc(t,n,r,s,i,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:i||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:s}),c=_a(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return _a(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class Uw extends nr{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const gi=new Uw;function Pw(e){gi.reset(),e.accept(gi);const t=gi.dslMethods;return gi.reset(),t}function Ph(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function Dh(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function Dw(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function Fw(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const $w="name";function Fh(e,t){Object.defineProperty(e,$w,{enumerable:!1,configurable:!0,writable:!1,value:t})}function Bw(e,t){const n=Jt(e),r=n.length;for(let s=0;s<r;s++){const i=n[s],o=e[i],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function Gw(e,t){const n=function(){};Fh(n,e+"BaseSemantics");const r={visit:function(s,i){if(j(s)&&(s=s[0]),!ze(s))return this[s.name](s.children,i)},validateVisitor:function(){const s=Ww(this,t);if(!z(s)){const i=b(s,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${i.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function jw(e,t,n){const r=function(){};Fh(r,e+"BaseSemanticsWithDefaults");const s=Object.create(n.prototype);return M(t,i=>{s[i]=Bw}),r.prototype=s,r.prototype.constructor=r,r}var ya;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(ya||(ya={}));function Ww(e,t){return Kw(e,t)}function Kw(e,t){const n=Zt(t,s=>We(e[s])===!1),r=b(n,s=>({msg:`Missing visitor method: <${s}> on ${e.constructor.name} CST Visitor.`,type:ya.MISSING_METHOD,methodName:s}));return Pr(r)}class Hw{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=k(t,"nodeLocationTracking")?t.nodeLocationTracking:Ye.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=ft,this.cstFinallyStateUpdate=ft,this.cstPostTerminal=ft,this.cstPostNonTerminal=ft,this.cstPostRule=ft;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Dh,this.setNodeLocationFromNode=Dh,this.cstPostRule=ft,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=ft,this.setNodeLocationFromNode=ft,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Ph,this.setNodeLocationFromNode=Ph,this.cstPostRule=ft,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=ft,this.setNodeLocationFromNode=ft,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=ft,this.setNodeLocationFromNode=ft,this.cstPostRule=ft,this.setInitialNodeLocation=ft;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];Dw(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];Fw(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(ze(this.baseCstVisitorConstructor)){const t=Gw(this.className,Jt(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(ze(this.baseCstVisitorWithDefaultsConstructor)){const t=jw(this.className,Jt(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class Vw{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):_i}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?_i:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class zw{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=yi){if(kt(this.definedRulesNames,t)){const o={message:kn.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Mt.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const s=this.defineRule(t,n,r);return this[t]=s,s}OVERRIDE_RULE(t,n,r=yi){const s=gw(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(s);const i=this.defineRule(t,n,r);return this[t]=i,i}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(s){if(fi(s))return!1;throw s}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return qS(dt(this.gastProductionsCache))}}class Yw{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ci,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},k(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(j(t)){if(z(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(j(t))this.tokensMap=Gt(t,(i,o)=>(i[o.name]=o,i),{});else if(k(t,"modes")&&le(ce(dt(t.modes)),WA)){const i=ce(dt(t.modes)),o=ta(i);this.tokensMap=Gt(o,(a,c)=>(a[c.name]=c,a),{})}else if(Xt(t))this.tokensMap=At(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=On;const r=k(t,"modes")?ce(dt(t.modes)):dt(t),s=le(r,i=>z(i.categoryMatches));this.tokenMatcher=s?ci:jr,Wr(dt(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const s=k(r,"resyncEnabled")?r.resyncEnabled:yi.resyncEnabled,i=k(r,"recoveryValueFunc")?r.recoveryValueFunc:yi.recoveryValueFunc,o=this.ruleShortNameIdx<<kw+ln;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const s=this.RULE_STACK.length===1,i=n&&!this.isBackTracking()&&this.recoveryEnabled;if(fi(t)){const o=t;if(i){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(s)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Uh,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof t!="function"){i=t.DEF;const o=t.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=t;if(s.call(this)===!0)return i.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(ma,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const o=n.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=n;if(s.call(this)===!0){let o=this.doSingleRepetition(i);for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i)}else throw this.raiseEarlyExitException(t,ot.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],s,ma,t,tw)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(pi,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,a,s,_h],a,pi,t,_h)}else throw this.raiseEarlyExitException(t,ot.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(ga,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const a=n.GATE;if(a!==void 0){const c=s;s=()=>a.call(this)&&c.call(this)}}else i=n;let o=!0;for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],s,ga,t,ZA,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(Ea,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,a,s,Eh],a,Ea,t,Eh)}}repetitionSepSecondInternal(t,n,r,s,i){for(;r();)this.CONSUME(n),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,s,i],r,pi,t,i)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(xh,n),s=j(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,s);if(o!==void 0)return s[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Iw(n,t))}}subruleInternal(t,n,r){let s;try{const i=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,s=t.apply(this,i),this.cstPostNonTerminal(s,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),s}catch(i){throw this.subruleInternalError(i,r,t.ruleName)}}subruleInternalError(t,n,r){throw fi(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let s;try{const i=this.LA(1);this.tokenMatcher(i,t)===!0?(this.consumeToken(),s=i):this.consumeInternalError(t,i,r)}catch(i){s=this.consumeInternalRecovery(t,n,i)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,s),s}consumeInternalError(t,n,r){let s;const i=this.LA(0);throw r!==void 0&&r.ERR_MSG?s=r.ERR_MSG:s=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new kh(s,n,i))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const s=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,s)}catch(i){throw i.name===Mh?r:i}}else throw r}saveRecogState(){const t=this.errors,n=At(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),On)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class qw{initErrorHandler(t){this._errors=[],this.errorMessageProvider=k(t,"errorMessageProvider")?t.errorMessageProvider:Ye.errorMessageProvider}SAVE_ERROR(t){if(fi(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:At(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return At(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const s=this.getCurrRuleFullName(),i=this.getGAstProductions()[s],a=ha(t,i,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:s});throw this.SAVE_ERROR(new Cw(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),s=this.getGAstProductions()[r],i=ua(t,s,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Nw(c,this.LA(1),a))}}class Xw{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(ze(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return yh([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=ue(t.ruleStack),s=this.getGAstProductions()[n];return new QA(s,t).startWalking()}}const mi={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(mi);const $h=!0,Bh=Math.pow(2,ln)-1,Gh=U({name:"RECORDING_PHASE_TOKEN",pattern:_t.NA});Wr([Gh]);const jh=li(Gh,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(jh);const Jw={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class Qw{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,s){return this.consumeInternalRecord(r,t,s)},this[`SUBRULE${n}`]=function(r,s){return this.subruleInternalRecord(r,t,s)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return _i}topLevelRuleRecord(t,n){try{const r=new er({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return Vr.call(this,Ft,t,n)}atLeastOneInternalRecord(t,n){Vr.call(this,ve,n,t)}atLeastOneSepFirstInternalRecord(t,n){Vr.call(this,Ne,n,t,$h)}manyInternalRecord(t,n){Vr.call(this,pt,n,t)}manySepFirstInternalRecord(t,n){Vr.call(this,fe,n,t,$h)}orInternalRecord(t,n){return Zw.call(this,t,n)}subruleInternalRecord(t,n,r){if(Ei(n),!t||k(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Wh(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const s=Zn(this.recordingProdStack),i=t.ruleName,o=new jt({idx:n,nonTerminalName:i,label:r==null?void 0:r.LABEL,referencedRule:void 0});return s.definition.push(o),this.outputCst?Jw:mi}consumeInternalRecord(t,n,r){if(Ei(n),!ih(t)){const o=new Error(`<CONSUME${Wh(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const s=Zn(this.recordingProdStack),i=new J({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return s.definition.push(i),jh}}function Vr(e,t,n,r=!1){Ei(n);const s=Zn(this.recordingProdStack),i=We(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),k(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),i.call(this),s.definition.push(o),this.recordingProdStack.pop(),mi}function Zw(e,t){Ei(t);const n=Zn(this.recordingProdStack),r=j(e)===!1,s=r===!1?e:e.DEF,i=new de({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});k(e,"MAX_LOOKAHEAD")&&(i.maxLookahead=e.MAX_LOOKAHEAD);const o=Bu(s,a=>We(a.GATE));return i.hasPredicates=o,n.definition.push(i),M(s,a=>{const c=new Dt({definition:[]});i.definition.push(c),k(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:k(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),mi}function Wh(e){return e===0?"":`${e}`}function Ei(e){if(e<0||e>Bh){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${Bh+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class tR{initPerformanceTracer(t){if(k(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ye.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:s,value:i}=ju(n),o=s>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${s}ms`),this.traceInitIndent--,i}else return n()}}function eR(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(s=>{if(s==="constructor")return;const i=Object.getOwnPropertyDescriptor(r,s);i&&(i.get||i.set)?Object.defineProperty(e.prototype,s,i):e.prototype[s]=n.prototype[s]})})}const _i=li(On,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(_i);const Ye=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:mh,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),yi=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Mt;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Mt||(Mt={}));class zr{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Wu(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),M(this.definedRulesNames,s=>{const o=this[s].originalGrammarAction;let a;this.TRACE_INIT(`${s} Rule`,()=>{a=this.topLevelRuleRecord(s,o)}),this.gastProductionsCache[s]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=Rw({rules:dt(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(z(r)&&this.skipValidations===!1){const s=vw({rules:dt(this.gastProductionsCache),tokenTypes:dt(this.tokensMap),errMsgProvider:kn,grammarName:n}),i=lw({lookaheadStrategy:this.lookaheadStrategy,rules:dt(this.gastProductionsCache),tokenTypes:dt(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(s,i)}}),z(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const s=nA(dt(this.gastProductionsCache));this.resyncFollows=s}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var s,i;(i=(s=this.lookaheadStrategy).initialize)===null||i===void 0||i.call(s,{rules:dt(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(dt(this.gastProductionsCache))})),!zr.DEFER_DEFINITION_ERRORS_HANDLING&&!z(this.definitionErrors))throw t=b(this.definitionErrors,s=>s.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),k(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=k(n,"skipValidations")?n.skipValidations:Ye.skipValidations}}zr.DEFER_DEFINITION_ERRORS_HANDLING=!1,eR(zr,[Lw,xw,Hw,Vw,Yw,zw,qw,Xw,Qw,tR]);class nR extends zr{constructor(t,n=Ye){const r=At(n);r.outputCst=!0,super(t,r)}}const Ce=!!JSON.parse("false");JSON.parse("false");const rR=!!JSON.parse("false"),Ta=yo(32,126).map(e=>String.fromCharCode(e)),Yr=U({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),sR=U({name:"Whitespace",pattern:/ +/,group:_t.SKIPPED}),iR=U({name:"Whitespace",pattern:/\s+/,line_breaks:!0,group:_t.SKIPPED}),Sa=U({name:"Stat",pattern:/@.*/,start_chars_hint:["@"]}),pe=U({name:"Command",pattern:/#/,start_chars_hint:["#"]});let Kh=!1;function oR(e,t,n){if(!Kh)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Yr)return null;let s=t;for(;e[s]===" ";)s++;if("@#/?':!".includes(e[s]))return null;let i=t+1;for(;i<e.length&&e[i]!==`
`;)i++;return[e.substring(t,i)]}const Hh=U({name:"Text",pattern:oR,line_breaks:!1,start_chars_hint:Ta.filter(e=>"@#/?':!".includes(e)===!1)}),Vh=U({name:"Comment",pattern:/'.*/,start_chars_hint:["'"]}),zh=U({name:"Label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Yh=U({name:"HyperLink",pattern:/!/,start_chars_hint:["!"]}),qh=U({name:"HyperLinkText",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Wt=U({name:"StringLiteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:Ta}),Xh=U({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Jh=U({name:"NumberLiteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/});function ee(e){return U({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:Wt})}const Qh=U({name:"IsEq",pattern:/=|is|eq|equal/,longer_alt:Wt}),Zh=U({name:"IsNotEq",pattern:/!=|not ?eq|not ?equal/,longer_alt:Wt}),tf=U({name:"IsLessThan",pattern:/<|below/,longer_alt:Wt}),ef=U({name:"IsGreaterThan",pattern:/>|above/,longer_alt:Wt}),nf=U({name:"IsLessThanOrEqual",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:Wt}),rf=U({name:"IsGreaterThanOrEqual",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:Wt}),Aa=U({name:"Or",pattern:/or/i,longer_alt:Wt}),wa=U({name:"Not",pattern:/not/i,longer_alt:Wt}),Ra=U({name:"And",pattern:/and/i,longer_alt:Wt}),va=U({name:"Plus",pattern:/\+/}),Na=U({name:"Minus",pattern:/-/}),sf=U({name:"Power",pattern:/\*\*/}),of=U({name:"Multiply",pattern:/\*/}),Ia=U({name:"Divide",pattern:/\//}),af=U({name:"ModDivide",pattern:/%/}),cf=U({name:"FloorDivide",pattern:/%%/}),lf=U({name:"Query",pattern:/\?/}),uf=U({name:"LParen",pattern:/\(/,push_mode:"ignore_newlines"}),hf=U({name:"RParen",pattern:/\)/,pop_mode:!0}),ff=U({name:"play",pattern:/play .*/,start_chars_hint:Ta,longer_alt:Wt}),Ca=ee("if"),Mn=ee("do"),ba=ee("else"),df=ee("endif"),pf=ee("while"),gf=ee("endwhile"),mf=ee("repeat"),Ef=ee("endrepeat"),La=ee("read"),_f=ee("endread"),yf=ee("break"),Tf=ee("continue");function Sf(e){return[...e,Jh,Qh,Zh,nf,tf,rf,ef,Aa,wa,Ra,va,Na,sf,of,Ia,cf,af,lf,uf,hf,Xh,Wt]}const Af=Sf([Hh,Sa,ff,pe,Vh,zh,Yh,qh,Yr,sR,Ca,Mn,ba,df,pf,gf,mf,Ef,La,_f,yf,Tf]),aR=new _t({defaultMode:"use_newlines",modes:{use_newlines:Af,ignore_newlines:Sf([iR])}},{skipValidations:!Ce,ensureOptimizations:Ce});function Oa(e){Kh=!0;const t=aR.tokenize(e||` 
`),[n]=(Array.isArray(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(li(Yr,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}var Q=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(Q||{});function cR(e){return e.map(t=>t.image)}function lR(e,t){const[n,r,...s]=t;if(E(e.stats)&&E(n))switch(n.image.toLowerCase()){case"rn":case"range":case"sl":case"select":case"nm":case"number":case"tx":case"text":case"ln":case"link":if(E(r)){const i=r.image.toLowerCase();e.stats[i]=cR(s??[])}break}}function wf(e){const t={...ka(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function ka(e){var r;if(!E(e))return{};if(E((r=e.stats)==null?void 0:r.type))return e.stats;e.stats={};const t=Oa(e.code);let n=!0;for(let s=0;s<t.tokens.length;++s){const i=t.tokens[s];if(i.tokenType===Sa){const[o,...a]=i.image.slice(1).split(" "),c=o.toLowerCase(),l=a.join(" "),u=l.toLowerCase();switch(c){case"stat":{const h=Oa(`!${l}`);h.tokens.length&&lR(e,h.tokens);break}case"flags":e.stats.flags=u;break;case"cli":e.stats.type=1,e.stats.name=u;break;case"func":e.stats.type=Q.FUNC,e.stats.name=u;break;case"board":e.stats.type=2,e.stats.name=u;break;case"object":e.stats.type=3,e.stats.name=u;break;case"terrain":e.stats.type=4,e.stats.name=u;break;case"charset":e.stats.type=5,e.stats.name=u;break;case"palette":e.stats.type=6,e.stats.name=u;break;default:n?e.stats.name=[c,...a].join(" "):e.stats[c]=1;break}n=!1}}return E(e.stats.type)||(e.stats.type=3),e.stats}function uR(e){return ka(e).type??0}function hR(e){return(ka(e).name??"").toLowerCase()}function fR(e,t){return{id:Sn(),name:e,pages:t,flags:{},players:{}}}function Ma(e,t,n){if(!E(e))return;const r=n.toLowerCase();return e.pages.find(i=>uR(i)===t&&(i.id===n||r===hR(i)))}function xa(e,t,n){const r=Ma(e,t,n);if(r)switch(t){case Q.ERROR:return r.error;case Q.FUNC:return r.code;case Q.BOARD:return r.board;case Q.OBJECT:return r.object;case Q.TERRAIN:return r.terrain;case Q.CHARSET:return r.charset;case Q.PALETTE:return r.palette}}function be(e,t){if(E(t)&&E(t.kind))return E(t.kinddata)||(t.kinddata=E(t.id)?Ti(e,t.kind):Rf(e,t.kind)),t.kinddata}function Ti(e,t){const n=t??"",r=Ma(e,Q.OBJECT,n),s=xa(e,Q.OBJECT,n);if(E(r)){const i=wf(r);return{...s,...i,name:n,code:r.code}}else return}function Rf(e,t){const n=t??"",r=Ma(e,Q.TERRAIN,n),s=xa(e,Q.TERRAIN,n);if(E(r)){const i=wf(r);return{...s,...i,name:n,code:r.code}}else return}function sr(e,t){return xa(e,Q.BOARD,t)}function vf(e,t){if(e)return e.flags[t]=e.flags[t]??{},e.flags[t]}function dR(e,t,n){const r=vf(e,t);return r==null?void 0:r[n]}function pR(e,t,n,r){const s=vf(e,t);return s&&(s[n]=r),r}function Nf(e,t){return sr(e,(e==null?void 0:e.players[t])??"")}function gR(e,t,n){E(e)&&E(sr(e,n))&&(e.players[t]=n)}function mR(e){return Zg(Object.values((e==null?void 0:e.players)??[])).map(t=>sr(e,t)).filter(E)}function ER(e,t,n,r){const s=Ao(t,(n==null?void 0:n.id)??"");if(!E(e)||!E(t)||!E(s)||!E(s.x)||!E(s.y)||!E(t.lookup)||r.x<0||r.x>=t.width||r.y<0||r.y>=t.height)return{kind:"edge",collision:Nt.SOLID,x:r.x,y:r.y};if(s.x-r.x===0&&s.y-r.y===0)return;const i=r.x+r.y*t.width,o=be(e,s),a=s.collision??(o==null?void 0:o.collision),c=Ao(t,t.lookup[i]??"");if(E(c))return{...c};const l=t.terrain[i];if(E(l)){const u=be(e,l),h=l.collision??(u==null?void 0:u.collision);if(ol(a,h))return{...l,x:r.x,y:r.y}}s.x=r.x,s.y=r.y,E(s.removed)||(t.lookup[i]=void 0,t.lookup[s.x+s.y*t.width]=s.id??"")}function ir(e,t){const n=be(e,t);return E(t==null?void 0:t.id)&&E(t.x)&&E(t.y)?(t.name??(n==null?void 0:n.name)??"object").toLowerCase():((t==null?void 0:t.name)??(n==null?void 0:n.name)??"terrain").toLowerCase()}function Ua(e,t,n,r){if(!E(e)||!E(t)||!E(t.named)||!E(n))return;const s=ir(e,n);t.named[s]||(t.named[s]=new Set),t.named[s].add((n==null?void 0:n.id)??r??"")}function _R(e,t,n){if(!(!E(e)||!E(t)||!E(t.lookup)||!E(n==null?void 0:n.id))&&!E(n.removed)){const r=n.x??0,s=n.y??0;t.lookup[r+s*t.width]=n.id}}function qr(e,t){if(!E(e)||!E(t)||E(t.lookup)&&E(t.named))return;const n=new Array(t.width*t.height).fill(void 0),r={},s=Object.values(t.objects);for(let a=0;a<s.length;++a){const c=s[a];if(E(c.x)&&E(c.y)&&E(c.id)&&!E(c.removed)){c.category=Os.OBJECT,n[c.x+c.y*t.width]=c.id;const l=ir(e,c);r[l]||(r[l]=new Set),r[l].add(c.id)}}let i=0,o=0;for(let a=0;a<t.terrain.length;++a){const c=t.terrain[a];if(E(c)){c.x=i,c.y=o,c.category=Os.TERRAIN;const l=ir(e,c);r[l]||(r[l]=new Set),r[l].add(a)}++i,i>=t.width&&(i=0,++o)}t.lookup=n,t.named=r}function Pa(e,t,n){return ir(e,t)!=="player"&&E(t)?(t.removed=n,!0):!1}function Si(e,t,n){var r;if(E(e)&&E(t)&&E(n==null?void 0:n.id)){if(E(t.lookup)&&E(n.x)&&E(n.y)){const i=n.x+n.y*t.width;t.lookup[i]===n.id&&delete t.lookup[i]}const s=ir(e,n);E((r=t.named)==null?void 0:r[s])&&E(n.id)&&t.named[s].delete(n.id)}}function yR(e,t,n){if(!E(e)||!E(t))return;const r=Object.values(t.objects);for(let s=0;s<r.length;++s){const i=r[s];E(i.id)&&E(i.removed)&&n-i.removed>bo*5&&wo(t,i.id)}}function TR(e,t,n){const r=[];if(!E(e)||!E(t))return r;t.lookup=void 0,qr(e,t);const s=Object.values(t.objects);for(let i=0;i<s.length;++i){const o=s[i];if(!E(o.id))continue;o.lx=o.x,o.ly=o.y;const a=be(e,o),c=o.code??(a==null?void 0:a.code)??"";c&&r.push({id:o.id,type:Q.OBJECT,code:c,object:o,terrain:void 0})}return yR(e,t,n),r}var Xr=(e=>(e[e.VIEW=0]="VIEW",e[e.EDIT=1]="EDIT",e))(Xr||{});function If(e){return{id:Sn(),type:e}}function Cf(e,t){const n=If(0);return n.book=e,n.board=t,n}function SR(e,t){const n=If(1);return n.book=e,n.board=t,n}const ge={defaultplayer:"",books:new Map,chips:new Map,frames:new Map};function AR(e){ge.defaultplayer=e}function bf(e){const t=[Cf(void 0,void 0)];return ge.frames.set(e,t),t}function wR(e,t,n){const r=Ai(e);E(r)&&r.push(Cf(t,n))}function RR(e,t,n){const r=Ai(e);E(r)&&r.push(SR(t,n))}function Ai(e){return ge.frames.get(e)??bf(e)}function Jr(e){const t=e.toLowerCase();return ge.books.get(e)??[...ge.books.values()].find(n=>n.name.toLowerCase()===t)}function vR(e){return ge.books.clear(),ge.books.set(e.id,e),e.id}function NR(e){return ge.books.set(e.id,e),e.id}function Z(e){let t=ge.chips.get(e);return E(t)||(t={book:void 0,board:void 0,object:void 0,terrain:void 0,charset:void 0,palette:void 0,inputqueue:new Set,inputmods:{[ht.NONE]:0,[ht.MOVE_UP]:0,[ht.MOVE_DOWN]:0,[ht.MOVE_LEFT]:0,[ht.MOVE_RIGHT]:0,[ht.OK_BUTTON]:0,[ht.CANCEL_BUTTON]:0,[ht.MENU_BUTTON]:0},inputcurrent:void 0},ge.chips.set(e,t)),t}function O(e,t){const n=Z(e.id());return hm(n,t,e.get)}const wi="main",Da="player",Fa="title";function IR(e){if(!st(e)||!e)return Vn("memory","login",`failed for playerid ==>${e}<==`,e);const t=Jr(wi);if(!E(t))return Vn("memory","login",`login failed to find book ${wi}`,e);const n=sr(t,Fa);if(!E(n))return Vn("memory","login",`login failed to find board ${Fa}`,e);const r=Ti(t,Da);if(!E(r))return Vn("memory","login",`login failed to find object type ${Da}`,e);const s=al(n,{id:e,x:0,y:0,kind:Da,stats:{player:e}});return E(s==null?void 0:s.id)&&gR(t,e,Fa),!0}function CR(e){ge.books.forEach(t=>wo(Nf(t,e),e))}function bR(e,t){const n=Jr(wi);mR(n).forEach(r=>{const s=TR(n,r,t);for(let i=0;i<s.length;++i){const o=s[i],a=Z(o.id);a.book=n,a.board=r,a.object=o.object,a.inputcurrent=void 0,e.tick(o.id,o.type,t,o.code)}})}function LR(e,t,n,r){const s=`${n}_cli`,i=Z(s);i.book=void 0,i.board=void 0,i.inputcurrent=void 0,tl("memory","running",t,s,r),e.once(s,Q.CLI,t,r)}function OR(e,t,n,r,s,i){const o=[];let a=t;const c=a===0,l=r.width??0,u=r.height??0,h=c?Et.BLACK:Et.CLEAR,d=Eg(e,a++,l,u,h);o.push(d);const f=Tg(e,a++,l,u);o.push(f);const m=a++,_=yg(e,m);o.push(_);const w=Sg(e,a++);s&&o.push(w),r.terrain.forEach((y,g)=>{if(y){const p=be(n,y);d.char[g]=y.char??(p==null?void 0:p.char)??0,d.color[g]=y.color??(p==null?void 0:p.color)??h,d.bg[g]=y.bg??(p==null?void 0:p.bg)??h,d.color[g]!==Et.CLEAR&&(i[g]=d.color[g])}});const R=r.objects??{};Object.values(R).forEach(y=>{if(E(y.removed)||E(y.headless))return;const g=y.id??"",p=be(n,y),S=_g(e,m,g),v=y.lx??y.x??0,W=y.ly??y.y??0,lt=v+W*r.width;S.x=y.x??0,S.y=y.y??0,S.char=y.char??(p==null?void 0:p.char)??1,S.color=y.color??(p==null?void 0:p.color)??Et.WHITE,S.bg=y.bg??(p==null?void 0:p.bg)??Et.BORROW,_.sprites.push(S),S.bg===Et.SHADOW&&(S.bg=Et.CLEAR,f.alphas[v+W*l]=.5),S.bg===Et.BORROW&&(S.bg=i[lt]??Et.BLACK),S.color!==Et.CLEAR&&(i[lt]=S.color),g===e&&(w.focusx=S.x,w.focusy=S.y,w.focusid=g)});function A(y,g){if(!(y<0||y>=r.width||g<0||g>=r.height))return f.alphas[y+g*r.width]}const T=[[1,1,1,1,1],[1,3,5,3,1],[1,5,12,5,1],[1,3,5,3,1],[1,1,1,1,1]].flat(),I=new Array(f.alphas.length);for(let y=0;y<f.alphas.length;++y){const g=y%r.width,p=Math.floor(y/r.width),S=[[A(g-2,p-2),A(g-1,p-2),A(g,p-2),A(g+1,p-2),A(g+2,p-2)],[A(g-2,p-1),A(g-1,p-1),A(g,p-1),A(g+1,p-1),A(g+2,p-1)],[A(g-2,p),A(g-1,p),A(g,p),A(g+1,p),A(g+2,p)],[A(g-2,p+1),A(g-1,p+1),A(g,p+1),A(g+1,p+1),A(g+2,p+1)],[A(g-2,p+2),A(g-1,p+2),A(g,p+2),A(g+1,p+2),A(g+2,p+2)]].flat().map((v,W)=>E(v)?v*T[W]:void 0).filter(E);I[y]=An(tm(S),0,1)}return f.alphas=I,o}function Lf(e){switch(e.type){case Xr.EDIT:return 1;case Xr.VIEW:return 2}return 0}function kR(e){const t=Jr(wi),n=Nf(t,e),r=[];if(!E(t)||!E(n))return r;let s=0;const i=[...Ai(n.id??"")],o=new Array(n.width*n.height).fill(0);return i.sort((a,c)=>Lf(a)-Lf(c)),i.forEach(a=>{const c=Jr(a.book??"")??t,l=sr(c,a.board??"")??n;if(E(c)&&E(l)){const u=OR(e,s,c,l,a.type===Xr.VIEW,o);s+=u.length,r.push(...u)}}),r}var Of={exports:{}},$a={exports:{}},kf;function MR(){return kf||(kf=1,function(e,t){(function(n,r){e.exports=r()})(Rs,function(){function n(_){return!isNaN(parseFloat(_))&&isFinite(_)}function r(_){return _.charAt(0).toUpperCase()+_.substring(1)}function s(_){return function(){return this[_]}}var i=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=i.concat(o,a,c,l);function h(_){if(_)for(var w=0;w<u.length;w++)_[u[w]]!==void 0&&this["set"+r(u[w])](_[u[w]])}h.prototype={getArgs:function(){return this.args},setArgs:function(_){if(Object.prototype.toString.call(_)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=_},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(_){if(_ instanceof h)this.evalOrigin=_;else if(_ instanceof Object)this.evalOrigin=new h(_);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var _=this.getFileName()||"",w=this.getLineNumber()||"",R=this.getColumnNumber()||"",A=this.getFunctionName()||"";return this.getIsEval()?_?"[eval] ("+_+":"+w+":"+R+")":"[eval]:"+w+":"+R:A?A+" ("+_+":"+w+":"+R+")":_+":"+w+":"+R}},h.fromString=function(w){var R=w.indexOf("("),A=w.lastIndexOf(")"),T=w.substring(0,R),I=w.substring(R+1,A).split(","),y=w.substring(A+1);if(y.indexOf("@")===0)var g=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(y,""),p=g[1],S=g[2],v=g[3];return new h({functionName:T,args:I||void 0,fileName:p,lineNumber:S||void 0,columnNumber:v||void 0})};for(var d=0;d<i.length;d++)h.prototype["get"+r(i[d])]=s(i[d]),h.prototype["set"+r(i[d])]=function(_){return function(w){this[_]=!!w}}(i[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=s(o[f]),h.prototype["set"+r(o[f])]=function(_){return function(w){if(!n(w))throw new TypeError(_+" must be a Number");this[_]=Number(w)}}(o[f]);for(var m=0;m<a.length;m++)h.prototype["get"+r(a[m])]=s(a[m]),h.prototype["set"+r(a[m])]=function(_){return function(w){this[_]=String(w)}}(a[m]);return h})}($a)),$a.exports}(function(e,t){(function(n,r){e.exports=r(MR())})(Rs,function(r){var s=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(i))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),m=d&&h||void 0,_=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:m,fileName:_,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var m=l.exec(u[d]);m&&h.push(new r({fileName:m[2],lineNumber:m[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var m=l.exec(u[d]);m&&h.push(new r({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",m=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,_;f.match(/\(([^)]*)\)/)&&(_=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var w=_===void 0||_==="[arguments not available]"?void 0:_.split(",");return new r({functionName:m,args:w,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Of);var xR=Of.exports,UR=ao(xR),Mf={},xf={},Uf={};const Pf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Uf.encode=function(e){if(0<=e&&e<Pf.length)return Pf[e];throw new TypeError("Must be between 0 and 63: "+e)};const PR=Uf,Df=5,Ff=1<<Df,DR=Ff-1,FR=Ff;function $R(e){return e<0?(-e<<1)+1:(e<<1)+0}xf.encode=function(t){let n="",r,s=$R(t);do r=s&DR,s>>>=Df,s>0&&(r|=FR),n+=PR.encode(r);while(s>0);return n};var Qr={};(function(e){function t(g,p,S){if(p in g)return g[p];if(arguments.length===3)return S;throw new Error('"'+p+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function s(g){const p=g.match(n);return p?{scheme:p[1],auth:p[2],host:p[3],port:p[4],path:p[5]}:null}e.urlParse=s;function i(g){let p="";return g.scheme&&(p+=g.scheme+":"),p+="//",g.auth&&(p+=g.auth+"@"),g.host&&(p+=g.host),g.port&&(p+=":"+g.port),g.path&&(p+=g.path),p}e.urlGenerate=i;const o=32;function a(g){const p=[];return function(S){for(let W=0;W<p.length;W++)if(p[W].input===S){const lt=p[0];return p[0]=p[W],p[W]=lt,p[0].result}const v=g(S);return p.unshift({input:S,result:v}),p.length>o&&p.pop(),v}}const c=a(function(p){let S=p;const v=s(p);if(v){if(!v.path)return p;S=v.path}const W=e.isAbsolute(S),lt=[];let Rr=0,St=0;for(;;)if(Rr=St,St=S.indexOf("/",Rr),St===-1){lt.push(S.slice(Rr));break}else for(lt.push(S.slice(Rr,St));St<S.length&&S[St]==="/";)St++;let Fe=0;for(St=lt.length-1;St>=0;St--){const ie=lt[St];ie==="."?lt.splice(St,1):ie===".."?Fe++:Fe>0&&(ie===""?(lt.splice(St+1,Fe),Fe=0):(lt.splice(St,2),Fe--))}return S=lt.join("/"),S===""&&(S=W?"/":"."),v?(v.path=S,i(v)):S});e.normalize=c;function l(g,p){g===""&&(g="."),p===""&&(p=".");const S=s(p),v=s(g);if(v&&(g=v.path||"/"),S&&!S.scheme)return v&&(S.scheme=v.scheme),i(S);if(S||p.match(r))return p;if(v&&!v.host&&!v.path)return v.host=p,i(v);const W=p.charAt(0)==="/"?p:c(g.replace(/\/+$/,"")+"/"+p);return v?(v.path=W,i(v)):W}e.join=l,e.isAbsolute=function(g){return g.charAt(0)==="/"||n.test(g)};function u(g,p){g===""&&(g="."),g=g.replace(/\/$/,"");let S=0;for(;p.indexOf(g+"/")!==0;){const v=g.lastIndexOf("/");if(v<0||(g=g.slice(0,v),g.match(/^([^\/]+:\/)?\/*$/)))return p;++S}return Array(S+1).join("../")+p.substr(g.length+1)}e.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(g){return g}function f(g){return _(g)?"$"+g:g}e.toSetString=h?d:f;function m(g){return _(g)?g.slice(1):g}e.fromSetString=h?d:m;function _(g){if(!g)return!1;const p=g.length;if(p<9||g.charCodeAt(p-1)!==95||g.charCodeAt(p-2)!==95||g.charCodeAt(p-3)!==111||g.charCodeAt(p-4)!==116||g.charCodeAt(p-5)!==111||g.charCodeAt(p-6)!==114||g.charCodeAt(p-7)!==112||g.charCodeAt(p-8)!==95||g.charCodeAt(p-9)!==95)return!1;for(let S=p-10;S>=0;S--)if(g.charCodeAt(S)!==36)return!1;return!0}function w(g,p,S){let v=A(g.source,p.source);return v!==0||(v=g.originalLine-p.originalLine,v!==0)||(v=g.originalColumn-p.originalColumn,v!==0||S)||(v=g.generatedColumn-p.generatedColumn,v!==0)||(v=g.generatedLine-p.generatedLine,v!==0)?v:A(g.name,p.name)}e.compareByOriginalPositions=w;function R(g,p,S){let v=g.generatedLine-p.generatedLine;return v!==0||(v=g.generatedColumn-p.generatedColumn,v!==0||S)||(v=A(g.source,p.source),v!==0)||(v=g.originalLine-p.originalLine,v!==0)||(v=g.originalColumn-p.originalColumn,v!==0)?v:A(g.name,p.name)}e.compareByGeneratedPositionsDeflated=R;function A(g,p){return g===p?0:g===null?1:p===null?-1:g>p?1:-1}function T(g,p){let S=g.generatedLine-p.generatedLine;return S!==0||(S=g.generatedColumn-p.generatedColumn,S!==0)||(S=A(g.source,p.source),S!==0)||(S=g.originalLine-p.originalLine,S!==0)||(S=g.originalColumn-p.originalColumn,S!==0)?S:A(g.name,p.name)}e.compareByGeneratedPositionsInflated=T;function I(g){return JSON.parse(g.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=I;function y(g,p,S){if(p=p||"",g&&(g[g.length-1]!=="/"&&p[0]!=="/"&&(g+="/"),p=g+p),S){const v=s(S);if(!v)throw new Error("sourceMapURL could not be parsed");if(v.path){const W=v.path.lastIndexOf("/");W>=0&&(v.path=v.path.substring(0,W+1))}p=l(i(v),p)}return c(p)}e.computeSourceURL=y})(Qr);var Ba={};let BR=class rg{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new rg;for(let s=0,i=t.length;s<i;s++)r.add(t[s],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),s=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,s)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Ba.ArraySet=BR;var $f={};const Bf=Qr;function GR(e,t){const n=e.generatedLine,r=t.generatedLine,s=e.generatedColumn,i=t.generatedColumn;return r>n||r==n&&i>=s||Bf.compareByGeneratedPositionsInflated(e,t)<=0}let jR=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){GR(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(Bf.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};$f.MappingList=jR;const Zr=xf,ut=Qr,Ri=Ba.ArraySet,WR=$f.MappingList;let Gf=class sg{constructor(t){t||(t={}),this._file=ut.getArg(t,"file",null),this._sourceRoot=ut.getArg(t,"sourceRoot",null),this._skipValidation=ut.getArg(t,"skipValidation",!1),this._sources=new Ri,this._names=new Ri,this._mappings=new WR,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new sg({file:t.file,sourceRoot:n});return t.eachMapping(function(s){const i={generated:{line:s.generatedLine,column:s.generatedColumn}};s.source!=null&&(i.source=s.source,n!=null&&(i.source=ut.relative(n,i.source)),i.original={line:s.originalLine,column:s.originalColumn},s.name!=null&&(i.name=s.name)),r.addMapping(i)}),t.sources.forEach(function(s){let i=s;n!==null&&(i=ut.relative(n,s)),r._sources.has(i)||r._sources.add(i);const o=t.sourceContentFor(s);o!=null&&r.setSourceContent(s,o)}),r}addMapping(t){const n=ut.getArg(t,"generated"),r=ut.getArg(t,"original",null);let s=ut.getArg(t,"source",null),i=ut.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,s,i),s!=null&&(s=String(s),this._sources.has(s)||this._sources.add(s)),i!=null&&(i=String(i),this._names.has(i)||this._names.add(i)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:s,name:i})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=ut.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[ut.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[ut.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let s=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);s=t.file}const i=this._sourceRoot;i!=null&&(s=ut.relative(i,s));const o=this._mappings.toArray().length>0?new Ri:this._sources,a=new Ri;this._mappings.unsortedForEach(function(c){if(c.source===s&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=ut.join(r,c.source)),i!=null&&(c.source=ut.relative(i,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=ut.join(r,c)),i!=null&&(c=ut.relative(i,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,s){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!s)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:s}))}}_serializeMappings(){let t=0,n=1,r=0,s=0,i=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,m=d.length;f<m;f++){if(l=d[f],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!ut.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=Zr.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=Zr.encode(h-o),o=h,c+=Zr.encode(l.originalLine-1-s),s=l.originalLine-1,c+=Zr.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Zr.encode(u-i),i=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=ut.relative(n,r));const s=ut.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,s)?this._sourcesContents[s]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};Gf.prototype._version=3,Mf.SourceMapGenerator=Gf;var jf={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,s,i,o,a){const c=Math.floor((r-n)/2)+n,l=o(s,i[c],!0);return l===0?c:l>0?r-c>1?t(c,r,s,i,o,a):a==e.LEAST_UPPER_BOUND?r<i.length?r:-1:c:c-n>1?t(n,c,s,i,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,s,i,o){if(s.length===0)return-1;let a=t(-1,s.length,r,s,i,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&i(s[a],s[a-1],!0)===0;)--a;return a}})(jf);var ts={exports:{}},KR={},HR=Object.freeze({__proto__:null,default:KR}),Wf=ug(HR);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;ts.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},ts.exports.initialize=t=>e=t}else{const e=Wf,t=Wf;ts.exports=function(){return new Promise((r,s)=>{const i=t.join(__dirname,"mappings.wasm");e.readFile(i,null,(o,a)=>{if(o){s(o);return}r(a.buffer)})})},ts.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Kf=ts.exports;const VR=Kf;function zR(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let es=null;var YR=function(){if(es)return es;const t=[];return es=VR().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,s,i,o,a,c,l,u,h,d){const f=new zR;f.generatedLine=r+1,f.generatedColumn=s,i&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),t[t.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,s)=>{t.push(r);try{s()}finally{t.pop()}}})).then(null,n=>{throw es=null,n}),es};const L=Qr,Ga=jf,vi=Ba.ArraySet,qR=Kf,XR=YR,ja=Symbol("smcInternal");class at{constructor(t,n){return t==ja?Promise.resolve(this):QR(t,n)}static initialize(t){qR.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return ZR(t,n)}static async with(t,n,r){const s=await new at(t,n);try{return await r(s)}finally{s.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}at.prototype._version=3,at.GENERATED_ORDER=1,at.ORIGINAL_ORDER=2,at.GREATEST_LOWER_BOUND=1,at.LEAST_UPPER_BOUND=2;class ns extends at{constructor(t,n){return super(ja).then(r=>{let s=t;typeof t=="string"&&(s=L.parseSourceMapInput(t));const i=L.getArg(s,"version");let o=L.getArg(s,"sources");const a=L.getArg(s,"names",[]);let c=L.getArg(s,"sourceRoot",null);const l=L.getArg(s,"sourcesContent",null),u=L.getArg(s,"mappings"),h=L.getArg(s,"file",null);if(i!=r._version)throw new Error("Unsupported version: "+i);return c&&(c=L.normalize(c)),o=o.map(String).map(L.normalize).map(function(d){return c&&L.isAbsolute(c)&&L.isAbsolute(d)?L.relative(c,d):d}),r._names=vi.fromArray(a.map(String),!0),r._sources=vi.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return L.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,XR().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=L.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new ns(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,s=this._wasm.exports.allocate_mappings(r),i=new Uint8Array(this._wasm.exports.memory.buffer,s,r);for(let a=0;a<r;a++)i[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(s);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const s=n||null,i=r||at.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=L.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(s,a)},()=>{switch(i){case at.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case at.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=L.getArg(t,"source");const r=L.getArg(t,"line"),s=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(s<0)throw new Error("Column numbers must be >= 0");const i=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),i.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,s)}),i}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:L.getArg(t,"line"),generatedColumn:L.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=L.getArg(t,"bias",at.GREATEST_LOWER_BOUND);r==null&&(r=at.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(i=>s=i,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),s&&s.generatedLine===n.generatedLine){let i=L.getArg(s,"source",null);i!==null&&(i=this._sources.at(i),i=L.computeSourceURL(this.sourceRoot,i,this._sourceMapURL));let o=L.getArg(s,"name",null);return o!==null&&(o=this._names.at(o)),{source:i,line:L.getArg(s,"originalLine",null),column:L.getArg(s,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let s=t;this.sourceRoot!=null&&(s=L.relative(this.sourceRoot,s));let i;if(this.sourceRoot!=null&&(i=L.urlParse(this.sourceRoot))){const o=s.replace(/^file:\/\//,"");if(i.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!i.path||i.path=="/")&&this._sources.has("/"+s))return this.sourcesContent[this._sources.indexOf("/"+s)]}if(n)return null;throw new Error('"'+s+'" is not in the SourceMap.')}generatedPositionFor(t){let n=L.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:L.getArg(t,"line"),originalColumn:L.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let s=L.getArg(t,"bias",at.GREATEST_LOWER_BOUND);s==null&&(s=at.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(o=>i=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,s)}),i&&i.source===r.source){let o=i.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:L.getArg(i,"generatedLine",null),column:L.getArg(i,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}ns.prototype.consumer=at;class JR extends at{constructor(t,n){return super(ja).then(r=>{let s=t;typeof t=="string"&&(s=L.parseSourceMapInput(t));const i=L.getArg(s,"version"),o=L.getArg(s,"sections");if(i!=r._version)throw new Error("Unsupported version: "+i);r._sources=new vi,r._names=new vi,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=L.getArg(c,"offset"),u=L.getArg(l,"line"),h=L.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new at(L.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(L.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(L.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:L.getArg(t,"line"),generatedColumn:L.getArg(t,"column")},r=Ga.search(n,this._sections,function(i,o){const a=i.generatedLine-o.generatedOffset.generatedLine;return a||i.generatedColumn-o.generatedOffset.generatedColumn}),s=this._sections[r];return s?s.consumer.originalPositionFor({line:n.generatedLine-(s.generatedOffset.generatedLine-1),column:n.generatedColumn-(s.generatedOffset.generatedLine===n.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const i=this._sections[r].consumer.sourceContentFor(t,!0);if(i)return i}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(L.getArg(t,"source"))===-1)continue;const s=r.consumer.generatedPositionFor(t);if(s)return{line:s.line+(r.generatedOffset.generatedLine-1),column:s.column+(r.generatedOffset.generatedLine===s.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],s=this.__originalMappingsUnsorted=[];for(let i=0;i<this._sections.length;i++){const o=this._sections[i],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=L.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&s.push(d)}}}eachMapping(t,n,r){const s=n||null,i=r||at.GENERATED_ORDER;let o;switch(i){case at.GENERATED_ORDER:o=this._generatedMappings;break;case at.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=L.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,s)}_findMapping(t,n,r,s,i,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[s]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[s]);return Ga.search(t,n,i,o)}allGeneratedPositionsFor(t){const n=L.getArg(t,"line"),r={source:L.getArg(t,"source"),originalLine:n,originalColumn:L.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const s=[];let i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",L.compareByOriginalPositions,Ga.LEAST_UPPER_BOUND);if(i>=0){let o=this._originalMappings[i];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:L.getArg(o,"generatedLine",null),column:L.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:L.getArg(o,"generatedLine",null),column:L.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}}return s}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function QR(e,t){let n=e;typeof e=="string"&&(n=L.parseSourceMapInput(e));const r=n.sections!=null?new JR(n,t):new ns(n,t);return Promise.resolve(r)}function ZR(e,t){return ns.fromSourceMap(e,t)}var Hf={};const tv=Mf.SourceMapGenerator,Ni=Qr,ev=/(\r?\n)/,nv=10,or="$$$isSourceNode$$$";let rv=class Yc{constructor(t,n,r,s,i){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=i??null,this[or]=!0,s!=null&&this.add(s)}static fromStringWithSourceMap(t,n,r){const s=new Yc,i=t.split(ev);let o=0;const a=function(){const f=_(),m=_()||"";return f+m;function _(){return o<i.length?i[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=i[o]||"";const m=h.substr(0,f.generatedColumn-l);i[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,m),u=f;return}for(;c<f.generatedLine;)s.add(a()),c++;l<f.generatedColumn&&(h=i[o]||"",s.add(h.substr(0,f.generatedColumn)),i[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<i.length&&(u&&d(u,a()),s.add(i.splice(o).join(""))),n.sources.forEach(function(f){const m=n.sourceContentFor(f);m!=null&&(r!=null&&(f=Ni.join(r,f)),s.setSourceContent(f,m))}),s;function d(f,m){if(f===null||f.source===void 0)s.add(m);else{const _=r?Ni.join(r,f.source):f.source;s.add(new Yc(f.originalLine,f.originalColumn,_,m,f.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[or]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[or]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,s=this.children.length;r<s;r++)n=this.children[r],n[or]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const s=this.children.length;if(s>0){for(n=[],r=0;r<s-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[or]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Ni.toSetString(t)]=n}walkSourceContents(t){for(let r=0,s=this.children.length;r<s;r++)this.children[r][or]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,s=n.length;r<s;r++)t(Ni.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new tv(t);let s=!1,i=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((i!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),i=u.source,o=u.line,a=u.column,c=u.name,s=!0):s&&(r.addMapping({generated:{line:n.line,column:n.column}}),i=null,s=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===nv?(n.line++,n.column=0,h+1===d?(i=null,s=!1):s&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};Hf.SourceNode=rv;var sv=Hf.SourceNode,Vf={exports:{}},B={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rs=Symbol.for("react.element"),iv=Symbol.for("react.portal"),ov=Symbol.for("react.fragment"),av=Symbol.for("react.strict_mode"),cv=Symbol.for("react.profiler"),lv=Symbol.for("react.provider"),uv=Symbol.for("react.context"),hv=Symbol.for("react.forward_ref"),fv=Symbol.for("react.suspense"),dv=Symbol.for("react.memo"),pv=Symbol.for("react.lazy"),zf=Symbol.iterator;function gv(e){return e===null||typeof e!="object"?null:(e=zf&&e[zf]||e["@@iterator"],typeof e=="function"?e:null)}var Yf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qf=Object.assign,Xf={};function ar(e,t,n){this.props=e,this.context=t,this.refs=Xf,this.updater=n||Yf}ar.prototype.isReactComponent={},ar.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},ar.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Jf(){}Jf.prototype=ar.prototype;function Wa(e,t,n){this.props=e,this.context=t,this.refs=Xf,this.updater=n||Yf}var Ka=Wa.prototype=new Jf;Ka.constructor=Wa,qf(Ka,ar.prototype),Ka.isPureReactComponent=!0;var Qf=Array.isArray,Zf=Object.prototype.hasOwnProperty,Ha={current:null},td={key:!0,ref:!0,__self:!0,__source:!0};function ed(e,t,n){var r,s={},i=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)Zf.call(t,r)&&!td.hasOwnProperty(r)&&(s[r]=t[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];s.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:rs,type:e,key:i,ref:o,props:s,_owner:Ha.current}}function mv(e,t){return{$$typeof:rs,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Va(e){return typeof e=="object"&&e!==null&&e.$$typeof===rs}function Ev(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var nd=/\/+/g;function za(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Ev(""+e.key):t.toString(36)}function Ii(e,t,n,r,s){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case rs:case iv:o=!0}}if(o)return o=e,s=s(o),e=r===""?"."+za(o,0):r,Qf(s)?(n="",e!=null&&(n=e.replace(nd,"$&/")+"/"),Ii(s,t,n,"",function(l){return l})):s!=null&&(Va(s)&&(s=mv(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(nd,"$&/")+"/")+e)),t.push(s)),1;if(o=0,r=r===""?".":r+":",Qf(e))for(var a=0;a<e.length;a++){i=e[a];var c=r+za(i,a);o+=Ii(i,t,n,c,s)}else if(c=gv(e),typeof c=="function")for(e=c.call(e),a=0;!(i=e.next()).done;)i=i.value,c=r+za(i,a++),o+=Ii(i,t,n,c,s);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Ci(e,t,n){if(e==null)return e;var r=[],s=0;return Ii(e,r,"","",function(i){return t.call(n,i,s++)}),r}function _v(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var xt={current:null},bi={transition:null},yv={ReactCurrentDispatcher:xt,ReactCurrentBatchConfig:bi,ReactCurrentOwner:Ha};function rd(){throw Error("act(...) is not supported in production builds of React.")}B.Children={map:Ci,forEach:function(e,t,n){Ci(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ci(e,function(){t++}),t},toArray:function(e){return Ci(e,function(t){return t})||[]},only:function(e){if(!Va(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},B.Component=ar,B.Fragment=ov,B.Profiler=cv,B.PureComponent=Wa,B.StrictMode=av,B.Suspense=fv,B.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yv,B.act=rd,B.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=qf({},e.props),s=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=Ha.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)Zf.call(t,c)&&!td.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:rs,type:e.type,key:s,ref:i,props:r,_owner:o}},B.createContext=function(e){return e={$$typeof:uv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:lv,_context:e},e.Consumer=e},B.createElement=ed,B.createFactory=function(e){var t=ed.bind(null,e);return t.type=e,t},B.createRef=function(){return{current:null}},B.forwardRef=function(e){return{$$typeof:hv,render:e}},B.isValidElement=Va,B.lazy=function(e){return{$$typeof:pv,_payload:{_status:-1,_result:e},_init:_v}},B.memo=function(e,t){return{$$typeof:dv,type:e,compare:t===void 0?null:t}},B.startTransition=function(e){var t=bi.transition;bi.transition={};try{e()}finally{bi.transition=t}},B.unstable_act=rd,B.useCallback=function(e,t){return xt.current.useCallback(e,t)},B.useContext=function(e){return xt.current.useContext(e)},B.useDebugValue=function(){},B.useDeferredValue=function(e){return xt.current.useDeferredValue(e)},B.useEffect=function(e,t){return xt.current.useEffect(e,t)},B.useId=function(){return xt.current.useId()},B.useImperativeHandle=function(e,t,n){return xt.current.useImperativeHandle(e,t,n)},B.useInsertionEffect=function(e,t){return xt.current.useInsertionEffect(e,t)},B.useLayoutEffect=function(e,t){return xt.current.useLayoutEffect(e,t)},B.useMemo=function(e,t){return xt.current.useMemo(e,t)},B.useReducer=function(e,t,n){return xt.current.useReducer(e,t,n)},B.useRef=function(e){return xt.current.useRef(e)},B.useState=function(e){return xt.current.useState(e)},B.useSyncExternalStore=function(e,t,n){return xt.current.useSyncExternalStore(e,t,n)},B.useTransition=function(){return xt.current.useTransition()},B.version="18.3.1",Vf.exports=B;var Tv=Vf.exports;const Sv=yo(32,126).map(e=>String.fromCharCode(e)),Av=U({name:"Whitespace",pattern:/ +/}),wv=U({name:"WhitespaceSkipped",pattern:/ +/,group:_t.SKIPPED}),sd=U({name:"StringLiteral",pattern:/[^ $]+/,start_chars_hint:Sv}),id=U({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Ya=U({name:"MaybeFlag",pattern:/\$[^ $]+/}),od=U({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),ad=U({name:"ContinueLine",pattern:/\\/});function cd(e,t=""){return U({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const ld=[["blue"],["green"],["cyan"],["red"],["purple"],["yellow"],["white"],["dkblue"],["dkgreen"],["dkcyan"],["dkred"],["dkpurple"],["dkyellow|brown","brown"],["dkwhite|ltgray|ltgrey|gray|grey","gray"],["dkgray|dkgrey|ltblack","dkgray"],["black"],["clear"]],ud=ld.map(([e,t])=>cd(`\\$(${e})`,t||e)),hd=[...ld.map(([e,t])=>cd(`\\$on(${e})`,`on${t||e}`))],Rv=[Av,ad,...ud,...hd,id,sd,od,Ya],vv=new _t(Rv,{skipValidations:!Ce,ensureOptimizations:Ce}),Nv=new _t([wv,ad,...ud,...hd,id,sd,od,Ya],{skipValidations:!Ce,ensureOptimizations:Ce});function Iv(e,t=!1){return t?Nv.tokenize(e):vv.tokenize(e)}function Cv(e,t,n,r){return{measureonly:!1,resetCheck:!0,x:0,y:0,isEven:!0,resetColor:n,resetBg:r,activeColor:n,activeBg:r,width:e,height:t,leftEdge:void 0,rightEdge:void 0,bottomEdge:void 0,char:[],color:[],bg:[]}}Tv.createContext(Cv(1,1,15,1));let bv=0,fd=0;const dd=Ce,Lv=["Command","lines"];class Ov extends nR{constructor(){super(Af,{traceInitPerf:Ce,skipValidations:!Ce,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});P(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));P(this,"line",this.RULED("line",()=>{this.OPTION(()=>this.SUBRULE(this.stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(Yr))}));P(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stat)},{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.label)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));P(this,"stat",this.RULED("stat",()=>{this.CONSUME(Sa)}));P(this,"text",this.RULED("text",()=>{this.CONSUME(Hh)}));P(this,"label",this.RULED("label",()=>{this.CONSUME(zh)}));P(this,"comment",this.RULED("comment",()=>{this.CONSUME(Vh)}));P(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>{this.CONSUME(pe),this.AT_LEAST_ONE1(()=>this.SUBRULE1(this.command))}},{ALT:()=>{this.AT_LEAST_ONE2(()=>this.SUBRULE2(this.command))}}])}));P(this,"command",this.RULED("command",()=>{this.OR([{ALT:()=>this.SUBRULE(this.flat_cmd)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));P(this,"flat_cmd",this.RULED("flat_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.hyperlink)},{ALT:()=>this.SUBRULE(this.Short_go)},{ALT:()=>this.SUBRULE(this.Short_try)},{ALT:()=>this.SUBRULE(this.Command_play)}])}));P(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.Command_if)},{ALT:()=>this.SUBRULE(this.Command_read)},{ALT:()=>this.SUBRULE(this.Command_while)},{ALT:()=>this.SUBRULE(this.Command_repeat)},{ALT:()=>this.SUBRULE(this.Command_break)},{ALT:()=>this.SUBRULE(this.Command_continue)}])}));P(this,"hyperlink",this.RULED("hyperlink",()=>{this.CONSUME(Yh),this.SUBRULE(this.words),this.CONSUME(qh)}));P(this,"Short_go",this.RULED("Short_go",()=>{this.CONSUME(Ia),this.SUBRULE(this.words)}));P(this,"Short_try",this.RULED("Short_try",()=>{this.CONSUME(lf),this.SUBRULE(this.words)}));P(this,"Command_play",this.RULED("Command_play",()=>{this.CONSUME(ff)}));P(this,"do_line",this.RULED("do_line",()=>{this.OPTION(()=>this.SUBRULE(this.do_stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(Yr))}));P(this,"do_stmt",this.RULED("do_stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));P(this,"Command_if",this.RULED("Command_if",()=>{this.CONSUME(Ca),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));P(this,"Command_else_if",this.RULED("Command_else_if",()=>{this.CONSUME(pe),this.CONSUME(ba),this.CONSUME(Ca),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));P(this,"Command_else",this.RULED("Command_else",()=>{this.CONSUME(pe),this.CONSUME(ba),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.SUBRULE(this.Command_endif)}}])})}));P(this,"Command_endif",this.RULED("Command_endif",()=>{this.CONSUME(pe),this.CONSUME(df)}));P(this,"Command_while",this.RULED("Command_while",()=>{this.CONSUME(pe),this.CONSUME(pf),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(pe),this.CONSUME4(gf)}}])})}));P(this,"Command_repeat",this.RULED("Command_repeat",()=>{this.CONSUME(pe),this.CONSUME(mf),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(pe),this.CONSUME4(Ef)}}])})}));P(this,"Command_read",this.RULED("Command_read",()=>{this.CONSUME(pe),this.CONSUME(La),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(pe),this.CONSUME4(_f)}}])})}));P(this,"Command_break",this.RULED("Command_break",()=>{this.CONSUME(yf)}));P(this,"Command_continue",this.RULED("Command_continue",()=>{this.CONSUME(Tf)}));P(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Aa),this.SUBRULE2(this.and_test)})}));P(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Ra),this.SUBRULE2(this.not_test)})}));P(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(wa),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));P(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));P(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Qh)},{ALT:()=>this.CONSUME(Zh)},{ALT:()=>this.CONSUME(tf)},{ALT:()=>this.CONSUME(ef)},{ALT:()=>this.CONSUME(nf)},{ALT:()=>this.CONSUME(rf)}])}));P(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Aa),this.SUBRULE2(this.and_test_value)})}));P(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Ra),this.SUBRULE2(this.not_test_value)})}));P(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(wa),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));P(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));P(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(va)},{ALT:()=>this.CONSUME(Na)}]),this.SUBRULE(this.term)}));P(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));P(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(of)},{ALT:()=>this.CONSUME(Ia)},{ALT:()=>this.CONSUME(af)},{ALT:()=>this.CONSUME(cf)}]),this.SUBRULE(this.factor)}));P(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(va)},{ALT:()=>this.CONSUME(Na)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));P(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(sf),this.SUBRULE(this.factor)})}));P(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));P(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Xh)},{ALT:()=>this.CONSUME(Wt)},{ALT:()=>this.CONSUME(Jh)},{ALT:()=>this.CONSUME(La)},{ALT:()=>{this.CONSUME(uf),this.SUBRULE(this.expr),this.CONSUME(hf)}}])}));this.performSelfAnalysis()}PEEK(n,r,...s){console.info(n,s.map(i=>[i.image,i.tokenType]),r)}RULED(n,r,s){const i=Lv.some(o=>n.includes(o));return this.RULE(n,()=>{const o=bv++,a=fd++,c=a.toString().padStart(3),l=" ".repeat(a),u=i?"font-weight: bold;":"";if(dd&&!this.RECORDING_PHASE){const d=[this.LA(0),this.LA(1),this.LA(2)].map(f=>[`[${f.tokenType.name}]`,f.image.replaceAll(`
`,"\\n")]).flat();console.info(`${c}%c${l}> ${n} ${o} ${d.join(" ")}`,u)}r(),dd&&!this.RECORDING_PHASE&&console.info(`${c}%c${l}< ${n} ${o}`,u),fd--},s)}}const ss=new Ov,kv=ss.getBaseCstVisitorConstructor();var Y=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.TEXT=1]="TEXT",e[e.LABEL=2]="LABEL",e[e.HYPERLINK=3]="HYPERLINK",e[e.STAT=4]="STAT",e[e.MOVE=5]="MOVE",e[e.COMMAND=6]="COMMAND",e[e.LITERAL=7]="LITERAL",e[e.IF=8]="IF",e[e.ELSE_IF=9]="ELSE_IF",e[e.ELSE=10]="ELSE",e[e.WHILE=11]="WHILE",e[e.BREAK=12]="BREAK",e[e.CONTINUE=13]="CONTINUE",e[e.REPEAT=14]="REPEAT",e[e.READ=15]="READ",e[e.OR=16]="OR",e[e.AND=17]="AND",e[e.NOT=18]="NOT",e[e.COMPARE=19]="COMPARE",e[e.OPERATOR=20]="OPERATOR",e[e.OPERATOR_ITEM=21]="OPERATOR_ITEM",e[e.EXPR=22]="EXPR",e))(Y||{}),xn=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(xn||{}),Le=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(Le||{}),Li=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Li||{});function cC(e){return e}function tt(e,t){return((t==null?void 0:t.map(n=>e.visit(n)).filter(n=>n))||[]).flat()}function qe(e){return e.image}function pd(e,t){return $(e,{type:7,literal:1,value:t})}function Mv(e){return!!(e!=null&&e.tokenType)}function xv(e){const t=Object.values(e).flat().filter(n=>!!n).map(n=>n&&Mv(n)?{startLine:n.startLine,startColumn:n.startColumn,startOffset:n.startOffset,endLine:n.endLine,endColumn:n.endColumn,endOffset:n.endOffset}:n!=null&&n.location?{...n.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(n=>n.startLine!==0&&n.endLine!==0);return{startLine:Math.min(...t.map(n=>n.startLine||1)),startColumn:Math.min(...t.map(n=>n.startColumn||1)),startOffset:Math.min(...t.map(n=>n.startOffset||1)),endLine:Math.max(...t.map(n=>n.endLine||1)),endColumn:Math.max(...t.map(n=>n.endColumn||1)),endOffset:Math.max(...t.map(n=>n.endOffset||1))}}function $(e,t){return{...t,...xv(e)}}class Uv extends kv{constructor(){super(),Ce&&this.validateVisitor()}program(t){return $(t,{type:0,lines:tt(this,t.line)})}line(t){if(t.stmt)return this.visit(t.stmt)}stmt(t){if(t.stat)return this.visit(t.stat);if(t.text)return this.visit(t.text);if(t.label)return this.visit(t.label);if(t.comment)return this.visit(t.comment);if(t.commands)return this.visit(t.commands)}stat(){}text(t){if(t.Text)return $(t,{type:1,value:qe(t.Text[0])})}label(t){var n;return $(t,{type:2,active:!0,name:qe(((n=t.Label)==null?void 0:n[0])??":").slice(1).trim()})}comment(t){return $(t,{type:2,active:!1,name:qe(t.Comment[0]).slice(1).trim()})}commands(t){return tt(this,t.command)}command(t){if(t.flat_cmd)return this.visit(t.flat_cmd);if(t.structured_cmd)return this.visit(t.structured_cmd)}flat_cmd(t){if(t.words)return $(t,{type:6,words:tt(this,t.words).flat()});if(t.hyperlink)return this.visit(t.hyperlink);if(t.Short_go)return this.visit(t.Short_go);if(t.Short_try)return this.visit(t.Short_try);if(t.Command_play)return this.visit(t.Command_play)}structured_cmd(t){if(t.Command_if)return this.visit(t.Command_if);if(t.Command_read)return this.visit(t.Command_read);if(t.Command_while)return this.visit(t.Command_while);if(t.Command_repeat)return this.visit(t.Command_repeat);if(t.Command_break)return this.visit(t.Command_break);if(t.Command_continue)return this.visit(t.Command_continue)}hyperlink(t){var n;return $(t,{type:3,link:tt(this,t.words).flat(),text:qe(((n=t.HyperLinkText)==null?void 0:n[0])??";").slice(1)})}Short_go(t){if(t.Divide)return $(t,{type:5,wait:!0,words:tt(this,t.words).flat()})}Short_try(t){if(t.Query)return $(t,{type:5,wait:!1,words:tt(this,t.words).flat()})}Command_play(t){if(t.play)return $(t,{type:6,words:[pd(t,"play"),pd(t,qe(t.play[0]).replace("play","").trim())]})}do_line(t){return this.visit(t.do_stmt)}do_stmt(t){if(t.text)return this.visit(t.text);if(t.comment)return this.visit(t.comment);if(t.commands)return this.visit(t.commands)}Command_if(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat(),s=[this.visit(t.Command_else_if),this.visit(t.Command_else)].flat();return $(t,{type:8,method:"if",words:n.filter(E),lines:r.filter(E),branches:s.filter(E)})}Command_else_if(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat(),s=tt(this,t.Command_else_if).flat();return[$(t,{type:9,method:"if",words:n.filter(E),lines:r.filter(E)}),...s.filter(E),this.visit(t.Command_else)]}Command_else(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat();return $(t,{type:10,method:"if",words:n.filter(E),lines:r.filter(E)})}Command_endif(){}Command_while(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat();return $(t,{type:11,words:n.filter(E),lines:r.filter(E)})}Command_repeat(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat();return $(t,{type:14,words:n.filter(E),lines:r.filter(E)})}Command_read(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat();return $(t,{type:15,words:n.filter(E),lines:r.filter(E)})}Command_break(t){return $(t,{type:12})}Command_continue(t){return $(t,{type:13})}expr(t){return t.and_test.length===1?this.visit(t.and_test):$(t,{type:16,items:this.visit(t.and_test)})}and_test(t){return t.not_test.length===1?this.visit(t.not_test):$(t,{type:17,items:this.visit(t.not_test)})}not_test(t){if(t.comparison)return this.visit(t.comparison);if(t.not_test)return $(t,{type:18,items:this.visit(t.not_test)})}comparison(t){return t.arith_expr.length===1?this.visit(t.arith_expr):$(t,{type:19,lhs:this.visit(t.arith_expr[0]),compare:this.visit(t.comp_op),rhs:this.visit(t.arith_expr[1])})}comp_op(t){if(t.is||t.IsEq)return 0;if(t.IsNotEq)return 1;if(t.IsLessThan)return 2;if(t.IsGreaterThan)return 3;if(t.IsLessThanOrEqual)return 4;if(t.IsGreaterThanOrEqual)return 5}expr_value(t){return t.and_test_value.length===1?this.visit(t.and_test_value):$(t,{type:16,items:this.visit(t.and_test_value)})}and_test_value(t){return t.not_test_value.length===1?this.visit(t.not_test_value):$(t,{type:17,items:this.visit(t.not_test_value)})}not_test_value(t){if(t.arith_expr)return this.visit(t.arith_expr);if(t.not_test)return $(t,{type:18,items:this.visit(t.not_test)})}arith_expr(t){const n=this.visit(t.term);return t.arith_expr_item?$(t,{type:20,lhs:n,items:tt(this,t.arith_expr_item)}):n}arith_expr_item(t){return $(t,{type:21,operator:t.Plus?1:2,rhs:this.visit(t.term)})}term(t){return t.term_item?$(t,{type:20,lhs:this.visit(t.factor),items:tt(this,t.term_item)}):this.visit(t.factor)}term_item(t){let n=0;return t.Multiply&&(n=4),t.Divide&&(n=5),t.ModDivide&&(n=6),t.FloorDivide&&(n=7),$(t,{type:21,operator:n,rhs:this.visit(t.factor)})}factor(t){if(t.power)return this.visit(t.power);let n=0;return t.Plus&&(n=8),t.Minus&&(n=9),$(t,{type:20,lhs:void 0,items:[$(t,{type:21,operator:n,rhs:this.visit(t.factor)})]})}power(t){const n=this.visit(t.token);return t.factor?$(t,{type:20,lhs:n,items:[$(t,{type:21,operator:3,rhs:this.visit(t.factor)})]}):n}words(t){return tt(this,t.expr)}token(t){if(t.StringLiteralDouble){const n=qe(t.StringLiteralDouble[0]);return $(t,{type:7,literal:2,value:n.substring(1,n.length-1)})}if(t.StringLiteral)return $(t,{type:7,literal:1,value:qe(t.StringLiteral[0])});if(t.NumberLiteral)return $(t,{type:7,literal:0,value:parseFloat(qe(t.NumberLiteral[0]))});if(t.read)return $(t,{type:7,literal:1,value:qe(t.read[0])});if(t.LParen)return $(t,{type:22,words:tt(this,t.expr).flat()})}}const Pv=new Uv,$t={internal:0,labels:{},labelIndex:0},is="if (api.hm()) { continue zss; }",qa=`if (api.sy()) { yield 1; ${is} };`,Oi=`yield 1; ${is}`,ki="zss.js";function ct(e,t){return new sv(e.startLine||1,e.startColumn||1,ki,t)}function Xa(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Dv(e){return`'${Xa(e)}'`}function Mi(e){if(e.startsWith('"'))return Mi(e.substring(1,e.length-1));const t=Iv(e);return t.errors.length?e:`'${t.tokens.map(r=>r.tokenType===Ya?`', api.group('${Xa(r.image.substring(1))}'), '`:Xa(r.image)).join("")}'`}function Oe(e){return e.filter(t=>t!==void 0).map(H)}function gd(e){return ct(e,"")}function Fv(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function et(e,t,n){return ct(e,[`api.${t}(`,...Fv(n,", "),")"])}function $v(e){if(e.type===Y.COMPARE)switch(e.compare){case xn.IS_EQ:return et(e,"isEq",[H(e.lhs),H(e.rhs)]);case xn.IS_NOT_EQ:return et(e,"isNotEq",[H(e.lhs),H(e.rhs)]);case xn.IS_LESS_THAN:return et(e,"isLessThan",[H(e.lhs),H(e.rhs)]);case xn.IS_GREATER_THAN:return et(e,"isGreaterThan",[H(e.lhs),H(e.rhs)]);case xn.IS_LESS_THAN_OR_EQ:return et(e,"isLessThanOrEq",[H(e.lhs),H(e.rhs)]);case xn.IS_GREATER_THAN_OR_EQ:return et(e,"isGreaterThanOrEq",[H(e.lhs),H(e.rhs)])}return ct(e,"")}function Un(e,t,n,r){return t.prepend(`api.${n}(`),t.add([", ",H(r),")"])}function md(e,t,n,r){return t.prepend(`api.${n}(`),t.add([H(r),")"])}function Bv(e,t){if(e.type===Y.OPERATOR_ITEM)switch(e.operator){case Le.PLUS:return Un(e,t,"opPlus",e.rhs);case Le.MINUS:return Un(e,t,"opMinus",e.rhs);case Le.POWER:return Un(e,t,"opPower",e.rhs);case Le.MULTIPLY:return Un(e,t,"opMultiply",e.rhs);case Le.DIVIDE:return Un(e,t,"opDivide",e.rhs);case Le.MOD_DIVIDE:return Un(e,t,"opModDivide",e.rhs);case Le.FLOOR_DIVIDE:return Un(e,t,"opFloorDivide",e.rhs);case Le.UNI_PLUS:return md(e,t,"opUniPlus",e.rhs);case Le.UNI_MINUS:return md(e,t,"opUniMinus",e.rhs)}return ct(e,"")}function Gv(e){if(e.type===Y.OPERATOR){const t=e.lhs?H(e.lhs):ct(e,"");return e.items.forEach(n=>Bv(n,t)),t}return ct(e,"")}function H(e){switch(e.type){case Y.PROGRAM:return ct(e,[`try { // first-line
`,`zss: while (true) {
`,`switch (api.getcase()) {
`,`default:
`,`case 1: 
`,...e.lines.map(t=>[H(t),`
`]).flat(),`}
`,`api.endofprogram();
`,`while(true) { ${Oi} }
`,`}
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${ki}`]);case Y.LITERAL:switch(e.literal){case Li.NUMBER:return ct(e,`${e.value}`);case Li.STRING:return ct(e,Dv(e.value));case Li.TEMPLATE:return ct(e,Mi(e.value))}return gd(e);case Y.TEXT:return et(e,"text",[Mi(e.value)]);case Y.STAT:return et(e,"stat",Oe(e.words));case Y.LABEL:{const t=$t.labelIndex++;return $t.labels[e.name]||($t.labels[e.name]=[]),$t.labels[e.name].push(e.active?t:-t),ct(e,`case ${t}: // ${e.name}`)}case Y.HYPERLINK:return et(e,"hyperlink",[Mi(e.text),...Oe(e.link)]);case Y.MOVE:return ct(e,["while (",et(e,"move",[e.wait?"true":"false",...Oe(e.words)]),`) { ${Oi} };
         ${qa} ${is}`]);case Y.COMMAND:return ct(e,["while (",et(e,"command",Oe(e.words)),`) { ${Oi} };
         ${qa} ${is}`]);case Y.IF:{const t=ct(e,["if (",et(e,`${e.method}`,Oe(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),e.branches&&e.branches.forEach(n=>t.add(H(n))),t.add("}"),t}case Y.ELSE_IF:{const t=ct(e,["} else if (",et(e,e.method,Oe(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t}case Y.ELSE:{const t=ct(e,`} else {
`);return e.words.length&&t.add(["while (",et(e,"command",Oe(e.words)),`) { ${Oi} };`]),e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t}case Y.WHILE:{const t=ct(e,["while (",et(e,"if",Oe(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t.add("}"),t}case Y.REPEAT:{const t=ct(e,[et(e,"repeatstart",[`${$t.internal}`,...Oe(e.words)]),`;
while (`,et(e,"repeat",[`${$t.internal}`]),`) {
         ${qa} ${is}
`]);return $t.internal+=1,e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t.add("}"),t}case Y.READ:{const[t,...n]=e.words,r=ct(e,[et(e,"readStart",[`${$t.internal}`,H(t)]),`;
while (`,et(e,"read",[`${$t.internal}`,...Oe(n)]),`) {
`]);return $t.internal+=1,e.lines&&e.lines.forEach(s=>r.add([H(s),`
`])),r.add("}"),r}case Y.BREAK:return ct(e,`break;
`);case Y.CONTINUE:return ct(e,`continue;
`);case Y.OR:return et(e,"or",e.items.map(H));case Y.AND:return et(e,"and",e.items.map(H));case Y.NOT:return et(e,"not",e.items.map(H));case Y.COMPARE:return $v(e);case Y.OPERATOR:return Gv(e);case Y.EXPR:return et(e,"expr",e.words.map(H));default:return console.error("<unsupported node>",e),gd(e)}}function jv(e){return $t.internal=0,$t.labels={restart:[1]},$t.labelIndex=2,{...H(e).toStringWithSourceMap({file:`${ki}.map`}),...$t}}const Wv=64;function Kv(e){return Array.isArray(e)?e.length>0?1:0:e??0}function ne(e){return`${e??""}`}function Hv(e,t){var I;const n=Jg(t.labels??{});let r,s="",i,o=0;const a={},c={},l={};let u=!1,h=pm,d=0,f=0,m=!1;const _=[];let w={};function R(y){if(w[y]===void 0)for(let g=0;g<_.length;++g){const p=_[g].getcommand(y);p&&(w[y]=p)}return w[y]}function A(y,g){const p=R(y);if(!p)throw new Error(`unknown firmware command ${y}`);return p(T,g)}const T={id(){return e},senderid(y=T.id()){return`vm${y??T.id()}`},install(y){E(y)&&(w={},_.push(y))},set(y,g){const p=y.toLowerCase();for(let S=0;S<_.length;++S){const[v]=_[S].set(T,p,g);if(v)return g}return g},get(y){const g=y.toLowerCase();for(let p=0;p<_.length;++p){const[S,v]=_[p].get(T,g);if(S)return v}},cycle(y){h=y},timestamp(){return f},tick(y){f=y;for(let p=0;p<_.length;++p)_[p].shouldtick(T);if(!T.shouldtick())return!1;const g=d%h===0;if(++d,!g)return!1;o=0,u=!1;for(let p=0;p<_.length;++p)_[p].tick(T);try{const p=r==null?void 0:r.next();p!=null&&p.done&&(console.error("we crashed?",t.source),m=!0)}catch(p){console.error("we crashed?",p),m=!0}for(let p=0;p<_.length;++p)_[p].tock(T);return!0},shouldtick(){return m===!1||T.hm()!==0},shouldhalt(){return o++>Wv},hm(){var g;const y=(i==null?void 0:i.target)??"";return((g=n[y])==null?void 0:g.find(p=>p>0))??0},yield(){u=!0},sy(){return u||T.shouldhalt()},emit(y,g){nt.emit(y,T.senderid(),g)},send(y,g,p){nt.emit(`${T.senderid(y)}:${g}`,e,p)},lock(y){s=y},unlock(){s=""},message(y){switch(y.target){case"urlstate":{const[g,p]=y.data;T.set(g,p);break}default:if(s&&y.sender!==s)return;i=y;break}},zap(y){const g=n[y];if(g){const p=g.findIndex(S=>S>0);p>=0&&(g[p]*=-1)}},restore(y){const g=n[y];if(g)for(let p=0;p<g.length;p++)g[p]=Math.abs(g[p])},getcase(){if(i){const y=T.hm();return T.set("sender",i.sender),T.set("data",i.data),i.player&&T.set("player",i.player),i=void 0,u=!1,m=!1,y}return 0},endofprogram(){T.yield(),m=!0},stacktrace(y){const g=UR.parse(y),[p]=g.filter(S=>S.fileName===ki);return{line:(p==null?void 0:p.lineNumber)??0,column:(p==null?void 0:p.columnNumber)??0}},text(y){return A("text",[y])},stat(...y){return A("stat",y)},hyperlink(...y){return A("hyperlink",y)},move(y,...g){const p=T.command("go",...g);return T.yield(),p&&y?1:0},command(...y){if(y.length===0)return 0;const[g,...p]=y,S=R(ne(g));return S?S(T,p):A("send",[g,...p])},if(...y){const[g,p]=C(O(T,y),0,[N.ANY]),S=Kv(g);return S&&p<y.length&&T.command(...y.slice(p)),S},repeatstart(y,...g){const[p,S]=C(O(T,g),0,[N.NUMBER]);a[y]=p,c[y]=S<g.length?g.slice(S):void 0},repeat(y){const g=a[y]??0;a[y]=g-1;const p=g>0,S=c[y];return p&&S&&T.command(...S),p},readstart(y,g){if(!st(g))return;const p=T.get(g)??[];l[y]=Array.isArray(p)?p:[p]},read(y,...g){const p=l[y];if(Array.isArray(p)===!1)return!1;const S=p.shift();if(S===void 0)return!1;const v=g.map(ne);switch(typeof S){case"number":case"string":v.forEach(W=>{T.set(W,S)});break;case"object":v.forEach(W=>{const lt=S[W];T.set(W,lt)});break}return!0},or(...y){let g=0;for(let p=0;p<y.length;){const[S,v]=C(O(T,y),0,[N.ANY]);if(g=S,g)break;p=v}return g},and(...y){let g=0;for(let p=0;p<y.length;){const[S,v]=C(O(T,y),0,[N.ANY]);if(g=S,!g)break;p=v}return g},not(...y){const[g]=C(O(T,y),0,[N.ANY]);return g?0:1},expr(...y){const[g]=C(O(T,y),0,[N.ANY]);return g},isEq(y,g){const[p]=C(O(T,[y]),0,[N.ANY]),[S]=C(O(T,[g]),0,[N.ANY]);return Xg(p,S)?1:0},isNotEq(y,g){const[p]=C(O(T,[y]),0,[N.ANY]),[S]=C(O(T,[g]),0,[N.ANY]);return p!==S?1:0},isLessThan(y,g){const[p]=C(O(T,[y]),0,[N.NUMBER]),[S]=C(O(T,[g]),0,[N.NUMBER]);return p<S?1:0},isGreaterThan(y,g){const[p]=C(O(T,[y]),0,[N.NUMBER]),[S]=C(O(T,[g]),0,[N.NUMBER]);return p>S?1:0},isLessThanOrEq(y,g){const[p]=C(O(T,[y]),0,[N.NUMBER]),[S]=C(O(T,[g]),0,[N.NUMBER]);return p<=S?1:0},isGreaterThanOrEq(y,g){const[p]=C(O(T,[y]),0,[N.NUMBER]),[S]=C(O(T,[g]),0,[N.NUMBER]);return p>=S?1:0},opPlus(y,g){const[p]=C(O(T,[y]),0,[N.ANY]),[S]=C(O(T,[g]),0,[N.ANY]);return p+S},opMinus(y,g){const[p]=C(O(T,[y]),0,[N.ANY]),[S]=C(O(T,[g]),0,[N.ANY]);return p-S},opPower(y,g){const[p]=C(O(T,[y]),0,[N.NUMBER]),[S]=C(O(T,[g]),0,[N.NUMBER]);return Math.pow(p,S)},opMultiply(y,g){const[p]=C(O(T,[y]),0,[N.NUMBER]),[S]=C(O(T,[g]),0,[N.NUMBER]);return p*S},opDivide(y,g){const[p]=C(O(T,[y]),0,[N.NUMBER]),[S]=C(O(T,[g]),0,[N.NUMBER]);return p/S},opModDivide(y,g){const[p]=C(O(T,[y]),0,[N.NUMBER]),[S]=C(O(T,[g]),0,[N.NUMBER]);return p%S},opFloorDivide(y,g){const[p]=C(O(T,[y]),0,[N.NUMBER]),[S]=C(O(T,[g]),0,[N.NUMBER]);return Math.floor(p/S)},opUniPlus(y){const[g]=C(O(T,[y]),0,[N.NUMBER]);return+g},opUniMinus(y){const[g]=C(O(T,[y]),0,[N.NUMBER]);return-g}};return r=(I=t.code)==null?void 0:I.call(t,T),T}function os(e){const t={},n={...e,getcommand(r){return t[r]},command(r,s){return t[r]=s,n}};return n}const Vv=os({get(){return[!1,void 0]},set(){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("book",(e,t)=>{const[n,r]=C(O(e,t),0,[N.STRING,N.STRING]),s=n.toLowerCase();switch(r.toLowerCase()){case"create":NR(fR(s,[]));break}return 0}).command("register",(e,t)=>{var o,a;const r=((a=(o=Z(e.id()).object)==null?void 0:o.stats)==null?void 0:a.player)??"",[s,i]=C(O(e,t),0,[N.STRING,N.STRING]);switch(s.toLowerCase()){case"read":bg(e.senderid(),i,r);break;case"write":Lg(e.senderid(),i,e.get(i),r);break;default:Vn(e.senderid(),"register",`unknown #regsiter [action] ${s}`,r);break}return 0}).command("clear",(e,t)=>{const n=ne(t[0]);return e.set(n,void 0),0}).command("set",(e,t)=>{const[n,r]=C(O(e,t),0,[N.STRING,N.ANY]);return e.set(n,r),0}).command("take",(e,t)=>{const[n,r,s]=C(O(e,t),0,[N.STRING,N.MAYBE_NUMBER]),i=e.get(n),o=r??1;if(!vt(i))return 1;const a=i-o;return a<0?(s<t.length&&e.command(...t.slice(s)),1):(e.set(n,a),0)}).command("give",(e,t)=>{const[n,r,s]=C(O(e,t),0,[N.STRING,N.MAYBE_NUMBER]),i=e.get(n),o=vt(i)?i:0,a=r??1;if(!vt(a))return 0;const c=i===void 0?1:0;return c&&s<t.length&&e.command(...t.slice(s)),e.set(n,o+a),c}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(ne(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(ne(t[0])),0)),zv=os({get(){return[!1,void 0]},set(){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("play",(e,t)=>{const n=O(e,t),[r]=C(n,0,[N.STRING]),s=e.get(r);return st(s)?e.emit("pcspeaker:play",[-1,s]):e.emit("pcspeaker:play",[-1,r]),0}),Yv=os({get(e,t){return[!1,void 0]},set(e,t,n){return[!1,void 0]},shouldtick(){},tick(e){},tock(e){}}).command("text",(e,t)=>{const n=t.map(ne).join("");return Ns("cli","player>",n),0}).command("hyperlink",(e,t)=>{const[n,r,...s]=t,i=ne(n),o=ne(r);return console.info("hyperlink",i,o,s),0});var Ed={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(e){(function(){var t=function(f,m){return m=m||"",f.replace(/(^|-)/g,"$1\\u"+m).replace(/,/g,"\\u"+m)},n=t("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+t("DF-F6,F8-FF","00"),s="A-Z"+t("C0-D6,D8-DE","00"),i="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(f,m,_,w){return f=f||n,m=m||r,_=_||s,w=w||i,{capitalize:new RegExp("(^|["+f+"])(["+m+"])","g"),pascal:new RegExp("(^|["+f+"])+(["+m+_+"])","g"),fill:new RegExp("["+f+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+m+"])","g"),improper:new RegExp("\\b("+w+")\\b","g"),relax:new RegExp("([^"+_+"])(["+_+"]*)(["+_+"])(?=[^"+_+"]|$)","g"),upper:new RegExp("^[^"+m+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+f+"]")}},a=o(),c={re:a,unicodes:t,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(f){return c.up.call(f.charAt(0))+f.slice(1)},decap:function(f){return c.low.call(f.charAt(0))+f.slice(1)},deapostrophe:function(f){return f.replace(a.apostrophe,"")},fill:function(f,m,_){return m!=null&&(f=f.replace(a.fill,function(w,R){return R?m+R:""})),_&&(f=c.deapostrophe(f)),f},prep:function(f,m,_,w){if(f=f==null?"":f+"",!w&&a.upper.test(f)&&(f=c.low.call(f)),!m&&!a.hole.test(f)){var R=c.fill(f," ");a.hole.test(R)&&(f=R)}return!_&&!a.room.test(f)&&(f=f.replace(a.relax,c.relax)),f},relax:function(f,m,_,w){return m+" "+(_?_+" ":"")+w}},l={_:c,of:function(f){for(var m=0,_=c.types.length;m<_;m++)if(l[c.types[m]].apply(l,arguments)===f)return c.types[m]},flip:function(f){return f.replace(/\w/g,function(m){return(m==c.up.call(m)?c.low:c.up).call(m)})},random:function(f){return f.replace(/\w/g,function(m){return(Math.round(Math.random())?c.up:c.low).call(m)})},type:function(f,m){l[f]=m,c.types.push(f)}},u={lower:function(f,m,_){return c.fill(c.low.call(c.prep(f,m)),m,_)},snake:function(f){return l.lower(f,"_",!0)},constant:function(f){return l.upper(f,"_",!0)},camel:function(f){return c.decap(l.pascal(f))},kebab:function(f){return l.lower(f,"-",!0)},upper:function(f,m,_){return c.fill(c.up.call(c.prep(f,m,!1,!0)),m,_)},capital:function(f,m,_){return c.fill(c.prep(f).replace(a.capitalize,function(w,R,A){return R+c.up.call(A)}),m,_)},header:function(f){return l.capital(f,"-",!0)},pascal:function(f){return c.fill(c.prep(f,!1,!0).replace(a.pascal,function(m,_,w){return c.up.call(w)}),"",!0)},title:function(f){return l.capital(f).replace(a.improper,function(m,_,w,R){return w>0&&w<R.lastIndexOf(" ")?c.low.call(m):m})},sentence:function(f,m,_){return f=l.lower(f).replace(a.sentence,function(w,R,A){return R+c.up.call(A)}),m&&m.forEach(function(w){f=f.replace(new RegExp("\\b"+l.lower(w)+"\\b","g"),c.cap)}),_&&_.forEach(function(w){f=f.replace(new RegExp("(\\b"+l.lower(w)+"\\. +)(\\w)"),function(R,A,T){return A+c.low.call(T)})}),f}};u.squish=u.pascal,l.default=l;for(var h in u)l.type(h,u[h]);var d=typeof d=="function"?d:function(){};d(e.exports?e.exports=l:this.Case=l)}).call(Rs)})(Ed);var qv=Ed.exports,Xv=ao(qv);const _d=1,yd=2,Ja=4,Qa=8,as=32,Xe=64,Kt=128,xi=31,Za=63,Pn=127,Jv=2147483647,un=Math.floor,Ui=Math.abs,Td=(e,t)=>e<t?e:t,Dn=(e,t)=>e>t?e:t,Sd=e=>e!==0?e<0:1/e<0,Ad=Number.MAX_SAFE_INTEGER,Qv=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&un(e)===e),cr=()=>new Set,tc=e=>e[e.length-1],Zv=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},hn=Array.from,tN=Array.isArray,eN=e=>e.toLowerCase(),nN=/^\s*/g,rN=e=>e.replace(nN,""),sN=/([A-Z])/g,wd=(e,t)=>rN(e.replace(sN,n=>`${t}${eN(n)}`)),iN=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},cs=typeof TextEncoder<"u"?new TextEncoder:null,oN=cs?e=>cs.encode(e):iN;let ls=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ls&&ls.decode(new Uint8Array).length===1&&(ls=null);const fn=e=>new Error(e),ke=()=>{throw fn("Method unimplemented")},Me=()=>{throw fn("Unexpected case")};class us{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const dn=()=>new us,aN=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},me=e=>{const t=new Uint8Array(aN(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},cN=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Dn(n,t)*2),e.cpos=0)},yt=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},ec=yt,D=(e,t)=>{for(;t>Pn;)yt(e,Kt|Pn&t),t=un(t/128);yt(e,Pn&t)},nc=(e,t)=>{const n=Sd(t);for(n&&(t=-t),yt(e,(t>Za?Kt:0)|(n?Xe:0)|Za&t),t=un(t/64);t>0;)yt(e,(t>Pn?Kt:0)|Pn&t),t=un(t/128)},rc=new Uint8Array(3e4),lN=rc.length/3,uN=(e,t)=>{if(t.length<lN){const n=cs.encodeInto(t,rc).written||0;D(e,n);for(let r=0;r<n;r++)yt(e,rc[r])}else Ct(e,oN(t))},hN=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;D(e,r);for(let s=0;s<r;s++)yt(e,n.codePointAt(s))},lr=cs&&cs.encodeInto?uN:hN,Pi=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=Td(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Dn(n*2,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},Ct=(e,t)=>{D(e,t.byteLength),Pi(e,t)},sc=(e,t)=>{cN(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},fN=(e,t)=>sc(e,4).setFloat32(0,t,!1),dN=(e,t)=>sc(e,8).setFloat64(0,t,!1),pN=(e,t)=>sc(e,8).setBigInt64(0,t,!1),Rd=new DataView(new ArrayBuffer(4)),gN=e=>(Rd.setFloat32(0,e),Rd.getFloat32(0)===e),hs=(e,t)=>{switch(typeof t){case"string":yt(e,119),lr(e,t);break;case"number":Qv(t)&&Ui(t)<=Jv?(yt(e,125),nc(e,t)):gN(t)?(yt(e,124),fN(e,t)):(yt(e,123),dN(e,t));break;case"bigint":yt(e,122),pN(e,t);break;case"object":if(t===null)yt(e,126);else if(tN(t)){yt(e,117),D(e,t.length);for(let n=0;n<t.length;n++)hs(e,t[n])}else if(t instanceof Uint8Array)yt(e,116),Ct(e,t);else{yt(e,118);const n=Object.keys(t);D(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];lr(e,s),hs(e,t[s])}}break;case"boolean":yt(e,t?120:121);break;default:yt(e,127)}};class vd extends us{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&D(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Nd=e=>{e.count>0&&(nc(e.encoder,e.count===1?e.s:-e.s),e.count>1&&D(e.encoder,e.count-2))};class Di{constructor(){this.encoder=new us,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Nd(this),this.count=1,this.s=t)}toUint8Array(){return Nd(this),me(this.encoder)}}const Id=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);nc(e.encoder,t),e.count>1&&D(e.encoder,e.count-2)}};class ic{constructor(){this.encoder=new us,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Id(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Id(this),me(this.encoder)}}class mN{constructor(){this.sarr=[],this.s="",this.lensE=new Di}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new us;return this.sarr.push(this.s),this.s="",lr(t,this.sarr.join("")),Pi(t,this.lensE.toUint8Array()),me(t)}}const Cd=fn("Unexpected end of array"),bd=fn("Integer out of Range");class Fi{constructor(t){this.arr=t,this.pos=0}}const Fn=e=>new Fi(e),EN=e=>e.pos!==e.arr.length,_N=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Ut=e=>_N(e,F(e)),ur=e=>e.arr[e.pos++],F=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const s=e.arr[e.pos++];if(t=t+(s&Pn)*n,n*=128,s<Kt)return t;if(t>Ad)throw bd}throw Cd},oc=e=>{let t=e.arr[e.pos++],n=t&Za,r=64;const s=(t&Xe)>0?-1:1;if(!(t&Kt))return s*n;const i=e.arr.length;for(;e.pos<i;){if(t=e.arr[e.pos++],n=n+(t&Pn)*r,r*=128,t<Kt)return s*n;if(n>Ad)throw bd}throw Cd},hr=ls?e=>ls.decode(Ut(e)):e=>{let t=F(e);if(t===0)return"";{let n=String.fromCodePoint(ur(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(ur(e));else for(;t>0;){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},ac=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},yN=[e=>{},e=>null,oc,e=>ac(e,4).getFloat32(0,!1),e=>ac(e,8).getFloat64(0,!1),e=>ac(e,8).getBigInt64(0,!1),e=>!1,e=>!0,hr,e=>{const t=F(e),n={};for(let r=0;r<t;r++){const s=hr(e);n[s]=fs(e)}return n},e=>{const t=F(e),n=[];for(let r=0;r<t;r++)n.push(fs(e));return n},Ut],fs=e=>yN[127-ur(e)](e);class Ld extends Fi{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),EN(this)?this.count=F(this)+1:this.count=-1),this.count--,this.s}}class $i extends Fi{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=oc(this);const t=Sd(this.s);this.count=1,t&&(this.s=-this.s,this.count=F(this)+2)}return this.count--,this.s}}class cc extends Fi{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=oc(this),n=t&1;this.diff=un(t/2),this.count=1,n&&(this.count=F(this)+2)}return this.s+=this.diff,this.count--,this.s}}class TN{constructor(t){this.decoder=new $i(t),this.str=hr(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Ee=()=>new Map,lc=e=>{const t=Ee();return e.forEach((n,r)=>{t.set(r,n)}),t},pn=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},SN=(e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n},AN=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1};class wN{constructor(){this._observers=Ee()}on(t,n){return pn(this._observers,t,cr).add(n),n}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return hn((this._observers.get(t)||Ee()).values()).forEach(r=>r(...n))}destroy(){this._observers=Ee()}}const RN=crypto.getRandomValues.bind(crypto),Od=()=>RN(new Uint32Array(1))[0],vN="10000000-1000-4000-8000"+-1e11,NN=()=>vN.replace(/[018]/g,e=>(e^Od()&15>>e/4).toString(16)),kd=e=>new Promise(e);Promise.all.bind(Promise);const Md=e=>e===void 0?null:e;class IN{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let xd=new IN,CN=!0;try{typeof localStorage<"u"&&localStorage&&(xd=localStorage,CN=!1)}catch{}const bN=xd,LN=Object.assign,ON=Object.keys,kN=(e,t)=>{for(const n in e)t(e[n],n)},Ud=e=>ON(e).length,MN=e=>{for(const t in e)return!1;return!0},xN=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},UN=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),PN=(e,t)=>e===t||Ud(e)===Ud(t)&&xN(e,(n,r)=>(n!==void 0||UN(t,r))&&t[r]===n),uc=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&uc(e,t,n+1)}},DN=e=>e,FN=(e,t)=>t.includes(e);var Pd={};const ds=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let xe;const $N=()=>{if(xe===void 0)if(ds){xe=Ee();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&xe.set(t,""),t=r):t!==null&&(xe.set(t,r),t=null)}t!==null&&xe.set(t,"")}else typeof location=="object"?(xe=Ee(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");xe.set(`--${wd(t,"-")}`,n),xe.set(`-${wd(t,"-")}`,n)}})):xe=Ee();return xe},hc=e=>$N().has(e),fc=e=>Md(ds?Pd[e.toUpperCase().replaceAll("-","_")]:bN.getItem(e));(e=>hc("--"+e)||fc(e)!==null)("production");const Dd=ds&&FN(Pd.FORCE_COLOR,["true","1","2"]),BN=!hc("no-colors")&&(!ds||process.stdout.isTTY||Dd)&&(!ds||hc("color")||Dd||fc("COLORTERM")!==null||(fc("TERM")||"").includes("color")),GN=e=>new Uint8Array(e),jN=e=>{const t=GN(e.byteLength);return t.set(e),t};class WN{constructor(t,n){this.left=t,this.right=n}}const Je=(e,t)=>new WN(e,t);typeof DOMParser<"u"&&new DOMParser;const KN=e=>SN(e,(t,n)=>`${n}:${t};`).join(""),Qe=Symbol,Fd=Qe(),$d=Qe(),HN=Qe(),VN=Qe(),zN=Qe(),Bd=Qe(),YN=Qe(),Gd=Qe(),qN=Qe(),XN=e=>{var r;e.length===1&&((r=e[0])==null?void 0:r.constructor)===Function&&(e=e[0]());const t=[];let n=0;for(;n<e.length;n++){const s=e[n];s===void 0||s.constructor===String||s.constructor===Number||s.constructor===Object&&t.push(JSON.stringify(s))}return t},JN={[Fd]:Je("font-weight","bold"),[$d]:Je("font-weight","normal"),[HN]:Je("color","blue"),[zN]:Je("color","green"),[VN]:Je("color","grey"),[Bd]:Je("color","red"),[YN]:Je("color","purple"),[Gd]:Je("color","orange"),[qN]:Je("color","black")},QN=BN?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=Ee();let s=[],i=0;for(;i<e.length;i++){const a=e[i],c=JN[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=KN(r);i>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(i>0&&(s=n,s.unshift(t.join("")));i<e.length;i++){const a=e[i];a instanceof Symbol||s.push(a)}return s}:XN,ZN=(...e)=>{console.log(...QN(e)),t0.forEach(t=>t.print(e))},t0=cr(),jd=e=>({[Symbol.iterator](){return this},next:e}),e0=(e,t)=>jd(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),dc=(e,t)=>jd(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class pc{constructor(t,n){this.clock=t,this.len=n}}class ps{constructor(){this.clients=new Map}}const Wd=(e,t,n)=>t.clients.forEach((r,s)=>{const i=e.doc.store.clients.get(s);for(let o=0;o<r.length;o++){const a=r[o];ap(e,i,a.clock,a.len,n)}}),n0=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const s=un((n+r)/2),i=e[s],o=i.clock;if(o<=t){if(t<o+i.len)return s;n=s+1}else r=s-1}return null},Kd=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&n0(n,t.clock)!==null},gc=e=>{e.clients.forEach(t=>{t.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<t.length;n++){const s=t[r-1],i=t[n];s.clock+s.len>=i.clock?s.len=Dn(s.len,i.clock+i.len-s.clock):(r<n&&(t[r]=i),r++)}t.length=r})},r0=e=>{const t=new ps;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){const i=r.slice();for(let o=n+1;o<e.length;o++)Zv(i,e[o].clients.get(s)||[]);t.clients.set(s,i)}});return gc(t),t},Bi=(e,t,n,r)=>{pn(e.clients,t,()=>[]).push(new pc(n,r))},s0=()=>new ps,i0=e=>{const t=s0();return e.clients.forEach((n,r)=>{const s=[];for(let i=0;i<n.length;i++){const o=n[i];if(o.deleted){const a=o.id.clock;let c=o.length;if(i+1<n.length)for(let l=n[i+1];i+1<n.length&&l.deleted;l=n[++i+1])c+=l.length;s.push(new pc(a,c))}}s.length>0&&t.clients.set(r,s)}),t},fr=(e,t)=>{D(e.restEncoder,t.clients.size),hn(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),D(e.restEncoder,n);const s=r.length;D(e.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},mc=e=>{const t=new ps,n=F(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const s=F(e.restDecoder),i=F(e.restDecoder);if(i>0){const o=pn(t.clients,s,()=>[]);for(let a=0;a<i;a++)o.push(new pc(e.readDsClock(),e.readDsLen()))}}return t},Hd=(e,t,n)=>{const r=new ps,s=F(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();const o=F(e.restDecoder),a=F(e.restDecoder),c=n.clients.get(o)||[],l=Tt(n,o);for(let u=0;u<a;u++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<l){l<d&&Bi(r,o,l,d-l);let f=Ue(c,h),m=c[f];for(!m.deleted&&m.id.clock<h&&(c.splice(f+1,0,eo(t,m,h-m.id.clock)),f++);f<c.length&&(m=c[f++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(f,0,eo(t,m,d-m.id.clock)),m.delete(t))}else Bi(r,o,h,d-h)}}if(r.clients.size>0){const i=new $n;return D(i.restEncoder,0),fr(i,r),i.toUint8Array()}return null},Vd=Od;class dr extends wN{constructor({guid:t=NN(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Vd(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new sp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=kd(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>kd(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&q(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(hn(this.subdocs).map(t=>t.guid))}transact(t,n=null){return q(this,t,n)}get(t,n=Rt){const r=pn(this.share,t,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==Rt&&s!==n)if(s===Rt){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Er)}getText(t=""){return this.get(t,Bn)}getMap(t=""){return this.get(t,_r)}getXmlElement(t=""){return this.get(t,Tr)}getXmlFragment(t=""){return this.get(t,Gn)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){hn(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new dr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,q(t.parent.doc,r=>{const s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class zd{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return F(this.restDecoder)}readDsLen(){return F(this.restDecoder)}}class Yd extends zd{readLeftID(){return G(F(this.restDecoder),F(this.restDecoder))}readRightID(){return G(F(this.restDecoder),F(this.restDecoder))}readClient(){return F(this.restDecoder)}readInfo(){return ur(this.restDecoder)}readString(){return hr(this.restDecoder)}readParentInfo(){return F(this.restDecoder)===1}readTypeRef(){return F(this.restDecoder)}readLen(){return F(this.restDecoder)}readAny(){return fs(this.restDecoder)}readBuf(){return jN(Ut(this.restDecoder))}readJSON(){return JSON.parse(hr(this.restDecoder))}readKey(){return hr(this.restDecoder)}}class o0{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=F(this.restDecoder),this.dsCurrVal}readDsLen(){const t=F(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class pr extends o0{constructor(t){super(t),this.keys=[],F(t),this.keyClockDecoder=new cc(Ut(t)),this.clientDecoder=new $i(Ut(t)),this.leftClockDecoder=new cc(Ut(t)),this.rightClockDecoder=new cc(Ut(t)),this.infoDecoder=new Ld(Ut(t),ur),this.stringDecoder=new TN(Ut(t)),this.parentInfoDecoder=new Ld(Ut(t),ur),this.typeRefDecoder=new $i(Ut(t)),this.lenDecoder=new $i(Ut(t))}readLeftID(){return new gr(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new gr(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return fs(this.restDecoder)}readBuf(){return Ut(this.restDecoder)}readJSON(){return fs(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class qd{constructor(){this.restEncoder=dn()}toUint8Array(){return me(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){D(this.restEncoder,t)}writeDsLen(t){D(this.restEncoder,t)}}class gs extends qd{writeLeftID(t){D(this.restEncoder,t.client),D(this.restEncoder,t.clock)}writeRightID(t){D(this.restEncoder,t.client),D(this.restEncoder,t.clock)}writeClient(t){D(this.restEncoder,t)}writeInfo(t){ec(this.restEncoder,t)}writeString(t){lr(this.restEncoder,t)}writeParentInfo(t){D(this.restEncoder,t?1:0)}writeTypeRef(t){D(this.restEncoder,t)}writeLen(t){D(this.restEncoder,t)}writeAny(t){hs(this.restEncoder,t)}writeBuf(t){Ct(this.restEncoder,t)}writeJSON(t){lr(this.restEncoder,JSON.stringify(t))}writeKey(t){lr(this.restEncoder,t)}}class Xd{constructor(){this.restEncoder=dn(),this.dsCurrVal=0}toUint8Array(){return me(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,D(this.restEncoder,n)}writeDsLen(t){t===0&&Me(),D(this.restEncoder,t-1),this.dsCurrVal+=t}}class $n extends Xd{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ic,this.clientEncoder=new Di,this.leftClockEncoder=new ic,this.rightClockEncoder=new ic,this.infoEncoder=new vd(ec),this.stringEncoder=new mN,this.parentInfoEncoder=new vd(ec),this.typeRefEncoder=new Di,this.lenEncoder=new Di}toUint8Array(){const t=dn();return D(t,0),Ct(t,this.keyClockEncoder.toUint8Array()),Ct(t,this.clientEncoder.toUint8Array()),Ct(t,this.leftClockEncoder.toUint8Array()),Ct(t,this.rightClockEncoder.toUint8Array()),Ct(t,me(this.infoEncoder)),Ct(t,this.stringEncoder.toUint8Array()),Ct(t,me(this.parentInfoEncoder)),Ct(t,this.typeRefEncoder.toUint8Array()),Ct(t,this.lenEncoder.toUint8Array()),Pi(t,me(this.restEncoder)),me(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){hs(this.restEncoder,t)}writeBuf(t){Ct(this.restEncoder,t)}writeJSON(t){hs(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const a0=(e,t,n,r)=>{r=Dn(r,t[0].id.clock);const s=Ue(t,r);D(e.restEncoder,t.length-s),e.writeClient(n),D(e.restEncoder,r);const i=t[s];i.write(e,r-i.id.clock);for(let o=s+1;o<t.length;o++)t[o].write(e,0)},Ec=(e,t,n)=>{const r=new Map;n.forEach((s,i)=>{Tt(t,i)>s&&r.set(i,s)}),ji(t).forEach((s,i)=>{n.has(i)||r.set(i,0)}),D(e.restEncoder,r.size),hn(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{a0(e,t.clients.get(s),s,i)})},c0=(e,t)=>{const n=Ee(),r=F(e.restDecoder);for(let s=0;s<r;s++){const i=F(e.restDecoder),o=new Array(i),a=e.readClient();let c=F(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<i;l++){const u=e.readInfo();switch(xi&u){case 0:{const h=e.readLen();o[l]=new re(G(a,c),h),c+=h;break}case 10:{const h=F(e.restDecoder);o[l]=new se(G(a,c),h),c+=h;break}default:{const h=(u&(Xe|Kt))===0,d=new mt(G(a,c),null,(u&Kt)===Kt?e.readLeftID():null,null,(u&Xe)===Xe?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(u&as)===as?e.readString():null,kp(e,u));o[l]=d,c+=d.length}}}}return n},l0=(e,t,n)=>{const r=[];let s=hn(n.keys()).sort((f,m)=>f-m);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f};let o=i();if(o===null)return null;const a=new sp,c=new Map,l=(f,m)=>{const _=c.get(f);(_==null||_>m)&&c.set(f,m)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const m=f.id.client,_=n.get(m);_?(_.i--,a.clients.set(m,_.refs.slice(_.i)),n.delete(m),_.i=0,_.refs=[]):a.clients.set(m,[f]),s=s.filter(w=>w!==m)}r.length=0};for(;;){if(u.constructor!==se){const m=pn(h,u.id.client,()=>Tt(t,u.id.client))-u.id.clock;if(m<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const _=u.getMissing(e,t);if(_!==null){r.push(u);const w=n.get(_)||{refs:[],i:0};if(w.refs.length===w.i)l(_,Tt(t,_)),d();else{u=w.refs[w.i++];continue}}else(m===0||m<u.length)&&(u.integrate(e,m),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=i(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new $n;return Ec(f,a,new Map),D(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},u0=(e,t)=>Ec(e,t.doc.store,t.beforeState),h0=(e,t,n,r=new pr(e))=>q(t,s=>{s.local=!1;let i=!1;const o=s.doc,a=o.store,c=c0(r,o),l=l0(s,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<Tt(a,d)){i=!0;break}if(l){for(const[d,f]of l.missing){const m=u.missing.get(d);(m==null||m>f)&&u.missing.set(d,f)}u.update=Ki([u.update,l.update])}}else a.pendingStructs=l;const h=Hd(r,s,a);if(a.pendingDs){const d=new pr(Fn(a.pendingDs));F(d.restDecoder);const f=Hd(d,s,a);h&&f?a.pendingDs=Ki([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(i){const d=a.pendingStructs.update;a.pendingStructs=null,Jd(s.doc,d)}},n,!1),Jd=(e,t,n,r=pr)=>{const s=Fn(t);h0(s,e,n,new r(s))},f0=(e,t,n)=>Jd(e,t,n,Yd),d0=(e,t,n=new Map)=>{Ec(e,t.store,n),fr(e,i0(t.store))},p0=(e,t=new Uint8Array([0]),n=new $n)=>{const r=Qd(t);d0(n,e,r);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(b0(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===gs)return I0(s.map((i,o)=>o===0?i:O0(i)));if(n.constructor===$n)return Ki(s)}return s[0]},g0=(e,t)=>p0(e,t,new gs),m0=e=>{const t=new Map,n=F(e.restDecoder);for(let r=0;r<n;r++){const s=F(e.restDecoder),i=F(e.restDecoder);t.set(s,i)}return t},Qd=e=>m0(new zd(Fn(e))),Zd=(e,t)=>(D(e.restEncoder,t.size),hn(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{D(e.restEncoder,n),D(e.restEncoder,r)}),e),E0=(e,t)=>Zd(e,ji(t.store)),_0=(e,t=new Xd)=>(e instanceof Map?Zd(t,e):E0(t,e),t.toUint8Array()),y0=e=>_0(e,new qd);class T0{constructor(){this.l=[]}}const tp=()=>new T0,ep=(e,t)=>e.l.push(t),np=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},rp=(e,t,n)=>uc(e.l,[t,n]);class gr{constructor(t,n){this.client=t,this.clock=n}}const Gi=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,G=(e,t)=>new gr(e,t),S0=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Me()},mr=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Kd(t.ds,e.id),_c=(e,t)=>{const n=pn(e.meta,_c,cr),r=e.doc.store;n.has(t)||(t.sv.forEach((s,i)=>{s<Tt(r,i)&&gn(e,G(i,s))}),Wd(e,t.ds,s=>{}),n.add(t))};class sp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const ji=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},Tt=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},ip=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Me()}n.push(t)},Ue=(e,t)=>{let n=0,r=e.length-1,s=e[r],i=s.id.clock;if(i===t)return r;let o=un(t/(i+s.length-1)*r);for(;n<=r;){if(s=e[o],i=s.id.clock,i<=t){if(t<i+s.length)return o;n=o+1}else r=o-1;o=un((n+r)/2)}throw Me()},yc=(e,t)=>{const n=e.clients.get(t.client);return n[Ue(n,t.clock)]},Tc=(e,t,n)=>{const r=Ue(t,n),s=t[r];return s.id.clock<n&&s instanceof mt?(t.splice(r+1,0,eo(e,s,n-s.id.clock)),r+1):r},gn=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Tc(e,n,t.clock)]},op=(e,t,n)=>{const r=t.clients.get(n.client),s=Ue(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==re&&r.splice(s+1,0,eo(e,i,n.clock-i.id.clock+1)),i},A0=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Ue(r,t.id.clock)]=n},ap=(e,t,n,r,s)=>{if(r===0)return;const i=n+r;let o=Tc(e,t,n),a;do a=t[o++],i<a.id.clock+a.length&&Tc(e,t,i),s(a);while(o<t.length&&t[o].id.clock<i)};class w0{constructor(t,n,r){this.doc=t,this.deleteSet=new ps,this.beforeState=ji(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const cp=(e,t)=>t.deleteSet.clients.size===0&&!AN(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(gc(t.deleteSet),u0(e,t),fr(e,t.deleteSet),!0),lp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&pn(e.changed,t,cr).add(n)},Wi=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof mt&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=t-s;return i&&e.splice(t+1-i,i),i},R0=(e,t,n)=>{for(const[r,s]of e.clients.entries()){const i=t.clients.get(r);for(let o=s.length-1;o>=0;o--){const a=s[o],c=a.clock+a.len;for(let l=Ue(i,a.clock),u=i[l];l<i.length&&u.id.clock<c;u=i[++l]){const h=i[l];if(a.clock+a.len<=h.id.clock)break;h instanceof mt&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},v0=(e,t)=>{e.clients.forEach((n,r)=>{const s=t.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],a=Td(s.length-1,1+Ue(s,o.clock+o.len-1));for(let c=a,l=s[c];c>0&&l.id.clock>=o.clock;l=s[c])c-=1+Wi(s,c)}})},up=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{gc(i),n.afterState=ji(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),rp(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),uc(a,[]),n._needFormattingCleanup&&H0(n)}finally{r.gc&&R0(i,s,r.gcFilter),v0(i,s),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=s.clients.get(h),m=Dn(Ue(f,d),1);for(let _=f.length-1;_>=m;)_-=1+Wi(f,_)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=s.clients.get(h),m=Ue(f,d);m+1<f.length&&Wi(f,m+1)>1||m>0&&Wi(f,m)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(ZN(Gd,Fd,"[yjs] ",$d,Bd,"Changed the client-id because another client seems to be using it."),r.clientID=Vd()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new gs;cp(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new $n;cp(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):up(e,t+1)}}},q=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let i=!1,o=null;e._transaction===null&&(i=!0,e._transaction=new w0(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(i){const a=e._transaction===s[0];e._transaction=null,a&&up(s,0)}}return o};function*N0(e){const t=F(e.restDecoder);for(let n=0;n<t;n++){const r=F(e.restDecoder),s=e.readClient();let i=F(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=F(e.restDecoder);yield new se(G(s,i),c),i+=c}else if(xi&a){const c=(a&(Xe|Kt))===0,l=new mt(G(s,i),null,(a&Kt)===Kt?e.readLeftID():null,null,(a&Xe)===Xe?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&as)===as?e.readString():null,kp(e,a));yield l,i+=l.length}else{const c=e.readLen();yield new re(G(s,i),c),i+=c}}}}class Sc{constructor(t,n){this.gen=N0(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===se);return this.curr}}class Ac{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const I0=e=>Ki(e,Yd,gs),C0=(e,t)=>{if(e.constructor===re){const{client:n,clock:r}=e.id;return new re(G(n,r+t),e.length-t)}else if(e.constructor===se){const{client:n,clock:r}=e.id;return new se(G(n,r+t),e.length-t)}else{const n=e,{client:r,clock:s}=n.id;return new mt(G(r,s+t),null,G(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Ki=(e,t=pr,n=$n)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Fn(u)));let s=r.map(u=>new Sc(u,!0)),i=null;const o=new n,a=new Ac(o);for(;s=s.filter(d=>d.curr!==null),s.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const m=d.curr.id.clock-f.curr.id.clock;return m===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===se?1:-1:m}else return f.curr.id.client-d.curr.id.client}),s.length!==0;){const u=s[0],h=u.curr.id.client;if(i!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)mn(a,i.struct,i.offset),i={struct:d,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===se)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{mn(a,i.struct,i.offset);const m=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new se(G(h,i.struct.id.clock+i.struct.length),m),offset:0}}else{const m=i.struct.id.clock+i.struct.length-d.id.clock;m>0&&(i.struct.constructor===se?i.struct.length-=m:d=C0(d,m)),i.struct.mergeWith(d)||(mn(a,i.struct,i.offset),i={struct:d,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==se;d=u.next())mn(a,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(mn(a,i.struct,i.offset),i=null),wc(a);const c=r.map(u=>mc(u)),l=r0(c);return fr(o,l),o.toUint8Array()},b0=(e,t,n=pr,r=$n)=>{const s=Qd(t),i=new r,o=new Ac(i),a=new n(Fn(e)),c=new Sc(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=s.get(h)||0;if(c.curr.constructor===se){c.next();continue}if(u.id.clock+u.length>d)for(mn(o,u,Dn(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)mn(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}wc(o);const l=mc(a);return fr(i,l),i.toUint8Array()},hp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:me(e.encoder.restEncoder)}),e.encoder.restEncoder=dn(),e.written=0)},mn=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&hp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),D(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},wc=e=>{hp(e);const t=e.encoder.restEncoder;D(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];D(t,r.written),Pi(t,r.restEncoder)}},L0=(e,t,n,r)=>{const s=new n(Fn(e)),i=new Sc(s,!1),o=new r,a=new Ac(o);for(let l=i.curr;l!==null;l=i.next())mn(a,t(l),0);wc(a);const c=mc(s);return fr(o,c),o.toUint8Array()},O0=e=>L0(e,DN,pr,gs),fp="You must not compute changes after the event-handler fired.";class Hi{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=k0(this.currentTarget,this.target))}deletes(t){return Kd(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw fn(fp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,a;if(this.adds(i)){let c=i.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(i))if(c!==null&&this.deletes(c))o="delete",a=tc(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=tc(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=tc(i.content.getContent());else return;t.set(s,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw fn(fp);const n=this.target,r=cr(),s=cr(),i=[];if(t={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&i.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,s.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const k0=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}t=t._item.parent}return n},dp=80;let Rc=0;class M0{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Rc++}}const x0=e=>{e.timestamp=Rc++},pp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Rc++},U0=(e,t,n)=>{if(e.length>=dp){const r=e.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return pp(r,t,n),r}else{const r=new M0(t,n);return e.push(r),r}},Vi=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((i,o)=>Ui(t-i.index)<Ui(t-o.index)?i:o);let r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,x0(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&Ui(n.index-s)<r.parent.length/dp?(pp(n,r,s),n):U0(e._searchMarker,r,s)},ms=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){e.splice(r,1);continue}s.p=i,i.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=Dn(t,s.index+n))}},zi=(e,t,n)=>{const r=e,s=t.changedParentTypes;for(;pn(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;rp(r._eH,n,t)};class Rt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=tp(),this._dEH=tp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw ke()}clone(){throw ke()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){ep(this._eH,t)}observeDeep(t){ep(this._dEH,t)}unobserve(t){np(this._eH,t)}unobserveDeep(t){np(this._dEH,t)}toJSON(){}}const gp=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let i=e._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)s.push(o[a]),r--;t=0}}i=i.right}return s},mp=e=>{const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},Es=(e,t)=>{let n=0,r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)t(s[i],n++,e)}r=r.right}},Ep=(e,t)=>{const n=[];return Es(e,(r,s)=>{n.push(t(r,s,e))}),n},P0=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},_p=(e,t)=>{const n=Vi(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Yi=(e,t,n,r)=>{let s=n;const i=e.doc,o=i.clientID,a=i.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(s=new mt(G(o,Tt(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Wn(l)),s.integrate(e,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:s=new mt(G(o,Tt(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new _s(new Uint8Array(h))),s.integrate(e,0);break;case dr:s=new mt(G(o,Tt(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Ts(h)),s.integrate(e,0);break;default:if(h instanceof Rt)s=new mt(G(o,Tt(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Ze(h)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},yp=()=>fn("Length exceeded!"),Tp=(e,t,n,r)=>{if(n>t._length)throw yp();if(n===0)return t._searchMarker&&ms(t._searchMarker,n,r.length),Yi(e,t,null,r);const s=n,i=Vi(t,n);let o=t._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&gn(e,G(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&ms(t._searchMarker,s,r.length),Yi(e,t,o,r)},D0=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return Yi(e,t,s,n)},Sp=(e,t,n,r)=>{if(r===0)return;const s=n,i=r,o=Vi(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&gn(e,G(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&gn(e,G(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw yp();t._searchMarker&&ms(t._searchMarker,s,-i+r)},qi=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},vc=(e,t,n,r)=>{const s=t._map.get(n)||null,i=e.doc,o=i.clientID;let a;if(r==null)a=new Wn([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Wn([r]);break;case Uint8Array:a=new _s(r);break;case dr:a=new Ts(r);break;default:if(r instanceof Rt)a=new Ze(r);else throw new Error("Unexpected content type")}new mt(G(o,Tt(i.store,o)),s,s&&s.lastId,null,null,t,n,a).integrate(e,0)},Nc=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Ap=e=>{const t={};return e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},wp=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted},F0=(e,t)=>{const n={};return e._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;i!==null&&mr(i,t)&&(n[s]=i.content.getContent()[i.length-1])}),n},Xi=e=>e0(e.entries(),t=>!t[1].deleted);class $0 extends Hi{constructor(t,n){super(t,n),this._transaction=n}}class Er extends Rt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Er;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Er}clone(){const t=new Er;return t.insert(0,this.toArray().map(n=>n instanceof Rt?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),zi(this,t,new $0(this,t))}insert(t,n){this.doc!==null?q(this.doc,r=>{Tp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?q(this.doc,n=>{D0(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?q(this.doc,r=>{Sp(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return _p(this,t)}toArray(){return mp(this)}slice(t=0,n=this.length){return gp(this,t,n)}toJSON(){return this.map(t=>t instanceof Rt?t.toJSON():t)}map(t){return Ep(this,t)}forEach(t){Es(this,t)}[Symbol.iterator](){return P0(this)}_write(t){t.writeTypeRef(lI)}}const B0=e=>new Er;class G0 extends Hi{constructor(t,n,r){super(t,n),this.keysChanged=r}}class _r extends Rt{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new _r}clone(){const t=new _r;return this.forEach((n,r)=>{t.set(r,n instanceof Rt?n.clone():n)}),t}_callObserver(t,n){zi(this,t,new G0(this,t,n))}toJSON(){const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];t[r]=s instanceof Rt?s.toJSON():s}}),t}get size(){return[...Xi(this._map)].length}keys(){return dc(Xi(this._map),t=>t[0])}values(){return dc(Xi(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return dc(Xi(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?q(this.doc,n=>{qi(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?q(this.doc,r=>{vc(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Nc(this,t)}has(t){return wp(this,t)}clear(){this.doc!==null?q(this.doc,t=>{this.forEach(function(n,r,s){qi(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(uI)}}const j0=e=>new _r,En=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&PN(e,t);class Ic{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Me(),this.right.content.constructor){case gt:this.right.deleted||yr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Rp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case gt:t.right.deleted||yr(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&gn(e,G(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Ji=(e,t,n,r)=>{const s=new Map,i=r?Vi(t,n):null;if(i){const o=new Ic(i.p.left,i.p,i.index,s);return Rp(e,o,n-i.index)}else{const o=new Ic(null,t._start,0,s);return Rp(e,o,n)}},vp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===gt&&En(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,i=s.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new mt(G(i,Tt(s.store,i)),c,c&&c.lastId,l,l&&l.id,t,null,new gt(a,o));u.integrate(e,0),n.right=u,n.forward()})},yr=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Np=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===gt&&En(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Ip=(e,t,n,r)=>{const s=e.doc,i=s.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!En(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new mt(G(i,Tt(s.store,i)),u,u&&u.lastId,h,h&&h.id,t,null,new gt(a,c)),n.right.integrate(e,0),n.forward()}}return o},Cc=(e,t,n,r,s)=>{n.currentAttributes.forEach((d,f)=>{s[f]===void 0&&(s[f]=null)});const i=e.doc,o=i.clientID;Np(n,s);const a=Ip(e,t,n,s),c=r.constructor===String?new Pe(r):r instanceof Rt?new Ze(r):new jn(r);let{left:l,right:u,index:h}=n;t._searchMarker&&ms(t._searchMarker,n.index,c.getLength()),u=new mt(G(o,Tt(i.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=h,n.forward(),vp(e,t,n,a)},Cp=(e,t,n,r,s)=>{const i=e.doc,o=i.clientID;Np(n,s);const a=Ip(e,t,n,s);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===gt));){if(!n.right.deleted)switch(n.right.content.constructor){case gt:{const{key:c,value:l}=n.right.content,u=s[c];if(u!==void 0){if(En(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&gn(e,G(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new mt(G(o,Tt(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Pe(c)),n.right.integrate(e,0),n.forward()}vp(e,t,n,a)},bp=(e,t,n,r,s)=>{let i=t;const o=Ee();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===gt){const l=i.content;o.set(l.key,l)}i=i.right}let a=0,c=!1;for(;t!==i;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case gt:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(t.delete(e),a++,!c&&(s.get(u)??null)===h&&d!==h&&(d===null?s.delete(u):s.set(u,d))),!c&&!t.deleted&&yr(s,l);break}}}t=t.right}return a},W0=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===gt){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},K0=e=>{let t=0;return q(e.doc,n=>{let r=e._start,s=e._start,i=Ee();const o=lc(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case gt:yr(o,s.content);break;default:t+=bp(n,r,s,i,o),i=lc(o),r=s;break}s=s.right}}),t},H0=e=>{const t=new Set,n=e.doc;for(const[r,s]of e.afterState.entries()){const i=e.beforeState.get(r)||0;s!==i&&ap(e,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===gt&&o.constructor!==re&&t.add(o.parent)})}q(n,r=>{Wd(e,e.deleteSet,s=>{if(s instanceof re||!s.parent._hasFormatting||t.has(s.parent))return;const i=s.parent;s.content.constructor===gt?t.add(i):W0(r,s)});for(const s of t)K0(s)})},Lp=(e,t,n)=>{const r=n,s=lc(t.currentAttributes),i=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Ze:case jn:case Pe:n<t.right.length&&gn(e,G(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}i&&bp(e,i,t.right,s,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&ms(o._searchMarker,t.index,-r+n),t};class V0 extends Hi{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];q(t,r=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},s.size>0&&(f.attributes={},s.forEach((m,_)=>{m!==null&&(f.attributes[_]=m)}))),l="";break;case"retain":u>0&&(f={retain:u},MN(c)||(f.attributes=LN({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case Ze:case jn:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Pe:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case gt:{const{key:f,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const _=s.get(f)??null;En(_,m)?m!==null&&o.delete(r):(a==="retain"&&d(),En(m,i.get(f)??null)?delete c[f]:c[f]=m)}}else if(this.deletes(o)){i.set(f,m);const _=s.get(f)??null;En(_,m)||(a==="retain"&&d(),c[f]=_)}else if(!o.deleted){i.set(f,m);const _=c[f];_!==void 0&&(En(_,m)?_!==null&&o.delete(r):(a==="retain"&&d(),m===null?delete c[f]:c[f]=m))}o.deleted||(a==="insert"&&d(),yr(s,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Bn extends Rt{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Bn}clone(){const t=new Bn;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new V0(this,t,n);zi(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Pe&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?q(this.doc,r=>{const s=new Ic(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const o=t[i];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&i===t.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Cc(r,this,s,a,o.attributes||{})}else o.retain!==void 0?Cp(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Lp(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){const s=[],i=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;i.forEach((m,_)=>{d=!0,h[_]=m});const f={insert:a};d&&(f.attributes=h),s.push(f),a=""}}const u=()=>{for(;c!==null;){if(mr(c,t)||n!==void 0&&mr(c,n))switch(c.content.constructor){case Pe:{const h=i.get("ychange");t!==void 0&&!mr(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),i.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!mr(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),i.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),i.delete("ychange")),a+=c.content.str;break}case Ze:case jn:{l();const h={insert:c.content.getContent()[0]};if(i.size>0){const d={};h.attributes=d,i.forEach((f,m)=>{d[m]=f})}s.push(h);break}case gt:mr(c,t)&&(l(),yr(i,c.content));break}c=c.right}l()};return t||n?q(o,h=>{t&&_c(h,t),n&&_c(h,n),u()},"cleanup"):u(),s}insert(t,n,r){if(n.length<=0)return;const s=this.doc;s!==null?q(s,i=>{const o=Ji(i,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Cc(i,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const s=this.doc;s!==null?q(s,i=>{const o=Ji(i,this,t,!r);Cc(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?q(r,s=>{Lp(s,Ji(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const s=this.doc;s!==null?q(s,i=>{const o=Ji(i,this,t,!1);o.right!==null&&Cp(i,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?q(this.doc,n=>{qi(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?q(this.doc,r=>{vc(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Nc(this,t)}getAttributes(){return Ap(this)}_write(t){t.writeTypeRef(hI)}}const z0=e=>new Bn;class bc{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Tr||n.constructor===Gn)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Gn extends Rt{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Gn}clone(){const t=new Gn;return t.insert(0,this.toArray().map(n=>n instanceof Rt?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new bc(this,t)}querySelector(t){t=t.toUpperCase();const r=new bc(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),hn(new bc(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){zi(this,t,new X0(this,n,t))}toString(){return Ep(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),Es(this,i=>{s.insertBefore(i.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?q(this.doc,r=>{Tp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)q(this.doc,r=>{const s=t&&t instanceof Rt?t._item:t;Yi(r,this,s,n)});else{const r=this._prelimContent,s=t===null?0:r.findIndex(i=>i===t)+1;if(s===0&&t!==null)throw fn("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?q(this.doc,r=>{Sp(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return mp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return _p(this,t)}slice(t=0,n=this.length){return gp(this,t,n)}forEach(t){Es(this,t)}_write(t){t.writeTypeRef(dI)}}const Y0=e=>new Gn;class Tr extends Gn{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new Tr(this.nodeName)}clone(){const t=new Tr(this.nodeName),n=this.getAttributes();return kN(n,(r,s)=>{typeof r=="string"&&t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof Rt?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?q(this.doc,n=>{qi(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?q(this.doc,r=>{vc(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Nc(this,t)}hasAttribute(t){return wp(this,t)}getAttributes(t){return t?F0(this,t):Ap(this)}toDOM(t=document,n={},r){const s=t.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return Es(this,o=>{s.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(fI),t.writeKey(this.nodeName)}}const q0=e=>new Tr(e.readKey());class X0 extends Hi{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class Qi extends _r{constructor(t){super(),this.hookName=t}_copy(){return new Qi(this.hookName)}clone(){const t=new Qi(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const s=n[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(pI),t.writeKey(this.hookName)}}const J0=e=>new Qi(e.readKey());class Zi extends Bn{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Zi}clone(){const t=new Zi;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{const n=[];for(const s in t.attributes){const i=[];for(const o in t.attributes[s])i.push({key:o,value:t.attributes[s][o]});i.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const i=n[s];r+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const a=i.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(gI)}}const Q0=e=>new Zi;class Lc{constructor(t,n){this.id=t,this.length=n}get deleted(){throw ke()}mergeWith(t){return!1}write(t,n,r){throw ke()}integrate(t,n){throw ke()}}const Z0=0;class re extends Lc{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),ip(t.doc.store,this)}write(t,n){t.writeInfo(Z0),t.writeLen(this.length-n)}getMissing(t,n){return null}}class _s{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new _s(this.content)}splice(t){throw ke()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const tI=e=>new _s(e.readBuf());class ys{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ys(this.len)}splice(t){const n=new ys(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Bi(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const eI=e=>new ys(e.readLen()),Op=(e,t)=>new dr({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Ts{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ts(Op(this.doc.guid,this.opts))}splice(t){throw ke()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const nI=e=>new Ts(Op(e.readString(),e.readAny()));class jn{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new jn(this.embed)}splice(t){throw ke()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const rI=e=>new jn(e.readJSON());class gt{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new gt(this.key,this.value)}splice(t){throw ke()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const sI=e=>new gt(e.readKey(),e.readJSON());class to{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new to(this.arr)}splice(t){const n=new to(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const iI=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new to(n)};class Wn{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Wn(this.arr)}splice(t){const n=new Wn(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeAny(i)}}getRef(){return 8}}const oI=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Wn(n)};class Pe{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Pe(this.str)}splice(t){const n=new Pe(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const aI=e=>new Pe(e.readString()),cI=[B0,j0,z0,q0,Y0,J0,Q0],lI=0,uI=1,hI=2,fI=3,dI=4,pI=5,gI=6;class Ze{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ze(this.type._copy())}splice(t){throw ke()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const mI=e=>new Ze(cI[e.readTypeRef()](e)),eo=(e,t,n)=>{const{client:r,clock:s}=t.id,i=new mt(G(r,s+n),t,G(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=G(t.redone.client,t.redone.clock+n)),t.right=i,i.right!==null&&(i.right.left=i),e._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=n,i};class mt extends Lc{constructor(t,n,r,s,i,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?yd:0}set marker(t){(this.info&Qa)>0!==t&&(this.info^=Qa)}get marker(){return(this.info&Qa)>0}get keep(){return(this.info&_d)>0}set keep(t){this.keep!==t&&(this.info^=_d)}get countable(){return(this.info&yd)>0}get deleted(){return(this.info&Ja)>0}set deleted(t){this.deleted!==t&&(this.info^=Ja)}markDeleted(){this.info|=Ja}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Tt(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Tt(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===gr&&this.id.client!==this.parent.client&&this.parent.clock>=Tt(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=op(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=gn(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===re||this.right&&this.right.constructor===re)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===mt&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===mt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===gr){const r=yc(n,this.parent);r.constructor===re?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=op(t,t.doc.store,G(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),Gi(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(Gi(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(yc(t.doc.store,s.origin)))i.has(yc(t.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ip(t.doc.store,this),this.content.integrate(t,this),lp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new re(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:G(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Gi(t.origin,this.lastId)&&this.right===t&&Gi(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Bi(t.deleteSet,this.id.client,this.id.clock,this.length),lp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Me();this.content.gc(t),n?A0(t,this,new re(this.id,this.length)):this.content=new ys(this.length)}write(t,n){const r=n>0?G(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&xi|(r===null?0:Kt)|(s===null?0:Xe)|(i===null?0:as);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=S0(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===gr?(t.writeParentInfo(!1),t.writeLeftID(a)):Me();i!==null&&t.writeString(i)}this.content.write(t,n)}}const kp=(e,t)=>EI[t&xi](e),EI=[()=>{Me()},eI,iI,tI,aI,rI,sI,mI,oI,nI,()=>{Me()}],_I=10;class se extends Lc{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Me()}write(t,n){t.writeInfo(_I),D(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Mp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},xp="__ $YJS$ __";Mp[xp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Mp[xp]=!0;const Oc=0,Up=1,Pp=2,yI=(e,t)=>{D(e,Oc);const n=y0(t);Ct(e,n)},Dp=(e,t,n)=>{D(e,Up),Ct(e,g0(t,n))},TI=(e,t,n)=>Dp(t,n,Ut(e)),Fp=(e,t,n)=>{try{f0(t,Ut(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},SI=(e,t)=>{D(e,Pp),Ct(e,t)},AI=Fp,wI=(e,t,n,r)=>{const s=F(e);switch(s){case Oc:TI(e,t,n);break;case Up:Fp(e,n,r);break;case Pp:AI(e,n,r);break;default:throw new Error("Unknown message type")}return s},Sr={},kc={},Mc={},Ss={},De=Nr("shared",["second"],e=>{switch(e.target){case"second":Object.keys(Mc).forEach(t=>{const n=Ss[t];n===void 0?De.emit("shared:join",t):n<10?Ss[t]=n+1:delete Ss[t]}),Object.keys(kc).forEach(t=>{De.emit("shared:active",t)});break;case"join":{const t=e.data,n=Sr[t];if(n&&kc[t]){De.reply(e,"joinack",t);const r=dn();yI(r,n),De.reply(e,"sync",ro(t,r));const s=dn();Dp(s,n),De.reply(e,"sync",ro(t,s))}break}case"joinack":{const t=e.data;Sr[t]&&Mc[t]&&(Ss[t]=0);break}case"active":{const t=e.data;Sr[t]&&Mc[t]&&(Ss[t]=0);break}case"sync":{const[t,n,r]=e.data,s=Sr[n];if(s&&t!==De.id()){const i=Fn(r),o=dn();if(wI(i,o,s,De)===Oc){const c=ro(n,o);De.emit("shared:sync",c)}}break}}});function RI(e){let t=Sr[e];if(t)return t;Sr[e]=t=new dr({guid:e});function n(r){const s=dn();SI(s,r),De.emit("shared:sync",ro(e,s))}return t.on("update",n),t.on("destroy",()=>{t==null||t.off("update",n)}),t}function no(e){return RI(e).getMap()}function ro(e,t){const n=me(t);return[De.id()??"",e,n]}function $p(e,t){const n=e.get(t);return n!=null&&n.toJSON?n.toJSON():n}function Bp(e,t,n){typeof n=="string"?e.set(t,new Bn(n)):e.set(t,n)}function vI(e,t,n){kc[e]=!0;const r=no(e);r.get(t)===void 0&&n!==void 0&&Bp(r,t,n)}function NI(e,t,n){const r=no(e),s=$p(r,t);(s===void 0||n!==s)&&Bp(r,t,n)}function II(e,t,n){const r=no(e);function s(){n($p(r,t))}function i(o){o.keysChanged.has(t)&&s()}return s(),r.observe(i),()=>{r.unobserve(i)}}function CI(e,t,n){const r=no(e);let s=r.get(t);function i(){n(s)}function o(c){c.keysChanged.has(t)&&s===void 0&&a(),s&&r.unobserve(o)}function a(){s=r.get(t),s?(s.observeDeep(i),i()):r.observe(o)}return a(),()=>{s?s.unobserveDeep(i):r.unobserve(o)}}const _n={};function Gp(e,t){return e.player=t,e.layers=[],e.layout=[],e.layoutreset=!0,e.layoutfocus="scroll",e}function jp(e){e.text=[],Object.values(_n[e.id]??{}).forEach(t=>t==null?void 0:t()),_n[e.id]={}}function Wp(e){const t=e.layout.find(n=>n.name===e.layoutfocus);if(!t){const n={id:Sn(),name:e.layoutfocus,edge:Vt.RIGHT,size:20,text:[]};return e.layout.push(n),e.layoutreset=!1,n}return t}const xc={},bI=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),LI=new Set(["rn","range","sl","select","nm","number","tx","text"]),OI=new Set(["tx","text"]),kI={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""};function Kn(e){let t=xc[e];return E(t)?t:xc[e]=t=Gp({},e)}function MI(){return Object.keys(xc)}function xI(e){const t=Kn(e);t.layout=t.layout.filter(n=>n.edge!==Vt.SCROLL)}function UI(e,t,n){Object.values(_n).forEach(r=>{r[t]!==void 0&&NI(e.id(),t,n)})}function PI(e){const t=Kn(e.id());t.layout=t.layout.filter(n=>n.edge!==Vt.SCROLL||n.text.length>0)}function Uc(e,t,n,r,s){const i=Kn(e.id()),o=r,a=s??Xv.capital(t),c=i.layout.find(l=>l.name===a);if(c)i.layoutreset=!0,i.layoutfocus=a,vt(o)&&(c.size=o);else switch(n){case Vt.START:Gp(i,e.id());break;case Vt.LEFT:case Vt.RIGHT:case Vt.TOP:case Vt.BOTTOM:case Vt.SCROLL:{const l={id:Sn(),name:a,edge:n,size:o??wg[n],text:[]};i.layout.push(l),i.layoutfocus=a;break}}}function DI(e,t){const n=Kn(e.id()),r=Wp(n);n.layoutreset&&(n.layoutreset=!1,jp(r)),r.text.push(t)}function FI(e,t,n,r){const s=Kn(e.id()),i=Wp(s);s.layoutreset&&(s.layoutreset=!1,jp(i));const o=n.toLowerCase(),a=[e.id(),t,...bI.has(o)?[o]:["hypertext",n],...r],c=a[2];if(LI.has(c)){const l=`${a[3]??""}`;_n[i.id]=_n[i.id]??{};const u=e.get(l);_n[i.id][l]===void 0&&(vI(e.id(),l,u??kI[c]),OI.has(c)?_n[i.id][l]=CI(e.id(),l,h=>{if(h!==void 0){const d=h.toJSON();d!==e.get(l)&&e.set(l,d)}}):_n[i.id][l]=II(e.id(),l,h=>{h!==void 0&&h!==e.get(l)&&e.set(l,h)}))}i.text.push(a)}const $I=os({get(){return[!1,void 0]},set(e,t,n){return UI(e,t,n),[!1,void 0]},shouldtick(){},tick(e){var r;const t=Z(e.id());let n="scroll";E((r=t.object)==null?void 0:r.name)&&(n=t.object.name),Uc(e,"scroll",Vt.SCROLL,void 0,n)},tock(e){PI(e)}}).command("gadget",(e,t)=>{const n=O(e,t),[r]=C(n,0,[N.STRING]),s=Ag[r.toLowerCase()];if(s===Vt.SCROLL){const[,i,o]=C(n,0,[N.STRING,N.MAYBE_STRING,N.MAYBE_NUMBER]);Uc(e,r,s,o,i)}else{const[,i,o]=C(n,0,[N.STRING,N.MAYBE_NUMBER,N.MAYBE_STRING]);Uc(e,r,s,i,o)}return 0}).command("frame",(e,t)=>{var c;const n=Z(e.id()),[r,s,i]=C(O(e,t),0,[N.STRING,N.MAYBE_STRING,N.MAYBE_STRING]),o=((c=n.board)==null?void 0:c.id)??"",a=r.toLowerCase();if(a==="reset")bf(o);else if(E(s)&&E(i))switch(s.toLowerCase()){case"edit":RR(o,a,i);break;case"view":wR(o,a,i);break}return 0}).command("text",(e,t)=>{const n=t.map(ne).join("");return DI(e,n),0}).command("hyperlink",(e,t)=>{const[n,r,...s]=t,i=ne(n),o=ne(r);return FI(e,i,o,s),0});function Pc(e,t){if(!(!E(e)||!E(t))){E(e.stats)||(e.stats={});for(const[n,r]of Object.entries(t)){const s=n.toLowerCase();e.stats[s]=r}}}function BI(e,t,n,r){if(E(e)&&E(t)&&E(n)){const[s,i]=n,o=Ti(e,s);if(E(o)&&E(o.name)){const a=ll(t,r,s);return E(a)&&(a.headless=!0,Ls(a,i),Ua(e,t,a)),a}}}function so(e,t,n,r){if(E(e)&&E(t)&&E(n)){const[s,i]=n,o=Rf(e,s);if(E(o)){const c=cl(t,r,s);Ls(c,i);const l=r.x+r.y*t.width;return Ua(e,t,c,l),c}const a=Ti(e,s);if(E(a)&&E(a.name)){const c=ll(t,r,s);return Ls(c,i),_R(e,t,c),Ua(e,t,c),c}}}const Kp=new Set(["cycle","player","sender","inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu","data"]),GI=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]);function jI(e){const t=ul[e];if(E(t))return t;const n=pl[e];if(E(n))return n;const r=ml[e];if(E(r))return r;const s=Il[e];if(E(s))return s}const WI=["NORTH","SOUTH","WEST","EAST"];function KI(e){const t=Z(e.id??"");if(t.inputcurrent!==void 0)return;const[n=ht.NONE]=t.inputqueue;e.stats===void 0&&(e.stats={}),e.stats.inputmove=[],e.stats.inputok=0,e.stats.inputcancel=0,e.stats.inputmenu=0;const r=t.inputmods[n];switch(e.stats.inputalt=r&Rg?1:0,e.stats.inputctrl=r&vg?1:0,e.stats.inputshift=r&Ng?1:0,n){case ht.MOVE_UP:case ht.MOVE_DOWN:case ht.MOVE_LEFT:case ht.MOVE_RIGHT:e.stats.inputmove=[WI[n-ht.MOVE_UP]];break;case ht.OK_BUTTON:e.stats.inputok=1;break;case ht.CANCEL_BUTTON:e.stats.inputcancel=1;break;case ht.MENU_BUTTON:e.stats.inputmenu=1;break}t.inputcurrent=n,t.inputqueue.delete(n)}function Ar(e,t,n,r){const s=st(t)?t:t.id,i=st(t)?void 0:{x:t.x??0,y:t.y??0},o=st(n)?n:n.id,a=s??i;E(o)&&E(a)&&e.send(o,r,a)}function Hp(e,t,n,r){E(n==null?void 0:n.id)?(n.headless=!0,Si(e,t,n)):cl(t,r,"empty")}function Vp(e,t,n,r,s){const i=ER(t,n,r,s);if(E(i)){Ar(e,i,e.id(),"thud"),r.kind==="player"?Ar(e,e.id(),i,"touch"):r.collision===Nt.BULLET?Ar(e,e.id(),i,"shot"):Ar(e,e.id(),i,"bump");const o=be(t,i);return(i.destructible??(o==null?void 0:o.destructible))&&Hp(t,n,i,s),!1}return!0}function Dc(e,t){if(st(e)){const n=e.toLowerCase();switch(n){case"edit":return[n,t+1]}}return[void 0,t]}function Fc(e,t,n){let r;const s=Ai((t==null?void 0:t.id)??"");switch(n){case"edit":{r=s.find(a=>a.type===Xr.EDIT);break}}const i=r?Jr((r==null?void 0:r.book)??""):e,o=r?sr(i,(r==null?void 0:r.board)??""):t;return{maybebook:i,maybeboard:o}}const HI=os({get(e,t){var o;const n=jI(t);if(E(n))return[!0,n];const r=Z(e.id());if(r.object){GI.has(t)&&KI(r.object);const a=(o=r.object.stats)==null?void 0:o[t];if(E(a)||Kp.has(t))return[!0,a]}const s=r.board?Ro(r.board,r.object):void 0,i=dR(r.book,(s==null?void 0:s.id)??"",t);return[E(i),i]},set(e,t,n){var i,o;const r=Z(e.id());if(E(r.object)&&(E((o=(i=r.object)==null?void 0:i.stats)==null?void 0:o[t])||Kp.has(t)))return r.object.stats||(r.object.stats={}),r.object.stats[t]=n,[!0,n];const s=r.board?Ro(r.board,r.object):void 0;return pR(r.book,(s==null?void 0:s.id)??"",t,n),[!0,n]},shouldtick(e){var n,r,s,i,o,a;const t=Z(e.id());!E((n=t.object)==null?void 0:n.x)||!E((r=t.object)==null?void 0:r.y)||!E((i=(s=t.object)==null?void 0:s.stats)==null?void 0:i.stepx)||!E((a=(o=t.object)==null?void 0:o.stats)==null?void 0:a.stepy)||Vp(e,t.book,t.board,t.object,{x:t.object.x+t.object.stats.stepx,y:t.object.y+t.object.stats.stepy})||Pc(t.object,{stepx:0,stepy:0})},tick(){},tock(e){var n;(n=Z(e.id()).object)!=null&&n.headless&&e.command("die")}}).command("become",(e,t)=>{var i,o;const n=Z(e.id()),r={x:((i=n.object)==null?void 0:i.x)??0,y:((o=n.object)==null?void 0:o.y)??0},[s]=C(O(e,t),0,[N.KIND]);return qr(n.book,n.board),Si(n.book,n.board,n.object),Pa(n.book,n.object,e.timestamp())&&so(n.book,n.board,s,r),e.endofprogram(),0}).command("bind",()=>0).command("change",(e,t)=>{const n=Z(e.id()),[r,s]=Dc(t[0],0),[i,o]=C(O(e,t),s,[N.KIND,N.KIND]),{maybebook:a,maybeboard:c}=Fc(n.book,n.board,r);qr(a,c);const l=No(i)??"",u=To(c,l),h=em(u,i),d=No(o),f=vl(o),m=Nl(o);return h.forEach(_=>{if(ir(a,_)===d)E(f)&&(_.color=f),E(m)&&(_.bg=m);else{if(E(_.id))switch(Si(a,c,_),r){case"edit":if(!wo(c,_.id))return;break;default:if(!Pa(a,_,e.timestamp()))return;break}ye(_)&&so(a,c,o,_)}}),0}).command("char",(e,t)=>{const n=Z(e.id()),[r]=C(O(e,t),0,[N.NUMBER]);return E(n.object)&&(n.object.char=r),0}).command("color",(e,t)=>{const n=Z(e.id()),[r]=C(O(e,t),0,[N.COLOR]);return E(n.object)&&E(r)&&Ls(n.object,r),0}).command("cycle",(e,t)=>{const[n]=C(O(e,t),0,[N.NUMBER]);return e.cycle(An(Math.round(n),1,255)),0}).command("die",e=>{var n;const t=Z(e.id());return(n=t.object)!=null&&n.headless&&Si(t.book,t.board,t.object),Pa(t.book,t.object,e.timestamp()),e.endofprogram(),0}).command("endgame",e=>(e.set("health",0),0)).command("go",(e,t)=>{const n=Z(e.id());if(!E(n.object))return 1;const[r]=C(O(e,t),0,[N.DIR]);return Vp(e,n.book,n.board,n.object,r),n.object.x!==r.x&&n.object.y!==r.y?1:0}).command("put",(e,t)=>{const n=Z(e.id()),[r,s]=Dc(t[0],0),[i,o]=C(O(e,t),s,[N.DIR,N.KIND]),{maybebook:a,maybeboard:c}=Fc(n.book,n.board,r);return qr(a,c),so(a,c,o,i),0}).command("send",(e,t)=>{var h,d;const n=Z(e.id()),[r,s]=C(O(e,t),0,[N.STRING,N.ANY]),[i,o]=r.split(":"),a=E(o)?i:"self",c=o??i;function l(f){f.forEach(m=>{E(m.id)&&e.send(m.id,c,s)})}const u=a.toLowerCase();switch(u){case"all":for(const f of Object.keys(((h=n.board)==null?void 0:h.objects)??{}))e.send(f,c,s);break;case"self":e.send(e.id(),c,s);break;case"others":for(const f of Object.keys(((d=n.board)==null?void 0:d.objects)??{}))f!==e.id()&&e.send(f,c,s);break;case"player":break;default:{l(So(n.board,[a]));const f=e.get(u);Array.isArray(f)?l(So(n.board,f)):l(So(n.board,[f]));break}}return 0}).command("shoot",(e,t)=>{const n=Z(e.id());if(!ye(n.object))return 0;const[r,s]=Dc(t[0],0),[i,o]=C(O(e,t),s,[N.DIR,N.MAYBE_KIND]),{maybebook:a,maybeboard:c}=Fc(n.book,n.board,r),l=rn(n.object,i),u=zt({x:0,y:0},l),h=zt({x:n.object.x,y:n.object.y},l);qr(a,c);let d=om(c,h);if(E(d)&&!E(d.id)){const f=be(a,n.object),m=be(a,d);ol(d.collision??(f==null?void 0:f.collision),d.collision??(m==null?void 0:m.collision))||(d=void 0)}if(E(d)){E(d.id)&&Ar(e,e.id(),d,"shot");const f=be(a,d);(d.destructible??(f==null?void 0:f.destructible))&&Hp(a,c,d,h);const m=BI(a,c,o??["bullet"],h);E(m)&&(m.collision=Nt.BULLET,Ar(e,d,e.id(),"thud"))}else{const f=so(a,c,o??["bullet"],h);E(f)&&(f.collision=Nt.BULLET,Pc(f,{stepx:u.x,stepy:u.y}))}return e.yield(),0}).command("throwstar",(e,t)=>e.command("shoot",...t,"star")?1:0).command("try",(e,t)=>{const[,n]=C(O(e,t),0,[N.DIR]);return e.command("go",...t)&&n<t.length&&e.command(...t.slice(n)),e.yield(),0}).command("walk",(e,t)=>{const n=Z(e.id());if(!ye(n.object))return 0;const[r]=C(O(e,t),0,[N.DIR]),s=rn(n.object,r),i=zt({x:0,y:0},s);return Pc(n.object,{stepx:i.x,stepy:i.y}),0}).command("stat",(e,t)=>{const n=Z(e.id());return n.object&&(n.object.name=t.map(ne).join(" ")),0}),VI={all:Vv,cli:Yv,audio:zv,gadget:$I,object:HI},zI={[Q.ERROR]:[],[Q.CLI]:["all","audio","cli"],[Q.BOARD]:["all","audio","gadget"],[Q.OBJECT]:["all","audio","object","gadget"],[Q.TERRAIN]:["all"],[Q.CHARSET]:["all"],[Q.PALETTE]:["all"]};function YI(e,t){(zI[t]??[]).forEach(r=>e.install(VI[r]))}function $c(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset||0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];Array.isArray(r)?r.forEach(s=>{t.push($c(s))}):t.push($c(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)||0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)||0))},e.range}function qI(e){const t=Oa(`${e}
`);if(t.errors.length>0)return{errors:t.errors,tokens:[]};ss.input=t.tokens;const n=ss.program();if(ss.errors.length>0)return{tokens:t.tokens,errors:ss.errors};const r=Pv.visit(n);return r?($c(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:["no ast output"]}}const Bc=Object.getPrototypeOf(function*(){}).constructor;function XI(e){const t=qI(e);if(t.errors&&t.errors.length>0)return t;if(!t.ast)return{...t,errors:["no ast output"]};const n=jv(t.ast);if(n.code){rR&&console.info(n.code);try{return{...t,...n,source:n.code,code:new Bc("api",n.code)}}catch(r){return{errors:[{message:r.message}],source:"there was an error",code:new Bc("api"," ")}}}return{...t,...n,source:"there was an error",code:new Bc("api"," ")}}function JI(){const e={},t={};function n(s){const i=e[s];if(i)return i;const o=XI(s);return e[s]=o,o}const r={ids(){return Object.keys(t)},has(s){return E(t[s])},halt(s){const i=t[s];return i&&delete t[s],!!i},tick(s,i,o,a){var l;let c=t[s];if(!E(t[s])){const u=n(a);if((l=u.errors)!=null&&l.length)return Vn("os","build",JSON.stringify(u.errors),""),!1;c=t[s]=Hv(s,u),YI(c,i)}return!!(c!=null&&c.tick(o))},once(s,i,o,a){return r.tick(s,i,o,a)&&r.halt(s)},message(s){const{target:i,path:o}=Xc(s.target),a=t[i];E(a)&&a.message({...s,target:o})}};return r}const QI=qc(co.numbers,4),ZI=qc(`${co.numbers}${co.lowercase}`,16),Gc=`pid_${QI()}_${ZI()}`;AR(Gc);const jc=JI();let Wc=0;const tC=32,wr={},tn=Nr("vm",["tick","second"],e=>{switch(e.target){case"mem":e.player===Gc&&(vR(e.data),Ns(tn.name(),"ackmem",e.player),tn.emit("ackmem",void 0,e.player));break;case"login":e.player&&IR(e.player)&&(wr[e.player]=0,Ns(tn.name(),"acklogin",e.player),tn.emit("acklogin",void 0,e.player));break;case"doot":e.player&&(wr[e.player]=0,tl(tn.name(),e.player,"active"),tn.emit("doot",void 0,e.player));break;case"input":if(e.player){const t=Z(e.player),[n=ht.NONE,r=0]=e.data??{};t.inputqueue.add(n),t.inputmods[n]=r}break;case"tick":Wc=e.data??0,bR(jc,Wc);break;case"second":Object.keys(wr).forEach(t=>{++wr[t],wr[t]>=tC&&(delete wr[t],CR(t),Ns(tn.name(),"logout",t),tn.emit("logout",void 0,t))});break;case"cli":LR(jc,Wc,e.player??"",e.data??"");break;default:jc.message(e);break}});function eC(){tn.emit("ready",void 0,Gc)}const Kc=Nr("clock",[],()=>{});let Hc=0,zp=performance.now(),Vc=0,io=0;function nC(){Kc.emit("tick",io),Kc.emit("tock",io),++Vc,++io,Vc>=bo&&(Vc%=bo,Kc.emit("second",io))}function Yp(){const e=performance.now(),t=e-zp;Hc+=t,Hc>=Co&&(Hc%=Co,nC()),zp=e,setTimeout(Yp)}Yp();const qp={},Xp=Nr("gadgetserver",["tock"],e=>{switch(e.target){case"tock":MI().forEach(t=>{const n=Kn(t);n.layers=kR(t);const r=_o(qp[t]??{},n);r.length&&(qp[t]=Lt(n),Cg(Xp.name(),r,t))});break;case"desync":if(e.player){const t=Kn(e.player);Ig(Xp.name(),t,e.player)}break;case"clearscroll":e.player&&xI(e.player);break}}),rC=lg(e=>postMessage(e));onmessage=function(t){rC(t.data)},queueMicrotask(eC)})();

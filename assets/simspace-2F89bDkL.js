var FM=Object.defineProperty;var $M=(or,Ae,Pt)=>Ae in or?FM(or,Ae,{enumerable:!0,configurable:!0,writable:!0,value:Pt}):or[Ae]=Pt;var ye=(or,Ae,Pt)=>$M(or,typeof Ae!="symbol"?Ae+"":Ae,Pt);(function(){"use strict";const or=new Set,Ae={emit(t,e,n,r){Ae.invoke(ub(t,e,n,r))},invoke(t){or.forEach(e=>e.handle(t))},connect(t){or.add(t)},disconnect(t){or.delete(t)}};var Pt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ci(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function q_(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Yh={};(function(t){var e=Pt&&Pt.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,f=u.length,p;d<f;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,f=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,b=l.addAdverb,_=b===void 0?!1:b,w=e(e(e([],e([],Array(m),!0).map(function(v){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),_?[n(t.adverbs)]:[],!0);return f&&(w=w.map(function(v){return v.charAt(0).toUpperCase()+v.substr(1)})),w.join(h)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d;return t.adjectives.length*h*t.nouns.length*t.verbs.length*(f?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(t.adjectives).length*h+h*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(f?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(t.adjectives).length*h+h*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(f?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(Yh);var X_=Ci(Yh);const Z_="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let J_=t=>crypto.getRandomValues(new Uint8Array(t)),Y_=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},Qh=(t,e=21)=>Y_(t,e,J_),Q_=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=Z_[n[t]&63];return e};var ef="abcdefghijklmnopqrstuvwxyz",tf="ABCDEFGHIJKLMNOPQRSTUVWXYZ",nf="0123456789",eb="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",tb="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const nb=nf,rb=ef,ib=tf;var sb=nb+rb+ib,Mc={lowercase:ef,uppercase:tf,numbers:nf,nolookalikes:eb,nolookalikesSafe:tb,alphanumeric:sb};function ft(){return`sid_${Q_(12).replaceAll("-",".")}`}const ob=Qh(Mc.numbers,4),ab=Qh(`${Mc.numbers}${Mc.lowercase}`,16);function cb(){return`pid_${ob()}_${ab()}`}function rf(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function lb(){return X_({capitalize:!1,adjectiveCount:1})}var Le=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(Le||{}),Ge=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(Ge||{}),Ro=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(Ro||{}),ce=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t))(ce||{}),he=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.LINK=11]="LINK",t[t.HOTKEY=12]="HOTKEY",t[t.SCROLL=13]="SCROLL",t[t.COPYIT=14]="COPYIT",t))(he||{});function Pe(t){return t.toLowerCase().trim()}function ub(t,e,n,r){return{id:ft(),target:t,sender:e,data:n,player:r}}function sf(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function hs(t,e,n){const r=ft(),i=Pe(t),s=e.map(Pe),o={id(){return r},name(){return t},topics(){return e},emit(a,c,l){Ae.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=sf(a.target),u=Pe(c);s.findIndex(h=>h==="all"||h===u)!==-1&&n(a),(r===c||u==="all"||i===u)&&n({...a,target:l})}};return Ae.connect(o),o}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var hb=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),fb=Object.prototype.hasOwnProperty;function Uc(t,e){return fb.call(t,e)}function Pc(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)Uc(t,i)&&r.push(i);return r}function Vt(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Dc(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Yr(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function of(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Bc(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(Bc(t[e]))return!0}else if(typeof t=="object"){for(var r=Pc(t),i=r.length,s=0;s<i;s++)if(Bc(t[r[s]]))return!0}}return!1}function af(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var cf=function(t){hb(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,af(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=af(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),st=cf,db=Vt,Ni={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=Io(n,this.path);r&&(r=Vt(r));var i=Qr(n,{op:"remove",path:this.from}).removed;return Qr(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=Io(n,this.from);return Qr(n,{op:"add",path:this.path,value:Vt(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:fs(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},pb={add:function(t,e,n){return Dc(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:Ni.move,copy:Ni.copy,test:Ni.test,_get:Ni._get};function Io(t,e){if(e=="")return t;var n={op:"_get",path:e};return Qr(t,n),n.value}function Qr(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):Oo(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=Io(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=fs(t,e.value),o.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new st("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Vt(t));var a=e.path||"",c=a.split("/"),l=t,u=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=Oo;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=of(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!Dc(f))throw new st("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);Dc(f)&&(f=~~f)}if(u>=h){if(n&&e.op==="add"&&f>l.length)throw new st("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=pb[e.op].call(e,l,f,t);if(o.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=h){var o=Ni[e.op].call(e,l,f,t);if(o.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new st("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function Fc(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new st("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Vt(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=Qr(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function mb(t,e,n){var r=Qr(t,e);if(r.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function Oo(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new st("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(Ni[t.op]){if(typeof t.path!="string")throw new st("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new st('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new st("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new st("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&Bc(t.value))throw new st("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new st("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new st("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=lf([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new st("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new st("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function lf(t,e,n){try{if(!Array.isArray(t))throw new st("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Fc(Vt(e),Vt(t),n||!0);else{n=n||Oo;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof st)return i;throw i}}function fs(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!fs(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!fs(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var gb=Object.freeze({__proto__:null,JsonPatchError:st,_areEquals:fs,applyOperation:Qr,applyPatch:Fc,applyReducer:mb,deepClone:db,getValueByPointer:Io,validate:lf,validator:Oo});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var $c=new WeakMap,yb=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),_b=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function bb(t){return $c.get(t)}function wb(t,e){return t.observers.get(e)}function vb(t,e){t.observers.delete(e.callback)}function Eb(t,e){e.unobserve()}function kb(t,e){var n=[],r,i=bb(t);if(!i)i=new yb(t),$c.set(t,i);else{var s=wb(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Vt(t),e){r.callback=e,r.next=null;var o=function(){jc(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){jc(r),clearTimeout(r.next),vb(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new _b(e,r)),r}function jc(t,e){e===void 0&&(e=!1);var n=$c.get(t.object);zc(n.value,t.object,t.patches,"",e),t.patches.length&&Fc(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function zc(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=Pc(e),o=Pc(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(Uc(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?zc(u,h,n,r+"/"+Yr(l),i):u!==h&&(i&&n.push({op:"test",path:r+"/"+Yr(l),value:Vt(u)}),n.push({op:"replace",path:r+"/"+Yr(l),value:Vt(h)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+Yr(l),value:Vt(u)}),n.push({op:"remove",path:r+"/"+Yr(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!Uc(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+Yr(l),value:Vt(e[l])})}}}function uf(t,e,n){n===void 0&&(n=!1);var r=[];return zc(t,e,r,"",n),r}var Sb=Object.freeze({__proto__:null,compare:uf,generate:jc,observe:kb,unobserve:Eb});Object.assign({},gb,Sb,{JsonPatchError:cf,deepClone:Vt,escapePathComponent:Yr,unescapePathComponent:of});var Ab=typeof Element<"u",xb=typeof Map=="function",Tb=typeof Set=="function",Rb=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Co(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!Co(t[r],e[r]))return!1;return!0}var s;if(xb&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!Co(r.value[1],e.get(r.value[0])))return!1;return!0}if(Tb&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(Rb&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(Ab&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!Co(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var Ib=function(e,n){try{return Co(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},Ob=Ci(Ib);function k(t){return t!=null}const Cb=Object.keys;function ei(t){return Vt(t)}function ve(t){return typeof t=="number"&&isNaN(t)===!1}function Se(t){return typeof t=="string"}function He(t){return Array.isArray(t)}function Nb(t){return t}function Lb(t){return k(t)&&typeof t=="object"&&Se(t.id)&&Se(t.target)&&Se(t.sender)}function Mb(t){const e=new Set;function n(s){Lb(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Ae.invoke(s))}const r=hs("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){Ae.disconnect(r)}return{forward:n,disconnect:i}}const Wc=66.666,No=Math.round(1e3/Wc),Ub=3;function Pb(){return location.href.includes("/join/")}function Db(){return location.href.includes("/locked/")}const Gc=hs("clock",[],()=>{});let Hc=0,Lo=0,Vc=0,hf=performance.now();function ff(){const t=performance.now(),e=t-hf,n=Db()?"locked":"";Vc+=e,Vc>=Wc&&(Vc%=Wc,Gc.emit("tick",Lo,n),Gc.emit("tock",Lo,n),++Hc,++Lo,Hc>=No&&(Hc%=No,Gc.emit("second",Lo,n))),hf=t,setTimeout(ff,1)}ff();var df={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(t){(function(){var e=function(f,p){return p=p||"",f.replace(/(^|-)/g,"$1\\u"+p).replace(/,/g,"\\u"+p)},n=e("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+e("DF-F6,F8-FF","00"),i="A-Z"+e("C0-D6,D8-DE","00"),s="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(f,p,m,b){return f=f||n,p=p||r,m=m||i,b=b||s,{capitalize:new RegExp("(^|["+f+"])(["+p+"])","g"),pascal:new RegExp("(^|["+f+"])+(["+p+m+"])","g"),fill:new RegExp("["+f+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+p+"])","g"),improper:new RegExp("\\b("+b+")\\b","g"),relax:new RegExp("([^"+m+"])(["+m+"]*)(["+m+"])(?=[^"+m+"]|$)","g"),upper:new RegExp("^[^"+p+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+f+"]")}},a=o(),c={re:a,unicodes:e,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(f){return c.up.call(f.charAt(0))+f.slice(1)},decap:function(f){return c.low.call(f.charAt(0))+f.slice(1)},deapostrophe:function(f){return f.replace(a.apostrophe,"")},fill:function(f,p,m){return p!=null&&(f=f.replace(a.fill,function(b,_){return _?p+_:""})),m&&(f=c.deapostrophe(f)),f},prep:function(f,p,m,b){if(f=f==null?"":f+"",!b&&a.upper.test(f)&&(f=c.low.call(f)),!p&&!a.hole.test(f)){var _=c.fill(f," ");a.hole.test(_)&&(f=_)}return!m&&!a.room.test(f)&&(f=f.replace(a.relax,c.relax)),f},relax:function(f,p,m,b){return p+" "+(m?m+" ":"")+b}},l={_:c,of:function(f){for(var p=0,m=c.types.length;p<m;p++)if(l[c.types[p]].apply(l,arguments)===f)return c.types[p]},flip:function(f){return f.replace(/\w/g,function(p){return(p==c.up.call(p)?c.low:c.up).call(p)})},random:function(f){return f.replace(/\w/g,function(p){return(Math.round(Math.random())?c.up:c.low).call(p)})},type:function(f,p){l[f]=p,c.types.push(f)}},u={lower:function(f,p,m){return c.fill(c.low.call(c.prep(f,p)),p,m)},snake:function(f){return l.lower(f,"_",!0)},constant:function(f){return l.upper(f,"_",!0)},camel:function(f){return c.decap(l.pascal(f))},kebab:function(f){return l.lower(f,"-",!0)},upper:function(f,p,m){return c.fill(c.up.call(c.prep(f,p,!1,!0)),p,m)},capital:function(f,p,m){return c.fill(c.prep(f).replace(a.capitalize,function(b,_,w){return _+c.up.call(w)}),p,m)},header:function(f){return l.capital(f,"-",!0)},pascal:function(f){return c.fill(c.prep(f,!1,!0).replace(a.pascal,function(p,m,b){return c.up.call(b)}),"",!0)},title:function(f){return l.capital(f).replace(a.improper,function(p,m,b,_){return b>0&&b<_.lastIndexOf(" ")?c.low.call(p):p})},sentence:function(f,p,m){return f=l.lower(f).replace(a.sentence,function(b,_,w){return _+c.up.call(w)}),p&&p.forEach(function(b){f=f.replace(new RegExp("\\b"+l.lower(b)+"\\b","g"),c.cap)}),m&&m.forEach(function(b){f=f.replace(new RegExp("(\\b"+l.lower(b)+"\\. +)(\\w)"),function(_,w,v){return w+c.low.call(v)})}),f}};u.squish=u.pascal,l.default=l;for(var h in u)l.type(h,u[h]);var d=typeof d=="function"?d:function(){};d(t.exports?t.exports=l:this.Case=l)}).call(Pt)})(df);var Bb=df.exports,Fb=Ci(Bb);function ds(){return ds=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ds.apply(this,arguments)}function $b(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Kc(t,e)}function Kc(t,e){return Kc=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Kc(t,e)}function jb(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var pf=function(){function t(n){this.trigger=n,this.observing=new Map}var e=t.prototype;return e.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},e.removeObservers=function(){var r=this;this.observing.forEach(function(i,s){i.iterate&&s[yt].connections.iterate.delete(r),i.byKey.forEach(function(o){s[yt].connections.byKey.get(o).delete(r)})}),this.observing.clear()},t}(),ti=[],Mo=function(t){$b(e,t);function e(r,i,s){var o;if(o=t.call(this,function(){return o._trigger()})||this,o.func=r,o.options=i,o.effect=s,o.isInitial=!0,o.reaction=function(){ti.push(jb(o));try{o.func()}finally{ti.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!s&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=e.prototype;return n._trigger=function(){if(ti.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},e}(pf);function mf(){return!!ti.length}function gf(){return ti.length?ti[ti.length-1]:void 0}function zb(t,e,n){var r=ds({name:"unnamed",fireImmediately:!0},n),i=new Mo(t,r,e);return i}var Uo=0;function yf(){return Uo>0}function qc(t){Uo++;try{return t()}finally{Uo--,Uo===0&&Gb()}}var Xc=!1;function _f(){return Xc}function bf(t){Xc=!0;try{t()}finally{Xc=!1}}function Wb(t){return function(){return bf(t)}}var Zc=[];function Gb(){var t=[].concat(Zc);Zc=[],wf(t)}function wf(t){var e=new Set;t.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[yt].connections.iterate.forEach(function(i){e.add(i)}),(r=n.observable[yt].connections.byKey.get(n.key))==null||r.forEach(function(i){e.add(i)})}),e.forEach(function(n){n.trigger()})}function Po(t){if(yf()){Zc.push(t);return}wf([t])}function vf(t,e){if(t.type==="iterate")t.observable[yt].connections.iterate.add(e);else{var n=t.observable[yt].connections.byKey.get(t.key);n||(n=new Set,t.observable[yt].connections.byKey.set(t.key,n)),n.add(e)}}function Do(t,e){if(!_f()){var n=gf();n&&(vf(t,n),n.registerConnection(t)),e&&(vf(t,e),e.registerConnection(t))}}var Jc=Symbol("$skipreactive"),yt=Symbol("$reactive"),cn=Symbol("$reactiveproxy");function ps(t,e){return!!(t&&t[cn]&&t[cn].implicitObserver===e)}function Yc(t){return t[Jc]=!0,t}function Ef(t){return!!(t&&!ps(t)&&t[yt])}function Qc(t,e,n){if(n===void 0&&(n=!1),t[Jc]||ps(t,e))return t;var r=Hb(t,n);if(!e)return r;var i=r[yt].proxiesWithImplicitObserver.get(e);if(!i){var s={implicitObserver:e};Object.setPrototypeOf(s,kf),i=new Proxy(r[yt].raw,s),r[yt].proxiesWithImplicitObserver.set(e,i)}return i}var ms=Qc;function Hb(t,e){if(e===void 0&&(e=!1),ps(t))return t;if(Ef(t))return t[yt].proxy;if(t[yt]||t[cn])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:t,proxiesWithImplicitObserver:new Map,shallow:e};Object.defineProperty(t,yt,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(t,kf);return n.proxy=r,r}var kf={has:function(e,n){var r=Reflect.has(e,n);return typeof n=="symbol"||Do({observable:e,key:n,type:"has"},this.implicitObserver),r},get:function(e,n,r){if(n===cn)return{implicitObserver:this.implicitObserver};var i=Reflect.get(e,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),i;if(n==="length"&&Array.isArray(e)?Do({observable:e,type:"iterate"},this.implicitObserver):Do({observable:e,key:n,type:"get"},this.implicitObserver),Ef(i))return Qc(i,this.implicitObserver);if(e[yt].shallow)return i;if(typeof i=="object"&&i!==null&&!ps(i,this.implicitObserver)&&!Object.isFrozen(i)){var s=Reflect.getOwnPropertyDescriptor(e,n);if((!s||!(s.writable===!1&&s.configurable===!1))&&(mf()||this.implicitObserver))return Qc(i,this.implicitObserver)}return i},ownKeys:function(e){return Do({observable:e,type:"iterate"},this.implicitObserver),Reflect.ownKeys(e)},set:function(e,n,r,i){return qc(function(){if(typeof n=="symbol")return Reflect.set(e,n,r,i);var s=Object.hasOwnProperty.call(e,n),o=Reflect.get(e,n,i),a=Reflect.set(e,n,r,i);if(!s)Po({observable:e,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(e)){if(!(o<r))for(var c=r+1;c<=o;c++)Po({observable:e,key:""+(c-1),oldValue:void 0,type:"delete"})}else Po({observable:e,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(e,n){return qc(function(){if(typeof n=="symbol")return Reflect.deleteProperty(e,n);var r=Object.hasOwnProperty.call(e,n),i=Reflect.get(e,n),s=Reflect.deleteProperty(e,n);return r&&Po({observable:e,key:n,oldValue:i,type:"delete"}),s})},preventExtensions:function(e){throw new Error("Dynamic observable objects cannot be frozen")}};function Vb(t,e){var n=ds({name:"unnamed",fireImmediately:!0},e),r=new Mo(t,n);return r}function Kb(t,e,n){var r=ds({name:"unnamed",fireImmediately:!0},n),i=new Mo(function(){t(e)},r);return e=ms(e,i),r.fireImmediately&&i.trigger(),i}var Sf=function(){function t(){this._observable=ms({_key:1})}var e=t.prototype;return e.reportObserved=function(r){return ms(this._observable,r)._key},e.reportChanged=function(){this._observable._key++},t}();function qb(t,e,n){return new Sf}var Xb=Object.freeze({__proto__:null,$reactive:yt,$reactiveproxy:cn,$skipreactive:Jc,Atom:Sf,Observer:pf,Reaction:Mo,autorun:Vb,autorunAsync:Kb,createAtom:qb,hasRunningReaction:mf,isActionRunning:yf,isReactive:ps,isTrackingDisabled:_f,markRaw:Yc,reaction:zb,reactive:ms,runInAction:qc,runningReaction:gf,untracked:bf,untrackedCB:Wb});const An=()=>new Map,el=t=>{const e=An();return t.forEach((n,r)=>{e.set(r,n)}),e},Cr=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},Zb=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},Jb=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},Li=()=>new Set,tl=t=>t[t.length-1],Yb=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Nr=Array.from,Qb=Array.isArray;class ew{constructor(){this._observers=An()}on(e,n){return Cr(this._observers,e,Li).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Nr((this._observers.get(e)||An()).values()).forEach(r=>r(...n))}destroy(){this._observers=An()}}const Lr=Math.floor,Bo=Math.abs,Af=(t,e)=>t<e?t:e,ni=(t,e)=>t>e?t:e,xf=t=>t!==0?t<0:1/t<0,Tf=1,Rf=2,nl=4,rl=8,gs=32,ar=64,tn=128,Fo=31,il=63,ri=127,tw=2147483647,If=Number.MAX_SAFE_INTEGER,nw=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Lr(t)===t),rw=t=>t.toLowerCase(),iw=/^\s*/g,sw=t=>t.replace(iw,""),ow=/([A-Z])/g,Of=(t,e)=>sw(t.replace(ow,n=>`${e}${rw(n)}`)),aw=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},ys=typeof TextEncoder<"u"?new TextEncoder:null,cw=ys?t=>ys.encode(t):aw;let _s=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});_s&&_s.decode(new Uint8Array).length===1&&(_s=null);class bs{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Mr=()=>new bs,lw=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},xn=t=>{const e=new Uint8Array(lw(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},uw=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(ni(n,e)*2),t.cpos=0)},St=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},sl=St,Ee=(t,e)=>{for(;e>ri;)St(t,tn|ri&e),e=Lr(e/128);St(t,ri&e)},ol=(t,e)=>{const n=xf(e);for(n&&(e=-e),St(t,(e>il?tn:0)|(n?ar:0)|il&e),e=Lr(e/64);e>0;)St(t,(e>ri?tn:0)|ri&e),e=Lr(e/128)},al=new Uint8Array(3e4),hw=al.length/3,fw=(t,e)=>{if(e.length<hw){const n=ys.encodeInto(e,al).written||0;Ee(t,n);for(let r=0;r<n;r++)St(t,al[r])}else Mt(t,cw(e))},dw=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;Ee(t,r);for(let i=0;i<r;i++)St(t,n.codePointAt(i))},Mi=ys&&ys.encodeInto?fw:dw,$o=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Af(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(ni(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},Mt=(t,e)=>{Ee(t,e.byteLength),$o(t,e)},cl=(t,e)=>{uw(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},pw=(t,e)=>cl(t,4).setFloat32(0,e,!1),mw=(t,e)=>cl(t,8).setFloat64(0,e,!1),gw=(t,e)=>cl(t,8).setBigInt64(0,e,!1),Cf=new DataView(new ArrayBuffer(4)),yw=t=>(Cf.setFloat32(0,t),Cf.getFloat32(0)===t),ws=(t,e)=>{switch(typeof e){case"string":St(t,119),Mi(t,e);break;case"number":nw(e)&&Bo(e)<=tw?(St(t,125),ol(t,e)):yw(e)?(St(t,124),pw(t,e)):(St(t,123),mw(t,e));break;case"bigint":St(t,122),gw(t,e);break;case"object":if(e===null)St(t,126);else if(Qb(e)){St(t,117),Ee(t,e.length);for(let n=0;n<e.length;n++)ws(t,e[n])}else if(e instanceof Uint8Array)St(t,116),Mt(t,e);else{St(t,118);const n=Object.keys(e);Ee(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Mi(t,i),ws(t,e[i])}}break;case"boolean":St(t,e?120:121);break;default:St(t,127)}};class Nf extends bs{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Ee(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Lf=t=>{t.count>0&&(ol(t.encoder,t.count===1?t.s:-t.s),t.count>1&&Ee(t.encoder,t.count-2))};class jo{constructor(){this.encoder=new bs,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Lf(this),this.count=1,this.s=e)}toUint8Array(){return Lf(this),xn(this.encoder)}}const Mf=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);ol(t.encoder,e),t.count>1&&Ee(t.encoder,t.count-2)}};class ll{constructor(){this.encoder=new bs,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Mf(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Mf(this),xn(this.encoder)}}class _w{constructor(){this.sarr=[],this.s="",this.lensE=new jo}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new bs;return this.sarr.push(this.s),this.s="",Mi(e,this.sarr.join("")),$o(e,this.lensE.toUint8Array()),xn(e)}}const Ur=t=>new Error(t),Dn=()=>{throw Ur("Method unimplemented")},Bn=()=>{throw Ur("Unexpected case")},Uf=Ur("Unexpected end of array"),Pf=Ur("Integer out of Range");class zo{constructor(e){this.arr=e,this.pos=0}}const ii=t=>new zo(t),bw=t=>t.pos!==t.arr.length,ww=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Dt=t=>ww(t,ke(t)),Ui=t=>t.arr[t.pos++],ke=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&ri)*n,n*=128,i<tn)return e;if(e>If)throw Pf}throw Uf},ul=t=>{let e=t.arr[t.pos++],n=e&il,r=64;const i=(e&ar)>0?-1:1;if(!(e&tn))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&ri)*r,r*=128,e<tn)return i*n;if(n>If)throw Pf}throw Uf},Pi=_s?t=>_s.decode(Dt(t)):t=>{let e=ke(t);if(e===0)return"";{let n=String.fromCodePoint(Ui(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Ui(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},hl=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},vw=[t=>{},t=>null,ul,t=>hl(t,4).getFloat32(0,!1),t=>hl(t,8).getFloat64(0,!1),t=>hl(t,8).getBigInt64(0,!1),t=>!1,t=>!0,Pi,t=>{const e=ke(t),n={};for(let r=0;r<e;r++){const i=Pi(t);n[i]=vs(t)}return n},t=>{const e=ke(t),n=[];for(let r=0;r<e;r++)n.push(vs(t));return n},Dt],vs=t=>vw[127-Ui(t)](t);class Df extends zo{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),bw(this)?this.count=ke(this)+1:this.count=-1),this.count--,this.s}}class Wo extends zo{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=ul(this);const e=xf(this.s);this.count=1,e&&(this.s=-this.s,this.count=ke(this)+2)}return this.count--,this.s}}class fl extends zo{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=ul(this),n=e&1;this.diff=Lr(e/2),this.count=1,n&&(this.count=ke(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Ew{constructor(e){this.decoder=new Wo(e),this.str=Pi(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const kw=crypto.getRandomValues.bind(crypto),Bf=()=>kw(new Uint32Array(1))[0],Sw="10000000-1000-4000-8000"+-1e11,Aw=()=>Sw.replace(/[018]/g,t=>(t^Bf()&15>>t/4).toString(16)),Ff=t=>new Promise(t);Promise.all.bind(Promise);const $f=t=>t===void 0?null:t;class xw{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let jf=new xw,Tw=!0;try{typeof localStorage<"u"&&localStorage&&(jf=localStorage,Tw=!1)}catch{}const Rw=jf,Iw=Object.assign,Ow=Object.keys,Cw=(t,e)=>{for(const n in t)e(t[n],n)},zf=t=>Ow(t).length,Nw=t=>{for(const e in t)return!1;return!0},Lw=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Mw=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Uw=(t,e)=>t===e||zf(t)===zf(e)&&Lw(t,(n,r)=>(n!==void 0||Mw(e,r))&&e[r]===n),Pw=Object.freeze,Wf=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Wf(t[e])}return Pw(t)},dl=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&dl(t,e,n+1)}},Dw=t=>t,Bw=(t,e)=>e.includes(t);var Gf={};const Es=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Fn;const Fw=()=>{if(Fn===void 0)if(Es){Fn=An();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Fn.set(e,""),e=r):e!==null&&(Fn.set(e,r),e=null)}e!==null&&Fn.set(e,"")}else typeof location=="object"?(Fn=An(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Fn.set(`--${Of(e,"-")}`,n),Fn.set(`-${Of(e,"-")}`,n)}})):Fn=An();return Fn},pl=t=>Fw().has(t),Go=t=>$f(Es?Gf[t.toUpperCase().replaceAll("-","_")]:Rw.getItem(t)),Hf=t=>pl("--"+t)||Go(t)!==null;Hf("production");const $w=Es&&Bw(Gf.FORCE_COLOR,["true","1","2"])||!pl("--no-colors")&&!Hf("no-color")&&(!Es||process.stdout.isTTY)&&(!Es||pl("--color")||Go("COLORTERM")!==null||(Go("TERM")||"").includes("color")),jw=t=>new Uint8Array(t),zw=t=>{const e=jw(t.byteLength);return e.set(t),e};class Ww{constructor(e,n){this.left=e,this.right=n}}const cr=(t,e)=>new Ww(t,e);typeof DOMParser<"u"&&new DOMParser;const Gw=t=>Zb(t,(e,n)=>`${n}:${e};`).join(""),lr=Symbol,Vf=lr(),Kf=lr(),Hw=lr(),Vw=lr(),Kw=lr(),qf=lr(),qw=lr(),ml=lr(),Xw=lr(),Zw=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},Jw={[Vf]:cr("font-weight","bold"),[Kf]:cr("font-weight","normal"),[Hw]:cr("color","blue"),[Kw]:cr("color","green"),[Vw]:cr("color","grey"),[qf]:cr("color","red"),[qw]:cr("color","purple"),[ml]:cr("color","orange"),[Xw]:cr("color","black")},Xf=$w?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=An();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=Jw[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=Gw(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:Zw,Yw=(...t)=>{console.log(...Xf(t)),Zf.forEach(e=>e.print(t))},Qw=(...t)=>{console.warn(...Xf(t)),t.unshift(ml),Zf.forEach(e=>e.print(t))},Zf=Li(),Jf=t=>({[Symbol.iterator](){return this},next:t}),ev=(t,e)=>Jf(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),gl=(t,e)=>Jf(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class yl{constructor(e,n){this.clock=e,this.len=n}}class ks{constructor(){this.clients=new Map}}const Yf=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];gd(t,s,a.clock,a.len,n)}}),tv=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Lr((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},Qf=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&tv(n,e.clock)!==null},_l=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=ni(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},nv=t=>{const e=new ks;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)Yb(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return _l(e),e},Ho=(t,e,n,r)=>{Cr(t.clients,e,()=>[]).push(new yl(n,r))},rv=()=>new ks,iv=t=>{const e=rv();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new yl(a,c))}}i.length>0&&e.clients.set(r,i)}),e},Di=(t,e)=>{Ee(t.restEncoder,e.clients.size),Nr(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),Ee(t.restEncoder,n);const i=r.length;Ee(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},bl=t=>{const e=new ks,n=ke(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=ke(t.restDecoder),s=ke(t.restDecoder);if(s>0){const o=Cr(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new yl(t.readDsClock(),t.readDsLen()))}}return e},ed=(t,e,n)=>{const r=new ks,i=ke(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=ke(t.restDecoder),a=ke(t.restDecoder),c=n.clients.get(o)||[],l=At(n,o);for(let u=0;u<a;u++){const h=t.readDsClock(),d=h+t.readDsLen();if(h<l){l<d&&Ho(r,o,l,d-l);let f=Tn(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,ia(e,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,ia(e,p,d-p.id.clock)),p.delete(e))}else Ho(r,o,h,d-h)}}if(r.clients.size>0){const s=new si;return Ee(s.restEncoder,0),Di(s,r),s.toUint8Array()}return null},td=Bf;class ur extends ew{constructor({guid:e=Aw(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=td(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new dd,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Ff(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Ff(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Ve(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Nr(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Ve(this,e,n)}get(e,n=ot){const r=Cr(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==ot&&i!==n)if(i===ot){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,$n)}getText(e=""){return this.get(e,Rn)}getMap(e=""){return this.get(e,jn)}getXmlElement(e=""){return this.get(e,hr)}getXmlFragment(e=""){return this.get(e,zn)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Nr(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new ur({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Ve(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class nd{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return ke(this.restDecoder)}readDsLen(){return ke(this.restDecoder)}}class rd extends nd{readLeftID(){return Oe(ke(this.restDecoder),ke(this.restDecoder))}readRightID(){return Oe(ke(this.restDecoder),ke(this.restDecoder))}readClient(){return ke(this.restDecoder)}readInfo(){return Ui(this.restDecoder)}readString(){return Pi(this.restDecoder)}readParentInfo(){return ke(this.restDecoder)===1}readTypeRef(){return ke(this.restDecoder)}readLen(){return ke(this.restDecoder)}readAny(){return vs(this.restDecoder)}readBuf(){return zw(Dt(this.restDecoder))}readJSON(){return JSON.parse(Pi(this.restDecoder))}readKey(){return Pi(this.restDecoder)}}class sv{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ke(this.restDecoder),this.dsCurrVal}readDsLen(){const e=ke(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Bi extends sv{constructor(e){super(e),this.keys=[],ke(e),this.keyClockDecoder=new fl(Dt(e)),this.clientDecoder=new Wo(Dt(e)),this.leftClockDecoder=new fl(Dt(e)),this.rightClockDecoder=new fl(Dt(e)),this.infoDecoder=new Df(Dt(e),Ui),this.stringDecoder=new Ew(Dt(e)),this.parentInfoDecoder=new Df(Dt(e),Ui),this.typeRefDecoder=new Wo(Dt(e)),this.lenDecoder=new Wo(Dt(e))}readLeftID(){return new Fi(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Fi(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return vs(this.restDecoder)}readBuf(){return Dt(this.restDecoder)}readJSON(){return vs(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class id{constructor(){this.restEncoder=Mr()}toUint8Array(){return xn(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Ee(this.restEncoder,e)}writeDsLen(e){Ee(this.restEncoder,e)}}class Ss extends id{writeLeftID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeRightID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeClient(e){Ee(this.restEncoder,e)}writeInfo(e){sl(this.restEncoder,e)}writeString(e){Mi(this.restEncoder,e)}writeParentInfo(e){Ee(this.restEncoder,e?1:0)}writeTypeRef(e){Ee(this.restEncoder,e)}writeLen(e){Ee(this.restEncoder,e)}writeAny(e){ws(this.restEncoder,e)}writeBuf(e){Mt(this.restEncoder,e)}writeJSON(e){Mi(this.restEncoder,JSON.stringify(e))}writeKey(e){Mi(this.restEncoder,e)}}class sd{constructor(){this.restEncoder=Mr(),this.dsCurrVal=0}toUint8Array(){return xn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,Ee(this.restEncoder,n)}writeDsLen(e){e===0&&Bn(),Ee(this.restEncoder,e-1),this.dsCurrVal+=e}}class si extends sd{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ll,this.clientEncoder=new jo,this.leftClockEncoder=new ll,this.rightClockEncoder=new ll,this.infoEncoder=new Nf(sl),this.stringEncoder=new _w,this.parentInfoEncoder=new Nf(sl),this.typeRefEncoder=new jo,this.lenEncoder=new jo}toUint8Array(){const e=Mr();return Ee(e,0),Mt(e,this.keyClockEncoder.toUint8Array()),Mt(e,this.clientEncoder.toUint8Array()),Mt(e,this.leftClockEncoder.toUint8Array()),Mt(e,this.rightClockEncoder.toUint8Array()),Mt(e,xn(this.infoEncoder)),Mt(e,this.stringEncoder.toUint8Array()),Mt(e,xn(this.parentInfoEncoder)),Mt(e,this.typeRefEncoder.toUint8Array()),Mt(e,this.lenEncoder.toUint8Array()),$o(e,xn(this.restEncoder)),xn(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ws(this.restEncoder,e)}writeBuf(e){Mt(this.restEncoder,e)}writeJSON(e){ws(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const ov=(t,e,n,r)=>{r=ni(r,e[0].id.clock);const i=Tn(e,r);Ee(t.restEncoder,e.length-i),t.writeClient(n),Ee(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},wl=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{At(e,s)>i&&r.set(s,i)}),Ko(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Ee(t.restEncoder,r.size),Nr(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{ov(t,e.clients.get(i),i,s)})},av=(t,e)=>{const n=An(),r=ke(t.restDecoder);for(let i=0;i<r;i++){const s=ke(t.restDecoder),o=new Array(s),a=t.readClient();let c=ke(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(Fo&u){case 0:{const h=t.readLen();o[l]=new nn(Oe(a,c),h),c+=h;break}case 10:{const h=ke(t.restDecoder);o[l]=new ln(Oe(a,c),h),c+=h;break}default:{const h=(u&(ar|tn))===0,d=new bt(Oe(a,c),null,(u&tn)===tn?t.readLeftID():null,null,(u&ar)===ar?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(u&gs)===gs?t.readString():null,jd(t,u));o[l]=d,c+=d.length}}}}return n},cv=(t,e,n)=>{const r=[];let i=Nr(n.keys()).sort((f,p)=>f-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=n.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=n.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new dd,c=new Map,l=(f,p)=>{const m=c.get(f);(m==null||m>p)&&c.set(f,p)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[f]),i=i.filter(b=>b!==p)}r.length=0};for(;;){if(u.constructor!==ln){const p=Cr(h,u.id.client,()=>At(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const b=n.get(m)||{refs:[],i:0};if(b.refs.length===b.i)l(m,At(e,m)),d();else{u=b.refs[b.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new si;return wl(f,a,new Map),Ee(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},lv=(t,e)=>wl(t,e.doc.store,e.beforeState),uv=(t,e,n,r=new Bi(t))=>Ve(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=av(r,o),l=cv(i,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<At(a,d)){s=!0;break}if(l){for(const[d,f]of l.missing){const p=u.missing.get(d);(p==null||p>f)&&u.missing.set(d,f)}u.update=Xo([u.update,l.update])}}else a.pendingStructs=l;const h=ed(r,i,a);if(a.pendingDs){const d=new Bi(ii(a.pendingDs));ke(d.restDecoder);const f=ed(d,i,a);h&&f?a.pendingDs=Xo([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,od(i.doc,d)}},n,!1),od=(t,e,n,r=Bi)=>{const i=ii(e);uv(i,t,n,new r(i))},hv=(t,e,n)=>od(t,e,n,rd),fv=(t,e,n=new Map)=>{wl(t,e.store,n),Di(t,iv(e.store))},dv=(t,e=new Uint8Array([0]),n=new si)=>{const r=ad(e);fv(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(Rv(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Ss)return xv(i.map((s,o)=>o===0?s:Ov(s)));if(n.constructor===si)return Xo(i)}return i[0]},pv=(t,e)=>dv(t,e,new Ss),mv=t=>{const e=new Map,n=ke(t.restDecoder);for(let r=0;r<n;r++){const i=ke(t.restDecoder),s=ke(t.restDecoder);e.set(i,s)}return e},ad=t=>mv(new nd(ii(t))),cd=(t,e)=>(Ee(t.restEncoder,e.size),Nr(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{Ee(t.restEncoder,n),Ee(t.restEncoder,r)}),t),gv=(t,e)=>cd(t,Ko(e.store)),yv=(t,e=new sd)=>(t instanceof Map?cd(e,t):gv(e,t),e.toUint8Array()),_v=t=>yv(t,new id);class bv{constructor(){this.l=[]}}const ld=()=>new bv,ud=(t,e)=>t.l.push(e),hd=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},fd=(t,e,n)=>dl(t.l,[e,n]);class Fi{constructor(e,n){this.client=e,this.clock=n}}const Vo=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Oe=(t,e)=>new Fi(t,e),wv=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Bn()},$i=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Qf(e.ds,t.id),vl=(t,e)=>{const n=Cr(t.meta,vl,Li),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<At(r,s)&&Pr(t,Oe(s,i))}),Yf(t,e.ds,i=>{}),n.add(e))};class dd{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ko=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},At=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},pd=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Bn()}n.push(e)},Tn=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=Lr(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=Lr((n+r)/2)}throw Bn()},El=(t,e)=>{const n=t.clients.get(e.client);return n[Tn(n,e.clock)]},kl=(t,e,n)=>{const r=Tn(e,n),i=e[r];return i.id.clock<n&&i instanceof bt?(e.splice(r+1,0,ia(t,i,n-i.id.clock)),r+1):r},Pr=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[kl(t,n,e.clock)]},md=(t,e,n)=>{const r=e.clients.get(n.client),i=Tn(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==nn&&r.splice(i+1,0,ia(t,s,n.clock-s.id.clock+1)),s},vv=(t,e,n)=>{const r=t.clients.get(e.id.client);r[Tn(r,e.id.clock)]=n},gd=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=kl(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&kl(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class Ev{constructor(e,n,r){this.doc=e,this.deleteSet=new ks,this.beforeState=Ko(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const yd=(t,e)=>e.deleteSet.clients.size===0&&!Jb(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(_l(e.deleteSet),lv(t,e),Di(t,e.deleteSet),!0),_d=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Cr(t.changed,e,Li).add(n)},qo=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof bt&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},kv=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Tn(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof bt&&h.deleted&&!h.keep&&n(h)&&h.gc(e,!1)}}}},Sv=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Af(i.length-1,1+Tn(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+qo(i,c)}})},bd=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{_l(s),n.afterState=Ko(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),fd(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),dl(a,[]),n._needFormattingCleanup&&Gv(n)}finally{r.gc&&kv(s,i,r.gcFilter),Sv(s,i),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=i.clients.get(h),p=ni(Tn(f,d),1);for(let m=f.length-1;m>=p;)m-=1+qo(f,m)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=i.clients.get(h),p=Tn(f,d);p+1<f.length&&qo(f,p+1)>1||p>0&&qo(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Yw(ml,Vf,"[yjs] ",Kf,qf,"Changed the client-id because another client seems to be using it."),r.clientID=td()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Ss;yd(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new si;yd(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):bd(t,e+1)}}},Ve=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new Ev(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&bd(i,0)}}return o};function*Av(t){const e=ke(t.restDecoder);for(let n=0;n<e;n++){const r=ke(t.restDecoder),i=t.readClient();let s=ke(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=ke(t.restDecoder);yield new ln(Oe(i,s),c),s+=c}else if(Fo&a){const c=(a&(ar|tn))===0,l=new bt(Oe(i,s),null,(a&tn)===tn?t.readLeftID():null,null,(a&ar)===ar?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&gs)===gs?t.readString():null,jd(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new nn(Oe(i,s),c),s+=c}}}}class Sl{constructor(e,n){this.gen=Av(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ln);return this.curr}}class Al{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const xv=t=>Xo(t,rd,Ss),Tv=(t,e)=>{if(t.constructor===nn){const{client:n,clock:r}=t.id;return new nn(Oe(n,r+e),t.length-e)}else if(t.constructor===ln){const{client:n,clock:r}=t.id;return new ln(Oe(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new bt(Oe(r,i+e),null,Oe(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Xo=(t,e=Bi,n=si)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(ii(u)));let i=r.map(u=>new Sl(u,!0)),s=null;const o=new n,a=new Al(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===ln?1:-1:p}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Dr(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===ln)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Dr(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new ln(Oe(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===ln?s.struct.length-=p:d=Tv(d,p)),s.struct.mergeWith(d)||(Dr(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==ln;d=u.next())Dr(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Dr(a,s.struct,s.offset),s=null),xl(a);const c=r.map(u=>bl(u)),l=nv(c);return Di(o,l),o.toUint8Array()},Rv=(t,e,n=Bi,r=si)=>{const i=ad(e),s=new r,o=new Al(s),a=new n(ii(t)),c=new Sl(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=i.get(h)||0;if(c.curr.constructor===ln){c.next();continue}if(u.id.clock+u.length>d)for(Dr(o,u,ni(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Dr(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}xl(o);const l=bl(a);return Di(s,l),s.toUint8Array()},wd=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:xn(t.encoder.restEncoder)}),t.encoder.restEncoder=Mr(),t.written=0)},Dr=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&wd(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),Ee(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},xl=t=>{wd(t);const e=t.encoder.restEncoder;Ee(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];Ee(e,r.written),$o(e,r.restEncoder)}},Iv=(t,e,n,r)=>{const i=new n(ii(t)),s=new Sl(i,!1),o=new r,a=new Al(o);for(let l=s.curr;l!==null;l=s.next())Dr(a,e(l),0);xl(a);const c=bl(i);return Di(o,c),o.toUint8Array()},Ov=t=>Iv(t,Dw,Bi,Ss),vd="You must not compute changes after the event-handler fired.";class Zo{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Cv(this.currentTarget,this.target))}deletes(e){return Qf(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ur(vd);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=tl(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=tl(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=tl(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ur(vd);const n=this.target,r=Li(),i=Li(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const Cv=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},Ut=()=>{Qw("Invalid access: Add Yjs type to a document before reading data.")},Ed=80;let Tl=0;class Nv{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Tl++}}const Lv=t=>{t.timestamp=Tl++},kd=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Tl++},Mv=(t,e,n)=>{if(t.length>=Ed){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return kd(r,e,n),r}else{const r=new Nv(e,n);return t.push(r),r}},Jo=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>Bo(e-s.index)<Bo(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,Lv(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Bo(n.index-i)<r.parent.length/Ed?(kd(n,r,i),n):Mv(t._searchMarker,r,i)},As=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=ni(e,i.index+n))}},Yo=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Cr(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;fd(r._eH,n,e)};class ot{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ld(),this._dEH=ld(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Dn()}clone(){throw Dn()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){ud(this._eH,e)}observeDeep(e){ud(this._dEH,e)}unobserve(e){hd(this._eH,e)}unobserveDeep(e){hd(this._dEH,e)}toJSON(){}}const Sd=(t,e,n)=>{t.doc??Ut(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},Ad=t=>{t.doc??Ut();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},xs=(t,e)=>{let n=0,r=t._start;for(t.doc??Ut();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},xd=(t,e)=>{const n=[];return xs(t,(r,i)=>{n.push(e(r,i,t))}),n},Uv=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Td=(t,e)=>{t.doc??Ut();const n=Jo(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Qo=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new bt(Oe(o,At(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new ci(l)),i.integrate(t,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new bt(Oe(o,At(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ts(new Uint8Array(h))),i.integrate(t,0);break;case ur:i=new bt(Oe(o,At(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Is(h)),i.integrate(t,0);break;default:if(h instanceof ot)i=new bt(Oe(o,At(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new fr(h)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Rd=()=>Ur("Length exceeded!"),Id=(t,e,n,r)=>{if(n>e._length)throw Rd();if(n===0)return e._searchMarker&&As(e._searchMarker,n,r.length),Qo(t,e,null,r);const i=n,s=Jo(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Pr(t,Oe(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&As(e._searchMarker,i,r.length),Qo(t,e,o,r)},Pv=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Qo(t,e,i,n)},Od=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=Jo(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Pr(t,Oe(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Pr(t,Oe(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw Rd();e._searchMarker&&As(e._searchMarker,i,-s+r)},ea=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Rl=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new ci([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ci([r]);break;case Uint8Array:a=new Ts(r);break;case ur:a=new Is(r);break;default:if(r instanceof ot)a=new fr(r);else throw new Error("Unexpected content type")}new bt(Oe(o,At(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Il=(t,e)=>{t.doc??Ut();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Cd=t=>{const e={};return t.doc??Ut(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},Nd=(t,e)=>{t.doc??Ut();const n=t._map.get(e);return n!==void 0&&!n.deleted},Dv=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&$i(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},ta=t=>(t.doc??Ut(),ev(t._map.entries(),e=>!e[1].deleted));class Bv extends Zo{}class $n extends ot{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new $n;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $n}clone(){const e=new $n;return e.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),e}get length(){return this.doc??Ut(),this._length}_callObserver(e,n){super._callObserver(e,n),Yo(this,e,new Bv(this,e))}insert(e,n){this.doc!==null?Ve(this.doc,r=>{Id(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Ve(this.doc,n=>{Pv(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Ve(this.doc,r=>{Od(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return Td(this,e)}toArray(){return Ad(this)}slice(e=0,n=this.length){return Sd(this,e,n)}toJSON(){return this.map(e=>e instanceof ot?e.toJSON():e)}map(e){return xd(this,e)}forEach(e){xs(this,e)}[Symbol.iterator](){return Uv(this)}_write(e){e.writeTypeRef(lE)}}const Fv=t=>new $n;class $v extends Zo{constructor(e,n,r){super(e,n),this.keysChanged=r}}class jn extends ot{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new jn}clone(){const e=new jn;return this.forEach((n,r)=>{e.set(r,n instanceof ot?n.clone():n)}),e}_callObserver(e,n){Yo(this,e,new $v(this,e,n))}toJSON(){this.doc??Ut();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof ot?i.toJSON():i}}),e}get size(){return[...ta(this)].length}keys(){return gl(ta(this),e=>e[0])}values(){return gl(ta(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return gl(ta(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??Ut(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ve(this.doc,n=>{ea(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Ve(this.doc,r=>{Rl(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Il(this,e)}has(e){return Nd(this,e)}clear(){this.doc!==null?Ve(this.doc,e=>{this.forEach(function(n,r,i){ea(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(uE)}}const jv=t=>new jn,Br=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Uw(t,e);class Ol{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Bn(),this.right.content.constructor){case _t:this.right.deleted||ji(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Ld=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case _t:e.right.deleted||ji(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Pr(t,Oe(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},na=(t,e,n,r)=>{const i=new Map,s=r?Jo(e,n):null;if(s){const o=new Ol(s.p.left,s.p,s.index,i);return Ld(t,o,n-s.index)}else{const o=new Ol(null,e._start,0,i);return Ld(t,o,n)}},Md=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===_t&&Br(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new bt(Oe(s,At(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new _t(a,o));u.integrate(t,0),n.right=u,n.forward()})},ji=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Ud=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===_t&&Br(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Pd=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Br(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new bt(Oe(s,At(i.store,s)),u,u&&u.lastId,h,h&&h.id,e,null,new _t(a,c)),n.right.integrate(t,0),n.forward()}}return o},Cl=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=t.doc,o=s.clientID;Ud(n,i);const a=Pd(t,e,n,i),c=r.constructor===String?new Wn(r):r instanceof ot?new fr(r):new ai(r);let{left:l,right:u,index:h}=n;e._searchMarker&&As(e._searchMarker,n.index,c.getLength()),u=new bt(Oe(o,At(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=h,n.forward(),Md(t,e,n,a)},Dd=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;Ud(n,i);const a=Pd(t,e,n,i);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===_t));){if(!n.right.deleted)switch(n.right.content.constructor){case _t:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(Br(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Pr(t,Oe(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new bt(Oe(o,At(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Wn(c)),n.right.integrate(t,0),n.forward()}Md(t,e,n,a)},Bd=(t,e,n,r,i)=>{let s=e;const o=An();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===_t){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case _t:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(e.delete(t),a++,!c&&(i.get(u)??null)===h&&d!==h&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&ji(i,l);break}}}e=e.right}return a},zv=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===_t){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},Wv=t=>{let e=0;return Ve(t.doc,n=>{let r=t._start,i=t._start,s=An();const o=el(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case _t:ji(o,i.content);break;default:e+=Bd(n,r,i,s,o),s=el(o),r=i;break}i=i.right}}),e},Gv=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&gd(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===_t&&o.constructor!==nn&&e.add(o.parent)})}Ve(n,r=>{Yf(t,t.deleteSet,i=>{if(i instanceof nn||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===_t?e.add(s):zv(r,i)});for(const i of e)Wv(i)})},Fd=(t,e,n)=>{const r=n,i=el(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case fr:case ai:case Wn:n<e.right.length&&Pr(t,Oe(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&Bd(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&As(o._searchMarker,e.index,-r+n),e};class Hv extends Zo{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Ve(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},i.size>0&&(f.attributes={},i.forEach((p,m)=>{p!==null&&(f.attributes[m]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},Nw(c)||(f.attributes=Iw({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case fr:case ai:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Wn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case _t:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(f)??null;Br(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),Br(p,s.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){s.set(f,p);const m=i.get(f)??null;Br(m,p)||(a==="retain"&&d(),c[f]=m)}else if(!o.deleted){s.set(f,p);const m=c[f];m!==void 0&&(Br(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),ji(i,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Rn extends ot{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Ut(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Rn}clone(){const e=new Rn;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new Hv(this,e,n);Yo(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??Ut();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Wn&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Ve(this.doc,r=>{const i=new Ol(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Cl(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Dd(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Fd(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??Ut();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;s.forEach((p,m)=>{d=!0,h[m]=p});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const u=()=>{for(;c!==null;){if($i(c,e)||n!==void 0&&$i(c,n))switch(c.content.constructor){case Wn:{const h=s.get("ychange");e!==void 0&&!$i(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!$i(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case fr:case ai:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,p)=>{d[p]=f})}i.push(h);break}case _t:$i(c,e)&&(l(),ji(s,c.content));break}c=c.right}l()};return e||n?Ve(o,h=>{e&&vl(h,e),n&&vl(h,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?Ve(i,s=>{const o=na(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Cl(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?Ve(i,s=>{const o=na(s,this,e,!r);Cl(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Ve(r,i=>{Fd(i,na(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?Ve(i,s=>{const o=na(s,this,e,!1);o.right!==null&&Dd(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Ve(this.doc,n=>{ea(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Ve(this.doc,r=>{Rl(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Il(this,e)}getAttributes(){return Cd(this)}_write(e){e.writeTypeRef(hE)}}const Vv=t=>new Rn;class Nl{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??Ut()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===hr||n.constructor===zn)&&n._start!==null)e=n._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class zn extends ot{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new zn}clone(){const e=new zn;return e.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),e}get length(){return this.doc??Ut(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Nl(this,e)}querySelector(e){e=e.toUpperCase();const r=new Nl(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Nr(new Nl(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Yo(this,e,new Xv(this,n,e))}toString(){return xd(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),xs(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?Ve(this.doc,r=>{Id(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Ve(this.doc,r=>{const i=e&&e instanceof ot?e._item:e;Qo(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Ur("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?Ve(this.doc,r=>{Od(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return Ad(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Td(this,e)}slice(e=0,n=this.length){return Sd(this,e,n)}forEach(e){xs(this,e)}_write(e){e.writeTypeRef(dE)}}const Kv=t=>new zn;class hr extends zn{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new hr(this.nodeName)}clone(){const e=new hr(this.nodeName),n=this.getAttributes();return Cw(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof ot?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ve(this.doc,n=>{ea(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Ve(this.doc,r=>{Rl(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Il(this,e)}hasAttribute(e){return Nd(this,e)}getAttributes(e){return e?Dv(this,e):Cd(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return xs(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(fE),e.writeKey(this.nodeName)}}const qv=t=>new hr(t.readKey());class Xv extends Zo{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class zi extends jn{constructor(e){super(),this.hookName=e}_copy(){return new zi(this.hookName)}clone(){const e=new zi(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(pE),e.writeKey(this.hookName)}}const Zv=t=>new zi(t.readKey());class oi extends Rn{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new oi}clone(){const e=new oi;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(mE)}}const Jv=t=>new oi;class Ll{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Dn()}mergeWith(e){return!1}write(e,n,r){throw Dn()}integrate(e,n){throw Dn()}}const Yv=0;class nn extends Ll{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),pd(e.doc.store,this)}write(e,n){e.writeInfo(Yv),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Ts{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ts(this.content)}splice(e){throw Dn()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const Qv=t=>new Ts(t.readBuf());class Rs{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Rs(this.len)}splice(e){const n=new Rs(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){Ho(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const eE=t=>new Rs(t.readLen()),$d=(t,e)=>new ur({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Is{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Is($d(this.doc.guid,this.opts))}splice(e){throw Dn()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const tE=t=>new Is($d(t.readString(),t.readAny()));class ai{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ai(this.embed)}splice(e){throw Dn()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const nE=t=>new ai(t.readJSON());class _t{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new _t(this.key,this.value)}splice(e){throw Dn()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const rE=t=>new _t(t.readKey(),t.readJSON());class ra{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ra(this.arr)}splice(e){const n=new ra(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const iE=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new ra(n)},sE=Go("node_env")==="development";class ci{constructor(e){this.arr=e,sE&&Wf(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ci(this.arr)}splice(e){const n=new ci(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const oE=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new ci(n)};class Wn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Wn(this.str)}splice(e){const n=new Wn(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const aE=t=>new Wn(t.readString()),cE=[Fv,jv,Vv,qv,Kv,Zv,Jv],lE=0,uE=1,hE=2,fE=3,dE=4,pE=5,mE=6;class fr{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new fr(this.type._copy())}splice(e){throw Dn()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const gE=t=>new fr(cE[t.readTypeRef()](t)),ia=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new bt(Oe(r,i+n),e,Oe(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Oe(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class bt extends Ll{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Rf:0}set marker(e){(this.info&rl)>0!==e&&(this.info^=rl)}get marker(){return(this.info&rl)>0}get keep(){return(this.info&Tf)>0}set keep(e){this.keep!==e&&(this.info^=Tf)}get countable(){return(this.info&Rf)>0}get deleted(){return(this.info&nl)>0}set deleted(e){this.deleted!==e&&(this.info^=nl)}markDeleted(){this.info|=nl}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=At(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=At(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Fi&&this.id.client!==this.parent.client&&this.parent.clock>=At(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=md(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Pr(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===nn||this.right&&this.right.constructor===nn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===bt&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===bt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Fi){const r=El(n,this.parent);r.constructor===nn?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=md(e,e.doc.store,Oe(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Vo(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Vo(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(El(e.doc.store,i.origin)))s.has(El(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),pd(e.doc.store,this),this.content.integrate(e,this),_d(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new nn(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Oe(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Vo(e.origin,this.lastId)&&this.right===e&&Vo(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Ho(e.deleteSet,this.id.client,this.id.clock,this.length),_d(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Bn();this.content.gc(e),n?vv(e,this,new nn(this.id,this.length)):this.content=new Rs(this.length)}write(e,n){const r=n>0?Oe(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Fo|(r===null?0:tn)|(i===null?0:ar)|(s===null?0:gs);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=wv(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Fi?(e.writeParentInfo(!1),e.writeLeftID(a)):Bn();s!==null&&e.writeString(s)}this.content.write(e,n)}}const jd=(t,e)=>yE[e&Fo](t),yE=[()=>{Bn()},eE,iE,Qv,aE,nE,rE,gE,oE,tE,()=>{Bn()}],_E=10;class ln extends Ll{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Bn()}write(e,n){e.writeInfo(_E),Ee(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const zd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Wd="__ $YJS$ __";zd[Wd]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),zd[Wd]=!0;let Ml,Ul,bE=t=>t();function wE(t,e){if(Ul)return Ul(t,e);bE(t)}function li(t,e,n){if(Ml)return Ml.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function vE(t){Ml=function(e,n,r){const i=t.createAtom(e);return n&&n(),i},Ul=(e,n)=>t.reaction(e,n,{fireImmediately:!1})}const Gd=new WeakSet;function EE(t){if(Gd.has(t))return t;Gd.add(t);let e;const n=new Map;function r(){if(!e){const h=d=>{(d.changes.added.size||d.changes.deleted.size||d.changes.keys.size||d.changes.delta.length)&&e.reportChanged()};e=li("map",()=>{t.observe(h)},()=>{t.unobserve(h)})}e.reportObserved(t._implicitObserver)}function i(h){let d=n.get(h);if(!d){const f=p=>{d.reportChanged()};d=li(h+"",()=>{t.observe(f)},()=>{t.unobserve(f)}),n.set(h,d)}d.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(h){if(typeof h!="number")throw new Error("unexpected");return i(h),Reflect.apply(s,this,arguments)};function o(h){const d=t[h];t[h]=function(){return r(),Reflect.apply(d,this,arguments)}}function a(h){let d=t,f=Object.getOwnPropertyDescriptor(d,h);if(f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),!f)throw new Error("property not found");const p=f.get;f.get=function(){return this._disableTracking||r(),Reflect.apply(p,this,arguments)},Object.defineProperty(t,h,f)}function c(h,d){let f=t,p=Object.getOwnPropertyDescriptor(f,h);if(p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),!p)throw new Error("property not found");Object.defineProperty(t,d,p)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const l=t.push;t.push=function(h){this._disableTracking=!0;const d=l.call(this,h);return this._disableTracking=!1,d};const u=t.slice;return t.slice=function(h,d){this._disableTracking=!0;const f=u.call(this,h,d);return this._disableTracking=!1,f},t}const Hd=new WeakSet;function kE(t){if(Hd.has(t))return t;Hd.add(t);let e;function n(){if(!e){let s=Array.from(t.share.keys());const o=a=>{const c=Array.from(t.share.keys());JSON.stringify(s)!==JSON.stringify(c)&&(s=c,e.reportChanged())};e=li("map",()=>{t.on("beforeObserverCalls",o)},()=>{t.off("beforeObserverCalls",o)})}e.reportObserved(t._implicitObserver)}const r=t.get;t.get=function(s){if(typeof s!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return sa(o),o};function i(s){const o=t[s];let a;t[s]=function(){let c,l=arguments;return n(),a&&a.removeObservers(),a=wE(()=>(c=Reflect.apply(o,t,l),c),()=>e.reportChanged()),c}}return i("toJSON"),Object.defineProperty(t,"keys",{get:()=>(n(),Object.keys(t.share))}),t}const Vd=new WeakSet;function SE(t){if(Vd.has(t))return t;Vd.add(t);let e;const n=new Map;function r(){if(!e){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&e.reportChanged()};e=li("map",()=>{t.observe(a)},()=>{t.unobserve(a)})}e.reportObserved(t._implicitObserver)}function i(a){let c=n.get(a);if(!c){const l=u=>{u.keysChanged.has(a)&&(u.changes.added.size||u.changes.deleted.size||u.changes.keys.size||u.changes.delta.length)&&c.reportChanged()};c=li(a,()=>{t.observe(l)},()=>{t.unobserve(l)}),n.set(a,c)}c.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(a){if(typeof a!="string")throw new Error("unexpected");return i(a),Reflect.apply(s,this,arguments)};function o(a){const c=t[a];t[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),t}const Kd=new WeakSet;function qd(t){if(Kd.has(t))return t;Kd.add(t);let e;const n=i=>{e.reportChanged()};e=li("text",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(i){const s=t[i];t[i]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return r("toString"),r("toJSON"),t}const Xd=new WeakSet;function Zd(t){if(Xd.has(t))return t;Xd.add(t);let e;const n=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&e.reportChanged()};e=li("xml",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(s){const o=t[s];t[s]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function i(s){let o=t,a=Object.getOwnPropertyDescriptor(o,s);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(t,s,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),t}function sa(t){return t instanceof oi||t instanceof Rn?qd(t):t instanceof $n?EE(t):t instanceof jn?SE(t):t instanceof ur||Object.prototype.hasOwnProperty.call(t,"autoLoad")?kE(t):t instanceof zn||t instanceof hr?Zd(t):t}function Jd(t){t.share.forEach(e=>{e.constructor!==ot&&sa(e)})}function Yd(t,e){for(let r=t.length-1;r>=e;r--){let i=t[r];if(!i.deleted){var n;if(i instanceof nn)continue;(n=i.content)==null||n.getContent().forEach(s=>{s instanceof ot&&sa(s)})}}}const Qd=new WeakSet;function AE(t){Qd.has(t)||(Qd.add(t),sa(t),t.store.clients.forEach(e=>{e&&Yd(e,0)}),Jd(t),t.on("beforeObserverCalls",e=>{Jd(t),e.afterState.forEach((n,r)=>{const i=e.beforeState.get(r)||0;if(i!==n){const s=e.doc.store.clients.get(r);if(!s)return;const o=Tn(s,i);Yd(s,o)}})}))}class Os{constructor(e){this.value=void 0,this.value=e}}function xE(t){return ArrayBuffer.isView(t)?new Os(t):new Os(Object.freeze(t))}function TE(t){const e=function(){var a;let c=(a=this[cn])==null?void 0:a.implicitObserver;return t._implicitObserver=c,t.slice.bind(t).apply(t,arguments).map(u=>{const h=oa(u,c);return c&&typeof h=="object"?ms(h,c):h})},n=function(a){return a.map(c=>{const l=Pl(c);let u=ui(l)||l;if(u instanceof Os&&(u=u.value),u instanceof ot&&u.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return u})},r=function(){return[].findIndex.apply(e.apply(this),arguments)},i={slice:e,unshift:(...o)=>(t.unshift(n(o)),t.lengthUntracked),push:(...o)=>(t.push(n(o)),t.lengthUntracked),insert:t.insert.bind(t),toJSON:t.toJSON.bind(t),forEach:function(){return[].forEach.apply(e.apply(this),arguments)},every:function(){return[].every.apply(e.apply(this),arguments)},filter:function(){return[].filter.apply(e.apply(this),arguments)},find:function(){return[].find.apply(e.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(e.apply(this),arguments)},includes:function(){return[].includes.apply(e.apply(this),arguments)},map:function(){return[].map.apply(e.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>NE(a,o))},splice:function(){let o=arguments[0]<0?t.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),l=e.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return t.doc?t.doc.transact(()=>{t.delete(o,a),t.insert(o,n(c))}):(t.delete(o,a),t.insert(o,n(c))),l}},s=[];for(let o in i)s[o]=i[o];return s}function Cs(t){if(typeof t=="string"&&t.trim().length){const e=Number(t);if(Number.isInteger(e))return e}return t}function ep(t,e=new $n){if(e[yt])throw new Error("unexpected");const n=TE(e),r=new Proxy(n,{set:(i,s,o)=>{throw typeof Cs(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(i,s,o)=>{const a=Cs(s);if(a===aa)return e;if(typeof a=="number"){let u;if(o&&o[cn]){var c;u=(c=o[cn])==null?void 0:c.implicitObserver,e._implicitObserver=u}let h=e.get(a);return h=oa(h,u),h}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const u=e.slice();return Reflect.get(u,a)}return a==="length"?e.length:Reflect.get(i,a,o)},deleteProperty:(i,s)=>{const o=Cs(s);if(typeof o!="number")throw new Error;return o<e.lengthUntracked&&o>=0?(e.delete(o),!0):!1},has:(i,s)=>{const o=Cs(s);return typeof o!="number"?Reflect.has(i,o):o<e.lengthUntracked&&o>=0},getOwnPropertyDescriptor(i,s){const o=Cs(s);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<e.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:i=>{const s=[];for(let o=0;o<e.length;o++)s.push(o+"");return s.push("length"),s}});return n.push.apply(r,t),r}function tp(t,e=new jn){if(e[yt])throw new Error("unexpected");const n=new Proxy({},{set:(r,i,s)=>{if(typeof i!="string")throw new Error;const o=Pl(s);let a=ui(o)||o;if(a instanceof Os&&(a=a.value),a instanceof ot&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return e.set(i,a),!0},get:(r,i,s)=>{if(i===aa)return e;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[cn]){var a;o=(a=s[cn])==null?void 0:a.implicitObserver,e._implicitObserver=o}let c=e.get(i);return c=oa(c,o),c},deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error;return e.has(i)?(e.delete(i),!0):!1},has:(r,i)=>!!(typeof i=="string"&&e.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&e.has(i))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.keys())});Ns.set(e,n);for(let r in t)n[r]=t[r];return n}function RE(t){return t instanceof ot}const Ns=new WeakMap;function oa(t,e){if(RE(t)){if(t._implicitObserver=e,t instanceof $n||t instanceof jn){if(!Ns.has(t)){const n=Pl(t);Ns.set(t,n)}t=Ns.get(t)}else if(t instanceof hr||t instanceof zn||t instanceof oi||t instanceof zi||t instanceof Rn)Yc(t),t.__v_skip=!0;else throw new Error("unknown YType");return t}else{if(t===null)return null;if(typeof t=="object")return xE(t)}return t}function Pl(t){if(t==null)return t;if(t=ui(t)||t,t instanceof $n)return ep([],t);if(t instanceof jn)return tp({},t);if(typeof t=="string")return t;if(Array.isArray(t))return ep(t);if(t instanceof hr||t instanceof zn||t instanceof oi||t instanceof zi)return t;if(t instanceof Rn)return t;if(typeof t=="object")return t instanceof Os?t:tp(t);if(typeof t=="number"||typeof t=="boolean")return t;throw new Error("invalid")}function IE(t){for(let[e,n]of Object.entries(t))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function np(t,e,n){let r=e[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?t.getXmlFragment(n):r==="text"?t.getText(n):Array.isArray(r)?t.getArray(n):t.getMap(n)}function OE(t,e){if(t[yt])throw new Error("unexpected");IE(e);const n=new Proxy({},{set:(r,i,s)=>{throw typeof i!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,i,s)=>{if(i===aa)return t;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[cn]){var a;o=(a=s[cn])==null?void 0:a.implicitObserver,t._implicitObserver=o}if(i==="toJSON"){for(let u of Object.keys(e))np(t,e,u);return Reflect.get(t,i)}let c=np(t,e,i);return c=oa(c,o),c},deleteProperty:(r,i)=>{throw new Error("deleteProperty not available for doc")},has:(r,i)=>!!(typeof i=="string"&&t.share.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&t.share.has(i)||i==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.share.keys())});return Ns.set(t,n),n}vE(Xb);const aa=Symbol("INTERNAL_SYMBOL");function rp(t,e){const n=ui(t)||t;if(!n)throw new Error("not a valid synced object");return n instanceof ur?(n.on("update",e),()=>{n.off("update",e)}):(n.observeDeep(e),()=>{n.unobserveDeep(e)})}function CE(t){const e=ui(t);if(!(e instanceof ur))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return e}function ui(t){if(typeof t!="object"||t===null)return;const e=t[aa];return e&&(Yc(e),e.__v_skip=!0),e}function NE(t,e){if(t===e)return!0;if(typeof t=="object"&&typeof e=="object"){const n=ui(t),r=ui(e);return!n||!r?!1:n===r}return!1}function LE(t,e=new ur){return AE(e),OE(e,t)}var xe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ls=Symbol.for("react.element"),ME=Symbol.for("react.portal"),UE=Symbol.for("react.fragment"),PE=Symbol.for("react.strict_mode"),DE=Symbol.for("react.profiler"),BE=Symbol.for("react.provider"),FE=Symbol.for("react.context"),$E=Symbol.for("react.forward_ref"),jE=Symbol.for("react.suspense"),zE=Symbol.for("react.memo"),WE=Symbol.for("react.lazy"),ip=Symbol.iterator;function GE(t){return t===null||typeof t!="object"?null:(t=ip&&t[ip]||t["@@iterator"],typeof t=="function"?t:null)}var sp={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},op=Object.assign,ap={};function Wi(t,e,n){this.props=t,this.context=e,this.refs=ap,this.updater=n||sp}Wi.prototype.isReactComponent={},Wi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},Wi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function cp(){}cp.prototype=Wi.prototype;function Dl(t,e,n){this.props=t,this.context=e,this.refs=ap,this.updater=n||sp}var Bl=Dl.prototype=new cp;Bl.constructor=Dl,op(Bl,Wi.prototype),Bl.isPureReactComponent=!0;var lp=Array.isArray,up=Object.prototype.hasOwnProperty,Fl={current:null},hp={key:!0,ref:!0,__self:!0,__source:!0};function fp(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)up.call(e,r)&&!hp.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ls,type:t,key:s,ref:o,props:i,_owner:Fl.current}}function HE(t,e){return{$$typeof:Ls,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function $l(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ls}function VE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var dp=/\/+/g;function jl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?VE(""+t.key):e.toString(36)}function ca(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ls:case ME:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+jl(o,0):r,lp(i)?(n="",t!=null&&(n=t.replace(dp,"$&/")+"/"),ca(i,e,n,"",function(l){return l})):i!=null&&($l(i)&&(i=HE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(dp,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",lp(t))for(var a=0;a<t.length;a++){s=t[a];var c=r+jl(s,a);o+=ca(s,e,n,c,i)}else if(c=GE(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=r+jl(s,a++),o+=ca(s,e,n,c,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function la(t,e,n){if(t==null)return t;var r=[],i=0;return ca(t,r,"","",function(s){return e.call(n,s,i++)}),r}function KE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Bt={current:null},ua={transition:null},qE={ReactCurrentDispatcher:Bt,ReactCurrentBatchConfig:ua,ReactCurrentOwner:Fl};function pp(){throw Error("act(...) is not supported in production builds of React.")}xe.Children={map:la,forEach:function(t,e,n){la(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return la(t,function(){e++}),e},toArray:function(t){return la(t,function(e){return e})||[]},only:function(t){if(!$l(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},xe.Component=Wi,xe.Fragment=UE,xe.Profiler=DE,xe.PureComponent=Dl,xe.StrictMode=PE,xe.Suspense=jE,xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qE,xe.act=pp,xe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=op({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Fl.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)up.call(e,c)&&!hp.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:Ls,type:t.type,key:i,ref:s,props:r,_owner:o}},xe.createContext=function(t){return t={$$typeof:FE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:BE,_context:t},t.Consumer=t},xe.createElement=fp,xe.createFactory=function(t){var e=fp.bind(null,t);return e.type=t,e},xe.createRef=function(){return{current:null}},xe.forwardRef=function(t){return{$$typeof:$E,render:t}},xe.isValidElement=$l,xe.lazy=function(t){return{$$typeof:WE,_payload:{_status:-1,_result:t},_init:KE}},xe.memo=function(t,e){return{$$typeof:zE,type:t,compare:e===void 0?null:e}},xe.startTransition=function(t){var e=ua.transition;ua.transition={};try{t()}finally{ua.transition=e}},xe.unstable_act=pp,xe.useCallback=function(t,e){return Bt.current.useCallback(t,e)},xe.useContext=function(t){return Bt.current.useContext(t)},xe.useDebugValue=function(){},xe.useDeferredValue=function(t){return Bt.current.useDeferredValue(t)},xe.useEffect=function(t,e){return Bt.current.useEffect(t,e)},xe.useId=function(){return Bt.current.useId()},xe.useImperativeHandle=function(t,e,n){return Bt.current.useImperativeHandle(t,e,n)},xe.useInsertionEffect=function(t,e){return Bt.current.useInsertionEffect(t,e)},xe.useLayoutEffect=function(t,e){return Bt.current.useLayoutEffect(t,e)},xe.useMemo=function(t,e){return Bt.current.useMemo(t,e)},xe.useReducer=function(t,e,n){return Bt.current.useReducer(t,e,n)},xe.useRef=function(t){return Bt.current.useRef(t)},xe.useState=function(t){return Bt.current.useState(t)},xe.useSyncExternalStore=function(t,e,n){return Bt.current.useSyncExternalStore(t,e,n)},xe.useTransition=function(){return Bt.current.useTransition()},xe.version="18.3.1";const zl=0,mp=1,gp=2,XE=(t,e)=>{Ee(t,zl);const n=_v(e);Mt(t,n)},yp=(t,e,n)=>{Ee(t,mp),Mt(t,pv(e,n))},ZE=(t,e,n)=>yp(e,n,Dt(t)),_p=(t,e,n)=>{try{hv(e,Dt(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},JE=(t,e)=>{Ee(t,gp),Mt(t,e)},YE=_p,QE=(t,e,n,r)=>{const i=ke(t);switch(i){case zl:ZE(t,e,n);break;case mp:_p(t,n,r);break;case gp:YE(t,n,r);break;default:throw new Error("Unknown message type")}return i};function et(t,e,n,r){const i=r??"";return Ae.emit(`error:${e}`,t,n,i),dk(t,n,i)}function ek(t,e,n){Ae.emit("gadgetclient:reset",t,e,n)}function tk(t,e,n){Ae.emit("gadgetclient:patch",t,e,n)}function nk(t,e){Ae.emit("gadgetserver:clearplayer",t,void 0,e)}function rk(t,e){Ae.emit("peer:joincode",t,void 0,e)}function ik(t,e){Ae.emit("started",t,void 0,e)}function sk(t,e,n,r){Ae.emit("register:flush",t,[e,n],r)}function ok(t,e){Ae.emit("register:dev",t,void 0,e)}function ak(t,e){Ae.emit("register:share",t,void 0,e)}function ck(t,e){Ae.emit("register:refresh",t,void 0,e)}function lk(t,e){Ae.emit("register:nuke",t,void 0,e)}function uk(t,e,n){Ae.emit("synth:tts",t,[e,n])}function hk(t,e,n){Ae.emit("synth:play",t,[e,n])}function Wl(t,e,n,r){Ae.emit("synth:voice",t,[e,n,r])}function fk(t,e,n,r,i){Ae.emit("synth:voicefx",t,[e,n,r,i])}function Ct(t,...e){return Ae.emit("tape:info",t,e),!0}function bp(t,...e){return Ae.emit("tape:debug",t,e),!0}function dk(t,...e){return Ae.emit("tape:error",t,e),!1}function pk(t,e,n,r,i,s){Ae.emit("tape:editor:open",t,[e,n,r,i],s)}function mk(t,e){Ae.emit("vm:endgame",t,void 0,e)}function wp(t,e){return`${t}${e}`}function Gl(t,e,n){Ae.emit("vm:flush",t,e,n)}const dr=LE({shared:[]});function ha(t,e,n){return t.find(r=>r.key===e&&r.type===n)}function ZM(t){}function vp(t,e,n){const r=ha(dr.shared,t,e);k(r)||dr.shared.push({key:t,type:e,value:n})}function gk(t,e){vp(t,0,e)}function Ep(t,e){const n=new Rn(e);vp(t,1,n)}function yk(t,e){const n=ha(dr.shared,t,0);if(k(n)){n.value=e;return}dr.shared.push({key:t,type:0,value:e})}function _k(t,e){const n=new Rn(e),r=ha(dr.shared,t,1);if(k(r)){r.value=n;return}dr.shared.push({key:t,type:1,value:n})}function kp(t,e,n){let r;function i(){const o=ha(dr.shared,t,e);k(o)&&(s(),r=rp(o,()=>n(o.value)))}const s=rp(dr.shared,i);return i(),()=>r==null?void 0:r()}function bk(t,e){return kp(t,0,e)}function Sp(t,e){return kp(t,1,n=>e(n.toJSON()))}function fa(t){return xn(t)}const Fr=CE(dr),Gn=hs("modem",["second"],t=>{switch(t.target){case"second":break;case"join":if(t.sender!==Gn.id()){Gn.reply(t,"joinack");const e=Mr();XE(e,Fr),Gn.reply(t,"sync",fa(e));const n=Mr();yp(n,Fr),Gn.reply(t,"sync",fa(n))}break;case"joinack":t.sender,Gn.id();break;case"sync":{if(t.sender!==Gn.id()&&k(t.data))try{const e=ii(t.data),n=Mr();QE(e,n,Fr,Gn)===zl&&Gn.emit("modem:sync",fa(n))}catch(e){et(Gn.name(),"sync",e.message)}break}}});function Ap(t){const e=Mr();JE(e,t),Gn.emit("modem:sync",fa(e))}Fr.on("update",Ap),Fr.on("destroy",()=>{Fr==null||Fr.off("update",Ap)});const wk=8,vk=14;function da(t,e){return new Array(t).fill(e)}function xp(t,e,n,r,i=0){const s=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:da(s,0),color:da(s,0),bg:da(s,i)}}function Ek(t,e,n,r=1,i=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:i,bg:Le.ONCLEAR}}function kk(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function Sk(t,e,n,r,i=0){const s=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:da(s,i)}}function Ak(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:2}}var un=(t=>(t[t.START=0]="START",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.SCROLL=5]="SCROLL",t))(un||{});const xk={start:0,left:1,right:2,top:3,bottom:4,scroll:5},Tk={0:1,1:20,2:20,3:1,4:1,5:40};function Tp(t,e){return`${t}:${e}`}const Rk=1,Ik=16,Ok=256;var Ft=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Ft||{});const $r={};function Hl(){return{layers:[],panels:[],reset:!0,focus:"scroll"}}function Rp(t){t.text=[],Object.values($r[t.id]??{}).forEach(e=>e==null?void 0:e()),$r[t.id]={}}function Ip(t){const e=t.panels.find(n=>n.name===t.focus);if(!e){const n={id:ft(),name:t.focus,edge:un.RIGHT,size:20,text:[]};return t.panels.push(n),t.reset=!1,n}return e}const Ck=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),Nk=new Set(["rn","range","sl","select","nm","number","tx","text"]),Lk=new Set(["tx","text"]),Mk={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""},Vl={};let Op=t=>{let e=Vl[t];return k(e)||(Vl[t]=e=Hl()),e};function Uk(t){Op=t}function hi(t){return Op(t)}function Pk(t){const e=hi(t);e.panels=e.panels.filter(n=>n.edge!==un.SCROLL)}function Dk(t,e,n){Object.values($r).forEach(r=>{if(r[e]!==void 0){const i=Tp(t.id(),e);ve(n)&&yk(i,n),Se(n)&&_k(i,n)}})}function Bk(t){let e="";const n=hi(t);return n.panels=n.panels.filter(r=>{if(r.edge===un.SCROLL){const[i]=r.text;return Se(i)&&r.text.length===1&&(e=i),r.text.length>1}return!0}),e}function Kl(t,e,n,r,i){const s=hi(t),o=r,a=i??Fb.capital(e),c=s.panels.find(l=>l.name===a);if(c)s.reset=!0,s.focus=a,ve(o)&&(c.size=o);else switch(n){case un.START:{Vl[t]=Hl();break}case un.LEFT:case un.RIGHT:case un.TOP:case un.BOTTOM:case un.SCROLL:{const l={id:ft(),name:a,edge:n,size:o??Tk[n],text:[]};s.panels.push(l),s.focus=a;break}}}function Fk(t,e){const n=hi(t),r=Ip(n);n.reset&&(n.reset=!1,Rp(r)),r.text.push(e)}function $k(t,e,n,r,i){const s=hi(t),o=Ip(s);s.reset&&(s.reset=!1,Rp(o));const a=Pe(r),c=[e.id(),n,...Ck.has(a)?[a]:["hyperlink",r],...i],l=c[2];if(Nk.has(l)){const u=`${c[3]??""}`;$r[o.id]=$r[o.id]??{};const h=e.get(u)??Mk[l];if($r[o.id][u]===void 0){const d=Tp(e.id(),u);ve(h)&&gk(d,h),Se(h)&&Ep(d,h),Lk.has(l)?$r[o.id][u]=Sp(d,f=>{k(f)&&f!==e.get(u)&&e.set(u,f)}):$r[o.id][u]=bk(d,f=>{k(f)&&f!==e.get(u)&&e.set(u,f)})}}o.text.push(c)}var Cp={exports:{}},ql={exports:{}},Np;function jk(){return Np||(Np=1,function(t,e){(function(n,r){t.exports=r()})(Pt,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(m){if(m)for(var b=0;b<u.length;b++)m[u[b]]!==void 0&&this["set"+r(u[b])](m[u[b]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",b=this.getLineNumber()||"",_=this.getColumnNumber()||"",w=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+b+":"+_+")":"[eval]:"+b+":"+_:w?w+" ("+m+":"+b+":"+_+")":m+":"+b+":"+_}},h.fromString=function(b){var _=b.indexOf("("),w=b.lastIndexOf(")"),v=b.substring(0,_),A=b.substring(_+1,w).split(","),O=b.substring(w+1);if(O.indexOf("@")===0)var x=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(O,""),R=x[1],$=x[2],L=x[3];return new h({functionName:v,args:A||void 0,fileName:R,lineNumber:$||void 0,columnNumber:L||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+r(s[d])]=i(s[d]),h.prototype["set"+r(s[d])]=function(m){return function(b){this[m]=!!b}}(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=i(o[f]),h.prototype["set"+r(o[f])]=function(m){return function(b){if(!n(b))throw new TypeError(m+" must be a Number");this[m]=Number(b)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(b){this[m]=String(b)}}(a[p]);return h})}(ql)),ql.exports}(function(t,e){(function(n,r){t.exports=r(jk())})(Pt,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,m=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:m,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;f.match(/\(([^)]*)\)/)&&(m=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Cp);var zk=Cp.exports,Wk=Ci(zk);const Hn=!!JSON.parse("false"),Gk=!!JSON.parse("false");JSON.parse("false");const Hk=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Gi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return wk*Gi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return vk*Gi.DRAW_CHAR_SCALE}};function pr(t){const e={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}var Lp={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Pt,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Lp);var Vk=Lp.exports,Kk=Ci(Vk);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Mp="170",qk="",pa="srgb",Up="srgb-linear",Pp="linear",Xl="srgb";function Xk(t,e,n){return Math.max(e,Math.min(n,t))}class Ms{constructor(e=0,n=0){Ms.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Xk(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Us{constructor(e,n,r,i,s,o,a,c,l){Us.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],h=r[7],d=r[2],f=r[5],p=r[8],m=i[0],b=i[3],_=i[6],w=i[1],v=i[4],A=i[7],O=i[2],x=i[5],R=i[8];return s[0]=o*m+a*w+c*O,s[3]=o*b+a*v+c*x,s[6]=o*_+a*A+c*R,s[1]=l*m+u*w+h*O,s[4]=l*b+u*v+h*x,s[7]=l*_+u*A+h*R,s[2]=d*m+f*w+p*O,s[5]=d*b+f*v+p*x,s[8]=d*_+f*A+p*R,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,d=a*c-u*s,f=l*s-o*c,p=n*h+r*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=d*m,e[4]=(u*n-i*c)*m,e[5]=(i*s-a*n)*m,e[6]=f*m,e[7]=(r*c-l*n)*m,e[8]=(o*n-r*s)*m,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(Zl.makeScale(e,n)),this}rotate(e){return this.premultiply(Zl.makeRotation(-e)),this}translate(e,n){return this.premultiply(Zl.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Zl=new Us,Zk={enabled:!0,workingColorSpace:Up,spaces:{},convert:function(t,e,n){return this.enabled===!1||e===n||!e||!n||(this.spaces[e].transfer===Xl&&(t.r=Jl(t.r),t.g=Jl(t.g),t.b=Jl(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Xl&&(t.r=Yl(t.r),t.g=Yl(t.g),t.b=Yl(t.b))),t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===qk?Pp:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}};function Jl(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Yl(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const Dp=[.64,.33,.3,.6,.15,.06],Bp=[.2126,.7152,.0722],Fp=[.3127,.329],$p=new Us().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),jp=new Us().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Zk.define({[Up]:{primaries:Dp,whitePoint:Fp,transfer:Pp,toXYZ:$p,fromXYZ:jp,luminanceCoefficients:Bp,workingColorSpaceConfig:{unpackColorSpace:pa},outputColorSpaceConfig:{drawingBufferColorSpace:pa}},[pa]:{primaries:Dp,whitePoint:Fp,transfer:Xl,toXYZ:$p,fromXYZ:jp,luminanceCoefficients:Bp,outputColorSpaceConfig:{drawingBufferColorSpace:pa}}}),typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Mp}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Mp),new Ms,new Ms;function jr(t,e,n){return Math.max(e,Math.min(n,t))}const Jk=Kk("089fad0j9awfem09wavefc09uwaef");function Yk(){return Jk()}function Ps(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(Yk()*i)}function Ql(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function Qk(t){return t[Ps(0,t.length-1)]}function mr(...t){return Qk(t.flat())}function e1(t){return[...new Set(t)].filter(k)}function gr(t){return k(t)&&k(t.x)&&k(t.y)}function xt(t,e){switch(e){case ce.NORTH:--t.y;break;case ce.SOUTH:++t.y;break;case ce.WEST:--t.x;break;case ce.EAST:++t.x;break}return t}function Hi(t,e){const n=e.x-t.x,r=e.y-t.y;if(n<0)return ce.WEST;if(n>0)return ce.EAST;if(r<0)return ce.NORTH;if(r>0)return ce.SOUTH}const zp={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function yr(t){return He(t)&&Wp(t[0])}function Wp(t){return k(ce[t])&&Se(t)}function t1(t){const e=ce[t];return k(e)?e:ce.IDLE}function Gp(t){if(Se(t))return zp[Pe(t)]}function Hp(t){if(yr(t))return t;if(Wp(t))return[t];const e=Gp(t);if(k(e))return[e]}function Vp(t){const e=C.words[t],n=Hp(e);if(yr(n))return[n,t+1];const[r,i]=Gt(t),s=Hp(r);return yr(s)?[s,i]:[void 0,t]}function eu(t){const e=[];let[n,r]=Vp(t);for(;yr(n);){if(e.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=re(C.words,r,[q.NUMBER,q.NUMBER]);e.push(o,a),r=c}const[i,s]=Vp(r);n=i,r=s}return e.length?[e,r]:[void 0,t]}function Vi(t){return He(t)&&typeof t[0]=="string"}function Kp(t){const e=C.words[t];if(Vi(e))return[e,t+1];const[n,r]=_c(t),[i,s]=Gt(r,!1);return Se(i)?[[i,n],s]:[void 0,t]}function ma(t){if(!Vi(t))return;const[e]=t;return e}function qp(t){if(!Vi(t))return;const[,e]=t,n=k(e)?_N(e):void 0;return k(n)?n:void 0}function Xp(t){if(!Vi(t))return;const[,e]=t,n=k(e)?bN(e):void 0;return k(n)?n:void 0}const tt=60,hn=25;var Te=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Te||{});function tu(t,e){const n=t??Ge.ISWALK,r=e??Ge.ISWALK;switch(n){case Ge.ISWALK:return r!==Ge.ISWALK;case Ge.ISSWIM:return r!==Ge.ISSWIM;case Ge.ISSOLID:return!0;case Ge.ISBULLET:return r!==Ge.ISWALK&&r!==Ge.ISSWIM}}function Zp(t,e,n){const r=t==null?void 0:t.objects[n];if(k(r))return r;if(k(e)){const i=Ds(t,"player"),s={x:e.x??0,y:e.y??0};Yp(s,i)}}function Ds(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(k)}function Jp(t,e){const n=ma(e),r=qp(e),i=Xp(e);return t.filter(s=>!(k(n)&&Rh(s)!==n||k(r)&&xN(s)!==r||k(i)&&TN(s)!==i)).filter(k)}function nu(t,e){return k(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(k(i))return i;const s=Ds(t,Pe(n));if(s.length)return s}else if(gr(n)&&n.x>=0&&n.x<tt&&n.y>=0&&n.y<hn){const i=n.x+n.y*tt,s=(r=t.lookup)==null?void 0:r[i];return k(s)?t.objects[s]:t.terrain[i]}}).flat().filter(k):[]}function Yp(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var Qp=typeof global=="object"&&global&&global.Object===Object&&global,n1=typeof self=="object"&&self&&self.Object===Object&&self,Vn=Qp||n1||Function("return this")(),fn=Vn.Symbol,em=Object.prototype,r1=em.hasOwnProperty,i1=em.toString,Bs=fn?fn.toStringTag:void 0;function s1(t){var e=r1.call(t,Bs),n=t[Bs];try{t[Bs]=void 0;var r=!0}catch{}var i=i1.call(t);return r&&(e?t[Bs]=n:delete t[Bs]),i}var o1=Object.prototype,a1=o1.toString;function c1(t){return a1.call(t)}var l1="[object Null]",u1="[object Undefined]",tm=fn?fn.toStringTag:void 0;function zr(t){return t==null?t===void 0?u1:l1:tm&&tm in Object(t)?s1(t):c1(t)}function In(t){return t!=null&&typeof t=="object"}var h1="[object Symbol]";function ga(t){return typeof t=="symbol"||In(t)&&zr(t)==h1}function ya(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Me=Array.isArray,f1=1/0,nm=fn?fn.prototype:void 0,rm=nm?nm.toString:void 0;function im(t){if(typeof t=="string")return t;if(Me(t))return ya(t,im)+"";if(ga(t))return rm?rm.call(t):"";var e=t+"";return e=="0"&&1/t==-f1?"-0":e}var d1=/\s/;function p1(t){for(var e=t.length;e--&&d1.test(t.charAt(e)););return e}var m1=/^\s+/;function g1(t){return t&&t.slice(0,p1(t)+1).replace(m1,"")}function dn(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var sm=NaN,y1=/^[-+]0x[0-9a-f]+$/i,_1=/^0b[01]+$/i,b1=/^0o[0-7]+$/i,w1=parseInt;function v1(t){if(typeof t=="number")return t;if(ga(t))return sm;if(dn(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=dn(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=g1(t);var n=_1.test(t);return n||b1.test(t)?w1(t.slice(2),n?2:8):y1.test(t)?sm:+t}var om=1/0,E1=17976931348623157e292;function k1(t){if(!t)return t===0?t:0;if(t=v1(t),t===om||t===-om){var e=t<0?-1:1;return e*E1}return t===t?t:0}function _a(t){var e=k1(t),n=e%1;return e===e?n?e-n:e:0}function Ki(t){return t}var S1="[object AsyncFunction]",A1="[object Function]",x1="[object GeneratorFunction]",T1="[object Proxy]";function _r(t){if(!dn(t))return!1;var e=zr(t);return e==A1||e==x1||e==S1||e==T1}var ru=Vn["__core-js_shared__"],am=function(){var t=/[^.]+$/.exec(ru&&ru.keys&&ru.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function R1(t){return!!am&&am in t}var I1=Function.prototype,O1=I1.toString;function fi(t){if(t!=null){try{return O1.call(t)}catch{}try{return t+""}catch{}}return""}var C1=/[\\^$.*+?()[\]{}|]/g,N1=/^\[object .+?Constructor\]$/,L1=Function.prototype,M1=Object.prototype,U1=L1.toString,P1=M1.hasOwnProperty,D1=RegExp("^"+U1.call(P1).replace(C1,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function B1(t){if(!dn(t)||R1(t))return!1;var e=_r(t)?D1:N1;return e.test(fi(t))}function F1(t,e){return t==null?void 0:t[e]}function di(t,e){var n=F1(t,e);return B1(n)?n:void 0}var iu=di(Vn,"WeakMap"),cm=Object.create,$1=function(){function t(){}return function(e){if(!dn(e))return{};if(cm)return cm(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function j1(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function wt(){}function z1(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var W1=800,G1=16,H1=Date.now;function V1(t){var e=0,n=0;return function(){var r=H1(),i=G1-(r-n);if(n=r,i>0){if(++e>=W1)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function K1(t){return function(){return t}}var ba=function(){try{var t=di(Object,"defineProperty");return t({},"",{}),t}catch{}}(),q1=ba?function(t,e){return ba(t,"toString",{configurable:!0,enumerable:!1,value:K1(e),writable:!0})}:Ki,X1=V1(q1);function lm(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function um(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function Z1(t){return t!==t}function J1(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function su(t,e,n){return e===e?J1(t,e,n):um(t,Z1,n)}function hm(t,e){var n=t==null?0:t.length;return!!n&&su(t,e,0)>-1}var Y1=9007199254740991,Q1=/^(?:0|[1-9]\d*)$/;function wa(t,e){var n=typeof t;return e=e??Y1,!!e&&(n=="number"||n!="symbol"&&Q1.test(t))&&t>-1&&t%1==0&&t<e}function ou(t,e,n){e=="__proto__"&&ba?ba(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Fs(t,e){return t===e||t!==t&&e!==e}var eS=Object.prototype,tS=eS.hasOwnProperty;function va(t,e,n){var r=t[e];(!(tS.call(t,e)&&Fs(r,n))||n===void 0&&!(e in t))&&ou(t,e,n)}function au(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?ou(n,a,c):va(n,a,c)}return n}var fm=Math.max;function nS(t,e,n){return e=fm(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=fm(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),j1(t,this,a)}}function cu(t,e){return X1(nS(t,e,Ki),t+"")}var rS=9007199254740991;function lu(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=rS}function Kn(t){return t!=null&&lu(t.length)&&!_r(t)}function dm(t,e,n){if(!dn(n))return!1;var r=typeof e;return(r=="number"?Kn(n)&&wa(e,n.length):r=="string"&&e in n)?Fs(n[e],t):!1}function iS(t){return cu(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&dm(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var sS=Object.prototype;function $s(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||sS;return t===n}function oS(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var aS="[object Arguments]";function pm(t){return In(t)&&zr(t)==aS}var mm=Object.prototype,cS=mm.hasOwnProperty,lS=mm.propertyIsEnumerable,Ea=pm(function(){return arguments}())?pm:function(t){return In(t)&&cS.call(t,"callee")&&!lS.call(t,"callee")};function uS(){return!1}var gm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ym=gm&&typeof module=="object"&&module&&!module.nodeType&&module,hS=ym&&ym.exports===gm,_m=hS?Vn.Buffer:void 0,fS=_m?_m.isBuffer:void 0,js=fS||uS,dS="[object Arguments]",pS="[object Array]",mS="[object Boolean]",gS="[object Date]",yS="[object Error]",_S="[object Function]",bS="[object Map]",wS="[object Number]",vS="[object Object]",ES="[object RegExp]",kS="[object Set]",SS="[object String]",AS="[object WeakMap]",xS="[object ArrayBuffer]",TS="[object DataView]",RS="[object Float32Array]",IS="[object Float64Array]",OS="[object Int8Array]",CS="[object Int16Array]",NS="[object Int32Array]",LS="[object Uint8Array]",MS="[object Uint8ClampedArray]",US="[object Uint16Array]",PS="[object Uint32Array]",Ye={};Ye[RS]=Ye[IS]=Ye[OS]=Ye[CS]=Ye[NS]=Ye[LS]=Ye[MS]=Ye[US]=Ye[PS]=!0,Ye[dS]=Ye[pS]=Ye[xS]=Ye[mS]=Ye[TS]=Ye[gS]=Ye[yS]=Ye[_S]=Ye[bS]=Ye[wS]=Ye[vS]=Ye[ES]=Ye[kS]=Ye[SS]=Ye[AS]=!1;function DS(t){return In(t)&&lu(t.length)&&!!Ye[zr(t)]}function ka(t){return function(e){return t(e)}}var bm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zs=bm&&typeof module=="object"&&module&&!module.nodeType&&module,BS=zs&&zs.exports===bm,uu=BS&&Qp.process,Wr=function(){try{var t=zs&&zs.require&&zs.require("util").types;return t||uu&&uu.binding&&uu.binding("util")}catch{}}(),wm=Wr&&Wr.isTypedArray,hu=wm?ka(wm):DS,FS=Object.prototype,$S=FS.hasOwnProperty;function vm(t,e){var n=Me(t),r=!n&&Ea(t),i=!n&&!r&&js(t),s=!n&&!r&&!i&&hu(t),o=n||r||i||s,a=o?oS(t.length,String):[],c=a.length;for(var l in t)(e||$S.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||wa(l,c)))&&a.push(l);return a}function Em(t,e){return function(n){return t(e(n))}}var jS=Em(Object.keys,Object),zS=Object.prototype,WS=zS.hasOwnProperty;function km(t){if(!$s(t))return jS(t);var e=[];for(var n in Object(t))WS.call(t,n)&&n!="constructor"&&e.push(n);return e}function pn(t){return Kn(t)?vm(t):km(t)}var GS=Object.prototype,HS=GS.hasOwnProperty,Kt=iS(function(t,e){if($s(e)||Kn(e)){au(e,pn(e),t);return}for(var n in e)HS.call(e,n)&&va(t,n,e[n])});function VS(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var KS=Object.prototype,qS=KS.hasOwnProperty;function XS(t){if(!dn(t))return VS(t);var e=$s(t),n=[];for(var r in t)r=="constructor"&&(e||!qS.call(t,r))||n.push(r);return n}function Sm(t){return Kn(t)?vm(t,!0):XS(t)}var ZS=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,JS=/^\w*$/;function fu(t,e){if(Me(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ga(t)?!0:JS.test(t)||!ZS.test(t)||e!=null&&t in Object(e)}var Ws=di(Object,"create");function YS(){this.__data__=Ws?Ws(null):{},this.size=0}function QS(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var eA="__lodash_hash_undefined__",tA=Object.prototype,nA=tA.hasOwnProperty;function rA(t){var e=this.__data__;if(Ws){var n=e[t];return n===eA?void 0:n}return nA.call(e,t)?e[t]:void 0}var iA=Object.prototype,sA=iA.hasOwnProperty;function oA(t){var e=this.__data__;return Ws?e[t]!==void 0:sA.call(e,t)}var aA="__lodash_hash_undefined__";function cA(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Ws&&e===void 0?aA:e,this}function pi(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}pi.prototype.clear=YS,pi.prototype.delete=QS,pi.prototype.get=rA,pi.prototype.has=oA,pi.prototype.set=cA;function lA(){this.__data__=[],this.size=0}function Sa(t,e){for(var n=t.length;n--;)if(Fs(t[n][0],e))return n;return-1}var uA=Array.prototype,hA=uA.splice;function fA(t){var e=this.__data__,n=Sa(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():hA.call(e,n,1),--this.size,!0}function dA(t){var e=this.__data__,n=Sa(e,t);return n<0?void 0:e[n][1]}function pA(t){return Sa(this.__data__,t)>-1}function mA(t,e){var n=this.__data__,r=Sa(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function br(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}br.prototype.clear=lA,br.prototype.delete=fA,br.prototype.get=dA,br.prototype.has=pA,br.prototype.set=mA;var Gs=di(Vn,"Map");function gA(){this.size=0,this.__data__={hash:new pi,map:new(Gs||br),string:new pi}}function yA(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Aa(t,e){var n=t.__data__;return yA(e)?n[typeof e=="string"?"string":"hash"]:n.map}function _A(t){var e=Aa(this,t).delete(t);return this.size-=e?1:0,e}function bA(t){return Aa(this,t).get(t)}function wA(t){return Aa(this,t).has(t)}function vA(t,e){var n=Aa(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function wr(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}wr.prototype.clear=gA,wr.prototype.delete=_A,wr.prototype.get=bA,wr.prototype.has=wA,wr.prototype.set=vA;var EA="Expected a function";function du(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(EA);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(du.Cache||wr),n}du.Cache=wr;var kA=500;function SA(t){var e=du(t,function(r){return n.size===kA&&n.clear(),r}),n=e.cache;return e}var AA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xA=/\\(\\)?/g,TA=SA(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(AA,function(n,r,i,s){e.push(i?s.replace(xA,"$1"):r||n)}),e});function Am(t){return t==null?"":im(t)}function xa(t,e){return Me(t)?t:fu(t,e)?[t]:TA(Am(t))}var RA=1/0;function Hs(t){if(typeof t=="string"||ga(t))return t;var e=t+"";return e=="0"&&1/t==-RA?"-0":e}function pu(t,e){e=xa(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[Hs(e[n++])];return n&&n==r?t:void 0}function IA(t,e,n){var r=t==null?void 0:pu(t,e);return r===void 0?n:r}function mu(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var xm=fn?fn.isConcatSpreadable:void 0;function OA(t){return Me(t)||Ea(t)||!!(xm&&t&&t[xm])}function gu(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=OA),i||(i=[]);++s<o;){var a=t[s];n(a)?mu(i,a):r||(i[i.length]=a)}return i}function rn(t){var e=t==null?0:t.length;return e?gu(t):[]}var Tm=Em(Object.getPrototypeOf,Object);function yu(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function CA(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:yu(t,e,n)}var NA="\\ud800-\\udfff",LA="\\u0300-\\u036f",MA="\\ufe20-\\ufe2f",UA="\\u20d0-\\u20ff",PA=LA+MA+UA,DA="\\ufe0e\\ufe0f",BA="\\u200d",FA=RegExp("["+BA+NA+PA+DA+"]");function Rm(t){return FA.test(t)}function $A(t){return t.split("")}var Im="\\ud800-\\udfff",jA="\\u0300-\\u036f",zA="\\ufe20-\\ufe2f",WA="\\u20d0-\\u20ff",GA=jA+zA+WA,HA="\\ufe0e\\ufe0f",VA="["+Im+"]",_u="["+GA+"]",bu="\\ud83c[\\udffb-\\udfff]",KA="(?:"+_u+"|"+bu+")",Om="[^"+Im+"]",Cm="(?:\\ud83c[\\udde6-\\uddff]){2}",Nm="[\\ud800-\\udbff][\\udc00-\\udfff]",qA="\\u200d",Lm=KA+"?",Mm="["+HA+"]?",XA="(?:"+qA+"(?:"+[Om,Cm,Nm].join("|")+")"+Mm+Lm+")*",ZA=Mm+Lm+XA,JA="(?:"+[Om+_u+"?",_u,Cm,Nm,VA].join("|")+")",YA=RegExp(bu+"(?="+bu+")|"+JA+ZA,"g");function QA(t){return t.match(YA)||[]}function ex(t){return Rm(t)?QA(t):$A(t)}function tx(t){return function(e){e=Am(e);var n=Rm(e)?ex(e):void 0,r=n?n[0]:e.charAt(0),i=n?CA(n,1).join(""):e.slice(1);return r[t]()+i}}var Um=tx("toUpperCase");function nx(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function rx(){this.__data__=new br,this.size=0}function ix(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function sx(t){return this.__data__.get(t)}function ox(t){return this.__data__.has(t)}var ax=200;function cx(t,e){var n=this.__data__;if(n instanceof br){var r=n.__data__;if(!Gs||r.length<ax-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new wr(r)}return n.set(t,e),this.size=n.size,this}function qn(t){var e=this.__data__=new br(t);this.size=e.size}qn.prototype.clear=rx,qn.prototype.delete=ix,qn.prototype.get=sx,qn.prototype.has=ox,qn.prototype.set=cx;function lx(t,e){return t&&au(e,pn(e),t)}var Pm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Dm=Pm&&typeof module=="object"&&module&&!module.nodeType&&module,ux=Dm&&Dm.exports===Pm,Bm=ux?Vn.Buffer:void 0,Fm=Bm?Bm.allocUnsafe:void 0;function hx(t,e){var n=t.length,r=Fm?Fm(n):new t.constructor(n);return t.copy(r),r}function wu(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function $m(){return[]}var fx=Object.prototype,dx=fx.propertyIsEnumerable,jm=Object.getOwnPropertySymbols,vu=jm?function(t){return t==null?[]:(t=Object(t),wu(jm(t),function(e){return dx.call(t,e)}))}:$m;function px(t,e){return au(t,vu(t),e)}var mx=Object.getOwnPropertySymbols,gx=mx?function(t){for(var e=[];t;)mu(e,vu(t)),t=Tm(t);return e}:$m;function zm(t,e,n){var r=e(t);return Me(t)?r:mu(r,n(t))}function Eu(t){return zm(t,pn,vu)}function yx(t){return zm(t,Sm,gx)}var ku=di(Vn,"DataView"),Su=di(Vn,"Promise"),qi=di(Vn,"Set"),Wm="[object Map]",_x="[object Object]",Gm="[object Promise]",Hm="[object Set]",Vm="[object WeakMap]",Km="[object DataView]",bx=fi(ku),wx=fi(Gs),vx=fi(Su),Ex=fi(qi),kx=fi(iu),mn=zr;(ku&&mn(new ku(new ArrayBuffer(1)))!=Km||Gs&&mn(new Gs)!=Wm||Su&&mn(Su.resolve())!=Gm||qi&&mn(new qi)!=Hm||iu&&mn(new iu)!=Vm)&&(mn=function(t){var e=zr(t),n=e==_x?t.constructor:void 0,r=n?fi(n):"";if(r)switch(r){case bx:return Km;case wx:return Wm;case vx:return Gm;case Ex:return Hm;case kx:return Vm}return e});var Sx=Object.prototype,Ax=Sx.hasOwnProperty;function xx(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Ax.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var Ta=Vn.Uint8Array;function Tx(t){var e=new t.constructor(t.byteLength);return new Ta(e).set(new Ta(t)),e}function Rx(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var Ix=/\w*$/;function Ox(t){var e=new t.constructor(t.source,Ix.exec(t));return e.lastIndex=t.lastIndex,e}var qm=fn?fn.prototype:void 0,Xm=qm?qm.valueOf:void 0;function Cx(t){return Xm?Object(Xm.call(t)):{}}function Nx(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var Lx="[object Boolean]",Mx="[object Date]",Ux="[object Map]",Px="[object Number]",Dx="[object RegExp]",Bx="[object Set]",Fx="[object String]",$x="[object Symbol]",jx="[object ArrayBuffer]",zx="[object DataView]",Wx="[object Float32Array]",Gx="[object Float64Array]",Hx="[object Int8Array]",Vx="[object Int16Array]",Kx="[object Int32Array]",qx="[object Uint8Array]",Xx="[object Uint8ClampedArray]",Zx="[object Uint16Array]",Jx="[object Uint32Array]";function Yx(t,e,n){var r=t.constructor;switch(e){case jx:return Tx(t);case Lx:case Mx:return new r(+t);case zx:return Rx(t);case Wx:case Gx:case Hx:case Vx:case Kx:case qx:case Xx:case Zx:case Jx:return Nx(t);case Ux:return new r;case Px:case Fx:return new r(t);case Dx:return Ox(t);case Bx:return new r;case $x:return Cx(t)}}function Qx(t){return typeof t.constructor=="function"&&!$s(t)?$1(Tm(t)):{}}var eT="[object Map]";function tT(t){return In(t)&&mn(t)==eT}var Zm=Wr&&Wr.isMap,nT=Zm?ka(Zm):tT,rT="[object Set]";function iT(t){return In(t)&&mn(t)==rT}var Jm=Wr&&Wr.isSet,sT=Jm?ka(Jm):iT,Ym="[object Arguments]",oT="[object Array]",aT="[object Boolean]",cT="[object Date]",lT="[object Error]",Qm="[object Function]",uT="[object GeneratorFunction]",hT="[object Map]",fT="[object Number]",eg="[object Object]",dT="[object RegExp]",pT="[object Set]",mT="[object String]",gT="[object Symbol]",yT="[object WeakMap]",_T="[object ArrayBuffer]",bT="[object DataView]",wT="[object Float32Array]",vT="[object Float64Array]",ET="[object Int8Array]",kT="[object Int16Array]",ST="[object Int32Array]",AT="[object Uint8Array]",xT="[object Uint8ClampedArray]",TT="[object Uint16Array]",RT="[object Uint32Array]",Ke={};Ke[Ym]=Ke[oT]=Ke[_T]=Ke[bT]=Ke[aT]=Ke[cT]=Ke[wT]=Ke[vT]=Ke[ET]=Ke[kT]=Ke[ST]=Ke[hT]=Ke[fT]=Ke[eg]=Ke[dT]=Ke[pT]=Ke[mT]=Ke[gT]=Ke[AT]=Ke[xT]=Ke[TT]=Ke[RT]=!0,Ke[lT]=Ke[Qm]=Ke[yT]=!1;function Ra(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!dn(t))return t;var a=Me(t);if(a)return o=xx(t),z1(t,o);var c=mn(t),l=c==Qm||c==uT;if(js(t))return hx(t);if(c==eg||c==Ym||l&&!i)return o=l?{}:Qx(t),px(t,lx(o,t));if(!Ke[c])return i?t:{};o=Yx(t,c),s||(s=new qn);var u=s.get(t);if(u)return u;s.set(t,o),sT(t)?t.forEach(function(f){o.add(Ra(f,e,n,f,t,s))}):nT(t)&&t.forEach(function(f,p){o.set(p,Ra(f,e,n,p,t,s))});var h=Eu,d=a?void 0:h(t);return lm(d||t,function(f,p){d&&(p=f,f=t[p]),va(o,p,Ra(f,e,n,p,t,s))}),o}var IT=4;function Nt(t){return Ra(t,IT)}function Vs(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var OT="__lodash_hash_undefined__";function CT(t){return this.__data__.set(t,OT),this}function NT(t){return this.__data__.has(t)}function Xi(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new wr;++e<n;)this.add(t[e])}Xi.prototype.add=Xi.prototype.push=CT,Xi.prototype.has=NT;function tg(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Au(t,e){return t.has(e)}var LT=1,MT=2;function ng(t,e,n,r,i,s){var o=n&LT,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var h=-1,d=!0,f=n&MT?new Xi:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var p=t[h],m=e[h];if(r)var b=o?r(m,p,h,e,t,s):r(p,m,h,t,e,s);if(b!==void 0){if(b)continue;d=!1;break}if(f){if(!tg(e,function(_,w){if(!Au(f,w)&&(p===_||i(p,_,n,r,s)))return f.push(w)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function UT(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function xu(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var PT=1,DT=2,BT="[object Boolean]",FT="[object Date]",$T="[object Error]",jT="[object Map]",zT="[object Number]",WT="[object RegExp]",GT="[object Set]",HT="[object String]",VT="[object Symbol]",KT="[object ArrayBuffer]",qT="[object DataView]",rg=fn?fn.prototype:void 0,Tu=rg?rg.valueOf:void 0;function XT(t,e,n,r,i,s,o){switch(n){case qT:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case KT:return!(t.byteLength!=e.byteLength||!s(new Ta(t),new Ta(e)));case BT:case FT:case zT:return Fs(+t,+e);case $T:return t.name==e.name&&t.message==e.message;case WT:case HT:return t==e+"";case jT:var a=UT;case GT:var c=r&PT;if(a||(a=xu),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=DT,o.set(t,e);var u=ng(a(t),a(e),r,i,s,o);return o.delete(t),u;case VT:if(Tu)return Tu.call(t)==Tu.call(e)}return!1}var ZT=1,JT=Object.prototype,YT=JT.hasOwnProperty;function QT(t,e,n,r,i,s){var o=n&ZT,a=Eu(t),c=a.length,l=Eu(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in e:YT.call(e,d)))return!1}var f=s.get(t),p=s.get(e);if(f&&p)return f==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var b=o;++h<c;){d=a[h];var _=t[d],w=e[d];if(r)var v=o?r(w,_,d,e,t,s):r(_,w,d,t,e,s);if(!(v===void 0?_===w||i(_,w,n,r,s):v)){m=!1;break}b||(b=d=="constructor")}if(m&&!b){var A=t.constructor,O=e.constructor;A!=O&&"constructor"in t&&"constructor"in e&&!(typeof A=="function"&&A instanceof A&&typeof O=="function"&&O instanceof O)&&(m=!1)}return s.delete(t),s.delete(e),m}var eR=1,ig="[object Arguments]",sg="[object Array]",Ia="[object Object]",tR=Object.prototype,og=tR.hasOwnProperty;function nR(t,e,n,r,i,s){var o=Me(t),a=Me(e),c=o?sg:mn(t),l=a?sg:mn(e);c=c==ig?Ia:c,l=l==ig?Ia:l;var u=c==Ia,h=l==Ia,d=c==l;if(d&&js(t)){if(!js(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new qn),o||hu(t)?ng(t,e,n,r,i,s):XT(t,e,c,n,r,i,s);if(!(n&eR)){var f=u&&og.call(t,"__wrapped__"),p=h&&og.call(e,"__wrapped__");if(f||p){var m=f?t.value():t,b=p?e.value():e;return s||(s=new qn),i(m,b,n,r,s)}}return d?(s||(s=new qn),QT(t,e,n,r,i,s)):!1}function Ru(t,e,n,r,i){return t===e?!0:t==null||e==null||!In(t)&&!In(e)?t!==t&&e!==e:nR(t,e,n,r,Ru,i)}var rR=1,iR=2;function sR(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new qn,h;if(!(h===void 0?Ru(l,c,rR|iR,r,u):h))return!1}}return!0}function ag(t){return t===t&&!dn(t)}function oR(t){for(var e=pn(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,ag(i)]}return e}function cg(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function aR(t){var e=oR(t);return e.length==1&&e[0][2]?cg(e[0][0],e[0][1]):function(n){return n===t||sR(n,t,e)}}function cR(t,e){return t!=null&&e in Object(t)}function lg(t,e,n){e=xa(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=Hs(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&lu(i)&&wa(o,i)&&(Me(t)||Ea(t)))}function lR(t,e){return t!=null&&lg(t,e,cR)}var uR=1,hR=2;function fR(t,e){return fu(t)&&ag(e)?cg(Hs(t),e):function(n){var r=IA(n,t);return r===void 0&&r===e?lR(n,t):Ru(e,r,uR|hR)}}function dR(t){return function(e){return e==null?void 0:e[t]}}function pR(t){return function(e){return pu(e,t)}}function mR(t){return fu(t)?dR(Hs(t)):pR(t)}function Xn(t){return typeof t=="function"?t:t==null?Ki:typeof t=="object"?Me(t)?fR(t[0],t[1]):aR(t):mR(t)}function gR(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function yR(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var _R=yR();function bR(t,e){return t&&_R(t,e,pn)}function wR(t,e){return function(n,r){if(n==null)return n;if(!Kn(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var mi=wR(bR);function vR(t,e,n,r){return mi(t,function(i,s,o){e(r,i,n(i),o)}),r}function ER(t,e){return function(n,r){var i=Me(n)?gR:vR,s=e?e():{};return i(n,t,Xn(r),s)}}var ug=Object.prototype,kR=ug.hasOwnProperty,Iu=cu(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&dm(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=Sm(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||Fs(u,ug[l])&&!kR.call(t,l))&&(t[l]=s[l])}return t});function hg(t){return In(t)&&Kn(t)}var SR=200;function AR(t,e,n,r){var i=-1,s=hm,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=SR&&(s=Au,o=!1,e=new Xi(e));e:for(;++i<a;){var u=t[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(e[d]===h)continue e;c.push(u)}else s(e,h,r)||c.push(u)}return c}var Oa=cu(function(t,e){return hg(t)?AR(t,gu(e,1,hg,!0)):[]});function Zi(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Lt(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:_a(e),yu(t,e<0?0:e,r)):[]}function Ks(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:_a(e),e=r-e,yu(t,0,e<0?0:e)):[]}function xR(t){return typeof t=="function"?t:Ki}function me(t,e){var n=Me(t)?lm:mi;return n(t,xR(e))}function TR(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function RR(t,e){var n=!0;return mi(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function On(t,e,n){var r=Me(t)?TR:RR;return r(t,Xn(e))}function fg(t,e){var n=[];return mi(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function gn(t,e){var n=Me(t)?wu:fg;return n(t,Xn(e))}function IR(t){return function(e,n,r){var i=Object(e);if(!Kn(e)){var s=Xn(n);e=pn(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var OR=Math.max;function CR(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:_a(n);return i<0&&(i=OR(r+i,0)),um(t,Xn(e),i)}var Ji=IR(CR);function Cn(t){return t&&t.length?t[0]:void 0}function NR(t,e){var n=-1,r=Kn(t)?Array(t.length):[];return mi(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function le(t,e){var n=Me(t)?ya:NR;return n(t,Xn(e))}function yn(t,e){return gu(le(t,e))}var LR=Object.prototype,MR=LR.hasOwnProperty,dg=ER(function(t,e,n){MR.call(t,n)?t[n].push(e):ou(t,n,[e])}),UR=Object.prototype,PR=UR.hasOwnProperty;function DR(t,e){return t!=null&&PR.call(t,e)}function pe(t,e){return t!=null&&lg(t,e,DR)}var BR="[object String]";function qt(t){return typeof t=="string"||!Me(t)&&In(t)&&zr(t)==BR}function FR(t,e){return ya(e,function(n){return t[n]})}function dt(t){return t==null?[]:FR(t,pn(t))}var $R=Math.max;function $t(t,e,n,r){t=Kn(t)?t:dt(t),n=n&&!r?_a(n):0;var i=t.length;return n<0&&(n=$R(i+n,0)),qt(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&su(t,e,n)>-1}function pg(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return su(t,e,i)}var jR="[object Map]",zR="[object Set]",WR=Object.prototype,GR=WR.hasOwnProperty;function qe(t){if(t==null)return!0;if(Kn(t)&&(Me(t)||typeof t=="string"||typeof t.splice=="function"||js(t)||hu(t)||Ea(t)))return!t.length;var e=mn(t);if(e==jR||e==zR)return!t.size;if($s(t))return!km(t).length;for(var n in t)if(GR.call(t,n))return!1;return!0}var HR="[object RegExp]";function VR(t){return In(t)&&zr(t)==HR}var mg=Wr&&Wr.isRegExp,vr=mg?ka(mg):VR;function Er(t){return t===void 0}var KR="Expected a function";function qR(t){if(typeof t!="function")throw new TypeError(KR);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function XR(t,e,n,r){if(!dn(t))return t;e=xa(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=Hs(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=dn(u)?u:wa(e[i+1])?[]:{})}va(a,c,l),a=a[c]}return t}function ZR(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=pu(t,o);n(a,o)&&XR(s,xa(o,t),a)}return s}function Nn(t,e){if(t==null)return{};var n=ya(yx(t),function(r){return[r]});return e=Xn(e),ZR(t,n,function(r,i){return e(r,i[0])})}function JR(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function Xt(t,e,n){var r=Me(t)?nx:JR,i=arguments.length<3;return r(t,Xn(e),n,i,mi)}function Ca(t,e){var n=Me(t)?wu:fg;return n(t,qR(Xn(e)))}function YR(t,e){var n;return mi(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function Ou(t,e,n){var r=Me(t)?tg:YR;return r(t,Xn(e))}var QR=1/0,eI=qi&&1/xu(new qi([,-0]))[1]==QR?function(t){return new qi(t)}:wt,tI=200;function nI(t,e,n){var r=-1,i=hm,s=t.length,o=!0,a=[],c=a;if(s>=tI){var l=eI(t);if(l)return xu(l);o=!1,i=Au,c=new Xi}else c=a;e:for(;++r<s;){var u=t[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue e;a.push(u)}else i(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function Na(t){return t&&t.length?nI(t):[]}function Cu(t){console&&console.error&&console.error(`Error: ${t}`)}function gg(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function yg(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function _g(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function rI(t){return iI(t)?t.LABEL:t.name}function iI(t){return qt(t.LABEL)&&t.LABEL!==""}class Zn{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),me(this.definition,n=>{n.accept(e)})}}class Zt extends Zn{constructor(e){super([]),this.idx=1,Kt(this,Nn(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Yi extends Zn{constructor(e){super(e.definition),this.orgText="",Kt(this,Nn(e,n=>n!==void 0))}}class Jt extends Zn{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Kt(this,Nn(e,n=>n!==void 0))}}class Yt extends Zn{constructor(e){super(e.definition),this.idx=1,Kt(this,Nn(e,n=>n!==void 0))}}class Jn extends Zn{constructor(e){super(e.definition),this.idx=1,Kt(this,Nn(e,n=>n!==void 0))}}class Yn extends Zn{constructor(e){super(e.definition),this.idx=1,Kt(this,Nn(e,n=>n!==void 0))}}class vt extends Zn{constructor(e){super(e.definition),this.idx=1,Kt(this,Nn(e,n=>n!==void 0))}}class Ln extends Zn{constructor(e){super(e.definition),this.idx=1,Kt(this,Nn(e,n=>n!==void 0))}}class Mn extends Zn{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Kt(this,Nn(e,n=>n!==void 0))}}class nt{constructor(e){this.idx=1,Kt(this,Nn(e,n=>n!==void 0))}accept(e){e.visit(this)}}function sI(t){return le(t,La)}function La(t){function e(n){return le(n,La)}if(t instanceof Zt){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return qt(t.label)&&(n.label=t.label),n}else{if(t instanceof Jt)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Yt)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Jn)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof Yn)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:La(new nt({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Ln)return{type:"RepetitionWithSeparator",idx:t.idx,separator:La(new nt({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof vt)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Mn)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof nt){const n={type:"Terminal",name:t.terminalType.name,label:rI(t.terminalType),idx:t.idx};qt(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=vr(r)?r.source:r),n}else{if(t instanceof Yi)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class gi{visit(e){const n=e;switch(n.constructor){case Zt:return this.visitNonTerminal(n);case Jt:return this.visitAlternative(n);case Yt:return this.visitOption(n);case Jn:return this.visitRepetitionMandatory(n);case Yn:return this.visitRepetitionMandatoryWithSeparator(n);case Ln:return this.visitRepetitionWithSeparator(n);case vt:return this.visitRepetition(n);case Mn:return this.visitAlternation(n);case nt:return this.visitTerminal(n);case Yi:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function oI(t){return t instanceof Jt||t instanceof Yt||t instanceof vt||t instanceof Jn||t instanceof Yn||t instanceof Ln||t instanceof nt||t instanceof Yi}function Ma(t,e=[]){return t instanceof Yt||t instanceof vt||t instanceof Ln?!0:t instanceof Mn?Ou(t.definition,r=>Ma(r,e)):t instanceof Zt&&$t(e,t)?!1:t instanceof Zn?(t instanceof Zt&&e.push(t),On(t.definition,r=>Ma(r,e))):!1}function aI(t){return t instanceof Mn}function Qn(t){if(t instanceof Zt)return"SUBRULE";if(t instanceof Yt)return"OPTION";if(t instanceof Mn)return"OR";if(t instanceof Jn)return"AT_LEAST_ONE";if(t instanceof Yn)return"AT_LEAST_ONE_SEP";if(t instanceof Ln)return"MANY_SEP";if(t instanceof vt)return"MANY";if(t instanceof nt)return"CONSUME";throw Error("non exhaustive match")}class Ua{walk(e,n=[]){me(e.definition,(r,i)=>{const s=Lt(e.definition,i+1);if(r instanceof Zt)this.walkProdRef(r,s,n);else if(r instanceof nt)this.walkTerminal(r,s,n);else if(r instanceof Jt)this.walkFlat(r,s,n);else if(r instanceof Yt)this.walkOption(r,s,n);else if(r instanceof Jn)this.walkAtLeastOne(r,s,n);else if(r instanceof Yn)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Ln)this.walkManySep(r,s,n);else if(r instanceof vt)this.walkMany(r,s,n);else if(r instanceof Mn)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new Yt({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=bg(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new Yt({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=bg(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);me(e.definition,s=>{const o=new Jt({definition:[s]});this.walk(o,i)})}}function bg(t,e,n){return[new Yt({definition:[new nt({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function qs(t){if(t instanceof Zt)return qs(t.referencedRule);if(t instanceof nt)return uI(t);if(oI(t))return cI(t);if(aI(t))return lI(t);throw Error("non exhaustive match")}function cI(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Ma(s),e=e.concat(qs(s)),r=r+1,i=n.length>r;return Na(e)}function lI(t){const e=le(t.definition,n=>qs(n));return Na(rn(e))}function uI(t){return[t.terminalType]}const wg="_~IN~_";class hI extends Ua{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=dI(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new Jt({definition:s}),a=qs(o);this.follows[i]=a}}function fI(t){const e={};return me(t,n=>{const r=new hI(n).startWalking();Kt(e,r)}),e}function dI(t,e){return t.name+e+wg}function ge(t){return t.charCodeAt(0)}function Nu(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function Xs(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function Qi(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function pI(){throw Error("Internal Error - Should never get here!")}function vg(t){return t.type==="Character"}const Pa=[];for(let t=ge("0");t<=ge("9");t++)Pa.push(t);const Da=[ge("_")].concat(Pa);for(let t=ge("a");t<=ge("z");t++)Da.push(t);for(let t=ge("A");t<=ge("Z");t++)Da.push(t);const Eg=[ge(" "),ge("\f"),ge(`
`),ge("\r"),ge("	"),ge("\v"),ge("	"),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge("\u2028"),ge("\u2029"),ge(" "),ge(" "),ge("　"),ge("\uFEFF")],mI=/[0-9a-fA-F]/,Ba=/[0-9]/,gI=/[1-9]/;class yI{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Xs(r,"global");break;case"i":Xs(r,"ignoreCase");break;case"m":Xs(r,"multiLine");break;case"u":Xs(r,"unicode");break;case"y":Xs(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Qi(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return pI()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;Qi(n);break}if(!(e===!0&&n===void 0)&&Qi(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),Qi(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[ge(`
`),ge("\r"),ge("\u2028"),ge("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=Pa;break;case"D":e=Pa,n=!0;break;case"s":e=Eg;break;case"S":e=Eg,n=!0;break;case"w":e=Da;break;case"W":e=Da,n=!0;break}if(Qi(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=ge("\f");break;case"n":e=ge(`
`);break;case"r":e=ge("\r");break;case"t":e=ge("	");break;case"v":e=ge("\v");break}if(Qi(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:ge("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:ge(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:ge(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,vg(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,vg(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else Nu(r.value,e),e.push(ge("-")),Nu(i.value,e)}else Nu(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:ge("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(gI.test(e)===!1)throw Error("Expecting a positive integer");for(;Ba.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Ba.test(e)===!1)throw Error("Expecting an integer");for(;Ba.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:ge(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Ba.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(mI.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class Lu{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let Fa={};const _I=new yI;function $a(t){const e=t.toString();if(Fa.hasOwnProperty(e))return Fa[e];{const n=_I.pattern(e);return Fa[e]=n,n}}function bI(){Fa={}}const kg="Complement Sets are not supported for first char optimization",ja=`Unable to use "first char" lexer optimizations:
`;function wI(t,e=!1){try{const n=$a(t);return Mu(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===kg)e&&gg(`${ja}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Cu(`${ja}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Mu(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)Mu(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":za(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(kg);me(o.value,c=>{if(typeof c=="number")za(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)za(u,e,n);else{for(let u=l.from;u<=l.to&&u<Js;u++)za(u,e,n);if(l.to>=Js){const u=l.from>=Js?l.from:Js,h=l.to,d=Gr(u),f=Gr(h);for(let p=d;p<=f;p++)e[p]=p}}}});break;case"Group":Mu(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Uu(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return dt(e)}function za(t,e,n){const r=Gr(t);e[r]=r,n===!0&&vI(t,e)}function vI(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=Gr(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Gr(i.charCodeAt(0));e[s]=s}}}function Sg(t,e){return Ji(t.value,n=>{if(typeof n=="number")return $t(e,n);{const r=n;return Ji(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function Uu(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?Me(t.value)?On(t.value,Uu):Uu(t.value):!1}class EI extends Lu{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){$t(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?Sg(e,this.targetCharCodes)===void 0&&(this.found=!0):Sg(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Pu(t,e){if(e instanceof RegExp){const n=$a(e),r=new EI(t);return r.visit(n),r.found}else return Ji(e,n=>$t(t,n.charCodeAt(0)))!==void 0}const yi="PATTERN",Zs="defaultMode",Wa="modes";let Ag=typeof new RegExp("(?:)").sticky=="boolean";function kI(t,e){e=Iu(e,{useSticky:Ag,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(w,v)=>v()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{VI()});let r;n("Reject Lexer.NA",()=>{r=Ca(t,w=>w[yi]===Et.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=le(r,w=>{const v=w[yi];if(vr(v)){const A=v.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!v.ignoreCase?A:A.length===2&&A[0]==="\\"&&!$t(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:e.useSticky?Tg(v):xg(v)}else{if(_r(v))return i=!0,{exec:v};if(typeof v=="object")return i=!0,v;if(typeof v=="string"){if(v.length===1)return v;{const A=v.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),O=new RegExp(A);return e.useSticky?Tg(O):xg(O)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=le(r,w=>w.tokenTypeIdx),a=le(r,w=>{const v=w.GROUP;if(v!==Et.SKIPPED){if(qt(v))return v;if(Er(v))return!1;throw Error("non exhaustive match")}}),c=le(r,w=>{const v=w.LONGER_ALT;if(v)return Me(v)?le(v,O=>pg(r,O)):[pg(r,v)]}),l=le(r,w=>w.PUSH_MODE),u=le(r,w=>pe(w,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const w=Og(e.lineTerminatorCharacters);h=le(r,v=>!1),e.positionTracking!=="onlyOffset"&&(h=le(r,v=>pe(v,"LINE_BREAKS")?!!v.LINE_BREAKS:Ig(v,w)===!1&&Pu(w,v.PATTERN)))});let d,f,p,m;n("Misc Mapping #2",()=>{d=le(r,Rg),f=le(s,WI),p=Xt(r,(w,v)=>{const A=v.GROUP;return qt(A)&&A!==Et.SKIPPED&&(w[A]=[]),w},{}),m=le(s,(w,v)=>({pattern:s[v],longerAlt:c[v],canLineTerminator:h[v],isCustom:d[v],short:f[v],group:a[v],push:l[v],pop:u[v],tokenTypeIdx:o[v],tokenType:r[v]}))});let b=!0,_=[];return e.safeMode||n("First Char Optimization",()=>{_=Xt(r,(w,v,A)=>{if(typeof v.PATTERN=="string"){const O=v.PATTERN.charCodeAt(0),x=Gr(O);Du(w,x,m[A])}else if(Me(v.START_CHARS_HINT)){let O;me(v.START_CHARS_HINT,x=>{const R=typeof x=="string"?x.charCodeAt(0):x,$=Gr(R);O!==$&&(O=$,Du(w,$,m[A]))})}else if(vr(v.PATTERN))if(v.PATTERN.unicode)b=!1,e.ensureOptimizations&&Cu(`${ja}	Unable to analyze < ${v.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const O=wI(v.PATTERN,e.ensureOptimizations);qe(O)&&(b=!1),me(O,x=>{Du(w,x,m[A])})}else e.ensureOptimizations&&Cu(`${ja}	TokenType: <${v.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return w},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:_,hasCustom:i,canBeOptimized:b}}function SI(t,e){let n=[];const r=xI(t);n=n.concat(r.errors);const i=TI(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(AI(s)),n=n.concat(UI(s)),n=n.concat(PI(s,e)),n=n.concat(DI(s)),n}function AI(t){let e=[];const n=gn(t,r=>vr(r[yi]));return e=e.concat(II(n)),e=e.concat(NI(n)),e=e.concat(LI(n)),e=e.concat(MI(n)),e=e.concat(OI(n)),e}function xI(t){const e=gn(t,i=>!pe(i,yi)),n=le(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:at.MISSING_PATTERN,tokenTypes:[i]})),r=Oa(t,e);return{errors:n,valid:r}}function TI(t){const e=gn(t,i=>{const s=i[yi];return!vr(s)&&!_r(s)&&!pe(s,"exec")&&!qt(s)}),n=le(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:at.INVALID_PATTERN,tokenTypes:[i]})),r=Oa(t,e);return{errors:n,valid:r}}const RI=/[^\\][$]/;function II(t){class e extends Lu{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=gn(t,i=>{const s=i.PATTERN;try{const o=$a(s),a=new e;return a.visit(o),a.found}catch{return RI.test(s.source)}});return le(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:at.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function OI(t){const e=gn(t,r=>r.PATTERN.test(""));return le(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:at.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const CI=/[^\\[][\^]|^\^/;function NI(t){class e extends Lu{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=gn(t,i=>{const s=i.PATTERN;try{const o=$a(s),a=new e;return a.visit(o),a.found}catch{return CI.test(s.source)}});return le(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:at.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function LI(t){const e=gn(t,r=>{const i=r[yi];return i instanceof RegExp&&(i.multiline||i.global)});return le(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:at.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function MI(t){const e=[];let n=le(t,s=>Xt(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!$t(e,a)&&a.PATTERN!==Et.NA&&(e.push(a),o.push(a)),o),[]));n=Vs(n);const r=gn(n,s=>s.length>1);return le(r,s=>{const o=le(s,c=>c.name);return{message:`The same RegExp pattern ->${Cn(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:at.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function UI(t){const e=gn(t,r=>{if(!pe(r,"GROUP"))return!1;const i=r.GROUP;return i!==Et.SKIPPED&&i!==Et.NA&&!qt(i)});return le(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:at.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function PI(t,e){const n=gn(t,i=>i.PUSH_MODE!==void 0&&!$t(e,i.PUSH_MODE));return le(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:at.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function DI(t){const e=[],n=Xt(t,(r,i,s)=>{const o=i.PATTERN;return o===Et.NA||(qt(o)?r.push({str:o,idx:s,tokenType:i}):vr(o)&&FI(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return me(t,(r,i)=>{me(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&BI(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:at.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function BI(t,e){if(vr(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(_r(e))return e(t,0,[],{});if(pe(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function FI(t){return Ji([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function xg(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function Tg(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function $I(t,e,n){const r=[];return pe(t,Zs)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Zs+`> property in its definition
`,type:at.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),pe(t,Wa)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Wa+`> property in its definition
`,type:at.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),pe(t,Wa)&&pe(t,Zs)&&!pe(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Zs}: <${t.defaultMode}>which does not exist
`,type:at.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),pe(t,Wa)&&me(t.modes,(i,s)=>{me(i,(o,a)=>{if(Er(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:at.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(pe(o,"LONGER_ALT")){const c=Me(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];me(c,l=>{!Er(l)&&!$t(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:at.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function jI(t,e,n){const r=[];let i=!1;const s=Vs(rn(dt(t.modes))),o=Ca(s,c=>c[yi]===Et.NA),a=Og(n);return e&&me(o,c=>{const l=Ig(c,a);if(l!==!1){const h={message:HI(c,l),type:l.issue,tokenType:c};r.push(h)}else pe(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Pu(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:at.NO_LINE_BREAKS_FLAGS}),r}function zI(t){const e={},n=pn(t);return me(n,r=>{const i=t[r];if(Me(i))e[r]=[];else throw Error("non exhaustive match")}),e}function Rg(t){const e=t.PATTERN;if(vr(e))return!1;if(_r(e))return!0;if(pe(e,"exec"))return!0;if(qt(e))return!1;throw Error("non exhaustive match")}function WI(t){return qt(t)&&t.length===1?t.charCodeAt(0):!1}const GI={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Ig(t,e){if(pe(t,"LINE_BREAKS"))return!1;if(vr(t.PATTERN)){try{Pu(e,t.PATTERN)}catch(n){return{issue:at.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(qt(t.PATTERN))return!1;if(Rg(t))return{issue:at.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function HI(t,e){if(e.issue===at.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===at.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Og(t){return le(t,n=>qt(n)?n.charCodeAt(0):n)}function Du(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const Js=256;let Ga=[];function Gr(t){return t<Js?t:Ga[t]}function VI(){if(qe(Ga)){Ga=new Array(65536);for(let t=0;t<65536;t++)Ga[t]=t>255?255+~~(t/255):t}}function Ys(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function Ha(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let Cg=1;const Ng={};function Qs(t){const e=KI(t);qI(e),ZI(e),XI(e),me(e,n=>{n.isParent=n.categoryMatches.length>0})}function KI(t){let e=Nt(t),n=t,r=!0;for(;r;){n=Vs(rn(le(n,s=>s.CATEGORIES)));const i=Oa(n,e);e=e.concat(i),qe(i)?r=!1:n=i}return e}function qI(t){me(t,e=>{Mg(e)||(Ng[Cg]=e,e.tokenTypeIdx=Cg++),Ug(e)&&!Me(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Ug(e)||(e.CATEGORIES=[]),JI(e)||(e.categoryMatches=[]),YI(e)||(e.categoryMatchesMap={})})}function XI(t){me(t,e=>{e.categoryMatches=[],me(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(Ng[r].tokenTypeIdx)})})}function ZI(t){me(t,e=>{Lg([],e)})}function Lg(t,e){me(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),me(e.CATEGORIES,n=>{const r=t.concat(e);$t(r,n)||Lg(r,n)})}function Mg(t){return pe(t,"tokenTypeIdx")}function Ug(t){return pe(t,"CATEGORIES")}function JI(t){return pe(t,"categoryMatches")}function YI(t){return pe(t,"categoryMatchesMap")}function QI(t){return pe(t,"tokenTypeIdx")}const eO={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var at;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(at||(at={}));const eo={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:eO,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(eo);class Et{constructor(e,n=eo){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=yg(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Kt({},eo,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===eo.lineTerminatorsPattern)this.config.lineTerminatorsPattern=GI;else if(this.config.lineTerminatorCharacters===eo.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Me(e)?i={modes:{defaultMode:Nt(e)},defaultMode:Zs}:(s=!1,i=Nt(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat($I(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(jI(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},me(i.modes,(a,c)=>{i.modes[c]=Ca(a,l=>Er(l))});const o=pn(i.modes);if(me(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(SI(a,o))}),qe(this.lexerDefinitionErrors)){Qs(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=kI(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Kt({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!qe(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=le(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}me(this.lexerDefinitionWarning,a=>{gg(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Ag?(this.chopInput=Ki,this.match=this.matchWithTest):(this.updateLastIndex=wt,this.match=this.matchWithExec),s&&(this.handleModes=wt),this.trackStartLines===!1&&(this.computeNewColumn=Ki),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=wt),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Xt(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!qe(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{bI()}),this.TRACE_INIT("toFastProperties",()=>{_g(this)})})}tokenize(e,n=this.defaultMode){if(!qe(this.lexerDefinitionErrors)){const i=le(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,h,d,f,p,m,b,_;const w=e,v=w.length;let A=0,O=0;const x=this.hasCustom?0:Math.floor(e.length/10),R=new Array(x),$=[];let L=this.trackStartLines?1:void 0,V=this.trackStartLines?1:void 0;const Y=zI(this.emptyGroups),I=this.trackStartLines,E=this.config.lineTerminatorsPattern;let g=0,N=[],j=[];const U=[],Q=[];Object.freeze(Q);let H;function J(){return N}function F(we){const je=Gr(we),be=j[je];return be===void 0?Q:be}const D=we=>{if(U.length===1&&we.tokenType.PUSH_MODE===void 0){const je=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(we);$.push({offset:we.startOffset,line:we.startLine,column:we.startColumn,length:we.image.length,message:je})}else{U.pop();const je=Zi(U);N=this.patternIdxToConfig[je],j=this.charCodeToPatternIdxToConfig[je],g=N.length;const be=this.canModeBeOptimized[je]&&this.config.safeMode===!1;j&&be?H=F:H=J}};function ae(we){U.push(we),j=this.charCodeToPatternIdxToConfig[we],N=this.patternIdxToConfig[we],g=N.length,g=N.length;const je=this.canModeBeOptimized[we]&&this.config.safeMode===!1;j&&je?H=F:H=J}ae.call(this,n);let ee;const te=this.config.recoveryEnabled;for(;A<v;){c=null;const we=w.charCodeAt(A),je=H(we),be=je.length;for(r=0;r<be;r++){ee=je[r];const _e=ee.pattern;l=null;const We=ee.short;if(We!==!1?we===We&&(c=_e):ee.isCustom===!0?(_=_e.exec(w,A,R,Y),_!==null?(c=_[0],_.payload!==void 0&&(l=_.payload)):c=null):(this.updateLastIndex(_e,A),c=this.match(_e,e,A)),c!==null){if(a=ee.longerAlt,a!==void 0){const $e=a.length;for(s=0;s<$e;s++){const gt=N[a[s]],kt=gt.pattern;if(u=null,gt.isCustom===!0?(_=kt.exec(w,A,R,Y),_!==null?(o=_[0],_.payload!==void 0&&(u=_.payload)):o=null):(this.updateLastIndex(kt,A),o=this.match(kt,e,A)),o&&o.length>c.length){c=o,l=u,ee=gt;break}}}break}}if(c!==null){if(h=c.length,d=ee.group,d!==void 0&&(f=ee.tokenTypeIdx,p=this.createTokenInstance(c,A,f,ee.tokenType,L,V,h),this.handlePayload(p,l),d===!1?O=this.addToken(R,O,p):Y[d].push(p)),e=this.chopInput(e,h),A=A+h,V=this.computeNewColumn(V,h),I===!0&&ee.canLineTerminator===!0){let _e=0,We,$e;E.lastIndex=0;do We=E.test(c),We===!0&&($e=E.lastIndex-1,_e++);while(We===!0);_e!==0&&(L=L+_e,V=h-$e,this.updateTokenEndLineColumnLocation(p,d,$e,_e,L,V,h))}this.handleModes(ee,D,ae,p)}else{const _e=A,We=L,$e=V;let gt=te===!1;for(;gt===!1&&A<v;)for(e=this.chopInput(e,1),A++,i=0;i<g;i++){const kt=N[i],y=kt.pattern,K=kt.short;if(K!==!1?w.charCodeAt(A)===K&&(gt=!0):kt.isCustom===!0?gt=y.exec(w,A,R,Y)!==null:(this.updateLastIndex(y,A),gt=y.exec(e)!==null),gt===!0)break}if(m=A-_e,V=this.computeNewColumn(V,m),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(w,_e,m,We,$e),$.push({offset:_e,line:We,column:$e,length:m,message:b}),te===!1)break}}return this.hasCustom||(R.length=O),{tokens:R,groups:Y,errors:$}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}}Et.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Et.NA=/NOT_APPLICABLE/;function to(t){return Pg(t)?t.LABEL:t.name}function Pg(t){return qt(t.LABEL)&&t.LABEL!==""}const tO="parent",Dg="categories",Bg="label",Fg="group",$g="push_mode",jg="pop_mode",zg="longer_alt",Wg="line_breaks",Gg="start_chars_hint";function sn(t){return nO(t)}function nO(t){const e=t.pattern,n={};if(n.name=t.name,Er(e)||(n.PATTERN=e),pe(t,tO))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return pe(t,Dg)&&(n.CATEGORIES=t[Dg]),Qs([n]),pe(t,Bg)&&(n.LABEL=t[Bg]),pe(t,Fg)&&(n.GROUP=t[Fg]),pe(t,jg)&&(n.POP_MODE=t[jg]),pe(t,$g)&&(n.PUSH_MODE=t[$g]),pe(t,zg)&&(n.LONGER_ALT=t[zg]),pe(t,Wg)&&(n.LINE_BREAKS=t[Wg]),pe(t,Gg)&&(n.START_CHARS_HINT=t[Gg]),n}const _i=sn({name:"EOF",pattern:Et.NA});Qs([_i]);function Va(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function rO(t,e){return Ys(t,e)}const Hg={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${Pg(t)?`--> ${to(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Cn(e).image+"'";if(r)return s+r+a;{const c=Xt(t,(d,f)=>d.concat(f),[]),l=le(c,d=>`[${le(d,f=>to(f)).join(", ")}]`),h=`one of these possible Token sequences:
${le(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Cn(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${le(t,l=>`[${le(l,u=>to(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Hg);const iO={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},bi={buildDuplicateFoundError(t,e){function n(u){return u instanceof nt?u.terminalType.name:u instanceof Zt?u.nonTerminalName:""}const r=t.name,i=Cn(e),s=i.idx,o=Qn(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=le(t.prefixPath,i=>to(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=le(t.prefixPath,i=>to(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=Qn(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=le(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Yi?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function sO(t,e){const n=new oO(t,e);return n.resolveRefs(),n.errors}class oO extends gi{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){me(dt(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:jt.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class aO extends Ua{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Nt(this.path.ruleStack).reverse(),this.occurrenceStack=Nt(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){qe(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class cO extends aO{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Jt({definition:i});this.possibleTokTypes=qs(s),this.found=!0}}}class Ka extends Ua{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class lO extends Ka{walkMany(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof nt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class Vg extends Ka{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof nt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class uO extends Ka{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof nt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class Kg extends Ka{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof nt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function Bu(t,e,n=[]){n=Nt(n);let r=[],i=0;function s(a){return a.concat(Lt(t,i+1))}function o(a){const c=Bu(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof Jt)return o(a.definition);if(a instanceof Zt)return o(a.definition);if(a instanceof Yt)r=o(a.definition);else if(a instanceof Jn){const c=a.definition.concat([new vt({definition:a.definition})]);return o(c)}else if(a instanceof Yn){const c=[new Jt({definition:a.definition}),new vt({definition:[new nt({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Ln){const c=a.definition.concat([new vt({definition:[new nt({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof vt){const c=a.definition.concat([new vt({definition:a.definition})]);r=o(c)}else{if(a instanceof Mn)return me(a.definition,c=>{qe(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof nt)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Lt(t,i)}),r}function qg(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!qe(h);){const d=h.pop();if(d===o){a&&Zi(h).idx<=l&&h.pop();continue}const f=d.def,p=d.idx,m=d.ruleStack,b=d.occurrenceStack;if(qe(f))continue;const _=f[0];if(_===i){const w={idx:p,def:Lt(f),ruleStack:Ks(m),occurrenceStack:Ks(b)};h.push(w)}else if(_ instanceof nt)if(p<c-1){const w=p+1,v=e[w];if(n(v,_.terminalType)){const A={idx:w,def:Lt(f),ruleStack:m,occurrenceStack:b};h.push(A)}}else if(p===c-1)u.push({nextTokenType:_.terminalType,nextTokenOccurrence:_.idx,ruleStack:m,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(_ instanceof Zt){const w=Nt(m);w.push(_.nonTerminalName);const v=Nt(b);v.push(_.idx);const A={idx:p,def:_.definition.concat(s,Lt(f)),ruleStack:w,occurrenceStack:v};h.push(A)}else if(_ instanceof Yt){const w={idx:p,def:Lt(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const v={idx:p,def:_.definition.concat(Lt(f)),ruleStack:m,occurrenceStack:b};h.push(v)}else if(_ instanceof Jn){const w=new vt({definition:_.definition,idx:_.idx}),v=_.definition.concat([w],Lt(f)),A={idx:p,def:v,ruleStack:m,occurrenceStack:b};h.push(A)}else if(_ instanceof Yn){const w=new nt({terminalType:_.separator}),v=new vt({definition:[w].concat(_.definition),idx:_.idx}),A=_.definition.concat([v],Lt(f)),O={idx:p,def:A,ruleStack:m,occurrenceStack:b};h.push(O)}else if(_ instanceof Ln){const w={idx:p,def:Lt(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const v=new nt({terminalType:_.separator}),A=new vt({definition:[v].concat(_.definition),idx:_.idx}),O=_.definition.concat([A],Lt(f)),x={idx:p,def:O,ruleStack:m,occurrenceStack:b};h.push(x)}else if(_ instanceof vt){const w={idx:p,def:Lt(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const v=new vt({definition:_.definition,idx:_.idx}),A=_.definition.concat([v],Lt(f)),O={idx:p,def:A,ruleStack:m,occurrenceStack:b};h.push(O)}else if(_ instanceof Mn)for(let w=_.definition.length-1;w>=0;w--){const v=_.definition[w],A={idx:p,def:v.definition.concat(Lt(f)),ruleStack:m,occurrenceStack:b};h.push(A),h.push(o)}else if(_ instanceof Jt)h.push({idx:p,def:_.definition.concat(Lt(f)),ruleStack:m,occurrenceStack:b});else if(_ instanceof Yi)h.push(hO(_,p,m,b));else throw Error("non exhaustive match")}return u}function hO(t,e,n,r){const i=Nt(n);i.push(t.name);const s=Nt(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var ct;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(ct||(ct={}));function Xg(t){if(t instanceof Yt||t==="Option")return ct.OPTION;if(t instanceof vt||t==="Repetition")return ct.REPETITION;if(t instanceof Jn||t==="RepetitionMandatory")return ct.REPETITION_MANDATORY;if(t instanceof Yn||t==="RepetitionMandatoryWithSeparator")return ct.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Ln||t==="RepetitionWithSeparator")return ct.REPETITION_WITH_SEPARATOR;if(t instanceof Mn||t==="Alternation")return ct.ALTERNATION;throw Error("non exhaustive match")}function fO(t,e,n,r,i,s){const o=$u(t,e,n),a=Qg(o)?Ha:Ys;return s(o,r,a,i)}function dO(t,e,n,r,i,s){const o=ju(t,e,i,n),a=Qg(o)?Ha:Ys;return s(o[0],a,r)}function pO(t,e,n,r){const i=t.length,s=On(t,o=>On(o,a=>a.length===1));if(e)return function(o){const a=le(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let d=0;d<u;d++){const f=l[d],p=f.length;for(let m=0;m<p;m++){const b=this.LA(m+1);if(n(b,f[m])===!1)continue e}return c}}};if(s&&!r){const o=le(t,c=>rn(c)),a=Xt(o,(c,l,u)=>(me(l,h=>{pe(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),me(h.categoryMatches,d=>{pe(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue e}return o}}}}function mO(t,e,n){const r=On(t,s=>s.length===1),i=t.length;if(r&&!n){const s=rn(t);if(s.length===1&&qe(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Xt(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,me(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class gO extends Ua{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,ct.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,ct.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,ct.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,ct.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,ct.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class Zg extends gi{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,ct.OPTION)}visitRepetition(e){this.checkIsTarget(e,ct.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,ct.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,ct.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,ct.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,ct.ALTERNATION)}}function Jg(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function Fu(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function yO(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function Yg(t,e){const n=le(t,o=>Bu([o],1)),r=Jg(n.length),i=le(n,o=>{const a={};return me(o,c=>{const l=Fu(c.partialPath);me(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=Jg(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=Fu(h);if(yO(i,f,c)||qe(d)||h.length===e){const m=r[c];if(zu(m,h)===!1){m.push(h);for(let b=0;b<f.length;b++){const _=f[b];i[c][_]=!0}}}else{const m=Bu(d,o+1,h);s[c]=s[c].concat(m),me(m,b=>{const _=Fu(b.partialPath);me(_,w=>{i[c][w]=!0})})}}}}return r}function $u(t,e,n,r){const i=new Zg(t,ct.ALTERNATION,r);return e.accept(i),Yg(i.result,n)}function ju(t,e,n,r){const i=new Zg(t,n);e.accept(i);const s=i.result,a=new gO(e,t,n).startWalking(),c=new Jt({definition:s}),l=new Jt({definition:a});return Yg([c,l],r)}function zu(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function _O(t,e){return t.length<e.length&&On(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function Qg(t){return On(t,e=>On(e,n=>On(n,r=>qe(r.categoryMatches))))}function bO(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return le(e,n=>Object.assign({type:jt.CUSTOM_LOOKAHEAD_VALIDATION},n))}function wO(t,e,n,r){const i=yn(t,c=>vO(c,n)),s=LO(t,e,n),o=yn(t,c=>IO(c,n)),a=yn(t,c=>SO(c,t,r,n));return i.concat(s,o,a)}function vO(t,e){const n=new kO;t.accept(n);const r=n.allProductions,i=dg(r,EO),s=Nn(i,a=>a.length>1);return le(dt(s),a=>{const c=Cn(a),l=e.buildDuplicateFoundError(t,a),u=Qn(c),h={message:l,type:jt.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=e0(c);return d&&(h.parameter=d),h})}function EO(t){return`${Qn(t)}_#_${t.idx}_#_${e0(t)}`}function e0(t){return t instanceof nt?t.terminalType.name:t instanceof Zt?t.nonTerminalName:""}class kO extends gi{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function SO(t,e,n,r){const i=[];if(Xt(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:jt.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function AO(t,e,n){const r=[];let i;return $t(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:jt.INVALID_RULE_OVERRIDE,ruleName:t})),r}function t0(t,e,n,r=[]){const i=[],s=qa(e.definition);if(qe(s))return[];{const o=t.name;$t(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:jt.LEFT_RECURSION,ruleName:o});const c=Oa(s,r.concat([t])),l=yn(c,u=>{const h=Nt(r);return h.push(u),t0(t,u,n,h)});return i.concat(l)}}function qa(t){let e=[];if(qe(t))return e;const n=Cn(t);if(n instanceof Zt)e.push(n.referencedRule);else if(n instanceof Jt||n instanceof Yt||n instanceof Jn||n instanceof Yn||n instanceof Ln||n instanceof vt)e=e.concat(qa(n.definition));else if(n instanceof Mn)e=rn(le(n.definition,s=>qa(s.definition)));else if(!(n instanceof nt))throw Error("non exhaustive match");const r=Ma(n),i=t.length>1;if(r&&i){const s=Lt(t);return e.concat(qa(s))}else return e}class Wu extends gi{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function xO(t,e){const n=new Wu;t.accept(n);const r=n.alternations;return yn(r,s=>{const o=Ks(s.definition);return yn(o,(a,c)=>{const l=qg([a],[],Ys,1);return qe(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:jt.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function TO(t,e,n){const r=new Wu;t.accept(r);let i=r.alternations;return i=Ca(i,o=>o.ignoreAmbiguities===!0),yn(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=$u(a,t,c,o),u=CO(l,o,t,n),h=NO(l,o,t,n);return u.concat(h)})}class RO extends gi{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function IO(t,e){const n=new Wu;t.accept(n);const r=n.alternations;return yn(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:jt.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function OO(t,e,n){const r=[];return me(t,i=>{const s=new RO;i.accept(s);const o=s.allProductions;me(o,a=>{const c=Xg(a),l=a.maxLookahead||e,u=a.idx,d=ju(u,i,c,l)[0];if(qe(rn(d))){const f=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:f,type:jt.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function CO(t,e,n,r){const i=[],s=Xt(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||me(c,u=>{const h=[l];me(t,(d,f)=>{l!==f&&zu(d,u)&&e.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!zu(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return le(s,a=>{const c=le(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:jt.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function NO(t,e,n,r){const i=Xt(t,(o,a,c)=>{const l=le(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Vs(yn(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=gn(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&_O(d.path,l));return le(u,d=>{const f=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:f,prefixPath:d.path}),type:jt.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function LO(t,e,n){const r=[],i=le(e,s=>s.name);return me(t,s=>{const o=s.name;if($t(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:jt.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function MO(t){const e=Iu(t,{errMsgProvider:iO}),n={};return me(t.rules,r=>{n[r.name]=r}),sO(n,e.errMsgProvider)}function UO(t){return t=Iu(t,{errMsgProvider:bi}),wO(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const n0="MismatchedTokenException",r0="NoViableAltException",i0="EarlyExitException",s0="NotAllInputParsedException",o0=[n0,r0,i0,s0];Object.freeze(o0);function Xa(t){return $t(o0,t.name)}class Za extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class a0 extends Za{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=n0}}class PO extends Za{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=r0}}class DO extends Za{constructor(e,n){super(e,n),this.name=s0}}class BO extends Za{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=i0}}const Gu={},c0="InRuleRecoveryException";class FO extends Error{constructor(e){super(e),this.name=c0}}class $O{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=pe(e,"recoveryEnabled")?e.recoveryEnabled:kr.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=jO)}getTokenToInsert(e){const n=Va(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new a0(f,l,this.LA(0));p.resyncedTokens=Ks(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new FO("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||qe(n))return!1;const r=this.LA(1);return Ji(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return $t(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Ji(e,s=>rO(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Gu;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return le(e,(r,i)=>i===0?Gu:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=le(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return rn(e)}getFollowSetFromFollowKey(e){if(e===Gu)return[_i];const n=e.ruleName+e.idxInCallingRule+wg+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,_i)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Ks(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=Nt(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return le(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function jO(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=_i,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const zO=4,Hr=8,l0=1<<Hr,u0=2<<Hr,Hu=3<<Hr,Vu=4<<Hr,Ku=5<<Hr,Ja=6<<Hr;function qu(t,e,n){return n|e|t}class WO{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:kr.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(qe(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return yn(e,n=>t0(n,n,bi))}validateEmptyOrAlternatives(e){return yn(e,n=>xO(n,bi))}validateAmbiguousAlternationAlternatives(e,n){return yn(e,r=>TO(r,n,bi))}validateSomeNonEmptyLookaheadPath(e,n){return OO(e,n,bi)}buildLookaheadForAlternation(e){return fO(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,pO)}buildLookaheadForOptional(e){return dO(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Xg(e.prodType),mO)}}class GO{initLooksAhead(e){this.dynamicTokensEnabled=pe(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:kr.dynamicTokensEnabled,this.maxLookahead=pe(e,"maxLookahead")?e.maxLookahead:kr.maxLookahead,this.lookaheadStrategy=pe(e,"lookaheadStrategy")?e.lookaheadStrategy:new WO({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){me(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=VO(n);me(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Qn(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=qu(this.fullRuleNameToShort[n.name],l0,l.idx);this.setLaFuncCache(d,h)})}),me(i,l=>{this.computeLookaheadFunc(n,l.idx,Hu,"Repetition",l.maxLookahead,Qn(l))}),me(s,l=>{this.computeLookaheadFunc(n,l.idx,u0,"Option",l.maxLookahead,Qn(l))}),me(o,l=>{this.computeLookaheadFunc(n,l.idx,Vu,"RepetitionMandatory",l.maxLookahead,Qn(l))}),me(a,l=>{this.computeLookaheadFunc(n,l.idx,Ja,"RepetitionMandatoryWithSeparator",l.maxLookahead,Qn(l))}),me(c,l=>{this.computeLookaheadFunc(n,l.idx,Ku,"RepetitionWithSeparator",l.maxLookahead,Qn(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=qu(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return qu(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class HO extends gi{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Ya=new HO;function VO(t){Ya.reset(),t.accept(Ya);const e=Ya.dslMethods;return Ya.reset(),e}function h0(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function f0(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function KO(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function qO(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const XO="name";function d0(t,e){Object.defineProperty(t,XO,{enumerable:!1,configurable:!0,writable:!1,value:e})}function ZO(t,e){const n=pn(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function JO(t,e){const n=function(){};d0(n,t+"BaseSemantics");const r={visit:function(i,s){if(Me(i)&&(i=i[0]),!Er(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=QO(this,e);if(!qe(i)){const s=le(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function YO(t,e,n){const r=function(){};d0(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return me(e,s=>{i[s]=ZO}),r.prototype=i,r.prototype.constructor=r,r}var Xu;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(Xu||(Xu={}));function QO(t,e){return eC(t,e)}function eC(t,e){const n=gn(e,i=>_r(t[i])===!1),r=le(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:Xu.MISSING_METHOD,methodName:i}));return Vs(r)}class tC{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=pe(e,"nodeLocationTracking")?e.nodeLocationTracking:kr.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=wt,this.cstFinallyStateUpdate=wt,this.cstPostTerminal=wt,this.cstPostNonTerminal=wt,this.cstPostRule=wt;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=f0,this.setNodeLocationFromNode=f0,this.cstPostRule=wt,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=wt,this.setNodeLocationFromNode=wt,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=h0,this.setNodeLocationFromNode=h0,this.cstPostRule=wt,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=wt,this.setNodeLocationFromNode=wt,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=wt,this.setNodeLocationFromNode=wt,this.cstPostRule=wt,this.setInitialNodeLocation=wt;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];KO(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];qO(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Er(this.baseCstVisitorConstructor)){const e=JO(this.className,pn(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Er(this.baseCstVisitorWithDefaultsConstructor)){const e=YO(this.className,pn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class nC{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):tc}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?tc:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class rC{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=nc){if($t(this.definedRulesNames,e)){const o={message:bi.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:jt.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=nc){const i=AO(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Xa(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return sI(dt(this.gastProductionsCache))}}class iC{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Ha,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},pe(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Me(e)){if(qe(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Me(e))this.tokensMap=Xt(e,(s,o)=>(s[o.name]=o,s),{});else if(pe(e,"modes")&&On(rn(dt(e.modes)),QI)){const s=rn(dt(e.modes)),o=Na(s);this.tokensMap=Xt(o,(a,c)=>(a[c.name]=c,a),{})}else if(dn(e))this.tokensMap=Nt(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=_i;const r=pe(e,"modes")?rn(dt(e.modes)):dt(e),i=On(r,s=>qe(s.categoryMatches));this.tokenMatcher=i?Ha:Ys,Qs(dt(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=pe(r,"resyncEnabled")?r.resyncEnabled:nc.resyncEnabled,s=pe(r,"recoveryValueFunc")?r.recoveryValueFunc:nc.recoveryValueFunc,o=this.ruleShortNameIdx<<zO+Hr;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Xa(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(u0,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(Vu,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,ct.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,Vu,e,uO)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Ja,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Kg],a,Ja,e,Kg)}else throw this.raiseEarlyExitException(e,ct.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(Hu,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,Hu,e,lO,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Ku,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Vg],a,Ku,e,Vg)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,Ja,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(l0,n),i=Me(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new DO(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Xa(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new a0(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===c0?r:s}}else throw r}saveRecogState(){const e=this.errors,n=Nt(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),_i)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class sC{initErrorHandler(e){this._errors=[],this.errorMessageProvider=pe(e,"errorMessageProvider")?e.errorMessageProvider:kr.errorMessageProvider}SAVE_ERROR(e){if(Xa(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Nt(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Nt(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=ju(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new BO(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=$u(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new PO(c,this.LA(1),a))}}class oC{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Er(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return qg([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=Cn(e.ruleStack),i=this.getGAstProductions()[n];return new cO(i,e).startWalking()}}const Qa={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Qa);const p0=!0,m0=Math.pow(2,Hr)-1,g0=sn({name:"RECORDING_PHASE_TOKEN",pattern:Et.NA});Qs([g0]);const y0=Va(g0,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(y0);const aC={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class cC{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return tc}topLevelRuleRecord(e,n){try{const r=new Yi({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return no.call(this,Yt,e,n)}atLeastOneInternalRecord(e,n){no.call(this,Jn,n,e)}atLeastOneSepFirstInternalRecord(e,n){no.call(this,Yn,n,e,p0)}manyInternalRecord(e,n){no.call(this,vt,n,e)}manySepFirstInternalRecord(e,n){no.call(this,Ln,n,e,p0)}orInternalRecord(e,n){return lC.call(this,e,n)}subruleInternalRecord(e,n,r){if(ec(n),!e||pe(e,"ruleName")===!1){const a=new Error(`<SUBRULE${_0(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Zi(this.recordingProdStack),s=e.ruleName,o=new Zt({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?aC:Qa}consumeInternalRecord(e,n,r){if(ec(n),!Mg(e)){const o=new Error(`<CONSUME${_0(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Zi(this.recordingProdStack),s=new nt({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),y0}}function no(t,e,n,r=!1){ec(n);const i=Zi(this.recordingProdStack),s=_r(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),pe(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Qa}function lC(t,e){ec(e);const n=Zi(this.recordingProdStack),r=Me(t)===!1,i=r===!1?t:t.DEF,s=new Mn({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});pe(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=Ou(i,a=>_r(a.GATE));return s.hasPredicates=o,n.definition.push(s),me(i,a=>{const c=new Jt({definition:[]});s.definition.push(c),pe(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:pe(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Qa}function _0(t){return t===0?"":`${t}`}function ec(t){if(t<0||t>m0){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${m0+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class uC{initPerformanceTracer(e){if(pe(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=kr.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=yg(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function hC(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const tc=Va(_i,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(tc);const kr=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Hg,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),nc=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var jt;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(jt||(jt={}));class ro{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{_g(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),me(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=MO({rules:dt(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(qe(r)&&this.skipValidations===!1){const i=UO({rules:dt(this.gastProductionsCache),tokenTypes:dt(this.tokensMap),errMsgProvider:bi,grammarName:n}),s=bO({lookaheadStrategy:this.lookaheadStrategy,rules:dt(this.gastProductionsCache),tokenTypes:dt(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),qe(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=fI(dt(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:dt(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(dt(this.gastProductionsCache))})),!ro.DEFER_DEFINITION_ERRORS_HANDLING&&!qe(this.definitionErrors))throw e=le(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),pe(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=pe(n,"skipValidations")?n.skipValidations:kr.skipValidations}}ro.DEFER_DEFINITION_ERRORS_HANDLING=!1,hC(ro,[$O,GO,tC,nC,iC,rC,sC,oC,cC,uC]);class fC extends ro{constructor(e,n=kr){const r=Nt(n);r.outputCst=!0,super(e,r)}}function dC(t){const e=new pC,n=dt(t);return le(n,r=>e.visitRule(r))}class pC extends gi{visitRule(e){const n=this.visitEach(e.definition),r=dg(n,s=>s.propertyName),i=le(r,(s,o)=>{const a=!Ou(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=le(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:rc(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:rc(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:rc(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:rc(e)}]}visitEachAndOverrideWith(e,n){return le(this.visitEach(e),r=>Kt({},r,n))}visitEach(e){return rn(le(e,n=>this.visit(n)))}}function rc(t){return t instanceof Zt?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function mC(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(rn(le(t,r=>gC(r)))),e.includeVisitorInterface&&(n=n.concat(wC(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function gC(t){const e=yC(t),n=_C(t);return[e,n]}function yC(t){const e=w0(t.name),n=Zu(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function _C(t){return`export type ${Zu(t.name)} = {
  ${le(t.properties,n=>bC(n)).join(`
  `)}
};`}function bC(t){const e=EC(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function wC(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${le(e,n=>vC(n)).join(`
  `)}
}`}function vC(t){const e=Zu(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function EC(t){if(Me(t)){const e=Na(le(t,r=>b0(r)));return"("+Xt(e,(r,i)=>r+" | "+i)+")"}else return b0(t)}function b0(t){return t.kind==="token"?"IToken":w0(t.name)}function w0(t){return Um(t)+"CstNode"}function Zu(t){return Um(t)+"CstChildren"}const kC={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function SC(t,e){const n=Object.assign(Object.assign({},kC),e),r=dC(t);return mC(r,n)}const Ju=Ql(32,126).map(t=>String.fromCharCode(t));function Re(t){return sn({...t,name:`token_${t.name}`})}function _n(t,e=!1){return Re(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:zt,group:Et.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:zt})}const io=Re({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),AC=Re({name:"whitespace",pattern:/ +/,group:Et.SKIPPED}),xC=Re({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Et.SKIPPED}),Yu=Re({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),es=Re({name:"command",pattern:/#/,start_chars_hint:["#"]});let v0=!1;function TC(t,e,n){if(!v0)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==io)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const E0=Re({name:"text",pattern:TC,line_breaks:!1,start_chars_hint:Ju.filter(t=>"@#/?':!".includes(t)===!1)}),k0=Re({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),S0=Re({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),A0=Re({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),x0=Re({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),zt=Re({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:Ju}),T0=Re({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),R0=Re({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),I0=Re({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:zt}),O0=Re({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:zt}),C0=Re({name:"islessthan",pattern:/<|below/,longer_alt:zt}),N0=Re({name:"isgreaterthan",pattern:/>|above/,longer_alt:zt}),L0=Re({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:zt}),M0=Re({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:zt}),Qu=Re({name:"or",pattern:/or/i,longer_alt:zt}),eh=Re({name:"not",pattern:/not/i,longer_alt:zt}),th=Re({name:"and",pattern:/and/i,longer_alt:zt}),nh=Re({name:"plus",pattern:/\+/}),rh=Re({name:"minus",pattern:/-/}),U0=Re({name:"power",pattern:/\*\*/}),P0=Re({name:"multiply",pattern:/\*/}),ih=Re({name:"divide",pattern:/\//}),D0=Re({name:"moddivide",pattern:/%/}),B0=Re({name:"floordivide",pattern:/%%/}),F0=Re({name:"query",pattern:/\?/}),$0=Re({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),j0=Re({name:"rparen",pattern:/\)/,pop_mode:!0}),z0=Re({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Ju,longer_alt:zt}),W0=_n("debugger"),sh=_n("if"),ic=_n("do"),RC=_n("to",!0),oh=_n("done"),IC=_n("then",!0),ah=_n("else"),G0=_n("while"),H0=_n("repeat"),V0=_n("waitfor"),K0=Re({name:"foreach",pattern:/foreach|for/,longer_alt:zt}),q0=_n("break"),X0=_n("continue");function Z0(t){return[...t,R0,I0,O0,L0,C0,M0,N0,Qu,eh,th,nh,rh,U0,P0,ih,B0,D0,F0,$0,j0,T0,zt]}const J0=Z0([E0,Yu,z0,es,k0,S0,A0,x0,io,AC,q0,X0,W0,oh,ic,ah,K0,sh,H0,IC,RC,V0,G0]),OC=new Et({defaultMode:"use_newlines",modes:{use_newlines:J0,ignore_newlines:Z0([xC])}},{skipValidations:!Hn,ensureOptimizations:Hn});function Y0(t){v0=!0;const e=OC.tokenize(t||` 
`),[n]=(He(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(Va(io,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function Q0(t,e=!0){const[n,...r]=t;switch(Pe(n)){default:return e?{type:he.OBJECT,values:t}:{type:he.CONST,values:t};case"loader":return{type:he.LOADER,values:r};case"board":return{type:he.BOARD,values:r};case"object":return{type:he.OBJECT,values:r};case"terrain":return{type:he.TERRAIN,values:r};case"charset":return{type:he.CHARSET,values:r};case"palette":return{type:he.PALETTE,values:r};case"rn":case"range":return{type:he.RANGE,values:r};case"sl":case"select":return{type:he.SELECT,values:r};case"nm":case"number":return{type:he.NUMBER,values:r};case"tx":case"text":return{type:he.TEXT,values:r};case"ln":case"link":return{type:he.LINK,values:r};case"hk":case"hotkey":return{type:he.HOTKEY,values:r};case"scroll":return{type:he.SCROLL,values:r};case"copyit":return{type:he.COPYIT,values:r}}}function bn(t){switch(t){case he.LOADER:return"loader";case he.BOARD:return"board";case he.OBJECT:return"object";case he.TERRAIN:return"terrain";case he.CHARSET:return"charset";case he.PALETTE:return"palette";case he.CONST:return"const";case he.RANGE:return"range";case he.SELECT:return"select";case he.NUMBER:return"number";case he.TEXT:return"text";case he.LINK:return"link";case he.HOTKEY:return"hotkey";case he.SCROLL:return"scroll";case he.COPYIT:return"copyit"}}var ch;try{ch=new TextDecoder}catch{}var se,wn,M=0,Xe={},Ce,Vr,vn=0,er=0,Tt,Sr,Qt=[],Ie,ey={useRecords:!1,mapsAsObjects:!0};class ty{}const ny=new ty;ny.name="MessagePack 0xC1";var Kr=!1,ry=2,iy;try{new Function("")}catch{ry=1/0}class so{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(se)return yy(()=>(dh(),this?this.unpack(e,n):so.prototype.unpack.call(ey,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof n=="object"?(wn=n.end||e.length,M=n.start||0):(M=0,wn=n>-1?n:e.length),er=0,Vr=null,Tt=null,se=e;try{Ie=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw se=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof so){if(Xe=this,this.structures)return Ce=this.structures,sc(n);(!Ce||Ce.length>0)&&(Ce=[])}else Xe=ey,(!Ce||Ce.length>0)&&(Ce=[]);return sc(n)}unpackMultiple(e,n){let r,i=0;try{Kr=!0;let s=e.length,o=this?this.unpack(e,s):oc.unpack(e,s);if(n){if(n(o,i,M)===!1)return;for(;M<s;)if(i=M,n(sc(),i,M)===!1)return}else{for(r=[o];M<s;)i=M,r.push(sc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Kr=!1,dh()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function sc(t){try{if(!Xe.trusted&&!Kr){let n=Ce.sharedLength||0;n<Ce.length&&(Ce.length=n)}let e;if(Xe.randomAccessStructure&&se[M]<64&&se[M]>=32&&iy?(e=iy(se,M,wn,Xe),se=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),M=wn):e=lt(),Tt&&(M=Tt.postBundlePosition,Tt=null),Kr&&(Ce.restoreStructures=null),M==wn)Ce&&Ce.restoreStructures&&sy(),Ce=null,se=null,Sr&&(Sr=null);else{if(M>wn)throw new Error("Unexpected end of MessagePack data");if(!Kr){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw Ce&&Ce.restoreStructures&&sy(),dh(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||M>wn)&&(e.incomplete=!0),e}}function sy(){for(let t in Ce.restoreStructures)Ce[t]=Ce.restoreStructures[t];Ce.restoreStructures=null}function lt(){let t=se[M++];if(t<160)if(t<128){if(t<64)return t;{let e=Ce[t&63]||Xe.getStructures&&ay()[t&63];return e?(e.read||(e.read=lh(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,Xe.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=dy();r==="__proto__"&&(r="__proto_"),e[r]=lt()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(lt(),lt());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=lt();return Xe.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(er>=M)return Vr.slice(M-vn,(M+=e)-vn);if(er==0&&wn<140){let n=e<16?hh(e):uy(e);if(n!=null)return n}return uh(e)}else{let e;switch(t){case 192:return null;case 193:return Tt?(e=lt(),e>0?Tt[1].slice(Tt.position1,Tt.position1+=e):Tt[0].slice(Tt.position0,Tt.position0-=e)):ny;case 194:return!1;case 195:return!0;case 196:if(e=se[M++],e===void 0)throw new Error("Unexpected end of buffer");return fh(e);case 197:return e=Ie.getUint16(M),M+=2,fh(e);case 198:return e=Ie.getUint32(M),M+=4,fh(e);case 199:return wi(se[M++]);case 200:return e=Ie.getUint16(M),M+=2,wi(e);case 201:return e=Ie.getUint32(M),M+=4,wi(e);case 202:if(e=Ie.getFloat32(M),Xe.useFloat32>2){let n=ph[(se[M]&127)<<1|se[M+1]>>7];return M+=4,(n*e+(e>0?.5:-.5)>>0)/n}return M+=4,e;case 203:return e=Ie.getFloat64(M),M+=8,e;case 204:return se[M++];case 205:return e=Ie.getUint16(M),M+=2,e;case 206:return e=Ie.getUint32(M),M+=4,e;case 207:return Xe.int64AsType==="number"?(e=Ie.getUint32(M)*4294967296,e+=Ie.getUint32(M+4)):Xe.int64AsType==="string"?e=Ie.getBigUint64(M).toString():Xe.int64AsType==="auto"?(e=Ie.getBigUint64(M),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Ie.getBigUint64(M),M+=8,e;case 208:return Ie.getInt8(M++);case 209:return e=Ie.getInt16(M),M+=2,e;case 210:return e=Ie.getInt32(M),M+=4,e;case 211:return Xe.int64AsType==="number"?(e=Ie.getInt32(M)*4294967296,e+=Ie.getUint32(M+4)):Xe.int64AsType==="string"?e=Ie.getBigInt64(M).toString():Xe.int64AsType==="auto"?(e=Ie.getBigInt64(M),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Ie.getBigInt64(M),M+=8,e;case 212:if(e=se[M++],e==114)return my(se[M++]&63);{let n=Qt[e];if(n)return n.read?(M++,n.read(lt())):n.noBuffer?(M++,n()):n(se.subarray(M,++M));throw new Error("Unknown extension "+e)}case 213:return e=se[M],e==114?(M++,my(se[M++]&63,se[M++])):wi(2);case 214:return wi(4);case 215:return wi(8);case 216:return wi(16);case 217:return e=se[M++],er>=M?Vr.slice(M-vn,(M+=e)-vn):NC(e);case 218:return e=Ie.getUint16(M),M+=2,er>=M?Vr.slice(M-vn,(M+=e)-vn):LC(e);case 219:return e=Ie.getUint32(M),M+=4,er>=M?Vr.slice(M-vn,(M+=e)-vn):MC(e);case 220:return e=Ie.getUint16(M),M+=2,cy(e);case 221:return e=Ie.getUint32(M),M+=4,cy(e);case 222:return e=Ie.getUint16(M),M+=2,ly(e);case 223:return e=Ie.getUint32(M),M+=4,ly(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const CC=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function lh(t,e){function n(){if(n.count++>ry){let i=t.read=new Function("r","return function(){return "+(Xe.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":CC.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(lt);return t.highByte===0&&(t.read=oy(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=lt()}return Xe.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?oy(e,n):n}const oy=(t,e)=>function(){let n=se[M++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=Ce[r]||ay()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=lh(i,t)),i.read()};function ay(){let t=yy(()=>(se=null,Xe.getStructures()));return Ce=Xe._mergeStructures(t,Ce)}var uh=oo,NC=oo,LC=oo,MC=oo;function oo(t){let e;if(t<16&&(e=hh(t)))return e;if(t>64&&ch)return ch.decode(se.subarray(M,M+=t));const n=M+t,r=[];for(e="";M<n;){const i=se[M++];if(!(i&128))r.push(i);else if((i&224)===192){const s=se[M++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=se[M++]&63,o=se[M++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=se[M++]&63,o=se[M++]&63,a=se[M++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=Rt.apply(String,r),r.length=0)}return r.length>0&&(e+=Rt.apply(String,r)),e}function cy(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=lt();return Xe.freezeData?Object.freeze(e):e}function ly(t){if(Xe.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=dy();r==="__proto__"&&(r="__proto_"),e[r]=lt()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(lt(),lt());return e}}var Rt=String.fromCharCode;function uy(t){let e=M,n=new Array(t);for(let r=0;r<t;r++){const i=se[M++];if((i&128)>0){M=e;return}n[r]=i}return Rt.apply(String,n)}function hh(t){if(t<4)if(t<2){if(t===0)return"";{let e=se[M++];if((e&128)>1){M-=1;return}return Rt(e)}}else{let e=se[M++],n=se[M++];if((e&128)>0||(n&128)>0){M-=2;return}if(t<3)return Rt(e,n);let r=se[M++];if((r&128)>0){M-=3;return}return Rt(e,n,r)}else{let e=se[M++],n=se[M++],r=se[M++],i=se[M++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){M-=4;return}if(t<6){if(t===4)return Rt(e,n,r,i);{let s=se[M++];if((s&128)>0){M-=5;return}return Rt(e,n,r,i,s)}}else if(t<8){let s=se[M++],o=se[M++];if((s&128)>0||(o&128)>0){M-=6;return}if(t<7)return Rt(e,n,r,i,s,o);let a=se[M++];if((a&128)>0){M-=7;return}return Rt(e,n,r,i,s,o,a)}else{let s=se[M++],o=se[M++],a=se[M++],c=se[M++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){M-=8;return}if(t<10){if(t===8)return Rt(e,n,r,i,s,o,a,c);{let l=se[M++];if((l&128)>0){M-=9;return}return Rt(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=se[M++],u=se[M++];if((l&128)>0||(u&128)>0){M-=10;return}if(t<11)return Rt(e,n,r,i,s,o,a,c,l,u);let h=se[M++];if((h&128)>0){M-=11;return}return Rt(e,n,r,i,s,o,a,c,l,u,h)}else{let l=se[M++],u=se[M++],h=se[M++],d=se[M++];if((l&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){M-=12;return}if(t<14){if(t===12)return Rt(e,n,r,i,s,o,a,c,l,u,h,d);{let f=se[M++];if((f&128)>0){M-=13;return}return Rt(e,n,r,i,s,o,a,c,l,u,h,d,f)}}else{let f=se[M++],p=se[M++];if((f&128)>0||(p&128)>0){M-=14;return}if(t<15)return Rt(e,n,r,i,s,o,a,c,l,u,h,d,f,p);let m=se[M++];if((m&128)>0){M-=15;return}return Rt(e,n,r,i,s,o,a,c,l,u,h,d,f,p,m)}}}}}function hy(){let t=se[M++],e;if(t<192)e=t-160;else switch(t){case 217:e=se[M++];break;case 218:e=Ie.getUint16(M),M+=2;break;case 219:e=Ie.getUint32(M),M+=4;break;default:throw new Error("Expected string")}return oo(e)}function fh(t){return Xe.copyBuffers?Uint8Array.prototype.slice.call(se,M,M+=t):se.subarray(M,M+=t)}function wi(t){let e=se[M++];if(Qt[e]){let n;return Qt[e](se.subarray(M,n=M+=t),r=>{M=r;try{return lt()}finally{M=n}})}else throw new Error("Unknown extension type "+e)}var fy=new Array(4096);function dy(){let t=se[M++];if(t>=160&&t<192){if(t=t-160,er>=M)return Vr.slice(M-vn,(M+=t)-vn);if(!(er==0&&wn<180))return uh(t)}else return M--,py(lt());let e=(t<<5^(t>1?Ie.getUint16(M):t>0?se[M]:0))&4095,n=fy[e],r=M,i=M+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Ie.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=se[r++],s!=n[o++]){r=1879048192;break}if(r===i)return M=r,n.string;i-=3,r=M}for(n=[],fy[e]=n,n.bytes=t;r<i;)s=Ie.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=se[r++],n.push(s);let a=t<16?hh(t):uy(t);return a!=null?n.string=a:n.string=uh(t)}function py(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const my=(t,e)=>{let n=lt().map(py),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=Ce[t];return i&&(i.isShared||Kr)&&((Ce.restoreStructures||(Ce.restoreStructures=[]))[t]=i),Ce[t]=n,n.read=lh(n,r),n.read()};Qt[0]=()=>{},Qt[0].noBuffer=!0,Qt[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let UC={Error,TypeError,ReferenceError};Qt[101]=()=>{let t=lt();return(UC[t[0]]||Error)(t[1],{cause:t[2]})},Qt[105]=t=>{if(Xe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Ie.getUint32(M-4);Sr||(Sr=new Map);let n=se[M],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Sr.set(e,i);let s=lt();return i.used?Object.assign(r,s):(i.target=s,s)},Qt[112]=t=>{if(Xe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Ie.getUint32(M-4),n=Sr.get(e);return n.used=!0,n.target},Qt[115]=()=>new Set(lt());const gy=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let PC=typeof globalThis=="object"?globalThis:window;Qt[116]=t=>{let e=t[0],n=gy[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new PC[n](Uint8Array.prototype.slice.call(t,1).buffer)},Qt[120]=()=>{let t=lt();return new RegExp(t[0],t[1])};const DC=[];Qt[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=M;return M+=e-t.length,Tt=DC,Tt=[hy(),hy()],Tt.position0=0,Tt.position1=0,Tt.postBundlePosition=M,M=n,lt()},Qt[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function yy(t){let e=wn,n=M,r=vn,i=er,s=Vr,o=Sr,a=Tt,c=new Uint8Array(se.slice(0,wn)),l=Ce,u=Ce.slice(0,Ce.length),h=Xe,d=Kr,f=t();return wn=e,M=n,vn=r,er=i,Vr=s,Sr=o,Tt=a,se=c,Kr=d,Ce=l,Ce.splice(0,Ce.length,...u),Xe=h,Ie=new DataView(se.buffer,se.byteOffset,se.byteLength),f}function dh(){se=null,Sr=null,Ce=null}const ph=new Array(147);for(let t=0;t<256;t++)ph[t]=+("1e"+Math.floor(45.15-t*.30103));var oc=new so({useRecords:!1});const BC=oc.unpack;oc.unpackMultiple,oc.unpack;let FC=new Float32Array(1);new Uint8Array(FC.buffer,0,4);let ac;try{ac=new TextEncoder}catch{}let mh,_y;const cc=typeof Buffer<"u",lc=cc?function(t){return Buffer.allocUnsafeSlow(t)}:Uint8Array,by=cc?Buffer:Uint8Array,wy=cc?4294967296:2144337920;let z,ao,Ze,P=0,Wt,rt=null,$C;const jC=21760,zC=/[\u0080-\uFFFF]/,ts=Symbol("record-id");class WC extends so{constructor(e){super(e),this.offset=0;let n,r,i,s,o=by.prototype.utf8Write?function(E,g){return z.utf8Write(E,g,z.byteLength-g)}:ac&&ac.encodeInto?function(E,g){return ac.encodeInto(E,z.subarray(g)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||h+u>64,f=u+64,p=u+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],b=0,_=0;this.pack=this.encode=function(E,g){if(z||(z=new lc(8192),Ze=z.dataView||(z.dataView=new DataView(z.buffer,0,8192)),P=0),Wt=z.length-10,Wt-P<2048?(z=new lc(z.length),Ze=z.dataView||(z.dataView=new DataView(z.buffer,0,z.length)),Wt=z.length-10,P=0):P=P+7&2147483640,n=P,g&ZC&&(P+=g&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof E!="string"?(rt=[],rt.size=1/0):rt=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let j=i.sharedLength||0;if(j>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let U=0;U<j;U++){let Q=i[U];if(!Q)continue;let H,J=i.transitions;for(let F=0,D=Q.length;F<D;F++){let ae=Q[F];H=J[ae],H||(H=J[ae]=Object.create(null)),J=H}J[ts]=U+64}this.lastNamedStructuresLength=j}c||(i.nextId=j+64)}r&&(r=!1);let N;try{a.randomAccessStructure&&E&&E.constructor&&E.constructor===Object?I(E):A(E);let j=rt;if(rt&&ky(n,A,0),s&&s.idsToInsert){let U=s.idsToInsert.sort((F,D)=>F.offset>D.offset?1:-1),Q=U.length,H=-1;for(;j&&Q>0;){let F=U[--Q].offset+n;F<j.stringsPosition+n&&H===-1&&(H=0),F>j.position+n?H>=0&&(H+=6):(H>=0&&(Ze.setUint32(j.position+n,Ze.getUint32(j.position+n)+H),H=-1),j=j.previous,Q++)}H>=0&&j&&Ze.setUint32(j.position+n,Ze.getUint32(j.position+n)+H),P+=U.length*6,P>Wt&&L(P),a.offset=P;let J=HC(z.subarray(n,P),U);return s=null,J}return a.offset=P,g&qC?(z.start=n,z.end=P,z):z.subarray(n,P)}catch(j){throw N=j,j}finally{if(i&&(w(),r&&a.saveStructures)){let j=i.sharedLength||0,U=z.subarray(n,P),Q=VC(i,a);if(!N)return a.saveStructures(Q,Q.isCompatible)===!1?a.pack(E,g):(a.lastNamedStructuresLength=j,z.length>1073741824&&(z=null),U)}z.length>1073741824&&(z=null),g&XC&&(P=n)}};const w=()=>{_<10&&_++;let E=i.sharedLength||0;if(i.length>E&&!c&&(i.length=E),b>1e4)i.transitions=null,_=0,b=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let g=0,N=m.length;g<N;g++)m[g][ts]=0;m=[]}},v=E=>{var g=E.length;g<16?z[P++]=144|g:g<65536?(z[P++]=220,z[P++]=g>>8,z[P++]=g&255):(z[P++]=221,Ze.setUint32(P,g),P+=4);for(let N=0;N<g;N++)A(E[N])},A=E=>{P>Wt&&(z=L(P));var g=typeof E,N;if(g==="string"){let j=E.length;if(rt&&j>=4&&j<4096){if((rt.size+=j)>jC){let J,F=(rt[0]?rt[0].length*3+rt[1].length:0)+10;P+F>Wt&&(z=L(P+F));let D;rt.position?(D=rt,z[P]=200,P+=3,z[P++]=98,J=P-n,P+=4,ky(n,A,0),Ze.setUint16(J+n-3,P-n-J)):(z[P++]=214,z[P++]=98,J=P-n,P+=4),rt=["",""],rt.previous=D,rt.size=0,rt.position=J}let H=zC.test(E);rt[H?0:1]+=E,z[P++]=193,A(H?-j:j);return}let U;j<32?U=1:j<256?U=2:j<65536?U=3:U=5;let Q=j*3;if(P+Q>Wt&&(z=L(P+Q)),j<64||!o){let H,J,F,D=P+U;for(H=0;H<j;H++)J=E.charCodeAt(H),J<128?z[D++]=J:J<2048?(z[D++]=J>>6|192,z[D++]=J&63|128):(J&64512)===55296&&((F=E.charCodeAt(H+1))&64512)===56320?(J=65536+((J&1023)<<10)+(F&1023),H++,z[D++]=J>>18|240,z[D++]=J>>12&63|128,z[D++]=J>>6&63|128,z[D++]=J&63|128):(z[D++]=J>>12|224,z[D++]=J>>6&63|128,z[D++]=J&63|128);N=D-P-U}else N=o(E,P+U);N<32?z[P++]=160|N:N<256?(U<2&&z.copyWithin(P+2,P+1,P+1+N),z[P++]=217,z[P++]=N):N<65536?(U<3&&z.copyWithin(P+3,P+2,P+2+N),z[P++]=218,z[P++]=N>>8,z[P++]=N&255):(U<5&&z.copyWithin(P+5,P+3,P+3+N),z[P++]=219,Ze.setUint32(P,N),P+=4),P+=N}else if(g==="number")if(E>>>0===E)E<32||E<128&&this.useRecords===!1||E<64&&!this.randomAccessStructure?z[P++]=E:E<256?(z[P++]=204,z[P++]=E):E<65536?(z[P++]=205,z[P++]=E>>8,z[P++]=E&255):(z[P++]=206,Ze.setUint32(P,E),P+=4);else if(E>>0===E)E>=-32?z[P++]=256+E:E>=-128?(z[P++]=208,z[P++]=E+256):E>=-32768?(z[P++]=209,Ze.setInt16(P,E),P+=2):(z[P++]=210,Ze.setInt32(P,E),P+=4);else{let j;if((j=this.useFloat32)>0&&E<4294967296&&E>=-2147483648){z[P++]=202,Ze.setFloat32(P,E);let U;if(j<4||(U=E*ph[(z[P]&127)<<1|z[P+1]>>7])>>0===U){P+=4;return}else P--}z[P++]=203,Ze.setFloat64(P,E),P+=8}else if(g==="object"||g==="function")if(!E)z[P++]=192;else{if(s){let U=s.get(E);if(U){if(!U.id){let Q=s.idsToInsert||(s.idsToInsert=[]);U.id=Q.push(U)}z[P++]=214,z[P++]=112,Ze.setUint32(P,U.id),P+=4;return}else s.set(E,{offset:P-n})}let j=E.constructor;if(j===Object)$(E);else if(j===Array)v(E);else if(j===Map)if(this.mapAsEmptyObject)z[P++]=128;else{N=E.size,N<16?z[P++]=128|N:N<65536?(z[P++]=222,z[P++]=N>>8,z[P++]=N&255):(z[P++]=223,Ze.setUint32(P,N),P+=4);for(let[U,Q]of E)A(U),A(Q)}else{for(let U=0,Q=mh.length;U<Q;U++){let H=_y[U];if(E instanceof H){let J=mh[U];if(J.write){J.type&&(z[P++]=212,z[P++]=J.type,z[P++]=0);let te=J.write.call(this,E);te===E?Array.isArray(E)?v(E):$(E):A(te);return}let F=z,D=Ze,ae=P;z=null;let ee;try{ee=J.pack.call(this,E,te=>(z=F,F=null,P+=te,P>Wt&&L(P),{target:z,targetView:Ze,position:P-te}),A)}finally{F&&(z=F,Ze=D,P=ae,Wt=z.length-10)}ee&&(ee.length+P>Wt&&L(ee.length+P),P=GC(ee,z,P,J.type));return}}if(Array.isArray(E))v(E);else{if(E.toJSON){const U=E.toJSON();if(U!==E)return A(U)}if(g==="function")return A(this.writeFunction&&this.writeFunction(E));$(E)}}}else if(g==="boolean")z[P++]=E?195:194;else if(g==="bigint"){if(E<BigInt(1)<<BigInt(63)&&E>=-(BigInt(1)<<BigInt(63)))z[P++]=211,Ze.setBigInt64(P,E);else if(E<BigInt(1)<<BigInt(64)&&E>0)z[P++]=207,Ze.setBigUint64(P,E);else if(this.largeBigIntToFloat)z[P++]=203,Ze.setFloat64(P,Number(E));else{if(this.largeBigIntToString)return A(E.toString());if(this.useBigIntExtension&&E<BigInt(2)**BigInt(1023)&&E>-(BigInt(2)**BigInt(1023))){z[P++]=199,P++,z[P++]=66;let j=[],U;do{let Q=E&BigInt(255);U=(Q&BigInt(128))===(E<BigInt(0)?BigInt(128):BigInt(0)),j.push(Q),E>>=BigInt(8)}while(!((E===BigInt(0)||E===BigInt(-1))&&U));z[P-2]=j.length;for(let Q=j.length;Q>0;)z[P++]=Number(j[--Q]);return}else throw new RangeError(E+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}P+=8}else if(g==="undefined")this.encodeUndefinedAsNil?z[P++]=192:(z[P++]=212,z[P++]=0,z[P++]=0);else throw new Error("Unknown type: "+g)},O=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?E=>{let g;if(this.skipValues){g=[];for(let U in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(U))&&!this.skipValues.includes(E[U])&&g.push(U)}else g=Object.keys(E);let N=g.length;N<16?z[P++]=128|N:N<65536?(z[P++]=222,z[P++]=N>>8,z[P++]=N&255):(z[P++]=223,Ze.setUint32(P,N),P+=4);let j;if(this.coercibleKeyAsNumber)for(let U=0;U<N;U++){j=g[U];let Q=Number(j);A(isNaN(Q)?j:Q),A(E[j])}else for(let U=0;U<N;U++)A(j=g[U]),A(E[j])}:E=>{z[P++]=222;let g=P-n;P+=2;let N=0;for(let j in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(j))&&(A(j),A(E[j]),N++);if(N>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');z[g+++n]=N>>8,z[g+n]=N&255},x=this.useRecords===!1?O:e.progressiveRecords&&!d?E=>{let g,N=i.transitions||(i.transitions=Object.create(null)),j=P++-n,U;for(let Q in E)if(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(Q)){if(g=N[Q],g)N=g;else{let H=Object.keys(E),J=N;N=i.transitions;let F=0;for(let D=0,ae=H.length;D<ae;D++){let ee=H[D];g=N[ee],g||(g=N[ee]=Object.create(null),F++),N=g}j+n+1==P?(P--,V(N,H,F)):Y(N,H,j,F),U=!0,N=J[Q]}A(E[Q])}if(!U){let Q=N[ts];Q?z[j+n]=Q:Y(N,Object.keys(E),j,0)}}:E=>{let g,N=i.transitions||(i.transitions=Object.create(null)),j=0;for(let Q in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(Q))&&(g=N[Q],g||(g=N[Q]=Object.create(null),j++),N=g);let U=N[ts];U?U>=96&&d?(z[P++]=((U-=96)&31)+96,z[P++]=U>>5):z[P++]=U:V(N,N.__keys__||Object.keys(E),j);for(let Q in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(Q))&&A(E[Q])},R=typeof this.useRecords=="function"&&this.useRecords,$=R?E=>{R(E)?x(E):O(E)}:x,L=E=>{let g;if(E>16777216){if(E-n>wy)throw new Error("Packed buffer would be larger than maximum buffer size");g=Math.min(wy,Math.round(Math.max((E-n)*(E>67108864?1.25:2),4194304)/4096)*4096)}else g=(Math.max(E-n<<2,z.length-1)>>12)+1<<12;let N=new lc(g);return Ze=N.dataView||(N.dataView=new DataView(N.buffer,0,g)),E=Math.min(E,z.length),z.copy?z.copy(N,0,n,E):N.set(z.slice(n,E)),P-=n,n=0,Wt=N.length-10,z=N},V=(E,g,N)=>{let j=i.nextId;j||(j=64),j<f&&this.shouldShareStructure&&!this.shouldShareStructure(g)?(j=i.nextOwnId,j<p||(j=f),i.nextOwnId=j+1):(j>=p&&(j=f),i.nextId=j+1);let U=g.highByte=j>=96&&d?j-96>>5:-1;E[ts]=j,E.__keys__=g,i[j-64]=g,j<f?(g.isShared=!0,i.sharedLength=j-63,r=!0,U>=0?(z[P++]=(j&31)+96,z[P++]=U):z[P++]=j):(U>=0?(z[P++]=213,z[P++]=114,z[P++]=(j&31)+96,z[P++]=U):(z[P++]=212,z[P++]=114,z[P++]=j),N&&(b+=_*N),m.length>=h&&(m.shift()[ts]=0),m.push(E),A(g))},Y=(E,g,N,j)=>{let U=z,Q=P,H=Wt,J=n;z=ao,P=0,n=0,z||(ao=z=new lc(8192)),Wt=z.length-10,V(E,g,j),ao=z;let F=P;if(z=U,P=Q,Wt=H,n=J,F>1){let D=P+F-1;D>Wt&&L(D);let ae=N+n;z.copyWithin(ae+F,ae+1,P),z.set(ao.slice(0,F),ae),P=D}else z[N+n]=ao[0]},I=E=>{let g=$C(E,z,n,P,i,L,(N,j,U)=>{if(U)return r=!0;P=j;let Q=z;return A(N),w(),Q!==z?{position:P,targetView:Ze,target:z}:P},this);if(g===0)return $(E);P=g}}useBuffer(e){z=e,z.dataView||(z.dataView=new DataView(z.buffer,z.byteOffset,z.byteLength)),P=0}set position(e){P=e}get position(){return P}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}_y=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,ty],mh=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?vy(t,16,e):Ey(cc?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==by&&this.moreTypes?vy(t,gy.indexOf(n.name),e):Ey(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function vy(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function Ey(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function GC(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function HC(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function ky(t,e,n){if(rt.length>0){Ze.setUint32(rt.position+t,P+n-rt.position-t),rt.stringsPosition=P-t;let r=rt;rt=null,e(r[0]),e(r[1])}}function VC(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let Sy=new WC({useRecords:!1});const KC=Sy.pack;Sy.pack;const qC=512,XC=1024,ZC=2048;function vi(){return null}function co(t,e,n={}){if(!k(t))return;const r=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=n[o];k(c)&&(a=c(a));const l=e[o];k(l)&&(o=l),a!==null&&r.push(o,a)}return r}function lo(t,e,n={}){if(k(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];k(a)&&(s=a);const c=n[s];k(c)&&(o=c(o)),r[s]=o}return r}catch(r){et("format","binary",r.message)}}function JC(t){try{const e=ei(t);return KC(e)}catch(e){et("format","binary",e.message)}}function YC(t){try{return BC(t)}catch(e){et("format","binary",e.message)}}function Ay(){return{id:ft()}}var gh=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.destructible=16]="destructible",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.headless=27]="headless",t[t.removed=28]="removed",t))(gh||{});function uc(t){return co(t,gh,{category:vi,kinddata:vi})}function hc(t){return lo(t,gh)}var yh=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(yh||{});function xy(t){return co(t,yh)}function Ty(t){return lo(t,yh)}function Ry(t,e){return{id:ft(),code:t,...e}}var _h=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(_h||{});function QC(t){return co(t,_h,{board:kN,object:uc,terrain:uc,charset:xy,palette:xy,stats:vi})}function eN(t){return lo(t,_h,{board:SN,object:hc,terrain:hc,charset:Ty,palette:Ty})}function Iy(t){const e={...uo(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function tN(t){return k(t)?(t.stats=void 0,uo(t)):{}}function uo(t){var r;if(!k(t))return{};if(k((r=t.stats)==null?void 0:r.type))return t.stats;t.stats={};const e=Y0(t.code);let n=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===Yu){const a=s.image.slice(1).split(" "),c=Q0(a,n),l=Pe(c.values.join(" "));switch(n=!1,c.type){case he.LOADER:t.stats.type=Te.LOADER,t.stats.name=l;break;case he.BOARD:t.stats.type=Te.BOARD,t.stats.name=l;break;case he.OBJECT:t.stats.type=Te.OBJECT,t.stats.name=l;break;case he.TERRAIN:t.stats.type=Te.TERRAIN,t.stats.name=l;break;case he.CHARSET:t.stats.type=Te.CHARSET,t.stats.name=l;break;case he.PALETTE:t.stats.type=Te.PALETTE,t.stats.name=l;break;case he.CONST:{const[u,h]=c.values;if(Se(u)){const d=Pe(u);if(Se(h)){const f=parseFloat(h);t.stats[d]=ve(f)?f:h}else ve(h)?t.stats[d]=h:t.stats[d]=1}break}case he.RANGE:case he.SELECT:case he.NUMBER:case he.TEXT:case he.LINK:case he.HOTKEY:case he.SCROLL:{const[u,...h]=c.values;if(Se(u)){const d=Pe(u);t.stats[d]=h}break}}}}return k(t.stats.type)||(t.stats.type=Te.OBJECT),t.stats}function Oy(t){switch(t){default:case Te.ERROR:return"error";case Te.LOADER:return bn(he.LOADER);case Te.BOARD:return bn(he.BOARD);case Te.OBJECT:return bn(he.OBJECT);case Te.TERRAIN:return bn(he.TERRAIN);case Te.CHARSET:return bn(he.CHARSET);case Te.PALETTE:return bn(he.PALETTE)}}function ho(t){return uo(t).type??Te.ERROR}function fo(t){return Oy(ho(t))}function tr(t){return uo(t).name??""}function Cy(t,e){const n=Iy(t),r=Object.keys(n);for(let i=0;i<r.length;++i){const s=r[i];switch(s){case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[s]=n[s];break;case"canpush":case"ispushable":e.pushable=1;break;case"iswalk":case"iswalkable":e.collision=Ge.ISWALK;break;case"isswim":case"isswimable":e.collision=Ge.ISSWIM;break;case"issolid":e.collision=Ge.ISSOLID;break;case"isbullet":e.collision=Ge.ISBULLET;break;case"canshoot":case"isdestructible":e.destructible=1;break}}}function bh(t){if(k(t))switch(ho(t)){default:return;case Te.ERROR:return t.code??"";case Te.LOADER:return t.code??"";case Te.BOARD:{k(t.board)||(t.board=EN()),t.board.id=t.id;const e=Iy(t);return t.board.isdark=k(e.isdark)&&e.isdark?1:0,t.board.over=e.over??t.board.over,t.board.under=e.under??t.board.under,t.board.exitnorth=e.exitnorth??t.board.exitnorth,t.board.exitsouth=e.exitsouth??t.board.exitsouth,t.board.exitwest=e.exitwest??t.board.exitwest,t.board.exiteast=e.exiteast??t.board.exiteast,t.board.timelimit=e.timelimit??t.board.timelimit,t.board.restartonzap=e.restartonzap??t.board.restartonzap,t.board.maxplayershots=e.maxplayershots??t.board.maxplayershots,t.board}case Te.OBJECT:return k(t.object)||(t.object=Ay()),t.object.name=tr(t),Cy(t,t.object),t.object;case Te.TERRAIN:return k(t.terrain)||(t.terrain=Ay()),t.terrain.name=tr(t),Cy(t,t.terrain),t.terrain;case Te.CHARSET:return k(t.charset),t.charset;case Te.PALETTE:return k(t.palette),t.palette}}function Ny(t){return{id:ft(),name:lb(),timestamp:0,activelist:[],pages:t,flags:{}}}var wh=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t))(wh||{});function nN(t){return co(t,wh,{pages:e=>e.map(QC)})}function rN(t){return lo(t,wh,{pages:e=>e.map(eN)})}function Ei(t,e){if(!k(t))return;const n=Pe(e);return t.pages.find(i=>i.id===e||n===tr(i))}function vh(t,e,n){if(!k(t))return;const r=Pe(n);return t.pages.find(s=>ho(s)===e&&(s.id===n||r===tr(s)))}function iN(t,e){return k(t)?t.pages.filter(n=>ho(n)===e):[]}function Ly(t,e){if(!k(t)||!k(e))return!1;const n=Ei(t,e.id);return k(n)?!1:(t.pages.push(e),!0)}function sN(t,e){const n=Ei(t,e);if(k(t)&&k(n)){const r=Pe(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==tr(i)),n}}function on(t,e){if(k(e)&&k(e.kind))return k(e.kinddata)||(e.kinddata=k(e.id)?fc(t,e.kind):Uy(t,e.kind)),e.kinddata}function oN(t,e,n){const r=on(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])}function My(t,e){const n=on(t,e);return{char:(e==null?void 0:e.char)??(n==null?void 0:n.char)??1,color:(e==null?void 0:e.color)??(n==null?void 0:n.color)??Le.WHITE,bg:(e==null?void 0:e.bg)??(n==null?void 0:n.bg)??Le.ONCLEAR,light:(e==null?void 0:e.light)??(n==null?void 0:n.light)}}function fc(t,e){const n=e??"",r=vh(t,Te.OBJECT,n);if(k(r)){const i=bh(r);return{...ei(i),name:n,code:r.code}}}function Uy(t,e){const n=e??"",r=vh(t,Te.TERRAIN,n);if(k(r)){const i=bh(r);return{...ei(i),name:n,code:r.code}}}function ns(t,e){const n=Ei(t,e);return bh(n)}function rs(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function Eh(t,e){t&&delete t.flags[e]}function Py(t,e,n){const r=rs(t,e);return r==null?void 0:r[n]}function aN(t,e,n,r){const i=rs(t,e);return i&&(i[n]=r),r}function dc(t,e){const n=Py(t,e,"board");return ns(t,Se(n)?n:"")}function kh(t,e,n){if(!k(t))return;aN(t,e,"board",n);const r=ns(t,n);k(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function cN(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=Py(t,r,"board");return Se(i)?i:""});return e1(n)}function Dy(t){return cN(t).map(n=>ns(t,n)).filter(k)}function lN(t,e,n,r){const i=Si(e,(n==null?void 0:n.id)??"");if(!k(t)||!k(e)||!k(i)||!k(i.x)||!k(i.y)||!k(e.lookup)||r.x<0||r.x>=tt||r.y<0||r.y>=hn||i.x-r.x===0&&i.y-r.y===0)return!0;const s=r.x+r.y*tt,o=on(t,i),a=i.collision??(o==null?void 0:o.collision),c=Si(e,e.lookup[s]??"");if(k(c))return!0;const l=e.terrain[s];if(k(l)){const u=on(t,l),h=l.collision??(u==null?void 0:u.collision);if(tu(a,h))return!0}return!1}function uN(t,e,n,r){const i=Si(e,(n==null?void 0:n.id)??"");if(!k(t)||!k(e)||!k(i)||!k(i.x)||!k(i.y)||!k(e.lookup)||r.x<0||r.x>=tt||r.y<0||r.y>=hn)return{kind:"edge",collision:Ge.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=i.x+i.y*tt,o=r.x+r.y*tt,a=on(t,i),c=i.collision??(a==null?void 0:a.collision),l=Si(e,e.lookup[o]??"");if(k(l))return{...l};const u=e.terrain[o];if(k(u)){const h=on(t,u),d=u.collision??(h==null?void 0:h.collision);if(tu(c,d))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,k(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function is(t,e){const n=on(t,e);return k(e==null?void 0:e.id)&&k(e.x)&&k(e.y)?Pe(e.name??(n==null?void 0:n.name)??"object"):Pe((e==null?void 0:e.name)??(n==null?void 0:n.name)??"terrain")}function Sh(t,e,n,r){if(!k(t)||!k(e)||!k(e.named)||!k(n))return;const i=is(t,n);e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function hN(t,e,n){if(!(!k(t)||!k(e)||!k(e.lookup)||!k(n==null?void 0:n.id))&&!k(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*tt]=n.id}}function pc(t,e){if(!k(t)||!k(e)||k(e.lookup)&&k(e.named))return;const n=new Array(tt*hn).fill(void 0),r={},i=Object.values(e.objects);for(let a=0;a<i.length;++a){const c=i[a];if(k(c.x)&&k(c.y)&&k(c.id)&&!k(c.removed)){c.category=Ro.ISOBJECT,n[c.x+c.y*tt]=c.id;const l=is(t,c);r[l]||(r[l]=new Set),r[l].add(c.id)}}let s=0,o=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(k(c)){c.x=s,c.y=o,c.category=Ro.ISTERRAIN;const l=is(t,c);r[l]||(r[l]=new Set),r[l].add(a)}++s,s>=tt&&(s=0,++o)}e.lookup=n,e.named=r}function mc(t,e,n){return is(t,e)!=="player"&&k(e)?(e.removed=n,!0):!1}function po(t,e,n){var r;if(k(t)&&k(e)&&k(n==null?void 0:n.id)){if(k(e.lookup)&&k(n.x)&&k(n.y)){const s=n.x+n.y*tt;e.lookup[s]===n.id&&e.lookup.splice(s,1)}const i=is(t,n);k((r=e.named)==null?void 0:r[i])&&k(n.id)&&e.named[i].delete(n.id)}}function fN(t,e,n){const r=[];if(!k(t)||!k(e))return r;const i=Object.values(e.objects);for(let s=0;s<i.length;++s){const o=i[s];k(o.id)&&k(o.removed)&&n-o.removed>No*5&&(r.push(o.id),Zy(e,o.id))}return r}function dN(t,e,n){const r=[];if(!k(t)||!k(e))return r;e.lookup=void 0,pc(t,e);const i=Object.values(e.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!k(a.id))continue;a.lx=a.x,a.ly=a.y;const c=on(t,a),l=a.code??(c==null?void 0:c.code)??"";l&&r.push({id:a.id,type:Te.OBJECT,code:l,object:a,terrain:void 0})}const s=fN(t,e,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:Te.ERROR,code:"",object:void 0,terrain:void 0});return r}function pN(t,e,n,r){if(k(t)&&k(e)&&k(n)){const[i,s]=n,o=fc(t,i);if(k(o)&&k(o.name)){const a=Ih(e,r,i);return bc(a,s),Sh(t,e,a),a}}}function Ah(t,e,n,r){if(k(t)&&k(e)&&k(n)){const[i,s]=n,o=Uy(t,i);if(k(o)){const c=Xy(e,r,i);bc(c,s);const l=r.x+r.y*tt;return Sh(t,e,c,l),c}const a=fc(t,i);if(k(a)&&k(a.name)){const c=Ih(e,r,i);return bc(c,s),hN(t,e,c),Sh(t,e,c),c}}}const By={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function qr(t){return He(t)&&Fy(t[0])}function Fy(t){return k(Ro[t])&&Se(t)}function $y(t){if(Se(t))return By[Pe(t)]}function jy(t){if(qr(t))return t;if(Fy(t))return[t];const e=$y(t);if(k(e))return[e]}function gc(t){const e=C.words[t],n=jy(e);if(qr(n))return[n,t+1];const[r,i]=Gt(t),s=jy(r);return qr(s)?[s,i]:[void 0,t]}const zy={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalkable:"ISWALKABLE",isswimmable:"ISSWIMABLE"};Ge.ISSOLID,Ge.ISWALK,Ge.ISSWIM,Ge.ISBULLET,Ge.ISWALK,Ge.ISSWIM;function ki(t){return He(t)&&xh(t[0])}function xh(t){return k(Ge[t])&&Se(t)}function mN(t){if(Se(t))return zy[Pe(t)]}function Wy(t){const e=C.words[t];if(ki(e))return[e,t+1];if(xh(e))return[[e],t+1];const[n,r]=Gt(t);return ki(n)?[n,r]:xh(n)?[[n],r]:[void 0,t]}function Gt(t,e=!0){var r,i,s,o,a;const n=C.words[t];if($y(n)){const[c,l]=gc(t);if(k(c))return[c,l]}if(mN(n)){const[c,l]=Wy(t);if(k(c))return[c,l]}if(Vy(n)){const[c,l]=_c(t);if(k(c))return[c,l]}if(Se(n)&&Pe(n)==="rnd"){const[c,l]=Gt(t+1),[u,h]=Gt(l);return ve(c)&&ve(u)?[Ps(c,u),h]:ve(c)?[Ps(0,c),l]:[Ps(0,1),t+1]}if(Gp(n)){const[c,l]=eu(t);if(k(c))return[c,l]}if(!k(n))return[void 0,t];if(gr(n)||ve(n)||He(n))return[n,t+1];if(Se(n)){const c=Pe(n);if(e){const l=(r=C.get)==null?void 0:r.call(C,n);if(k(l))return[l,t+1]}switch(c){case"aligned":case"alligned":{const l=Zp(C.board,C.element,C.player);return!k(C.element)||!k(l)?[0,t+1]:[C.element.x===l.x||C.element.y===l.y?1:0,t+1]}case"contact":{const l=Zp(C.board,C.element,C.player);if(!k(C.element)||!k(l))return[0,t+1];const u=(l.x??0)-(((i=C.element)==null?void 0:i.x)??0),h=(l.y??0)-(((s=C.element)==null?void 0:s.y)??0);return[u===0&&Math.abs(h)<2||h===0&&Math.abs(u)<2?1:0,t+1]}case"blocked":{const[l,u]=re(C.words,t+1,[q.DIR]);return[lN(C.book,C.board,C.element,l)?1:0,u]}case"any":{const[l,u]=re(C.words,t+1,[q.KIND]),h=ma(l)??"",d=Ds(C.board,h);return[Jp(d,l).length?1:0,u]}case"rnd":return[Ps(0,1),t+1];case"abs":{const[l,u]=re(C.words,t+1,[q.NUMBER]);return[Math.abs(l),u]}case"ceil":{const[l,u]=re(C.words,t+1,[q.NUMBER]);return[Math.ceil(l),u]}case"floor":{const[l,u]=re(C.words,t+1,[q.NUMBER]);return[Math.floor(l),u]}case"round":{const[l,u]=re(C.words,t+1,[q.NUMBER]);return[Math.round(l),u]}case"min":{const l=[];for(let u=t+1;u<C.words.length;){const[h,d]=Gt(u);if(He(h)&&!gr(h)&&!yr(h)&&!qr(h)&&!ki(h)&&!En(h))return[mr(h),d];u=d,l.push(h)}return[Math.min(...l),C.words.length]}case"max":{const l=[];for(let u=t+1;u<C.words.length;){const[h,d]=Gt(u);if(He(h)&&!gr(h)&&!yr(h)&&!qr(h)&&!ki(h)&&!En(h))return[mr(h),d];u=d,l.push(h)}return[Math.max(...l),C.words.length]}case"clamp":{const[l,u,h,d]=re(C.words,t+1,[q.NUMBER,q.NUMBER,q.NUMBER]);return[jr(l,u,h),d]}case"pick":{const l=[];for(let u=t+1;u<C.words.length;){const[h,d]=Gt(u);if(He(h)&&!gr(h)&&!yr(h)&&!qr(h)&&!ki(h)&&!En(h))return[mr(h),d];u=d,l.push(h)}return[mr(l),C.words.length]}case"range":{const[l,u,h,d]=re(C.words,t+1,[q.NUMBER,q.MAYBE_NUMBER,q.MAYBE_NUMBER]);return[Ql(l,u,h),d]}case"run":{const[l,u]=re(C.words,t+1,[q.STRING]);return Cc(l),[(o=C.get)==null?void 0:o.call(C,"arg"),u]}case"runwith":{const[l,u,h]=re(C.words,t+1,[q.ANY,q.STRING]);return k(C.element)&&(C.element.arg=l),Cc(u),[(a=C.get)==null?void 0:a.call(C,"arg"),h]}}}return[n,t+1]}function gN(t){return k(t)&&t<Le.ONBLACK?t:void 0}function yN(t){return k(t)&&t>Le.WHITE&&t<Le.ONCLEAR?t-Le.ONBLACK:void 0}const yc={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function En(t){return He(t)&&Hy(t[0])}function Gy(t){return En(t)&&t[0].startsWith("ON")}function Hy(t){return k(Le[t])&&Se(t)}function Vy(t){if(Se(t))return yc[Pe(t)]}function _N(t){return t.map(e=>Le[e]).find(e=>k(e)&&e<Le.ONBLACK)}function bN(t){return t.map(e=>Le[e]).find(e=>k(e)&&e>=Le.ONBLACK)}function Ky(t){if(En(t))return t;if(Hy(t))return[t];const e=Vy(t);if(k(e))return[e]}function qy(t){const e=C.words[t],n=Ky(e);if(En(n))return[n,t+1];const[r,i]=Gt(t),s=Ky(r);return En(s)?[s,i]:[void 0,t]}function _c(t){const e=[];let n=t;const[r,i]=qy(t);if(En(r)&&(e.push(...r),n=i),En(e)&&!Gy(e)){const[s,o]=qy(i);Gy(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function wN(t){const e={};return t.every(n=>{const r=Le[n];k(r)&&(r<Le.ONBLACK?e.color=r:e.bg=r-Le.ONBLACK)}),e}function vN(){return new Array(tt*hn).map(()=>{})}function EN(t=Nb){const e={terrain:vN(),objects:{},id:""};return t(e)}var Th=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t))(Th||{});function kN(t){return co(t,Th,{terrain:e=>e.map(uc),objects:e=>Object.values(e).map(uc),id:vi,named:vi,lookup:vi,codepage:vi})}function SN(t){return lo(t,Th,{terrain:e=>e.map(hc),objects:e=>{const n={};for(let r=0;r<e.length;++r){const i=hc(e[r]);k(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function AN(t,e){return!k(t)||e.x<0||e.x>=tt||e.y<0||e.y>=hn?-1:e.x+e.y*tt}function Rh(t){var e;return Pe((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"object")}function xN(t){var e;return(t==null?void 0:t.color)??((e=t==null?void 0:t.kinddata)==null?void 0:e.color)??Le.BLACK}function TN(t){var e;return(t==null?void 0:t.bg)??((e=t==null?void 0:t.kinddata)==null?void 0:e.bg)??Le.BLACK}function bc(t,e){if(!k(t)||!En(e))return;const{color:n,bg:r}=wN(e);k(n)&&(t.color=n),k(r)&&(t.bg=r)}function RN(t,e){if(!k(t)||!k(e)||!k(e.x)||!k(e.y)||e.x<0||e.x>=tt||e.y<0||e.y>=hn)return;const n={...e},r=e.x+e.y*tt;return t.terrain[r]=n,e}function IN(t,e){if(!k(t)||!k(e))return;const n={...e,id:e.id??ft()};return t.objects[n.id]=n,n}function Xy(t,e,n){return RN(t,{...e,kind:n})}function Ih(t,e,n,r){return IN(t,{...e,id:r??void 0,kind:n})}function Si(t,e){if(t)return t.objects[e]}function Oh(t,e,n,r,i){if(!k(t)||!k(e))return{x:0,y:0};const s={x:e.x??0,y:e.y??0},o={x:e.lx??s.x,y:e.ly??s.y},a=Hi(o,s),c=tt-1,l=hn-1;for(let u=0;u<r.length;++u){const h=t1(r[u]);switch(h){case ce.IDLE:break;case ce.NORTH:case ce.SOUTH:case ce.WEST:case ce.EAST:xt(s,h);break;case ce.BY:{const[d,f]=r.slice(u+1);ve(d)&&ve(f)&&(s.x=jr(s.x+d,0,c),s.y=jr(s.y+f,0,l)),u+=2;break}case ce.AT:{const[d,f]=r.slice(u+1);ve(d)&&ve(f)&&(s.x=jr(d,0,c),s.y=jr(f,0,l)),u+=2;break}case ce.FLOW:xt(s,a);break;case ce.SEEK:{const d=ON(t,e,n);gr(d)&&xt(s,Hi(i,d));break}case ce.RNDNS:xt(s,mr(ce.NORTH,ce.SOUTH));break;case ce.RNDNE:xt(s,mr(ce.NORTH,ce.EAST));break;case ce.RND:xt(s,mr(ce.NORTH,ce.SOUTH,ce.WEST,ce.EAST));break;case ce.CW:case ce.CCW:case ce.OPP:case ce.RNDP:{const d=Oh(t,e,n,r.slice(u+1),i);switch(s.x=i.x,s.y=i.y,h){case ce.CW:switch(Hi(i,d)){case ce.NORTH:xt(s,ce.EAST);break;case ce.SOUTH:xt(s,ce.WEST);break;case ce.EAST:xt(s,ce.SOUTH);break;case ce.WEST:xt(s,ce.NORTH);break}break;case ce.CCW:switch(Hi(i,d)){case ce.NORTH:xt(s,ce.WEST);break;case ce.SOUTH:xt(s,ce.EAST);break;case ce.EAST:xt(s,ce.NORTH);break;case ce.WEST:xt(s,ce.SOUTH);break}break;case ce.OPP:switch(Hi(i,d)){case ce.NORTH:xt(s,ce.SOUTH);break;case ce.SOUTH:xt(s,ce.NORTH);break;case ce.EAST:xt(s,ce.WEST);break;case ce.WEST:xt(s,ce.EAST);break}break;case ce.RNDP:switch(Hi(i,d)){case ce.NORTH:case ce.SOUTH:s.x+=mr(-1,1);break;case ce.WEST:case ce.EAST:s.y+=mr(-1,1);break}break}break}}}return s}function Zy(t,e){return k(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function ON(t,e,n){if(!k(t)||!k(e))return;const r=t.objects[n];if(k(r))return r;if(gr(e))return Yp(e,Ds(t,"player"))}const C={timestamp:0,book:void 0,board:void 0,element:void 0,player:"",isplayer:!1,words:[],get:void 0};var q=(t=>(t[t.CATEGORY=0]="CATEGORY",t[t.COLLISION=1]="COLLISION",t[t.COLOR=2]="COLOR",t[t.KIND=3]="KIND",t[t.DIR=4]="DIR",t[t.NUMBER=5]="NUMBER",t[t.STRING=6]="STRING",t[t.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",t[t.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",t[t.MAYBE_COLLISION=9]="MAYBE_COLLISION",t[t.MAYBE_COLOR=10]="MAYBE_COLOR",t[t.MAYBE_KIND=11]="MAYBE_KIND",t[t.MAYBE_DIR=12]="MAYBE_DIR",t[t.MAYBE_NUMBER=13]="MAYBE_NUMBER",t[t.MAYBE_STRING=14]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",t[t.ANY=16]="ANY",t))(q||{});function It(t,e){throw new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function re(t,e,n){var o,a,c,l;const r=C.words;C.words=t;const i=[];let s=e;for(let u=0;u<n.length;++u)switch(n[u]){case 0:{const[h,d]=gc(s);qr(h)||It("terrain or object",h),s=d,i.push(h);break}case 1:{const[h,d]=Wy(s);ki(h)||It("solid, walk, swim, bullet, walkable or swimmable",h),s=d,i.push(h);break}case 2:{const[h,d]=_c(s);En(h)||It("color",h),s=d,i.push(h);break}case 3:{const[h,d]=Kp(s);Vi(h)?(s=d,i.push(h)):It("kind",h);break}case 4:{const[h,d]=eu(s);if(yr(h)){const f=((o=C.element)==null?void 0:o.x)??0,p=((a=C.element)==null?void 0:a.y)??0,m={x:f,y:p},b=k(C.board)&&k(C.element)?Oh(C.board,C.element,C.player,h,m):m;s=d,i.push(b)}else It("direction",h);break}case 5:{const[h,d]=Gt(s);if(Se(h)){const f=parseFloat(h);ve(f)?i.push(f):It("number",h)}else ve(h)?i.push(h):It("number",h);s=d;break}case 6:{const h=C.words[s];Se(h)||It("string",h),++s,i.push(h);break}case 7:{const[h,d]=Gt(s,!1);let f=h;if(Se(f)){const p=parseFloat(f);ve(p)&&(f=p)}else ve(f)||It("number or string",f);s=d,i.push(f);break}case 8:{const[h,d]=gc(s);h!==void 0&&!qr(h)&&It("optional terrain or object",h),s=d,i.push(h);break}case 9:{const[h,d]=gc(s);h!==void 0&&!ki(h)&&It("optional solid, walk, swim, bullet, walkable or swimmable",h),s=d,i.push(h);break}case 10:{const[h,d]=_c(s);h!==void 0&&!En(h)&&It("optional color",h),s=d,i.push(h);break}case 11:{const[h,d]=Kp(s);h!==void 0&&!Vi(h)&&It("optional kind",h),s=d,i.push(h);break}case 12:{const[h,d]=eu(s);if(yr(h)){const f=((c=C.element)==null?void 0:c.x)??0,p=((l=C.element)==null?void 0:l.y)??0,m={x:f,y:p},b=C.board?Oh(C.board,C.element,C.player,h,m):m;s=d,i.push(b)}else h===void 0?(s=d,i.push(void 0)):It("optional direction",h);break}case 13:{const[h,d]=Gt(s);if(Se(h)){const f=parseFloat(h);ve(f)?i.push(f):It("optional number",h)}else ve(h)||h===void 0?i.push(h):It("optional number",h);s=d;break}case 14:{const h=C.words[s];h!==void 0&&!Se(h)&&It("optional string",h),++s,i.push(h);break}case 15:{const[h,d]=Gt(s,!1);let f=h;if(Se(f)){const p=parseFloat(f);ve(p)&&(f=p)}else f!==void 0&&!ve(f)&&It("number or string",f);s=d,i.push(f);break}case 16:{const[h,d]=Gt(s);s=d,i.push(h);break}}return C.words=r,[...i,s]}const CN=["echo","reverb","chorus","phaser","distortion","vibrato"];function Jy(t,e,n){const[r]=re(n,0,[q.MAYBE_STRING]),i=r??"",s=e.get(i);hk("audio",t,Se(s)?s:i)}function nr(t,e){const[n]=re(e,0,[q.NUMBER_OR_STRING]);if(ve(n))Wl("audio",t,"volume",n);else if(CN.includes(Pe(n))){const[r,i]=re(e,1,[q.NUMBER_OR_STRING,q.MAYBE_NUMBER_OR_STRING]);fk("audio",t,n,r,i)}else{const[r]=re(e,1,[q.MAYBE_NUMBER_OR_STRING]);if(ve(r)){const i=e.length-1,s=new Array(i).fill(q.NUMBER),o=re(e,1,s).slice(0,i),a=o.length===1?o[0]:o;Wl("audio",t,n,a)}else{const[i]=re(e,1,[q.MAYBE_NUMBER_OR_STRING]);Wl("audio",t,n,i)}}}const NN=pr().command("play",(t,e)=>(Jy(1,t,e),0)).command("synth",(t,e)=>{for(let n=1;n<=8;++n)nr(n,e);return 0}).command("synth1",(t,e)=>(nr(1,e),0)).command("synth2",(t,e)=>(nr(2,e),0)).command("synth3",(t,e)=>(nr(3,e),0)).command("synth4",(t,e)=>(nr(4,e),0)).command("synth5",(t,e)=>(nr(5,e),0)).command("synth6",(t,e)=>(nr(6,e),0)).command("synth7",(t,e)=>(nr(7,e),0)).command("synth8",(t,e)=>(nr(8,e),0)).command("bgplay",(t,e)=>(Jy(0,t,e),0)).command("bgsynth",(t,e)=>(nr(0,e),0)).command("tts",(t,e)=>{const[n,r]=re(e,0,[q.STRING,q.MAYBE_STRING]);return uk("audio",r??"",n),0});function wc(t,e,n,r){const i=Se(e)?e:e.id,s=Se(e)?void 0:{x:e.x??0,y:e.y??0},o=Se(n)?n:n.id,a=i??s;k(o)&&k(a)&&t.send(o,r,a)}function LN(t,e,n,r){k(n==null?void 0:n.id)?(n.headless=!0,po(t,e,n)):Xy(e,r,"empty")}function Yy(t,e,n,r,i){const s=uN(e,n,r,i);if(k(s)){wc(t,s,t.id(),"thud"),r.kind===ze.PLAYER?wc(t,t.id(),s,"touch"):r.collision===Ge.ISBULLET?wc(t,t.id(),s,"shot"):wc(t,t.id(),s,"bump");const o=on(e,s);return(s.destructible??(o==null?void 0:o.destructible))&&LN(e,n,s,i),!1}return!0}function Qy(t,e,n){if(!gr(C.element))return 0;const[r,i]=re(e,0,[q.DIR,q.MAYBE_KIND]),s=i??["bullet"],o=pN(C.book,C.board,s,{x:C.element.x,y:C.element.y});if(k(o)){o.arg=n,o.collision=Ge.ISBULLET,o.destructible=1,o.stepx=r.x-C.element.x,o.stepy=r.y-C.element.y;const a=on(C.book,o),c=o.code??(a==null?void 0:a.code)??"";B_(C.book,C.board,o,c,1),o.x===C.element.x&&o.y===C.element.y?o.headless=!0:t.bucket(o.id)}return t.yield(),0}const MN=pr().command("change",(t,e)=>{if(!k(C.book)||!k(C.board))return 0;const[n,r]=re(e,0,[q.KIND,q.KIND]);pc(C.book,C.board);const i=ma(n)??"",s=Ds(C.board,i),o=Jp(s,n),a=ma(r),c=qp(r),l=Xp(r);return o.forEach(u=>{if(is(C.book,u)===a)k(c)&&(u.color=c),k(l)&&(u.bg=l);else{if(k(u.id)&&(po(C.book,C.board,u),!mc(C.book,u,C.timestamp)))return;gr(u)&&Ah(C.book,C.board,r,u)}}),0}).command("put",(t,e)=>{if(!k(C.book)||!k(C.board))return 0;const[n,r]=re(e,0,[q.DIR,q.KIND]);return pc(C.book,C.board),Ah(C.book,C.board,r,n),0}).command("shootwith",(t,e)=>{const[n,r]=re(e,0,[q.ANY]);return Qy(t,e.slice(r),n)}).command("shoot",Qy).command("throwstar",()=>0),UN=navigator.userAgent.includes("Mac")?"cmd":"ctrl",Xr="$dkpurple",PN="$196",DN="$205";function an(t,e){return`$${t}${e}$blue`}function e_(t,e){return`$${t}${e}$ondkblue`}function Qe(t,e){Ct(t,e)}function BN(t,e){const n=PN.repeat(e);Qe(t,`${Xr}${n}`)}function Ch(t,e){const n=DN.repeat(e);Qe(t,`${Xr}${n}`)}function mo(t,e){Qe(t,`${Xr} ${" ".repeat(e.length)} `),BN(t,e.length+2),Qe(t,`${Xr} $white${e} `),Ch(t,e.length+2)}function Ar(t,e){Qe(t,`${Xr} ${" ".repeat(e.length)} `),Qe(t,`${Xr} $gray${e} `),Ch(t,e.length+2)}function De(t,e,n){Qe(t,`${Xr} $white${e} $blue${n}`)}function Fe(t,e){Qe(t,`${Xr}$blue${e}`)}function ss(t=""){Gl("cli",t,C.player)}const FN=pr().command("send",(t,e)=>{const[n,r]=re(e,0,[q.STRING,q.ANY]);switch(n){case"helpmenu":mo("cli","H E L P"),De("cli","#help controls","zss controls and inputs"),Qe("cli","!helpcontrols;read help controls"),Qe("cli",""),De("cli","#help text","text formatting"),Qe("cli","!helptext;read help text"),Qe("cli",""),De("cli","#help developer","developer commands"),Qe("cli","!helpdeveloper;read help developer"),Qe("cli",""),De("cli","#help player","player settings"),Qe("cli","!helpplayer;read help player"),Ar("cli","keyboard input"),De("cli","?","open console"),De("cli","esc","close console"),De("cli","tab","move console"),De("cli","up / down arrow keys","navigate console items"),De("cli","left / right arrow keys","change console items"),De("cli","enter","interact with console items"),De("cli","alt + arrow keys","skip words and console lines"),De("cli",`${UN} + up / down arrow keys`,"input history");break;case"helpcontrols":mo("cli","zss controls and inputs"),Ar("cli","keyboard input"),De("cli","arrow keys","move"),De("cli","shift + arrow keys","shoot"),De("cli","enter","ok / accept"),De("cli","escape","cancel / close"),De("cli","tab","menu / action"),Ar("cli","mouse input"),Fe("cli","todo ???"),Ar("cli","controller input"),De("cli","left stick","move"),De("cli","right stick","aim"),De("cli","a","ok / accept"),De("cli","b","cancel / close"),De("cli","y","menu / action"),De("cli","x","shoot"),De("cli","triggers","shoot");break;case"helptext":mo("cli","text formatting"),Ar("cli","typography"),Fe("cli","plain text"),Fe("cli","$centering text"),Fe("cli",'"\\"@quoted strings for special chars\\""'),Fe("cli","$$0-255 for ascii chars $159$176$240"),Fe("cli",`use color names like ${an("red","$$red")} to change foreground color`),Fe("cli",`use color names like ${e_("ongreen","$$ongreen")} to change background color`),Fe("cli",`use clear ${e_("onclear","to change background to")} transparent`),Ar("cli","hyperlinks"),Fe("cli",`${an("white",'"!hotkey"')} message shortcut;${an("gray","Label")}`),Fe("cli",`${an("white",'"!range"')} flag [labelmin] [labelmax];${an("gray","Input Label")}`),Fe("cli",`${an("white",'"!select"')} flag ...list of values;${an("gray","Input Label")}`),Fe("cli",`${an("white",'"!number"')} flag [minvalue] [maxvalue];${an("gray","Input Label")}`),Fe("cli",`${an("white",'"!text"')} flag;${an("gray","Input Label")}`),Fe("cli",`${an("white",'"!copyit"')} flag;${an("gray","Input Label")}`);break;case"helpdeveloper":mo("cli","developer commands"),De("cli","#books","list books in memory"),De("cli","#pages","list pages in opened book"),De("cli","@[pagetype:]page name","create & edit a new codepage in the currently opened book"),De("cli","#trash","list books and pages from open book you can delete"),De("cli","#save","flush state to register");break;case"helpplayer":mo("cli","player settings"),Fe("cli","todo");break;default:Ct("$2",`${n} ${r??""}`);break}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(Ot),s=i.join(" ");switch(Pe(r)){case bn(he.LOADER):n=Ii(ze.CONTENT,s,Te.LOADER);break;default:n=Ii(ze.CONTENT,[r,...i].join(" "),Te.OBJECT);break;case bn(he.BOARD):n=Ii(ze.CONTENT,s,Te.BOARD);break;case bn(he.OBJECT):n=Ii(ze.CONTENT,s,Te.OBJECT);break;case bn(he.TERRAIN):n=Ii(ze.CONTENT,s,Te.TERRAIN);break;case bn(he.CHARSET):n=Ii(ze.CONTENT,s,Te.CHARSET);break;case bn(he.PALETTE):n=Ii(ze.CONTENT,s,Te.PALETTE);break}return k(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(Ot).join(" ");return Ct("$2",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Ot(n),s=r.map(Ot).join(" ");return Ct("$2",`!${s};${i}`),0}).command("dev",()=>(ss(),ok("cli",C.player),0)).command("share",()=>(ss(),ak("cli",C.player),0)).command("bookcreate",(t,e)=>{const[n]=re(e,0,[q.MAYBE_STRING]),r=M_(n);return k(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=re(e,0,[q.STRING]),r=Jr(n);return k(r)?(Fe("cli",`opened [book] ${r.name}`),Oc(ze.MAIN,r.id),t.command("pages")):et("cli","bookopen",`book ${n} not found`,C.player),0}).command("booktrash",(t,e)=>{const[n]=re(e,0,[q.STRING]),r=Ht(ze.MAIN),i=Jr(n);return k(i)&&(r===i&&Oc(ze.MAIN,""),yM(n),Fe("cli",`trashed [book] ${i.name}`),ss(),t.command("pages")),0}).command("pageopen",(t,e)=>{const[n]=re(e,0,[q.STRING]),r=Un(ze.MAIN);if(!k(r))return 0;const i=Ei(r,n);if(k(i)){const s=tr(i),o=fo(i);Fe("cli",`opened [${o}] ${s}`),Ep(wp(r.id,i.id),i.code);const a=fo(i);pk("cli",r.id,i.id,a,`${s} - ${r.name}`,C.player)}else et("cli","pageopen",`page ${n} not found`,C.player);return 0}).command("pagetrash",(t,e)=>{const[n]=re(e,0,[q.STRING]),r=Un(ze.MAIN),i=sN(r,n);if(k(n)){const s=tr(i),o=fo(i);Fe("cli",`trashed [${o}] ${s}`),ss(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(Ot).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{Ar("cli","books");const t=Ht(ze.MAIN);De("cli","main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=Ht(ze.CONTENT);De("cli","content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),Ch("cli",7);const n=Ic();return n.length?n.forEach(r=>{Qe("cli",`!bookopen ${r.id};${r.name}`)}):Fe("cli","no books found"),Qe("cli","!bookcreate;create a new book"),0}).command("pages",()=>{Ar("cli","pages");const t=Un(ze.MAIN);return k(t)&&(De("cli","main",`${t.name} $GREEN${t.id}`),t.pages.length?t.pages.forEach(e=>{const n=tr(e),r=fo(e);Qe("cli",`!pageopen ${e.id};[${r}] ${n}`)}):(Qe("cli",""),Fe("cli","no pages found"),Fe("cli","use @ to create a page"),Fe("cli","@board name of board"),Fe("cli","@object name of object"),Fe("cli","@terrain name of terrain"),Fe("cli","You can omit the type and it will default to object"),Fe("cli","@object name of object"),Fe("cli","@name of object"))),0}).command("trash",()=>{Ar("cli","$REDTRASH"),Fe("cli","books");const t=Ic();t.length&&(t.forEach(n=>{Qe("cli",`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Qe("cli",""));const e=Ht(ze.MAIN);return k(e)&&(Fe("cli",`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=tr(n);Qe("cli",`!pagetrash ${n.id};$REDTRASH ${r}`)}),Qe("cli","")),0}).command("save",()=>(ss(),0)).command("savewith",(t,e)=>{const[n]=re(e,0,[q.STRING]);return ss(n),0}).command("nuke",()=>(lk("cli",C.player),0)).command("joincode",()=>(rk("cli",C.player),0));function $N(t){const e=By[t];if(k(e))return e;const n=zy[t];if(k(n))return n;const r=yc[t];if(k(r))return r;const i=zp[t];if(k(i))return i}const jN=pr({get(t,e){const n=$N(e);return k(n)?[!0,n]:[!1,void 0]}}),zN=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),t_=new Set(["player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),WN=["NORTH","SOUTH","WEST","EAST"];function GN(t){const e=ls(t);if(ve(e.inputcurrent)||(e.inputcurrent=0),He(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=Ft.NONE,i=0]=n??[Ft.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&Rk?1:0,e.inputctrl=i&Ik?1:0,e.inputshift=i&Ok?1:0,r){case Ft.MOVE_UP:case Ft.MOVE_DOWN:case Ft.MOVE_LEFT:case Ft.MOVE_RIGHT:e.inputmove=[WN[r-Ft.MOVE_UP]];break;case Ft.OK_BUTTON:e.inputok=1;break;case Ft.CANCEL_BUTTON:e.inputcancel=1;break;case Ft.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Ft.NONE&&o!==r}),e}const HN=pr({get(t,e){var s,o;if(C.isplayer&&zN.has(e)){const a=GN(((s=C.element)==null?void 0:s.id)??"")[e];return[k(a),a]}const n=(o=C.element)==null?void 0:o[e];if(k(n)||t_.has(e))return[!0,n];const i=ls(C.player)[e];return[k(i),i]},set(t,e,n){var s;const r=(s=C.element)==null?void 0:s[e];if(k(r)||t_.has(e))return k(C.element)&&(C.element[e]=n),[!0,n];const i=ls(C.player);return i[e]=n,[!0,n]},everytick(t){var e,n;(e=C.element)!=null&&e.headless&&t.command("die"),k((n=C.element)==null?void 0:n.x)&&k(C.element.y)&&k(C.element.stepx)&&k(C.element.stepy)&&Yy(t,C.book,C.board,C.element,{x:C.element.x+C.element.stepx,y:C.element.y+C.element.stepy})===!1&&(C.element.stepx=0,C.element.stepy=0,oN(C.book,C.element,"destructible")&&(C.element.headless=!0,mc(C.book,C.element,C.timestamp)))}}).command("become",(t,e)=>{var i,s;const n={x:((i=C.element)==null?void 0:i.x)??0,y:((s=C.element)==null?void 0:s.y)??0},[r]=re(e,0,[q.KIND]);return pc(C.book,C.board),po(C.book,C.board,C.element),mc(C.book,C.element,C.timestamp)&&Ah(C.book,C.board,r,n),t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=re(e,0,[q.NUMBER]);return k(C.element)&&(C.element.char=n),0}).command("color",(t,e)=>{const[n]=re(e,0,[q.COLOR]);return k(C.element)&&k(n)&&bc(C.element,n),0}).command("go",(t,e)=>{if(k(C.element)){const[n]=re(e,0,[q.DIR]);if(Yy(t,C.book,C.board,C.element,n),t.yield(),C.element.x===n.x&&C.element.y===n.y)return 0}return 1}).command("try",(t,e)=>{const[,n]=re(e,0,[q.DIR]);return t.command("go",...e)&&n<e.length&&t.command(...e.slice(n)),0}).command("walk",(t,e)=>{if(!k(C.element))return 0;const[n]=re(e,0,[q.DIR]),r=C.element.x??0,i=C.element.y??0;return C.element.stepx=n.x-r,C.element.stepy=n.y-i,0}),VN=pr().command("clear",(t,e)=>(e.forEach(n=>t.set(Ot(n),0)),0)).command("set",(t,e)=>{const[n,r]=re(e,0,[q.STRING,q.ANY]);return t.set(n,r),0}).command("take",(t,e)=>{const[n,r,i]=re(e,0,[q.STRING,q.MAYBE_NUMBER]),s=t.get(n),o=r??1;if(!ve(s))return 1;const a=s-o;return a<0?(i<e.length&&t.command(...e.slice(i)),1):(t.set(n,a),0)}).command("give",(t,e)=>{const[n,r,i]=re(e,0,[q.STRING,q.MAYBE_NUMBER]),s=t.get(n),o=ve(s)?s:0,a=r??1;if(!ve(a))return 0;const c=s===void 0?1:0;return c&&i<e.length&&t.command(...e.slice(i)),t.set(n,o+a),c}),KN=pr({get(){return[!1,void 0]},set(t,e,n){return Dk(t,e,n),[!1,void 0]},tick(){var e;const t=((e=C.element)==null?void 0:e.name)??"scroll";Kl(C.player,"scroll",un.SCROLL,void 0,t)},everytick(){const t=Bk(C.player);if(t&&k(C.element)){C.element.tickertext=t,C.element.tickertime=C.timestamp;const e=My(C.book,C.element);Ct(`$${Le[e.color]}$${e.char}`,t)}}}).command("send",(t,e)=>{var u,h;const[n,r]=re(e,0,[q.STRING,q.ANY]),[i,s]=n.split(":"),o=k(s)?i:"self",a=s??i;function c(d){d.forEach(f=>{k(f.id)&&t.send(f.id,a,r)})}const l=Pe(o);switch(l){case"all":for(const d of Object.keys(((u=C.board)==null?void 0:u.objects)??{}))t.send(d,a,r);break;case"self":t.message({id:ft(),sender:t.id(),target:a,data:r});break;case"others":for(const d of Object.keys(((h=C.board)==null?void 0:h.objects)??{}))d!==t.id()&&t.send(d,a,r);break;default:{c(nu(C.board,[o]));const d=t.get(l);He(d)?c(nu(C.board,d)):c(nu(C.board,[d]));break}}return 0}).command("stat",(t,e)=>{const n=Q0(e.map(Ot));switch(n.type){case he.OBJECT:k(C.element)&&(C.element.name=n.values.join(" "));break}return 0}).command("text",(t,e)=>{const n=e.map(Ot).join("");return Fk(C.player,n),0}).command("hyperlink",(t,e)=>{const[n,r,...i]=e,s=Ot(n),o=Ot(r);return $k(C.player,t,s,o,i),0}).command("gadget",(t,e)=>{const[n]=re(e,0,[q.STRING]),r=xk[Pe(n)];if(r===un.SCROLL){const[i,s]=re(e,1,[q.MAYBE_STRING,q.MAYBE_NUMBER]);Kl(C.player,n,r,s,i)}else if(k(r)){const[i,s]=re(e,1,[q.MAYBE_NUMBER,q.MAYBE_STRING]);Kl(C.player,n,r,i,s)}return 0}),qN=pr().command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=re(e,0,[q.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(Ot(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(Ot(e[0])),0)).command("cycle",(t,e)=>{if(k(C.element)){const[n]=re(e,0,[q.NUMBER]);C.element.cycle=jr(Math.round(n),1,255)}return 0}).command("die",t=>{var e;return(e=C.element)!=null&&e.headless&&po(C.book,C.board,C.element),mc(C.book,C.element,C.timestamp),t.endofprogram(),0}).command("endgame",()=>(mk("element",C.player),0)).command("run",(t,e)=>{const[n]=re(e,0,[q.STRING]);return Cc(n),0}).command("runwith",(t,e)=>{const[n,r]=re(e,0,[q.ANY,q.STRING]);return t.set("arg",n),Cc(r),0});function n_(t,e){if(!k(t))return;const n=Pe(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const XN=(t,e)=>{const n=F_(t.id());if(!k(n))return 0;const[r]=re(e,0,[q.STRING]),i=Pe(r);switch(i){case"seek":{const[s]=re(e,1,[q.NUMBER]);n.cursor=s;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[s]=re(e,1,[q.STRING]);t.set(s,n_(n,i));break}case"text":{const[s,o]=re(e,1,[q.STRING,q.STRING]),a=n_(n,s);if(ve(a)&&Se(o)){const c=new Uint8Array(n.bytes.buffer,n.cursor,a),u=new TextDecoder("utf-8").decode(c);t.set(o,u),n.cursor+=a}break}}return 0},ZN=pr({get(t,e){const n=F_(t.id());if(k(n))switch(Pe(e)){case"filename":return[k(n.filename),n.filename];case"cursor":return[k(n.cursor),n.cursor]}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=re(e,0,[q.STRING,q.ANY]);return t.message({id:ft(),sender:t.id(),target:n,data:r}),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(Ot).join(" ");return Ct("$2",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Ot(n),s=r.map(Ot).join(" ");return Ct("$2",`!${s};${i}`),0}).command("load",(t,e)=>{const n=e.map(Ot).join(" "),r=t.get(n)??n;return Un(ze.CONTENT,r),0}).command("reload",(t,e)=>{const n=e.map(Ot).join(" "),r=t.get(n)??n,i=Un(ze.CONTENT,r);return i.pages=[],0}).command("bin",XN);var go=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.CODE_PAGE=3]="CODE_PAGE",t))(go||{});const JN={audio:NN,board:MN,cli:FN,const:jN,element:HN,flags:VN,gadget:KN,lifecycle:qN,loader:ZN},Nh=["const","flags","audio","board","lifecycle","element"],YN={0:[],1:["cli",...Nh],2:["loader",...Nh],3:["gadget",...Nh]},QN={0:new Map,1:new Map,2:new Map,3:new Map};function yo(t){return(YN[t]??[]).map(n=>JN[n]).filter(k)}function eL(t,e){const n=QN[t];if(!n.has(e)){let r;const i=yo(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!k(r));++s);n.set(e,r)}return n.get(e)}function tL(t,e,n){const r=yo(t);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(e,n);if(s)return[s,o]}return[!1,void 0]}function nL(t,e,n,r){const i=yo(t);for(let s=0;s<i.length;++s){const[o]=i[s].set(e,n,r);if(o)return[o,r]}return[!1,void 0]}function rL(t,e){const n=yo(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function r_(t,e){const n=yo(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var i_={},s_={},o_={};const a_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");o_.encode=function(t){if(0<=t&&t<a_.length)return a_[t];throw new TypeError("Must be between 0 and 63: "+t)};const iL=o_,c_=5,l_=1<<c_,sL=l_-1,oL=l_;function aL(t){return t<0?(-t<<1)+1:(t<<1)+0}s_.encode=function(e){let n="",r,i=aL(e);do r=i&sL,i>>>=c_,i>0&&(r|=oL),n+=iL.encode(r);while(i>0);return n};var _o={};(function(t){function e(x,R,$){if(R in x)return x[R];if(arguments.length===3)return $;throw new Error('"'+R+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(x){const R=x.match(n);return R?{scheme:R[1],auth:R[2],host:R[3],port:R[4],path:R[5]}:null}t.urlParse=i;function s(x){let R="";return x.scheme&&(R+=x.scheme+":"),R+="//",x.auth&&(R+=x.auth+"@"),x.host&&(R+=x.host),x.port&&(R+=":"+x.port),x.path&&(R+=x.path),R}t.urlGenerate=s;const o=32;function a(x){const R=[];return function($){for(let V=0;V<R.length;V++)if(R[V].input===$){const Y=R[0];return R[0]=R[V],R[V]=Y,R[0].result}const L=x($);return R.unshift({input:$,result:L}),R.length>o&&R.pop(),L}}const c=a(function(R){let $=R;const L=i(R);if(L){if(!L.path)return R;$=L.path}const V=t.isAbsolute($),Y=[];let I=0,E=0;for(;;)if(I=E,E=$.indexOf("/",I),E===-1){Y.push($.slice(I));break}else for(Y.push($.slice(I,E));E<$.length&&$[E]==="/";)E++;let g=0;for(E=Y.length-1;E>=0;E--){const N=Y[E];N==="."?Y.splice(E,1):N===".."?g++:g>0&&(N===""?(Y.splice(E+1,g),g=0):(Y.splice(E,2),g--))}return $=Y.join("/"),$===""&&($=V?"/":"."),L?(L.path=$,s(L)):$});t.normalize=c;function l(x,R){x===""&&(x="."),R===""&&(R=".");const $=i(R),L=i(x);if(L&&(x=L.path||"/"),$&&!$.scheme)return L&&($.scheme=L.scheme),s($);if($||R.match(r))return R;if(L&&!L.host&&!L.path)return L.host=R,s(L);const V=R.charAt(0)==="/"?R:c(x.replace(/\/+$/,"")+"/"+R);return L?(L.path=V,s(L)):V}t.join=l,t.isAbsolute=function(x){return x.charAt(0)==="/"||n.test(x)};function u(x,R){x===""&&(x="."),x=x.replace(/\/$/,"");let $=0;for(;R.indexOf(x+"/")!==0;){const L=x.lastIndexOf("/");if(L<0||(x=x.slice(0,L),x.match(/^([^\/]+:\/)?\/*$/)))return R;++$}return Array($+1).join("../")+R.substr(x.length+1)}t.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(x){return x}function f(x){return m(x)?"$"+x:x}t.toSetString=h?d:f;function p(x){return m(x)?x.slice(1):x}t.fromSetString=h?d:p;function m(x){if(!x)return!1;const R=x.length;if(R<9||x.charCodeAt(R-1)!==95||x.charCodeAt(R-2)!==95||x.charCodeAt(R-3)!==111||x.charCodeAt(R-4)!==116||x.charCodeAt(R-5)!==111||x.charCodeAt(R-6)!==114||x.charCodeAt(R-7)!==112||x.charCodeAt(R-8)!==95||x.charCodeAt(R-9)!==95)return!1;for(let $=R-10;$>=0;$--)if(x.charCodeAt($)!==36)return!1;return!0}function b(x,R,$){let L=w(x.source,R.source);return L!==0||(L=x.originalLine-R.originalLine,L!==0)||(L=x.originalColumn-R.originalColumn,L!==0||$)||(L=x.generatedColumn-R.generatedColumn,L!==0)||(L=x.generatedLine-R.generatedLine,L!==0)?L:w(x.name,R.name)}t.compareByOriginalPositions=b;function _(x,R,$){let L=x.generatedLine-R.generatedLine;return L!==0||(L=x.generatedColumn-R.generatedColumn,L!==0||$)||(L=w(x.source,R.source),L!==0)||(L=x.originalLine-R.originalLine,L!==0)||(L=x.originalColumn-R.originalColumn,L!==0)?L:w(x.name,R.name)}t.compareByGeneratedPositionsDeflated=_;function w(x,R){return x===R?0:x===null?1:R===null?-1:x>R?1:-1}function v(x,R){let $=x.generatedLine-R.generatedLine;return $!==0||($=x.generatedColumn-R.generatedColumn,$!==0)||($=w(x.source,R.source),$!==0)||($=x.originalLine-R.originalLine,$!==0)||($=x.originalColumn-R.originalColumn,$!==0)?$:w(x.name,R.name)}t.compareByGeneratedPositionsInflated=v;function A(x){return JSON.parse(x.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=A;function O(x,R,$){if(R=R||"",x&&(x[x.length-1]!=="/"&&R[0]!=="/"&&(x+="/"),R=x+R),$){const L=i($);if(!L)throw new Error("sourceMapURL could not be parsed");if(L.path){const V=L.path.lastIndexOf("/");V>=0&&(L.path=L.path.substring(0,V+1))}R=l(s(L),R)}return c(R)}t.computeSourceURL=O})(_o);var Lh={};let cL=class V_{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new V_;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};Lh.ArraySet=cL;var u_={};const h_=_o;function lL(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||h_.compareByGeneratedPositionsInflated(t,e)<=0}let uL=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){lL(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(h_.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};u_.MappingList=uL;const bo=s_,pt=_o,vc=Lh.ArraySet,hL=u_.MappingList;let f_=class K_{constructor(e){e||(e={}),this._file=pt.getArg(e,"file",null),this._sourceRoot=pt.getArg(e,"sourceRoot",null),this._skipValidation=pt.getArg(e,"skipValidation",!1),this._sources=new vc,this._names=new vc,this._mappings=new hL,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new K_({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=pt.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=pt.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=pt.getArg(e,"generated"),r=pt.getArg(e,"original",null);let i=pt.getArg(e,"source",null),s=pt.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=pt.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[pt.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[pt.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=pt.relative(s,i));const o=this._mappings.toArray().length>0?new vc:this._sources,a=new vc;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=pt.join(r,c.source)),s!=null&&(c.source=pt.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=pt.join(r,c)),s!=null&&(c=pt.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(l=d[f],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!pt.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=bo.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=bo.encode(h-o),o=h,c+=bo.encode(l.originalLine-1-i),i=l.originalLine-1,c+=bo.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=bo.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=pt.relative(n,r));const i=pt.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};f_.prototype._version=3,i_.SourceMapGenerator=f_;var d_={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(d_);var wo={exports:{}},fL={},dL=Object.freeze({__proto__:null,default:fL}),p_=q_(dL);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;wo.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},wo.exports.initialize=e=>t=e}else{const t=p_,e=p_;wo.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},wo.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var m_=wo.exports;const pL=m_;function mL(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let vo=null;var gL=function(){if(vo)return vo;const e=[];return vo=pL().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,h,d){const f=new mL;f.generatedLine=r+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),e[e.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw vo=null,n}),vo};const fe=_o,Mh=d_,Ec=Lh.ArraySet,yL=m_,_L=gL,Uh=Symbol("smcInternal");class ut{constructor(e,n){return e==Uh?Promise.resolve(this):wL(e,n)}static initialize(e){yL.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return vL(e,n)}static async with(e,n,r){const i=await new ut(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ut.prototype._version=3,ut.GENERATED_ORDER=1,ut.ORIGINAL_ORDER=2,ut.GREATEST_LOWER_BOUND=1,ut.LEAST_UPPER_BOUND=2;class Eo extends ut{constructor(e,n){return super(Uh).then(r=>{let i=e;typeof e=="string"&&(i=fe.parseSourceMapInput(e));const s=fe.getArg(i,"version");let o=fe.getArg(i,"sources");const a=fe.getArg(i,"names",[]);let c=fe.getArg(i,"sourceRoot",null);const l=fe.getArg(i,"sourcesContent",null),u=fe.getArg(i,"mappings"),h=fe.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=fe.normalize(c)),o=o.map(String).map(fe.normalize).map(function(d){return c&&fe.isAbsolute(c)&&fe.isAbsolute(d)?fe.relative(c,d):d}),r._names=Ec.fromArray(a.map(String),!0),r._sources=Ec.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return fe.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,_L().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=fe.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new Eo(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||ut.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=fe.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case ut.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ut.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=fe.getArg(e,"source");const r=fe.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:fe.getArg(e,"line"),generatedColumn:fe.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=fe.getArg(e,"bias",ut.GREATEST_LOWER_BOUND);r==null&&(r=ut.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=fe.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=fe.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=fe.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:fe.getArg(i,"originalLine",null),column:fe.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=fe.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=fe.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=fe.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:fe.getArg(e,"line"),originalColumn:fe.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=fe.getArg(e,"bias",ut.GREATEST_LOWER_BOUND);i==null&&(i=ut.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:fe.getArg(s,"generatedLine",null),column:fe.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Eo.prototype.consumer=ut;class bL extends ut{constructor(e,n){return super(Uh).then(r=>{let i=e;typeof e=="string"&&(i=fe.parseSourceMapInput(e));const s=fe.getArg(i,"version"),o=fe.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Ec,r._names=new Ec,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=fe.getArg(c,"offset"),u=fe.getArg(l,"line"),h=fe.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new ut(fe.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(fe.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(fe.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:fe.getArg(e,"line"),generatedColumn:fe.getArg(e,"column")},r=Mh.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(fe.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=fe.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,n,r){const i=n||null,s=r||ut.GENERATED_ORDER;let o;switch(s){case ut.GENERATED_ORDER:o=this._generatedMappings;break;case ut.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=fe.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return Mh.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=fe.getArg(e,"line"),r={source:fe.getArg(e,"source"),originalLine:n,originalColumn:fe.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",fe.compareByOriginalPositions,Mh.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:fe.getArg(o,"generatedLine",null),column:fe.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:fe.getArg(o,"generatedLine",null),column:fe.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function wL(t,e){let n=t;typeof t=="string"&&(n=fe.parseSourceMapInput(t));const r=n.sections!=null?new bL(n,e):new Eo(n,e);return Promise.resolve(r)}function vL(t,e){return Eo.fromSourceMap(t,e)}var g_={};const EL=i_.SourceMapGenerator,kc=_o,kL=/(\r?\n)/,SL=10,os="$$$isSourceNode$$$";let AL=class Jh{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[os]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new Jh,s=e.split(kL);let o=0;const a=function(){const f=m(),p=m()||"";return f+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=s[o]||"";const p=h.substr(0,f.generatedColumn-l);s[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,p),u=f;return}for(;c<f.generatedLine;)i.add(a()),c++;l<f.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,f.generatedColumn)),s[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=kc.join(r,f)),i.setSourceContent(f,p))}),i;function d(f,p){if(f===null||f.source===void 0)i.add(p);else{const m=r?kc.join(r,f.source):f.source;i.add(new Jh(f.originalLine,f.originalColumn,m,p,f.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[os]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[os]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[os]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[os]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[kc.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][os]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(kc.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new EL(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===SL?(n.line++,n.column=0,h+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};g_.SourceNode=AL;var xL=g_.SourceNode;const TL=Ql(32,126).map(t=>String.fromCharCode(t)),RL=sn({name:"Whitespace",pattern:/ +/}),IL=sn({name:"WhitespaceSkipped",pattern:/ +/,group:Et.SKIPPED}),Ph=sn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),y_=sn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:TL}),Dh=sn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Bh=sn({name:"EscapedDollar",pattern:"$$"}),Fh=sn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),$h=sn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),__=sn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function OL(t,e=""){return sn({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const b_=Object.keys(yc).map(t=>OL(`\\$(${t})`,t)),CL=[RL,Ph,...b_,Dh,y_,$h,Bh,__,Fh],NL=new Et(CL,{skipValidations:!Hn,ensureOptimizations:Hn}),LL=new Et([IL,Ph,...b_,Dh,y_,$h,Bh,__,Fh],{skipValidations:!Hn,ensureOptimizations:Hn});function jh(t,e=!1){return e?LL.tokenize(t):NL.tokenize(t)}function w_(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function v_(t){t.active={...t.reset}}function E_(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case Bh:s("$");break;case $h:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case Dh:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Ph:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=yc[l],h=gN(Le[u]),d=yN(Le[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):k(h)?e.active.color=h:k(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(k(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){v_(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;DL(u,u+l.length,e.active.color,e.active.bg,e),PL(u,l,e)}}}function ML(t,e,n){const r=jh(t);r.tokens&&(E_(r.tokens,e),v_(e))}function UL(t,e,n){const r=jh(t);if(!r.tokens)return;const i=w_(e,n,Le.WHITE,Le.BLACK);return i.measureonly=!0,E_(r.tokens,i),i.x>0&&++i.y,i}function PL(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++)}function DL(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r}let k_=0;const S_=Hn,BL=["Command","lines"];class FL extends fC{constructor(){super(J0,{traceInitPerf:Hn,skipValidations:!Hn,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});ye(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));ye(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(io)}])}));ye(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));ye(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));ye(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));ye(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(S0)}));ye(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Yu)}));ye(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(E0)}])}));ye(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(k0)}));ye(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(A0),this.SUBRULE(this.words),this.CONSUME(x0)}));ye(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(es),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));ye(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));ye(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));ye(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_debugger)},{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));ye(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(ih),this.SUBRULE(this.words)}));ye(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(F0),this.SUBRULE(this.words)}));ye(this,"command_debugger",this.RULED("command_debugger",()=>{this.CONSUME(W0)}));ye(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(sh),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));ye(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ic),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(io)),this.CONSUME4(es),this.CONSUME4(oh)}}])}));ye(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ic),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(es),this.CONSUME(oh)}}])}));ye(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ic),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));ye(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(es),this.CONSUME(ah),this.CONSUME(sh),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));ye(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(es),this.CONSUME(ah),this.OPTION(()=>this.SUBRULE(this.command_fork))}));ye(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(G0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(H0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(V0),this.SUBRULE(this.words)}));ye(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(K0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(q0)}));ye(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(X0)}));ye(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(z0)}));ye(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Qu),this.SUBRULE2(this.and_test)})}));ye(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(th),this.SUBRULE2(this.not_test)})}));ye(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(eh),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));ye(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));ye(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(I0)},{ALT:()=>this.CONSUME(O0)},{ALT:()=>this.CONSUME(C0)},{ALT:()=>this.CONSUME(N0)},{ALT:()=>this.CONSUME(L0)},{ALT:()=>this.CONSUME(M0)}])}));ye(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Qu),this.SUBRULE2(this.and_test_value)})}));ye(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(th),this.SUBRULE2(this.not_test_value)})}));ye(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(eh),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));ye(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));ye(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(nh)},{ALT:()=>this.CONSUME(rh)}]),this.SUBRULE(this.term)}));ye(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));ye(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(P0)},{ALT:()=>this.CONSUME(ih)},{ALT:()=>this.CONSUME(D0)},{ALT:()=>this.CONSUME(B0)}]),this.SUBRULE(this.factor)}));ye(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(nh)},{ALT:()=>this.CONSUME(rh)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));ye(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(U0),this.SUBRULE(this.factor)})}));ye(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));ye(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(T0)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(R0)},{ALT:()=>{this.CONSUME($0),this.SUBRULE(this.expr),this.CONSUME(j0)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=BL.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(k_++).toString().padStart(3),c=s?"font-weight: bold;":"";if(S_&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),S_&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),k_--},i)}}const as=new FL;if(Gk){const t=as.getGAstProductions(),e=SC(t);console.info(e)}const $L=as.getBaseCstVisitorConstructor();var oe=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(oe||{}),Ai=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(Ai||{}),rr=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(rr||{}),Sc=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(Sc||{});function jL(t){return!!(t!=null&&t.tokenType)}function xr(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class zL extends $L{constructor(){super();ye(this,"unique",0);Hn&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&jL(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():k(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:xr(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:xr(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:xr(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:xr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:xr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,"if","",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=ft(),i=ft();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=ft(),i=ft();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,"if",r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=ft(),i=ft();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=ft(),i=ft(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=ft(),i=ft(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){return this.createcodenode(n,{type:22,words:this.go(n.words)})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=xr(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=xr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=xr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(xr(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const WL=new zL,en={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Ac="zss.js";function Ne(t,e){return new xL(t.startLine??1,t.startColumn??1,Ac,e)}function zh(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Wh(t){return`'${zh(t)}'`}function xc(t){if(t.startsWith('"'))return xc(t.replaceAll(/(^"|"$)/g,""));const e=jh(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===Fh?`', api.get('${zh(r.image.substring(1))}'), '`:zh(r.image)).join("")}'].join('')`}function xi(t){return t.filter(e=>e!==void 0).map(Be)}function A_(t){return Ne(t,"")}function GL(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function mt(t,e,n){return Ne(t,[`api.${e}(`,...GL(n,", "),")"])}function HL(t){if(t.type===oe.COMPARE&&t.compare.type===oe.COMPARE_ITEM)switch(t.compare.method){case Ai.IS_EQ:return mt(t,"isEq",[Be(t.lhs),Be(t.rhs)]);case Ai.IS_NOT_EQ:return mt(t,"isNotEq",[Be(t.lhs),Be(t.rhs)]);case Ai.IS_LESS_THAN:return mt(t,"isLessThan",[Be(t.lhs),Be(t.rhs)]);case Ai.IS_GREATER_THAN:return mt(t,"isGreaterThan",[Be(t.lhs),Be(t.rhs)]);case Ai.IS_LESS_THAN_OR_EQ:return mt(t,"isLessThanOrEq",[Be(t.lhs),Be(t.rhs)]);case Ai.IS_GREATER_THAN_OR_EQ:return mt(t,"isGreaterThanOrEq",[Be(t.lhs),Be(t.rhs)])}return Ne(t,"")}function Ti(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",Be(n),")"])}function x_(t,e,n){return t.prepend(`api.${e}(`),t.add([Be(n),")"])}function VL(t,e){if(t.type===oe.OPERATOR_ITEM)switch(t.operator){case rr.PLUS:return Ti(e,"opPlus",t.rhs);case rr.MINUS:return Ti(e,"opMinus",t.rhs);case rr.POWER:return Ti(e,"opPower",t.rhs);case rr.MULTIPLY:return Ti(e,"opMultiply",t.rhs);case rr.DIVIDE:return Ti(e,"opDivide",t.rhs);case rr.MOD_DIVIDE:return Ti(e,"opModDivide",t.rhs);case rr.FLOOR_DIVIDE:return Ti(e,"opFloorDivide",t.rhs);case rr.UNI_PLUS:return x_(e,"opUniPlus",t.rhs);case rr.UNI_MINUS:return x_(e,"opUniMinus",t.rhs)}return Ne(t,"")}function KL(t){if(t.type===oe.OPERATOR){const e=t.lhs?Be(t.lhs):Ne(t,"");return t.items.forEach(n=>VL(n,e)),e}return Ne(t,"")}function Tc(t,e){return Ne(t,[mt(t,"jump",[`${e}`]),"; continue;"])}function Tr(t){return en.linelookup[t??""]??-1}function Gh(t,e){en.linelookup[t]=e}function ko(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case oe.WHILE:case oe.REPEAT:case oe.FOREACH:case oe.ELSE_IF:i.type===e&&(i.done=n);break;case oe.IF_BLOCK:case oe.IF_CHECK:i.type===e&&(i.skip=n);break;case oe.LINE:ko(i.stmts,e,n);break}}}function T_(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case oe.WHILE:case oe.REPEAT:case oe.FOREACH:case oe.ELSE_IF:i.type===e&&Gh(i.done,n);break;case oe.IF_BLOCK:case oe.IF_CHECK:i.type===e&&Gh(i.skip,n);break;case oe.LINE:T_(i.stmts,e,n);break}}}function Be(t){var e;switch(t.type){case oe.PROGRAM:return Ne(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(Be).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Ac}`]);case oe.API:return Ne(t,["  ",mt(t,t.method,xi(t.words)),`;
`]);case oe.LINE:return Ne(t,[`case ${t.lineindex}:
`,...t.stmts.map(Be).flat(),`  break;
`]);case oe.MARK:return Ne(t,`  // ${t.comment}
`);case oe.GOTO:{const n=Tr(t.id);return Ne(t,["  ",Tc(t,n),`
`])}case oe.COUNT:return Ne(t,`${t.index}`);case oe.LITERAL:switch(t.literal){case Sc.NUMBER:return Ne(t,`${t.value}`);case Sc.STRING:return Ne(t,Wh(t.value));case Sc.TEMPLATE:return Ne(t,xc(t.value))}return A_(t);case oe.TEXT:return Ne(t,["  ",mt(t,"text",[xc(t.value)]),`;
`]);case oe.STAT:if(en.isfirststat){en.isfirststat=!1;const n=t.value.trim().split(" ").map(Wh);return Ne(t,["  ",mt(t,"stat",n),`;
`])}return Ne(t,`  // skipped ${t.value}
`);case oe.LABEL:{const n=Pe(t.name),r=t.active?"label":"comment";en.labels[n]||(en.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return en.labels[n].push(i),Ne(t,`  // ${i} '${n}' ${r}
`)}case oe.HYPERLINK:return Ne(t,["  ",mt(t,"hyperlink",[xc(t.text),...xi(t.link)]),`;
`]);case oe.MOVE:{const n=mt(t,"command",[Wh("go"),xi(t.words)].flat());return t.wait?Ne(t,["  if (",n,`) { continue; };
`]):Ne(t,["  ",n,`;
`])}case oe.COMMAND:return Ne(t,["  ",mt(t,"command",xi(t.words)),`;
`]);case oe.IF:{const n=((e=t.block)==null?void 0:e.type)===oe.IF_BLOCK?t.block:void 0;if(k(n)){ko([t.check],oe.IF_CHECK,n.skip);const r=Ne(t,Be(t.check));return n.lines.forEach(i=>r.add(Be(i))),T_(n.altlines,oe.ELSE_IF,Tr(n.done)),n.altlines.forEach(i=>r.add(Be(i))),r}return Ne(t,Be(t.check))}case oe.IF_CHECK:{const n=Tr(t.skip);return n===-1?Ne(t,["  ",mt(t,t.method,xi(t.words)),`;
`]):Ne(t,["  if (!",mt(t,t.method,xi(t.words)),") { ",Tc(t,n),` }
`])}case oe.ELSE_IF:case oe.ELSE:{const n=Ne(t,"");return t.lines.forEach(r=>n.add(Be(r))),n}case oe.WHILE:{const n=Tr(t.loop),r=Tr(t.done),i=Ne(t,"");return ko(t.lines,oe.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case oe.BREAK:s.goto=r;break;case oe.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case oe.REPEAT:{const n=Tr(t.loop),r=Tr(t.done),i=Ne(t,"");return ko(t.lines,oe.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case oe.BREAK:s.goto=r;break;case oe.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case oe.WAITFOR:{const n=Ne(t,"");return n.add(["  if (!",mt(t,"if",xi(t.words)),`) { api.i(${t.lineindex-1}); }
`]),n}case oe.FOREACH:{const n=Tr(t.loop),r=Tr(t.done),i=Ne(t,"");return ko(t.lines,oe.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case oe.BREAK:s.goto=r;break;case oe.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case oe.BREAK:return Ne(t,["  ",Tc(t,t.goto),`
`]);case oe.CONTINUE:return Ne(t,["  ",Tc(t,t.goto),`
`]);case oe.OR:return mt(t,"or",t.items.map(Be));case oe.AND:return mt(t,"and",t.items.map(Be));case oe.NOT:return mt(t,"not",t.items.map(Be));case oe.COMPARE:return HL(t);case oe.OPERATOR:return KL(t);case oe.EXPR:return mt(t,"expr",t.words.map(Be));default:return console.error("<unsupported node>",t.type,t),A_(t)}}function ir(t){if(k(t))switch(t.type===oe.LINE&&++en.lineindex,t.lineindex=en.lineindex,t.type){case oe.PROGRAM:t.lines.forEach(ir);break;case oe.LINE:t.stmts.forEach(ir);break;case oe.MARK:Gh(t.id,t.lineindex);break;case oe.IF:ir(t.check),ir(t.block);break;case oe.IF_BLOCK:t.lines.forEach(ir),t.altlines.forEach(ir);break;case oe.ELSE_IF:t.lines.forEach(ir);break;case oe.ELSE:case oe.WHILE:case oe.REPEAT:case oe.FOREACH:t.lines.forEach(ir);break;case oe.MOVE:case oe.COMMAND:case oe.WAITFOR:case oe.IF_CHECK:t.words.forEach(ir);break}}function qL(t){return en.labels={},en.internal=1,en.lineindex=0,en.isfirststat=!0,ir(t),{...Be(t).toStringWithSourceMap({file:`${Ac}.map`}),...en}}function XL(t){return He(t)?t.length>0?1:0:t??0}function Ot(t){return`${t??""}`}function R_(t){return`${t}_chip`}function ZL(t,e,n){var c,l;const r=R_(t),i=ls(r);let s;He(i.lb)||(i.lb=ei(Object.entries(n.labels??{})),i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((c=n.errors)==null?void 0:c.length)??0)!==0?1:0);function o(u,h){C.words=h;const d=eL(e,u);return k(d)?d(a,h):u!=="send"?o("send",[u,...h]):0}const a={halt(){mM(r)},id(){return t},senderid(u=t){return`vm:${u??t}`},set(u,h){const[d,f]=nL(e,a,u,h);if(d)return f},get(u){const[h,d]=tL(e,a,u);if(h)return d},bucket(u){const h=a.get("bucket");He(h)?h.push(u):a.set("bucket",[u])},tick(u){const h=ve(i.ps)?i.ps:0,d=h%u===0;if(i.ps=h+1,d===!1)return!1;if(a.shouldtick()===!1)return r_(e,a),!1;i.lc=0,i.ys=0,C.get=a.get,rL(e,a);try{const f=s==null?void 0:s.next();f!=null&&f.done&&(et("chip","crash","generator logic unexpectedly exited"),i.es=1)}catch(f){et("chip","crash",f.message),i.es=1}return r_(e,a),!0},isended(){return i.es===1},shouldtick(){return i.es===0||a.hm()!==0},shouldhalt(){return ve(i.lc)?++i.lc>Gi.HALT_AT_COUNT:!0},hm(){if(He(i.mg)&&He(i.lb)){const[,u]=i.mg;if(k(u))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===u)return f.find(p=>ve(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(u){i.ec=u},sy(){return!!i.ys||a.shouldhalt()},emit(u,h,d){Ae.emit(u,a.senderid(),h,d)},send(u,h,d,f){Ae.emit(`${a.senderid(u)}:${h}`,t,d,f)},lock(u){i.lk=u},unlock(){i.lk=""},message(u){i.lk&&u.sender!==i.lk||(i.mg=[u.id,u.target,u.data,u.sender,u.player])},zap(u){if(He(i.lb))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===u){const p=f.findIndex(m=>m>0);p>=0&&(f[p]*=-1)}}},restore(u){if(He(i.lb))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===u)for(let p=0;p<f.length;p++)f[h]=Math.abs(f[h])}},getcase(){i.ec=ve(i.ec)?i.ec:1;const u=a.hm();if(u&&He(i.mg)){const[,,h,d,f]=i.mg;a.set("sender",d),k(h)&&a.set("arg",h),f&&a.set("player",f),i.mg=void 0,i.ys=0,i.es=0,i.ec=u}return i.ec},nextcase(){const u=ve(i.ec)?i.ec:1;return i.ec=u+1,i.ec},endofprogram(){a.yield(),i.es=1},stacktrace(u){const h=Wk.parse(u),[d]=h.filter(f=>f.fileName===Ac);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(u){return o("text",[u])},stat(...u){return o("stat",u)},hyperlink(...u){return o("hyperlink",u)},command(...u){if(u.length===0)return 0;const[h,...d]=u;return o(Ot(h),d)},if(...u){const[h,d]=re(u,0,[q.ANY]),f=XL(h);return f&&d<u.length&&a.command(...u.slice(d)),f?1:0},repeatstart(u,...h){const[d,f]=re(h,0,[q.NUMBER]),p=`repeatcount${u}`,m=`repeatwords${u}`;i[p]=d,i[m]=f<h.length?h.slice(f):void 0},repeat(u){const h=`repeatcount${u}`,d=`repeatwords${u}`;if(!ve(i[h]))return 0;const f=i[h];i[h]=f-1;const p=f>0,m=i[d];return p&&He(m)&&a.command(...m),p?1:0},foreachstart(u,...h){const[d,f,p,m]=re(h,0,[q.STRING,q.NUMBER,q.NUMBER,q.MAYBE_NUMBER]);let b=Math.min(f,p),_=Math.max(f,p);const w=(m??0)||1;if(w<0){const v=b;b=_,_=v}return a.set(d,b-w),0},foreach(u,...h){const[d,f,p,m,b]=re(h,0,[q.STRING,q.NUMBER,q.NUMBER,q.MAYBE_NUMBER]);let _=Math.min(f,p),w=Math.max(f,p);const v=(m??0)||1;if(v<0){const x=_;_=w,w=x}let A=a.get(d);!ve(A)||A<_||A>w?A=_:A+=v;const O=A<=w?1:0;return O&&(a.set(d,A),b<h.length&&a.command(...h.slice(b))),O},or(...u){let h=0;for(let d=0;d<u.length;){const[f,p]=re(u,d,[q.ANY]);if(h=f,h)break;d=p}return h},and(...u){let h=0;for(let d=0;d<u.length;){const[f,p]=re(u,d,[q.ANY]);if(h=f,!h)break;d=p}return h},not(...u){const[h]=re(u,0,[q.ANY]);return h?0:1},expr(...u){const[h]=re(u,0,[q.ANY]);return h},isEq(u,h){const[d]=re([u],0,[q.ANY]),[f]=re([h],0,[q.ANY]);return typeof d=="object"||typeof f=="object"?Ob(d,f)?1:0:d===f?1:0},isNotEq(u,h){return this.isEq(u,h)?0:1},isLessThan(u,h){const[d]=re([u],0,[q.NUMBER]),[f]=re([h],0,[q.NUMBER]);return d<f?1:0},isGreaterThan(u,h){const[d]=re([u],0,[q.NUMBER]),[f]=re([h],0,[q.NUMBER]);return d>f?1:0},isLessThanOrEq(u,h){const[d]=re([u],0,[q.NUMBER]),[f]=re([h],0,[q.NUMBER]);return d<=f?1:0},isGreaterThanOrEq(u,h){const[d]=re([u],0,[q.NUMBER]),[f]=re([h],0,[q.NUMBER]);return d>=f?1:0},opPlus(u,h){const[d]=re([u],0,[q.ANY]),[f]=re([h],0,[q.ANY]);return d+f},opMinus(u,h){const[d]=re([u],0,[q.ANY]),[f]=re([h],0,[q.ANY]);return d-f},opPower(u,h){const[d]=re([u],0,[q.NUMBER]),[f]=re([h],0,[q.NUMBER]);return Math.pow(d,f)},opMultiply(u,h){const[d]=re([u],0,[q.NUMBER]),[f]=re([h],0,[q.NUMBER]);return d*f},opDivide(u,h){const[d]=re([u],0,[q.NUMBER]),[f]=re([h],0,[q.NUMBER]);return d/f},opModDivide(u,h){const[d]=re([u],0,[q.NUMBER]),[f]=re([h],0,[q.NUMBER]);return d%f},opFloorDivide(u,h){const[d]=re([u],0,[q.NUMBER]),[f]=re([h],0,[q.NUMBER]);return Math.floor(d/f)},opUniPlus(u){const[h]=re([u],0,[q.NUMBER]);return+h},opUniMinus(u){const[h]=re([u],0,[q.NUMBER]);return-h}};return s=(l=n.code)==null?void 0:l.call(n,a),a}function Rc(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var I_={exports:{}};/*!

  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>

  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  */(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var h=typeof Rc=="function"&&Rc;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[l]={exports:{}};r[l][0].call(f.exports,function(p){var m=r[l][1][p];return o(m||p)},f,f.exports,n,r,i,s)}return i[l].exports}for(var a=typeof Rc=="function"&&Rc,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,d,f,p,m,b=[],_=0,w=c.length,v=w,A=s.getTypeOf(c)!=="string";_<c.length;)v=w-_,h=A?(l=c[_++],u=_<w?c[_++]:0,_<w?c[_++]:0):(l=c.charCodeAt(_++),u=_<w?c.charCodeAt(_++):0,_<w?c.charCodeAt(_++):0),d=l>>2,f=(3&l)<<4|u>>4,p=1<v?(15&u)<<2|h>>6:64,m=2<v?63&h:64,b.push(a.charAt(d)+a.charAt(f)+a.charAt(p)+a.charAt(m));return b.join("")},i.decode=function(c){var l,u,h,d,f,p,m=0,b=0,_="data:";if(c.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var w,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&v--,c.charAt(c.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=o.uint8array?new Uint8Array(0|v):new Array(0|v);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(f=a.indexOf(c.charAt(m++)))>>2,h=(3&f)<<6|(p=a.indexOf(c.charAt(m++))),w[b++]=l,f!==64&&(w[b++]=u),p!==64&&(w[b++]=h);return w}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,h,d,f,p){this.compressedSize=u,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(f,p){var m,b="";for(m=0;m<p;m++)b+=String.fromCharCode(255&f),f>>>=8;return b}function o(f,p,m,b,_,w){var v,A,O=f.file,x=f.compression,R=w!==l.utf8encode,$=a.transformTo("string",w(O.name)),L=a.transformTo("string",l.utf8encode(O.name)),V=O.comment,Y=a.transformTo("string",w(V)),I=a.transformTo("string",l.utf8encode(V)),E=L.length!==O.name.length,g=I.length!==V.length,N="",j="",U="",Q=O.dir,H=O.date,J={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(J.crc32=f.crc32,J.compressedSize=f.compressedSize,J.uncompressedSize=f.uncompressedSize);var F=0;p&&(F|=8),R||!E&&!g||(F|=2048);var D=0,ae=0;Q&&(D|=16),_==="UNIX"?(ae=798,D|=function(te,we){var je=te;return te||(je=we?16893:33204),(65535&je)<<16}(O.unixPermissions,Q)):(ae=20,D|=function(te){return 63&(te||0)}(O.dosPermissions)),v=H.getUTCHours(),v<<=6,v|=H.getUTCMinutes(),v<<=5,v|=H.getUTCSeconds()/2,A=H.getUTCFullYear()-1980,A<<=4,A|=H.getUTCMonth()+1,A<<=5,A|=H.getUTCDate(),E&&(j=s(1,1)+s(u($),4)+L,N+="up"+s(j.length,2)+j),g&&(U=s(1,1)+s(u(Y),4)+I,N+="uc"+s(U.length,2)+U);var ee="";return ee+=`
\0`,ee+=s(F,2),ee+=x.magic,ee+=s(v,2),ee+=s(A,2),ee+=s(J.crc32,4),ee+=s(J.compressedSize,4),ee+=s(J.uncompressedSize,4),ee+=s($.length,2),ee+=s(N.length,2),{fileRecord:h.LOCAL_FILE_HEADER+ee+$+N,dirRecord:h.CENTRAL_FILE_HEADER+s(ae,2)+ee+s(Y.length,2)+"\0\0\0\0"+s(D,4)+s(b,4)+$+N+Y}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),h=n("../signature");function d(f,p,m,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var p=f.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-b-1))/m:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var p=this.streamFiles&&!f.file.dir;if(p){var m=o(f,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var p=this.streamFiles&&!f.file.dir,m=o(f,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(b){return h.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-f,b=function(_,w,v,A,O){var x=a.transformTo("string",O(A));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(_,2)+s(_,2)+s(w,4)+s(v,4)+s(x.length,2)+x}(this.dirRecords.length,m,f,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var p=this;return f.on("data",function(m){p.processChunk(m)}),f.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),f.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var p=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var m=0;m<p.length;m++)try{p[m].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,p=0;p<f.length;p++)f[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var p=function(w,v){var A=w||v,O=s[A];if(!O)throw new Error(A+" is not a valid compression method !");return O}(f.options.compression,c.compression),m=f.options.compressionOptions||c.compressionOptions||{},b=f.dir,_=f.date;f._compressWorker(p,m).withStreamInfo("file",{name:d,dir:b,date:_,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function h(d){return new o.Promise(function(f,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(b){p(b)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(d,f){var p=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(m){var b=new c(f);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],_=m.files;if(f.checkCRC32)for(var w=0;w<_.length;w++)b.push(h(_[w]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),_=b.files,w=0;w<_.length;w++){var v=_[w],A=v.fileNameStr,O=s.resolve(v.fileNameStr);p.file(O,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:f.createFolders}),v.dir||(p.file(O).unsafeOriginalName=A)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,d){u.push(h)||u._helper.pause(),l&&l(d)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,o)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var o=new Buffer(s);return o.fill(0),o},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(O,x,R){var $,L=a.getTypeOf(x),V=a.extend(R||{},u);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(O=_(O)),V.createFolders&&($=b(O))&&w.call(this,$,!0);var Y=L==="string"&&V.binary===!1&&V.base64===!1;R&&R.binary!==void 0||(V.binary=!Y),(x instanceof h&&x.uncompressedSize===0||V.dir||!x||x.length===0)&&(V.base64=!1,V.binary=!0,x="",V.compression="STORE",L="string");var I=null;I=x instanceof h||x instanceof c?x:p.isNode&&p.isStream(x)?new m(O,x):a.prepareContent(O,x,V.binary,V.optimizedBinaryString,V.base64);var E=new d(O,I,V);this.files[O]=E}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),h=n("./compressedObject"),d=n("./zipObject"),f=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),b=function(O){O.slice(-1)==="/"&&(O=O.substring(0,O.length-1));var x=O.lastIndexOf("/");return 0<x?O.substring(0,x):""},_=function(O){return O.slice(-1)!=="/"&&(O+="/"),O},w=function(O,x){return x=x!==void 0?x:u.createFolders,O=_(O),this.files[O]||s.call(this,O,null,{dir:!0,createFolders:x}),this.files[O]};function v(O){return Object.prototype.toString.call(O)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(O){var x,R,$;for(x in this.files)$=this.files[x],(R=x.slice(this.root.length,x.length))&&x.slice(0,this.root.length)===this.root&&O(R,$)},filter:function(O){var x=[];return this.forEach(function(R,$){O(R,$)&&x.push($)}),x},file:function(O,x,R){if(arguments.length!==1)return O=this.root+O,s.call(this,O,x,R),this;if(v(O)){var $=O;return this.filter(function(V,Y){return!Y.dir&&$.test(V)})}var L=this.files[this.root+O];return L&&!L.dir?L:null},folder:function(O){if(!O)return this;if(v(O))return this.filter(function(L,V){return V.dir&&O.test(L)});var x=this.root+O,R=w.call(this,x),$=this.clone();return $.root=R.name,$},remove:function(O){O=this.root+O;var x=this.files[O];if(x||(O.slice(-1)!=="/"&&(O+="/"),x=this.files[O]),x&&!x.dir)delete this.files[O];else for(var R=this.filter(function(L,V){return V.name.slice(0,O.length)===O}),$=0;$<R.length;$++)delete this.files[R[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(O){var x,R={};try{if((R=a.extend(O||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");a.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var $=R.comment||this.comment||"";x=f.generateWorker(this,R,$)}catch(L){(x=new c("error")).error(L)}return new l(x,R.type||"string",R.mimeType)},generateAsync:function(O,x){return this.generateInternalStream(O).accumulate(x)},generateNodeStream:function(O,x){return(O=O||{}).type||(O.type="nodebuffer"),this.generateInternalStream(O).toNodejsStream(x)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),h=null;if(l.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(b,_){var w=[],v=p._internalType,A=p._outputType,O=p._mimeType;p.on("data",function(x,R){w.push(x),m&&m(R)}).on("error",function(x){w=[],_(x)}).on("end",function(){try{var x=function(R,$,L){switch(R){case"blob":return s.newBlob(s.transformTo("arraybuffer",$),L);case"base64":return c.encode($);default:return s.transformTo(R,$)}}(A,function(R,$){var L,V=0,Y=null,I=0;for(L=0;L<$.length;L++)I+=$[L].length;switch(R){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(Y=new Uint8Array(I),L=0;L<$.length;L++)Y.set($[L],V),V+=$[L].length;return Y;case"nodebuffer":return Buffer.concat($);default:throw new Error("concat : unsupported type '"+R+"'")}}(v,w),O);b(x)}catch(R){_(R)}w=[]}).resume()})}function f(p,m,b){var _=m;switch(m){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=m,this._mimeType=b,s.checkSupport(_),this._worker=p.pipe(new o(_)),p.lock()}catch(w){this._worker=new a("error"),this._worker.error(w)}}f.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var b=this;return p==="data"?this._worker.on(p,function(_){m.call(b,_.data,_.meta)}):this._worker.on(p,function(){s.delay(m,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(p){var m,b,_,w,v,A=p.length,O=0;for(w=0;w<A;w++)(64512&(b=p.charCodeAt(w)))==55296&&w+1<A&&(64512&(_=p.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),w++),O+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(O):new Array(O),w=v=0;v<O;w++)(64512&(b=p.charCodeAt(w)))==55296&&w+1<A&&(64512&(_=p.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),w++),b<128?m[v++]=b:(b<2048?m[v++]=192|b>>>6:(b<65536?m[v++]=224|b>>>12:(m[v++]=240|b>>>18,m[v++]=128|b>>>12&63),m[v++]=128|b>>>6&63),m[v++]=128|63&b);return m}(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(p){var m,b,_,w,v=p.length,A=new Array(2*v);for(m=b=0;m<v;)if((_=p[m++])<128)A[b++]=_;else if(4<(w=l[_]))A[b++]=65533,m+=w-1;else{for(_&=w===2?31:w===3?15:7;1<w&&m<v;)_=_<<6|63&p[m++],w--;1<w?A[b++]=65533:_<65536?A[b++]=_:(_-=65536,A[b++]=55296|_>>10&1023,A[b++]=56320|1023&_)}return A.length!==b&&(A.subarray?A=A.subarray(0,b):A.length=b),s.applyFromCharCode(A)}(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var p=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(w,v){var A;for((v=v||w.length)>w.length&&(v=w.length),A=v-1;0<=A&&(192&w[A])==128;)A--;return A<0||A===0?v:A+l[w[A]]>v?A:v}(p),_=p;b!==p.length&&(o.uint8array?(_=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(_=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:i.utf8decode(_),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,b){for(var _=0;_<m.length;++_)b[_]=255&m.charCodeAt(_);return b}n("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(m),_.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,b,_){var w=[],v=0,A=m.length;if(A<=_)return String.fromCharCode.apply(null,m);for(;v<A;)b==="array"||b==="nodebuffer"?w.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+_,A)))):w.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+_,A)))),v+=_;return w.join("")},stringifyByChar:function(m){for(var b="",_=0;_<m.length;_++)b+=String.fromCharCode(m[_]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var b=65536,_=i.getTypeOf(m),w=!0;if(_==="uint8array"?w=h.applyCanBeUsed.uint8array:_==="nodebuffer"&&(w=h.applyCanBeUsed.nodebuffer),w)for(;1<b;)try{return h.stringifyByChunk(m,_,b)}catch{b=Math.floor(b/2)}return h.stringifyByChar(m)}function f(m,b){for(var _=0;_<m.length;_++)b[_]=m[_];return b}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return f(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return f(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var _=i.getTypeOf(b);return p[_][m](b)},i.resolve=function(m){for(var b=m.split("/"),_=[],w=0;w<b.length;w++){var v=b[w];v==="."||v===""&&w!==0&&w!==b.length-1||(v===".."?_.pop():_.push(v))}return _.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,_,w="";for(_=0;_<(m||"").length;_++)w+="\\x"+((b=m.charCodeAt(_))<16?"0":"")+b.toString(16).toUpperCase();return w},i.delay=function(m,b,_){setImmediate(function(){m.apply(_||null,b||[])})},i.inherits=function(m,b){function _(){}_.prototype=b.prototype,m.prototype=new _},i.extend=function(){var m,b,_={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&_[b]===void 0&&(_[b]=arguments[m][b]);return _},i.prepareContent=function(m,b,_,w,v){return c.Promise.resolve(b).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(O,x){var R=new FileReader;R.onload=function($){O($.target.result)},R.onerror=function($){x($.target.error)},R.readAsArrayBuffer(A)}):A}).then(function(A){var O=i.getTypeOf(A);return O?(O==="arraybuffer"?A=i.transformTo("uint8array",A):O==="string"&&(v?A=o.decode(A):_&&w!==!0&&(A=function(x){return u(x,s.uint8array?new Uint8Array(x.length):new Array(x.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===d;return this.reader.setIndex(f),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var p=d-f;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),h=n("./support");function d(f,p){this.options=f,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var p,m;if(f.skip(22),this.fileNameLength=f.readInt(2),m=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var _ in u)if(Object.prototype.hasOwnProperty.call(u,_)&&u[_].magic===b)return u[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var p=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(p),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var p,m,b,_=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<_;)p=f.readInt(2),m=f.readInt(2),b=f.readData(m),this.extraFields[p]={id:p,length:m,value:b};f.setIndex(_)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var _=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,b="string";try{if(!p)throw new Error("No output type specified.");var _=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var w=!this._dataBinary;w&&!_&&(m=m.pipe(new c.Utf8EncodeWorker)),!w&&_&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(v){(m=new u("error")).error(v)}return new o(m,b,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var f=[];function p(){var m,b;a=!0;for(var _=f.length;_;){for(b=f,f=[],m=-1;++m<_;)b[m]();_=f.length}a=!1}r.exports=function(m){f.push(m)!==1||a||o()}}).call(this,typeof Pt<"u"?Pt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,_!==o&&m(this,_)}function d(_,w,v){this.promise=_,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function f(_,w,v){s(function(){var A;try{A=w(v)}catch(O){return a.reject(_,O)}A===_?a.reject(_,new TypeError("Cannot resolve promise with itself")):a.resolve(_,A)})}function p(_){var w=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof w=="function")return function(){w.apply(_,arguments)}}function m(_,w){var v=!1;function A(R){v||(v=!0,a.reject(_,R))}function O(R){v||(v=!0,a.resolve(_,R))}var x=b(function(){w(O,A)});x.status==="error"&&A(x.value)}function b(_,w){var v={};try{v.value=_(w),v.status="success"}catch(A){v.status="error",v.value=A}return v}(r.exports=h).prototype.finally=function(_){if(typeof _!="function")return this;var w=this.constructor;return this.then(function(v){return w.resolve(_()).then(function(){return v})},function(v){return w.resolve(_()).then(function(){throw v})})},h.prototype.catch=function(_){return this.then(null,_)},h.prototype.then=function(_,w){if(typeof _!="function"&&this.state===l||typeof w!="function"&&this.state===c)return this;var v=new this.constructor(o);return this.state!==u?f(v,this.state===l?_:w,this.outcome):this.queue.push(new d(v,_,w)),v},d.prototype.callFulfilled=function(_){a.resolve(this.promise,_)},d.prototype.otherCallFulfilled=function(_){f(this.promise,this.onFulfilled,_)},d.prototype.callRejected=function(_){a.reject(this.promise,_)},d.prototype.otherCallRejected=function(_){f(this.promise,this.onRejected,_)},a.resolve=function(_,w){var v=b(p,w);if(v.status==="error")return a.reject(_,v.value);var A=v.value;if(A)m(_,A);else{_.state=l,_.outcome=w;for(var O=-1,x=_.queue.length;++O<x;)_.queue[O].callFulfilled(w)}return _},a.reject=function(_,w){_.state=c,_.outcome=w;for(var v=-1,A=_.queue.length;++v<A;)_.queue[v].callRejected(w);return _},h.resolve=function(_){return _ instanceof this?_:a.resolve(new this(o),_)},h.reject=function(_){var w=new this(o);return a.reject(w,_)},h.all=function(_){var w=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=_.length,A=!1;if(!v)return this.resolve([]);for(var O=new Array(v),x=0,R=-1,$=new this(o);++R<v;)L(_[R],R);return $;function L(V,Y){w.resolve(V).then(function(I){O[Y]=I,++x!==v||A||(A=!0,a.resolve($,O))},function(I){A||(A=!0,a.reject($,I))})}},h.race=function(_){var w=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=_.length,A=!1;if(!v)return this.resolve([]);for(var O=-1,x=new this(o);++O<v;)R=_[O],w.resolve(R).then(function($){A||(A=!0,a.resolve(x,$))},function($){A||(A=!0,a.reject(x,$))});var R;return x}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,h=0,d=-1,f=0,p=8;function m(_){if(!(this instanceof m))return new m(_);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},_||{});var w=this.options;w.raw&&0<w.windowBits?w.windowBits=-w.windowBits:w.gzip&&0<w.windowBits&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(v!==h)throw new Error(c[v]);if(w.header&&s.deflateSetHeader(this.strm,w.header),w.dictionary){var A;if(A=typeof w.dictionary=="string"?a.string2buf(w.dictionary):u.call(w.dictionary)==="[object ArrayBuffer]"?new Uint8Array(w.dictionary):w.dictionary,(v=s.deflateSetDictionary(this.strm,A))!==h)throw new Error(c[v]);this._dict_set=!0}}function b(_,w){var v=new m(w);if(v.push(_,!0),v.err)throw v.msg||c[v.err];return v.result}m.prototype.push=function(_,w){var v,A,O=this.strm,x=this.options.chunkSize;if(this.ended)return!1;A=w===~~w?w:w===!0?4:0,typeof _=="string"?O.input=a.string2buf(_):u.call(_)==="[object ArrayBuffer]"?O.input=new Uint8Array(_):O.input=_,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new o.Buf8(x),O.next_out=0,O.avail_out=x),(v=s.deflate(O,A))!==1&&v!==h)return this.onEnd(v),!(this.ended=!0);O.avail_out!==0&&(O.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(O.output,O.next_out))):this.onData(o.shrinkBuf(O.output,O.next_out)))}while((0<O.avail_in||O.avail_out===0)&&v!==1);return A===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===h):A!==2||(this.onEnd(h),!(O.avail_out=0))},m.prototype.onData=function(_){this.chunks.push(_)},m.prototype.onEnd=function(_){_===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(_,w){return(w=w||{}).raw=!0,b(_,w)},i.gzip=function(_,w){return(w=w||{}).gzip=!0,b(_,w)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),h=n("./zlib/gzheader"),d=Object.prototype.toString;function f(m){if(!(this instanceof f))return new f(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var _=s.inflateInit2(this.strm,b.windowBits);if(_!==c.Z_OK)throw new Error(l[_]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,b){var _=new f(b);if(_.push(m,!0),_.err)throw _.msg||l[_.err];return _.result}f.prototype.push=function(m,b){var _,w,v,A,O,x,R=this.strm,$=this.options.chunkSize,L=this.options.dictionary,V=!1;if(this.ended)return!1;w=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?R.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?R.input=new Uint8Array(m):R.input=m,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8($),R.next_out=0,R.avail_out=$),(_=s.inflate(R,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&L&&(x=typeof L=="string"?a.string2buf(L):d.call(L)==="[object ArrayBuffer]"?new Uint8Array(L):L,_=s.inflateSetDictionary(this.strm,x)),_===c.Z_BUF_ERROR&&V===!0&&(_=c.Z_OK,V=!1),_!==c.Z_STREAM_END&&_!==c.Z_OK)return this.onEnd(_),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&_!==c.Z_STREAM_END&&(R.avail_in!==0||w!==c.Z_FINISH&&w!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(R.output,R.next_out),A=R.next_out-v,O=a.buf2string(R.output,v),R.next_out=A,R.avail_out=$-A,A&&o.arraySet(R.output,R.output,v,A,0),this.onData(O)):this.onData(o.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(V=!0)}while((0<R.avail_in||R.avail_out===0)&&_!==c.Z_STREAM_END);return _===c.Z_STREAM_END&&(w=c.Z_FINISH),w===c.Z_FINISH?(_=s.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===c.Z_OK):w!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(R.avail_out=0))},f.prototype.onData=function(m){this.chunks.push(m)},f.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=f,i.inflate=p,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,p(m,b)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),d);else for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){var l,u,h,d,f,p;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(p=new Uint8Array(h),l=d=0,u=c.length;l<u;l++)f=c[l],p.set(f,d),d+=f.length;return p}},a={arraySet:function(c,l,u,h,d){for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",p=0;p<d;p++)f+=String.fromCharCode(h[p]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,p,m,b,_=h.length,w=0;for(m=0;m<_;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),w+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(w),m=b=0;b<w;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),f<128?d[b++]=f:(f<2048?d[b++]=192|f>>>6:(f<65536?d[b++]=224|f>>>12:(d[b++]=240|f>>>18,d[b++]=128|f>>>12&63),d[b++]=128|f>>>6&63),d[b++]=128|63&f);return d},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,p=d.length;f<p;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,p,m,b,_=d||h.length,w=new Array(2*_);for(f=p=0;f<_;)if((m=h[f++])<128)w[p++]=m;else if(4<(b=c[m]))w[p++]=65533,f+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&f<_;)m=m<<6|63&h[f++],b--;1<b?w[p++]=65533:m<65536?w[p++]=m:(m-=65536,w[p++]=55296|m>>10&1023,w[p++]=56320|1023&m)}return u(w,p)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var d=l;d<h;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),h=0,d=4,f=0,p=-2,m=-1,b=4,_=2,w=8,v=9,A=286,O=30,x=19,R=2*A+1,$=15,L=3,V=258,Y=V+L+1,I=42,E=113,g=1,N=2,j=3,U=4;function Q(y,K){return y.msg=u[K],K}function H(y){return(y<<1)-(4<y?9:0)}function J(y){for(var K=y.length;0<=--K;)y[K]=0}function F(y){var K=y.state,G=K.pending;G>y.avail_out&&(G=y.avail_out),G!==0&&(o.arraySet(y.output,K.pending_buf,K.pending_out,G,y.next_out),y.next_out+=G,K.pending_out+=G,y.total_out+=G,y.avail_out-=G,K.pending-=G,K.pending===0&&(K.pending_out=0))}function D(y,K){a._tr_flush_block(y,0<=y.block_start?y.block_start:-1,y.strstart-y.block_start,K),y.block_start=y.strstart,F(y.strm)}function ae(y,K){y.pending_buf[y.pending++]=K}function ee(y,K){y.pending_buf[y.pending++]=K>>>8&255,y.pending_buf[y.pending++]=255&K}function te(y,K){var G,T,S=y.max_chain_length,B=y.strstart,X=y.prev_length,Z=y.nice_match,W=y.strstart>y.w_size-Y?y.strstart-(y.w_size-Y):0,ne=y.window,ue=y.w_mask,ie=y.prev,de=y.strstart+V,Je=ne[B+X-1],Ue=ne[B+X];y.prev_length>=y.good_match&&(S>>=2),Z>y.lookahead&&(Z=y.lookahead);do if(ne[(G=K)+X]===Ue&&ne[G+X-1]===Je&&ne[G]===ne[B]&&ne[++G]===ne[B+1]){B+=2,G++;do;while(ne[++B]===ne[++G]&&ne[++B]===ne[++G]&&ne[++B]===ne[++G]&&ne[++B]===ne[++G]&&ne[++B]===ne[++G]&&ne[++B]===ne[++G]&&ne[++B]===ne[++G]&&ne[++B]===ne[++G]&&B<de);if(T=V-(de-B),B=de-V,X<T){if(y.match_start=K,Z<=(X=T))break;Je=ne[B+X-1],Ue=ne[B+X]}}while((K=ie[K&ue])>W&&--S!=0);return X<=y.lookahead?X:y.lookahead}function we(y){var K,G,T,S,B,X,Z,W,ne,ue,ie=y.w_size;do{if(S=y.window_size-y.lookahead-y.strstart,y.strstart>=ie+(ie-Y)){for(o.arraySet(y.window,y.window,ie,ie,0),y.match_start-=ie,y.strstart-=ie,y.block_start-=ie,K=G=y.hash_size;T=y.head[--K],y.head[K]=ie<=T?T-ie:0,--G;);for(K=G=ie;T=y.prev[--K],y.prev[K]=ie<=T?T-ie:0,--G;);S+=ie}if(y.strm.avail_in===0)break;if(X=y.strm,Z=y.window,W=y.strstart+y.lookahead,ne=S,ue=void 0,ue=X.avail_in,ne<ue&&(ue=ne),G=ue===0?0:(X.avail_in-=ue,o.arraySet(Z,X.input,X.next_in,ue,W),X.state.wrap===1?X.adler=c(X.adler,Z,ue,W):X.state.wrap===2&&(X.adler=l(X.adler,Z,ue,W)),X.next_in+=ue,X.total_in+=ue,ue),y.lookahead+=G,y.lookahead+y.insert>=L)for(B=y.strstart-y.insert,y.ins_h=y.window[B],y.ins_h=(y.ins_h<<y.hash_shift^y.window[B+1])&y.hash_mask;y.insert&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[B+L-1])&y.hash_mask,y.prev[B&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=B,B++,y.insert--,!(y.lookahead+y.insert<L)););}while(y.lookahead<Y&&y.strm.avail_in!==0)}function je(y,K){for(var G,T;;){if(y.lookahead<Y){if(we(y),y.lookahead<Y&&K===h)return g;if(y.lookahead===0)break}if(G=0,y.lookahead>=L&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),G!==0&&y.strstart-G<=y.w_size-Y&&(y.match_length=te(y,G)),y.match_length>=L)if(T=a._tr_tally(y,y.strstart-y.match_start,y.match_length-L),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=L){for(y.match_length--;y.strstart++,y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart,--y.match_length!=0;);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+1])&y.hash_mask;else T=a._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(T&&(D(y,!1),y.strm.avail_out===0))return g}return y.insert=y.strstart<L-1?y.strstart:L-1,K===d?(D(y,!0),y.strm.avail_out===0?j:U):y.last_lit&&(D(y,!1),y.strm.avail_out===0)?g:N}function be(y,K){for(var G,T,S;;){if(y.lookahead<Y){if(we(y),y.lookahead<Y&&K===h)return g;if(y.lookahead===0)break}if(G=0,y.lookahead>=L&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=L-1,G!==0&&y.prev_length<y.max_lazy_match&&y.strstart-G<=y.w_size-Y&&(y.match_length=te(y,G),y.match_length<=5&&(y.strategy===1||y.match_length===L&&4096<y.strstart-y.match_start)&&(y.match_length=L-1)),y.prev_length>=L&&y.match_length<=y.prev_length){for(S=y.strstart+y.lookahead-L,T=a._tr_tally(y,y.strstart-1-y.prev_match,y.prev_length-L),y.lookahead-=y.prev_length-1,y.prev_length-=2;++y.strstart<=S&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),--y.prev_length!=0;);if(y.match_available=0,y.match_length=L-1,y.strstart++,T&&(D(y,!1),y.strm.avail_out===0))return g}else if(y.match_available){if((T=a._tr_tally(y,0,y.window[y.strstart-1]))&&D(y,!1),y.strstart++,y.lookahead--,y.strm.avail_out===0)return g}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(T=a._tr_tally(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<L-1?y.strstart:L-1,K===d?(D(y,!0),y.strm.avail_out===0?j:U):y.last_lit&&(D(y,!1),y.strm.avail_out===0)?g:N}function _e(y,K,G,T,S){this.good_length=y,this.max_lazy=K,this.nice_length=G,this.max_chain=T,this.func=S}function We(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*R),this.dyn_dtree=new o.Buf16(2*(2*O+1)),this.bl_tree=new o.Buf16(2*(2*x+1)),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16($+1),this.heap=new o.Buf16(2*A+1),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function $e(y){var K;return y&&y.state?(y.total_in=y.total_out=0,y.data_type=_,(K=y.state).pending=0,K.pending_out=0,K.wrap<0&&(K.wrap=-K.wrap),K.status=K.wrap?I:E,y.adler=K.wrap===2?0:1,K.last_flush=h,a._tr_init(K),f):Q(y,p)}function gt(y){var K=$e(y);return K===f&&function(G){G.window_size=2*G.w_size,J(G.head),G.max_lazy_match=s[G.level].max_lazy,G.good_match=s[G.level].good_length,G.nice_match=s[G.level].nice_length,G.max_chain_length=s[G.level].max_chain,G.strstart=0,G.block_start=0,G.lookahead=0,G.insert=0,G.match_length=G.prev_length=L-1,G.match_available=0,G.ins_h=0}(y.state),K}function kt(y,K,G,T,S,B){if(!y)return p;var X=1;if(K===m&&(K=6),T<0?(X=0,T=-T):15<T&&(X=2,T-=16),S<1||v<S||G!==w||T<8||15<T||K<0||9<K||B<0||b<B)return Q(y,p);T===8&&(T=9);var Z=new We;return(y.state=Z).strm=y,Z.wrap=X,Z.gzhead=null,Z.w_bits=T,Z.w_size=1<<Z.w_bits,Z.w_mask=Z.w_size-1,Z.hash_bits=S+7,Z.hash_size=1<<Z.hash_bits,Z.hash_mask=Z.hash_size-1,Z.hash_shift=~~((Z.hash_bits+L-1)/L),Z.window=new o.Buf8(2*Z.w_size),Z.head=new o.Buf16(Z.hash_size),Z.prev=new o.Buf16(Z.w_size),Z.lit_bufsize=1<<S+6,Z.pending_buf_size=4*Z.lit_bufsize,Z.pending_buf=new o.Buf8(Z.pending_buf_size),Z.d_buf=1*Z.lit_bufsize,Z.l_buf=3*Z.lit_bufsize,Z.level=K,Z.strategy=B,Z.method=G,gt(y)}s=[new _e(0,0,0,0,function(y,K){var G=65535;for(G>y.pending_buf_size-5&&(G=y.pending_buf_size-5);;){if(y.lookahead<=1){if(we(y),y.lookahead===0&&K===h)return g;if(y.lookahead===0)break}y.strstart+=y.lookahead,y.lookahead=0;var T=y.block_start+G;if((y.strstart===0||y.strstart>=T)&&(y.lookahead=y.strstart-T,y.strstart=T,D(y,!1),y.strm.avail_out===0)||y.strstart-y.block_start>=y.w_size-Y&&(D(y,!1),y.strm.avail_out===0))return g}return y.insert=0,K===d?(D(y,!0),y.strm.avail_out===0?j:U):(y.strstart>y.block_start&&(D(y,!1),y.strm.avail_out),g)}),new _e(4,4,8,4,je),new _e(4,5,16,8,je),new _e(4,6,32,32,je),new _e(4,4,16,16,be),new _e(8,16,32,32,be),new _e(8,16,128,128,be),new _e(8,32,128,256,be),new _e(32,128,258,1024,be),new _e(32,258,258,4096,be)],i.deflateInit=function(y,K){return kt(y,K,w,15,8,0)},i.deflateInit2=kt,i.deflateReset=gt,i.deflateResetKeep=$e,i.deflateSetHeader=function(y,K){return y&&y.state?y.state.wrap!==2?p:(y.state.gzhead=K,f):p},i.deflate=function(y,K){var G,T,S,B;if(!y||!y.state||5<K||K<0)return y?Q(y,p):p;if(T=y.state,!y.output||!y.input&&y.avail_in!==0||T.status===666&&K!==d)return Q(y,y.avail_out===0?-5:p);if(T.strm=y,G=T.last_flush,T.last_flush=K,T.status===I)if(T.wrap===2)y.adler=0,ae(T,31),ae(T,139),ae(T,8),T.gzhead?(ae(T,(T.gzhead.text?1:0)+(T.gzhead.hcrc?2:0)+(T.gzhead.extra?4:0)+(T.gzhead.name?8:0)+(T.gzhead.comment?16:0)),ae(T,255&T.gzhead.time),ae(T,T.gzhead.time>>8&255),ae(T,T.gzhead.time>>16&255),ae(T,T.gzhead.time>>24&255),ae(T,T.level===9?2:2<=T.strategy||T.level<2?4:0),ae(T,255&T.gzhead.os),T.gzhead.extra&&T.gzhead.extra.length&&(ae(T,255&T.gzhead.extra.length),ae(T,T.gzhead.extra.length>>8&255)),T.gzhead.hcrc&&(y.adler=l(y.adler,T.pending_buf,T.pending,0)),T.gzindex=0,T.status=69):(ae(T,0),ae(T,0),ae(T,0),ae(T,0),ae(T,0),ae(T,T.level===9?2:2<=T.strategy||T.level<2?4:0),ae(T,3),T.status=E);else{var X=w+(T.w_bits-8<<4)<<8;X|=(2<=T.strategy||T.level<2?0:T.level<6?1:T.level===6?2:3)<<6,T.strstart!==0&&(X|=32),X+=31-X%31,T.status=E,ee(T,X),T.strstart!==0&&(ee(T,y.adler>>>16),ee(T,65535&y.adler)),y.adler=1}if(T.status===69)if(T.gzhead.extra){for(S=T.pending;T.gzindex<(65535&T.gzhead.extra.length)&&(T.pending!==T.pending_buf_size||(T.gzhead.hcrc&&T.pending>S&&(y.adler=l(y.adler,T.pending_buf,T.pending-S,S)),F(y),S=T.pending,T.pending!==T.pending_buf_size));)ae(T,255&T.gzhead.extra[T.gzindex]),T.gzindex++;T.gzhead.hcrc&&T.pending>S&&(y.adler=l(y.adler,T.pending_buf,T.pending-S,S)),T.gzindex===T.gzhead.extra.length&&(T.gzindex=0,T.status=73)}else T.status=73;if(T.status===73)if(T.gzhead.name){S=T.pending;do{if(T.pending===T.pending_buf_size&&(T.gzhead.hcrc&&T.pending>S&&(y.adler=l(y.adler,T.pending_buf,T.pending-S,S)),F(y),S=T.pending,T.pending===T.pending_buf_size)){B=1;break}B=T.gzindex<T.gzhead.name.length?255&T.gzhead.name.charCodeAt(T.gzindex++):0,ae(T,B)}while(B!==0);T.gzhead.hcrc&&T.pending>S&&(y.adler=l(y.adler,T.pending_buf,T.pending-S,S)),B===0&&(T.gzindex=0,T.status=91)}else T.status=91;if(T.status===91)if(T.gzhead.comment){S=T.pending;do{if(T.pending===T.pending_buf_size&&(T.gzhead.hcrc&&T.pending>S&&(y.adler=l(y.adler,T.pending_buf,T.pending-S,S)),F(y),S=T.pending,T.pending===T.pending_buf_size)){B=1;break}B=T.gzindex<T.gzhead.comment.length?255&T.gzhead.comment.charCodeAt(T.gzindex++):0,ae(T,B)}while(B!==0);T.gzhead.hcrc&&T.pending>S&&(y.adler=l(y.adler,T.pending_buf,T.pending-S,S)),B===0&&(T.status=103)}else T.status=103;if(T.status===103&&(T.gzhead.hcrc?(T.pending+2>T.pending_buf_size&&F(y),T.pending+2<=T.pending_buf_size&&(ae(T,255&y.adler),ae(T,y.adler>>8&255),y.adler=0,T.status=E)):T.status=E),T.pending!==0){if(F(y),y.avail_out===0)return T.last_flush=-1,f}else if(y.avail_in===0&&H(K)<=H(G)&&K!==d)return Q(y,-5);if(T.status===666&&y.avail_in!==0)return Q(y,-5);if(y.avail_in!==0||T.lookahead!==0||K!==h&&T.status!==666){var Z=T.strategy===2?function(W,ne){for(var ue;;){if(W.lookahead===0&&(we(W),W.lookahead===0)){if(ne===h)return g;break}if(W.match_length=0,ue=a._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++,ue&&(D(W,!1),W.strm.avail_out===0))return g}return W.insert=0,ne===d?(D(W,!0),W.strm.avail_out===0?j:U):W.last_lit&&(D(W,!1),W.strm.avail_out===0)?g:N}(T,K):T.strategy===3?function(W,ne){for(var ue,ie,de,Je,Ue=W.window;;){if(W.lookahead<=V){if(we(W),W.lookahead<=V&&ne===h)return g;if(W.lookahead===0)break}if(W.match_length=0,W.lookahead>=L&&0<W.strstart&&(ie=Ue[de=W.strstart-1])===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]){Je=W.strstart+V;do;while(ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&de<Je);W.match_length=V-(Je-de),W.match_length>W.lookahead&&(W.match_length=W.lookahead)}if(W.match_length>=L?(ue=a._tr_tally(W,1,W.match_length-L),W.lookahead-=W.match_length,W.strstart+=W.match_length,W.match_length=0):(ue=a._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++),ue&&(D(W,!1),W.strm.avail_out===0))return g}return W.insert=0,ne===d?(D(W,!0),W.strm.avail_out===0?j:U):W.last_lit&&(D(W,!1),W.strm.avail_out===0)?g:N}(T,K):s[T.level].func(T,K);if(Z!==j&&Z!==U||(T.status=666),Z===g||Z===j)return y.avail_out===0&&(T.last_flush=-1),f;if(Z===N&&(K===1?a._tr_align(T):K!==5&&(a._tr_stored_block(T,0,0,!1),K===3&&(J(T.head),T.lookahead===0&&(T.strstart=0,T.block_start=0,T.insert=0))),F(y),y.avail_out===0))return T.last_flush=-1,f}return K!==d?f:T.wrap<=0?1:(T.wrap===2?(ae(T,255&y.adler),ae(T,y.adler>>8&255),ae(T,y.adler>>16&255),ae(T,y.adler>>24&255),ae(T,255&y.total_in),ae(T,y.total_in>>8&255),ae(T,y.total_in>>16&255),ae(T,y.total_in>>24&255)):(ee(T,y.adler>>>16),ee(T,65535&y.adler)),F(y),0<T.wrap&&(T.wrap=-T.wrap),T.pending!==0?f:1)},i.deflateEnd=function(y){var K;return y&&y.state?(K=y.state.status)!==I&&K!==69&&K!==73&&K!==91&&K!==103&&K!==E&&K!==666?Q(y,p):(y.state=null,K===E?Q(y,-3):f):p},i.deflateSetDictionary=function(y,K){var G,T,S,B,X,Z,W,ne,ue=K.length;if(!y||!y.state||(B=(G=y.state).wrap)===2||B===1&&G.status!==I||G.lookahead)return p;for(B===1&&(y.adler=c(y.adler,K,ue,0)),G.wrap=0,ue>=G.w_size&&(B===0&&(J(G.head),G.strstart=0,G.block_start=0,G.insert=0),ne=new o.Buf8(G.w_size),o.arraySet(ne,K,ue-G.w_size,G.w_size,0),K=ne,ue=G.w_size),X=y.avail_in,Z=y.next_in,W=y.input,y.avail_in=ue,y.next_in=0,y.input=K,we(G);G.lookahead>=L;){for(T=G.strstart,S=G.lookahead-(L-1);G.ins_h=(G.ins_h<<G.hash_shift^G.window[T+L-1])&G.hash_mask,G.prev[T&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=T,T++,--S;);G.strstart=T,G.lookahead=L-1,we(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=L-1,G.match_available=0,y.next_in=Z,y.input=W,y.avail_in=X,G.wrap=B,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,h,d,f,p,m,b,_,w,v,A,O,x,R,$,L,V,Y,I,E,g,N;a=s.state,c=s.next_in,g=s.input,l=c+(s.avail_in-5),u=s.next_out,N=s.output,h=u-(o-s.avail_out),d=u+(s.avail_out-257),f=a.dmax,p=a.wsize,m=a.whave,b=a.wnext,_=a.window,w=a.hold,v=a.bits,A=a.lencode,O=a.distcode,x=(1<<a.lenbits)-1,R=(1<<a.distbits)-1;e:do{v<15&&(w+=g[c++]<<v,v+=8,w+=g[c++]<<v,v+=8),$=A[w&x];t:for(;;){if(w>>>=L=$>>>24,v-=L,(L=$>>>16&255)===0)N[u++]=65535&$;else{if(!(16&L)){if(!(64&L)){$=A[(65535&$)+(w&(1<<L)-1)];continue t}if(32&L){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}V=65535&$,(L&=15)&&(v<L&&(w+=g[c++]<<v,v+=8),V+=w&(1<<L)-1,w>>>=L,v-=L),v<15&&(w+=g[c++]<<v,v+=8,w+=g[c++]<<v,v+=8),$=O[w&R];n:for(;;){if(w>>>=L=$>>>24,v-=L,!(16&(L=$>>>16&255))){if(!(64&L)){$=O[(65535&$)+(w&(1<<L)-1)];continue n}s.msg="invalid distance code",a.mode=30;break e}if(Y=65535&$,v<(L&=15)&&(w+=g[c++]<<v,(v+=8)<L&&(w+=g[c++]<<v,v+=8)),f<(Y+=w&(1<<L)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(w>>>=L,v-=L,(L=u-h)<Y){if(m<(L=Y-L)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(E=_,(I=0)===b){if(I+=p-L,L<V){for(V-=L;N[u++]=_[I++],--L;);I=u-Y,E=N}}else if(b<L){if(I+=p+b-L,(L-=b)<V){for(V-=L;N[u++]=_[I++],--L;);if(I=0,b<V){for(V-=L=b;N[u++]=_[I++],--L;);I=u-Y,E=N}}}else if(I+=b-L,L<V){for(V-=L;N[u++]=_[I++],--L;);I=u-Y,E=N}for(;2<V;)N[u++]=E[I++],N[u++]=E[I++],N[u++]=E[I++],V-=3;V&&(N[u++]=E[I++],1<V&&(N[u++]=E[I++]))}else{for(I=u-Y;N[u++]=N[I++],N[u++]=N[I++],N[u++]=N[I++],2<(V-=3););V&&(N[u++]=N[I++],1<V&&(N[u++]=N[I++]))}break}}break}}while(c<l&&u<d);c-=V=v>>3,w&=(1<<(v-=V<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=w,a.bits=v}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,h=2,d=0,f=-2,p=1,m=852,b=592;function _(I){return(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24)}function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(I){var E;return I&&I.state?(E=I.state,I.total_in=I.total_out=E.total=0,I.msg="",E.wrap&&(I.adler=1&E.wrap),E.mode=p,E.last=0,E.havedict=0,E.dmax=32768,E.head=null,E.hold=0,E.bits=0,E.lencode=E.lendyn=new s.Buf32(m),E.distcode=E.distdyn=new s.Buf32(b),E.sane=1,E.back=-1,d):f}function A(I){var E;return I&&I.state?((E=I.state).wsize=0,E.whave=0,E.wnext=0,v(I)):f}function O(I,E){var g,N;return I&&I.state?(N=I.state,E<0?(g=0,E=-E):(g=1+(E>>4),E<48&&(E&=15)),E&&(E<8||15<E)?f:(N.window!==null&&N.wbits!==E&&(N.window=null),N.wrap=g,N.wbits=E,A(I))):f}function x(I,E){var g,N;return I?(N=new w,(I.state=N).window=null,(g=O(I,E))!==d&&(I.state=null),g):f}var R,$,L=!0;function V(I){if(L){var E;for(R=new s.Buf32(512),$=new s.Buf32(32),E=0;E<144;)I.lens[E++]=8;for(;E<256;)I.lens[E++]=9;for(;E<280;)I.lens[E++]=7;for(;E<288;)I.lens[E++]=8;for(l(u,I.lens,0,288,R,0,I.work,{bits:9}),E=0;E<32;)I.lens[E++]=5;l(h,I.lens,0,32,$,0,I.work,{bits:5}),L=!1}I.lencode=R,I.lenbits=9,I.distcode=$,I.distbits=5}function Y(I,E,g,N){var j,U=I.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new s.Buf8(U.wsize)),N>=U.wsize?(s.arraySet(U.window,E,g-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(N<(j=U.wsize-U.wnext)&&(j=N),s.arraySet(U.window,E,g-N,j,U.wnext),(N-=j)?(s.arraySet(U.window,E,g-N,N,0),U.wnext=N,U.whave=U.wsize):(U.wnext+=j,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=j))),0}i.inflateReset=A,i.inflateReset2=O,i.inflateResetKeep=v,i.inflateInit=function(I){return x(I,15)},i.inflateInit2=x,i.inflate=function(I,E){var g,N,j,U,Q,H,J,F,D,ae,ee,te,we,je,be,_e,We,$e,gt,kt,y,K,G,T,S=0,B=new s.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!I||!I.state||!I.output||!I.input&&I.avail_in!==0)return f;(g=I.state).mode===12&&(g.mode=13),Q=I.next_out,j=I.output,J=I.avail_out,U=I.next_in,N=I.input,H=I.avail_in,F=g.hold,D=g.bits,ae=H,ee=J,K=d;e:for(;;)switch(g.mode){case p:if(g.wrap===0){g.mode=13;break}for(;D<16;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(2&g.wrap&&F===35615){B[g.check=0]=255&F,B[1]=F>>>8&255,g.check=a(g.check,B,2,0),D=F=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&F)<<8)+(F>>8))%31){I.msg="incorrect header check",g.mode=30;break}if((15&F)!=8){I.msg="unknown compression method",g.mode=30;break}if(D-=4,y=8+(15&(F>>>=4)),g.wbits===0)g.wbits=y;else if(y>g.wbits){I.msg="invalid window size",g.mode=30;break}g.dmax=1<<y,I.adler=g.check=1,g.mode=512&F?10:12,D=F=0;break;case 2:for(;D<16;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(g.flags=F,(255&g.flags)!=8){I.msg="unknown compression method",g.mode=30;break}if(57344&g.flags){I.msg="unknown header flags set",g.mode=30;break}g.head&&(g.head.text=F>>8&1),512&g.flags&&(B[0]=255&F,B[1]=F>>>8&255,g.check=a(g.check,B,2,0)),D=F=0,g.mode=3;case 3:for(;D<32;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.head&&(g.head.time=F),512&g.flags&&(B[0]=255&F,B[1]=F>>>8&255,B[2]=F>>>16&255,B[3]=F>>>24&255,g.check=a(g.check,B,4,0)),D=F=0,g.mode=4;case 4:for(;D<16;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.head&&(g.head.xflags=255&F,g.head.os=F>>8),512&g.flags&&(B[0]=255&F,B[1]=F>>>8&255,g.check=a(g.check,B,2,0)),D=F=0,g.mode=5;case 5:if(1024&g.flags){for(;D<16;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.length=F,g.head&&(g.head.extra_len=F),512&g.flags&&(B[0]=255&F,B[1]=F>>>8&255,g.check=a(g.check,B,2,0)),D=F=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&(H<(te=g.length)&&(te=H),te&&(g.head&&(y=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Array(g.head.extra_len)),s.arraySet(g.head.extra,N,U,te,y)),512&g.flags&&(g.check=a(g.check,N,te,U)),H-=te,U+=te,g.length-=te),g.length))break e;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(H===0)break e;for(te=0;y=N[U+te++],g.head&&y&&g.length<65536&&(g.head.name+=String.fromCharCode(y)),y&&te<H;);if(512&g.flags&&(g.check=a(g.check,N,te,U)),H-=te,U+=te,y)break e}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(H===0)break e;for(te=0;y=N[U+te++],g.head&&y&&g.length<65536&&(g.head.comment+=String.fromCharCode(y)),y&&te<H;);if(512&g.flags&&(g.check=a(g.check,N,te,U)),H-=te,U+=te,y)break e}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;D<16;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(F!==(65535&g.check)){I.msg="header crc mismatch",g.mode=30;break}D=F=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),I.adler=g.check=0,g.mode=12;break;case 10:for(;D<32;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}I.adler=g.check=_(F),D=F=0,g.mode=11;case 11:if(g.havedict===0)return I.next_out=Q,I.avail_out=J,I.next_in=U,I.avail_in=H,g.hold=F,g.bits=D,2;I.adler=g.check=1,g.mode=12;case 12:if(E===5||E===6)break e;case 13:if(g.last){F>>>=7&D,D-=7&D,g.mode=27;break}for(;D<3;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}switch(g.last=1&F,D-=1,3&(F>>>=1)){case 0:g.mode=14;break;case 1:if(V(g),g.mode=20,E!==6)break;F>>>=2,D-=2;break e;case 2:g.mode=17;break;case 3:I.msg="invalid block type",g.mode=30}F>>>=2,D-=2;break;case 14:for(F>>>=7&D,D-=7&D;D<32;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if((65535&F)!=(F>>>16^65535)){I.msg="invalid stored block lengths",g.mode=30;break}if(g.length=65535&F,D=F=0,g.mode=15,E===6)break e;case 15:g.mode=16;case 16:if(te=g.length){if(H<te&&(te=H),J<te&&(te=J),te===0)break e;s.arraySet(j,N,U,te,Q),H-=te,U+=te,J-=te,Q+=te,g.length-=te;break}g.mode=12;break;case 17:for(;D<14;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(g.nlen=257+(31&F),F>>>=5,D-=5,g.ndist=1+(31&F),F>>>=5,D-=5,g.ncode=4+(15&F),F>>>=4,D-=4,286<g.nlen||30<g.ndist){I.msg="too many length or distance symbols",g.mode=30;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;D<3;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.lens[X[g.have++]]=7&F,F>>>=3,D-=3}for(;g.have<19;)g.lens[X[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,G={bits:g.lenbits},K=l(0,g.lens,0,19,g.lencode,0,g.work,G),g.lenbits=G.bits,K){I.msg="invalid code lengths set",g.mode=30;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;_e=(S=g.lencode[F&(1<<g.lenbits)-1])>>>16&255,We=65535&S,!((be=S>>>24)<=D);){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(We<16)F>>>=be,D-=be,g.lens[g.have++]=We;else{if(We===16){for(T=be+2;D<T;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(F>>>=be,D-=be,g.have===0){I.msg="invalid bit length repeat",g.mode=30;break}y=g.lens[g.have-1],te=3+(3&F),F>>>=2,D-=2}else if(We===17){for(T=be+3;D<T;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}D-=be,y=0,te=3+(7&(F>>>=be)),F>>>=3,D-=3}else{for(T=be+7;D<T;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}D-=be,y=0,te=11+(127&(F>>>=be)),F>>>=7,D-=7}if(g.have+te>g.nlen+g.ndist){I.msg="invalid bit length repeat",g.mode=30;break}for(;te--;)g.lens[g.have++]=y}}if(g.mode===30)break;if(g.lens[256]===0){I.msg="invalid code -- missing end-of-block",g.mode=30;break}if(g.lenbits=9,G={bits:g.lenbits},K=l(u,g.lens,0,g.nlen,g.lencode,0,g.work,G),g.lenbits=G.bits,K){I.msg="invalid literal/lengths set",g.mode=30;break}if(g.distbits=6,g.distcode=g.distdyn,G={bits:g.distbits},K=l(h,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,G),g.distbits=G.bits,K){I.msg="invalid distances set",g.mode=30;break}if(g.mode=20,E===6)break e;case 20:g.mode=21;case 21:if(6<=H&&258<=J){I.next_out=Q,I.avail_out=J,I.next_in=U,I.avail_in=H,g.hold=F,g.bits=D,c(I,ee),Q=I.next_out,j=I.output,J=I.avail_out,U=I.next_in,N=I.input,H=I.avail_in,F=g.hold,D=g.bits,g.mode===12&&(g.back=-1);break}for(g.back=0;_e=(S=g.lencode[F&(1<<g.lenbits)-1])>>>16&255,We=65535&S,!((be=S>>>24)<=D);){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(_e&&!(240&_e)){for($e=be,gt=_e,kt=We;_e=(S=g.lencode[kt+((F&(1<<$e+gt)-1)>>$e)])>>>16&255,We=65535&S,!($e+(be=S>>>24)<=D);){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}F>>>=$e,D-=$e,g.back+=$e}if(F>>>=be,D-=be,g.back+=be,g.length=We,_e===0){g.mode=26;break}if(32&_e){g.back=-1,g.mode=12;break}if(64&_e){I.msg="invalid literal/length code",g.mode=30;break}g.extra=15&_e,g.mode=22;case 22:if(g.extra){for(T=g.extra;D<T;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.length+=F&(1<<g.extra)-1,F>>>=g.extra,D-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;_e=(S=g.distcode[F&(1<<g.distbits)-1])>>>16&255,We=65535&S,!((be=S>>>24)<=D);){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(!(240&_e)){for($e=be,gt=_e,kt=We;_e=(S=g.distcode[kt+((F&(1<<$e+gt)-1)>>$e)])>>>16&255,We=65535&S,!($e+(be=S>>>24)<=D);){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}F>>>=$e,D-=$e,g.back+=$e}if(F>>>=be,D-=be,g.back+=be,64&_e){I.msg="invalid distance code",g.mode=30;break}g.offset=We,g.extra=15&_e,g.mode=24;case 24:if(g.extra){for(T=g.extra;D<T;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.offset+=F&(1<<g.extra)-1,F>>>=g.extra,D-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){I.msg="invalid distance too far back",g.mode=30;break}g.mode=25;case 25:if(J===0)break e;if(te=ee-J,g.offset>te){if((te=g.offset-te)>g.whave&&g.sane){I.msg="invalid distance too far back",g.mode=30;break}we=te>g.wnext?(te-=g.wnext,g.wsize-te):g.wnext-te,te>g.length&&(te=g.length),je=g.window}else je=j,we=Q-g.offset,te=g.length;for(J<te&&(te=J),J-=te,g.length-=te;j[Q++]=je[we++],--te;);g.length===0&&(g.mode=21);break;case 26:if(J===0)break e;j[Q++]=g.length,J--,g.mode=21;break;case 27:if(g.wrap){for(;D<32;){if(H===0)break e;H--,F|=N[U++]<<D,D+=8}if(ee-=J,I.total_out+=ee,g.total+=ee,ee&&(I.adler=g.check=g.flags?a(g.check,j,ee,Q-ee):o(g.check,j,ee,Q-ee)),ee=J,(g.flags?F:_(F))!==g.check){I.msg="incorrect data check",g.mode=30;break}D=F=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;D<32;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(F!==(4294967295&g.total)){I.msg="incorrect length check",g.mode=30;break}D=F=0}g.mode=29;case 29:K=1;break e;case 30:K=-3;break e;case 31:return-4;case 32:default:return f}return I.next_out=Q,I.avail_out=J,I.next_in=U,I.avail_in=H,g.hold=F,g.bits=D,(g.wsize||ee!==I.avail_out&&g.mode<30&&(g.mode<27||E!==4))&&Y(I,I.output,I.next_out,ee-I.avail_out)?(g.mode=31,-4):(ae-=I.avail_in,ee-=I.avail_out,I.total_in+=ae,I.total_out+=ee,g.total+=ee,g.wrap&&ee&&(I.adler=g.check=g.flags?a(g.check,j,ee,I.next_out-ee):o(g.check,j,ee,I.next_out-ee)),I.data_type=g.bits+(g.last?64:0)+(g.mode===12?128:0)+(g.mode===20||g.mode===15?256:0),(ae==0&&ee===0||E===4)&&K===d&&(K=-5),K)},i.inflateEnd=function(I){if(!I||!I.state)return f;var E=I.state;return E.window&&(E.window=null),I.state=null,d},i.inflateGetHeader=function(I,E){var g;return I&&I.state&&2&(g=I.state).wrap?((g.head=E).done=!1,d):f},i.inflateSetDictionary=function(I,E){var g,N=E.length;return I&&I.state?(g=I.state).wrap!==0&&g.mode!==11?f:g.mode===11&&o(1,E,N,0)!==g.check?-3:Y(I,E,N,N)?(g.mode=31,-4):(g.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,h,d,f,p,m,b,_){var w,v,A,O,x,R,$,L,V,Y=_.bits,I=0,E=0,g=0,N=0,j=0,U=0,Q=0,H=0,J=0,F=0,D=null,ae=0,ee=new s.Buf16(16),te=new s.Buf16(16),we=null,je=0;for(I=0;I<=15;I++)ee[I]=0;for(E=0;E<f;E++)ee[h[d+E]]++;for(j=Y,N=15;1<=N&&ee[N]===0;N--);if(N<j&&(j=N),N===0)return p[m++]=20971520,p[m++]=20971520,_.bits=1,0;for(g=1;g<N&&ee[g]===0;g++);for(j<g&&(j=g),I=H=1;I<=15;I++)if(H<<=1,(H-=ee[I])<0)return-1;if(0<H&&(u===0||N!==1))return-1;for(te[1]=0,I=1;I<15;I++)te[I+1]=te[I]+ee[I];for(E=0;E<f;E++)h[d+E]!==0&&(b[te[h[d+E]]++]=E);if(R=u===0?(D=we=b,19):u===1?(D=o,ae-=257,we=a,je-=257,256):(D=c,we=l,-1),I=g,x=m,Q=E=F=0,A=-1,O=(J=1<<(U=j))-1,u===1&&852<J||u===2&&592<J)return 1;for(;;){for($=I-Q,V=b[E]<R?(L=0,b[E]):b[E]>R?(L=we[je+b[E]],D[ae+b[E]]):(L=96,0),w=1<<I-Q,g=v=1<<U;p[x+(F>>Q)+(v-=w)]=$<<24|L<<16|V|0,v!==0;);for(w=1<<I-1;F&w;)w>>=1;if(w!==0?(F&=w-1,F+=w):F=0,E++,--ee[I]==0){if(I===N)break;I=h[d+b[E]]}if(j<I&&(F&O)!==A){for(Q===0&&(Q=j),x+=g,H=1<<(U=I-Q);U+Q<N&&!((H-=ee[U+Q])<=0);)U++,H<<=1;if(J+=1<<U,u===1&&852<J||u===2&&592<J)return 1;p[A=F&O]=j<<24|U<<16|x-m|0}}return F!==0&&(p[x+F]=I-Q<<24|64<<16|0),_.bits=j,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(S){for(var B=S.length;0<=--B;)S[B]=0}var l=0,u=29,h=256,d=h+1+u,f=30,p=19,m=2*d+1,b=15,_=16,w=7,v=256,A=16,O=17,x=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=new Array(2*(d+2));c(Y);var I=new Array(2*f);c(I);var E=new Array(512);c(E);var g=new Array(256);c(g);var N=new Array(u);c(N);var j,U,Q,H=new Array(f);function J(S,B,X,Z,W){this.static_tree=S,this.extra_bits=B,this.extra_base=X,this.elems=Z,this.max_length=W,this.has_stree=S&&S.length}function F(S,B){this.dyn_tree=S,this.max_code=0,this.stat_desc=B}function D(S){return S<256?E[S]:E[256+(S>>>7)]}function ae(S,B){S.pending_buf[S.pending++]=255&B,S.pending_buf[S.pending++]=B>>>8&255}function ee(S,B,X){S.bi_valid>_-X?(S.bi_buf|=B<<S.bi_valid&65535,ae(S,S.bi_buf),S.bi_buf=B>>_-S.bi_valid,S.bi_valid+=X-_):(S.bi_buf|=B<<S.bi_valid&65535,S.bi_valid+=X)}function te(S,B,X){ee(S,X[2*B],X[2*B+1])}function we(S,B){for(var X=0;X|=1&S,S>>>=1,X<<=1,0<--B;);return X>>>1}function je(S,B,X){var Z,W,ne=new Array(b+1),ue=0;for(Z=1;Z<=b;Z++)ne[Z]=ue=ue+X[Z-1]<<1;for(W=0;W<=B;W++){var ie=S[2*W+1];ie!==0&&(S[2*W]=we(ne[ie]++,ie))}}function be(S){var B;for(B=0;B<d;B++)S.dyn_ltree[2*B]=0;for(B=0;B<f;B++)S.dyn_dtree[2*B]=0;for(B=0;B<p;B++)S.bl_tree[2*B]=0;S.dyn_ltree[2*v]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function _e(S){8<S.bi_valid?ae(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function We(S,B,X,Z){var W=2*B,ne=2*X;return S[W]<S[ne]||S[W]===S[ne]&&Z[B]<=Z[X]}function $e(S,B,X){for(var Z=S.heap[X],W=X<<1;W<=S.heap_len&&(W<S.heap_len&&We(B,S.heap[W+1],S.heap[W],S.depth)&&W++,!We(B,Z,S.heap[W],S.depth));)S.heap[X]=S.heap[W],X=W,W<<=1;S.heap[X]=Z}function gt(S,B,X){var Z,W,ne,ue,ie=0;if(S.last_lit!==0)for(;Z=S.pending_buf[S.d_buf+2*ie]<<8|S.pending_buf[S.d_buf+2*ie+1],W=S.pending_buf[S.l_buf+ie],ie++,Z===0?te(S,W,B):(te(S,(ne=g[W])+h+1,B),(ue=R[ne])!==0&&ee(S,W-=N[ne],ue),te(S,ne=D(--Z),X),(ue=$[ne])!==0&&ee(S,Z-=H[ne],ue)),ie<S.last_lit;);te(S,v,B)}function kt(S,B){var X,Z,W,ne=B.dyn_tree,ue=B.stat_desc.static_tree,ie=B.stat_desc.has_stree,de=B.stat_desc.elems,Je=-1;for(S.heap_len=0,S.heap_max=m,X=0;X<de;X++)ne[2*X]!==0?(S.heap[++S.heap_len]=Je=X,S.depth[X]=0):ne[2*X+1]=0;for(;S.heap_len<2;)ne[2*(W=S.heap[++S.heap_len]=Je<2?++Je:0)]=1,S.depth[W]=0,S.opt_len--,ie&&(S.static_len-=ue[2*W+1]);for(B.max_code=Je,X=S.heap_len>>1;1<=X;X--)$e(S,ne,X);for(W=de;X=S.heap[1],S.heap[1]=S.heap[S.heap_len--],$e(S,ne,1),Z=S.heap[1],S.heap[--S.heap_max]=X,S.heap[--S.heap_max]=Z,ne[2*W]=ne[2*X]+ne[2*Z],S.depth[W]=(S.depth[X]>=S.depth[Z]?S.depth[X]:S.depth[Z])+1,ne[2*X+1]=ne[2*Z+1]=W,S.heap[1]=W++,$e(S,ne,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(Ue,Sn){var Ao,sr,xo,ht,Nc,Zh,Or=Sn.dyn_tree,G_=Sn.max_code,PM=Sn.stat_desc.static_tree,DM=Sn.stat_desc.has_stree,BM=Sn.stat_desc.extra_bits,H_=Sn.stat_desc.extra_base,To=Sn.stat_desc.max_length,Lc=0;for(ht=0;ht<=b;ht++)Ue.bl_count[ht]=0;for(Or[2*Ue.heap[Ue.heap_max]+1]=0,Ao=Ue.heap_max+1;Ao<m;Ao++)To<(ht=Or[2*Or[2*(sr=Ue.heap[Ao])+1]+1]+1)&&(ht=To,Lc++),Or[2*sr+1]=ht,G_<sr||(Ue.bl_count[ht]++,Nc=0,H_<=sr&&(Nc=BM[sr-H_]),Zh=Or[2*sr],Ue.opt_len+=Zh*(ht+Nc),DM&&(Ue.static_len+=Zh*(PM[2*sr+1]+Nc)));if(Lc!==0){do{for(ht=To-1;Ue.bl_count[ht]===0;)ht--;Ue.bl_count[ht]--,Ue.bl_count[ht+1]+=2,Ue.bl_count[To]--,Lc-=2}while(0<Lc);for(ht=To;ht!==0;ht--)for(sr=Ue.bl_count[ht];sr!==0;)G_<(xo=Ue.heap[--Ao])||(Or[2*xo+1]!==ht&&(Ue.opt_len+=(ht-Or[2*xo+1])*Or[2*xo],Or[2*xo+1]=ht),sr--)}}(S,B),je(ne,Je,S.bl_count)}function y(S,B,X){var Z,W,ne=-1,ue=B[1],ie=0,de=7,Je=4;for(ue===0&&(de=138,Je=3),B[2*(X+1)+1]=65535,Z=0;Z<=X;Z++)W=ue,ue=B[2*(Z+1)+1],++ie<de&&W===ue||(ie<Je?S.bl_tree[2*W]+=ie:W!==0?(W!==ne&&S.bl_tree[2*W]++,S.bl_tree[2*A]++):ie<=10?S.bl_tree[2*O]++:S.bl_tree[2*x]++,ne=W,Je=(ie=0)===ue?(de=138,3):W===ue?(de=6,3):(de=7,4))}function K(S,B,X){var Z,W,ne=-1,ue=B[1],ie=0,de=7,Je=4;for(ue===0&&(de=138,Je=3),Z=0;Z<=X;Z++)if(W=ue,ue=B[2*(Z+1)+1],!(++ie<de&&W===ue)){if(ie<Je)for(;te(S,W,S.bl_tree),--ie!=0;);else W!==0?(W!==ne&&(te(S,W,S.bl_tree),ie--),te(S,A,S.bl_tree),ee(S,ie-3,2)):ie<=10?(te(S,O,S.bl_tree),ee(S,ie-3,3)):(te(S,x,S.bl_tree),ee(S,ie-11,7));ne=W,Je=(ie=0)===ue?(de=138,3):W===ue?(de=6,3):(de=7,4)}}c(H);var G=!1;function T(S,B,X,Z){ee(S,(l<<1)+(Z?1:0),3),function(W,ne,ue,ie){_e(W),ae(W,ue),ae(W,~ue),s.arraySet(W.pending_buf,W.window,ne,ue,W.pending),W.pending+=ue}(S,B,X)}i._tr_init=function(S){G||(function(){var B,X,Z,W,ne,ue=new Array(b+1);for(W=Z=0;W<u-1;W++)for(N[W]=Z,B=0;B<1<<R[W];B++)g[Z++]=W;for(g[Z-1]=W,W=ne=0;W<16;W++)for(H[W]=ne,B=0;B<1<<$[W];B++)E[ne++]=W;for(ne>>=7;W<f;W++)for(H[W]=ne<<7,B=0;B<1<<$[W]-7;B++)E[256+ne++]=W;for(X=0;X<=b;X++)ue[X]=0;for(B=0;B<=143;)Y[2*B+1]=8,B++,ue[8]++;for(;B<=255;)Y[2*B+1]=9,B++,ue[9]++;for(;B<=279;)Y[2*B+1]=7,B++,ue[7]++;for(;B<=287;)Y[2*B+1]=8,B++,ue[8]++;for(je(Y,d+1,ue),B=0;B<f;B++)I[2*B+1]=5,I[2*B]=we(B,5);j=new J(Y,R,h+1,d,b),U=new J(I,$,0,f,b),Q=new J(new Array(0),L,0,p,w)}(),G=!0),S.l_desc=new F(S.dyn_ltree,j),S.d_desc=new F(S.dyn_dtree,U),S.bl_desc=new F(S.bl_tree,Q),S.bi_buf=0,S.bi_valid=0,be(S)},i._tr_stored_block=T,i._tr_flush_block=function(S,B,X,Z){var W,ne,ue=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(ie){var de,Je=4093624447;for(de=0;de<=31;de++,Je>>>=1)if(1&Je&&ie.dyn_ltree[2*de]!==0)return o;if(ie.dyn_ltree[18]!==0||ie.dyn_ltree[20]!==0||ie.dyn_ltree[26]!==0)return a;for(de=32;de<h;de++)if(ie.dyn_ltree[2*de]!==0)return a;return o}(S)),kt(S,S.l_desc),kt(S,S.d_desc),ue=function(ie){var de;for(y(ie,ie.dyn_ltree,ie.l_desc.max_code),y(ie,ie.dyn_dtree,ie.d_desc.max_code),kt(ie,ie.bl_desc),de=p-1;3<=de&&ie.bl_tree[2*V[de]+1]===0;de--);return ie.opt_len+=3*(de+1)+5+5+4,de}(S),W=S.opt_len+3+7>>>3,(ne=S.static_len+3+7>>>3)<=W&&(W=ne)):W=ne=X+5,X+4<=W&&B!==-1?T(S,B,X,Z):S.strategy===4||ne===W?(ee(S,2+(Z?1:0),3),gt(S,Y,I)):(ee(S,4+(Z?1:0),3),function(ie,de,Je,Ue){var Sn;for(ee(ie,de-257,5),ee(ie,Je-1,5),ee(ie,Ue-4,4),Sn=0;Sn<Ue;Sn++)ee(ie,ie.bl_tree[2*V[Sn]+1],3);K(ie,ie.dyn_ltree,de-1),K(ie,ie.dyn_dtree,Je-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,ue+1),gt(S,S.dyn_ltree,S.dyn_dtree)),be(S),Z&&_e(S)},i._tr_tally=function(S,B,X){return S.pending_buf[S.d_buf+2*S.last_lit]=B>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&B,S.pending_buf[S.l_buf+S.last_lit]=255&X,S.last_lit++,B===0?S.dyn_ltree[2*X]++:(S.matches++,B--,S.dyn_ltree[2*(g[X]+h+1)]++,S.dyn_dtree[2*D(B)]++),S.last_lit===S.lit_bufsize-1},i._tr_align=function(S){ee(S,2,3),te(S,v,Y),function(B){B.bi_valid===16?(ae(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):8<=B.bi_valid&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,d=1,f={},p=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(A){process.nextTick(function(){w(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,O=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=O,A}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(A){o.postMessage(h+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){w(A.data)},function(A){u.port2.postMessage(A)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(A){var O=m.createElement("script");O.onreadystatechange=function(){w(A),O.onreadystatechange=null,l.removeChild(O),O=null},l.appendChild(O)}):function(A){setTimeout(w,0,A)},b.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var O=new Array(arguments.length-1),x=0;x<O.length;x++)O[x]=arguments[x+1];var R={callback:A,args:O};return f[d]=R,c(d),d++},b.clearImmediate=_}function _(A){delete f[A]}function w(A){if(p)setTimeout(w,0,A);else{var O=f[A];if(O){p=!0;try{(function(x){var R=x.callback,$=x.args;switch($.length){case 0:R();break;case 1:R($[0]);break;case 2:R($[0],$[1]);break;case 3:R($[0],$[1],$[2]);break;default:R.apply(a,$)}})(O)}finally{_(A),p=!1}}}}function v(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(h)===0&&w(+A.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Pt<"u"?Pt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(I_);var JL=I_.exports,Hh=Ci(JL);const O_={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(O_);var kn=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},cs,So,Ri;class YL{constructor(...e){cs.set(this,new Map),So.set(this,new Map),Ri.set(this,new Map);for(const n of e)this.define(n)}define(e,n=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),kn(this,Ri,"f").has(r)||kn(this,Ri,"f").set(r,new Set);const s=kn(this,Ri,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&kn(this,So,"f").set(r,a),o=!1,c)continue;const l=kn(this,cs,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);kn(this,cs,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const n=e.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<e.length;return!(r.length<n.length-1)&&i?null:kn(this,cs,"f").get(r)??null}getExtension(e){var n;return typeof e!="string"?null:(e=(n=e==null?void 0:e.split)==null?void 0:n.call(e,";")[0],(e&&kn(this,So,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:kn(this,Ri,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of kn(this,Ri,"f").values())Object.freeze(e);return this}_getTestState(){return{types:kn(this,cs,"f"),extensions:kn(this,So,"f")}}}cs=new WeakMap,So=new WeakMap,Ri=new WeakMap;var QL=new YL(O_)._freeze();function C_(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return QL.getType(t)??"application/octet-stream"}function eM(t){const e=Ry(t,{}),n=tr(e),r=fo(e),i=Un(ze.MAIN);if(!k(i))return;const s=ho(e),o=vh(i,s,n);k(o)?Ct("memory",`${i.name} already has a [${r}] named ${n}`):(Ly(i,e),P_(e.id,i.id),Ct("memory",`created [${r}] ${n} in ${i.name}`))}async function tM(t){const e=await t.text();eM(e)}async function nM(t,e){try{Ct("parsezipfile",t.name);const n=await t.arrayBuffer();(await new Hh().loadAsync(n)).forEach((s,o)=>{o.async("uint8array").then(a=>{const c=C_(s,a),l=new File([a],o.name,{type:c});e(l)}).catch(a=>{et("memory","crash",a.message)})})}catch(n){et("memory","crash",n.message)}}async function rM(t,e){try{Ct("parsebinaryfile",t.name);const n=await t.arrayBuffer(),r=t.name.split(".").slice(-1)[0]??"";e(Pe(r),new Uint8Array(n))}catch(n){et("memory","crash",n.message)}}function Vh(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];He(r)?r.forEach(i=>{e.push(Vh(i))}):e.push(Vh(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function iM(t){const e=Y0(`${t}
`);if(e.errors.length>0)return e;as.input=e.tokens;const n=as.program();if(as.errors.length>0)return{tokens:e.tokens,errors:as.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=WL.go(n);return r?(Vh(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Kh=Object.getPrototypeOf(function*(){}).constructor;function sM(t,e){const n=`compile-${t}`;console.time(n);const r=iM(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=qL(r.ast);if(i.code){Hk&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Kh("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Kh("api"," ")}}}return{...r,...i,source:"",code:new Kh("api"," ")}}function oM(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=sM(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},has(i){return k(e[i])},isended(i){const s=e[i];return k(s)?s.isended():!0},halt(i){const s=e[i];return k(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},tick(i,s,o,a,c){var u;let l=e[i];if(!k(e[i])){const h=n(a,c);if(l=e[i]=ZL(i,s,h),(u=h.errors)!=null&&u.length){const[d]=h.errors,f=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((_,w)=>[_,w]);p.slice(f-5,f).forEach(([_,w])=>{et("os","build",`$grey${w+1} $grey${_}`)});const[m,b]=p[f]??[];if(Se(m)&&k(b)){const _=(d.column??1)-1,w=_+d.length,v=_<m.length?m:`${m}*`,A=v.substring(0,_),O=v.substring(_,w),x=v.substring(w);et("os","build",`$red${b+1} $grey${A}$red${O}$grey${x}`)}return d.message.split(`
`).forEach(_=>{et("os","build",_)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=sf(i.target),a=e[s];if(k(a)){const c={...i,target:o};a.message(c)}}};return r}function aM(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}function N_(t,e,n,r,i){t.push({x:e+r,y:n+i}),t.push({x:e-r,y:n+i}),t.push({x:e+r,y:n-i}),t.push({x:e-r,y:n-i})}function cM(t,e,n){const r=[];let i=5-4*n,s=0,o=n,a=(-2*n+5)*4,c=3*4;for(;s<=o;)N_(r,t,e,s,o),N_(r,t,e,o,s),i>0?(i+=a,o-=1,s+=1,a+=4*4,c+=2*2):(i+=c,s+=1,a+=2*4,c+=2*4);return r}let L_=0;function lM(){switch(L_++){case 0:return Le.BLUE;case 1:return Le.GREEN;case 2:return Le.CYAN;case 3:return Le.RED;case 4:return Le.PURPLE;case 5:return Le.YELLOW;default:return L_=0,Le.WHITE}}const uM=new Ms;function hM(t,e,n,r,i){const s=[];let o=e;const a=o===0,c=tt,l=hn,u=a?Le.BLACK:Le.ONCLEAR,h=xp(t,o++,c,l,u);s.push(h);const d=o++,f=kk(t,d);s.push(f);const p=Sk(t,o++,c,l,r.isdark?1:0);s.push(p);const m=xp(t,o++,c,l,Le.ONCLEAR);s.push(m);const b={...w_(tt,hn,lM(),Le.ONCLEAR),...m},_=Ak(t,o++);i&&s.push(_),r.terrain.forEach((v,A)=>{if(v){const O=on(n,v);h.char[A]=v.char??(O==null?void 0:O.char)??0,h.color[A]=v.color??(O==null?void 0:O.color)??u,h.bg[A]=v.bg??(O==null?void 0:O.bg)??u}});const w=r.objects??{};return Object.values(w).forEach(v=>{if(k(v.removed)||k(v.headless))return;const A=v.id??"",O=My(n,v),x=Ek(t,d,A);if(x.x=v.x??0,x.y=v.y??0,x.char=O.char,x.color=O.color,x.bg=O.bg,f.sprites.push(x),r.isdark&&ve(O.light)){const V=cM(x.x,x.y,O.light);for(let Y=0;Y<V.length;++Y){let I=0;const E=V[Y],g=aM(x.x,x.y,E.x,E.y);for(let N=0;N<g.length;N++){const j=g[N];if(j.x<0||j.x>=c||j.y<0||j.y>=l)break;const Q=uM.subVectors(j,x).length()/(O.light+1),J=1-jr(Q+I,0,1),F=j.x+j.y*c;p.alphas[F]=jr(p.alphas[F]-J,0,1);const D=AN(r,j);if(D<0||!k(r==null?void 0:r.lookup))break;if(j.x!==x.x||j.y!==x.y){const we=Si(r,r.lookup[D]??"");k(we)&&(I+=.5)}const ae=r.terrain[D],ee=on(n,ae),te=(ae==null?void 0:ae.collision)??(ee==null?void 0:ee.collision);if(tu(Ge.ISWALK,te))break}}}function R(V,Y){if(!(V<0||V>=c||Y<0||Y>=l))return p.alphas[V+Y*c]}const $=[[.01,.01,.01],[.01,1,.01],[.01,.01,.01]].flat(),L=ei(p.alphas);for(let V=0;V<p.alphas.length;++V){const Y=V%c,I=Math.floor(V/c),E=[[R(Y-1,I-1),R(Y,I-1),R(Y+1,I-1)],[R(Y-1,I),R(Y,I),R(Y+1,I)],[R(Y-1,I+1),R(Y,I+1),R(Y+1,I+1)]].flat().map((j,U)=>k(j)?[j*$[U],$[U]]:void 0).filter(k),g=E.map(([,j])=>j).reduce((j,U)=>j+U,0),N=E.map(([j])=>j).reduce((j,U)=>j+U,0);L[V]=N/g}if(p.alphas=ei(L),Se(v.tickertext)&&ve(v.tickertime)&&v.tickertext.length){const V=tt,Y=UL(v.tickertext,V,hn-1),I=(Y==null?void 0:Y.measuredwidth)??1,E=v.x??0,g=v.y??0,N=g<hn*.5;b.x=E-Math.floor(I*.5),b.y=g+(N?1:-1),b.x+I>tt&&(b.x=tt-I),b.x<0&&(b.x=0),ML(v.tickertext,b)}A===t&&(_.focusx=x.x,_.focusy=x.y,_.focusid=A)}),s}const Rr=oM();var ze=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(ze||{});const it={defaultplayer:cb(),software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map,chipindex:new Map,codepageindex:new Map,binaryfiles:new Map};function fM(t){console.info("memorysetdefaultplayer",t),it.defaultplayer=t}function Zr(){return it.defaultplayer}function Ic(){return[...it.books.values()]}function dM(){const[t]=it.books.values();return t}function Jr(t){const e=Pe(t);return it.books.get(t)??Ic().find(n=>n.name===e)}function Oc(t,e){k(Jr(e))&&(it.software[t]=e)}function Ht(t){return Jr(it.software[t])}function M_(t){const e=Ny([]);return Se(t)&&(e.name=t),U_(e),Ct("memory",`created [book] ${e.name}`),e}function pM(t){let e=Jr(t);return k(e)||(e=Ny([]),e.name=t),U_(e),Ct("memory",`created [book] ${e.name}`),e}function Un(t,e){let n=k(e)?pM(e):Ht(t);return k(n)||(k(n)||(n=dM()),k(n)||(n=M_(e)),k(n)&&Ct("memory",`opened [book] ${n.name} for ${t}`)),Oc(t,n.id),n}function Ii(t,e,n){const r=Un(t);let i=Ei(r,e);if(k(i))return i;const s=Oy(n);return i=Ry(s==="object"?`@${e}
`:`@${s} ${e}
`,{}),Ly(r,i),P_(i.id,r.id),Gl("memory","",it.defaultplayer),i}function ls(t){const e=Un("main");return rs(e,t)}function mM(t){const e=Un("main");return Eh(e,t)}function gM(t,e){it.books.clear(),t.forEach(r=>{it.books.set(r.id,r),r.name==="main"&&(it.software.main=r.id)});const n=Jr(e);if(k(n)&&Oc("main",n.id),!it.software.main){const r=it.books.values().next();r.value&&(it.software.main=r.value.id)}}function U_(t){return it.books.set(t.id,t),t.id}function yM(t){const e=Jr(t);e&&it.books.delete(e.id)}function P_(t,e){it.codepageindex.set(t,e)}function _M(t){if(!Se(t)||!t)return et("memory","login",`failed for playerid ==>${t}<==`,t);const e=Ht("main");if(!k(e))return et("memory","login:main","login failed to find book 'main'",t);const n=dc(e,t);if(k(n))return!0;const r=ns(e,"title");if(!k(r))return et("memory","login:title","login failed to find board 'title'",t);const i=fc(e,"player");if(!k(i))return et("memory","login:player","login failed to find object type 'player'",t);const s=i.name??"player",o=Ih(r,{x:0,y:0},s,t);return k(o==null?void 0:o.id)?(o.player=t,kh(e,t,r.id),!0):!1}function D_(t){const e=Ht("main"),n=dc(e,t);kh(e,t,""),po(e,n,Si(n,t)),Zy(n,t),Eh(e,t),Eh(e,R_(t))}function bM(t){const e=Ht("main"),n=Dy(e);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;rf(c)&&k(t[c])===!1&&(t[c]=0,kh(e,c,i.id))}}}function wM(t){Rr.message(t)}function B_(t,e,n,r,i=Ub){if(!k(t)||!k(e)||!k(n))return;const s={...C},o=n.id??"";C.book=t,C.board=e,C.element=n,C.isplayer=rf(o),C.player=n.player??it.defaultplayer;const a=on(t,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=Rh(n);if(Rr.tick(l,go.CODE_PAGE,ve(c)?c:i,u,r),ve(n==null?void 0:n.tickertime)&&C.timestamp-n.tickertime>No*5&&(n.tickertime=0,n.tickertext=""),C.isplayer){const h=ls(C.element.id??"");h.inputcurrent=0}Cb(s).forEach(h=>{C[h]=s[h]})}function vM(){const t=Ht("main");if(!k(t))return;const e=t.timestamp+1,n=Gi.HALT_AT_COUNT;Gi.HALT_AT_COUNT=n*2,it.loaders.forEach((i,s)=>{Rr.tick(s,go.LOADER,1,"loader",i),Rr.isended(s)&&(Rr.halt(s),it.loaders.delete(s))}),Gi.HALT_AT_COUNT=n,t.timestamp=e,C.timestamp=e,Dy(t).forEach(i=>{const s=dN(t,i,e);for(let o=0;o<s.length;++o){const{id:a,type:c,code:l,object:u}=s[o];c===Te.ERROR?Rr.halt(a):B_(t,i,u,l)}})}function EM(){Rr.gc()}function kM(t,e=""){const n=Un("main");if(!k(n))return;const r=`${t}_cli`;C.timestamp=n.timestamp,C.book=n,C.board=dc(n,t),C.element=Si(C.board,t),C.player=t,C.isplayer=!0,bp("memory","running",n.timestamp,r,e),Rr.once(r,go.CLI,"cli",e)}function Cc(t){const e=Un("main"),n=Ei(e,t);if(!k(e)||!k(n)||!k(C.element))return;const r=`${t}_run`,i=Rh(C.element),s=(n==null?void 0:n.code)??"";Rr.once(r,go.CODE_PAGE,i,s)}function SM(t,e,n,r){const i=Ht("main");if(!k(i))return;const s=["binaryfile",n];Ct("memory","looking for stats",...s);const o=iN(i,Te.LOADER).filter(a=>{const c=uo(a);return Object.keys(c).filter(u=>s.includes(Pe(u))).length===s.length});for(let a=0;a<o.length;++a){const c=o[a],l=`${t}_load_${c.id}`;it.binaryfiles.set(l,{filename:e.name,cursor:0,bytes:r,dataview:new DataView(r.buffer)}),Ct("memory","starting loader",i.timestamp,l),it.loaders.set(l,c.code)}}function F_(t){return it.binaryfiles.get(t)}function $_(t,e){function n(r){if(k(e))switch(r){case"text/plain":tM(e).catch(i=>et("memory","crash",i.message));break;case"application/zip":nM(e,i=>$_(t,i)).catch(i=>et("memory","crash",i.message));break;case"application/octet-stream":rM(e,(i,s)=>{SM(t,e,i,s)}).catch(i=>et("memory","crash",i.message));break;default:e.arrayBuffer().then(i=>{const s=C_(e.name,new Uint8Array(i));if(s)n(s);else return et("memory","loadfile",`unsupported file ${e.name}`)}).catch(i=>et("memory","crash",i.message));return}}n((e==null?void 0:e.type)??"")}function AM(t){const e=Ht("main"),n=dc(e,t),r=[];if(!k(e)||!k(n))return r;const i=ns(e,n.over??""),s=ns(e,n.under??""),o=[i,n,s].filter(k);let a=0;for(let c=0;c<o.length;++c){const l=o[c],u=hM(t,a,e,l,l===n);a+=u.length,r.push(...u)}return r}function xM(t){const e=Ht(ze.MAIN),n=rs(e,ze.GADGETSTORE);delete n[t]}Uk(t=>{const e=Ht(ze.MAIN),n=rs(e,ze.GADGETSTORE);let r=n[t];return k(r)||(n[t]=r=Hl()),r});const j_=hs("gadgetserver",["tock"],t=>{const e=Ht(ze.MAIN),n=(e==null?void 0:e.activelist)??[],r=rs(e,ze.GADGETSYNC);switch(t.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=hi(s);o.layers=AM(s);const a=r[s]??{},c=uf(a,o);c.length&&(r[s]=ei(o),tk(j_.name(),c,s))}break;case"desync":t.player&&ek(j_.name(),hi(t.player),t.player);break;case"clearscroll":t.player&&Pk(t.player);break;case"clearplayer":t.player&&xM(t.player);break}});function qh(t,e){function n(r){console.error(r),et(t,"crash",r.message)}e().catch(n)}function TM(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return e+n}function RM(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const IM=new Date("1980/09/02");async function OM(t){return new Promise((e,n)=>{const r=new Hh;for(let i=0;i<t.length;++i){const s=t[i],o=nN(s);if(o){const a=JC(o);k(a)&&r.file(s.id,a,{date:IM})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{e(RM(i))}).catch(n)})}async function CM(t){return new Promise((e,n)=>{const r=new Hh;r.loadAsync(TM(t),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=rN(YC(c));k(l)&&i.push(l)}e(i)}).catch(n)})}const NM=16,Oi={},LM=64;let z_=0;const Ir={},us={};async function Xh(t=""){EM();const e=Ic(),n=Ht(ze.MAIN);if(e.length&&k(n)){const r=await OM(e),i=`${t}${new Date().toISOString()}${n.name} ${r.length} chars`;sk(Pn.name(),i,r,Zr())}}let W_=!1;const Pn=hs("vm",["init","tick","second"],t=>{var e;switch(t.target){case"init":k(t.player)&&!W_&&(W_=!0,t.player,fM(t.player),Pn.reply(t,"ackinit",!0,t.player));break;case"books":t.player===Zr()&&qh("vm:books",async()=>{if(He(t.data)){const[n,r]=t.data,i=await CM(n),s=i.map(o=>o.name);gM(i,r),Qe(Pn.name(),`loading ${s.join(", ")}`),Pn.reply(t,"ackbooks",!0,t.player)}});break;case"login":t.player&&_M(t.player)&&(Oi[t.player]=0,Qe(Pn.name(),`login from ${t.player}`),Pn.reply(t,"acklogin",!0,t.player));break;case"endgame":t.player===Zr()&&qh("vm:endgame",async()=>{t.player&&(D_(t.player),nk("vm",t.player),await Xh(),ck("vm",t.player))});break;case"doot":t.player&&(Oi[t.player]=0,bp(Pn.name(),"active",t.player));break;case"input":if(t.player){const n=ls(t.player),[r=Ft.NONE,i=0]=t.data??[Ft.NONE,0];He(n.inputqueue)||(n.inputqueue=[]),r!==Ft.NONE&&n.inputqueue.push([r,i])}break;case"codewatch":if(t.player&&He(t.data)){const[n,r]=t.data;if(!k(us[r])){const i=wp(n,r);us[r]=Sp(i,s=>{const o=Jr(n),a=Ei(o,r);k(a)&&(a.code=s,tN(a))})}Ir[n]=Ir[n]??{},Ir[n][r]=Ir[n][r]??new Set,Ir[n][r].add(t.player)}break;case"coderelease":if(t.player&&He(t.data)){const[n,r]=t.data;k(Ir[n])&&k(Ir[n][r])&&(Ir[n][r].delete(t.player),Ir[n][r].size===0&&((e=us[r])==null||e.call(us),us[r]=void 0))}break;case"tick":t.player!=="locked"&&vM();break;case"second":{bM(Oi);const n=Object.keys(Oi);for(let r=0;r<n.length;++r)++Oi[n[r]];for(let r=0;r<n.length;++r){const i=n[r];Oi[i]>=NM&&(delete Oi[i],D_(i),Ct(Pn.name(),"player logout",i),Pn.emit("logout",void 0,i))}Pb()===!1&&++z_>=LM&&(z_=0,Gl(Pn.name(),"",Zr()));break}case"flush":t.player===Zr()&&qh("vm:flush",async()=>{Se(t.data)?await Xh(`${t.data} `):await Xh()});break;case"cli":t.player===Zr()&&kM(t.player,t.data);break;case"loadfile":t.player===Zr()&&$_(t.player,t.data);break;default:wM(t);break}});function MM(){ik(Pn.name(),Zr())}const{forward:UM}=Mb(t=>postMessage(t));onmessage=function(e){UM(e.data)},setTimeout(MM,100)})();

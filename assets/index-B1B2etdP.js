var Kme=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Wlt=Kme((Vd,Jl)=>{function Xme(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Zp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function su(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ZQ(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var WP={exports:{}},mT={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nj;function Yme(){if(Nj)return mT;Nj=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:s}}return mT.Fragment=e,mT.jsx=n,mT.jsxs=n,mT}var Pj;function Zme(){return Pj||(Pj=1,WP.exports=Yme()),WP.exports}var ke=Zme();function Jme(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var JQ={exports:{}},Cc=JQ.exports={},f0,h0;function qU(){throw new Error("setTimeout has not been defined")}function VU(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?f0=setTimeout:f0=qU}catch{f0=qU}try{typeof clearTimeout=="function"?h0=clearTimeout:h0=VU}catch{h0=VU}})();function QQ(t){if(f0===setTimeout)return setTimeout(t,0);if((f0===qU||!f0)&&setTimeout)return f0=setTimeout,setTimeout(t,0);try{return f0(t,0)}catch{try{return f0.call(null,t,0)}catch{return f0.call(this,t,0)}}}function Qme(t){if(h0===clearTimeout)return clearTimeout(t);if((h0===VU||!h0)&&clearTimeout)return h0=clearTimeout,clearTimeout(t);try{return h0(t)}catch{try{return h0.call(null,t)}catch{return h0.call(this,t)}}}var lv=[],PS=!1,d1,lO=-1;function ege(){!PS||!d1||(PS=!1,d1.length?lv=d1.concat(lv):lO=-1,lv.length&&eee())}function eee(){if(!PS){var t=QQ(ege);PS=!0;for(var e=lv.length;e;){for(d1=lv,lv=[];++lO<e;)d1&&d1[lO].run();lO=-1,e=lv.length}d1=null,PS=!1,Qme(t)}}Cc.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];lv.push(new tee(t,e)),lv.length===1&&!PS&&QQ(eee)};function tee(t,e){this.fun=t,this.array=e}tee.prototype.run=function(){this.fun.apply(null,this.array)};Cc.title="browser";Cc.browser=!0;Cc.env={};Cc.argv=[];Cc.version="";Cc.versions={};function Pv(){}Cc.on=Pv;Cc.addListener=Pv;Cc.once=Pv;Cc.off=Pv;Cc.removeListener=Pv;Cc.removeAllListeners=Pv;Cc.emit=Pv;Cc.prependListener=Pv;Cc.prependOnceListener=Pv;Cc.listeners=function(t){return[]};Cc.binding=function(t){throw new Error("process.binding is not supported")};Cc.cwd=function(){return"/"};Cc.chdir=function(t){throw new Error("process.chdir is not supported")};Cc.umask=function(){return 0};var tge=JQ.exports;const Sa=Jme(tge);var KP={exports:{}},gi={},Dj;function nge(){if(Dj)return gi;Dj=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function d(W){return W===null||typeof W!="object"?null:(W=h&&W[h]||W["@@iterator"],typeof W=="function"?W:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,g={};function y(W,$,J){this.props=W,this.context=$,this.refs=g,this.updater=J||m}y.prototype.isReactComponent={},y.prototype.setState=function(W,$){if(typeof W!="object"&&typeof W!="function"&&W!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,W,$,"setState")},y.prototype.forceUpdate=function(W){this.updater.enqueueForceUpdate(this,W,"forceUpdate")};function v(){}v.prototype=y.prototype;function x(W,$,J){this.props=W,this.context=$,this.refs=g,this.updater=J||m}var E=x.prototype=new v;E.constructor=x,p(E,y.prototype),E.isPureReactComponent=!0;var C=Array.isArray,A={H:null,A:null,T:null,S:null,V:null},k=Object.prototype.hasOwnProperty;function M(W,$,J,ne,ie,ae){return J=ae.ref,{$$typeof:t,type:W,key:$,ref:J!==void 0?J:null,props:ae}}function I(W,$){return M(W.type,$,void 0,void 0,void 0,W.props)}function z(W){return typeof W=="object"&&W!==null&&W.$$typeof===t}function H(W){var $={"=":"=0",":":"=2"};return"$"+W.replace(/[=:]/g,function(J){return $[J]})}var K=/\/+/g;function P(W,$){return typeof W=="object"&&W!==null&&W.key!=null?H(""+W.key):$.toString(36)}function F(){}function N(W){switch(W.status){case"fulfilled":return W.value;case"rejected":throw W.reason;default:switch(typeof W.status=="string"?W.then(F,F):(W.status="pending",W.then(function($){W.status==="pending"&&(W.status="fulfilled",W.value=$)},function($){W.status==="pending"&&(W.status="rejected",W.reason=$)})),W.status){case"fulfilled":return W.value;case"rejected":throw W.reason}}throw W}function X(W,$,J,ne,ie){var ae=typeof W;(ae==="undefined"||ae==="boolean")&&(W=null);var xe=!1;if(W===null)xe=!0;else switch(ae){case"bigint":case"string":case"number":xe=!0;break;case"object":switch(W.$$typeof){case t:case e:xe=!0;break;case u:return xe=W._init,X(xe(W._payload),$,J,ne,ie)}}if(xe)return ie=ie(W),xe=ne===""?"."+P(W,0):ne,C(ie)?(J="",xe!=null&&(J=xe.replace(K,"$&/")+"/"),X(ie,$,J,"",function(Se){return Se})):ie!=null&&(z(ie)&&(ie=I(ie,J+(ie.key==null||W&&W.key===ie.key?"":(""+ie.key).replace(K,"$&/")+"/")+xe)),$.push(ie)),1;xe=0;var Ne=ne===""?".":ne+":";if(C(W))for(var Re=0;Re<W.length;Re++)ne=W[Re],ae=Ne+P(ne,Re),xe+=X(ne,$,J,ae,ie);else if(Re=d(W),typeof Re=="function")for(W=Re.call(W),Re=0;!(ne=W.next()).done;)ne=ne.value,ae=Ne+P(ne,Re++),xe+=X(ne,$,J,ae,ie);else if(ae==="object"){if(typeof W.then=="function")return X(N(W),$,J,ne,ie);throw $=String(W),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(W).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return xe}function G(W,$,J){if(W==null)return W;var ne=[],ie=0;return X(W,ne,"","",function(ae){return $.call(J,ae,ie++)}),ne}function j(W){if(W._status===-1){var $=W._result;$=$(),$.then(function(J){(W._status===0||W._status===-1)&&(W._status=1,W._result=J)},function(J){(W._status===0||W._status===-1)&&(W._status=2,W._result=J)}),W._status===-1&&(W._status=0,W._result=$)}if(W._status===1)return W._result.default;throw W._result}var q=typeof reportError=="function"?reportError:function(W){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof W=="object"&&W!==null&&typeof W.message=="string"?String(W.message):String(W),error:W});if(!window.dispatchEvent($))return}else if(typeof Sa=="object"&&typeof Sa.emit=="function"){Sa.emit("uncaughtException",W);return}console.error(W)};function te(){}return gi.Children={map:G,forEach:function(W,$,J){G(W,function(){$.apply(this,arguments)},J)},count:function(W){var $=0;return G(W,function(){$++}),$},toArray:function(W){return G(W,function($){return $})||[]},only:function(W){if(!z(W))throw Error("React.Children.only expected to receive a single React element child.");return W}},gi.Component=y,gi.Fragment=n,gi.Profiler=i,gi.PureComponent=x,gi.StrictMode=r,gi.Suspense=c,gi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,gi.__COMPILER_RUNTIME={__proto__:null,c:function(W){return A.H.useMemoCache(W)}},gi.cache=function(W){return function(){return W.apply(null,arguments)}},gi.cloneElement=function(W,$,J){if(W==null)throw Error("The argument must be a React element, but you passed "+W+".");var ne=p({},W.props),ie=W.key,ae=void 0;if($!=null)for(xe in $.ref!==void 0&&(ae=void 0),$.key!==void 0&&(ie=""+$.key),$)!k.call($,xe)||xe==="key"||xe==="__self"||xe==="__source"||xe==="ref"&&$.ref===void 0||(ne[xe]=$[xe]);var xe=arguments.length-2;if(xe===1)ne.children=J;else if(1<xe){for(var Ne=Array(xe),Re=0;Re<xe;Re++)Ne[Re]=arguments[Re+2];ne.children=Ne}return M(W.type,ie,void 0,void 0,ae,ne)},gi.createContext=function(W){return W={$$typeof:o,_currentValue:W,_currentValue2:W,_threadCount:0,Provider:null,Consumer:null},W.Provider=W,W.Consumer={$$typeof:s,_context:W},W},gi.createElement=function(W,$,J){var ne,ie={},ae=null;if($!=null)for(ne in $.key!==void 0&&(ae=""+$.key),$)k.call($,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(ie[ne]=$[ne]);var xe=arguments.length-2;if(xe===1)ie.children=J;else if(1<xe){for(var Ne=Array(xe),Re=0;Re<xe;Re++)Ne[Re]=arguments[Re+2];ie.children=Ne}if(W&&W.defaultProps)for(ne in xe=W.defaultProps,xe)ie[ne]===void 0&&(ie[ne]=xe[ne]);return M(W,ae,void 0,void 0,null,ie)},gi.createRef=function(){return{current:null}},gi.forwardRef=function(W){return{$$typeof:a,render:W}},gi.isValidElement=z,gi.lazy=function(W){return{$$typeof:u,_payload:{_status:-1,_result:W},_init:j}},gi.memo=function(W,$){return{$$typeof:l,type:W,compare:$===void 0?null:$}},gi.startTransition=function(W){var $=A.T,J={};A.T=J;try{var ne=W(),ie=A.S;ie!==null&&ie(J,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then(te,q)}catch(ae){q(ae)}finally{A.T=$}},gi.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},gi.use=function(W){return A.H.use(W)},gi.useActionState=function(W,$,J){return A.H.useActionState(W,$,J)},gi.useCallback=function(W,$){return A.H.useCallback(W,$)},gi.useContext=function(W){return A.H.useContext(W)},gi.useDebugValue=function(){},gi.useDeferredValue=function(W,$){return A.H.useDeferredValue(W,$)},gi.useEffect=function(W,$,J){var ne=A.H;if(typeof J=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ne.useEffect(W,$)},gi.useId=function(){return A.H.useId()},gi.useImperativeHandle=function(W,$,J){return A.H.useImperativeHandle(W,$,J)},gi.useInsertionEffect=function(W,$){return A.H.useInsertionEffect(W,$)},gi.useLayoutEffect=function(W,$){return A.H.useLayoutEffect(W,$)},gi.useMemo=function(W,$){return A.H.useMemo(W,$)},gi.useOptimistic=function(W,$){return A.H.useOptimistic(W,$)},gi.useReducer=function(W,$,J){return A.H.useReducer(W,$,J)},gi.useRef=function(W){return A.H.useRef(W)},gi.useState=function(W){return A.H.useState(W)},gi.useSyncExternalStore=function(W,$,J){return A.H.useSyncExternalStore(W,$,J)},gi.useTransition=function(){return A.H.useTransition()},gi.version="19.1.1",gi}var Lj;function n3(){return Lj||(Lj=1,KP.exports=nge()),KP.exports}var et=n3();const zd=su(et);var XP={exports:{}},k_={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uj;function rge(){return Uj||(Uj=1,k_.ConcurrentRoot=1,k_.ContinuousEventPriority=8,k_.DefaultEventPriority=32,k_.DiscreteEventPriority=2,k_.IdleEventPriority=268435456,k_.LegacyRoot=0,k_.NoEventPriority=0),k_}var Bj;function ige(){return Bj||(Bj=1,XP.exports=rge()),XP.exports}var uO=ige();/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const EM="176",sge=0,Fj=1,oge=2,age=0,$B=1,fO=2,l0=3,wv=0,Ql=1,Zl=2,Ou=0,DS=1,jj=2,zj=3,Hj=4,cge=5,c1=100,lge=101,uge=102,fge=103,hge=104,dge=200,pge=201,mge=202,gge=203,GU=204,$U=205,_ge=206,vge=207,yge=208,bge=209,Ege=210,Sge=211,xge=212,Tge=213,wge=214,WU=0,KU=1,XU=2,YS=3,YU=4,ZU=5,JU=6,QU=7,nee=0,Rge=1,Cge=2,gv=0,Age=1,Mge=2,kge=3,ree=4,Oge=5,Ige=6,Nge=7,iee=300,ZS=301,JS=302,e6=303,t6=304,r3=306,hI=1e3,p1=1001,n6=1002,rf=1003,Pge=1004,k2=1005,nf=1006,YP=1007,m1=1008,xa=1009,see=1010,oee=1011,gA=1012,WB=1013,Wy=1014,hg=1015,ab=1016,KB=1017,XB=1018,QS=1020,aee=35902,cee=1021,lee=1022,Vf=1023,_A=1026,ex=1027,SM=1028,YB=1029,ZB=1030,JB=1031,i3=1033,hO=33776,dO=33777,pO=33778,mO=33779,r6=35840,i6=35841,s6=35842,o6=35843,a6=36196,c6=37492,l6=37496,u6=37808,f6=37809,h6=37810,d6=37811,p6=37812,m6=37813,g6=37814,_6=37815,v6=37816,y6=37817,b6=37818,E6=37819,S6=37820,x6=37821,gO=36492,T6=36494,w6=36495,uee=36283,R6=36284,C6=36285,A6=36286,iE=3200,Dge=3201,Lge=0,Uge=1,b0="",rs="srgb",Rv="srgb-linear",dI="linear",fo="srgb",PE=7680,qj=519,Bge=512,Fge=513,jge=514,fee=515,zge=516,Hge=517,qge=518,Vge=519,Vj=35044,Gj=35048,$j="300 es",uv=2e3,pI=2001;class Dv{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){const r=this._listeners;if(r===void 0)return;const i=r[e];if(i!==void 0){const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const n=this._listeners;if(n===void 0)return;const r=n[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const Xu=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Wj=1234567;const tA=Math.PI/180,vA=180/Math.PI;function jx(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Xu[t&255]+Xu[t>>8&255]+Xu[t>>16&255]+Xu[t>>24&255]+"-"+Xu[e&255]+Xu[e>>8&255]+"-"+Xu[e>>16&15|64]+Xu[e>>24&255]+"-"+Xu[n&63|128]+Xu[n>>8&255]+"-"+Xu[n>>16&255]+Xu[n>>24&255]+Xu[r&255]+Xu[r>>8&255]+Xu[r>>16&255]+Xu[r>>24&255]).toLowerCase()}function Ki(t,e,n){return Math.max(e,Math.min(n,t))}function QB(t,e){return(t%e+e)%e}function Gge(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)}function $ge(t,e,n){return t!==e?(n-t)/(e-t):0}function nA(t,e,n){return(1-n)*t+n*e}function Wge(t,e,n,r){return nA(t,e,1-Math.exp(-n*r))}function Kge(t,e=1){return e-Math.abs(QB(t,e*2)-e)}function Xge(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function Yge(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function Zge(t,e){return t+Math.floor(Math.random()*(e-t+1))}function Jge(t,e){return t+Math.random()*(e-t)}function Qge(t){return t*(.5-Math.random())}function e0e(t){t!==void 0&&(Wj=t);let e=Wj+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function t0e(t){return t*tA}function n0e(t){return t*vA}function r0e(t){return(t&t-1)===0&&t!==0}function i0e(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function s0e(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function o0e(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),c=o(n/2),l=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),d=o((e-r)/2),m=s((r-e)/2),p=o((r-e)/2);switch(i){case"XYX":t.set(a*u,c*h,c*d,a*l);break;case"YZY":t.set(c*d,a*u,c*h,a*l);break;case"ZXZ":t.set(c*h,c*d,a*u,a*l);break;case"XZX":t.set(a*u,c*p,c*m,a*l);break;case"YXY":t.set(c*m,a*u,c*p,a*l);break;case"ZYZ":t.set(c*p,c*m,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function hS(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Pf(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const a0e={DEG2RAD:tA,RAD2DEG:vA,generateUUID:jx,clamp:Ki,euclideanModulo:QB,mapLinear:Gge,inverseLerp:$ge,lerp:nA,damp:Wge,pingpong:Kge,smoothstep:Xge,smootherstep:Yge,randInt:Zge,randFloat:Jge,randFloatSpread:Qge,seededRandom:e0e,degToRad:t0e,radToDeg:n0e,isPowerOfTwo:r0e,ceilPowerOfTwo:i0e,floorPowerOfTwo:s0e,setQuaternionFromProperEuler:o0e,normalize:Pf,denormalize:hS};class Vn{constructor(e=0,n=0){Vn.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Ki(this.x,e.x,n.x),this.y=Ki(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Ki(this.x,e,n),this.y=Ki(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Ki(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Ki(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class _i{constructor(e,n,r,i,s,o,a,c,l){_i.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],h=r[7],d=r[2],m=r[5],p=r[8],g=i[0],y=i[3],v=i[6],x=i[1],E=i[4],C=i[7],A=i[2],k=i[5],M=i[8];return s[0]=o*g+a*x+c*A,s[3]=o*y+a*E+c*k,s[6]=o*v+a*C+c*M,s[1]=l*g+u*x+h*A,s[4]=l*y+u*E+h*k,s[7]=l*v+u*C+h*M,s[2]=d*g+m*x+p*A,s[5]=d*y+m*E+p*k,s[8]=d*v+m*C+p*M,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,d=a*c-u*s,m=l*s-o*c,p=n*h+r*d+i*m;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/p;return e[0]=h*g,e[1]=(i*l-u*r)*g,e[2]=(a*r-i*o)*g,e[3]=d*g,e[4]=(u*n-i*c)*g,e[5]=(i*s-a*n)*g,e[6]=m*g,e[7]=(r*c-l*n)*g,e[8]=(o*n-r*s)*g,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(ZP.makeScale(e,n)),this}rotate(e){return this.premultiply(ZP.makeRotation(-e)),this}translate(e,n){return this.premultiply(ZP.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const ZP=new _i;function hee(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function yA(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function c0e(){const t=yA("canvas");return t.style.display="block",t}const Kj={};function _O(t){t in Kj||(Kj[t]=!0,console.warn(t))}function l0e(t,e,n){return new Promise(function(r,i){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:i();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:r()}}setTimeout(s,n)})}function u0e(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function f0e(t){const e=t.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const Xj=new _i().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Yj=new _i().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function h0e(){const t={enabled:!0,workingColorSpace:Rv,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===fo&&(i.r=_v(i.r),i.g=_v(i.g),i.b=_v(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===fo&&(i.r=LS(i.r),i.g=LS(i.g),i.b=LS(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===b0?dI:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[Rv]:{primaries:e,whitePoint:r,transfer:dI,toXYZ:Xj,fromXYZ:Yj,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:rs},outputColorSpaceConfig:{drawingBufferColorSpace:rs}},[rs]:{primaries:e,whitePoint:r,transfer:fo,toXYZ:Xj,fromXYZ:Yj,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:rs}}}),t}const xs=h0e();function _v(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function LS(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let DE;class d0e{static getDataURL(e,n="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{DE===void 0&&(DE=yA("canvas")),DE.width=e.width,DE.height=e.height;const i=DE.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),r=DE}return r.toDataURL(n)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=yA("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=_v(s[o]/255)*255;return r.putImageData(i,0,0),n}else if(e.data){const n=e.data.slice(0);for(let r=0;r<n.length;r++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[r]=Math.floor(_v(n[r]/255)*255):n[r]=_v(n[r]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let p0e=0,e8=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:p0e++}),this.uuid=jx(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(JP(i[o].image)):s.push(JP(i[o]))}else s=JP(i);r.url=s}return n||(e.images[this.uuid]=r),r}};function JP(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?d0e.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let m0e=0;class El extends Dv{constructor(e=El.DEFAULT_IMAGE,n=El.DEFAULT_MAPPING,r=p1,i=p1,s=nf,o=m1,a=Vf,c=xa,l=El.DEFAULT_ANISOTROPY,u=b0){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:m0e++}),this.uuid=jx(),this.name="",this.source=new e8(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new Vn(0,0),this.repeat=new Vn(1,1),this.center=new Vn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new _i,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isTextureArray=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isTextureArray=e.isTextureArray,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),n||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==iee)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case hI:e.x=e.x-Math.floor(e.x);break;case p1:e.x=e.x<0?0:1;break;case n6:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case hI:e.y=e.y-Math.floor(e.y);break;case p1:e.y=e.y<0?0:1;break;case n6:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}El.DEFAULT_IMAGE=null;El.DEFAULT_MAPPING=iee;El.DEFAULT_ANISOTROPY=1;class La{constructor(e=0,n=0,r=0,i=1){La.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,r,i){return this.x=e,this.y=n,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*n+o[4]*r+o[8]*i+o[12]*s,this.y=o[1]*n+o[5]*r+o[9]*i+o[13]*s,this.z=o[2]*n+o[6]*r+o[10]*i+o[14]*s,this.w=o[3]*n+o[7]*r+o[11]*i+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,r,i,s;const c=e.elements,l=c[0],u=c[4],h=c[8],d=c[1],m=c[5],p=c[9],g=c[2],y=c[6],v=c[10];if(Math.abs(u-d)<.01&&Math.abs(h-g)<.01&&Math.abs(p-y)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+g)<.1&&Math.abs(p+y)<.1&&Math.abs(l+m+v-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const E=(l+1)/2,C=(m+1)/2,A=(v+1)/2,k=(u+d)/4,M=(h+g)/4,I=(p+y)/4;return E>C&&E>A?E<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(E),i=k/r,s=M/r):C>A?C<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(C),r=k/i,s=I/i):A<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(A),r=M/s,i=I/s),this.set(r,i,s,n),this}let x=Math.sqrt((y-p)*(y-p)+(h-g)*(h-g)+(d-u)*(d-u));return Math.abs(x)<.001&&(x=1),this.x=(y-p)/x,this.y=(h-g)/x,this.z=(d-u)/x,this.w=Math.acos((l+m+v-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Ki(this.x,e.x,n.x),this.y=Ki(this.y,e.y,n.y),this.z=Ki(this.z,e.z,n.z),this.w=Ki(this.w,e.w,n.w),this}clampScalar(e,n){return this.x=Ki(this.x,e,n),this.y=Ki(this.y,e,n),this.z=Ki(this.z,e,n),this.w=Ki(this.w,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Ki(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this.w=e.w+(n.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class g0e extends Dv{constructor(e=1,n=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=r.depth?r.depth:1,this.scissor=new La(0,0,e,n),this.scissorTest=!1,this.viewport=new La(0,0,e,n);const i={width:e,height:n,depth:this.depth};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:nf,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,multiview:!1},r);const s=new El(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const o=r.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,n,r=1){if(this.width!==e||this.height!==n||this.depth!==r){this.width=e,this.height=n,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=n,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,r=e.textures.length;n<r;n++){this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0,this.textures[n].renderTarget=this;const i=Object.assign({},e.textures[n].image);this.textures[n].source=new e8(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Iu extends g0e{constructor(e=1,n=1,r={}){super(e,n,r),this.isWebGLRenderTarget=!0}}class dee extends El{constructor(e=null,n=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=rf,this.minFilter=rf,this.wrapR=p1,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class _0e extends El{constructor(e=null,n=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=rf,this.minFilter=rf,this.wrapR=p1,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class zx{constructor(e=0,n=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=i}static slerpFlat(e,n,r,i,s,o,a){let c=r[i+0],l=r[i+1],u=r[i+2],h=r[i+3];const d=s[o+0],m=s[o+1],p=s[o+2],g=s[o+3];if(a===0){e[n+0]=c,e[n+1]=l,e[n+2]=u,e[n+3]=h;return}if(a===1){e[n+0]=d,e[n+1]=m,e[n+2]=p,e[n+3]=g;return}if(h!==g||c!==d||l!==m||u!==p){let y=1-a;const v=c*d+l*m+u*p+h*g,x=v>=0?1:-1,E=1-v*v;if(E>Number.EPSILON){const A=Math.sqrt(E),k=Math.atan2(A,v*x);y=Math.sin(y*k)/A,a=Math.sin(a*k)/A}const C=a*x;if(c=c*y+d*C,l=l*y+m*C,u=u*y+p*C,h=h*y+g*C,y===1-a){const A=1/Math.sqrt(c*c+l*l+u*u+h*h);c*=A,l*=A,u*=A,h*=A}}e[n]=c,e[n+1]=l,e[n+2]=u,e[n+3]=h}static multiplyQuaternionsFlat(e,n,r,i,s,o){const a=r[i],c=r[i+1],l=r[i+2],u=r[i+3],h=s[o],d=s[o+1],m=s[o+2],p=s[o+3];return e[n]=a*p+u*h+c*m-l*d,e[n+1]=c*p+u*d+l*h-a*m,e[n+2]=l*p+u*m+a*d-c*h,e[n+3]=u*p-a*h-c*d-l*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,r,i){return this._x=e,this._y=n,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const r=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(r/2),u=a(i/2),h=a(s/2),d=c(r/2),m=c(i/2),p=c(s/2);switch(o){case"XYZ":this._x=d*u*h+l*m*p,this._y=l*m*h-d*u*p,this._z=l*u*p+d*m*h,this._w=l*u*h-d*m*p;break;case"YXZ":this._x=d*u*h+l*m*p,this._y=l*m*h-d*u*p,this._z=l*u*p-d*m*h,this._w=l*u*h+d*m*p;break;case"ZXY":this._x=d*u*h-l*m*p,this._y=l*m*h+d*u*p,this._z=l*u*p+d*m*h,this._w=l*u*h-d*m*p;break;case"ZYX":this._x=d*u*h-l*m*p,this._y=l*m*h+d*u*p,this._z=l*u*p-d*m*h,this._w=l*u*h+d*m*p;break;case"YZX":this._x=d*u*h+l*m*p,this._y=l*m*h+d*u*p,this._z=l*u*p-d*m*h,this._w=l*u*h-d*m*p;break;case"XZY":this._x=d*u*h-l*m*p,this._y=l*m*h-d*u*p,this._z=l*u*p+d*m*h,this._w=l*u*h+d*m*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const r=n/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,r=n[0],i=n[4],s=n[8],o=n[1],a=n[5],c=n[9],l=n[2],u=n[6],h=n[10],d=r+a+h;if(d>0){const m=.5/Math.sqrt(d+1);this._w=.25/m,this._x=(u-c)*m,this._y=(s-l)*m,this._z=(o-i)*m}else if(r>a&&r>h){const m=2*Math.sqrt(1+r-a-h);this._w=(u-c)/m,this._x=.25*m,this._y=(i+o)/m,this._z=(s+l)/m}else if(a>h){const m=2*Math.sqrt(1+a-r-h);this._w=(s-l)/m,this._x=(i+o)/m,this._y=.25*m,this._z=(c+u)/m}else{const m=2*Math.sqrt(1+h-r-a);this._w=(o-i)/m,this._x=(s+l)/m,this._y=(c+u)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let r=e.dot(n)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ki(this.dot(e),-1,1)))}rotateTowards(e,n){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,n/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const r=e._x,i=e._y,s=e._z,o=e._w,a=n._x,c=n._y,l=n._z,u=n._w;return this._x=r*u+o*a+i*l-s*c,this._y=i*u+o*c+s*a-r*l,this._z=s*u+o*l+r*c-i*a,this._w=o*u-r*a-i*c-s*l,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+r*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const m=1-n;return this._w=m*o+n*this._w,this._x=m*r+n*this._x,this._y=m*i+n*this._y,this._z=m*s+n*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),h=Math.sin((1-n)*u)/l,d=Math.sin(n*u)/l;return this._w=o*h+this._w*d,this._x=r*h+this._x*d,this._y=i*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,n,r){return this.copy(e).slerp(n,r)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(n),s*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class jt{constructor(e=0,n=0,r=0){jt.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(e,n,r){return r===void 0&&(r=this.z),this.x=e,this.y=n,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(Zj.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(Zj.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*n+s[3]*r+s[6]*i,this.y=s[1]*n+s[4]*r+s[7]*i,this.z=s[2]*n+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,s=e.elements,o=1/(s[3]*n+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*n+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*n+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*n+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(e){const n=this.x,r=this.y,i=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*i-a*r),u=2*(a*n-s*i),h=2*(s*r-o*n);return this.x=n+c*l+o*h-a*u,this.y=r+c*u+a*l-s*h,this.z=i+c*h+s*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*n+s[4]*r+s[8]*i,this.y=s[1]*n+s[5]*r+s[9]*i,this.z=s[2]*n+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Ki(this.x,e.x,n.x),this.y=Ki(this.y,e.y,n.y),this.z=Ki(this.z,e.z,n.z),this}clampScalar(e,n){return this.x=Ki(this.x,e,n),this.y=Ki(this.y,e,n),this.z=Ki(this.z,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Ki(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const r=e.x,i=e.y,s=e.z,o=n.x,a=n.y,c=n.z;return this.x=i*c-s*a,this.y=s*o-r*c,this.z=r*a-i*o,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const r=e.dot(this)/n;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return QP.copy(this).projectOnVector(e),this.sub(QP)}reflect(e){return this.sub(QP.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Ki(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return n*n+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,r){const i=Math.sin(n)*e;return this.x=i*Math.sin(r),this.y=Math.cos(n)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,r){return this.x=e*Math.sin(n),this.y=r,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=r,this.z=i,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,r=Math.sqrt(1-n*n);return this.x=r*Math.cos(e),this.y=n,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const QP=new jt,Zj=new zx;class sE{constructor(e=new jt(1/0,1/0,1/0),n=new jt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n+=3)this.expandByPoint(Zm.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,r=e.count;n<r;n++)this.expandByPoint(Zm.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=Zm.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(n===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Zm):Zm.fromBufferAttribute(s,o),Zm.applyMatrix4(e.matrixWorld),this.expandByPoint(Zm);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),O2.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),O2.copy(r.boundingBox)),O2.applyMatrix4(e.matrixWorld),this.union(O2)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Zm),Zm.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,r;return e.normal.x>0?(n=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),n<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(gT),I2.subVectors(this.max,gT),LE.subVectors(e.a,gT),UE.subVectors(e.b,gT),BE.subVectors(e.c,gT),oy.subVectors(UE,LE),ay.subVectors(BE,UE),Ob.subVectors(LE,BE);let n=[0,-oy.z,oy.y,0,-ay.z,ay.y,0,-Ob.z,Ob.y,oy.z,0,-oy.x,ay.z,0,-ay.x,Ob.z,0,-Ob.x,-oy.y,oy.x,0,-ay.y,ay.x,0,-Ob.y,Ob.x,0];return!eD(n,LE,UE,BE,I2)||(n=[1,0,0,0,1,0,0,0,1],!eD(n,LE,UE,BE,I2))?!1:(N2.crossVectors(oy,ay),n=[N2.x,N2.y,N2.z],eD(n,LE,UE,BE,I2))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Zm).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Zm).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(O_[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),O_[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),O_[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),O_[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),O_[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),O_[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),O_[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),O_[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(O_),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const O_=[new jt,new jt,new jt,new jt,new jt,new jt,new jt,new jt],Zm=new jt,O2=new sE,LE=new jt,UE=new jt,BE=new jt,oy=new jt,ay=new jt,Ob=new jt,gT=new jt,I2=new jt,N2=new jt,Ib=new jt;function eD(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){Ib.fromArray(t,s);const a=i.x*Math.abs(Ib.x)+i.y*Math.abs(Ib.y)+i.z*Math.abs(Ib.z),c=e.dot(Ib),l=n.dot(Ib),u=r.dot(Ib);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const v0e=new sE,_T=new jt,tD=new jt;class Hx{constructor(e=new jt,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const r=this.center;n!==void 0?r.copy(n):v0e.setFromPoints(e).getCenter(r);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const r=this.center.distanceToSquared(e);return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;_T.subVectors(e,this.center);const n=_T.lengthSq();if(n>this.radius*this.radius){const r=Math.sqrt(n),i=(r-this.radius)*.5;this.center.addScaledVector(_T,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(tD.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_T.copy(e.center).add(tD)),this.expandByPoint(_T.copy(e.center).sub(tD))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const I_=new jt,nD=new jt,P2=new jt,cy=new jt,rD=new jt,D2=new jt,iD=new jt;class t8{constructor(e=new jt,n=new jt(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,I_)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=I_.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(I_.copy(this.origin).addScaledVector(this.direction,n),I_.distanceToSquared(e))}distanceSqToSegment(e,n,r,i){nD.copy(e).add(n).multiplyScalar(.5),P2.copy(n).sub(e).normalize(),cy.copy(this.origin).sub(nD);const s=e.distanceTo(n)*.5,o=-this.direction.dot(P2),a=cy.dot(this.direction),c=-cy.dot(P2),l=cy.lengthSq(),u=Math.abs(1-o*o);let h,d,m,p;if(u>0)if(h=o*c-a,d=o*a-c,p=s*u,h>=0)if(d>=-p)if(d<=p){const g=1/u;h*=g,d*=g,m=h*(h+o*d+2*a)+d*(o*h+d+2*c)+l}else d=s,h=Math.max(0,-(o*d+a)),m=-h*h+d*(d+2*c)+l;else d=-s,h=Math.max(0,-(o*d+a)),m=-h*h+d*(d+2*c)+l;else d<=-p?(h=Math.max(0,-(-o*s+a)),d=h>0?-s:Math.min(Math.max(-s,-c),s),m=-h*h+d*(d+2*c)+l):d<=p?(h=0,d=Math.min(Math.max(-s,-c),s),m=d*(d+2*c)+l):(h=Math.max(0,-(o*s+a)),d=h>0?s:Math.min(Math.max(-s,-c),s),m=-h*h+d*(d+2*c)+l);else d=o>0?-s:s,h=Math.max(0,-(o*d+a)),m=-h*h+d*(d+2*c)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(nD).addScaledVector(P2,d),m}intersectSphere(e,n){I_.subVectors(e.center,this.origin);const r=I_.dot(this.direction),i=I_.dot(I_)-r*r,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=r-o,c=r+o;return c<0?null:a<0?this.at(c,n):this.at(a,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/n;return r>=0?r:null}intersectPlane(e,n){const r=this.distanceToPlane(e);return r===null?null:this.at(r,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let r,i,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(r=(e.min.x-d.x)*l,i=(e.max.x-d.x)*l):(r=(e.max.x-d.x)*l,i=(e.min.x-d.x)*l),u>=0?(s=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),r>o||s>i||((s>r||isNaN(r))&&(r=s),(o<i||isNaN(i))&&(i=o),h>=0?(a=(e.min.z-d.z)*h,c=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,c=(e.min.z-d.z)*h),r>c||a>i)||((a>r||r!==r)&&(r=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(r>=0?r:i,n)}intersectsBox(e){return this.intersectBox(e,I_)!==null}intersectTriangle(e,n,r,i,s){rD.subVectors(n,e),D2.subVectors(r,e),iD.crossVectors(rD,D2);let o=this.direction.dot(iD),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;cy.subVectors(this.origin,e);const c=a*this.direction.dot(D2.crossVectors(cy,D2));if(c<0)return null;const l=a*this.direction.dot(rD.cross(cy));if(l<0||c+l>o)return null;const u=-a*cy.dot(iD);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ks{constructor(e,n,r,i,s,o,a,c,l,u,h,d,m,p,g,y){Ks.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l,u,h,d,m,p,g,y)}set(e,n,r,i,s,o,a,c,l,u,h,d,m,p,g,y){const v=this.elements;return v[0]=e,v[4]=n,v[8]=r,v[12]=i,v[1]=s,v[5]=o,v[9]=a,v[13]=c,v[2]=l,v[6]=u,v[10]=h,v[14]=d,v[3]=m,v[7]=p,v[11]=g,v[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ks().fromArray(this.elements)}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this}copyPosition(e){const n=this.elements,r=e.elements;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,r){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,n,r){return this.set(e.x,n.x,r.x,0,e.y,n.y,r.y,0,e.z,n.z,r.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,r=e.elements,i=1/FE.setFromMatrixColumn(e,0).length(),s=1/FE.setFromMatrixColumn(e,1).length(),o=1/FE.setFromMatrixColumn(e,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*s,n[5]=r[5]*s,n[6]=r[6]*s,n[7]=0,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),a=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=o*u,m=o*h,p=a*u,g=a*h;n[0]=c*u,n[4]=-c*h,n[8]=l,n[1]=m+p*l,n[5]=d-g*l,n[9]=-a*c,n[2]=g-d*l,n[6]=p+m*l,n[10]=o*c}else if(e.order==="YXZ"){const d=c*u,m=c*h,p=l*u,g=l*h;n[0]=d+g*a,n[4]=p*a-m,n[8]=o*l,n[1]=o*h,n[5]=o*u,n[9]=-a,n[2]=m*a-p,n[6]=g+d*a,n[10]=o*c}else if(e.order==="ZXY"){const d=c*u,m=c*h,p=l*u,g=l*h;n[0]=d-g*a,n[4]=-o*h,n[8]=p+m*a,n[1]=m+p*a,n[5]=o*u,n[9]=g-d*a,n[2]=-o*l,n[6]=a,n[10]=o*c}else if(e.order==="ZYX"){const d=o*u,m=o*h,p=a*u,g=a*h;n[0]=c*u,n[4]=p*l-m,n[8]=d*l+g,n[1]=c*h,n[5]=g*l+d,n[9]=m*l-p,n[2]=-l,n[6]=a*c,n[10]=o*c}else if(e.order==="YZX"){const d=o*c,m=o*l,p=a*c,g=a*l;n[0]=c*u,n[4]=g-d*h,n[8]=p*h+m,n[1]=h,n[5]=o*u,n[9]=-a*u,n[2]=-l*u,n[6]=m*h+p,n[10]=d-g*h}else if(e.order==="XZY"){const d=o*c,m=o*l,p=a*c,g=a*l;n[0]=c*u,n[4]=-h,n[8]=l*u,n[1]=d*h+g,n[5]=o*u,n[9]=m*h-p,n[2]=p*h-m,n[6]=a*u,n[10]=g*h+d}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(y0e,e,b0e)}lookAt(e,n,r){const i=this.elements;return Ad.subVectors(e,n),Ad.lengthSq()===0&&(Ad.z=1),Ad.normalize(),ly.crossVectors(r,Ad),ly.lengthSq()===0&&(Math.abs(r.z)===1?Ad.x+=1e-4:Ad.z+=1e-4,Ad.normalize(),ly.crossVectors(r,Ad)),ly.normalize(),L2.crossVectors(Ad,ly),i[0]=ly.x,i[4]=L2.x,i[8]=Ad.x,i[1]=ly.y,i[5]=L2.y,i[9]=Ad.y,i[2]=ly.z,i[6]=L2.z,i[10]=Ad.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[4],c=r[8],l=r[12],u=r[1],h=r[5],d=r[9],m=r[13],p=r[2],g=r[6],y=r[10],v=r[14],x=r[3],E=r[7],C=r[11],A=r[15],k=i[0],M=i[4],I=i[8],z=i[12],H=i[1],K=i[5],P=i[9],F=i[13],N=i[2],X=i[6],G=i[10],j=i[14],q=i[3],te=i[7],W=i[11],$=i[15];return s[0]=o*k+a*H+c*N+l*q,s[4]=o*M+a*K+c*X+l*te,s[8]=o*I+a*P+c*G+l*W,s[12]=o*z+a*F+c*j+l*$,s[1]=u*k+h*H+d*N+m*q,s[5]=u*M+h*K+d*X+m*te,s[9]=u*I+h*P+d*G+m*W,s[13]=u*z+h*F+d*j+m*$,s[2]=p*k+g*H+y*N+v*q,s[6]=p*M+g*K+y*X+v*te,s[10]=p*I+g*P+y*G+v*W,s[14]=p*z+g*F+y*j+v*$,s[3]=x*k+E*H+C*N+A*q,s[7]=x*M+E*K+C*X+A*te,s[11]=x*I+E*P+C*G+A*W,s[15]=x*z+E*F+C*j+A*$,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[4],i=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],h=e[6],d=e[10],m=e[14],p=e[3],g=e[7],y=e[11],v=e[15];return p*(+s*c*h-i*l*h-s*a*d+r*l*d+i*a*m-r*c*m)+g*(+n*c*m-n*l*d+s*o*d-i*o*m+i*l*u-s*c*u)+y*(+n*l*h-n*a*m-s*o*h+r*o*m+s*a*u-r*l*u)+v*(-i*a*u-n*c*h+n*a*d+i*o*h-r*o*d+r*c*u)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=n,i[14]=r),this}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],d=e[10],m=e[11],p=e[12],g=e[13],y=e[14],v=e[15],x=h*y*l-g*d*l+g*c*m-a*y*m-h*c*v+a*d*v,E=p*d*l-u*y*l-p*c*m+o*y*m+u*c*v-o*d*v,C=u*g*l-p*h*l+p*a*m-o*g*m-u*a*v+o*h*v,A=p*h*c-u*g*c-p*a*d+o*g*d+u*a*y-o*h*y,k=n*x+r*E+i*C+s*A;if(k===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/k;return e[0]=x*M,e[1]=(g*d*s-h*y*s-g*i*m+r*y*m+h*i*v-r*d*v)*M,e[2]=(a*y*s-g*c*s+g*i*l-r*y*l-a*i*v+r*c*v)*M,e[3]=(h*c*s-a*d*s-h*i*l+r*d*l+a*i*m-r*c*m)*M,e[4]=E*M,e[5]=(u*y*s-p*d*s+p*i*m-n*y*m-u*i*v+n*d*v)*M,e[6]=(p*c*s-o*y*s-p*i*l+n*y*l+o*i*v-n*c*v)*M,e[7]=(o*d*s-u*c*s+u*i*l-n*d*l-o*i*m+n*c*m)*M,e[8]=C*M,e[9]=(p*h*s-u*g*s-p*r*m+n*g*m+u*r*v-n*h*v)*M,e[10]=(o*g*s-p*a*s+p*r*l-n*g*l-o*r*v+n*a*v)*M,e[11]=(u*a*s-o*h*s-u*r*l+n*h*l+o*r*m-n*a*m)*M,e[12]=A*M,e[13]=(u*g*i-p*h*i+p*r*d-n*g*d-u*r*y+n*h*y)*M,e[14]=(p*a*i-o*g*i-p*r*c+n*g*c+o*r*y-n*a*y)*M,e[15]=(o*h*i-u*a*i+u*r*c-n*h*c-o*r*d+n*a*d)*M,this}scale(e){const n=this.elements,r=e.x,i=e.y,s=e.z;return n[0]*=r,n[4]*=i,n[8]*=s,n[1]*=r,n[5]*=i,n[9]*=s,n[2]*=r,n[6]*=i,n[10]*=s,n[3]*=r,n[7]*=i,n[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,r,i))}makeTranslation(e,n,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,r,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const r=Math.cos(n),i=Math.sin(n),s=1-r,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+r,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+r,u*c-i*o,0,l*c-i*a,u*c+i*o,s*c*c+r,0,0,0,0,1),this}makeScale(e,n,r){return this.set(e,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,n,r,i,s,o){return this.set(1,r,s,0,e,1,o,0,n,i,1,0,0,0,0,1),this}compose(e,n,r){const i=this.elements,s=n._x,o=n._y,a=n._z,c=n._w,l=s+s,u=o+o,h=a+a,d=s*l,m=s*u,p=s*h,g=o*u,y=o*h,v=a*h,x=c*l,E=c*u,C=c*h,A=r.x,k=r.y,M=r.z;return i[0]=(1-(g+v))*A,i[1]=(m+C)*A,i[2]=(p-E)*A,i[3]=0,i[4]=(m-C)*k,i[5]=(1-(d+v))*k,i[6]=(y+x)*k,i[7]=0,i[8]=(p+E)*M,i[9]=(y-x)*M,i[10]=(1-(d+g))*M,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,n,r){const i=this.elements;let s=FE.set(i[0],i[1],i[2]).length();const o=FE.set(i[4],i[5],i[6]).length(),a=FE.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Jm.copy(this);const l=1/s,u=1/o,h=1/a;return Jm.elements[0]*=l,Jm.elements[1]*=l,Jm.elements[2]*=l,Jm.elements[4]*=u,Jm.elements[5]*=u,Jm.elements[6]*=u,Jm.elements[8]*=h,Jm.elements[9]*=h,Jm.elements[10]*=h,n.setFromRotationMatrix(Jm),r.x=s,r.y=o,r.z=a,this}makePerspective(e,n,r,i,s,o,a=uv){const c=this.elements,l=2*s/(n-e),u=2*s/(r-i),h=(n+e)/(n-e),d=(r+i)/(r-i);let m,p;if(a===uv)m=-(o+s)/(o-s),p=-2*o*s/(o-s);else if(a===pI)m=-o/(o-s),p=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=h,c[12]=0,c[1]=0,c[5]=u,c[9]=d,c[13]=0,c[2]=0,c[6]=0,c[10]=m,c[14]=p,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,n,r,i,s,o,a=uv){const c=this.elements,l=1/(n-e),u=1/(r-i),h=1/(o-s),d=(n+e)*l,m=(r+i)*u;let p,g;if(a===uv)p=(o+s)*h,g=-2*h;else if(a===pI)p=s*h,g=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-d,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-m,c[2]=0,c[6]=0,c[10]=g,c[14]=-p,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<16;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<16;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e[n+9]=r[9],e[n+10]=r[10],e[n+11]=r[11],e[n+12]=r[12],e[n+13]=r[13],e[n+14]=r[14],e[n+15]=r[15],e}}const FE=new jt,Jm=new Ks,y0e=new jt(0,0,0),b0e=new jt(1,1,1),ly=new jt,L2=new jt,Ad=new jt,Jj=new Ks,Qj=new zx;class U0{constructor(e=0,n=0,r=0,i=U0.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,r,i=this._order){return this._x=e,this._y=n,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,r=!0){const i=e.elements,s=i[0],o=i[4],a=i[8],c=i[1],l=i[5],u=i[9],h=i[2],d=i[6],m=i[10];switch(n){case"XYZ":this._y=Math.asin(Ki(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,m),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ki(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ki(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,m),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Ki(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,m),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Ki(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-Ki(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,r){return Jj.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Jj,n,r)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return Qj.setFromEuler(this),this.setFromQuaternion(Qj,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}U0.DEFAULT_ORDER="XYZ";class bA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let E0e=0;const ez=new jt,jE=new zx,N_=new Ks,U2=new jt,vT=new jt,S0e=new jt,x0e=new zx,tz=new jt(1,0,0),nz=new jt(0,1,0),rz=new jt(0,0,1),iz={type:"added"},T0e={type:"removed"},zE={type:"childadded",child:null},sD={type:"childremoved",child:null};class zh extends Dv{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:E0e++}),this.uuid=jx(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=zh.DEFAULT_UP.clone();const e=new jt,n=new U0,r=new zx,i=new jt(1,1,1);function s(){r.setFromEuler(n,!1)}function o(){n.setFromQuaternion(r,void 0,!1)}n._onChange(s),r._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ks},normalMatrix:{value:new _i}}),this.matrix=new Ks,this.matrixWorld=new Ks,this.matrixAutoUpdate=zh.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=zh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new bA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return jE.setFromAxisAngle(e,n),this.quaternion.multiply(jE),this}rotateOnWorldAxis(e,n){return jE.setFromAxisAngle(e,n),this.quaternion.premultiply(jE),this}rotateX(e){return this.rotateOnAxis(tz,e)}rotateY(e){return this.rotateOnAxis(nz,e)}rotateZ(e){return this.rotateOnAxis(rz,e)}translateOnAxis(e,n){return ez.copy(e).applyQuaternion(this.quaternion),this.position.add(ez.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(tz,e)}translateY(e){return this.translateOnAxis(nz,e)}translateZ(e){return this.translateOnAxis(rz,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(N_.copy(this.matrixWorld).invert())}lookAt(e,n,r){e.isVector3?U2.copy(e):U2.set(e,n,r);const i=this.parent;this.updateWorldMatrix(!0,!1),vT.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?N_.lookAt(vT,U2,this.up):N_.lookAt(U2,vT,this.up),this.quaternion.setFromRotationMatrix(N_),i&&(N_.extractRotation(i.matrixWorld),jE.setFromRotationMatrix(N_),this.quaternion.premultiply(jE.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(iz),zE.child=e,this.dispatchEvent(zE),zE.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(T0e),sD.child=e,this.dispatchEvent(sD),sD.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),N_.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),N_.multiply(e.parent.matrixWorld)),e.applyMatrix4(N_),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(iz),zE.child=e,this.dispatchEvent(zE),zE.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let r=0,i=this.children.length;r<i;r++){const o=this.children[r].getObjectByProperty(e,n);if(o!==void 0)return o}}getObjectsByProperty(e,n,r=[]){this[e]===n&&r.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(e,n,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vT,e,S0e),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vT,x0e,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].updateMatrixWorld(e)}updateWorldMatrix(e,n){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?{min:a.boundingBox.min.toArray(),max:a.boundingBox.max.toArray()}:void 0,boundingSphere:a.boundingSphere?{radius:a.boundingSphere.radius,center:a.boundingSphere.center.toArray()}:void 0})),i.instanceInfo=this._instanceInfo.map(a=>({...a})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:this.boundingSphere.center.toArray(),radius:this.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:this.boundingBox.min.toArray(),max:this.boundingBox.max.toArray()}));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const h=c[l];s(e.shapes,h)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(s(e.materials,this.material[c]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(s(e.animations,c))}}if(n){const a=o(e.geometries),c=o(e.materials),l=o(e.textures),u=o(e.images),h=o(e.shapes),d=o(e.skeletons),m=o(e.animations),p=o(e.nodes);a.length>0&&(r.geometries=a),c.length>0&&(r.materials=c),l.length>0&&(r.textures=l),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),m.length>0&&(r.animations=m),p.length>0&&(r.nodes=p)}return r.object=i,r;function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}zh.DEFAULT_UP=new jt(0,1,0);zh.DEFAULT_MATRIX_AUTO_UPDATE=!0;zh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Qm=new jt,P_=new jt,oD=new jt,D_=new jt,HE=new jt,qE=new jt,sz=new jt,aD=new jt,cD=new jt,lD=new jt,uD=new La,fD=new La,hD=new La;class lg{constructor(e=new jt,n=new jt,r=new jt){this.a=e,this.b=n,this.c=r}static getNormal(e,n,r,i){i.subVectors(r,n),Qm.subVectors(e,n),i.cross(Qm);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,n,r,i,s){Qm.subVectors(i,n),P_.subVectors(r,n),oD.subVectors(e,n);const o=Qm.dot(Qm),a=Qm.dot(P_),c=Qm.dot(oD),l=P_.dot(P_),u=P_.dot(oD),h=o*l-a*a;if(h===0)return s.set(0,0,0),null;const d=1/h,m=(l*c-a*u)*d,p=(o*u-a*c)*d;return s.set(1-m-p,p,m)}static containsPoint(e,n,r,i){return this.getBarycoord(e,n,r,i,D_)===null?!1:D_.x>=0&&D_.y>=0&&D_.x+D_.y<=1}static getInterpolation(e,n,r,i,s,o,a,c){return this.getBarycoord(e,n,r,i,D_)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,D_.x),c.addScaledVector(o,D_.y),c.addScaledVector(a,D_.z),c)}static getInterpolatedAttribute(e,n,r,i,s,o){return uD.setScalar(0),fD.setScalar(0),hD.setScalar(0),uD.fromBufferAttribute(e,n),fD.fromBufferAttribute(e,r),hD.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(uD,s.x),o.addScaledVector(fD,s.y),o.addScaledVector(hD,s.z),o}static isFrontFacing(e,n,r,i){return Qm.subVectors(r,n),P_.subVectors(e,n),Qm.cross(P_).dot(i)<0}set(e,n,r){return this.a.copy(e),this.b.copy(n),this.c.copy(r),this}setFromPointsAndIndices(e,n,r,i){return this.a.copy(e[n]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,n,r,i){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Qm.subVectors(this.c,this.b),P_.subVectors(this.a,this.b),Qm.cross(P_).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return lg.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return lg.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,i,s){return lg.getInterpolation(e,this.a,this.b,this.c,n,r,i,s)}containsPoint(e){return lg.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return lg.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const r=this.a,i=this.b,s=this.c;let o,a;HE.subVectors(i,r),qE.subVectors(s,r),aD.subVectors(e,r);const c=HE.dot(aD),l=qE.dot(aD);if(c<=0&&l<=0)return n.copy(r);cD.subVectors(e,i);const u=HE.dot(cD),h=qE.dot(cD);if(u>=0&&h<=u)return n.copy(i);const d=c*h-u*l;if(d<=0&&c>=0&&u<=0)return o=c/(c-u),n.copy(r).addScaledVector(HE,o);lD.subVectors(e,s);const m=HE.dot(lD),p=qE.dot(lD);if(p>=0&&m<=p)return n.copy(s);const g=m*l-c*p;if(g<=0&&l>=0&&p<=0)return a=l/(l-p),n.copy(r).addScaledVector(qE,a);const y=u*p-m*h;if(y<=0&&h-u>=0&&m-p>=0)return sz.subVectors(s,i),a=(h-u)/(h-u+(m-p)),n.copy(i).addScaledVector(sz,a);const v=1/(y+g+d);return o=g*v,a=d*v,n.copy(r).addScaledVector(HE,o).addScaledVector(qE,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const pee={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},uy={h:0,s:0,l:0},B2={h:0,s:0,l:0};function dD(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class Xi{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=rs){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,xs.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=xs.workingColorSpace){return this.r=e,this.g=n,this.b=r,xs.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=xs.workingColorSpace){if(e=QB(e,1),n=Ki(n,0,1),r=Ki(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=dD(o,s,e+1/3),this.g=dD(o,s,e),this.b=dD(o,s,e-1/3)}return xs.toWorkingColorSpace(this,i),this}setStyle(e,n=rs){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=rs){const r=pee[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=_v(e.r),this.g=_v(e.g),this.b=_v(e.b),this}copyLinearToSRGB(e){return this.r=LS(e.r),this.g=LS(e.g),this.b=LS(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=rs){return xs.fromWorkingColorSpace(Yu.copy(this),e),Math.round(Ki(Yu.r*255,0,255))*65536+Math.round(Ki(Yu.g*255,0,255))*256+Math.round(Ki(Yu.b*255,0,255))}getHexString(e=rs){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=xs.workingColorSpace){xs.fromWorkingColorSpace(Yu.copy(this),n);const r=Yu.r,i=Yu.g,s=Yu.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=xs.workingColorSpace){return xs.fromWorkingColorSpace(Yu.copy(this),n),e.r=Yu.r,e.g=Yu.g,e.b=Yu.b,e}getStyle(e=rs){xs.fromWorkingColorSpace(Yu.copy(this),e);const n=Yu.r,r=Yu.g,i=Yu.b;return e!==rs?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(uy),this.setHSL(uy.h+e,uy.s+n,uy.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(uy),e.getHSL(B2);const r=nA(uy.h,B2.h,n),i=nA(uy.s,B2.s,n),s=nA(uy.l,B2.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Yu=new Xi;Xi.NAMES=pee;let w0e=0;class cb extends Dv{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:w0e++}),this.uuid=jx(),this.name="",this.type="Material",this.blending=DS,this.side=wv,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=GU,this.blendDst=$U,this.blendEquation=c1,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Xi(0,0,0),this.blendAlpha=0,this.depthFunc=YS,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=qj,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=PE,this.stencilZFail=PE,this.stencilZPass=PE,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const r=e[n];if(r===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const i=this[n];if(i===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==DS&&(r.blending=this.blending),this.side!==wv&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==GU&&(r.blendSrc=this.blendSrc),this.blendDst!==$U&&(r.blendDst=this.blendDst),this.blendEquation!==c1&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==YS&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==qj&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==PE&&(r.stencilFail=this.stencilFail),this.stencilZFail!==PE&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==PE&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(n){const s=i(e.textures),o=i(e.images);s.length>0&&(r.textures=s),o.length>0&&(r.images=o)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let r=null;if(n!==null){const i=n.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=n[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class n8 extends cb{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Xi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new U0,this.combine=nee,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Hc=new jt,F2=new Vn;let R0e=0;class Pa{constructor(e,n,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:R0e++}),this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=r,this.usage=Vj,this.updateRanges=[],this.gpuType=hg,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,r){e*=this.itemSize,r*=n.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=n.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,r=this.count;n<r;n++)F2.fromBufferAttribute(this,n),F2.applyMatrix3(e),this.setXY(n,F2.x,F2.y);else if(this.itemSize===3)for(let n=0,r=this.count;n<r;n++)Hc.fromBufferAttribute(this,n),Hc.applyMatrix3(e),this.setXYZ(n,Hc.x,Hc.y,Hc.z);return this}applyMatrix4(e){for(let n=0,r=this.count;n<r;n++)Hc.fromBufferAttribute(this,n),Hc.applyMatrix4(e),this.setXYZ(n,Hc.x,Hc.y,Hc.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)Hc.fromBufferAttribute(this,n),Hc.applyNormalMatrix(e),this.setXYZ(n,Hc.x,Hc.y,Hc.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)Hc.fromBufferAttribute(this,n),Hc.transformDirection(e),this.setXYZ(n,Hc.x,Hc.y,Hc.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let r=this.array[e*this.itemSize+n];return this.normalized&&(r=hS(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=Pf(r,this.array)),this.array[e*this.itemSize+n]=r,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=hS(n,this.array)),n}setX(e,n){return this.normalized&&(n=Pf(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=hS(n,this.array)),n}setY(e,n){return this.normalized&&(n=Pf(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=hS(n,this.array)),n}setZ(e,n){return this.normalized&&(n=Pf(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=hS(n,this.array)),n}setW(e,n){return this.normalized&&(n=Pf(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=Pf(n,this.array),r=Pf(r,this.array)),this.array[e+0]=n,this.array[e+1]=r,this}setXYZ(e,n,r,i){return e*=this.itemSize,this.normalized&&(n=Pf(n,this.array),r=Pf(r,this.array),i=Pf(i,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,n,r,i,s){return e*=this.itemSize,this.normalized&&(n=Pf(n,this.array),r=Pf(r,this.array),i=Pf(i,this.array),s=Pf(s,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Vj&&(e.usage=this.usage),e}}class mee extends Pa{constructor(e,n,r){super(new Uint16Array(e),n,r)}}class gee extends Pa{constructor(e,n,r){super(new Uint32Array(e),n,r)}}class S1 extends Pa{constructor(e,n,r){super(new Float32Array(e),n,r)}}let C0e=0;const Np=new Ks,pD=new zh,VE=new jt,Md=new sE,yT=new sE,ql=new jt;class $0 extends Dv{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:C0e++}),this.uuid=jx(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(hee(e)?gee:mee)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,r=0){this.groups.push({start:e,count:n,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new _i().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Np.makeRotationFromQuaternion(e),this.applyMatrix4(Np),this}rotateX(e){return Np.makeRotationX(e),this.applyMatrix4(Np),this}rotateY(e){return Np.makeRotationY(e),this.applyMatrix4(Np),this}rotateZ(e){return Np.makeRotationZ(e),this.applyMatrix4(Np),this}translate(e,n,r){return Np.makeTranslation(e,n,r),this.applyMatrix4(Np),this}scale(e,n,r){return Np.makeScale(e,n,r),this.applyMatrix4(Np),this}lookAt(e){return pD.lookAt(e),pD.updateMatrix(),this.applyMatrix4(pD.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(VE).negate(),this.translate(VE.x,VE.y,VE.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const r=[];for(let i=0,s=e.length;i<s;i++){const o=e[i];r.push(o.x,o.y,o.z||0)}this.setAttribute("position",new S1(r,3))}else{const r=Math.min(e.length,n.count);for(let i=0;i<r;i++){const s=e[i];n.setXYZ(i,s.x,s.y,s.z||0)}e.length>n.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new sE);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new jt(-1/0,-1/0,-1/0),new jt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let r=0,i=n.length;r<i;r++){const s=n[r];Md.setFromBufferAttribute(s),this.morphTargetsRelative?(ql.addVectors(this.boundingBox.min,Md.min),this.boundingBox.expandByPoint(ql),ql.addVectors(this.boundingBox.max,Md.max),this.boundingBox.expandByPoint(ql)):(this.boundingBox.expandByPoint(Md.min),this.boundingBox.expandByPoint(Md.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Hx);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new jt,1/0);return}if(e){const r=this.boundingSphere.center;if(Md.setFromBufferAttribute(e),n)for(let s=0,o=n.length;s<o;s++){const a=n[s];yT.setFromBufferAttribute(a),this.morphTargetsRelative?(ql.addVectors(Md.min,yT.min),Md.expandByPoint(ql),ql.addVectors(Md.max,yT.max),Md.expandByPoint(ql)):(Md.expandByPoint(yT.min),Md.expandByPoint(yT.max))}Md.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)ql.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(ql));if(n)for(let s=0,o=n.length;s<o;s++){const a=n[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)ql.fromBufferAttribute(a,l),c&&(VE.fromBufferAttribute(e,l),ql.add(VE)),i=Math.max(i,r.distanceToSquared(ql))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=n.position,i=n.normal,s=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Pa(new Float32Array(4*r.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let I=0;I<r.count;I++)a[I]=new jt,c[I]=new jt;const l=new jt,u=new jt,h=new jt,d=new Vn,m=new Vn,p=new Vn,g=new jt,y=new jt;function v(I,z,H){l.fromBufferAttribute(r,I),u.fromBufferAttribute(r,z),h.fromBufferAttribute(r,H),d.fromBufferAttribute(s,I),m.fromBufferAttribute(s,z),p.fromBufferAttribute(s,H),u.sub(l),h.sub(l),m.sub(d),p.sub(d);const K=1/(m.x*p.y-p.x*m.y);isFinite(K)&&(g.copy(u).multiplyScalar(p.y).addScaledVector(h,-m.y).multiplyScalar(K),y.copy(h).multiplyScalar(m.x).addScaledVector(u,-p.x).multiplyScalar(K),a[I].add(g),a[z].add(g),a[H].add(g),c[I].add(y),c[z].add(y),c[H].add(y))}let x=this.groups;x.length===0&&(x=[{start:0,count:e.count}]);for(let I=0,z=x.length;I<z;++I){const H=x[I],K=H.start,P=H.count;for(let F=K,N=K+P;F<N;F+=3)v(e.getX(F+0),e.getX(F+1),e.getX(F+2))}const E=new jt,C=new jt,A=new jt,k=new jt;function M(I){A.fromBufferAttribute(i,I),k.copy(A);const z=a[I];E.copy(z),E.sub(A.multiplyScalar(A.dot(z))).normalize(),C.crossVectors(k,z);const K=C.dot(c[I])<0?-1:1;o.setXYZW(I,E.x,E.y,E.z,K)}for(let I=0,z=x.length;I<z;++I){const H=x[I],K=H.start,P=H.count;for(let F=K,N=K+P;F<N;F+=3)M(e.getX(F+0)),M(e.getX(F+1)),M(e.getX(F+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Pa(new Float32Array(n.count*3),3),this.setAttribute("normal",r);else for(let d=0,m=r.count;d<m;d++)r.setXYZ(d,0,0,0);const i=new jt,s=new jt,o=new jt,a=new jt,c=new jt,l=new jt,u=new jt,h=new jt;if(e)for(let d=0,m=e.count;d<m;d+=3){const p=e.getX(d+0),g=e.getX(d+1),y=e.getX(d+2);i.fromBufferAttribute(n,p),s.fromBufferAttribute(n,g),o.fromBufferAttribute(n,y),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),a.fromBufferAttribute(r,p),c.fromBufferAttribute(r,g),l.fromBufferAttribute(r,y),a.add(u),c.add(u),l.add(u),r.setXYZ(p,a.x,a.y,a.z),r.setXYZ(g,c.x,c.y,c.z),r.setXYZ(y,l.x,l.y,l.z)}else for(let d=0,m=n.count;d<m;d+=3)i.fromBufferAttribute(n,d+0),s.fromBufferAttribute(n,d+1),o.fromBufferAttribute(n,d+2),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,r=e.count;n<r;n++)ql.fromBufferAttribute(e,n),ql.normalize(),e.setXYZ(n,ql.x,ql.y,ql.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,h=a.normalized,d=new l.constructor(c.length*u);let m=0,p=0;for(let g=0,y=c.length;g<y;g++){a.isInterleavedBufferAttribute?m=c[g]*a.data.stride+a.offset:m=c[g]*u;for(let v=0;v<u;v++)d[p++]=l[m++]}return new Pa(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new $0,r=this.index.array,i=this.attributes;for(const a in i){const c=i[a],l=e(c,r);n.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,h=l.length;u<h;u++){const d=l[u],m=e(d,r);c.push(m)}n.morphAttributes[a]=c}n.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];n.addGroup(l.start,l.count,l.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(e[l]=c[l]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const r=this.attributes;for(const c in r){const l=r[c];e.data.attributes[c]=l.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let h=0,d=l.length;h<d;h++){const m=l[h];u.push(m.toJSON(e.data))}u.length>0&&(i[c]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const i=e.attributes;for(const l in i){const u=i[l];this.setAttribute(l,u.clone(n))}const s=e.morphAttributes;for(const l in s){const u=[],h=s[l];for(let d=0,m=h.length;d<m;d++)u.push(h[d].clone(n));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const h=o[l];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const oz=new Ks,Nb=new t8,j2=new Hx,az=new jt,z2=new jt,H2=new jt,q2=new jt,mD=new jt,V2=new jt,cz=new jt,G2=new jt;class Uh extends zh{constructor(e=new $0,n=new n8){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,n){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,o=r.morphTargetsRelative;n.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){V2.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c],h=s[c];u!==0&&(mD.fromBufferAttribute(h,e),o?V2.addScaledVector(mD,u):V2.addScaledVector(mD.sub(n),u))}n.add(V2)}return n}raycast(e,n){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),j2.copy(r.boundingSphere),j2.applyMatrix4(s),Nb.copy(e.ray).recast(e.near),!(j2.containsPoint(Nb.origin)===!1&&(Nb.intersectSphere(j2,az)===null||Nb.origin.distanceToSquared(az)>(e.far-e.near)**2))&&(oz.copy(s).invert(),Nb.copy(e.ray).applyMatrix4(oz),!(r.boundingBox!==null&&Nb.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,n,Nb)))}_computeIntersections(e,n,r){let i;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,m=s.drawRange;if(a!==null)if(Array.isArray(o))for(let p=0,g=d.length;p<g;p++){const y=d[p],v=o[y.materialIndex],x=Math.max(y.start,m.start),E=Math.min(a.count,Math.min(y.start+y.count,m.start+m.count));for(let C=x,A=E;C<A;C+=3){const k=a.getX(C),M=a.getX(C+1),I=a.getX(C+2);i=$2(this,v,e,r,l,u,h,k,M,I),i&&(i.faceIndex=Math.floor(C/3),i.face.materialIndex=y.materialIndex,n.push(i))}}else{const p=Math.max(0,m.start),g=Math.min(a.count,m.start+m.count);for(let y=p,v=g;y<v;y+=3){const x=a.getX(y),E=a.getX(y+1),C=a.getX(y+2);i=$2(this,o,e,r,l,u,h,x,E,C),i&&(i.faceIndex=Math.floor(y/3),n.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let p=0,g=d.length;p<g;p++){const y=d[p],v=o[y.materialIndex],x=Math.max(y.start,m.start),E=Math.min(c.count,Math.min(y.start+y.count,m.start+m.count));for(let C=x,A=E;C<A;C+=3){const k=C,M=C+1,I=C+2;i=$2(this,v,e,r,l,u,h,k,M,I),i&&(i.faceIndex=Math.floor(C/3),i.face.materialIndex=y.materialIndex,n.push(i))}}else{const p=Math.max(0,m.start),g=Math.min(c.count,m.start+m.count);for(let y=p,v=g;y<v;y+=3){const x=y,E=y+1,C=y+2;i=$2(this,o,e,r,l,u,h,x,E,C),i&&(i.faceIndex=Math.floor(y/3),n.push(i))}}}}function A0e(t,e,n,r,i,s,o,a){let c;if(e.side===Ql?c=r.intersectTriangle(o,s,i,!0,a):c=r.intersectTriangle(i,s,o,e.side===wv,a),c===null)return null;G2.copy(a),G2.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(G2);return l<n.near||l>n.far?null:{distance:l,point:G2.clone(),object:t}}function $2(t,e,n,r,i,s,o,a,c,l){t.getVertexPosition(a,z2),t.getVertexPosition(c,H2),t.getVertexPosition(l,q2);const u=A0e(t,e,n,r,z2,H2,q2,cz);if(u){const h=new jt;lg.getBarycoord(cz,z2,H2,q2,h),i&&(u.uv=lg.getInterpolatedAttribute(i,a,c,l,h,new Vn)),s&&(u.uv1=lg.getInterpolatedAttribute(s,a,c,l,h,new Vn)),o&&(u.normal=lg.getInterpolatedAttribute(o,a,c,l,h,new jt),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const d={a,b:c,c:l,normal:new jt,materialIndex:0};lg.getNormal(z2,H2,q2,d.normal),u.face=d,u.barycoord=h}return u}class qx extends $0{constructor(e=1,n=1,r=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],h=[];let d=0,m=0;p("z","y","x",-1,-1,r,n,e,o,s,0),p("z","y","x",1,-1,r,n,-e,o,s,1),p("x","z","y",1,1,e,r,n,i,o,2),p("x","z","y",1,-1,e,r,-n,i,o,3),p("x","y","z",1,-1,e,n,r,i,s,4),p("x","y","z",-1,-1,e,n,-r,i,s,5),this.setIndex(c),this.setAttribute("position",new S1(l,3)),this.setAttribute("normal",new S1(u,3)),this.setAttribute("uv",new S1(h,2));function p(g,y,v,x,E,C,A,k,M,I,z){const H=C/M,K=A/I,P=C/2,F=A/2,N=k/2,X=M+1,G=I+1;let j=0,q=0;const te=new jt;for(let W=0;W<G;W++){const $=W*K-F;for(let J=0;J<X;J++){const ne=J*H-P;te[g]=ne*x,te[y]=$*E,te[v]=N,l.push(te.x,te.y,te.z),te[g]=0,te[y]=0,te[v]=k>0?1:-1,u.push(te.x,te.y,te.z),h.push(J/M),h.push(1-W/I),j+=1}}for(let W=0;W<I;W++)for(let $=0;$<M;$++){const J=d+$+X*W,ne=d+$+X*(W+1),ie=d+($+1)+X*(W+1),ae=d+($+1)+X*W;c.push(J,ne,ae),c.push(ne,ie,ae),q+=6}a.addGroup(m,q,z),m+=q,d+=j}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new qx(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function tx(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function Df(t){const e={};for(let n=0;n<t.length;n++){const r=tx(t[n]);for(const i in r)e[i]=r[i]}return e}function M0e(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function _ee(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:xs.workingColorSpace}const k0e={clone:tx,merge:Df};var O0e=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,I0e=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Fa extends cb{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=O0e,this.fragmentShader=I0e,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=tx(e.uniforms),this.uniformsGroups=M0e(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?n.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?n.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?n.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?n.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?n.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?n.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?n.uniforms[i]={type:"m4",value:o.toArray()}:n.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(n.extensions=r),n}}class r8 extends zh{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ks,this.projectionMatrix=new Ks,this.projectionMatrixInverse=new Ks,this.coordinateSystem=uv}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const fy=new jt,lz=new Vn,uz=new Vn;class jf extends r8{constructor(e=50,n=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=vA*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(tA*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return vA*2*Math.atan(Math.tan(tA*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,r){fy.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(fy.x,fy.y).multiplyScalar(-e/fy.z),fy.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(fy.x,fy.y).multiplyScalar(-e/fy.z)}getViewSize(e,n){return this.getViewBounds(e,lz,uz),n.subVectors(uz,lz)}setViewOffset(e,n,r,i,s,o){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(tA*.5*this.fov)/this.zoom,r=2*n,i=this.aspect*r,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*i/c,n-=o.offsetY*r/l,i*=o.width/c,r*=o.height/l}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,n,n-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const GE=-90,$E=1;class N0e extends zh{constructor(e,n,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new jf(GE,$E,e,n);i.layers=this.layers,this.add(i);const s=new jf(GE,$E,e,n);s.layers=this.layers,this.add(s);const o=new jf(GE,$E,e,n);o.layers=this.layers,this.add(o);const a=new jf(GE,$E,e,n);a.layers=this.layers,this.add(a);const c=new jf(GE,$E,e,n);c.layers=this.layers,this.add(c);const l=new jf(GE,$E,e,n);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[r,i,s,o,a,c]=n;for(const l of n)this.remove(l);if(e===uv)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===pI)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of n)this.add(l),l.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const g=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(n,s),e.setRenderTarget(r,1,i),e.render(n,o),e.setRenderTarget(r,2,i),e.render(n,a),e.setRenderTarget(r,3,i),e.render(n,c),e.setRenderTarget(r,4,i),e.render(n,l),r.texture.generateMipmaps=g,e.setRenderTarget(r,5,i),e.render(n,u),e.setRenderTarget(h,d,m),e.xr.enabled=p,r.texture.needsPMREMUpdate=!0}}class vee extends El{constructor(e=[],n=ZS,r,i,s,o,a,c,l,u){super(e,n,r,i,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class P0e extends Iu{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new vee(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:nf}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new qx(5,5,5),s=new Fa({name:"CubemapFromEquirect",uniforms:tx(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Ql,blending:Ou});s.uniforms.tEquirect.value=n;const o=new Uh(i,s),a=n.minFilter;return n.minFilter===m1&&(n.minFilter=nf),new N0e(1,10,this).update(e,o),n.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,n=!0,r=!0,i=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(n,r,i);e.setRenderTarget(s)}}class TS extends zh{constructor(){super(),this.isGroup=!0,this.type="Group"}}const D0e={type:"move"};class gD{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new TS,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new TS,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new jt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new jt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new TS,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new jt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new jt),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const r of e.hand.values())this._getHandJoint(n,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,r){let i=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(l&&e.hand){o=!0;for(const g of e.hand.values()){const y=n.getJointPose(g,r),v=this._getHandJoint(l,g);y!==null&&(v.matrix.fromArray(y.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=y.radius),v.visible=y!==null}const u=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],d=u.position.distanceTo(h.position),m=.02,p=.005;l.inputState.pinching&&d>m+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&d<=m-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=n.getPose(e.gripSpace,r),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(i=n.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(D0e)))}return a!==null&&(a.visible=i!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const r=new TS;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[n.jointName]=r,e.add(r)}return e.joints[n.jointName]}}class mI extends zh{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new U0,this.environmentIntensity=1,this.environmentRotation=new U0,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class s3 extends El{constructor(e=null,n=1,r=1,i,s,o,a,c,l=rf,u=rf,h,d){super(null,o,a,c,l,u,i,s,h,d),this.isDataTexture=!0,this.image={data:e,width:n,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class M6 extends Pa{constructor(e,n,r,i=1){super(e,n,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const WE=new Ks,fz=new Ks,W2=[],hz=new sE,L0e=new Ks,bT=new Uh,ET=new Hx;class U0e extends Uh{constructor(e,n,r){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new M6(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<r;i++)this.setMatrixAt(i,L0e)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new sE),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,WE),hz.copy(e.boundingBox).applyMatrix4(WE),this.boundingBox.union(hz)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new Hx),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,WE),ET.copy(e.boundingSphere).applyMatrix4(WE),this.boundingSphere.union(ET)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,n){const r=n.morphTargetInfluences,i=this.morphTexture.source.data.data,s=r.length+1,o=e*s+1;for(let a=0;a<r.length;a++)r[a]=i[o+a]}raycast(e,n){const r=this.matrixWorld,i=this.count;if(bT.geometry=this.geometry,bT.material=this.material,bT.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ET.copy(this.boundingSphere),ET.applyMatrix4(r),e.ray.intersectsSphere(ET)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,WE),fz.multiplyMatrices(r,WE),bT.matrixWorld=fz,bT.raycast(e,W2);for(let o=0,a=W2.length;o<a;o++){const c=W2[o];c.instanceId=s,c.object=this,n.push(c)}W2.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new M6(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,n){const r=n.morphTargetInfluences,i=r.length+1;this.morphTexture===null&&(this.morphTexture=new s3(new Float32Array(i*this.count),i,this.count,SM,hg));const s=this.morphTexture.source.data.data;let o=0;for(let l=0;l<r.length;l++)o+=r[l];const a=this.geometry.morphTargetsRelative?1:1-o,c=i*e;s[c]=a,s.set(r,c+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const _D=new jt,B0e=new jt,F0e=new _i;let Qb=class{constructor(e=new jt(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,r,i){return this.normal.set(e,n,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,r){const i=_D.subVectors(r,n).cross(B0e.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const r=e.delta(_D),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:n.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const n=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return n<0&&r>0||r<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const r=n||F0e.getNormalMatrix(e),i=this.coplanarPoint(_D).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const Pb=new Hx,K2=new jt;class yee{constructor(e=new Qb,n=new Qb,r=new Qb,i=new Qb,s=new Qb,o=new Qb){this.planes=[e,n,r,i,s,o]}set(e,n,r,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(n),a[2].copy(r),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const n=this.planes;for(let r=0;r<6;r++)n[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,n=uv){const r=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],c=i[3],l=i[4],u=i[5],h=i[6],d=i[7],m=i[8],p=i[9],g=i[10],y=i[11],v=i[12],x=i[13],E=i[14],C=i[15];if(r[0].setComponents(c-s,d-l,y-m,C-v).normalize(),r[1].setComponents(c+s,d+l,y+m,C+v).normalize(),r[2].setComponents(c+o,d+u,y+p,C+x).normalize(),r[3].setComponents(c-o,d-u,y-p,C-x).normalize(),r[4].setComponents(c-a,d-h,y-g,C-E).normalize(),n===uv)r[5].setComponents(c+a,d+h,y+g,C+E).normalize();else if(n===pI)r[5].setComponents(a,h,g,E).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Pb.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),Pb.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Pb)}intersectsSprite(e){return Pb.center.set(0,0,0),Pb.radius=.7071067811865476,Pb.applyMatrix4(e.matrixWorld),this.intersectsSphere(Pb)}intersectsSphere(e){const n=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(n[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const n=this.planes;for(let r=0;r<6;r++){const i=n[r];if(K2.x=i.normal.x>0?e.max.x:e.min.x,K2.y=i.normal.y>0?e.max.y:e.min.y,K2.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(K2)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let r=0;r<6;r++)if(n[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class j0e extends cb{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Xi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const dz=new Ks,k6=new t8,X2=new Hx,Y2=new jt;class z0e extends zh{constructor(e=new $0,n=new j0e){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),X2.copy(r.boundingSphere),X2.applyMatrix4(i),X2.radius+=s,e.ray.intersectsSphere(X2)===!1)return;dz.copy(i).invert(),k6.copy(e.ray).applyMatrix4(dz);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=r.index,h=r.attributes.position;if(l!==null){const d=Math.max(0,o.start),m=Math.min(l.count,o.start+o.count);for(let p=d,g=m;p<g;p++){const y=l.getX(p);Y2.fromBufferAttribute(h,y),pz(Y2,y,c,i,e,n,this)}}else{const d=Math.max(0,o.start),m=Math.min(h.count,o.start+o.count);for(let p=d,g=m;p<g;p++)Y2.fromBufferAttribute(h,p),pz(Y2,p,c,i,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function pz(t,e,n,r,i,s,o){const a=k6.distanceSqToPoint(t);if(a<n){const c=new jt;k6.closestPointToPoint(t,c),c.applyMatrix4(r);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class H0e extends El{constructor(e,n,r,i,s,o,a,c,l){super(e,n,r,i,s,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class o3 extends El{constructor(e,n,r=Wy,i,s,o,a=rf,c=rf,l,u=_A){if(u!==_A&&u!==ex)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,s,o,a,c,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:n},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new e8(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}class xM extends $0{constructor(e=1,n=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:r,heightSegments:i};const s=e/2,o=n/2,a=Math.floor(r),c=Math.floor(i),l=a+1,u=c+1,h=e/a,d=n/c,m=[],p=[],g=[],y=[];for(let v=0;v<u;v++){const x=v*d-o;for(let E=0;E<l;E++){const C=E*h-s;p.push(C,-x,0),g.push(0,0,1),y.push(E/a),y.push(1-v/c)}}for(let v=0;v<c;v++)for(let x=0;x<a;x++){const E=x+l*v,C=x+l*(v+1),A=x+1+l*(v+1),k=x+1+l*v;m.push(E,C,k),m.push(C,A,k)}this.setIndex(m),this.setAttribute("position",new S1(p,3)),this.setAttribute("normal",new S1(g,3)),this.setAttribute("uv",new S1(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xM(e.width,e.height,e.widthSegments,e.heightSegments)}}class q0e extends cb{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=iE,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class V0e extends cb{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const mz={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class G0e{constructor(e,n,r){const i=this;let s=!1,o=0,a=0,c;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=r,this.itemStart=function(u){a++,s===!1&&i.onStart!==void 0&&i.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,i.onProgress!==void 0&&i.onProgress(u,o,a),o===a&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,h){return l.push(u,h),this},this.removeHandler=function(u){const h=l.indexOf(u);return h!==-1&&l.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=l.length;h<d;h+=2){const m=l[h],p=l[h+1];if(m.global&&(m.lastIndex=0),m.test(u))return p}return null}}}const $0e=new G0e;class i8{constructor(e){this.manager=e!==void 0?e:$0e,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const r=this;return new Promise(function(i,s){r.load(e,i,n,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}i8.DEFAULT_MATERIAL_NAME="__DEFAULT";class W0e extends i8{constructor(e){super(e)}load(e,n,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=mz.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){n&&n(o),s.manager.itemEnd(e)},0),o;const a=yA("img");function c(){u(),mz.add(e,this),n&&n(this),s.manager.itemEnd(e)}function l(h){u(),i&&i(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class K0e extends i8{constructor(e){super(e)}load(e,n,r,i){const s=new El,o=new W0e(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,n!==void 0&&n(s)},r,i),s}}let s8=class extends r8{constructor(e=-1,n=1,r=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=r,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,r,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,o=r+e,a=i+n,c=i-n;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}};class X0e extends jf{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}let Y0e=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=gz(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=gz();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}};function gz(){return performance.now()}class yn{constructor(e){this.value=e}clone(){return new yn(this.value.clone===void 0?this.value:this.value.clone())}}const _z=new Ks;class bee{constructor(e,n,r=0,i=1/0){this.ray=new t8(e,n),this.near=r,this.far=i,this.camera=null,this.layers=new bA,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}setFromXRController(e){return _z.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_z),this}intersectObject(e,n=!0,r=[]){return O6(e,this,r,n),r.sort(vz),r}intersectObjects(e,n=!0,r=[]){for(let i=0,s=e.length;i<s;i++)O6(e[i],this,r,n);return r.sort(vz),r}}function vz(t,e){return t.distance-e.distance}function O6(t,e,n,r){let i=!0;if(t.layers.test(e.layers)&&t.raycast(e,n)===!1&&(i=!1),i===!0&&r===!0){const s=t.children;for(let o=0,a=s.length;o<a;o++)O6(s[o],e,n,!0)}}const yz=new Vn;class Z0e{constructor(e=new Vn(1/0,1/0),n=new Vn(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=yz.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,yz).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function bz(t,e,n,r){const i=J0e(r);switch(n){case cee:return t*e;case SM:return t*e/i.components*i.byteLength;case YB:return t*e/i.components*i.byteLength;case ZB:return t*e*2/i.components*i.byteLength;case JB:return t*e*2/i.components*i.byteLength;case lee:return t*e*3/i.components*i.byteLength;case Vf:return t*e*4/i.components*i.byteLength;case i3:return t*e*4/i.components*i.byteLength;case hO:case dO:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case pO:case mO:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case i6:case o6:return Math.max(t,16)*Math.max(e,8)/4;case r6:case s6:return Math.max(t,8)*Math.max(e,8)/2;case a6:case c6:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case l6:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case u6:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case f6:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case h6:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case d6:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case p6:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case m6:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case g6:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case _6:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case v6:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case y6:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case b6:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case E6:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case S6:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case x6:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case gO:case T6:case w6:return Math.ceil(t/4)*Math.ceil(e/4)*16;case uee:case R6:return Math.ceil(t/4)*Math.ceil(e/4)*8;case C6:case A6:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function J0e(t){switch(t){case xa:case see:return{byteLength:1,components:1};case gA:case oee:case ab:return{byteLength:2,components:1};case KB:case XB:return{byteLength:2,components:4};case Wy:case WB:case hg:return{byteLength:4,components:1};case aee:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:EM}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=EM);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function Eee(){let t=null,e=!1,n=null,r=null;function i(s,o){n(s,o),r=t.requestAnimationFrame(i)}return{start:function(){e!==!0&&n!==null&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){n=s},setContext:function(s){t=s}}}function Q0e(t){const e=new WeakMap;function n(a,c){const l=a.array,u=a.usage,h=l.byteLength,d=t.createBuffer();t.bindBuffer(c,d),t.bufferData(c,l,u),a.onUploadCallback();let m;if(l instanceof Float32Array)m=t.FLOAT;else if(l instanceof Uint16Array)a.isFloat16BufferAttribute?m=t.HALF_FLOAT:m=t.UNSIGNED_SHORT;else if(l instanceof Int16Array)m=t.SHORT;else if(l instanceof Uint32Array)m=t.UNSIGNED_INT;else if(l instanceof Int32Array)m=t.INT;else if(l instanceof Int8Array)m=t.BYTE;else if(l instanceof Uint8Array)m=t.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)m=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:d,type:m,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:h}}function r(a,c,l){const u=c.array,h=c.updateRanges;if(t.bindBuffer(l,a),h.length===0)t.bufferSubData(l,0,u);else{h.sort((m,p)=>m.start-p.start);let d=0;for(let m=1;m<h.length;m++){const p=h[d],g=h[m];g.start<=p.start+p.count+1?p.count=Math.max(p.count,g.start+g.count-p.start):(++d,h[d]=g)}h.length=d+1;for(let m=0,p=h.length;m<p;m++){const g=h[m];t.bufferSubData(l,g.start*u.BYTES_PER_ELEMENT,u,g.start,g.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(t.deleteBuffer(c.buffer),e.delete(a))}function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const l=e.get(a);if(l===void 0)e.set(a,n(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(l.buffer,a,c),l.version=a.version}}return{get:i,remove:s,update:o}}var e_e=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,t_e=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,n_e=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,r_e=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,i_e=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,s_e=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,o_e=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,a_e=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,c_e=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,l_e=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,u_e=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,f_e=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,h_e=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,d_e=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,p_e=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,m_e=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,g_e=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,__e=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,v_e=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,y_e=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,b_e=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,E_e=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,S_e=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,x_e=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,T_e=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,w_e=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,R_e=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,C_e=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,A_e=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,M_e=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,k_e="gl_FragColor = linearToOutputTexel( gl_FragColor );",O_e=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,I_e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,N_e=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,P_e=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,D_e=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,L_e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,U_e=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,B_e=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,F_e=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,j_e=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,z_e=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,H_e=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,q_e=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,V_e=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,G_e=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,$_e=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,W_e=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,K_e=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,X_e=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Y_e=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Z_e=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,J_e=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Q_e=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,eve=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,tve=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,nve=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,rve=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ive=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,sve=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,ove=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,ave=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,cve=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,lve=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,uve=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,fve=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,hve=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,dve=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,pve=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,mve=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,gve=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,_ve=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,vve=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,yve=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,bve=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Eve=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Sve=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,xve=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Tve=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,wve=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Rve=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Cve=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Ave=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Mve=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,kve=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Ove=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Ive=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Nve=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Pve=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Dve=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Lve=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Uve=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Bve=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Fve=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,jve=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,zve=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Hve=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,qve=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Vve=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Gve=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,$ve=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Wve=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Kve=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Xve=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Yve=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Zve=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Jve=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Qve=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,eye=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,tye=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,nye=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,rye=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,iye=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,sye=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,oye=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,aye=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,cye=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,lye=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,uye=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,fye=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,hye=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,dye=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,pye=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mye=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gye=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_ye=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,vye=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yye=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,bye=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Eye=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Sye=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xye=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Tye=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wye=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Rye=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Cye=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Aye=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Mye=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kye=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Oye=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Iye=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,yi={alphahash_fragment:e_e,alphahash_pars_fragment:t_e,alphamap_fragment:n_e,alphamap_pars_fragment:r_e,alphatest_fragment:i_e,alphatest_pars_fragment:s_e,aomap_fragment:o_e,aomap_pars_fragment:a_e,batching_pars_vertex:c_e,batching_vertex:l_e,begin_vertex:u_e,beginnormal_vertex:f_e,bsdfs:h_e,iridescence_fragment:d_e,bumpmap_pars_fragment:p_e,clipping_planes_fragment:m_e,clipping_planes_pars_fragment:g_e,clipping_planes_pars_vertex:__e,clipping_planes_vertex:v_e,color_fragment:y_e,color_pars_fragment:b_e,color_pars_vertex:E_e,color_vertex:S_e,common:x_e,cube_uv_reflection_fragment:T_e,defaultnormal_vertex:w_e,displacementmap_pars_vertex:R_e,displacementmap_vertex:C_e,emissivemap_fragment:A_e,emissivemap_pars_fragment:M_e,colorspace_fragment:k_e,colorspace_pars_fragment:O_e,envmap_fragment:I_e,envmap_common_pars_fragment:N_e,envmap_pars_fragment:P_e,envmap_pars_vertex:D_e,envmap_physical_pars_fragment:$_e,envmap_vertex:L_e,fog_vertex:U_e,fog_pars_vertex:B_e,fog_fragment:F_e,fog_pars_fragment:j_e,gradientmap_pars_fragment:z_e,lightmap_pars_fragment:H_e,lights_lambert_fragment:q_e,lights_lambert_pars_fragment:V_e,lights_pars_begin:G_e,lights_toon_fragment:W_e,lights_toon_pars_fragment:K_e,lights_phong_fragment:X_e,lights_phong_pars_fragment:Y_e,lights_physical_fragment:Z_e,lights_physical_pars_fragment:J_e,lights_fragment_begin:Q_e,lights_fragment_maps:eve,lights_fragment_end:tve,logdepthbuf_fragment:nve,logdepthbuf_pars_fragment:rve,logdepthbuf_pars_vertex:ive,logdepthbuf_vertex:sve,map_fragment:ove,map_pars_fragment:ave,map_particle_fragment:cve,map_particle_pars_fragment:lve,metalnessmap_fragment:uve,metalnessmap_pars_fragment:fve,morphinstance_vertex:hve,morphcolor_vertex:dve,morphnormal_vertex:pve,morphtarget_pars_vertex:mve,morphtarget_vertex:gve,normal_fragment_begin:_ve,normal_fragment_maps:vve,normal_pars_fragment:yve,normal_pars_vertex:bve,normal_vertex:Eve,normalmap_pars_fragment:Sve,clearcoat_normal_fragment_begin:xve,clearcoat_normal_fragment_maps:Tve,clearcoat_pars_fragment:wve,iridescence_pars_fragment:Rve,opaque_fragment:Cve,packing:Ave,premultiplied_alpha_fragment:Mve,project_vertex:kve,dithering_fragment:Ove,dithering_pars_fragment:Ive,roughnessmap_fragment:Nve,roughnessmap_pars_fragment:Pve,shadowmap_pars_fragment:Dve,shadowmap_pars_vertex:Lve,shadowmap_vertex:Uve,shadowmask_pars_fragment:Bve,skinbase_vertex:Fve,skinning_pars_vertex:jve,skinning_vertex:zve,skinnormal_vertex:Hve,specularmap_fragment:qve,specularmap_pars_fragment:Vve,tonemapping_fragment:Gve,tonemapping_pars_fragment:$ve,transmission_fragment:Wve,transmission_pars_fragment:Kve,uv_pars_fragment:Xve,uv_pars_vertex:Yve,uv_vertex:Zve,worldpos_vertex:Jve,background_vert:Qve,background_frag:eye,backgroundCube_vert:tye,backgroundCube_frag:nye,cube_vert:rye,cube_frag:iye,depth_vert:sye,depth_frag:oye,distanceRGBA_vert:aye,distanceRGBA_frag:cye,equirect_vert:lye,equirect_frag:uye,linedashed_vert:fye,linedashed_frag:hye,meshbasic_vert:dye,meshbasic_frag:pye,meshlambert_vert:mye,meshlambert_frag:gye,meshmatcap_vert:_ye,meshmatcap_frag:vye,meshnormal_vert:yye,meshnormal_frag:bye,meshphong_vert:Eye,meshphong_frag:Sye,meshphysical_vert:xye,meshphysical_frag:Tye,meshtoon_vert:wye,meshtoon_frag:Rye,points_vert:Cye,points_frag:Aye,shadow_vert:Mye,shadow_frag:kye,sprite_vert:Oye,sprite_frag:Iye},Hn={common:{diffuse:{value:new Xi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new _i},alphaMap:{value:null},alphaMapTransform:{value:new _i},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new _i}},envmap:{envMap:{value:null},envMapRotation:{value:new _i},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new _i}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new _i}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new _i},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new _i},normalScale:{value:new Vn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new _i},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new _i}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new _i}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new _i}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Xi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Xi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new _i},alphaTest:{value:0},uvTransform:{value:new _i}},sprite:{diffuse:{value:new Xi(16777215)},opacity:{value:1},center:{value:new Vn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new _i},alphaMap:{value:null},alphaMapTransform:{value:new _i},alphaTest:{value:0}}},d0={basic:{uniforms:Df([Hn.common,Hn.specularmap,Hn.envmap,Hn.aomap,Hn.lightmap,Hn.fog]),vertexShader:yi.meshbasic_vert,fragmentShader:yi.meshbasic_frag},lambert:{uniforms:Df([Hn.common,Hn.specularmap,Hn.envmap,Hn.aomap,Hn.lightmap,Hn.emissivemap,Hn.bumpmap,Hn.normalmap,Hn.displacementmap,Hn.fog,Hn.lights,{emissive:{value:new Xi(0)}}]),vertexShader:yi.meshlambert_vert,fragmentShader:yi.meshlambert_frag},phong:{uniforms:Df([Hn.common,Hn.specularmap,Hn.envmap,Hn.aomap,Hn.lightmap,Hn.emissivemap,Hn.bumpmap,Hn.normalmap,Hn.displacementmap,Hn.fog,Hn.lights,{emissive:{value:new Xi(0)},specular:{value:new Xi(1118481)},shininess:{value:30}}]),vertexShader:yi.meshphong_vert,fragmentShader:yi.meshphong_frag},standard:{uniforms:Df([Hn.common,Hn.envmap,Hn.aomap,Hn.lightmap,Hn.emissivemap,Hn.bumpmap,Hn.normalmap,Hn.displacementmap,Hn.roughnessmap,Hn.metalnessmap,Hn.fog,Hn.lights,{emissive:{value:new Xi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yi.meshphysical_vert,fragmentShader:yi.meshphysical_frag},toon:{uniforms:Df([Hn.common,Hn.aomap,Hn.lightmap,Hn.emissivemap,Hn.bumpmap,Hn.normalmap,Hn.displacementmap,Hn.gradientmap,Hn.fog,Hn.lights,{emissive:{value:new Xi(0)}}]),vertexShader:yi.meshtoon_vert,fragmentShader:yi.meshtoon_frag},matcap:{uniforms:Df([Hn.common,Hn.bumpmap,Hn.normalmap,Hn.displacementmap,Hn.fog,{matcap:{value:null}}]),vertexShader:yi.meshmatcap_vert,fragmentShader:yi.meshmatcap_frag},points:{uniforms:Df([Hn.points,Hn.fog]),vertexShader:yi.points_vert,fragmentShader:yi.points_frag},dashed:{uniforms:Df([Hn.common,Hn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yi.linedashed_vert,fragmentShader:yi.linedashed_frag},depth:{uniforms:Df([Hn.common,Hn.displacementmap]),vertexShader:yi.depth_vert,fragmentShader:yi.depth_frag},normal:{uniforms:Df([Hn.common,Hn.bumpmap,Hn.normalmap,Hn.displacementmap,{opacity:{value:1}}]),vertexShader:yi.meshnormal_vert,fragmentShader:yi.meshnormal_frag},sprite:{uniforms:Df([Hn.sprite,Hn.fog]),vertexShader:yi.sprite_vert,fragmentShader:yi.sprite_frag},background:{uniforms:{uvTransform:{value:new _i},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:yi.background_vert,fragmentShader:yi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new _i}},vertexShader:yi.backgroundCube_vert,fragmentShader:yi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:yi.cube_vert,fragmentShader:yi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yi.equirect_vert,fragmentShader:yi.equirect_frag},distanceRGBA:{uniforms:Df([Hn.common,Hn.displacementmap,{referencePosition:{value:new jt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yi.distanceRGBA_vert,fragmentShader:yi.distanceRGBA_frag},shadow:{uniforms:Df([Hn.lights,Hn.fog,{color:{value:new Xi(0)},opacity:{value:1}}]),vertexShader:yi.shadow_vert,fragmentShader:yi.shadow_frag}};d0.physical={uniforms:Df([d0.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new _i},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new _i},clearcoatNormalScale:{value:new Vn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new _i},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new _i},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new _i},sheen:{value:0},sheenColor:{value:new Xi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new _i},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new _i},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new _i},transmissionSamplerSize:{value:new Vn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new _i},attenuationDistance:{value:0},attenuationColor:{value:new Xi(0)},specularColor:{value:new Xi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new _i},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new _i},anisotropyVector:{value:new Vn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new _i}}]),vertexShader:yi.meshphysical_vert,fragmentShader:yi.meshphysical_frag};const Z2={r:0,b:0,g:0},Db=new U0,Nye=new Ks;function Pye(t,e,n,r,i,s,o){const a=new Xi(0);let c=s===!0?0:1,l,u,h=null,d=0,m=null;function p(E){let C=E.isScene===!0?E.background:null;return C&&C.isTexture&&(C=(E.backgroundBlurriness>0?n:e).get(C)),C}function g(E){let C=!1;const A=p(E);A===null?v(a,c):A&&A.isColor&&(v(A,1),C=!0);const k=t.xr.getEnvironmentBlendMode();k==="additive"?r.buffers.color.setClear(0,0,0,1,o):k==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,o),(t.autoClear||C)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function y(E,C){const A=p(C);A&&(A.isCubeTexture||A.mapping===r3)?(u===void 0&&(u=new Uh(new qx(1,1,1),new Fa({name:"BackgroundCubeMaterial",uniforms:tx(d0.backgroundCube.uniforms),vertexShader:d0.backgroundCube.vertexShader,fragmentShader:d0.backgroundCube.fragmentShader,side:Ql,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(k,M,I){this.matrixWorld.copyPosition(I.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),Db.copy(C.backgroundRotation),Db.x*=-1,Db.y*=-1,Db.z*=-1,A.isCubeTexture&&A.isRenderTargetTexture===!1&&(Db.y*=-1,Db.z*=-1),u.material.uniforms.envMap.value=A,u.material.uniforms.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=C.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=C.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Nye.makeRotationFromEuler(Db)),u.material.toneMapped=xs.getTransfer(A.colorSpace)!==fo,(h!==A||d!==A.version||m!==t.toneMapping)&&(u.material.needsUpdate=!0,h=A,d=A.version,m=t.toneMapping),u.layers.enableAll(),E.unshift(u,u.geometry,u.material,0,0,null)):A&&A.isTexture&&(l===void 0&&(l=new Uh(new xM(2,2),new Fa({name:"BackgroundMaterial",uniforms:tx(d0.background.uniforms),vertexShader:d0.background.vertexShader,fragmentShader:d0.background.fragmentShader,side:wv,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=A,l.material.uniforms.backgroundIntensity.value=C.backgroundIntensity,l.material.toneMapped=xs.getTransfer(A.colorSpace)!==fo,A.matrixAutoUpdate===!0&&A.updateMatrix(),l.material.uniforms.uvTransform.value.copy(A.matrix),(h!==A||d!==A.version||m!==t.toneMapping)&&(l.material.needsUpdate=!0,h=A,d=A.version,m=t.toneMapping),l.layers.enableAll(),E.unshift(l,l.geometry,l.material,0,0,null))}function v(E,C){E.getRGB(Z2,_ee(t)),r.buffers.color.setClear(Z2.r,Z2.g,Z2.b,C,o)}function x(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),l!==void 0&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}return{getClearColor:function(){return a},setClearColor:function(E,C=1){a.set(E),c=C,v(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(E){c=E,v(a,c)},render:g,addToRenderList:y,dispose:x}}function Dye(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},i=d(null);let s=i,o=!1;function a(H,K,P,F,N){let X=!1;const G=h(F,P,K);s!==G&&(s=G,l(s.object)),X=m(H,F,P,N),X&&p(H,F,P,N),N!==null&&e.update(N,t.ELEMENT_ARRAY_BUFFER),(X||o)&&(o=!1,C(H,K,P,F),N!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(N).buffer))}function c(){return t.createVertexArray()}function l(H){return t.bindVertexArray(H)}function u(H){return t.deleteVertexArray(H)}function h(H,K,P){const F=P.wireframe===!0;let N=r[H.id];N===void 0&&(N={},r[H.id]=N);let X=N[K.id];X===void 0&&(X={},N[K.id]=X);let G=X[F];return G===void 0&&(G=d(c()),X[F]=G),G}function d(H){const K=[],P=[],F=[];for(let N=0;N<n;N++)K[N]=0,P[N]=0,F[N]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:K,enabledAttributes:P,attributeDivisors:F,object:H,attributes:{},index:null}}function m(H,K,P,F){const N=s.attributes,X=K.attributes;let G=0;const j=P.getAttributes();for(const q in j)if(j[q].location>=0){const W=N[q];let $=X[q];if($===void 0&&(q==="instanceMatrix"&&H.instanceMatrix&&($=H.instanceMatrix),q==="instanceColor"&&H.instanceColor&&($=H.instanceColor)),W===void 0||W.attribute!==$||$&&W.data!==$.data)return!0;G++}return s.attributesNum!==G||s.index!==F}function p(H,K,P,F){const N={},X=K.attributes;let G=0;const j=P.getAttributes();for(const q in j)if(j[q].location>=0){let W=X[q];W===void 0&&(q==="instanceMatrix"&&H.instanceMatrix&&(W=H.instanceMatrix),q==="instanceColor"&&H.instanceColor&&(W=H.instanceColor));const $={};$.attribute=W,W&&W.data&&($.data=W.data),N[q]=$,G++}s.attributes=N,s.attributesNum=G,s.index=F}function g(){const H=s.newAttributes;for(let K=0,P=H.length;K<P;K++)H[K]=0}function y(H){v(H,0)}function v(H,K){const P=s.newAttributes,F=s.enabledAttributes,N=s.attributeDivisors;P[H]=1,F[H]===0&&(t.enableVertexAttribArray(H),F[H]=1),N[H]!==K&&(t.vertexAttribDivisor(H,K),N[H]=K)}function x(){const H=s.newAttributes,K=s.enabledAttributes;for(let P=0,F=K.length;P<F;P++)K[P]!==H[P]&&(t.disableVertexAttribArray(P),K[P]=0)}function E(H,K,P,F,N,X,G){G===!0?t.vertexAttribIPointer(H,K,P,N,X):t.vertexAttribPointer(H,K,P,F,N,X)}function C(H,K,P,F){g();const N=F.attributes,X=P.getAttributes(),G=K.defaultAttributeValues;for(const j in X){const q=X[j];if(q.location>=0){let te=N[j];if(te===void 0&&(j==="instanceMatrix"&&H.instanceMatrix&&(te=H.instanceMatrix),j==="instanceColor"&&H.instanceColor&&(te=H.instanceColor)),te!==void 0){const W=te.normalized,$=te.itemSize,J=e.get(te);if(J===void 0)continue;const ne=J.buffer,ie=J.type,ae=J.bytesPerElement,xe=ie===t.INT||ie===t.UNSIGNED_INT||te.gpuType===WB;if(te.isInterleavedBufferAttribute){const Ne=te.data,Re=Ne.stride,Se=te.offset;if(Ne.isInstancedInterleavedBuffer){for(let ze=0;ze<q.locationSize;ze++)v(q.location+ze,Ne.meshPerAttribute);H.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=Ne.meshPerAttribute*Ne.count)}else for(let ze=0;ze<q.locationSize;ze++)y(q.location+ze);t.bindBuffer(t.ARRAY_BUFFER,ne);for(let ze=0;ze<q.locationSize;ze++)E(q.location+ze,$/q.locationSize,ie,W,Re*ae,(Se+$/q.locationSize*ze)*ae,xe)}else{if(te.isInstancedBufferAttribute){for(let Ne=0;Ne<q.locationSize;Ne++)v(q.location+Ne,te.meshPerAttribute);H.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let Ne=0;Ne<q.locationSize;Ne++)y(q.location+Ne);t.bindBuffer(t.ARRAY_BUFFER,ne);for(let Ne=0;Ne<q.locationSize;Ne++)E(q.location+Ne,$/q.locationSize,ie,W,$*ae,$/q.locationSize*Ne*ae,xe)}}else if(G!==void 0){const W=G[j];if(W!==void 0)switch(W.length){case 2:t.vertexAttrib2fv(q.location,W);break;case 3:t.vertexAttrib3fv(q.location,W);break;case 4:t.vertexAttrib4fv(q.location,W);break;default:t.vertexAttrib1fv(q.location,W)}}}}x()}function A(){I();for(const H in r){const K=r[H];for(const P in K){const F=K[P];for(const N in F)u(F[N].object),delete F[N];delete K[P]}delete r[H]}}function k(H){if(r[H.id]===void 0)return;const K=r[H.id];for(const P in K){const F=K[P];for(const N in F)u(F[N].object),delete F[N];delete K[P]}delete r[H.id]}function M(H){for(const K in r){const P=r[K];if(P[H.id]===void 0)continue;const F=P[H.id];for(const N in F)u(F[N].object),delete F[N];delete P[H.id]}}function I(){z(),o=!0,s!==i&&(s=i,l(s.object))}function z(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:I,resetDefaultState:z,dispose:A,releaseStatesOfGeometry:k,releaseStatesOfProgram:M,initAttributes:g,enableAttribute:y,disableUnusedAttributes:x}}function Lye(t,e,n){let r;function i(l){r=l}function s(l,u){t.drawArrays(r,l,u),n.update(u,r,1)}function o(l,u,h){h!==0&&(t.drawArraysInstanced(r,l,u,h),n.update(u,r,h))}function a(l,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,l,0,u,0,h);let m=0;for(let p=0;p<h;p++)m+=u[p];n.update(m,r,1)}function c(l,u,h,d){if(h===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let p=0;p<l.length;p++)o(l[p],u[p],d[p]);else{m.multiDrawArraysInstancedWEBGL(r,l,0,u,0,d,0,h);let p=0;for(let g=0;g<h;g++)p+=u[g]*d[g];n.update(p,r,1)}}this.setMode=i,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function Uye(t,e,n,r){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(M){return!(M!==Vf&&r.convert(M)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(M){const I=M===ab&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(M!==xa&&r.convert(M)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&M!==hg&&!I)}function c(M){if(M==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=n.precision!==void 0?n.precision:"highp";const u=c(l);u!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",u,"instead."),l=u);const h=n.logarithmicDepthBuffer===!0,d=n.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),m=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),p=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g=t.getParameter(t.MAX_TEXTURE_SIZE),y=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),v=t.getParameter(t.MAX_VERTEX_ATTRIBS),x=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),E=t.getParameter(t.MAX_VARYING_VECTORS),C=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),A=p>0,k=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:a,precision:l,logarithmicDepthBuffer:h,reverseDepthBuffer:d,maxTextures:m,maxVertexTextures:p,maxTextureSize:g,maxCubemapSize:y,maxAttributes:v,maxVertexUniforms:x,maxVaryings:E,maxFragmentUniforms:C,vertexTextures:A,maxSamples:k}}function Bye(t){const e=this;let n=null,r=0,i=!1,s=!1;const o=new Qb,a=new _i,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const m=h.length!==0||d||r!==0||i;return i=d,r=h.length,m},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){n=u(h,d,0)},this.setState=function(h,d,m){const p=h.clippingPlanes,g=h.clipIntersection,y=h.clipShadows,v=t.get(h);if(!i||p===null||p.length===0||s&&!y)s?u(null):l();else{const x=s?0:r,E=x*4;let C=v.clippingState||null;c.value=C,C=u(p,d,E,m);for(let A=0;A!==E;++A)C[A]=n[A];v.clippingState=C,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=x}};function l(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,d,m,p){const g=h!==null?h.length:0;let y=null;if(g!==0){if(y=c.value,p!==!0||y===null){const v=m+g*4,x=d.matrixWorldInverse;a.getNormalMatrix(x),(y===null||y.length<v)&&(y=new Float32Array(v));for(let E=0,C=m;E!==g;++E,C+=4)o.copy(h[E]).applyMatrix4(x,a),o.normal.toArray(y,C),y[C+3]=o.constant}c.value=y,c.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,y}}function Fye(t){let e=new WeakMap;function n(o,a){return a===e6?o.mapping=ZS:a===t6&&(o.mapping=JS),o}function r(o){if(o&&o.isTexture){const a=o.mapping;if(a===e6||a===t6)if(e.has(o)){const c=e.get(o).texture;return n(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const l=new P0e(c.height);return l.fromEquirectangularTexture(t,o),e.set(o,l),o.addEventListener("dispose",i),n(l.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}const wS=4,Ez=[.125,.215,.35,.446,.526,.582],l1=20,vD=new s8,Sz=new Xi;let yD=null,bD=0,ED=0,SD=!1;const e1=(1+Math.sqrt(5))/2,KE=1/e1,xz=[new jt(-e1,KE,0),new jt(e1,KE,0),new jt(-KE,0,e1),new jt(KE,0,e1),new jt(0,e1,-KE),new jt(0,e1,KE),new jt(-1,1,-1),new jt(1,1,-1),new jt(-1,1,1),new jt(1,1,1)],jye=new jt;class Tz{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,r=.1,i=100,s={}){const{size:o=256,position:a=jye}=s;yD=this._renderer.getRenderTarget(),bD=this._renderer.getActiveCubeFace(),ED=this._renderer.getActiveMipmapLevel(),SD=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,r,i,c,a),n>0&&this._blur(c,0,0,n),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Cz(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Rz(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(yD,bD,ED),this._renderer.xr.enabled=SD,e.scissorTest=!1,J2(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===ZS||e.mapping===JS?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),yD=this._renderer.getRenderTarget(),bD=this._renderer.getActiveCubeFace(),ED=this._renderer.getActiveMipmapLevel(),SD=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=n||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,r={magFilter:nf,minFilter:nf,generateMipmaps:!1,type:ab,format:Vf,colorSpace:Rv,depthBuffer:!1},i=wz(e,n,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=wz(e,n,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=zye(s)),this._blurMaterial=Hye(s,e,n)}return i}_compileMaterial(e){const n=new Uh(this._lodPlanes[0],e);this._renderer.compile(n,vD)}_sceneToCubeUV(e,n,r,i,s){const c=new jf(90,1,n,r),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,m=h.toneMapping;h.getClearColor(Sz),h.toneMapping=gv,h.autoClear=!1;const p=new n8({name:"PMREM.Background",side:Ql,depthWrite:!1,depthTest:!1}),g=new Uh(new qx,p);let y=!1;const v=e.background;v?v.isColor&&(p.color.copy(v),e.background=null,y=!0):(p.color.copy(Sz),y=!0);for(let x=0;x<6;x++){const E=x%3;E===0?(c.up.set(0,l[x],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+u[x],s.y,s.z)):E===1?(c.up.set(0,0,l[x]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+u[x],s.z)):(c.up.set(0,l[x],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+u[x]));const C=this._cubeSize;J2(i,E*C,x>2?C:0,C,C),h.setRenderTarget(i),y&&h.render(g,c),h.render(e,c)}g.geometry.dispose(),g.material.dispose(),h.toneMapping=m,h.autoClear=d,e.background=v}_textureToCubeUV(e,n){const r=this._renderer,i=e.mapping===ZS||e.mapping===JS;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=Cz()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Rz());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new Uh(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const c=this._cubeSize;J2(n,0,0,3*c,2*c),r.setRenderTarget(n),r.render(o,vD)}_applyPMREM(e){const n=this._renderer,r=n.autoClear;n.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=xz[(i-s-1)%xz.length];this._blur(e,s-1,s,o,a)}n.autoClear=r}_blur(e,n,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,n,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,n,r,i,s,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new Uh(this._lodPlanes[i],l),d=l.uniforms,m=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*m):2*Math.PI/(2*l1-1),g=s/p,y=isFinite(s)?1+Math.floor(u*g):l1;y>l1&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${l1}`);const v=[];let x=0;for(let M=0;M<l1;++M){const I=M/g,z=Math.exp(-I*I/2);v.push(z),M===0?x+=z:M<y&&(x+=2*z)}for(let M=0;M<v.length;M++)v[M]=v[M]/x;d.envMap.value=e.texture,d.samples.value=y,d.weights.value=v,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:E}=this;d.dTheta.value=p,d.mipInt.value=E-r;const C=this._sizeLods[i],A=3*C*(i>E-wS?i-E+wS:0),k=4*(this._cubeSize-C);J2(n,A,k,3*C,2*C),c.setRenderTarget(n),c.render(h,vD)}}function zye(t){const e=[],n=[],r=[];let i=t;const s=t-wS+1+Ez.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);n.push(a);let c=1/a;o>t-wS?c=Ez[o-t+wS-1]:o===0&&(c=0),r.push(c);const l=1/(a-2),u=-l,h=1+l,d=[u,u,h,u,h,h,u,u,h,h,u,h],m=6,p=6,g=3,y=2,v=1,x=new Float32Array(g*p*m),E=new Float32Array(y*p*m),C=new Float32Array(v*p*m);for(let k=0;k<m;k++){const M=k%3*2/3-1,I=k>2?0:-1,z=[M,I,0,M+2/3,I,0,M+2/3,I+1,0,M,I,0,M+2/3,I+1,0,M,I+1,0];x.set(z,g*p*k),E.set(d,y*p*k);const H=[k,k,k,k,k,k];C.set(H,v*p*k)}const A=new $0;A.setAttribute("position",new Pa(x,g)),A.setAttribute("uv",new Pa(E,y)),A.setAttribute("faceIndex",new Pa(C,v)),e.push(A),i>wS&&i--}return{lodPlanes:e,sizeLods:n,sigmas:r}}function wz(t,e,n){const r=new Iu(t,e,n);return r.texture.mapping=r3,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function J2(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function Hye(t,e,n){const r=new Float32Array(l1),i=new jt(0,1,0);return new Fa({name:"SphericalGaussianBlur",defines:{n:l1,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:o8(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ou,depthTest:!1,depthWrite:!1})}function Rz(){return new Fa({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:o8(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ou,depthTest:!1,depthWrite:!1})}function Cz(){return new Fa({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:o8(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ou,depthTest:!1,depthWrite:!1})}function o8(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function qye(t){let e=new WeakMap,n=null;function r(a){if(a&&a.isTexture){const c=a.mapping,l=c===e6||c===t6,u=c===ZS||c===JS;if(l||u){let h=e.get(a);const d=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return n===null&&(n=new Tz(t)),h=l?n.fromEquirectangular(a,h):n.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),h.texture;if(h!==void 0)return h.texture;{const m=a.image;return l&&m&&m.height>0||u&&m&&i(m)?(n===null&&(n=new Tz(t)),h=l?n.fromEquirectangular(a):n.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),a.addEventListener("dispose",s),h.texture):null}}}return a}function i(a){let c=0;const l=6;for(let u=0;u<l;u++)a[u]!==void 0&&c++;return c===l}function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);l!==void 0&&(e.delete(c),l.dispose())}function o(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:r,dispose:o}}function Vye(t){const e={};function n(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(r)}return e[r]=i,i}return{has:function(r){return n(r)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(r){const i=n(r);return i===null&&_O("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function Gye(t,e,n,r){const i={},s=new WeakMap;function o(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const p in d.attributes)e.remove(d.attributes[p]);d.removeEventListener("dispose",o),delete i[d.id];const m=s.get(d);m&&(e.remove(m),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,n.memory.geometries--}function a(h,d){return i[d.id]===!0||(d.addEventListener("dispose",o),i[d.id]=!0,n.memory.geometries++),d}function c(h){const d=h.attributes;for(const m in d)e.update(d[m],t.ARRAY_BUFFER)}function l(h){const d=[],m=h.index,p=h.attributes.position;let g=0;if(m!==null){const x=m.array;g=m.version;for(let E=0,C=x.length;E<C;E+=3){const A=x[E+0],k=x[E+1],M=x[E+2];d.push(A,k,k,M,M,A)}}else if(p!==void 0){const x=p.array;g=p.version;for(let E=0,C=x.length/3-1;E<C;E+=3){const A=E+0,k=E+1,M=E+2;d.push(A,k,k,M,M,A)}}else return;const y=new(hee(d)?gee:mee)(d,1);y.version=g;const v=s.get(h);v&&e.remove(v),s.set(h,y)}function u(h){const d=s.get(h);if(d){const m=h.index;m!==null&&d.version<m.version&&l(h)}else l(h);return s.get(h)}return{get:a,update:c,getWireframeAttribute:u}}function $ye(t,e,n){let r;function i(d){r=d}let s,o;function a(d){s=d.type,o=d.bytesPerElement}function c(d,m){t.drawElements(r,m,s,d*o),n.update(m,r,1)}function l(d,m,p){p!==0&&(t.drawElementsInstanced(r,m,s,d*o,p),n.update(m,r,p))}function u(d,m,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,m,0,s,d,0,p);let y=0;for(let v=0;v<p;v++)y+=m[v];n.update(y,r,1)}function h(d,m,p,g){if(p===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let v=0;v<d.length;v++)l(d[v]/o,m[v],g[v]);else{y.multiDrawElementsInstancedWEBGL(r,m,0,s,d,0,g,0,p);let v=0;for(let x=0;x<p;x++)v+=m[x]*g[x];n.update(v,r,1)}}this.setMode=i,this.setIndex=a,this.render=c,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function Wye(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,o,a){switch(n.calls++,o){case t.TRIANGLES:n.triangles+=a*(s/3);break;case t.LINES:n.lines+=a*(s/2);break;case t.LINE_STRIP:n.lines+=a*(s-1);break;case t.LINE_LOOP:n.lines+=a*s;break;case t.POINTS:n.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:i,update:r}}function Kye(t,e,n){const r=new WeakMap,i=new La;function s(o,a,c){const l=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=u!==void 0?u.length:0;let d=r.get(a);if(d===void 0||d.count!==h){let H=function(){I.dispose(),r.delete(a),a.removeEventListener("dispose",H)};var m=H;d!==void 0&&d.texture.dispose();const p=a.morphAttributes.position!==void 0,g=a.morphAttributes.normal!==void 0,y=a.morphAttributes.color!==void 0,v=a.morphAttributes.position||[],x=a.morphAttributes.normal||[],E=a.morphAttributes.color||[];let C=0;p===!0&&(C=1),g===!0&&(C=2),y===!0&&(C=3);let A=a.attributes.position.count*C,k=1;A>e.maxTextureSize&&(k=Math.ceil(A/e.maxTextureSize),A=e.maxTextureSize);const M=new Float32Array(A*k*4*h),I=new dee(M,A,k,h);I.type=hg,I.needsUpdate=!0;const z=C*4;for(let K=0;K<h;K++){const P=v[K],F=x[K],N=E[K],X=A*k*4*K;for(let G=0;G<P.count;G++){const j=G*z;p===!0&&(i.fromBufferAttribute(P,G),M[X+j+0]=i.x,M[X+j+1]=i.y,M[X+j+2]=i.z,M[X+j+3]=0),g===!0&&(i.fromBufferAttribute(F,G),M[X+j+4]=i.x,M[X+j+5]=i.y,M[X+j+6]=i.z,M[X+j+7]=0),y===!0&&(i.fromBufferAttribute(N,G),M[X+j+8]=i.x,M[X+j+9]=i.y,M[X+j+10]=i.z,M[X+j+11]=N.itemSize===4?i.w:1)}}d={count:h,texture:I,size:new Vn(A,k)},r.set(a,d),a.addEventListener("dispose",H)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(t,"morphTexture",o.morphTexture,n);else{let p=0;for(let y=0;y<l.length;y++)p+=l[y];const g=a.morphTargetsRelative?1:1-p;c.getUniforms().setValue(t,"morphTargetBaseInfluence",g),c.getUniforms().setValue(t,"morphTargetInfluences",l)}c.getUniforms().setValue(t,"morphTargetsTexture",d.texture,n),c.getUniforms().setValue(t,"morphTargetsTextureSize",d.size)}return{update:s}}function Xye(t,e,n,r){let i=new WeakMap;function s(c){const l=r.render.frame,u=c.geometry,h=e.get(c,u);if(i.get(h)!==l&&(e.update(h),i.set(h,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),i.get(c)!==l&&(n.update(c.instanceMatrix,t.ARRAY_BUFFER),c.instanceColor!==null&&n.update(c.instanceColor,t.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){const d=c.skeleton;i.get(d)!==l&&(d.update(),i.set(d,l))}return h}function o(){i=new WeakMap}function a(c){const l=c.target;l.removeEventListener("dispose",a),n.remove(l.instanceMatrix),l.instanceColor!==null&&n.remove(l.instanceColor)}return{update:s,dispose:o}}const See=new El,Az=new o3(1,1),xee=new dee,Tee=new _0e,wee=new vee,Mz=[],kz=[],Oz=new Float32Array(16),Iz=new Float32Array(9),Nz=new Float32Array(4);function Vx(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let s=Mz[i];if(s===void 0&&(s=new Float32Array(i),Mz[i]=s),e!==0){r.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=n,t[o].toArray(s,a)}return s}function Sl(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function xl(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function a3(t,e){let n=kz[e];n===void 0&&(n=new Int32Array(e),kz[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function Yye(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Zye(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Sl(n,e))return;t.uniform2fv(this.addr,e),xl(n,e)}}function Jye(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Sl(n,e))return;t.uniform3fv(this.addr,e),xl(n,e)}}function Qye(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Sl(n,e))return;t.uniform4fv(this.addr,e),xl(n,e)}}function ebe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Sl(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),xl(n,e)}else{if(Sl(n,r))return;Nz.set(r),t.uniformMatrix2fv(this.addr,!1,Nz),xl(n,r)}}function tbe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Sl(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),xl(n,e)}else{if(Sl(n,r))return;Iz.set(r),t.uniformMatrix3fv(this.addr,!1,Iz),xl(n,r)}}function nbe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Sl(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),xl(n,e)}else{if(Sl(n,r))return;Oz.set(r),t.uniformMatrix4fv(this.addr,!1,Oz),xl(n,r)}}function rbe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function ibe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Sl(n,e))return;t.uniform2iv(this.addr,e),xl(n,e)}}function sbe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Sl(n,e))return;t.uniform3iv(this.addr,e),xl(n,e)}}function obe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Sl(n,e))return;t.uniform4iv(this.addr,e),xl(n,e)}}function abe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function cbe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Sl(n,e))return;t.uniform2uiv(this.addr,e),xl(n,e)}}function lbe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Sl(n,e))return;t.uniform3uiv(this.addr,e),xl(n,e)}}function ube(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Sl(n,e))return;t.uniform4uiv(this.addr,e),xl(n,e)}}function fbe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i);let s;this.type===t.SAMPLER_2D_SHADOW?(Az.compareFunction=fee,s=Az):s=See,n.setTexture2D(e||s,i)}function hbe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||Tee,i)}function dbe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(e||wee,i)}function pbe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||xee,i)}function mbe(t){switch(t){case 5126:return Yye;case 35664:return Zye;case 35665:return Jye;case 35666:return Qye;case 35674:return ebe;case 35675:return tbe;case 35676:return nbe;case 5124:case 35670:return rbe;case 35667:case 35671:return ibe;case 35668:case 35672:return sbe;case 35669:case 35673:return obe;case 5125:return abe;case 36294:return cbe;case 36295:return lbe;case 36296:return ube;case 35678:case 36198:case 36298:case 36306:case 35682:return fbe;case 35679:case 36299:case 36307:return hbe;case 35680:case 36300:case 36308:case 36293:return dbe;case 36289:case 36303:case 36311:case 36292:return pbe}}function gbe(t,e){t.uniform1fv(this.addr,e)}function _be(t,e){const n=Vx(e,this.size,2);t.uniform2fv(this.addr,n)}function vbe(t,e){const n=Vx(e,this.size,3);t.uniform3fv(this.addr,n)}function ybe(t,e){const n=Vx(e,this.size,4);t.uniform4fv(this.addr,n)}function bbe(t,e){const n=Vx(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Ebe(t,e){const n=Vx(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Sbe(t,e){const n=Vx(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function xbe(t,e){t.uniform1iv(this.addr,e)}function Tbe(t,e){t.uniform2iv(this.addr,e)}function wbe(t,e){t.uniform3iv(this.addr,e)}function Rbe(t,e){t.uniform4iv(this.addr,e)}function Cbe(t,e){t.uniform1uiv(this.addr,e)}function Abe(t,e){t.uniform2uiv(this.addr,e)}function Mbe(t,e){t.uniform3uiv(this.addr,e)}function kbe(t,e){t.uniform4uiv(this.addr,e)}function Obe(t,e,n){const r=this.cache,i=e.length,s=a3(n,i);Sl(r,s)||(t.uniform1iv(this.addr,s),xl(r,s));for(let o=0;o!==i;++o)n.setTexture2D(e[o]||See,s[o])}function Ibe(t,e,n){const r=this.cache,i=e.length,s=a3(n,i);Sl(r,s)||(t.uniform1iv(this.addr,s),xl(r,s));for(let o=0;o!==i;++o)n.setTexture3D(e[o]||Tee,s[o])}function Nbe(t,e,n){const r=this.cache,i=e.length,s=a3(n,i);Sl(r,s)||(t.uniform1iv(this.addr,s),xl(r,s));for(let o=0;o!==i;++o)n.setTextureCube(e[o]||wee,s[o])}function Pbe(t,e,n){const r=this.cache,i=e.length,s=a3(n,i);Sl(r,s)||(t.uniform1iv(this.addr,s),xl(r,s));for(let o=0;o!==i;++o)n.setTexture2DArray(e[o]||xee,s[o])}function Dbe(t){switch(t){case 5126:return gbe;case 35664:return _be;case 35665:return vbe;case 35666:return ybe;case 35674:return bbe;case 35675:return Ebe;case 35676:return Sbe;case 5124:case 35670:return xbe;case 35667:case 35671:return Tbe;case 35668:case 35672:return wbe;case 35669:case 35673:return Rbe;case 5125:return Cbe;case 36294:return Abe;case 36295:return Mbe;case 36296:return kbe;case 35678:case 36198:case 36298:case 36306:case 35682:return Obe;case 35679:case 36299:case 36307:return Ibe;case 35680:case 36300:case 36308:case 36293:return Nbe;case 36289:case 36303:case 36311:case 36292:return Pbe}}class Lbe{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.setValue=mbe(n.type)}}class Ube{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=Dbe(n.type)}}class Bbe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,r){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,n[a.id],r)}}}const xD=/(\w+)(\])?(\[|\.)?/g;function Pz(t,e){t.seq.push(e),t.map[e.id]=e}function Fbe(t,e,n){const r=t.name,i=r.length;for(xD.lastIndex=0;;){const s=xD.exec(r),o=xD.lastIndex;let a=s[1];const c=s[2]==="]",l=s[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===i){Pz(n,l===void 0?new Lbe(a,t,e):new Ube(a,t,e));break}else{let h=n.map[a];h===void 0&&(h=new Bbe(a),Pz(n,h)),n=h}}}class vO{constructor(e,n){this.seq=[],this.map={};const r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(n,i),o=e.getUniformLocation(n,s.name);Fbe(s,o,this)}}setValue(e,n,r,i){const s=this.map[n];s!==void 0&&s.setValue(e,r,i)}setOptional(e,n,r){const i=n[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,n,r,i){for(let s=0,o=n.length;s!==o;++s){const a=n[s],c=r[a.id];c.needsUpdate!==!1&&a.setValue(e,c.value,i)}}static seqWithValue(e,n){const r=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in n&&r.push(o)}return r}}function Dz(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}const jbe=37297;let zbe=0;function Hbe(t,e){const n=t.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let o=i;o<s;o++){const a=o+1;r.push(`${a===e?">":" "} ${a}: ${n[o]}`)}return r.join(`
`)}const Lz=new _i;function qbe(t){xs._getMatrix(Lz,xs.workingColorSpace,t);const e=`mat3( ${Lz.elements.map(n=>n.toFixed(4))} )`;switch(xs.getTransfer(t)){case dI:return[e,"LinearTransferOETF"];case fo:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function Uz(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();if(r&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return n.toUpperCase()+`

`+i+`

`+Hbe(t.getShaderSource(e),o)}else return i}function Vbe(t,e){const n=qbe(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join(`
`)}function Gbe(t,e){let n;switch(e){case Age:n="Linear";break;case Mge:n="Reinhard";break;case kge:n="Cineon";break;case ree:n="ACESFilmic";break;case Ige:n="AgX";break;case Nge:n="Neutral";break;case Oge:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Q2=new jt;function $be(){xs.getLuminanceCoefficients(Q2);const t=Q2.x.toFixed(4),e=Q2.y.toFixed(4),n=Q2.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Wbe(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(zC).join(`
`)}function Kbe(t){const e=[];for(const n in t){const r=t[n];r!==!1&&e.push("#define "+n+" "+r)}return e.join(`
`)}function Xbe(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i),o=s.name;let a=1;s.type===t.FLOAT_MAT2&&(a=2),s.type===t.FLOAT_MAT3&&(a=3),s.type===t.FLOAT_MAT4&&(a=4),n[o]={type:s.type,location:t.getAttribLocation(e,o),locationSize:a}}return n}function zC(t){return t!==""}function Bz(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Fz(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Ybe=/^[ \t]*#include +<([\w\d./]+)>/gm;function I6(t){return t.replace(Ybe,Jbe)}const Zbe=new Map;function Jbe(t,e){let n=yi[e];if(n===void 0){const r=Zbe.get(e);if(r!==void 0)n=yi[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return I6(n)}const Qbe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function jz(t){return t.replace(Qbe,e1e)}function e1e(t,e,n,r){let i="";for(let s=parseInt(e);s<parseInt(n);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function zz(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function t1e(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===$B?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===fO?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===l0&&(e="SHADOWMAP_TYPE_VSM"),e}function n1e(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case ZS:case JS:e="ENVMAP_TYPE_CUBE";break;case r3:e="ENVMAP_TYPE_CUBE_UV";break}return e}function r1e(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case JS:e="ENVMAP_MODE_REFRACTION";break}return e}function i1e(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case nee:e="ENVMAP_BLENDING_MULTIPLY";break;case Rge:e="ENVMAP_BLENDING_MIX";break;case Cge:e="ENVMAP_BLENDING_ADD";break}return e}function s1e(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}function o1e(t,e,n,r){const i=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const c=t1e(n),l=n1e(n),u=r1e(n),h=i1e(n),d=s1e(n),m=Wbe(n),p=Kbe(s),g=i.createProgram();let y,v,x=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(y=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(zC).join(`
`),y.length>0&&(y+=`
`),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(zC).join(`
`),v.length>0&&(v+=`
`)):(y=[zz(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(zC).join(`
`),v=[zz(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==gv?"#define TONE_MAPPING":"",n.toneMapping!==gv?yi.tonemapping_pars_fragment:"",n.toneMapping!==gv?Gbe("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",yi.colorspace_pars_fragment,Vbe("linearToOutputTexel",n.outputColorSpace),$be(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(zC).join(`
`)),o=I6(o),o=Bz(o,n),o=Fz(o,n),a=I6(a),a=Bz(a,n),a=Fz(a,n),o=jz(o),a=jz(a),n.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,y=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,v=["#define varying in",n.glslVersion===$j?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===$j?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const E=x+y+o,C=x+v+a,A=Dz(i,i.VERTEX_SHADER,E),k=Dz(i,i.FRAGMENT_SHADER,C);i.attachShader(g,A),i.attachShader(g,k),n.index0AttributeName!==void 0?i.bindAttribLocation(g,0,n.index0AttributeName):n.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g);function M(K){if(t.debug.checkShaderErrors){const P=i.getProgramInfoLog(g).trim(),F=i.getShaderInfoLog(A).trim(),N=i.getShaderInfoLog(k).trim();let X=!0,G=!0;if(i.getProgramParameter(g,i.LINK_STATUS)===!1)if(X=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(i,g,A,k);else{const j=Uz(i,A,"vertex"),q=Uz(i,k,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(g,i.VALIDATE_STATUS)+`

Material Name: `+K.name+`
Material Type: `+K.type+`

Program Info Log: `+P+`
`+j+`
`+q)}else P!==""?console.warn("THREE.WebGLProgram: Program Info Log:",P):(F===""||N==="")&&(G=!1);G&&(K.diagnostics={runnable:X,programLog:P,vertexShader:{log:F,prefix:y},fragmentShader:{log:N,prefix:v}})}i.deleteShader(A),i.deleteShader(k),I=new vO(i,g),z=Xbe(i,g)}let I;this.getUniforms=function(){return I===void 0&&M(this),I};let z;this.getAttributes=function(){return z===void 0&&M(this),z};let H=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return H===!1&&(H=i.getProgramParameter(g,jbe)),H},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=zbe++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=A,this.fragmentShader=k,this}let a1e=0;class c1e{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(n),s=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const r of n)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let r=n.get(e);return r===void 0&&(r=new Set,n.set(e,r)),r}_getShaderStage(e){const n=this.shaderCache;let r=n.get(e);return r===void 0&&(r=new l1e(e),n.set(e,r)),r}}class l1e{constructor(e){this.id=a1e++,this.code=e,this.usedTimes=0}}function u1e(t,e,n,r,i,s,o){const a=new bA,c=new c1e,l=new Set,u=[],h=i.logarithmicDepthBuffer,d=i.vertexTextures;let m=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(z){return l.add(z),z===0?"uv":`uv${z}`}function y(z,H,K,P,F){const N=P.fog,X=F.geometry,G=z.isMeshStandardMaterial?P.environment:null,j=(z.isMeshStandardMaterial?n:e).get(z.envMap||G),q=j&&j.mapping===r3?j.image.height:null,te=p[z.type];z.precision!==null&&(m=i.getMaxPrecision(z.precision),m!==z.precision&&console.warn("THREE.WebGLProgram.getParameters:",z.precision,"not supported, using",m,"instead."));const W=X.morphAttributes.position||X.morphAttributes.normal||X.morphAttributes.color,$=W!==void 0?W.length:0;let J=0;X.morphAttributes.position!==void 0&&(J=1),X.morphAttributes.normal!==void 0&&(J=2),X.morphAttributes.color!==void 0&&(J=3);let ne,ie,ae,xe;if(te){const ct=d0[te];ne=ct.vertexShader,ie=ct.fragmentShader}else ne=z.vertexShader,ie=z.fragmentShader,c.update(z),ae=c.getVertexShaderID(z),xe=c.getFragmentShaderID(z);const Ne=t.getRenderTarget(),Re=t.state.buffers.depth.getReversed(),Se=F.isInstancedMesh===!0,ze=F.isBatchedMesh===!0,Be=!!z.map,Je=!!z.matcap,at=!!j,re=!!z.aoMap,Le=!!z.lightMap,He=!!z.bumpMap,Ue=!!z.normalMap,De=!!z.displacementMap,fe=!!z.emissiveMap,ve=!!z.metalnessMap,Ae=!!z.roughnessMap,pe=z.anisotropy>0,Ge=z.clearcoat>0,Qe=z.dispersion>0,Ze=z.iridescence>0,tt=z.sheen>0,Ft=z.transmission>0,bt=pe&&!!z.anisotropyMap,Mt=Ge&&!!z.clearcoatMap,Ie=Ge&&!!z.clearcoatNormalMap,ce=Ge&&!!z.clearcoatRoughnessMap,Q=Ze&&!!z.iridescenceMap,le=Ze&&!!z.iridescenceThicknessMap,we=tt&&!!z.sheenColorMap,Me=tt&&!!z.sheenRoughnessMap,Te=!!z.specularMap,ye=!!z.specularColorMap,Ye=!!z.specularIntensityMap,Pe=Ft&&!!z.transmissionMap,We=Ft&&!!z.thicknessMap,Ve=!!z.gradientMap,Xe=!!z.alphaMap,lt=z.alphaTest>0,qe=!!z.alphaHash,rt=!!z.extensions;let it=gv;z.toneMapped&&(Ne===null||Ne.isXRRenderTarget===!0)&&(it=t.toneMapping);const nt={shaderID:te,shaderType:z.type,shaderName:z.name,vertexShader:ne,fragmentShader:ie,defines:z.defines,customVertexShaderID:ae,customFragmentShaderID:xe,isRawShaderMaterial:z.isRawShaderMaterial===!0,glslVersion:z.glslVersion,precision:m,batching:ze,batchingColor:ze&&F._colorsTexture!==null,instancing:Se,instancingColor:Se&&F.instanceColor!==null,instancingMorph:Se&&F.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:Ne===null?t.outputColorSpace:Ne.isXRRenderTarget===!0?Ne.texture.colorSpace:Rv,alphaToCoverage:!!z.alphaToCoverage,map:Be,matcap:Je,envMap:at,envMapMode:at&&j.mapping,envMapCubeUVHeight:q,aoMap:re,lightMap:Le,bumpMap:He,normalMap:Ue,displacementMap:d&&De,emissiveMap:fe,normalMapObjectSpace:Ue&&z.normalMapType===Uge,normalMapTangentSpace:Ue&&z.normalMapType===Lge,metalnessMap:ve,roughnessMap:Ae,anisotropy:pe,anisotropyMap:bt,clearcoat:Ge,clearcoatMap:Mt,clearcoatNormalMap:Ie,clearcoatRoughnessMap:ce,dispersion:Qe,iridescence:Ze,iridescenceMap:Q,iridescenceThicknessMap:le,sheen:tt,sheenColorMap:we,sheenRoughnessMap:Me,specularMap:Te,specularColorMap:ye,specularIntensityMap:Ye,transmission:Ft,transmissionMap:Pe,thicknessMap:We,gradientMap:Ve,opaque:z.transparent===!1&&z.blending===DS&&z.alphaToCoverage===!1,alphaMap:Xe,alphaTest:lt,alphaHash:qe,combine:z.combine,mapUv:Be&&g(z.map.channel),aoMapUv:re&&g(z.aoMap.channel),lightMapUv:Le&&g(z.lightMap.channel),bumpMapUv:He&&g(z.bumpMap.channel),normalMapUv:Ue&&g(z.normalMap.channel),displacementMapUv:De&&g(z.displacementMap.channel),emissiveMapUv:fe&&g(z.emissiveMap.channel),metalnessMapUv:ve&&g(z.metalnessMap.channel),roughnessMapUv:Ae&&g(z.roughnessMap.channel),anisotropyMapUv:bt&&g(z.anisotropyMap.channel),clearcoatMapUv:Mt&&g(z.clearcoatMap.channel),clearcoatNormalMapUv:Ie&&g(z.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ce&&g(z.clearcoatRoughnessMap.channel),iridescenceMapUv:Q&&g(z.iridescenceMap.channel),iridescenceThicknessMapUv:le&&g(z.iridescenceThicknessMap.channel),sheenColorMapUv:we&&g(z.sheenColorMap.channel),sheenRoughnessMapUv:Me&&g(z.sheenRoughnessMap.channel),specularMapUv:Te&&g(z.specularMap.channel),specularColorMapUv:ye&&g(z.specularColorMap.channel),specularIntensityMapUv:Ye&&g(z.specularIntensityMap.channel),transmissionMapUv:Pe&&g(z.transmissionMap.channel),thicknessMapUv:We&&g(z.thicknessMap.channel),alphaMapUv:Xe&&g(z.alphaMap.channel),vertexTangents:!!X.attributes.tangent&&(Ue||pe),vertexColors:z.vertexColors,vertexAlphas:z.vertexColors===!0&&!!X.attributes.color&&X.attributes.color.itemSize===4,pointsUvs:F.isPoints===!0&&!!X.attributes.uv&&(Be||Xe),fog:!!N,useFog:z.fog===!0,fogExp2:!!N&&N.isFogExp2,flatShading:z.flatShading===!0,sizeAttenuation:z.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:Re,skinning:F.isSkinnedMesh===!0,morphTargets:X.morphAttributes.position!==void 0,morphNormals:X.morphAttributes.normal!==void 0,morphColors:X.morphAttributes.color!==void 0,morphTargetsCount:$,morphTextureStride:J,numDirLights:H.directional.length,numPointLights:H.point.length,numSpotLights:H.spot.length,numSpotLightMaps:H.spotLightMap.length,numRectAreaLights:H.rectArea.length,numHemiLights:H.hemi.length,numDirLightShadows:H.directionalShadowMap.length,numPointLightShadows:H.pointShadowMap.length,numSpotLightShadows:H.spotShadowMap.length,numSpotLightShadowsWithMaps:H.numSpotLightShadowsWithMaps,numLightProbes:H.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:z.dithering,shadowMapEnabled:t.shadowMap.enabled&&K.length>0,shadowMapType:t.shadowMap.type,toneMapping:it,decodeVideoTexture:Be&&z.map.isVideoTexture===!0&&xs.getTransfer(z.map.colorSpace)===fo,decodeVideoTextureEmissive:fe&&z.emissiveMap.isVideoTexture===!0&&xs.getTransfer(z.emissiveMap.colorSpace)===fo,premultipliedAlpha:z.premultipliedAlpha,doubleSided:z.side===Zl,flipSided:z.side===Ql,useDepthPacking:z.depthPacking>=0,depthPacking:z.depthPacking||0,index0AttributeName:z.index0AttributeName,extensionClipCullDistance:rt&&z.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(rt&&z.extensions.multiDraw===!0||ze)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:z.customProgramCacheKey()};return nt.vertexUv1s=l.has(1),nt.vertexUv2s=l.has(2),nt.vertexUv3s=l.has(3),l.clear(),nt}function v(z){const H=[];if(z.shaderID?H.push(z.shaderID):(H.push(z.customVertexShaderID),H.push(z.customFragmentShaderID)),z.defines!==void 0)for(const K in z.defines)H.push(K),H.push(z.defines[K]);return z.isRawShaderMaterial===!1&&(x(H,z),E(H,z),H.push(t.outputColorSpace)),H.push(z.customProgramCacheKey),H.join()}function x(z,H){z.push(H.precision),z.push(H.outputColorSpace),z.push(H.envMapMode),z.push(H.envMapCubeUVHeight),z.push(H.mapUv),z.push(H.alphaMapUv),z.push(H.lightMapUv),z.push(H.aoMapUv),z.push(H.bumpMapUv),z.push(H.normalMapUv),z.push(H.displacementMapUv),z.push(H.emissiveMapUv),z.push(H.metalnessMapUv),z.push(H.roughnessMapUv),z.push(H.anisotropyMapUv),z.push(H.clearcoatMapUv),z.push(H.clearcoatNormalMapUv),z.push(H.clearcoatRoughnessMapUv),z.push(H.iridescenceMapUv),z.push(H.iridescenceThicknessMapUv),z.push(H.sheenColorMapUv),z.push(H.sheenRoughnessMapUv),z.push(H.specularMapUv),z.push(H.specularColorMapUv),z.push(H.specularIntensityMapUv),z.push(H.transmissionMapUv),z.push(H.thicknessMapUv),z.push(H.combine),z.push(H.fogExp2),z.push(H.sizeAttenuation),z.push(H.morphTargetsCount),z.push(H.morphAttributeCount),z.push(H.numDirLights),z.push(H.numPointLights),z.push(H.numSpotLights),z.push(H.numSpotLightMaps),z.push(H.numHemiLights),z.push(H.numRectAreaLights),z.push(H.numDirLightShadows),z.push(H.numPointLightShadows),z.push(H.numSpotLightShadows),z.push(H.numSpotLightShadowsWithMaps),z.push(H.numLightProbes),z.push(H.shadowMapType),z.push(H.toneMapping),z.push(H.numClippingPlanes),z.push(H.numClipIntersection),z.push(H.depthPacking)}function E(z,H){a.disableAll(),H.supportsVertexTextures&&a.enable(0),H.instancing&&a.enable(1),H.instancingColor&&a.enable(2),H.instancingMorph&&a.enable(3),H.matcap&&a.enable(4),H.envMap&&a.enable(5),H.normalMapObjectSpace&&a.enable(6),H.normalMapTangentSpace&&a.enable(7),H.clearcoat&&a.enable(8),H.iridescence&&a.enable(9),H.alphaTest&&a.enable(10),H.vertexColors&&a.enable(11),H.vertexAlphas&&a.enable(12),H.vertexUv1s&&a.enable(13),H.vertexUv2s&&a.enable(14),H.vertexUv3s&&a.enable(15),H.vertexTangents&&a.enable(16),H.anisotropy&&a.enable(17),H.alphaHash&&a.enable(18),H.batching&&a.enable(19),H.dispersion&&a.enable(20),H.batchingColor&&a.enable(21),z.push(a.mask),a.disableAll(),H.fog&&a.enable(0),H.useFog&&a.enable(1),H.flatShading&&a.enable(2),H.logarithmicDepthBuffer&&a.enable(3),H.reverseDepthBuffer&&a.enable(4),H.skinning&&a.enable(5),H.morphTargets&&a.enable(6),H.morphNormals&&a.enable(7),H.morphColors&&a.enable(8),H.premultipliedAlpha&&a.enable(9),H.shadowMapEnabled&&a.enable(10),H.doubleSided&&a.enable(11),H.flipSided&&a.enable(12),H.useDepthPacking&&a.enable(13),H.dithering&&a.enable(14),H.transmission&&a.enable(15),H.sheen&&a.enable(16),H.opaque&&a.enable(17),H.pointsUvs&&a.enable(18),H.decodeVideoTexture&&a.enable(19),H.decodeVideoTextureEmissive&&a.enable(20),H.alphaToCoverage&&a.enable(21),z.push(a.mask)}function C(z){const H=p[z.type];let K;if(H){const P=d0[H];K=k0e.clone(P.uniforms)}else K=z.uniforms;return K}function A(z,H){let K;for(let P=0,F=u.length;P<F;P++){const N=u[P];if(N.cacheKey===H){K=N,++K.usedTimes;break}}return K===void 0&&(K=new o1e(t,H,z,s),u.push(K)),K}function k(z){if(--z.usedTimes===0){const H=u.indexOf(z);u[H]=u[u.length-1],u.pop(),z.destroy()}}function M(z){c.remove(z)}function I(){c.dispose()}return{getParameters:y,getProgramCacheKey:v,getUniforms:C,acquireProgram:A,releaseProgram:k,releaseShaderCache:M,programs:u,dispose:I}}function f1e(){let t=new WeakMap;function e(o){return t.has(o)}function n(o){let a=t.get(o);return a===void 0&&(a={},t.set(o,a)),a}function r(o){t.delete(o)}function i(o,a,c){t.get(o)[a]=c}function s(){t=new WeakMap}return{has:e,get:n,remove:r,update:i,dispose:s}}function h1e(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Hz(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function qz(){const t=[];let e=0;const n=[],r=[],i=[];function s(){e=0,n.length=0,r.length=0,i.length=0}function o(h,d,m,p,g,y){let v=t[e];return v===void 0?(v={id:h.id,object:h,geometry:d,material:m,groupOrder:p,renderOrder:h.renderOrder,z:g,group:y},t[e]=v):(v.id=h.id,v.object=h,v.geometry=d,v.material=m,v.groupOrder=p,v.renderOrder=h.renderOrder,v.z=g,v.group=y),e++,v}function a(h,d,m,p,g,y){const v=o(h,d,m,p,g,y);m.transmission>0?r.push(v):m.transparent===!0?i.push(v):n.push(v)}function c(h,d,m,p,g,y){const v=o(h,d,m,p,g,y);m.transmission>0?r.unshift(v):m.transparent===!0?i.unshift(v):n.unshift(v)}function l(h,d){n.length>1&&n.sort(h||h1e),r.length>1&&r.sort(d||Hz),i.length>1&&i.sort(d||Hz)}function u(){for(let h=e,d=t.length;h<d;h++){const m=t[h];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:n,transmissive:r,transparent:i,init:s,push:a,unshift:c,finish:u,sort:l}}function d1e(){let t=new WeakMap;function e(r,i){const s=t.get(r);let o;return s===void 0?(o=new qz,t.set(r,[o])):i>=s.length?(o=new qz,s.push(o)):o=s[i],o}function n(){t=new WeakMap}return{get:e,dispose:n}}function p1e(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new jt,color:new Xi};break;case"SpotLight":n={position:new jt,direction:new jt,color:new Xi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new jt,color:new Xi,distance:0,decay:0};break;case"HemisphereLight":n={direction:new jt,skyColor:new Xi,groundColor:new Xi};break;case"RectAreaLight":n={color:new Xi,position:new jt,halfWidth:new jt,halfHeight:new jt};break}return t[e.id]=n,n}}}function m1e(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vn};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vn};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vn,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let g1e=0;function _1e(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function v1e(t){const e=new p1e,n=m1e(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)r.probe.push(new jt);const i=new jt,s=new Ks,o=new Ks;function a(l){let u=0,h=0,d=0;for(let z=0;z<9;z++)r.probe[z].set(0,0,0);let m=0,p=0,g=0,y=0,v=0,x=0,E=0,C=0,A=0,k=0,M=0;l.sort(_1e);for(let z=0,H=l.length;z<H;z++){const K=l[z],P=K.color,F=K.intensity,N=K.distance,X=K.shadow&&K.shadow.map?K.shadow.map.texture:null;if(K.isAmbientLight)u+=P.r*F,h+=P.g*F,d+=P.b*F;else if(K.isLightProbe){for(let G=0;G<9;G++)r.probe[G].addScaledVector(K.sh.coefficients[G],F);M++}else if(K.isDirectionalLight){const G=e.get(K);if(G.color.copy(K.color).multiplyScalar(K.intensity),K.castShadow){const j=K.shadow,q=n.get(K);q.shadowIntensity=j.intensity,q.shadowBias=j.bias,q.shadowNormalBias=j.normalBias,q.shadowRadius=j.radius,q.shadowMapSize=j.mapSize,r.directionalShadow[m]=q,r.directionalShadowMap[m]=X,r.directionalShadowMatrix[m]=K.shadow.matrix,x++}r.directional[m]=G,m++}else if(K.isSpotLight){const G=e.get(K);G.position.setFromMatrixPosition(K.matrixWorld),G.color.copy(P).multiplyScalar(F),G.distance=N,G.coneCos=Math.cos(K.angle),G.penumbraCos=Math.cos(K.angle*(1-K.penumbra)),G.decay=K.decay,r.spot[g]=G;const j=K.shadow;if(K.map&&(r.spotLightMap[A]=K.map,A++,j.updateMatrices(K),K.castShadow&&k++),r.spotLightMatrix[g]=j.matrix,K.castShadow){const q=n.get(K);q.shadowIntensity=j.intensity,q.shadowBias=j.bias,q.shadowNormalBias=j.normalBias,q.shadowRadius=j.radius,q.shadowMapSize=j.mapSize,r.spotShadow[g]=q,r.spotShadowMap[g]=X,C++}g++}else if(K.isRectAreaLight){const G=e.get(K);G.color.copy(P).multiplyScalar(F),G.halfWidth.set(K.width*.5,0,0),G.halfHeight.set(0,K.height*.5,0),r.rectArea[y]=G,y++}else if(K.isPointLight){const G=e.get(K);if(G.color.copy(K.color).multiplyScalar(K.intensity),G.distance=K.distance,G.decay=K.decay,K.castShadow){const j=K.shadow,q=n.get(K);q.shadowIntensity=j.intensity,q.shadowBias=j.bias,q.shadowNormalBias=j.normalBias,q.shadowRadius=j.radius,q.shadowMapSize=j.mapSize,q.shadowCameraNear=j.camera.near,q.shadowCameraFar=j.camera.far,r.pointShadow[p]=q,r.pointShadowMap[p]=X,r.pointShadowMatrix[p]=K.shadow.matrix,E++}r.point[p]=G,p++}else if(K.isHemisphereLight){const G=e.get(K);G.skyColor.copy(K.color).multiplyScalar(F),G.groundColor.copy(K.groundColor).multiplyScalar(F),r.hemi[v]=G,v++}}y>0&&(t.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Hn.LTC_FLOAT_1,r.rectAreaLTC2=Hn.LTC_FLOAT_2):(r.rectAreaLTC1=Hn.LTC_HALF_1,r.rectAreaLTC2=Hn.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=d;const I=r.hash;(I.directionalLength!==m||I.pointLength!==p||I.spotLength!==g||I.rectAreaLength!==y||I.hemiLength!==v||I.numDirectionalShadows!==x||I.numPointShadows!==E||I.numSpotShadows!==C||I.numSpotMaps!==A||I.numLightProbes!==M)&&(r.directional.length=m,r.spot.length=g,r.rectArea.length=y,r.point.length=p,r.hemi.length=v,r.directionalShadow.length=x,r.directionalShadowMap.length=x,r.pointShadow.length=E,r.pointShadowMap.length=E,r.spotShadow.length=C,r.spotShadowMap.length=C,r.directionalShadowMatrix.length=x,r.pointShadowMatrix.length=E,r.spotLightMatrix.length=C+A-k,r.spotLightMap.length=A,r.numSpotLightShadowsWithMaps=k,r.numLightProbes=M,I.directionalLength=m,I.pointLength=p,I.spotLength=g,I.rectAreaLength=y,I.hemiLength=v,I.numDirectionalShadows=x,I.numPointShadows=E,I.numSpotShadows=C,I.numSpotMaps=A,I.numLightProbes=M,r.version=g1e++)}function c(l,u){let h=0,d=0,m=0,p=0,g=0;const y=u.matrixWorldInverse;for(let v=0,x=l.length;v<x;v++){const E=l[v];if(E.isDirectionalLight){const C=r.directional[h];C.direction.setFromMatrixPosition(E.matrixWorld),i.setFromMatrixPosition(E.target.matrixWorld),C.direction.sub(i),C.direction.transformDirection(y),h++}else if(E.isSpotLight){const C=r.spot[m];C.position.setFromMatrixPosition(E.matrixWorld),C.position.applyMatrix4(y),C.direction.setFromMatrixPosition(E.matrixWorld),i.setFromMatrixPosition(E.target.matrixWorld),C.direction.sub(i),C.direction.transformDirection(y),m++}else if(E.isRectAreaLight){const C=r.rectArea[p];C.position.setFromMatrixPosition(E.matrixWorld),C.position.applyMatrix4(y),o.identity(),s.copy(E.matrixWorld),s.premultiply(y),o.extractRotation(s),C.halfWidth.set(E.width*.5,0,0),C.halfHeight.set(0,E.height*.5,0),C.halfWidth.applyMatrix4(o),C.halfHeight.applyMatrix4(o),p++}else if(E.isPointLight){const C=r.point[d];C.position.setFromMatrixPosition(E.matrixWorld),C.position.applyMatrix4(y),d++}else if(E.isHemisphereLight){const C=r.hemi[g];C.direction.setFromMatrixPosition(E.matrixWorld),C.direction.transformDirection(y),g++}}}return{setup:a,setupView:c,state:r}}function Vz(t){const e=new v1e(t),n=[],r=[];function i(u){l.camera=u,n.length=0,r.length=0}function s(u){n.push(u)}function o(u){r.push(u)}function a(){e.setup(n)}function c(u){e.setupView(n,u)}const l={lightsArray:n,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:o}}function y1e(t){let e=new WeakMap;function n(i,s=0){const o=e.get(i);let a;return o===void 0?(a=new Vz(t),e.set(i,[a])):s>=o.length?(a=new Vz(t),o.push(a)):a=o[s],a}function r(){e=new WeakMap}return{get:n,dispose:r}}const b1e=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,E1e=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function S1e(t,e,n){let r=new yee;const i=new Vn,s=new Vn,o=new La,a=new q0e({depthPacking:Dge}),c=new V0e,l={},u=n.maxTextureSize,h={[wv]:Ql,[Ql]:wv,[Zl]:Zl},d=new Fa({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vn},radius:{value:4}},vertexShader:b1e,fragmentShader:E1e}),m=d.clone();m.defines.HORIZONTAL_PASS=1;const p=new $0;p.setAttribute("position",new Pa(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new Uh(p,d),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=$B;let v=this.type;this.render=function(k,M,I){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||k.length===0)return;const z=t.getRenderTarget(),H=t.getActiveCubeFace(),K=t.getActiveMipmapLevel(),P=t.state;P.setBlending(Ou),P.buffers.color.setClear(1,1,1,1),P.buffers.depth.setTest(!0),P.setScissorTest(!1);const F=v!==l0&&this.type===l0,N=v===l0&&this.type!==l0;for(let X=0,G=k.length;X<G;X++){const j=k[X],q=j.shadow;if(q===void 0){console.warn("THREE.WebGLShadowMap:",j,"has no shadow.");continue}if(q.autoUpdate===!1&&q.needsUpdate===!1)continue;i.copy(q.mapSize);const te=q.getFrameExtents();if(i.multiply(te),s.copy(q.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/te.x),i.x=s.x*te.x,q.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/te.y),i.y=s.y*te.y,q.mapSize.y=s.y)),q.map===null||F===!0||N===!0){const $=this.type!==l0?{minFilter:rf,magFilter:rf}:{};q.map!==null&&q.map.dispose(),q.map=new Iu(i.x,i.y,$),q.map.texture.name=j.name+".shadowMap",q.camera.updateProjectionMatrix()}t.setRenderTarget(q.map),t.clear();const W=q.getViewportCount();for(let $=0;$<W;$++){const J=q.getViewport($);o.set(s.x*J.x,s.y*J.y,s.x*J.z,s.y*J.w),P.viewport(o),q.updateMatrices(j,$),r=q.getFrustum(),C(M,I,q.camera,j,this.type)}q.isPointLightShadow!==!0&&this.type===l0&&x(q,I),q.needsUpdate=!1}v=this.type,y.needsUpdate=!1,t.setRenderTarget(z,H,K)};function x(k,M){const I=e.update(g);d.defines.VSM_SAMPLES!==k.blurSamples&&(d.defines.VSM_SAMPLES=k.blurSamples,m.defines.VSM_SAMPLES=k.blurSamples,d.needsUpdate=!0,m.needsUpdate=!0),k.mapPass===null&&(k.mapPass=new Iu(i.x,i.y)),d.uniforms.shadow_pass.value=k.map.texture,d.uniforms.resolution.value=k.mapSize,d.uniforms.radius.value=k.radius,t.setRenderTarget(k.mapPass),t.clear(),t.renderBufferDirect(M,null,I,d,g,null),m.uniforms.shadow_pass.value=k.mapPass.texture,m.uniforms.resolution.value=k.mapSize,m.uniforms.radius.value=k.radius,t.setRenderTarget(k.map),t.clear(),t.renderBufferDirect(M,null,I,m,g,null)}function E(k,M,I,z){let H=null;const K=I.isPointLight===!0?k.customDistanceMaterial:k.customDepthMaterial;if(K!==void 0)H=K;else if(H=I.isPointLight===!0?c:a,t.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0||M.alphaToCoverage===!0){const P=H.uuid,F=M.uuid;let N=l[P];N===void 0&&(N={},l[P]=N);let X=N[F];X===void 0&&(X=H.clone(),N[F]=X,M.addEventListener("dispose",A)),H=X}if(H.visible=M.visible,H.wireframe=M.wireframe,z===l0?H.side=M.shadowSide!==null?M.shadowSide:M.side:H.side=M.shadowSide!==null?M.shadowSide:h[M.side],H.alphaMap=M.alphaMap,H.alphaTest=M.alphaToCoverage===!0?.5:M.alphaTest,H.map=M.map,H.clipShadows=M.clipShadows,H.clippingPlanes=M.clippingPlanes,H.clipIntersection=M.clipIntersection,H.displacementMap=M.displacementMap,H.displacementScale=M.displacementScale,H.displacementBias=M.displacementBias,H.wireframeLinewidth=M.wireframeLinewidth,H.linewidth=M.linewidth,I.isPointLight===!0&&H.isMeshDistanceMaterial===!0){const P=t.properties.get(H);P.light=I}return H}function C(k,M,I,z,H){if(k.visible===!1)return;if(k.layers.test(M.layers)&&(k.isMesh||k.isLine||k.isPoints)&&(k.castShadow||k.receiveShadow&&H===l0)&&(!k.frustumCulled||r.intersectsObject(k))){k.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,k.matrixWorld);const F=e.update(k),N=k.material;if(Array.isArray(N)){const X=F.groups;for(let G=0,j=X.length;G<j;G++){const q=X[G],te=N[q.materialIndex];if(te&&te.visible){const W=E(k,te,z,H);k.onBeforeShadow(t,k,M,I,F,W,q),t.renderBufferDirect(I,null,F,W,k,q),k.onAfterShadow(t,k,M,I,F,W,q)}}}else if(N.visible){const X=E(k,N,z,H);k.onBeforeShadow(t,k,M,I,F,X,null),t.renderBufferDirect(I,null,F,X,k,null),k.onAfterShadow(t,k,M,I,F,X,null)}}const P=k.children;for(let F=0,N=P.length;F<N;F++)C(P[F],M,I,z,H)}function A(k){k.target.removeEventListener("dispose",A);for(const I in l){const z=l[I],H=k.target.uuid;H in z&&(z[H].dispose(),delete z[H])}}}const x1e={[WU]:KU,[XU]:JU,[YU]:QU,[YS]:ZU,[KU]:WU,[JU]:XU,[QU]:YU,[ZU]:YS};function T1e(t,e){function n(){let Pe=!1;const We=new La;let Ve=null;const Xe=new La(0,0,0,0);return{setMask:function(lt){Ve!==lt&&!Pe&&(t.colorMask(lt,lt,lt,lt),Ve=lt)},setLocked:function(lt){Pe=lt},setClear:function(lt,qe,rt,it,nt){nt===!0&&(lt*=it,qe*=it,rt*=it),We.set(lt,qe,rt,it),Xe.equals(We)===!1&&(t.clearColor(lt,qe,rt,it),Xe.copy(We))},reset:function(){Pe=!1,Ve=null,Xe.set(-1,0,0,0)}}}function r(){let Pe=!1,We=!1,Ve=null,Xe=null,lt=null;return{setReversed:function(qe){if(We!==qe){const rt=e.get("EXT_clip_control");qe?rt.clipControlEXT(rt.LOWER_LEFT_EXT,rt.ZERO_TO_ONE_EXT):rt.clipControlEXT(rt.LOWER_LEFT_EXT,rt.NEGATIVE_ONE_TO_ONE_EXT),We=qe;const it=lt;lt=null,this.setClear(it)}},getReversed:function(){return We},setTest:function(qe){qe?Ne(t.DEPTH_TEST):Re(t.DEPTH_TEST)},setMask:function(qe){Ve!==qe&&!Pe&&(t.depthMask(qe),Ve=qe)},setFunc:function(qe){if(We&&(qe=x1e[qe]),Xe!==qe){switch(qe){case WU:t.depthFunc(t.NEVER);break;case KU:t.depthFunc(t.ALWAYS);break;case XU:t.depthFunc(t.LESS);break;case YS:t.depthFunc(t.LEQUAL);break;case YU:t.depthFunc(t.EQUAL);break;case ZU:t.depthFunc(t.GEQUAL);break;case JU:t.depthFunc(t.GREATER);break;case QU:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}Xe=qe}},setLocked:function(qe){Pe=qe},setClear:function(qe){lt!==qe&&(We&&(qe=1-qe),t.clearDepth(qe),lt=qe)},reset:function(){Pe=!1,Ve=null,Xe=null,lt=null,We=!1}}}function i(){let Pe=!1,We=null,Ve=null,Xe=null,lt=null,qe=null,rt=null,it=null,nt=null;return{setTest:function(ct){Pe||(ct?Ne(t.STENCIL_TEST):Re(t.STENCIL_TEST))},setMask:function(ct){We!==ct&&!Pe&&(t.stencilMask(ct),We=ct)},setFunc:function(ct,Qt,tn){(Ve!==ct||Xe!==Qt||lt!==tn)&&(t.stencilFunc(ct,Qt,tn),Ve=ct,Xe=Qt,lt=tn)},setOp:function(ct,Qt,tn){(qe!==ct||rt!==Qt||it!==tn)&&(t.stencilOp(ct,Qt,tn),qe=ct,rt=Qt,it=tn)},setLocked:function(ct){Pe=ct},setClear:function(ct){nt!==ct&&(t.clearStencil(ct),nt=ct)},reset:function(){Pe=!1,We=null,Ve=null,Xe=null,lt=null,qe=null,rt=null,it=null,nt=null}}}const s=new n,o=new r,a=new i,c=new WeakMap,l=new WeakMap;let u={},h={},d=new WeakMap,m=[],p=null,g=!1,y=null,v=null,x=null,E=null,C=null,A=null,k=null,M=new Xi(0,0,0),I=0,z=!1,H=null,K=null,P=null,F=null,N=null;const X=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let G=!1,j=0;const q=t.getParameter(t.VERSION);q.indexOf("WebGL")!==-1?(j=parseFloat(/^WebGL (\d)/.exec(q)[1]),G=j>=1):q.indexOf("OpenGL ES")!==-1&&(j=parseFloat(/^OpenGL ES (\d)/.exec(q)[1]),G=j>=2);let te=null,W={};const $=t.getParameter(t.SCISSOR_BOX),J=t.getParameter(t.VIEWPORT),ne=new La().fromArray($),ie=new La().fromArray(J);function ae(Pe,We,Ve,Xe){const lt=new Uint8Array(4),qe=t.createTexture();t.bindTexture(Pe,qe),t.texParameteri(Pe,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(Pe,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let rt=0;rt<Ve;rt++)Pe===t.TEXTURE_3D||Pe===t.TEXTURE_2D_ARRAY?t.texImage3D(We,0,t.RGBA,1,1,Xe,0,t.RGBA,t.UNSIGNED_BYTE,lt):t.texImage2D(We+rt,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,lt);return qe}const xe={};xe[t.TEXTURE_2D]=ae(t.TEXTURE_2D,t.TEXTURE_2D,1),xe[t.TEXTURE_CUBE_MAP]=ae(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),xe[t.TEXTURE_2D_ARRAY]=ae(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),xe[t.TEXTURE_3D]=ae(t.TEXTURE_3D,t.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),Ne(t.DEPTH_TEST),o.setFunc(YS),He(!1),Ue(Fj),Ne(t.CULL_FACE),re(Ou);function Ne(Pe){u[Pe]!==!0&&(t.enable(Pe),u[Pe]=!0)}function Re(Pe){u[Pe]!==!1&&(t.disable(Pe),u[Pe]=!1)}function Se(Pe,We){return h[Pe]!==We?(t.bindFramebuffer(Pe,We),h[Pe]=We,Pe===t.DRAW_FRAMEBUFFER&&(h[t.FRAMEBUFFER]=We),Pe===t.FRAMEBUFFER&&(h[t.DRAW_FRAMEBUFFER]=We),!0):!1}function ze(Pe,We){let Ve=m,Xe=!1;if(Pe){Ve=d.get(We),Ve===void 0&&(Ve=[],d.set(We,Ve));const lt=Pe.textures;if(Ve.length!==lt.length||Ve[0]!==t.COLOR_ATTACHMENT0){for(let qe=0,rt=lt.length;qe<rt;qe++)Ve[qe]=t.COLOR_ATTACHMENT0+qe;Ve.length=lt.length,Xe=!0}}else Ve[0]!==t.BACK&&(Ve[0]=t.BACK,Xe=!0);Xe&&t.drawBuffers(Ve)}function Be(Pe){return p!==Pe?(t.useProgram(Pe),p=Pe,!0):!1}const Je={[c1]:t.FUNC_ADD,[lge]:t.FUNC_SUBTRACT,[uge]:t.FUNC_REVERSE_SUBTRACT};Je[fge]=t.MIN,Je[hge]=t.MAX;const at={[dge]:t.ZERO,[pge]:t.ONE,[mge]:t.SRC_COLOR,[GU]:t.SRC_ALPHA,[Ege]:t.SRC_ALPHA_SATURATE,[yge]:t.DST_COLOR,[_ge]:t.DST_ALPHA,[gge]:t.ONE_MINUS_SRC_COLOR,[$U]:t.ONE_MINUS_SRC_ALPHA,[bge]:t.ONE_MINUS_DST_COLOR,[vge]:t.ONE_MINUS_DST_ALPHA,[Sge]:t.CONSTANT_COLOR,[xge]:t.ONE_MINUS_CONSTANT_COLOR,[Tge]:t.CONSTANT_ALPHA,[wge]:t.ONE_MINUS_CONSTANT_ALPHA};function re(Pe,We,Ve,Xe,lt,qe,rt,it,nt,ct){if(Pe===Ou){g===!0&&(Re(t.BLEND),g=!1);return}if(g===!1&&(Ne(t.BLEND),g=!0),Pe!==cge){if(Pe!==y||ct!==z){if((v!==c1||C!==c1)&&(t.blendEquation(t.FUNC_ADD),v=c1,C=c1),ct)switch(Pe){case DS:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case jj:t.blendFunc(t.ONE,t.ONE);break;case zj:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Hj:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}else switch(Pe){case DS:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case jj:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case zj:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Hj:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}x=null,E=null,A=null,k=null,M.set(0,0,0),I=0,y=Pe,z=ct}return}lt=lt||We,qe=qe||Ve,rt=rt||Xe,(We!==v||lt!==C)&&(t.blendEquationSeparate(Je[We],Je[lt]),v=We,C=lt),(Ve!==x||Xe!==E||qe!==A||rt!==k)&&(t.blendFuncSeparate(at[Ve],at[Xe],at[qe],at[rt]),x=Ve,E=Xe,A=qe,k=rt),(it.equals(M)===!1||nt!==I)&&(t.blendColor(it.r,it.g,it.b,nt),M.copy(it),I=nt),y=Pe,z=!1}function Le(Pe,We){Pe.side===Zl?Re(t.CULL_FACE):Ne(t.CULL_FACE);let Ve=Pe.side===Ql;We&&(Ve=!Ve),He(Ve),Pe.blending===DS&&Pe.transparent===!1?re(Ou):re(Pe.blending,Pe.blendEquation,Pe.blendSrc,Pe.blendDst,Pe.blendEquationAlpha,Pe.blendSrcAlpha,Pe.blendDstAlpha,Pe.blendColor,Pe.blendAlpha,Pe.premultipliedAlpha),o.setFunc(Pe.depthFunc),o.setTest(Pe.depthTest),o.setMask(Pe.depthWrite),s.setMask(Pe.colorWrite);const Xe=Pe.stencilWrite;a.setTest(Xe),Xe&&(a.setMask(Pe.stencilWriteMask),a.setFunc(Pe.stencilFunc,Pe.stencilRef,Pe.stencilFuncMask),a.setOp(Pe.stencilFail,Pe.stencilZFail,Pe.stencilZPass)),fe(Pe.polygonOffset,Pe.polygonOffsetFactor,Pe.polygonOffsetUnits),Pe.alphaToCoverage===!0?Ne(t.SAMPLE_ALPHA_TO_COVERAGE):Re(t.SAMPLE_ALPHA_TO_COVERAGE)}function He(Pe){H!==Pe&&(Pe?t.frontFace(t.CW):t.frontFace(t.CCW),H=Pe)}function Ue(Pe){Pe!==sge?(Ne(t.CULL_FACE),Pe!==K&&(Pe===Fj?t.cullFace(t.BACK):Pe===oge?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):Re(t.CULL_FACE),K=Pe}function De(Pe){Pe!==P&&(G&&t.lineWidth(Pe),P=Pe)}function fe(Pe,We,Ve){Pe?(Ne(t.POLYGON_OFFSET_FILL),(F!==We||N!==Ve)&&(t.polygonOffset(We,Ve),F=We,N=Ve)):Re(t.POLYGON_OFFSET_FILL)}function ve(Pe){Pe?Ne(t.SCISSOR_TEST):Re(t.SCISSOR_TEST)}function Ae(Pe){Pe===void 0&&(Pe=t.TEXTURE0+X-1),te!==Pe&&(t.activeTexture(Pe),te=Pe)}function pe(Pe,We,Ve){Ve===void 0&&(te===null?Ve=t.TEXTURE0+X-1:Ve=te);let Xe=W[Ve];Xe===void 0&&(Xe={type:void 0,texture:void 0},W[Ve]=Xe),(Xe.type!==Pe||Xe.texture!==We)&&(te!==Ve&&(t.activeTexture(Ve),te=Ve),t.bindTexture(Pe,We||xe[Pe]),Xe.type=Pe,Xe.texture=We)}function Ge(){const Pe=W[te];Pe!==void 0&&Pe.type!==void 0&&(t.bindTexture(Pe.type,null),Pe.type=void 0,Pe.texture=void 0)}function Qe(){try{t.compressedTexImage2D(...arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Ze(){try{t.compressedTexImage3D(...arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function tt(){try{t.texSubImage2D(...arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Ft(){try{t.texSubImage3D(...arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function bt(){try{t.compressedTexSubImage2D(...arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Mt(){try{t.compressedTexSubImage3D(...arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Ie(){try{t.texStorage2D(...arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function ce(){try{t.texStorage3D(...arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Q(){try{t.texImage2D(...arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function le(){try{t.texImage3D(...arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function we(Pe){ne.equals(Pe)===!1&&(t.scissor(Pe.x,Pe.y,Pe.z,Pe.w),ne.copy(Pe))}function Me(Pe){ie.equals(Pe)===!1&&(t.viewport(Pe.x,Pe.y,Pe.z,Pe.w),ie.copy(Pe))}function Te(Pe,We){let Ve=l.get(We);Ve===void 0&&(Ve=new WeakMap,l.set(We,Ve));let Xe=Ve.get(Pe);Xe===void 0&&(Xe=t.getUniformBlockIndex(We,Pe.name),Ve.set(Pe,Xe))}function ye(Pe,We){const Xe=l.get(We).get(Pe);c.get(We)!==Xe&&(t.uniformBlockBinding(We,Xe,Pe.__bindingPointIndex),c.set(We,Xe))}function Ye(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),o.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},te=null,W={},h={},d=new WeakMap,m=[],p=null,g=!1,y=null,v=null,x=null,E=null,C=null,A=null,k=null,M=new Xi(0,0,0),I=0,z=!1,H=null,K=null,P=null,F=null,N=null,ne.set(0,0,t.canvas.width,t.canvas.height),ie.set(0,0,t.canvas.width,t.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:Ne,disable:Re,bindFramebuffer:Se,drawBuffers:ze,useProgram:Be,setBlending:re,setMaterial:Le,setFlipSided:He,setCullFace:Ue,setLineWidth:De,setPolygonOffset:fe,setScissorTest:ve,activeTexture:Ae,bindTexture:pe,unbindTexture:Ge,compressedTexImage2D:Qe,compressedTexImage3D:Ze,texImage2D:Q,texImage3D:le,updateUBOMapping:Te,uniformBlockBinding:ye,texStorage2D:Ie,texStorage3D:ce,texSubImage2D:tt,texSubImage3D:Ft,compressedTexSubImage2D:bt,compressedTexSubImage3D:Mt,scissor:we,viewport:Me,reset:Ye}}function w1e(t,e,n,r,i,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new Vn,u=new WeakMap;let h;const d=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(Ae,pe){return m?new OffscreenCanvas(Ae,pe):yA("canvas")}function g(Ae,pe,Ge){let Qe=1;const Ze=ve(Ae);if((Ze.width>Ge||Ze.height>Ge)&&(Qe=Ge/Math.max(Ze.width,Ze.height)),Qe<1)if(typeof HTMLImageElement<"u"&&Ae instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ae instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ae instanceof ImageBitmap||typeof VideoFrame<"u"&&Ae instanceof VideoFrame){const tt=Math.floor(Qe*Ze.width),Ft=Math.floor(Qe*Ze.height);h===void 0&&(h=p(tt,Ft));const bt=pe?p(tt,Ft):h;return bt.width=tt,bt.height=Ft,bt.getContext("2d").drawImage(Ae,0,0,tt,Ft),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ze.width+"x"+Ze.height+") to ("+tt+"x"+Ft+")."),bt}else return"data"in Ae&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ze.width+"x"+Ze.height+")."),Ae;return Ae}function y(Ae){return Ae.generateMipmaps}function v(Ae){t.generateMipmap(Ae)}function x(Ae){return Ae.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:Ae.isWebGL3DRenderTarget?t.TEXTURE_3D:Ae.isWebGLArrayRenderTarget||Ae.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function E(Ae,pe,Ge,Qe,Ze=!1){if(Ae!==null){if(t[Ae]!==void 0)return t[Ae];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ae+"'")}let tt=pe;if(pe===t.RED&&(Ge===t.FLOAT&&(tt=t.R32F),Ge===t.HALF_FLOAT&&(tt=t.R16F),Ge===t.UNSIGNED_BYTE&&(tt=t.R8)),pe===t.RED_INTEGER&&(Ge===t.UNSIGNED_BYTE&&(tt=t.R8UI),Ge===t.UNSIGNED_SHORT&&(tt=t.R16UI),Ge===t.UNSIGNED_INT&&(tt=t.R32UI),Ge===t.BYTE&&(tt=t.R8I),Ge===t.SHORT&&(tt=t.R16I),Ge===t.INT&&(tt=t.R32I)),pe===t.RG&&(Ge===t.FLOAT&&(tt=t.RG32F),Ge===t.HALF_FLOAT&&(tt=t.RG16F),Ge===t.UNSIGNED_BYTE&&(tt=t.RG8)),pe===t.RG_INTEGER&&(Ge===t.UNSIGNED_BYTE&&(tt=t.RG8UI),Ge===t.UNSIGNED_SHORT&&(tt=t.RG16UI),Ge===t.UNSIGNED_INT&&(tt=t.RG32UI),Ge===t.BYTE&&(tt=t.RG8I),Ge===t.SHORT&&(tt=t.RG16I),Ge===t.INT&&(tt=t.RG32I)),pe===t.RGB_INTEGER&&(Ge===t.UNSIGNED_BYTE&&(tt=t.RGB8UI),Ge===t.UNSIGNED_SHORT&&(tt=t.RGB16UI),Ge===t.UNSIGNED_INT&&(tt=t.RGB32UI),Ge===t.BYTE&&(tt=t.RGB8I),Ge===t.SHORT&&(tt=t.RGB16I),Ge===t.INT&&(tt=t.RGB32I)),pe===t.RGBA_INTEGER&&(Ge===t.UNSIGNED_BYTE&&(tt=t.RGBA8UI),Ge===t.UNSIGNED_SHORT&&(tt=t.RGBA16UI),Ge===t.UNSIGNED_INT&&(tt=t.RGBA32UI),Ge===t.BYTE&&(tt=t.RGBA8I),Ge===t.SHORT&&(tt=t.RGBA16I),Ge===t.INT&&(tt=t.RGBA32I)),pe===t.RGB&&Ge===t.UNSIGNED_INT_5_9_9_9_REV&&(tt=t.RGB9_E5),pe===t.RGBA){const Ft=Ze?dI:xs.getTransfer(Qe);Ge===t.FLOAT&&(tt=t.RGBA32F),Ge===t.HALF_FLOAT&&(tt=t.RGBA16F),Ge===t.UNSIGNED_BYTE&&(tt=Ft===fo?t.SRGB8_ALPHA8:t.RGBA8),Ge===t.UNSIGNED_SHORT_4_4_4_4&&(tt=t.RGBA4),Ge===t.UNSIGNED_SHORT_5_5_5_1&&(tt=t.RGB5_A1)}return(tt===t.R16F||tt===t.R32F||tt===t.RG16F||tt===t.RG32F||tt===t.RGBA16F||tt===t.RGBA32F)&&e.get("EXT_color_buffer_float"),tt}function C(Ae,pe){let Ge;return Ae?pe===null||pe===Wy||pe===QS?Ge=t.DEPTH24_STENCIL8:pe===hg?Ge=t.DEPTH32F_STENCIL8:pe===gA&&(Ge=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):pe===null||pe===Wy||pe===QS?Ge=t.DEPTH_COMPONENT24:pe===hg?Ge=t.DEPTH_COMPONENT32F:pe===gA&&(Ge=t.DEPTH_COMPONENT16),Ge}function A(Ae,pe){return y(Ae)===!0||Ae.isFramebufferTexture&&Ae.minFilter!==rf&&Ae.minFilter!==nf?Math.log2(Math.max(pe.width,pe.height))+1:Ae.mipmaps!==void 0&&Ae.mipmaps.length>0?Ae.mipmaps.length:Ae.isCompressedTexture&&Array.isArray(Ae.image)?pe.mipmaps.length:1}function k(Ae){const pe=Ae.target;pe.removeEventListener("dispose",k),I(pe),pe.isVideoTexture&&u.delete(pe)}function M(Ae){const pe=Ae.target;pe.removeEventListener("dispose",M),H(pe)}function I(Ae){const pe=r.get(Ae);if(pe.__webglInit===void 0)return;const Ge=Ae.source,Qe=d.get(Ge);if(Qe){const Ze=Qe[pe.__cacheKey];Ze.usedTimes--,Ze.usedTimes===0&&z(Ae),Object.keys(Qe).length===0&&d.delete(Ge)}r.remove(Ae)}function z(Ae){const pe=r.get(Ae);t.deleteTexture(pe.__webglTexture);const Ge=Ae.source,Qe=d.get(Ge);delete Qe[pe.__cacheKey],o.memory.textures--}function H(Ae){const pe=r.get(Ae);if(Ae.depthTexture&&(Ae.depthTexture.dispose(),r.remove(Ae.depthTexture)),Ae.isWebGLCubeRenderTarget)for(let Qe=0;Qe<6;Qe++){if(Array.isArray(pe.__webglFramebuffer[Qe]))for(let Ze=0;Ze<pe.__webglFramebuffer[Qe].length;Ze++)t.deleteFramebuffer(pe.__webglFramebuffer[Qe][Ze]);else t.deleteFramebuffer(pe.__webglFramebuffer[Qe]);pe.__webglDepthbuffer&&t.deleteRenderbuffer(pe.__webglDepthbuffer[Qe])}else{if(Array.isArray(pe.__webglFramebuffer))for(let Qe=0;Qe<pe.__webglFramebuffer.length;Qe++)t.deleteFramebuffer(pe.__webglFramebuffer[Qe]);else t.deleteFramebuffer(pe.__webglFramebuffer);if(pe.__webglDepthbuffer&&t.deleteRenderbuffer(pe.__webglDepthbuffer),pe.__webglMultisampledFramebuffer&&t.deleteFramebuffer(pe.__webglMultisampledFramebuffer),pe.__webglColorRenderbuffer)for(let Qe=0;Qe<pe.__webglColorRenderbuffer.length;Qe++)pe.__webglColorRenderbuffer[Qe]&&t.deleteRenderbuffer(pe.__webglColorRenderbuffer[Qe]);pe.__webglDepthRenderbuffer&&t.deleteRenderbuffer(pe.__webglDepthRenderbuffer)}const Ge=Ae.textures;for(let Qe=0,Ze=Ge.length;Qe<Ze;Qe++){const tt=r.get(Ge[Qe]);tt.__webglTexture&&(t.deleteTexture(tt.__webglTexture),o.memory.textures--),r.remove(Ge[Qe])}r.remove(Ae)}let K=0;function P(){K=0}function F(){const Ae=K;return Ae>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Ae+" texture units while this GPU supports only "+i.maxTextures),K+=1,Ae}function N(Ae){const pe=[];return pe.push(Ae.wrapS),pe.push(Ae.wrapT),pe.push(Ae.wrapR||0),pe.push(Ae.magFilter),pe.push(Ae.minFilter),pe.push(Ae.anisotropy),pe.push(Ae.internalFormat),pe.push(Ae.format),pe.push(Ae.type),pe.push(Ae.generateMipmaps),pe.push(Ae.premultiplyAlpha),pe.push(Ae.flipY),pe.push(Ae.unpackAlignment),pe.push(Ae.colorSpace),pe.join()}function X(Ae,pe){const Ge=r.get(Ae);if(Ae.isVideoTexture&&De(Ae),Ae.isRenderTargetTexture===!1&&Ae.version>0&&Ge.__version!==Ae.version){const Qe=Ae.image;if(Qe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Qe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ie(Ge,Ae,pe);return}}n.bindTexture(t.TEXTURE_2D,Ge.__webglTexture,t.TEXTURE0+pe)}function G(Ae,pe){const Ge=r.get(Ae);if(Ae.version>0&&Ge.__version!==Ae.version){ie(Ge,Ae,pe);return}n.bindTexture(t.TEXTURE_2D_ARRAY,Ge.__webglTexture,t.TEXTURE0+pe)}function j(Ae,pe){const Ge=r.get(Ae);if(Ae.version>0&&Ge.__version!==Ae.version){ie(Ge,Ae,pe);return}n.bindTexture(t.TEXTURE_3D,Ge.__webglTexture,t.TEXTURE0+pe)}function q(Ae,pe){const Ge=r.get(Ae);if(Ae.version>0&&Ge.__version!==Ae.version){ae(Ge,Ae,pe);return}n.bindTexture(t.TEXTURE_CUBE_MAP,Ge.__webglTexture,t.TEXTURE0+pe)}const te={[hI]:t.REPEAT,[p1]:t.CLAMP_TO_EDGE,[n6]:t.MIRRORED_REPEAT},W={[rf]:t.NEAREST,[Pge]:t.NEAREST_MIPMAP_NEAREST,[k2]:t.NEAREST_MIPMAP_LINEAR,[nf]:t.LINEAR,[YP]:t.LINEAR_MIPMAP_NEAREST,[m1]:t.LINEAR_MIPMAP_LINEAR},$={[Bge]:t.NEVER,[Vge]:t.ALWAYS,[Fge]:t.LESS,[fee]:t.LEQUAL,[jge]:t.EQUAL,[qge]:t.GEQUAL,[zge]:t.GREATER,[Hge]:t.NOTEQUAL};function J(Ae,pe){if(pe.type===hg&&e.has("OES_texture_float_linear")===!1&&(pe.magFilter===nf||pe.magFilter===YP||pe.magFilter===k2||pe.magFilter===m1||pe.minFilter===nf||pe.minFilter===YP||pe.minFilter===k2||pe.minFilter===m1)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(Ae,t.TEXTURE_WRAP_S,te[pe.wrapS]),t.texParameteri(Ae,t.TEXTURE_WRAP_T,te[pe.wrapT]),(Ae===t.TEXTURE_3D||Ae===t.TEXTURE_2D_ARRAY)&&t.texParameteri(Ae,t.TEXTURE_WRAP_R,te[pe.wrapR]),t.texParameteri(Ae,t.TEXTURE_MAG_FILTER,W[pe.magFilter]),t.texParameteri(Ae,t.TEXTURE_MIN_FILTER,W[pe.minFilter]),pe.compareFunction&&(t.texParameteri(Ae,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(Ae,t.TEXTURE_COMPARE_FUNC,$[pe.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(pe.magFilter===rf||pe.minFilter!==k2&&pe.minFilter!==m1||pe.type===hg&&e.has("OES_texture_float_linear")===!1)return;if(pe.anisotropy>1||r.get(pe).__currentAnisotropy){const Ge=e.get("EXT_texture_filter_anisotropic");t.texParameterf(Ae,Ge.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(pe.anisotropy,i.getMaxAnisotropy())),r.get(pe).__currentAnisotropy=pe.anisotropy}}}function ne(Ae,pe){let Ge=!1;Ae.__webglInit===void 0&&(Ae.__webglInit=!0,pe.addEventListener("dispose",k));const Qe=pe.source;let Ze=d.get(Qe);Ze===void 0&&(Ze={},d.set(Qe,Ze));const tt=N(pe);if(tt!==Ae.__cacheKey){Ze[tt]===void 0&&(Ze[tt]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,Ge=!0),Ze[tt].usedTimes++;const Ft=Ze[Ae.__cacheKey];Ft!==void 0&&(Ze[Ae.__cacheKey].usedTimes--,Ft.usedTimes===0&&z(pe)),Ae.__cacheKey=tt,Ae.__webglTexture=Ze[tt].texture}return Ge}function ie(Ae,pe,Ge){let Qe=t.TEXTURE_2D;(pe.isDataArrayTexture||pe.isCompressedArrayTexture)&&(Qe=t.TEXTURE_2D_ARRAY),pe.isData3DTexture&&(Qe=t.TEXTURE_3D);const Ze=ne(Ae,pe),tt=pe.source;n.bindTexture(Qe,Ae.__webglTexture,t.TEXTURE0+Ge);const Ft=r.get(tt);if(tt.version!==Ft.__version||Ze===!0){n.activeTexture(t.TEXTURE0+Ge);const bt=xs.getPrimaries(xs.workingColorSpace),Mt=pe.colorSpace===b0?null:xs.getPrimaries(pe.colorSpace),Ie=pe.colorSpace===b0||bt===Mt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,pe.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,pe.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ie);let ce=g(pe.image,!1,i.maxTextureSize);ce=fe(pe,ce);const Q=s.convert(pe.format,pe.colorSpace),le=s.convert(pe.type);let we=E(pe.internalFormat,Q,le,pe.colorSpace,pe.isVideoTexture);J(Qe,pe);let Me;const Te=pe.mipmaps,ye=pe.isVideoTexture!==!0,Ye=Ft.__version===void 0||Ze===!0,Pe=tt.dataReady,We=A(pe,ce);if(pe.isDepthTexture)we=C(pe.format===ex,pe.type),Ye&&(ye?n.texStorage2D(t.TEXTURE_2D,1,we,ce.width,ce.height):n.texImage2D(t.TEXTURE_2D,0,we,ce.width,ce.height,0,Q,le,null));else if(pe.isDataTexture)if(Te.length>0){ye&&Ye&&n.texStorage2D(t.TEXTURE_2D,We,we,Te[0].width,Te[0].height);for(let Ve=0,Xe=Te.length;Ve<Xe;Ve++)Me=Te[Ve],ye?Pe&&n.texSubImage2D(t.TEXTURE_2D,Ve,0,0,Me.width,Me.height,Q,le,Me.data):n.texImage2D(t.TEXTURE_2D,Ve,we,Me.width,Me.height,0,Q,le,Me.data);pe.generateMipmaps=!1}else ye?(Ye&&n.texStorage2D(t.TEXTURE_2D,We,we,ce.width,ce.height),Pe&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,ce.width,ce.height,Q,le,ce.data)):n.texImage2D(t.TEXTURE_2D,0,we,ce.width,ce.height,0,Q,le,ce.data);else if(pe.isCompressedTexture)if(pe.isCompressedArrayTexture){ye&&Ye&&n.texStorage3D(t.TEXTURE_2D_ARRAY,We,we,Te[0].width,Te[0].height,ce.depth);for(let Ve=0,Xe=Te.length;Ve<Xe;Ve++)if(Me=Te[Ve],pe.format!==Vf)if(Q!==null)if(ye){if(Pe)if(pe.layerUpdates.size>0){const lt=bz(Me.width,Me.height,pe.format,pe.type);for(const qe of pe.layerUpdates){const rt=Me.data.subarray(qe*lt/Me.data.BYTES_PER_ELEMENT,(qe+1)*lt/Me.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Ve,0,0,qe,Me.width,Me.height,1,Q,rt)}pe.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Ve,0,0,0,Me.width,Me.height,ce.depth,Q,Me.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,Ve,we,Me.width,Me.height,ce.depth,0,Me.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else ye?Pe&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,Ve,0,0,0,Me.width,Me.height,ce.depth,Q,le,Me.data):n.texImage3D(t.TEXTURE_2D_ARRAY,Ve,we,Me.width,Me.height,ce.depth,0,Q,le,Me.data)}else{ye&&Ye&&n.texStorage2D(t.TEXTURE_2D,We,we,Te[0].width,Te[0].height);for(let Ve=0,Xe=Te.length;Ve<Xe;Ve++)Me=Te[Ve],pe.format!==Vf?Q!==null?ye?Pe&&n.compressedTexSubImage2D(t.TEXTURE_2D,Ve,0,0,Me.width,Me.height,Q,Me.data):n.compressedTexImage2D(t.TEXTURE_2D,Ve,we,Me.width,Me.height,0,Me.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ye?Pe&&n.texSubImage2D(t.TEXTURE_2D,Ve,0,0,Me.width,Me.height,Q,le,Me.data):n.texImage2D(t.TEXTURE_2D,Ve,we,Me.width,Me.height,0,Q,le,Me.data)}else if(pe.isDataArrayTexture)if(ye){if(Ye&&n.texStorage3D(t.TEXTURE_2D_ARRAY,We,we,ce.width,ce.height,ce.depth),Pe)if(pe.layerUpdates.size>0){const Ve=bz(ce.width,ce.height,pe.format,pe.type);for(const Xe of pe.layerUpdates){const lt=ce.data.subarray(Xe*Ve/ce.data.BYTES_PER_ELEMENT,(Xe+1)*Ve/ce.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,Xe,ce.width,ce.height,1,Q,le,lt)}pe.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,ce.width,ce.height,ce.depth,Q,le,ce.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,we,ce.width,ce.height,ce.depth,0,Q,le,ce.data);else if(pe.isData3DTexture)ye?(Ye&&n.texStorage3D(t.TEXTURE_3D,We,we,ce.width,ce.height,ce.depth),Pe&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,ce.width,ce.height,ce.depth,Q,le,ce.data)):n.texImage3D(t.TEXTURE_3D,0,we,ce.width,ce.height,ce.depth,0,Q,le,ce.data);else if(pe.isFramebufferTexture){if(Ye)if(ye)n.texStorage2D(t.TEXTURE_2D,We,we,ce.width,ce.height);else{let Ve=ce.width,Xe=ce.height;for(let lt=0;lt<We;lt++)n.texImage2D(t.TEXTURE_2D,lt,we,Ve,Xe,0,Q,le,null),Ve>>=1,Xe>>=1}}else if(Te.length>0){if(ye&&Ye){const Ve=ve(Te[0]);n.texStorage2D(t.TEXTURE_2D,We,we,Ve.width,Ve.height)}for(let Ve=0,Xe=Te.length;Ve<Xe;Ve++)Me=Te[Ve],ye?Pe&&n.texSubImage2D(t.TEXTURE_2D,Ve,0,0,Q,le,Me):n.texImage2D(t.TEXTURE_2D,Ve,we,Q,le,Me);pe.generateMipmaps=!1}else if(ye){if(Ye){const Ve=ve(ce);n.texStorage2D(t.TEXTURE_2D,We,we,Ve.width,Ve.height)}Pe&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,Q,le,ce)}else n.texImage2D(t.TEXTURE_2D,0,we,Q,le,ce);y(pe)&&v(Qe),Ft.__version=tt.version,pe.onUpdate&&pe.onUpdate(pe)}Ae.__version=pe.version}function ae(Ae,pe,Ge){if(pe.image.length!==6)return;const Qe=ne(Ae,pe),Ze=pe.source;n.bindTexture(t.TEXTURE_CUBE_MAP,Ae.__webglTexture,t.TEXTURE0+Ge);const tt=r.get(Ze);if(Ze.version!==tt.__version||Qe===!0){n.activeTexture(t.TEXTURE0+Ge);const Ft=xs.getPrimaries(xs.workingColorSpace),bt=pe.colorSpace===b0?null:xs.getPrimaries(pe.colorSpace),Mt=pe.colorSpace===b0||Ft===bt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,pe.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,pe.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Mt);const Ie=pe.isCompressedTexture||pe.image[0].isCompressedTexture,ce=pe.image[0]&&pe.image[0].isDataTexture,Q=[];for(let Xe=0;Xe<6;Xe++)!Ie&&!ce?Q[Xe]=g(pe.image[Xe],!0,i.maxCubemapSize):Q[Xe]=ce?pe.image[Xe].image:pe.image[Xe],Q[Xe]=fe(pe,Q[Xe]);const le=Q[0],we=s.convert(pe.format,pe.colorSpace),Me=s.convert(pe.type),Te=E(pe.internalFormat,we,Me,pe.colorSpace),ye=pe.isVideoTexture!==!0,Ye=tt.__version===void 0||Qe===!0,Pe=Ze.dataReady;let We=A(pe,le);J(t.TEXTURE_CUBE_MAP,pe);let Ve;if(Ie){ye&&Ye&&n.texStorage2D(t.TEXTURE_CUBE_MAP,We,Te,le.width,le.height);for(let Xe=0;Xe<6;Xe++){Ve=Q[Xe].mipmaps;for(let lt=0;lt<Ve.length;lt++){const qe=Ve[lt];pe.format!==Vf?we!==null?ye?Pe&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,lt,0,0,qe.width,qe.height,we,qe.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,lt,Te,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ye?Pe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,lt,0,0,qe.width,qe.height,we,Me,qe.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,lt,Te,qe.width,qe.height,0,we,Me,qe.data)}}}else{if(Ve=pe.mipmaps,ye&&Ye){Ve.length>0&&We++;const Xe=ve(Q[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,We,Te,Xe.width,Xe.height)}for(let Xe=0;Xe<6;Xe++)if(ce){ye?Pe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,0,0,0,Q[Xe].width,Q[Xe].height,we,Me,Q[Xe].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,0,Te,Q[Xe].width,Q[Xe].height,0,we,Me,Q[Xe].data);for(let lt=0;lt<Ve.length;lt++){const rt=Ve[lt].image[Xe].image;ye?Pe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,lt+1,0,0,rt.width,rt.height,we,Me,rt.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,lt+1,Te,rt.width,rt.height,0,we,Me,rt.data)}}else{ye?Pe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,0,0,0,we,Me,Q[Xe]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,0,Te,we,Me,Q[Xe]);for(let lt=0;lt<Ve.length;lt++){const qe=Ve[lt];ye?Pe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,lt+1,0,0,we,Me,qe.image[Xe]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,lt+1,Te,we,Me,qe.image[Xe])}}}y(pe)&&v(t.TEXTURE_CUBE_MAP),tt.__version=Ze.version,pe.onUpdate&&pe.onUpdate(pe)}Ae.__version=pe.version}function xe(Ae,pe,Ge,Qe,Ze,tt){const Ft=s.convert(Ge.format,Ge.colorSpace),bt=s.convert(Ge.type),Mt=E(Ge.internalFormat,Ft,bt,Ge.colorSpace),Ie=r.get(pe),ce=r.get(Ge);if(ce.__renderTarget=pe,!Ie.__hasExternalTextures){const Q=Math.max(1,pe.width>>tt),le=Math.max(1,pe.height>>tt);Ze===t.TEXTURE_3D||Ze===t.TEXTURE_2D_ARRAY?n.texImage3D(Ze,tt,Mt,Q,le,pe.depth,0,Ft,bt,null):n.texImage2D(Ze,tt,Mt,Q,le,0,Ft,bt,null)}n.bindFramebuffer(t.FRAMEBUFFER,Ae),Ue(pe)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Qe,Ze,ce.__webglTexture,0,He(pe)):(Ze===t.TEXTURE_2D||Ze>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&Ze<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,Qe,Ze,ce.__webglTexture,tt),n.bindFramebuffer(t.FRAMEBUFFER,null)}function Ne(Ae,pe,Ge){if(t.bindRenderbuffer(t.RENDERBUFFER,Ae),pe.depthBuffer){const Qe=pe.depthTexture,Ze=Qe&&Qe.isDepthTexture?Qe.type:null,tt=C(pe.stencilBuffer,Ze),Ft=pe.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,bt=He(pe);Ue(pe)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,bt,tt,pe.width,pe.height):Ge?t.renderbufferStorageMultisample(t.RENDERBUFFER,bt,tt,pe.width,pe.height):t.renderbufferStorage(t.RENDERBUFFER,tt,pe.width,pe.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,Ft,t.RENDERBUFFER,Ae)}else{const Qe=pe.textures;for(let Ze=0;Ze<Qe.length;Ze++){const tt=Qe[Ze],Ft=s.convert(tt.format,tt.colorSpace),bt=s.convert(tt.type),Mt=E(tt.internalFormat,Ft,bt,tt.colorSpace),Ie=He(pe);Ge&&Ue(pe)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,Ie,Mt,pe.width,pe.height):Ue(pe)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Ie,Mt,pe.width,pe.height):t.renderbufferStorage(t.RENDERBUFFER,Mt,pe.width,pe.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function Re(Ae,pe){if(pe&&pe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,Ae),!(pe.depthTexture&&pe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Qe=r.get(pe.depthTexture);Qe.__renderTarget=pe,(!Qe.__webglTexture||pe.depthTexture.image.width!==pe.width||pe.depthTexture.image.height!==pe.height)&&(pe.depthTexture.image.width=pe.width,pe.depthTexture.image.height=pe.height,pe.depthTexture.needsUpdate=!0),X(pe.depthTexture,0);const Ze=Qe.__webglTexture,tt=He(pe);if(pe.depthTexture.format===_A)Ue(pe)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Ze,0,tt):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Ze,0);else if(pe.depthTexture.format===ex)Ue(pe)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Ze,0,tt):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Ze,0);else throw new Error("Unknown depthTexture format")}function Se(Ae){const pe=r.get(Ae),Ge=Ae.isWebGLCubeRenderTarget===!0;if(pe.__boundDepthTexture!==Ae.depthTexture){const Qe=Ae.depthTexture;if(pe.__depthDisposeCallback&&pe.__depthDisposeCallback(),Qe){const Ze=()=>{delete pe.__boundDepthTexture,delete pe.__depthDisposeCallback,Qe.removeEventListener("dispose",Ze)};Qe.addEventListener("dispose",Ze),pe.__depthDisposeCallback=Ze}pe.__boundDepthTexture=Qe}if(Ae.depthTexture&&!pe.__autoAllocateDepthBuffer){if(Ge)throw new Error("target.depthTexture not supported in Cube render targets");const Qe=Ae.texture.mipmaps;Qe&&Qe.length>0?Re(pe.__webglFramebuffer[0],Ae):Re(pe.__webglFramebuffer,Ae)}else if(Ge){pe.__webglDepthbuffer=[];for(let Qe=0;Qe<6;Qe++)if(n.bindFramebuffer(t.FRAMEBUFFER,pe.__webglFramebuffer[Qe]),pe.__webglDepthbuffer[Qe]===void 0)pe.__webglDepthbuffer[Qe]=t.createRenderbuffer(),Ne(pe.__webglDepthbuffer[Qe],Ae,!1);else{const Ze=Ae.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,tt=pe.__webglDepthbuffer[Qe];t.bindRenderbuffer(t.RENDERBUFFER,tt),t.framebufferRenderbuffer(t.FRAMEBUFFER,Ze,t.RENDERBUFFER,tt)}}else{const Qe=Ae.texture.mipmaps;if(Qe&&Qe.length>0?n.bindFramebuffer(t.FRAMEBUFFER,pe.__webglFramebuffer[0]):n.bindFramebuffer(t.FRAMEBUFFER,pe.__webglFramebuffer),pe.__webglDepthbuffer===void 0)pe.__webglDepthbuffer=t.createRenderbuffer(),Ne(pe.__webglDepthbuffer,Ae,!1);else{const Ze=Ae.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,tt=pe.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,tt),t.framebufferRenderbuffer(t.FRAMEBUFFER,Ze,t.RENDERBUFFER,tt)}}n.bindFramebuffer(t.FRAMEBUFFER,null)}function ze(Ae,pe,Ge){const Qe=r.get(Ae);pe!==void 0&&xe(Qe.__webglFramebuffer,Ae,Ae.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),Ge!==void 0&&Se(Ae)}function Be(Ae){const pe=Ae.texture,Ge=r.get(Ae),Qe=r.get(pe);Ae.addEventListener("dispose",M);const Ze=Ae.textures,tt=Ae.isWebGLCubeRenderTarget===!0,Ft=Ze.length>1;if(Ft||(Qe.__webglTexture===void 0&&(Qe.__webglTexture=t.createTexture()),Qe.__version=pe.version,o.memory.textures++),tt){Ge.__webglFramebuffer=[];for(let bt=0;bt<6;bt++)if(pe.mipmaps&&pe.mipmaps.length>0){Ge.__webglFramebuffer[bt]=[];for(let Mt=0;Mt<pe.mipmaps.length;Mt++)Ge.__webglFramebuffer[bt][Mt]=t.createFramebuffer()}else Ge.__webglFramebuffer[bt]=t.createFramebuffer()}else{if(pe.mipmaps&&pe.mipmaps.length>0){Ge.__webglFramebuffer=[];for(let bt=0;bt<pe.mipmaps.length;bt++)Ge.__webglFramebuffer[bt]=t.createFramebuffer()}else Ge.__webglFramebuffer=t.createFramebuffer();if(Ft)for(let bt=0,Mt=Ze.length;bt<Mt;bt++){const Ie=r.get(Ze[bt]);Ie.__webglTexture===void 0&&(Ie.__webglTexture=t.createTexture(),o.memory.textures++)}if(Ae.samples>0&&Ue(Ae)===!1){Ge.__webglMultisampledFramebuffer=t.createFramebuffer(),Ge.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,Ge.__webglMultisampledFramebuffer);for(let bt=0;bt<Ze.length;bt++){const Mt=Ze[bt];Ge.__webglColorRenderbuffer[bt]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,Ge.__webglColorRenderbuffer[bt]);const Ie=s.convert(Mt.format,Mt.colorSpace),ce=s.convert(Mt.type),Q=E(Mt.internalFormat,Ie,ce,Mt.colorSpace,Ae.isXRRenderTarget===!0),le=He(Ae);t.renderbufferStorageMultisample(t.RENDERBUFFER,le,Q,Ae.width,Ae.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+bt,t.RENDERBUFFER,Ge.__webglColorRenderbuffer[bt])}t.bindRenderbuffer(t.RENDERBUFFER,null),Ae.depthBuffer&&(Ge.__webglDepthRenderbuffer=t.createRenderbuffer(),Ne(Ge.__webglDepthRenderbuffer,Ae,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(tt){n.bindTexture(t.TEXTURE_CUBE_MAP,Qe.__webglTexture),J(t.TEXTURE_CUBE_MAP,pe);for(let bt=0;bt<6;bt++)if(pe.mipmaps&&pe.mipmaps.length>0)for(let Mt=0;Mt<pe.mipmaps.length;Mt++)xe(Ge.__webglFramebuffer[bt][Mt],Ae,pe,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+bt,Mt);else xe(Ge.__webglFramebuffer[bt],Ae,pe,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+bt,0);y(pe)&&v(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(Ft){for(let bt=0,Mt=Ze.length;bt<Mt;bt++){const Ie=Ze[bt],ce=r.get(Ie);n.bindTexture(t.TEXTURE_2D,ce.__webglTexture),J(t.TEXTURE_2D,Ie),xe(Ge.__webglFramebuffer,Ae,Ie,t.COLOR_ATTACHMENT0+bt,t.TEXTURE_2D,0),y(Ie)&&v(t.TEXTURE_2D)}n.unbindTexture()}else{let bt=t.TEXTURE_2D;if((Ae.isWebGL3DRenderTarget||Ae.isWebGLArrayRenderTarget)&&(bt=Ae.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(bt,Qe.__webglTexture),J(bt,pe),pe.mipmaps&&pe.mipmaps.length>0)for(let Mt=0;Mt<pe.mipmaps.length;Mt++)xe(Ge.__webglFramebuffer[Mt],Ae,pe,t.COLOR_ATTACHMENT0,bt,Mt);else xe(Ge.__webglFramebuffer,Ae,pe,t.COLOR_ATTACHMENT0,bt,0);y(pe)&&v(bt),n.unbindTexture()}Ae.depthBuffer&&Se(Ae)}function Je(Ae){const pe=Ae.textures;for(let Ge=0,Qe=pe.length;Ge<Qe;Ge++){const Ze=pe[Ge];if(y(Ze)){const tt=x(Ae),Ft=r.get(Ze).__webglTexture;n.bindTexture(tt,Ft),v(tt),n.unbindTexture()}}}const at=[],re=[];function Le(Ae){if(Ae.samples>0){if(Ue(Ae)===!1){const pe=Ae.textures,Ge=Ae.width,Qe=Ae.height;let Ze=t.COLOR_BUFFER_BIT;const tt=Ae.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Ft=r.get(Ae),bt=pe.length>1;if(bt)for(let Ie=0;Ie<pe.length;Ie++)n.bindFramebuffer(t.FRAMEBUFFER,Ft.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ie,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,Ft.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ie,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,Ft.__webglMultisampledFramebuffer);const Mt=Ae.texture.mipmaps;Mt&&Mt.length>0?n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Ft.__webglFramebuffer[0]):n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Ft.__webglFramebuffer);for(let Ie=0;Ie<pe.length;Ie++){if(Ae.resolveDepthBuffer&&(Ae.depthBuffer&&(Ze|=t.DEPTH_BUFFER_BIT),Ae.stencilBuffer&&Ae.resolveStencilBuffer&&(Ze|=t.STENCIL_BUFFER_BIT)),bt){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,Ft.__webglColorRenderbuffer[Ie]);const ce=r.get(pe[Ie]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,ce,0)}t.blitFramebuffer(0,0,Ge,Qe,0,0,Ge,Qe,Ze,t.NEAREST),c===!0&&(at.length=0,re.length=0,at.push(t.COLOR_ATTACHMENT0+Ie),Ae.depthBuffer&&Ae.resolveDepthBuffer===!1&&(at.push(tt),re.push(tt),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,re)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,at))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),bt)for(let Ie=0;Ie<pe.length;Ie++){n.bindFramebuffer(t.FRAMEBUFFER,Ft.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ie,t.RENDERBUFFER,Ft.__webglColorRenderbuffer[Ie]);const ce=r.get(pe[Ie]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,Ft.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ie,t.TEXTURE_2D,ce,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Ft.__webglMultisampledFramebuffer)}else if(Ae.depthBuffer&&Ae.resolveDepthBuffer===!1&&c){const pe=Ae.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[pe])}}}function He(Ae){return Math.min(i.maxSamples,Ae.samples)}function Ue(Ae){const pe=r.get(Ae);return Ae.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&pe.__useRenderToTexture!==!1}function De(Ae){const pe=o.render.frame;u.get(Ae)!==pe&&(u.set(Ae,pe),Ae.update())}function fe(Ae,pe){const Ge=Ae.colorSpace,Qe=Ae.format,Ze=Ae.type;return Ae.isCompressedTexture===!0||Ae.isVideoTexture===!0||Ge!==Rv&&Ge!==b0&&(xs.getTransfer(Ge)===fo?(Qe!==Vf||Ze!==xa)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Ge)),pe}function ve(Ae){return typeof HTMLImageElement<"u"&&Ae instanceof HTMLImageElement?(l.width=Ae.naturalWidth||Ae.width,l.height=Ae.naturalHeight||Ae.height):typeof VideoFrame<"u"&&Ae instanceof VideoFrame?(l.width=Ae.displayWidth,l.height=Ae.displayHeight):(l.width=Ae.width,l.height=Ae.height),l}this.allocateTextureUnit=F,this.resetTextureUnits=P,this.setTexture2D=X,this.setTexture2DArray=G,this.setTexture3D=j,this.setTextureCube=q,this.rebindTextures=ze,this.setupRenderTarget=Be,this.updateRenderTargetMipmap=Je,this.updateMultisampleRenderTarget=Le,this.setupDepthRenderbuffer=Se,this.setupFrameBufferTexture=xe,this.useMultisampledRTT=Ue}function R1e(t,e){function n(r,i=b0){let s;const o=xs.getTransfer(i);if(r===xa)return t.UNSIGNED_BYTE;if(r===KB)return t.UNSIGNED_SHORT_4_4_4_4;if(r===XB)return t.UNSIGNED_SHORT_5_5_5_1;if(r===aee)return t.UNSIGNED_INT_5_9_9_9_REV;if(r===see)return t.BYTE;if(r===oee)return t.SHORT;if(r===gA)return t.UNSIGNED_SHORT;if(r===WB)return t.INT;if(r===Wy)return t.UNSIGNED_INT;if(r===hg)return t.FLOAT;if(r===ab)return t.HALF_FLOAT;if(r===cee)return t.ALPHA;if(r===lee)return t.RGB;if(r===Vf)return t.RGBA;if(r===_A)return t.DEPTH_COMPONENT;if(r===ex)return t.DEPTH_STENCIL;if(r===SM)return t.RED;if(r===YB)return t.RED_INTEGER;if(r===ZB)return t.RG;if(r===JB)return t.RG_INTEGER;if(r===i3)return t.RGBA_INTEGER;if(r===hO||r===dO||r===pO||r===mO)if(o===fo)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===hO)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===dO)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===pO)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===mO)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===hO)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===dO)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===pO)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===mO)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===r6||r===i6||r===s6||r===o6)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===r6)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===i6)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===s6)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===o6)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===a6||r===c6||r===l6)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===a6||r===c6)return o===fo?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===l6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===u6||r===f6||r===h6||r===d6||r===p6||r===m6||r===g6||r===_6||r===v6||r===y6||r===b6||r===E6||r===S6||r===x6)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===u6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===f6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===h6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===d6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===p6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===m6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===g6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===_6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===v6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===y6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===b6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===E6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===S6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===x6)return o===fo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===gO||r===T6||r===w6)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===gO)return o===fo?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===T6)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===w6)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===uee||r===R6||r===C6||r===A6)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===gO)return s.COMPRESSED_RED_RGTC1_EXT;if(r===R6)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===C6)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===A6)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===QS?t.UNSIGNED_INT_24_8:t[r]!==void 0?t[r]:null}return{convert:n}}const C1e=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,A1e=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class M1e{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n,r){if(this.texture===null){const i=new El,s=e.properties.get(i);s.__webglTexture=n.texture,(n.depthNear!==r.depthNear||n.depthFar!==r.depthFar)&&(this.depthNear=n.depthNear,this.depthFar=n.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,r=new Fa({vertexShader:C1e,fragmentShader:A1e,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new Uh(new xM(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class k1e extends Dv{constructor(e,n){super();const r=this;let i=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,h=null,d=null,m=null,p=null;const g=new M1e,y=n.getContextAttributes();let v=null,x=null;const E=[],C=[],A=new Vn;let k=null;const M=new jf;M.viewport=new La;const I=new jf;I.viewport=new La;const z=[M,I],H=new X0e;let K=null,P=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ie){let ae=E[ie];return ae===void 0&&(ae=new gD,E[ie]=ae),ae.getTargetRaySpace()},this.getControllerGrip=function(ie){let ae=E[ie];return ae===void 0&&(ae=new gD,E[ie]=ae),ae.getGripSpace()},this.getHand=function(ie){let ae=E[ie];return ae===void 0&&(ae=new gD,E[ie]=ae),ae.getHandSpace()};function F(ie){const ae=C.indexOf(ie.inputSource);if(ae===-1)return;const xe=E[ae];xe!==void 0&&(xe.update(ie.inputSource,ie.frame,l||o),xe.dispatchEvent({type:ie.type,data:ie.inputSource}))}function N(){i.removeEventListener("select",F),i.removeEventListener("selectstart",F),i.removeEventListener("selectend",F),i.removeEventListener("squeeze",F),i.removeEventListener("squeezestart",F),i.removeEventListener("squeezeend",F),i.removeEventListener("end",N),i.removeEventListener("inputsourceschange",X);for(let ie=0;ie<E.length;ie++){const ae=C[ie];ae!==null&&(C[ie]=null,E[ie].disconnect(ae))}K=null,P=null,g.reset(),e.setRenderTarget(v),m=null,d=null,h=null,i=null,x=null,ne.stop(),r.isPresenting=!1,e.setPixelRatio(k),e.setSize(A.width,A.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ie){s=ie,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ie){a=ie,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(ie){l=ie},this.getBaseLayer=function(){return d!==null?d:m},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(ie){if(i=ie,i!==null){if(v=e.getRenderTarget(),i.addEventListener("select",F),i.addEventListener("selectstart",F),i.addEventListener("selectend",F),i.addEventListener("squeeze",F),i.addEventListener("squeezestart",F),i.addEventListener("squeezeend",F),i.addEventListener("end",N),i.addEventListener("inputsourceschange",X),y.xrCompatible!==!0&&await n.makeXRCompatible(),k=e.getPixelRatio(),e.getSize(A),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let xe=null,Ne=null,Re=null;y.depth&&(Re=y.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,xe=y.stencil?ex:_A,Ne=y.stencil?QS:Wy);const Se={colorFormat:n.RGBA8,depthFormat:Re,scaleFactor:s};h=new XRWebGLBinding(i,n),d=h.createProjectionLayer(Se),i.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),x=new Iu(d.textureWidth,d.textureHeight,{format:Vf,type:xa,depthTexture:new o3(d.textureWidth,d.textureHeight,Ne,void 0,void 0,void 0,void 0,void 0,void 0,xe),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}else{const xe={antialias:y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:s};m=new XRWebGLLayer(i,n,xe),i.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),x=new Iu(m.framebufferWidth,m.framebufferHeight,{format:Vf,type:xa,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1})}x.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=await i.requestReferenceSpace(a),ne.setContext(i),ne.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return g.getDepthTexture()};function X(ie){for(let ae=0;ae<ie.removed.length;ae++){const xe=ie.removed[ae],Ne=C.indexOf(xe);Ne>=0&&(C[Ne]=null,E[Ne].disconnect(xe))}for(let ae=0;ae<ie.added.length;ae++){const xe=ie.added[ae];let Ne=C.indexOf(xe);if(Ne===-1){for(let Se=0;Se<E.length;Se++)if(Se>=C.length){C.push(xe),Ne=Se;break}else if(C[Se]===null){C[Se]=xe,Ne=Se;break}if(Ne===-1)break}const Re=E[Ne];Re&&Re.connect(xe)}}const G=new jt,j=new jt;function q(ie,ae,xe){G.setFromMatrixPosition(ae.matrixWorld),j.setFromMatrixPosition(xe.matrixWorld);const Ne=G.distanceTo(j),Re=ae.projectionMatrix.elements,Se=xe.projectionMatrix.elements,ze=Re[14]/(Re[10]-1),Be=Re[14]/(Re[10]+1),Je=(Re[9]+1)/Re[5],at=(Re[9]-1)/Re[5],re=(Re[8]-1)/Re[0],Le=(Se[8]+1)/Se[0],He=ze*re,Ue=ze*Le,De=Ne/(-re+Le),fe=De*-re;if(ae.matrixWorld.decompose(ie.position,ie.quaternion,ie.scale),ie.translateX(fe),ie.translateZ(De),ie.matrixWorld.compose(ie.position,ie.quaternion,ie.scale),ie.matrixWorldInverse.copy(ie.matrixWorld).invert(),Re[10]===-1)ie.projectionMatrix.copy(ae.projectionMatrix),ie.projectionMatrixInverse.copy(ae.projectionMatrixInverse);else{const ve=ze+De,Ae=Be+De,pe=He-fe,Ge=Ue+(Ne-fe),Qe=Je*Be/Ae*ve,Ze=at*Be/Ae*ve;ie.projectionMatrix.makePerspective(pe,Ge,Qe,Ze,ve,Ae),ie.projectionMatrixInverse.copy(ie.projectionMatrix).invert()}}function te(ie,ae){ae===null?ie.matrixWorld.copy(ie.matrix):ie.matrixWorld.multiplyMatrices(ae.matrixWorld,ie.matrix),ie.matrixWorldInverse.copy(ie.matrixWorld).invert()}this.updateCamera=function(ie){if(i===null)return;let ae=ie.near,xe=ie.far;g.texture!==null&&(g.depthNear>0&&(ae=g.depthNear),g.depthFar>0&&(xe=g.depthFar)),H.near=I.near=M.near=ae,H.far=I.far=M.far=xe,(K!==H.near||P!==H.far)&&(i.updateRenderState({depthNear:H.near,depthFar:H.far}),K=H.near,P=H.far),M.layers.mask=ie.layers.mask|2,I.layers.mask=ie.layers.mask|4,H.layers.mask=M.layers.mask|I.layers.mask;const Ne=ie.parent,Re=H.cameras;te(H,Ne);for(let Se=0;Se<Re.length;Se++)te(Re[Se],Ne);Re.length===2?q(H,M,I):H.projectionMatrix.copy(M.projectionMatrix),W(ie,H,Ne)};function W(ie,ae,xe){xe===null?ie.matrix.copy(ae.matrixWorld):(ie.matrix.copy(xe.matrixWorld),ie.matrix.invert(),ie.matrix.multiply(ae.matrixWorld)),ie.matrix.decompose(ie.position,ie.quaternion,ie.scale),ie.updateMatrixWorld(!0),ie.projectionMatrix.copy(ae.projectionMatrix),ie.projectionMatrixInverse.copy(ae.projectionMatrixInverse),ie.isPerspectiveCamera&&(ie.fov=vA*2*Math.atan(1/ie.projectionMatrix.elements[5]),ie.zoom=1)}this.getCamera=function(){return H},this.getFoveation=function(){if(!(d===null&&m===null))return c},this.setFoveation=function(ie){c=ie,d!==null&&(d.fixedFoveation=ie),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=ie)},this.hasDepthSensing=function(){return g.texture!==null},this.getDepthSensingMesh=function(){return g.getMesh(H)};let $=null;function J(ie,ae){if(u=ae.getViewerPose(l||o),p=ae,u!==null){const xe=u.views;m!==null&&(e.setRenderTargetFramebuffer(x,m.framebuffer),e.setRenderTarget(x));let Ne=!1;xe.length!==H.cameras.length&&(H.cameras.length=0,Ne=!0);for(let ze=0;ze<xe.length;ze++){const Be=xe[ze];let Je=null;if(m!==null)Je=m.getViewport(Be);else{const re=h.getViewSubImage(d,Be);Je=re.viewport,ze===0&&(e.setRenderTargetTextures(x,re.colorTexture,re.depthStencilTexture),e.setRenderTarget(x))}let at=z[ze];at===void 0&&(at=new jf,at.layers.enable(ze),at.viewport=new La,z[ze]=at),at.matrix.fromArray(Be.transform.matrix),at.matrix.decompose(at.position,at.quaternion,at.scale),at.projectionMatrix.fromArray(Be.projectionMatrix),at.projectionMatrixInverse.copy(at.projectionMatrix).invert(),at.viewport.set(Je.x,Je.y,Je.width,Je.height),ze===0&&(H.matrix.copy(at.matrix),H.matrix.decompose(H.position,H.quaternion,H.scale)),Ne===!0&&H.cameras.push(at)}const Re=i.enabledFeatures;if(Re&&Re.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&h){const ze=h.getDepthInformation(xe[0]);ze&&ze.isValid&&ze.texture&&g.init(e,ze,i.renderState)}}for(let xe=0;xe<E.length;xe++){const Ne=C[xe],Re=E[xe];Ne!==null&&Re!==void 0&&Re.update(Ne,ae,l||o)}$&&$(ie,ae),ae.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ae}),p=null}const ne=new Eee;ne.setAnimationLoop(J),this.setAnimationLoop=function(ie){$=ie},this.dispose=function(){}}}const Lb=new U0,O1e=new Ks;function I1e(t,e){function n(y,v){y.matrixAutoUpdate===!0&&y.updateMatrix(),v.value.copy(y.matrix)}function r(y,v){v.color.getRGB(y.fogColor.value,_ee(t)),v.isFog?(y.fogNear.value=v.near,y.fogFar.value=v.far):v.isFogExp2&&(y.fogDensity.value=v.density)}function i(y,v,x,E,C){v.isMeshBasicMaterial||v.isMeshLambertMaterial?s(y,v):v.isMeshToonMaterial?(s(y,v),h(y,v)):v.isMeshPhongMaterial?(s(y,v),u(y,v)):v.isMeshStandardMaterial?(s(y,v),d(y,v),v.isMeshPhysicalMaterial&&m(y,v,C)):v.isMeshMatcapMaterial?(s(y,v),p(y,v)):v.isMeshDepthMaterial?s(y,v):v.isMeshDistanceMaterial?(s(y,v),g(y,v)):v.isMeshNormalMaterial?s(y,v):v.isLineBasicMaterial?(o(y,v),v.isLineDashedMaterial&&a(y,v)):v.isPointsMaterial?c(y,v,x,E):v.isSpriteMaterial?l(y,v):v.isShadowMaterial?(y.color.value.copy(v.color),y.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function s(y,v){y.opacity.value=v.opacity,v.color&&y.diffuse.value.copy(v.color),v.emissive&&y.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(y.map.value=v.map,n(v.map,y.mapTransform)),v.alphaMap&&(y.alphaMap.value=v.alphaMap,n(v.alphaMap,y.alphaMapTransform)),v.bumpMap&&(y.bumpMap.value=v.bumpMap,n(v.bumpMap,y.bumpMapTransform),y.bumpScale.value=v.bumpScale,v.side===Ql&&(y.bumpScale.value*=-1)),v.normalMap&&(y.normalMap.value=v.normalMap,n(v.normalMap,y.normalMapTransform),y.normalScale.value.copy(v.normalScale),v.side===Ql&&y.normalScale.value.negate()),v.displacementMap&&(y.displacementMap.value=v.displacementMap,n(v.displacementMap,y.displacementMapTransform),y.displacementScale.value=v.displacementScale,y.displacementBias.value=v.displacementBias),v.emissiveMap&&(y.emissiveMap.value=v.emissiveMap,n(v.emissiveMap,y.emissiveMapTransform)),v.specularMap&&(y.specularMap.value=v.specularMap,n(v.specularMap,y.specularMapTransform)),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest);const x=e.get(v),E=x.envMap,C=x.envMapRotation;E&&(y.envMap.value=E,Lb.copy(C),Lb.x*=-1,Lb.y*=-1,Lb.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(Lb.y*=-1,Lb.z*=-1),y.envMapRotation.value.setFromMatrix4(O1e.makeRotationFromEuler(Lb)),y.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=v.reflectivity,y.ior.value=v.ior,y.refractionRatio.value=v.refractionRatio),v.lightMap&&(y.lightMap.value=v.lightMap,y.lightMapIntensity.value=v.lightMapIntensity,n(v.lightMap,y.lightMapTransform)),v.aoMap&&(y.aoMap.value=v.aoMap,y.aoMapIntensity.value=v.aoMapIntensity,n(v.aoMap,y.aoMapTransform))}function o(y,v){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity,v.map&&(y.map.value=v.map,n(v.map,y.mapTransform))}function a(y,v){y.dashSize.value=v.dashSize,y.totalSize.value=v.dashSize+v.gapSize,y.scale.value=v.scale}function c(y,v,x,E){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity,y.size.value=v.size*x,y.scale.value=E*.5,v.map&&(y.map.value=v.map,n(v.map,y.uvTransform)),v.alphaMap&&(y.alphaMap.value=v.alphaMap,n(v.alphaMap,y.alphaMapTransform)),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest)}function l(y,v){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity,y.rotation.value=v.rotation,v.map&&(y.map.value=v.map,n(v.map,y.mapTransform)),v.alphaMap&&(y.alphaMap.value=v.alphaMap,n(v.alphaMap,y.alphaMapTransform)),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest)}function u(y,v){y.specular.value.copy(v.specular),y.shininess.value=Math.max(v.shininess,1e-4)}function h(y,v){v.gradientMap&&(y.gradientMap.value=v.gradientMap)}function d(y,v){y.metalness.value=v.metalness,v.metalnessMap&&(y.metalnessMap.value=v.metalnessMap,n(v.metalnessMap,y.metalnessMapTransform)),y.roughness.value=v.roughness,v.roughnessMap&&(y.roughnessMap.value=v.roughnessMap,n(v.roughnessMap,y.roughnessMapTransform)),v.envMap&&(y.envMapIntensity.value=v.envMapIntensity)}function m(y,v,x){y.ior.value=v.ior,v.sheen>0&&(y.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),y.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(y.sheenColorMap.value=v.sheenColorMap,n(v.sheenColorMap,y.sheenColorMapTransform)),v.sheenRoughnessMap&&(y.sheenRoughnessMap.value=v.sheenRoughnessMap,n(v.sheenRoughnessMap,y.sheenRoughnessMapTransform))),v.clearcoat>0&&(y.clearcoat.value=v.clearcoat,y.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(y.clearcoatMap.value=v.clearcoatMap,n(v.clearcoatMap,y.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,n(v.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(y.clearcoatNormalMap.value=v.clearcoatNormalMap,n(v.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===Ql&&y.clearcoatNormalScale.value.negate())),v.dispersion>0&&(y.dispersion.value=v.dispersion),v.iridescence>0&&(y.iridescence.value=v.iridescence,y.iridescenceIOR.value=v.iridescenceIOR,y.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(y.iridescenceMap.value=v.iridescenceMap,n(v.iridescenceMap,y.iridescenceMapTransform)),v.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=v.iridescenceThicknessMap,n(v.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),v.transmission>0&&(y.transmission.value=v.transmission,y.transmissionSamplerMap.value=x.texture,y.transmissionSamplerSize.value.set(x.width,x.height),v.transmissionMap&&(y.transmissionMap.value=v.transmissionMap,n(v.transmissionMap,y.transmissionMapTransform)),y.thickness.value=v.thickness,v.thicknessMap&&(y.thicknessMap.value=v.thicknessMap,n(v.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=v.attenuationDistance,y.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(y.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(y.anisotropyMap.value=v.anisotropyMap,n(v.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=v.specularIntensity,y.specularColor.value.copy(v.specularColor),v.specularColorMap&&(y.specularColorMap.value=v.specularColorMap,n(v.specularColorMap,y.specularColorMapTransform)),v.specularIntensityMap&&(y.specularIntensityMap.value=v.specularIntensityMap,n(v.specularIntensityMap,y.specularIntensityMapTransform))}function p(y,v){v.matcap&&(y.matcap.value=v.matcap)}function g(y,v){const x=e.get(v).light;y.referencePosition.value.setFromMatrixPosition(x.matrixWorld),y.nearDistance.value=x.shadow.camera.near,y.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function N1e(t,e,n,r){let i={},s={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function c(x,E){const C=E.program;r.uniformBlockBinding(x,C)}function l(x,E){let C=i[x.id];C===void 0&&(p(x),C=u(x),i[x.id]=C,x.addEventListener("dispose",y));const A=E.program;r.updateUBOMapping(x,A);const k=e.render.frame;s[x.id]!==k&&(d(x),s[x.id]=k)}function u(x){const E=h();x.__bindingPointIndex=E;const C=t.createBuffer(),A=x.__size,k=x.usage;return t.bindBuffer(t.UNIFORM_BUFFER,C),t.bufferData(t.UNIFORM_BUFFER,A,k),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,E,C),C}function h(){for(let x=0;x<a;x++)if(o.indexOf(x)===-1)return o.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(x){const E=i[x.id],C=x.uniforms,A=x.__cache;t.bindBuffer(t.UNIFORM_BUFFER,E);for(let k=0,M=C.length;k<M;k++){const I=Array.isArray(C[k])?C[k]:[C[k]];for(let z=0,H=I.length;z<H;z++){const K=I[z];if(m(K,k,z,A)===!0){const P=K.__offset,F=Array.isArray(K.value)?K.value:[K.value];let N=0;for(let X=0;X<F.length;X++){const G=F[X],j=g(G);typeof G=="number"||typeof G=="boolean"?(K.__data[0]=G,t.bufferSubData(t.UNIFORM_BUFFER,P+N,K.__data)):G.isMatrix3?(K.__data[0]=G.elements[0],K.__data[1]=G.elements[1],K.__data[2]=G.elements[2],K.__data[3]=0,K.__data[4]=G.elements[3],K.__data[5]=G.elements[4],K.__data[6]=G.elements[5],K.__data[7]=0,K.__data[8]=G.elements[6],K.__data[9]=G.elements[7],K.__data[10]=G.elements[8],K.__data[11]=0):(G.toArray(K.__data,N),N+=j.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,P,K.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function m(x,E,C,A){const k=x.value,M=E+"_"+C;if(A[M]===void 0)return typeof k=="number"||typeof k=="boolean"?A[M]=k:A[M]=k.clone(),!0;{const I=A[M];if(typeof k=="number"||typeof k=="boolean"){if(I!==k)return A[M]=k,!0}else if(I.equals(k)===!1)return I.copy(k),!0}return!1}function p(x){const E=x.uniforms;let C=0;const A=16;for(let M=0,I=E.length;M<I;M++){const z=Array.isArray(E[M])?E[M]:[E[M]];for(let H=0,K=z.length;H<K;H++){const P=z[H],F=Array.isArray(P.value)?P.value:[P.value];for(let N=0,X=F.length;N<X;N++){const G=F[N],j=g(G),q=C%A,te=q%j.boundary,W=q+te;C+=te,W!==0&&A-W<j.storage&&(C+=A-W),P.__data=new Float32Array(j.storage/Float32Array.BYTES_PER_ELEMENT),P.__offset=C,C+=j.storage}}}const k=C%A;return k>0&&(C+=A-k),x.__size=C,x.__cache={},this}function g(x){const E={boundary:0,storage:0};return typeof x=="number"||typeof x=="boolean"?(E.boundary=4,E.storage=4):x.isVector2?(E.boundary=8,E.storage=8):x.isVector3||x.isColor?(E.boundary=16,E.storage=12):x.isVector4?(E.boundary=16,E.storage=16):x.isMatrix3?(E.boundary=48,E.storage=48):x.isMatrix4?(E.boundary=64,E.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),E}function y(x){const E=x.target;E.removeEventListener("dispose",y);const C=o.indexOf(E.__bindingPointIndex);o.splice(C,1),t.deleteBuffer(i[E.id]),delete i[E.id],delete s[E.id]}function v(){for(const x in i)t.deleteBuffer(i[x]);o=[],i={},s={}}return{bind:c,update:l,dispose:v}}class P1e{constructor(e={}){const{canvas:n=c0e(),context:r=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let m;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");m=r.getContextAttributes().alpha}else m=o;const p=new Uint32Array(4),g=new Int32Array(4);let y=null,v=null;const x=[],E=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=gv,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const C=this;let A=!1;this._outputColorSpace=rs;let k=0,M=0,I=null,z=-1,H=null;const K=new La,P=new La;let F=null;const N=new Xi(0);let X=0,G=n.width,j=n.height,q=1,te=null,W=null;const $=new La(0,0,G,j),J=new La(0,0,G,j);let ne=!1;const ie=new yee;let ae=!1,xe=!1;const Ne=new Ks,Re=new Ks,Se=new jt,ze=new La,Be={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Je=!1;function at(){return I===null?q:1}let re=r;function Le(je,gt){return n.getContext(je,gt)}try{const je={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${EM}`),n.addEventListener("webglcontextlost",Xe,!1),n.addEventListener("webglcontextrestored",lt,!1),n.addEventListener("webglcontextcreationerror",qe,!1),re===null){const gt="webgl2";if(re=Le(gt,je),re===null)throw Le(gt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(je){throw console.error("THREE.WebGLRenderer: "+je.message),je}let He,Ue,De,fe,ve,Ae,pe,Ge,Qe,Ze,tt,Ft,bt,Mt,Ie,ce,Q,le,we,Me,Te,ye,Ye,Pe;function We(){He=new Vye(re),He.init(),ye=new R1e(re,He),Ue=new Uye(re,He,e,ye),De=new T1e(re,He),Ue.reverseDepthBuffer&&d&&De.buffers.depth.setReversed(!0),fe=new Wye(re),ve=new f1e,Ae=new w1e(re,He,De,ve,Ue,ye,fe),pe=new Fye(C),Ge=new qye(C),Qe=new Q0e(re),Ye=new Dye(re,Qe),Ze=new Gye(re,Qe,fe,Ye),tt=new Xye(re,Ze,Qe,fe),we=new Kye(re,Ue,Ae),ce=new Bye(ve),Ft=new u1e(C,pe,Ge,He,Ue,Ye,ce),bt=new I1e(C,ve),Mt=new d1e,Ie=new y1e(He),le=new Pye(C,pe,Ge,De,tt,m,c),Q=new S1e(C,tt,Ue),Pe=new N1e(re,fe,Ue,De),Me=new Lye(re,He,fe),Te=new $ye(re,He,fe),fe.programs=Ft.programs,C.capabilities=Ue,C.extensions=He,C.properties=ve,C.renderLists=Mt,C.shadowMap=Q,C.state=De,C.info=fe}We();const Ve=new k1e(C,re);this.xr=Ve,this.getContext=function(){return re},this.getContextAttributes=function(){return re.getContextAttributes()},this.forceContextLoss=function(){const je=He.get("WEBGL_lose_context");je&&je.loseContext()},this.forceContextRestore=function(){const je=He.get("WEBGL_lose_context");je&&je.restoreContext()},this.getPixelRatio=function(){return q},this.setPixelRatio=function(je){je!==void 0&&(q=je,this.setSize(G,j,!1))},this.getSize=function(je){return je.set(G,j)},this.setSize=function(je,gt,Pt=!0){if(Ve.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}G=je,j=gt,n.width=Math.floor(je*q),n.height=Math.floor(gt*q),Pt===!0&&(n.style.width=je+"px",n.style.height=gt+"px"),this.setViewport(0,0,je,gt)},this.getDrawingBufferSize=function(je){return je.set(G*q,j*q).floor()},this.setDrawingBufferSize=function(je,gt,Pt){G=je,j=gt,q=Pt,n.width=Math.floor(je*Pt),n.height=Math.floor(gt*Pt),this.setViewport(0,0,je,gt)},this.getCurrentViewport=function(je){return je.copy(K)},this.getViewport=function(je){return je.copy($)},this.setViewport=function(je,gt,Pt,Dt){je.isVector4?$.set(je.x,je.y,je.z,je.w):$.set(je,gt,Pt,Dt),De.viewport(K.copy($).multiplyScalar(q).round())},this.getScissor=function(je){return je.copy(J)},this.setScissor=function(je,gt,Pt,Dt){je.isVector4?J.set(je.x,je.y,je.z,je.w):J.set(je,gt,Pt,Dt),De.scissor(P.copy(J).multiplyScalar(q).round())},this.getScissorTest=function(){return ne},this.setScissorTest=function(je){De.setScissorTest(ne=je)},this.setOpaqueSort=function(je){te=je},this.setTransparentSort=function(je){W=je},this.getClearColor=function(je){return je.copy(le.getClearColor())},this.setClearColor=function(){le.setClearColor(...arguments)},this.getClearAlpha=function(){return le.getClearAlpha()},this.setClearAlpha=function(){le.setClearAlpha(...arguments)},this.clear=function(je=!0,gt=!0,Pt=!0){let Dt=0;if(je){let St=!1;if(I!==null){const nn=I.texture.format;St=nn===i3||nn===JB||nn===YB}if(St){const nn=I.texture.type,xn=nn===xa||nn===Wy||nn===gA||nn===QS||nn===KB||nn===XB,ln=le.getClearColor(),Un=le.getClearAlpha(),ur=ln.r,cr=ln.g,Fn=ln.b;xn?(p[0]=ur,p[1]=cr,p[2]=Fn,p[3]=Un,re.clearBufferuiv(re.COLOR,0,p)):(g[0]=ur,g[1]=cr,g[2]=Fn,g[3]=Un,re.clearBufferiv(re.COLOR,0,g))}else Dt|=re.COLOR_BUFFER_BIT}gt&&(Dt|=re.DEPTH_BUFFER_BIT),Pt&&(Dt|=re.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),re.clear(Dt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Xe,!1),n.removeEventListener("webglcontextrestored",lt,!1),n.removeEventListener("webglcontextcreationerror",qe,!1),le.dispose(),Mt.dispose(),Ie.dispose(),ve.dispose(),pe.dispose(),Ge.dispose(),tt.dispose(),Ye.dispose(),Pe.dispose(),Ft.dispose(),Ve.dispose(),Ve.removeEventListener("sessionstart",Ot),Ve.removeEventListener("sessionend",qt),vt.stop()};function Xe(je){je.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),A=!0}function lt(){console.log("THREE.WebGLRenderer: Context Restored."),A=!1;const je=fe.autoReset,gt=Q.enabled,Pt=Q.autoUpdate,Dt=Q.needsUpdate,St=Q.type;We(),fe.autoReset=je,Q.enabled=gt,Q.autoUpdate=Pt,Q.needsUpdate=Dt,Q.type=St}function qe(je){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",je.statusMessage)}function rt(je){const gt=je.target;gt.removeEventListener("dispose",rt),it(gt)}function it(je){nt(je),ve.remove(je)}function nt(je){const gt=ve.get(je).programs;gt!==void 0&&(gt.forEach(function(Pt){Ft.releaseProgram(Pt)}),je.isShaderMaterial&&Ft.releaseShaderCache(je))}this.renderBufferDirect=function(je,gt,Pt,Dt,St,nn){gt===null&&(gt=Be);const xn=St.isMesh&&St.matrixWorld.determinant()<0,ln=fi(je,gt,Pt,Dt,St);De.setMaterial(Dt,xn);let Un=Pt.index,ur=1;if(Dt.wireframe===!0){if(Un=Ze.getWireframeAttribute(Pt),Un===void 0)return;ur=2}const cr=Pt.drawRange,Fn=Pt.attributes.position;let dr=cr.start*ur,Dr=(cr.start+cr.count)*ur;nn!==null&&(dr=Math.max(dr,nn.start*ur),Dr=Math.min(Dr,(nn.start+nn.count)*ur)),Un!==null?(dr=Math.max(dr,0),Dr=Math.min(Dr,Un.count)):Fn!=null&&(dr=Math.max(dr,0),Dr=Math.min(Dr,Fn.count));const ws=Dr-dr;if(ws<0||ws===1/0)return;Ye.setup(St,Dt,ln,Pt,Un);let Ar,Ur=Me;if(Un!==null&&(Ar=Qe.get(Un),Ur=Te,Ur.setIndex(Ar)),St.isMesh)Dt.wireframe===!0?(De.setLineWidth(Dt.wireframeLinewidth*at()),Ur.setMode(re.LINES)):Ur.setMode(re.TRIANGLES);else if(St.isLine){let rr=Dt.linewidth;rr===void 0&&(rr=1),De.setLineWidth(rr*at()),St.isLineSegments?Ur.setMode(re.LINES):St.isLineLoop?Ur.setMode(re.LINE_LOOP):Ur.setMode(re.LINE_STRIP)}else St.isPoints?Ur.setMode(re.POINTS):St.isSprite&&Ur.setMode(re.TRIANGLES);if(St.isBatchedMesh)if(St._multiDrawInstances!==null)_O("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Ur.renderMultiDrawInstances(St._multiDrawStarts,St._multiDrawCounts,St._multiDrawCount,St._multiDrawInstances);else if(He.get("WEBGL_multi_draw"))Ur.renderMultiDraw(St._multiDrawStarts,St._multiDrawCounts,St._multiDrawCount);else{const rr=St._multiDrawStarts,pr=St._multiDrawCounts,un=St._multiDrawCount,Er=Un?Qe.get(Un).bytesPerElement:1,Co=ve.get(Dt).currentProgram.getUniforms();for(let io=0;io<un;io++)Co.setValue(re,"_gl_DrawID",io),Ur.render(rr[io]/Er,pr[io])}else if(St.isInstancedMesh)Ur.renderInstances(dr,ws,St.count);else if(Pt.isInstancedBufferGeometry){const rr=Pt._maxInstanceCount!==void 0?Pt._maxInstanceCount:1/0,pr=Math.min(Pt.instanceCount,rr);Ur.renderInstances(dr,ws,pr)}else Ur.render(dr,ws)};function ct(je,gt,Pt){je.transparent===!0&&je.side===Zl&&je.forceSinglePass===!1?(je.side=Ql,je.needsUpdate=!0,Ln(je,gt,Pt),je.side=wv,je.needsUpdate=!0,Ln(je,gt,Pt),je.side=Zl):Ln(je,gt,Pt)}this.compile=function(je,gt,Pt=null){Pt===null&&(Pt=je),v=Ie.get(Pt),v.init(gt),E.push(v),Pt.traverseVisible(function(St){St.isLight&&St.layers.test(gt.layers)&&(v.pushLight(St),St.castShadow&&v.pushShadow(St))}),je!==Pt&&je.traverseVisible(function(St){St.isLight&&St.layers.test(gt.layers)&&(v.pushLight(St),St.castShadow&&v.pushShadow(St))}),v.setupLights();const Dt=new Set;return je.traverse(function(St){if(!(St.isMesh||St.isPoints||St.isLine||St.isSprite))return;const nn=St.material;if(nn)if(Array.isArray(nn))for(let xn=0;xn<nn.length;xn++){const ln=nn[xn];ct(ln,Pt,St),Dt.add(ln)}else ct(nn,Pt,St),Dt.add(nn)}),v=E.pop(),Dt},this.compileAsync=function(je,gt,Pt=null){const Dt=this.compile(je,gt,Pt);return new Promise(St=>{function nn(){if(Dt.forEach(function(xn){ve.get(xn).currentProgram.isReady()&&Dt.delete(xn)}),Dt.size===0){St(je);return}setTimeout(nn,10)}He.get("KHR_parallel_shader_compile")!==null?nn():setTimeout(nn,10)})};let Qt=null;function tn(je){Qt&&Qt(je)}function Ot(){vt.stop()}function qt(){vt.start()}const vt=new Eee;vt.setAnimationLoop(tn),typeof self<"u"&&vt.setContext(self),this.setAnimationLoop=function(je){Qt=je,Ve.setAnimationLoop(je),je===null?vt.stop():vt.start()},Ve.addEventListener("sessionstart",Ot),Ve.addEventListener("sessionend",qt),this.render=function(je,gt){if(gt!==void 0&&gt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(A===!0)return;if(je.matrixWorldAutoUpdate===!0&&je.updateMatrixWorld(),gt.parent===null&&gt.matrixWorldAutoUpdate===!0&&gt.updateMatrixWorld(),Ve.enabled===!0&&Ve.isPresenting===!0&&(Ve.cameraAutoUpdate===!0&&Ve.updateCamera(gt),gt=Ve.getCamera()),je.isScene===!0&&je.onBeforeRender(C,je,gt,I),v=Ie.get(je,E.length),v.init(gt),E.push(v),Re.multiplyMatrices(gt.projectionMatrix,gt.matrixWorldInverse),ie.setFromProjectionMatrix(Re),xe=this.localClippingEnabled,ae=ce.init(this.clippingPlanes,xe),y=Mt.get(je,x.length),y.init(),x.push(y),Ve.enabled===!0&&Ve.isPresenting===!0){const nn=C.xr.getDepthSensingMesh();nn!==null&&Kt(nn,gt,-1/0,C.sortObjects)}Kt(je,gt,0,C.sortObjects),y.finish(),C.sortObjects===!0&&y.sort(te,W),Je=Ve.enabled===!1||Ve.isPresenting===!1||Ve.hasDepthSensing()===!1,Je&&le.addToRenderList(y,je),this.info.render.frame++,ae===!0&&ce.beginShadows();const Pt=v.state.shadowsArray;Q.render(Pt,je,gt),ae===!0&&ce.endShadows(),this.info.autoReset===!0&&this.info.reset();const Dt=y.opaque,St=y.transmissive;if(v.setupLights(),gt.isArrayCamera){const nn=gt.cameras;if(St.length>0)for(let xn=0,ln=nn.length;xn<ln;xn++){const Un=nn[xn];Wt(Dt,St,je,Un)}Je&&le.render(je);for(let xn=0,ln=nn.length;xn<ln;xn++){const Un=nn[xn];_n(y,je,Un,Un.viewport)}}else St.length>0&&Wt(Dt,St,je,gt),Je&&le.render(je),_n(y,je,gt);I!==null&&M===0&&(Ae.updateMultisampleRenderTarget(I),Ae.updateRenderTargetMipmap(I)),je.isScene===!0&&je.onAfterRender(C,je,gt),Ye.resetDefaultState(),z=-1,H=null,E.pop(),E.length>0?(v=E[E.length-1],ae===!0&&ce.setGlobalState(C.clippingPlanes,v.state.camera)):v=null,x.pop(),x.length>0?y=x[x.length-1]:y=null};function Kt(je,gt,Pt,Dt){if(je.visible===!1)return;if(je.layers.test(gt.layers)){if(je.isGroup)Pt=je.renderOrder;else if(je.isLOD)je.autoUpdate===!0&&je.update(gt);else if(je.isLight)v.pushLight(je),je.castShadow&&v.pushShadow(je);else if(je.isSprite){if(!je.frustumCulled||ie.intersectsSprite(je)){Dt&&ze.setFromMatrixPosition(je.matrixWorld).applyMatrix4(Re);const xn=tt.update(je),ln=je.material;ln.visible&&y.push(je,xn,ln,Pt,ze.z,null)}}else if((je.isMesh||je.isLine||je.isPoints)&&(!je.frustumCulled||ie.intersectsObject(je))){const xn=tt.update(je),ln=je.material;if(Dt&&(je.boundingSphere!==void 0?(je.boundingSphere===null&&je.computeBoundingSphere(),ze.copy(je.boundingSphere.center)):(xn.boundingSphere===null&&xn.computeBoundingSphere(),ze.copy(xn.boundingSphere.center)),ze.applyMatrix4(je.matrixWorld).applyMatrix4(Re)),Array.isArray(ln)){const Un=xn.groups;for(let ur=0,cr=Un.length;ur<cr;ur++){const Fn=Un[ur],dr=ln[Fn.materialIndex];dr&&dr.visible&&y.push(je,xn,dr,Pt,ze.z,Fn)}}else ln.visible&&y.push(je,xn,ln,Pt,ze.z,null)}}const nn=je.children;for(let xn=0,ln=nn.length;xn<ln;xn++)Kt(nn[xn],gt,Pt,Dt)}function _n(je,gt,Pt,Dt){const St=je.opaque,nn=je.transmissive,xn=je.transparent;v.setupLightsView(Pt),ae===!0&&ce.setGlobalState(C.clippingPlanes,Pt),Dt&&De.viewport(K.copy(Dt)),St.length>0&&dn(St,gt,Pt),nn.length>0&&dn(nn,gt,Pt),xn.length>0&&dn(xn,gt,Pt),De.buffers.depth.setTest(!0),De.buffers.depth.setMask(!0),De.buffers.color.setMask(!0),De.setPolygonOffset(!1)}function Wt(je,gt,Pt,Dt){if((Pt.isScene===!0?Pt.overrideMaterial:null)!==null)return;v.state.transmissionRenderTarget[Dt.id]===void 0&&(v.state.transmissionRenderTarget[Dt.id]=new Iu(1,1,{generateMipmaps:!0,type:He.has("EXT_color_buffer_half_float")||He.has("EXT_color_buffer_float")?ab:xa,minFilter:m1,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:xs.workingColorSpace}));const nn=v.state.transmissionRenderTarget[Dt.id],xn=Dt.viewport||K;nn.setSize(xn.z*C.transmissionResolutionScale,xn.w*C.transmissionResolutionScale);const ln=C.getRenderTarget();C.setRenderTarget(nn),C.getClearColor(N),X=C.getClearAlpha(),X<1&&C.setClearColor(16777215,.5),C.clear(),Je&&le.render(Pt);const Un=C.toneMapping;C.toneMapping=gv;const ur=Dt.viewport;if(Dt.viewport!==void 0&&(Dt.viewport=void 0),v.setupLightsView(Dt),ae===!0&&ce.setGlobalState(C.clippingPlanes,Dt),dn(je,Pt,Dt),Ae.updateMultisampleRenderTarget(nn),Ae.updateRenderTargetMipmap(nn),He.has("WEBGL_multisampled_render_to_texture")===!1){let cr=!1;for(let Fn=0,dr=gt.length;Fn<dr;Fn++){const Dr=gt[Fn],ws=Dr.object,Ar=Dr.geometry,Ur=Dr.material,rr=Dr.group;if(Ur.side===Zl&&ws.layers.test(Dt.layers)){const pr=Ur.side;Ur.side=Ql,Ur.needsUpdate=!0,Mn(ws,Pt,Dt,Ar,Ur,rr),Ur.side=pr,Ur.needsUpdate=!0,cr=!0}}cr===!0&&(Ae.updateMultisampleRenderTarget(nn),Ae.updateRenderTargetMipmap(nn))}C.setRenderTarget(ln),C.setClearColor(N,X),ur!==void 0&&(Dt.viewport=ur),C.toneMapping=Un}function dn(je,gt,Pt){const Dt=gt.isScene===!0?gt.overrideMaterial:null;for(let St=0,nn=je.length;St<nn;St++){const xn=je[St],ln=xn.object,Un=xn.geometry,ur=xn.group;let cr=xn.material;cr.allowOverride===!0&&Dt!==null&&(cr=Dt),ln.layers.test(Pt.layers)&&Mn(ln,gt,Pt,Un,cr,ur)}}function Mn(je,gt,Pt,Dt,St,nn){je.onBeforeRender(C,gt,Pt,Dt,St,nn),je.modelViewMatrix.multiplyMatrices(Pt.matrixWorldInverse,je.matrixWorld),je.normalMatrix.getNormalMatrix(je.modelViewMatrix),St.onBeforeRender(C,gt,Pt,Dt,je,nn),St.transparent===!0&&St.side===Zl&&St.forceSinglePass===!1?(St.side=Ql,St.needsUpdate=!0,C.renderBufferDirect(Pt,gt,Dt,St,je,nn),St.side=wv,St.needsUpdate=!0,C.renderBufferDirect(Pt,gt,Dt,St,je,nn),St.side=Zl):C.renderBufferDirect(Pt,gt,Dt,St,je,nn),je.onAfterRender(C,gt,Pt,Dt,St,nn)}function Ln(je,gt,Pt){gt.isScene!==!0&&(gt=Be);const Dt=ve.get(je),St=v.state.lights,nn=v.state.shadowsArray,xn=St.state.version,ln=Ft.getParameters(je,St.state,nn,gt,Pt),Un=Ft.getProgramCacheKey(ln);let ur=Dt.programs;Dt.environment=je.isMeshStandardMaterial?gt.environment:null,Dt.fog=gt.fog,Dt.envMap=(je.isMeshStandardMaterial?Ge:pe).get(je.envMap||Dt.environment),Dt.envMapRotation=Dt.environment!==null&&je.envMap===null?gt.environmentRotation:je.envMapRotation,ur===void 0&&(je.addEventListener("dispose",rt),ur=new Map,Dt.programs=ur);let cr=ur.get(Un);if(cr!==void 0){if(Dt.currentProgram===cr&&Dt.lightsStateVersion===xn)return ni(je,ln),cr}else ln.uniforms=Ft.getUniforms(je),je.onBeforeCompile(ln,C),cr=Ft.acquireProgram(ln,Un),ur.set(Un,cr),Dt.uniforms=ln.uniforms;const Fn=Dt.uniforms;return(!je.isShaderMaterial&&!je.isRawShaderMaterial||je.clipping===!0)&&(Fn.clippingPlanes=ce.uniform),ni(je,ln),Dt.needsLights=Ds(je),Dt.lightsStateVersion=xn,Dt.needsLights&&(Fn.ambientLightColor.value=St.state.ambient,Fn.lightProbe.value=St.state.probe,Fn.directionalLights.value=St.state.directional,Fn.directionalLightShadows.value=St.state.directionalShadow,Fn.spotLights.value=St.state.spot,Fn.spotLightShadows.value=St.state.spotShadow,Fn.rectAreaLights.value=St.state.rectArea,Fn.ltc_1.value=St.state.rectAreaLTC1,Fn.ltc_2.value=St.state.rectAreaLTC2,Fn.pointLights.value=St.state.point,Fn.pointLightShadows.value=St.state.pointShadow,Fn.hemisphereLights.value=St.state.hemi,Fn.directionalShadowMap.value=St.state.directionalShadowMap,Fn.directionalShadowMatrix.value=St.state.directionalShadowMatrix,Fn.spotShadowMap.value=St.state.spotShadowMap,Fn.spotLightMatrix.value=St.state.spotLightMatrix,Fn.spotLightMap.value=St.state.spotLightMap,Fn.pointShadowMap.value=St.state.pointShadowMap,Fn.pointShadowMatrix.value=St.state.pointShadowMatrix),Dt.currentProgram=cr,Dt.uniformsList=null,cr}function is(je){if(je.uniformsList===null){const gt=je.currentProgram.getUniforms();je.uniformsList=vO.seqWithValue(gt.seq,je.uniforms)}return je.uniformsList}function ni(je,gt){const Pt=ve.get(je);Pt.outputColorSpace=gt.outputColorSpace,Pt.batching=gt.batching,Pt.batchingColor=gt.batchingColor,Pt.instancing=gt.instancing,Pt.instancingColor=gt.instancingColor,Pt.instancingMorph=gt.instancingMorph,Pt.skinning=gt.skinning,Pt.morphTargets=gt.morphTargets,Pt.morphNormals=gt.morphNormals,Pt.morphColors=gt.morphColors,Pt.morphTargetsCount=gt.morphTargetsCount,Pt.numClippingPlanes=gt.numClippingPlanes,Pt.numIntersection=gt.numClipIntersection,Pt.vertexAlphas=gt.vertexAlphas,Pt.vertexTangents=gt.vertexTangents,Pt.toneMapping=gt.toneMapping}function fi(je,gt,Pt,Dt,St){gt.isScene!==!0&&(gt=Be),Ae.resetTextureUnits();const nn=gt.fog,xn=Dt.isMeshStandardMaterial?gt.environment:null,ln=I===null?C.outputColorSpace:I.isXRRenderTarget===!0?I.texture.colorSpace:Rv,Un=(Dt.isMeshStandardMaterial?Ge:pe).get(Dt.envMap||xn),ur=Dt.vertexColors===!0&&!!Pt.attributes.color&&Pt.attributes.color.itemSize===4,cr=!!Pt.attributes.tangent&&(!!Dt.normalMap||Dt.anisotropy>0),Fn=!!Pt.morphAttributes.position,dr=!!Pt.morphAttributes.normal,Dr=!!Pt.morphAttributes.color;let ws=gv;Dt.toneMapped&&(I===null||I.isXRRenderTarget===!0)&&(ws=C.toneMapping);const Ar=Pt.morphAttributes.position||Pt.morphAttributes.normal||Pt.morphAttributes.color,Ur=Ar!==void 0?Ar.length:0,rr=ve.get(Dt),pr=v.state.lights;if(ae===!0&&(xe===!0||je!==H)){const $n=je===H&&Dt.id===z;ce.setState(Dt,je,$n)}let un=!1;Dt.version===rr.__version?(rr.needsLights&&rr.lightsStateVersion!==pr.state.version||rr.outputColorSpace!==ln||St.isBatchedMesh&&rr.batching===!1||!St.isBatchedMesh&&rr.batching===!0||St.isBatchedMesh&&rr.batchingColor===!0&&St.colorTexture===null||St.isBatchedMesh&&rr.batchingColor===!1&&St.colorTexture!==null||St.isInstancedMesh&&rr.instancing===!1||!St.isInstancedMesh&&rr.instancing===!0||St.isSkinnedMesh&&rr.skinning===!1||!St.isSkinnedMesh&&rr.skinning===!0||St.isInstancedMesh&&rr.instancingColor===!0&&St.instanceColor===null||St.isInstancedMesh&&rr.instancingColor===!1&&St.instanceColor!==null||St.isInstancedMesh&&rr.instancingMorph===!0&&St.morphTexture===null||St.isInstancedMesh&&rr.instancingMorph===!1&&St.morphTexture!==null||rr.envMap!==Un||Dt.fog===!0&&rr.fog!==nn||rr.numClippingPlanes!==void 0&&(rr.numClippingPlanes!==ce.numPlanes||rr.numIntersection!==ce.numIntersection)||rr.vertexAlphas!==ur||rr.vertexTangents!==cr||rr.morphTargets!==Fn||rr.morphNormals!==dr||rr.morphColors!==Dr||rr.toneMapping!==ws||rr.morphTargetsCount!==Ur)&&(un=!0):(un=!0,rr.__version=Dt.version);let Er=rr.currentProgram;un===!0&&(Er=Ln(Dt,gt,St));let Co=!1,io=!1,aa=!1;const ki=Er.getUniforms(),kn=rr.uniforms;if(De.useProgram(Er.program)&&(Co=!0,io=!0,aa=!0),Dt.id!==z&&(z=Dt.id,io=!0),Co||H!==je){De.buffers.depth.getReversed()?(Ne.copy(je.projectionMatrix),u0e(Ne),f0e(Ne),ki.setValue(re,"projectionMatrix",Ne)):ki.setValue(re,"projectionMatrix",je.projectionMatrix),ki.setValue(re,"viewMatrix",je.matrixWorldInverse);const Zi=ki.map.cameraPosition;Zi!==void 0&&Zi.setValue(re,Se.setFromMatrixPosition(je.matrixWorld)),Ue.logarithmicDepthBuffer&&ki.setValue(re,"logDepthBufFC",2/(Math.log(je.far+1)/Math.LN2)),(Dt.isMeshPhongMaterial||Dt.isMeshToonMaterial||Dt.isMeshLambertMaterial||Dt.isMeshBasicMaterial||Dt.isMeshStandardMaterial||Dt.isShaderMaterial)&&ki.setValue(re,"isOrthographic",je.isOrthographicCamera===!0),H!==je&&(H=je,io=!0,aa=!0)}if(St.isSkinnedMesh){ki.setOptional(re,St,"bindMatrix"),ki.setOptional(re,St,"bindMatrixInverse");const $n=St.skeleton;$n&&($n.boneTexture===null&&$n.computeBoneTexture(),ki.setValue(re,"boneTexture",$n.boneTexture,Ae))}St.isBatchedMesh&&(ki.setOptional(re,St,"batchingTexture"),ki.setValue(re,"batchingTexture",St._matricesTexture,Ae),ki.setOptional(re,St,"batchingIdTexture"),ki.setValue(re,"batchingIdTexture",St._indirectTexture,Ae),ki.setOptional(re,St,"batchingColorTexture"),St._colorsTexture!==null&&ki.setValue(re,"batchingColorTexture",St._colorsTexture,Ae));const Gr=Pt.morphAttributes;if((Gr.position!==void 0||Gr.normal!==void 0||Gr.color!==void 0)&&we.update(St,Pt,Er),(io||rr.receiveShadow!==St.receiveShadow)&&(rr.receiveShadow=St.receiveShadow,ki.setValue(re,"receiveShadow",St.receiveShadow)),Dt.isMeshGouraudMaterial&&Dt.envMap!==null&&(kn.envMap.value=Un,kn.flipEnvMap.value=Un.isCubeTexture&&Un.isRenderTargetTexture===!1?-1:1),Dt.isMeshStandardMaterial&&Dt.envMap===null&&gt.environment!==null&&(kn.envMapIntensity.value=gt.environmentIntensity),io&&(ki.setValue(re,"toneMappingExposure",C.toneMappingExposure),rr.needsLights&&Ps(kn,aa),nn&&Dt.fog===!0&&bt.refreshFogUniforms(kn,nn),bt.refreshMaterialUniforms(kn,Dt,q,j,v.state.transmissionRenderTarget[je.id]),vO.upload(re,is(rr),kn,Ae)),Dt.isShaderMaterial&&Dt.uniformsNeedUpdate===!0&&(vO.upload(re,is(rr),kn,Ae),Dt.uniformsNeedUpdate=!1),Dt.isSpriteMaterial&&ki.setValue(re,"center",St.center),ki.setValue(re,"modelViewMatrix",St.modelViewMatrix),ki.setValue(re,"normalMatrix",St.normalMatrix),ki.setValue(re,"modelMatrix",St.matrixWorld),Dt.isShaderMaterial||Dt.isRawShaderMaterial){const $n=Dt.uniformsGroups;for(let Zi=0,za=$n.length;Zi<za;Zi++){const ms=$n[Zi];Pe.update(ms,Er),Pe.bind(ms,Er)}}return Er}function Ps(je,gt){je.ambientLightColor.needsUpdate=gt,je.lightProbe.needsUpdate=gt,je.directionalLights.needsUpdate=gt,je.directionalLightShadows.needsUpdate=gt,je.pointLights.needsUpdate=gt,je.pointLightShadows.needsUpdate=gt,je.spotLights.needsUpdate=gt,je.spotLightShadows.needsUpdate=gt,je.rectAreaLights.needsUpdate=gt,je.hemisphereLights.needsUpdate=gt}function Ds(je){return je.isMeshLambertMaterial||je.isMeshToonMaterial||je.isMeshPhongMaterial||je.isMeshStandardMaterial||je.isShadowMaterial||je.isShaderMaterial&&je.lights===!0}this.getActiveCubeFace=function(){return k},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return I},this.setRenderTargetTextures=function(je,gt,Pt){const Dt=ve.get(je);Dt.__autoAllocateDepthBuffer=je.resolveDepthBuffer===!1,Dt.__autoAllocateDepthBuffer===!1&&(Dt.__useRenderToTexture=!1),ve.get(je.texture).__webglTexture=gt,ve.get(je.depthTexture).__webglTexture=Dt.__autoAllocateDepthBuffer?void 0:Pt,Dt.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(je,gt){const Pt=ve.get(je);Pt.__webglFramebuffer=gt,Pt.__useDefaultFramebuffer=gt===void 0};const zi=re.createFramebuffer();this.setRenderTarget=function(je,gt=0,Pt=0){I=je,k=gt,M=Pt;let Dt=!0,St=null,nn=!1,xn=!1;if(je){const Un=ve.get(je);if(Un.__useDefaultFramebuffer!==void 0)De.bindFramebuffer(re.FRAMEBUFFER,null),Dt=!1;else if(Un.__webglFramebuffer===void 0)Ae.setupRenderTarget(je);else if(Un.__hasExternalTextures)Ae.rebindTextures(je,ve.get(je.texture).__webglTexture,ve.get(je.depthTexture).__webglTexture);else if(je.depthBuffer){const Fn=je.depthTexture;if(Un.__boundDepthTexture!==Fn){if(Fn!==null&&ve.has(Fn)&&(je.width!==Fn.image.width||je.height!==Fn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Ae.setupDepthRenderbuffer(je)}}const ur=je.texture;(ur.isData3DTexture||ur.isDataArrayTexture||ur.isCompressedArrayTexture)&&(xn=!0);const cr=ve.get(je).__webglFramebuffer;je.isWebGLCubeRenderTarget?(Array.isArray(cr[gt])?St=cr[gt][Pt]:St=cr[gt],nn=!0):je.samples>0&&Ae.useMultisampledRTT(je)===!1?St=ve.get(je).__webglMultisampledFramebuffer:Array.isArray(cr)?St=cr[Pt]:St=cr,K.copy(je.viewport),P.copy(je.scissor),F=je.scissorTest}else K.copy($).multiplyScalar(q).floor(),P.copy(J).multiplyScalar(q).floor(),F=ne;if(Pt!==0&&(St=zi),De.bindFramebuffer(re.FRAMEBUFFER,St)&&Dt&&De.drawBuffers(je,St),De.viewport(K),De.scissor(P),De.setScissorTest(F),nn){const Un=ve.get(je.texture);re.framebufferTexture2D(re.FRAMEBUFFER,re.COLOR_ATTACHMENT0,re.TEXTURE_CUBE_MAP_POSITIVE_X+gt,Un.__webglTexture,Pt)}else if(xn){const Un=ve.get(je.texture),ur=gt;re.framebufferTextureLayer(re.FRAMEBUFFER,re.COLOR_ATTACHMENT0,Un.__webglTexture,Pt,ur)}else if(je!==null&&Pt!==0){const Un=ve.get(je.texture);re.framebufferTexture2D(re.FRAMEBUFFER,re.COLOR_ATTACHMENT0,re.TEXTURE_2D,Un.__webglTexture,Pt)}z=-1},this.readRenderTargetPixels=function(je,gt,Pt,Dt,St,nn,xn){if(!(je&&je.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ln=ve.get(je).__webglFramebuffer;if(je.isWebGLCubeRenderTarget&&xn!==void 0&&(ln=ln[xn]),ln){De.bindFramebuffer(re.FRAMEBUFFER,ln);try{const Un=je.texture,ur=Un.format,cr=Un.type;if(!Ue.textureFormatReadable(ur)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ue.textureTypeReadable(cr)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}gt>=0&&gt<=je.width-Dt&&Pt>=0&&Pt<=je.height-St&&re.readPixels(gt,Pt,Dt,St,ye.convert(ur),ye.convert(cr),nn)}finally{const Un=I!==null?ve.get(I).__webglFramebuffer:null;De.bindFramebuffer(re.FRAMEBUFFER,Un)}}},this.readRenderTargetPixelsAsync=async function(je,gt,Pt,Dt,St,nn,xn){if(!(je&&je.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ln=ve.get(je).__webglFramebuffer;if(je.isWebGLCubeRenderTarget&&xn!==void 0&&(ln=ln[xn]),ln)if(gt>=0&&gt<=je.width-Dt&&Pt>=0&&Pt<=je.height-St){De.bindFramebuffer(re.FRAMEBUFFER,ln);const Un=je.texture,ur=Un.format,cr=Un.type;if(!Ue.textureFormatReadable(ur))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ue.textureTypeReadable(cr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Fn=re.createBuffer();re.bindBuffer(re.PIXEL_PACK_BUFFER,Fn),re.bufferData(re.PIXEL_PACK_BUFFER,nn.byteLength,re.STREAM_READ),re.readPixels(gt,Pt,Dt,St,ye.convert(ur),ye.convert(cr),0);const dr=I!==null?ve.get(I).__webglFramebuffer:null;De.bindFramebuffer(re.FRAMEBUFFER,dr);const Dr=re.fenceSync(re.SYNC_GPU_COMMANDS_COMPLETE,0);return re.flush(),await l0e(re,Dr,4),re.bindBuffer(re.PIXEL_PACK_BUFFER,Fn),re.getBufferSubData(re.PIXEL_PACK_BUFFER,0,nn),re.deleteBuffer(Fn),re.deleteSync(Dr),nn}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(je,gt=null,Pt=0){const Dt=Math.pow(2,-Pt),St=Math.floor(je.image.width*Dt),nn=Math.floor(je.image.height*Dt),xn=gt!==null?gt.x:0,ln=gt!==null?gt.y:0;Ae.setTexture2D(je,0),re.copyTexSubImage2D(re.TEXTURE_2D,Pt,0,0,xn,ln,St,nn),De.unbindTexture()};const ds=re.createFramebuffer(),ps=re.createFramebuffer();this.copyTextureToTexture=function(je,gt,Pt=null,Dt=null,St=0,nn=null){nn===null&&(St!==0?(_O("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),nn=St,St=0):nn=0);let xn,ln,Un,ur,cr,Fn,dr,Dr,ws;const Ar=je.isCompressedTexture?je.mipmaps[nn]:je.image;if(Pt!==null)xn=Pt.max.x-Pt.min.x,ln=Pt.max.y-Pt.min.y,Un=Pt.isBox3?Pt.max.z-Pt.min.z:1,ur=Pt.min.x,cr=Pt.min.y,Fn=Pt.isBox3?Pt.min.z:0;else{const Gr=Math.pow(2,-St);xn=Math.floor(Ar.width*Gr),ln=Math.floor(Ar.height*Gr),je.isDataArrayTexture?Un=Ar.depth:je.isData3DTexture?Un=Math.floor(Ar.depth*Gr):Un=1,ur=0,cr=0,Fn=0}Dt!==null?(dr=Dt.x,Dr=Dt.y,ws=Dt.z):(dr=0,Dr=0,ws=0);const Ur=ye.convert(gt.format),rr=ye.convert(gt.type);let pr;gt.isData3DTexture?(Ae.setTexture3D(gt,0),pr=re.TEXTURE_3D):gt.isDataArrayTexture||gt.isCompressedArrayTexture?(Ae.setTexture2DArray(gt,0),pr=re.TEXTURE_2D_ARRAY):(Ae.setTexture2D(gt,0),pr=re.TEXTURE_2D),re.pixelStorei(re.UNPACK_FLIP_Y_WEBGL,gt.flipY),re.pixelStorei(re.UNPACK_PREMULTIPLY_ALPHA_WEBGL,gt.premultiplyAlpha),re.pixelStorei(re.UNPACK_ALIGNMENT,gt.unpackAlignment);const un=re.getParameter(re.UNPACK_ROW_LENGTH),Er=re.getParameter(re.UNPACK_IMAGE_HEIGHT),Co=re.getParameter(re.UNPACK_SKIP_PIXELS),io=re.getParameter(re.UNPACK_SKIP_ROWS),aa=re.getParameter(re.UNPACK_SKIP_IMAGES);re.pixelStorei(re.UNPACK_ROW_LENGTH,Ar.width),re.pixelStorei(re.UNPACK_IMAGE_HEIGHT,Ar.height),re.pixelStorei(re.UNPACK_SKIP_PIXELS,ur),re.pixelStorei(re.UNPACK_SKIP_ROWS,cr),re.pixelStorei(re.UNPACK_SKIP_IMAGES,Fn);const ki=je.isDataArrayTexture||je.isData3DTexture,kn=gt.isDataArrayTexture||gt.isData3DTexture;if(je.isDepthTexture){const Gr=ve.get(je),$n=ve.get(gt),Zi=ve.get(Gr.__renderTarget),za=ve.get($n.__renderTarget);De.bindFramebuffer(re.READ_FRAMEBUFFER,Zi.__webglFramebuffer),De.bindFramebuffer(re.DRAW_FRAMEBUFFER,za.__webglFramebuffer);for(let ms=0;ms<Un;ms++)ki&&(re.framebufferTextureLayer(re.READ_FRAMEBUFFER,re.COLOR_ATTACHMENT0,ve.get(je).__webglTexture,St,Fn+ms),re.framebufferTextureLayer(re.DRAW_FRAMEBUFFER,re.COLOR_ATTACHMENT0,ve.get(gt).__webglTexture,nn,ws+ms)),re.blitFramebuffer(ur,cr,xn,ln,dr,Dr,xn,ln,re.DEPTH_BUFFER_BIT,re.NEAREST);De.bindFramebuffer(re.READ_FRAMEBUFFER,null),De.bindFramebuffer(re.DRAW_FRAMEBUFFER,null)}else if(St!==0||je.isRenderTargetTexture||ve.has(je)){const Gr=ve.get(je),$n=ve.get(gt);De.bindFramebuffer(re.READ_FRAMEBUFFER,ds),De.bindFramebuffer(re.DRAW_FRAMEBUFFER,ps);for(let Zi=0;Zi<Un;Zi++)ki?re.framebufferTextureLayer(re.READ_FRAMEBUFFER,re.COLOR_ATTACHMENT0,Gr.__webglTexture,St,Fn+Zi):re.framebufferTexture2D(re.READ_FRAMEBUFFER,re.COLOR_ATTACHMENT0,re.TEXTURE_2D,Gr.__webglTexture,St),kn?re.framebufferTextureLayer(re.DRAW_FRAMEBUFFER,re.COLOR_ATTACHMENT0,$n.__webglTexture,nn,ws+Zi):re.framebufferTexture2D(re.DRAW_FRAMEBUFFER,re.COLOR_ATTACHMENT0,re.TEXTURE_2D,$n.__webglTexture,nn),St!==0?re.blitFramebuffer(ur,cr,xn,ln,dr,Dr,xn,ln,re.COLOR_BUFFER_BIT,re.NEAREST):kn?re.copyTexSubImage3D(pr,nn,dr,Dr,ws+Zi,ur,cr,xn,ln):re.copyTexSubImage2D(pr,nn,dr,Dr,ur,cr,xn,ln);De.bindFramebuffer(re.READ_FRAMEBUFFER,null),De.bindFramebuffer(re.DRAW_FRAMEBUFFER,null)}else kn?je.isDataTexture||je.isData3DTexture?re.texSubImage3D(pr,nn,dr,Dr,ws,xn,ln,Un,Ur,rr,Ar.data):gt.isCompressedArrayTexture?re.compressedTexSubImage3D(pr,nn,dr,Dr,ws,xn,ln,Un,Ur,Ar.data):re.texSubImage3D(pr,nn,dr,Dr,ws,xn,ln,Un,Ur,rr,Ar):je.isDataTexture?re.texSubImage2D(re.TEXTURE_2D,nn,dr,Dr,xn,ln,Ur,rr,Ar.data):je.isCompressedTexture?re.compressedTexSubImage2D(re.TEXTURE_2D,nn,dr,Dr,Ar.width,Ar.height,Ur,Ar.data):re.texSubImage2D(re.TEXTURE_2D,nn,dr,Dr,xn,ln,Ur,rr,Ar);re.pixelStorei(re.UNPACK_ROW_LENGTH,un),re.pixelStorei(re.UNPACK_IMAGE_HEIGHT,Er),re.pixelStorei(re.UNPACK_SKIP_PIXELS,Co),re.pixelStorei(re.UNPACK_SKIP_ROWS,io),re.pixelStorei(re.UNPACK_SKIP_IMAGES,aa),nn===0&&gt.generateMipmaps&&re.generateMipmap(pr),De.unbindTexture()},this.copyTextureToTexture3D=function(je,gt,Pt=null,Dt=null,St=0){return _O('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(je,gt,Pt,Dt,St)},this.initRenderTarget=function(je){ve.get(je).__webglFramebuffer===void 0&&Ae.setupRenderTarget(je)},this.initTexture=function(je){je.isCubeTexture?Ae.setTextureCube(je,0):je.isData3DTexture?Ae.setTexture3D(je,0):je.isDataArrayTexture||je.isCompressedArrayTexture?Ae.setTexture2DArray(je,0):Ae.setTexture2D(je,0),De.unbindTexture()},this.resetState=function(){k=0,M=0,I=null,De.reset(),Ye.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return uv}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorSpace=xs._getDrawingBufferColorSpace(e),n.unpackColorSpace=xs._getUnpackColorSpace()}}var TD={exports:{}},wD={},RD={exports:{}},CD={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gz;function D1e(){if(Gz)return CD;Gz=1;var t=n3();function e(h,d){return h===d&&(h!==0||1/h===1/d)||h!==h&&d!==d}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,i=t.useEffect,s=t.useLayoutEffect,o=t.useDebugValue;function a(h,d){var m=d(),p=r({inst:{value:m,getSnapshot:d}}),g=p[0].inst,y=p[1];return s(function(){g.value=m,g.getSnapshot=d,c(g)&&y({inst:g})},[h,m,d]),i(function(){return c(g)&&y({inst:g}),h(function(){c(g)&&y({inst:g})})},[h]),o(m),m}function c(h){var d=h.getSnapshot;h=h.value;try{var m=d();return!n(h,m)}catch{return!0}}function l(h,d){return d()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:a;return CD.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,CD}var $z;function L1e(){return $z||($z=1,RD.exports=D1e()),RD.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wz;function U1e(){if(Wz)return wD;Wz=1;var t=n3(),e=L1e();function n(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var r=typeof Object.is=="function"?Object.is:n,i=e.useSyncExternalStore,s=t.useRef,o=t.useEffect,a=t.useMemo,c=t.useDebugValue;return wD.useSyncExternalStoreWithSelector=function(l,u,h,d,m){var p=s(null);if(p.current===null){var g={hasValue:!1,value:null};p.current=g}else g=p.current;p=a(function(){function v(k){if(!x){if(x=!0,E=k,k=d(k),m!==void 0&&g.hasValue){var M=g.value;if(m(M,k))return C=M}return C=k}if(M=C,r(E,k))return M;var I=d(k);return m!==void 0&&m(M,I)?(E=k,M):(E=k,C=I)}var x=!1,E,C,A=h===void 0?null:h;return[function(){return v(u())},A===null?void 0:function(){return v(A())}]},[u,h,d,m]);var y=i(l,p[0],p[1]);return o(function(){g.hasValue=!0,g.value=y},[y]),c(y),y},wD}var Kz;function B1e(){return Kz||(Kz=1,TD.exports=U1e()),TD.exports}var F1e=B1e();const j1e=su(F1e),Xz=t=>{let e;const n=new Set,r=(l,u)=>{const h=typeof l=="function"?l(e):l;if(!Object.is(h,e)){const d=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),n.forEach(m=>m(e,d))}},i=()=>e,a={setState:r,getState:i,getInitialState:()=>c,subscribe:l=>(n.add(l),()=>n.delete(l))},c=e=t(r,i,a);return a},c3=t=>t?Xz(t):Xz,{useSyncExternalStoreWithSelector:z1e}=j1e,H1e=t=>t;function q1e(t,e=H1e,n){const r=z1e(t.subscribe,t.getState,t.getInitialState,e,n);return zd.useDebugValue(r),r}const Yz=(t,e)=>{const n=c3(t),r=(i,s=e)=>q1e(n,i,s);return Object.assign(r,n),r},Ree=(t,e)=>t?Yz(t,e):Yz,V1e=t=>typeof t=="object"&&typeof t.then=="function",g1=[];function Cee(t,e,n=(r,i)=>r===i){if(t===e)return!0;if(!t||!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!n(t[i],e[i]))return!1;return!0}function Aee(t,e=null,n=!1,r={}){e===null&&(e=[t]);for(const s of g1)if(Cee(e,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!n)throw s.promise}const i={keys:e,equal:r.equal,remove:()=>{const s=g1.indexOf(i);s!==-1&&g1.splice(s,1)},promise:(V1e(t)?t:t(...e)).then(s=>{i.response=s,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(s=>i.error=s)};if(g1.push(i),!n)throw i.promise}const Mee=(t,e,n)=>Aee(t,e,!1,n),G1e=(t,e,n)=>void Aee(t,e,!0,n),$1e=t=>{if(t===void 0||t.length===0)g1.splice(0,g1.length);else{const e=g1.find(n=>Cee(t,n.keys,n.equal));e&&e.remove()}};var AD={exports:{}},MD={exports:{}},kD={exports:{}},OD={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zz;function W1e(){return Zz||(Zz=1,(function(t){function e(G,j){var q=G.length;G.push(j);e:for(;0<q;){var te=q-1>>>1,W=G[te];if(0<i(W,j))G[te]=j,G[q]=W,q=te;else break e}}function n(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var j=G[0],q=G.pop();if(q!==j){G[0]=q;e:for(var te=0,W=G.length,$=W>>>1;te<$;){var J=2*(te+1)-1,ne=G[J],ie=J+1,ae=G[ie];if(0>i(ne,q))ie<W&&0>i(ae,ne)?(G[te]=ae,G[ie]=q,te=ie):(G[te]=ne,G[J]=q,te=J);else if(ie<W&&0>i(ae,q))G[te]=ae,G[ie]=q,te=ie;else break e}}return j}function i(G,j){var q=G.sortIndex-j.sortIndex;return q!==0?q:G.id-j.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,h=null,d=3,m=!1,p=!1,g=!1,y=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;function E(G){for(var j=n(l);j!==null;){if(j.callback===null)r(l);else if(j.startTime<=G)r(l),j.sortIndex=j.expirationTime,e(c,j);else break;j=n(l)}}function C(G){if(g=!1,E(G),!p)if(n(c)!==null)p=!0,N();else{var j=n(l);j!==null&&X(C,j.startTime-G)}}var A=!1,k=-1,M=5,I=-1;function z(){return!(t.unstable_now()-I<M)}function H(){if(A){var G=t.unstable_now();I=G;var j=!0;try{e:{p=!1,g&&(g=!1,v(k),k=-1),m=!0;var q=d;try{t:{for(E(G),h=n(c);h!==null&&!(h.expirationTime>G&&z());){var te=h.callback;if(typeof te=="function"){h.callback=null,d=h.priorityLevel;var W=te(h.expirationTime<=G);if(G=t.unstable_now(),typeof W=="function"){h.callback=W,E(G),j=!0;break t}h===n(c)&&r(c),E(G)}else r(c);h=n(c)}if(h!==null)j=!0;else{var $=n(l);$!==null&&X(C,$.startTime-G),j=!1}}break e}finally{h=null,d=q,m=!1}j=void 0}}finally{j?K():A=!1}}}var K;if(typeof x=="function")K=function(){x(H)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,F=P.port2;P.port1.onmessage=H,K=function(){F.postMessage(null)}}else K=function(){y(H,0)};function N(){A||(A=!0,K())}function X(G,j){k=y(function(){G(t.unstable_now())},j)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(G){G.callback=null},t.unstable_continueExecution=function(){p||m||(p=!0,N())},t.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<G?Math.floor(1e3/G):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(G){switch(d){case 1:case 2:case 3:var j=3;break;default:j=d}var q=d;d=j;try{return G()}finally{d=q}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(G,j){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var q=d;d=G;try{return j()}finally{d=q}},t.unstable_scheduleCallback=function(G,j,q){var te=t.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?te+q:te):q=te,G){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=q+W,G={id:u++,callback:j,priorityLevel:G,startTime:q,expirationTime:W,sortIndex:-1},q>te?(G.sortIndex=q,e(l,G),n(c)===null&&G===n(l)&&(g?(v(k),k=-1):g=!0,X(C,q-te))):(G.sortIndex=W,e(c,G),p||m||(p=!0,N())),G},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(G){var j=d;return function(){var q=d;d=j;try{return G.apply(this,arguments)}finally{d=q}}}})(OD)),OD}var Jz;function kee(){return Jz||(Jz=1,kD.exports=W1e()),kD.exports}var Qz;function K1e(){return Qz||(Qz=1,(function(t){t.exports=function(e){function n(b,T,D,Z){return new Lg(b,T,D,Z)}function r(){}function i(b){var T="https://react.dev/errors/"+b;if(1<arguments.length){T+="?args[]="+encodeURIComponent(arguments[1]);for(var D=2;D<arguments.length;D++)T+="&args[]="+encodeURIComponent(arguments[D])}return"Minified React error #"+b+"; visit "+T+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(b){return b===null||typeof b!="object"?null:(b=Dc&&b[Dc]||b["@@iterator"],typeof b=="function"?b:null)}function o(b){if(b==null)return null;if(typeof b=="function")return b.$$typeof===Bg?null:b.displayName||b.name||null;if(typeof b=="string")return b;switch(b){case oo:return"Fragment";case pu:return"Portal";case Nc:return"Profiler";case Bs:return"StrictMode";case Pc:return"Suspense";case Rf:return"SuspenseList"}if(typeof b=="object")switch(b.$$typeof){case Oo:return(b.displayName||"Context")+".Provider";case Il:return(b._context.displayName||"Context")+".Consumer";case $u:var T=b.render;return b=b.displayName,b||(b=T.displayName||T.name||"",b=b!==""?"ForwardRef("+b+")":"ForwardRef"),b;case Nl:return T=b.displayName||null,T!==null?T:o(b.type)||"Memo";case Ma:T=b._payload,b=b._init;try{return o(b(T))}catch{}}return null}function a(b){if(_p===void 0)try{throw Error()}catch(D){var T=D.stack.trim().match(/\n( *(at )?)/);_p=T&&T[1]||"",Fg=-1<D.stack.indexOf(`
    at`)?" (<anonymous>)":-1<D.stack.indexOf("@")?"@unknown:0:0":""}return`
`+_p+b+Fg}function c(b,T){if(!b||Nm)return"";Nm=!0;var D=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var Z={DetermineComponentFrameRoot:function(){try{if(T){var Nn=function(){throw Error()};if(Object.defineProperty(Nn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Nn,[])}catch(Sr){var Dn=Sr}Reflect.construct(b,[],Nn)}else{try{Nn.call()}catch(Sr){Dn=Sr}b.call(Nn.prototype)}}else{try{throw Error()}catch(Sr){Dn=Sr}(Nn=b())&&typeof Nn.catch=="function"&&Nn.catch(function(){})}}catch(Sr){if(Sr&&Dn&&typeof Sr.stack=="string")return[Sr.stack,Dn.stack]}return[null,null]}};Z.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var oe=Object.getOwnPropertyDescriptor(Z.DetermineComponentFrameRoot,"name");oe&&oe.configurable&&Object.defineProperty(Z.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _e=Z.DetermineComponentFrameRoot(),$e=_e[0],ft=_e[1];if($e&&ft){var Ct=$e.split(`
`),Jt=ft.split(`
`);for(oe=Z=0;Z<Ct.length&&!Ct[Z].includes("DetermineComponentFrameRoot");)Z++;for(;oe<Jt.length&&!Jt[oe].includes("DetermineComponentFrameRoot");)oe++;if(Z===Ct.length||oe===Jt.length)for(Z=Ct.length-1,oe=Jt.length-1;1<=Z&&0<=oe&&Ct[Z]!==Jt[oe];)oe--;for(;1<=Z&&0<=oe;Z--,oe--)if(Ct[Z]!==Jt[oe]){if(Z!==1||oe!==1)do if(Z--,oe--,0>oe||Ct[Z]!==Jt[oe]){var mn=`
`+Ct[Z].replace(" at new "," at ");return b.displayName&&mn.includes("<anonymous>")&&(mn=mn.replace("<anonymous>",b.displayName)),mn}while(1<=Z&&0<=oe);break}}}finally{Nm=!1,Error.prepareStackTrace=D}return(D=b?b.displayName||b.name:"")?a(D):""}function l(b){switch(b.tag){case 26:case 27:case 5:return a(b.type);case 16:return a("Lazy");case 13:return a("Suspense");case 19:return a("SuspenseList");case 0:case 15:return b=c(b.type,!1),b;case 11:return b=c(b.type.render,!1),b;case 1:return b=c(b.type,!0),b;default:return""}}function u(b){try{var T="";do T+=l(b),b=b.return;while(b);return T}catch(D){return`
Error generating stack: `+D.message+`
`+D.stack}}function h(b){var T=b,D=b;if(b.alternate)for(;T.return;)T=T.return;else{b=T;do T=b,(T.flags&4098)!==0&&(D=T.return),b=T.return;while(b)}return T.tag===3?D:null}function d(b){if(h(b)!==b)throw Error(i(188))}function m(b){var T=b.alternate;if(!T){if(T=h(b),T===null)throw Error(i(188));return T!==b?null:b}for(var D=b,Z=T;;){var oe=D.return;if(oe===null)break;var _e=oe.alternate;if(_e===null){if(Z=oe.return,Z!==null){D=Z;continue}break}if(oe.child===_e.child){for(_e=oe.child;_e;){if(_e===D)return d(oe),b;if(_e===Z)return d(oe),T;_e=_e.sibling}throw Error(i(188))}if(D.return!==Z.return)D=oe,Z=_e;else{for(var $e=!1,ft=oe.child;ft;){if(ft===D){$e=!0,D=oe,Z=_e;break}if(ft===Z){$e=!0,Z=oe,D=_e;break}ft=ft.sibling}if(!$e){for(ft=_e.child;ft;){if(ft===D){$e=!0,D=_e,Z=oe;break}if(ft===Z){$e=!0,Z=_e,D=oe;break}ft=ft.sibling}if(!$e)throw Error(i(189))}}if(D.alternate!==Z)throw Error(i(190))}if(D.tag!==3)throw Error(i(188));return D.stateNode.current===D?b:T}function p(b){var T=b.tag;if(T===5||T===26||T===27||T===6)return b;for(b=b.child;b!==null;){if(T=p(b),T!==null)return T;b=b.sibling}return null}function g(b){var T=b.tag;if(T===5||T===26||T===27||T===6)return b;for(b=b.child;b!==null;){if(b.tag!==4&&(T=g(b),T!==null))return T;b=b.sibling}return null}function y(b){return{current:b}}function v(b){0>Cp||(b.current=Zg[Cp],Zg[Cp]=null,Cp--)}function x(b,T){Cp++,Zg[Cp]=b.current,b.current=T}function E(b){return b>>>=0,b===0?32:31-(Yo(b)/Jg|0)|0}function C(b){var T=b&42;if(T!==0)return T;switch(b&-b){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return b&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return b}}function A(b,T){var D=b.pendingLanes;if(D===0)return 0;var Z=0,oe=b.suspendedLanes,_e=b.pingedLanes,$e=b.warmLanes;b=b.finishedLanes!==0;var ft=D&134217727;return ft!==0?(D=ft&~oe,D!==0?Z=C(D):(_e&=ft,_e!==0?Z=C(_e):b||($e=ft&~$e,$e!==0&&(Z=C($e))))):(ft=D&~oe,ft!==0?Z=C(ft):_e!==0?Z=C(_e):b||($e=D&~$e,$e!==0&&(Z=C($e)))),Z===0?0:T!==0&&T!==Z&&(T&oe)===0&&(oe=Z&-Z,$e=T&-T,oe>=$e||oe===32&&($e&4194176)!==0)?T:Z}function k(b,T){return(b.pendingLanes&~(b.suspendedLanes&~b.pingedLanes)&T)===0}function M(b,T){switch(b){case 1:case 2:case 4:case 8:return T+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return T+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function I(){var b=ph;return ph<<=1,(ph&4194176)===0&&(ph=128),b}function z(){var b=Xm;return Xm<<=1,(Xm&62914560)===0&&(Xm=4194304),b}function H(b){for(var T=[],D=0;31>D;D++)T.push(b);return T}function K(b,T){b.pendingLanes|=T,T!==268435456&&(b.suspendedLanes=0,b.pingedLanes=0,b.warmLanes=0)}function P(b,T,D,Z,oe,_e){var $e=b.pendingLanes;b.pendingLanes=D,b.suspendedLanes=0,b.pingedLanes=0,b.warmLanes=0,b.expiredLanes&=D,b.entangledLanes&=D,b.errorRecoveryDisabledLanes&=D,b.shellSuspendCounter=0;var ft=b.entanglements,Ct=b.expirationTimes,Jt=b.hiddenUpdates;for(D=$e&~D;0<D;){var mn=31-Eo(D),Nn=1<<mn;ft[mn]=0,Ct[mn]=-1;var Dn=Jt[mn];if(Dn!==null)for(Jt[mn]=null,mn=0;mn<Dn.length;mn++){var Sr=Dn[mn];Sr!==null&&(Sr.lane&=-536870913)}D&=~Nn}Z!==0&&F(b,Z,0),_e!==0&&oe===0&&b.tag!==0&&(b.suspendedLanes|=_e&~($e&~T))}function F(b,T,D){b.pendingLanes|=T,b.suspendedLanes&=~T;var Z=31-Eo(T);b.entangledLanes|=T,b.entanglements[Z]=b.entanglements[Z]|1073741824|D&4194218}function N(b,T){var D=b.entangledLanes|=T;for(b=b.entanglements;D;){var Z=31-Eo(D),oe=1<<Z;oe&T|b[Z]&T&&(b[Z]|=T),D&=~oe}}function X(b){return b&=-b,2<b?8<b?(b&134217727)!==0?32:268435456:8:2}function G(b){if(Zs&&typeof Zs.onCommitFiberRoot=="function")try{Zs.onCommitFiberRoot(Ya,b,void 0,(b.current.flags&128)===128)}catch{}}function j(b){if(typeof Fs=="function"&&xd(b),Zs&&typeof Zs.setStrictMode=="function")try{Zs.setStrictMode(Ya,b)}catch{}}function q(b,T){return b===T&&(b!==0||1/b===1/T)||b!==b&&T!==T}function te(b,T){if(typeof b=="object"&&b!==null){var D=bs.get(b);return D!==void 0?D:(T={value:b,source:T,stack:u(T)},bs.set(b,T),T)}return{value:b,source:T,stack:u(T)}}function W(b,T){_r[Pi++]=Fl,_r[Pi++]=Js,Js=b,Fl=T}function $(b,T,D){di[Qs++]=cs,di[Qs++]=Qi,di[Qs++]=bu,bu=b;var Z=cs;b=Qi;var oe=32-Eo(Z)-1;Z&=~(1<<oe),D+=1;var _e=32-Eo(T)+oe;if(30<_e){var $e=oe-oe%5;_e=(Z&(1<<$e)-1).toString(32),Z>>=$e,oe-=$e,cs=1<<32-Eo(T)+oe|D<<oe|Z,Qi=_e+b}else cs=1<<_e|D<<oe|Z,Qi=b}function J(b){b.return!==null&&(W(b,1),$(b,1,0))}function ne(b){for(;b===Js;)Js=_r[--Pi],_r[Pi]=null,Fl=_r[--Pi],_r[Pi]=null;for(;b===bu;)bu=di[--Qs],di[Qs]=null,Qi=di[--Qs],di[Qs]=null,cs=di[--Qs],di[Qs]=null}function ie(b,T){x(zc,T),x(ao,b),x(si,null),b=_d(T),v(si),x(si,b)}function ae(){v(si),v(ao),v(zc)}function xe(b){b.memoizedState!==null&&x(yc,b);var T=si.current,D=p_(T,b.type);T!==D&&(x(ao,b),x(si,D))}function Ne(b){ao.current===b&&(v(si),v(ao)),yc.current===b&&(v(yc),sl?Zn._currentValue=Uc:Zn._currentValue2=Uc)}function Re(b){var T=Error(i(418,""));throw at(te(T,b)),Di}function Se(b,T){if(!gc)throw Error(i(175));T_(b.stateNode,b.type,b.memoizedProps,T,b)||Re(b)}function ze(b){for(Xn=b.return;Xn;)switch(Xn.tag){case 3:case 27:Wr=!0;return;case 5:case 13:Wr=!1;return;default:Xn=Xn.return}}function Be(b){if(!gc||b!==Xn)return!1;if(!An)return ze(b),An=!0,!1;var T=!1;if(Xo?b.tag!==3&&b.tag!==27&&(b.tag!==5||C_(b.type)&&!Cf(b.type,b.memoizedProps))&&(T=!0):b.tag!==3&&(b.tag!==5||C_(b.type)&&!Cf(b.type,b.memoizedProps))&&(T=!0),T&&Wn&&Re(b),ze(b),b.tag===13){if(!gc)throw Error(i(316));if(b=b.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(i(317));Wn=w_(b)}else Wn=Xn?Gm(b.stateNode):null;return!0}function Je(){gc&&(Wn=Xn=null,An=!1)}function at(b){eo===null?eo=[b]:eo.push(b)}function re(){for(var b=cl,T=ll=cl=0;T<b;){var D=al[T];al[T++]=null;var Z=al[T];al[T++]=null;var oe=al[T];al[T++]=null;var _e=al[T];if(al[T++]=null,Z!==null&&oe!==null){var $e=Z.pending;$e===null?oe.next=oe:(oe.next=$e.next,$e.next=oe),Z.pending=oe}_e!==0&&De(D,oe,_e)}}function Le(b,T,D,Z){al[cl++]=b,al[cl++]=T,al[cl++]=D,al[cl++]=Z,ll|=Z,b.lanes|=Z,b=b.alternate,b!==null&&(b.lanes|=Z)}function He(b,T,D,Z){return Le(b,T,D,Z),fe(b)}function Ue(b,T){return Le(b,null,null,T),fe(b)}function De(b,T,D){b.lanes|=D;var Z=b.alternate;Z!==null&&(Z.lanes|=D);for(var oe=!1,_e=b.return;_e!==null;)_e.childLanes|=D,Z=_e.alternate,Z!==null&&(Z.childLanes|=D),_e.tag===22&&(b=_e.stateNode,b===null||b._visibility&1||(oe=!0)),b=_e,_e=_e.return;oe&&T!==null&&b.tag===3&&(_e=b.stateNode,oe=31-Eo(D),_e=_e.hiddenUpdates,b=_e[oe],b===null?_e[oe]=[T]:b.push(T),T.lane=D|536870912)}function fe(b){if(50<dl)throw dl=0,Hl=null,Error(i(185));for(var T=b.return;T!==null;)b=T,T=b.return;return b.tag===3?b.stateNode:null}function ve(b){b!==Ap&&b.next===null&&(Ap===null?gh=Ap=b:Ap=Ap.next=b),Mp=!0,A_||(A_=!0,tt(pe))}function Ae(b,T){if(!Td&&Mp){Td=!0;do for(var D=!1,Z=gh;Z!==null;){if(b!==0){var oe=Z.pendingLanes;if(oe===0)var _e=0;else{var $e=Z.suspendedLanes,ft=Z.pingedLanes;_e=(1<<31-Eo(42|b)+1)-1,_e&=oe&~($e&~ft),_e=_e&201326677?_e&201326677|1:_e?_e|2:0}_e!==0&&(D=!0,Ze(Z,_e))}else _e=Bt,_e=A(Z,Z===Et?_e:0),(_e&3)===0||k(Z,_e)||(D=!0,Ze(Z,_e));Z=Z.next}while(D);Td=!1}}function pe(){Mp=A_=!1;var b=0;Zo!==0&&(hh()&&(b=Zo),Zo=0);for(var T=tr(),D=null,Z=gh;Z!==null;){var oe=Z.next,_e=Ge(Z,T);_e===0?(Z.next=null,D===null?gh=oe:D.next=oe,oe===null&&(Ap=D)):(D=Z,(b!==0||(_e&3)!==0)&&(Mp=!0)),Z=oe}Ae(b)}function Ge(b,T){for(var D=b.suspendedLanes,Z=b.pingedLanes,oe=b.expirationTimes,_e=b.pendingLanes&-62914561;0<_e;){var $e=31-Eo(_e),ft=1<<$e,Ct=oe[$e];Ct===-1?((ft&D)===0||(ft&Z)!==0)&&(oe[$e]=M(ft,T)):Ct<=T&&(b.expiredLanes|=ft),_e&=~ft}if(T=Et,D=Bt,D=A(b,b===T?D:0),Z=b.callbackNode,D===0||b===T&&It===2||b.cancelPendingCommit!==null)return Z!==null&&Z!==null&&ys(Z),b.callbackNode=null,b.callbackPriority=0;if((D&3)===0||k(b,D)){if(T=D&-D,T===b.callbackPriority)return T;switch(Z!==null&&ys(Z),X(D)){case 2:case 8:D=vc;break;case 32:D=ii;break;case 268435456:D=as;break;default:D=ii}return Z=Qe.bind(null,b),D=da(D,Z),b.callbackPriority=T,b.callbackNode=D,T}return Z!==null&&Z!==null&&ys(Z),b.callbackPriority=2,b.callbackNode=null,2}function Qe(b,T){var D=b.callbackNode;if(mc()&&b.callbackNode!==D)return null;var Z=Bt;return Z=A(b,b===Et?Z:0),Z===0?null:(Wo(b,Z,T),Ge(b,tr()),b.callbackNode!=null&&b.callbackNode===D?Qe.bind(null,b):null)}function Ze(b,T){if(mc())return null;Wo(b,T,!0)}function tt(b){yd?Bc(function(){(mt&6)!==0?da(ar,b):b()}):da(ar,b)}function Ft(){return Zo===0&&(Zo=I()),Zo}function bt(b,T){if(pa===null){var D=pa=[];Eu=0,ls=Ft(),Mr={status:"pending",value:void 0,then:function(Z){D.push(Z)}}}return Eu++,T.then(Mt,Mt),T}function Mt(){if(--Eu===0&&pa!==null){Mr!==null&&(Mr.status="fulfilled");var b=pa;pa=null,ls=0,Mr=null;for(var T=0;T<b.length;T++)(0,b[T])()}}function Ie(b,T){var D=[],Z={status:"pending",value:null,reason:null,then:function(oe){D.push(oe)}};return b.then(function(){Z.status="fulfilled",Z.value=T;for(var oe=0;oe<D.length;oe++)(0,D[oe])(T)},function(oe){for(Z.status="rejected",Z.reason=oe,oe=0;oe<D.length;oe++)(0,D[oe])(void 0)}),Z}function ce(b){b.updateQueue={baseState:b.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Q(b,T){b=b.updateQueue,T.updateQueue===b&&(T.updateQueue={baseState:b.baseState,firstBaseUpdate:b.firstBaseUpdate,lastBaseUpdate:b.lastBaseUpdate,shared:b.shared,callbacks:null})}function le(b){return{lane:b,tag:0,payload:null,callback:null,next:null}}function we(b,T,D){var Z=b.updateQueue;if(Z===null)return null;if(Z=Z.shared,(mt&2)!==0){var oe=Z.pending;return oe===null?T.next=T:(T.next=oe.next,oe.next=T),Z.pending=T,T=fe(b),De(b,null,D),T}return Le(b,Z,T,D),fe(b)}function Me(b,T,D){if(T=T.updateQueue,T!==null&&(T=T.shared,(D&4194176)!==0)){var Z=T.lanes;Z&=b.pendingLanes,D|=Z,T.lanes=D,N(b,D)}}function Te(b,T){var D=b.updateQueue,Z=b.alternate;if(Z!==null&&(Z=Z.updateQueue,D===Z)){var oe=null,_e=null;if(D=D.firstBaseUpdate,D!==null){do{var $e={lane:D.lane,tag:D.tag,payload:D.payload,callback:null,next:null};_e===null?oe=_e=$e:_e=_e.next=$e,D=D.next}while(D!==null);_e===null?oe=_e=T:_e=_e.next=T}else oe=_e=T;D={baseState:Z.baseState,firstBaseUpdate:oe,lastBaseUpdate:_e,shared:Z.shared,callbacks:Z.callbacks},b.updateQueue=D;return}b=D.lastBaseUpdate,b===null?D.firstBaseUpdate=T:b.next=T,D.lastBaseUpdate=T}function ye(){if(kp){var b=Mr;if(b!==null)throw b}}function Ye(b,T,D,Z){kp=!1;var oe=b.updateQueue;co=!1;var _e=oe.firstBaseUpdate,$e=oe.lastBaseUpdate,ft=oe.shared.pending;if(ft!==null){oe.shared.pending=null;var Ct=ft,Jt=Ct.next;Ct.next=null,$e===null?_e=Jt:$e.next=Jt,$e=Ct;var mn=b.alternate;mn!==null&&(mn=mn.updateQueue,ft=mn.lastBaseUpdate,ft!==$e&&(ft===null?mn.firstBaseUpdate=Jt:ft.next=Jt,mn.lastBaseUpdate=Ct))}if(_e!==null){var Nn=oe.baseState;$e=0,mn=Jt=Ct=null,ft=_e;do{var Dn=ft.lane&-536870913,Sr=Dn!==ft.lane;if(Sr?(Bt&Dn)===Dn:(Z&Dn)===Dn){Dn!==0&&Dn===ls&&(kp=!0),mn!==null&&(mn=mn.next={lane:0,tag:ft.tag,payload:ft.payload,callback:null,next:null});e:{var pl=b,Ip=ft;Dn=T;var Sh=D;switch(Ip.tag){case 1:if(pl=Ip.payload,typeof pl=="function"){Nn=pl.call(Sh,Nn,Dn);break e}Nn=pl;break e;case 3:pl.flags=pl.flags&-65537|128;case 0:if(pl=Ip.payload,Dn=typeof pl=="function"?pl.call(Sh,Nn,Dn):pl,Dn==null)break e;Nn=pd({},Nn,Dn);break e;case 2:co=!0}}Dn=ft.callback,Dn!==null&&(b.flags|=64,Sr&&(b.flags|=8192),Sr=oe.callbacks,Sr===null?oe.callbacks=[Dn]:Sr.push(Dn))}else Sr={lane:Dn,tag:ft.tag,payload:ft.payload,callback:ft.callback,next:null},mn===null?(Jt=mn=Sr,Ct=Nn):mn=mn.next=Sr,$e|=Dn;if(ft=ft.next,ft===null){if(ft=oe.shared.pending,ft===null)break;Sr=ft,ft=Sr.next,Sr.next=null,oe.lastBaseUpdate=Sr,oe.shared.pending=null}}while(!0);mn===null&&(Ct=Nn),oe.baseState=Ct,oe.firstBaseUpdate=Jt,oe.lastBaseUpdate=mn,_e===null&&(oe.shared.lanes=0),ir|=$e,b.lanes=$e,b.memoizedState=Nn}}function Pe(b,T){if(typeof b!="function")throw Error(i(191,b));b.call(T)}function We(b,T){var D=b.callbacks;if(D!==null)for(b.callbacks=null,b=0;b<D.length;b++)Pe(D[b],T)}function Ve(b,T){if(Ia(b,T))return!0;if(typeof b!="object"||b===null||typeof T!="object"||T===null)return!1;var D=Object.keys(b),Z=Object.keys(T);if(D.length!==Z.length)return!1;for(Z=0;Z<D.length;Z++){var oe=D[Z];if(!Wu.call(T,oe)||!Ia(b[oe],T[oe]))return!1}return!0}function Xe(b){return b=b.status,b==="fulfilled"||b==="rejected"}function lt(){}function qe(b,T,D){switch(D=b[D],D===void 0?b.push(T):D!==T&&(T.then(lt,lt),T=D),T.status){case"fulfilled":return T.value;case"rejected":throw b=T.reason,b===Ms?Error(i(483)):b;default:if(typeof T.status=="string")T.then(lt,lt);else{if(b=Et,b!==null&&100<b.shellSuspendCounter)throw Error(i(482));b=T,b.status="pending",b.then(function(Z){if(T.status==="pending"){var oe=T;oe.status="fulfilled",oe.value=Z}},function(Z){if(T.status==="pending"){var oe=T;oe.status="rejected",oe.reason=Z}})}switch(T.status){case"fulfilled":return T.value;case"rejected":throw b=T.reason,b===Ms?Error(i(483)):b}throw kf=T,Ms}}function rt(){if(kf===null)throw Error(i(459));var b=kf;return kf=null,b}function it(b){var T=Su;return Su+=1,jl===null&&(jl=[]),qe(jl,b,T)}function nt(b,T){T=T.props.ref,b.ref=T!==void 0?T:null}function ct(b,T){throw T.$$typeof===md?Error(i(525)):(b=Object.prototype.toString.call(T),Error(i(31,b==="[object Object]"?"object with keys {"+Object.keys(T).join(", ")+"}":b)))}function Qt(b){var T=b._init;return T(b._payload)}function tn(b){function T(Lt,Rt){if(b){var Vt=Lt.deletions;Vt===null?(Lt.deletions=[Rt],Lt.flags|=16):Vt.push(Rt)}}function D(Lt,Rt){if(!b)return null;for(;Rt!==null;)T(Lt,Rt),Rt=Rt.sibling;return null}function Z(Lt){for(var Rt=new Map;Lt!==null;)Lt.key!==null?Rt.set(Lt.key,Lt):Rt.set(Lt.index,Lt),Lt=Lt.sibling;return Rt}function oe(Lt,Rt){return Lt=Ca(Lt,Rt),Lt.index=0,Lt.sibling=null,Lt}function _e(Lt,Rt,Vt){return Lt.index=Vt,b?(Vt=Lt.alternate,Vt!==null?(Vt=Vt.index,Vt<Rt?(Lt.flags|=33554434,Rt):Vt):(Lt.flags|=33554434,Rt)):(Lt.flags|=1048576,Rt)}function $e(Lt){return b&&Lt.alternate===null&&(Lt.flags|=33554434),Lt}function ft(Lt,Rt,Vt,gn){return Rt===null||Rt.tag!==6?(Rt=gp(Vt,Lt.mode,gn),Rt.return=Lt,Rt):(Rt=oe(Rt,Vt),Rt.return=Lt,Rt)}function Ct(Lt,Rt,Vt,gn){var lr=Vt.type;return lr===oo?mn(Lt,Rt,Vt.props.children,gn,Vt.key):Rt!==null&&(Rt.elementType===lr||typeof lr=="object"&&lr!==null&&lr.$$typeof===Ma&&Qt(lr)===Rt.type)?(Rt=oe(Rt,Vt.props),nt(Rt,Vt),Rt.return=Lt,Rt):(Rt=pp(Vt.type,Vt.key,Vt.props,null,Lt.mode,gn),nt(Rt,Vt),Rt.return=Lt,Rt)}function Jt(Lt,Rt,Vt,gn){return Rt===null||Rt.tag!==4||Rt.stateNode.containerInfo!==Vt.containerInfo||Rt.stateNode.implementation!==Vt.implementation?(Rt=Ol(Vt,Lt.mode,gn),Rt.return=Lt,Rt):(Rt=oe(Rt,Vt.children||[]),Rt.return=Lt,Rt)}function mn(Lt,Rt,Vt,gn,lr){return Rt===null||Rt.tag!==7?(Rt=Vu(Vt,Lt.mode,gn,lr),Rt.return=Lt,Rt):(Rt=oe(Rt,Vt),Rt.return=Lt,Rt)}function Nn(Lt,Rt,Vt){if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number"||typeof Rt=="bigint")return Rt=gp(""+Rt,Lt.mode,Vt),Rt.return=Lt,Rt;if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case ua:return Vt=pp(Rt.type,Rt.key,Rt.props,null,Lt.mode,Vt),nt(Vt,Rt),Vt.return=Lt,Vt;case pu:return Rt=Ol(Rt,Lt.mode,Vt),Rt.return=Lt,Rt;case Ma:var gn=Rt._init;return Rt=gn(Rt._payload),Nn(Lt,Rt,Vt)}if(gd(Rt)||s(Rt))return Rt=Vu(Rt,Lt.mode,Vt,null),Rt.return=Lt,Rt;if(typeof Rt.then=="function")return Nn(Lt,it(Rt),Vt);if(Rt.$$typeof===Oo)return Nn(Lt,Yn(Lt,Rt),Vt);ct(Lt,Rt)}return null}function Dn(Lt,Rt,Vt,gn){var lr=Rt!==null?Rt.key:null;if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number"||typeof Vt=="bigint")return lr!==null?null:ft(Lt,Rt,""+Vt,gn);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case ua:return Vt.key===lr?Ct(Lt,Rt,Vt,gn):null;case pu:return Vt.key===lr?Jt(Lt,Rt,Vt,gn):null;case Ma:return lr=Vt._init,Vt=lr(Vt._payload),Dn(Lt,Rt,Vt,gn)}if(gd(Vt)||s(Vt))return lr!==null?null:mn(Lt,Rt,Vt,gn,null);if(typeof Vt.then=="function")return Dn(Lt,Rt,it(Vt),gn);if(Vt.$$typeof===Oo)return Dn(Lt,Rt,Yn(Lt,Vt),gn);ct(Lt,Vt)}return null}function Sr(Lt,Rt,Vt,gn,lr){if(typeof gn=="string"&&gn!==""||typeof gn=="number"||typeof gn=="bigint")return Lt=Lt.get(Vt)||null,ft(Rt,Lt,""+gn,lr);if(typeof gn=="object"&&gn!==null){switch(gn.$$typeof){case ua:return Lt=Lt.get(gn.key===null?Vt:gn.key)||null,Ct(Rt,Lt,gn,lr);case pu:return Lt=Lt.get(gn.key===null?Vt:gn.key)||null,Jt(Rt,Lt,gn,lr);case Ma:var Es=gn._init;return gn=Es(gn._payload),Sr(Lt,Rt,Vt,gn,lr)}if(gd(gn)||s(gn))return Lt=Lt.get(Vt)||null,mn(Rt,Lt,gn,lr,null);if(typeof gn.then=="function")return Sr(Lt,Rt,Vt,it(gn),lr);if(gn.$$typeof===Oo)return Sr(Lt,Rt,Vt,Yn(Rt,gn),lr);ct(Rt,gn)}return null}function pl(Lt,Rt,Vt,gn){for(var lr=null,Es=null,br=Rt,Ui=Rt=0,to=null;br!==null&&Ui<Vt.length;Ui++){br.index>Ui?(to=br,br=null):to=br.sibling;var $i=Dn(Lt,br,Vt[Ui],gn);if($i===null){br===null&&(br=to);break}b&&br&&$i.alternate===null&&T(Lt,br),Rt=_e($i,Rt,Ui),Es===null?lr=$i:Es.sibling=$i,Es=$i,br=to}if(Ui===Vt.length)return D(Lt,br),An&&W(Lt,Ui),lr;if(br===null){for(;Ui<Vt.length;Ui++)br=Nn(Lt,Vt[Ui],gn),br!==null&&(Rt=_e(br,Rt,Ui),Es===null?lr=br:Es.sibling=br,Es=br);return An&&W(Lt,Ui),lr}for(br=Z(br);Ui<Vt.length;Ui++)to=Sr(br,Lt,Ui,Vt[Ui],gn),to!==null&&(b&&to.alternate!==null&&br.delete(to.key===null?Ui:to.key),Rt=_e(to,Rt,Ui),Es===null?lr=to:Es.sibling=to,Es=to);return b&&br.forEach(function(Cd){return T(Lt,Cd)}),An&&W(Lt,Ui),lr}function Ip(Lt,Rt,Vt,gn){if(Vt==null)throw Error(i(151));for(var lr=null,Es=null,br=Rt,Ui=Rt=0,to=null,$i=Vt.next();br!==null&&!$i.done;Ui++,$i=Vt.next()){br.index>Ui?(to=br,br=null):to=br.sibling;var Cd=Dn(Lt,br,$i.value,gn);if(Cd===null){br===null&&(br=to);break}b&&br&&Cd.alternate===null&&T(Lt,br),Rt=_e(Cd,Rt,Ui),Es===null?lr=Cd:Es.sibling=Cd,Es=Cd,br=to}if($i.done)return D(Lt,br),An&&W(Lt,Ui),lr;if(br===null){for(;!$i.done;Ui++,$i=Vt.next())$i=Nn(Lt,$i.value,gn),$i!==null&&(Rt=_e($i,Rt,Ui),Es===null?lr=$i:Es.sibling=$i,Es=$i);return An&&W(Lt,Ui),lr}for(br=Z(br);!$i.done;Ui++,$i=Vt.next())$i=Sr(br,Lt,Ui,$i.value,gn),$i!==null&&(b&&$i.alternate!==null&&br.delete($i.key===null?Ui:$i.key),Rt=_e($i,Rt,Ui),Es===null?lr=$i:Es.sibling=$i,Es=$i);return b&&br.forEach(function(IE){return T(Lt,IE)}),An&&W(Lt,Ui),lr}function Sh(Lt,Rt,Vt,gn){if(typeof Vt=="object"&&Vt!==null&&Vt.type===oo&&Vt.key===null&&(Vt=Vt.props.children),typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case ua:e:{for(var lr=Vt.key;Rt!==null;){if(Rt.key===lr){if(lr=Vt.type,lr===oo){if(Rt.tag===7){D(Lt,Rt.sibling),gn=oe(Rt,Vt.props.children),gn.return=Lt,Lt=gn;break e}}else if(Rt.elementType===lr||typeof lr=="object"&&lr!==null&&lr.$$typeof===Ma&&Qt(lr)===Rt.type){D(Lt,Rt.sibling),gn=oe(Rt,Vt.props),nt(gn,Vt),gn.return=Lt,Lt=gn;break e}D(Lt,Rt);break}else T(Lt,Rt);Rt=Rt.sibling}Vt.type===oo?(gn=Vu(Vt.props.children,Lt.mode,gn,Vt.key),gn.return=Lt,Lt=gn):(gn=pp(Vt.type,Vt.key,Vt.props,null,Lt.mode,gn),nt(gn,Vt),gn.return=Lt,Lt=gn)}return $e(Lt);case pu:e:{for(lr=Vt.key;Rt!==null;){if(Rt.key===lr)if(Rt.tag===4&&Rt.stateNode.containerInfo===Vt.containerInfo&&Rt.stateNode.implementation===Vt.implementation){D(Lt,Rt.sibling),gn=oe(Rt,Vt.children||[]),gn.return=Lt,Lt=gn;break e}else{D(Lt,Rt);break}else T(Lt,Rt);Rt=Rt.sibling}gn=Ol(Vt,Lt.mode,gn),gn.return=Lt,Lt=gn}return $e(Lt);case Ma:return lr=Vt._init,Vt=lr(Vt._payload),Sh(Lt,Rt,Vt,gn)}if(gd(Vt))return pl(Lt,Rt,Vt,gn);if(s(Vt)){if(lr=s(Vt),typeof lr!="function")throw Error(i(150));return Vt=lr.call(Vt),Ip(Lt,Rt,Vt,gn)}if(typeof Vt.then=="function")return Sh(Lt,Rt,it(Vt),gn);if(Vt.$$typeof===Oo)return Sh(Lt,Rt,Yn(Lt,Vt),gn);ct(Lt,Vt)}return typeof Vt=="string"&&Vt!==""||typeof Vt=="number"||typeof Vt=="bigint"?(Vt=""+Vt,Rt!==null&&Rt.tag===6?(D(Lt,Rt.sibling),gn=oe(Rt,Vt),gn.return=Lt,Lt=gn):(D(Lt,Rt),gn=gp(Vt,Lt.mode,gn),gn.return=Lt,Lt=gn),$e(Lt)):D(Lt,Rt)}return function(Lt,Rt,Vt,gn){try{Su=0;var lr=Sh(Lt,Rt,Vt,gn);return jl=null,lr}catch(br){if(br===Ms)throw br;var Es=n(29,br,null,Lt.mode);return Es.lanes=gn,Es.return=Lt,Es}finally{}}}function Ot(b,T){b=On,x(Op,b),x(_h,T),On=b|T.baseLanes}function qt(){x(Op,On),x(_h,_h.current)}function vt(){On=Op.current,v(_h),v(Op)}function Kt(b){var T=b.alternate;x(So,So.current&1),x(ul,b),fl===null&&(T===null||_h.current!==null||T.memoizedState!==null)&&(fl=b)}function _n(b){if(b.tag===22){if(x(So,So.current),x(ul,b),fl===null){var T=b.alternate;T!==null&&T.memoizedState!==null&&(fl=b)}}else Wt()}function Wt(){x(So,So.current),x(ul,ul.current)}function dn(b){v(ul),fl===b&&(fl=null),v(So)}function Mn(b){for(var T=b;T!==null;){if(T.tag===13){var D=T.memoizedState;if(D!==null&&(D=D.dehydrated,D===null||Vm(D)||Vg(D)))return T}else if(T.tag===19&&T.memoizedProps.revealOrder!==void 0){if((T.flags&128)!==0)return T}else if(T.child!==null){T.child.return=T,T=T.child;continue}if(T===b)break;for(;T.sibling===null;){if(T.return===null||T.return===b)return null;T=T.return}T.sibling.return=T.return,T=T.sibling}return null}function Ln(){throw Error(i(321))}function is(b,T){if(T===null)return!1;for(var D=0;D<T.length&&D<b.length;D++)if(!Ia(b[D],T[D]))return!1;return!0}function ni(b,T,D,Z,oe,_e){return vh=_e,qr=T,T.memoizedState=null,T.updateQueue=null,T.lanes=0,yr.H=b===null||b.memoizedState===null?xu:ci,If=!1,_e=D(Z,oe),If=!1,yh&&(_e=Ps(T,D,Z,oe)),fi(b),_e}function fi(b){yr.H=ea;var T=kr!==null&&kr.next!==null;if(vh=0,Gs=kr=qr=null,zl=!1,Jo=0,xo=null,T)throw Error(i(300));b===null||ga||(b=b.dependencies,b!==null&&jn(b)&&(ga=!0))}function Ps(b,T,D,Z){qr=b;var oe=0;do{if(yh&&(xo=null),Jo=0,yh=!1,25<=oe)throw Error(i(301));if(oe+=1,Gs=kr=null,b.updateQueue!=null){var _e=b.updateQueue;_e.lastEffect=null,_e.events=null,_e.stores=null,_e.memoCache!=null&&(_e.memoCache.index=0)}yr.H=bh,_e=T(D,Z)}while(yh);return _e}function Ds(){var b=yr.H,T=b.useState()[0];return T=typeof T.then=="function"?Pt(T):T,b=b.useState()[0],(kr!==null?kr.memoizedState:null)!==b&&(qr.flags|=1024),T}function zi(){var b=Ym!==0;return Ym=0,b}function ds(b,T,D){T.updateQueue=b.updateQueue,T.flags&=-2053,b.lanes&=~D}function ps(b){if(zl){for(b=b.memoizedState;b!==null;){var T=b.queue;T!==null&&(T.pending=null),b=b.next}zl=!1}vh=0,Gs=kr=qr=null,yh=!1,Jo=Ym=0,xo=null}function je(){var b={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Gs===null?qr.memoizedState=Gs=b:Gs=Gs.next=b,Gs}function gt(){if(kr===null){var b=qr.alternate;b=b!==null?b.memoizedState:null}else b=kr.next;var T=Gs===null?qr.memoizedState:Gs.next;if(T!==null)Gs=T,kr=b;else{if(b===null)throw qr.alternate===null?Error(i(467)):Error(i(310));kr=b,b={memoizedState:kr.memoizedState,baseState:kr.baseState,baseQueue:kr.baseQueue,queue:kr.queue,next:null},Gs===null?qr.memoizedState=Gs=b:Gs=Gs.next=b}return Gs}function Pt(b){var T=Jo;return Jo+=1,xo===null&&(xo=[]),b=qe(xo,b,T),T=qr,(Gs===null?T.memoizedState:Gs.next)===null&&(T=T.alternate,yr.H=T===null||T.memoizedState===null?xu:ci),b}function Dt(b){if(b!==null&&typeof b=="object"){if(typeof b.then=="function")return Pt(b);if(b.$$typeof===Oo)return qs(b)}throw Error(i(438,String(b)))}function St(b){var T=null,D=qr.updateQueue;if(D!==null&&(T=D.memoCache),T==null){var Z=qr.alternate;Z!==null&&(Z=Z.updateQueue,Z!==null&&(Z=Z.memoCache,Z!=null&&(T={data:Z.data.map(function(oe){return oe.slice()}),index:0})))}if(T==null&&(T={data:[],index:0}),D===null&&(D=Za(),qr.updateQueue=D),D.memoCache=T,D=T.data[T.index],D===void 0)for(D=T.data[T.index]=Array(b),Z=0;Z<b;Z++)D[Z]=gu;return T.index++,D}function nn(b,T){return typeof T=="function"?T(b):T}function xn(b){var T=gt();return ln(T,kr,b)}function ln(b,T,D){var Z=b.queue;if(Z===null)throw Error(i(311));Z.lastRenderedReducer=D;var oe=b.baseQueue,_e=Z.pending;if(_e!==null){if(oe!==null){var $e=oe.next;oe.next=_e.next,_e.next=$e}T.baseQueue=oe=_e,Z.pending=null}if(_e=b.baseState,oe===null)b.memoizedState=_e;else{T=oe.next;var ft=$e=null,Ct=null,Jt=T,mn=!1;do{var Nn=Jt.lane&-536870913;if(Nn!==Jt.lane?(Bt&Nn)===Nn:(vh&Nn)===Nn){var Dn=Jt.revertLane;if(Dn===0)Ct!==null&&(Ct=Ct.next={lane:0,revertLane:0,action:Jt.action,hasEagerState:Jt.hasEagerState,eagerState:Jt.eagerState,next:null}),Nn===ls&&(mn=!0);else if((vh&Dn)===Dn){Jt=Jt.next,Dn===ls&&(mn=!0);continue}else Nn={lane:0,revertLane:Jt.revertLane,action:Jt.action,hasEagerState:Jt.hasEagerState,eagerState:Jt.eagerState,next:null},Ct===null?(ft=Ct=Nn,$e=_e):Ct=Ct.next=Nn,qr.lanes|=Dn,ir|=Dn;Nn=Jt.action,If&&D(_e,Nn),_e=Jt.hasEagerState?Jt.eagerState:D(_e,Nn)}else Dn={lane:Nn,revertLane:Jt.revertLane,action:Jt.action,hasEagerState:Jt.hasEagerState,eagerState:Jt.eagerState,next:null},Ct===null?(ft=Ct=Dn,$e=_e):Ct=Ct.next=Dn,qr.lanes|=Nn,ir|=Nn;Jt=Jt.next}while(Jt!==null&&Jt!==T);if(Ct===null?$e=_e:Ct.next=ft,!Ia(_e,b.memoizedState)&&(ga=!0,mn&&(D=Mr,D!==null)))throw D;b.memoizedState=_e,b.baseState=$e,b.baseQueue=Ct,Z.lastRenderedState=_e}return oe===null&&(Z.lanes=0),[b.memoizedState,Z.dispatch]}function Un(b){var T=gt(),D=T.queue;if(D===null)throw Error(i(311));D.lastRenderedReducer=b;var Z=D.dispatch,oe=D.pending,_e=T.memoizedState;if(oe!==null){D.pending=null;var $e=oe=oe.next;do _e=b(_e,$e.action),$e=$e.next;while($e!==oe);Ia(_e,T.memoizedState)||(ga=!0),T.memoizedState=_e,T.baseQueue===null&&(T.baseState=_e),D.lastRenderedState=_e}return[_e,Z]}function ur(b,T,D){var Z=qr,oe=gt(),_e=An;if(_e){if(D===void 0)throw Error(i(407));D=D()}else D=T();var $e=!Ia((kr||oe).memoizedState,D);if($e&&(oe.memoizedState=D,ga=!0),oe=oe.queue,np(dr.bind(null,Z,oe,b),[b]),oe.getSnapshot!==T||$e||Gs!==null&&Gs.memoizedState.tag&1){if(Z.flags|=2048,za(9,Fn.bind(null,Z,oe,D,T),{destroy:void 0},null),Et===null)throw Error(i(349));_e||(vh&60)!==0||cr(Z,T,D)}return D}function cr(b,T,D){b.flags|=16384,b={getSnapshot:T,value:D},T=qr.updateQueue,T===null?(T=Za(),qr.updateQueue=T,T.stores=[b]):(D=T.stores,D===null?T.stores=[b]:D.push(b))}function Fn(b,T,D,Z){T.value=D,T.getSnapshot=Z,Dr(T)&&ws(b)}function dr(b,T,D){return D(function(){Dr(T)&&ws(b)})}function Dr(b){var T=b.getSnapshot;b=b.value;try{var D=T();return!Ia(b,D)}catch{return!0}}function ws(b){var T=Ue(b,2);T!==null&&la(T,b,2)}function Ar(b){var T=je();if(typeof b=="function"){var D=b;if(b=D(),If){j(!0);try{D()}finally{j(!1)}}}return T.memoizedState=T.baseState=b,T.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:nn,lastRenderedState:b},T}function Ur(b,T,D,Z){return b.baseState=D,ln(b,kr,typeof Z=="function"?Z:nn)}function rr(b,T,D,Z,oe){if(pf(b))throw Error(i(485));if(b=T.action,b!==null){var _e={payload:oe,action:b,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function($e){_e.listeners.push($e)}};yr.T!==null?D(!0):_e.isTransition=!1,Z(_e),D=T.pending,D===null?(_e.next=T.pending=_e,pr(T,_e)):(_e.next=D.next,T.pending=D.next=_e)}}function pr(b,T){var D=T.action,Z=T.payload,oe=b.state;if(T.isTransition){var _e=yr.T,$e={};yr.T=$e;try{var ft=D(oe,Z),Ct=yr.S;Ct!==null&&Ct($e,ft),un(b,T,ft)}catch(Jt){Co(b,T,Jt)}finally{yr.T=_e}}else try{_e=D(oe,Z),un(b,T,_e)}catch(Jt){Co(b,T,Jt)}}function un(b,T,D){D!==null&&typeof D=="object"&&typeof D.then=="function"?D.then(function(Z){Er(b,T,Z)},function(Z){return Co(b,T,Z)}):Er(b,T,D)}function Er(b,T,D){T.status="fulfilled",T.value=D,io(T),b.state=D,T=b.pending,T!==null&&(D=T.next,D===T?b.pending=null:(D=D.next,T.next=D,pr(b,D)))}function Co(b,T,D){var Z=b.pending;if(b.pending=null,Z!==null){Z=Z.next;do T.status="rejected",T.reason=D,io(T),T=T.next;while(T!==Z)}b.action=null}function io(b){b=b.listeners;for(var T=0;T<b.length;T++)(0,b[T])()}function aa(b,T){return T}function ki(b,T){if(An){var D=Et.formState;if(D!==null){e:{var Z=qr;if(An){if(Wn){var oe=Gg(Wn,Wr);if(oe){Wn=Gm(oe),Z=Qv(oe);break e}}Re(Z)}Z=!1}Z&&(T=D[0])}}D=je(),D.memoizedState=D.baseState=T,Z={pending:null,lanes:0,dispatch:null,lastRenderedReducer:aa,lastRenderedState:T},D.queue=Z,D=vo.bind(null,qr,Z),Z.dispatch=D,Z=Ar(!1);var _e=lu.bind(null,qr,!1,Z.queue);return Z=je(),oe={state:T,dispatch:null,action:b,pending:null},Z.queue=oe,D=rr.bind(null,qr,oe,_e,D),oe.dispatch=D,Z.memoizedState=b,[T,D,!1]}function kn(b){var T=gt();return Gr(T,kr,b)}function Gr(b,T,D){T=ln(b,T,aa)[0],b=xn(nn)[0],T=typeof T=="object"&&T!==null&&typeof T.then=="function"?Pt(T):T;var Z=gt(),oe=Z.queue,_e=oe.dispatch;return D!==Z.memoizedState&&(qr.flags|=2048,za(9,$n.bind(null,oe,D),{destroy:void 0},null)),[T,_e,b]}function $n(b,T){b.action=T}function Zi(b){var T=gt(),D=kr;if(D!==null)return Gr(T,D,b);gt(),T=T.memoizedState,D=gt();var Z=D.queue.dispatch;return D.memoizedState=b,[T,Z,!1]}function za(b,T,D,Z){return b={tag:b,create:T,inst:D,deps:Z,next:null},T=qr.updateQueue,T===null&&(T=Za(),qr.updateQueue=T),D=T.lastEffect,D===null?T.lastEffect=b.next=b:(Z=D.next,D.next=b,b.next=Z,T.lastEffect=b),b}function ms(){return gt().memoizedState}function Rs(b,T,D,Z){var oe=je();qr.flags|=b,oe.memoizedState=za(1|T,D,{destroy:void 0},Z===void 0?null:Z)}function th(b,T,D,Z){var oe=gt();Z=Z===void 0?null:Z;var _e=oe.memoizedState.inst;kr!==null&&Z!==null&&is(Z,kr.memoizedState.deps)?oe.memoizedState=za(T,D,_e,Z):(qr.flags|=b,oe.memoizedState=za(1|T,D,_e,Z))}function mm(b,T){Rs(8390656,8,b,T)}function np(b,T){th(2048,8,b,T)}function rp(b,T){return th(4,2,b,T)}function od(b,T){return th(4,4,b,T)}function Ha(b,T){if(typeof T=="function"){b=b();var D=T(b);return function(){typeof D=="function"?D():T(null)}}if(T!=null)return b=b(),T.current=b,function(){T.current=null}}function Mc(b,T,D){D=D!=null?D.concat([b]):null,th(4,4,Ha.bind(null,T,b),D)}function lc(){}function kc(b,T){var D=gt();T=T===void 0?null:T;var Z=D.memoizedState;return T!==null&&is(T,Z[1])?Z[0]:(D.memoizedState=[b,T],b)}function gm(b,T){var D=gt();T=T===void 0?null:T;var Z=D.memoizedState;if(T!==null&&is(T,Z[1]))return Z[0];if(Z=b(),If){j(!0);try{b()}finally{j(!1)}}return D.memoizedState=[Z,T],Z}function Xc(b,T,D){return D===void 0||(vh&1073741824)!==0?b.memoizedState=T:(b.memoizedState=D,b=cp(),qr.lanes|=b,ir|=b,D)}function Yc(b,T,D,Z){return Ia(D,T)?D:_h.current!==null?(b=Xc(b,D,Z),Ia(b,T)||(ga=!0),b):(vh&42)===0?(ga=!0,b.memoizedState=D):(b=cp(),qr.lanes|=b,ir|=b,T)}function nh(b,T,D,Z,oe){var _e=bo();vs(_e!==0&&8>_e?_e:8);var $e=yr.T,ft={};yr.T=ft,lu(b,!1,T,D);try{var Ct=oe(),Jt=yr.S;if(Jt!==null&&Jt(ft,Ct),Ct!==null&&typeof Ct=="object"&&typeof Ct.then=="function"){var mn=Ie(Ct,Z);cu(b,T,mn,$o(b))}else cu(b,T,Z,$o(b))}catch(Nn){cu(b,T,{then:function(){},status:"rejected",reason:Nn},$o())}finally{vs(_e),yr.T=$e}}function gs(b){var T=b.memoizedState;if(T!==null)return T;T={memoizedState:Uc,baseState:Uc,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:nn,lastRenderedState:Uc},next:null};var D={};return T.next={memoizedState:D,baseState:D,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:nn,lastRenderedState:D},next:null},b.memoizedState=T,b=b.alternate,b!==null&&(b.memoizedState=T),T}function xi(){return qs(Zn)}function au(){return gt().memoizedState}function kg(){return gt().memoizedState}function s_(b){for(var T=b.return;T!==null;){switch(T.tag){case 24:case 3:var D=$o();b=le(D);var Z=we(T,b,D);Z!==null&&(la(Z,T,D),Me(Z,T,D)),T={cache:Sm()},b.payload=T;return}T=T.return}}function Zc(b,T,D){var Z=$o();D={lane:Z,revertLane:0,action:D,hasEagerState:!1,eagerState:null,next:null},pf(b)?Oc(T,D):(D=He(b,T,D,Z),D!==null&&(la(D,b,Z),_m(D,T,Z)))}function vo(b,T,D){var Z=$o();cu(b,T,D,Z)}function cu(b,T,D,Z){var oe={lane:Z,revertLane:0,action:D,hasEagerState:!1,eagerState:null,next:null};if(pf(b))Oc(T,oe);else{var _e=b.alternate;if(b.lanes===0&&(_e===null||_e.lanes===0)&&(_e=T.lastRenderedReducer,_e!==null))try{var $e=T.lastRenderedState,ft=_e($e,D);if(oe.hasEagerState=!0,oe.eagerState=ft,Ia(ft,$e))return Le(b,T,oe,0),Et===null&&re(),!1}catch{}finally{}if(D=He(b,T,oe,Z),D!==null)return la(D,b,Z),_m(D,T,Z),!0}return!1}function lu(b,T,D,Z){if(Z={lane:2,revertLane:Ft(),action:Z,hasEagerState:!1,eagerState:null,next:null},pf(b)){if(T)throw Error(i(479))}else T=He(b,D,Z,2),T!==null&&la(T,b,2)}function pf(b){var T=b.alternate;return b===qr||T!==null&&T===qr}function Oc(b,T){yh=zl=!0;var D=b.pending;D===null?T.next=T:(T.next=D.next,D.next=T),b.pending=T}function _m(b,T,D){if((D&4194176)!==0){var Z=T.lanes;Z&=b.pendingLanes,D|=Z,T.lanes=D,N(b,D)}}function ad(b,T,D,Z){T=b.memoizedState,D=D(Z,T),D=D==null?T:pd({},T,D),b.memoizedState=D,b.lanes===0&&(b.updateQueue.baseState=D)}function ip(b,T,D,Z,oe,_e,$e){return b=b.stateNode,typeof b.shouldComponentUpdate=="function"?b.shouldComponentUpdate(Z,_e,$e):T.prototype&&T.prototype.isPureReactComponent?!Ve(D,Z)||!Ve(oe,_e):!0}function vm(b,T,D,Z){b=T.state,typeof T.componentWillReceiveProps=="function"&&T.componentWillReceiveProps(D,Z),typeof T.UNSAFE_componentWillReceiveProps=="function"&&T.UNSAFE_componentWillReceiveProps(D,Z),T.state!==b&&M_.enqueueReplaceState(T,T.state,null)}function Du(b,T){var D=T;if("ref"in T){D={};for(var Z in T)Z!=="ref"&&(D[Z]=T[Z])}if(b=b.defaultProps){D===T&&(D=pd({},D));for(var oe in b)D[oe]===void 0&&(D[oe]=b[oe])}return D}function mf(b,T){try{var D=b.onUncaughtError;D(T.value,{componentStack:T.stack})}catch(Z){setTimeout(function(){throw Z})}}function sp(b,T,D){try{var Z=b.onCaughtError;Z(D.value,{componentStack:D.stack,errorBoundary:T.tag===1?T.stateNode:null})}catch(oe){setTimeout(function(){throw oe})}}function wa(b,T,D){return D=le(D),D.tag=3,D.payload={element:null},D.callback=function(){mf(b,T)},D}function qa(b){return b=le(b),b.tag=3,b}function rh(b,T,D,Z){var oe=D.type.getDerivedStateFromError;if(typeof oe=="function"){var _e=Z.value;b.payload=function(){return oe(_e)},b.callback=function(){sp(T,D,Z)}}var $e=D.stateNode;$e!==null&&typeof $e.componentDidCatch=="function"&&(b.callback=function(){sp(T,D,Z),typeof oe!="function"&&(es===null?es=new Set([this]):es.add(this));var ft=Z.stack;this.componentDidCatch(Z.value,{componentStack:ft!==null?ft:""})})}function op(b,T,D,Z,oe){if(D.flags|=32768,Z!==null&&typeof Z=="object"&&typeof Z.then=="function"){if(T=D.alternate,T!==null&&Lu(T,D,oe,!0),D=ul.current,D!==null){switch(D.tag){case 13:return fl===null?Qr():D.alternate===null&&bn===0&&(bn=3),D.flags&=-257,D.flags|=65536,D.lanes=oe,Z===wd?D.flags|=16384:(T=D.updateQueue,T===null?D.updateQueue=new Set([Z]):T.add(Z),qu(b,Z,oe)),!1;case 22:return D.flags|=65536,Z===wd?D.flags|=16384:(T=D.updateQueue,T===null?(T={transitions:null,markerInstances:null,retryQueue:new Set([Z])},D.updateQueue=T):(D=T.retryQueue,D===null?T.retryQueue=new Set([Z]):D.add(Z)),qu(b,Z,oe)),!1}throw Error(i(435,D.tag))}return qu(b,Z,oe),Qr(),!1}if(An)return T=ul.current,T!==null?((T.flags&65536)===0&&(T.flags|=256),T.flags|=65536,T.lanes=oe,Z!==Di&&(b=Error(i(422),{cause:Z}),at(te(b,D)))):(Z!==Di&&(T=Error(i(423),{cause:Z}),at(te(T,D))),b=b.current.alternate,b.flags|=65536,oe&=-oe,b.lanes|=oe,Z=te(Z,D),oe=wa(b.stateNode,Z,oe),Te(b,oe),bn!==4&&(bn=2)),!1;var _e=Error(i(520),{cause:Z});if(_e=te(_e,D),pi===null?pi=[_e]:pi.push(_e),bn!==4&&(bn=2),T===null)return!0;Z=te(Z,D),D=T;do{switch(D.tag){case 3:return D.flags|=65536,b=oe&-oe,D.lanes|=b,b=wa(D.stateNode,Z,b),Te(D,b),!1;case 1:if(T=D.type,_e=D.stateNode,(D.flags&128)===0&&(typeof T.getDerivedStateFromError=="function"||_e!==null&&typeof _e.componentDidCatch=="function"&&(es===null||!es.has(_e))))return D.flags|=65536,oe&=-oe,D.lanes|=oe,oe=qa(oe),rh(oe,b,D,Z),Te(D,oe),!1}D=D.return}while(D!==null);return!1}function Ho(b,T,D,Z){T.child=b===null?Qg(T,null,D,Z):Of(T,b.child,D,Z)}function o_(b,T,D,Z,oe){D=D.render;var _e=T.ref;if("ref"in Z){var $e={};for(var ft in Z)ft!=="ref"&&($e[ft]=Z[ft])}else $e=Z;return Ic(T),Z=ni(b,T,D,$e,_e,oe),ft=zi(),b!==null&&!ga?(ds(b,T,oe),Cn(b,T,oe)):(An&&ft&&J(T),T.flags|=1,Ho(b,T,Z,oe),T.child)}function Xv(b,T,D,Z,oe){if(b===null){var _e=D.type;return typeof _e=="function"&&!hp(_e)&&_e.defaultProps===void 0&&D.compare===null?(T.tag=15,T.type=_e,Yv(b,T,_e,Z,oe)):(b=pp(D.type,null,Z,T,T.mode,oe),b.ref=T.ref,b.return=T,T.child=b)}if(_e=b.child,!$r(b,oe)){var $e=_e.memoizedProps;if(D=D.compare,D=D!==null?D:Ve,D($e,Z)&&b.ref===T.ref)return Cn(b,T,oe)}return T.flags|=1,b=Ca(_e,Z),b.ref=T.ref,b.return=T,T.child=b}function Yv(b,T,D,Z,oe){if(b!==null){var _e=b.memoizedProps;if(Ve(_e,Z)&&b.ref===T.ref)if(ga=!1,T.pendingProps=Z=_e,$r(b,oe))(b.flags&131072)!==0&&(ga=!0);else return T.lanes=b.lanes,Cn(b,T,oe)}return uu(b,T,D,Z,oe)}function cd(b,T,D){var Z=T.pendingProps,oe=Z.children,_e=(T.stateNode._pendingVisibility&2)!==0,$e=b!==null?b.memoizedState:null;if(_f(b,T),Z.mode==="hidden"||_e){if((T.flags&128)!==0){if(Z=$e!==null?$e.baseLanes|D:D,b!==null){for(oe=T.child=b.child,_e=0;oe!==null;)_e=_e|oe.lanes|oe.childLanes,oe=oe.sibling;T.childLanes=_e&~Z}else T.childLanes=0,T.child=null;return gf(b,T,Z,D)}if((D&536870912)!==0)T.memoizedState={baseLanes:0,cachePool:null},b!==null&&Ra(T,$e!==null?$e.cachePool:null),$e!==null?Ot(T,$e):qt(),_n(T);else return T.lanes=T.childLanes=536870912,gf(b,T,$e!==null?$e.baseLanes|D:D,D)}else $e!==null?(Ra(T,$e.cachePool),Ot(T,$e),Wt(),T.memoizedState=null):(b!==null&&Ra(T,null),qt(),Wt());return Ho(b,T,oe,D),T.child}function gf(b,T,D,Z){var oe=a_();return oe=oe===null?null:{parent:sl?Y._currentValue:Y._currentValue2,pool:oe},T.memoizedState={baseLanes:D,cachePool:oe},b!==null&&Ra(T,null),qt(),_n(T),b!==null&&Lu(b,T,Z,!0),null}function _f(b,T){var D=T.ref;if(D===null)b!==null&&b.ref!==null&&(T.flags|=2097664);else{if(typeof D!="function"&&typeof D!="object")throw Error(i(284));(b===null||b.ref!==D)&&(T.flags|=2097664)}}function uu(b,T,D,Z,oe){return Ic(T),D=ni(b,T,D,Z,void 0,oe),Z=zi(),b!==null&&!ga?(ds(b,T,oe),Cn(b,T,oe)):(An&&Z&&J(T),T.flags|=1,Ho(b,T,D,oe),T.child)}function Cl(b,T,D,Z,oe,_e){return Ic(T),T.updateQueue=null,D=Ps(T,Z,D,oe),fi(b),Z=zi(),b!==null&&!ga?(ds(b,T,_e),Cn(b,T,_e)):(An&&Z&&J(T),T.flags|=1,Ho(b,T,D,_e),T.child)}function ym(b,T,D,Z,oe){if(Ic(T),T.stateNode===null){var _e=Mf,$e=D.contextType;typeof $e=="object"&&$e!==null&&(_e=qs($e)),_e=new D(Z,_e),T.memoizedState=_e.state!==null&&_e.state!==void 0?_e.state:null,_e.updater=M_,T.stateNode=_e,_e._reactInternals=T,_e=T.stateNode,_e.props=Z,_e.state=T.memoizedState,_e.refs={},ce(T),$e=D.contextType,_e.context=typeof $e=="object"&&$e!==null?qs($e):Mf,_e.state=T.memoizedState,$e=D.getDerivedStateFromProps,typeof $e=="function"&&(ad(T,D,$e,Z),_e.state=T.memoizedState),typeof D.getDerivedStateFromProps=="function"||typeof _e.getSnapshotBeforeUpdate=="function"||typeof _e.UNSAFE_componentWillMount!="function"&&typeof _e.componentWillMount!="function"||($e=_e.state,typeof _e.componentWillMount=="function"&&_e.componentWillMount(),typeof _e.UNSAFE_componentWillMount=="function"&&_e.UNSAFE_componentWillMount(),$e!==_e.state&&M_.enqueueReplaceState(_e,_e.state,null),Ye(T,Z,_e,oe),ye(),_e.state=T.memoizedState),typeof _e.componentDidMount=="function"&&(T.flags|=4194308),Z=!0}else if(b===null){_e=T.stateNode;var ft=T.memoizedProps,Ct=Du(D,ft);_e.props=Ct;var Jt=_e.context,mn=D.contextType;$e=Mf,typeof mn=="object"&&mn!==null&&($e=qs(mn));var Nn=D.getDerivedStateFromProps;mn=typeof Nn=="function"||typeof _e.getSnapshotBeforeUpdate=="function",ft=T.pendingProps!==ft,mn||typeof _e.UNSAFE_componentWillReceiveProps!="function"&&typeof _e.componentWillReceiveProps!="function"||(ft||Jt!==$e)&&vm(T,_e,Z,$e),co=!1;var Dn=T.memoizedState;_e.state=Dn,Ye(T,Z,_e,oe),ye(),Jt=T.memoizedState,ft||Dn!==Jt||co?(typeof Nn=="function"&&(ad(T,D,Nn,Z),Jt=T.memoizedState),(Ct=co||ip(T,D,Ct,Z,Dn,Jt,$e))?(mn||typeof _e.UNSAFE_componentWillMount!="function"&&typeof _e.componentWillMount!="function"||(typeof _e.componentWillMount=="function"&&_e.componentWillMount(),typeof _e.UNSAFE_componentWillMount=="function"&&_e.UNSAFE_componentWillMount()),typeof _e.componentDidMount=="function"&&(T.flags|=4194308)):(typeof _e.componentDidMount=="function"&&(T.flags|=4194308),T.memoizedProps=Z,T.memoizedState=Jt),_e.props=Z,_e.state=Jt,_e.context=$e,Z=Ct):(typeof _e.componentDidMount=="function"&&(T.flags|=4194308),Z=!1)}else{_e=T.stateNode,Q(b,T),$e=T.memoizedProps,mn=Du(D,$e),_e.props=mn,Nn=T.pendingProps,Dn=_e.context,Jt=D.contextType,Ct=Mf,typeof Jt=="object"&&Jt!==null&&(Ct=qs(Jt)),ft=D.getDerivedStateFromProps,(Jt=typeof ft=="function"||typeof _e.getSnapshotBeforeUpdate=="function")||typeof _e.UNSAFE_componentWillReceiveProps!="function"&&typeof _e.componentWillReceiveProps!="function"||($e!==Nn||Dn!==Ct)&&vm(T,_e,Z,Ct),co=!1,Dn=T.memoizedState,_e.state=Dn,Ye(T,Z,_e,oe),ye();var Sr=T.memoizedState;$e!==Nn||Dn!==Sr||co||b!==null&&b.dependencies!==null&&jn(b.dependencies)?(typeof ft=="function"&&(ad(T,D,ft,Z),Sr=T.memoizedState),(mn=co||ip(T,D,mn,Z,Dn,Sr,Ct)||b!==null&&b.dependencies!==null&&jn(b.dependencies))?(Jt||typeof _e.UNSAFE_componentWillUpdate!="function"&&typeof _e.componentWillUpdate!="function"||(typeof _e.componentWillUpdate=="function"&&_e.componentWillUpdate(Z,Sr,Ct),typeof _e.UNSAFE_componentWillUpdate=="function"&&_e.UNSAFE_componentWillUpdate(Z,Sr,Ct)),typeof _e.componentDidUpdate=="function"&&(T.flags|=4),typeof _e.getSnapshotBeforeUpdate=="function"&&(T.flags|=1024)):(typeof _e.componentDidUpdate!="function"||$e===b.memoizedProps&&Dn===b.memoizedState||(T.flags|=4),typeof _e.getSnapshotBeforeUpdate!="function"||$e===b.memoizedProps&&Dn===b.memoizedState||(T.flags|=1024),T.memoizedProps=Z,T.memoizedState=Sr),_e.props=Z,_e.state=Sr,_e.context=Ct,Z=mn):(typeof _e.componentDidUpdate!="function"||$e===b.memoizedProps&&Dn===b.memoizedState||(T.flags|=4),typeof _e.getSnapshotBeforeUpdate!="function"||$e===b.memoizedProps&&Dn===b.memoizedState||(T.flags|=1024),Z=!1)}return _e=Z,_f(b,T),Z=(T.flags&128)!==0,_e||Z?(_e=T.stateNode,D=Z&&typeof D.getDerivedStateFromError!="function"?null:_e.render(),T.flags|=1,b!==null&&Z?(T.child=Of(T,b.child,null,oe),T.child=Of(T,null,D,oe)):Ho(b,T,D,oe),T.memoizedState=_e.state,b=T.child):b=Cn(b,T,oe),b}function Oi(b,T,D,Z){return Je(),T.flags|=256,Ho(b,T,D,Z),T.child}function Cs(b){return{baseLanes:b,cachePool:Og()}}function bm(b,T,D){return b=b!==null?b.childLanes&~D:0,T&&(b|=Fr),b}function Em(b,T,D){var Z=T.pendingProps,oe=!1,_e=(T.flags&128)!==0,$e;if(($e=_e)||($e=b!==null&&b.memoizedState===null?!1:(So.current&2)!==0),$e&&(oe=!0,T.flags&=-129),$e=(T.flags&32)!==0,T.flags&=-33,b===null){if(An){if(oe?Kt(T):Wt(),An){var ft=Wn,Ct;(Ct=ft)&&(ft=x_(ft,Wr),ft!==null?(T.memoizedState={dehydrated:ft,treeContext:bu!==null?{id:cs,overflow:Qi}:null,retryLane:536870912},Ct=n(18,null,null,0),Ct.stateNode=ft,Ct.return=T,T.child=Ct,Xn=T,Wn=null,Ct=!0):Ct=!1),Ct||Re(T)}if(ft=T.memoizedState,ft!==null&&(ft=ft.dehydrated,ft!==null))return Vg(ft)?T.lanes=16:T.lanes=536870912,null;dn(T)}return ft=Z.children,Z=Z.fallback,oe?(Wt(),oe=T.mode,ft=Ke({mode:"hidden",children:ft},oe),Z=Vu(Z,oe,D,null),ft.return=T,Z.return=T,ft.sibling=Z,T.child=ft,oe=T.child,oe.memoizedState=Cs(D),oe.childLanes=bm(b,$e,D),T.memoizedState=Ku,Z):(Kt(T),vf(T,ft))}if(Ct=b.memoizedState,Ct!==null&&(ft=Ct.dehydrated,ft!==null)){if(_e)T.flags&256?(Kt(T),T.flags&=-257,T=dt(b,T,D)):T.memoizedState!==null?(Wt(),T.child=b.child,T.flags|=128,T=null):(Wt(),oe=Z.fallback,ft=T.mode,Z=Ke({mode:"visible",children:Z.children},ft),oe=Vu(oe,ft,D,null),oe.flags|=2,Z.return=T,oe.return=T,Z.sibling=oe,T.child=Z,Of(T,b.child,null,D),Z=T.child,Z.memoizedState=Cs(D),Z.childLanes=bm(b,$e,D),T.memoizedState=Ku,T=oe);else if(Kt(T),Vg(ft))$e=b_(ft).digest,Z=Error(i(419)),Z.stack="",Z.digest=$e,at({value:Z,source:null,stack:null}),T=dt(b,T,D);else if(ga||Lu(b,T,D,!1),$e=(D&b.childLanes)!==0,ga||$e){if($e=Et,$e!==null){if(Z=D&-D,(Z&42)!==0)Z=1;else switch(Z){case 2:Z=1;break;case 8:Z=4;break;case 32:Z=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:Z=64;break;case 268435456:Z=134217728;break;default:Z=0}if(Z=(Z&($e.suspendedLanes|D))!==0?0:Z,Z!==0&&Z!==Ct.retryLane)throw Ct.retryLane=Z,Ue(b,Z),la($e,b,Z),e0}Vm(ft)||Qr(),T=dt(b,T,D)}else Vm(ft)?(T.flags|=128,T.child=b.child,T=up.bind(null,b),E_(ft,T),T=null):(b=Ct.treeContext,gc&&(Wn=Xa(ft),Xn=T,An=!0,eo=null,Wr=!1,b!==null&&(di[Qs++]=cs,di[Qs++]=Qi,di[Qs++]=bu,cs=b.id,Qi=b.overflow,bu=T)),T=vf(T,Z.children),T.flags|=4096);return T}return oe?(Wt(),oe=Z.fallback,ft=T.mode,Ct=b.child,_e=Ct.sibling,Z=Ca(Ct,{mode:"hidden",children:Z.children}),Z.subtreeFlags=Ct.subtreeFlags&31457280,_e!==null?oe=Ca(_e,oe):(oe=Vu(oe,ft,D,null),oe.flags|=2),oe.return=T,Z.return=T,Z.sibling=oe,T.child=Z,Z=oe,oe=T.child,ft=b.child.memoizedState,ft===null?ft=Cs(D):(Ct=ft.cachePool,Ct!==null?(_e=sl?Y._currentValue:Y._currentValue2,Ct=Ct.parent!==_e?{parent:_e,pool:_e}:Ct):Ct=Og(),ft={baseLanes:ft.baseLanes|D,cachePool:Ct}),oe.memoizedState=ft,oe.childLanes=bm(b,$e,D),T.memoizedState=Ku,Z):(Kt(T),D=b.child,b=D.sibling,D=Ca(D,{mode:"visible",children:Z.children}),D.return=T,D.sibling=null,b!==null&&($e=T.deletions,$e===null?(T.deletions=[b],T.flags|=16):$e.push(b)),T.child=D,T.memoizedState=null,D)}function vf(b,T){return T=Ke({mode:"visible",children:T},b.mode),T.return=b,b.child=T}function Ke(b,T){return mp(b,T,0,null)}function dt(b,T,D){return Of(T,b.child,null,D),b=vf(T,T.pendingProps.children),b.flags|=2,T.memoizedState=null,b}function pt(b,T,D){b.lanes|=T;var Z=b.alternate;Z!==null&&(Z.lanes|=T),Ii(b.return,T,D)}function zt(b,T,D,Z,oe){var _e=b.memoizedState;_e===null?b.memoizedState={isBackwards:T,rendering:null,renderingStartTime:0,last:Z,tail:D,tailMode:oe}:(_e.isBackwards=T,_e.rendering=null,_e.renderingStartTime=0,_e.last=Z,_e.tail=D,_e.tailMode=oe)}function on(b,T,D){var Z=T.pendingProps,oe=Z.revealOrder,_e=Z.tail;if(Ho(b,T,Z.children,D),Z=So.current,(Z&2)!==0)Z=Z&1|2,T.flags|=128;else{if(b!==null&&(b.flags&128)!==0)e:for(b=T.child;b!==null;){if(b.tag===13)b.memoizedState!==null&&pt(b,D,T);else if(b.tag===19)pt(b,D,T);else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===T)break e;for(;b.sibling===null;){if(b.return===null||b.return===T)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}Z&=1}switch(x(So,Z),oe){case"forwards":for(D=T.child,oe=null;D!==null;)b=D.alternate,b!==null&&Mn(b)===null&&(oe=D),D=D.sibling;D=oe,D===null?(oe=T.child,T.child=null):(oe=D.sibling,D.sibling=null),zt(T,!1,oe,D,_e);break;case"backwards":for(D=null,oe=T.child,T.child=null;oe!==null;){if(b=oe.alternate,b!==null&&Mn(b)===null){T.child=oe;break}b=oe.sibling,oe.sibling=D,D=oe,oe=b}zt(T,!0,D,null,_e);break;case"together":zt(T,!1,null,null,void 0);break;default:T.memoizedState=null}return T.child}function Cn(b,T,D){if(b!==null&&(T.dependencies=b.dependencies),ir|=T.lanes,(D&T.childLanes)===0)if(b!==null){if(Lu(b,T,D,!1),(D&T.childLanes)===0)return null}else return null;if(b!==null&&T.child!==b.child)throw Error(i(153));if(T.child!==null){for(b=T.child,D=Ca(b,b.pendingProps),T.child=D,D.return=T;b.sibling!==null;)b=b.sibling,D=D.sibling=Ca(b,b.pendingProps),D.return=T;D.sibling=null}return T.child}function $r(b,T){return(b.lanes&T)!==0?!0:(b=b.dependencies,!!(b!==null&&jn(b)))}function qo(b,T,D){switch(T.tag){case 3:ie(T,T.stateNode.containerInfo),yo(T,Y,b.memoizedState.cache),Je();break;case 27:case 5:xe(T);break;case 4:ie(T,T.stateNode.containerInfo);break;case 10:yo(T,T.type,T.memoizedProps.value);break;case 13:var Z=T.memoizedState;if(Z!==null)return Z.dehydrated!==null?(Kt(T),T.flags|=128,null):(D&T.child.childLanes)!==0?Em(b,T,D):(Kt(T),b=Cn(b,T,D),b!==null?b.sibling:null);Kt(T);break;case 19:var oe=(b.flags&128)!==0;if(Z=(D&T.childLanes)!==0,Z||(Lu(b,T,D,!1),Z=(D&T.childLanes)!==0),oe){if(Z)return on(b,T,D);T.flags|=128}if(oe=T.memoizedState,oe!==null&&(oe.rendering=null,oe.tail=null,oe.lastEffect=null),x(So,So.current),Z)break;return null;case 22:case 23:return T.lanes=0,cd(b,T,D);case 24:yo(T,Y,b.memoizedState.cache)}return Cn(b,T,D)}function Kn(b,T,D){if(b!==null)if(b.memoizedProps!==T.pendingProps)ga=!0;else{if(!$r(b,D)&&(T.flags&128)===0)return ga=!1,qo(b,T,D);ga=(b.flags&131072)!==0}else ga=!1,An&&(T.flags&1048576)!==0&&$(T,Fl,T.index);switch(T.lanes=0,T.tag){case 16:e:{b=T.pendingProps;var Z=T.elementType,oe=Z._init;if(Z=oe(Z._payload),T.type=Z,typeof Z=="function")hp(Z)?(b=Du(Z,b),T.tag=1,T=ym(null,T,Z,b,D)):(T.tag=0,T=uu(null,T,Z,b,D));else{if(Z!=null){if(oe=Z.$$typeof,oe===$u){T.tag=11,T=o_(null,T,Z,b,D);break e}else if(oe===Nl){T.tag=14,T=Xv(null,T,Z,b,D);break e}}throw T=o(Z)||Z,Error(i(306,T,""))}}return T;case 0:return uu(b,T,T.type,T.pendingProps,D);case 1:return Z=T.type,oe=Du(Z,T.pendingProps),ym(b,T,Z,oe,D);case 3:e:{if(ie(T,T.stateNode.containerInfo),b===null)throw Error(i(387));var _e=T.pendingProps;oe=T.memoizedState,Z=oe.element,Q(b,T),Ye(T,_e,null,D);var $e=T.memoizedState;if(_e=$e.cache,yo(T,Y,_e),_e!==oe.cache&&hu(T,[Y],D,!0),ye(),_e=$e.element,gc&&oe.isDehydrated)if(oe={element:_e,isDehydrated:!1,cache:$e.cache},T.updateQueue.baseState=oe,T.memoizedState=oe,T.flags&256){T=Oi(b,T,_e,D);break e}else if(_e!==Z){Z=te(Error(i(424)),T),at(Z),T=Oi(b,T,_e,D);break e}else for(gc&&(Wn=Ul(T.stateNode.containerInfo),Xn=T,An=!0,eo=null,Wr=!0),D=Qg(T,null,_e,D),T.child=D;D;)D.flags=D.flags&-3|4096,D=D.sibling;else{if(Je(),_e===Z){T=Cn(b,T,D);break e}Ho(b,T,_e,D)}T=T.child}return T;case 26:if(ol)return _f(b,T),b===null?(D=ty(T.type,null,T.pendingProps,null))?T.memoizedState=D:An||(T.stateNode=jc(T.type,T.pendingProps,zc.current,T)):T.memoizedState=ty(T.type,b.memoizedProps,T.pendingProps,b.memoizedState),null;case 27:if(Xo)return xe(T),b===null&&Xo&&An&&(Z=T.stateNode=Sd(T.type,T.pendingProps,zc.current,si.current,!1),Xn=T,Wr=!0,Wn=ey(Z)),Z=T.pendingProps.children,b!==null||An?Ho(b,T,Z,D):T.child=Of(T,null,Z,D),_f(b,T),T.child;case 5:return b===null&&An&&(Ab(T.type,T.pendingProps,si.current),(oe=Z=Wn)&&(Z=$m(Z,T.type,T.pendingProps,Wr),Z!==null?(T.stateNode=Z,Xn=T,Wn=ey(Z),Wr=!1,oe=!0):oe=!1),oe||Re(T)),xe(T),oe=T.type,_e=T.pendingProps,$e=b!==null?b.memoizedProps:null,Z=_e.children,Cf(oe,_e)?Z=null:$e!==null&&Cf(oe,$e)&&(T.flags|=32),T.memoizedState!==null&&(oe=ni(b,T,Ds,null,null,D),sl?Zn._currentValue=oe:Zn._currentValue2=oe),_f(b,T),Ho(b,T,Z,D),T.child;case 6:return b===null&&An&&(Mb(T.pendingProps,si.current),(b=D=Wn)&&(D=S_(D,T.pendingProps,Wr),D!==null?(T.stateNode=D,Xn=T,Wn=null,b=!0):b=!1),b||Re(T)),null;case 13:return Em(b,T,D);case 4:return ie(T,T.stateNode.containerInfo),Z=T.pendingProps,b===null?T.child=Of(T,null,Z,D):Ho(b,T,Z,D),T.child;case 11:return o_(b,T,T.type,T.pendingProps,D);case 7:return Ho(b,T,T.pendingProps,D),T.child;case 8:return Ho(b,T,T.pendingProps.children,D),T.child;case 12:return Ho(b,T,T.pendingProps.children,D),T.child;case 10:return Z=T.pendingProps,yo(T,T.type,Z.value),Ho(b,T,Z.children,D),T.child;case 9:return oe=T.type._context,Z=T.pendingProps.children,Ic(T),oe=qs(oe),Z=Z(oe),T.flags|=1,Ho(b,T,Z,D),T.child;case 14:return Xv(b,T,T.type,T.pendingProps,D);case 15:return Yv(b,T,T.type,T.pendingProps,D);case 19:return on(b,T,D);case 22:return cd(b,T,D);case 24:return Ic(T),Z=qs(Y),b===null?(oe=a_(),oe===null&&(oe=Et,_e=Sm(),oe.pooledCache=_e,_e.refCount++,_e!==null&&(oe.pooledCacheLanes|=D),oe=_e),T.memoizedState={parent:Z,cache:oe},ce(T),yo(T,Y,oe)):((b.lanes&D)!==0&&(Q(b,T),Ye(T,null,null,D),ye()),oe=b.memoizedState,_e=T.memoizedState,oe.parent!==Z?(oe={parent:Z,cache:Z},T.memoizedState=oe,T.lanes===0&&(T.memoizedState=T.updateQueue.baseState=oe),yo(T,Y,Z)):(Z=_e.cache,yo(T,Y,Z),Z!==oe.cache&&hu(T,[Y],D,!0))),Ho(b,T,T.pendingProps.children,D),T.child;case 29:throw T.pendingProps}throw Error(i(156,T.tag))}function yo(b,T,D){sl?(x(Eh,T._currentValue),T._currentValue=D):(x(Eh,T._currentValue2),T._currentValue2=D)}function fu(b){var T=Eh.current;sl?b._currentValue=T:b._currentValue2=T,v(Eh)}function Ii(b,T,D){for(;b!==null;){var Z=b.alternate;if((b.childLanes&T)!==T?(b.childLanes|=T,Z!==null&&(Z.childLanes|=T)):Z!==null&&(Z.childLanes&T)!==T&&(Z.childLanes|=T),b===D)break;b=b.return}}function hu(b,T,D,Z){var oe=b.child;for(oe!==null&&(oe.return=b);oe!==null;){var _e=oe.dependencies;if(_e!==null){var $e=oe.child;_e=_e.firstContext;e:for(;_e!==null;){var ft=_e;_e=oe;for(var Ct=0;Ct<T.length;Ct++)if(ft.context===T[Ct]){_e.lanes|=D,ft=_e.alternate,ft!==null&&(ft.lanes|=D),Ii(_e.return,D,b),Z||($e=null);break e}_e=ft.next}}else if(oe.tag===18){if($e=oe.return,$e===null)throw Error(i(341));$e.lanes|=D,_e=$e.alternate,_e!==null&&(_e.lanes|=D),Ii($e,D,b),$e=null}else $e=oe.child;if($e!==null)$e.return=oe;else for($e=oe;$e!==null;){if($e===b){$e=null;break}if(oe=$e.sibling,oe!==null){oe.return=$e.return,$e=oe;break}$e=$e.return}oe=$e}}function Lu(b,T,D,Z){b=null;for(var oe=T,_e=!1;oe!==null;){if(!_e){if((oe.flags&524288)!==0)_e=!0;else if((oe.flags&262144)!==0)break}if(oe.tag===10){var $e=oe.alternate;if($e===null)throw Error(i(387));if($e=$e.memoizedProps,$e!==null){var ft=oe.type;Ia(oe.pendingProps.value,$e.value)||(b!==null?b.push(ft):b=[ft])}}else if(oe===yc.current){if($e=oe.alternate,$e===null)throw Error(i(387));$e.memoizedState.memoizedState!==oe.memoizedState.memoizedState&&(b!==null?b.push(Zn):b=[Zn])}oe=oe.return}b!==null&&hu(T,b,D,Z),T.flags|=262144}function jn(b){for(b=b.firstContext;b!==null;){var T=b.context;if(!Ia(sl?T._currentValue:T._currentValue2,b.memoizedValue))return!0;b=b.next}return!1}function Ic(b){L=b,w=null,b=b.dependencies,b!==null&&(b.firstContext=null)}function qs(b){return vr(L,b)}function Yn(b,T){return L===null&&Ic(b),vr(b,T)}function vr(b,T){var D=sl?T._currentValue:T._currentValue2;if(T={context:T,memoizedValue:D,next:null},w===null){if(b===null)throw Error(i(308));w=T,b.dependencies={lanes:0,firstContext:T},b.flags|=524288}else w=w.next=T;return D}function Sm(){return{controller:new O,data:new Map,refCount:0}}function du(b){b.refCount--,b.refCount===0&&B(V,function(){b.controller.abort()})}function a_(){var b=me.current;return b!==null?b:Et.pooledCache}function Ra(b,T){T===null?x(me,me.current):x(me,T.pool)}function Og(){var b=a_();return b===null?null:{parent:sl?Y._currentValue:Y._currentValue2,pool:b}}function Ao(b){b.flags|=4}function Va(b,T){if(b!==null&&b.child===T.child)return!1;if((T.flags&16)!==0)return!0;for(b=T.child;b!==null;){if((b.flags&13878)!==0||(b.subtreeFlags&13878)!==0)return!0;b=b.sibling}return!1}function yf(b,T,D,Z){if(Io)for(D=T.child;D!==null;){if(D.tag===5||D.tag===6)ka(b,D.stateNode);else if(!(D.tag===4||Xo&&D.tag===27)&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===T)break;for(;D.sibling===null;){if(D.return===null||D.return===T)return;D=D.return}D.sibling.return=D.return,D=D.sibling}else if(Pl)for(var oe=T.child;oe!==null;){if(oe.tag===5){var _e=oe.stateNode;D&&Z&&(_e=qm(_e,oe.type,oe.memoizedProps)),ka(b,_e)}else if(oe.tag===6)_e=oe.stateNode,D&&Z&&(_e=y_(_e,oe.memoizedProps)),ka(b,_e);else if(oe.tag!==4){if(oe.tag===22&&oe.memoizedState!==null)_e=oe.child,_e!==null&&(_e.return=oe),yf(b,oe,!0,!0);else if(oe.child!==null){oe.child.return=oe,oe=oe.child;continue}}if(oe===T)break;for(;oe.sibling===null;){if(oe.return===null||oe.return===T)return;oe=oe.return}oe.sibling.return=oe.return,oe=oe.sibling}}function Ig(b,T,D,Z){if(Pl)for(var oe=T.child;oe!==null;){if(oe.tag===5){var _e=oe.stateNode;D&&Z&&(_e=qm(_e,oe.type,oe.memoizedProps)),Ll(b,_e)}else if(oe.tag===6)_e=oe.stateNode,D&&Z&&(_e=y_(_e,oe.memoizedProps)),Ll(b,_e);else if(oe.tag!==4){if(oe.tag===22&&oe.memoizedState!==null)_e=oe.child,_e!==null&&(_e.return=oe),Ig(b,oe,!(oe.memoizedProps!==null&&oe.memoizedProps.mode==="manual"),!0);else if(oe.child!==null){oe.child.return=oe,oe=oe.child;continue}}if(oe===T)break;for(;oe.sibling===null;){if(oe.return===null||oe.return===T)return;oe=oe.return}oe.sibling.return=oe.return,oe=oe.sibling}}function Uu(b,T){if(Pl&&Va(b,T)){b=T.stateNode;var D=b.containerInfo,Z=Hm();Ig(Z,T,!1,!1),b.pendingChildren=Z,Ao(T),Ka(D,Z)}}function bf(b,T,D,Z){if(Io)b.memoizedProps!==Z&&Ao(T);else if(Pl){var oe=b.stateNode,_e=b.memoizedProps;if((b=Va(b,T))||_e!==Z){var $e=si.current;_e=xp(oe,D,_e,Z,!b,null),_e===oe?T.stateNode=oe:(Pm(_e,D,Z,$e)&&Ao(T),T.stateNode=_e,b?yf(_e,T,!1,!1):Ao(T))}else T.stateNode=oe}}function xm(b,T,D){if(Oa(T,D)){if(b.flags|=16777216,!_c(T,D))if(f_())b.flags|=8192;else throw kf=wd,ma}else b.flags&=-16777217}function ih(b,T){if(qi(T)){if(b.flags|=16777216,!Km(T))if(f_())b.flags|=8192;else throw kf=wd,ma}else b.flags&=-16777217}function Ef(b,T){T!==null&&(b.flags|=4),b.flags&16384&&(T=b.tag!==22?z():536870912,b.lanes|=T,Kr|=T)}function Jc(b,T){if(!An)switch(b.tailMode){case"hidden":T=b.tail;for(var D=null;T!==null;)T.alternate!==null&&(D=T),T=T.sibling;D===null?b.tail=null:D.sibling=null;break;case"collapsed":D=b.tail;for(var Z=null;D!==null;)D.alternate!==null&&(Z=D),D=D.sibling;Z===null?T||b.tail===null?b.tail=null:b.tail.sibling=null:Z.sibling=null}}function hi(b){var T=b.alternate!==null&&b.alternate.child===b.child,D=0,Z=0;if(T)for(var oe=b.child;oe!==null;)D|=oe.lanes|oe.childLanes,Z|=oe.subtreeFlags&31457280,Z|=oe.flags&31457280,oe.return=b,oe=oe.sibling;else for(oe=b.child;oe!==null;)D|=oe.lanes|oe.childLanes,Z|=oe.subtreeFlags,Z|=oe.flags,oe.return=b,oe=oe.sibling;return b.subtreeFlags|=Z,b.childLanes=D,T}function Al(b,T,D){var Z=T.pendingProps;switch(ne(T),T.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return hi(T),null;case 1:return hi(T),null;case 3:return D=T.stateNode,Z=null,b!==null&&(Z=b.memoizedState.cache),T.memoizedState.cache!==Z&&(T.flags|=2048),fu(Y),ae(),D.pendingContext&&(D.context=D.pendingContext,D.pendingContext=null),(b===null||b.child===null)&&(Be(T)?Ao(T):b===null||b.memoizedState.isDehydrated&&(T.flags&256)===0||(T.flags|=1024,eo!==null&&(ah(eo),eo=null))),Uu(b,T),hi(T),null;case 26:if(ol){D=T.type;var oe=T.memoizedState;return b===null?(Ao(T),oe!==null?(hi(T),ih(T,oe)):(hi(T),xm(T,D,Z))):oe?oe!==b.memoizedState?(Ao(T),hi(T),ih(T,oe)):(hi(T),T.flags&=-16777217):(Io?b.memoizedProps!==Z&&Ao(T):bf(b,T,D,Z),hi(T),xm(T,D,Z)),null}case 27:if(Xo){if(Ne(T),D=zc.current,oe=T.type,b!==null&&T.stateNode!=null)Io?b.memoizedProps!==Z&&Ao(T):bf(b,T,oe,Z);else{if(!Z){if(T.stateNode===null)throw Error(i(166));return hi(T),null}b=si.current,Be(T)?Se(T,b):(b=Sd(oe,Z,D,b,!0),T.stateNode=b,Ao(T))}return hi(T),null}case 5:if(Ne(T),D=T.type,b!==null&&T.stateNode!=null)bf(b,T,D,Z);else{if(!Z){if(T.stateNode===null)throw Error(i(166));return hi(T),null}b=si.current,Be(T)?Se(T,b):(oe=_u(D,Z,zc.current,b,T),yf(oe,T,!1,!1),T.stateNode=oe,Pm(oe,D,Z,b)&&Ao(T))}return hi(T),xm(T,T.type,T.pendingProps),null;case 6:if(b&&T.stateNode!=null)D=b.memoizedProps,Io?D!==Z&&Ao(T):Pl&&(D!==Z?(T.stateNode=vp(Z,zc.current,si.current,T),Ao(T)):T.stateNode=b.stateNode);else{if(typeof Z!="string"&&T.stateNode===null)throw Error(i(166));if(b=zc.current,D=si.current,Be(T)){if(!gc)throw Error(i(176));if(b=T.stateNode,D=T.memoizedProps,Z=null,oe=Xn,oe!==null)switch(oe.tag){case 27:case 5:Z=oe.memoizedProps}Tb(b,D,T,Z)||Re(T)}else T.stateNode=vp(Z,b,D,T)}return hi(T),null;case 13:if(Z=T.memoizedState,b===null||b.memoizedState!==null&&b.memoizedState.dehydrated!==null){if(oe=Be(T),Z!==null&&Z.dehydrated!==null){if(b===null){if(!oe)throw Error(i(318));if(!gc)throw Error(i(344));if(oe=T.memoizedState,oe=oe!==null?oe.dehydrated:null,!oe)throw Error(i(317));wb(oe,T)}else Je(),(T.flags&128)===0&&(T.memoizedState=null),T.flags|=4;hi(T),oe=!1}else eo!==null&&(ah(eo),eo=null),oe=!0;if(!oe)return T.flags&256?(dn(T),T):(dn(T),null)}if(dn(T),(T.flags&128)!==0)return T.lanes=D,T;if(D=Z!==null,b=b!==null&&b.memoizedState!==null,D){Z=T.child,oe=null,Z.alternate!==null&&Z.alternate.memoizedState!==null&&Z.alternate.memoizedState.cachePool!==null&&(oe=Z.alternate.memoizedState.cachePool.pool);var _e=null;Z.memoizedState!==null&&Z.memoizedState.cachePool!==null&&(_e=Z.memoizedState.cachePool.pool),_e!==oe&&(Z.flags|=2048)}return D!==b&&D&&(T.child.flags|=8192),Ef(T,T.updateQueue),hi(T),null;case 4:return ae(),Uu(b,T),b===null&&Lm(T.stateNode.containerInfo),hi(T),null;case 10:return fu(T.type),hi(T),null;case 19:if(v(So),oe=T.memoizedState,oe===null)return hi(T),null;if(Z=(T.flags&128)!==0,_e=oe.rendering,_e===null)if(Z)Jc(oe,!1);else{if(bn!==0||b!==null&&(b.flags&128)!==0)for(b=T.child;b!==null;){if(_e=Mn(b),_e!==null){for(T.flags|=128,Jc(oe,!1),b=_e.updateQueue,T.updateQueue=b,Ef(T,b),T.subtreeFlags=0,b=D,D=T.child;D!==null;)dp(D,b),D=D.sibling;return x(So,So.current&1|2),T.child}b=b.sibling}oe.tail!==null&&tr()>Vi&&(T.flags|=128,Z=!0,Jc(oe,!1),T.lanes=4194304)}else{if(!Z)if(b=Mn(_e),b!==null){if(T.flags|=128,Z=!0,b=b.updateQueue,T.updateQueue=b,Ef(T,b),Jc(oe,!0),oe.tail===null&&oe.tailMode==="hidden"&&!_e.alternate&&!An)return hi(T),null}else 2*tr()-oe.renderingStartTime>Vi&&D!==536870912&&(T.flags|=128,Z=!0,Jc(oe,!1),T.lanes=4194304);oe.isBackwards?(_e.sibling=T.child,T.child=_e):(b=oe.last,b!==null?b.sibling=_e:T.child=_e,oe.last=_e)}return oe.tail!==null?(T=oe.tail,oe.rendering=T,oe.tail=T.sibling,oe.renderingStartTime=tr(),T.sibling=null,b=So.current,x(So,Z?b&1|2:b&1),T):(hi(T),null);case 22:case 23:return dn(T),vt(),Z=T.memoizedState!==null,b!==null?b.memoizedState!==null!==Z&&(T.flags|=8192):Z&&(T.flags|=8192),Z?(D&536870912)!==0&&(T.flags&128)===0&&(hi(T),T.subtreeFlags&6&&(T.flags|=8192)):hi(T),D=T.updateQueue,D!==null&&Ef(T,D.retryQueue),D=null,b!==null&&b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(D=b.memoizedState.cachePool.pool),Z=null,T.memoizedState!==null&&T.memoizedState.cachePool!==null&&(Z=T.memoizedState.cachePool.pool),Z!==D&&(T.flags|=2048),b!==null&&v(me),null;case 24:return D=null,b!==null&&(D=b.memoizedState.cache),T.memoizedState.cache!==D&&(T.flags|=2048),fu(Y),hi(T),null;case 25:return null}throw Error(i(156,T.tag))}function Zv(b,T){switch(ne(T),T.tag){case 1:return b=T.flags,b&65536?(T.flags=b&-65537|128,T):null;case 3:return fu(Y),ae(),b=T.flags,(b&65536)!==0&&(b&128)===0?(T.flags=b&-65537|128,T):null;case 26:case 27:case 5:return Ne(T),null;case 13:if(dn(T),b=T.memoizedState,b!==null&&b.dehydrated!==null){if(T.alternate===null)throw Error(i(340));Je()}return b=T.flags,b&65536?(T.flags=b&-65537|128,T):null;case 19:return v(So),null;case 4:return ae(),null;case 10:return fu(T.type),null;case 22:case 23:return dn(T),vt(),b!==null&&v(me),b=T.flags,b&65536?(T.flags=b&-65537|128,T):null;case 24:return fu(Y),null;case 25:return null;default:return null}}function Jv(b,T){switch(ne(T),T.tag){case 3:fu(Y),ae();break;case 26:case 27:case 5:Ne(T);break;case 4:ae();break;case 13:dn(T);break;case 19:v(So);break;case 10:fu(T.type);break;case 22:case 23:dn(T),vt(),b!==null&&v(me);break;case 24:fu(Y)}}function Tm(b,T){try{var D=T.updateQueue,Z=D!==null?D.lastEffect:null;if(Z!==null){var oe=Z.next;D=oe;do{if((D.tag&b)===b){Z=void 0;var _e=D.create,$e=D.inst;Z=_e(),$e.destroy=Z}D=D.next}while(D!==oe)}}catch(ft){ei(T,T.return,ft)}}function uc(b,T,D){try{var Z=T.updateQueue,oe=Z!==null?Z.lastEffect:null;if(oe!==null){var _e=oe.next;Z=_e;do{if((Z.tag&b)===b){var $e=Z.inst,ft=$e.destroy;if(ft!==void 0){$e.destroy=void 0,oe=T;var Ct=D;try{ft()}catch(Jt){ei(oe,Ct,Jt)}}}Z=Z.next}while(Z!==_e)}}catch(Jt){ei(T,T.return,Jt)}}function sh(b){var T=b.updateQueue;if(T!==null){var D=b.stateNode;try{We(T,D)}catch(Z){ei(b,b.return,Z)}}}function Bu(b,T,D){D.props=Du(b.type,b.memoizedProps),D.state=b.memoizedState;try{D.componentWillUnmount()}catch(Z){ei(b,T,Z)}}function ld(b,T){try{var D=b.ref;if(D!==null){var Z=b.stateNode;switch(b.tag){case 26:case 27:case 5:var oe=il(Z);break;default:oe=Z}typeof D=="function"?b.refCleanup=D(oe):D.current=oe}}catch(_e){ei(b,T,_e)}}function Ga(b,T){var D=b.ref,Z=b.refCleanup;if(D!==null)if(typeof Z=="function")try{Z()}catch(oe){ei(b,T,oe)}finally{b.refCleanup=null,b=b.alternate,b!=null&&(b.refCleanup=null)}else if(typeof D=="function")try{D(null)}catch(oe){ei(b,T,oe)}else D.current=null}function Ng(b){var T=b.type,D=b.memoizedProps,Z=b.stateNode;try{Sp(Z,T,D,b)}catch(oe){ei(b,b.return,oe)}}function c_(b,T,D){try{Ys(b.stateNode,b.type,D,T,b)}catch(Z){ei(b,b.return,Z)}}function Hr(b){return b.tag===5||b.tag===3||(ol?b.tag===26:!1)||(Xo?b.tag===27:!1)||b.tag===4}function Ti(b){e:for(;;){for(;b.sibling===null;){if(b.return===null||Hr(b.return))return null;b=b.return}for(b.sibling.return=b.return,b=b.sibling;b.tag!==5&&b.tag!==6&&(!Xo||b.tag!==27)&&b.tag!==18;){if(b.flags&2||b.child===null||b.tag===4)continue e;b.child.return=b,b=b.child}if(!(b.flags&2))return b.stateNode}}function wm(b,T,D){var Z=b.tag;if(Z===5||Z===6)b=b.stateNode,T?__(D,b,T):Ep(D,b);else if(!(Z===4||Xo&&Z===27)&&(b=b.child,b!==null))for(wm(b,T,D),b=b.sibling;b!==null;)wm(b,T,D),b=b.sibling}function Rm(b,T,D){var Z=b.tag;if(Z===5||Z===6)b=b.stateNode,T?Fm(D,b,T):Ko(D,b);else if(!(Z===4||Xo&&Z===27)&&(b=b.child,b!==null))for(Rm(b,T,D),b=b.sibling;b!==null;)Rm(b,T,D),b=b.sibling}function Cm(b,T,D){b=b.containerInfo;try{yu(b,D)}catch(Z){ei(T,T.return,Z)}}function Tn(b,T){for(m_(b.containerInfo),U=T;U!==null;)if(b=U,T=b.child,(b.subtreeFlags&1028)!==0&&T!==null)T.return=b,U=T;else for(;U!==null;){b=U;var D=b.alternate;switch(T=b.flags,b.tag){case 0:break;case 11:case 15:break;case 1:if((T&1024)!==0&&D!==null){T=void 0;var Z=b,oe=D.memoizedProps;D=D.memoizedState;var _e=Z.stateNode;try{var $e=Du(Z.type,oe,Z.elementType===Z.type);T=_e.getSnapshotBeforeUpdate($e,D),_e.__reactInternalSnapshotBeforeUpdate=T}catch(ft){ei(Z,Z.return,ft)}}break;case 3:(T&1024)!==0&&Io&&zm(b.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((T&1024)!==0)throw Error(i(163))}if(T=b.sibling,T!==null){T.return=b.return,U=T;break}U=b.return}return $e=ee,ee=!1,$e}function ss(b,T,D){var Z=D.flags;switch(D.tag){case 0:case 11:case 15:ca(b,D),Z&4&&Tm(5,D);break;case 1:if(ca(b,D),Z&4)if(b=D.stateNode,T===null)try{b.componentDidMount()}catch(ft){ei(D,D.return,ft)}else{var oe=Du(D.type,T.memoizedProps);T=T.memoizedState;try{b.componentDidUpdate(oe,T,b.__reactInternalSnapshotBeforeUpdate)}catch(ft){ei(D,D.return,ft)}}Z&64&&sh(D),Z&512&&ld(D,D.return);break;case 3:if(ca(b,D),Z&64&&(Z=D.updateQueue,Z!==null)){if(b=null,D.child!==null)switch(D.child.tag){case 27:case 5:b=il(D.child.stateNode);break;case 1:b=D.child.stateNode}try{We(Z,b)}catch(ft){ei(D,D.return,ft)}}break;case 26:if(ol){ca(b,D),Z&512&&ld(D,D.return);break}case 27:case 5:ca(b,D),T===null&&Z&4&&Ng(D),Z&512&&ld(D,D.return);break;case 12:ca(b,D);break;case 13:ca(b,D),Z&4&&ju(b,D);break;case 22:if(oe=D.memoizedState!==null||S,!oe){T=T!==null&&T.memoizedState!==null||f;var _e=S,$e=f;S=oe,(f=T)&&!$e?Vo(b,D,(D.subtreeFlags&8772)!==0):ca(b,D),S=_e,f=$e}Z&512&&(D.memoizedProps.mode==="manual"?ld(D,D.return):Ga(D,D.return));break;default:ca(b,D)}}function Fu(b){var T=b.alternate;T!==null&&(b.alternate=null,Fu(T)),b.child=null,b.deletions=null,b.sibling=null,b.tag===5&&(T=b.stateNode,T!==null&&vd(T)),b.stateNode=null,b.return=null,b.dependencies=null,b.memoizedProps=null,b.memoizedState=null,b.pendingProps=null,b.stateNode=null,b.updateQueue=null}function fc(b,T,D){for(D=D.child;D!==null;)Qc(b,T,D),D=D.sibling}function Qc(b,T,D){if(Zs&&typeof Zs.onCommitFiberUnmount=="function")try{Zs.onCommitFiberUnmount(Ya,D)}catch{}switch(D.tag){case 26:if(ol){f||Ga(D,T),fc(b,T,D),D.memoizedState?ry(D.memoizedState):D.stateNode&&Rp(D.stateNode);break}case 27:if(Xo){f||Ga(D,T);var Z=ue,oe=de;ue=D.stateNode,fc(b,T,D),Xg(D.stateNode),ue=Z,de=oe;break}case 5:f||Ga(D,T);case 6:if(Io){if(Z=ue,oe=de,ue=null,fc(b,T,D),ue=Z,de=oe,ue!==null)if(de)try{jm(ue,D.stateNode)}catch(_e){ei(D,T,_e)}else try{Hg(ue,D.stateNode)}catch(_e){ei(D,T,_e)}}else fc(b,T,D);break;case 18:Io&&ue!==null&&(de?Cb(ue,D.stateNode):Rb(ue,D.stateNode));break;case 4:Io?(Z=ue,oe=de,ue=D.stateNode.containerInfo,de=!0,fc(b,T,D),ue=Z,de=oe):(Pl&&Cm(D.stateNode,D,Hm()),fc(b,T,D));break;case 0:case 11:case 14:case 15:f||uc(2,D,T),f||uc(4,D,T),fc(b,T,D);break;case 1:f||(Ga(D,T),Z=D.stateNode,typeof Z.componentWillUnmount=="function"&&Bu(D,T,Z)),fc(b,T,D);break;case 21:fc(b,T,D);break;case 22:f||Ga(D,T),f=(Z=f)||D.memoizedState!==null,fc(b,T,D),f=Z;break;default:fc(b,T,D)}}function ju(b,T){if(gc&&T.memoizedState===null&&(b=T.alternate,b!==null&&(b=b.memoizedState,b!==null&&(b=b.dehydrated,b!==null))))try{R_(b)}catch(D){ei(T,T.return,D)}}function zu(b){switch(b.tag){case 13:case 19:var T=b.stateNode;return T===null&&(T=b.stateNode=new R),T;case 22:return b=b.stateNode,T=b._retryCache,T===null&&(T=b._retryCache=new R),T;default:throw Error(i(435,b.tag))}}function Sf(b,T){var D=zu(b);T.forEach(function(Z){var oe=d_.bind(null,b,Z);D.has(Z)||(D.add(Z),Z.then(oe,oe))})}function Hi(b,T){var D=T.deletions;if(D!==null)for(var Z=0;Z<D.length;Z++){var oe=D[Z],_e=b,$e=T;if(Io){var ft=$e;e:for(;ft!==null;){switch(ft.tag){case 27:case 5:ue=ft.stateNode,de=!1;break e;case 3:ue=ft.stateNode.containerInfo,de=!0;break e;case 4:ue=ft.stateNode.containerInfo,de=!0;break e}ft=ft.return}if(ue===null)throw Error(i(160));Qc(_e,$e,oe),ue=null,de=!1}else Qc(_e,$e,oe);_e=oe.alternate,_e!==null&&(_e.return=null),oe.return=null}if(T.subtreeFlags&13878)for(T=T.child;T!==null;)l_(T,b),T=T.sibling}function l_(b,T){var D=b.alternate,Z=b.flags;switch(b.tag){case 0:case 11:case 14:case 15:Hi(T,b),os(b),Z&4&&(uc(3,b,b.return),Tm(3,b),uc(5,b,b.return));break;case 1:Hi(T,b),os(b),Z&512&&(f||D===null||Ga(D,D.return)),Z&64&&S&&(b=b.updateQueue,b!==null&&(Z=b.callbacks,Z!==null&&(D=b.shared.hiddenCallbacks,b.shared.hiddenCallbacks=D===null?Z:D.concat(Z))));break;case 26:if(ol){var oe=be;Hi(T,b),os(b),Z&512&&(f||D===null||Ga(D,D.return)),Z&4&&(Z=D!==null?D.memoizedState:null,T=b.memoizedState,D===null?T===null?b.stateNode===null?b.stateNode=iy(oe,b.type,b.memoizedProps,b):Wm(oe,b.type,b.stateNode):b.stateNode=ny(oe,T,b.memoizedProps):Z!==T?(Z===null?D.stateNode!==null&&Rp(D.stateNode):ry(Z),T===null?Wm(oe,b.type,b.stateNode):ny(oe,T,b.memoizedProps)):T===null&&b.stateNode!==null&&c_(b,b.memoizedProps,D.memoizedProps));break}case 27:if(Xo&&Z&4&&b.alternate===null){oe=b.stateNode;var _e=b.memoizedProps;try{Wg(oe),Kg(b.type,_e,oe,b)}catch(mn){ei(b,b.return,mn)}}case 5:if(Hi(T,b),os(b),Z&512&&(f||D===null||Ga(D,D.return)),Io){if(b.flags&32){T=b.stateNode;try{bd(T)}catch(mn){ei(b,b.return,mn)}}Z&4&&b.stateNode!=null&&(T=b.memoizedProps,c_(b,T,D!==null?D.memoizedProps:T)),Z&1024&&(_=!0)}break;case 6:if(Hi(T,b),os(b),Z&4&&Io){if(b.stateNode===null)throw Error(i(162));Z=b.memoizedProps,D=D!==null?D.memoizedProps:Z,T=b.stateNode;try{zg(T,D,Z)}catch(mn){ei(b,b.return,mn)}}break;case 3:if(ol?(Bl(),oe=be,be=wp(T.containerInfo),Hi(T,b),be=oe):Hi(T,b),os(b),Z&4){if(Io&&gc&&D!==null&&D.memoizedState.isDehydrated)try{$g(T.containerInfo)}catch(mn){ei(b,b.return,mn)}if(Pl){Z=T.containerInfo,D=T.pendingChildren;try{yu(Z,D)}catch(mn){ei(b,b.return,mn)}}}_&&(_=!1,u_(b));break;case 4:ol?(D=be,be=wp(b.stateNode.containerInfo),Hi(T,b),os(b),be=D):(Hi(T,b),os(b)),Z&4&&Pl&&Cm(b.stateNode,b,b.stateNode.pendingChildren);break;case 12:Hi(T,b),os(b);break;case 13:Hi(T,b),os(b),b.child.flags&8192&&b.memoizedState!==null!=(D!==null&&D.memoizedState!==null)&&(Li=tr()),Z&4&&(Z=b.updateQueue,Z!==null&&(b.updateQueue=null,Sf(b,Z)));break;case 22:Z&512&&(f||D===null||Ga(D,D.return)),oe=b.memoizedState!==null;var $e=D!==null&&D.memoizedState!==null,ft=S,Ct=f;if(S=ft||oe,f=Ct||$e,Hi(T,b),f=Ct,S=ft,os(b),T=b.stateNode,T._current=b,T._visibility&=-3,T._visibility|=T._pendingVisibility&2,Z&8192&&(T._visibility=oe?T._visibility&-2:T._visibility|1,oe&&(T=S||f,D===null||$e||T||ud(b)),Io&&(b.memoizedProps===null||b.memoizedProps.mode!=="manual"))){e:if(D=null,Io)for(T=b;;){if(T.tag===5||ol&&T.tag===26||Xo&&T.tag===27){if(D===null){$e=D=T;try{_e=$e.stateNode,oe?Ed(_e):qg($e.stateNode,$e.memoizedProps)}catch(mn){ei($e,$e.return,mn)}}}else if(T.tag===6){if(D===null){$e=T;try{var Jt=$e.stateNode;oe?Dl(Jt):v_(Jt,$e.memoizedProps)}catch(mn){ei($e,$e.return,mn)}}}else if((T.tag!==22&&T.tag!==23||T.memoizedState===null||T===b)&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===b)break e;for(;T.sibling===null;){if(T.return===null||T.return===b)break e;D===T&&(D=null),T=T.return}D===T&&(D=null),T.sibling.return=T.return,T=T.sibling}}Z&4&&(Z=b.updateQueue,Z!==null&&(D=Z.retryQueue,D!==null&&(Z.retryQueue=null,Sf(b,D))));break;case 19:Hi(T,b),os(b),Z&4&&(Z=b.updateQueue,Z!==null&&(b.updateQueue=null,Sf(b,Z)));break;case 21:break;default:Hi(T,b),os(b)}}function os(b){var T=b.flags;if(T&2){try{if(Io&&(!Xo||b.tag!==27)){e:{for(var D=b.return;D!==null;){if(Hr(D)){var Z=D;break e}D=D.return}throw Error(i(160))}switch(Z.tag){case 27:if(Xo){var oe=Z.stateNode,_e=Ti(b);Rm(b,_e,oe);break}case 5:var $e=Z.stateNode;Z.flags&32&&(bd($e),Z.flags&=-33);var ft=Ti(b);Rm(b,ft,$e);break;case 3:case 4:var Ct=Z.stateNode.containerInfo,Jt=Ti(b);wm(b,Jt,Ct);break;default:throw Error(i(161))}}}catch(mn){ei(b,b.return,mn)}b.flags&=-3}T&4096&&(b.flags&=-4097)}function u_(b){if(b.subtreeFlags&1024)for(b=b.child;b!==null;){var T=b;u_(T),T.tag===5&&T.flags&1024&&sr(T.stateNode),b=b.sibling}}function ca(b,T){if(T.subtreeFlags&8772)for(T=T.child;T!==null;)ss(b,T.alternate,T),T=T.sibling}function ud(b){for(b=b.child;b!==null;){var T=b;switch(T.tag){case 0:case 11:case 14:case 15:uc(4,T,T.return),ud(T);break;case 1:Ga(T,T.return);var D=T.stateNode;typeof D.componentWillUnmount=="function"&&Bu(T,T.return,D),ud(T);break;case 26:case 27:case 5:Ga(T,T.return),ud(T);break;case 22:Ga(T,T.return),T.memoizedState===null&&ud(T);break;default:ud(T)}b=b.sibling}}function Vo(b,T,D){for(D=D&&(T.subtreeFlags&8772)!==0,T=T.child;T!==null;){var Z=T.alternate,oe=b,_e=T,$e=_e.flags;switch(_e.tag){case 0:case 11:case 15:Vo(oe,_e,D),Tm(4,_e);break;case 1:if(Vo(oe,_e,D),Z=_e,oe=Z.stateNode,typeof oe.componentDidMount=="function")try{oe.componentDidMount()}catch(Jt){ei(Z,Z.return,Jt)}if(Z=_e,oe=Z.updateQueue,oe!==null){var ft=Z.stateNode;try{var Ct=oe.shared.hiddenCallbacks;if(Ct!==null)for(oe.shared.hiddenCallbacks=null,oe=0;oe<Ct.length;oe++)Pe(Ct[oe],ft)}catch(Jt){ei(Z,Z.return,Jt)}}D&&$e&64&&sh(_e),ld(_e,_e.return);break;case 26:case 27:case 5:Vo(oe,_e,D),D&&Z===null&&$e&4&&Ng(_e),ld(_e,_e.return);break;case 12:Vo(oe,_e,D);break;case 13:Vo(oe,_e,D),D&&$e&4&&ju(oe,_e);break;case 22:_e.memoizedState===null&&Vo(oe,_e,D),ld(_e,_e.return);break;default:Vo(oe,_e,D)}T=T.sibling}}function hc(b,T){var D=null;b!==null&&b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(D=b.memoizedState.cachePool.pool),b=null,T.memoizedState!==null&&T.memoizedState.cachePool!==null&&(b=T.memoizedState.cachePool.pool),b!==D&&(b!=null&&b.refCount++,D!=null&&du(D))}function gr(b,T){b=null,T.alternate!==null&&(b=T.alternate.memoizedState.cache),T=T.memoizedState.cache,T!==b&&(T.refCount++,b!=null&&du(b))}function he(b,T,D,Z){if(T.subtreeFlags&10256)for(T=T.child;T!==null;)dc(b,T,D,Z),T=T.sibling}function dc(b,T,D,Z){var oe=T.flags;switch(T.tag){case 0:case 11:case 15:he(b,T,D,Z),oe&2048&&Tm(9,T);break;case 3:he(b,T,D,Z),oe&2048&&(b=null,T.alternate!==null&&(b=T.alternate.memoizedState.cache),T=T.memoizedState.cache,T!==b&&(T.refCount++,b!=null&&du(b)));break;case 12:if(oe&2048){he(b,T,D,Z),b=T.stateNode;try{var _e=T.memoizedProps,$e=_e.id,ft=_e.onPostCommit;typeof ft=="function"&&ft($e,T.alternate===null?"mount":"update",b.passiveEffectDuration,-0)}catch(Ct){ei(T,T.return,Ct)}}else he(b,T,D,Z);break;case 23:break;case 22:_e=T.stateNode,T.memoizedState!==null?_e._visibility&4?he(b,T,D,Z):Ji(b,T):_e._visibility&4?he(b,T,D,Z):(_e._visibility|=4,Ml(b,T,D,Z,(T.subtreeFlags&10256)!==0)),oe&2048&&hc(T.alternate,T);break;case 24:he(b,T,D,Z),oe&2048&&gr(T.alternate,T);break;default:he(b,T,D,Z)}}function Ml(b,T,D,Z,oe){for(oe=oe&&(T.subtreeFlags&10256)!==0,T=T.child;T!==null;){var _e=b,$e=T,ft=D,Ct=Z,Jt=$e.flags;switch($e.tag){case 0:case 11:case 15:Ml(_e,$e,ft,Ct,oe),Tm(8,$e);break;case 23:break;case 22:var mn=$e.stateNode;$e.memoizedState!==null?mn._visibility&4?Ml(_e,$e,ft,Ct,oe):Ji(_e,$e):(mn._visibility|=4,Ml(_e,$e,ft,Ct,oe)),oe&&Jt&2048&&hc($e.alternate,$e);break;case 24:Ml(_e,$e,ft,Ct,oe),oe&&Jt&2048&&gr($e.alternate,$e);break;default:Ml(_e,$e,ft,Ct,oe)}T=T.sibling}}function Ji(b,T){if(T.subtreeFlags&10256)for(T=T.child;T!==null;){var D=b,Z=T,oe=Z.flags;switch(Z.tag){case 22:Ji(D,Z),oe&2048&&hc(Z.alternate,Z);break;case 24:Ji(D,Z),oe&2048&&gr(Z.alternate,Z);break;default:Ji(D,Z)}T=T.sibling}}function vn(b){if(b.subtreeFlags&Ce)for(b=b.child;b!==null;)Mo(b),b=b.sibling}function Mo(b){switch(b.tag){case 26:vn(b),b.flags&Ce&&(b.memoizedState!==null?sy(be,b.memoizedState,b.memoizedProps):bp(b.type,b.memoizedProps));break;case 5:vn(b),b.flags&Ce&&bp(b.type,b.memoizedProps);break;case 3:case 4:if(ol){var T=be;be=wp(b.stateNode.containerInfo),vn(b),be=T}else vn(b);break;case 22:b.memoizedState===null&&(T=b.alternate,T!==null&&T.memoizedState!==null?(T=Ce,Ce=16777216,vn(b),Ce=T):vn(b));break;default:vn(b)}}function Go(b){var T=b.alternate;if(T!==null&&(b=T.child,b!==null)){T.child=null;do T=b.sibling,b.sibling=null,b=T;while(b!==null)}}function Ni(b){var T=b.deletions;if((b.flags&16)!==0){if(T!==null)for(var D=0;D<T.length;D++){var Z=T[D];U=Z,Pg(Z,b)}Go(b)}if(b.subtreeFlags&10256)for(b=b.child;b!==null;)Xt(b),b=b.sibling}function Xt(b){switch(b.tag){case 0:case 11:case 15:Ni(b),b.flags&2048&&uc(9,b,b.return);break;case 3:Ni(b);break;case 12:Ni(b);break;case 22:var T=b.stateNode;b.memoizedState!==null&&T._visibility&4&&(b.return===null||b.return.tag!==13)?(T._visibility&=-5,ai(b)):Ni(b);break;default:Ni(b)}}function ai(b){var T=b.deletions;if((b.flags&16)!==0){if(T!==null)for(var D=0;D<T.length;D++){var Z=T[D];U=Z,Pg(Z,b)}Go(b)}for(b=b.child;b!==null;){switch(T=b,T.tag){case 0:case 11:case 15:uc(8,T,T.return),ai(T);break;case 22:D=T.stateNode,D._visibility&4&&(D._visibility&=-5,ai(T));break;default:ai(T)}b=b.sibling}}function Pg(b,T){for(;U!==null;){var D=U;switch(D.tag){case 0:case 11:case 15:uc(8,D,T);break;case 23:case 22:if(D.memoizedState!==null&&D.memoizedState.cachePool!==null){var Z=D.memoizedState.cachePool.pool;Z!=null&&Z.refCount++}break;case 24:du(D.memoizedState.cache)}if(Z=D.child,Z!==null)Z.return=D,U=Z;else e:for(D=b;U!==null;){Z=U;var oe=Z.sibling,_e=Z.return;if(Fu(Z),Z===D){U=null;break e}if(oe!==null){oe.return=_e,U=oe;break e}U=_e}}}function oh(b){var T=jg(b);if(T!=null){if(typeof T.memoizedProps["data-testname"]!="string")throw Error(i(364));return T}if(b=Bm(b),b===null)throw Error(i(362));return b.stateNode.current}function ap(b,T){var D=b.tag;switch(T.$$typeof){case Fe:if(b.type===T.value)return!0;break;case ot:e:{for(T=T.value,b=[b,0],D=0;D<b.length;){var Z=b[D++],oe=Z.tag,_e=b[D++],$e=T[_e];if(oe!==5&&oe!==26&&oe!==27||!dh(Z)){for(;$e!=null&&ap(Z,$e);)_e++,$e=T[_e];if(_e===T.length){T=!0;break e}else for(Z=Z.child;Z!==null;)b.push(Z,_e),Z=Z.sibling}}T=!1}return T;case _t:if((D===5||D===26||D===27)&&g_(b.stateNode,T.value))return!0;break;case ht:if((D===5||D===6||D===26||D===27)&&(b=ha(b),b!==null&&0<=b.indexOf(T.value)))return!0;break;case Tt:if((D===5||D===26||D===27)&&(b=b.memoizedProps["data-testname"],typeof b=="string"&&b.toLowerCase()===T.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function Am(b){switch(b.$$typeof){case Fe:return"<"+(o(b.value)||"Unknown")+">";case ot:return":has("+(Am(b)||"")+")";case _t:return'[role="'+b.value+'"]';case ht:return'"'+b.value+'"';case Tt:return'[data-testname="'+b.value+'"]';default:throw Error(i(365))}}function xf(b,T){var D=[];b=[b,0];for(var Z=0;Z<b.length;){var oe=b[Z++],_e=oe.tag,$e=b[Z++],ft=T[$e];if(_e!==5&&_e!==26&&_e!==27||!dh(oe)){for(;ft!=null&&ap(oe,ft);)$e++,ft=T[$e];if($e===T.length)D.push(oe);else for(oe=oe.child;oe!==null;)b.push(oe,$e),oe=oe.sibling}}return D}function el(b,T){if(!Fc)throw Error(i(363));b=oh(b),b=xf(b,T),T=[],b=Array.from(b);for(var D=0;D<b.length;){var Z=b[D++],oe=Z.tag;if(oe===5||oe===26||oe===27)dh(Z)||T.push(Z.stateNode);else for(Z=Z.child;Z!==null;)b.push(Z),Z=Z.sibling}return T}function $o(){if((mt&2)!==0&&Bt!==0)return Bt&-Bt;if(yr.T!==null){var b=ls;return b!==0?b:Ft()}return fh()}function cp(){Fr===0&&(Fr=(Bt&536870912)===0||An?I():536870912);var b=ul.current;return b!==null&&(b.flags|=32),Fr}function la(b,T,D){(b===Et&&It===2||b.cancelPendingCommit!==null)&&(so(b,0),tl(b,Bt,Fr,!1)),K(b,D),((mt&2)===0||b!==Et)&&(b===Et&&((mt&2)===0&&(mr|=D),bn===4&&tl(b,Bt,Fr,!1)),ve(b))}function Wo(b,T,D){if((mt&6)!==0)throw Error(i(327));var Z=!D&&(T&60)===0&&(T&b.expiredLanes)===0||k(b,T),oe=Z?_s(b,T):ch(b,T,!0),_e=Z;do{if(oe===0){hn&&!Z&&tl(b,T,0,!1);break}else if(oe===6)tl(b,T,0,!Zt);else{if(D=b.current.alternate,_e&&!Ls(D)){oe=ch(b,T,!1),_e=!1;continue}if(oe===2){if(_e=T,b.errorRecoveryDisabledLanes&_e)var $e=0;else $e=b.pendingLanes&-536870913,$e=$e!==0?$e:$e&536870912?536870912:0;if($e!==0){T=$e;e:{var ft=b;oe=pi;var Ct=gc&&ft.current.memoizedState.isDehydrated;if(Ct&&(so(ft,$e).flags|=256),$e=ch(ft,$e,!1),$e!==2){if(In&&!Ct){ft.errorRecoveryDisabledLanes|=_e,mr|=_e,oe=4;break e}_e=li,li=oe,_e!==null&&ah(_e)}oe=$e}if(_e=!1,oe!==2)continue}}if(oe===1){so(b,0),tl(b,T,0,!0);break}e:{switch(Z=b,oe){case 0:case 1:throw Error(i(345));case 4:if((T&4194176)===T){tl(Z,T,Fr,!Zt);break e}break;case 2:li=null;break;case 3:case 5:break;default:throw Error(i(329))}if(Z.finishedWork=D,Z.finishedLanes=T,(T&62914560)===T&&(_e=Li+300-tr(),10<_e)){if(tl(Z,T,Fr,!Zt),A(Z,0)!==0)break e;Z.timeoutHandle=Dm($a.bind(null,Z,D,li,mi,ji,T,Fr,mr,Kr,Zt,2,-0,0),_e);break e}$a(Z,D,li,mi,ji,T,Fr,mr,Kr,Zt,0,-0,0)}}break}while(!0);ve(b)}function ah(b){li===null?li=b:li.push.apply(li,b)}function $a(b,T,D,Z,oe,_e,$e,ft,Ct,Jt,mn,Nn,Dn){var Sr=T.subtreeFlags;if((Sr&8192||(Sr&16785408)===16785408)&&(Um(),Mo(T),T=Af(),T!==null)){b.cancelPendingCommit=T(h_.bind(null,b,D,Z,oe,$e,ft,Ct,1,Nn,Dn)),tl(b,_e,$e,!Jt);return}h_(b,D,Z,oe,$e,ft,Ct,mn,Nn,Dn)}function Ls(b){for(var T=b;;){var D=T.tag;if((D===0||D===11||D===15)&&T.flags&16384&&(D=T.updateQueue,D!==null&&(D=D.stores,D!==null)))for(var Z=0;Z<D.length;Z++){var oe=D[Z],_e=oe.getSnapshot;oe=oe.value;try{if(!Ia(_e(),oe))return!1}catch{return!1}}if(D=T.child,T.subtreeFlags&16384&&D!==null)D.return=T,T=D;else{if(T===b)break;for(;T.sibling===null;){if(T.return===null||T.return===b)return!0;T=T.return}T.sibling.return=T.return,T=T.sibling}}return!0}function tl(b,T,D,Z){T&=~ti,T&=~mr,b.suspendedLanes|=T,b.pingedLanes&=~T,Z&&(b.warmLanes|=T),Z=b.expirationTimes;for(var oe=T;0<oe;){var _e=31-Eo(oe),$e=1<<_e;Z[_e]=-1,oe&=~$e}D!==0&&F(b,D,T)}function lp(){return(mt&6)===0?(Ae(0),!1):!0}function kl(){if(kt!==null){if(It===0)var b=kt.return;else b=kt,w=L=null,ps(b),jl=null,Su=0,b=kt;for(;b!==null;)Jv(b.alternate,b),b=b.return;kt=null}}function so(b,T){b.finishedWork=null,b.finishedLanes=0;var D=b.timeoutHandle;D!==uh&&(b.timeoutHandle=uh,yp(D)),D=b.cancelPendingCommit,D!==null&&(b.cancelPendingCommit=null,D()),kl(),Et=b,kt=D=Ca(b.current,null),Bt=T,It=0,Nt=null,Zt=!1,hn=k(b,T),In=!1,Kr=Fr=ti=mr=ir=bn=0,li=pi=null,ji=!1,(T&8)!==0&&(T|=T&32);var Z=b.entangledLanes;if(Z!==0)for(b=b.entanglements,Z&=T;0<Z;){var oe=31-Eo(Z),_e=1<<oe;T|=b[oe],Z&=~_e}return On=T,re(),D}function Mm(b,T){qr=null,yr.H=ea,T===Ms?(T=rt(),It=3):T===ma?(T=rt(),It=4):It=T===e0?8:T!==null&&typeof T=="object"&&typeof T.then=="function"?6:1,Nt=T,kt===null&&(bn=1,mf(b,te(T,b.current)))}function f_(){var b=ul.current;return b===null?!0:(Bt&4194176)===Bt?fl===null:(Bt&62914560)===Bt||(Bt&536870912)!==0?b===fl:!1}function Tf(){var b=yr.H;return yr.H=ea,b===null?ea:b}function km(){var b=yr.A;return yr.A=Oe,b}function Qr(){bn=4,Zt||(Bt&4194176)!==Bt&&ul.current!==null||(hn=!0),(ir&134217727)===0&&(mr&134217727)===0||Et===null||tl(Et,Bt,Fr,!1)}function ch(b,T,D){var Z=mt;mt|=2;var oe=Tf(),_e=km();(Et!==b||Bt!==T)&&(mi=null,so(b,T)),T=!1;var $e=bn;e:do try{if(It!==0&&kt!==null){var ft=kt,Ct=Nt;switch(It){case 8:kl(),$e=6;break e;case 3:case 2:case 6:ul.current===null&&(T=!0);var Jt=It;if(It=0,Nt=null,wf(b,ft,Ct,Jt),D&&hn){$e=0;break e}break;default:Jt=It,It=0,Nt=null,wf(b,ft,Ct,Jt)}}Dg(),$e=bn;break}catch(mn){Mm(b,mn)}while(!0);return T&&b.shellSuspendCounter++,w=L=null,mt=Z,yr.H=oe,yr.A=_e,kt===null&&(Et=null,Bt=0,re()),$e}function Dg(){for(;kt!==null;)Hu(kt)}function _s(b,T){var D=mt;mt|=2;var Z=Tf(),oe=km();Et!==b||Bt!==T?(mi=null,Vi=tr()+500,so(b,T)):hn=k(b,T);e:do try{if(It!==0&&kt!==null){T=kt;var _e=Nt;t:switch(It){case 1:It=0,Nt=null,wf(b,T,_e,1);break;case 2:if(Xe(_e)){It=0,Nt=null,pc(T);break}T=function(){It===2&&Et===b&&(It=7),ve(b)},_e.then(T,T);break e;case 3:It=7;break e;case 4:It=5;break e;case 7:Xe(_e)?(It=0,Nt=null,pc(T)):(It=0,Nt=null,wf(b,T,_e,7));break;case 5:var $e=null;switch(kt.tag){case 26:$e=kt.memoizedState;case 5:case 27:var ft=kt,Ct=ft.type,Jt=ft.pendingProps;if($e?Km($e):_c(Ct,Jt)){It=0,Nt=null;var mn=ft.sibling;if(mn!==null)kt=mn;else{var Nn=ft.return;Nn!==null?(kt=Nn,wi(Nn)):kt=null}break t}}It=0,Nt=null,wf(b,T,_e,5);break;case 6:It=0,Nt=null,wf(b,T,_e,6);break;case 8:kl(),bn=6;break e;default:throw Error(i(462))}}fd();break}catch(Dn){Mm(b,Dn)}while(!0);return w=L=null,yr.H=Z,yr.A=oe,mt=D,kt!==null?0:(Et=null,Bt=0,re(),bn)}function fd(){for(;kt!==null&&!kb();)Hu(kt)}function Hu(b){var T=Kn(b.alternate,b,On);b.memoizedProps=b.pendingProps,T===null?wi(b):kt=T}function pc(b){var T=b,D=T.alternate;switch(T.tag){case 15:case 0:T=Cl(D,T,T.pendingProps,T.type,void 0,Bt);break;case 11:T=Cl(D,T,T.pendingProps,T.type.render,T.ref,Bt);break;case 5:ps(T);default:Jv(D,T),T=kt=dp(T,On),T=Kn(D,T,On)}b.memoizedProps=b.pendingProps,T===null?wi(b):kt=T}function wf(b,T,D,Z){w=L=null,ps(T),jl=null,Su=0;var oe=T.return;try{if(op(b,oe,T,D,Bt)){bn=1,mf(b,te(D,b.current)),kt=null;return}}catch(_e){if(oe!==null)throw kt=oe,_e;bn=1,mf(b,te(D,b.current)),kt=null;return}T.flags&32768?(An||Z===1?b=!0:hn||(Bt&536870912)!==0?b=!1:(Zt=b=!0,(Z===2||Z===3||Z===6)&&(Z=ul.current,Z!==null&&Z.tag===13&&(Z.flags|=16384))),hd(T,b)):wi(T)}function wi(b){var T=b;do{if((T.flags&32768)!==0){hd(T,Zt);return}b=T.return;var D=Al(T.alternate,T,On);if(D!==null){kt=D;return}if(T=T.sibling,T!==null){kt=T;return}kt=T=b}while(T!==null);bn===0&&(bn=5)}function hd(b,T){do{var D=Zv(b.alternate,b);if(D!==null){D.flags&=32767,kt=D;return}if(D=b.return,D!==null&&(D.flags|=32768,D.subtreeFlags=0,D.deletions=null),!T&&(b=b.sibling,b!==null)){kt=b;return}kt=b=D}while(b!==null);bn=6,kt=null}function h_(b,T,D,Z,oe,_e,$e,ft,Ct,Jt){var mn=yr.T,Nn=bo();try{vs(2),yr.T=null,xb(b,T,D,Z,Nn,oe,_e,$e,ft,Ct,Jt)}finally{yr.T=mn,vs(Nn)}}function xb(b,T,D,Z,oe,_e,$e,ft){do mc();while(Gi!==null);if((mt&6)!==0)throw Error(i(327));var Ct=b.finishedWork;if(Z=b.finishedLanes,Ct===null)return null;if(b.finishedWork=null,b.finishedLanes=0,Ct===b.current)throw Error(i(177));b.callbackNode=null,b.callbackPriority=0,b.cancelPendingCommit=null;var Jt=Ct.lanes|Ct.childLanes;if(Jt|=ll,P(b,Z,Jt,_e,$e,ft),b===Et&&(kt=Et=null,Bt=0),(Ct.subtreeFlags&10256)===0&&(Ct.flags&10256)===0||$s||($s=!0,hl=Jt,bc=D,fp(ii,function(){return mc(),null})),D=(Ct.flags&15990)!==0,(Ct.subtreeFlags&15990)!==0||D?(D=yr.T,yr.T=null,_e=bo(),vs(2),$e=mt,mt|=4,Tn(b,Ct),l_(Ct,b),lh(b.containerInfo),b.current=Ct,ss(b,Ct.alternate,Ct),mh(),mt=$e,vs(_e),yr.T=D):b.current=Ct,$s?($s=!1,Gi=b,No=Z):dd(b,Jt),Jt=b.pendingLanes,Jt===0&&(es=null),G(Ct.stateNode),ve(b),T!==null)for(oe=b.onRecoverableError,Ct=0;Ct<T.length;Ct++)Jt=T[Ct],oe(Jt.value,{componentStack:Jt.stack});return(No&3)!==0&&mc(),Jt=b.pendingLanes,(Z&4194218)!==0&&(Jt&42)!==0?b===Hl?dl++:(dl=0,Hl=b):dl=0,Ae(0),null}function dd(b,T){(b.pooledCacheLanes&=T)===0&&(T=b.pooledCache,T!=null&&(b.pooledCache=null,du(T)))}function mc(){if(Gi!==null){var b=Gi,T=hl;hl=0;var D=X(No),Z=32>D?32:D;D=yr.T;var oe=bo();try{if(vs(Z),yr.T=null,Gi===null)var _e=!1;else{Z=bc,bc=null;var $e=Gi,ft=No;if(Gi=null,No=0,(mt&6)!==0)throw Error(i(331));var Ct=mt;if(mt|=4,Xt($e.current),dc($e,$e.current,ft,Z),mt=Ct,Ae(0,!1),Zs&&typeof Zs.onPostCommitFiberRoot=="function")try{Zs.onPostCommitFiberRoot(Ya,$e)}catch{}_e=!0}return _e}finally{vs(oe),yr.T=D,dd(b,T)}}return!1}function Pn(b,T,D){T=te(D,T),T=wa(b.stateNode,T,2),b=we(b,T,2),b!==null&&(K(b,2),ve(b))}function ei(b,T,D){if(b.tag===3)Pn(b,b,D);else for(;T!==null;){if(T.tag===3){Pn(T,b,D);break}else if(T.tag===1){var Z=T.stateNode;if(typeof T.type.getDerivedStateFromError=="function"||typeof Z.componentDidCatch=="function"&&(es===null||!es.has(Z))){b=te(D,b),D=qa(2),Z=we(T,D,2),Z!==null&&(rh(D,Z,T,b),K(Z,2),ve(Z));break}}T=T.return}}function qu(b,T,D){var Z=b.pingCache;if(Z===null){Z=b.pingCache=new xt;var oe=new Set;Z.set(T,oe)}else oe=Z.get(T),oe===void 0&&(oe=new Set,Z.set(T,oe));oe.has(D)||(In=!0,oe.add(D),b=ko.bind(null,b,T,D),T.then(b,b))}function ko(b,T,D){var Z=b.pingCache;Z!==null&&Z.delete(T),b.pingedLanes|=b.suspendedLanes&D,b.warmLanes&=~D,Et===b&&(Bt&D)===D&&(bn===4||bn===3&&(Bt&62914560)===Bt&&300>tr()-Li?(mt&2)===0&&so(b,0):ti|=D,Kr===Bt&&(Kr=0)),ve(b)}function Om(b,T){T===0&&(T=z()),b=Ue(b,T),b!==null&&(K(b,T),ve(b))}function up(b){var T=b.memoizedState,D=0;T!==null&&(D=T.retryLane),Om(b,D)}function d_(b,T){var D=0;switch(b.tag){case 13:var Z=b.stateNode,oe=b.memoizedState;oe!==null&&(D=oe.retryLane);break;case 19:Z=b.stateNode;break;case 22:Z=b.stateNode._retryCache;break;default:throw Error(i(314))}Z!==null&&Z.delete(T),Om(b,D)}function fp(b,T){return da(b,T)}function Lg(b,T,D,Z){this.tag=b,this.key=D,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=T,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=Z,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hp(b){return b=b.prototype,!(!b||!b.isReactComponent)}function Ca(b,T){var D=b.alternate;return D===null?(D=n(b.tag,T,b.key,b.mode),D.elementType=b.elementType,D.type=b.type,D.stateNode=b.stateNode,D.alternate=b,b.alternate=D):(D.pendingProps=T,D.type=b.type,D.flags=0,D.subtreeFlags=0,D.deletions=null),D.flags=b.flags&31457280,D.childLanes=b.childLanes,D.lanes=b.lanes,D.child=b.child,D.memoizedProps=b.memoizedProps,D.memoizedState=b.memoizedState,D.updateQueue=b.updateQueue,T=b.dependencies,D.dependencies=T===null?null:{lanes:T.lanes,firstContext:T.firstContext},D.sibling=b.sibling,D.index=b.index,D.ref=b.ref,D.refCleanup=b.refCleanup,D}function dp(b,T){b.flags&=31457282;var D=b.alternate;return D===null?(b.childLanes=0,b.lanes=T,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=D.childLanes,b.lanes=D.lanes,b.child=D.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=D.memoizedProps,b.memoizedState=D.memoizedState,b.updateQueue=D.updateQueue,b.type=D.type,T=D.dependencies,b.dependencies=T===null?null:{lanes:T.lanes,firstContext:T.firstContext}),b}function pp(b,T,D,Z,oe,_e){var $e=0;if(Z=b,typeof b=="function")hp(b)&&($e=1);else if(typeof b=="string")$e=ol&&Xo?Tp(b,D,si.current)?26:Yg(b)?27:5:ol?Tp(b,D,si.current)?26:5:Xo&&Yg(b)?27:5;else e:switch(b){case oo:return Vu(D.children,oe,_e,T);case Bs:$e=8,oe|=24;break;case Nc:return b=n(12,D,T,oe|2),b.elementType=Nc,b.lanes=_e,b;case Pc:return b=n(13,D,T,oe),b.elementType=Pc,b.lanes=_e,b;case Rf:return b=n(19,D,T,oe),b.elementType=Rf,b.lanes=_e,b;case mu:return mp(D,oe,_e,T);default:if(typeof b=="object"&&b!==null)switch(b.$$typeof){case Ug:case Oo:$e=10;break e;case Il:$e=9;break e;case $u:$e=11;break e;case Nl:$e=14;break e;case Ma:$e=16,Z=null;break e}$e=29,D=Error(i(130,b===null?"null":typeof b,"")),Z=null}return T=n($e,D,T,oe),T.elementType=b,T.type=Z,T.lanes=_e,T}function Vu(b,T,D,Z){return b=n(7,b,Z,T),b.lanes=D,b}function mp(b,T,D,Z){b=n(22,b,Z,T),b.elementType=mu,b.lanes=D;var oe={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var _e=oe._current;if(_e===null)throw Error(i(456));if((oe._pendingVisibility&2)===0){var $e=Ue(_e,2);$e!==null&&(oe._pendingVisibility|=2,la($e,_e,2))}},attach:function(){var _e=oe._current;if(_e===null)throw Error(i(456));if((oe._pendingVisibility&2)!==0){var $e=Ue(_e,2);$e!==null&&(oe._pendingVisibility&=-3,la($e,_e,2))}}};return b.stateNode=oe,b}function gp(b,T,D){return b=n(6,b,null,T),b.lanes=D,b}function Ol(b,T,D){return T=n(4,b.children!==null?b.children:[],b.key,T),T.lanes=D,T.stateNode={containerInfo:b.containerInfo,pendingChildren:null,implementation:b.implementation},T}function Gu(b,T,D,Z,oe,_e,$e,ft){this.tag=1,this.containerInfo=b,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=uh,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=H(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=H(0),this.hiddenUpdates=H(null),this.identifierPrefix=Z,this.onUncaughtError=oe,this.onCaughtError=_e,this.onRecoverableError=$e,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ft,this.incompleteTransitions=new Map}function fr(b,T,D,Z,oe,_e,$e,ft,Ct,Jt,mn,Nn){return b=new Gu(b,T,D,$e,ft,Ct,Jt,Nn),T=1,_e===!0&&(T|=24),_e=n(3,null,null,T),b.current=_e,_e.stateNode=b,T=Sm(),T.refCount++,b.pooledCache=T,T.refCount++,_e.memoizedState={element:Z,isDehydrated:D,cache:T},ce(_e),b}function Br(b){return b?(b=Mf,b):Mf}function Aa(b){var T=b._reactInternals;if(T===void 0)throw typeof b.render=="function"?Error(i(188)):(b=Object.keys(b).join(","),Error(i(268,b)));return b=m(T),b=b!==null?p(b):null,b===null?null:il(b.stateNode)}function nl(b,T,D,Z,oe,_e){oe=Br(oe),Z.context===null?Z.context=oe:Z.pendingContext=oe,Z=le(T),Z.payload={element:D},_e=_e===void 0?null:_e,_e!==null&&(Z.callback=_e),D=we(b,Z,T),D!==null&&(la(D,b,T),Me(D,b,T))}function ri(b,T){if(b=b.memoizedState,b!==null&&b.dehydrated!==null){var D=b.retryLane;b.retryLane=D!==0&&D<T?D:T}}function Im(b,T){ri(b,T),(b=b.alternate)&&ri(b,T)}var wr={},rl=n3(),Us=kee(),pd=Object.assign,md=Symbol.for("react.element"),ua=Symbol.for("react.transitional.element"),pu=Symbol.for("react.portal"),oo=Symbol.for("react.fragment"),Bs=Symbol.for("react.strict_mode"),Nc=Symbol.for("react.profiler"),Ug=Symbol.for("react.provider"),Il=Symbol.for("react.consumer"),Oo=Symbol.for("react.context"),$u=Symbol.for("react.forward_ref"),Pc=Symbol.for("react.suspense"),Rf=Symbol.for("react.suspense_list"),Nl=Symbol.for("react.memo"),Ma=Symbol.for("react.lazy"),mu=Symbol.for("react.offscreen"),gu=Symbol.for("react.memo_cache_sentinel"),Dc=Symbol.iterator,Bg=Symbol.for("react.client.reference"),yr=rl.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_p,Fg,Nm=!1,gd=Array.isArray,Wa=e.rendererVersion,As=e.rendererPackageName,Lc=e.extraDevToolsConfig,il=e.getPublicInstance,_d=e.getRootHostContext,p_=e.getChildHostContext,m_=e.prepareForCommit,lh=e.resetAfterCommit,_u=e.createInstance,ka=e.appendInitialChild,Pm=e.finalizeInitialChildren,Cf=e.shouldSetTextContent,vp=e.createTextInstance,Dm=e.scheduleTimeout,yp=e.cancelTimeout,uh=e.noTimeout,sl=e.isPrimaryRenderer;e.warnsIfNotActing;var Io=e.supportsMutation,Pl=e.supportsPersistence,gc=e.supportsHydration,jg=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var Lm=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var vs=e.setCurrentUpdatePriority,bo=e.getCurrentUpdatePriority,fh=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var hh=e.shouldAttemptEagerTransition,vd=e.detachDeletedInstance;e.requestPostPaintCallback;var Oa=e.maySuspendCommit,_c=e.preloadInstance,Um=e.startSuspendingCommit,bp=e.suspendInstance,Af=e.waitForCommitToBeReady,Uc=e.NotPendingTransition,Zn=e.HostTransitionContext,sr=e.resetFormInstance;e.bindToConsole;var yd=e.supportsMicrotasks,Bc=e.scheduleMicrotask,Fc=e.supportsTestSelectors,Bm=e.findFiberRoot,fa=e.getBoundingRect,ha=e.getTextContent,dh=e.isHiddenSubtree,g_=e.matchAccessibilityRole,vu=e.setFocusIfFocusable,Vs=e.setupIntersectionObserver,Ko=e.appendChild,Ep=e.appendChildToContainer,zg=e.commitTextUpdate,Sp=e.commitMount,Ys=e.commitUpdate,Fm=e.insertBefore,__=e.insertInContainerBefore,Hg=e.removeChild,jm=e.removeChildFromContainer,bd=e.resetTextContent,Ed=e.hideInstance,Dl=e.hideTextInstance,qg=e.unhideInstance,v_=e.unhideTextInstance,zm=e.clearContainer,xp=e.cloneInstance,Hm=e.createContainerChildSet,Ll=e.appendChildToContainerChildSet,Ka=e.finalizeContainerChildren,yu=e.replaceContainerChildren,qm=e.cloneHiddenInstance,y_=e.cloneHiddenTextInstance,Vm=e.isSuspenseInstancePending,Vg=e.isSuspenseInstanceFallback,b_=e.getSuspenseInstanceFallbackErrorDetails,E_=e.registerSuspenseInstanceRetry,Gg=e.canHydrateFormStateMarker,Qv=e.isFormStateMarkerMatching,Gm=e.getNextHydratableSibling,ey=e.getFirstHydratableChild,Ul=e.getFirstHydratableChildWithinContainer,Xa=e.getFirstHydratableChildWithinSuspenseInstance,$m=e.canHydrateInstance,S_=e.canHydrateTextInstance,x_=e.canHydrateSuspenseInstance,T_=e.hydrateInstance,Tb=e.hydrateTextInstance,wb=e.hydrateSuspenseInstance,w_=e.getNextHydratableInstanceAfterSuspenseInstance,$g=e.commitHydratedContainer,R_=e.commitHydratedSuspenseInstance,Rb=e.clearSuspenseBoundary,Cb=e.clearSuspenseBoundaryFromContainer,C_=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var Ab=e.validateHydratableInstance,Mb=e.validateHydratableTextInstance,ol=e.supportsResources,Tp=e.isHostHoistableType,wp=e.getHoistableRoot,ty=e.getResource,ny=e.acquireResource,ry=e.releaseResource,iy=e.hydrateHoistable,Wm=e.mountHoistable,Rp=e.unmountHoistable,jc=e.createHoistableInstance,Bl=e.prepareToCommitHoistables,qi=e.mayResourceSuspendCommit,Km=e.preloadResource,sy=e.suspendResource,Xo=e.supportsSingletons,Sd=e.resolveSingletonInstance,Wg=e.clearSingleton,Kg=e.acquireSingletonInstance,Xg=e.releaseSingletonInstance,Yg=e.isHostSingletonType,Zg=[],Cp=-1,Mf={},Eo=Math.clz32?Math.clz32:E,Yo=Math.log,Jg=Math.LN2,ph=128,Xm=4194304,da=Us.unstable_scheduleCallback,ys=Us.unstable_cancelCallback,kb=Us.unstable_shouldYield,mh=Us.unstable_requestPaint,tr=Us.unstable_now,ar=Us.unstable_ImmediatePriority,vc=Us.unstable_UserBlockingPriority,ii=Us.unstable_NormalPriority,as=Us.unstable_IdlePriority,Fs=Us.log,xd=Us.unstable_setDisableYieldValue,Ya=null,Zs=null,Ia=typeof Object.is=="function"?Object.is:q,bs=new WeakMap,_r=[],Pi=0,Js=null,Fl=0,di=[],Qs=0,bu=null,cs=1,Qi="",si=y(null),ao=y(null),zc=y(null),yc=y(null),Xn=null,Wn=null,An=!1,eo=null,Wr=!1,Di=Error(i(519)),al=[],cl=0,ll=0,gh=null,Ap=null,A_=!1,Mp=!1,Td=!1,Zo=0,pa=null,Eu=0,ls=0,Mr=null,co=!1,kp=!1,Wu=Object.prototype.hasOwnProperty,Ms=Error(i(460)),ma=Error(i(474)),wd={then:function(){}},kf=null,jl=null,Su=0,Of=tn(!0),Qg=tn(!1),_h=y(null),Op=y(0),ul=y(null),fl=null,So=y(0),vh=0,qr=null,kr=null,Gs=null,zl=!1,yh=!1,If=!1,Ym=0,Jo=0,xo=null,Qo=0,Za=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},ea={readContext:qs,use:Dt,useCallback:Ln,useContext:Ln,useEffect:Ln,useImperativeHandle:Ln,useLayoutEffect:Ln,useInsertionEffect:Ln,useMemo:Ln,useReducer:Ln,useRef:Ln,useState:Ln,useDebugValue:Ln,useDeferredValue:Ln,useTransition:Ln,useSyncExternalStore:Ln,useId:Ln};ea.useCacheRefresh=Ln,ea.useMemoCache=Ln,ea.useHostTransitionStatus=Ln,ea.useFormState=Ln,ea.useActionState=Ln,ea.useOptimistic=Ln;var xu={readContext:qs,use:Dt,useCallback:function(b,T){return je().memoizedState=[b,T===void 0?null:T],b},useContext:qs,useEffect:mm,useImperativeHandle:function(b,T,D){D=D!=null?D.concat([b]):null,Rs(4194308,4,Ha.bind(null,T,b),D)},useLayoutEffect:function(b,T){return Rs(4194308,4,b,T)},useInsertionEffect:function(b,T){Rs(4,2,b,T)},useMemo:function(b,T){var D=je();T=T===void 0?null:T;var Z=b();if(If){j(!0);try{b()}finally{j(!1)}}return D.memoizedState=[Z,T],Z},useReducer:function(b,T,D){var Z=je();if(D!==void 0){var oe=D(T);if(If){j(!0);try{D(T)}finally{j(!1)}}}else oe=T;return Z.memoizedState=Z.baseState=oe,b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:b,lastRenderedState:oe},Z.queue=b,b=b.dispatch=Zc.bind(null,qr,b),[Z.memoizedState,b]},useRef:function(b){var T=je();return b={current:b},T.memoizedState=b},useState:function(b){b=Ar(b);var T=b.queue,D=vo.bind(null,qr,T);return T.dispatch=D,[b.memoizedState,D]},useDebugValue:lc,useDeferredValue:function(b,T){var D=je();return Xc(D,b,T)},useTransition:function(){var b=Ar(!1);return b=nh.bind(null,qr,b.queue,!0,!1),je().memoizedState=b,[!1,b]},useSyncExternalStore:function(b,T,D){var Z=qr,oe=je();if(An){if(D===void 0)throw Error(i(407));D=D()}else{if(D=T(),Et===null)throw Error(i(349));(Bt&60)!==0||cr(Z,T,D)}oe.memoizedState=D;var _e={value:D,getSnapshot:T};return oe.queue=_e,mm(dr.bind(null,Z,_e,b),[b]),Z.flags|=2048,za(9,Fn.bind(null,Z,_e,D,T),{destroy:void 0},null),D},useId:function(){var b=je(),T=Et.identifierPrefix;if(An){var D=Qi,Z=cs;D=(Z&~(1<<32-Eo(Z)-1)).toString(32)+D,T=":"+T+"R"+D,D=Ym++,0<D&&(T+="H"+D.toString(32)),T+=":"}else D=Qo++,T=":"+T+"r"+D.toString(32)+":";return b.memoizedState=T},useCacheRefresh:function(){return je().memoizedState=s_.bind(null,qr)}};xu.useMemoCache=St,xu.useHostTransitionStatus=xi,xu.useFormState=ki,xu.useActionState=ki,xu.useOptimistic=function(b){var T=je();T.memoizedState=T.baseState=b;var D={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return T.queue=D,T=lu.bind(null,qr,!0,D),D.dispatch=T,[b,T]};var ci={readContext:qs,use:Dt,useCallback:kc,useContext:qs,useEffect:np,useImperativeHandle:Mc,useInsertionEffect:rp,useLayoutEffect:od,useMemo:gm,useReducer:xn,useRef:ms,useState:function(){return xn(nn)},useDebugValue:lc,useDeferredValue:function(b,T){var D=gt();return Yc(D,kr.memoizedState,b,T)},useTransition:function(){var b=xn(nn)[0],T=gt().memoizedState;return[typeof b=="boolean"?b:Pt(b),T]},useSyncExternalStore:ur,useId:au};ci.useCacheRefresh=kg,ci.useMemoCache=St,ci.useHostTransitionStatus=xi,ci.useFormState=kn,ci.useActionState=kn,ci.useOptimistic=function(b,T){var D=gt();return Ur(D,kr,b,T)};var bh={readContext:qs,use:Dt,useCallback:kc,useContext:qs,useEffect:np,useImperativeHandle:Mc,useInsertionEffect:rp,useLayoutEffect:od,useMemo:gm,useReducer:Un,useRef:ms,useState:function(){return Un(nn)},useDebugValue:lc,useDeferredValue:function(b,T){var D=gt();return kr===null?Xc(D,b,T):Yc(D,kr.memoizedState,b,T)},useTransition:function(){var b=Un(nn)[0],T=gt().memoizedState;return[typeof b=="boolean"?b:Pt(b),T]},useSyncExternalStore:ur,useId:au};bh.useCacheRefresh=kg,bh.useMemoCache=St,bh.useHostTransitionStatus=xi,bh.useFormState=Zi,bh.useActionState=Zi,bh.useOptimistic=function(b,T){var D=gt();return kr!==null?Ur(D,kr,b,T):(D.baseState=b,[b,D.queue.dispatch])};var M_={isMounted:function(b){return(b=b._reactInternals)?h(b)===b:!1},enqueueSetState:function(b,T,D){b=b._reactInternals;var Z=$o(),oe=le(Z);oe.payload=T,D!=null&&(oe.callback=D),T=we(b,oe,Z),T!==null&&(la(T,b,Z),Me(T,b,Z))},enqueueReplaceState:function(b,T,D){b=b._reactInternals;var Z=$o(),oe=le(Z);oe.tag=1,oe.payload=T,D!=null&&(oe.callback=D),T=we(b,oe,Z),T!==null&&(la(T,b,Z),Me(T,b,Z))},enqueueForceUpdate:function(b,T){b=b._reactInternals;var D=$o(),Z=le(D);Z.tag=2,T!=null&&(Z.callback=T),T=we(b,Z,D),T!==null&&(la(T,b,D),Me(T,b,D))}},Rd=typeof reportError=="function"?reportError:function(b){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var T=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof b=="object"&&b!==null&&typeof b.message=="string"?String(b.message):String(b),error:b});if(!window.dispatchEvent(T))return}else if(typeof Sa=="object"&&typeof Sa.emit=="function"){Sa.emit("uncaughtException",b);return}console.error(b)},e0=Error(i(461)),ga=!1,Ku={dehydrated:null,treeContext:null,retryLane:0},Eh=y(null),L=null,w=null,O=typeof AbortController<"u"?AbortController:function(){var b=[],T=this.signal={aborted:!1,addEventListener:function(D,Z){b.push(Z)}};this.abort=function(){T.aborted=!0,b.forEach(function(D){return D()})}},B=Us.unstable_scheduleCallback,V=Us.unstable_NormalPriority,Y={$$typeof:Oo,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},se=yr.S;yr.S=function(b,T){typeof T=="object"&&T!==null&&typeof T.then=="function"&&bt(b,T),se!==null&&se(b,T)};var me=y(null),S=!1,f=!1,_=!1,R=typeof WeakSet=="function"?WeakSet:Set,U=null,ee=!1,ue=null,de=!1,be=null,Ce=8192,Oe={getCacheForType:function(b){var T=qs(Y),D=T.data.get(b);return D===void 0&&(D=b(),T.data.set(b,D)),D}},Fe=0,ot=1,_t=2,Tt=3,ht=4;if(typeof Symbol=="function"&&Symbol.for){var st=Symbol.for;Fe=st("selector.component"),ot=st("selector.has_pseudo_class"),_t=st("selector.role"),Tt=st("selector.test_id"),ht=st("selector.text")}var xt=typeof WeakMap=="function"?WeakMap:Map,mt=0,Et=null,kt=null,Bt=0,It=0,Nt=null,Zt=!1,hn=!1,In=!1,On=0,bn=0,ir=0,mr=0,ti=0,Fr=0,Kr=0,pi=null,li=null,ji=!1,Li=0,Vi=1/0,mi=null,es=null,$s=!1,Gi=null,No=0,hl=0,bc=null,dl=0,Hl=null;return wr.attemptContinuousHydration=function(b){if(b.tag===13){var T=Ue(b,67108864);T!==null&&la(T,b,67108864),Im(b,67108864)}},wr.attemptHydrationAtCurrentPriority=function(b){if(b.tag===13){var T=$o(),D=Ue(b,T);D!==null&&la(D,b,T),Im(b,T)}},wr.attemptSynchronousHydration=function(b){switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var T=C(b.pendingLanes);if(T!==0){for(b.pendingLanes|=2,b.entangledLanes|=2;T;){var D=1<<31-Eo(T);b.entanglements[1]|=D,T&=~D}ve(b),(mt&6)===0&&(Vi=tr()+500,Ae(0))}}break;case 13:T=Ue(b,2),T!==null&&la(T,b,2),lp(),Im(b,2)}},wr.batchedUpdates=function(b,T){return b(T)},wr.createComponentSelector=function(b){return{$$typeof:Fe,value:b}},wr.createContainer=function(b,T,D,Z,oe,_e,$e,ft,Ct,Jt){return fr(b,T,!1,null,D,Z,_e,$e,ft,Ct,Jt,null)},wr.createHasPseudoClassSelector=function(b){return{$$typeof:ot,value:b}},wr.createHydrationContainer=function(b,T,D,Z,oe,_e,$e,ft,Ct,Jt,mn,Nn,Dn){return b=fr(D,Z,!0,b,oe,_e,ft,Ct,Jt,mn,Nn,Dn),b.context=Br(null),D=b.current,Z=$o(),oe=le(Z),oe.callback=T??null,we(D,oe,Z),b.current.lanes=Z,K(b,Z),ve(b),b},wr.createPortal=function(b,T,D){var Z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pu,key:Z==null?null:""+Z,children:b,containerInfo:T,implementation:D}},wr.createRoleSelector=function(b){return{$$typeof:_t,value:b}},wr.createTestNameSelector=function(b){return{$$typeof:Tt,value:b}},wr.createTextSelector=function(b){return{$$typeof:ht,value:b}},wr.defaultOnCaughtError=function(b){console.error(b)},wr.defaultOnRecoverableError=function(b){Rd(b)},wr.defaultOnUncaughtError=function(b){Rd(b)},wr.deferredUpdates=function(b){var T=yr.T,D=bo();try{return vs(32),yr.T=null,b()}finally{vs(D),yr.T=T}},wr.discreteUpdates=function(b,T,D,Z,oe){var _e=yr.T,$e=bo();try{return vs(2),yr.T=null,b(T,D,Z,oe)}finally{vs($e),yr.T=_e,mt===0&&(Vi=tr()+500)}},wr.findAllNodes=el,wr.findBoundingRects=function(b,T){if(!Fc)throw Error(i(363));T=el(b,T),b=[];for(var D=0;D<T.length;D++)b.push(fa(T[D]));for(T=b.length-1;0<T;T--){D=b[T];for(var Z=D.x,oe=Z+D.width,_e=D.y,$e=_e+D.height,ft=T-1;0<=ft;ft--)if(T!==ft){var Ct=b[ft],Jt=Ct.x,mn=Jt+Ct.width,Nn=Ct.y,Dn=Nn+Ct.height;if(Z>=Jt&&_e>=Nn&&oe<=mn&&$e<=Dn){b.splice(T,1);break}else if(Z!==Jt||D.width!==Ct.width||Dn<_e||Nn>$e){if(!(_e!==Nn||D.height!==Ct.height||mn<Z||Jt>oe)){Jt>Z&&(Ct.width+=Jt-Z,Ct.x=Z),mn<oe&&(Ct.width=oe-Jt),b.splice(T,1);break}}else{Nn>_e&&(Ct.height+=Nn-_e,Ct.y=_e),Dn<$e&&(Ct.height=$e-Nn),b.splice(T,1);break}}}return b},wr.findHostInstance=Aa,wr.findHostInstanceWithNoPortals=function(b){return b=m(b),b=b!==null?g(b):null,b===null?null:il(b.stateNode)},wr.findHostInstanceWithWarning=function(b){return Aa(b)},wr.flushPassiveEffects=mc,wr.flushSyncFromReconciler=function(b){var T=mt;mt|=1;var D=yr.T,Z=bo();try{if(vs(2),yr.T=null,b)return b()}finally{vs(Z),yr.T=D,mt=T,(mt&6)===0&&Ae(0)}},wr.flushSyncWork=lp,wr.focusWithin=function(b,T){if(!Fc)throw Error(i(363));for(b=oh(b),T=xf(b,T),T=Array.from(T),b=0;b<T.length;){var D=T[b++],Z=D.tag;if(!dh(D)){if((Z===5||Z===26||Z===27)&&vu(D.stateNode))return!0;for(D=D.child;D!==null;)T.push(D),D=D.sibling}}return!1},wr.getFindAllNodesFailureDescription=function(b,T){if(!Fc)throw Error(i(363));var D=0,Z=[];b=[oh(b),0];for(var oe=0;oe<b.length;){var _e=b[oe++],$e=_e.tag,ft=b[oe++],Ct=T[ft];if(($e!==5&&$e!==26&&$e!==27||!dh(_e))&&(ap(_e,Ct)&&(Z.push(Am(Ct)),ft++,ft>D&&(D=ft)),ft<T.length))for(_e=_e.child;_e!==null;)b.push(_e,ft),_e=_e.sibling}if(D<T.length){for(b=[];D<T.length;D++)b.push(Am(T[D]));return`findAllNodes was able to match part of the selector:
  `+(Z.join(" > ")+`

No matching component was found for:
  `)+b.join(" > ")}return null},wr.getPublicRootInstance=function(b){if(b=b.current,!b.child)return null;switch(b.child.tag){case 27:case 5:return il(b.child.stateNode);default:return b.child.stateNode}},wr.injectIntoDevTools=function(){var b={bundleType:0,version:Wa,rendererPackageName:As,currentDispatcherRef:yr,findFiberByHostInstance:jg,reconcilerVersion:"19.0.0"};if(Lc!==null&&(b.rendererConfig=Lc),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")b=!1;else{var T=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(T.isDisabled||!T.supportsFiber)b=!0;else{try{Ya=T.inject(b),Zs=T}catch{}b=!!T.checkDCE}}return b},wr.isAlreadyRendering=function(){return!1},wr.observeVisibleRects=function(b,T,D,Z){if(!Fc)throw Error(i(363));b=el(b,T);var oe=Vs(b,D,Z).disconnect;return{disconnect:function(){oe()}}},wr.shouldError=function(){return null},wr.shouldSuspend=function(){return!1},wr.startHostTransition=function(b,T,D,Z){if(b.tag!==5)throw Error(i(476));var oe=gs(b).queue;nh(b,oe,T,Uc,D===null?r:function(){var _e=gs(b).next.queue;return cu(b,_e,{},$o()),D(Z)})},wr.updateContainer=function(b,T,D,Z){var oe=T.current,_e=$o();return nl(oe,_e,b,T,D,Z),_e},wr.updateContainerSync=function(b,T,D,Z){return T.tag===0&&mc(),nl(T.current,2,b,T,D,Z),2},wr},t.exports.default=t.exports,Object.defineProperty(t.exports,"__esModule",{value:!0})})(MD)),MD.exports}var eH;function X1e(){return eH||(eH=1,AD.exports=K1e()),AD.exports}var Y1e=X1e();const Z1e=su(Y1e);var tH=kee();function Oee(t){let e=t.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const Iee=t=>t&&t.isOrthographicCamera,J1e=t=>t!=null&&(typeof t=="string"||typeof t=="number"||t.isColor),a8=((t,e)=>typeof window<"u"&&(((t=window.document)==null?void 0:t.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?et.useLayoutEffect:et.useEffect;function Nee(t){const e=et.useRef(t);return a8(()=>void(e.current=t),[t]),e}function Pee(t){var e;const n=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],n),t[1]):t}function XE(t){var e;return(e=t.__r3f)==null?void 0:e.root.getState()}const ya={obj:t=>t===Object(t)&&!ya.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,nul:t=>t===null,arr:t=>Array.isArray(t),equ(t,e,{arrays:n="shallow",objects:r="reference",strict:i=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if(ya.str(t)||ya.num(t)||ya.boo(t))return t===e;const s=ya.obj(t);if(s&&r==="reference")return t===e;const o=ya.arr(t);if(o&&n==="reference")return t===e;if((o||s)&&t===e)return!0;let a;for(a in t)if(!(a in e))return!1;if(s&&n==="shallow"&&r==="shallow"){for(a in i?e:t)if(!ya.equ(t[a],e[a],{strict:i,objects:"reference"}))return!1}else for(a in i?e:t)if(t[a]!==e[a])return!1;if(ya.und(a)){if(o&&t.length===0&&e.length===0||s&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function Q1e(t){const e={nodes:{},materials:{},meshes:{}};return t&&t.traverse(n=>{n.name&&(e.nodes[n.name]=n),n.material&&!e.materials[n.material.name]&&(e.materials[n.material.name]=n.material),n.isMesh&&!e.meshes[n.name]&&(e.meshes[n.name]=n)}),e}function eEe(t){t.type!=="Scene"&&(t.dispose==null||t.dispose());for(const e in t){const n=t[e];n?.type!=="Scene"&&(n==null||n.dispose==null||n.dispose())}}const Dee=["children","key","ref"];function tEe(t){const e={};for(const n in t)Dee.includes(n)||(e[n]=t[n]);return e}function gI(t,e,n,r){const i=t;let s=i?.__r3f;return s||(s={root:e,type:n,parent:null,children:[],props:tEe(r),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=s)),s}function EA(t,e){let n=t[e];if(!e.includes("-"))return{root:t,key:e,target:n};n=t;for(const i of e.split("-")){var r;e=i,t=n,n=(r=n)==null?void 0:r[e]}return{root:t,key:e,target:n}}const nH=/-\d+$/;function _I(t,e){if(ya.str(e.props.attach)){if(nH.test(e.props.attach)){const i=e.props.attach.replace(nH,""),{root:s,key:o}=EA(t.object,i);Array.isArray(s[o])||(s[o]=[])}const{root:n,key:r}=EA(t.object,e.props.attach);e.previousAttach=n[r],n[r]=e.object}else ya.fun(e.props.attach)&&(e.previousAttach=e.props.attach(t.object,e.object))}function vI(t,e){if(ya.str(e.props.attach)){const{root:n,key:r}=EA(t.object,e.props.attach),i=e.previousAttach;i===void 0?delete n[r]:n[r]=i}else e.previousAttach==null||e.previousAttach(t.object,e.object);delete e.previousAttach}const N6=[...Dee,"args","dispose","attach","object","onUpdate","dispose"],rH=new Map;function nEe(t){let e=rH.get(t.constructor);try{e||(e=new t.constructor,rH.set(t.constructor,e))}catch{}return e}function rEe(t,e){const n={};for(const r in e)if(!N6.includes(r)&&!ya.equ(e[r],t.props[r])){n[r]=e[r];for(const i in e)i.startsWith(`${r}-`)&&(n[i]=e[i])}for(const r in t.props){if(N6.includes(r)||e.hasOwnProperty(r))continue;const{root:i,key:s}=EA(t.object,r);if(i.constructor&&i.constructor.length===0){const o=nEe(i);ya.und(o)||(n[s]=o[s])}else n[s]=0}return n}const iEe=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],sEe=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function My(t,e){var n;const r=t.__r3f,i=r&&Oee(r).getState(),s=r?.eventCount;for(const a in e){let c=e[a];if(N6.includes(a))continue;if(r&&sEe.test(a)){typeof c=="function"?r.handlers[a]=c:delete r.handlers[a],r.eventCount=Object.keys(r.handlers).length;continue}if(c===void 0)continue;let{root:l,key:u,target:h}=EA(t,a);if(h instanceof bA&&c instanceof bA)h.mask=c.mask;else if(h instanceof Xi&&J1e(c))h.set(c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof h.copy=="function"&&c!=null&&c.constructor&&h.constructor===c.constructor)h.copy(c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&Array.isArray(c))typeof h.fromArray=="function"?h.fromArray(c):h.set(...c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof c=="number")typeof h.setScalar=="function"?h.setScalar(c):h.set(c);else{var o;l[u]=c,i&&!i.linear&&iEe.includes(u)&&(o=l[u])!=null&&o.isTexture&&l[u].format===Vf&&l[u].type===xa&&(l[u].colorSpace=rs)}}if(r!=null&&r.parent&&i!=null&&i.internal&&(n=r.object)!=null&&n.isObject3D&&s!==r.eventCount){const a=r.object,c=i.internal.interaction.indexOf(a);c>-1&&i.internal.interaction.splice(c,1),r.eventCount&&a.raycast!==null&&i.internal.interaction.push(a)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&Gx(r),t}function Gx(t){var e;if(!t.parent)return;t.props.onUpdate==null||t.props.onUpdate(t.object);const n=(e=t.root)==null||e.getState==null?void 0:e.getState();n&&n.internal.frames===0&&n.invalidate()}function Lee(t,e){t.manual||(Iee(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix())}const Uf=t=>t?.isObject3D;function ek(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function Uee(t,e,n,r){const i=n.get(e);i&&(n.delete(e),n.size===0&&(t.delete(r),i.target.releasePointerCapture(r)))}function oEe(t,e){const{internal:n}=t.getState();n.interaction=n.interaction.filter(r=>r!==e),n.initialHits=n.initialHits.filter(r=>r!==e),n.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&n.hovered.delete(i)}),n.capturedMap.forEach((r,i)=>{Uee(n.capturedMap,e,r,i)})}function aEe(t){function e(c){const{internal:l}=t.getState(),u=c.offsetX-l.initialClick[0],h=c.offsetY-l.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function n(c){return c.filter(l=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=l.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(c,l){const u=t.getState(),h=new Set,d=[],m=l?l(u.internal.interaction):u.internal.interaction;for(let v=0;v<m.length;v++){const x=XE(m[v]);x&&(x.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(c,u);function p(v){const x=XE(v);if(!x||!x.events.enabled||x.raycaster.camera===null)return[];if(x.raycaster.camera===void 0){var E;x.events.compute==null||x.events.compute(c,x,(E=x.previousRoot)==null?void 0:E.getState()),x.raycaster.camera===void 0&&(x.raycaster.camera=null)}return x.raycaster.camera?x.raycaster.intersectObject(v,!0):[]}let g=m.flatMap(p).sort((v,x)=>{const E=XE(v.object),C=XE(x.object);return!E||!C?v.distance-x.distance:C.events.priority-E.events.priority||v.distance-x.distance}).filter(v=>{const x=ek(v);return h.has(x)?!1:(h.add(x),!0)});u.events.filter&&(g=u.events.filter(g,u));for(const v of g){let x=v.object;for(;x;){var y;(y=x.__r3f)!=null&&y.eventCount&&d.push({...v,eventObject:x}),x=x.parent}}if("pointerId"in c&&u.internal.capturedMap.has(c.pointerId))for(let v of u.internal.capturedMap.get(c.pointerId).values())h.has(ek(v.intersection))||d.push(v.intersection);return d}function i(c,l,u,h){if(c.length){const d={stopped:!1};for(const m of c){let p=XE(m.object);if(p||m.object.traverseAncestors(g=>{const y=XE(g);if(y)return p=y,!1}),p){const{raycaster:g,pointer:y,camera:v,internal:x}=p,E=new jt(y.x,y.y,0).unproject(v),C=z=>{var H,K;return(H=(K=x.capturedMap.get(z))==null?void 0:K.has(m.eventObject))!=null?H:!1},A=z=>{const H={intersection:m,target:l.target};x.capturedMap.has(z)?x.capturedMap.get(z).set(m.eventObject,H):x.capturedMap.set(z,new Map([[m.eventObject,H]])),l.target.setPointerCapture(z)},k=z=>{const H=x.capturedMap.get(z);H&&Uee(x.capturedMap,m.eventObject,H,z)};let M={};for(let z in l){let H=l[z];typeof H!="function"&&(M[z]=H)}let I={...m,...M,pointer:y,intersections:c,stopped:d.stopped,delta:u,unprojectedPoint:E,ray:g.ray,camera:v,stopPropagation(){const z="pointerId"in l&&x.capturedMap.get(l.pointerId);if((!z||z.has(m.eventObject))&&(I.stopped=d.stopped=!0,x.hovered.size&&Array.from(x.hovered.values()).find(H=>H.eventObject===m.eventObject))){const H=c.slice(0,c.indexOf(m));s([...H,m])}},target:{hasPointerCapture:C,setPointerCapture:A,releasePointerCapture:k},currentTarget:{hasPointerCapture:C,setPointerCapture:A,releasePointerCapture:k},nativeEvent:l};if(h(I),d.stopped===!0)break}}}return c}function s(c){const{internal:l}=t.getState();for(const u of l.hovered.values())if(!c.length||!c.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f;if(l.hovered.delete(ek(u)),d!=null&&d.eventCount){const m=d.handlers,p={...u,intersections:c};m.onPointerOut==null||m.onPointerOut(p),m.onPointerLeave==null||m.onPointerLeave(p)}}}function o(c,l){for(let u=0;u<l.length;u++){const h=l[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(c)}}function a(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return l=>{const{internal:u}=t.getState();"pointerId"in l&&u.capturedMap.has(l.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(l.pointerId)&&(u.capturedMap.delete(l.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=t.getState();d.lastEvent.current=u;const m=c==="onPointerMove",p=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",y=r(u,m?n:void 0),v=p?e(u):0;c==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=y.map(E=>E.eventObject)),p&&!y.length&&v<=2&&(o(u,d.interaction),h&&h(u)),m&&s(y);function x(E){const C=E.eventObject,A=C.__r3f;if(!(A!=null&&A.eventCount))return;const k=A.handlers;if(m){if(k.onPointerOver||k.onPointerEnter||k.onPointerOut||k.onPointerLeave){const M=ek(E),I=d.hovered.get(M);I?I.stopped&&E.stopPropagation():(d.hovered.set(M,E),k.onPointerOver==null||k.onPointerOver(E),k.onPointerEnter==null||k.onPointerEnter(E))}k.onPointerMove==null||k.onPointerMove(E)}else{const M=k[c];M?(!p||d.initialHits.includes(C))&&(o(u,d.interaction.filter(I=>!d.initialHits.includes(I))),M(E)):p&&d.initialHits.includes(C)&&o(u,d.interaction.filter(I=>!d.initialHits.includes(I)))}}i(y,u,v,x)}}return{handlePointer:a}}const iH=t=>!!(t!=null&&t.render),c8=et.createContext(null),cEe=(t,e)=>{const n=Ree((a,c)=>{const l=new jt,u=new jt,h=new jt;function d(v=c().camera,x=u,E=c().size){const{width:C,height:A,top:k,left:M}=E,I=C/A;x.isVector3?h.copy(x):h.set(...x);const z=v.getWorldPosition(l).distanceTo(h);if(Iee(v))return{width:C/v.zoom,height:A/v.zoom,top:k,left:M,factor:1,distance:z,aspect:I};{const H=v.fov*Math.PI/180,K=2*Math.tan(H/2)*z,P=K*(C/A);return{width:P,height:K,top:k,left:M,factor:C/P,distance:z,aspect:I}}}let m;const p=v=>a(x=>({performance:{...x.performance,current:v}})),g=new Vn;return{set:a,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(v=1)=>t(c(),v),advance:(v,x)=>e(v,x,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Y0e,pointer:g,mouse:g,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const v=c();m&&clearTimeout(m),v.performance.current!==v.performance.min&&p(v.performance.min),m=setTimeout(()=>p(c().performance.max),v.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:v=>a(x=>({...x,events:{...x.events,...v}})),setSize:(v,x,E=0,C=0)=>{const A=c().camera,k={width:v,height:x,top:E,left:C};a(M=>({size:k,viewport:{...M.viewport,...d(A,u,k)}}))},setDpr:v=>a(x=>{const E=Pee(v);return{viewport:{...x.viewport,dpr:E,initialDpr:x.viewport.initialDpr||E}}}),setFrameloop:(v="always")=>{const x=c().clock;x.stop(),x.elapsedTime=0,v!=="never"&&(x.start(),x.elapsedTime=0),a(()=>({frameloop:v}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:et.createRef(),active:!1,frames:0,priority:0,subscribe:(v,x,E)=>{const C=c().internal;return C.priority=C.priority+(x>0?1:0),C.subscribers.push({ref:v,priority:x,store:E}),C.subscribers=C.subscribers.sort((A,k)=>A.priority-k.priority),()=>{const A=c().internal;A!=null&&A.subscribers&&(A.priority=A.priority-(x>0?1:0),A.subscribers=A.subscribers.filter(k=>k.ref!==v))}}}}}),r=n.getState();let i=r.size,s=r.viewport.dpr,o=r.camera;return n.subscribe(()=>{const{camera:a,size:c,viewport:l,gl:u,set:h}=n.getState();if(c.width!==i.width||c.height!==i.height||l.dpr!==s){i=c,s=l.dpr,Lee(a,c),l.dpr>0&&u.setPixelRatio(l.dpr);const d=typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(c.width,c.height,d)}a!==o&&(o=a,h(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(a)}})))}),n.subscribe(a=>t(a)),n};function l8(){const t=et.useContext(c8);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function Hh(t=n=>n,e){return l8()(t,e)}function Jd(t,e=0){const n=l8(),r=n.getState().internal.subscribe,i=Nee(t);return a8(()=>r(i,e,n),[e,r,n]),null}const sH=new WeakMap,lEe=t=>{var e;return typeof t=="function"&&(t==null||(e=t.prototype)==null?void 0:e.constructor)===t};function Bee(t,e){return function(n,...r){let i;return lEe(n)?(i=sH.get(n),i||(i=new n,sH.set(n,i))):i=n,t&&t(i),Promise.all(r.map(s=>new Promise((o,a)=>i.load(s,c=>{Uf(c?.scene)&&Object.assign(c,Q1e(c.scene)),o(c)},e,c=>a(new Error(`Could not load ${s}: ${c?.message}`))))))}}function u8(t,e,n,r){const i=Array.isArray(e)?e:[e],s=Mee(Bee(n,r),[t,...i],{equal:ya.equ});return Array.isArray(e)?s:s[0]}u8.preload=function(t,e,n){const r=Array.isArray(e)?e:[e];return G1e(Bee(n),[t,...r])};u8.clear=function(t,e){const n=Array.isArray(e)?e:[e];return $1e([t,...n])};function uEe(t){const e=Z1e(t);return e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:et.version}),e}const Fee=0,nx={},fEe=/^three(?=[A-Z])/,l3=t=>`${t[0].toUpperCase()}${t.slice(1)}`;let hEe=0;const dEe=t=>typeof t=="function";function f8(t){if(dEe(t)){const e=`${hEe++}`;return nx[e]=t,e}else Object.assign(nx,t)}function jee(t,e){const n=l3(t),r=nx[n];if(t!=="primitive"&&!r)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(t==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function pEe(t,e,n){var r;return t=l3(t)in nx?t:t.replace(fEe,""),jee(t,e),t==="primitive"&&(r=e.object)!=null&&r.__r3f&&delete e.object.__r3f,gI(e.object,n,t,e)}function mEe(t){if(!t.isHidden){var e;t.props.attach&&(e=t.parent)!=null&&e.object?vI(t.parent,t):Uf(t.object)&&(t.object.visible=!1),t.isHidden=!0,Gx(t)}}function zee(t){if(t.isHidden){var e;t.props.attach&&(e=t.parent)!=null&&e.object?_I(t.parent,t):Uf(t.object)&&t.props.visible!==!1&&(t.object.visible=!0),t.isHidden=!1,Gx(t)}}function h8(t,e,n){const r=e.root.getState();if(!(!t.parent&&t.object!==r.scene)){if(!e.object){var i,s;const o=nx[l3(e.type)];e.object=(i=e.props.object)!=null?i:new o(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(My(e.object,e.props),e.props.attach)_I(t,e);else if(Uf(e.object)&&Uf(t.object)){const o=t.object.children.indexOf(n?.object);if(n&&o!==-1){const a=t.object.children.indexOf(e.object);if(a!==-1){t.object.children.splice(a,1);const c=a<o?o-1:o;t.object.children.splice(c,0,e.object)}else e.object.parent=t.object,t.object.children.splice(o,0,e.object),e.object.dispatchEvent({type:"added"}),t.object.dispatchEvent({type:"childadded",child:e.object})}else t.object.add(e.object)}for(const o of e.children)h8(e,o);Gx(e)}}function ID(t,e){e&&(e.parent=t,t.children.push(e),h8(t,e))}function oH(t,e,n){if(!e||!n)return;e.parent=t;const r=t.children.indexOf(n);r!==-1?t.children.splice(r,0,e):t.children.push(e),h8(t,e,n)}function Hee(t){if(typeof t.dispose=="function"){const e=()=>{try{t.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():tH.unstable_scheduleCallback(tH.unstable_IdlePriority,e)}}function P6(t,e,n){if(!e)return;e.parent=null;const r=t.children.indexOf(e);r!==-1&&t.children.splice(r,1),e.props.attach?vI(t,e):Uf(e.object)&&Uf(t.object)&&(t.object.remove(e.object),oEe(Oee(e),e.object));const i=e.props.dispose!==null&&n!==!1;for(let s=e.children.length-1;s>=0;s--){const o=e.children[s];P6(e,o,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&Hee(e.object),n===void 0&&Gx(e)}function gEe(t,e){for(const n of[t,t.alternate])if(n!==null)if(typeof n.ref=="function"){n.refCleanup==null||n.refCleanup();const r=n.ref(e);typeof r=="function"&&(n.refCleanup=r)}else n.ref&&(n.ref.current=e)}const yO=[];function _Ee(){for(const[n]of yO){const r=n.parent;if(r){n.props.attach?vI(r,n):Uf(n.object)&&Uf(r.object)&&r.object.remove(n.object);for(const i of n.children)i.props.attach?vI(n,i):Uf(i.object)&&Uf(n.object)&&n.object.remove(i.object)}n.isHidden&&zee(n),n.object.__r3f&&delete n.object.__r3f,n.type!=="primitive"&&Hee(n.object)}for(const[n,r,i]of yO){n.props=r;const s=n.parent;if(s){var t,e;const o=nx[l3(n.type)];n.object=(t=n.props.object)!=null?t:new o(...(e=n.props.args)!=null?e:[]),n.object.__r3f=n,gEe(i,n.object),My(n.object,n.props),n.props.attach?_I(s,n):Uf(n.object)&&Uf(s.object)&&s.object.add(n.object);for(const a of n.children)a.props.attach?_I(n,a):Uf(a.object)&&Uf(n.object)&&n.object.add(a.object);Gx(n)}}yO.length=0}const ND=()=>{},aH={};let tk=Fee;const vEe=0,yEe=4,yI=uEe({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:pEe,removeChild:P6,appendChild:ID,appendInitialChild:ID,insertBefore:oH,appendChildToContainer(t,e){const n=t.getState().scene.__r3f;!e||!n||ID(n,e)},removeChildFromContainer(t,e){const n=t.getState().scene.__r3f;!e||!n||P6(n,e)},insertInContainerBefore(t,e,n){const r=t.getState().scene.__r3f;!e||!n||!r||oH(r,e,n)},getRootHostContext:()=>aH,getChildHostContext:()=>aH,commitUpdate(t,e,n,r,i){var s,o,a;jee(e,r);let c=!1;if((t.type==="primitive"&&n.object!==r.object||((s=r.args)==null?void 0:s.length)!==((o=n.args)==null?void 0:o.length)||(a=r.args)!=null&&a.some((u,h)=>{var d;return u!==((d=n.args)==null?void 0:d[h])}))&&(c=!0),c)yO.push([t,{...r},i]);else{const u=rEe(t,r);Object.keys(u).length&&(Object.assign(t.props,u),My(t.object,u))}(i.sibling===null||(i.flags&yEe)===vEe)&&_Ee()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:t=>t?.object,prepareForCommit:()=>null,preparePortalMount:t=>gI(t.getState().scene,t,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:mEe,unhideInstance:zee,createTextInstance:ND,hideTextInstance:ND,unhideTextInstance:ND,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:et.createContext(null),setCurrentUpdatePriority(t){tk=t},getCurrentUpdatePriority(){return tk},resolveUpdatePriority(){var t;if(tk!==Fee)return tk;switch(typeof window<"u"&&((t=window.event)==null?void 0:t.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return uO.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return uO.ContinuousEventPriority;default:return uO.DefaultEventPriority}},resetFormInstance(){}}),I1=new Map,YE={objects:"shallow",strict:!1};function bEe(t,e){if(!e&&typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:n,height:r,top:i,left:s}=t.parentElement.getBoundingClientRect();return{width:n,height:r,top:i,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function EEe(t){const e=I1.get(t),n=e?.fiber,r=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=r||cEe(U6,lH),o=n||yI.createContainer(s,uO.ConcurrentRoot,null,!1,null,"",i,i,i,null);e||I1.set(t,{fiber:o,store:s});let a,c,l=!1,u=null;return{async configure(h={}){let d;u=new Promise($=>d=$);let{gl:m,size:p,scene:g,events:y,onCreated:v,shadows:x=!1,linear:E=!1,flat:C=!1,legacy:A=!1,orthographic:k=!1,frameloop:M="always",dpr:I=[1,2],performance:z,raycaster:H,camera:K,onPointerMissed:P}=h,F=s.getState(),N=F.gl;if(!F.gl){const $={canvas:t,powerPreference:"high-performance",antialias:!0,alpha:!0},J=typeof m=="function"?await m($):m;iH(J)?N=J:N=new P1e({...$,...m}),F.set({gl:N})}let X=F.raycaster;X||F.set({raycaster:X=new bee});const{params:G,...j}=H||{};if(ya.equ(j,X,YE)||My(X,{...j}),ya.equ(G,X.params,YE)||My(X,{params:{...X.params,...G}}),!F.camera||F.camera===c&&!ya.equ(c,K,YE)){c=K;const $=K?.isCamera,J=$?K:k?new s8(0,0,0,0,.1,1e3):new jf(75,0,.1,1e3);$||(J.position.z=5,K&&(My(J,K),J.manual||("aspect"in K||"left"in K||"right"in K||"bottom"in K||"top"in K)&&(J.manual=!0,J.updateProjectionMatrix())),!F.camera&&!(K!=null&&K.rotation)&&J.lookAt(0,0,0)),F.set({camera:J}),X.camera=J}if(!F.scene){let $;g!=null&&g.isScene?($=g,gI($,s,"",{})):($=new mI,gI($,s,"",{}),g&&My($,g)),F.set({scene:$})}y&&!F.events.handlers&&F.set({events:y(s)});const q=bEe(t,p);if(ya.equ(q,F.size,YE)||F.setSize(q.width,q.height,q.top,q.left),I&&F.viewport.dpr!==Pee(I)&&F.setDpr(I),F.frameloop!==M&&F.setFrameloop(M),F.onPointerMissed||F.set({onPointerMissed:P}),z&&!ya.equ(z,F.performance,YE)&&F.set($=>({performance:{...$.performance,...z}})),!F.xr){var te;const $=(ie,ae)=>{const xe=s.getState();xe.frameloop!=="never"&&lH(ie,!0,xe,ae)},J=()=>{const ie=s.getState();ie.gl.xr.enabled=ie.gl.xr.isPresenting,ie.gl.xr.setAnimationLoop(ie.gl.xr.isPresenting?$:null),ie.gl.xr.isPresenting||U6(ie)},ne={connect(){const ie=s.getState().gl;ie.xr.addEventListener("sessionstart",J),ie.xr.addEventListener("sessionend",J)},disconnect(){const ie=s.getState().gl;ie.xr.removeEventListener("sessionstart",J),ie.xr.removeEventListener("sessionend",J)}};typeof((te=N.xr)==null?void 0:te.addEventListener)=="function"&&ne.connect(),F.set({xr:ne})}if(N.shadowMap){const $=N.shadowMap.enabled,J=N.shadowMap.type;if(N.shadowMap.enabled=!!x,ya.boo(x))N.shadowMap.type=fO;else if(ya.str(x)){var W;const ne={basic:age,percentage:$B,soft:fO,variance:l0};N.shadowMap.type=(W=ne[x])!=null?W:fO}else ya.obj(x)&&Object.assign(N.shadowMap,x);($!==N.shadowMap.enabled||J!==N.shadowMap.type)&&(N.shadowMap.needsUpdate=!0)}return xs.enabled=!A,l||(N.outputColorSpace=E?Rv:rs,N.toneMapping=C?gv:ree),F.legacy!==A&&F.set(()=>({legacy:A})),F.linear!==E&&F.set(()=>({linear:E})),F.flat!==C&&F.set(()=>({flat:C})),m&&!ya.fun(m)&&!iH(m)&&!ya.equ(m,N,YE)&&My(N,m),a=v,l=!0,d(),this},render(h){return!l&&!u&&this.configure(),u.then(()=>{yI.updateContainer(ke.jsx(SEe,{store:s,children:h,onCreated:a,rootElement:t}),o,null,()=>{})}),s},unmount(){xEe(t)}}}function SEe({store:t,children:e,onCreated:n,rootElement:r}){return a8(()=>{const i=t.getState();i.set(s=>({internal:{...s.internal,active:!0}})),n&&n(i),t.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),ke.jsx(c8.Provider,{value:t,children:e})}function xEe(t,e){const n=I1.get(t),r=n?.fiber;if(r){const i=n?.store.getState();i&&(i.internal.active=!1),yI.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var s,o,a,c;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=i.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(c=i.gl)!=null&&c.xr&&i.xr.disconnect(),eEe(i.scene),I1.delete(t)}catch{}},500)})}}function TEe(t,e,n){return ke.jsx(wEe,{children:t,container:e,state:n})}function wEe({state:t={},children:e,container:n}){const{events:r,size:i,...s}=t,o=l8(),[a]=et.useState(()=>new bee),[c]=et.useState(()=>new Vn),l=Nee((h,d)=>{let m;if(d.camera&&i){const p=d.camera;m=h.viewport.getCurrentViewport(p,new jt,i),p!==h.camera&&Lee(p,i)}return{...h,...d,scene:n,raycaster:a,pointer:c,mouse:c,previousRoot:o,events:{...h.events,...d.events,...r},size:{...h.size,...i},viewport:{...h.viewport,...m},setEvents:p=>d.set(g=>({...g,events:{...g.events,...p}}))}}),u=et.useMemo(()=>{const h=Ree((m,p)=>({...s,set:m,get:p})),d=m=>h.setState(p=>l.current(m,p));return d(o.getState()),o.subscribe(d),h},[o,n]);return ke.jsx(ke.Fragment,{children:yI.createPortal(ke.jsx(c8.Provider,{value:u,children:e}),u,null)})}function qee(t,e){const n={callback:t};return e.add(n),()=>void e.delete(n)}const Vee=new Set,Gee=new Set,REe=new Set,CEe=t=>qee(t,Vee),AEe=t=>qee(t,Gee);function PD(t,e){if(t.size)for(const{callback:n}of t.values())n(e)}function rA(t,e){switch(t){case"before":return PD(Vee,e);case"after":return PD(Gee,e);case"tail":return PD(REe,e)}}let DD,LD;function D6(t,e,n){let r=e.clock.getDelta();e.frameloop==="never"&&typeof t=="number"&&(r=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),DD=e.internal.subscribers;for(let i=0;i<DD.length;i++)LD=DD[i],LD.ref.current(LD.store.getState(),r,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let bI=!1,L6=!1,UD,cH,ZE;function $ee(t){cH=requestAnimationFrame($ee),bI=!0,UD=0,rA("before",t),L6=!0;for(const n of I1.values()){var e;ZE=n.store.getState(),ZE.internal.active&&(ZE.frameloop==="always"||ZE.internal.frames>0)&&!((e=ZE.gl.xr)!=null&&e.isPresenting)&&(UD+=D6(t,ZE))}if(L6=!1,rA("after",t),UD===0)return rA("tail",t),bI=!1,cancelAnimationFrame(cH)}function U6(t,e=1){var n;if(!t)return I1.forEach(r=>U6(r.store.getState(),e));(n=t.gl.xr)!=null&&n.isPresenting||!t.internal.active||t.frameloop==="never"||(e>1?t.internal.frames=Math.min(60,t.internal.frames+e):L6?t.internal.frames=2:t.internal.frames=1,bI||(bI=!0,requestAnimationFrame($ee)))}function lH(t,e=!0,n,r){if(e&&rA("before",t),n)D6(t,n,r);else for(const i of I1.values())D6(t,i.store.getState());e&&rA("after",t)}const BD={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function MEe(t){const{handlePointer:e}=aEe(t);return{priority:1,enabled:!0,compute(n,r,i){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(BD).reduce((n,r)=>({...n,[r]:e(r)}),{}),update:()=>{var n;const{events:r,internal:i}=t.getState();(n=i.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:n=>{const{set:r,events:i}=t.getState();if(i.disconnect==null||i.disconnect(),r(s=>({events:{...s.events,connected:n}})),i.handlers)for(const s in i.handlers){const o=i.handlers[s],[a,c]=BD[s];n.addEventListener(a,o,{passive:c})}},disconnect:()=>{const{set:n,events:r}=t.getState();if(r.connected){if(r.handlers)for(const i in r.handlers){const s=r.handlers[i],[o]=BD[i];r.connected.removeEventListener(o,s)}n(i=>({events:{...i.events,connected:void 0}}))}}}}var nk={exports:{}},uH;function kEe(){if(uH)return nk.exports;uH=1;function t(e,n=100,r={}){if(typeof e!="function")throw new TypeError(`Expected the first parameter to be a function, got \`${typeof e}\`.`);if(n<0)throw new RangeError("`wait` must not be negative.");const{immediate:i}=typeof r=="boolean"?{immediate:r}:r;let s,o,a,c,l;function u(){const m=s,p=o;return s=void 0,o=void 0,l=e.apply(m,p),l}function h(){const m=Date.now()-c;m<n&&m>=0?a=setTimeout(h,n-m):(a=void 0,i||(l=u()))}const d=function(...m){if(s&&this!==s&&Object.getPrototypeOf(this)===Object.getPrototypeOf(s))throw new Error("Debounced method called with different contexts of the same prototype.");s=this,o=m,c=Date.now();const p=i&&!a;return a||(a=setTimeout(h,n)),p&&(l=u()),l};return Object.defineProperty(d,"isPending",{get(){return a!==void 0}}),d.clear=()=>{a&&(clearTimeout(a),a=void 0)},d.flush=()=>{a&&d.trigger()},d.trigger=()=>{l=u(),d.clear()},d}return nk.exports.debounce=t,nk.exports=t,nk.exports}var OEe=kEe();const IEe=su(OEe);var bO={exports:{}},NEe=bO.exports,fH;function PEe(){return fH||(fH=1,(function(t,e){(function(n,r){t.exports=r()})(NEe,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return(function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h})(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(bO)),bO.exports}var DEe=PEe();const d8=su(DEe);new Vn;new Vn;function Vr(t,e,n){return Math.max(e,Math.min(n,t))}function LEe(t,e){return Vr(t-Math.floor(t/e)*e,0,e)}function UEe(t,e){var n=LEe(e-t,Math.PI*2);return n>Math.PI&&(n-=Math.PI*2),n}function BEe(t){return t/180*Math.PI}function FEe(t){return t*180/Math.PI}const jEe=d8("089fad0j9awfem09wavefc09uwaef");function hH(t){return 2*Math.floor(t/2)}function Wee(t,e){return Math.round(t/e)*e}function zEe(){return jEe()}function HEe(t){return d8(t)()}function Bd(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(zEe()*i)}function Kee(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(HEe(t)*s)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var qEe=(function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})(),VEe=Object.prototype.hasOwnProperty;function B6(t,e){return VEe.call(t,e)}function F6(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)B6(t,i)&&r.push(i);return r}function Bh(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function j6(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function t1(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Xee(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function z6(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(z6(t[e]))return!0}else if(typeof t=="object"){for(var r=F6(t),i=r.length,s=0;s<i;s++)if(z6(t[r[s]]))return!0}}return!1}function dH(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Yee=(function(t){qEe(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,dH(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=dH(n,{name:r,index:i,operation:s,tree:o}),c}return e})(Error),nc=Yee,GEe=Bh,RS={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=EI(n,this.path);r&&(r=Bh(r));var i=x1(n,{op:"remove",path:this.from}).removed;return x1(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=EI(n,this.from);return x1(n,{op:"add",path:this.path,value:Bh(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:SA(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},$Ee={add:function(t,e,n){return j6(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:RS.move,copy:RS.copy,test:RS.test,_get:RS._get};function EI(t,e){if(e=="")return t;var n={op:"_get",path:e};return x1(t,n),n.value}function x1(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):SI(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=EI(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=SA(t,e.value),o.test===!1)throw new nc("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new nc("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Bh(t));var a=e.path||"",c=a.split("/"),l=t,u=1,h=c.length,d=void 0,m=void 0,p=void 0;for(typeof n=="function"?p=n:p=SI;;){if(m=c[u],m&&m.indexOf("~")!=-1&&(m=Xee(m)),i&&(m=="__proto__"||m=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[m]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(m==="-")m=l.length;else{if(n&&!j6(m))throw new nc("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);j6(m)&&(m=~~m)}if(u>=h){if(n&&e.op==="add"&&m>l.length)throw new nc("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=$Ee[e.op].call(e,l,m,t);if(o.test===!1)throw new nc("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=h){var o=RS[e.op].call(e,l,m,t);if(o.test===!1)throw new nc("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[m],n&&u<h&&(!l||typeof l!="object"))throw new nc("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function u3(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new nc("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Bh(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=x1(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function WEe(t,e,n){var r=x1(t,e);if(r.test===!1)throw new nc("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function SI(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new nc("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(RS[t.op]){if(typeof t.path!="string")throw new nc("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new nc('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new nc("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new nc("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&z6(t.value))throw new nc("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new nc("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new nc("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Zee([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new nc("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new nc("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Zee(t,e,n){try{if(!Array.isArray(t))throw new nc("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)u3(Bh(e),Bh(t),n||!0);else{n=n||SI;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof nc)return i;throw i}}function SA(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!SA(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!SA(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}const KEe=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:nc,_areEquals:SA,applyOperation:x1,applyPatch:u3,applyReducer:WEe,deepClone:GEe,getValueByPointer:EI,validate:Zee,validator:SI},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var p8=new WeakMap,XEe=(function(){function t(e){this.observers=new Map,this.obj=e}return t})(),YEe=(function(){function t(e,n){this.callback=e,this.observer=n}return t})();function ZEe(t){return p8.get(t)}function JEe(t,e){return t.observers.get(e)}function QEe(t,e){t.observers.delete(e.callback)}function eSe(t,e){e.unobserve()}function tSe(t,e){var n=[],r,i=ZEe(t);if(!i)i=new XEe(t),p8.set(t,i);else{var s=JEe(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Bh(t),e){r.callback=e,r.next=null;var o=function(){H6(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){H6(r),clearTimeout(r.next),QEe(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new YEe(e,r)),r}function H6(t,e){e===void 0&&(e=!1);var n=p8.get(t.object);m8(n.value,t.object,t.patches,"",e),t.patches.length&&u3(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function m8(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=F6(e),o=F6(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(B6(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?m8(u,h,n,r+"/"+t1(l),i):u!==h&&(i&&n.push({op:"test",path:r+"/"+t1(l),value:Bh(u)}),n.push({op:"replace",path:r+"/"+t1(l),value:Bh(h)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+t1(l),value:Bh(u)}),n.push({op:"remove",path:r+"/"+t1(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!B6(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+t1(l),value:Bh(e[l])})}}}function nSe(t,e,n){n===void 0&&(n=!1);var r=[];return m8(t,e,r,"",n),r}const rSe=Object.freeze(Object.defineProperty({__proto__:null,compare:nSe,generate:H6,observe:tSe,unobserve:eSe},Symbol.toStringTag,{value:"Module"}));Object.assign({},KEe,rSe,{JsonPatchError:Yee,deepClone:Bh,escapePathComponent:t1,unescapePathComponent:Xee});var FD,pH;function iSe(){if(pH)return FD;pH=1;var t=typeof Element<"u",e=typeof Map=="function",n=typeof Set=="function",r=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function i(s,o){if(s===o)return!0;if(s&&o&&typeof s=="object"&&typeof o=="object"){if(s.constructor!==o.constructor)return!1;var a,c,l;if(Array.isArray(s)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(!i(s[c],o[c]))return!1;return!0}var u;if(e&&s instanceof Map&&o instanceof Map){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;for(u=s.entries();!(c=u.next()).done;)if(!i(c.value[1],o.get(c.value[0])))return!1;return!0}if(n&&s instanceof Set&&o instanceof Set){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;return!0}if(r&&ArrayBuffer.isView(s)&&ArrayBuffer.isView(o)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(s[c]!==o[c])return!1;return!0}if(s.constructor===RegExp)return s.source===o.source&&s.flags===o.flags;if(s.valueOf!==Object.prototype.valueOf&&typeof s.valueOf=="function"&&typeof o.valueOf=="function")return s.valueOf()===o.valueOf();if(s.toString!==Object.prototype.toString&&typeof s.toString=="function"&&typeof o.toString=="function")return s.toString()===o.toString();if(l=Object.keys(s),a=l.length,a!==Object.keys(o).length)return!1;for(c=a;c--!==0;)if(!Object.prototype.hasOwnProperty.call(o,l[c]))return!1;if(t&&s instanceof Element)return!1;for(c=a;c--!==0;)if(!((l[c]==="_owner"||l[c]==="__v"||l[c]==="__o")&&s.$$typeof)&&!i(s[l[c]],o[l[c]]))return!1;return!0}return s!==s&&o!==o}return FD=function(o,a){try{return i(o,a)}catch(c){if((c.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw c}},FD}var sSe=iSe();const Ty=su(sSe);function ge(t){return t!=null}const oSe=Object.fromEntries,Cv=Object.keys;function na(t){return Bh(t)}function aSe(t){return typeof t=="boolean"}function an(t){return typeof t=="number"&&isNaN(t)===!1}function Sn(t){return typeof t=="string"}function Rr(t){return Array.isArray(t)}function Ah(t){return t}function cSe(t){return typeof t=="object"&&Sn(t.session)&&Sn(t.player)&&Sn(t.id)&&Sn(t.sender)&&Sn(t.target)}function lSe(t){t.emit("","session_reset")}function Pr(t,e,n,...r){return t.emit(e,"error",[`$red${n}$blue>>`,...r]),!1}function uSe(t,e,...n){return t.emit(e,"info",n),!0}function Ei(t,e,...n){return t.emit(e,"log",n),!0}function fSe(t,e,...n){return t.emit(e,"chat",n),!0}function Jee(t,e,n){t.emit(e,"toast",n)}function hSe(t,e,n){t.emit(e,"bridge:streamstart",n)}function dSe(t,e){t.emit(e,"bridge:streamstop",void 0)}function pSe(t,e,n){t.emit(e,"bridge:chatstart",n)}function mSe(t,e){t.emit(e,"bridge:chatstop")}function gSe(t,e,n,r,i,s,o){t.emit(e,"bridge:fetch",[n,r,i,s,o])}function _Se(t,e,n){t.emit(e,"bridge:join",n)}function vSe(t,e,n){t.emit(e,"bridge:start",n)}function ySe(t,e,n){t.emit(e,"bridge:tab",n)}function bSe(t,e){t.emit(e,"bridge:tabopen")}function ESe(t,e,n){t.emit(e,"bridge:showjoincode",n)}function SSe(t,e){t.emit(e,"gadgetserver:desync")}function xSe(t,e){t.emit(e,"gadgetserver:clearscroll")}function mH(t,e,n,r){t.emit(e,"register:downloadjsonfile",[n,r])}function TSe(t,e){t.emit(e,"register:dev",void 0)}function wSe(t,e){t.emit(e,"register:share",void 0)}function RSe(t,e){t.emit(e,"register:nuke",void 0)}function CSe(t,e){t.emit(e,"register:enterar",void 0)}function ASe(t,e){t.emit(e,"synth:audioenabled",void 0)}function MSe(t,e,n,r){t.emit(e,"synth:tts",[n,r])}function kSe(t,e,n,r){t.emit(e,"synth:ttsqueue",[n,r])}function OSe(t,e,n,r){t.emit(e,"synth:play",[n,r])}function ISe(t,e,n,r,i){t.emit(e,"synth:bgplay",[n,r,i])}function NSe(t,e,n){t.emit(e,"synth:bpm",n)}function PSe(t,e,n){t.emit(e,"synth:playvolume",n)}function DSe(t,e,n){t.emit(e,"synth:bgplayvolume",n)}function LSe(t,e,n){t.emit(e,"synth:ttsvolume",n)}function jD(t,e,n,r,i){t.emit(e,"synth:voice",[n,r,i])}function Qee(t,e,n,r,i,s){t.emit(e,"synth:voicefx",[n,r,i,s])}function USe(t,e,n){t.emit(e,"synth:record",n)}function BSe(t,e){t.emit(e,"synth:flush")}function FSe(t,e){t.emit(e,"register:refresh")}function gH(t,e,n,r){t.emit(e,"register:config",[n,r])}function jSe(t,e){t.emit(e,"register:configshow")}function zSe(t,e){t.emit(e,"register:inspector")}function _H(t,e,n){t.emit(e,"register:findany",n)}function HSe(t,e){t.emit(e,"register:terminal:open")}function vH(t,e,n){t.emit(e,"register:terminal:quickopen",n)}function xI(t,e){t.emit(e,"register:terminal:close")}function ete(t,e,n){t.emit(e,"register:terminal:inclayout",n)}function g8(t,e){t.emit(e,"register:terminal:full")}function qSe(t,e,n,r,i,s){t.emit(e,"register:editor:open",[n,r,i,s])}function VSe(t,e){t.emit(e,"register:editor:close")}function GSe(t,e){t.emit(e,"vm:operator")}function $Se(t,e){t.emit(e,"vm:admin")}function WSe(t,e,n,r){t.emit(e,"vm:zztsearch",[n,r])}function KSe(t,e){t.emit(e,"vm:zztrandom")}function tte(t,e){t.emit(e,"vm:zsswords")}function XSe(t,e,n){t.emit(e,"vm:halt",n)}function YSe(t,e,n){t.emit(e,"vm:books",n)}function ZSe(t,e){t.emit(e,"vm:search")}function JSe(t,e,n){t.emit(e,"vm:login",n)}function QSe(t,e){t.emit(e,"vm:local")}function nte(t,e){t.emit(e,"vm:logout")}function rte(t,e){t.emit(e,"vm:doot")}function yH(t,e,n,r,i){t.emit(e,"vm:touched",[n,r,i])}function ite(t,e,n,r){t.emit(e,"vm:input",[n,r])}function exe(t,e,n){t.emit(e,"vm:copyjsonfile",n)}function txe(t,e,n){t.emit(e,"vm:makeitscroll",n)}function nxe(t,e){t.emit(e,"vm:refscroll")}function rxe(t,e,n,r){t.emit(e,"vm:inspect",[n,r])}function ixe(t,e){t.emit(e,"vm:findany")}function ste(t,e){const[n,r]=e;return`${t}:${[n,r].filter(ge).join(":")}`}function sxe(t,e,n,r){t.emit(e,"vm:codewatch",[n,r])}function oxe(t,e,n,r){t.emit(e,"vm:coderelease",[n,r])}function R0(t,e,n){t.emit(e,"vm:cli",n)}function ote(t,e){t.emit(e,"vm:clirepeatlast")}function axe(t,e){t.emit(e,"vm:restart")}function cxe(t,e,n){t.emit(e,"vm:synthsend",n)}function lxe(t,e){t.emit(e,"vm:flush")}function uxe(t,e){t.emit(e,"vm:fork")}function fxe(t,e){t.emit(e,"vm:itchiopublish")}function hxe(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function dxe(t,e){return{filename:t,json:e}}function pxe(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function qh(t,e,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=hxe(i,s);break;case"json":o=dxe(i,s);break;case"binary":o=pxe(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[n,r,i,o])},1)}var ST={},bH;function mxe(){return bH||(bH=1,(function(t){var e=ST&&ST.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,m=u.length,p;d<m;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,m=d===void 0?!0:d,p=l.adjectiveCount,g=p===void 0?1:p,y=l.addAdverb,v=y===void 0?!1:y,x=e(e(e([],e([],Array(g),!0).map(function(E){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),v?[n(t.adverbs)]:[],!0);return m&&(x=x.map(function(E){return E.charAt(0).toUpperCase()+E.substr(1)})),x.join(h)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,m=d===void 0?!1:d;return t.adjectives.length*h*t.nouns.length*t.verbs.length*(m?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,m=d===void 0?!1:d,p=l.separator,g=p===void 0?"":p;return r(t.adjectives).length*h+h*g.length+r(t.nouns).length+g.length+r(t.verbs).length+(m?r(t.adverbs).length+g.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,m=d===void 0?!1:d,p=l.separator,g=p===void 0?"":p;return i(t.adjectives).length*h+h*g.length+i(t.nouns).length+g.length+i(t.verbs).length+(m?i(t.adverbs).length+g.length:0)}t.minLength=c,t.default=s})(ST)),ST}var gxe=mxe();const _8=su(gxe);function f3(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function _xe(t,e){let n;const r=()=>{if(n)return n;const i=indexedDB.open(t);return i.onupgradeneeded=()=>i.result.createObjectStore(e),n=f3(i),n.then(s=>{s.onclose=()=>n=void 0},()=>{}),n};return(i,s)=>r().then(o=>s(o.transaction(e,i).objectStore(e)))}let zD;function v8(){return zD||(zD=_xe("keyval-store","keyval")),zD}function vxe(t,e=v8()){return e("readonly",n=>f3(n.get(t)))}function yxe(t,e=v8()){return e("readonly",n=>Promise.all(t.map(r=>f3(n.get(r)))))}function bxe(t,e,n=v8()){return n("readwrite",r=>new Promise((i,s)=>{r.get(t).onsuccess=function(){try{r.put(e(this.result),t),i(f3(r.transaction))}catch(o){s(o)}}}))}const HD=new Set,xA={emit(t,e,n,r,i){xA.invoke(Dxe(t,e,n,r,i))},invoke(t){HD.forEach(e=>e.handle(t))},connect(t){HD.add(t)},disconnect(t){HD.delete(t)}},Exe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Sxe=t=>crypto.getRandomValues(new Uint8Array(t)),xxe=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i|0;for(;c--;)if(o+=t[a[c]&r]||"",o.length>=s)return o}}},ate=(t,e=21)=>xxe(t,e|0,Sxe),Txe=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=Exe[n[t]&63];return e};var qD,EH;function cte(){return EH||(EH=1,qD="abcdefghijklmnopqrstuvwxyz"),qD}var VD,SH;function lte(){return SH||(SH=1,VD="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),VD}var GD,xH;function ute(){return xH||(xH=1,GD="0123456789"),GD}var $D,TH;function wxe(){return TH||(TH=1,$D="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz"),$D}var WD,wH;function Rxe(){return wH||(wH=1,WD="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz"),WD}var KD,RH;function Cxe(){if(RH)return KD;RH=1;const t=ute(),e=cte(),n=lte();return KD=t+e+n,KD}var XD,CH;function Axe(){return CH||(CH=1,XD={lowercase:cte(),uppercase:lte(),numbers:ute(),nolookalikes:wxe(),nolookalikesSafe:Rxe(),alphanumeric:Cxe()}),XD}var q6=Axe();function va(){return`sid_${Txe(12).replaceAll("-",".")}`}const Mxe=ate(q6.numbers,4),kxe=ate(`${q6.numbers}${q6.lowercase}`,16);function Oxe(){return`pid_${Mxe()}_${kxe()}`}function $p(t){return t?.startsWith("pid_")??!1}function fte(){return _8({capitalize:!1,adjectiveCount:1})}function Ixe(){return _8({addAdverb:!1,capitalize:!1,adjectiveCount:0})}const Nxe=20,AH="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function Pxe(t){const e=d8(t),n=[];for(let r=0;r<Nxe;++r)n.push(AH[Math.floor(e()*AH.length)]);return n.join("")}var en=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t[t.BLBLACK=33]="BLBLACK",t[t.BLDKBLUE=34]="BLDKBLUE",t[t.BLDKGREEN=35]="BLDKGREEN",t[t.BLDKCYAN=36]="BLDKCYAN",t[t.BLDKRED=37]="BLDKRED",t[t.BLDKPURPLE=38]="BLDKPURPLE",t[t.BLDKYELLOW=39]="BLDKYELLOW",t[t.BLLTGRAY=40]="BLLTGRAY",t[t.BLDKGRAY=41]="BLDKGRAY",t[t.BLBLUE=42]="BLBLUE",t[t.BLGREEN=43]="BLGREEN",t[t.BLCYAN=44]="BLCYAN",t[t.BLRED=45]="BLRED",t[t.BLPURPLE=46]="BLPURPLE",t[t.BLYELLOW=47]="BLYELLOW",t[t.BLWHITE=48]="BLWHITE",t))(en||{}),Qn=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t[t.ISGHOST=4]="ISGHOST",t))(Qn||{}),N1=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(N1||{}),pn=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.FIND=18]="FIND",t[t.FLEE=19]="FLEE",t[t.TO=20]="TO",t[t.MID=21]="MID",t[t.OVER=22]="OVER",t[t.UNDER=23]="UNDER",t[t.GROUND=24]="GROUND",t[t.WITHIN=25]="WITHIN",t[t.AWAYBY=26]="AWAYBY",t))(pn||{}),qn=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.HOTKEY=11]="HOTKEY",t[t.COPYIT=12]="COPYIT",t[t.OPENIT=13]="OPENIT",t[t.VIEWIT=14]="VIEWIT",t[t.ZSSEDIT=15]="ZSSEDIT",t[t.CHAREDIT=16]="CHAREDIT",t[t.COLOREDIT=17]="COLOREDIT",t))(qn||{});function hr(t){return Sn(t)?t.toLowerCase().trim():""}function Dxe(t,e,n,r,i){return{session:t,player:e,id:va(),sender:n,target:r,data:i}}function P1(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function lb(t,e=[],n=Ah,r=""){const i=va(),s=hr(t),o=e.map(hr);let a=r;const c={id(){return i},name(){return t},session(l){return ge(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,h){xA.emit(a,l,i,u,h)},reply(l,u,h){c.emit(l.player,`${l.sender}:${u}`,h)},replynext(l,u,h){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,h),64)},handle(l){const{target:u,path:h}=P1(l.target),d=hr(u);!a&&d==="ready"&&(a=l.session),d==="session_reset"&&(a=""),o.findIndex(m=>m==="all"||m===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:h})}};return xA.connect(c),c}var EO={exports:{}},Lxe=EO.exports,MH;function Uxe(){return MH||(MH=1,(function(t,e){(function(n,r){r()})(Lxe,function(){function n(l,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function r(l,u,h){var d=new XMLHttpRequest;d.open("GET",l),d.responseType="blob",d.onload=function(){c(d.response,u,h)},d.onerror=function(){console.error("could not download file")},d.send()}function i(l){var u=new XMLHttpRequest;u.open("HEAD",l,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function s(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(u)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Zp=="object"&&Zp.global===Zp?Zp:void 0,a=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(l,u,h){var d=o.URL||o.webkitURL,m=document.createElement("a");u=u||l.name||"download",m.download=u,m.rel="noopener",typeof l=="string"?(m.href=l,m.origin===location.origin?s(m):i(m.href)?r(l,u,h):s(m,m.target="_blank")):(m.href=d.createObjectURL(l),setTimeout(function(){d.revokeObjectURL(m.href)},4e4),setTimeout(function(){s(m)},0))}:"msSaveOrOpenBlob"in navigator?function(l,u,h){if(u=u||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(n(l,h),u);else if(i(l))r(l,u,h);else{var d=document.createElement("a");d.href=l,d.target="_blank",setTimeout(function(){s(d)})}}:function(l,u,h,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof l=="string")return r(l,u,h);var m=l.type==="application/octet-stream",p=/constructor/i.test(o.HTMLElement)||o.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||m&&p||a)&&typeof FileReader<"u"){var y=new FileReader;y.onloadend=function(){var E=y.result;E=g?E:E.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=E:location=E,d=null},y.readAsDataURL(l)}else{var v=o.URL||o.webkitURL,x=v.createObjectURL(l);d?d.location=x:location.href=x,d=null,setTimeout(function(){v.revokeObjectURL(x)},4e4)}});o.saveAs=c.saveAs=c,t.exports=c})})(EO)),EO.exports}var Bxe=Uxe(),hte={},h3={};h3.byteLength=zxe;h3.toByteArray=qxe;h3.fromByteArray=$xe;var E0=[],zp=[],Fxe=typeof Uint8Array<"u"?Uint8Array:Array,YD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var JE=0,jxe=YD.length;JE<jxe;++JE)E0[JE]=YD[JE],zp[YD.charCodeAt(JE)]=JE;zp[45]=62;zp[95]=63;function dte(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function zxe(t){var e=dte(t),n=e[0],r=e[1];return(n+r)*3/4-r}function Hxe(t,e,n){return(e+n)*3/4-n}function qxe(t){var e,n=dte(t),r=n[0],i=n[1],s=new Fxe(Hxe(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=zp[t.charCodeAt(c)]<<18|zp[t.charCodeAt(c+1)]<<12|zp[t.charCodeAt(c+2)]<<6|zp[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=zp[t.charCodeAt(c)]<<2|zp[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=zp[t.charCodeAt(c)]<<10|zp[t.charCodeAt(c+1)]<<4|zp[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Vxe(t){return E0[t>>18&63]+E0[t>>12&63]+E0[t>>6&63]+E0[t&63]}function Gxe(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(Vxe(r));return i.join("")}function $xe(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Gxe(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(E0[e>>2]+E0[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(E0[e>>10]+E0[e>>4&63]+E0[e<<2&63]+"=")),i.join("")}var y8={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */y8.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=n?i-1:0,d=n?-1:1,m=t[e+h];for(h+=d,s=m&(1<<-u)-1,m>>=-u,u+=a;u>0;s=s*256+t[e+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+h],h+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(m?-1:1)*o*Math.pow(2,s-r)};y8.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=r?0:s-1,p=r?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=d/c:e+=d*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[n+m]=a&255,m+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+m]=o&255,m+=p,o/=256,l-=8);t[n+m-p]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=h3,n=y8,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=A,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const Ie=new s(1),ce={foo:function(){return 42}};return Object.setPrototypeOf(ce,s.prototype),Object.setPrototypeOf(Ie,ce),Ie.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(Ie){if(Ie>i)throw new RangeError('The value "'+Ie+'" is invalid for option "size"');const ce=new s(Ie);return Object.setPrototypeOf(ce,u.prototype),ce}function u(Ie,ce,Q){if(typeof Ie=="number"){if(typeof ce=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(Ie)}return h(Ie,ce,Q)}u.poolSize=8192;function h(Ie,ce,Q){if(typeof Ie=="string")return g(Ie,ce);if(o.isView(Ie))return v(Ie);if(Ie==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ie);if(Ze(Ie,o)||Ie&&Ze(Ie.buffer,o)||typeof a<"u"&&(Ze(Ie,a)||Ie&&Ze(Ie.buffer,a)))return x(Ie,ce,Q);if(typeof Ie=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const le=Ie.valueOf&&Ie.valueOf();if(le!=null&&le!==Ie)return u.from(le,ce,Q);const we=E(Ie);if(we)return we;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Ie[Symbol.toPrimitive]=="function")return u.from(Ie[Symbol.toPrimitive]("string"),ce,Q);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ie)}u.from=function(Ie,ce,Q){return h(Ie,ce,Q)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(Ie){if(typeof Ie!="number")throw new TypeError('"size" argument must be of type number');if(Ie<0)throw new RangeError('The value "'+Ie+'" is invalid for option "size"')}function m(Ie,ce,Q){return d(Ie),Ie<=0?l(Ie):ce!==void 0?typeof Q=="string"?l(Ie).fill(ce,Q):l(Ie).fill(ce):l(Ie)}u.alloc=function(Ie,ce,Q){return m(Ie,ce,Q)};function p(Ie){return d(Ie),l(Ie<0?0:C(Ie)|0)}u.allocUnsafe=function(Ie){return p(Ie)},u.allocUnsafeSlow=function(Ie){return p(Ie)};function g(Ie,ce){if((typeof ce!="string"||ce==="")&&(ce="utf8"),!u.isEncoding(ce))throw new TypeError("Unknown encoding: "+ce);const Q=k(Ie,ce)|0;let le=l(Q);const we=le.write(Ie,ce);return we!==Q&&(le=le.slice(0,we)),le}function y(Ie){const ce=Ie.length<0?0:C(Ie.length)|0,Q=l(ce);for(let le=0;le<ce;le+=1)Q[le]=Ie[le]&255;return Q}function v(Ie){if(Ze(Ie,s)){const ce=new s(Ie);return x(ce.buffer,ce.byteOffset,ce.byteLength)}return y(Ie)}function x(Ie,ce,Q){if(ce<0||Ie.byteLength<ce)throw new RangeError('"offset" is outside of buffer bounds');if(Ie.byteLength<ce+(Q||0))throw new RangeError('"length" is outside of buffer bounds');let le;return ce===void 0&&Q===void 0?le=new s(Ie):Q===void 0?le=new s(Ie,ce):le=new s(Ie,ce,Q),Object.setPrototypeOf(le,u.prototype),le}function E(Ie){if(u.isBuffer(Ie)){const ce=C(Ie.length)|0,Q=l(ce);return Q.length===0||Ie.copy(Q,0,0,ce),Q}if(Ie.length!==void 0)return typeof Ie.length!="number"||tt(Ie.length)?l(0):y(Ie);if(Ie.type==="Buffer"&&Array.isArray(Ie.data))return y(Ie.data)}function C(Ie){if(Ie>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return Ie|0}function A(Ie){return+Ie!=Ie&&(Ie=0),u.alloc(+Ie)}u.isBuffer=function(ce){return ce!=null&&ce._isBuffer===!0&&ce!==u.prototype},u.compare=function(ce,Q){if(Ze(ce,s)&&(ce=u.from(ce,ce.offset,ce.byteLength)),Ze(Q,s)&&(Q=u.from(Q,Q.offset,Q.byteLength)),!u.isBuffer(ce)||!u.isBuffer(Q))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(ce===Q)return 0;let le=ce.length,we=Q.length;for(let Me=0,Te=Math.min(le,we);Me<Te;++Me)if(ce[Me]!==Q[Me]){le=ce[Me],we=Q[Me];break}return le<we?-1:we<le?1:0},u.isEncoding=function(ce){switch(String(ce).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(ce,Q){if(!Array.isArray(ce))throw new TypeError('"list" argument must be an Array of Buffers');if(ce.length===0)return u.alloc(0);let le;if(Q===void 0)for(Q=0,le=0;le<ce.length;++le)Q+=ce[le].length;const we=u.allocUnsafe(Q);let Me=0;for(le=0;le<ce.length;++le){let Te=ce[le];if(Ze(Te,s))Me+Te.length>we.length?(u.isBuffer(Te)||(Te=u.from(Te)),Te.copy(we,Me)):s.prototype.set.call(we,Te,Me);else if(u.isBuffer(Te))Te.copy(we,Me);else throw new TypeError('"list" argument must be an Array of Buffers');Me+=Te.length}return we};function k(Ie,ce){if(u.isBuffer(Ie))return Ie.length;if(o.isView(Ie)||Ze(Ie,o))return Ie.byteLength;if(typeof Ie!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Ie);const Q=Ie.length,le=arguments.length>2&&arguments[2]===!0;if(!le&&Q===0)return 0;let we=!1;for(;;)switch(ce){case"ascii":case"latin1":case"binary":return Q;case"utf8":case"utf-8":return ve(Ie).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q*2;case"hex":return Q>>>1;case"base64":return Ge(Ie).length;default:if(we)return le?-1:ve(Ie).length;ce=(""+ce).toLowerCase(),we=!0}}u.byteLength=k;function M(Ie,ce,Q){let le=!1;if((ce===void 0||ce<0)&&(ce=0),ce>this.length||((Q===void 0||Q>this.length)&&(Q=this.length),Q<=0)||(Q>>>=0,ce>>>=0,Q<=ce))return"";for(Ie||(Ie="utf8");;)switch(Ie){case"hex":return J(this,ce,Q);case"utf8":case"utf-8":return j(this,ce,Q);case"ascii":return W(this,ce,Q);case"latin1":case"binary":return $(this,ce,Q);case"base64":return G(this,ce,Q);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ne(this,ce,Q);default:if(le)throw new TypeError("Unknown encoding: "+Ie);Ie=(Ie+"").toLowerCase(),le=!0}}u.prototype._isBuffer=!0;function I(Ie,ce,Q){const le=Ie[ce];Ie[ce]=Ie[Q],Ie[Q]=le}u.prototype.swap16=function(){const ce=this.length;if(ce%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let Q=0;Q<ce;Q+=2)I(this,Q,Q+1);return this},u.prototype.swap32=function(){const ce=this.length;if(ce%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let Q=0;Q<ce;Q+=4)I(this,Q,Q+3),I(this,Q+1,Q+2);return this},u.prototype.swap64=function(){const ce=this.length;if(ce%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let Q=0;Q<ce;Q+=8)I(this,Q,Q+7),I(this,Q+1,Q+6),I(this,Q+2,Q+5),I(this,Q+3,Q+4);return this},u.prototype.toString=function(){const ce=this.length;return ce===0?"":arguments.length===0?j(this,0,ce):M.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(ce){if(!u.isBuffer(ce))throw new TypeError("Argument must be a Buffer");return this===ce?!0:u.compare(this,ce)===0},u.prototype.inspect=function(){let ce="";const Q=t.INSPECT_MAX_BYTES;return ce=this.toString("hex",0,Q).replace(/(.{2})/g,"$1 ").trim(),this.length>Q&&(ce+=" ... "),"<Buffer "+ce+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(ce,Q,le,we,Me){if(Ze(ce,s)&&(ce=u.from(ce,ce.offset,ce.byteLength)),!u.isBuffer(ce))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof ce);if(Q===void 0&&(Q=0),le===void 0&&(le=ce?ce.length:0),we===void 0&&(we=0),Me===void 0&&(Me=this.length),Q<0||le>ce.length||we<0||Me>this.length)throw new RangeError("out of range index");if(we>=Me&&Q>=le)return 0;if(we>=Me)return-1;if(Q>=le)return 1;if(Q>>>=0,le>>>=0,we>>>=0,Me>>>=0,this===ce)return 0;let Te=Me-we,ye=le-Q;const Ye=Math.min(Te,ye),Pe=this.slice(we,Me),We=ce.slice(Q,le);for(let Ve=0;Ve<Ye;++Ve)if(Pe[Ve]!==We[Ve]){Te=Pe[Ve],ye=We[Ve];break}return Te<ye?-1:ye<Te?1:0};function z(Ie,ce,Q,le,we){if(Ie.length===0)return-1;if(typeof Q=="string"?(le=Q,Q=0):Q>2147483647?Q=2147483647:Q<-2147483648&&(Q=-2147483648),Q=+Q,tt(Q)&&(Q=we?0:Ie.length-1),Q<0&&(Q=Ie.length+Q),Q>=Ie.length){if(we)return-1;Q=Ie.length-1}else if(Q<0)if(we)Q=0;else return-1;if(typeof ce=="string"&&(ce=u.from(ce,le)),u.isBuffer(ce))return ce.length===0?-1:H(Ie,ce,Q,le,we);if(typeof ce=="number")return ce=ce&255,typeof s.prototype.indexOf=="function"?we?s.prototype.indexOf.call(Ie,ce,Q):s.prototype.lastIndexOf.call(Ie,ce,Q):H(Ie,[ce],Q,le,we);throw new TypeError("val must be string, number or Buffer")}function H(Ie,ce,Q,le,we){let Me=1,Te=Ie.length,ye=ce.length;if(le!==void 0&&(le=String(le).toLowerCase(),le==="ucs2"||le==="ucs-2"||le==="utf16le"||le==="utf-16le")){if(Ie.length<2||ce.length<2)return-1;Me=2,Te/=2,ye/=2,Q/=2}function Ye(We,Ve){return Me===1?We[Ve]:We.readUInt16BE(Ve*Me)}let Pe;if(we){let We=-1;for(Pe=Q;Pe<Te;Pe++)if(Ye(Ie,Pe)===Ye(ce,We===-1?0:Pe-We)){if(We===-1&&(We=Pe),Pe-We+1===ye)return We*Me}else We!==-1&&(Pe-=Pe-We),We=-1}else for(Q+ye>Te&&(Q=Te-ye),Pe=Q;Pe>=0;Pe--){let We=!0;for(let Ve=0;Ve<ye;Ve++)if(Ye(Ie,Pe+Ve)!==Ye(ce,Ve)){We=!1;break}if(We)return Pe}return-1}u.prototype.includes=function(ce,Q,le){return this.indexOf(ce,Q,le)!==-1},u.prototype.indexOf=function(ce,Q,le){return z(this,ce,Q,le,!0)},u.prototype.lastIndexOf=function(ce,Q,le){return z(this,ce,Q,le,!1)};function K(Ie,ce,Q,le){Q=Number(Q)||0;const we=Ie.length-Q;le?(le=Number(le),le>we&&(le=we)):le=we;const Me=ce.length;le>Me/2&&(le=Me/2);let Te;for(Te=0;Te<le;++Te){const ye=parseInt(ce.substr(Te*2,2),16);if(tt(ye))return Te;Ie[Q+Te]=ye}return Te}function P(Ie,ce,Q,le){return Qe(ve(ce,Ie.length-Q),Ie,Q,le)}function F(Ie,ce,Q,le){return Qe(Ae(ce),Ie,Q,le)}function N(Ie,ce,Q,le){return Qe(Ge(ce),Ie,Q,le)}function X(Ie,ce,Q,le){return Qe(pe(ce,Ie.length-Q),Ie,Q,le)}u.prototype.write=function(ce,Q,le,we){if(Q===void 0)we="utf8",le=this.length,Q=0;else if(le===void 0&&typeof Q=="string")we=Q,le=this.length,Q=0;else if(isFinite(Q))Q=Q>>>0,isFinite(le)?(le=le>>>0,we===void 0&&(we="utf8")):(we=le,le=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Me=this.length-Q;if((le===void 0||le>Me)&&(le=Me),ce.length>0&&(le<0||Q<0)||Q>this.length)throw new RangeError("Attempt to write outside buffer bounds");we||(we="utf8");let Te=!1;for(;;)switch(we){case"hex":return K(this,ce,Q,le);case"utf8":case"utf-8":return P(this,ce,Q,le);case"ascii":case"latin1":case"binary":return F(this,ce,Q,le);case"base64":return N(this,ce,Q,le);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return X(this,ce,Q,le);default:if(Te)throw new TypeError("Unknown encoding: "+we);we=(""+we).toLowerCase(),Te=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function G(Ie,ce,Q){return ce===0&&Q===Ie.length?e.fromByteArray(Ie):e.fromByteArray(Ie.slice(ce,Q))}function j(Ie,ce,Q){Q=Math.min(Ie.length,Q);const le=[];let we=ce;for(;we<Q;){const Me=Ie[we];let Te=null,ye=Me>239?4:Me>223?3:Me>191?2:1;if(we+ye<=Q){let Ye,Pe,We,Ve;switch(ye){case 1:Me<128&&(Te=Me);break;case 2:Ye=Ie[we+1],(Ye&192)===128&&(Ve=(Me&31)<<6|Ye&63,Ve>127&&(Te=Ve));break;case 3:Ye=Ie[we+1],Pe=Ie[we+2],(Ye&192)===128&&(Pe&192)===128&&(Ve=(Me&15)<<12|(Ye&63)<<6|Pe&63,Ve>2047&&(Ve<55296||Ve>57343)&&(Te=Ve));break;case 4:Ye=Ie[we+1],Pe=Ie[we+2],We=Ie[we+3],(Ye&192)===128&&(Pe&192)===128&&(We&192)===128&&(Ve=(Me&15)<<18|(Ye&63)<<12|(Pe&63)<<6|We&63,Ve>65535&&Ve<1114112&&(Te=Ve))}}Te===null?(Te=65533,ye=1):Te>65535&&(Te-=65536,le.push(Te>>>10&1023|55296),Te=56320|Te&1023),le.push(Te),we+=ye}return te(le)}const q=4096;function te(Ie){const ce=Ie.length;if(ce<=q)return String.fromCharCode.apply(String,Ie);let Q="",le=0;for(;le<ce;)Q+=String.fromCharCode.apply(String,Ie.slice(le,le+=q));return Q}function W(Ie,ce,Q){let le="";Q=Math.min(Ie.length,Q);for(let we=ce;we<Q;++we)le+=String.fromCharCode(Ie[we]&127);return le}function $(Ie,ce,Q){let le="";Q=Math.min(Ie.length,Q);for(let we=ce;we<Q;++we)le+=String.fromCharCode(Ie[we]);return le}function J(Ie,ce,Q){const le=Ie.length;(!ce||ce<0)&&(ce=0),(!Q||Q<0||Q>le)&&(Q=le);let we="";for(let Me=ce;Me<Q;++Me)we+=Ft[Ie[Me]];return we}function ne(Ie,ce,Q){const le=Ie.slice(ce,Q);let we="";for(let Me=0;Me<le.length-1;Me+=2)we+=String.fromCharCode(le[Me]+le[Me+1]*256);return we}u.prototype.slice=function(ce,Q){const le=this.length;ce=~~ce,Q=Q===void 0?le:~~Q,ce<0?(ce+=le,ce<0&&(ce=0)):ce>le&&(ce=le),Q<0?(Q+=le,Q<0&&(Q=0)):Q>le&&(Q=le),Q<ce&&(Q=ce);const we=this.subarray(ce,Q);return Object.setPrototypeOf(we,u.prototype),we};function ie(Ie,ce,Q){if(Ie%1!==0||Ie<0)throw new RangeError("offset is not uint");if(Ie+ce>Q)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(ce,Q,le){ce=ce>>>0,Q=Q>>>0,le||ie(ce,Q,this.length);let we=this[ce],Me=1,Te=0;for(;++Te<Q&&(Me*=256);)we+=this[ce+Te]*Me;return we},u.prototype.readUintBE=u.prototype.readUIntBE=function(ce,Q,le){ce=ce>>>0,Q=Q>>>0,le||ie(ce,Q,this.length);let we=this[ce+--Q],Me=1;for(;Q>0&&(Me*=256);)we+=this[ce+--Q]*Me;return we},u.prototype.readUint8=u.prototype.readUInt8=function(ce,Q){return ce=ce>>>0,Q||ie(ce,1,this.length),this[ce]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(ce,Q){return ce=ce>>>0,Q||ie(ce,2,this.length),this[ce]|this[ce+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(ce,Q){return ce=ce>>>0,Q||ie(ce,2,this.length),this[ce]<<8|this[ce+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(ce,Q){return ce=ce>>>0,Q||ie(ce,4,this.length),(this[ce]|this[ce+1]<<8|this[ce+2]<<16)+this[ce+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(ce,Q){return ce=ce>>>0,Q||ie(ce,4,this.length),this[ce]*16777216+(this[ce+1]<<16|this[ce+2]<<8|this[ce+3])},u.prototype.readBigUInt64LE=bt(function(ce){ce=ce>>>0,He(ce,"offset");const Q=this[ce],le=this[ce+7];(Q===void 0||le===void 0)&&Ue(ce,this.length-8);const we=Q+this[++ce]*2**8+this[++ce]*2**16+this[++ce]*2**24,Me=this[++ce]+this[++ce]*2**8+this[++ce]*2**16+le*2**24;return BigInt(we)+(BigInt(Me)<<BigInt(32))}),u.prototype.readBigUInt64BE=bt(function(ce){ce=ce>>>0,He(ce,"offset");const Q=this[ce],le=this[ce+7];(Q===void 0||le===void 0)&&Ue(ce,this.length-8);const we=Q*2**24+this[++ce]*2**16+this[++ce]*2**8+this[++ce],Me=this[++ce]*2**24+this[++ce]*2**16+this[++ce]*2**8+le;return(BigInt(we)<<BigInt(32))+BigInt(Me)}),u.prototype.readIntLE=function(ce,Q,le){ce=ce>>>0,Q=Q>>>0,le||ie(ce,Q,this.length);let we=this[ce],Me=1,Te=0;for(;++Te<Q&&(Me*=256);)we+=this[ce+Te]*Me;return Me*=128,we>=Me&&(we-=Math.pow(2,8*Q)),we},u.prototype.readIntBE=function(ce,Q,le){ce=ce>>>0,Q=Q>>>0,le||ie(ce,Q,this.length);let we=Q,Me=1,Te=this[ce+--we];for(;we>0&&(Me*=256);)Te+=this[ce+--we]*Me;return Me*=128,Te>=Me&&(Te-=Math.pow(2,8*Q)),Te},u.prototype.readInt8=function(ce,Q){return ce=ce>>>0,Q||ie(ce,1,this.length),this[ce]&128?(255-this[ce]+1)*-1:this[ce]},u.prototype.readInt16LE=function(ce,Q){ce=ce>>>0,Q||ie(ce,2,this.length);const le=this[ce]|this[ce+1]<<8;return le&32768?le|4294901760:le},u.prototype.readInt16BE=function(ce,Q){ce=ce>>>0,Q||ie(ce,2,this.length);const le=this[ce+1]|this[ce]<<8;return le&32768?le|4294901760:le},u.prototype.readInt32LE=function(ce,Q){return ce=ce>>>0,Q||ie(ce,4,this.length),this[ce]|this[ce+1]<<8|this[ce+2]<<16|this[ce+3]<<24},u.prototype.readInt32BE=function(ce,Q){return ce=ce>>>0,Q||ie(ce,4,this.length),this[ce]<<24|this[ce+1]<<16|this[ce+2]<<8|this[ce+3]},u.prototype.readBigInt64LE=bt(function(ce){ce=ce>>>0,He(ce,"offset");const Q=this[ce],le=this[ce+7];(Q===void 0||le===void 0)&&Ue(ce,this.length-8);const we=this[ce+4]+this[ce+5]*2**8+this[ce+6]*2**16+(le<<24);return(BigInt(we)<<BigInt(32))+BigInt(Q+this[++ce]*2**8+this[++ce]*2**16+this[++ce]*2**24)}),u.prototype.readBigInt64BE=bt(function(ce){ce=ce>>>0,He(ce,"offset");const Q=this[ce],le=this[ce+7];(Q===void 0||le===void 0)&&Ue(ce,this.length-8);const we=(Q<<24)+this[++ce]*2**16+this[++ce]*2**8+this[++ce];return(BigInt(we)<<BigInt(32))+BigInt(this[++ce]*2**24+this[++ce]*2**16+this[++ce]*2**8+le)}),u.prototype.readFloatLE=function(ce,Q){return ce=ce>>>0,Q||ie(ce,4,this.length),n.read(this,ce,!0,23,4)},u.prototype.readFloatBE=function(ce,Q){return ce=ce>>>0,Q||ie(ce,4,this.length),n.read(this,ce,!1,23,4)},u.prototype.readDoubleLE=function(ce,Q){return ce=ce>>>0,Q||ie(ce,8,this.length),n.read(this,ce,!0,52,8)},u.prototype.readDoubleBE=function(ce,Q){return ce=ce>>>0,Q||ie(ce,8,this.length),n.read(this,ce,!1,52,8)};function ae(Ie,ce,Q,le,we,Me){if(!u.isBuffer(Ie))throw new TypeError('"buffer" argument must be a Buffer instance');if(ce>we||ce<Me)throw new RangeError('"value" argument is out of bounds');if(Q+le>Ie.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(ce,Q,le,we){if(ce=+ce,Q=Q>>>0,le=le>>>0,!we){const ye=Math.pow(2,8*le)-1;ae(this,ce,Q,le,ye,0)}let Me=1,Te=0;for(this[Q]=ce&255;++Te<le&&(Me*=256);)this[Q+Te]=ce/Me&255;return Q+le},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(ce,Q,le,we){if(ce=+ce,Q=Q>>>0,le=le>>>0,!we){const ye=Math.pow(2,8*le)-1;ae(this,ce,Q,le,ye,0)}let Me=le-1,Te=1;for(this[Q+Me]=ce&255;--Me>=0&&(Te*=256);)this[Q+Me]=ce/Te&255;return Q+le},u.prototype.writeUint8=u.prototype.writeUInt8=function(ce,Q,le){return ce=+ce,Q=Q>>>0,le||ae(this,ce,Q,1,255,0),this[Q]=ce&255,Q+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(ce,Q,le){return ce=+ce,Q=Q>>>0,le||ae(this,ce,Q,2,65535,0),this[Q]=ce&255,this[Q+1]=ce>>>8,Q+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(ce,Q,le){return ce=+ce,Q=Q>>>0,le||ae(this,ce,Q,2,65535,0),this[Q]=ce>>>8,this[Q+1]=ce&255,Q+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(ce,Q,le){return ce=+ce,Q=Q>>>0,le||ae(this,ce,Q,4,4294967295,0),this[Q+3]=ce>>>24,this[Q+2]=ce>>>16,this[Q+1]=ce>>>8,this[Q]=ce&255,Q+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(ce,Q,le){return ce=+ce,Q=Q>>>0,le||ae(this,ce,Q,4,4294967295,0),this[Q]=ce>>>24,this[Q+1]=ce>>>16,this[Q+2]=ce>>>8,this[Q+3]=ce&255,Q+4};function xe(Ie,ce,Q,le,we){Le(ce,le,we,Ie,Q,7);let Me=Number(ce&BigInt(4294967295));Ie[Q++]=Me,Me=Me>>8,Ie[Q++]=Me,Me=Me>>8,Ie[Q++]=Me,Me=Me>>8,Ie[Q++]=Me;let Te=Number(ce>>BigInt(32)&BigInt(4294967295));return Ie[Q++]=Te,Te=Te>>8,Ie[Q++]=Te,Te=Te>>8,Ie[Q++]=Te,Te=Te>>8,Ie[Q++]=Te,Q}function Ne(Ie,ce,Q,le,we){Le(ce,le,we,Ie,Q,7);let Me=Number(ce&BigInt(4294967295));Ie[Q+7]=Me,Me=Me>>8,Ie[Q+6]=Me,Me=Me>>8,Ie[Q+5]=Me,Me=Me>>8,Ie[Q+4]=Me;let Te=Number(ce>>BigInt(32)&BigInt(4294967295));return Ie[Q+3]=Te,Te=Te>>8,Ie[Q+2]=Te,Te=Te>>8,Ie[Q+1]=Te,Te=Te>>8,Ie[Q]=Te,Q+8}u.prototype.writeBigUInt64LE=bt(function(ce,Q=0){return xe(this,ce,Q,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=bt(function(ce,Q=0){return Ne(this,ce,Q,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(ce,Q,le,we){if(ce=+ce,Q=Q>>>0,!we){const Ye=Math.pow(2,8*le-1);ae(this,ce,Q,le,Ye-1,-Ye)}let Me=0,Te=1,ye=0;for(this[Q]=ce&255;++Me<le&&(Te*=256);)ce<0&&ye===0&&this[Q+Me-1]!==0&&(ye=1),this[Q+Me]=(ce/Te>>0)-ye&255;return Q+le},u.prototype.writeIntBE=function(ce,Q,le,we){if(ce=+ce,Q=Q>>>0,!we){const Ye=Math.pow(2,8*le-1);ae(this,ce,Q,le,Ye-1,-Ye)}let Me=le-1,Te=1,ye=0;for(this[Q+Me]=ce&255;--Me>=0&&(Te*=256);)ce<0&&ye===0&&this[Q+Me+1]!==0&&(ye=1),this[Q+Me]=(ce/Te>>0)-ye&255;return Q+le},u.prototype.writeInt8=function(ce,Q,le){return ce=+ce,Q=Q>>>0,le||ae(this,ce,Q,1,127,-128),ce<0&&(ce=255+ce+1),this[Q]=ce&255,Q+1},u.prototype.writeInt16LE=function(ce,Q,le){return ce=+ce,Q=Q>>>0,le||ae(this,ce,Q,2,32767,-32768),this[Q]=ce&255,this[Q+1]=ce>>>8,Q+2},u.prototype.writeInt16BE=function(ce,Q,le){return ce=+ce,Q=Q>>>0,le||ae(this,ce,Q,2,32767,-32768),this[Q]=ce>>>8,this[Q+1]=ce&255,Q+2},u.prototype.writeInt32LE=function(ce,Q,le){return ce=+ce,Q=Q>>>0,le||ae(this,ce,Q,4,2147483647,-2147483648),this[Q]=ce&255,this[Q+1]=ce>>>8,this[Q+2]=ce>>>16,this[Q+3]=ce>>>24,Q+4},u.prototype.writeInt32BE=function(ce,Q,le){return ce=+ce,Q=Q>>>0,le||ae(this,ce,Q,4,2147483647,-2147483648),ce<0&&(ce=4294967295+ce+1),this[Q]=ce>>>24,this[Q+1]=ce>>>16,this[Q+2]=ce>>>8,this[Q+3]=ce&255,Q+4},u.prototype.writeBigInt64LE=bt(function(ce,Q=0){return xe(this,ce,Q,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=bt(function(ce,Q=0){return Ne(this,ce,Q,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Re(Ie,ce,Q,le,we,Me){if(Q+le>Ie.length)throw new RangeError("Index out of range");if(Q<0)throw new RangeError("Index out of range")}function Se(Ie,ce,Q,le,we){return ce=+ce,Q=Q>>>0,we||Re(Ie,ce,Q,4),n.write(Ie,ce,Q,le,23,4),Q+4}u.prototype.writeFloatLE=function(ce,Q,le){return Se(this,ce,Q,!0,le)},u.prototype.writeFloatBE=function(ce,Q,le){return Se(this,ce,Q,!1,le)};function ze(Ie,ce,Q,le,we){return ce=+ce,Q=Q>>>0,we||Re(Ie,ce,Q,8),n.write(Ie,ce,Q,le,52,8),Q+8}u.prototype.writeDoubleLE=function(ce,Q,le){return ze(this,ce,Q,!0,le)},u.prototype.writeDoubleBE=function(ce,Q,le){return ze(this,ce,Q,!1,le)},u.prototype.copy=function(ce,Q,le,we){if(!u.isBuffer(ce))throw new TypeError("argument should be a Buffer");if(le||(le=0),!we&&we!==0&&(we=this.length),Q>=ce.length&&(Q=ce.length),Q||(Q=0),we>0&&we<le&&(we=le),we===le||ce.length===0||this.length===0)return 0;if(Q<0)throw new RangeError("targetStart out of bounds");if(le<0||le>=this.length)throw new RangeError("Index out of range");if(we<0)throw new RangeError("sourceEnd out of bounds");we>this.length&&(we=this.length),ce.length-Q<we-le&&(we=ce.length-Q+le);const Me=we-le;return this===ce&&typeof s.prototype.copyWithin=="function"?this.copyWithin(Q,le,we):s.prototype.set.call(ce,this.subarray(le,we),Q),Me},u.prototype.fill=function(ce,Q,le,we){if(typeof ce=="string"){if(typeof Q=="string"?(we=Q,Q=0,le=this.length):typeof le=="string"&&(we=le,le=this.length),we!==void 0&&typeof we!="string")throw new TypeError("encoding must be a string");if(typeof we=="string"&&!u.isEncoding(we))throw new TypeError("Unknown encoding: "+we);if(ce.length===1){const Te=ce.charCodeAt(0);(we==="utf8"&&Te<128||we==="latin1")&&(ce=Te)}}else typeof ce=="number"?ce=ce&255:typeof ce=="boolean"&&(ce=Number(ce));if(Q<0||this.length<Q||this.length<le)throw new RangeError("Out of range index");if(le<=Q)return this;Q=Q>>>0,le=le===void 0?this.length:le>>>0,ce||(ce=0);let Me;if(typeof ce=="number")for(Me=Q;Me<le;++Me)this[Me]=ce;else{const Te=u.isBuffer(ce)?ce:u.from(ce,we),ye=Te.length;if(ye===0)throw new TypeError('The value "'+ce+'" is invalid for argument "value"');for(Me=0;Me<le-Q;++Me)this[Me+Q]=Te[Me%ye]}return this};const Be={};function Je(Ie,ce,Q){Be[Ie]=class extends Q{constructor(){super(),Object.defineProperty(this,"message",{value:ce.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Ie}]`,this.stack,delete this.name}get code(){return Ie}set code(we){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:we,writable:!0})}toString(){return`${this.name} [${Ie}]: ${this.message}`}}}Je("ERR_BUFFER_OUT_OF_BOUNDS",function(Ie){return Ie?`${Ie} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Je("ERR_INVALID_ARG_TYPE",function(Ie,ce){return`The "${Ie}" argument must be of type number. Received type ${typeof ce}`},TypeError),Je("ERR_OUT_OF_RANGE",function(Ie,ce,Q){let le=`The value of "${Ie}" is out of range.`,we=Q;return Number.isInteger(Q)&&Math.abs(Q)>2**32?we=at(String(Q)):typeof Q=="bigint"&&(we=String(Q),(Q>BigInt(2)**BigInt(32)||Q<-(BigInt(2)**BigInt(32)))&&(we=at(we)),we+="n"),le+=` It must be ${ce}. Received ${we}`,le},RangeError);function at(Ie){let ce="",Q=Ie.length;const le=Ie[0]==="-"?1:0;for(;Q>=le+4;Q-=3)ce=`_${Ie.slice(Q-3,Q)}${ce}`;return`${Ie.slice(0,Q)}${ce}`}function re(Ie,ce,Q){He(ce,"offset"),(Ie[ce]===void 0||Ie[ce+Q]===void 0)&&Ue(ce,Ie.length-(Q+1))}function Le(Ie,ce,Q,le,we,Me){if(Ie>Q||Ie<ce){const Te=typeof ce=="bigint"?"n":"";let ye;throw ce===0||ce===BigInt(0)?ye=`>= 0${Te} and < 2${Te} ** ${(Me+1)*8}${Te}`:ye=`>= -(2${Te} ** ${(Me+1)*8-1}${Te}) and < 2 ** ${(Me+1)*8-1}${Te}`,new Be.ERR_OUT_OF_RANGE("value",ye,Ie)}re(le,we,Me)}function He(Ie,ce){if(typeof Ie!="number")throw new Be.ERR_INVALID_ARG_TYPE(ce,"number",Ie)}function Ue(Ie,ce,Q){throw Math.floor(Ie)!==Ie?(He(Ie,Q),new Be.ERR_OUT_OF_RANGE("offset","an integer",Ie)):ce<0?new Be.ERR_BUFFER_OUT_OF_BOUNDS:new Be.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${ce}`,Ie)}const De=/[^+/0-9A-Za-z-_]/g;function fe(Ie){if(Ie=Ie.split("=")[0],Ie=Ie.trim().replace(De,""),Ie.length<2)return"";for(;Ie.length%4!==0;)Ie=Ie+"=";return Ie}function ve(Ie,ce){ce=ce||1/0;let Q;const le=Ie.length;let we=null;const Me=[];for(let Te=0;Te<le;++Te){if(Q=Ie.charCodeAt(Te),Q>55295&&Q<57344){if(!we){if(Q>56319){(ce-=3)>-1&&Me.push(239,191,189);continue}else if(Te+1===le){(ce-=3)>-1&&Me.push(239,191,189);continue}we=Q;continue}if(Q<56320){(ce-=3)>-1&&Me.push(239,191,189),we=Q;continue}Q=(we-55296<<10|Q-56320)+65536}else we&&(ce-=3)>-1&&Me.push(239,191,189);if(we=null,Q<128){if((ce-=1)<0)break;Me.push(Q)}else if(Q<2048){if((ce-=2)<0)break;Me.push(Q>>6|192,Q&63|128)}else if(Q<65536){if((ce-=3)<0)break;Me.push(Q>>12|224,Q>>6&63|128,Q&63|128)}else if(Q<1114112){if((ce-=4)<0)break;Me.push(Q>>18|240,Q>>12&63|128,Q>>6&63|128,Q&63|128)}else throw new Error("Invalid code point")}return Me}function Ae(Ie){const ce=[];for(let Q=0;Q<Ie.length;++Q)ce.push(Ie.charCodeAt(Q)&255);return ce}function pe(Ie,ce){let Q,le,we;const Me=[];for(let Te=0;Te<Ie.length&&!((ce-=2)<0);++Te)Q=Ie.charCodeAt(Te),le=Q>>8,we=Q%256,Me.push(we),Me.push(le);return Me}function Ge(Ie){return e.toByteArray(fe(Ie))}function Qe(Ie,ce,Q,le){let we;for(we=0;we<le&&!(we+Q>=ce.length||we>=Ie.length);++we)ce[we+Q]=Ie[we];return we}function Ze(Ie,ce){return Ie instanceof ce||Ie!=null&&Ie.constructor!=null&&Ie.constructor.name!=null&&Ie.constructor.name===ce.name}function tt(Ie){return Ie!==Ie}const Ft=(function(){const Ie="0123456789abcdef",ce=new Array(256);for(let Q=0;Q<16;++Q){const le=Q*16;for(let we=0;we<16;++we)ce[le+we]=Ie[Q]+Ie[we]}return ce})();function bt(Ie){return typeof BigInt>"u"?Mt:Ie}function Mt(){throw new Error("BigInt not supported")}})(hte);const Lo=hte.Buffer;function rk(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ZD={exports:{}},kH;function Wxe(){return kH||(kH=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var h=typeof rk=="function"&&rk;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var m=i[l]={exports:{}};r[l][0].call(m.exports,function(p){var g=r[l][1][p];return o(g||p)},m,m.exports,n,r,i,s)}return i[l].exports}for(var a=typeof rk=="function"&&rk,c=0;c<s.length;c++)o(s[c]);return o})({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,d,m,p,g,y=[],v=0,x=c.length,E=x,C=s.getTypeOf(c)!=="string";v<c.length;)E=x-v,h=C?(l=c[v++],u=v<x?c[v++]:0,v<x?c[v++]:0):(l=c.charCodeAt(v++),u=v<x?c.charCodeAt(v++):0,v<x?c.charCodeAt(v++):0),d=l>>2,m=(3&l)<<4|u>>4,p=1<E?(15&u)<<2|h>>6:64,g=2<E?63&h:64,y.push(a.charAt(d)+a.charAt(m)+a.charAt(p)+a.charAt(g));return y.join("")},i.decode=function(c){var l,u,h,d,m,p,g=0,y=0,v="data:";if(c.substr(0,v.length)===v)throw new Error("Invalid base64 input, it looks like a data url.");var x,E=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&E--,c.charAt(c.length-2)===a.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=o.uint8array?new Uint8Array(0|E):new Array(0|E);g<c.length;)l=a.indexOf(c.charAt(g++))<<2|(d=a.indexOf(c.charAt(g++)))>>4,u=(15&d)<<4|(m=a.indexOf(c.charAt(g++)))>>2,h=(3&m)<<6|(p=a.indexOf(c.charAt(g++))),x[y++]=l,m!==64&&(x[y++]=u),p!==64&&(x[y++]=h);return x}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,h,d,m,p){this.compressedSize=u,this.uncompressedSize=h,this.crc32=d,this.compression=m,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=(function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c})();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?(function(l,u,h,d){var m=o,p=d+h;l^=-1;for(var g=d;g<p;g++)l=l>>>8^m[255&(l^u[g])];return-1^l})(0|c,a,a.length,0):(function(l,u,h,d){var m=o,p=d+h;l^=-1;for(var g=d;g<p;g++)l=l>>>8^m[255&(l^u.charCodeAt(g))];return-1^l})(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(m,p){var g,y="";for(g=0;g<p;g++)y+=String.fromCharCode(255&m),m>>>=8;return y}function o(m,p,g,y,v,x){var E,C,A=m.file,k=m.compression,M=x!==l.utf8encode,I=a.transformTo("string",x(A.name)),z=a.transformTo("string",l.utf8encode(A.name)),H=A.comment,K=a.transformTo("string",x(H)),P=a.transformTo("string",l.utf8encode(H)),F=z.length!==A.name.length,N=P.length!==H.length,X="",G="",j="",q=A.dir,te=A.date,W={crc32:0,compressedSize:0,uncompressedSize:0};p&&!g||(W.crc32=m.crc32,W.compressedSize=m.compressedSize,W.uncompressedSize=m.uncompressedSize);var $=0;p&&($|=8),M||!F&&!N||($|=2048);var J=0,ne=0;q&&(J|=16),v==="UNIX"?(ne=798,J|=(function(ae,xe){var Ne=ae;return ae||(Ne=xe?16893:33204),(65535&Ne)<<16})(A.unixPermissions,q)):(ne=20,J|=(function(ae){return 63&(ae||0)})(A.dosPermissions)),E=te.getUTCHours(),E<<=6,E|=te.getUTCMinutes(),E<<=5,E|=te.getUTCSeconds()/2,C=te.getUTCFullYear()-1980,C<<=4,C|=te.getUTCMonth()+1,C<<=5,C|=te.getUTCDate(),F&&(G=s(1,1)+s(u(I),4)+z,X+="up"+s(G.length,2)+G),N&&(j=s(1,1)+s(u(K),4)+P,X+="uc"+s(j.length,2)+j);var ie="";return ie+=`
\0`,ie+=s($,2),ie+=k.magic,ie+=s(E,2),ie+=s(C,2),ie+=s(W.crc32,4),ie+=s(W.compressedSize,4),ie+=s(W.uncompressedSize,4),ie+=s(I.length,2),ie+=s(X.length,2),{fileRecord:h.LOCAL_FILE_HEADER+ie+I+X,dirRecord:h.CENTRAL_FILE_HEADER+s(ne,2)+ie+s(K.length,2)+"\0\0\0\0"+s(J,4)+s(y,4)+I+X+K}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),h=n("../signature");function d(m,p,g,y){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=g,this.encodeFileName=y,this.streamFiles=m,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(m){var p=m.meta.percent||0,g=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(m):(this.bytesWritten+=m.data.length,c.prototype.push.call(this,{data:m.data,meta:{currentFile:this.currentFile,percent:g?(p+100*(g-y-1))/g:100}}))},d.prototype.openedSource=function(m){this.currentSourceOffset=this.bytesWritten,this.currentFile=m.file.name;var p=this.streamFiles&&!m.file.dir;if(p){var g=o(m,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(m){this.accumulate=!1;var p=this.streamFiles&&!m.file.dir,g=o(m,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),p)this.push({data:(function(y){return h.DATA_DESCRIPTOR+s(y.crc32,4)+s(y.compressedSize,4)+s(y.uncompressedSize,4)})(m),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var m=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var g=this.bytesWritten-m,y=(function(v,x,E,C,A){var k=a.transformTo("string",A(C));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(v,2)+s(v,2)+s(x,4)+s(E,4)+s(k.length,2)+k})(this.dirRecords.length,g,m,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(m){this._sources.push(m);var p=this;return m.on("data",function(g){p.processChunk(g)}),m.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),m.on("error",function(g){p.error(g)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(m){var p=this._sources;if(!c.prototype.error.call(this,m))return!1;for(var g=0;g<p.length;g++)try{p[g].error(m)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var m=this._sources,p=0;p<m.length;p++)m[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,m){h++;var p=(function(x,E){var C=x||E,A=s[C];if(!A)throw new Error(C+" is not a valid compression method !");return A})(m.options.compression,c.compression),g=m.options.compressionOptions||c.compressionOptions||{},y=m.dir,v=m.date;m._compressWorker(p,g).withStreamInfo("file",{name:d,dir:y,date:v,comment:m.comment||"",unixPermissions:m.unixPermissions,dosPermissions:m.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function h(d){return new o.Promise(function(m,p){var g=d.decompressed.getContentWorker().pipe(new l);g.on("error",function(y){p(y)}).on("end",function(){g.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):m()}).resume()})}r.exports=function(d,m){var p=this;return m=s.extend(m||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,m.optimizedBinaryString,m.base64).then(function(g){var y=new c(m);return y.load(g),y}).then(function(g){var y=[o.Promise.resolve(g)],v=g.files;if(m.checkCRC32)for(var x=0;x<v.length;x++)y.push(h(v[x]));return o.Promise.all(y)}).then(function(g){for(var y=g.shift(),v=y.files,x=0;x<v.length;x++){var E=v[x],C=E.fileNameStr,A=s.resolve(E.fileNameStr);p.file(A,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:m.createFolders}),E.dir||(p.file(A).unsafeOriginalName=C)}return y.zipComment.length&&(p.comment=y.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,d){u.push(h)||u._helper.pause(),l&&l(d)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Lo<"u",newBufferFrom:function(s,o){if(Lo.from&&Lo.from!==Uint8Array.from)return Lo.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Lo(s,o)},allocBuffer:function(s){if(Lo.alloc)return Lo.alloc(s);var o=new Lo(s);return o.fill(0),o},isBuffer:function(s){return Lo.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(A,k,M){var I,z=a.getTypeOf(k),H=a.extend(M||{},u);H.date=H.date||new Date,H.compression!==null&&(H.compression=H.compression.toUpperCase()),typeof H.unixPermissions=="string"&&(H.unixPermissions=parseInt(H.unixPermissions,8)),H.unixPermissions&&16384&H.unixPermissions&&(H.dir=!0),H.dosPermissions&&16&H.dosPermissions&&(H.dir=!0),H.dir&&(A=v(A)),H.createFolders&&(I=y(A))&&x.call(this,I,!0);var K=z==="string"&&H.binary===!1&&H.base64===!1;M&&M.binary!==void 0||(H.binary=!K),(k instanceof h&&k.uncompressedSize===0||H.dir||!k||k.length===0)&&(H.base64=!1,H.binary=!0,k="",H.compression="STORE",z="string");var P=null;P=k instanceof h||k instanceof c?k:p.isNode&&p.isStream(k)?new g(A,k):a.prepareContent(A,k,H.binary,H.optimizedBinaryString,H.base64);var F=new d(A,P,H);this.files[A]=F}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),h=n("./compressedObject"),d=n("./zipObject"),m=n("./generate"),p=n("./nodejsUtils"),g=n("./nodejs/NodejsStreamInputAdapter"),y=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var k=A.lastIndexOf("/");return 0<k?A.substring(0,k):""},v=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},x=function(A,k){return k=k!==void 0?k:u.createFolders,A=v(A),this.files[A]||s.call(this,A,null,{dir:!0,createFolders:k}),this.files[A]};function E(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var k,M,I;for(k in this.files)I=this.files[k],(M=k.slice(this.root.length,k.length))&&k.slice(0,this.root.length)===this.root&&A(M,I)},filter:function(A){var k=[];return this.forEach(function(M,I){A(M,I)&&k.push(I)}),k},file:function(A,k,M){if(arguments.length!==1)return A=this.root+A,s.call(this,A,k,M),this;if(E(A)){var I=A;return this.filter(function(H,K){return!K.dir&&I.test(H)})}var z=this.files[this.root+A];return z&&!z.dir?z:null},folder:function(A){if(!A)return this;if(E(A))return this.filter(function(z,H){return H.dir&&A.test(z)});var k=this.root+A,M=x.call(this,k),I=this.clone();return I.root=M.name,I},remove:function(A){A=this.root+A;var k=this.files[A];if(k||(A.slice(-1)!=="/"&&(A+="/"),k=this.files[A]),k&&!k.dir)delete this.files[A];else for(var M=this.filter(function(z,H){return H.name.slice(0,A.length)===A}),I=0;I<M.length;I++)delete this.files[M[I].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var k,M={};try{if((M=a.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=M.type.toLowerCase(),M.compression=M.compression.toUpperCase(),M.type==="binarystring"&&(M.type="string"),!M.type)throw new Error("No output type specified.");a.checkSupport(M.type),M.platform!=="darwin"&&M.platform!=="freebsd"&&M.platform!=="linux"&&M.platform!=="sunos"||(M.platform="UNIX"),M.platform==="win32"&&(M.platform="DOS");var I=M.comment||this.comment||"";k=m.generateWorker(this,M,I)}catch(z){(k=new c("error")).error(z)}return new l(k,M.type||"string",M.mimeType)},generateAsync:function(A,k){return this.generateInternalStream(A).accumulate(k)},generateNodeStream:function(A,k){return(A=A||{}).type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(k)}};r.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),h=null;if(l.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,g){return new u.Promise(function(y,v){var x=[],E=p._internalType,C=p._outputType,A=p._mimeType;p.on("data",function(k,M){x.push(k),g&&g(M)}).on("error",function(k){x=[],v(k)}).on("end",function(){try{var k=(function(M,I,z){switch(M){case"blob":return s.newBlob(s.transformTo("arraybuffer",I),z);case"base64":return c.encode(I);default:return s.transformTo(M,I)}})(C,(function(M,I){var z,H=0,K=null,P=0;for(z=0;z<I.length;z++)P+=I[z].length;switch(M){case"string":return I.join("");case"array":return Array.prototype.concat.apply([],I);case"uint8array":for(K=new Uint8Array(P),z=0;z<I.length;z++)K.set(I[z],H),H+=I[z].length;return K;case"nodebuffer":return Lo.concat(I);default:throw new Error("concat : unsupported type '"+M+"'")}})(E,x),A);y(k)}catch(M){v(M)}x=[]}).resume()})}function m(p,g,y){var v=g;switch(g){case"blob":case"arraybuffer":v="uint8array";break;case"base64":v="string"}try{this._internalType=v,this._outputType=g,this._mimeType=y,s.checkSupport(v),this._worker=p.pipe(new o(v)),p.lock()}catch(x){this._worker=new a("error"),this._worker.error(x)}}m.prototype={accumulate:function(p){return d(this,p)},on:function(p,g){var y=this;return p==="data"?this._worker.on(p,function(v){g.call(y,v.data,v.meta)}):this._worker.on(p,function(){s.delay(g,arguments,y)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=m},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Lo<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(m){return o.nodebuffer?a.newBufferFrom(m,"utf-8"):(function(p){var g,y,v,x,E,C=p.length,A=0;for(x=0;x<C;x++)(64512&(y=p.charCodeAt(x)))==55296&&x+1<C&&(64512&(v=p.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(v-56320),x++),A+=y<128?1:y<2048?2:y<65536?3:4;for(g=o.uint8array?new Uint8Array(A):new Array(A),x=E=0;E<A;x++)(64512&(y=p.charCodeAt(x)))==55296&&x+1<C&&(64512&(v=p.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(v-56320),x++),y<128?g[E++]=y:(y<2048?g[E++]=192|y>>>6:(y<65536?g[E++]=224|y>>>12:(g[E++]=240|y>>>18,g[E++]=128|y>>>12&63),g[E++]=128|y>>>6&63),g[E++]=128|63&y);return g})(m)},i.utf8decode=function(m){return o.nodebuffer?s.transformTo("nodebuffer",m).toString("utf-8"):(function(p){var g,y,v,x,E=p.length,C=new Array(2*E);for(g=y=0;g<E;)if((v=p[g++])<128)C[y++]=v;else if(4<(x=l[v]))C[y++]=65533,g+=x-1;else{for(v&=x===2?31:x===3?15:7;1<x&&g<E;)v=v<<6|63&p[g++],x--;1<x?C[y++]=65533:v<65536?C[y++]=v:(v-=65536,C[y++]=55296|v>>10&1023,C[y++]=56320|1023&v)}return C.length!==y&&(C.subarray?C=C.subarray(0,y):C.length=y),s.applyFromCharCode(C)})(m=s.transformTo(o.uint8array?"uint8array":"array",m))},s.inherits(h,c),h.prototype.processChunk=function(m){var p=s.transformTo(o.uint8array?"uint8array":"array",m.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var g=p;(p=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),p.set(g,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var y=(function(x,E){var C;for((E=E||x.length)>x.length&&(E=x.length),C=E-1;0<=C&&(192&x[C])==128;)C--;return C<0||C===0?E:C+l[x[C]]>E?C:E})(p),v=p;y!==p.length&&(o.uint8array?(v=p.subarray(0,y),this.leftOver=p.subarray(y,p.length)):(v=p.slice(0,y),this.leftOver=p.slice(y,p.length))),this.push({data:i.utf8decode(v),meta:m.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(m){this.push({data:i.utf8encode(m.data),meta:m.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(g){return g}function u(g,y){for(var v=0;v<g.length;++v)y[v]=255&g.charCodeAt(v);return y}n("setimmediate"),i.newBlob=function(g,y){i.checkSupport("blob");try{return new Blob([g],{type:y})}catch{try{var v=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return v.append(g),v.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(g,y,v){var x=[],E=0,C=g.length;if(C<=v)return String.fromCharCode.apply(null,g);for(;E<C;)y==="array"||y==="nodebuffer"?x.push(String.fromCharCode.apply(null,g.slice(E,Math.min(E+v,C)))):x.push(String.fromCharCode.apply(null,g.subarray(E,Math.min(E+v,C)))),E+=v;return x.join("")},stringifyByChar:function(g){for(var y="",v=0;v<g.length;v++)y+=String.fromCharCode(g[v]);return y},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function d(g){var y=65536,v=i.getTypeOf(g),x=!0;if(v==="uint8array"?x=h.applyCanBeUsed.uint8array:v==="nodebuffer"&&(x=h.applyCanBeUsed.nodebuffer),x)for(;1<y;)try{return h.stringifyByChunk(g,v,y)}catch{y=Math.floor(y/2)}return h.stringifyByChar(g)}function m(g,y){for(var v=0;v<g.length;v++)y[v]=g[v];return y}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return p.string.uint8array(g).buffer},uint8array:function(g){return u(g,new Uint8Array(g.length))},nodebuffer:function(g){return u(g,a.allocBuffer(g.length))}},p.array={string:d,array:l,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(g)}},p.arraybuffer={string:function(g){return d(new Uint8Array(g))},array:function(g){return m(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:l,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(new Uint8Array(g))}},p.uint8array={string:d,array:function(g){return m(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:l,nodebuffer:function(g){return a.newBufferFrom(g)}},p.nodebuffer={string:d,array:function(g){return m(g,new Array(g.length))},arraybuffer:function(g){return p.nodebuffer.uint8array(g).buffer},uint8array:function(g){return m(g,new Uint8Array(g.length))},nodebuffer:l},i.transformTo=function(g,y){if(y=y||"",!g)return y;i.checkSupport(g);var v=i.getTypeOf(y);return p[v][g](y)},i.resolve=function(g){for(var y=g.split("/"),v=[],x=0;x<y.length;x++){var E=y[x];E==="."||E===""&&x!==0&&x!==y.length-1||(E===".."?v.pop():v.push(E))}return v.join("/")},i.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(g)?"nodebuffer":s.uint8array&&g instanceof Uint8Array?"uint8array":s.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(g){if(!s[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(g){var y,v,x="";for(v=0;v<(g||"").length;v++)x+="\\x"+((y=g.charCodeAt(v))<16?"0":"")+y.toString(16).toUpperCase();return x},i.delay=function(g,y,v){setImmediate(function(){g.apply(v||null,y||[])})},i.inherits=function(g,y){function v(){}v.prototype=y.prototype,g.prototype=new v},i.extend=function(){var g,y,v={};for(g=0;g<arguments.length;g++)for(y in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],y)&&v[y]===void 0&&(v[y]=arguments[g][y]);return v},i.prepareContent=function(g,y,v,x,E){return c.Promise.resolve(y).then(function(C){return s.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new c.Promise(function(A,k){var M=new FileReader;M.onload=function(I){A(I.target.result)},M.onerror=function(I){k(I.target.error)},M.readAsArrayBuffer(C)}):C}).then(function(C){var A=i.getTypeOf(C);return A?(A==="arraybuffer"?C=i.transformTo("uint8array",C):A==="string"&&(E?C=o.decode(C):v&&x!==!0&&(C=(function(k){return u(k,s.uint8array?new Uint8Array(k.length):new Array(k.length))})(C))),C):c.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var m=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===d;return this.reader.setIndex(m),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",m=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(m)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,m,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),d=this.reader.readInt(4),m=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:m}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var m=this.centralDirOffset+this.centralDirSize;this.zip64&&(m+=20,m+=12+this.zip64EndOfCentralSize);var p=d-m;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),h=n("./support");function d(m,p){this.options=m,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(m){var p,g;if(m.skip(22),this.fileNameLength=m.readInt(2),g=m.readInt(2),this.fileName=m.readData(this.fileNameLength),m.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=(function(y){for(var v in u)if(Object.prototype.hasOwnProperty.call(u,v)&&u[v].magic===y)return u[v];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,m.readData(this.compressedSize))},readCentralPart:function(m){this.versionMadeBy=m.readInt(2),m.skip(2),this.bitFlag=m.readInt(2),this.compressionMethod=m.readString(2),this.date=m.readDate(),this.crc32=m.readInt(4),this.compressedSize=m.readInt(4),this.uncompressedSize=m.readInt(4);var p=m.readInt(2);if(this.extraFieldsLength=m.readInt(2),this.fileCommentLength=m.readInt(2),this.diskNumberStart=m.readInt(2),this.internalFileAttributes=m.readInt(2),this.externalFileAttributes=m.readInt(4),this.localHeaderOffset=m.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");m.skip(p),this.readExtraFields(m),this.parseZIP64ExtraField(m),this.fileComment=m.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var m=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),m==0&&(this.dosPermissions=63&this.externalFileAttributes),m==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var m=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=m.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=m.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=m.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=m.readInt(4))}},readExtraFields:function(m){var p,g,y,v=m.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});m.index+4<v;)p=m.readInt(2),g=m.readInt(2),y=m.readData(g),this.extraFields[p]={id:p,length:g,value:y};m.setIndex(v)},handleUTF8:function(){var m=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var g=o.transformTo(m,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var v=o.transformTo(m,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var m=this.extraFields[28789];if(m){var p=s(m.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(m.length-5))}return null},findExtraFieldUnicodeComment:function(){var m=this.extraFields[25461];if(m){var p=s(m.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(m.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,g,y){this.name=p,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=g,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var g=null,y="string";try{if(!p)throw new Error("No output type specified.");var v=(y=p.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),g=this._decompressWorker();var x=!this._dataBinary;x&&!v&&(g=g.pipe(new c.Utf8EncodeWorker)),!x&&v&&(g=g.pipe(new c.Utf8DecodeWorker))}catch(E){(g=new u("error")).error(E)}return new o(g,y,"")},async:function(p,g){return this.internalStream(p).accumulate(g)},nodeStream:function(p,g){return this.internalStream(p||"nodebuffer").toNodejsStream(g)},_compressWorker:function(p,g){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(y,p,g)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},m=0;m<h.length;m++)s.prototype[h[m]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var g=s.document.createElement("script");g.onreadystatechange=function(){p(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},s.document.documentElement.appendChild(g)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var m=[];function p(){var g,y;a=!0;for(var v=m.length;v;){for(y=m,m=[],g=-1;++g<v;)y[g]();v=m.length}a=!1}r.exports=function(g){m.push(g)!==1||a||o()}}).call(this,typeof Zp<"u"?Zp:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,v!==o&&g(this,v)}function d(v,x,E){this.promise=v,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function m(v,x,E){s(function(){var C;try{C=x(E)}catch(A){return a.reject(v,A)}C===v?a.reject(v,new TypeError("Cannot resolve promise with itself")):a.resolve(v,C)})}function p(v){var x=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof x=="function")return function(){x.apply(v,arguments)}}function g(v,x){var E=!1;function C(M){E||(E=!0,a.reject(v,M))}function A(M){E||(E=!0,a.resolve(v,M))}var k=y(function(){x(A,C)});k.status==="error"&&C(k.value)}function y(v,x){var E={};try{E.value=v(x),E.status="success"}catch(C){E.status="error",E.value=C}return E}(r.exports=h).prototype.finally=function(v){if(typeof v!="function")return this;var x=this.constructor;return this.then(function(E){return x.resolve(v()).then(function(){return E})},function(E){return x.resolve(v()).then(function(){throw E})})},h.prototype.catch=function(v){return this.then(null,v)},h.prototype.then=function(v,x){if(typeof v!="function"&&this.state===l||typeof x!="function"&&this.state===c)return this;var E=new this.constructor(o);return this.state!==u?m(E,this.state===l?v:x,this.outcome):this.queue.push(new d(E,v,x)),E},d.prototype.callFulfilled=function(v){a.resolve(this.promise,v)},d.prototype.otherCallFulfilled=function(v){m(this.promise,this.onFulfilled,v)},d.prototype.callRejected=function(v){a.reject(this.promise,v)},d.prototype.otherCallRejected=function(v){m(this.promise,this.onRejected,v)},a.resolve=function(v,x){var E=y(p,x);if(E.status==="error")return a.reject(v,E.value);var C=E.value;if(C)g(v,C);else{v.state=l,v.outcome=x;for(var A=-1,k=v.queue.length;++A<k;)v.queue[A].callFulfilled(x)}return v},a.reject=function(v,x){v.state=c,v.outcome=x;for(var E=-1,C=v.queue.length;++E<C;)v.queue[E].callRejected(x);return v},h.resolve=function(v){return v instanceof this?v:a.resolve(new this(o),v)},h.reject=function(v){var x=new this(o);return a.reject(x,v)},h.all=function(v){var x=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=v.length,C=!1;if(!E)return this.resolve([]);for(var A=new Array(E),k=0,M=-1,I=new this(o);++M<E;)z(v[M],M);return I;function z(H,K){x.resolve(H).then(function(P){A[K]=P,++k!==E||C||(C=!0,a.resolve(I,A))},function(P){C||(C=!0,a.reject(I,P))})}},h.race=function(v){var x=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=v.length,C=!1;if(!E)return this.resolve([]);for(var A=-1,k=new this(o);++A<E;)M=v[A],x.resolve(M).then(function(I){C||(C=!0,a.resolve(k,I))},function(I){C||(C=!0,a.reject(k,I))});var M;return k}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,h=0,d=-1,m=0,p=8;function g(v){if(!(this instanceof g))return new g(v);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:m,to:""},v||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var E=s.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(E!==h)throw new Error(c[E]);if(x.header&&s.deflateSetHeader(this.strm,x.header),x.dictionary){var C;if(C=typeof x.dictionary=="string"?a.string2buf(x.dictionary):u.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(E=s.deflateSetDictionary(this.strm,C))!==h)throw new Error(c[E]);this._dict_set=!0}}function y(v,x){var E=new g(x);if(E.push(v,!0),E.err)throw E.msg||c[E.err];return E.result}g.prototype.push=function(v,x){var E,C,A=this.strm,k=this.options.chunkSize;if(this.ended)return!1;C=x===~~x?x:x===!0?4:0,typeof v=="string"?A.input=a.string2buf(v):u.call(v)==="[object ArrayBuffer]"?A.input=new Uint8Array(v):A.input=v,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new o.Buf8(k),A.next_out=0,A.avail_out=k),(E=s.deflate(A,C))!==1&&E!==h)return this.onEnd(E),!(this.ended=!0);A.avail_out!==0&&(A.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(A.output,A.next_out))):this.onData(o.shrinkBuf(A.output,A.next_out)))}while((0<A.avail_in||A.avail_out===0)&&E!==1);return C===4?(E=s.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===h):C!==2||(this.onEnd(h),!(A.avail_out=0))},g.prototype.onData=function(v){this.chunks.push(v)},g.prototype.onEnd=function(v){v===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},i.Deflate=g,i.deflate=y,i.deflateRaw=function(v,x){return(x=x||{}).raw=!0,y(v,x)},i.gzip=function(v,x){return(x=x||{}).gzip=!0,y(v,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),h=n("./zlib/gzheader"),d=Object.prototype.toString;function m(g){if(!(this instanceof m))return new m(g);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},g||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||g&&g.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&(15&y.windowBits)==0&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var v=s.inflateInit2(this.strm,y.windowBits);if(v!==c.Z_OK)throw new Error(l[v]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(g,y){var v=new m(y);if(v.push(g,!0),v.err)throw v.msg||l[v.err];return v.result}m.prototype.push=function(g,y){var v,x,E,C,A,k,M=this.strm,I=this.options.chunkSize,z=this.options.dictionary,H=!1;if(this.ended)return!1;x=y===~~y?y:y===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof g=="string"?M.input=a.binstring2buf(g):d.call(g)==="[object ArrayBuffer]"?M.input=new Uint8Array(g):M.input=g,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new o.Buf8(I),M.next_out=0,M.avail_out=I),(v=s.inflate(M,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&z&&(k=typeof z=="string"?a.string2buf(z):d.call(z)==="[object ArrayBuffer]"?new Uint8Array(z):z,v=s.inflateSetDictionary(this.strm,k)),v===c.Z_BUF_ERROR&&H===!0&&(v=c.Z_OK,H=!1),v!==c.Z_STREAM_END&&v!==c.Z_OK)return this.onEnd(v),!(this.ended=!0);M.next_out&&(M.avail_out!==0&&v!==c.Z_STREAM_END&&(M.avail_in!==0||x!==c.Z_FINISH&&x!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=a.utf8border(M.output,M.next_out),C=M.next_out-E,A=a.buf2string(M.output,E),M.next_out=C,M.avail_out=I-C,C&&o.arraySet(M.output,M.output,E,C,0),this.onData(A)):this.onData(o.shrinkBuf(M.output,M.next_out)))),M.avail_in===0&&M.avail_out===0&&(H=!0)}while((0<M.avail_in||M.avail_out===0)&&v!==c.Z_STREAM_END);return v===c.Z_STREAM_END&&(x=c.Z_FINISH),x===c.Z_FINISH?(v=s.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===c.Z_OK):x!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(M.avail_out=0))},m.prototype.onData=function(g){this.chunks.push(g)},m.prototype.onEnd=function(g){g===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Inflate=m,i.inflate=p,i.inflateRaw=function(g,y){return(y=y||{}).raw=!0,p(g,y)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),d);else for(var m=0;m<h;m++)c[d+m]=l[u+m]},flattenChunks:function(c){var l,u,h,d,m,p;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(p=new Uint8Array(h),l=d=0,u=c.length;l<u;l++)m=c[l],p.set(m,d),d+=m.length;return p}},a={arraySet:function(c,l,u,h,d){for(var m=0;m<h;m++)c[d+m]=l[u+m]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var m="",p=0;p<d;p++)m+=String.fromCharCode(h[p]);return m}c[254]=c[254]=1,i.string2buf=function(h){var d,m,p,g,y,v=h.length,x=0;for(g=0;g<v;g++)(64512&(m=h.charCodeAt(g)))==55296&&g+1<v&&(64512&(p=h.charCodeAt(g+1)))==56320&&(m=65536+(m-55296<<10)+(p-56320),g++),x+=m<128?1:m<2048?2:m<65536?3:4;for(d=new s.Buf8(x),g=y=0;y<x;g++)(64512&(m=h.charCodeAt(g)))==55296&&g+1<v&&(64512&(p=h.charCodeAt(g+1)))==56320&&(m=65536+(m-55296<<10)+(p-56320),g++),m<128?d[y++]=m:(m<2048?d[y++]=192|m>>>6:(m<65536?d[y++]=224|m>>>12:(d[y++]=240|m>>>18,d[y++]=128|m>>>12&63),d[y++]=128|m>>>6&63),d[y++]=128|63&m);return d},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),m=0,p=d.length;m<p;m++)d[m]=h.charCodeAt(m);return d},i.buf2string=function(h,d){var m,p,g,y,v=d||h.length,x=new Array(2*v);for(m=p=0;m<v;)if((g=h[m++])<128)x[p++]=g;else if(4<(y=c[g]))x[p++]=65533,m+=y-1;else{for(g&=y===2?31:y===3?15:7;1<y&&m<v;)g=g<<6|63&h[m++],y--;1<y?x[p++]=65533:g<65536?x[p++]=g:(g-=65536,x[p++]=55296|g>>10&1023,x[p++]=56320|1023&g)}return u(x,p)},i.utf8border=function(h,d){var m;for((d=d||h.length)>h.length&&(d=h.length),m=d-1;0<=m&&(192&h[m])==128;)m--;return m<0||m===0?d:m+c[h[m]]>d?m:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=(function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a})();r.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var d=l;d<h;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),h=0,d=4,m=0,p=-2,g=-1,y=4,v=2,x=8,E=9,C=286,A=30,k=19,M=2*C+1,I=15,z=3,H=258,K=H+z+1,P=42,F=113,N=1,X=2,G=3,j=4;function q(re,Le){return re.msg=u[Le],Le}function te(re){return(re<<1)-(4<re?9:0)}function W(re){for(var Le=re.length;0<=--Le;)re[Le]=0}function $(re){var Le=re.state,He=Le.pending;He>re.avail_out&&(He=re.avail_out),He!==0&&(o.arraySet(re.output,Le.pending_buf,Le.pending_out,He,re.next_out),re.next_out+=He,Le.pending_out+=He,re.total_out+=He,re.avail_out-=He,Le.pending-=He,Le.pending===0&&(Le.pending_out=0))}function J(re,Le){a._tr_flush_block(re,0<=re.block_start?re.block_start:-1,re.strstart-re.block_start,Le),re.block_start=re.strstart,$(re.strm)}function ne(re,Le){re.pending_buf[re.pending++]=Le}function ie(re,Le){re.pending_buf[re.pending++]=Le>>>8&255,re.pending_buf[re.pending++]=255&Le}function ae(re,Le){var He,Ue,De=re.max_chain_length,fe=re.strstart,ve=re.prev_length,Ae=re.nice_match,pe=re.strstart>re.w_size-K?re.strstart-(re.w_size-K):0,Ge=re.window,Qe=re.w_mask,Ze=re.prev,tt=re.strstart+H,Ft=Ge[fe+ve-1],bt=Ge[fe+ve];re.prev_length>=re.good_match&&(De>>=2),Ae>re.lookahead&&(Ae=re.lookahead);do if(Ge[(He=Le)+ve]===bt&&Ge[He+ve-1]===Ft&&Ge[He]===Ge[fe]&&Ge[++He]===Ge[fe+1]){fe+=2,He++;do;while(Ge[++fe]===Ge[++He]&&Ge[++fe]===Ge[++He]&&Ge[++fe]===Ge[++He]&&Ge[++fe]===Ge[++He]&&Ge[++fe]===Ge[++He]&&Ge[++fe]===Ge[++He]&&Ge[++fe]===Ge[++He]&&Ge[++fe]===Ge[++He]&&fe<tt);if(Ue=H-(tt-fe),fe=tt-H,ve<Ue){if(re.match_start=Le,Ae<=(ve=Ue))break;Ft=Ge[fe+ve-1],bt=Ge[fe+ve]}}while((Le=Ze[Le&Qe])>pe&&--De!=0);return ve<=re.lookahead?ve:re.lookahead}function xe(re){var Le,He,Ue,De,fe,ve,Ae,pe,Ge,Qe,Ze=re.w_size;do{if(De=re.window_size-re.lookahead-re.strstart,re.strstart>=Ze+(Ze-K)){for(o.arraySet(re.window,re.window,Ze,Ze,0),re.match_start-=Ze,re.strstart-=Ze,re.block_start-=Ze,Le=He=re.hash_size;Ue=re.head[--Le],re.head[Le]=Ze<=Ue?Ue-Ze:0,--He;);for(Le=He=Ze;Ue=re.prev[--Le],re.prev[Le]=Ze<=Ue?Ue-Ze:0,--He;);De+=Ze}if(re.strm.avail_in===0)break;if(ve=re.strm,Ae=re.window,pe=re.strstart+re.lookahead,Ge=De,Qe=void 0,Qe=ve.avail_in,Ge<Qe&&(Qe=Ge),He=Qe===0?0:(ve.avail_in-=Qe,o.arraySet(Ae,ve.input,ve.next_in,Qe,pe),ve.state.wrap===1?ve.adler=c(ve.adler,Ae,Qe,pe):ve.state.wrap===2&&(ve.adler=l(ve.adler,Ae,Qe,pe)),ve.next_in+=Qe,ve.total_in+=Qe,Qe),re.lookahead+=He,re.lookahead+re.insert>=z)for(fe=re.strstart-re.insert,re.ins_h=re.window[fe],re.ins_h=(re.ins_h<<re.hash_shift^re.window[fe+1])&re.hash_mask;re.insert&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[fe+z-1])&re.hash_mask,re.prev[fe&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=fe,fe++,re.insert--,!(re.lookahead+re.insert<z)););}while(re.lookahead<K&&re.strm.avail_in!==0)}function Ne(re,Le){for(var He,Ue;;){if(re.lookahead<K){if(xe(re),re.lookahead<K&&Le===h)return N;if(re.lookahead===0)break}if(He=0,re.lookahead>=z&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+z-1])&re.hash_mask,He=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart),He!==0&&re.strstart-He<=re.w_size-K&&(re.match_length=ae(re,He)),re.match_length>=z)if(Ue=a._tr_tally(re,re.strstart-re.match_start,re.match_length-z),re.lookahead-=re.match_length,re.match_length<=re.max_lazy_match&&re.lookahead>=z){for(re.match_length--;re.strstart++,re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+z-1])&re.hash_mask,He=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart,--re.match_length!=0;);re.strstart++}else re.strstart+=re.match_length,re.match_length=0,re.ins_h=re.window[re.strstart],re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+1])&re.hash_mask;else Ue=a._tr_tally(re,0,re.window[re.strstart]),re.lookahead--,re.strstart++;if(Ue&&(J(re,!1),re.strm.avail_out===0))return N}return re.insert=re.strstart<z-1?re.strstart:z-1,Le===d?(J(re,!0),re.strm.avail_out===0?G:j):re.last_lit&&(J(re,!1),re.strm.avail_out===0)?N:X}function Re(re,Le){for(var He,Ue,De;;){if(re.lookahead<K){if(xe(re),re.lookahead<K&&Le===h)return N;if(re.lookahead===0)break}if(He=0,re.lookahead>=z&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+z-1])&re.hash_mask,He=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart),re.prev_length=re.match_length,re.prev_match=re.match_start,re.match_length=z-1,He!==0&&re.prev_length<re.max_lazy_match&&re.strstart-He<=re.w_size-K&&(re.match_length=ae(re,He),re.match_length<=5&&(re.strategy===1||re.match_length===z&&4096<re.strstart-re.match_start)&&(re.match_length=z-1)),re.prev_length>=z&&re.match_length<=re.prev_length){for(De=re.strstart+re.lookahead-z,Ue=a._tr_tally(re,re.strstart-1-re.prev_match,re.prev_length-z),re.lookahead-=re.prev_length-1,re.prev_length-=2;++re.strstart<=De&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+z-1])&re.hash_mask,He=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart),--re.prev_length!=0;);if(re.match_available=0,re.match_length=z-1,re.strstart++,Ue&&(J(re,!1),re.strm.avail_out===0))return N}else if(re.match_available){if((Ue=a._tr_tally(re,0,re.window[re.strstart-1]))&&J(re,!1),re.strstart++,re.lookahead--,re.strm.avail_out===0)return N}else re.match_available=1,re.strstart++,re.lookahead--}return re.match_available&&(Ue=a._tr_tally(re,0,re.window[re.strstart-1]),re.match_available=0),re.insert=re.strstart<z-1?re.strstart:z-1,Le===d?(J(re,!0),re.strm.avail_out===0?G:j):re.last_lit&&(J(re,!1),re.strm.avail_out===0)?N:X}function Se(re,Le,He,Ue,De){this.good_length=re,this.max_lazy=Le,this.nice_length=He,this.max_chain=Ue,this.func=De}function ze(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*M),this.dyn_dtree=new o.Buf16(2*(2*A+1)),this.bl_tree=new o.Buf16(2*(2*k+1)),W(this.dyn_ltree),W(this.dyn_dtree),W(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(I+1),this.heap=new o.Buf16(2*C+1),W(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*C+1),W(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Be(re){var Le;return re&&re.state?(re.total_in=re.total_out=0,re.data_type=v,(Le=re.state).pending=0,Le.pending_out=0,Le.wrap<0&&(Le.wrap=-Le.wrap),Le.status=Le.wrap?P:F,re.adler=Le.wrap===2?0:1,Le.last_flush=h,a._tr_init(Le),m):q(re,p)}function Je(re){var Le=Be(re);return Le===m&&(function(He){He.window_size=2*He.w_size,W(He.head),He.max_lazy_match=s[He.level].max_lazy,He.good_match=s[He.level].good_length,He.nice_match=s[He.level].nice_length,He.max_chain_length=s[He.level].max_chain,He.strstart=0,He.block_start=0,He.lookahead=0,He.insert=0,He.match_length=He.prev_length=z-1,He.match_available=0,He.ins_h=0})(re.state),Le}function at(re,Le,He,Ue,De,fe){if(!re)return p;var ve=1;if(Le===g&&(Le=6),Ue<0?(ve=0,Ue=-Ue):15<Ue&&(ve=2,Ue-=16),De<1||E<De||He!==x||Ue<8||15<Ue||Le<0||9<Le||fe<0||y<fe)return q(re,p);Ue===8&&(Ue=9);var Ae=new ze;return(re.state=Ae).strm=re,Ae.wrap=ve,Ae.gzhead=null,Ae.w_bits=Ue,Ae.w_size=1<<Ae.w_bits,Ae.w_mask=Ae.w_size-1,Ae.hash_bits=De+7,Ae.hash_size=1<<Ae.hash_bits,Ae.hash_mask=Ae.hash_size-1,Ae.hash_shift=~~((Ae.hash_bits+z-1)/z),Ae.window=new o.Buf8(2*Ae.w_size),Ae.head=new o.Buf16(Ae.hash_size),Ae.prev=new o.Buf16(Ae.w_size),Ae.lit_bufsize=1<<De+6,Ae.pending_buf_size=4*Ae.lit_bufsize,Ae.pending_buf=new o.Buf8(Ae.pending_buf_size),Ae.d_buf=1*Ae.lit_bufsize,Ae.l_buf=3*Ae.lit_bufsize,Ae.level=Le,Ae.strategy=fe,Ae.method=He,Je(re)}s=[new Se(0,0,0,0,function(re,Le){var He=65535;for(He>re.pending_buf_size-5&&(He=re.pending_buf_size-5);;){if(re.lookahead<=1){if(xe(re),re.lookahead===0&&Le===h)return N;if(re.lookahead===0)break}re.strstart+=re.lookahead,re.lookahead=0;var Ue=re.block_start+He;if((re.strstart===0||re.strstart>=Ue)&&(re.lookahead=re.strstart-Ue,re.strstart=Ue,J(re,!1),re.strm.avail_out===0)||re.strstart-re.block_start>=re.w_size-K&&(J(re,!1),re.strm.avail_out===0))return N}return re.insert=0,Le===d?(J(re,!0),re.strm.avail_out===0?G:j):(re.strstart>re.block_start&&(J(re,!1),re.strm.avail_out),N)}),new Se(4,4,8,4,Ne),new Se(4,5,16,8,Ne),new Se(4,6,32,32,Ne),new Se(4,4,16,16,Re),new Se(8,16,32,32,Re),new Se(8,16,128,128,Re),new Se(8,32,128,256,Re),new Se(32,128,258,1024,Re),new Se(32,258,258,4096,Re)],i.deflateInit=function(re,Le){return at(re,Le,x,15,8,0)},i.deflateInit2=at,i.deflateReset=Je,i.deflateResetKeep=Be,i.deflateSetHeader=function(re,Le){return re&&re.state?re.state.wrap!==2?p:(re.state.gzhead=Le,m):p},i.deflate=function(re,Le){var He,Ue,De,fe;if(!re||!re.state||5<Le||Le<0)return re?q(re,p):p;if(Ue=re.state,!re.output||!re.input&&re.avail_in!==0||Ue.status===666&&Le!==d)return q(re,re.avail_out===0?-5:p);if(Ue.strm=re,He=Ue.last_flush,Ue.last_flush=Le,Ue.status===P)if(Ue.wrap===2)re.adler=0,ne(Ue,31),ne(Ue,139),ne(Ue,8),Ue.gzhead?(ne(Ue,(Ue.gzhead.text?1:0)+(Ue.gzhead.hcrc?2:0)+(Ue.gzhead.extra?4:0)+(Ue.gzhead.name?8:0)+(Ue.gzhead.comment?16:0)),ne(Ue,255&Ue.gzhead.time),ne(Ue,Ue.gzhead.time>>8&255),ne(Ue,Ue.gzhead.time>>16&255),ne(Ue,Ue.gzhead.time>>24&255),ne(Ue,Ue.level===9?2:2<=Ue.strategy||Ue.level<2?4:0),ne(Ue,255&Ue.gzhead.os),Ue.gzhead.extra&&Ue.gzhead.extra.length&&(ne(Ue,255&Ue.gzhead.extra.length),ne(Ue,Ue.gzhead.extra.length>>8&255)),Ue.gzhead.hcrc&&(re.adler=l(re.adler,Ue.pending_buf,Ue.pending,0)),Ue.gzindex=0,Ue.status=69):(ne(Ue,0),ne(Ue,0),ne(Ue,0),ne(Ue,0),ne(Ue,0),ne(Ue,Ue.level===9?2:2<=Ue.strategy||Ue.level<2?4:0),ne(Ue,3),Ue.status=F);else{var ve=x+(Ue.w_bits-8<<4)<<8;ve|=(2<=Ue.strategy||Ue.level<2?0:Ue.level<6?1:Ue.level===6?2:3)<<6,Ue.strstart!==0&&(ve|=32),ve+=31-ve%31,Ue.status=F,ie(Ue,ve),Ue.strstart!==0&&(ie(Ue,re.adler>>>16),ie(Ue,65535&re.adler)),re.adler=1}if(Ue.status===69)if(Ue.gzhead.extra){for(De=Ue.pending;Ue.gzindex<(65535&Ue.gzhead.extra.length)&&(Ue.pending!==Ue.pending_buf_size||(Ue.gzhead.hcrc&&Ue.pending>De&&(re.adler=l(re.adler,Ue.pending_buf,Ue.pending-De,De)),$(re),De=Ue.pending,Ue.pending!==Ue.pending_buf_size));)ne(Ue,255&Ue.gzhead.extra[Ue.gzindex]),Ue.gzindex++;Ue.gzhead.hcrc&&Ue.pending>De&&(re.adler=l(re.adler,Ue.pending_buf,Ue.pending-De,De)),Ue.gzindex===Ue.gzhead.extra.length&&(Ue.gzindex=0,Ue.status=73)}else Ue.status=73;if(Ue.status===73)if(Ue.gzhead.name){De=Ue.pending;do{if(Ue.pending===Ue.pending_buf_size&&(Ue.gzhead.hcrc&&Ue.pending>De&&(re.adler=l(re.adler,Ue.pending_buf,Ue.pending-De,De)),$(re),De=Ue.pending,Ue.pending===Ue.pending_buf_size)){fe=1;break}fe=Ue.gzindex<Ue.gzhead.name.length?255&Ue.gzhead.name.charCodeAt(Ue.gzindex++):0,ne(Ue,fe)}while(fe!==0);Ue.gzhead.hcrc&&Ue.pending>De&&(re.adler=l(re.adler,Ue.pending_buf,Ue.pending-De,De)),fe===0&&(Ue.gzindex=0,Ue.status=91)}else Ue.status=91;if(Ue.status===91)if(Ue.gzhead.comment){De=Ue.pending;do{if(Ue.pending===Ue.pending_buf_size&&(Ue.gzhead.hcrc&&Ue.pending>De&&(re.adler=l(re.adler,Ue.pending_buf,Ue.pending-De,De)),$(re),De=Ue.pending,Ue.pending===Ue.pending_buf_size)){fe=1;break}fe=Ue.gzindex<Ue.gzhead.comment.length?255&Ue.gzhead.comment.charCodeAt(Ue.gzindex++):0,ne(Ue,fe)}while(fe!==0);Ue.gzhead.hcrc&&Ue.pending>De&&(re.adler=l(re.adler,Ue.pending_buf,Ue.pending-De,De)),fe===0&&(Ue.status=103)}else Ue.status=103;if(Ue.status===103&&(Ue.gzhead.hcrc?(Ue.pending+2>Ue.pending_buf_size&&$(re),Ue.pending+2<=Ue.pending_buf_size&&(ne(Ue,255&re.adler),ne(Ue,re.adler>>8&255),re.adler=0,Ue.status=F)):Ue.status=F),Ue.pending!==0){if($(re),re.avail_out===0)return Ue.last_flush=-1,m}else if(re.avail_in===0&&te(Le)<=te(He)&&Le!==d)return q(re,-5);if(Ue.status===666&&re.avail_in!==0)return q(re,-5);if(re.avail_in!==0||Ue.lookahead!==0||Le!==h&&Ue.status!==666){var Ae=Ue.strategy===2?(function(pe,Ge){for(var Qe;;){if(pe.lookahead===0&&(xe(pe),pe.lookahead===0)){if(Ge===h)return N;break}if(pe.match_length=0,Qe=a._tr_tally(pe,0,pe.window[pe.strstart]),pe.lookahead--,pe.strstart++,Qe&&(J(pe,!1),pe.strm.avail_out===0))return N}return pe.insert=0,Ge===d?(J(pe,!0),pe.strm.avail_out===0?G:j):pe.last_lit&&(J(pe,!1),pe.strm.avail_out===0)?N:X})(Ue,Le):Ue.strategy===3?(function(pe,Ge){for(var Qe,Ze,tt,Ft,bt=pe.window;;){if(pe.lookahead<=H){if(xe(pe),pe.lookahead<=H&&Ge===h)return N;if(pe.lookahead===0)break}if(pe.match_length=0,pe.lookahead>=z&&0<pe.strstart&&(Ze=bt[tt=pe.strstart-1])===bt[++tt]&&Ze===bt[++tt]&&Ze===bt[++tt]){Ft=pe.strstart+H;do;while(Ze===bt[++tt]&&Ze===bt[++tt]&&Ze===bt[++tt]&&Ze===bt[++tt]&&Ze===bt[++tt]&&Ze===bt[++tt]&&Ze===bt[++tt]&&Ze===bt[++tt]&&tt<Ft);pe.match_length=H-(Ft-tt),pe.match_length>pe.lookahead&&(pe.match_length=pe.lookahead)}if(pe.match_length>=z?(Qe=a._tr_tally(pe,1,pe.match_length-z),pe.lookahead-=pe.match_length,pe.strstart+=pe.match_length,pe.match_length=0):(Qe=a._tr_tally(pe,0,pe.window[pe.strstart]),pe.lookahead--,pe.strstart++),Qe&&(J(pe,!1),pe.strm.avail_out===0))return N}return pe.insert=0,Ge===d?(J(pe,!0),pe.strm.avail_out===0?G:j):pe.last_lit&&(J(pe,!1),pe.strm.avail_out===0)?N:X})(Ue,Le):s[Ue.level].func(Ue,Le);if(Ae!==G&&Ae!==j||(Ue.status=666),Ae===N||Ae===G)return re.avail_out===0&&(Ue.last_flush=-1),m;if(Ae===X&&(Le===1?a._tr_align(Ue):Le!==5&&(a._tr_stored_block(Ue,0,0,!1),Le===3&&(W(Ue.head),Ue.lookahead===0&&(Ue.strstart=0,Ue.block_start=0,Ue.insert=0))),$(re),re.avail_out===0))return Ue.last_flush=-1,m}return Le!==d?m:Ue.wrap<=0?1:(Ue.wrap===2?(ne(Ue,255&re.adler),ne(Ue,re.adler>>8&255),ne(Ue,re.adler>>16&255),ne(Ue,re.adler>>24&255),ne(Ue,255&re.total_in),ne(Ue,re.total_in>>8&255),ne(Ue,re.total_in>>16&255),ne(Ue,re.total_in>>24&255)):(ie(Ue,re.adler>>>16),ie(Ue,65535&re.adler)),$(re),0<Ue.wrap&&(Ue.wrap=-Ue.wrap),Ue.pending!==0?m:1)},i.deflateEnd=function(re){var Le;return re&&re.state?(Le=re.state.status)!==P&&Le!==69&&Le!==73&&Le!==91&&Le!==103&&Le!==F&&Le!==666?q(re,p):(re.state=null,Le===F?q(re,-3):m):p},i.deflateSetDictionary=function(re,Le){var He,Ue,De,fe,ve,Ae,pe,Ge,Qe=Le.length;if(!re||!re.state||(fe=(He=re.state).wrap)===2||fe===1&&He.status!==P||He.lookahead)return p;for(fe===1&&(re.adler=c(re.adler,Le,Qe,0)),He.wrap=0,Qe>=He.w_size&&(fe===0&&(W(He.head),He.strstart=0,He.block_start=0,He.insert=0),Ge=new o.Buf8(He.w_size),o.arraySet(Ge,Le,Qe-He.w_size,He.w_size,0),Le=Ge,Qe=He.w_size),ve=re.avail_in,Ae=re.next_in,pe=re.input,re.avail_in=Qe,re.next_in=0,re.input=Le,xe(He);He.lookahead>=z;){for(Ue=He.strstart,De=He.lookahead-(z-1);He.ins_h=(He.ins_h<<He.hash_shift^He.window[Ue+z-1])&He.hash_mask,He.prev[Ue&He.w_mask]=He.head[He.ins_h],He.head[He.ins_h]=Ue,Ue++,--De;);He.strstart=Ue,He.lookahead=z-1,xe(He)}return He.strstart+=He.lookahead,He.block_start=He.strstart,He.insert=He.lookahead,He.lookahead=0,He.match_length=He.prev_length=z-1,He.match_available=0,re.next_in=Ae,re.input=pe,re.avail_in=ve,He.wrap=fe,m},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,h,d,m,p,g,y,v,x,E,C,A,k,M,I,z,H,K,P,F,N,X;a=s.state,c=s.next_in,N=s.input,l=c+(s.avail_in-5),u=s.next_out,X=s.output,h=u-(o-s.avail_out),d=u+(s.avail_out-257),m=a.dmax,p=a.wsize,g=a.whave,y=a.wnext,v=a.window,x=a.hold,E=a.bits,C=a.lencode,A=a.distcode,k=(1<<a.lenbits)-1,M=(1<<a.distbits)-1;e:do{E<15&&(x+=N[c++]<<E,E+=8,x+=N[c++]<<E,E+=8),I=C[x&k];t:for(;;){if(x>>>=z=I>>>24,E-=z,(z=I>>>16&255)===0)X[u++]=65535&I;else{if(!(16&z)){if((64&z)==0){I=C[(65535&I)+(x&(1<<z)-1)];continue t}if(32&z){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}H=65535&I,(z&=15)&&(E<z&&(x+=N[c++]<<E,E+=8),H+=x&(1<<z)-1,x>>>=z,E-=z),E<15&&(x+=N[c++]<<E,E+=8,x+=N[c++]<<E,E+=8),I=A[x&M];n:for(;;){if(x>>>=z=I>>>24,E-=z,!(16&(z=I>>>16&255))){if((64&z)==0){I=A[(65535&I)+(x&(1<<z)-1)];continue n}s.msg="invalid distance code",a.mode=30;break e}if(K=65535&I,E<(z&=15)&&(x+=N[c++]<<E,(E+=8)<z&&(x+=N[c++]<<E,E+=8)),m<(K+=x&(1<<z)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(x>>>=z,E-=z,(z=u-h)<K){if(g<(z=K-z)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(F=v,(P=0)===y){if(P+=p-z,z<H){for(H-=z;X[u++]=v[P++],--z;);P=u-K,F=X}}else if(y<z){if(P+=p+y-z,(z-=y)<H){for(H-=z;X[u++]=v[P++],--z;);if(P=0,y<H){for(H-=z=y;X[u++]=v[P++],--z;);P=u-K,F=X}}}else if(P+=y-z,z<H){for(H-=z;X[u++]=v[P++],--z;);P=u-K,F=X}for(;2<H;)X[u++]=F[P++],X[u++]=F[P++],X[u++]=F[P++],H-=3;H&&(X[u++]=F[P++],1<H&&(X[u++]=F[P++]))}else{for(P=u-K;X[u++]=X[P++],X[u++]=X[P++],X[u++]=X[P++],2<(H-=3););H&&(X[u++]=X[P++],1<H&&(X[u++]=X[P++]))}break}}break}}while(c<l&&u<d);c-=H=E>>3,x&=(1<<(E-=H<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=x,a.bits=E}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,h=2,d=0,m=-2,p=1,g=852,y=592;function v(P){return(P>>>24&255)+(P>>>8&65280)+((65280&P)<<8)+((255&P)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(P){var F;return P&&P.state?(F=P.state,P.total_in=P.total_out=F.total=0,P.msg="",F.wrap&&(P.adler=1&F.wrap),F.mode=p,F.last=0,F.havedict=0,F.dmax=32768,F.head=null,F.hold=0,F.bits=0,F.lencode=F.lendyn=new s.Buf32(g),F.distcode=F.distdyn=new s.Buf32(y),F.sane=1,F.back=-1,d):m}function C(P){var F;return P&&P.state?((F=P.state).wsize=0,F.whave=0,F.wnext=0,E(P)):m}function A(P,F){var N,X;return P&&P.state?(X=P.state,F<0?(N=0,F=-F):(N=1+(F>>4),F<48&&(F&=15)),F&&(F<8||15<F)?m:(X.window!==null&&X.wbits!==F&&(X.window=null),X.wrap=N,X.wbits=F,C(P))):m}function k(P,F){var N,X;return P?(X=new x,(P.state=X).window=null,(N=A(P,F))!==d&&(P.state=null),N):m}var M,I,z=!0;function H(P){if(z){var F;for(M=new s.Buf32(512),I=new s.Buf32(32),F=0;F<144;)P.lens[F++]=8;for(;F<256;)P.lens[F++]=9;for(;F<280;)P.lens[F++]=7;for(;F<288;)P.lens[F++]=8;for(l(u,P.lens,0,288,M,0,P.work,{bits:9}),F=0;F<32;)P.lens[F++]=5;l(h,P.lens,0,32,I,0,P.work,{bits:5}),z=!1}P.lencode=M,P.lenbits=9,P.distcode=I,P.distbits=5}function K(P,F,N,X){var G,j=P.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new s.Buf8(j.wsize)),X>=j.wsize?(s.arraySet(j.window,F,N-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(X<(G=j.wsize-j.wnext)&&(G=X),s.arraySet(j.window,F,N-X,G,j.wnext),(X-=G)?(s.arraySet(j.window,F,N-X,X,0),j.wnext=X,j.whave=j.wsize):(j.wnext+=G,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=G))),0}i.inflateReset=C,i.inflateReset2=A,i.inflateResetKeep=E,i.inflateInit=function(P){return k(P,15)},i.inflateInit2=k,i.inflate=function(P,F){var N,X,G,j,q,te,W,$,J,ne,ie,ae,xe,Ne,Re,Se,ze,Be,Je,at,re,Le,He,Ue,De=0,fe=new s.Buf8(4),ve=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!P||!P.state||!P.output||!P.input&&P.avail_in!==0)return m;(N=P.state).mode===12&&(N.mode=13),q=P.next_out,G=P.output,W=P.avail_out,j=P.next_in,X=P.input,te=P.avail_in,$=N.hold,J=N.bits,ne=te,ie=W,Le=d;e:for(;;)switch(N.mode){case p:if(N.wrap===0){N.mode=13;break}for(;J<16;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}if(2&N.wrap&&$===35615){fe[N.check=0]=255&$,fe[1]=$>>>8&255,N.check=a(N.check,fe,2,0),J=$=0,N.mode=2;break}if(N.flags=0,N.head&&(N.head.done=!1),!(1&N.wrap)||(((255&$)<<8)+($>>8))%31){P.msg="incorrect header check",N.mode=30;break}if((15&$)!=8){P.msg="unknown compression method",N.mode=30;break}if(J-=4,re=8+(15&($>>>=4)),N.wbits===0)N.wbits=re;else if(re>N.wbits){P.msg="invalid window size",N.mode=30;break}N.dmax=1<<re,P.adler=N.check=1,N.mode=512&$?10:12,J=$=0;break;case 2:for(;J<16;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}if(N.flags=$,(255&N.flags)!=8){P.msg="unknown compression method",N.mode=30;break}if(57344&N.flags){P.msg="unknown header flags set",N.mode=30;break}N.head&&(N.head.text=$>>8&1),512&N.flags&&(fe[0]=255&$,fe[1]=$>>>8&255,N.check=a(N.check,fe,2,0)),J=$=0,N.mode=3;case 3:for(;J<32;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}N.head&&(N.head.time=$),512&N.flags&&(fe[0]=255&$,fe[1]=$>>>8&255,fe[2]=$>>>16&255,fe[3]=$>>>24&255,N.check=a(N.check,fe,4,0)),J=$=0,N.mode=4;case 4:for(;J<16;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}N.head&&(N.head.xflags=255&$,N.head.os=$>>8),512&N.flags&&(fe[0]=255&$,fe[1]=$>>>8&255,N.check=a(N.check,fe,2,0)),J=$=0,N.mode=5;case 5:if(1024&N.flags){for(;J<16;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}N.length=$,N.head&&(N.head.extra_len=$),512&N.flags&&(fe[0]=255&$,fe[1]=$>>>8&255,N.check=a(N.check,fe,2,0)),J=$=0}else N.head&&(N.head.extra=null);N.mode=6;case 6:if(1024&N.flags&&(te<(ae=N.length)&&(ae=te),ae&&(N.head&&(re=N.head.extra_len-N.length,N.head.extra||(N.head.extra=new Array(N.head.extra_len)),s.arraySet(N.head.extra,X,j,ae,re)),512&N.flags&&(N.check=a(N.check,X,ae,j)),te-=ae,j+=ae,N.length-=ae),N.length))break e;N.length=0,N.mode=7;case 7:if(2048&N.flags){if(te===0)break e;for(ae=0;re=X[j+ae++],N.head&&re&&N.length<65536&&(N.head.name+=String.fromCharCode(re)),re&&ae<te;);if(512&N.flags&&(N.check=a(N.check,X,ae,j)),te-=ae,j+=ae,re)break e}else N.head&&(N.head.name=null);N.length=0,N.mode=8;case 8:if(4096&N.flags){if(te===0)break e;for(ae=0;re=X[j+ae++],N.head&&re&&N.length<65536&&(N.head.comment+=String.fromCharCode(re)),re&&ae<te;);if(512&N.flags&&(N.check=a(N.check,X,ae,j)),te-=ae,j+=ae,re)break e}else N.head&&(N.head.comment=null);N.mode=9;case 9:if(512&N.flags){for(;J<16;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}if($!==(65535&N.check)){P.msg="header crc mismatch",N.mode=30;break}J=$=0}N.head&&(N.head.hcrc=N.flags>>9&1,N.head.done=!0),P.adler=N.check=0,N.mode=12;break;case 10:for(;J<32;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}P.adler=N.check=v($),J=$=0,N.mode=11;case 11:if(N.havedict===0)return P.next_out=q,P.avail_out=W,P.next_in=j,P.avail_in=te,N.hold=$,N.bits=J,2;P.adler=N.check=1,N.mode=12;case 12:if(F===5||F===6)break e;case 13:if(N.last){$>>>=7&J,J-=7&J,N.mode=27;break}for(;J<3;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}switch(N.last=1&$,J-=1,3&($>>>=1)){case 0:N.mode=14;break;case 1:if(H(N),N.mode=20,F!==6)break;$>>>=2,J-=2;break e;case 2:N.mode=17;break;case 3:P.msg="invalid block type",N.mode=30}$>>>=2,J-=2;break;case 14:for($>>>=7&J,J-=7&J;J<32;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}if((65535&$)!=($>>>16^65535)){P.msg="invalid stored block lengths",N.mode=30;break}if(N.length=65535&$,J=$=0,N.mode=15,F===6)break e;case 15:N.mode=16;case 16:if(ae=N.length){if(te<ae&&(ae=te),W<ae&&(ae=W),ae===0)break e;s.arraySet(G,X,j,ae,q),te-=ae,j+=ae,W-=ae,q+=ae,N.length-=ae;break}N.mode=12;break;case 17:for(;J<14;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}if(N.nlen=257+(31&$),$>>>=5,J-=5,N.ndist=1+(31&$),$>>>=5,J-=5,N.ncode=4+(15&$),$>>>=4,J-=4,286<N.nlen||30<N.ndist){P.msg="too many length or distance symbols",N.mode=30;break}N.have=0,N.mode=18;case 18:for(;N.have<N.ncode;){for(;J<3;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}N.lens[ve[N.have++]]=7&$,$>>>=3,J-=3}for(;N.have<19;)N.lens[ve[N.have++]]=0;if(N.lencode=N.lendyn,N.lenbits=7,He={bits:N.lenbits},Le=l(0,N.lens,0,19,N.lencode,0,N.work,He),N.lenbits=He.bits,Le){P.msg="invalid code lengths set",N.mode=30;break}N.have=0,N.mode=19;case 19:for(;N.have<N.nlen+N.ndist;){for(;Se=(De=N.lencode[$&(1<<N.lenbits)-1])>>>16&255,ze=65535&De,!((Re=De>>>24)<=J);){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}if(ze<16)$>>>=Re,J-=Re,N.lens[N.have++]=ze;else{if(ze===16){for(Ue=Re+2;J<Ue;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}if($>>>=Re,J-=Re,N.have===0){P.msg="invalid bit length repeat",N.mode=30;break}re=N.lens[N.have-1],ae=3+(3&$),$>>>=2,J-=2}else if(ze===17){for(Ue=Re+3;J<Ue;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}J-=Re,re=0,ae=3+(7&($>>>=Re)),$>>>=3,J-=3}else{for(Ue=Re+7;J<Ue;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}J-=Re,re=0,ae=11+(127&($>>>=Re)),$>>>=7,J-=7}if(N.have+ae>N.nlen+N.ndist){P.msg="invalid bit length repeat",N.mode=30;break}for(;ae--;)N.lens[N.have++]=re}}if(N.mode===30)break;if(N.lens[256]===0){P.msg="invalid code -- missing end-of-block",N.mode=30;break}if(N.lenbits=9,He={bits:N.lenbits},Le=l(u,N.lens,0,N.nlen,N.lencode,0,N.work,He),N.lenbits=He.bits,Le){P.msg="invalid literal/lengths set",N.mode=30;break}if(N.distbits=6,N.distcode=N.distdyn,He={bits:N.distbits},Le=l(h,N.lens,N.nlen,N.ndist,N.distcode,0,N.work,He),N.distbits=He.bits,Le){P.msg="invalid distances set",N.mode=30;break}if(N.mode=20,F===6)break e;case 20:N.mode=21;case 21:if(6<=te&&258<=W){P.next_out=q,P.avail_out=W,P.next_in=j,P.avail_in=te,N.hold=$,N.bits=J,c(P,ie),q=P.next_out,G=P.output,W=P.avail_out,j=P.next_in,X=P.input,te=P.avail_in,$=N.hold,J=N.bits,N.mode===12&&(N.back=-1);break}for(N.back=0;Se=(De=N.lencode[$&(1<<N.lenbits)-1])>>>16&255,ze=65535&De,!((Re=De>>>24)<=J);){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}if(Se&&(240&Se)==0){for(Be=Re,Je=Se,at=ze;Se=(De=N.lencode[at+(($&(1<<Be+Je)-1)>>Be)])>>>16&255,ze=65535&De,!(Be+(Re=De>>>24)<=J);){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}$>>>=Be,J-=Be,N.back+=Be}if($>>>=Re,J-=Re,N.back+=Re,N.length=ze,Se===0){N.mode=26;break}if(32&Se){N.back=-1,N.mode=12;break}if(64&Se){P.msg="invalid literal/length code",N.mode=30;break}N.extra=15&Se,N.mode=22;case 22:if(N.extra){for(Ue=N.extra;J<Ue;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}N.length+=$&(1<<N.extra)-1,$>>>=N.extra,J-=N.extra,N.back+=N.extra}N.was=N.length,N.mode=23;case 23:for(;Se=(De=N.distcode[$&(1<<N.distbits)-1])>>>16&255,ze=65535&De,!((Re=De>>>24)<=J);){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}if((240&Se)==0){for(Be=Re,Je=Se,at=ze;Se=(De=N.distcode[at+(($&(1<<Be+Je)-1)>>Be)])>>>16&255,ze=65535&De,!(Be+(Re=De>>>24)<=J);){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}$>>>=Be,J-=Be,N.back+=Be}if($>>>=Re,J-=Re,N.back+=Re,64&Se){P.msg="invalid distance code",N.mode=30;break}N.offset=ze,N.extra=15&Se,N.mode=24;case 24:if(N.extra){for(Ue=N.extra;J<Ue;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}N.offset+=$&(1<<N.extra)-1,$>>>=N.extra,J-=N.extra,N.back+=N.extra}if(N.offset>N.dmax){P.msg="invalid distance too far back",N.mode=30;break}N.mode=25;case 25:if(W===0)break e;if(ae=ie-W,N.offset>ae){if((ae=N.offset-ae)>N.whave&&N.sane){P.msg="invalid distance too far back",N.mode=30;break}xe=ae>N.wnext?(ae-=N.wnext,N.wsize-ae):N.wnext-ae,ae>N.length&&(ae=N.length),Ne=N.window}else Ne=G,xe=q-N.offset,ae=N.length;for(W<ae&&(ae=W),W-=ae,N.length-=ae;G[q++]=Ne[xe++],--ae;);N.length===0&&(N.mode=21);break;case 26:if(W===0)break e;G[q++]=N.length,W--,N.mode=21;break;case 27:if(N.wrap){for(;J<32;){if(te===0)break e;te--,$|=X[j++]<<J,J+=8}if(ie-=W,P.total_out+=ie,N.total+=ie,ie&&(P.adler=N.check=N.flags?a(N.check,G,ie,q-ie):o(N.check,G,ie,q-ie)),ie=W,(N.flags?$:v($))!==N.check){P.msg="incorrect data check",N.mode=30;break}J=$=0}N.mode=28;case 28:if(N.wrap&&N.flags){for(;J<32;){if(te===0)break e;te--,$+=X[j++]<<J,J+=8}if($!==(4294967295&N.total)){P.msg="incorrect length check",N.mode=30;break}J=$=0}N.mode=29;case 29:Le=1;break e;case 30:Le=-3;break e;case 31:return-4;case 32:default:return m}return P.next_out=q,P.avail_out=W,P.next_in=j,P.avail_in=te,N.hold=$,N.bits=J,(N.wsize||ie!==P.avail_out&&N.mode<30&&(N.mode<27||F!==4))&&K(P,P.output,P.next_out,ie-P.avail_out)?(N.mode=31,-4):(ne-=P.avail_in,ie-=P.avail_out,P.total_in+=ne,P.total_out+=ie,N.total+=ie,N.wrap&&ie&&(P.adler=N.check=N.flags?a(N.check,G,ie,P.next_out-ie):o(N.check,G,ie,P.next_out-ie)),P.data_type=N.bits+(N.last?64:0)+(N.mode===12?128:0)+(N.mode===20||N.mode===15?256:0),(ne==0&&ie===0||F===4)&&Le===d&&(Le=-5),Le)},i.inflateEnd=function(P){if(!P||!P.state)return m;var F=P.state;return F.window&&(F.window=null),P.state=null,d},i.inflateGetHeader=function(P,F){var N;return P&&P.state?(2&(N=P.state).wrap)==0?m:((N.head=F).done=!1,d):m},i.inflateSetDictionary=function(P,F){var N,X=F.length;return P&&P.state?(N=P.state).wrap!==0&&N.mode!==11?m:N.mode===11&&o(1,F,X,0)!==N.check?-3:K(P,F,X,X)?(N.mode=31,-4):(N.havedict=1,d):m},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,h,d,m,p,g,y,v){var x,E,C,A,k,M,I,z,H,K=v.bits,P=0,F=0,N=0,X=0,G=0,j=0,q=0,te=0,W=0,$=0,J=null,ne=0,ie=new s.Buf16(16),ae=new s.Buf16(16),xe=null,Ne=0;for(P=0;P<=15;P++)ie[P]=0;for(F=0;F<m;F++)ie[h[d+F]]++;for(G=K,X=15;1<=X&&ie[X]===0;X--);if(X<G&&(G=X),X===0)return p[g++]=20971520,p[g++]=20971520,v.bits=1,0;for(N=1;N<X&&ie[N]===0;N++);for(G<N&&(G=N),P=te=1;P<=15;P++)if(te<<=1,(te-=ie[P])<0)return-1;if(0<te&&(u===0||X!==1))return-1;for(ae[1]=0,P=1;P<15;P++)ae[P+1]=ae[P]+ie[P];for(F=0;F<m;F++)h[d+F]!==0&&(y[ae[h[d+F]]++]=F);if(M=u===0?(J=xe=y,19):u===1?(J=o,ne-=257,xe=a,Ne-=257,256):(J=c,xe=l,-1),P=N,k=g,q=F=$=0,C=-1,A=(W=1<<(j=G))-1,u===1&&852<W||u===2&&592<W)return 1;for(;;){for(I=P-q,H=y[F]<M?(z=0,y[F]):y[F]>M?(z=xe[Ne+y[F]],J[ne+y[F]]):(z=96,0),x=1<<P-q,N=E=1<<j;p[k+($>>q)+(E-=x)]=I<<24|z<<16|H|0,E!==0;);for(x=1<<P-1;$&x;)x>>=1;if(x!==0?($&=x-1,$+=x):$=0,F++,--ie[P]==0){if(P===X)break;P=h[d+y[F]]}if(G<P&&($&A)!==C){for(q===0&&(q=G),k+=N,te=1<<(j=P-q);j+q<X&&!((te-=ie[j+q])<=0);)j++,te<<=1;if(W+=1<<j,u===1&&852<W||u===2&&592<W)return 1;p[C=$&A]=G<<24|j<<16|k-g|0}}return $!==0&&(p[k+$]=P-q<<24|64<<16|0),v.bits=G,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(De){for(var fe=De.length;0<=--fe;)De[fe]=0}var l=0,u=29,h=256,d=h+1+u,m=30,p=19,g=2*d+1,y=15,v=16,x=7,E=256,C=16,A=17,k=18,M=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=new Array(2*(d+2));c(K);var P=new Array(2*m);c(P);var F=new Array(512);c(F);var N=new Array(256);c(N);var X=new Array(u);c(X);var G,j,q,te=new Array(m);function W(De,fe,ve,Ae,pe){this.static_tree=De,this.extra_bits=fe,this.extra_base=ve,this.elems=Ae,this.max_length=pe,this.has_stree=De&&De.length}function $(De,fe){this.dyn_tree=De,this.max_code=0,this.stat_desc=fe}function J(De){return De<256?F[De]:F[256+(De>>>7)]}function ne(De,fe){De.pending_buf[De.pending++]=255&fe,De.pending_buf[De.pending++]=fe>>>8&255}function ie(De,fe,ve){De.bi_valid>v-ve?(De.bi_buf|=fe<<De.bi_valid&65535,ne(De,De.bi_buf),De.bi_buf=fe>>v-De.bi_valid,De.bi_valid+=ve-v):(De.bi_buf|=fe<<De.bi_valid&65535,De.bi_valid+=ve)}function ae(De,fe,ve){ie(De,ve[2*fe],ve[2*fe+1])}function xe(De,fe){for(var ve=0;ve|=1&De,De>>>=1,ve<<=1,0<--fe;);return ve>>>1}function Ne(De,fe,ve){var Ae,pe,Ge=new Array(y+1),Qe=0;for(Ae=1;Ae<=y;Ae++)Ge[Ae]=Qe=Qe+ve[Ae-1]<<1;for(pe=0;pe<=fe;pe++){var Ze=De[2*pe+1];Ze!==0&&(De[2*pe]=xe(Ge[Ze]++,Ze))}}function Re(De){var fe;for(fe=0;fe<d;fe++)De.dyn_ltree[2*fe]=0;for(fe=0;fe<m;fe++)De.dyn_dtree[2*fe]=0;for(fe=0;fe<p;fe++)De.bl_tree[2*fe]=0;De.dyn_ltree[2*E]=1,De.opt_len=De.static_len=0,De.last_lit=De.matches=0}function Se(De){8<De.bi_valid?ne(De,De.bi_buf):0<De.bi_valid&&(De.pending_buf[De.pending++]=De.bi_buf),De.bi_buf=0,De.bi_valid=0}function ze(De,fe,ve,Ae){var pe=2*fe,Ge=2*ve;return De[pe]<De[Ge]||De[pe]===De[Ge]&&Ae[fe]<=Ae[ve]}function Be(De,fe,ve){for(var Ae=De.heap[ve],pe=ve<<1;pe<=De.heap_len&&(pe<De.heap_len&&ze(fe,De.heap[pe+1],De.heap[pe],De.depth)&&pe++,!ze(fe,Ae,De.heap[pe],De.depth));)De.heap[ve]=De.heap[pe],ve=pe,pe<<=1;De.heap[ve]=Ae}function Je(De,fe,ve){var Ae,pe,Ge,Qe,Ze=0;if(De.last_lit!==0)for(;Ae=De.pending_buf[De.d_buf+2*Ze]<<8|De.pending_buf[De.d_buf+2*Ze+1],pe=De.pending_buf[De.l_buf+Ze],Ze++,Ae===0?ae(De,pe,fe):(ae(De,(Ge=N[pe])+h+1,fe),(Qe=M[Ge])!==0&&ie(De,pe-=X[Ge],Qe),ae(De,Ge=J(--Ae),ve),(Qe=I[Ge])!==0&&ie(De,Ae-=te[Ge],Qe)),Ze<De.last_lit;);ae(De,E,fe)}function at(De,fe){var ve,Ae,pe,Ge=fe.dyn_tree,Qe=fe.stat_desc.static_tree,Ze=fe.stat_desc.has_stree,tt=fe.stat_desc.elems,Ft=-1;for(De.heap_len=0,De.heap_max=g,ve=0;ve<tt;ve++)Ge[2*ve]!==0?(De.heap[++De.heap_len]=Ft=ve,De.depth[ve]=0):Ge[2*ve+1]=0;for(;De.heap_len<2;)Ge[2*(pe=De.heap[++De.heap_len]=Ft<2?++Ft:0)]=1,De.depth[pe]=0,De.opt_len--,Ze&&(De.static_len-=Qe[2*pe+1]);for(fe.max_code=Ft,ve=De.heap_len>>1;1<=ve;ve--)Be(De,Ge,ve);for(pe=tt;ve=De.heap[1],De.heap[1]=De.heap[De.heap_len--],Be(De,Ge,1),Ae=De.heap[1],De.heap[--De.heap_max]=ve,De.heap[--De.heap_max]=Ae,Ge[2*pe]=Ge[2*ve]+Ge[2*Ae],De.depth[pe]=(De.depth[ve]>=De.depth[Ae]?De.depth[ve]:De.depth[Ae])+1,Ge[2*ve+1]=Ge[2*Ae+1]=pe,De.heap[1]=pe++,Be(De,Ge,1),2<=De.heap_len;);De.heap[--De.heap_max]=De.heap[1],(function(bt,Mt){var Ie,ce,Q,le,we,Me,Te=Mt.dyn_tree,ye=Mt.max_code,Ye=Mt.stat_desc.static_tree,Pe=Mt.stat_desc.has_stree,We=Mt.stat_desc.extra_bits,Ve=Mt.stat_desc.extra_base,Xe=Mt.stat_desc.max_length,lt=0;for(le=0;le<=y;le++)bt.bl_count[le]=0;for(Te[2*bt.heap[bt.heap_max]+1]=0,Ie=bt.heap_max+1;Ie<g;Ie++)Xe<(le=Te[2*Te[2*(ce=bt.heap[Ie])+1]+1]+1)&&(le=Xe,lt++),Te[2*ce+1]=le,ye<ce||(bt.bl_count[le]++,we=0,Ve<=ce&&(we=We[ce-Ve]),Me=Te[2*ce],bt.opt_len+=Me*(le+we),Pe&&(bt.static_len+=Me*(Ye[2*ce+1]+we)));if(lt!==0){do{for(le=Xe-1;bt.bl_count[le]===0;)le--;bt.bl_count[le]--,bt.bl_count[le+1]+=2,bt.bl_count[Xe]--,lt-=2}while(0<lt);for(le=Xe;le!==0;le--)for(ce=bt.bl_count[le];ce!==0;)ye<(Q=bt.heap[--Ie])||(Te[2*Q+1]!==le&&(bt.opt_len+=(le-Te[2*Q+1])*Te[2*Q],Te[2*Q+1]=le),ce--)}})(De,fe),Ne(Ge,Ft,De.bl_count)}function re(De,fe,ve){var Ae,pe,Ge=-1,Qe=fe[1],Ze=0,tt=7,Ft=4;for(Qe===0&&(tt=138,Ft=3),fe[2*(ve+1)+1]=65535,Ae=0;Ae<=ve;Ae++)pe=Qe,Qe=fe[2*(Ae+1)+1],++Ze<tt&&pe===Qe||(Ze<Ft?De.bl_tree[2*pe]+=Ze:pe!==0?(pe!==Ge&&De.bl_tree[2*pe]++,De.bl_tree[2*C]++):Ze<=10?De.bl_tree[2*A]++:De.bl_tree[2*k]++,Ge=pe,Ft=(Ze=0)===Qe?(tt=138,3):pe===Qe?(tt=6,3):(tt=7,4))}function Le(De,fe,ve){var Ae,pe,Ge=-1,Qe=fe[1],Ze=0,tt=7,Ft=4;for(Qe===0&&(tt=138,Ft=3),Ae=0;Ae<=ve;Ae++)if(pe=Qe,Qe=fe[2*(Ae+1)+1],!(++Ze<tt&&pe===Qe)){if(Ze<Ft)for(;ae(De,pe,De.bl_tree),--Ze!=0;);else pe!==0?(pe!==Ge&&(ae(De,pe,De.bl_tree),Ze--),ae(De,C,De.bl_tree),ie(De,Ze-3,2)):Ze<=10?(ae(De,A,De.bl_tree),ie(De,Ze-3,3)):(ae(De,k,De.bl_tree),ie(De,Ze-11,7));Ge=pe,Ft=(Ze=0)===Qe?(tt=138,3):pe===Qe?(tt=6,3):(tt=7,4)}}c(te);var He=!1;function Ue(De,fe,ve,Ae){ie(De,(l<<1)+(Ae?1:0),3),(function(pe,Ge,Qe,Ze){Se(pe),ne(pe,Qe),ne(pe,~Qe),s.arraySet(pe.pending_buf,pe.window,Ge,Qe,pe.pending),pe.pending+=Qe})(De,fe,ve)}i._tr_init=function(De){He||((function(){var fe,ve,Ae,pe,Ge,Qe=new Array(y+1);for(pe=Ae=0;pe<u-1;pe++)for(X[pe]=Ae,fe=0;fe<1<<M[pe];fe++)N[Ae++]=pe;for(N[Ae-1]=pe,pe=Ge=0;pe<16;pe++)for(te[pe]=Ge,fe=0;fe<1<<I[pe];fe++)F[Ge++]=pe;for(Ge>>=7;pe<m;pe++)for(te[pe]=Ge<<7,fe=0;fe<1<<I[pe]-7;fe++)F[256+Ge++]=pe;for(ve=0;ve<=y;ve++)Qe[ve]=0;for(fe=0;fe<=143;)K[2*fe+1]=8,fe++,Qe[8]++;for(;fe<=255;)K[2*fe+1]=9,fe++,Qe[9]++;for(;fe<=279;)K[2*fe+1]=7,fe++,Qe[7]++;for(;fe<=287;)K[2*fe+1]=8,fe++,Qe[8]++;for(Ne(K,d+1,Qe),fe=0;fe<m;fe++)P[2*fe+1]=5,P[2*fe]=xe(fe,5);G=new W(K,M,h+1,d,y),j=new W(P,I,0,m,y),q=new W(new Array(0),z,0,p,x)})(),He=!0),De.l_desc=new $(De.dyn_ltree,G),De.d_desc=new $(De.dyn_dtree,j),De.bl_desc=new $(De.bl_tree,q),De.bi_buf=0,De.bi_valid=0,Re(De)},i._tr_stored_block=Ue,i._tr_flush_block=function(De,fe,ve,Ae){var pe,Ge,Qe=0;0<De.level?(De.strm.data_type===2&&(De.strm.data_type=(function(Ze){var tt,Ft=4093624447;for(tt=0;tt<=31;tt++,Ft>>>=1)if(1&Ft&&Ze.dyn_ltree[2*tt]!==0)return o;if(Ze.dyn_ltree[18]!==0||Ze.dyn_ltree[20]!==0||Ze.dyn_ltree[26]!==0)return a;for(tt=32;tt<h;tt++)if(Ze.dyn_ltree[2*tt]!==0)return a;return o})(De)),at(De,De.l_desc),at(De,De.d_desc),Qe=(function(Ze){var tt;for(re(Ze,Ze.dyn_ltree,Ze.l_desc.max_code),re(Ze,Ze.dyn_dtree,Ze.d_desc.max_code),at(Ze,Ze.bl_desc),tt=p-1;3<=tt&&Ze.bl_tree[2*H[tt]+1]===0;tt--);return Ze.opt_len+=3*(tt+1)+5+5+4,tt})(De),pe=De.opt_len+3+7>>>3,(Ge=De.static_len+3+7>>>3)<=pe&&(pe=Ge)):pe=Ge=ve+5,ve+4<=pe&&fe!==-1?Ue(De,fe,ve,Ae):De.strategy===4||Ge===pe?(ie(De,2+(Ae?1:0),3),Je(De,K,P)):(ie(De,4+(Ae?1:0),3),(function(Ze,tt,Ft,bt){var Mt;for(ie(Ze,tt-257,5),ie(Ze,Ft-1,5),ie(Ze,bt-4,4),Mt=0;Mt<bt;Mt++)ie(Ze,Ze.bl_tree[2*H[Mt]+1],3);Le(Ze,Ze.dyn_ltree,tt-1),Le(Ze,Ze.dyn_dtree,Ft-1)})(De,De.l_desc.max_code+1,De.d_desc.max_code+1,Qe+1),Je(De,De.dyn_ltree,De.dyn_dtree)),Re(De),Ae&&Se(De)},i._tr_tally=function(De,fe,ve){return De.pending_buf[De.d_buf+2*De.last_lit]=fe>>>8&255,De.pending_buf[De.d_buf+2*De.last_lit+1]=255&fe,De.pending_buf[De.l_buf+De.last_lit]=255&ve,De.last_lit++,fe===0?De.dyn_ltree[2*ve]++:(De.matches++,fe--,De.dyn_ltree[2*(N[ve]+h+1)]++,De.dyn_dtree[2*J(fe)]++),De.last_lit===De.lit_bufsize-1},i._tr_align=function(De){ie(De,2,3),ae(De,E,K),(function(fe){fe.bi_valid===16?(ne(fe,fe.bi_buf),fe.bi_buf=0,fe.bi_valid=0):8<=fe.bi_valid&&(fe.pending_buf[fe.pending++]=255&fe.bi_buf,fe.bi_buf>>=8,fe.bi_valid-=8)})(De)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,d=1,m={},p=!1,g=o.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(o);y=y&&y.setTimeout?y:o,c={}.toString.call(o.process)==="[object process]"?function(C){Sa.nextTick(function(){x(C)})}:(function(){if(o.postMessage&&!o.importScripts){var C=!0,A=o.onmessage;return o.onmessage=function(){C=!1},o.postMessage("","*"),o.onmessage=A,C}})()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",E,!1):o.attachEvent("onmessage",E),function(C){o.postMessage(h+C,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(C){x(C.data)},function(C){u.port2.postMessage(C)}):g&&"onreadystatechange"in g.createElement("script")?(l=g.documentElement,function(C){var A=g.createElement("script");A.onreadystatechange=function(){x(C),A.onreadystatechange=null,l.removeChild(A),A=null},l.appendChild(A)}):function(C){setTimeout(x,0,C)},y.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var A=new Array(arguments.length-1),k=0;k<A.length;k++)A[k]=arguments[k+1];var M={callback:C,args:A};return m[d]=M,c(d),d++},y.clearImmediate=v}function v(C){delete m[C]}function x(C){if(p)setTimeout(x,0,C);else{var A=m[C];if(A){p=!0;try{(function(k){var M=k.callback,I=k.args;switch(I.length){case 0:M();break;case 1:M(I[0]);break;case 2:M(I[0],I[1]);break;case 3:M(I[0],I[1],I[2]);break;default:M.apply(a,I)}})(A)}finally{v(C),p=!1}}}}function E(C){C.source===o&&typeof C.data=="string"&&C.data.indexOf(h)===0&&x(+C.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Zp<"u"?Zp:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(ZD)),ZD.exports}var Kxe=Wxe();const Xxe=su(Kxe);async function Yxe(t,e){const n=new Xxe;n.file("index.html",`<!doctype html>
      <html lang=en>
      <head>
      <meta charset=utf-8>
      <title>...adding bytes</title>
      </head>
      <body>
      <script>location = 'https://zed.cafe/#${e}';<\/script>
      </body>
    </html>`);const r=await n.generateAsync({type:"blob"});Bxe.saveAs(r,`${t}.zip`)}function Ci(t,e,n){return t.namespaceURI&&t.namespaceURI!=="http://www.w3.org/1999/xhtml"||(e=Array.isArray(e)?e:[e],!e.includes(t.tagName.toLowerCase()))?!1:n?Object.entries(n).every(([r,i])=>t[r]===i):!0}function fm(t){var e;if(Zxe(t)&&t.defaultView)return t.defaultView;if(!((e=t.ownerDocument)===null||e===void 0)&&e.defaultView)return t.ownerDocument.defaultView;throw new Error(`Could not determine window of node. Node was ${Jxe(t)}`)}function Zxe(t){return t.nodeType===9}function Jxe(t){return typeof t=="function"?`function ${t.name}`:t===null?"null":String(t)}function pte(t,e){return new Promise((n,r)=>{const i=new e;i.onerror=r,i.onabort=r,i.onload=()=>{n(String(i.result))},i.readAsText(t)})}function b8(t,e){const n={...e,length:e.length,item:r=>n[r],[Symbol.iterator]:function*(){for(let i=0;i<n.length;i++)yield n[i]}};return n.constructor=t.FileList,t.FileList&&Object.setPrototypeOf(n,t.FileList.prototype),Object.freeze(n),n}function Ny(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class mte{getAsFile(){return this.file}getAsString(e){typeof this.data=="string"&&e(this.data)}webkitGetAsEntry(){throw new Error("not implemented")}constructor(e,n){Ny(this,"kind",void 0),Ny(this,"type",void 0),Ny(this,"file",null),Ny(this,"data",void 0),typeof e=="string"?(this.kind="string",this.type=String(n),this.data=e):(this.kind="file",this.type=e.type,this.file=e)}}class Qxe extends Array{add(...e){const n=new mte(e[0],e[1]);return this.push(n),n}clear(){this.splice(0,this.length)}remove(e){this.splice(e,1)}}function ik(t,e){const[n,r]=t.split("/"),i=!r||r==="*";return s=>e?s.type===(i?n:t):i?s.type.startsWith(`${n}/`):s.type===n}function eTe(t){return new class{getData(n){var r;const i=(r=this.items.find(ik(n,!0)))!==null&&r!==void 0?r:this.items.find(ik(n,!1));let s="";return i?.getAsString(o=>{s=o}),s}setData(n,r){const i=this.items.findIndex(ik(n,!0)),s=new mte(r,n);i>=0?this.items.splice(i,1,s):this.items.push(s)}clearData(n){if(n){const r=this.items.findIndex(ik(n,!0));r>=0&&this.items.remove(r)}else this.items.clear()}get types(){const n=[];return this.files.length&&n.push("Files"),this.items.forEach(r=>n.push(r.type)),Object.freeze(n),n}setDragImage(){}constructor(){Ny(this,"dropEffect","none"),Ny(this,"effectAllowed","uninitialized"),Ny(this,"items",new Qxe),Ny(this,"files",b8(t,[]))}}}function E8(t,e=[]){const n=typeof t.DataTransfer>"u"?eTe(t):new t.DataTransfer;return Object.defineProperty(n,"files",{get:()=>b8(t,e)}),n}async function tTe(t,e){return e.kind==="file"?e.getAsFile():new t.Blob([await new Promise(n=>e.getAsString(n))],{type:e.type})}function gte(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _te(t,...e){const n=Object.fromEntries(e.map(r=>[typeof r=="string"?"text/plain":r.type,Promise.resolve(r)]));return typeof t.ClipboardItem<"u"?new t.ClipboardItem(n):new class{get types(){return Array.from(Object.keys(this.data))}async getType(i){const s=await this.data[i];if(!s)throw new Error(`${i} is not one of the available MIME types on this item.`);return s instanceof t.Blob?s:new t.Blob([s],{type:i})}constructor(i){gte(this,"data",void 0),this.data=i}}(n)}const rx=Symbol("Manage ClipboardSub");function OH(t,e){return Object.assign(new class extends t.EventTarget{async read(){return Array.from(this.items)}async readText(){let r="";for(const i of this.items){const s=i.types.includes("text/plain")?"text/plain":i.types.find(o=>o.startsWith("text/"));s&&(r+=await i.getType(s).then(o=>pte(o,t.FileReader)))}return r}async write(r){this.items=r}async writeText(r){this.items=[_te(t,r)]}constructor(...r){super(...r),gte(this,"items",[])}},{[rx]:e})}function S8(t){return!!t?.[rx]}function nTe(t){if(S8(t.navigator.clipboard))return t.navigator.clipboard[rx];const e=Object.getOwnPropertyDescriptor(t.navigator,"clipboard");let n;const r={resetClipboardStub:()=>{n=OH(t,r)},detachClipboardStub:()=>{e?Object.defineProperty(t.navigator,"clipboard",e):Object.defineProperty(t.navigator,"clipboard",{value:void 0,configurable:!0})}};return n=OH(t,r),Object.defineProperty(t.navigator,"clipboard",{get:()=>n,configurable:!0}),n[rx]}function rTe(t){S8(t.navigator.clipboard)&&t.navigator.clipboard[rx].resetClipboardStub()}function iTe(t){S8(t.navigator.clipboard)&&t.navigator.clipboard[rx].detachClipboardStub()}async function sTe(t){const e=t.defaultView,n=e?.navigator.clipboard,r=n&&await n.read();if(!r)throw new Error("The Clipboard API is unavailable.");const i=E8(e);for(const s of r)for(const o of s.types)i.setData(o,await s.getType(o).then(a=>pte(a,e.FileReader)));return i}async function vte(t,e){const n=fm(t),r=n.navigator.clipboard,i=[];for(let o=0;o<e.items.length;o++){const a=e.items[o],c=await tTe(n,a);i.push(_te(n,c))}if(!(r&&await r.write(i).then(()=>!0,()=>!1)))throw new Error("The Clipboard API is unavailable.")}const TI=globalThis;typeof TI.afterEach=="function"&&TI.afterEach(()=>rTe(globalThis.window));typeof TI.afterAll=="function"&&TI.afterAll(()=>iTe(globalThis.window));const yte=["input:not([type=hidden]):not([disabled])","button:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[contenteditable=""]','[contenteditable="true"]',"a[href]","[tabindex]:not([disabled])"].join(", ");function x8(t){return t.matches(yte)}function oTe(t){return new t.constructor(t.type,t)}function Av(t){for(let n=t;n;n=n.parentElement)if(Ci(n,["button","input","select","textarea","optgroup","option"])){if(n.hasAttribute("disabled"))return!0}else if(Ci(n,"fieldset")){var e;if(n.hasAttribute("disabled")&&!(!((e=n.querySelector(":scope > legend"))===null||e===void 0)&&e.contains(t)))return!0}else if(n.tagName.includes("-")&&n.constructor.formAssociated&&n.hasAttribute("disabled"))return!0;return!1}function TM(t){const e=t.activeElement;return e?.shadowRoot?TM(e.shadowRoot):Av(e)?t.ownerDocument?t.ownerDocument.body:t.body:e}function JD(t){var e;return(e=TM(t))!==null&&e!==void 0?e:t.body}function aTe(t,e){let n=t;do{if(e(n))return n;n=n.parentElement}while(n&&n!==t.ownerDocument.body)}function D1(t){return t.hasAttribute("contenteditable")&&(t.getAttribute("contenteditable")=="true"||t.getAttribute("contenteditable")=="")}function TA(t){const e=cTe(t);return e&&(e.closest('[contenteditable=""]')||e.closest('[contenteditable="true"]'))}function cTe(t){return t.nodeType===1?t:t.parentElement}var bte=(function(t){return t.button="button",t.color="color",t.file="file",t.image="image",t.reset="reset",t.submit="submit",t.checkbox="checkbox",t.radio="radio",t})(bte||{});function Ete(t){return Ci(t,"button")||Ci(t,"input")&&t.type in bte}function ix(t){return xte(t)&&!t.readOnly||D1(t)}var Ste=(function(t){return t.text="text",t.date="date",t["datetime-local"]="datetime-local",t.email="email",t.month="month",t.number="number",t.password="password",t.search="search",t.tel="tel",t.time="time",t.url="url",t.week="week",t})(Ste||{});function xte(t){return Ci(t,"textarea")||Ci(t,"input")&&t.type in Ste}function W0(t){return Tte(t)&&xte(t)}function lTe(t){return Tte(t)&&Ete(t)}function Tte(t){return t.nodeType===1}function uTe(t){const e=t.ownerDocument.getSelection();if(e?.focusNode&&W0(t)){const r=TA(e.focusNode);if(r){if(!e.isCollapsed){var n;const i=((n=r.firstChild)===null||n===void 0?void 0:n.nodeType)===3?r.firstChild:r;e.setBaseAndExtent(i,0,i,0)}}else e.setBaseAndExtent(t,0,t,0)}}var t0={},SO={exports:{}};SO.exports;var IH;function wte(){return IH||(IH=1,(function(t){const n=(s=0)=>o=>`\x1B[${38+s};5;${o}m`,r=(s=0)=>(o,a,c)=>`\x1B[${38+s};2;${o};${a};${c}m`;function i(){const s=new Map,o={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};o.color.gray=o.color.blackBright,o.bgColor.bgGray=o.bgColor.bgBlackBright,o.color.grey=o.color.blackBright,o.bgColor.bgGrey=o.bgColor.bgBlackBright;for(const[a,c]of Object.entries(o)){for(const[l,u]of Object.entries(c))o[l]={open:`\x1B[${u[0]}m`,close:`\x1B[${u[1]}m`},c[l]=o[l],s.set(u[0],u[1]);Object.defineProperty(o,a,{value:c,enumerable:!1})}return Object.defineProperty(o,"codes",{value:s,enumerable:!1}),o.color.close="\x1B[39m",o.bgColor.close="\x1B[49m",o.color.ansi256=n(),o.color.ansi16m=r(),o.bgColor.ansi256=n(10),o.bgColor.ansi16m=r(10),Object.defineProperties(o,{rgbToAnsi256:{value:(a,c,l)=>a===c&&c===l?a<8?16:a>248?231:Math.round((a-8)/247*24)+232:16+36*Math.round(a/255*5)+6*Math.round(c/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:a=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(a.toString(16));if(!c)return[0,0,0];let{colorString:l}=c.groups;l.length===3&&(l=l.split("").map(h=>h+h).join(""));const u=Number.parseInt(l,16);return[u>>16&255,u>>8&255,u&255]},enumerable:!1},hexToAnsi256:{value:a=>o.rgbToAnsi256(...o.hexToRgb(a)),enumerable:!1}}),o}Object.defineProperty(t,"exports",{enumerable:!0,get:i})})(SO)),SO.exports}var Ub={},NH;function d3(){if(NH)return Ub;NH=1,Object.defineProperty(Ub,"__esModule",{value:!0}),Ub.printIteratorEntries=e,Ub.printIteratorValues=n,Ub.printListItems=r,Ub.printObjectProperties=i;const t=(s,o)=>{const a=Object.keys(s).sort(o);return Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(s).forEach(c=>{Object.getOwnPropertyDescriptor(s,c).enumerable&&a.push(c)}),a};function e(s,o,a,c,l,u,h=": "){let d="",m=s.next();if(!m.done){d+=o.spacingOuter;const p=a+o.indent;for(;!m.done;){const g=u(m.value[0],o,p,c,l),y=u(m.value[1],o,p,c,l);d+=p+g+h+y,m=s.next(),m.done?o.min||(d+=","):d+=","+o.spacingInner}d+=o.spacingOuter+a}return d}function n(s,o,a,c,l,u){let h="",d=s.next();if(!d.done){h+=o.spacingOuter;const m=a+o.indent;for(;!d.done;)h+=m+u(d.value,o,m,c,l),d=s.next(),d.done?o.min||(h+=","):h+=","+o.spacingInner;h+=o.spacingOuter+a}return h}function r(s,o,a,c,l,u){let h="";if(s.length){h+=o.spacingOuter;const d=a+o.indent;for(let m=0;m<s.length;m++)h+=d,m in s&&(h+=u(s[m],o,d,c,l)),m<s.length-1?h+=","+o.spacingInner:o.min||(h+=",");h+=o.spacingOuter+a}return h}function i(s,o,a,c,l,u){let h="";const d=t(s,o.compareKeys);if(d.length){h+=o.spacingOuter;const m=a+o.indent;for(let p=0;p<d.length;p++){const g=d[p],y=u(g,o,m,c,l),v=u(s[g],o,m,c,l);h+=m+y+": "+v,p<d.length-1?h+=","+o.spacingInner:o.min||(h+=",")}h+=o.spacingOuter+a}return h}return Ub}var L_={},PH;function fTe(){if(PH)return L_;PH=1,Object.defineProperty(L_,"__esModule",{value:!0}),L_.test=L_.serialize=L_.default=void 0;var t=d3(),e=(function(){return typeof globalThis<"u"?globalThis:typeof e<"u"?e:typeof self<"u"?self:typeof window<"u"?window:Function("return this")()})(),n=e["jest-symbol-do-not-touch"]||e.Symbol;const r=typeof n=="function"&&n.for?n.for("jest.asymmetricMatcher"):1267621,i=" ",s=(l,u,h,d,m,p)=>{const g=l.toString();return g==="ArrayContaining"||g==="ArrayNotContaining"?++d>u.maxDepth?"["+g+"]":g+i+"["+(0,t.printListItems)(l.sample,u,h,d,m,p)+"]":g==="ObjectContaining"||g==="ObjectNotContaining"?++d>u.maxDepth?"["+g+"]":g+i+"{"+(0,t.printObjectProperties)(l.sample,u,h,d,m,p)+"}":g==="StringMatching"||g==="StringNotMatching"||g==="StringContaining"||g==="StringNotContaining"?g+i+p(l.sample,u,h,d,m):l.toAsymmetricMatcher()};L_.serialize=s;const o=l=>l&&l.$$typeof===r;L_.test=o;var c={serialize:s,test:o};return L_.default=c,L_}var U_={},QD,DH;function hTe(){return DH||(DH=1,QD=({onlyFirst:t=!1}={})=>{const e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,t?void 0:"g")}),QD}var LH;function dTe(){if(LH)return U_;LH=1,Object.defineProperty(U_,"__esModule",{value:!0}),U_.test=U_.serialize=U_.default=void 0;var t=n(hTe()),e=n(wte());function n(c){return c&&c.__esModule?c:{default:c}}const r=c=>c.replace((0,t.default)(),l=>{switch(l){case e.default.red.close:case e.default.green.close:case e.default.cyan.close:case e.default.gray.close:case e.default.white.close:case e.default.yellow.close:case e.default.bgRed.close:case e.default.bgGreen.close:case e.default.bgYellow.close:case e.default.inverse.close:case e.default.dim.close:case e.default.bold.close:case e.default.reset.open:case e.default.reset.close:return"</>";case e.default.red.open:return"<red>";case e.default.green.open:return"<green>";case e.default.cyan.open:return"<cyan>";case e.default.gray.open:return"<gray>";case e.default.white.open:return"<white>";case e.default.yellow.open:return"<yellow>";case e.default.bgRed.open:return"<bgRed>";case e.default.bgGreen.open:return"<bgGreen>";case e.default.bgYellow.open:return"<bgYellow>";case e.default.inverse.open:return"<inverse>";case e.default.dim.open:return"<dim>";case e.default.bold.open:return"<bold>";default:return""}}),i=c=>typeof c=="string"&&!!c.match((0,t.default)());U_.test=i;const s=(c,l,u,h,d,m)=>m(r(c),l,u,h,d);U_.serialize=s;var a={serialize:s,test:i};return U_.default=a,U_}var B_={},UH;function pTe(){if(UH)return B_;UH=1,Object.defineProperty(B_,"__esModule",{value:!0}),B_.test=B_.serialize=B_.default=void 0;var t=d3();const e=" ",n=["DOMStringMap","NamedNodeMap"],r=/^(HTML\w*Collection|NodeList)$/,i=u=>n.indexOf(u)!==-1||r.test(u),s=u=>u&&u.constructor&&!!u.constructor.name&&i(u.constructor.name);B_.test=s;const o=u=>u.constructor.name==="NamedNodeMap",a=(u,h,d,m,p,g)=>{const y=u.constructor.name;return++m>h.maxDepth?"["+y+"]":(h.min?"":y+e)+(n.indexOf(y)!==-1?"{"+(0,t.printObjectProperties)(o(u)?Array.from(u).reduce((v,x)=>(v[x.name]=x.value,v),{}):{...u},h,d,m,p,g)+"}":"["+(0,t.printListItems)(Array.from(u),h,d,m,p,g)+"]")};B_.serialize=a;var l={serialize:a,test:s};return B_.default=l,B_}var F_={},Nf={},sk={},BH;function mTe(){if(BH)return sk;BH=1,Object.defineProperty(sk,"__esModule",{value:!0}),sk.default=t;function t(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}return sk}var FH;function T8(){if(FH)return Nf;FH=1,Object.defineProperty(Nf,"__esModule",{value:!0}),Nf.printText=Nf.printProps=Nf.printElementAsLeaf=Nf.printElement=Nf.printComment=Nf.printChildren=void 0;var t=e(mTe());function e(c){return c&&c.__esModule?c:{default:c}}const n=(c,l,u,h,d,m,p)=>{const g=h+u.indent,y=u.colors;return c.map(v=>{const x=l[v];let E=p(x,u,g,d,m);return typeof x!="string"&&(E.indexOf(`
`)!==-1&&(E=u.spacingOuter+g+E+u.spacingOuter+h),E="{"+E+"}"),u.spacingInner+h+y.prop.open+v+y.prop.close+"="+y.value.open+E+y.value.close}).join("")};Nf.printProps=n;const r=(c,l,u,h,d,m)=>c.map(p=>l.spacingOuter+u+(typeof p=="string"?i(p,l):m(p,l,u,h,d))).join("");Nf.printChildren=r;const i=(c,l)=>{const u=l.colors.content;return u.open+(0,t.default)(c)+u.close};Nf.printText=i;const s=(c,l)=>{const u=l.colors.comment;return u.open+"<!--"+(0,t.default)(c)+"-->"+u.close};Nf.printComment=s;const o=(c,l,u,h,d)=>{const m=h.colors.tag;return m.open+"<"+c+(l&&m.close+l+h.spacingOuter+d+m.open)+(u?">"+m.close+u+h.spacingOuter+d+m.open+"</"+c:(l&&!h.min?"":" ")+"/")+">"+m.close};Nf.printElement=o;const a=(c,l)=>{const u=l.colors.tag;return u.open+"<"+c+u.close+" "+u.open+" />"+u.close};return Nf.printElementAsLeaf=a,Nf}var jH;function gTe(){if(jH)return F_;jH=1,Object.defineProperty(F_,"__esModule",{value:!0}),F_.test=F_.serialize=F_.default=void 0;var t=T8();const e=1,n=3,r=8,i=11,s=/^((HTML|SVG)\w*)?Element$/,o=g=>{try{return typeof g.hasAttribute=="function"&&g.hasAttribute("is")}catch{return!1}},a=g=>{const y=g.constructor.name,{nodeType:v,tagName:x}=g,E=typeof x=="string"&&x.includes("-")||o(g);return v===e&&(s.test(y)||E)||v===n&&y==="Text"||v===r&&y==="Comment"||v===i&&y==="DocumentFragment"},c=g=>{var y;return(g==null||(y=g.constructor)===null||y===void 0?void 0:y.name)&&a(g)};F_.test=c;function l(g){return g.nodeType===n}function u(g){return g.nodeType===r}function h(g){return g.nodeType===i}const d=(g,y,v,x,E,C)=>{if(l(g))return(0,t.printText)(g.data,y);if(u(g))return(0,t.printComment)(g.data,y);const A=h(g)?"DocumentFragment":g.tagName.toLowerCase();return++x>y.maxDepth?(0,t.printElementAsLeaf)(A,y):(0,t.printElement)(A,(0,t.printProps)(h(g)?[]:Array.from(g.attributes).map(k=>k.name).sort(),h(g)?{}:Array.from(g.attributes).reduce((k,M)=>(k[M.name]=M.value,k),{}),y,v+y.indent,x,E,C),(0,t.printChildren)(Array.prototype.slice.call(g.childNodes||g.children),y,v+y.indent,x,E,C),y,v)};F_.serialize=d;var p={serialize:d,test:c};return F_.default=p,F_}var j_={},zH;function _Te(){if(zH)return j_;zH=1,Object.defineProperty(j_,"__esModule",{value:!0}),j_.test=j_.serialize=j_.default=void 0;var t=d3();const e="@@__IMMUTABLE_ITERABLE__@@",n="@@__IMMUTABLE_LIST__@@",r="@@__IMMUTABLE_KEYED__@@",i="@@__IMMUTABLE_MAP__@@",s="@@__IMMUTABLE_ORDERED__@@",o="@@__IMMUTABLE_RECORD__@@",a="@@__IMMUTABLE_SEQ__@@",c="@@__IMMUTABLE_SET__@@",l="@@__IMMUTABLE_STACK__@@",u=M=>"Immutable."+M,h=M=>"["+M+"]",d=" ",m="",p=(M,I,z,H,K,P,F)=>++H>I.maxDepth?h(u(F)):u(F)+d+"{"+(0,t.printIteratorEntries)(M.entries(),I,z,H,K,P)+"}";function g(M){let I=0;return{next(){if(I<M._keys.length){const z=M._keys[I++];return{done:!1,value:[z,M.get(z)]}}return{done:!0,value:void 0}}}}const y=(M,I,z,H,K,P)=>{const F=u(M._name||"Record");return++H>I.maxDepth?h(F):F+d+"{"+(0,t.printIteratorEntries)(g(M),I,z,H,K,P)+"}"},v=(M,I,z,H,K,P)=>{const F=u("Seq");return++H>I.maxDepth?h(F):M[r]?F+d+"{"+(M._iter||M._object?(0,t.printIteratorEntries)(M.entries(),I,z,H,K,P):m)+"}":F+d+"["+(M._iter||M._array||M._collection||M._iterable?(0,t.printIteratorValues)(M.values(),I,z,H,K,P):m)+"]"},x=(M,I,z,H,K,P,F)=>++H>I.maxDepth?h(u(F)):u(F)+d+"["+(0,t.printIteratorValues)(M.values(),I,z,H,K,P)+"]",E=(M,I,z,H,K,P)=>M[i]?p(M,I,z,H,K,P,M[s]?"OrderedMap":"Map"):M[n]?x(M,I,z,H,K,P,"List"):M[c]?x(M,I,z,H,K,P,M[s]?"OrderedSet":"Set"):M[l]?x(M,I,z,H,K,P,"Stack"):M[a]?v(M,I,z,H,K,P):y(M,I,z,H,K,P);j_.serialize=E;const C=M=>M&&(M[e]===!0||M[o]===!0);j_.test=C;var k={serialize:E,test:C};return j_.default=k,j_}var z_={},eL={exports:{}},lo={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HH;function vTe(){if(HH)return lo;HH=1;var t=60103,e=60106,n=60107,r=60108,i=60114,s=60109,o=60110,a=60112,c=60113,l=60120,u=60115,h=60116,d=60121,m=60122,p=60117,g=60129,y=60131;if(typeof Symbol=="function"&&Symbol.for){var v=Symbol.for;t=v("react.element"),e=v("react.portal"),n=v("react.fragment"),r=v("react.strict_mode"),i=v("react.profiler"),s=v("react.provider"),o=v("react.context"),a=v("react.forward_ref"),c=v("react.suspense"),l=v("react.suspense_list"),u=v("react.memo"),h=v("react.lazy"),d=v("react.block"),m=v("react.server.block"),p=v("react.fundamental"),g=v("react.debug_trace_mode"),y=v("react.legacy_hidden")}function x(F){if(typeof F=="object"&&F!==null){var N=F.$$typeof;switch(N){case t:switch(F=F.type,F){case n:case i:case r:case c:case l:return F;default:switch(F=F&&F.$$typeof,F){case o:case a:case h:case u:case s:return F;default:return N}}case e:return N}}}var E=s,C=t,A=a,k=n,M=h,I=u,z=e,H=i,K=r,P=c;return lo.ContextConsumer=o,lo.ContextProvider=E,lo.Element=C,lo.ForwardRef=A,lo.Fragment=k,lo.Lazy=M,lo.Memo=I,lo.Portal=z,lo.Profiler=H,lo.StrictMode=K,lo.Suspense=P,lo.isAsyncMode=function(){return!1},lo.isConcurrentMode=function(){return!1},lo.isContextConsumer=function(F){return x(F)===o},lo.isContextProvider=function(F){return x(F)===s},lo.isElement=function(F){return typeof F=="object"&&F!==null&&F.$$typeof===t},lo.isForwardRef=function(F){return x(F)===a},lo.isFragment=function(F){return x(F)===n},lo.isLazy=function(F){return x(F)===h},lo.isMemo=function(F){return x(F)===u},lo.isPortal=function(F){return x(F)===e},lo.isProfiler=function(F){return x(F)===i},lo.isStrictMode=function(F){return x(F)===r},lo.isSuspense=function(F){return x(F)===c},lo.isValidElementType=function(F){return typeof F=="string"||typeof F=="function"||F===n||F===i||F===g||F===r||F===c||F===l||F===y||typeof F=="object"&&F!==null&&(F.$$typeof===h||F.$$typeof===u||F.$$typeof===s||F.$$typeof===o||F.$$typeof===a||F.$$typeof===p||F.$$typeof===d||F[0]===m)},lo.typeOf=x,lo}var qH;function yTe(){return qH||(qH=1,eL.exports=vTe()),eL.exports}var VH;function bTe(){if(VH)return z_;VH=1,Object.defineProperty(z_,"__esModule",{value:!0}),z_.test=z_.serialize=z_.default=void 0;var t=r(yTe()),e=T8();function n(h){if(typeof WeakMap!="function")return null;var d=new WeakMap,m=new WeakMap;return(n=function(p){return p?m:d})(h)}function r(h,d){if(h&&h.__esModule)return h;if(h===null||typeof h!="object"&&typeof h!="function")return{default:h};var m=n(d);if(m&&m.has(h))return m.get(h);var p={},g=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in h)if(y!=="default"&&Object.prototype.hasOwnProperty.call(h,y)){var v=g?Object.getOwnPropertyDescriptor(h,y):null;v&&(v.get||v.set)?Object.defineProperty(p,y,v):p[y]=h[y]}return p.default=h,m&&m.set(h,p),p}const i=(h,d=[])=>(Array.isArray(h)?h.forEach(m=>{i(m,d)}):h!=null&&h!==!1&&d.push(h),d),s=h=>{const d=h.type;if(typeof d=="string")return d;if(typeof d=="function")return d.displayName||d.name||"Unknown";if(t.isFragment(h))return"React.Fragment";if(t.isSuspense(h))return"React.Suspense";if(typeof d=="object"&&d!==null){if(t.isContextProvider(h))return"Context.Provider";if(t.isContextConsumer(h))return"Context.Consumer";if(t.isForwardRef(h)){if(d.displayName)return d.displayName;const m=d.render.displayName||d.render.name||"";return m!==""?"ForwardRef("+m+")":"ForwardRef"}if(t.isMemo(h)){const m=d.displayName||d.type.displayName||d.type.name||"";return m!==""?"Memo("+m+")":"Memo"}}return"UNDEFINED"},o=h=>{const{props:d}=h;return Object.keys(d).filter(m=>m!=="children"&&d[m]!==void 0).sort()},a=(h,d,m,p,g,y)=>++p>d.maxDepth?(0,e.printElementAsLeaf)(s(h),d):(0,e.printElement)(s(h),(0,e.printProps)(o(h),h.props,d,m+d.indent,p,g,y),(0,e.printChildren)(i(h.props.children),d,m+d.indent,p,g,y),d,m);z_.serialize=a;const c=h=>h!=null&&t.isElement(h);z_.test=c;var u={serialize:a,test:c};return z_.default=u,z_}var H_={},GH;function ETe(){if(GH)return H_;GH=1,Object.defineProperty(H_,"__esModule",{value:!0}),H_.test=H_.serialize=H_.default=void 0;var t=T8(),e=(function(){return typeof globalThis<"u"?globalThis:typeof e<"u"?e:typeof self<"u"?self:typeof window<"u"?window:Function("return this")()})(),n=e["jest-symbol-do-not-touch"]||e.Symbol;const r=typeof n=="function"&&n.for?n.for("react.test.json"):245830487,i=l=>{const{props:u}=l;return u?Object.keys(u).filter(h=>u[h]!==void 0).sort():[]},s=(l,u,h,d,m,p)=>++d>u.maxDepth?(0,t.printElementAsLeaf)(l.type,u):(0,t.printElement)(l.type,l.props?(0,t.printProps)(i(l),l.props,u,h+u.indent,d,m,p):"",l.children?(0,t.printChildren)(l.children,u,h+u.indent,d,m,p):"",u,h);H_.serialize=s;const o=l=>l&&l.$$typeof===r;H_.test=o;var c={serialize:s,test:o};return H_.default=c,H_}var $H;function STe(){if($H)return t0;$H=1,Object.defineProperty(t0,"__esModule",{value:!0}),t0.default=t0.DEFAULT_OPTIONS=void 0,t0.format=xe,t0.plugins=void 0;var t=l(wte()),e=d3(),n=l(fTe()),r=l(dTe()),i=l(pTe()),s=l(gTe()),o=l(_Te()),a=l(bTe()),c=l(ETe());function l(Se){return Se&&Se.__esModule?Se:{default:Se}}const u=Object.prototype.toString,h=Date.prototype.toISOString,d=Error.prototype.toString,m=RegExp.prototype.toString,p=Se=>typeof Se.constructor=="function"&&Se.constructor.name||"Object",g=Se=>typeof window<"u"&&Se===window,y=/^Symbol\((.*)\)(.*)$/,v=/\n/gi;class x extends Error{constructor(ze,Be){super(ze),this.stack=Be,this.name=this.constructor.name}}function E(Se){return Se==="[object Array]"||Se==="[object ArrayBuffer]"||Se==="[object DataView]"||Se==="[object Float32Array]"||Se==="[object Float64Array]"||Se==="[object Int8Array]"||Se==="[object Int16Array]"||Se==="[object Int32Array]"||Se==="[object Uint8Array]"||Se==="[object Uint8ClampedArray]"||Se==="[object Uint16Array]"||Se==="[object Uint32Array]"}function C(Se){return Object.is(Se,-0)?"-0":String(Se)}function A(Se){return`${Se}n`}function k(Se,ze){return ze?"[Function "+(Se.name||"anonymous")+"]":"[Function]"}function M(Se){return String(Se).replace(y,"Symbol($1)")}function I(Se){return"["+d.call(Se)+"]"}function z(Se,ze,Be,Je){if(Se===!0||Se===!1)return""+Se;if(Se===void 0)return"undefined";if(Se===null)return"null";const at=typeof Se;if(at==="number")return C(Se);if(at==="bigint")return A(Se);if(at==="string")return Je?'"'+Se.replace(/"|\\/g,"\\$&")+'"':'"'+Se+'"';if(at==="function")return k(Se,ze);if(at==="symbol")return M(Se);const re=u.call(Se);return re==="[object WeakMap]"?"WeakMap {}":re==="[object WeakSet]"?"WeakSet {}":re==="[object Function]"||re==="[object GeneratorFunction]"?k(Se,ze):re==="[object Symbol]"?M(Se):re==="[object Date]"?isNaN(+Se)?"Date { NaN }":h.call(Se):re==="[object Error]"?I(Se):re==="[object RegExp]"?Be?m.call(Se).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"):m.call(Se):Se instanceof Error?I(Se):null}function H(Se,ze,Be,Je,at,re){if(at.indexOf(Se)!==-1)return"[Circular]";at=at.slice(),at.push(Se);const Le=++Je>ze.maxDepth,He=ze.min;if(ze.callToJSON&&!Le&&Se.toJSON&&typeof Se.toJSON=="function"&&!re)return N(Se.toJSON(),ze,Be,Je,at,!0);const Ue=u.call(Se);return Ue==="[object Arguments]"?Le?"[Arguments]":(He?"":"Arguments ")+"["+(0,e.printListItems)(Se,ze,Be,Je,at,N)+"]":E(Ue)?Le?"["+Se.constructor.name+"]":(He||!ze.printBasicPrototype&&Se.constructor.name==="Array"?"":Se.constructor.name+" ")+"["+(0,e.printListItems)(Se,ze,Be,Je,at,N)+"]":Ue==="[object Map]"?Le?"[Map]":"Map {"+(0,e.printIteratorEntries)(Se.entries(),ze,Be,Je,at,N," => ")+"}":Ue==="[object Set]"?Le?"[Set]":"Set {"+(0,e.printIteratorValues)(Se.values(),ze,Be,Je,at,N)+"}":Le||g(Se)?"["+p(Se)+"]":(He||!ze.printBasicPrototype&&p(Se)==="Object"?"":p(Se)+" ")+"{"+(0,e.printObjectProperties)(Se,ze,Be,Je,at,N)+"}"}function K(Se){return Se.serialize!=null}function P(Se,ze,Be,Je,at,re){let Le;try{Le=K(Se)?Se.serialize(ze,Be,Je,at,re,N):Se.print(ze,He=>N(He,Be,Je,at,re),He=>{const Ue=Je+Be.indent;return Ue+He.replace(v,`
`+Ue)},{edgeSpacing:Be.spacingOuter,min:Be.min,spacing:Be.spacingInner},Be.colors)}catch(He){throw new x(He.message,He.stack)}if(typeof Le!="string")throw new Error(`pretty-format: Plugin must return type "string" but instead returned "${typeof Le}".`);return Le}function F(Se,ze){for(let Be=0;Be<Se.length;Be++)try{if(Se[Be].test(ze))return Se[Be]}catch(Je){throw new x(Je.message,Je.stack)}return null}function N(Se,ze,Be,Je,at,re){const Le=F(ze.plugins,Se);if(Le!==null)return P(Le,Se,ze,Be,Je,at);const He=z(Se,ze.printFunctionName,ze.escapeRegex,ze.escapeString);return He!==null?He:H(Se,ze,Be,Je,at,re)}const X={comment:"gray",content:"reset",prop:"yellow",tag:"cyan",value:"green"},G=Object.keys(X),j={callToJSON:!0,compareKeys:void 0,escapeRegex:!1,escapeString:!0,highlight:!1,indent:2,maxDepth:1/0,min:!1,plugins:[],printBasicPrototype:!0,printFunctionName:!0,theme:X};t0.DEFAULT_OPTIONS=j;function q(Se){if(Object.keys(Se).forEach(ze=>{if(!j.hasOwnProperty(ze))throw new Error(`pretty-format: Unknown option "${ze}".`)}),Se.min&&Se.indent!==void 0&&Se.indent!==0)throw new Error('pretty-format: Options "min" and "indent" cannot be used together.');if(Se.theme!==void 0){if(Se.theme===null)throw new Error('pretty-format: Option "theme" must not be null.');if(typeof Se.theme!="object")throw new Error(`pretty-format: Option "theme" must be of type "object" but instead received "${typeof Se.theme}".`)}}const te=Se=>G.reduce((ze,Be)=>{const Je=Se.theme&&Se.theme[Be]!==void 0?Se.theme[Be]:X[Be],at=Je&&t.default[Je];if(at&&typeof at.close=="string"&&typeof at.open=="string")ze[Be]=at;else throw new Error(`pretty-format: Option "theme" has a key "${Be}" whose value "${Je}" is undefined in ansi-styles.`);return ze},Object.create(null)),W=()=>G.reduce((Se,ze)=>(Se[ze]={close:"",open:""},Se),Object.create(null)),$=Se=>Se&&Se.printFunctionName!==void 0?Se.printFunctionName:j.printFunctionName,J=Se=>Se&&Se.escapeRegex!==void 0?Se.escapeRegex:j.escapeRegex,ne=Se=>Se&&Se.escapeString!==void 0?Se.escapeString:j.escapeString,ie=Se=>{var ze;return{callToJSON:Se&&Se.callToJSON!==void 0?Se.callToJSON:j.callToJSON,colors:Se&&Se.highlight?te(Se):W(),compareKeys:Se&&typeof Se.compareKeys=="function"?Se.compareKeys:j.compareKeys,escapeRegex:J(Se),escapeString:ne(Se),indent:Se&&Se.min?"":ae(Se&&Se.indent!==void 0?Se.indent:j.indent),maxDepth:Se&&Se.maxDepth!==void 0?Se.maxDepth:j.maxDepth,min:Se&&Se.min!==void 0?Se.min:j.min,plugins:Se&&Se.plugins!==void 0?Se.plugins:j.plugins,printBasicPrototype:(ze=Se?.printBasicPrototype)!==null&&ze!==void 0?ze:!0,printFunctionName:$(Se),spacingInner:Se&&Se.min?" ":`
`,spacingOuter:Se&&Se.min?"":`
`}};function ae(Se){return new Array(Se+1).join(" ")}function xe(Se,ze){if(ze&&(q(ze),ze.plugins)){const Je=F(ze.plugins,Se);if(Je!==null)return P(Je,Se,ie(ze),"",0,[])}const Be=z(Se,$(ze),J(ze),ne(ze));return Be!==null?Be:H(Se,ie(ze),"",0,[])}const Ne={AsymmetricMatcher:n.default,ConvertAnsi:r.default,DOMCollection:i.default,DOMElement:s.default,Immutable:o.default,ReactElement:a.default,ReactTestComponent:c.default};t0.plugins=Ne;var Re=xe;return t0.default=Re,t0}var Rte=STe(),xTe=Object.prototype.toString;function TTe(t){return typeof t=="function"||xTe.call(t)==="[object Function]"}function wTe(t){var e=Number(t);return isNaN(e)?0:e===0||!isFinite(e)?e:(e>0?1:-1)*Math.floor(Math.abs(e))}var RTe=Math.pow(2,53)-1;function CTe(t){var e=wTe(t);return Math.min(Math.max(e,0),RTe)}function ag(t,e){var n=Array,r=Object(t);if(t==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");for(var i=CTe(r.length),s=TTe(n)?Object(new n(i)):new Array(i),o=0,a;o<i;)a=r[o],s[o]=a,o+=1;return s.length=i,s}function wA(t){"@babel/helpers - typeof";return wA=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wA(t)}function ATe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function MTe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Cte(r.key),r)}}function kTe(t,e,n){return e&&MTe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function OTe(t,e,n){return e=Cte(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Cte(t){var e=ITe(t,"string");return wA(e)==="symbol"?e:String(e)}function ITe(t,e){if(wA(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(wA(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var NTe=(function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];ATe(this,t),OTe(this,"items",void 0),this.items=e}return kTe(t,[{key:"add",value:function(n){return this.has(n)===!1&&this.items.push(n),this}},{key:"clear",value:function(){this.items=[]}},{key:"delete",value:function(n){var r=this.items.length;return this.items=this.items.filter(function(i){return i!==n}),r!==this.items.length}},{key:"forEach",value:function(n){var r=this;this.items.forEach(function(i){n(i,i,r)})}},{key:"has",value:function(n){return this.items.indexOf(n)!==-1}},{key:"size",get:function(){return this.items.length}}]),t})();const PTe=typeof Set>"u"?Set:NTe;function lf(t){var e;return(e=t.localName)!==null&&e!==void 0?e:t.tagName.toLowerCase()}var DTe={article:"article",aside:"complementary",button:"button",datalist:"listbox",dd:"definition",details:"group",dialog:"dialog",dt:"term",fieldset:"group",figure:"figure",form:"form",footer:"contentinfo",h1:"heading",h2:"heading",h3:"heading",h4:"heading",h5:"heading",h6:"heading",header:"banner",hr:"separator",html:"document",legend:"legend",li:"listitem",math:"math",main:"main",menu:"list",nav:"navigation",ol:"list",optgroup:"group",option:"option",output:"status",progress:"progressbar",section:"region",summary:"button",table:"table",tbody:"rowgroup",textarea:"textbox",tfoot:"rowgroup",td:"cell",th:"columnheader",thead:"rowgroup",tr:"row",ul:"list"},LTe={caption:new Set(["aria-label","aria-labelledby"]),code:new Set(["aria-label","aria-labelledby"]),deletion:new Set(["aria-label","aria-labelledby"]),emphasis:new Set(["aria-label","aria-labelledby"]),generic:new Set(["aria-label","aria-labelledby","aria-roledescription"]),insertion:new Set(["aria-label","aria-labelledby"]),paragraph:new Set(["aria-label","aria-labelledby"]),presentation:new Set(["aria-label","aria-labelledby"]),strong:new Set(["aria-label","aria-labelledby"]),subscript:new Set(["aria-label","aria-labelledby"]),superscript:new Set(["aria-label","aria-labelledby"])};function UTe(t,e){return["aria-atomic","aria-busy","aria-controls","aria-current","aria-describedby","aria-details","aria-dropeffect","aria-flowto","aria-grabbed","aria-hidden","aria-keyshortcuts","aria-label","aria-labelledby","aria-live","aria-owns","aria-relevant","aria-roledescription"].some(function(n){var r;return t.hasAttribute(n)&&!((r=LTe[e])!==null&&r!==void 0&&r.has(n))})}function Ate(t,e){return UTe(t,e)}function BTe(t){var e=jTe(t);if(e===null||e==="presentation"){var n=FTe(t);if(e!=="presentation"||Ate(t,n||""))return n}return e}function FTe(t){var e=DTe[lf(t)];if(e!==void 0)return e;switch(lf(t)){case"a":case"area":case"link":if(t.hasAttribute("href"))return"link";break;case"img":return t.getAttribute("alt")===""&&!Ate(t,"img")?"presentation":"img";case"input":{var n=t,r=n.type;switch(r){case"button":case"image":case"reset":case"submit":return"button";case"checkbox":case"radio":return r;case"range":return"slider";case"email":case"tel":case"text":case"url":return t.hasAttribute("list")?"combobox":"textbox";case"search":return t.hasAttribute("list")?"combobox":"searchbox";case"number":return"spinbutton";default:return null}}case"select":return t.hasAttribute("multiple")||t.size>1?"listbox":"combobox"}return null}function jTe(t){var e=t.getAttribute("role");if(e!==null){var n=e.trim().split(" ")[0];if(n.length>0)return n}return null}function ba(t){return t!==null&&t.nodeType===t.ELEMENT_NODE}function Mte(t){return ba(t)&&lf(t)==="caption"}function xO(t){return ba(t)&&lf(t)==="input"}function zTe(t){return ba(t)&&lf(t)==="optgroup"}function HTe(t){return ba(t)&&lf(t)==="select"}function qTe(t){return ba(t)&&lf(t)==="table"}function VTe(t){return ba(t)&&lf(t)==="textarea"}function GTe(t){var e=t.ownerDocument===null?t:t.ownerDocument,n=e.defaultView;if(n===null)throw new TypeError("no window available");return n}function $Te(t){return ba(t)&&lf(t)==="fieldset"}function WTe(t){return ba(t)&&lf(t)==="legend"}function KTe(t){return ba(t)&&lf(t)==="slot"}function XTe(t){return ba(t)&&t.ownerSVGElement!==void 0}function YTe(t){return ba(t)&&lf(t)==="svg"}function ZTe(t){return XTe(t)&&lf(t)==="title"}function wI(t,e){if(ba(t)&&t.hasAttribute(e)){var n=t.getAttribute(e).split(" "),r=t.getRootNode?t.getRootNode():t.ownerDocument;return n.map(function(i){return r.getElementById(i)}).filter(function(i){return i!==null})}return[]}function fv(t,e){return ba(t)?e.indexOf(BTe(t))!==-1:!1}function JTe(t){return t.trim().replace(/\s\s+/g," ")}function QTe(t,e){if(!ba(t))return!1;if(t.hasAttribute("hidden")||t.getAttribute("aria-hidden")==="true")return!0;var n=e(t);return n.getPropertyValue("display")==="none"||n.getPropertyValue("visibility")==="hidden"}function ewe(t){return fv(t,["button","combobox","listbox","textbox"])||kte(t,"range")}function kte(t,e){if(!ba(t))return!1;switch(e){case"range":return fv(t,["meter","progressbar","scrollbar","slider","spinbutton"]);default:throw new TypeError("No knowledge about abstract role '".concat(e,"'. This is likely a bug :("))}}function WH(t,e){var n=ag(t.querySelectorAll(e));return wI(t,"aria-owns").forEach(function(r){n.push.apply(n,ag(r.querySelectorAll(e)))}),n}function twe(t){return HTe(t)?t.selectedOptions||WH(t,"[selected]"):WH(t,'[aria-selected="true"]')}function nwe(t){return fv(t,["none","presentation"])}function rwe(t){return Mte(t)}function iwe(t){return fv(t,["button","cell","checkbox","columnheader","gridcell","heading","label","legend","link","menuitem","menuitemcheckbox","menuitemradio","option","radio","row","rowheader","switch","tab","tooltip","treeitem"])}function swe(t){return!1}function owe(t){return xO(t)||VTe(t)?t.value:t.textContent||""}function KH(t){var e=t.getPropertyValue("content");return/^["'].*["']$/.test(e)?e.slice(1,-1):""}function Ote(t){var e=lf(t);return e==="button"||e==="input"&&t.getAttribute("type")!=="hidden"||e==="meter"||e==="output"||e==="progress"||e==="select"||e==="textarea"}function Ite(t){if(Ote(t))return t;var e=null;return t.childNodes.forEach(function(n){if(e===null&&ba(n)){var r=Ite(n);r!==null&&(e=r)}}),e}function awe(t){if(t.control!==void 0)return t.control;var e=t.getAttribute("for");return e!==null?t.ownerDocument.getElementById(e):Ite(t)}function cwe(t){var e=t.labels;if(e===null)return e;if(e!==void 0)return ag(e);if(!Ote(t))return null;var n=t.ownerDocument;return ag(n.querySelectorAll("label")).filter(function(r){return awe(r)===t})}function lwe(t){var e=t.assignedNodes();return e.length===0?ag(t.childNodes):e}function Nte(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=new PTe,r=GTe(t),i=e.compute,s=i===void 0?"name":i,o=e.computedStyleSupportsPseudoElements,a=o===void 0?e.getComputedStyle!==void 0:o,c=e.getComputedStyle,l=c===void 0?r.getComputedStyle.bind(r):c,u=e.hidden,h=u===void 0?!1:u;function d(v,x){var E="";if(ba(v)&&a){var C=l(v,"::before"),A=KH(C);E="".concat(A," ").concat(E)}var k=KTe(v)?lwe(v):ag(v.childNodes).concat(wI(v,"aria-owns"));if(k.forEach(function(z){var H=y(z,{isEmbeddedInLabel:x.isEmbeddedInLabel,isReferenced:!1,recursion:!0}),K=ba(z)?l(z).getPropertyValue("display"):"inline",P=K!=="inline"?" ":"";E+="".concat(P).concat(H).concat(P)}),ba(v)&&a){var M=l(v,"::after"),I=KH(M);E="".concat(E," ").concat(I)}return E.trim()}function m(v,x){var E=v.getAttributeNode(x);return E!==null&&!n.has(E)&&E.value.trim()!==""?(n.add(E),E.value):null}function p(v){return ba(v)?m(v,"title"):null}function g(v){if(!ba(v))return null;if($Te(v)){n.add(v);for(var x=ag(v.childNodes),E=0;E<x.length;E+=1){var C=x[E];if(WTe(C))return y(C,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else if(qTe(v)){n.add(v);for(var A=ag(v.childNodes),k=0;k<A.length;k+=1){var M=A[k];if(Mte(M))return y(M,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else if(YTe(v)){n.add(v);for(var I=ag(v.childNodes),z=0;z<I.length;z+=1){var H=I[z];if(ZTe(H))return H.textContent}return null}else if(lf(v)==="img"||lf(v)==="area"){var K=m(v,"alt");if(K!==null)return K}else if(zTe(v)){var P=m(v,"label");if(P!==null)return P}if(xO(v)&&(v.type==="button"||v.type==="submit"||v.type==="reset")){var F=m(v,"value");if(F!==null)return F;if(v.type==="submit")return"Submit";if(v.type==="reset")return"Reset"}var N=cwe(v);if(N!==null&&N.length!==0)return n.add(v),ag(N).map(function(q){return y(q,{isEmbeddedInLabel:!0,isReferenced:!1,recursion:!0})}).filter(function(q){return q.length>0}).join(" ");if(xO(v)&&v.type==="image"){var X=m(v,"alt");if(X!==null)return X;var G=m(v,"title");return G!==null?G:"Submit Query"}if(fv(v,["button"])){var j=d(v,{isEmbeddedInLabel:!1});if(j!=="")return j}return null}function y(v,x){if(n.has(v))return"";if(!h&&QTe(v,l)&&!x.isReferenced)return n.add(v),"";var E=ba(v)?v.getAttributeNode("aria-labelledby"):null,C=E!==null&&!n.has(E)?wI(v,"aria-labelledby"):[];if(s==="name"&&!x.isReferenced&&C.length>0)return n.add(E),C.map(function(K){return y(K,{isEmbeddedInLabel:x.isEmbeddedInLabel,isReferenced:!0,recursion:!1})}).join(" ");var A=x.recursion&&ewe(v)&&s==="name";if(!A){var k=(ba(v)&&v.getAttribute("aria-label")||"").trim();if(k!==""&&s==="name")return n.add(v),k;if(!nwe(v)){var M=g(v);if(M!==null)return n.add(v),M}}if(fv(v,["menu"]))return n.add(v),"";if(A||x.isEmbeddedInLabel||x.isReferenced){if(fv(v,["combobox","listbox"])){n.add(v);var I=twe(v);return I.length===0?xO(v)?v.value:"":ag(I).map(function(K){return y(K,{isEmbeddedInLabel:x.isEmbeddedInLabel,isReferenced:!1,recursion:!0})}).join(" ")}if(kte(v,"range"))return n.add(v),v.hasAttribute("aria-valuetext")?v.getAttribute("aria-valuetext"):v.hasAttribute("aria-valuenow")?v.getAttribute("aria-valuenow"):v.getAttribute("value")||"";if(fv(v,["textbox"]))return n.add(v),owe(v)}if(iwe(v)||ba(v)&&x.isReferenced||rwe(v)||swe()){var z=d(v,{isEmbeddedInLabel:x.isEmbeddedInLabel});if(z!=="")return n.add(v),z}if(v.nodeType===v.TEXT_NODE)return n.add(v),v.textContent||"";if(x.recursion)return n.add(v),d(v,{isEmbeddedInLabel:x.isEmbeddedInLabel});var H=p(v);return H!==null?(n.add(v),H):(n.add(v),"")}return JTe(y(t,{isEmbeddedInLabel:!1,isReferenced:s==="description",recursion:!1}))}function RA(t){"@babel/helpers - typeof";return RA=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},RA(t)}function XH(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function YH(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?XH(Object(n),!0).forEach(function(r){uwe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):XH(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function uwe(t,e,n){return e=fwe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fwe(t){var e=hwe(t,"string");return RA(e)==="symbol"?e:String(e)}function hwe(t,e){if(RA(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(RA(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Pte(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=wI(t,"aria-describedby").map(function(i){return Nte(i,YH(YH({},e),{},{compute:"description"}))}).join(" ");if(n===""){var r=t.getAttribute("title");n=r===null?"":r}return n}function dwe(t){return fv(t,["caption","code","deletion","emphasis","generic","insertion","paragraph","presentation","strong","subscript","superscript"])}function w8(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return dwe(t)?"":Nte(t,e)}var kd={},xT={},ok={},TT={},ZH;function pwe(){if(ZH)return TT;ZH=1,Object.defineProperty(TT,"__esModule",{value:!0}),TT.default=void 0;function t(){var n=this,r=0,i={"@@iterator":function(){return i},next:function(){if(r<n.length){var o=n[r];return r=r+1,{done:!1,value:o}}else return{done:!0}}};return i}var e=t;return TT.default=e,TT}var JH;function wM(){if(JH)return ok;JH=1,Object.defineProperty(ok,"__esModule",{value:!0}),ok.default=r;var t=e(pwe());function e(i){return i&&i.__esModule?i:{default:i}}function n(i){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},n(i)}function r(i,s){return typeof Symbol=="function"&&n(Symbol.iterator)==="symbol"&&Object.defineProperty(i,Symbol.iterator,{value:t.default.bind(s)}),i}return ok}var QH;function mwe(){if(QH)return xT;QH=1,Object.defineProperty(xT,"__esModule",{value:!0}),xT.default=void 0;var t=e(wM());function e(d){return d&&d.__esModule?d:{default:d}}function n(d,m){return s(d)||i(d,m)||a(d,m)||r()}function r(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i(d,m){var p=d==null?null:typeof Symbol<"u"&&d[Symbol.iterator]||d["@@iterator"];if(p!=null){var g=[],y=!0,v=!1,x,E;try{for(p=p.call(d);!(y=(x=p.next()).done)&&(g.push(x.value),!(m&&g.length===m));y=!0);}catch(C){v=!0,E=C}finally{try{!y&&p.return!=null&&p.return()}finally{if(v)throw E}}return g}}function s(d){if(Array.isArray(d))return d}function o(d,m){var p=typeof Symbol<"u"&&d[Symbol.iterator]||d["@@iterator"];if(!p){if(Array.isArray(d)||(p=a(d))||m){p&&(d=p);var g=0,y=function(){};return{s:y,n:function(){return g>=d.length?{done:!0}:{done:!1,value:d[g++]}},e:function(A){throw A},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,x=!1,E;return{s:function(){p=p.call(d)},n:function(){var A=p.next();return v=A.done,A},e:function(A){x=!0,E=A},f:function(){try{!v&&p.return!=null&&p.return()}finally{if(x)throw E}}}}function a(d,m){if(d){if(typeof d=="string")return c(d,m);var p=Object.prototype.toString.call(d).slice(8,-1);if(p==="Object"&&d.constructor&&(p=d.constructor.name),p==="Map"||p==="Set")return Array.from(d);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return c(d,m)}}function c(d,m){(m==null||m>d.length)&&(m=d.length);for(var p=0,g=new Array(m);p<m;p++)g[p]=d[p];return g}var l=[["aria-activedescendant",{type:"id"}],["aria-atomic",{type:"boolean"}],["aria-autocomplete",{type:"token",values:["inline","list","both","none"]}],["aria-braillelabel",{type:"string"}],["aria-brailleroledescription",{type:"string"}],["aria-busy",{type:"boolean"}],["aria-checked",{type:"tristate"}],["aria-colcount",{type:"integer"}],["aria-colindex",{type:"integer"}],["aria-colspan",{type:"integer"}],["aria-controls",{type:"idlist"}],["aria-current",{type:"token",values:["page","step","location","date","time",!0,!1]}],["aria-describedby",{type:"idlist"}],["aria-description",{type:"string"}],["aria-details",{type:"id"}],["aria-disabled",{type:"boolean"}],["aria-dropeffect",{type:"tokenlist",values:["copy","execute","link","move","none","popup"]}],["aria-errormessage",{type:"id"}],["aria-expanded",{type:"boolean",allowundefined:!0}],["aria-flowto",{type:"idlist"}],["aria-grabbed",{type:"boolean",allowundefined:!0}],["aria-haspopup",{type:"token",values:[!1,!0,"menu","listbox","tree","grid","dialog"]}],["aria-hidden",{type:"boolean",allowundefined:!0}],["aria-invalid",{type:"token",values:["grammar",!1,"spelling",!0]}],["aria-keyshortcuts",{type:"string"}],["aria-label",{type:"string"}],["aria-labelledby",{type:"idlist"}],["aria-level",{type:"integer"}],["aria-live",{type:"token",values:["assertive","off","polite"]}],["aria-modal",{type:"boolean"}],["aria-multiline",{type:"boolean"}],["aria-multiselectable",{type:"boolean"}],["aria-orientation",{type:"token",values:["vertical","undefined","horizontal"]}],["aria-owns",{type:"idlist"}],["aria-placeholder",{type:"string"}],["aria-posinset",{type:"integer"}],["aria-pressed",{type:"tristate"}],["aria-readonly",{type:"boolean"}],["aria-relevant",{type:"tokenlist",values:["additions","all","removals","text"]}],["aria-required",{type:"boolean"}],["aria-roledescription",{type:"string"}],["aria-rowcount",{type:"integer"}],["aria-rowindex",{type:"integer"}],["aria-rowspan",{type:"integer"}],["aria-selected",{type:"boolean",allowundefined:!0}],["aria-setsize",{type:"integer"}],["aria-sort",{type:"token",values:["ascending","descending","none","other"]}],["aria-valuemax",{type:"number"}],["aria-valuemin",{type:"number"}],["aria-valuenow",{type:"number"}],["aria-valuetext",{type:"string"}]],u={entries:function(){return l},forEach:function(m){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,g=o(l),y;try{for(g.s();!(y=g.n()).done;){var v=n(y.value,2),x=v[0],E=v[1];m.call(p,E,x,l)}}catch(C){g.e(C)}finally{g.f()}},get:function(m){var p=l.find(function(g){return g[0]===m});return p&&p[1]},has:function(m){return!!u.get(m)},keys:function(){return l.map(function(m){var p=n(m,1),g=p[0];return g})},values:function(){return l.map(function(m){var p=n(m,2),g=p[1];return g})}},h=(0,t.default)(u,u.entries());return xT.default=h,xT}var wT={},eq;function gwe(){if(eq)return wT;eq=1,Object.defineProperty(wT,"__esModule",{value:!0}),wT.default=void 0;var t=e(wM());function e(d){return d&&d.__esModule?d:{default:d}}function n(d,m){return s(d)||i(d,m)||a(d,m)||r()}function r(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i(d,m){var p=d==null?null:typeof Symbol<"u"&&d[Symbol.iterator]||d["@@iterator"];if(p!=null){var g=[],y=!0,v=!1,x,E;try{for(p=p.call(d);!(y=(x=p.next()).done)&&(g.push(x.value),!(m&&g.length===m));y=!0);}catch(C){v=!0,E=C}finally{try{!y&&p.return!=null&&p.return()}finally{if(v)throw E}}return g}}function s(d){if(Array.isArray(d))return d}function o(d,m){var p=typeof Symbol<"u"&&d[Symbol.iterator]||d["@@iterator"];if(!p){if(Array.isArray(d)||(p=a(d))||m){p&&(d=p);var g=0,y=function(){};return{s:y,n:function(){return g>=d.length?{done:!0}:{done:!1,value:d[g++]}},e:function(A){throw A},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,x=!1,E;return{s:function(){p=p.call(d)},n:function(){var A=p.next();return v=A.done,A},e:function(A){x=!0,E=A},f:function(){try{!v&&p.return!=null&&p.return()}finally{if(x)throw E}}}}function a(d,m){if(d){if(typeof d=="string")return c(d,m);var p=Object.prototype.toString.call(d).slice(8,-1);if(p==="Object"&&d.constructor&&(p=d.constructor.name),p==="Map"||p==="Set")return Array.from(d);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return c(d,m)}}function c(d,m){(m==null||m>d.length)&&(m=d.length);for(var p=0,g=new Array(m);p<m;p++)g[p]=d[p];return g}var l=[["a",{reserved:!1}],["abbr",{reserved:!1}],["acronym",{reserved:!1}],["address",{reserved:!1}],["applet",{reserved:!1}],["area",{reserved:!1}],["article",{reserved:!1}],["aside",{reserved:!1}],["audio",{reserved:!1}],["b",{reserved:!1}],["base",{reserved:!0}],["bdi",{reserved:!1}],["bdo",{reserved:!1}],["big",{reserved:!1}],["blink",{reserved:!1}],["blockquote",{reserved:!1}],["body",{reserved:!1}],["br",{reserved:!1}],["button",{reserved:!1}],["canvas",{reserved:!1}],["caption",{reserved:!1}],["center",{reserved:!1}],["cite",{reserved:!1}],["code",{reserved:!1}],["col",{reserved:!0}],["colgroup",{reserved:!0}],["content",{reserved:!1}],["data",{reserved:!1}],["datalist",{reserved:!1}],["dd",{reserved:!1}],["del",{reserved:!1}],["details",{reserved:!1}],["dfn",{reserved:!1}],["dialog",{reserved:!1}],["dir",{reserved:!1}],["div",{reserved:!1}],["dl",{reserved:!1}],["dt",{reserved:!1}],["em",{reserved:!1}],["embed",{reserved:!1}],["fieldset",{reserved:!1}],["figcaption",{reserved:!1}],["figure",{reserved:!1}],["font",{reserved:!1}],["footer",{reserved:!1}],["form",{reserved:!1}],["frame",{reserved:!1}],["frameset",{reserved:!1}],["h1",{reserved:!1}],["h2",{reserved:!1}],["h3",{reserved:!1}],["h4",{reserved:!1}],["h5",{reserved:!1}],["h6",{reserved:!1}],["head",{reserved:!0}],["header",{reserved:!1}],["hgroup",{reserved:!1}],["hr",{reserved:!1}],["html",{reserved:!0}],["i",{reserved:!1}],["iframe",{reserved:!1}],["img",{reserved:!1}],["input",{reserved:!1}],["ins",{reserved:!1}],["kbd",{reserved:!1}],["keygen",{reserved:!1}],["label",{reserved:!1}],["legend",{reserved:!1}],["li",{reserved:!1}],["link",{reserved:!0}],["main",{reserved:!1}],["map",{reserved:!1}],["mark",{reserved:!1}],["marquee",{reserved:!1}],["menu",{reserved:!1}],["menuitem",{reserved:!1}],["meta",{reserved:!0}],["meter",{reserved:!1}],["nav",{reserved:!1}],["noembed",{reserved:!0}],["noscript",{reserved:!0}],["object",{reserved:!1}],["ol",{reserved:!1}],["optgroup",{reserved:!1}],["option",{reserved:!1}],["output",{reserved:!1}],["p",{reserved:!1}],["param",{reserved:!0}],["picture",{reserved:!0}],["pre",{reserved:!1}],["progress",{reserved:!1}],["q",{reserved:!1}],["rp",{reserved:!1}],["rt",{reserved:!1}],["rtc",{reserved:!1}],["ruby",{reserved:!1}],["s",{reserved:!1}],["samp",{reserved:!1}],["script",{reserved:!0}],["section",{reserved:!1}],["select",{reserved:!1}],["small",{reserved:!1}],["source",{reserved:!0}],["spacer",{reserved:!1}],["span",{reserved:!1}],["strike",{reserved:!1}],["strong",{reserved:!1}],["style",{reserved:!0}],["sub",{reserved:!1}],["summary",{reserved:!1}],["sup",{reserved:!1}],["table",{reserved:!1}],["tbody",{reserved:!1}],["td",{reserved:!1}],["textarea",{reserved:!1}],["tfoot",{reserved:!1}],["th",{reserved:!1}],["thead",{reserved:!1}],["time",{reserved:!1}],["title",{reserved:!0}],["tr",{reserved:!1}],["track",{reserved:!0}],["tt",{reserved:!1}],["u",{reserved:!1}],["ul",{reserved:!1}],["var",{reserved:!1}],["video",{reserved:!1}],["wbr",{reserved:!1}],["xmp",{reserved:!1}]],u={entries:function(){return l},forEach:function(m){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,g=o(l),y;try{for(g.s();!(y=g.n()).done;){var v=n(y.value,2),x=v[0],E=v[1];m.call(p,E,x,l)}}catch(C){g.e(C)}finally{g.f()}},get:function(m){var p=l.find(function(g){return g[0]===m});return p&&p[1]},has:function(m){return!!u.get(m)},keys:function(){return l.map(function(m){var p=n(m,1),g=p[0];return g})},values:function(){return l.map(function(m){var p=n(m,2),g=p[1];return g})}},h=(0,t.default)(u,u.entries());return wT.default=h,wT}var RT={},CT={},AT={},tq;function _we(){if(tq)return AT;tq=1,Object.defineProperty(AT,"__esModule",{value:!0}),AT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},e=t;return AT.default=e,AT}var MT={},nq;function vwe(){if(nq)return MT;nq=1,Object.defineProperty(MT,"__esModule",{value:!0}),MT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},e=t;return MT.default=e,MT}var kT={},rq;function ywe(){if(rq)return kT;rq=1,Object.defineProperty(kT,"__esModule",{value:!0}),kT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null},relatedConcepts:[{concept:{name:"input"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},e=t;return kT.default=e,kT}var OT={},iq;function bwe(){if(iq)return OT;iq=1,Object.defineProperty(OT,"__esModule",{value:!0}),OT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return OT.default=e,OT}var IT={},sq;function Ewe(){if(sq)return IT;sq=1,Object.defineProperty(IT,"__esModule",{value:!0}),IT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuemax":null,"aria-valuemin":null,"aria-valuenow":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},e=t;return IT.default=e,IT}var NT={},oq;function Swe(){if(oq)return NT;oq=1,Object.defineProperty(NT,"__esModule",{value:!0}),NT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{"aria-atomic":null,"aria-busy":null,"aria-controls":null,"aria-current":null,"aria-describedby":null,"aria-details":null,"aria-dropeffect":null,"aria-flowto":null,"aria-grabbed":null,"aria-hidden":null,"aria-keyshortcuts":null,"aria-label":null,"aria-labelledby":null,"aria-live":null,"aria-owns":null,"aria-relevant":null,"aria-roledescription":null},relatedConcepts:[{concept:{name:"role"},module:"XHTML"},{concept:{name:"type"},module:"Dublin Core"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]},e=t;return NT.default=e,NT}var PT={},aq;function xwe(){if(aq)return PT;aq=1,Object.defineProperty(PT,"__esModule",{value:!0}),PT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"frontmatter"},module:"DTB"},{concept:{name:"level"},module:"DTB"},{concept:{name:"level"},module:"SMIL"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},e=t;return PT.default=e,PT}var DT={},cq;function Twe(){if(cq)return DT;cq=1,Object.defineProperty(DT,"__esModule",{value:!0}),DT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},e=t;return DT.default=e,DT}var LT={},lq;function wwe(){if(lq)return LT;lq=1,Object.defineProperty(LT,"__esModule",{value:!0}),LT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","group"]]},e=t;return LT.default=e,LT}var UT={},uq;function Rwe(){if(uq)return UT;uq=1,Object.defineProperty(UT,"__esModule",{value:!0}),UT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},e=t;return UT.default=e,UT}var BT={},fq;function Cwe(){if(fq)return BT;fq=1,Object.defineProperty(BT,"__esModule",{value:!0}),BT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},e=t;return BT.default=e,BT}var FT={},hq;function Awe(){if(hq)return FT;hq=1,Object.defineProperty(FT,"__esModule",{value:!0}),FT.default=void 0;var t={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-modal":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},e=t;return FT.default=e,FT}var dq;function Mwe(){if(dq)return CT;dq=1,Object.defineProperty(CT,"__esModule",{value:!0}),CT.default=void 0;var t=d(_we()),e=d(vwe()),n=d(ywe()),r=d(bwe()),i=d(Ewe()),s=d(Swe()),o=d(xwe()),a=d(Twe()),c=d(wwe()),l=d(Rwe()),u=d(Cwe()),h=d(Awe());function d(g){return g&&g.__esModule?g:{default:g}}var m=[["command",t.default],["composite",e.default],["input",n.default],["landmark",r.default],["range",i.default],["roletype",s.default],["section",o.default],["sectionhead",a.default],["select",c.default],["structure",l.default],["widget",u.default],["window",h.default]],p=m;return CT.default=p,CT}var jT={},zT={},pq;function kwe(){if(pq)return zT;pq=1,Object.defineProperty(zT,"__esModule",{value:!0}),zT.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"assertive"},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return zT.default=e,zT}var HT={},mq;function Owe(){if(mq)return HT;mq=1,Object.defineProperty(HT,"__esModule",{value:!0}),HT.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","alert"],["roletype","window","dialog"]]},e=t;return HT.default=e,HT}var qT={},gq;function Iwe(){if(gq)return qT;gq=1,Object.defineProperty(qT,"__esModule",{value:!0}),qT.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},e=t;return qT.default=e,qT}var VT={},_q;function Nwe(){if(_q)return VT;_q=1,Object.defineProperty(VT,"__esModule",{value:!0}),VT.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"article"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","document"]]},e=t;return VT.default=e,VT}var GT={},vq;function Pwe(){if(vq)return GT;vq=1,Object.defineProperty(GT,"__esModule",{value:!0}),GT.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["scoped to the body element"],name:"header"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return GT.default=e,GT}var $T={},yq;function Dwe(){if(yq)return $T;yq=1,Object.defineProperty($T,"__esModule",{value:!0}),$T.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"blockquote"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return $T.default=e,$T}var WT={},bq;function Lwe(){if(bq)return WT;bq=1,Object.defineProperty(WT,"__esModule",{value:!0}),WT.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-pressed":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"button"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"image"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"reset"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"submit"}],name:"input"},module:"HTML"},{concept:{name:"button"},module:"HTML"},{concept:{name:"trigger"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},e=t;return WT.default=e,WT}var KT={},Eq;function Uwe(){if(Eq)return KT;Eq=1,Object.defineProperty(KT,"__esModule",{value:!0}),KT.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"caption"},module:"HTML"}],requireContextRole:["figure","grid","table"],requiredContextRole:["figure","grid","table"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return KT.default=e,KT}var XT={},Sq;function Bwe(){if(Sq)return XT;Sq=1,Object.defineProperty(XT,"__esModule",{value:!0}),XT.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-colspan":null,"aria-rowindex":null,"aria-rowspan":null},relatedConcepts:[{concept:{constraints:["ancestor table element has table role"],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return XT.default=e,XT}var YT={},xq;function Fwe(){if(xq)return YT;xq=1,Object.defineProperty(YT,"__esModule",{value:!0}),YT.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"checkbox"}],name:"input"},module:"HTML"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]},e=t;return YT.default=e,YT}var ZT={},Tq;function jwe(){if(Tq)return ZT;Tq=1,Object.defineProperty(ZT,"__esModule",{value:!0}),ZT.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"code"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return ZT.default=e,ZT}var JT={},wq;function zwe(){if(wq)return JT;wq=1,Object.defineProperty(JT,"__esModule",{value:!0}),JT.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{concept:{name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"col"}],name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"colgroup"}],name:"th"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]},e=t;return JT.default=e,JT}var QT={},Rq;function Hwe(){if(Rq)return QT;Rq=1,Object.defineProperty(QT,"__esModule",{value:!0}),QT.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-expanded":"false","aria-haspopup":"listbox"},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"email"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"search"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"tel"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"text"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"multiple"},{constraints:["undefined"],name:"size"}],constraints:["the multiple attribute is not set and the size attribute does not have a value greater than 1"],name:"select"},module:"HTML"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-expanded":"false"},superClass:[["roletype","widget","input"]]},e=t;return QT.default=e,QT}var ew={},Cq;function qwe(){if(Cq)return ew;Cq=1,Object.defineProperty(ew,"__esModule",{value:!0}),ew.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"aside"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-label"}],constraints:["scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"aside"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],constraints:["scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"aside"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return ew.default=e,ew}var tw={},Aq;function Vwe(){if(Aq)return tw;Aq=1,Object.defineProperty(tw,"__esModule",{value:!0}),tw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["scoped to the body element"],name:"footer"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return tw.default=e,tw}var nw={},Mq;function Gwe(){if(Mq)return nw;Mq=1,Object.defineProperty(nw,"__esModule",{value:!0}),nw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dd"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return nw.default=e,nw}var rw={},kq;function $we(){if(kq)return rw;kq=1,Object.defineProperty(rw,"__esModule",{value:!0}),rw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"del"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return rw.default=e,rw}var iw={},Oq;function Wwe(){if(Oq)return iw;Oq=1,Object.defineProperty(iw,"__esModule",{value:!0}),iw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dialog"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","window"]]},e=t;return iw.default=e,iw}var sw={},Iq;function Kwe(){if(Iq)return sw;Iq=1,Object.defineProperty(sw,"__esModule",{value:!0}),sw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{module:"DAISY Guide"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","list"]]},e=t;return sw.default=e,sw}var ow={},Nq;function Xwe(){if(Nq)return ow;Nq=1,Object.defineProperty(ow,"__esModule",{value:!0}),ow.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}},{concept:{name:"html"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},e=t;return ow.default=e,ow}var aw={},Pq;function Ywe(){if(Pq)return aw;Pq=1,Object.defineProperty(aw,"__esModule",{value:!0}),aw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"em"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return aw.default=e,aw}var cw={},Dq;function Zwe(){if(Dq)return cw;Dq=1,Object.defineProperty(cw,"__esModule",{value:!0}),cw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["article"]],requiredProps:{},superClass:[["roletype","structure","section","list"]]},e=t;return cw.default=e,cw}var lw={},Lq;function Jwe(){if(Lq)return lw;Lq=1,Object.defineProperty(lw,"__esModule",{value:!0}),lw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"figure"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return lw.default=e,lw}var uw={},Uq;function Qwe(){if(Uq)return uw;Uq=1,Object.defineProperty(uw,"__esModule",{value:!0}),uw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"name"}],name:"form"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return uw.default=e,uw}var fw={},Bq;function eRe(){if(Bq)return fw;Bq=1,Object.defineProperty(fw,"__esModule",{value:!0}),fw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"a"},module:"HTML"},{concept:{name:"area"},module:"HTML"},{concept:{name:"aside"},module:"HTML"},{concept:{name:"b"},module:"HTML"},{concept:{name:"bdo"},module:"HTML"},{concept:{name:"body"},module:"HTML"},{concept:{name:"data"},module:"HTML"},{concept:{name:"div"},module:"HTML"},{concept:{constraints:["scoped to the main element","scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"footer"},module:"HTML"},{concept:{constraints:["scoped to the main element","scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"header"},module:"HTML"},{concept:{name:"hgroup"},module:"HTML"},{concept:{name:"i"},module:"HTML"},{concept:{name:"pre"},module:"HTML"},{concept:{name:"q"},module:"HTML"},{concept:{name:"samp"},module:"HTML"},{concept:{name:"section"},module:"HTML"},{concept:{name:"small"},module:"HTML"},{concept:{name:"span"},module:"HTML"},{concept:{name:"u"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},e=t;return fw.default=e,fw}var hw={},Fq;function tRe(){if(Fq)return hw;Fq=1,Object.defineProperty(hw,"__esModule",{value:!0}),hw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-multiselectable":null,"aria-readonly":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","table"]]},e=t;return hw.default=e,hw}var dw={},jq;function nRe(){if(jq)return dw;jq=1,Object.defineProperty(dw,"__esModule",{value:!0}),dw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-selected":null},relatedConcepts:[{concept:{constraints:["ancestor table element has grid role","ancestor table element has treegrid role"],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","widget"]]},e=t;return dw.default=e,dw}var pw={},zq;function rRe(){if(zq)return pw;zq=1,Object.defineProperty(pw,"__esModule",{value:!0}),pw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[{concept:{name:"details"},module:"HTML"},{concept:{name:"fieldset"},module:"HTML"},{concept:{name:"optgroup"},module:"HTML"},{concept:{name:"address"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return pw.default=e,pw}var mw={},Hq;function iRe(){if(Hq)return mw;Hq=1,Object.defineProperty(mw,"__esModule",{value:!0}),mw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-level":"2"},relatedConcepts:[{concept:{name:"h1"},module:"HTML"},{concept:{name:"h2"},module:"HTML"},{concept:{name:"h3"},module:"HTML"},{concept:{name:"h4"},module:"HTML"},{concept:{name:"h5"},module:"HTML"},{concept:{name:"h6"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-level":"2"},superClass:[["roletype","structure","sectionhead"]]},e=t;return mw.default=e,mw}var gw={},qq;function sRe(){if(qq)return gw;qq=1,Object.defineProperty(gw,"__esModule",{value:!0}),gw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"alt"}],name:"img"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"alt"}],name:"img"},module:"HTML"},{concept:{name:"imggroup"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return gw.default=e,gw}var _w={},Vq;function oRe(){if(Vq)return _w;Vq=1,Object.defineProperty(_w,"__esModule",{value:!0}),_w.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"ins"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return _w.default=e,_w}var vw={},Gq;function aRe(){if(Gq)return vw;Gq=1,Object.defineProperty(vw,"__esModule",{value:!0}),vw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"href"}],name:"a"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"href"}],name:"area"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},e=t;return vw.default=e,vw}var yw={},$q;function cRe(){if($q)return yw;$q=1,Object.defineProperty(yw,"__esModule",{value:!0}),yw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menu"},module:"HTML"},{concept:{name:"ol"},module:"HTML"},{concept:{name:"ul"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["listitem"]],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return yw.default=e,yw}var bw={},Wq;function lRe(){if(Wq)return bw;Wq=1,Object.defineProperty(bw,"__esModule",{value:!0}),bw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-multiselectable":null,"aria-readonly":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[{concept:{attributes:[{constraints:[">1"],name:"size"}],constraints:["the size attribute value is greater than 1"],name:"select"},module:"HTML"},{concept:{attributes:[{name:"multiple"}],name:"select"},module:"HTML"},{concept:{name:"datalist"},module:"HTML"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["option","group"],["option"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},e=t;return bw.default=e,bw}var Ew={},Kq;function uRe(){if(Kq)return Ew;Kq=1,Object.defineProperty(Ew,"__esModule",{value:!0}),Ew.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{constraints:["direct descendant of ol","direct descendant of ul","direct descendant of menu"],name:"li"},module:"HTML"},{concept:{name:"item"},module:"XForms"}],requireContextRole:["directory","list"],requiredContextRole:["directory","list"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return Ew.default=e,Ew}var Sw={},Xq;function fRe(){if(Xq)return Sw;Xq=1,Object.defineProperty(Sw,"__esModule",{value:!0}),Sw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-live":"polite"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return Sw.default=e,Sw}var xw={},Yq;function hRe(){if(Yq)return xw;Yq=1,Object.defineProperty(xw,"__esModule",{value:!0}),xw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"main"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return xw.default=e,xw}var Tw={},Zq;function dRe(){if(Zq)return Tw;Zq=1,Object.defineProperty(Tw,"__esModule",{value:!0}),Tw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:[],props:{"aria-braillelabel":null,"aria-brailleroledescription":null,"aria-description":null},relatedConcepts:[{concept:{name:"mark"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return Tw.default=e,Tw}var ww={},Jq;function pRe(){if(Jq)return ww;Jq=1,Object.defineProperty(ww,"__esModule",{value:!0}),ww.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return ww.default=e,ww}var Rw={},Qq;function mRe(){if(Qq)return Rw;Qq=1,Object.defineProperty(Rw,"__esModule",{value:!0}),Rw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"math"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return Rw.default=e,Rw}var Cw={},eV;function gRe(){if(eV)return Cw;eV=1,Object.defineProperty(Cw,"__esModule",{value:!0}),Cw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"vertical"},relatedConcepts:[{concept:{name:"MENU"},module:"JAPI"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"},{concept:{name:"sidebar"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},e=t;return Cw.default=e,Cw}var Aw={},tV;function _Re(){if(tV)return Aw;tV=1,Object.defineProperty(Aw,"__esModule",{value:!0}),Aw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"toolbar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select","menu"],["roletype","structure","section","group","select","menu"]]},e=t;return Aw.default=e,Aw}var Mw={},nV;function vRe(){if(nV)return Mw;nV=1,Object.defineProperty(Mw,"__esModule",{value:!0}),Mw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"MENU_ITEM"},module:"JAPI"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},e=t;return Mw.default=e,Mw}var kw={},rV;function yRe(){if(rV)return kw;rV=1,Object.defineProperty(kw,"__esModule",{value:!0}),kw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"],["roletype","widget","command","menuitem"]]},e=t;return kw.default=e,kw}var Ow={},iV;function bRe(){if(iV)return Ow;iV=1,Object.defineProperty(Ow,"__esModule",{value:!0}),Ow.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox","menuitemcheckbox"],["roletype","widget","command","menuitem","menuitemcheckbox"],["roletype","widget","input","radio"]]},e=t;return Ow.default=e,Ow}var Iw={},sV;function ERe(){if(sV)return Iw;sV=1,Object.defineProperty(Iw,"__esModule",{value:!0}),Iw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null,"aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[{concept:{name:"meter"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","structure","range"]]},e=t;return Iw.default=e,Iw}var Nw={},oV;function SRe(){if(oV)return Nw;oV=1,Object.defineProperty(Nw,"__esModule",{value:!0}),Nw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"nav"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return Nw.default=e,Nw}var Pw={},aV;function xRe(){if(aV)return Pw;aV=1,Object.defineProperty(Pw,"__esModule",{value:!0}),Pw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]},e=t;return Pw.default=e,Pw}var Dw={},cV;function TRe(){if(cV)return Dw;cV=1,Object.defineProperty(Dw,"__esModule",{value:!0}),Dw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return Dw.default=e,Dw}var Lw={},lV;function wRe(){if(lV)return Lw;lV=1,Object.defineProperty(Lw,"__esModule",{value:!0}),Lw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[{concept:{name:"item"},module:"XForms"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"option"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-selected":"false"},superClass:[["roletype","widget","input"]]},e=t;return Lw.default=e,Lw}var Uw={},uV;function RRe(){if(uV)return Uw;uV=1,Object.defineProperty(Uw,"__esModule",{value:!0}),Uw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"p"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return Uw.default=e,Uw}var Bw={},fV;function CRe(){if(fV)return Bw;fV=1,Object.defineProperty(Bw,"__esModule",{value:!0}),Bw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{attributes:[{name:"alt",value:""}],name:"img"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},e=t;return Bw.default=e,Bw}var Fw={},hV;function ARe(){if(hV)return Fw;hV=1,Object.defineProperty(Fw,"__esModule",{value:!0}),Fw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null},relatedConcepts:[{concept:{name:"progress"},module:"HTML"},{concept:{name:"status"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","range"],["roletype","widget"]]},e=t;return Fw.default=e,Fw}var jw={},dV;function MRe(){if(dV)return jw;dV=1,Object.defineProperty(jw,"__esModule",{value:!0}),jw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"radio"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]},e=t;return jw.default=e,jw}var zw={},pV;function kRe(){if(pV)return zw;pV=1,Object.defineProperty(zw,"__esModule",{value:!0}),zw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{name:"list"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["radio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},e=t;return zw.default=e,zw}var Hw={},mV;function ORe(){if(mV)return Hw;mV=1,Object.defineProperty(Hw,"__esModule",{value:!0}),Hw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"section"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"section"},module:"HTML"},{concept:{name:"Device Independence Glossart perceivable unit"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return Hw.default=e,Hw}var qw={},gV;function IRe(){if(gV)return qw;gV=1,Object.defineProperty(qw,"__esModule",{value:!0}),qw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-expanded":null,"aria-level":null,"aria-posinset":null,"aria-rowindex":null,"aria-selected":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"tr"},module:"HTML"}],requireContextRole:["grid","rowgroup","table","treegrid"],requiredContextRole:["grid","rowgroup","table","treegrid"],requiredOwnedElements:[["cell"],["columnheader"],["gridcell"],["rowheader"]],requiredProps:{},superClass:[["roletype","structure","section","group"],["roletype","widget"]]},e=t;return qw.default=e,qw}var Vw={},_V;function NRe(){if(_V)return Vw;_V=1,Object.defineProperty(Vw,"__esModule",{value:!0}),Vw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"tbody"},module:"HTML"},{concept:{name:"tfoot"},module:"HTML"},{concept:{name:"thead"},module:"HTML"}],requireContextRole:["grid","table","treegrid"],requiredContextRole:["grid","table","treegrid"],requiredOwnedElements:[["row"]],requiredProps:{},superClass:[["roletype","structure"]]},e=t;return Vw.default=e,Vw}var Gw={},vV;function PRe(){if(vV)return Gw;vV=1,Object.defineProperty(Gw,"__esModule",{value:!0}),Gw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{concept:{attributes:[{name:"scope",value:"row"}],name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"rowgroup"}],name:"th"},module:"HTML"}],requireContextRole:["row","rowgroup"],requiredContextRole:["row","rowgroup"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]},e=t;return Gw.default=e,Gw}var $w={},yV;function DRe(){if(yV)return $w;yV=1,Object.defineProperty($w,"__esModule",{value:!0}),$w.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-valuetext":null,"aria-orientation":"vertical","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-valuenow":null},superClass:[["roletype","structure","range"],["roletype","widget"]]},e=t;return $w.default=e,$w}var Ww={},bV;function LRe(){if(bV)return Ww;bV=1,Object.defineProperty(Ww,"__esModule",{value:!0}),Ww.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return Ww.default=e,Ww}var Kw={},EV;function URe(){if(EV)return Kw;EV=1,Object.defineProperty(Kw,"__esModule",{value:!0}),Kw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"search"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input","textbox"]]},e=t;return Kw.default=e,Kw}var Xw={},SV;function BRe(){if(SV)return Xw;SV=1,Object.defineProperty(Xw,"__esModule",{value:!0}),Xw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0","aria-valuenow":null,"aria-valuetext":null},relatedConcepts:[{concept:{name:"hr"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},e=t;return Xw.default=e,Xw}var Yw={},xV;function FRe(){if(xV)return Yw;xV=1,Object.defineProperty(Yw,"__esModule",{value:!0}),Yw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-valuetext":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"range"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","widget","input"],["roletype","structure","range"]]},e=t;return Yw.default=e,Yw}var Zw={},TV;function jRe(){if(TV)return Zw;TV=1,Object.defineProperty(Zw,"__esModule",{value:!0}),Zw.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-valuetext":null,"aria-valuenow":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"number"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","widget","input"],["roletype","structure","range"]]},e=t;return Zw.default=e,Zw}var Jw={},wV;function zRe(){if(wV)return Jw;wV=1,Object.defineProperty(Jw,"__esModule",{value:!0}),Jw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"polite"},relatedConcepts:[{concept:{name:"output"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return Jw.default=e,Jw}var Qw={},RV;function HRe(){if(RV)return Qw;RV=1,Object.defineProperty(Qw,"__esModule",{value:!0}),Qw.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"strong"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return Qw.default=e,Qw}var eR={},CV;function qRe(){if(CV)return eR;CV=1,Object.defineProperty(eR,"__esModule",{value:!0}),eR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"sub"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return eR.default=e,eR}var tR={},AV;function VRe(){if(AV)return tR;AV=1,Object.defineProperty(tR,"__esModule",{value:!0}),tR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"sup"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return tR.default=e,tR}var nR={},MV;function GRe(){if(MV)return nR;MV=1,Object.defineProperty(nR,"__esModule",{value:!0}),nR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"button"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"]]},e=t;return nR.default=e,nR}var rR={},kV;function $Re(){if(kV)return rR;kV=1,Object.defineProperty(rR,"__esModule",{value:!0}),rR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[],requireContextRole:["tablist"],requiredContextRole:["tablist"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"],["roletype","widget"]]},e=t;return rR.default=e,rR}var iR={},OV;function WRe(){if(OV)return iR;OV=1,Object.defineProperty(iR,"__esModule",{value:!0}),iR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-colcount":null,"aria-rowcount":null},relatedConcepts:[{concept:{name:"table"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return iR.default=e,iR}var sR={},IV;function KRe(){if(IV)return sR;IV=1,Object.defineProperty(sR,"__esModule",{value:!0}),sR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-multiselectable":null,"aria-orientation":"horizontal"},relatedConcepts:[{module:"DAISY",concept:{name:"guide"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["tab"]],requiredProps:{},superClass:[["roletype","widget","composite"]]},e=t;return sR.default=e,sR}var oR={},NV;function XRe(){if(NV)return oR;NV=1,Object.defineProperty(oR,"__esModule",{value:!0}),oR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return oR.default=e,oR}var aR={},PV;function YRe(){if(PV)return aR;PV=1,Object.defineProperty(aR,"__esModule",{value:!0}),aR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dfn"},module:"HTML"},{concept:{name:"dt"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return aR.default=e,aR}var cR={},DV;function ZRe(){if(DV)return cR;DV=1,Object.defineProperty(cR,"__esModule",{value:!0}),cR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-multiline":null,"aria-placeholder":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"type"},{constraints:["undefined"],name:"list"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"email"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"tel"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"text"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"url"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{name:"input"},module:"XForms"},{concept:{name:"textarea"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input"]]},e=t;return cR.default=e,cR}var lR={},LV;function JRe(){if(LV)return lR;LV=1,Object.defineProperty(lR,"__esModule",{value:!0}),lR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"time"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return lR.default=e,lR}var uR={},UV;function QRe(){if(UV)return uR;UV=1,Object.defineProperty(uR,"__esModule",{value:!0}),uR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","status"]]},e=t;return uR.default=e,uR}var fR={},BV;function eCe(){if(BV)return fR;BV=1,Object.defineProperty(fR,"__esModule",{value:!0}),fR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"menubar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","group"]]},e=t;return fR.default=e,fR}var hR={},FV;function tCe(){if(FV)return hR;FV=1,Object.defineProperty(hR,"__esModule",{value:!0}),hR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return hR.default=e,hR}var dR={},jV;function nCe(){if(jV)return dR;jV=1,Object.defineProperty(dR,"__esModule",{value:!0}),dR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-multiselectable":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["treeitem","group"],["treeitem"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},e=t;return dR.default=e,dR}var pR={},zV;function rCe(){if(zV)return pR;zV=1,Object.defineProperty(pR,"__esModule",{value:!0}),pR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite","grid"],["roletype","structure","section","table","grid"],["roletype","widget","composite","select","tree"],["roletype","structure","section","group","select","tree"]]},e=t;return pR.default=e,pR}var mR={},HV;function iCe(){if(HV)return mR;HV=1,Object.defineProperty(mR,"__esModule",{value:!0}),mR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[],requireContextRole:["group","tree"],requiredContextRole:["group","tree"],requiredOwnedElements:[],requiredProps:{"aria-selected":null},superClass:[["roletype","structure","section","listitem"],["roletype","widget","input","option"]]},e=t;return mR.default=e,mR}var qV;function sCe(){if(qV)return jT;qV=1,Object.defineProperty(jT,"__esModule",{value:!0}),jT.default=void 0;var t=nt(kwe()),e=nt(Owe()),n=nt(Iwe()),r=nt(Nwe()),i=nt(Pwe()),s=nt(Dwe()),o=nt(Lwe()),a=nt(Uwe()),c=nt(Bwe()),l=nt(Fwe()),u=nt(jwe()),h=nt(zwe()),d=nt(Hwe()),m=nt(qwe()),p=nt(Vwe()),g=nt(Gwe()),y=nt($we()),v=nt(Wwe()),x=nt(Kwe()),E=nt(Xwe()),C=nt(Ywe()),A=nt(Zwe()),k=nt(Jwe()),M=nt(Qwe()),I=nt(eRe()),z=nt(tRe()),H=nt(nRe()),K=nt(rRe()),P=nt(iRe()),F=nt(sRe()),N=nt(oRe()),X=nt(aRe()),G=nt(cRe()),j=nt(lRe()),q=nt(uRe()),te=nt(fRe()),W=nt(hRe()),$=nt(dRe()),J=nt(pRe()),ne=nt(mRe()),ie=nt(gRe()),ae=nt(_Re()),xe=nt(vRe()),Ne=nt(yRe()),Re=nt(bRe()),Se=nt(ERe()),ze=nt(SRe()),Be=nt(xRe()),Je=nt(TRe()),at=nt(wRe()),re=nt(RRe()),Le=nt(CRe()),He=nt(ARe()),Ue=nt(MRe()),De=nt(kRe()),fe=nt(ORe()),ve=nt(IRe()),Ae=nt(NRe()),pe=nt(PRe()),Ge=nt(DRe()),Qe=nt(LRe()),Ze=nt(URe()),tt=nt(BRe()),Ft=nt(FRe()),bt=nt(jRe()),Mt=nt(zRe()),Ie=nt(HRe()),ce=nt(qRe()),Q=nt(VRe()),le=nt(GRe()),we=nt($Re()),Me=nt(WRe()),Te=nt(KRe()),ye=nt(XRe()),Ye=nt(YRe()),Pe=nt(ZRe()),We=nt(JRe()),Ve=nt(QRe()),Xe=nt(eCe()),lt=nt(tCe()),qe=nt(nCe()),rt=nt(rCe()),it=nt(iCe());function nt(tn){return tn&&tn.__esModule?tn:{default:tn}}var ct=[["alert",t.default],["alertdialog",e.default],["application",n.default],["article",r.default],["banner",i.default],["blockquote",s.default],["button",o.default],["caption",a.default],["cell",c.default],["checkbox",l.default],["code",u.default],["columnheader",h.default],["combobox",d.default],["complementary",m.default],["contentinfo",p.default],["definition",g.default],["deletion",y.default],["dialog",v.default],["directory",x.default],["document",E.default],["emphasis",C.default],["feed",A.default],["figure",k.default],["form",M.default],["generic",I.default],["grid",z.default],["gridcell",H.default],["group",K.default],["heading",P.default],["img",F.default],["insertion",N.default],["link",X.default],["list",G.default],["listbox",j.default],["listitem",q.default],["log",te.default],["main",W.default],["mark",$.default],["marquee",J.default],["math",ne.default],["menu",ie.default],["menubar",ae.default],["menuitem",xe.default],["menuitemcheckbox",Ne.default],["menuitemradio",Re.default],["meter",Se.default],["navigation",ze.default],["none",Be.default],["note",Je.default],["option",at.default],["paragraph",re.default],["presentation",Le.default],["progressbar",He.default],["radio",Ue.default],["radiogroup",De.default],["region",fe.default],["row",ve.default],["rowgroup",Ae.default],["rowheader",pe.default],["scrollbar",Ge.default],["search",Qe.default],["searchbox",Ze.default],["separator",tt.default],["slider",Ft.default],["spinbutton",bt.default],["status",Mt.default],["strong",Ie.default],["subscript",ce.default],["superscript",Q.default],["switch",le.default],["tab",we.default],["table",Me.default],["tablist",Te.default],["tabpanel",ye.default],["term",Ye.default],["textbox",Pe.default],["time",We.default],["timer",Ve.default],["toolbar",Xe.default],["tooltip",lt.default],["tree",qe.default],["treegrid",rt.default],["treeitem",it.default]],Qt=ct;return jT.default=Qt,jT}var gR={},_R={},VV;function oCe(){if(VV)return _R;VV=1,Object.defineProperty(_R,"__esModule",{value:!0}),_R.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"abstract [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return _R.default=e,_R}var vR={},GV;function aCe(){if(GV)return vR;GV=1,Object.defineProperty(vR,"__esModule",{value:!0}),vR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"acknowledgments [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return vR.default=e,vR}var yR={},$V;function cCe(){if($V)return yR;$V=1,Object.defineProperty(yR,"__esModule",{value:!0}),yR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"afterword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return yR.default=e,yR}var bR={},WV;function lCe(){if(WV)return bR;WV=1,Object.defineProperty(bR,"__esModule",{value:!0}),bR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"appendix [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return bR.default=e,bR}var ER={},KV;function uCe(){if(KV)return ER;KV=1,Object.defineProperty(ER,"__esModule",{value:!0}),ER.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"referrer [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},e=t;return ER.default=e,ER}var SR={},XV;function fCe(){if(XV)return SR;XV=1,Object.defineProperty(SR,"__esModule",{value:!0}),SR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"EPUB biblioentry [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-bibliography"],requiredContextRole:["doc-bibliography"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]},e=t;return SR.default=e,SR}var xR={},YV;function hCe(){if(YV)return xR;YV=1,Object.defineProperty(xR,"__esModule",{value:!0}),xR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"bibliography [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-biblioentry"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return xR.default=e,xR}var TR={},ZV;function dCe(){if(ZV)return TR;ZV=1,Object.defineProperty(TR,"__esModule",{value:!0}),TR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"biblioref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},e=t;return TR.default=e,TR}var wR={},JV;function pCe(){if(JV)return wR;JV=1,Object.defineProperty(wR,"__esModule",{value:!0}),wR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"chapter [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return wR.default=e,wR}var RR={},QV;function mCe(){if(QV)return RR;QV=1,Object.defineProperty(RR,"__esModule",{value:!0}),RR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"colophon [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return RR.default=e,RR}var CR={},eG;function gCe(){if(eG)return CR;eG=1,Object.defineProperty(CR,"__esModule",{value:!0}),CR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"conclusion [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return CR.default=e,CR}var AR={},tG;function _Ce(){if(tG)return AR;tG=1,Object.defineProperty(AR,"__esModule",{value:!0}),AR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"cover [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","img"]]},e=t;return AR.default=e,AR}var MR={},nG;function vCe(){if(nG)return MR;nG=1,Object.defineProperty(MR,"__esModule",{value:!0}),MR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credit [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return MR.default=e,MR}var kR={},rG;function yCe(){if(rG)return kR;rG=1,Object.defineProperty(kR,"__esModule",{value:!0}),kR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credits [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return kR.default=e,kR}var OR={},iG;function bCe(){if(iG)return OR;iG=1,Object.defineProperty(OR,"__esModule",{value:!0}),OR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"dedication [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return OR.default=e,OR}var IR={},sG;function ECe(){if(sG)return IR;sG=1,Object.defineProperty(IR,"__esModule",{value:!0}),IR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-endnotes"],requiredContextRole:["doc-endnotes"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]},e=t;return IR.default=e,IR}var NR={},oG;function SCe(){if(oG)return NR;oG=1,Object.defineProperty(NR,"__esModule",{value:!0}),NR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnotes [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-endnote"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return NR.default=e,NR}var PR={},aG;function xCe(){if(aG)return PR;aG=1,Object.defineProperty(PR,"__esModule",{value:!0}),PR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epigraph [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return PR.default=e,PR}var DR={},cG;function TCe(){if(cG)return DR;cG=1,Object.defineProperty(DR,"__esModule",{value:!0}),DR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epilogue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return DR.default=e,DR}var LR={},lG;function wCe(){if(lG)return LR;lG=1,Object.defineProperty(LR,"__esModule",{value:!0}),LR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"errata [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return LR.default=e,LR}var UR={},uG;function RCe(){if(uG)return UR;uG=1,Object.defineProperty(UR,"__esModule",{value:!0}),UR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return UR.default=e,UR}var BR={},fG;function CCe(){if(fG)return BR;fG=1,Object.defineProperty(BR,"__esModule",{value:!0}),BR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"footnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return BR.default=e,BR}var FR={},hG;function ACe(){if(hG)return FR;hG=1,Object.defineProperty(FR,"__esModule",{value:!0}),FR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"foreword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return FR.default=e,FR}var jR={},dG;function MCe(){if(dG)return jR;dG=1,Object.defineProperty(jR,"__esModule",{value:!0}),jR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossary [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["definition"],["term"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return jR.default=e,jR}var zR={},pG;function kCe(){if(pG)return zR;pG=1,Object.defineProperty(zR,"__esModule",{value:!0}),zR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},e=t;return zR.default=e,zR}var HR={},mG;function OCe(){if(mG)return HR;mG=1,Object.defineProperty(HR,"__esModule",{value:!0}),HR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"index [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},e=t;return HR.default=e,HR}var qR={},gG;function ICe(){if(gG)return qR;gG=1,Object.defineProperty(qR,"__esModule",{value:!0}),qR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"introduction [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return qR.default=e,qR}var VR={},_G;function NCe(){if(_G)return VR;_G=1,Object.defineProperty(VR,"__esModule",{value:!0}),VR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"noteref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},e=t;return VR.default=e,VR}var GR={},vG;function PCe(){if(vG)return GR;vG=1,Object.defineProperty(GR,"__esModule",{value:!0}),GR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"notice [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]},e=t;return GR.default=e,GR}var $R={},yG;function DCe(){if(yG)return $R;yG=1,Object.defineProperty($R,"__esModule",{value:!0}),$R.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"pagebreak [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","separator"]]},e=t;return $R.default=e,$R}var WR={},bG;function LCe(){if(bG)return WR;bG=1,Object.defineProperty(WR,"__esModule",{value:!0}),WR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"page-list [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},e=t;return WR.default=e,WR}var KR={},EG;function UCe(){if(EG)return KR;EG=1,Object.defineProperty(KR,"__esModule",{value:!0}),KR.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"part [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return KR.default=e,KR}var XR={},SG;function BCe(){if(SG)return XR;SG=1,Object.defineProperty(XR,"__esModule",{value:!0}),XR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"preface [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return XR.default=e,XR}var YR={},xG;function FCe(){if(xG)return YR;xG=1,Object.defineProperty(YR,"__esModule",{value:!0}),YR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"prologue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},e=t;return YR.default=e,YR}var ZR={},TG;function jCe(){if(TG)return ZR;TG=1,Object.defineProperty(ZR,"__esModule",{value:!0}),ZR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"pullquote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["none"]]},e=t;return ZR.default=e,ZR}var JR={},wG;function zCe(){if(wG)return JR;wG=1,Object.defineProperty(JR,"__esModule",{value:!0}),JR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"qna [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},e=t;return JR.default=e,JR}var QR={},RG;function HCe(){if(RG)return QR;RG=1,Object.defineProperty(QR,"__esModule",{value:!0}),QR.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"subtitle [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"]]},e=t;return QR.default=e,QR}var eC={},CG;function qCe(){if(CG)return eC;CG=1,Object.defineProperty(eC,"__esModule",{value:!0}),eC.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"help [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]},e=t;return eC.default=e,eC}var tC={},AG;function VCe(){if(AG)return tC;AG=1,Object.defineProperty(tC,"__esModule",{value:!0}),tC.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"toc [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},e=t;return tC.default=e,tC}var MG;function GCe(){if(MG)return gR;MG=1,Object.defineProperty(gR,"__esModule",{value:!0}),gR.default=void 0;var t=ne(oCe()),e=ne(aCe()),n=ne(cCe()),r=ne(lCe()),i=ne(uCe()),s=ne(fCe()),o=ne(hCe()),a=ne(dCe()),c=ne(pCe()),l=ne(mCe()),u=ne(gCe()),h=ne(_Ce()),d=ne(vCe()),m=ne(yCe()),p=ne(bCe()),g=ne(ECe()),y=ne(SCe()),v=ne(xCe()),x=ne(TCe()),E=ne(wCe()),C=ne(RCe()),A=ne(CCe()),k=ne(ACe()),M=ne(MCe()),I=ne(kCe()),z=ne(OCe()),H=ne(ICe()),K=ne(NCe()),P=ne(PCe()),F=ne(DCe()),N=ne(LCe()),X=ne(UCe()),G=ne(BCe()),j=ne(FCe()),q=ne(jCe()),te=ne(zCe()),W=ne(HCe()),$=ne(qCe()),J=ne(VCe());function ne(xe){return xe&&xe.__esModule?xe:{default:xe}}var ie=[["doc-abstract",t.default],["doc-acknowledgments",e.default],["doc-afterword",n.default],["doc-appendix",r.default],["doc-backlink",i.default],["doc-biblioentry",s.default],["doc-bibliography",o.default],["doc-biblioref",a.default],["doc-chapter",c.default],["doc-colophon",l.default],["doc-conclusion",u.default],["doc-cover",h.default],["doc-credit",d.default],["doc-credits",m.default],["doc-dedication",p.default],["doc-endnote",g.default],["doc-endnotes",y.default],["doc-epigraph",v.default],["doc-epilogue",x.default],["doc-errata",E.default],["doc-example",C.default],["doc-footnote",A.default],["doc-foreword",k.default],["doc-glossary",M.default],["doc-glossref",I.default],["doc-index",z.default],["doc-introduction",H.default],["doc-noteref",K.default],["doc-notice",P.default],["doc-pagebreak",F.default],["doc-pagelist",N.default],["doc-part",X.default],["doc-preface",G.default],["doc-prologue",j.default],["doc-pullquote",q.default],["doc-qna",te.default],["doc-subtitle",W.default],["doc-tip",$.default],["doc-toc",J.default]],ae=ie;return gR.default=ae,gR}var nC={},rC={},kG;function $Ce(){if(kG)return rC;kG=1,Object.defineProperty(rC,"__esModule",{value:!0}),rC.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{module:"GRAPHICS",concept:{name:"graphics-object"}},{module:"ARIA",concept:{name:"img"}},{module:"ARIA",concept:{name:"article"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","document"]]},e=t;return rC.default=e,rC}var iC={},OG;function WCe(){if(OG)return iC;OG=1,Object.defineProperty(iC,"__esModule",{value:!0}),iC.default=void 0;var t={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{module:"GRAPHICS",concept:{name:"graphics-document"}},{module:"ARIA",concept:{name:"group"}},{module:"ARIA",concept:{name:"img"}},{module:"GRAPHICS",concept:{name:"graphics-symbol"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","group"]]},e=t;return iC.default=e,iC}var sC={},IG;function KCe(){if(IG)return sC;IG=1,Object.defineProperty(sC,"__esModule",{value:!0}),sC.default=void 0;var t={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","img"]]},e=t;return sC.default=e,sC}var NG;function XCe(){if(NG)return nC;NG=1,Object.defineProperty(nC,"__esModule",{value:!0}),nC.default=void 0;var t=r($Ce()),e=r(WCe()),n=r(KCe());function r(o){return o&&o.__esModule?o:{default:o}}var i=[["graphics-document",t.default],["graphics-object",e.default],["graphics-symbol",n.default]],s=i;return nC.default=s,nC}var PG;function R8(){if(PG)return RT;PG=1,Object.defineProperty(RT,"__esModule",{value:!0}),RT.default=void 0;var t=s(Mwe()),e=s(sCe()),n=s(GCe()),r=s(XCe()),i=s(wM());function s(v){return v&&v.__esModule?v:{default:v}}function o(v,x,E){return x in v?Object.defineProperty(v,x,{value:E,enumerable:!0,configurable:!0,writable:!0}):v[x]=E,v}function a(v,x){var E=typeof Symbol<"u"&&v[Symbol.iterator]||v["@@iterator"];if(!E){if(Array.isArray(v)||(E=u(v))||x){E&&(v=E);var C=0,A=function(){};return{s:A,n:function(){return C>=v.length?{done:!0}:{done:!1,value:v[C++]}},e:function(H){throw H},f:A}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var k=!0,M=!1,I;return{s:function(){E=E.call(v)},n:function(){var H=E.next();return k=H.done,H},e:function(H){M=!0,I=H},f:function(){try{!k&&E.return!=null&&E.return()}finally{if(M)throw I}}}}function c(v,x){return m(v)||d(v,x)||u(v,x)||l()}function l(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function u(v,x){if(v){if(typeof v=="string")return h(v,x);var E=Object.prototype.toString.call(v).slice(8,-1);if(E==="Object"&&v.constructor&&(E=v.constructor.name),E==="Map"||E==="Set")return Array.from(v);if(E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E))return h(v,x)}}function h(v,x){(x==null||x>v.length)&&(x=v.length);for(var E=0,C=new Array(x);E<x;E++)C[E]=v[E];return C}function d(v,x){var E=v==null?null:typeof Symbol<"u"&&v[Symbol.iterator]||v["@@iterator"];if(E!=null){var C=[],A=!0,k=!1,M,I;try{for(E=E.call(v);!(A=(M=E.next()).done)&&(C.push(M.value),!(x&&C.length===x));A=!0);}catch(z){k=!0,I=z}finally{try{!A&&E.return!=null&&E.return()}finally{if(k)throw I}}return C}}function m(v){if(Array.isArray(v))return v}var p=[].concat(t.default,e.default,n.default,r.default);p.forEach(function(v){var x=c(v,2),E=x[1],C=a(E.superClass),A;try{for(C.s();!(A=C.n()).done;){var k=A.value,M=a(k),I;try{var z=function(){var K=I.value,P=p.find(function(j){var q=c(j,1),te=q[0];return te===K});if(P)for(var F=P[1],N=0,X=Object.keys(F.props);N<X.length;N++){var G=X[N];Object.prototype.hasOwnProperty.call(E.props,G)||Object.assign(E.props,o({},G,F.props[G]))}};for(M.s();!(I=M.n()).done;)z()}catch(H){M.e(H)}finally{M.f()}}}catch(H){C.e(H)}finally{C.f()}});var g={entries:function(){return p},forEach:function(x){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,C=a(p),A;try{for(C.s();!(A=C.n()).done;){var k=c(A.value,2),M=k[0],I=k[1];x.call(E,I,M,p)}}catch(z){C.e(z)}finally{C.f()}},get:function(x){var E=p.find(function(C){return C[0]===x});return E&&E[1]},has:function(x){return!!g.get(x)},keys:function(){return p.map(function(x){var E=c(x,1),C=E[0];return C})},values:function(){return p.map(function(x){var E=c(x,2),C=E[1];return C})}},y=(0,i.default)(g,g.entries());return RT.default=y,RT}var oC={},tL={},DG;function YCe(){if(DG)return tL;DG=1;var t=Object.prototype.hasOwnProperty;function e(n,r){var i,s;if(n===r)return!0;if(n&&r&&(i=n.constructor)===r.constructor){if(i===Date)return n.getTime()===r.getTime();if(i===RegExp)return n.toString()===r.toString();if(i===Array){if((s=n.length)===r.length)for(;s--&&e(n[s],r[s]););return s===-1}if(!i||typeof n=="object"){s=0;for(i in n)if(t.call(n,i)&&++s&&!t.call(r,i)||!(i in r)||!e(n[i],r[i]))return!1;return Object.keys(r).length===s}}return n!==n&&r!==r}return tL.dequal=e,tL}var LG;function ZCe(){if(LG)return oC;LG=1,Object.defineProperty(oC,"__esModule",{value:!0}),oC.default=void 0;var t=YCe(),e=r(wM()),n=r(R8());function r(A){return A&&A.__esModule?A:{default:A}}function i(A,k){return a(A)||o(A,k)||l(A,k)||s()}function s(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function o(A,k){var M=A==null?null:typeof Symbol<"u"&&A[Symbol.iterator]||A["@@iterator"];if(M!=null){var I=[],z=!0,H=!1,K,P;try{for(M=M.call(A);!(z=(K=M.next()).done)&&(I.push(K.value),!(k&&I.length===k));z=!0);}catch(F){H=!0,P=F}finally{try{!z&&M.return!=null&&M.return()}finally{if(H)throw P}}return I}}function a(A){if(Array.isArray(A))return A}function c(A,k){var M=typeof Symbol<"u"&&A[Symbol.iterator]||A["@@iterator"];if(!M){if(Array.isArray(A)||(M=l(A))||k){M&&(A=M);var I=0,z=function(){};return{s:z,n:function(){return I>=A.length?{done:!0}:{done:!1,value:A[I++]}},e:function(N){throw N},f:z}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var H=!0,K=!1,P;return{s:function(){M=M.call(A)},n:function(){var N=M.next();return H=N.done,N},e:function(N){K=!0,P=N},f:function(){try{!H&&M.return!=null&&M.return()}finally{if(K)throw P}}}}function l(A,k){if(A){if(typeof A=="string")return u(A,k);var M=Object.prototype.toString.call(A).slice(8,-1);if(M==="Object"&&A.constructor&&(M=A.constructor.name),M==="Map"||M==="Set")return Array.from(A);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return u(A,k)}}function u(A,k){(k==null||k>A.length)&&(k=A.length);for(var M=0,I=new Array(k);M<k;M++)I[M]=A[M];return I}for(var h=[],d=n.default.keys(),m=0;m<d.length;m++){var p=d[m],g=n.default.get(p);if(g)for(var y=[].concat(g.baseConcepts,g.relatedConcepts),v=0;v<y.length;v++){var x=y[v];x.module==="HTML"&&(function(){var A=x.concept;if(A){var k=h.find(function(H){return(0,t.dequal)(H,A)}),M;k?M=k[1]:M=[];for(var I=!0,z=0;z<M.length;z++)if(M[z]===p){I=!1;break}I&&M.push(p),h.push([A,M])}})()}}var E={entries:function(){return h},forEach:function(k){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,I=c(h),z;try{for(I.s();!(z=I.n()).done;){var H=i(z.value,2),K=H[0],P=H[1];k.call(M,P,K,h)}}catch(F){I.e(F)}finally{I.f()}},get:function(k){var M=h.find(function(I){return k.name===I[0].name&&(0,t.dequal)(k.attributes,I[0].attributes)});return M&&M[1]},has:function(k){return!!E.get(k)},keys:function(){return h.map(function(k){var M=i(k,1),I=M[0];return I})},values:function(){return h.map(function(k){var M=i(k,2),I=M[1];return I})}},C=(0,e.default)(E,E.entries());return oC.default=C,oC}var aC={},UG;function JCe(){if(UG)return aC;UG=1,Object.defineProperty(aC,"__esModule",{value:!0}),aC.default=void 0;var t=n(wM()),e=n(R8());function n(k){return k&&k.__esModule?k:{default:k}}function r(k,M){return o(k)||s(k,M)||c(k,M)||i()}function i(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s(k,M){var I=k==null?null:typeof Symbol<"u"&&k[Symbol.iterator]||k["@@iterator"];if(I!=null){var z=[],H=!0,K=!1,P,F;try{for(I=I.call(k);!(H=(P=I.next()).done)&&(z.push(P.value),!(M&&z.length===M));H=!0);}catch(N){K=!0,F=N}finally{try{!H&&I.return!=null&&I.return()}finally{if(K)throw F}}return z}}function o(k){if(Array.isArray(k))return k}function a(k,M){var I=typeof Symbol<"u"&&k[Symbol.iterator]||k["@@iterator"];if(!I){if(Array.isArray(k)||(I=c(k))||M){I&&(k=I);var z=0,H=function(){};return{s:H,n:function(){return z>=k.length?{done:!0}:{done:!1,value:k[z++]}},e:function(X){throw X},f:H}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var K=!0,P=!1,F;return{s:function(){I=I.call(k)},n:function(){var X=I.next();return K=X.done,X},e:function(X){P=!0,F=X},f:function(){try{!K&&I.return!=null&&I.return()}finally{if(P)throw F}}}}function c(k,M){if(k){if(typeof k=="string")return l(k,M);var I=Object.prototype.toString.call(k).slice(8,-1);if(I==="Object"&&k.constructor&&(I=k.constructor.name),I==="Map"||I==="Set")return Array.from(k);if(I==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(I))return l(k,M)}}function l(k,M){(M==null||M>k.length)&&(M=k.length);for(var I=0,z=new Array(M);I<M;I++)z[I]=k[I];return z}for(var u=[],h=e.default.keys(),d=0;d<h.length;d++){var m=h[d],p=e.default.get(m),g=[];if(p){for(var y=[].concat(p.baseConcepts,p.relatedConcepts),v=0;v<y.length;v++){var x=y[v];if(x.module==="HTML"){var E=x.concept;E!=null&&g.push(E)}}g.length>0&&u.push([m,g])}}var C={entries:function(){return u},forEach:function(M){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,z=a(u),H;try{for(z.s();!(H=z.n()).done;){var K=r(H.value,2),P=K[0],F=K[1];M.call(I,F,P,u)}}catch(N){z.e(N)}finally{z.f()}},get:function(M){var I=u.find(function(z){return z[0]===M});return I&&I[1]},has:function(M){return!!C.get(M)},keys:function(){return u.map(function(M){var I=r(M,1),z=I[0];return z})},values:function(){return u.map(function(M){var I=r(M,2),z=I[1];return z})}},A=(0,t.default)(C,C.entries());return aC.default=A,aC}var BG;function QCe(){if(BG)return kd;BG=1,Object.defineProperty(kd,"__esModule",{value:!0}),kd.roles=kd.roleElements=kd.elementRoles=kd.dom=kd.aria=void 0;var t=s(mwe()),e=s(gwe()),n=s(R8()),r=s(ZCe()),i=s(JCe());function s(h){return h&&h.__esModule?h:{default:h}}var o=t.default;kd.aria=o;var a=e.default;kd.dom=a;var c=n.default;kd.roles=c;var l=r.default;kd.elementRoles=l;var u=i.default;return kd.roleElements=u,kd}var jp=QCe(),nL={exports:{}},FG;function eAe(){return FG||(FG=1,(function(t){var e=(function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function o(c,l){if(!s[c]){s[c]={};for(var u=0;u<c.length;u++)s[c][c.charAt(u)]=u}return s[c][l]}var a={compressToBase64:function(c){if(c==null)return"";var l=a._compress(c,6,function(u){return r.charAt(u)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(l){return o(r,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(l){return n(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=a.compress(c),u=new Uint8Array(l.length*2),h=0,d=l.length;h<d;h++){var m=l.charCodeAt(h);u[h*2]=m>>>8,u[h*2+1]=m%256}return u},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var l=new Array(c.length/2),u=0,h=l.length;u<h;u++)l[u]=c[u*2]*256+c[u*2+1];var d=[];return l.forEach(function(m){d.push(n(m))}),a.decompress(d.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(l){return i.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(l){return o(i,c.charAt(l))}))},compress:function(c){return a._compress(c,16,function(l){return n(l)})},_compress:function(c,l,u){if(c==null)return"";var h,d,m={},p={},g="",y="",v="",x=2,E=3,C=2,A=[],k=0,M=0,I;for(I=0;I<c.length;I+=1)if(g=c.charAt(I),Object.prototype.hasOwnProperty.call(m,g)||(m[g]=E++,p[g]=!0),y=v+g,Object.prototype.hasOwnProperty.call(m,y))v=y;else{if(Object.prototype.hasOwnProperty.call(p,v)){if(v.charCodeAt(0)<256){for(h=0;h<C;h++)k=k<<1,M==l-1?(M=0,A.push(u(k)),k=0):M++;for(d=v.charCodeAt(0),h=0;h<8;h++)k=k<<1|d&1,M==l-1?(M=0,A.push(u(k)),k=0):M++,d=d>>1}else{for(d=1,h=0;h<C;h++)k=k<<1|d,M==l-1?(M=0,A.push(u(k)),k=0):M++,d=0;for(d=v.charCodeAt(0),h=0;h<16;h++)k=k<<1|d&1,M==l-1?(M=0,A.push(u(k)),k=0):M++,d=d>>1}x--,x==0&&(x=Math.pow(2,C),C++),delete p[v]}else for(d=m[v],h=0;h<C;h++)k=k<<1|d&1,M==l-1?(M=0,A.push(u(k)),k=0):M++,d=d>>1;x--,x==0&&(x=Math.pow(2,C),C++),m[y]=E++,v=String(g)}if(v!==""){if(Object.prototype.hasOwnProperty.call(p,v)){if(v.charCodeAt(0)<256){for(h=0;h<C;h++)k=k<<1,M==l-1?(M=0,A.push(u(k)),k=0):M++;for(d=v.charCodeAt(0),h=0;h<8;h++)k=k<<1|d&1,M==l-1?(M=0,A.push(u(k)),k=0):M++,d=d>>1}else{for(d=1,h=0;h<C;h++)k=k<<1|d,M==l-1?(M=0,A.push(u(k)),k=0):M++,d=0;for(d=v.charCodeAt(0),h=0;h<16;h++)k=k<<1|d&1,M==l-1?(M=0,A.push(u(k)),k=0):M++,d=d>>1}x--,x==0&&(x=Math.pow(2,C),C++),delete p[v]}else for(d=m[v],h=0;h<C;h++)k=k<<1|d&1,M==l-1?(M=0,A.push(u(k)),k=0):M++,d=d>>1;x--,x==0&&(x=Math.pow(2,C),C++)}for(d=2,h=0;h<C;h++)k=k<<1|d&1,M==l-1?(M=0,A.push(u(k)),k=0):M++,d=d>>1;for(;;)if(k=k<<1,M==l-1){A.push(u(k));break}else M++;return A.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,u){var h=[],d=4,m=4,p=3,g="",y=[],v,x,E,C,A,k,M,I={val:u(0),position:l,index:1};for(v=0;v<3;v+=1)h[v]=v;for(E=0,A=Math.pow(2,2),k=1;k!=A;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),E|=(C>0?1:0)*k,k<<=1;switch(E){case 0:for(E=0,A=Math.pow(2,8),k=1;k!=A;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),E|=(C>0?1:0)*k,k<<=1;M=n(E);break;case 1:for(E=0,A=Math.pow(2,16),k=1;k!=A;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),E|=(C>0?1:0)*k,k<<=1;M=n(E);break;case 2:return""}for(h[3]=M,x=M,y.push(M);;){if(I.index>c)return"";for(E=0,A=Math.pow(2,p),k=1;k!=A;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),E|=(C>0?1:0)*k,k<<=1;switch(M=E){case 0:for(E=0,A=Math.pow(2,8),k=1;k!=A;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),E|=(C>0?1:0)*k,k<<=1;h[m++]=n(E),M=m-1,d--;break;case 1:for(E=0,A=Math.pow(2,16),k=1;k!=A;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),E|=(C>0?1:0)*k,k<<=1;h[m++]=n(E),M=m-1,d--;break;case 2:return y.join("")}if(d==0&&(d=Math.pow(2,p),p++),h[M])g=h[M];else if(M===m)g=x+x.charAt(0);else return null;y.push(g),h[m++]=x+g.charAt(0),d--,x=g,d==0&&(d=Math.pow(2,p),p++)}}};return a})();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(nL)),nL.exports}var tAe=eAe();const nAe=su(tAe);var V6={};function Dte(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}const rAe=(t,e,n,r,i,s,o)=>{const a=r+n.indent,c=n.colors;return t.map(l=>{const u=e[l];let h=o(u,n,a,i,s);return typeof u!="string"&&(h.indexOf(`
`)!==-1&&(h=n.spacingOuter+a+h+n.spacingOuter+r),h="{"+h+"}"),n.spacingInner+r+c.prop.open+l+c.prop.close+"="+c.value.open+h+c.value.close}).join("")},iAe=3,sAe=(t,e,n,r,i,s)=>t.map(o=>{const a=typeof o=="string"?Lte(o,e):s(o,e,n,r,i);return a===""&&typeof o=="object"&&o!==null&&o.nodeType!==iAe?"":e.spacingOuter+n+a}).join(""),Lte=(t,e)=>{const n=e.colors.content;return n.open+Dte(t)+n.close},oAe=(t,e)=>{const n=e.colors.comment;return n.open+"<!--"+Dte(t)+"-->"+n.close},aAe=(t,e,n,r,i)=>{const s=r.colors.tag;return s.open+"<"+t+(e&&s.close+e+r.spacingOuter+i+s.open)+(n?">"+s.close+n+r.spacingOuter+i+s.open+"</"+t:(e&&!r.min?"":" ")+"/")+">"+s.close},cAe=(t,e)=>{const n=e.colors.tag;return n.open+"<"+t+n.close+" "+n.open+" />"+n.close},lAe=1,Ute=3,Bte=8,Fte=11,uAe=/^((HTML|SVG)\w*)?Element$/,jte=t=>{const{tagName:e}=t;return!!(typeof e=="string"&&e.includes("-")||typeof t.hasAttribute=="function"&&t.hasAttribute("is"))},fAe=t=>{const e=t.constructor.name,{nodeType:n}=t;return n===lAe&&(uAe.test(e)||jte(t))||n===Ute&&e==="Text"||n===Bte&&e==="Comment"||n===Fte&&e==="DocumentFragment"};function hAe(t){return t.nodeType===Ute}function dAe(t){return t.nodeType===Bte}function rL(t){return t.nodeType===Fte}function pAe(t){return{test:e=>{var n;return((e==null||(n=e.constructor)==null?void 0:n.name)||jte(e))&&fAe(e)},serialize:(e,n,r,i,s,o)=>{if(hAe(e))return Lte(e.data,n);if(dAe(e))return oAe(e.data,n);const a=rL(e)?"DocumentFragment":e.tagName.toLowerCase();return++i>n.maxDepth?cAe(a,n):aAe(a,rAe(rL(e)?[]:Array.from(e.attributes).map(c=>c.name).sort(),rL(e)?{}:Array.from(e.attributes).reduce((c,l)=>(c[l.name]=l.value,c),{}),n,r+n.indent,i,s,o),sAe(Array.prototype.slice.call(e.childNodes||e.children).filter(t),n,r+n.indent,i,s,o),n,r)}}}let zte=null,C8=null,A8=null;try{const t=Jl&&Jl.require;C8=t.call(Jl,"fs").readFileSync,A8=t.call(Jl,"@babel/code-frame").codeFrameColumns,zte=t.call(Jl,"picocolors")}catch{}function mAe(t){const e=t.indexOf("(")+1,n=t.indexOf(")"),r=t.slice(e,n),i=r.split(":"),[s,o,a]=[i[0],parseInt(i[1],10),parseInt(i[2],10)];let c="";try{c=C8(s,"utf-8")}catch{return""}const l=A8(c,{start:{line:o,column:a}},{highlightCode:!0,linesBelow:0});return zte.dim(r)+`
`+l+`
`}function gAe(){if(!C8||!A8)return"";const e=new Error().stack.split(`
`).slice(1).find(n=>!n.includes("node_modules/"));return mAe(e)}const Hte=3;function iL(){return typeof jest<"u"&&jest!==null?setTimeout._isMockFunction===!0||Object.prototype.hasOwnProperty.call(setTimeout,"clock"):!1}function M8(){if(typeof window>"u")throw new Error("Could not find default container");return window.document}function _Ae(t){if(t.defaultView)return t.defaultView;if(t.ownerDocument&&t.ownerDocument.defaultView)return t.ownerDocument.defaultView;if(t.window)return t.window;throw t.ownerDocument&&t.ownerDocument.defaultView===null?new Error("It looks like the window object is not available for the provided node."):t.then instanceof Function?new Error("It looks like you passed a Promise object instead of a DOM node. Did you do something like `fireEvent.click(screen.findBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`, or await the findBy query `fireEvent.click(await screen.findBy...`?"):Array.isArray(t)?new Error("It looks like you passed an Array instead of a DOM node. Did you do something like `fireEvent.click(screen.getAllBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`?"):typeof t.debug=="function"&&typeof t.logTestingPlaygroundURL=="function"?new Error("It looks like you passed a `screen` object. Did you do something like `fireEvent.click(screen, ...` when you meant to use a query, e.g. `fireEvent.click(screen.getBy..., `?"):new Error("The given node is not an Element, the node type is: "+typeof t+".")}function Lv(t){if(!t||typeof t.querySelector!="function"||typeof t.querySelectorAll!="function")throw new TypeError("Expected container to be an Element, a Document or a DocumentFragment but got "+e(t)+".");function e(n){return typeof n=="object"?n===null?"null":n.constructor.name:typeof n}}const vAe=()=>{if(typeof Sa>"u")return!1;let t;try{var e;const n=(e=V6)==null?void 0:e.COLORS;n&&(t=JSON.parse(n))}catch{}return typeof t=="boolean"?t:Sa.versions!==void 0&&Sa.versions.node!==void 0},{DOMCollection:yAe}=Rte.plugins,bAe=1,EAe=8;function SAe(t){return t.nodeType!==EAe&&(t.nodeType!==bAe||!t.matches(Is().defaultIgnore))}function RI(t,e,n){if(n===void 0&&(n={}),t||(t=M8().body),typeof e!="number"&&(e=typeof Sa<"u"&&typeof V6<"u"&&V6.DEBUG_PRINT_LIMIT||7e3),e===0)return"";t.documentElement&&(t=t.documentElement);let r=typeof t;if(r==="object"?r=t.constructor.name:t={},!("outerHTML"in t))throw new TypeError("Expected an element or document but got "+r);const{filterNode:i=SAe,...s}=n,o=Rte.format(t,{plugins:[pAe(i),yAe],printFunctionName:!1,highlight:vAe(),...s});return e!==void 0&&t.outerHTML.length>e?o.slice(0,e)+"...":o}const jG=function(){const t=gAe();console.log(t?RI(...arguments)+`

`+t:RI(...arguments))};let CI={testIdAttribute:"data-testid",asyncUtilTimeout:1e3,asyncWrapper:t=>t(),unstable_advanceTimersWrapper:t=>t(),eventWrapper:t=>t(),defaultHidden:!1,defaultIgnore:"script, style",showOriginalStackTrace:!1,throwSuggestions:!1,getElementError(t,e){const n=RI(e),r=new Error([t,"Ignored nodes: comments, "+CI.defaultIgnore+`
`+n].filter(Boolean).join(`

`));return r.name="TestingLibraryElementError",r},_disableExpensiveErrorDiagnostics:!1,computedStyleSupportsPseudoElements:!1};function xAe(t){try{return CI._disableExpensiveErrorDiagnostics=!0,t()}finally{CI._disableExpensiveErrorDiagnostics=!1}}function Is(){return CI}const TAe=["button","meter","output","progress","select","textarea","input"];function qte(t){return TAe.includes(t.nodeName.toLowerCase())?"":t.nodeType===Hte?t.textContent:Array.from(t.childNodes).map(e=>qte(e)).join("")}function G6(t){let e;return t.tagName.toLowerCase()==="label"?e=qte(t):e=t.value||t.textContent,e}function Vte(t){if(t.labels!==void 0){var e;return(e=t.labels)!=null?e:[]}if(!wAe(t))return[];const n=t.ownerDocument.querySelectorAll("label");return Array.from(n).filter(r=>r.control===t)}function wAe(t){return/BUTTON|METER|OUTPUT|PROGRESS|SELECT|TEXTAREA/.test(t.tagName)||t.tagName==="INPUT"&&t.getAttribute("type")!=="hidden"}function Gte(t,e,n){let{selector:r="*"}=n===void 0?{}:n;const i=e.getAttribute("aria-labelledby"),s=i?i.split(" "):[];return s.length?s.map(o=>{const a=t.querySelector('[id="'+o+'"]');return a?{content:G6(a),formControl:null}:{content:"",formControl:null}}):Array.from(Vte(e)).map(o=>{const a=G6(o),l=Array.from(o.querySelectorAll("button, input, meter, output, progress, select, textarea")).filter(u=>u.matches(r))[0];return{content:a,formControl:l}})}function $te(t){if(t==null)throw new Error("It looks like "+t+" was passed instead of a matcher. Did you do something like getByText("+t+")?")}function $x(t,e,n,r){if(typeof t!="string")return!1;$te(n);const i=r(t);return typeof n=="string"||typeof n=="number"?i.toLowerCase().includes(n.toString().toLowerCase()):typeof n=="function"?n(i,e):Kte(n,i)}function vv(t,e,n,r){if(typeof t!="string")return!1;$te(n);const i=r(t);return n instanceof Function?n(i,e):n instanceof RegExp?Kte(n,i):i===String(n)}function Wte(t){let{trim:e=!0,collapseWhitespace:n=!0}=t===void 0?{}:t;return r=>{let i=r;return i=e?i.trim():i,i=n?i.replace(/\s+/g," "):i,i}}function oE(t){let{trim:e,collapseWhitespace:n,normalizer:r}=t;if(!r)return Wte({trim:e,collapseWhitespace:n});if(typeof e<"u"||typeof n<"u")throw new Error('trim and collapseWhitespace are not supported with a normalizer. If you want to use the default trim and collapseWhitespace logic in your normalizer, use "getDefaultNormalizer({trim, collapseWhitespace})" and compose that into your normalizer');return r}function Kte(t,e){const n=t.test(e);return t.global&&t.lastIndex!==0&&(console.warn("To match all elements we had to reset the lastIndex of the RegExp because the global flag is enabled. We encourage to remove the global flag from the RegExp."),t.lastIndex=0),n}function p3(t){return t.matches("input[type=submit], input[type=button], input[type=reset]")?t.value:Array.from(t.childNodes).filter(e=>e.nodeType===Hte&&!!e.textContent).map(e=>e.textContent).join("")}const RAe=CAe(jp.elementRoles);function Xte(t){return t.hidden===!0||t.getAttribute("aria-hidden")==="true"||t.ownerDocument.defaultView.getComputedStyle(t).display==="none"}function k8(t,e){e===void 0&&(e={});const{isSubtreeInaccessible:n=Xte}=e;if(t.ownerDocument.defaultView.getComputedStyle(t).visibility==="hidden")return!0;let i=t;for(;i;){if(n(i))return!0;i=i.parentElement}return!1}function O8(t){for(const{match:e,roles:n}of RAe)if(e(t))return[...n];return[]}function CAe(t){function e(o){let{name:a,attributes:c}=o;return""+a+c.map(l=>{let{name:u,value:h,constraints:d=[]}=l;const m=d.indexOf("undefined")!==-1,p=d.indexOf("set")!==-1;return typeof h<"u"?"["+u+'="'+h+'"]':m?":not(["+u+"])":p?"["+u+"]:not(["+u+'=""])':"["+u+"]"}).join("")}function n(o){let{attributes:a=[]}=o;return a.length}function r(o,a){let{specificity:c}=o,{specificity:l}=a;return l-c}function i(o){let{attributes:a=[]}=o;const c=a.findIndex(u=>u.value&&u.name==="type"&&u.value==="text");c>=0&&(a=[...a.slice(0,c),...a.slice(c+1)]);const l=e({...o,attributes:a});return u=>c>=0&&u.type!=="text"?!1:u.matches(l)}let s=[];for(const[o,a]of t.entries())s=[...s,{match:i(o),roles:Array.from(a),specificity:n(o)}];return s.sort(r)}function AAe(t,e){let{hidden:n=!1}=e===void 0?{}:e;function r(i){return[i,...Array.from(i.children).reduce((s,o)=>[...s,...r(o)],[])]}return r(t).filter(i=>n===!1?k8(i)===!1:!0).reduce((i,s)=>{let o=[];return s.hasAttribute("role")?o=s.getAttribute("role").split(" ").slice(0,1):o=O8(s),o.reduce((a,c)=>Array.isArray(a[c])?{...a,[c]:[...a[c],s]}:{...a,[c]:[s]},i)},{})}function MAe(t,e){let{hidden:n,includeDescription:r}=e;const i=AAe(t,{hidden:n});return Object.entries(i).filter(s=>{let[o]=s;return o!=="generic"}).map(s=>{let[o,a]=s;const c="-".repeat(50),l=a.map(u=>{const h='Name "'+w8(u,{computedStyleSupportsPseudoElements:Is().computedStyleSupportsPseudoElements})+`":
`,d=RI(u.cloneNode(!1));if(r){const m='Description "'+Pte(u,{computedStyleSupportsPseudoElements:Is().computedStyleSupportsPseudoElements})+`":
`;return""+h+m+d}return""+h+d}).join(`

`);return o+`:

`+l+`

`+c}).join(`
`)}function kAe(t){return t.tagName==="OPTION"?t.selected:RM(t,"aria-selected")}function OAe(t){return t.getAttribute("aria-busy")==="true"}function IAe(t){if(!("indeterminate"in t&&t.indeterminate))return"checked"in t?t.checked:RM(t,"aria-checked")}function NAe(t){return RM(t,"aria-pressed")}function PAe(t){var e,n;return(e=(n=RM(t,"aria-current"))!=null?n:t.getAttribute("aria-current"))!=null?e:!1}function DAe(t){return RM(t,"aria-expanded")}function RM(t,e){const n=t.getAttribute(e);if(n==="true")return!0;if(n==="false")return!1}function LAe(t){const e={H1:1,H2:2,H3:3,H4:4,H5:5,H6:6};return t.getAttribute("aria-level")&&Number(t.getAttribute("aria-level"))||e[t.tagName]}function UAe(t){const e=t.getAttribute("aria-valuenow");return e===null?void 0:+e}function BAe(t){const e=t.getAttribute("aria-valuemax");return e===null?void 0:+e}function FAe(t){const e=t.getAttribute("aria-valuemin");return e===null?void 0:+e}function jAe(t){const e=t.getAttribute("aria-valuetext");return e===null?void 0:e}const zG=Wte();function zAe(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function HG(t){return new RegExp(zAe(t.toLowerCase()),"i")}function hy(t,e,n,r){let{variant:i,name:s}=r,o="";const a={},c=[["Role","TestId"].includes(t)?n:HG(n)];s&&(a.name=HG(s)),t==="Role"&&k8(e)&&(a.hidden=!0,o=`Element is inaccessible. This means that the element and all its children are invisible to screen readers.
    If you are using the aria-hidden prop, make sure this is the right choice for your case.
    `),Object.keys(a).length>0&&c.push(a);const l=i+"By"+t;return{queryName:t,queryMethod:l,queryArgs:c,variant:i,warning:o,toString(){o&&console.warn(o);let[u,h]=c;return u=typeof u=="string"?"'"+u+"'":u,h=h?", { "+Object.entries(h).map(d=>{let[m,p]=d;return m+": "+p}).join(", ")+" }":"",l+"("+u+h+")"}}}function dy(t,e,n){return n&&!0}function $6(t,e,n){var r,i;if(e===void 0&&(e="get"),t.matches(Is().defaultIgnore))return;const s=(r=t.getAttribute("role"))!=null?r:(i=O8(t))==null?void 0:i[0];if(s!=="generic"&&dy("Role",n,s))return hy("Role",t,s,{variant:e,name:w8(t,{computedStyleSupportsPseudoElements:Is().computedStyleSupportsPseudoElements})});const o=Gte(document,t).map(d=>d.content).join(" ");if(dy("LabelText",n,o))return hy("LabelText",t,o,{variant:e});const a=t.getAttribute("placeholder");if(dy("PlaceholderText",n,a))return hy("PlaceholderText",t,a,{variant:e});const c=zG(p3(t));if(dy("Text",n,c))return hy("Text",t,c,{variant:e});if(dy("DisplayValue",n,t.value))return hy("DisplayValue",t,zG(t.value),{variant:e});const l=t.getAttribute("alt");if(dy("AltText",n,l))return hy("AltText",t,l,{variant:e});const u=t.getAttribute("title");if(dy("Title",n,u))return hy("Title",t,u,{variant:e});const h=t.getAttribute(Is().testIdAttribute);if(dy("TestId",n,h))return hy("TestId",t,h,{variant:e})}function ak(t,e){t.stack=e.stack.replace(e.message,t.message)}function HAe(t,e){let{container:n=M8(),timeout:r=Is().asyncUtilTimeout,showOriginalStackTrace:i=Is().showOriginalStackTrace,stackTraceError:s,interval:o=50,onTimeout:a=l=>(Object.defineProperty(l,"message",{value:Is().getElementError(l.message,n).message}),l),mutationObserverOptions:c={subtree:!0,childList:!0,attributes:!0,characterData:!0}}=e;if(typeof t!="function")throw new TypeError("Received `callback` arg must be a function");return new Promise(async(l,u)=>{let h,d,m,p=!1,g="idle";const y=setTimeout(A,r),v=iL();if(v){const{unstable_advanceTimersWrapper:k}=Is();for(C();!p;){if(!iL()){const M=new Error("Changed from using fake timers to real timers while using waitFor. This is not allowed and will result in very strange behavior. Please ensure you're awaiting all async things your test is doing before changing to real timers. For more info, please go to https://github.com/testing-library/dom-testing-library/issues/830");i||ak(M,s),u(M);return}if(await k(async()=>{jest.advanceTimersByTime(o)}),p)break;C()}}else{try{Lv(n)}catch(M){u(M);return}d=setInterval(E,o);const{MutationObserver:k}=_Ae(n);m=new k(E),m.observe(n,c),C()}function x(k,M){p=!0,clearTimeout(y),v||(clearInterval(d),m.disconnect()),k?u(k):l(M)}function E(){if(iL()){const k=new Error("Changed from using real timers to fake timers while using waitFor. This is not allowed and will result in very strange behavior. Please ensure you're awaiting all async things your test is doing before changing to fake timers. For more info, please go to https://github.com/testing-library/dom-testing-library/issues/830");return i||ak(k,s),u(k)}else return C()}function C(){if(g!=="pending")try{const k=xAe(t);typeof k?.then=="function"?(g="pending",k.then(M=>{g="resolved",x(null,M)},M=>{g="rejected",h=M})):x(null,k)}catch(k){h=k}}function A(){let k;h?(k=h,!i&&k.name==="TestingLibraryElementError"&&ak(k,s)):(k=new Error("Timed out in waitFor."),i||ak(k,s)),x(a(k),null)}})}function qAe(t,e){const n=new Error("STACK_TRACE_MESSAGE");return Is().asyncWrapper(()=>HAe(t,{stackTraceError:n,...e}))}function Yte(t,e){return Is().getElementError(t,e)}function VAe(t,e){return Yte(t+"\n\n(If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).",e)}function m3(t,e,n,r){let{exact:i=!0,collapseWhitespace:s,trim:o,normalizer:a}=r===void 0?{}:r;const c=i?vv:$x,l=oE({collapseWhitespace:s,trim:o,normalizer:a});return Array.from(e.querySelectorAll("["+t+"]")).filter(u=>c(u.getAttribute(t),u,n,l))}function AI(t,e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];const o=t(n,...i);if(o.length>1){const a=o.map(c=>Yte(null,c).message).join(`

`);throw VAe(e(n,...i)+`

Here are the matching elements:

`+a,n)}return o[0]||null}}function Zte(t,e){return Is().getElementError(`A better query is available, try this:
`+t.toString()+`
`,e)}function GAe(t,e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];const o=t(n,...i);if(!o.length)throw Is().getElementError(e(n,...i),n);return o}}function MI(t){return(e,n,r,i)=>qAe(()=>t(e,n,r),{container:e,...i})}const US=(t,e,n)=>function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];const a=t(r,...s),[{suggest:c=Is().throwSuggestions}={}]=s.slice(-1);if(a&&c){const l=$6(a,n);if(l&&!e.endsWith(l.queryName))throw Zte(l.toString(),r)}return a},sm=(t,e,n)=>function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];const a=t(r,...s),[{suggest:c=Is().throwSuggestions}={}]=s.slice(-1);if(a.length&&c){const l=[...new Set(a.map(u=>{var h;return(h=$6(u,n))==null?void 0:h.toString()}))];if(l.length===1&&!e.endsWith($6(a[0],n).queryName))throw Zte(l[0],r)}return a};function aE(t,e,n){const r=US(AI(t,e),t.name,"query"),i=GAe(t,n),s=AI(i,e),o=US(s,t.name,"get"),a=sm(i,t.name.replace("query","get"),"getAll"),c=MI(sm(i,t.name,"findAll")),l=MI(US(s,t.name,"find"));return[r,a,o,c,l]}function $Ae(t){return Array.from(t.querySelectorAll("label,input")).map(e=>({node:e,textToMatch:G6(e)})).filter(e=>{let{textToMatch:n}=e;return n!==null})}const WAe=function(t,e,n){let{exact:r=!0,trim:i,collapseWhitespace:s,normalizer:o}=n===void 0?{}:n;const a=r?vv:$x,c=oE({collapseWhitespace:s,trim:i,normalizer:o});return $Ae(t).filter(u=>{let{node:h,textToMatch:d}=u;return a(d,h,e,c)}).map(u=>{let{node:h}=u;return h})},CA=function(t,e,n){let{selector:r="*",exact:i=!0,collapseWhitespace:s,trim:o,normalizer:a}=n===void 0?{}:n;Lv(t);const c=i?vv:$x,l=oE({collapseWhitespace:s,trim:o,normalizer:a}),u=Array.from(t.querySelectorAll("*")).filter(h=>Vte(h).length||h.hasAttribute("aria-labelledby")).reduce((h,d)=>{const m=Gte(t,d,{selector:r});m.filter(g=>!!g.formControl).forEach(g=>{c(g.content,g.formControl,e,l)&&g.formControl&&h.push(g.formControl)});const p=m.filter(g=>!!g.content).map(g=>g.content);return c(p.join(" "),d,e,l)&&h.push(d),p.length>1&&p.forEach((g,y)=>{c(g,d,e,l)&&h.push(d);const v=[...p];v.splice(y,1),v.length>1&&c(v.join(" "),d,e,l)&&h.push(d)}),h},[]).concat(m3("aria-label",t,e,{exact:i,normalizer:l}));return Array.from(new Set(u)).filter(h=>h.matches(r))},L1=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const s=CA(t,e,...r);if(!s.length){const o=WAe(t,e,...r);if(o.length){const a=o.map(c=>KAe(t,c)).filter(c=>!!c);throw a.length?Is().getElementError(a.map(c=>"Found a label with the text of: "+e+", however the element associated with this label (<"+c+" />) is non-labellable [https://html.spec.whatwg.org/multipage/forms.html#category-label]. If you really need to label a <"+c+" />, you can use aria-label or aria-labelledby instead.").join(`

`),t):Is().getElementError("Found a label with the text of: "+e+`, however no form control was found associated to that label. Make sure you're using the "for" attribute or "aria-labelledby" attribute correctly.`,t)}else throw Is().getElementError("Unable to find a label with the text of: "+e,t)}return s};function KAe(t,e){const n=e.getAttribute("for");if(!n)return null;const r=t.querySelector('[id="'+n+'"]');return r?r.tagName.toLowerCase():null}const Jte=(t,e)=>"Found multiple elements with the text of: "+e,XAe=US(AI(CA,Jte),CA.name,"query"),Qte=AI(L1,Jte),YAe=MI(sm(L1,L1.name,"findAll")),ZAe=MI(US(Qte,L1.name,"find")),JAe=sm(L1,L1.name,"getAll"),QAe=US(Qte,L1.name,"get"),eMe=sm(CA,CA.name,"queryAll"),W6=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Lv(e[0]),m3("placeholder",...e)},tMe=(t,e)=>"Found multiple elements with the placeholder text of: "+e,nMe=(t,e)=>"Unable to find an element with the placeholder text of: "+e,rMe=sm(W6,W6.name,"queryAll"),[iMe,sMe,oMe,aMe,cMe]=aE(W6,tMe,nMe),K6=function(t,e,n){let{selector:r="*",exact:i=!0,collapseWhitespace:s,trim:o,ignore:a=Is().defaultIgnore,normalizer:c}=n===void 0?{}:n;Lv(t);const l=i?vv:$x,u=oE({collapseWhitespace:s,trim:o,normalizer:c});let h=[];return typeof t.matches=="function"&&t.matches(r)&&(h=[t]),[...h,...Array.from(t.querySelectorAll(r))].filter(d=>!a||!d.matches(a)).filter(d=>l(p3(d),d,e,u))},lMe=(t,e)=>"Found multiple elements with the text: "+e,uMe=function(t,e,n){n===void 0&&(n={});const{collapseWhitespace:r,trim:i,normalizer:s,selector:o}=n,c=oE({collapseWhitespace:r,trim:i,normalizer:s})(e.toString()),l=c!==e.toString(),u=(o??"*")!=="*";return"Unable to find an element with the text: "+(l?c+" (normalized from '"+e+"')":e)+(u?", which matches selector '"+o+"'":"")+". This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible."},fMe=sm(K6,K6.name,"queryAll"),[hMe,dMe,pMe,mMe,gMe]=aE(K6,lMe,uMe),X6=function(t,e,n){let{exact:r=!0,collapseWhitespace:i,trim:s,normalizer:o}=n===void 0?{}:n;Lv(t);const a=r?vv:$x,c=oE({collapseWhitespace:i,trim:s,normalizer:o});return Array.from(t.querySelectorAll("input,textarea,select")).filter(l=>l.tagName==="SELECT"?Array.from(l.options).filter(h=>h.selected).some(h=>a(p3(h),h,e,c)):a(l.value,l,e,c))},_Me=(t,e)=>"Found multiple elements with the display value: "+e+".",vMe=(t,e)=>"Unable to find an element with the display value: "+e+".",yMe=sm(X6,X6.name,"queryAll"),[bMe,EMe,SMe,xMe,TMe]=aE(X6,_Me,vMe),wMe=/^(img|input|area|.+-.+)$/i,Y6=function(t,e,n){return n===void 0&&(n={}),Lv(t),m3("alt",t,e,n).filter(r=>wMe.test(r.tagName))},RMe=(t,e)=>"Found multiple elements with the alt text: "+e,CMe=(t,e)=>"Unable to find an element with the alt text: "+e,AMe=sm(Y6,Y6.name,"queryAll"),[MMe,kMe,OMe,IMe,NMe]=aE(Y6,RMe,CMe),PMe=t=>{var e;return t.tagName.toLowerCase()==="title"&&((e=t.parentElement)==null?void 0:e.tagName.toLowerCase())==="svg"},Z6=function(t,e,n){let{exact:r=!0,collapseWhitespace:i,trim:s,normalizer:o}=n===void 0?{}:n;Lv(t);const a=r?vv:$x,c=oE({collapseWhitespace:i,trim:s,normalizer:o});return Array.from(t.querySelectorAll("[title], svg > title")).filter(l=>a(l.getAttribute("title"),l,e,c)||PMe(l)&&a(p3(l),l,e,c))},DMe=(t,e)=>"Found multiple elements with the title: "+e+".",LMe=(t,e)=>"Unable to find an element with the title: "+e+".",UMe=sm(Z6,Z6.name,"queryAll"),[BMe,FMe,jMe,zMe,HMe]=aE(Z6,DMe,LMe),J6=function(t,e,n){let{hidden:r=Is().defaultHidden,name:i,description:s,queryFallbacks:o=!1,selected:a,busy:c,checked:l,pressed:u,current:h,level:d,expanded:m,value:{now:p,min:g,max:y,text:v}={}}=n===void 0?{}:n;if(Lv(t),a!==void 0){var x;if(((x=jp.roles.get(e))==null?void 0:x.props["aria-selected"])===void 0)throw new Error('"aria-selected" is not supported on role "'+e+'".')}if(c!==void 0){var E;if(((E=jp.roles.get(e))==null?void 0:E.props["aria-busy"])===void 0)throw new Error('"aria-busy" is not supported on role "'+e+'".')}if(l!==void 0){var C;if(((C=jp.roles.get(e))==null?void 0:C.props["aria-checked"])===void 0)throw new Error('"aria-checked" is not supported on role "'+e+'".')}if(u!==void 0){var A;if(((A=jp.roles.get(e))==null?void 0:A.props["aria-pressed"])===void 0)throw new Error('"aria-pressed" is not supported on role "'+e+'".')}if(h!==void 0){var k;if(((k=jp.roles.get(e))==null?void 0:k.props["aria-current"])===void 0)throw new Error('"aria-current" is not supported on role "'+e+'".')}if(d!==void 0&&e!=="heading")throw new Error('Role "'+e+'" cannot have "level" property.');if(p!==void 0){var M;if(((M=jp.roles.get(e))==null?void 0:M.props["aria-valuenow"])===void 0)throw new Error('"aria-valuenow" is not supported on role "'+e+'".')}if(y!==void 0){var I;if(((I=jp.roles.get(e))==null?void 0:I.props["aria-valuemax"])===void 0)throw new Error('"aria-valuemax" is not supported on role "'+e+'".')}if(g!==void 0){var z;if(((z=jp.roles.get(e))==null?void 0:z.props["aria-valuemin"])===void 0)throw new Error('"aria-valuemin" is not supported on role "'+e+'".')}if(v!==void 0){var H;if(((H=jp.roles.get(e))==null?void 0:H.props["aria-valuetext"])===void 0)throw new Error('"aria-valuetext" is not supported on role "'+e+'".')}if(m!==void 0){var K;if(((K=jp.roles.get(e))==null?void 0:K.props["aria-expanded"])===void 0)throw new Error('"aria-expanded" is not supported on role "'+e+'".')}const P=new WeakMap;function F(N){return P.has(N)||P.set(N,Xte(N)),P.get(N)}return Array.from(t.querySelectorAll(qMe(e))).filter(N=>{if(N.hasAttribute("role")){const j=N.getAttribute("role");if(o)return j.split(" ").filter(Boolean).some(te=>te===e);const[q]=j.split(" ");return q===e}return O8(N).some(j=>j===e)}).filter(N=>{if(a!==void 0)return a===kAe(N);if(c!==void 0)return c===OAe(N);if(l!==void 0)return l===IAe(N);if(u!==void 0)return u===NAe(N);if(h!==void 0)return h===PAe(N);if(m!==void 0)return m===DAe(N);if(d!==void 0)return d===LAe(N);if(p!==void 0||y!==void 0||g!==void 0||v!==void 0){let G=!0;if(p!==void 0&&G&&(G=p===UAe(N)),y!==void 0&&G&&(G=y===BAe(N)),g!==void 0&&G&&(G=g===FAe(N)),v!==void 0){var X;G&&(G=vv((X=jAe(N))!=null?X:null,N,v,j=>j))}return G}return!0}).filter(N=>i===void 0?!0:vv(w8(N,{computedStyleSupportsPseudoElements:Is().computedStyleSupportsPseudoElements}),N,i,X=>X)).filter(N=>s===void 0?!0:vv(Pte(N,{computedStyleSupportsPseudoElements:Is().computedStyleSupportsPseudoElements}),N,s,X=>X)).filter(N=>r===!1?k8(N,{isSubtreeInaccessible:F})===!1:!0)};function qMe(t){var e;const n='*[role~="'+t+'"]',r=(e=jp.roleElements.get(t))!=null?e:new Set,i=new Set(Array.from(r).map(s=>{let{name:o}=s;return o}));return[n].concat(Array.from(i)).join(",")}const ene=t=>{let e="";return t===void 0?e="":typeof t=="string"?e=' and name "'+t+'"':e=" and name `"+t+"`",e},VMe=function(t,e,n){let{name:r}=n===void 0?{}:n;return'Found multiple elements with the role "'+e+'"'+ene(r)},GMe=function(t,e,n){let{hidden:r=Is().defaultHidden,name:i,description:s}=n===void 0?{}:n;if(Is()._disableExpensiveErrorDiagnostics)return'Unable to find role="'+e+'"'+ene(i);let o="";Array.from(t.children).forEach(u=>{o+=MAe(u,{hidden:r,includeDescription:s!==void 0})});let a;o.length===0?r===!1?a="There are no accessible roles. But there might be some inaccessible roles. If you wish to access them, then set the `hidden` option to `true`. Learn more about this here: https://testing-library.com/docs/dom-testing-library/api-queries#byrole":a="There are no available roles.":a=(`
Here are the `+(r===!1?"accessible":"available")+` roles:

  `+o.replace(/\n/g,`
  `).replace(/\n\s\s\n/g,`

`)+`
`).trim();let c="";i===void 0?c="":typeof i=="string"?c=' and name "'+i+'"':c=" and name `"+i+"`";let l="";return s===void 0?l="":typeof s=="string"?l=' and description "'+s+'"':l=" and description `"+s+"`",(`
Unable to find an `+(r===!1?"accessible ":"")+'element with the role "'+e+'"'+c+l+`

`+a).trim()},$Me=sm(J6,J6.name,"queryAll"),[WMe,KMe,XMe,YMe,ZMe]=aE(J6,VMe,GMe),I8=()=>Is().testIdAttribute,Q6=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Lv(e[0]),m3(I8(),...e)},JMe=(t,e)=>"Found multiple elements by: ["+I8()+'="'+e+'"]',QMe=(t,e)=>"Unable to find an element by: ["+I8()+'="'+e+'"]',e2e=sm(Q6,Q6.name,"queryAll"),[t2e,n2e,r2e,i2e,s2e]=aE(Q6,JMe,QMe);var e5=Object.freeze({__proto__:null,queryAllByLabelText:eMe,queryByLabelText:XAe,getAllByLabelText:JAe,getByLabelText:QAe,findAllByLabelText:YAe,findByLabelText:ZAe,queryByPlaceholderText:iMe,queryAllByPlaceholderText:rMe,getByPlaceholderText:oMe,getAllByPlaceholderText:sMe,findAllByPlaceholderText:aMe,findByPlaceholderText:cMe,queryByText:hMe,queryAllByText:fMe,getByText:pMe,getAllByText:dMe,findAllByText:mMe,findByText:gMe,queryByDisplayValue:bMe,queryAllByDisplayValue:yMe,getByDisplayValue:SMe,getAllByDisplayValue:EMe,findAllByDisplayValue:xMe,findByDisplayValue:TMe,queryByAltText:MMe,queryAllByAltText:AMe,getByAltText:OMe,getAllByAltText:kMe,findAllByAltText:IMe,findByAltText:NMe,queryByTitle:BMe,queryAllByTitle:UMe,getByTitle:jMe,getAllByTitle:FMe,findAllByTitle:zMe,findByTitle:HMe,queryByRole:WMe,queryAllByRole:$Me,getAllByRole:KMe,getByRole:XMe,findAllByRole:YMe,findByRole:ZMe,queryByTestId:t2e,queryAllByTestId:e2e,getByTestId:r2e,getAllByTestId:n2e,findAllByTestId:i2e,findByTestId:s2e});function o2e(t,e,n){return e===void 0&&(e=e5),n===void 0&&(n={}),Object.keys(e).reduce((r,i)=>{const s=e[i];return r[i]=s.bind(null,t),r},n)}const qG={copy:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},cut:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},paste:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionEnd:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionStart:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionUpdate:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keyDown:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},keyPress:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},keyUp:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},focus:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},blur:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},focusIn:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},focusOut:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},change:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},input:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},invalid:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!0}},submit:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}},reset:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}},click:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,button:0,composed:!0}},contextMenu:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dblClick:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},drag:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragEnd:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragEnter:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragExit:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragLeave:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragOver:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragStart:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},drop:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseDown:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseEnter:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseLeave:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseMove:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseOut:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseOver:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseUp:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},select:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},touchCancel:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},touchEnd:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},touchMove:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},touchStart:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},resize:{EventType:"UIEvent",defaultInit:{bubbles:!1,cancelable:!1}},scroll:{EventType:"UIEvent",defaultInit:{bubbles:!1,cancelable:!1}},wheel:{EventType:"WheelEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},abort:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},canPlay:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},canPlayThrough:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},durationChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},emptied:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},encrypted:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},ended:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadedData:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadedMetadata:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadStart:{EventType:"ProgressEvent",defaultInit:{bubbles:!1,cancelable:!1}},pause:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},play:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},playing:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},progress:{EventType:"ProgressEvent",defaultInit:{bubbles:!1,cancelable:!1}},rateChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},seeked:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},seeking:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},stalled:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},suspend:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},timeUpdate:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},volumeChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},waiting:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},load:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},error:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},animationStart:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},animationEnd:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},animationIteration:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionCancel:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionEnd:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}},transitionRun:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionStart:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},pointerOver:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerEnter:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},pointerDown:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerMove:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerUp:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerCancel:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},pointerOut:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerLeave:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},gotPointerCapture:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},lostPointerCapture:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},popState:{EventType:"PopStateEvent",defaultInit:{bubbles:!0,cancelable:!1}},offline:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},online:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},pageHide:{EventType:"PageTransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}},pageShow:{EventType:"PageTransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}}},a2e={doubleClick:"dblClick"};Object.keys(qG).forEach(t=>{const{EventType:e,defaultInit:n}=qG[t];t.toLowerCase()});Object.keys(a2e).forEach(t=>{});function c2e(t){return t.replace(/[ \t]*[\n][ \t]*/g,`
`)}function l2e(t){return nAe.compressToEncodedURIComponent(c2e(t))}function u2e(t){return"https://testing-playground.com/#markup="+l2e(t)}const f2e=(t,e,n)=>Array.isArray(t)?t.forEach(r=>jG(r,e,n)):jG(t,e,n),h2e=function(t){if(t===void 0&&(t=M8().body),!t||!("innerHTML"in t)){console.log("The element you're providing isn't a valid DOM element.");return}if(!t.innerHTML){console.log("The provided element doesn't have any children.");return}const e=u2e(t.innerHTML);return console.log(`Open this URL in your browser

`+e),e},VG={debug:f2e,logTestingPlaygroundURL:h2e};typeof document<"u"&&document.body?o2e(document.body,e5,VG):Object.keys(e5).reduce((t,e)=>(t[e]=()=>{throw new TypeError("For queries bound to document.body a global document has to be available... Learn more: https://testing-library.com/s/screen-global-error")},t),VG);function sx(t,e){return Is().eventWrapper(t)}function Ky(t){const e=aTe(t,x8),n=TM(t.ownerDocument);(e??t.ownerDocument.body)!==n&&(sx(e?()=>e.focus():()=>n?.blur()),uTe(e??t.ownerDocument.body))}function d2e(t){!x8(t)||!(TM(t.ownerDocument)===t)||sx(()=>t.blur())}const Xy={};Xy.click=(t,e,n)=>{const r=e.closest("button,input,label,select,textarea"),i=r&&Ci(r,"label")&&r.control;if(i&&i!==e)return()=>{x8(i)&&(Ky(i),n.dispatchEvent(i,oTe(t)))};if(Ci(e,"input",{type:"file"}))return()=>{d2e(e),e.dispatchEvent(new(fm(e)).Event("fileDialog")),Ky(e)}};const ox=Symbol("Displayed value in UI"),hv=Symbol("Displayed selection in UI"),kI=Symbol("Initial value to compare on blur");function p2e(t){return typeof t=="object"&&ox in t}function m2e(t){return!!t&&typeof t=="object"&&hv in t}function g2e(t,e){t[kI]===void 0&&(t[kI]=t.value),t[ox]=e,t.value=Object.assign(new String(e),{[ox]:!0})}function K0(t){return t[ox]===void 0?t.value:String(t[ox])}function N8(t){t[ox]=void 0}function tne(t){t[kI]=void 0}function _2e(t){return t[kI]}function v2e(t,e){t[hv]=e}function Wx(t,{focusOffset:e,anchorOffset:n=e},r="replace"){const i=K0(t).length,s=h=>Math.max(0,Math.min(i,h)),o=r==="replace"||t[hv]===void 0?s(n):t[hv].anchorOffset,a=s(e),c=Math.min(o,a),l=Math.max(o,a);if(t[hv]={anchorOffset:o,focusOffset:a},t.selectionStart===c&&t.selectionEnd===l)return;const u=Object.assign(new Number(c),{[hv]:!0});try{t.setSelectionRange(u,l)}catch{}}function AA(t){var e,n,r;const i=(r=t[hv])!==null&&r!==void 0?r:{anchorOffset:(e=t.selectionStart)!==null&&e!==void 0?e:0,focusOffset:(n=t.selectionEnd)!==null&&n!==void 0?n:0};return{...i,startOffset:Math.min(i.anchorOffset,i.focusOffset),endOffset:Math.max(i.anchorOffset,i.focusOffset)}}function y2e(t){return!!t[hv]}function TO(t){t[hv]=void 0}const OI=globalThis.parseInt;function b2e(t){const e=t.replace(/\D/g,"");if(e.length<2)return t;const n=OI(e[0],10),r=OI(e[1],10);if(n>=3||n===2&&r>=4){let i;return n>=3?i=1:i=2,GG(e,i)}return t.length===2?t:GG(e,2)}function GG(t,e){const n=t.slice(0,e),r=Math.min(OI(n,10),23),i=t.slice(e),s=OI(i,10),o=Math.min(s,59);return`${r.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}function nne(t,e){const n=t.cloneNode();return n.value=e,n.value===e}var rne=(function(t){return t.email="email",t.password="password",t.search="search",t.telephone="telephone",t.text="text",t.url="url",t})(rne||{});function E2e(t){var e;const n=(e=t.getAttribute("maxlength"))!==null&&e!==void 0?e:"";return/^\d+$/.test(n)&&Number(n)>=0?Number(n):void 0}function S2e(t){return Ci(t,"textarea")||Ci(t,"input")&&t.type in rne}function ine(t,e,n,r){if(wO(t)&&e+n>=0&&e+n<=t.nodeValue.length)return{node:t,offset:e+n};const i=$G(t,e,n);if(i){if(wO(i))return{node:i,offset:n>0?Math.min(1,i.nodeValue.length):Math.max(i.nodeValue.length-1,0)};if(Ci(i,"br")){const s=$G(i,void 0,n);return s?wO(s)?{node:s,offset:n>0?0:s.nodeValue.length}:n<0&&Ci(s,"br")?{node:i.parentNode,offset:ck(i)}:{node:s.parentNode,offset:ck(s)+(n>0?0:1)}:n<0&&r==="deleteContentBackward"?{node:i.parentNode,offset:ck(i)}:void 0}else return{node:i.parentNode,offset:ck(i)+(n>0?1:0)}}}function $G(t,e,n){const r=Number(e)+(n<0?-1:0);return e!==void 0&&P8(t)&&r>=0&&r<t.children.length&&(t=t.children[r]),T2e(t,n===1?"next":"previous",x2e)}function x2e(t){if(wO(t))return!0;if(P8(t)){if(Ci(t,["input","textarea"]))return t.type!=="hidden";if(Ci(t,"br"))return!0}return!1}function ck(t){let e=0;for(;t.previousSibling;)e++,t=t.previousSibling;return e}function P8(t){return t.nodeType===1}function wO(t){return t.nodeType===3}function T2e(t,e,n){for(;;){var r;const i=t[`${e}Sibling`];if(i){if(t=w2e(i,e==="next"?"first":"last"),n(t))return t}else if(t.parentNode&&(!P8(t.parentNode)||!D1(t.parentNode)&&t.parentNode!==((r=t.ownerDocument)===null||r===void 0?void 0:r.body)))t=t.parentNode;else break}}function w2e(t,e){for(;t.hasChildNodes();)t=t[`${e}Child`];return t}const MA=Symbol("Track programmatic changes for React workaround");function R2e(t){return Object.getOwnPropertyNames(t).some(e=>e.startsWith("__react"))&&fm(t).REACT_VERSION===17}function C2e(t){R2e(t)&&(t[MA]={previousValue:String(t.value),tracked:[]})}function A2e(t,e){var n,r;(r=t[MA])===null||r===void 0||(n=r.tracked)===null||n===void 0||n.push(e),t[MA]||(N8(t),Wx(t,{focusOffset:e.length}))}function M2e(t,e){var n;const r=t[MA];if(t[MA]=void 0,!(!(r==null||(n=r.tracked)===null||n===void 0)&&n.length))return;const i=r.tracked.length===2&&r.tracked[0]===r.previousValue&&r.tracked[1]===t.value;i||N8(t),y2e(t)&&Wx(t,{focusOffset:i?e:t.value.length})}function sne(t){const e=k2e(t);if(e&&W0(e))return{type:"input",selection:AA(e)};const n=e?.ownerDocument.getSelection();return{type:TA(t)&&n?.anchorNode&&TA(n.anchorNode)?"contenteditable":"default",selection:n}}function k2e(t){return t.nodeType===1?t:t.parentElement}function O2e(t){const e=sne(t);if(e.type==="input")return e.selection;if(e.type==="contenteditable"){var n;return(n=e.selection)===null||n===void 0?void 0:n.getRangeAt(0)}}function U1({focusNode:t,focusOffset:e,anchorNode:n=t,anchorOffset:r=e}){var i,s;if(sne(t).type==="input")return Wx(t,{anchorOffset:r,focusOffset:e});(s=n.ownerDocument)===null||s===void 0||(i=s.getSelection())===null||i===void 0||i.setBaseAndExtent(n,r,t,e)}function one(t){return Ci(t,"input")&&["date","time"].includes(t.type)}function ax(t,e,n,r="insertText"){const i=O2e(e);i&&(!one(e)&&!t.dispatchUIEvent(e,"beforeinput",{inputType:r,data:n})||("startContainer"in i?I2e(t,e,i,n,r):N2e(t,e,i,n,r)))}function I2e(t,e,n,r,i){let s=!1;if(!n.collapsed)s=!0,n.deleteContents();else if(["deleteContentBackward","deleteContentForward"].includes(i)){const o=ine(n.startContainer,n.startOffset,i==="deleteContentBackward"?-1:1,i);if(o){s=!0;const a=n.cloneRange();a.comparePoint(o.node,o.offset)<0?a.setStart(o.node,o.offset):a.setEnd(o.node,o.offset),a.deleteContents()}}if(r)if(n.endContainer.nodeType===3){const o=n.endOffset;n.endContainer.insertData(o,r),n.setStart(n.endContainer,o+r.length),n.setEnd(n.endContainer,o+r.length)}else{const o=e.ownerDocument.createTextNode(r);n.insertNode(o),n.setStart(o,r.length),n.setEnd(o,r.length)}(s||r)&&t.dispatchUIEvent(e,"input",{inputType:i})}function N2e(t,e,n,r,i){let s=r;if(S2e(e)){const l=E2e(e);if(l!==void 0&&r.length>0){const u=l-e.value.length;if(u>0)s=r.substring(0,u);else return}}const{newValue:o,newOffset:a,oldValue:c}=P2e(s,e,n,i);o===c&&a===n.startOffset&&a===n.endOffset||Ci(e,"input",{type:"number"})&&!D2e(o)||(g2e(e,o),U1({focusNode:e,anchorOffset:a,focusOffset:a}),one(e)?nne(e,o)&&(WG(t,e,a,{}),t.dispatchUIEvent(e,"change"),tne(e)):WG(t,e,a,{data:r,inputType:i}))}function P2e(t,e,{startOffset:n,endOffset:r},i){const s=K0(e),o=Math.max(0,n===r&&i==="deleteContentBackward"?n-1:n),a=s.substring(0,o),c=Math.min(s.length,n===r&&i==="deleteContentForward"?n+1:r),l=s.substring(c,s.length);let u=`${a}${t}${l}`,h=o+t.length;if(Ci(e,"input",{type:"time"})){const d=b2e(u);d!==""&&nne(e,d)&&(u=d,h=d.length)}return{oldValue:s,newValue:u,newOffset:h}}function WG(t,e,n,r){t.dispatchUIEvent(e,"input",r),M2e(e,n)}function D2e(t){var e,n;const r=t.split("e",2);return!(/[^\d.\-e]/.test(t)||Number((e=t.match(/-/g))===null||e===void 0?void 0:e.length)>2||Number((n=t.match(/\./g))===null||n===void 0?void 0:n.length)>1||r[1]&&!/^-?\d*$/.test(r[1]))}Xy.cut=(t,e,n)=>()=>{ix(e)&&ax(n,e,"","deleteByCut")};function L2e(t){return t?D1(t)?t.textContent:K0(t):null}function U2e(t){const e=fm(t);for(let n=t;n?.ownerDocument;n=n.parentElement){const{display:r,visibility:i}=e.getComputedStyle(n);if(r==="none"||i==="hidden")return!1}return!0}function B2e(t,e){const n=t.ownerDocument,r=n.querySelectorAll(yte),i=Array.from(r).filter(c=>c===t||!(Number(c.getAttribute("tabindex"))<0||Av(c)));Number(t.getAttribute("tabindex"))>=0&&i.sort((c,l)=>{const u=Number(c.getAttribute("tabindex")),h=Number(l.getAttribute("tabindex"));return u===h?0:u===0?1:h===0?-1:u-h});const s={};let o=[n.body];const a=Ci(t,"input",{type:"radio"})?t.name:void 0;i.forEach(c=>{const l=c;if(Ci(l,"input",{type:"radio"})&&l.name){if(l===t){o.push(l);return}else if(l.name===a)return;if(l.checked){o=o.filter(u=>!Ci(u,"input",{type:"radio",name:l.name})),o.push(l),s[l.name]=l;return}if(typeof s[l.name]<"u")return}o.push(l)});for(let c=o.findIndex(l=>l===t);;)if(c+=e?-1:1,c===o.length?c=0:c===-1&&(c=o.length-1),o[c]===t||o[c]===n.body||U2e(o[c]))return o[c]}function KG(t,e){if(W0(t)){const n=AA(t);U1({focusNode:t,focusOffset:n.startOffset===n.endOffset?n.focusOffset+e:e<0?n.startOffset:n.endOffset})}else{const n=t.ownerDocument.getSelection();if(!n?.focusNode)return;if(n.isCollapsed){const r=ine(n.focusNode,n.focusOffset,e);r&&U1({focusNode:r.node,focusOffset:r.offset})}else n[e<0?"collapseToStart":"collapseToEnd"]()}}function ane(t){if(W0(t))return U1({focusNode:t,anchorOffset:0,focusOffset:K0(t).length});var e;const n=(e=TA(t))!==null&&e!==void 0?e:t.ownerDocument.body;U1({focusNode:n,anchorOffset:0,focusOffset:n.childNodes.length})}function F2e(t){if(W0(t))return AA(t).startOffset===0&&AA(t).endOffset===K0(t).length;var e;const n=(e=TA(t))!==null&&e!==void 0?e:t.ownerDocument.body,r=t.ownerDocument.getSelection();return r?.anchorNode===n&&r.focusNode===n&&r.anchorOffset===0&&r.focusOffset===n.childNodes.length}function HC(t,e,n){var r;if(W0(t))return U1({focusNode:t,anchorOffset:e,focusOffset:n});if(D1(t)&&((r=t.firstChild)===null||r===void 0?void 0:r.nodeType)===3)return U1({focusNode:t.firstChild,anchorOffset:e,focusOffset:n});throw new Error("Not implemented. The result of this interaction is unreliable.")}function lk(t,e,n){const r=fm(e),i=Array.from(e.ownerDocument.querySelectorAll(e.name?`input[type="radio"][name="${r.CSS.escape(e.name)}"]`:'input[type="radio"][name=""], input[type="radio"]:not([name])'));for(let s=i.findIndex(o=>o===e)+n;;s+=n){if(i[s]||(s=n>0?0:i.length-1),i[s]===e)return;if(!Av(i[s])){Ky(i[s]),t.dispatchUIEvent(i[s],"click");return}}}Xy.keydown=(t,e,n)=>{var r,i;return(i=(r=XG[t.key])===null||r===void 0?void 0:r.call(XG,t,e,n))!==null&&i!==void 0?i:j2e(t,e,n)};const XG={ArrowDown:(t,e,n)=>{if(Ci(e,"input",{type:"radio"}))return()=>lk(n,e,1)},ArrowLeft:(t,e,n)=>Ci(e,"input",{type:"radio"})?()=>lk(n,e,-1):()=>KG(e,-1),ArrowRight:(t,e,n)=>Ci(e,"input",{type:"radio"})?()=>lk(n,e,1):()=>KG(e,1),ArrowUp:(t,e,n)=>{if(Ci(e,"input",{type:"radio"}))return()=>lk(n,e,-1)},Backspace:(t,e,n)=>{if(ix(e))return()=>{ax(n,e,"","deleteContentBackward")}},Delete:(t,e,n)=>{if(ix(e))return()=>{ax(n,e,"","deleteContentForward")}},End:(t,e)=>{if(Ci(e,["input","textarea"])||D1(e))return()=>{var n,r;const i=(r=(n=L2e(e))===null||n===void 0?void 0:n.length)!==null&&r!==void 0?r:0;HC(e,i,i)}},Home:(t,e)=>{if(Ci(e,["input","textarea"])||D1(e))return()=>{HC(e,0,0)}},PageDown:(t,e)=>{if(Ci(e,["input"]))return()=>{const n=K0(e).length;HC(e,n,n)}},PageUp:(t,e)=>{if(Ci(e,["input"]))return()=>{HC(e,0,0)}},Tab:(t,e,n)=>()=>{const r=B2e(e,n.system.keyboard.modifiers.Shift);Ky(r),W0(r)&&Wx(r,{anchorOffset:0,focusOffset:r.value.length})}},j2e=(t,e,n)=>{if(t.code==="KeyA"&&n.system.keyboard.modifiers.Control)return()=>ane(e)};Xy.keypress=(t,e,n)=>{if(t.key==="Enter"){if(Ci(e,"button")||Ci(e,"input")&&z2e.includes(e.type)||Ci(e,"a")&&e.href)return()=>{n.dispatchUIEvent(e,"click")};if(Ci(e,"input")){const r=e.form,i=r?.querySelector('input[type="submit"], button:not([type]), button[type="submit"]');return i?()=>n.dispatchUIEvent(i,"click"):r&&H2e.includes(e.type)&&r.querySelectorAll("input").length===1?()=>n.dispatchUIEvent(r,"submit"):void 0}}if(ix(e)){const r=t.key==="Enter"?D1(e)&&!n.system.keyboard.modifiers.Shift?"insertParagraph":"insertLineBreak":"insertText",i=t.key==="Enter"?`
`:t.key;return()=>ax(n,e,i,r)}};const z2e=["button","color","file","image","reset","submit"],H2e=["email","month","password","search","tel","text","url","week"];Xy.keyup=(t,e,n)=>{var r;return(r=YG[t.key])===null||r===void 0?void 0:r.call(YG,t,e,n)};const YG={" ":(t,e,n)=>{if(Ete(e))return()=>n.dispatchUIEvent(e,"click")}};Xy.paste=(t,e,n)=>{if(ix(e))return()=>{var r;const i=(r=t.clipboardData)===null||r===void 0?void 0:r.getData("text");i&&ax(n,e,i,"insertFromPaste")}};const cne={auxclick:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},beforeinput:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},blur:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},click:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},contextmenu:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},copy:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},change:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},cut:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dblclick:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},focus:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},focusin:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},focusout:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},keydown:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keypress:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keyup:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},paste:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},input:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},mousedown:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseenter:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseleave:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mousemove:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseout:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseover:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseup:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerover:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerenter:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},pointerdown:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointermove:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerup:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointercancel:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},pointerout:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerleave:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},submit:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}}};function lne(t){return cne[t].EventType}const q2e=["MouseEvent","PointerEvent"];function V2e(t){return q2e.includes(lne(t))}function G2e(t){return lne(t)==="KeyboardEvent"}const $2e={ClipboardEvent:[K2e],Event:[],FocusEvent:[cC,X2e],InputEvent:[cC,Y2e],MouseEvent:[cC,sL,ZG],PointerEvent:[cC,sL,ZG,J2e],KeyboardEvent:[cC,sL,Z2e]};function une(t,e,n){const r=fm(e),{EventType:i,defaultInit:s}=cne[t],o=new(W2e(r))[i](t,s);return $2e[i].forEach(a=>a(o,n??{})),o}function W2e(t){var e;const n=(e=t.Event)!==null&&e!==void 0?e:class{};var r;const i=(r=t.AnimationEvent)!==null&&r!==void 0?r:class extends n{};var s;const o=(s=t.ClipboardEvent)!==null&&s!==void 0?s:class extends n{};var a;const c=(a=t.PopStateEvent)!==null&&a!==void 0?a:class extends n{};var l;const u=(l=t.ProgressEvent)!==null&&l!==void 0?l:class extends n{};var h;const d=(h=t.TransitionEvent)!==null&&h!==void 0?h:class extends n{};var m;const p=(m=t.UIEvent)!==null&&m!==void 0?m:class extends n{};var g;const y=(g=t.CompositionEvent)!==null&&g!==void 0?g:class extends p{};var v;const x=(v=t.FocusEvent)!==null&&v!==void 0?v:class extends p{};var E;const C=(E=t.InputEvent)!==null&&E!==void 0?E:class extends p{};var A;const k=(A=t.KeyboardEvent)!==null&&A!==void 0?A:class extends p{};var M;const I=(M=t.MouseEvent)!==null&&M!==void 0?M:class extends p{};var z;const H=(z=t.DragEvent)!==null&&z!==void 0?z:class extends I{};var K;const P=(K=t.PointerEvent)!==null&&K!==void 0?K:class extends I{};var F;const N=(F=t.TouchEvent)!==null&&F!==void 0?F:class extends p{};return{Event:n,AnimationEvent:i,ClipboardEvent:o,PopStateEvent:c,ProgressEvent:u,TransitionEvent:d,UIEvent:p,CompositionEvent:y,FocusEvent:x,InputEvent:C,KeyboardEvent:k,MouseEvent:I,DragEvent:H,PointerEvent:P,TouchEvent:N}}function ub(t,e){for(const[n,r]of Object.entries(e))Object.defineProperty(t,n,{get:()=>r??null})}function tc(t){return Number(t??0)}function K2e(t,{clipboardData:e}){ub(t,{clipboardData:e})}function X2e(t,{relatedTarget:e}){ub(t,{relatedTarget:e})}function Y2e(t,{data:e,inputType:n,isComposing:r}){ub(t,{data:e,isComposing:!!r,inputType:String(n)})}function cC(t,{view:e,detail:n}){ub(t,{view:e,detail:tc(n??0)})}function sL(t,{altKey:e,ctrlKey:n,metaKey:r,shiftKey:i,modifierAltGraph:s,modifierCapsLock:o,modifierFn:a,modifierFnLock:c,modifierNumLock:l,modifierScrollLock:u,modifierSymbol:h,modifierSymbolLock:d}){ub(t,{altKey:!!e,ctrlKey:!!n,metaKey:!!r,shiftKey:!!i,getModifierState(m){return!!{Alt:e,AltGraph:s,CapsLock:o,Control:n,Fn:a,FnLock:c,Meta:r,NumLock:l,ScrollLock:u,Shift:i,Symbol:h,SymbolLock:d}[m]}})}function Z2e(t,{key:e,code:n,location:r,repeat:i,isComposing:s,charCode:o}){ub(t,{key:String(e),code:String(n),location:tc(r),repeat:!!i,isComposing:!!s,charCode:o})}function ZG(t,{x:e,y:n,screenX:r,screenY:i,clientX:s=e,clientY:o=n,button:a,buttons:c,relatedTarget:l,offsetX:u,offsetY:h,pageX:d,pageY:m}){ub(t,{screenX:tc(r),screenY:tc(i),clientX:tc(s),x:tc(s),clientY:tc(o),y:tc(o),button:tc(a),buttons:tc(c),relatedTarget:l,offsetX:tc(u),offsetY:tc(h),pageX:tc(d),pageY:tc(m)})}function J2e(t,{pointerId:e,width:n,height:r,pressure:i,tangentialPressure:s,tiltX:o,tiltY:a,twist:c,pointerType:l,isPrimary:u}){ub(t,{pointerId:tc(e),width:tc(n??1),height:tc(r??1),pressure:tc(i),tangentialPressure:tc(s),tiltX:tc(o),tiltY:tc(a),twist:tc(c),pointerType:String(l),isPrimary:!!u})}function Q2e(t,e,n,r=!1){(V2e(e)||G2e(e))&&(n={...n,...this.system.getUIEventModifiers()});const i=une(e,t,n);return fne.call(this,t,i,r)}function fne(t,e,n=!1){var r;const i=e.type,s=n?()=>{}:(r=Xy[i])===null||r===void 0?void 0:r.call(Xy,e,t,this);if(s){e.preventDefault();let o=!1;return Object.defineProperty(e,"defaultPrevented",{get:()=>o}),Object.defineProperty(e,"preventDefault",{value:()=>{o=e.cancelable}}),sx(()=>t.dispatchEvent(e)),o||s(),!o}return sx(()=>t.dispatchEvent(e))}function n1(t,e,n){const r=une(e,t,n);sx(()=>t.dispatchEvent(r))}const JG=Symbol("patched focus/blur methods");function hne(t){if(t.prototype[JG])return;const{focus:e,blur:n}=t.prototype;Object.defineProperties(t.prototype,{focus:{configurable:!0,get:()=>i},blur:{configurable:!0,get:()=>s},[JG]:{configurable:!0,get:()=>({focus:e,blur:n})}});let r;function i(o){if(this.ownerDocument.visibilityState!=="hidden")return e.call(this,o);const a=QG(this.ownerDocument);if(a===this)return;const c=Symbol("focus call");r=c,a&&(n.call(a),n1(a,"blur",{relatedTarget:this}),n1(a,"focusout",{relatedTarget:r===c?this:null})),r===c&&(e.call(this,o),n1(this,"focus",{relatedTarget:a})),r===c&&n1(this,"focusin",{relatedTarget:a})}function s(){if(this.ownerDocument.visibilityState!=="hidden")return n.call(this);const o=QG(this.ownerDocument);if(o!==this)return;r=Symbol("blur call"),n.call(this),n1(o,"blur",{relatedTarget:null}),n1(o,"focusout",{relatedTarget:null})}}function QG(t){const e=TM(t);return e?.tagName==="BODY"?null:e}const oL=Symbol("Interceptor for programmatical calls");function CS(t,e,n){const r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=Object.getOwnPropertyDescriptor(t,e),s=r?.set?"set":"value";if(typeof r?.[s]!="function"||r[s][oL])throw new Error(`Element ${t.tagName} does not implement "${String(e)}".`);function o(...a){const{applyNative:c=!1,realArgs:l,then:u}=n.call(this,...a),h=(!c&&i||r)[s];s==="set"?h.call(this,l):h.call(this,...l),u?.()}o[oL]=oL,Object.defineProperty(t,e,{...i??r,[s]:o})}function eke(t){CS(t,"value",function(n){const r=p2e(n);return r&&C2e(this),{applyNative:!!r,realArgs:tke(this,n),then:r?void 0:()=>A2e(this,String(n))}})}function tke(t,e){return Ci(t,"input",{type:"number"})&&String(e)!==""&&!Number.isNaN(Number(e))?String(Number(e)):String(e)}function nke(t){CS(t,"setSelectionRange",function(n,...r){const i=m2e(n);return{applyNative:!!i,realArgs:[Number(n),...r],then:()=>i?void 0:TO(t)}}),CS(t,"selectionStart",function(n){return{realArgs:n,then:()=>TO(t)}}),CS(t,"selectionEnd",function(n){return{realArgs:n,then:()=>TO(t)}}),CS(t,"select",function(){return{realArgs:[],then:()=>v2e(t,{anchorOffset:0,focusOffset:K0(t).length})}})}function rke(t){CS(t,"setRangeText",function(...n){return{realArgs:n,then:()=>{N8(t),TO(t)}}})}const BS=Symbol("Node prepared with document state workarounds");function dne(t){t[BS]||(t.addEventListener("focus",e=>{const n=e.target;e$(n)},{capture:!0,passive:!0}),t.activeElement&&e$(t.activeElement),t.addEventListener("blur",e=>{const n=e.target,r=_2e(n);r!==void 0&&(n.value!==r&&n1(n,"change"),tne(n))},{capture:!0,passive:!0}),t[BS]=BS)}function e$(t){t[BS]||(Ci(t,["input","textarea"])&&(eke(t),nke(t),rke(t)),t[BS]=BS)}function ike(t){return ske(t)?t:t.ownerDocument}function ske(t){return t.nodeType===9}var Nd=(function(t){return t[t.Trigger=2]="Trigger",t[t.Call=1]="Call",t})({});function qC(t,e){t.levelRefs[e]={}}function uk(t,e){return t.levelRefs[e]}function cx(t){const e=t.delay;if(typeof e=="number")return Promise.all([new Promise(n=>globalThis.setTimeout(()=>n(),e)),t.advanceTimers(e)])}var RO=(function(t){return t[t.EachTrigger=4]="EachTrigger",t[t.EachApiCall=2]="EachApiCall",t[t.EachTarget=1]="EachTarget",t[t.Never=0]="Never",t})({});function Bb(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var n0=(function(t){return t[t.STANDARD=0]="STANDARD",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.NUMPAD=3]="NUMPAD",t})({});const oke=["Alt","AltGraph","Control","Fn","Meta","Shift","Symbol"];function t$(t){return oke.includes(t)}const ake=["CapsLock","FnLock","NumLock","ScrollLock","SymbolLock"];function n$(t){return ake.includes(t)}class cke{isKeyPressed(e){return this.pressed.has(String(e.code))}getPressedKeys(){return this.pressed.values().map(e=>e.keyDef)}async keydown(e,n){const r=String(n.key),i=String(n.code),s=JD(e.config.document);this.setKeydownTarget(s),this.pressed.add(i,n),t$(r)&&(this.modifiers[r]=!0);const o=e.dispatchUIEvent(s,"keydown",{key:r,code:i});n$(r)&&!this.modifiers[r]&&(this.modifiers[r]=!0,this.modifierLockStart[r]=!0),o&&this.pressed.setUnprevented(i),o&&this.hasKeyPress(r)&&e.dispatchUIEvent(JD(e.config.document),"keypress",{key:r,code:i,charCode:n.key==="Enter"?13:String(n.key).charCodeAt(0)})}async keyup(e,n){const r=String(n.key),i=String(n.code),s=this.pressed.isUnprevented(i);this.pressed.delete(i),t$(r)&&!this.pressed.values().find(o=>o.keyDef.key===r)&&(this.modifiers[r]=!1),e.dispatchUIEvent(JD(e.config.document),"keyup",{key:r,code:i},!s),n$(r)&&this.modifiers[r]&&(this.modifierLockStart[r]?this.modifierLockStart[r]=!1:this.modifiers[r]=!1)}setKeydownTarget(e){e!==this.lastKeydownTarget&&(this.carryChar=""),this.lastKeydownTarget=e}hasKeyPress(e){return(e.length===1||e==="Enter")&&!this.modifiers.Control&&!this.modifiers.Alt}constructor(e){Bb(this,"system",void 0),Bb(this,"modifiers",{Alt:!1,AltGraph:!1,CapsLock:!1,Control:!1,Fn:!1,FnLock:!1,Meta:!1,NumLock:!1,ScrollLock:!1,Shift:!1,Symbol:!1,SymbolLock:!1}),Bb(this,"pressed",new class{add(n,r){var i,s,o;(o=(i=this.registry)[s=n])!==null&&o!==void 0||(i[s]={keyDef:r,unpreventedDefault:!1})}has(n){return!!this.registry[n]}setUnprevented(n){const r=this.registry[n];r&&(r.unpreventedDefault=!0)}isUnprevented(n){var r;return!!(!((r=this.registry[n])===null||r===void 0)&&r.unpreventedDefault)}delete(n){delete this.registry[n]}values(){return Object.values(this.registry)}constructor(){Bb(this,"registry",{})}}),Bb(this,"carryChar",""),Bb(this,"lastKeydownTarget",void 0),Bb(this,"modifierLockStart",{}),this.system=e}}const lke=[..."0123456789".split("").map(t=>({code:`Digit${t}`,key:t})),...")!@#$%^&*(".split("").map((t,e)=>({code:`Digit${e}`,key:t,shiftKey:!0})),..."abcdefghijklmnopqrstuvwxyz".split("").map(t=>({code:`Key${t.toUpperCase()}`,key:t})),..."ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").map(t=>({code:`Key${t}`,key:t,shiftKey:!0})),{code:"BracketLeft",key:"["},{code:"BracketLeft",key:"{",shiftKey:!0},{code:"BracketRight",key:"]"},{code:"BracketRight",key:"}",shiftKey:!0},{code:"Space",key:" "},{code:"AltLeft",key:"Alt",location:n0.LEFT},{code:"AltRight",key:"Alt",location:n0.RIGHT},{code:"ShiftLeft",key:"Shift",location:n0.LEFT},{code:"ShiftRight",key:"Shift",location:n0.RIGHT},{code:"ControlLeft",key:"Control",location:n0.LEFT},{code:"ControlRight",key:"Control",location:n0.RIGHT},{code:"MetaLeft",key:"Meta",location:n0.LEFT},{code:"MetaRight",key:"Meta",location:n0.RIGHT},{code:"OSLeft",key:"OS",location:n0.LEFT},{code:"OSRight",key:"OS",location:n0.RIGHT},{code:"ContextMenu",key:"ContextMenu"},{code:"Tab",key:"Tab"},{code:"CapsLock",key:"CapsLock"},{code:"Backspace",key:"Backspace"},{code:"Enter",key:"Enter"},{code:"Escape",key:"Escape"},{code:"ArrowUp",key:"ArrowUp"},{code:"ArrowDown",key:"ArrowDown"},{code:"ArrowLeft",key:"ArrowLeft"},{code:"ArrowRight",key:"ArrowRight"},{code:"Home",key:"Home"},{code:"End",key:"End"},{code:"Delete",key:"Delete"},{code:"PageUp",key:"PageUp"},{code:"PageDown",key:"PageDown"},{code:"Fn",key:"Fn"},{code:"Symbol",key:"Symbol"},{code:"AltRight",key:"AltGraph"}],uke=[{name:"MouseLeft",pointerType:"mouse",button:"primary"},{name:"MouseRight",pointerType:"mouse",button:"secondary"},{name:"MouseMiddle",pointerType:"mouse",button:"auxiliary"},{name:"TouchA",pointerType:"touch"},{name:"TouchB",pointerType:"touch"},{name:"TouchC",pointerType:"touch"}];function fke(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class pne{getButtons(){let e=0;for(const n of Object.keys(this.pressed))e|=2**Number(n);return e}down(e){const n=t5(e.button);if(n in this.pressed){this.pressed[n].push(e);return}return this.pressed[n]=[e],n}up(e){const n=t5(e.button);if(n in this.pressed&&(this.pressed[n]=this.pressed[n].filter(r=>r.name!==e.name),this.pressed[n].length===0))return delete this.pressed[n],n}constructor(){fke(this,"pressed",{})}}const r$={primary:0,secondary:1,auxiliary:2,back:3,X1:3,forward:4,X2:4};function t5(t=0){return t in r$?r$[t]:Number(t)}const i$={1:2,2:1};function n5(t){return t=t5(t),t in i$?i$[t]:t}function hke(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class dke{get countPressed(){return this.pressedKeys.size}isPressed(e){return this.pressedKeys.has(e.name)}addPressed(e){return this.pressedKeys.add(e.name)}removePressed(e){return this.pressedKeys.delete(e.name)}constructor(){hke(this,"pressedKeys",new Set)}}function iA(t,e){const n=[];for(let s=t;s;s=s.parentElement)n.push(s);const r=[];for(let s=e;s;s=s.parentElement)r.push(s);let i=0;for(;!(i>=n.length||i>=r.length||n[n.length-1-i]!==r[r.length-1-i]);i++);return[n.slice(0,n.length-i),r.slice(0,r.length-i),r.slice(r.length-i)]}function r5({target:t,node:e,offset:n}){return W0(t)?{node:t,offset:n??K0(t).length}:e?{node:e,offset:n??(e.nodeType===3?e.nodeValue.length:e.childNodes.length)}:mne(t,n)}function mne(t,e,n=!0){let r=e===void 0?t.childNodes.length-1:0;const i=e===void 0?-1:1;for(;e===void 0?r>=(n?Math.max(t.childNodes.length-1,0):0):r<=t.childNodes.length;){if(e&&r===t.childNodes.length)throw new Error("The given offset is out of bounds.");const s=t.childNodes.item(r),o=String(s.textContent);if(o.length)if(e!==void 0&&o.length<e)e-=o.length;else{if(s.nodeType===1)return mne(s,e,!1);if(s.nodeType===3)return{node:s,offset:e??s.nodeValue.length}}r+=i}return{node:t,offset:t.childNodes.length}}function pke({document:t,target:e,clickCount:n,node:r,offset:i}){if(lTe(e))return;const s=W0(e),o=String(s?K0(e):e.textContent),[a,c]=r?[i,i]:mke(o,i,n);if(s)return Wx(e,{anchorOffset:a??o.length,focusOffset:c??o.length}),{node:e,start:a??0,end:c??o.length};{const{node:l,offset:u}=r5({target:e,node:r,offset:a}),{node:h,offset:d}=r5({target:e,node:r,offset:c}),m=e.ownerDocument.createRange();try{m.setStart(l,u),m.setEnd(h,d)}catch{throw new Error("The given offset is out of bounds.")}const p=t.getSelection();return p?.removeAllRanges(),p?.addRange(m.cloneRange()),m}}function mke(t,e,n){if(n%3===1||t.length===0)return[e,e];const r=e??t.length;return n%3===2?[r-t.substr(0,e).match(/(\w+|\s+|\W)?$/)[0].length,e===void 0?e:e+t.substr(e).match(/^(\w+|\s+|\W)?/)[0].length]:[r-t.substr(0,e).match(/[^\r\n]*$/)[0].length,e===void 0?e:e+t.substr(e).match(/^[^\r\n]*/)[0].length]}function gke(t,{document:e,target:n,node:r,offset:i}){const s=r5({target:n,node:r,offset:i});if("node"in t){if(s.node===t.node){const o=s.offset<t.start?t.end:t.start,a=s.offset>t.end||s.offset<t.start?s.offset:t.end;Wx(t.node,{anchorOffset:o,focusOffset:a})}}else{const o=t.cloneRange(),a=o.comparePoint(s.node,s.offset);a<0?o.setStart(s.node,s.offset):a>0&&o.setEnd(s.node,s.offset);const c=e.getSelection();c?.removeAllRanges(),c?.addRange(o.cloneRange())}}function gne(t,e){var n,r,i,s,o,a,c,l,u,h,d,m,p,g,y,v,x,E,C,A,k,M,I,z;return t.target!==e.target||((n=t.coords)===null||n===void 0?void 0:n.x)!==((r=e.coords)===null||r===void 0?void 0:r.x)||((i=t.coords)===null||i===void 0?void 0:i.y)!==((s=e.coords)===null||s===void 0?void 0:s.y)||((o=t.coords)===null||o===void 0?void 0:o.clientX)!==((a=e.coords)===null||a===void 0?void 0:a.clientX)||((c=t.coords)===null||c===void 0?void 0:c.clientY)!==((l=e.coords)===null||l===void 0?void 0:l.clientY)||((u=t.coords)===null||u===void 0?void 0:u.offsetX)!==((h=e.coords)===null||h===void 0?void 0:h.offsetX)||((d=t.coords)===null||d===void 0?void 0:d.offsetY)!==((m=e.coords)===null||m===void 0?void 0:m.offsetY)||((p=t.coords)===null||p===void 0?void 0:p.pageX)!==((g=e.coords)===null||g===void 0?void 0:g.pageX)||((y=t.coords)===null||y===void 0?void 0:y.pageY)!==((v=e.coords)===null||v===void 0?void 0:v.pageY)||((x=t.coords)===null||x===void 0?void 0:x.screenX)!==((E=e.coords)===null||E===void 0?void 0:E.screenX)||((C=t.coords)===null||C===void 0?void 0:C.screenY)!==((A=e.coords)===null||A===void 0?void 0:A.screenY)||((k=t.caret)===null||k===void 0?void 0:k.node)!==((M=e.caret)===null||M===void 0?void 0:M.node)||((I=t.caret)===null||I===void 0?void 0:I.offset)!==((z=e.caret)===null||z===void 0?void 0:z.offset)}function Fb(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class _ke{move(e,n,r){const i=this.position,s=this.getTarget(e);if(this.position=n,!gne(i,n))return;const o=this.getTarget(e),a=this.getEventInit("mousemove"),[c,l]=iA(s,o);return{leave:()=>{s!==o&&(e.dispatchUIEvent(s,"mouseout",a),c.forEach(u=>e.dispatchUIEvent(u,"mouseleave",a)))},enter:()=>{s!==o&&(e.dispatchUIEvent(o,"mouseover",a),l.forEach(u=>e.dispatchUIEvent(u,"mouseenter",a)))},move:()=>{r||(e.dispatchUIEvent(o,"mousemove",a),this.modifySelecting(e))}}}down(e,n,r){const i=this.buttons.down(n);if(i===void 0)return;const s=this.getTarget(e);this.buttonDownTarget[i]=s;const o=this.getEventInit("mousedown",n.button),a=Av(s);!r&&(a||e.dispatchUIEvent(s,"mousedown",o))&&(this.startSelecting(e,o.detail),Ky(s)),!a&&n5(n.button)===2&&e.dispatchUIEvent(s,"contextmenu",this.getEventInit("contextmenu",n.button))}up(e,n,r){const i=this.buttons.up(n);if(i===void 0)return;const s=this.getTarget(e);if(!Av(s)){if(!r){const a=this.getEventInit("mouseup",n.button);e.dispatchUIEvent(s,"mouseup",a),this.endSelecting()}const o=iA(this.buttonDownTarget[i],s)[2][0];if(o){const a=this.getEventInit("click",n.button);a.detail&&(e.dispatchUIEvent(o,a.button===0?"click":"auxclick",a),a.button===0&&a.detail===2&&e.dispatchUIEvent(o,"dblclick",{...this.getEventInit("dblclick",n.button),detail:a.detail}))}}}resetClickCount(){this.clickCount.reset()}getEventInit(e,n){const r={...this.position.coords};return r.button=n5(n),r.buttons=this.buttons.getButtons(),e==="mousedown"?r.detail=this.clickCount.getOnDown(r.button):e==="mouseup"?r.detail=this.clickCount.getOnUp(r.button):(e==="click"||e==="auxclick")&&(r.detail=this.clickCount.incOnClick(r.button)),r}getTarget(e){var n;return(n=this.position.target)!==null&&n!==void 0?n:e.config.document.body}startSelecting(e,n){var r,i;this.selecting=pke({document:e.config.document,target:this.getTarget(e),node:(r=this.position.caret)===null||r===void 0?void 0:r.node,offset:(i=this.position.caret)===null||i===void 0?void 0:i.offset,clickCount:n})}modifySelecting(e){var n,r;this.selecting&&gke(this.selecting,{document:e.config.document,target:this.getTarget(e),node:(n=this.position.caret)===null||n===void 0?void 0:n.node,offset:(r=this.position.caret)===null||r===void 0?void 0:r.offset})}endSelecting(){this.selecting=void 0}constructor(){Fb(this,"position",{}),Fb(this,"buttons",new pne),Fb(this,"selecting",void 0),Fb(this,"buttonDownTarget",{}),Fb(this,"clickCount",new class{incOnClick(e){const n=this.down[e]===void 0?void 0:Number(this.down[e])+1;return this.count=this.count[e]===void 0?{}:{[e]:Number(this.count[e])+1},n}getOnDown(e){var n;this.down={[e]:(n=this.count[e])!==null&&n!==void 0?n:0};var r;return this.count={[e]:(r=this.count[e])!==null&&r!==void 0?r:0},Number(this.count[e])+1}getOnUp(e){return this.down[e]===void 0?void 0:Number(this.down[e])+1}reset(){this.count={}}constructor(){Fb(this,"down",{}),Fb(this,"count",{})}})}}function II(t,e){var n;return((n=_ne(t,e))===null||n===void 0?void 0:n.pointerEvents)!=="none"}function vke(t){const e=fm(t);for(let n=t,r=[];n?.ownerDocument;n=n.parentElement){r.push(n);const i=e.getComputedStyle(n).pointerEvents;if(i&&!["inherit","unset"].includes(i))return{pointerEvents:i,tree:r}}}const s$=Symbol("Last check for pointer-events");function _ne(t,e){const n=e[s$];if(!(t.config.pointerEventsCheck!==RO.Never&&(!n||o$(t.config.pointerEventsCheck,RO.EachApiCall)&&n[Nd.Call]!==uk(t,Nd.Call)||o$(t.config.pointerEventsCheck,RO.EachTrigger)&&n[Nd.Trigger]!==uk(t,Nd.Trigger))))return n?.result;const i=vke(e);return e[s$]={[Nd.Call]:uk(t,Nd.Call),[Nd.Trigger]:uk(t,Nd.Trigger),result:i},i}function VC(t,e){const n=_ne(t,e);if(n?.pointerEvents==="none")throw new Error([`Unable to perform pointer interaction as the element ${n.tree.length>1?"inherits":"has"} \`pointer-events: none\`:`,"",yke(n.tree)].join(`
`))}function yke(t){return t.reverse().map((e,n)=>["".padEnd(n),e.tagName,e.id&&`#${e.id}`,e.hasAttribute("data-testid")&&`(testId=${e.getAttribute("data-testid")})`,bke(e),t.length>1&&n===0&&"  <-- This element declared `pointer-events: none`",t.length>1&&n===t.length-1&&"  <-- Asserted pointer events here"].filter(Boolean).join("")).join(`
`)}function bke(t){var e;let n;if(t.hasAttribute("aria-label"))n=t.getAttribute("aria-label");else if(t.hasAttribute("aria-labelledby")){var r,i;n=(i=t.ownerDocument.getElementById(t.getAttribute("aria-labelledby")))===null||i===void 0||(r=i.textContent)===null||r===void 0?void 0:r.trim()}else if(Ci(t,["button","input","meter","output","progress","select","textarea"])&&(!((e=t.labels)===null||e===void 0)&&e.length))n=Array.from(t.labels).map(o=>{var a;return(a=o.textContent)===null||a===void 0?void 0:a.trim()}).join("|");else if(Ci(t,"button")){var s;n=(s=t.textContent)===null||s===void 0?void 0:s.trim()}return n=n?.replace(/\n/g,"  "),Number(n?.length)>30&&(n=`${n?.substring(0,29)}`),n?`(label=${n})`:""}function o$(t,e){return(t&e)>0}function q_(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class Eke{init(e){const n=this.getTarget(e),[,r]=iA(null,n),i=this.getEventInit();return VC(e,n),e.dispatchUIEvent(n,"pointerover",i),r.forEach(s=>e.dispatchUIEvent(s,"pointerenter",i)),this}move(e,n){const r=this.position,i=this.getTarget(e);if(this.position=n,!gne(r,n))return;const s=this.getTarget(e),o=this.getEventInit(-1),[a,c]=iA(i,s);return{leave:()=>{II(e,i)&&i!==s&&(e.dispatchUIEvent(i,"pointerout",o),a.forEach(l=>e.dispatchUIEvent(l,"pointerleave",o)))},enter:()=>{VC(e,s),i!==s&&(e.dispatchUIEvent(s,"pointerover",o),c.forEach(l=>e.dispatchUIEvent(l,"pointerenter",o)))},move:()=>{e.dispatchUIEvent(s,"pointermove",o)}}}down(e,n=0){if(this.isDown)return;const r=this.getTarget(e);VC(e,r),this.isDown=!0,this.isPrevented=!e.dispatchUIEvent(r,"pointerdown",this.getEventInit(n))}up(e,n=0){if(!this.isDown)return;const r=this.getTarget(e);VC(e,r),this.isPrevented=!1,this.isDown=!1,e.dispatchUIEvent(r,"pointerup",this.getEventInit(n))}release(e){const n=this.getTarget(e),[r]=iA(n,null),i=this.getEventInit();II(e,n)&&(e.dispatchUIEvent(n,"pointerout",i),r.forEach(s=>e.dispatchUIEvent(s,"pointerleave",i))),this.isCancelled=!0}getTarget(e){var n;return(n=this.position.target)!==null&&n!==void 0?n:e.config.document.body}getEventInit(e){return{...this.position.coords,pointerId:this.pointerId,pointerType:this.pointerType,isPrimary:this.isPrimary,button:n5(e),buttons:this.buttons.getButtons()}}constructor({pointerId:e,pointerType:n,isPrimary:r},i){q_(this,"pointerId",void 0),q_(this,"pointerType",void 0),q_(this,"isPrimary",void 0),q_(this,"buttons",void 0),q_(this,"isMultitouch",!1),q_(this,"isCancelled",!1),q_(this,"isDown",!1),q_(this,"isPrevented",!1),q_(this,"position",{}),this.pointerId=e,this.pointerType=n,this.isPrimary=r,this.isMultitouch=!r,this.buttons=i}}function py(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class Ske{isKeyPressed(e){return this.devices.get(e.pointerType).isPressed(e)}async press(e,n,r){this.devices.get(n.pointerType).addPressed(n),this.buttons.down(n);const i=this.getPointerName(n),s=n.pointerType==="touch"?this.pointers.new(i,n.pointerType,this.buttons):this.pointers.get(i);s.position=r,s.pointerType!=="touch"&&(this.mouse.position=r),s.pointerType==="touch"&&s.init(e),s.down(e,n.button),s.pointerType!=="touch"&&this.mouse.down(e,n,s.isPrevented)}async move(e,n,r){const i=this.pointers.get(n),s=i.move(e,r),o=i.pointerType==="touch"?void 0:this.mouse.move(e,r,i.isPrevented);s?.leave(),o?.leave(),s?.enter(),o?.enter(),s?.move(),o?.move()}async release(e,n,r){const i=this.devices.get(n.pointerType);i.removePressed(n),this.buttons.up(n);const s=this.pointers.get(this.getPointerName(n)),o=s.isPrevented;if(s.position=r,s.pointerType!=="touch"&&(this.mouse.position=r),i.countPressed===0&&s.up(e,n.button),s.pointerType==="touch"&&s.release(e),s.pointerType==="touch"&&!s.isMultitouch){const a=this.mouse.move(e,r,o);a?.leave(),a?.enter(),a?.move(),this.mouse.down(e,n,o)}if(!s.isMultitouch){const a=this.mouse.move(e,r,o);a?.leave(),a?.enter(),a?.move(),this.mouse.up(e,n,o)}}getPointerName(e){return e.pointerType==="touch"?e.name:e.pointerType}getPreviousPosition(e){return this.pointers.has(e)?this.pointers.get(e).position:void 0}resetClickCount(){this.mouse.resetClickCount()}getMouseTarget(e){var n;return(n=this.mouse.position.target)!==null&&n!==void 0?n:e.config.document.body}setMousePosition(e){this.mouse.position=e,this.pointers.get("mouse").position=e}constructor(e){py(this,"system",void 0),py(this,"mouse",void 0),py(this,"buttons",void 0),py(this,"devices",new class{get(n){var r,i,s;return(s=(r=this.registry)[i=n])!==null&&s!==void 0?s:r[i]=new dke}constructor(){py(this,"registry",{})}}),py(this,"pointers",new class{new(n,r,i){const s=r!=="touch"||!Object.values(this.registry).some(o=>o.pointerType==="touch"&&!o.isCancelled);return s||Object.values(this.registry).forEach(o=>{o.pointerType===r&&!o.isCancelled&&(o.isMultitouch=!0)}),this.registry[n]=new Eke({pointerId:this.nextId++,pointerType:r,isPrimary:s},i),this.registry[n]}get(n){if(!this.has(n))throw new Error(`Trying to access pointer "${n}" which does not exist.`);return this.registry[n]}has(n){return n in this.registry}constructor(){py(this,"registry",{}),py(this,"nextId",1)}}),this.system=e,this.buttons=new pne,this.mouse=new _ke,this.pointers.new("mouse","mouse",this.buttons)}}function a$(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class vne{getUIEventModifiers(){return{altKey:this.keyboard.modifiers.Alt,ctrlKey:this.keyboard.modifiers.Control,metaKey:this.keyboard.modifiers.Meta,shiftKey:this.keyboard.modifiers.Shift,modifierAltGraph:this.keyboard.modifiers.AltGraph,modifierCapsLock:this.keyboard.modifiers.CapsLock,modifierFn:this.keyboard.modifiers.Fn,modifierFnLock:this.keyboard.modifiers.FnLock,modifierNumLock:this.keyboard.modifiers.NumLock,modifierScrollLock:this.keyboard.modifiers.ScrollLock,modifierSymbol:this.keyboard.modifiers.Symbol,modifierSymbolLock:this.keyboard.modifiers.SymbolLock}}constructor(){a$(this,"keyboard",new cke(this)),a$(this,"pointer",new Ske(this))}}async function xke(t){const e=[];return this.config.skipHover||e.push({target:t}),e.push({keys:"[MouseLeft]",target:t}),this.pointer(e)}async function Tke(t){return this.pointer([{target:t},"[MouseLeft][MouseLeft]"])}async function wke(t){return this.pointer([{target:t},"[MouseLeft][MouseLeft][MouseLeft]"])}async function Rke(t){return this.pointer({target:t})}async function Cke(t){return VC(this,this.system.pointer.getMouseTarget(this)),this.pointer({target:t.ownerDocument.body})}async function Ake({shift:t}={}){return this.keyboard(t===!0?"{Shift>}{Tab}{/Shift}":t===!1?"[/ShiftLeft][/ShiftRight]{Tab}":"{Tab}")}var D8=(function(t){return t["{"]="}",t["["]="]",t})(D8||{});function yne(t,e){let n=0;const r=t[n]in D8?t[n]:"";n+=r.length;const s=new RegExp(`^\\${r}{2}`).test(t)?"":r;return{type:s,...s===""?Mke(t,n,e):kke(t,n,s,e)}}function Mke(t,e,n){const r=t[e];return bne(r,t,e,n),e+=r.length,{consumedLength:e,descriptor:r,releasePrevious:!1,releaseSelf:!0,repeat:1}}function kke(t,e,n,r){var i,s;const o=t[e]==="/"?"/":"";e+=o.length;const a=n==="{"&&t[e]==="\\";e+=Number(a);const c=a?t[e]:(i=t.slice(e).match(n==="{"?/^\w+|^[^}>/]/:/^\w+/))===null||i===void 0?void 0:i[0];bne(c,t,e,r),e+=c.length;var l;const u=(l=(s=t.slice(e).match(/^>\d+/))===null||s===void 0?void 0:s[0])!==null&&l!==void 0?l:"";e+=u.length;const h=t[e]==="/"||!u&&t[e]===">"?t[e]:"";e+=h.length;const d=D8[n],m=t[e]===d?d:"";if(!m)throw new Error(Ene([!u&&"repeat modifier",!h&&"release modifier",`"${d}"`].filter(Boolean).join(" or "),t[e],t,r));return e+=m.length,{consumedLength:e,descriptor:c,releasePrevious:!!o,repeat:u?Math.max(Number(u.substr(1)),1):1,releaseSelf:Oke(h,u)}}function bne(t,e,n,r){if(!t)throw new Error(Ene("key descriptor",e[n],e,r))}function Oke(t,e){if(t)return t==="/";if(e)return!1}function Ene(t,e,n,r){return`Expected ${t} but found "${e??""}" in "${n}"
    See ${r==="pointer"?"https://testing-library.com/docs/user-event/pointer#pressing-a-button-or-touching-the-screen":"https://testing-library.com/docs/user-event/keyboard"}
    for more information about how userEvent parses your input.`}function Ike(t,e){const n=[];do{const{type:i,descriptor:s,consumedLength:o,releasePrevious:a,releaseSelf:c=!0,repeat:l}=yne(e,"keyboard");var r;const u=(r=t.find(h=>{if(i==="["){var d;return((d=h.code)===null||d===void 0?void 0:d.toLowerCase())===s.toLowerCase()}else if(i==="{"){var m;return((m=h.key)===null||m===void 0?void 0:m.toLowerCase())===s.toLowerCase()}return h.key===s}))!==null&&r!==void 0?r:{key:"Unknown",code:"Unknown",[i==="["?"code":"key"]:s};n.push({keyDef:u,releasePrevious:a,releaseSelf:c,repeat:l}),e=e.slice(o)}while(e);return n}async function Nke(t){const e=Ike(this.config.keyboardMap,t);for(let n=0;n<e.length;n++)await cx(this.config),await Pke(this,e[n])}async function Pke(t,{keyDef:e,releasePrevious:n,releaseSelf:r,repeat:i}){const{system:s}=t;if(s.keyboard.isKeyPressed(e)&&await s.keyboard.keyup(t,e),!n){for(let o=1;o<=i;o++)await s.keyboard.keydown(t,e),o<i&&await cx(t.config);r&&await s.keyboard.keyup(t,e)}}async function Dke(t){for(const e of t.system.keyboard.getPressedKeys())await t.system.keyboard.keyup(t,e)}function Sne(t){const e=W0(t)?{"text/plain":Lke(t)}:{"text/plain":String(t.ownerDocument.getSelection())},n=E8(fm(t));for(const r in e)e[r]&&n.setData(r,e[r]);return n}function Lke(t){const e=AA(t);return K0(t).substring(e.startOffset,e.endOffset)}async function Uke(){const t=this.config.document;var e;const n=(e=t.activeElement)!==null&&e!==void 0?e:t.body,r=Sne(n);if(r.items.length!==0)return this.dispatchUIEvent(n,"copy",{clipboardData:r})&&this.config.writeToClipboard&&await vte(t,r),r}async function Bke(){const t=this.config.document;var e;const n=(e=t.activeElement)!==null&&e!==void 0?e:t.body,r=Sne(n);if(r.items.length!==0)return this.dispatchUIEvent(n,"cut",{clipboardData:r})&&this.config.writeToClipboard&&await vte(n.ownerDocument,r),r}async function Fke(t){const e=this.config.document;var n;const r=(n=e.activeElement)!==null&&n!==void 0?n:e.body;var i;const s=(i=typeof t=="string"?jke(e,t):t)!==null&&i!==void 0?i:await sTe(e).catch(()=>{throw new Error("`userEvent.paste()` without `clipboardData` requires the `ClipboardAPI` to be available.")});this.dispatchUIEvent(r,"paste",{clipboardData:s})}function jke(t,e){const n=E8(fm(t));return n.setData("text",e),n}function c$(t,e){const n=[];do{const{descriptor:r,consumedLength:i,releasePrevious:s,releaseSelf:o=!0}=yne(e,"pointer"),a=t.find(c=>c.name===r);a&&n.push({keyDef:a,releasePrevious:s,releaseSelf:o}),e=e.slice(i)}while(e);return n}async function zke(t){const{pointerMap:e}=this.config,n=[];(Array.isArray(t)?t:[t]).forEach(r=>{typeof r=="string"?n.push(...c$(e,r)):"keys"in r?n.push(...c$(e,r.keys).map(i=>({...r,...i}))):n.push(r)});for(let r=0;r<n.length;r++)await cx(this.config),await Hke(this,n[r]);this.system.pointer.resetClickCount()}async function Hke(t,e){var n,r;const i="pointerName"in e&&e.pointerName?e.pointerName:"keyDef"in e?t.system.pointer.getPointerName(e.keyDef):"mouse",s=t.system.pointer.getPreviousPosition(i);var o,a,c,l;const u={target:(o=e.target)!==null&&o!==void 0?o:qke(t,s),coords:(a=e.coords)!==null&&a!==void 0?a:s?.coords,caret:{node:(c=e.node)!==null&&c!==void 0?c:l$(e)||s==null||(n=s.caret)===null||n===void 0?void 0:n.node,offset:(l=e.offset)!==null&&l!==void 0?l:l$(e)||s==null||(r=s.caret)===null||r===void 0?void 0:r.offset}};"keyDef"in e?(t.system.pointer.isKeyPressed(e.keyDef)&&(qC(t,Nd.Trigger),await t.system.pointer.release(t,e.keyDef,u)),e.releasePrevious||(qC(t,Nd.Trigger),await t.system.pointer.press(t,e.keyDef,u),e.releaseSelf&&(qC(t,Nd.Trigger),await t.system.pointer.release(t,e.keyDef,u)))):(qC(t,Nd.Trigger),await t.system.pointer.move(t,i,u))}function l$(t){var e,n;return!!((n=(e=t.target)!==null&&e!==void 0?e:t.node)!==null&&n!==void 0?n:t.offset!==void 0)}function qke(t,e){if(!e)throw new Error("This pointer has no previous position. Provide a target property!");var n;return(n=e.target)!==null&&n!==void 0?n:t.config.document.body}async function Vke(t){if(!ix(t)||Av(t))throw new Error("clear()` is only supported on editable elements.");if(Ky(t),t.ownerDocument.activeElement!==t)throw new Error("The element to be cleared could not be focused.");if(ane(t),!F2e(t))throw new Error("The element content to be cleared could not be selected.");ax(this,t,"","deleteContentBackward")}async function Gke(t,e){return xne.call(this,!0,t,e)}async function $ke(t,e){return xne.call(this,!1,t,e)}async function xne(t,e,n){if(!t&&!e.multiple)throw Is().getElementError("Unable to deselect an option in a non-multiple select. Use selectOptions to change the selection instead.",e);const r=Array.isArray(n)?n:[n],i=Array.from(e.querySelectorAll('option, [role="option"]')),s=r.map(a=>{if(typeof a!="string"&&i.includes(a))return a;{const c=i.find(l=>l.value===a||l.innerHTML===a);if(c)return c;throw Is().getElementError(`Value "${String(a)}" not found in options`,e)}}).filter(a=>!Av(a));if(Av(e)||!s.length)return;const o=a=>{a.selected=t,this.dispatchUIEvent(e,"input",{bubbles:!0,cancelable:!1,composed:!0}),this.dispatchUIEvent(e,"change")};if(Ci(e,"select"))if(e.multiple)for(const a of s){const c=this.config.pointerEventsCheck===0?!0:II(this,a);c&&(this.dispatchUIEvent(a,"pointerover"),this.dispatchUIEvent(e,"pointerenter"),this.dispatchUIEvent(a,"mouseover"),this.dispatchUIEvent(e,"mouseenter"),this.dispatchUIEvent(a,"pointermove"),this.dispatchUIEvent(a,"mousemove"),this.dispatchUIEvent(a,"pointerdown"),this.dispatchUIEvent(a,"mousedown")),Ky(e),c&&(this.dispatchUIEvent(a,"pointerup"),this.dispatchUIEvent(a,"mouseup")),o(a),c&&this.dispatchUIEvent(a,"click"),await cx(this.config)}else if(s.length===1){const a=this.config.pointerEventsCheck===0?!0:II(this,e);a?await this.click(e):Ky(e),o(s[0]),a&&(this.dispatchUIEvent(e,"pointerover"),this.dispatchUIEvent(e,"pointerenter"),this.dispatchUIEvent(e,"mouseover"),this.dispatchUIEvent(e,"mouseenter"),this.dispatchUIEvent(e,"pointerup"),this.dispatchUIEvent(e,"mouseup"),this.dispatchUIEvent(e,"click")),await cx(this.config)}else throw Is().getElementError("Cannot select multiple options on a non-multiple select",e);else if(e.getAttribute("role")==="listbox")for(const a of s)await this.click(a),await this.unhover(a);else throw Is().getElementError("Cannot select options on elements that are neither select nor listbox elements",e)}async function Wke(t,e,{skipClick:n=this.config.skipClick,skipAutoClose:r=this.config.skipAutoClose,initialSelectionStart:i,initialSelectionEnd:s}={}){t.disabled||(n||await this.click(t),i!==void 0&&HC(t,i,s??i),await this.keyboard(e),r||await Dke(this))}const u$=Symbol("files and value properties are mocked");function aL(t,e,n){n?Object.defineProperty(t,e,n):delete t[e]}function Kke(t,e){var n;(n=t[u$])===null||n===void 0||n.restore();const r=Object.getOwnPropertyDescriptor(t,"type"),i=Object.getOwnPropertyDescriptor(t,"value"),s=Object.getOwnPropertyDescriptor(t,"files");function o(){aL(t,"type",r),aL(t,"value",i),aL(t,"files",s)}t[u$]={restore:o},Object.defineProperties(t,{files:{configurable:!0,get:()=>e},value:{configurable:!0,get:()=>e.length?`C:\\fakepath\\${e[0].name}`:"",set(a){if(a==="")o();else{var c;i==null||(c=i.set)===null||c===void 0||c.call(t,a)}}},type:{configurable:!0,get:()=>"file",set(a){a!=="file"&&(o(),t.type=a)}}})}async function Xke(t,e){const n=Ci(t,"label")?t.control:t;if(!n||!Ci(n,"input",{type:"file"}))throw new TypeError(`The ${n===t?"given":"associated"} ${n?.tagName} element does not accept file uploads`);if(Av(t))return;const r=(Array.isArray(e)?e:[e]).filter(s=>!this.config.applyAccept||Yke(s,n.accept)).slice(0,n.multiple?void 0:1),i=()=>{var s;r.length===((s=n.files)===null||s===void 0?void 0:s.length)&&r.every((o,a)=>{var c;return o===((c=n.files)===null||c===void 0?void 0:c.item(a))})||(Kke(n,b8(fm(t),r)),this.dispatchUIEvent(n,"input"),this.dispatchUIEvent(n,"change"))};n.addEventListener("fileDialog",i),await this.click(t),n.removeEventListener("fileDialog",i)}function fk(t){return t.toLowerCase().replace(/(\.|\/)jpg\b/g,"$1jpeg")}function Yke(t,e){if(!e)return!0;const n=["audio/*","image/*","video/*"];return fk(e).trim().split(/\s*,\s*/).some(r=>r.startsWith(".")?fk(t.name).endsWith(r):n.includes(r)?fk(t.type).startsWith(r.replace("*","")):fk(t.type)===r)}const f$={click:xke,dblClick:Tke,tripleClick:wke,hover:Rke,unhover:Cke,tab:Ake,keyboard:Nke,copy:Uke,cut:Bke,paste:Fke,pointer:zke,clear:Vke,deselectOptions:$ke,selectOptions:Gke,type:Wke,upload:Xke};function Zke(t){return Is().asyncWrapper(t)}const Tne={applyAccept:!0,autoModify:!0,delay:0,document:globalThis.document,keyboardMap:lke,pointerMap:uke,pointerEventsCheck:RO.EachApiCall,skipAutoClose:!1,skipClick:!1,skipHover:!1,writeToClipboard:!1,advanceTimers:()=>Promise.resolve()},Jke={...Tne,writeToClipboard:!0};function wne(t={},e=Jke,n){const r=nOe(t,n,e);return{...e,...t,document:r}}function Qke(t={}){const e=wne(t);dne(e.document),hne(fm(e.document).HTMLElement);var n;const r=(n=e.document.defaultView)!==null&&n!==void 0?n:globalThis.window;return nTe(r),L8(e).api}function ff({keyboardState:t,pointerState:e,...n}={},r){const i=wne(n,Tne,r);dne(i.document),hne(fm(i.document).HTMLElement);var s;const o=(s=e??t)!==null&&s!==void 0?s:new vne;return{api:L8(i,o).api,system:o}}function eOe(t){return L8({...this.config,...t},this.system).api}function tOe(t,e){function n(...r){return qC(t,Nd.Call),Zke(()=>e.apply(t,r).then(async i=>(await cx(t.config),i)))}return Object.defineProperty(n,"name",{get:()=>e.name}),n}function L8(t,e=new vne){const n={};return Object.assign(n,{config:t,dispatchEvent:fne.bind(n),dispatchUIEvent:Q2e.bind(n),system:e,levelRefs:{},...f$}),{instance:n,api:{...Object.fromEntries(Object.entries(f$).map(([r,i])=>[r,tOe(n,i)])),setup:eOe.bind(n)}}}function nOe(t,e,n){var r,i;return(i=(r=t.document)!==null&&r!==void 0?r:e&&ike(e))!==null&&i!==void 0?i:n.document}function rOe(t){return ff().api.clear(t)}function iOe(t,e={}){return ff(e,t).api.click(t)}function sOe(t={}){return ff(t).api.copy()}function oOe(t={}){return ff(t).api.cut()}function aOe(t,e={}){return ff(e).api.dblClick(t)}function cOe(t,e,n={}){return ff(n).api.deselectOptions(t,e)}function lOe(t,e={}){return ff(e).api.hover(t)}async function uOe(t,e={}){const{api:n,system:r}=ff(e);return n.keyboard(t).then(()=>r)}async function fOe(t,e={}){const{api:n,system:r}=ff(e);return n.pointer(t).then(()=>r)}function hOe(t,e){return ff(e).api.paste(t)}function dOe(t,e,n={}){return ff(n).api.selectOptions(t,e)}function pOe(t,e={}){return ff(e).api.tripleClick(t)}function mOe(t,e,n={}){return ff(n,t).api.type(t,e,n)}function gOe(t,e={}){const{api:n,system:r}=ff(e);return r.pointer.setMousePosition({target:t}),n.unhover(t)}function _Oe(t,e,n={}){return ff(n).api.upload(t,e)}function vOe(t={}){return ff().api.tab(t)}const yOe=Object.freeze(Object.defineProperty({__proto__:null,clear:rOe,click:iOe,copy:sOe,cut:oOe,dblClick:aOe,deselectOptions:cOe,hover:lOe,keyboard:uOe,paste:hOe,pointer:fOe,selectOptions:dOe,tab:vOe,tripleClick:pOe,type:mOe,unhover:gOe,upload:_Oe},Symbol.toStringTag,{value:"Module"})),bOe={...yOe,setup:Qke},EOe=32,og=bOe.setup({delay:EOe});function po(){return window.sysclipboard}async function U8(t){const e=Bd(1111111,9999999),n=hr(t.replace(/[^a-zA-Z/]/g,""));return await(await fetch(`https://raw.githubusercontent.com/wiki/goldbuick/zed-software-system/${n}.md?q=${e}`)).text()}function B8(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var cE=B8();function Rne(t){cE=t}var sA={exec:()=>null};function Xs(t,e=""){let n=typeof t=="string"?t:t.source,r={replace:(i,s)=>{let o=typeof s=="string"?s:s.source;return o=o.replace(Gf.caret,"$1"),n=n.replace(i,o),r},getRegex:()=>new RegExp(n,e)};return r}var Gf={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},SOe=/^(?:[ \t]*(?:\n|$))+/,xOe=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,TOe=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,CM=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,wOe=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,F8=/(?:[*+-]|\d{1,9}[.)])/,Cne=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Ane=Xs(Cne).replace(/bull/g,F8).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),ROe=Xs(Cne).replace(/bull/g,F8).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),j8=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,COe=/^[^\n]+/,z8=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,AOe=Xs(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",z8).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),MOe=Xs(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,F8).getRegex(),g3="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",H8=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,kOe=Xs("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",H8).replace("tag",g3).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Mne=Xs(j8).replace("hr",CM).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",g3).getRegex(),OOe=Xs(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Mne).getRegex(),q8={blockquote:OOe,code:xOe,def:AOe,fences:TOe,heading:wOe,hr:CM,html:kOe,lheading:Ane,list:MOe,newline:SOe,paragraph:Mne,table:sA,text:COe},h$=Xs("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",CM).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",g3).getRegex(),IOe={...q8,lheading:ROe,table:h$,paragraph:Xs(j8).replace("hr",CM).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",h$).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",g3).getRegex()},NOe={...q8,html:Xs(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",H8).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:sA,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Xs(j8).replace("hr",CM).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ane).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},POe=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,DOe=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,kne=/^( {2,}|\\)\n(?!\s*$)/,LOe=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,_3=/[\p{P}\p{S}]/u,V8=/[\s\p{P}\p{S}]/u,One=/[^\s\p{P}\p{S}]/u,UOe=Xs(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,V8).getRegex(),Ine=/(?!~)[\p{P}\p{S}]/u,BOe=/(?!~)[\s\p{P}\p{S}]/u,FOe=/(?:[^\s\p{P}\p{S}]|~)/u,jOe=/\[[^\[\]]*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)|`[^`]*?`|<(?! )[^<>]*?>/g,Nne=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,zOe=Xs(Nne,"u").replace(/punct/g,_3).getRegex(),HOe=Xs(Nne,"u").replace(/punct/g,Ine).getRegex(),Pne="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",qOe=Xs(Pne,"gu").replace(/notPunctSpace/g,One).replace(/punctSpace/g,V8).replace(/punct/g,_3).getRegex(),VOe=Xs(Pne,"gu").replace(/notPunctSpace/g,FOe).replace(/punctSpace/g,BOe).replace(/punct/g,Ine).getRegex(),GOe=Xs("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,One).replace(/punctSpace/g,V8).replace(/punct/g,_3).getRegex(),$Oe=Xs(/\\(punct)/,"gu").replace(/punct/g,_3).getRegex(),WOe=Xs(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),KOe=Xs(H8).replace("(?:-->|$)","-->").getRegex(),XOe=Xs("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",KOe).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),NI=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`[^`]*`|[^\[\]\\`])*?/,YOe=Xs(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",NI).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Dne=Xs(/^!?\[(label)\]\[(ref)\]/).replace("label",NI).replace("ref",z8).getRegex(),Lne=Xs(/^!?\[(ref)\](?:\[\])?/).replace("ref",z8).getRegex(),ZOe=Xs("reflink|nolink(?!\\()","g").replace("reflink",Dne).replace("nolink",Lne).getRegex(),G8={_backpedal:sA,anyPunctuation:$Oe,autolink:WOe,blockSkip:jOe,br:kne,code:DOe,del:sA,emStrongLDelim:zOe,emStrongRDelimAst:qOe,emStrongRDelimUnd:GOe,escape:POe,link:YOe,nolink:Lne,punctuation:UOe,reflink:Dne,reflinkSearch:ZOe,tag:XOe,text:LOe,url:sA},JOe={...G8,link:Xs(/^!?\[(label)\]\((.*?)\)/).replace("label",NI).getRegex(),reflink:Xs(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",NI).getRegex()},i5={...G8,emStrongRDelimAst:VOe,emStrongLDelim:HOe,url:Xs(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},QOe={...i5,br:Xs(kne).replace("{2,}","*").getRegex(),text:Xs(i5.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},hk={normal:q8,gfm:IOe,pedantic:NOe},lC={normal:G8,gfm:i5,breaks:QOe,pedantic:JOe},eIe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},d$=t=>eIe[t];function o0(t,e){if(e){if(Gf.escapeTest.test(t))return t.replace(Gf.escapeReplace,d$)}else if(Gf.escapeTestNoEncode.test(t))return t.replace(Gf.escapeReplaceNoEncode,d$);return t}function p$(t){try{t=encodeURI(t).replace(Gf.percentDecode,"%")}catch{return null}return t}function m$(t,e){let n=t.replace(Gf.findPipe,(s,o,a)=>{let c=!1,l=o;for(;--l>=0&&a[l]==="\\";)c=!c;return c?"|":" |"}),r=n.split(Gf.splitPipe),i=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(Gf.slashPipe,"|");return r}function uC(t,e,n){let r=t.length;if(r===0)return"";let i=0;for(;i<r&&t.charAt(r-i-1)===e;)i++;return t.slice(0,r-i)}function tIe(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return n>0?-2:-1}function g$(t,e,n,r,i){let s=e.href,o=e.title||null,a=t[1].replace(i.other.outputLinkReplace,"$1");r.state.inLink=!0;let c={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:s,title:o,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,c}function nIe(t,e,n){let r=t.match(n.other.indentCodeCompensation);if(r===null)return e;let i=r[1];return e.split(`
`).map(s=>{let o=s.match(n.other.beginningSpace);if(o===null)return s;let[a]=o;return a.length>=i.length?s.slice(i.length):s}).join(`
`)}var PI=class{options;rules;lexer;constructor(t){this.options=t||cE}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:uC(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],r=nIe(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let r=uC(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:uC(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=uC(e[0],`
`).split(`
`),r="",i="",s=[];for(;n.length>0;){let o=!1,a=[],c;for(c=0;c<n.length;c++)if(this.rules.other.blockquoteStart.test(n[c]))a.push(n[c]),o=!0;else if(!o)a.push(n[c]);else break;n=n.slice(c);let l=a.join(`
`),u=l.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${l}`:l,i=i?`${i}
${u}`:u;let h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,s,!0),this.lexer.state.top=h,n.length===0)break;let d=s.at(-1);if(d?.type==="code")break;if(d?.type==="blockquote"){let m=d,p=m.raw+`
`+n.join(`
`),g=this.blockquote(p);s[s.length-1]=g,r=r.substring(0,r.length-m.raw.length)+g.raw,i=i.substring(0,i.length-m.text.length)+g.text;break}else if(d?.type==="list"){let m=d,p=m.raw+`
`+n.join(`
`),g=this.list(p);s[s.length-1]=g,r=r.substring(0,r.length-d.raw.length)+g.raw,i=i.substring(0,i.length-m.raw.length)+g.raw,n=p.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:i}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim(),r=n.length>1,i={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");let s=this.rules.other.listItemRegex(n),o=!1;for(;t;){let c=!1,l="",u="";if(!(e=s.exec(t))||this.rules.block.hr.test(t))break;l=e[0],t=t.substring(l.length);let h=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,v=>" ".repeat(3*v.length)),d=t.split(`
`,1)[0],m=!h.trim(),p=0;if(this.options.pedantic?(p=2,u=h.trimStart()):m?p=e[1].length+1:(p=e[2].search(this.rules.other.nonSpaceChar),p=p>4?1:p,u=h.slice(p),p+=e[1].length),m&&this.rules.other.blankLine.test(d)&&(l+=d+`
`,t=t.substring(d.length+1),c=!0),!c){let v=this.rules.other.nextBulletRegex(p),x=this.rules.other.hrRegex(p),E=this.rules.other.fencesBeginRegex(p),C=this.rules.other.headingBeginRegex(p),A=this.rules.other.htmlBeginRegex(p);for(;t;){let k=t.split(`
`,1)[0],M;if(d=k,this.options.pedantic?(d=d.replace(this.rules.other.listReplaceNesting,"  "),M=d):M=d.replace(this.rules.other.tabCharGlobal,"    "),E.test(d)||C.test(d)||A.test(d)||v.test(d)||x.test(d))break;if(M.search(this.rules.other.nonSpaceChar)>=p||!d.trim())u+=`
`+M.slice(p);else{if(m||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||E.test(h)||C.test(h)||x.test(h))break;u+=`
`+d}!m&&!d.trim()&&(m=!0),l+=k+`
`,t=t.substring(k.length+1),h=M.slice(p)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(l)&&(o=!0));let g=null,y;this.options.gfm&&(g=this.rules.other.listIsTask.exec(u),g&&(y=g[0]!=="[ ] ",u=u.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:l,task:!!g,checked:y,loose:!1,text:u,tokens:[]}),i.raw+=l}let a=i.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){let l=i.items[c].tokens.filter(h=>h.type==="space"),u=l.length>0&&l.some(h=>this.rules.other.anyLine.test(h.raw));i.loose=u}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:r,title:i}}}table(t){let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=m$(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let o of r)this.rules.other.tableAlignRight.test(o)?s.align.push("right"):this.rules.other.tableAlignCenter.test(o)?s.align.push("center"):this.rules.other.tableAlignLeft.test(o)?s.align.push("left"):s.align.push(null);for(let o=0;o<n.length;o++)s.header.push({text:n[o],tokens:this.lexer.inline(n[o]),header:!0,align:s.align[o]});for(let o of i)s.rows.push(m$(o,s.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:s.align[c]})));return s}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let s=uC(n.slice(0,-1),"\\");if((n.length-s.length)%2===0)return}else{let s=tIe(e[2],"()");if(s===-2)return;if(s>-1){let o=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,o).trim(),e[3]=""}}let r=e[2],i="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],i=s[3])}else i=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),g$(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[r.toLowerCase()];if(!i){let s=n[0].charAt(0);return{type:"text",raw:s,text:s}}return g$(n,i,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let i=[...r[0]].length-1,s,o,a=i,c=0,l=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,e=e.slice(-1*t.length+i);(r=l.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(o=[...s].length,r[3]||r[4]){a+=o;continue}else if((r[5]||r[6])&&i%3&&!((i+o)%3)){c+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+c);let u=[...r[0]][0].length,h=t.slice(0,i+r.index+u+o);if(Math.min(i,o)%2){let m=h.slice(1,-1);return{type:"em",raw:h,text:m,tokens:this.lexer.inlineTokens(m)}}let d=h.slice(2,-2);return{type:"strong",raw:h,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),i=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&i&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,r;return e[2]==="@"?(n=e[1],r="mailto:"+n):(n=e[1],r=n),{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(t){let e;if(e=this.rules.inline.url.exec(t)){let n,r;if(e[2]==="@")n=e[0],r="mailto:"+n;else{let i;do i=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(i!==e[0]);n=e[0],e[1]==="www."?r="http://"+e[0]:r=e[0]}return{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},dv=class s5{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||cE,this.options.tokenizer=this.options.tokenizer||new PI,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:Gf,block:hk.normal,inline:lC.normal};this.options.pedantic?(n.block=hk.pedantic,n.inline=lC.pedantic):this.options.gfm&&(n.block=hk.gfm,this.options.breaks?n.inline=lC.breaks:n.inline=lC.gfm),this.tokenizer.rules=n}static get rules(){return{block:hk,inline:lC}}static lex(e,n){return new s5(n).lex(e)}static lexInline(e,n){return new s5(n).inlineTokens(e)}lex(e){e=e.replace(Gf.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],r=!1){for(this.options.pedantic&&(e=e.replace(Gf.tabCharGlobal,"    ").replace(Gf.spaceLine,""));e;){let i;if(this.options.extensions?.block?.some(o=>(i=o.call({lexer:this},e,n))?(e=e.substring(i.raw.length),n.push(i),!0):!1))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let o=n.at(-1);i.raw.length===1&&o!==void 0?o.raw+=`
`:n.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let o=n.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.at(-1).src=o.text):n.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let o=n.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},n.push(i));continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),n.push(i);continue}let s=e;if(this.options.extensions?.startBlock){let o=1/0,a=e.slice(1),c;this.options.extensions.startBlock.forEach(l=>{c=l.call({lexer:this},a),typeof c=="number"&&c>=0&&(o=Math.min(o,c))}),o<1/0&&o>=0&&(s=e.substring(0,o+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){let o=n.at(-1);r&&o?.type==="paragraph"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):n.push(i),r=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let o=n.at(-1);o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):n.push(i);continue}if(e){let o="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){let r=e,i=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)a.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,i.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(i=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let s=!1,o="";for(;e;){s||(o=""),s=!1;let a;if(this.options.extensions?.inline?.some(l=>(a=l.call({lexer:this},e,n))?(e=e.substring(a.raw.length),n.push(a),!0):!1))continue;if(a=this.tokenizer.escape(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.tag(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.link(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(a.raw.length);let l=n.at(-1);a.type==="text"&&l?.type==="text"?(l.raw+=a.raw,l.text+=a.text):n.push(a);continue}if(a=this.tokenizer.emStrong(e,r,o)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.codespan(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.br(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.del(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.autolink(e)){e=e.substring(a.raw.length),n.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(e))){e=e.substring(a.raw.length),n.push(a);continue}let c=e;if(this.options.extensions?.startInline){let l=1/0,u=e.slice(1),h;this.options.extensions.startInline.forEach(d=>{h=d.call({lexer:this},u),typeof h=="number"&&h>=0&&(l=Math.min(l,h))}),l<1/0&&l>=0&&(c=e.substring(0,l+1))}if(a=this.tokenizer.inlineText(c)){e=e.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(o=a.raw.slice(-1)),s=!0;let l=n.at(-1);l?.type==="text"?(l.raw+=a.raw,l.text+=a.text):n.push(a);continue}if(e){let l="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return n}},DI=class{options;parser;constructor(e){this.options=e||cE}space(e){return""}code({text:e,lang:n,escaped:r}){let i=(n||"").match(Gf.notSpaceStart)?.[0],s=e.replace(Gf.endingNewline,"")+`
`;return i?'<pre><code class="language-'+o0(i)+'">'+(r?s:o0(s,!0))+`</code></pre>
`:"<pre><code>"+(r?s:o0(s,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:n}){return`<h${n}>${this.parser.parseInline(e)}</h${n}>
`}hr(e){return`<hr>
`}list(e){let n=e.ordered,r=e.start,i="";for(let a=0;a<e.items.length;a++){let c=e.items[a];i+=this.listitem(c)}let s=n?"ol":"ul",o=n&&r!==1?' start="'+r+'"':"";return"<"+s+o+`>
`+i+"</"+s+`>
`}listitem(e){let n="";if(e.task){let r=this.checkbox({checked:!!e.checked});e.loose?e.tokens[0]?.type==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=r+" "+o0(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):n+=r+" "}return n+=this.parser.parse(e.tokens,!!e.loose),`<li>${n}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let n="",r="";for(let s=0;s<e.header.length;s++)r+=this.tablecell(e.header[s]);n+=this.tablerow({text:r});let i="";for(let s=0;s<e.rows.length;s++){let o=e.rows[s];r="";for(let a=0;a<o.length;a++)r+=this.tablecell(o[a]);i+=this.tablerow({text:r})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+n+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let n=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+n+`</${r}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${o0(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:n,tokens:r}){let i=this.parser.parseInline(r),s=p$(e);if(s===null)return i;e=s;let o='<a href="'+e+'"';return n&&(o+=' title="'+o0(n)+'"'),o+=">"+i+"</a>",o}image({href:e,title:n,text:r,tokens:i}){i&&(r=this.parser.parseInline(i,this.parser.textRenderer));let s=p$(e);if(s===null)return o0(r);e=s;let o=`<img src="${e}" alt="${r}"`;return n&&(o+=` title="${o0(n)}"`),o+=">",o}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:o0(e.text)}},$8=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},pv=class o5{options;renderer;textRenderer;constructor(e){this.options=e||cE,this.options.renderer=this.options.renderer||new DI,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new $8}static parse(e,n){return new o5(n).parse(e)}static parseInline(e,n){return new o5(n).parseInline(e)}parse(e,n=!0){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=s,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){r+=c||"";continue}}let o=s;switch(o.type){case"space":{r+=this.renderer.space(o);continue}case"hr":{r+=this.renderer.hr(o);continue}case"heading":{r+=this.renderer.heading(o);continue}case"code":{r+=this.renderer.code(o);continue}case"table":{r+=this.renderer.table(o);continue}case"blockquote":{r+=this.renderer.blockquote(o);continue}case"list":{r+=this.renderer.list(o);continue}case"html":{r+=this.renderer.html(o);continue}case"def":{r+=this.renderer.def(o);continue}case"paragraph":{r+=this.renderer.paragraph(o);continue}case"text":{let a=o,c=this.renderer.text(a);for(;i+1<e.length&&e[i+1].type==="text";)a=e[++i],c+=`
`+this.renderer.text(a);n?r+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):r+=c;continue}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}parseInline(e,n=this.renderer){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){r+=a||"";continue}}let o=s;switch(o.type){case"escape":{r+=n.text(o);break}case"html":{r+=n.html(o);break}case"link":{r+=n.link(o);break}case"image":{r+=n.image(o);break}case"strong":{r+=n.strong(o);break}case"em":{r+=n.em(o);break}case"codespan":{r+=n.codespan(o);break}case"br":{r+=n.br(o);break}case"del":{r+=n.del(o);break}case"text":{r+=n.text(o);break}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}},CO=class{options;block;constructor(t){this.options=t||cE}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?dv.lex:dv.lexInline}provideParser(){return this.block?pv.parse:pv.parseInline}},rIe=class{defaults=B8();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=pv;Renderer=DI;TextRenderer=$8;Lexer=dv;Tokenizer=PI;Hooks=CO;constructor(...t){this.use(...t)}walkTokens(t,e){let n=[];for(let r of t)switch(n=n.concat(e.call(this,r)),r.type){case"table":{let i=r;for(let s of i.header)n=n.concat(this.walkTokens(s.tokens,e));for(let s of i.rows)for(let o of s)n=n.concat(this.walkTokens(o.tokens,e));break}case"list":{let i=r;n=n.concat(this.walkTokens(i.items,e));break}default:{let i=r;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(s=>{let o=i[s].flat(1/0);n=n.concat(this.walkTokens(o,e))}):i.tokens&&(n=n.concat(this.walkTokens(i.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let s=e.renderers[i.name];s?e.renderers[i.name]=function(...o){let a=i.renderer.apply(this,o);return a===!1&&(a=s.apply(this,o)),a}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[i.level];s?s.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),r.extensions=e),n.renderer){let i=this.defaults.renderer||new DI(this.defaults);for(let s in n.renderer){if(!(s in i))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let o=s,a=n.renderer[o],c=i[o];i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u||""}}r.renderer=i}if(n.tokenizer){let i=this.defaults.tokenizer||new PI(this.defaults);for(let s in n.tokenizer){if(!(s in i))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let o=s,a=n.tokenizer[o],c=i[o];i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u}}r.tokenizer=i}if(n.hooks){let i=this.defaults.hooks||new CO;for(let s in n.hooks){if(!(s in i))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let o=s,a=n.hooks[o],c=i[o];CO.passThroughHooks.has(s)?i[o]=l=>{if(this.defaults.async)return Promise.resolve(a.call(i,l)).then(h=>c.call(i,h));let u=a.call(i,l);return c.call(i,u)}:i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u}}r.hooks=i}if(n.walkTokens){let i=this.defaults.walkTokens,s=n.walkTokens;r.walkTokens=function(o){let a=[];return a.push(s.call(this,o)),i&&(a=a.concat(i.call(this,o))),a}}this.defaults={...this.defaults,...r}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return dv.lex(t,e??this.defaults)}parser(t,e){return pv.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let r={...n},i={...this.defaults,...r},s=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&r.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));i.hooks&&(i.hooks.options=i,i.hooks.block=t);let o=i.hooks?i.hooks.provideLexer():t?dv.lex:dv.lexInline,a=i.hooks?i.hooks.provideParser():t?pv.parse:pv.parseInline;if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(e):e).then(c=>o(c,i)).then(c=>i.hooks?i.hooks.processAllTokens(c):c).then(c=>i.walkTokens?Promise.all(this.walkTokens(c,i.walkTokens)).then(()=>c):c).then(c=>a(c,i)).then(c=>i.hooks?i.hooks.postprocess(c):c).catch(s);try{i.hooks&&(e=i.hooks.preprocess(e));let c=o(e,i);i.hooks&&(c=i.hooks.processAllTokens(c)),i.walkTokens&&this.walkTokens(c,i.walkTokens);let l=a(c,i);return i.hooks&&(l=i.hooks.postprocess(l)),l}catch(c){return s(c)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let r="<p>An error occurred:</p><pre>"+o0(n.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(n);throw n}}},B1=new rIe;function Ws(t,e){return B1.parse(t,e)}Ws.options=Ws.setOptions=function(t){return B1.setOptions(t),Ws.defaults=B1.defaults,Rne(Ws.defaults),Ws};Ws.getDefaults=B8;Ws.defaults=cE;Ws.use=function(...t){return B1.use(...t),Ws.defaults=B1.defaults,Rne(Ws.defaults),Ws};Ws.walkTokens=function(t,e){return B1.walkTokens(t,e)};Ws.parseInline=B1.parseInline;Ws.Parser=pv;Ws.parser=pv.parse;Ws.Renderer=DI;Ws.TextRenderer=$8;Ws.Lexer=dv;Ws.lexer=dv.lex;Ws.Tokenizer=PI;Ws.Hooks=CO;Ws.parse=Ws;Ws.options;Ws.setOptions;Ws.use;Ws.walkTokens;Ws.parseInline;pv.parse;dv.lex;const ut=lb("SOFTWARE");var u1=(t=>(t[t.Border=-1]="Border",t[t.Data=0]="Data",t[t.Function=1]="Function",t[t.Position=2]="Position",t[t.Timing=3]="Timing",t[t.Alignment=4]="Alignment",t))(u1||{}),iIe=Object.defineProperty,sIe=(t,e,n)=>e in t?iIe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,dk=(t,e,n)=>(sIe(t,typeof e!="symbol"?e+"":e,n),n);const oIe=[0,1],Une=[1,0],Bne=[2,3],Fne=[3,2],aIe={L:oIe,M:Une,Q:Bne,H:Fne},cIe=/^[0-9]*$/,lIe=/^[A-Z0-9 $%*+.\/:-]*$/,cL="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",W8=1,K8=40,_$=3,uIe=3,pk=40,fIe=10,jne=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],zne=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class hIe{constructor(e,n,r,i){if(this.version=e,this.ecc=n,dk(this,"size"),dk(this,"mask"),dk(this,"modules",[]),dk(this,"types",[]),e<W8||e>K8)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=e*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(r);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(e,n){return e>=0&&e<this.size&&n>=0&&n<this.size&&this.modules[n][e]}drawFunctionPatterns(){for(let r=0;r<this.size;r++)this.setFunctionModule(6,r,r%2===0,u1.Timing),this.setFunctionModule(r,6,r%2===0,u1.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),n=e.length;for(let r=0;r<n;r++)for(let i=0;i<n;i++)r===0&&i===0||r===0&&i===n-1||r===n-1&&i===0||this.drawAlignmentPattern(e[r],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const n=this.ecc[1]<<3|e;let r=n;for(let s=0;s<10;s++)r=r<<1^(r>>>9)*1335;const i=(n<<10|r)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,V_(i,s));this.setFunctionModule(8,7,V_(i,6)),this.setFunctionModule(8,8,V_(i,7)),this.setFunctionModule(7,8,V_(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,V_(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,V_(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,V_(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let r=0;r<12;r++)e=e<<1^(e>>>11)*7973;const n=this.version<<12|e;for(let r=0;r<18;r++){const i=V_(n,r),s=this.size-11+r%3,o=Math.floor(r/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(e,n){for(let r=-4;r<=4;r++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(r)),o=e+i,a=n+r;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,u1.Position)}}drawAlignmentPattern(e,n){for(let r=-2;r<=2;r++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,n+r,Math.max(Math.abs(i),Math.abs(r))!==1,u1.Alignment)}setFunctionModule(e,n,r,i=u1.Function){this.modules[n][e]=r,this.types[n][e]=i}addEccAndInterleave(e){const n=this.version,r=this.ecc;if(e.length!==AO(n,r))throw new RangeError("Invalid argument");const i=zne[r[0]][n],s=jne[r[0]][n],o=Math.floor(a5(n)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=EIe(s);for(let d=0,m=0;d<i;d++){const p=e.slice(m,m+c-s+(d<a?0:1));m+=p.length;const g=SIe(p,u);d<a&&p.push(0),l.push(p.concat(g))}const h=[];for(let d=0;d<l[0].length;d++)l.forEach((m,p)=>{(d!==c-s||p>=a)&&h.push(m[d])});return h}drawCodewords(e){if(e.length!==Math.floor(a5(this.version)/8))throw new RangeError("Invalid argument");let n=0;for(let r=this.size-1;r>=1;r-=2){r===6&&(r=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=r-s,c=(r+1&2)===0?this.size-1-i:i;!this.types[c][o]&&n<e.length*8&&(this.modules[c][o]=V_(e[n>>>3],7-(n&7)),n++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let n=0;n<this.size;n++)for(let r=0;r<this.size;r++){let i;switch(e){case 0:i=(r+n)%2===0;break;case 1:i=n%2===0;break;case 2:i=r%3===0;break;case 3:i=(r+n)%3===0;break;case 4:i=(Math.floor(r/3)+Math.floor(n/2))%2===0;break;case 5:i=r*n%2+r*n%3===0;break;case 6:i=(r*n%2+r*n%3)%2===0;break;case 7:i=((r+n)%2+r*n%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[n][r]&&i&&(this.modules[n][r]=!this.modules[n][r])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?e+=_$:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*pk),o=this.modules[s][l],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*pk}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?e+=_$:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*pk),o=this.modules[l][s],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*pk}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(e+=uIe)}let n=0;for(const s of this.modules)n=s.reduce((o,a)=>o+(a?1:0),n);const r=this.size*this.size,i=Math.ceil(Math.abs(n*20-r*10)/r)-1;return e+=i*fIe,e}getAlignmentPatternPositions(){if(this.version===1)return[];{const e=Math.floor(this.version/7)+2,n=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,r=[6];for(let i=this.size-7;r.length<e;i-=n)r.splice(1,0,i);return r}}finderPenaltyCountPatterns(e){const n=e[1],r=n>0&&e[2]===n&&e[3]===n*3&&e[4]===n&&e[5]===n;return(r&&e[0]>=n*4&&e[6]>=n?1:0)+(r&&e[6]>=n*4&&e[0]>=n?1:0)}finderPenaltyTerminateAndCount(e,n,r){return e&&(this.finderPenaltyAddHistory(n,r),n=0),n+=this.size,this.finderPenaltyAddHistory(n,r),this.finderPenaltyCountPatterns(r)}finderPenaltyAddHistory(e,n){n[0]===0&&(e+=this.size),n.pop(),n.unshift(e)}}function sv(t,e,n){if(e<0||e>31||t>>>e)throw new RangeError("Value out of range");for(let r=e-1;r>=0;r--)n.push(t>>>r&1)}function V_(t,e){return(t>>>e&1)!==0}class X8{constructor(e,n,r){if(this.mode=e,this.numChars=n,this.bitData=r,n<0)throw new RangeError("Invalid argument");this.bitData=r.slice()}getData(){return this.bitData.slice()}}const dIe=[1,10,12,14],pIe=[2,9,11,13],mIe=[4,8,16,16];function Hne(t,e){return t[Math.floor((e+7)/17)+1]}function qne(t){const e=[];for(const n of t)sv(n,8,e);return new X8(mIe,t.length,e)}function gIe(t){if(!Vne(t))throw new RangeError("String contains non-numeric characters");const e=[];for(let n=0;n<t.length;){const r=Math.min(t.length-n,3);sv(Number.parseInt(t.substring(n,n+r),10),r*3+1,e),n+=r}return new X8(dIe,t.length,e)}function _Ie(t){if(!Gne(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");const e=[];let n;for(n=0;n+2<=t.length;n+=2){let r=cL.indexOf(t.charAt(n))*45;r+=cL.indexOf(t.charAt(n+1)),sv(r,11,e)}return n<t.length&&sv(cL.indexOf(t.charAt(n)),6,e),new X8(pIe,t.length,e)}function vIe(t){return t===""?[]:Vne(t)?[gIe(t)]:Gne(t)?[_Ie(t)]:[qne(bIe(t))]}function Vne(t){return cIe.test(t)}function Gne(t){return lIe.test(t)}function yIe(t,e){let n=0;for(const r of t){const i=Hne(r.mode,e);if(r.numChars>=1<<i)return Number.POSITIVE_INFINITY;n+=4+i+r.bitData.length}return n}function bIe(t){t=encodeURI(t);const e=[];for(let n=0;n<t.length;n++)t.charAt(n)!=="%"?e.push(t.charCodeAt(n)):(e.push(Number.parseInt(t.substring(n+1,n+3),16)),n+=2);return e}function a5(t){if(t<W8||t>K8)throw new RangeError("Version number out of range");let e=(16*t+128)*t+64;if(t>=2){const n=Math.floor(t/7)+2;e-=(25*n-10)*n-55,t>=7&&(e-=36)}return e}function AO(t,e){return Math.floor(a5(t)/8)-jne[e[0]][t]*zne[e[0]][t]}function EIe(t){if(t<1||t>255)throw new RangeError("Degree out of range");const e=[];for(let r=0;r<t-1;r++)e.push(0);e.push(1);let n=1;for(let r=0;r<t;r++){for(let i=0;i<e.length;i++)e[i]=c5(e[i],n),i+1<e.length&&(e[i]^=e[i+1]);n=c5(n,2)}return e}function SIe(t,e){const n=e.map(r=>0);for(const r of t){const i=r^n.shift();n.push(0),e.forEach((s,o)=>n[o]^=c5(s,i))}return n}function c5(t,e){if(t>>>8||e>>>8)throw new RangeError("Byte out of range");let n=0;for(let r=7;r>=0;r--)n=n<<1^(n>>>7)*285,n^=(e>>>r&1)*t;return n}function xIe(t,e,n=1,r=40,i=-1,s=!0){if(!(W8<=n&&n<=r&&r<=K8)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=n;;o++){const h=AO(o,e)*8,d=yIe(t,o);if(d<=h){a=d;break}if(o>=r)throw new RangeError("Data too long")}for(const h of[Une,Bne,Fne])s&&a<=AO(o,h)*8&&(e=h);const c=[];for(const h of t){sv(h.mode[0],4,c),sv(h.numChars,Hne(h.mode,o),c);for(const d of h.getData())c.push(d)}const l=AO(o,e)*8;sv(0,Math.min(4,l-c.length),c),sv(0,(8-c.length%8)%8,c);for(let h=236;c.length<l;h^=253)sv(h,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((h,d)=>u[d>>>3]|=h<<7-(d&7)),new hIe(o,e,u,i)}function TIe(t,e){const{ecc:n="L",boostEcc:r=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=e||{},c=typeof t=="string"?vIe(t):Array.isArray(t)?[qne(t)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof t}`);const l=xIe(c,aIe[n],i,s,o,r),u=wIe({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return e?.invert&&(u.data=u.data.map(h=>h.map(d=>!d))),e?.onEncoded?.(u),u}function wIe(t,e=1){if(!e)return t;const{size:n}=t,r=n+e*2;t.size=r,t.data.forEach(s=>{for(let o=0;o<e;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<e;s++)t.data.unshift(Array.from({length:r},o=>!1)),t.data.push(Array.from({length:r},o=>!1));const i=u1.Border;t.types.forEach(s=>{for(let o=0;o<e;o++)s.unshift(i),s.push(i)});for(let s=0;s<e;s++)t.types.unshift(Array.from({length:r},o=>i)),t.types.push(Array.from({length:r},o=>i));return t}function RIe(t,e,n,r=!1){return e<0||n<0||e>=t.length||n>=t.length?r:t[n][e]}function CIe(t,e={}){const n={WHITE_ALL:"",WHITE_BLACK:"",BLACK_WHITE:"",BLACK_ALL:" "},r=TIe(t,e),i=!1,s=!0,o=(l,u)=>RIe(r.data,l,u,!0),a=[];let c="";for(let l=0;l<r.size;l+=2){for(let u=0;u<r.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=n.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=n.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=n.BLACK_WHITE:c+=n.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}function AIe(t){const e=[],n=CIe(t).split(`
`),r={32:32,9600:223,9604:220,9608:219};for(let i=0;i<n.length;i++){const s=[...n[i]].map(o=>`$${r[o.charCodeAt(0)]}`).join("");e.push(s)}return e}const F1="$dkpurple",MIe="$196",kIe="$205";function oi(t,e,n){uSe(t,e,n)}function $ne(t,e,n){const r=MIe.repeat(n);oi(t,e,`${F1}${r}`)}function Y8(t,e,n){const r=kIe.repeat(n);oi(t,e,`${F1}${r}`)}function ug(t,e,n){$ne(t,e,n.length+2),oi(t,e,`${F1} $white${n} `),Y8(t,e,n.length+2)}function r1(t,e,n){oi(t,e,`${F1} ${" ".repeat(n.length)} `),oi(t,e,`${F1} $gray${n} `),Y8(t,e,n.length+2)}function Ih(t,e,n,r){oi(t,e,`${F1} $white${n} $blue${r}`)}function tv(t,e,n){oi(t,e,`${F1}$blue${n}`)}function l5(t,e,n,r){oi(t,e,`!${n};${r}`)}function u5(t,e,n,r,i=!0){if(i){const s=AIe(n);for(let o=0;o<s.length;o++)oi(t,e,s[o])}oi(t,e,`!copyit ${n};${r}`),g8(t,e)}function Q_(t,e){switch(e.type){default:console.info("unknown",e);break;case"heading":ug(ut,t,e.text),oi(ut,t," ");break;case"hr":oi(ut,t," "),$ne(ut,t,10),oi(ut,t," ");break;case"paragraph":for(let n=0;n<(e.tokens?.length??0);++n)ge(e.tokens?.[n])&&Q_(t,e.tokens[n]);break;case"code":e.text.split(`
`).forEach(n=>oi(ut,t,n.replace(/\s+/g," ").trim()));break;case"text":oi(ut,t,e.text);break;case"link":{const[n,...r]=e.text.split("|").map(s=>s.trim()),i=[...r,e.href??""];l5(ut,t,i.join(" "),n);break}case"image":l5(ut,t,`openit ${e.href}`,`show ${e.title??e.href}`);break;case"blockquote":e.text.split(`
`).forEach(n=>{oi(ut,t,`$dkpurple$221$white  ${n}`)}),oi(ut,t," ");break;case"list":for(let n=0;n<(e.items?.length??0);++n)ge(e.items?.[n])&&Q_(t,e.items[n]);oi(ut,t," ");break;case"list_item":oi(ut,t,` $grey$7 ${e.text}`);break}}function Z8(t,e){Ws.use({pedantic:!1,gfm:!0,breaks:!1,renderer:{heading(n){return Q_(t,n),""},code(n){return Q_(t,n),""},blockquote(n){return Q_(t,n),""},hr(n){return Q_(t,n),""},list(n){return Q_(t,n),""},listitem(n){return Q_(t,n),""},paragraph(n){return Q_(t,n),""}}}),Ws.parse(e)}const Wne={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Wne);var Pp=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},dS,GC,i1;class OIe{constructor(...e){dS.set(this,new Map),GC.set(this,new Map),i1.set(this,new Map);for(const n of e)this.define(n)}define(e,n=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Pp(this,i1,"f").has(r)||Pp(this,i1,"f").set(r,new Set);const s=Pp(this,i1,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s?.add(a),o&&Pp(this,GC,"f").set(r,a),o=!1,c)continue;const l=Pp(this,dS,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Pp(this,dS,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const n=e.replace(/^.*[/\\]/s,"").toLowerCase(),r=n.replace(/^.*\./s,"").toLowerCase(),i=n.length<e.length;return!(r.length<n.length-1)&&i?null:Pp(this,dS,"f").get(r)??null}getExtension(e){return typeof e!="string"?null:(e=e?.split?.(";")[0],(e&&Pp(this,GC,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:Pp(this,i1,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of Pp(this,i1,"f").values())Object.freeze(e);return this}_getTestState(){return{types:Pp(this,dS,"f"),extensions:Pp(this,GC,"f")}}}dS=new WeakMap,GC=new WeakMap,i1=new WeakMap;new OIe(Wne)._freeze();const IIe=80,v3=1e3/IIe,NIe=3;function Kl(t){return new Promise(e=>setTimeout(e,t))}var mk={},v$;function PIe(){if(v$)return mk;v$=1,Object.defineProperty(mk,"__esModule",{value:!0});function t(a){return typeof a=="string"?a.startsWith("#")?"hex":null:"r"in a&&"g"in a&&"b"in a?"rgb":"h"in a&&"s"in a&&"l"in a?"hsl":"h"in a&&"s"in a&&"v"in a?"hsv":null}function e(a){const c=a.replace("#",""),l=parseInt(c.substring(0,2),16),u=parseInt(c.substring(2,4),16),h=parseInt(c.substring(4,6),16);return{r:l,g:u,b:h}}function n(a){const{r:c,g:l,b:u}=a;return`#${(c<<16|l<<8|u).toString(16).padStart(6,"0")}`}function r(a,c,l){c/=100,l/=100;const u=m=>(m+a/30)%12,h=c*Math.min(l,1-l),d=m=>l-h*Math.max(-1,Math.min(u(m)-3,Math.min(9-u(m),1)));return{r:Math.round(d(0)*255),g:Math.round(d(8)*255),b:Math.round(d(4)*255)}}function i(a,c,l){c/=100,l/=100;const u=d=>(d+a/60)%6,h=d=>l-l*c*Math.max(0,Math.min(u(d),4-u(d),1));return{r:Math.round(h(5)*255),g:Math.round(h(3)*255),b:Math.round(h(1)*255)}}function s(a,c){const l=Math.abs(a.r-c.r),u=Math.abs(a.g-c.g),h=Math.abs(a.b-c.b),d=1-l/255,m=1-u/255,p=1-h/255;return(d+m+p)/3}function o(a){let c=Math.min(Math.max(a.similarityThreshold||.8,.01),1);const{targetColor:l,colorArray:u}=a,h=t(l);if(h===null)return null;let d;if(h==="hex")d=e(l);else if(h==="rgb")d=l;else if(h==="hsl"){const{h:g,s:y,l:v}=l;d=r(g,y,v)}else if(h==="hsv"){const{h:g,s:y,v}=l;d=i(g,y,v)}else return null;let m=null,p=0;for(const g of u){t(g.hex?g.hex:g.rgb),g.hex?g.rgb||(g.rgb=e(g.hex)):g.hex=n(g.rgb);const y=Math.round(s(d,g.rgb)*100)/100;y>=c&&y>p&&(p=y,m={name:g.name,hex:g.hex,rgb:g.rgb,similarity:y})}return m}return mk.default=o,mk}PIe();function lx(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function DIe(t){return t[Bd(0,t.length-1)]}function LIe(t,e){return e[Kee(t,0,e.length-1)]}function Wp(...t){return DIe(t.flat())}function UIe(t,...e){return LIe(t,e.flat())}function BIe(t){return[...new Set(t)].filter(ge)}const wn=60,Nr=25,fg=wn*Nr;var Tr=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Tr||{});const f5=14,ux=3,sf=8,of=14,Jp=16,h5=16,Kne=16;var zs=(t=>(t[t.BLANK=0]="BLANK",t[t.TILES=1]="TILES",t[t.SPRITES=2]="SPRITES",t[t.DITHER=3]="DITHER",t[t.MEDIA=4]="MEDIA",t[t.CONTROL=5]="CONTROL",t))(zs||{}),mo=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(mo||{});function Kx(t){let e=0,n=0,r=wn*.5,i=Nr*.5,s=1.5,o="flat",a=0;return t.forEach(c=>{switch(c.type){case 1:e=Math.max(e,c.width),n=Math.max(n,c.height);break;case 3:e=Math.max(e,c.width),n=Math.max(n,c.height);break;case 5:r=c.focusx,i=c.focusy,s=c.viewscale,o=c.graphics,a=c.facing;break}}),{width:e,height:n,focusx:r,focusy:i,viewscale:s,graphics:o,facing:a}}function fb(t,e){return`${t}:${e}`}const J8=1,Q8=16,eF=256;var rn=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(rn||{});function fx(t,e=16){return t?lx(e-1).map(n=>{const r=n*ux;return new Xi(t.bits[r]/63,t.bits[r+1]/63,t.bits[r+2]/63)}):[]}var MO={exports:{}},kO={exports:{}},FIe=kO.exports,y$;function jIe(){return y$||(y$=1,(function(t,e){(function(n,r){t.exports=r()})(FIe,function(){function n(g){return!isNaN(parseFloat(g))&&isFinite(g)}function r(g){return g.charAt(0).toUpperCase()+g.substring(1)}function i(g){return function(){return this[g]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(g){if(g)for(var y=0;y<u.length;y++)g[u[y]]!==void 0&&this["set"+r(u[y])](g[u[y]])}h.prototype={getArgs:function(){return this.args},setArgs:function(g){if(Object.prototype.toString.call(g)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=g},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(g){if(g instanceof h)this.evalOrigin=g;else if(g instanceof Object)this.evalOrigin=new h(g);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var g=this.getFileName()||"",y=this.getLineNumber()||"",v=this.getColumnNumber()||"",x=this.getFunctionName()||"";return this.getIsEval()?g?"[eval] ("+g+":"+y+":"+v+")":"[eval]:"+y+":"+v:x?x+" ("+g+":"+y+":"+v+")":g+":"+y+":"+v}},h.fromString=function(y){var v=y.indexOf("("),x=y.lastIndexOf(")"),E=y.substring(0,v),C=y.substring(v+1,x).split(","),A=y.substring(x+1);if(A.indexOf("@")===0)var k=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(A,""),M=k[1],I=k[2],z=k[3];return new h({functionName:E,args:C||void 0,fileName:M,lineNumber:I||void 0,columnNumber:z||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+r(s[d])]=i(s[d]),h.prototype["set"+r(s[d])]=(function(g){return function(y){this[g]=!!y}})(s[d]);for(var m=0;m<o.length;m++)h.prototype["get"+r(o[m])]=i(o[m]),h.prototype["set"+r(o[m])]=(function(g){return function(y){if(!n(y))throw new TypeError(g+" must be a Number");this[g]=Number(y)}})(o[m]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=(function(g){return function(y){this[g]=String(y)}})(a[p]);return h})})(kO)),kO.exports}var zIe=MO.exports,b$;function HIe(){return b$||(b$=1,(function(t,e){(function(n,r){t.exports=r(jIe())})(zIe,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var m=this.extractLocation(d?d[1]:h),p=d&&h||void 0,g=["eval","<anonymous>"].indexOf(m[0])>-1?void 0:m[0];return new r({functionName:p,fileName:g,lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),m=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:m,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,m=u.length;d<m;d+=2){var p=l.exec(u[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,m=u.length;d<m;d+=2){var p=l.exec(u[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),m=h.shift()||"",p=m.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,g;m.match(/\(([^)]*)\)/)&&(g=m.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var y=g===void 0||g==="[arguments not available]"?void 0:g.split(",");return new r({functionName:p,args:y,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(MO)),MO.exports}var qIe=HIe();const VIe=su(qIe),B0=!!JSON.parse("false"),GIe=!!JSON.parse("false"),$Ie=!!JSON.parse("false"),E$=!!JSON.parse("false");JSON.parse("false");JSON.parse("false");JSON.parse("false");JSON.parse("false");const En={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return sf*En.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return of*En.DRAW_CHAR_SCALE}};function Uv(t){const e={},n={everytick(){},aftertick(){},listcommands(){return Cv(e)},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}var d5;try{d5=new TextDecoder}catch{}var zn,O0,wt=0,Uo={},ns,Py,Hp=0,S0=0,Yl,yv,Kh=[],Wi,S$={useRecords:!1,mapsAsObjects:!0};class Xne{}const Yne=new Xne;Yne.name="MessagePack 0xC1";var Uy=!1,Zne=2,WIe;try{new Function("")}catch{Zne=1/0}class kA{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(zn)return rre(()=>(m5(),this?this.unpack(e,n):kA.prototype.unpack.call(S$,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Lo<"u"?Lo.from(e):new Uint8Array(e)),typeof n=="object"?(O0=n.end||e.length,wt=n.start||0):(wt=0,O0=n>-1?n:e.length),S0=0,Py=null,Yl=null,zn=e;try{Wi=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw zn=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof kA){if(Uo=this,this.structures)return ns=this.structures,gk(n);(!ns||ns.length>0)&&(ns=[])}else Uo=S$,(!ns||ns.length>0)&&(ns=[]);return gk(n)}unpackMultiple(e,n){let r,i=0;try{Uy=!0;let s=e.length,o=this?this.unpack(e,s):y3.unpack(e,s);if(n){if(n(o,i,wt)===!1)return;for(;wt<s;)if(i=wt,n(gk(),i,wt)===!1)return}else{for(r=[o];wt<s;)i=wt,r.push(gk());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Uy=!1,m5()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function gk(t){try{if(!Uo.trusted&&!Uy){let n=ns.sharedLength||0;n<ns.length&&(ns.length=n)}let e;if(Uo.randomAccessStructure&&zn[wt]<64&&zn[wt]>=32&&WIe||(e=wc()),Yl&&(wt=Yl.postBundlePosition,Yl=null),Uy&&(ns.restoreStructures=null),wt==O0)ns&&ns.restoreStructures&&x$(),ns=null,zn=null,yv&&(yv=null);else{if(wt>O0)throw new Error("Unexpected end of MessagePack data");if(!Uy){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw ns&&ns.restoreStructures&&x$(),m5(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||wt>O0)&&(e.incomplete=!0),e}}function x$(){for(let t in ns.restoreStructures)ns[t]=ns.restoreStructures[t];ns.restoreStructures=null}function wc(){let t=zn[wt++];if(t<160)if(t<128){if(t<64)return t;{let e=ns[t&63]||Uo.getStructures&&Jne()[t&63];return e?(e.read||(e.read=tF(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,Uo.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=ere();r==="__proto__"&&(r="__proto_"),e[r]=wc()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(wc(),wc());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=wc();return Uo.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(S0>=wt)return Py.slice(wt-Hp,(wt+=e)-Hp);if(S0==0&&O0<140){let n=e<16?nF(e):Qne(e);if(n!=null)return n}return p5(e)}else{let e;switch(t){case 192:return null;case 193:return Yl?(e=wc(),e>0?Yl[1].slice(Yl.position1,Yl.position1+=e):Yl[0].slice(Yl.position0,Yl.position0-=e)):Yne;case 194:return!1;case 195:return!0;case 196:if(e=zn[wt++],e===void 0)throw new Error("Unexpected end of buffer");return lL(e);case 197:return e=Wi.getUint16(wt),wt+=2,lL(e);case 198:return e=Wi.getUint32(wt),wt+=4,lL(e);case 199:return jb(zn[wt++]);case 200:return e=Wi.getUint16(wt),wt+=2,jb(e);case 201:return e=Wi.getUint32(wt),wt+=4,jb(e);case 202:if(e=Wi.getFloat32(wt),Uo.useFloat32>2){let n=rF[(zn[wt]&127)<<1|zn[wt+1]>>7];return wt+=4,(n*e+(e>0?.5:-.5)>>0)/n}return wt+=4,e;case 203:return e=Wi.getFloat64(wt),wt+=8,e;case 204:return zn[wt++];case 205:return e=Wi.getUint16(wt),wt+=2,e;case 206:return e=Wi.getUint32(wt),wt+=4,e;case 207:return Uo.int64AsType==="number"?(e=Wi.getUint32(wt)*4294967296,e+=Wi.getUint32(wt+4)):Uo.int64AsType==="string"?e=Wi.getBigUint64(wt).toString():Uo.int64AsType==="auto"?(e=Wi.getBigUint64(wt),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Wi.getBigUint64(wt),wt+=8,e;case 208:return Wi.getInt8(wt++);case 209:return e=Wi.getInt16(wt),wt+=2,e;case 210:return e=Wi.getInt32(wt),wt+=4,e;case 211:return Uo.int64AsType==="number"?(e=Wi.getInt32(wt)*4294967296,e+=Wi.getUint32(wt+4)):Uo.int64AsType==="string"?e=Wi.getBigInt64(wt).toString():Uo.int64AsType==="auto"?(e=Wi.getBigInt64(wt),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Wi.getBigInt64(wt),wt+=8,e;case 212:if(e=zn[wt++],e==114)return M$(zn[wt++]&63);{let n=Kh[e];if(n)return n.read?(wt++,n.read(wc())):n.noBuffer?(wt++,n()):n(zn.subarray(wt,++wt));throw new Error("Unknown extension "+e)}case 213:return e=zn[wt],e==114?(wt++,M$(zn[wt++]&63,zn[wt++])):jb(2);case 214:return jb(4);case 215:return jb(8);case 216:return jb(16);case 217:return e=zn[wt++],S0>=wt?Py.slice(wt-Hp,(wt+=e)-Hp):XIe(e);case 218:return e=Wi.getUint16(wt),wt+=2,S0>=wt?Py.slice(wt-Hp,(wt+=e)-Hp):YIe(e);case 219:return e=Wi.getUint32(wt),wt+=4,S0>=wt?Py.slice(wt-Hp,(wt+=e)-Hp):ZIe(e);case 220:return e=Wi.getUint16(wt),wt+=2,w$(e);case 221:return e=Wi.getUint32(wt),wt+=4,w$(e);case 222:return e=Wi.getUint16(wt),wt+=2,R$(e);case 223:return e=Wi.getUint32(wt),wt+=4,R$(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const KIe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function tF(t,e){function n(){if(n.count++>Zne){let i=t.read=new Function("r","return function(){return "+(Uo.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":KIe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(wc);return t.highByte===0&&(t.read=T$(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=wc()}return Uo.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?T$(e,n):n}const T$=(t,e)=>function(){let n=zn[wt++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=ns[r]||Jne()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=tF(i,t)),i.read()};function Jne(){let t=rre(()=>(zn=null,Uo.getStructures()));return ns=Uo._mergeStructures(t,ns)}var p5=AM,XIe=AM,YIe=AM,ZIe=AM;function AM(t){let e;if(t<16&&(e=nF(t)))return e;if(t>64&&d5)return d5.decode(zn.subarray(wt,wt+=t));const n=wt+t,r=[];for(e="";wt<n;){const i=zn[wt++];if((i&128)===0)r.push(i);else if((i&224)===192){const s=zn[wt++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=zn[wt++]&63,o=zn[wt++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=zn[wt++]&63,o=zn[wt++]&63,a=zn[wt++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=Gl.apply(String,r),r.length=0)}return r.length>0&&(e+=Gl.apply(String,r)),e}function w$(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=wc();return Uo.freezeData?Object.freeze(e):e}function R$(t){if(Uo.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=ere();r==="__proto__"&&(r="__proto_"),e[r]=wc()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(wc(),wc());return e}}var Gl=String.fromCharCode;function Qne(t){let e=wt,n=new Array(t);for(let r=0;r<t;r++){const i=zn[wt++];if((i&128)>0){wt=e;return}n[r]=i}return Gl.apply(String,n)}function nF(t){if(t<4)if(t<2){if(t===0)return"";{let e=zn[wt++];if((e&128)>1){wt-=1;return}return Gl(e)}}else{let e=zn[wt++],n=zn[wt++];if((e&128)>0||(n&128)>0){wt-=2;return}if(t<3)return Gl(e,n);let r=zn[wt++];if((r&128)>0){wt-=3;return}return Gl(e,n,r)}else{let e=zn[wt++],n=zn[wt++],r=zn[wt++],i=zn[wt++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){wt-=4;return}if(t<6){if(t===4)return Gl(e,n,r,i);{let s=zn[wt++];if((s&128)>0){wt-=5;return}return Gl(e,n,r,i,s)}}else if(t<8){let s=zn[wt++],o=zn[wt++];if((s&128)>0||(o&128)>0){wt-=6;return}if(t<7)return Gl(e,n,r,i,s,o);let a=zn[wt++];if((a&128)>0){wt-=7;return}return Gl(e,n,r,i,s,o,a)}else{let s=zn[wt++],o=zn[wt++],a=zn[wt++],c=zn[wt++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){wt-=8;return}if(t<10){if(t===8)return Gl(e,n,r,i,s,o,a,c);{let l=zn[wt++];if((l&128)>0){wt-=9;return}return Gl(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=zn[wt++],u=zn[wt++];if((l&128)>0||(u&128)>0){wt-=10;return}if(t<11)return Gl(e,n,r,i,s,o,a,c,l,u);let h=zn[wt++];if((h&128)>0){wt-=11;return}return Gl(e,n,r,i,s,o,a,c,l,u,h)}else{let l=zn[wt++],u=zn[wt++],h=zn[wt++],d=zn[wt++];if((l&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){wt-=12;return}if(t<14){if(t===12)return Gl(e,n,r,i,s,o,a,c,l,u,h,d);{let m=zn[wt++];if((m&128)>0){wt-=13;return}return Gl(e,n,r,i,s,o,a,c,l,u,h,d,m)}}else{let m=zn[wt++],p=zn[wt++];if((m&128)>0||(p&128)>0){wt-=14;return}if(t<15)return Gl(e,n,r,i,s,o,a,c,l,u,h,d,m,p);let g=zn[wt++];if((g&128)>0){wt-=15;return}return Gl(e,n,r,i,s,o,a,c,l,u,h,d,m,p,g)}}}}}function C$(){let t=zn[wt++],e;if(t<192)e=t-160;else switch(t){case 217:e=zn[wt++];break;case 218:e=Wi.getUint16(wt),wt+=2;break;case 219:e=Wi.getUint32(wt),wt+=4;break;default:throw new Error("Expected string")}return AM(e)}function lL(t){return Uo.copyBuffers?Uint8Array.prototype.slice.call(zn,wt,wt+=t):zn.subarray(wt,wt+=t)}function jb(t){let e=zn[wt++];if(Kh[e]){let n;return Kh[e](zn.subarray(wt,n=wt+=t),r=>{wt=r;try{return wc()}finally{wt=n}})}else throw new Error("Unknown extension type "+e)}var A$=new Array(4096);function ere(){let t=zn[wt++];if(t>=160&&t<192){if(t=t-160,S0>=wt)return Py.slice(wt-Hp,(wt+=t)-Hp);if(!(S0==0&&O0<180))return p5(t)}else return wt--,tre(wc());let e=(t<<5^(t>1?Wi.getUint16(wt):t>0?zn[wt]:0))&4095,n=A$[e],r=wt,i=wt+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Wi.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=zn[r++],s!=n[o++]){r=1879048192;break}if(r===i)return wt=r,n.string;i-=3,r=wt}for(n=[],A$[e]=n,n.bytes=t;r<i;)s=Wi.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=zn[r++],n.push(s);let a=t<16?nF(t):Qne(t);return a!=null?n.string=a:n.string=p5(t)}function tre(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";if(Uo.allowArraysInMapKeys&&Array.isArray(t)&&t.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return t.flat().toString();throw new Error(`Invalid property type for record: ${typeof t}`)}const M$=(t,e)=>{let n=wc().map(tre),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=ns[t];return i&&(i.isShared||Uy)&&((ns.restoreStructures||(ns.restoreStructures=[]))[t]=i),ns[t]=n,n.read=tF(n,r),n.read()};Kh[0]=()=>{};Kh[0].noBuffer=!0;Kh[66]=t=>{let e=t.byteLength%8||8,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);if(t.byteLength!==e){let r=new DataView(t.buffer,t.byteOffset,t.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let h=r.getBigUint64(s);for(let d=s+8;d<o;d+=8)h<<=64n,h|=r.getBigUint64(d);return h}let c=s+(a>>4<<3),l=i(s,c),u=i(c,o);return l<<BigInt((o-c)*8)|u};n=n<<BigInt((r.byteLength-e)*8)|i(e,r.byteLength)}return n};let k$={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};Kh[101]=()=>{let t=wc();if(!k$[t[0]]){let e=Error(t[1],{cause:t[2]});return e.name=t[0],e}return k$[t[0]](t[1],{cause:t[2]})};Kh[105]=t=>{if(Uo.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Wi.getUint32(wt-4);yv||(yv=new Map);let n=zn[wt],r;n>=144&&n<160||n==220||n==221?r=[]:n>=128&&n<144||n==222||n==223?r=new Map:(n>=199&&n<=201||n>=212&&n<=216)&&zn[wt+1]===115?r=new Set:r={};let i={target:r};yv.set(e,i);let s=wc();if(i.used)Object.assign(r,s);else return i.target=s;if(r instanceof Map)for(let[o,a]of s.entries())r.set(o,a);if(r instanceof Set)for(let o of Array.from(s))r.add(o);return r};Kh[112]=t=>{if(Uo.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Wi.getUint32(wt-4),n=yv.get(e);return n.used=!0,n.target};Kh[115]=()=>new Set(wc());const nre=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let JIe=typeof globalThis=="object"?globalThis:window;Kh[116]=t=>{let e=t[0],n=Uint8Array.prototype.slice.call(t,1).buffer,r=nre[e];if(!r){if(e===16)return n;if(e===17)return new DataView(n);throw new Error("Could not find typed array for code "+e)}return new JIe[r](n)};Kh[120]=()=>{let t=wc();return new RegExp(t[0],t[1])};const QIe=[];Kh[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=wt;return wt+=e-t.length,Yl=QIe,Yl=[C$(),C$()],Yl.position0=0,Yl.position1=0,Yl.postBundlePosition=wt,wt=n,wc()};Kh[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function rre(t){let e=O0,n=wt,r=Hp,i=S0,s=Py,o=yv,a=Yl,c=new Uint8Array(zn.slice(0,O0)),l=ns,u=ns.slice(0,ns.length),h=Uo,d=Uy,m=t();return O0=e,wt=n,Hp=r,S0=i,Py=s,yv=o,Yl=a,zn=c,Uy=d,ns=l,ns.splice(0,ns.length,...u),Uo=h,Wi=new DataView(zn.buffer,zn.byteOffset,zn.byteLength),m}function m5(){zn=null,yv=null,ns=null}const rF=new Array(147);for(let t=0;t<256;t++)rF[t]=+("1e"+Math.floor(45.15-t*.30103));var y3=new kA({useRecords:!1});y3.unpack;y3.unpackMultiple;y3.unpack;let eNe=new Float32Array(1);new Uint8Array(eNe.buffer,0,4);let OO;try{OO=new TextEncoder}catch{}let g5,ire;const hx=typeof Lo<"u",_k=hx?function(t){return Lo.allocUnsafeSlow(t)}:Uint8Array,sre=hx?Lo:Uint8Array,O$=hx?4294967296:2144337920;let Ht,fC,wo,At=0,Zu,Na=null,tNe;const nNe=21760,rNe=/[\u0080-\uFFFF]/,QE=Symbol("record-id");class iNe extends kA{constructor(e){super(e),this.offset=0;let n,r,i,s,o=sre.prototype.utf8Write?function(F,N){return Ht.utf8Write(F,N,Ht.byteLength-N)}:OO&&OO.encodeInto?function(F,N){return OO.encodeInto(F,Ht.subarray(N)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||h+u>64,m=u+64,p=u+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],y=0,v=0;this.pack=this.encode=function(F,N){if(Ht||(Ht=new _k(8192),wo=Ht.dataView||(Ht.dataView=new DataView(Ht.buffer,0,8192)),At=0),Zu=Ht.length-10,Zu-At<2048?(Ht=new _k(Ht.length),wo=Ht.dataView||(Ht.dataView=new DataView(Ht.buffer,0,Ht.length)),Zu=Ht.length-10,At=0):At=At+7&2147483640,n=At,N&lNe&&(At+=N&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof F!="string"?(Na=[],Na.size=1/0):Na=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let G=i.sharedLength||0;if(G>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let j=0;j<G;j++){let q=i[j];if(!q)continue;let te,W=i.transitions;for(let $=0,J=q.length;$<J;$++){let ne=q[$];te=W[ne],te||(te=W[ne]=Object.create(null)),W=te}W[QE]=j+64}this.lastNamedStructuresLength=G}c||(i.nextId=G+64)}r&&(r=!1);let X;try{a.randomAccessStructure&&F&&F.constructor&&F.constructor===Object?P(F):C(F);let G=Na;if(Na&&N$(n,C,0),s&&s.idsToInsert){let j=s.idsToInsert.sort(($,J)=>$.offset>J.offset?1:-1),q=j.length,te=-1;for(;G&&q>0;){let $=j[--q].offset+n;$<G.stringsPosition+n&&te===-1&&(te=0),$>G.position+n?te>=0&&(te+=6):(te>=0&&(wo.setUint32(G.position+n,wo.getUint32(G.position+n)+te),te=-1),G=G.previous,q++)}te>=0&&G&&wo.setUint32(G.position+n,wo.getUint32(G.position+n)+te),At+=j.length*6,At>Zu&&z(At),a.offset=At;let W=sNe(Ht.subarray(n,At),j);return s=null,W}return a.offset=At,N&aNe?(Ht.start=n,Ht.end=At,Ht):Ht.subarray(n,At)}catch(G){throw X=G,G}finally{if(i&&(x(),r&&a.saveStructures)){let G=i.sharedLength||0,j=Ht.subarray(n,At),q=oNe(i,a);if(!X)return a.saveStructures(q,q.isCompatible)===!1?a.pack(F,N):(a.lastNamedStructuresLength=G,Ht.length>1073741824&&(Ht=null),j)}Ht.length>1073741824&&(Ht=null),N&cNe&&(At=n)}};const x=()=>{v<10&&v++;let F=i.sharedLength||0;if(i.length>F&&!c&&(i.length=F),y>1e4)i.transitions=null,v=0,y=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let N=0,X=g.length;N<X;N++)g[N][QE]=0;g=[]}},E=F=>{var N=F.length;N<16?Ht[At++]=144|N:N<65536?(Ht[At++]=220,Ht[At++]=N>>8,Ht[At++]=N&255):(Ht[At++]=221,wo.setUint32(At,N),At+=4);for(let X=0;X<N;X++)C(F[X])},C=F=>{At>Zu&&(Ht=z(At));var N=typeof F,X;if(N==="string"){let G=F.length;if(Na&&G>=4&&G<4096){if((Na.size+=G)>nNe){let W,$=(Na[0]?Na[0].length*3+Na[1].length:0)+10;At+$>Zu&&(Ht=z(At+$));let J;Na.position?(J=Na,Ht[At]=200,At+=3,Ht[At++]=98,W=At-n,At+=4,N$(n,C,0),wo.setUint16(W+n-3,At-n-W)):(Ht[At++]=214,Ht[At++]=98,W=At-n,At+=4),Na=["",""],Na.previous=J,Na.size=0,Na.position=W}let te=rNe.test(F);Na[te?0:1]+=F,Ht[At++]=193,C(te?-G:G);return}let j;G<32?j=1:G<256?j=2:G<65536?j=3:j=5;let q=G*3;if(At+q>Zu&&(Ht=z(At+q)),G<64||!o){let te,W,$,J=At+j;for(te=0;te<G;te++)W=F.charCodeAt(te),W<128?Ht[J++]=W:W<2048?(Ht[J++]=W>>6|192,Ht[J++]=W&63|128):(W&64512)===55296&&(($=F.charCodeAt(te+1))&64512)===56320?(W=65536+((W&1023)<<10)+($&1023),te++,Ht[J++]=W>>18|240,Ht[J++]=W>>12&63|128,Ht[J++]=W>>6&63|128,Ht[J++]=W&63|128):(Ht[J++]=W>>12|224,Ht[J++]=W>>6&63|128,Ht[J++]=W&63|128);X=J-At-j}else X=o(F,At+j);X<32?Ht[At++]=160|X:X<256?(j<2&&Ht.copyWithin(At+2,At+1,At+1+X),Ht[At++]=217,Ht[At++]=X):X<65536?(j<3&&Ht.copyWithin(At+3,At+2,At+2+X),Ht[At++]=218,Ht[At++]=X>>8,Ht[At++]=X&255):(j<5&&Ht.copyWithin(At+5,At+3,At+3+X),Ht[At++]=219,wo.setUint32(At,X),At+=4),At+=X}else if(N==="number")if(F>>>0===F)F<32||F<128&&this.useRecords===!1||F<64&&!this.randomAccessStructure?Ht[At++]=F:F<256?(Ht[At++]=204,Ht[At++]=F):F<65536?(Ht[At++]=205,Ht[At++]=F>>8,Ht[At++]=F&255):(Ht[At++]=206,wo.setUint32(At,F),At+=4);else if(F>>0===F)F>=-32?Ht[At++]=256+F:F>=-128?(Ht[At++]=208,Ht[At++]=F+256):F>=-32768?(Ht[At++]=209,wo.setInt16(At,F),At+=2):(Ht[At++]=210,wo.setInt32(At,F),At+=4);else{let G;if((G=this.useFloat32)>0&&F<4294967296&&F>=-2147483648){Ht[At++]=202,wo.setFloat32(At,F);let j;if(G<4||(j=F*rF[(Ht[At]&127)<<1|Ht[At+1]>>7])>>0===j){At+=4;return}else At--}Ht[At++]=203,wo.setFloat64(At,F),At+=8}else if(N==="object"||N==="function")if(!F)Ht[At++]=192;else{if(s){let j=s.get(F);if(j){if(!j.id){let q=s.idsToInsert||(s.idsToInsert=[]);j.id=q.push(j)}Ht[At++]=214,Ht[At++]=112,wo.setUint32(At,j.id),At+=4;return}else s.set(F,{offset:At-n})}let G=F.constructor;if(G===Object)I(F);else if(G===Array)E(F);else if(G===Map)if(this.mapAsEmptyObject)Ht[At++]=128;else{X=F.size,X<16?Ht[At++]=128|X:X<65536?(Ht[At++]=222,Ht[At++]=X>>8,Ht[At++]=X&255):(Ht[At++]=223,wo.setUint32(At,X),At+=4);for(let[j,q]of F)C(j),C(q)}else{for(let j=0,q=g5.length;j<q;j++){let te=ire[j];if(F instanceof te){let W=g5[j];if(W.write){W.type&&(Ht[At++]=212,Ht[At++]=W.type,Ht[At++]=0);let ae=W.write.call(this,F);ae===F?Array.isArray(F)?E(F):I(F):C(ae);return}let $=Ht,J=wo,ne=At;Ht=null;let ie;try{ie=W.pack.call(this,F,ae=>(Ht=$,$=null,At+=ae,At>Zu&&z(At),{target:Ht,targetView:wo,position:At-ae}),C)}finally{$&&(Ht=$,wo=J,At=ne,Zu=Ht.length-10)}ie&&(ie.length+At>Zu&&z(ie.length+At),At=I$(ie,Ht,At,W.type));return}}if(Array.isArray(F))E(F);else{if(F.toJSON){const j=F.toJSON();if(j!==F)return C(j)}if(N==="function")return C(this.writeFunction&&this.writeFunction(F));I(F)}}}else if(N==="boolean")Ht[At++]=F?195:194;else if(N==="bigint"){if(F<9223372036854776e3&&F>=-9223372036854776e3)Ht[At++]=211,wo.setBigInt64(At,F);else if(F<18446744073709552e3&&F>0)Ht[At++]=207,wo.setBigUint64(At,F);else if(this.largeBigIntToFloat)Ht[At++]=203,wo.setFloat64(At,Number(F));else{if(this.largeBigIntToString)return C(F.toString());if(this.useBigIntExtension||this.moreTypes){let G=F<0?BigInt(-1):BigInt(0),j;if(F>>BigInt(65536)===G){let q=BigInt(18446744073709552e3)-BigInt(1),te=[];for(;te.push(F&q),F>>BigInt(63)!==G;)F>>=BigInt(64);j=new Uint8Array(new BigUint64Array(te).buffer),j.reverse()}else{let q=F<0,te=(q?~F:F).toString(16);if(te.length%2?te="0"+te:parseInt(te.charAt(0),16)>=8&&(te="00"+te),hx)j=Lo.from(te,"hex");else{j=new Uint8Array(te.length/2);for(let W=0;W<j.length;W++)j[W]=parseInt(te.slice(W*2,W*2+2),16)}if(q)for(let W=0;W<j.length;W++)j[W]=~j[W]}j.length+At>Zu&&z(j.length+At),At=I$(j,Ht,At,66);return}else throw new RangeError(F+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}At+=8}else if(N==="undefined")this.encodeUndefinedAsNil?Ht[At++]=192:(Ht[At++]=212,Ht[At++]=0,Ht[At++]=0);else throw new Error("Unknown type: "+N)},A=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?F=>{let N;if(this.skipValues){N=[];for(let j in F)(typeof F.hasOwnProperty!="function"||F.hasOwnProperty(j))&&!this.skipValues.includes(F[j])&&N.push(j)}else N=Object.keys(F);let X=N.length;X<16?Ht[At++]=128|X:X<65536?(Ht[At++]=222,Ht[At++]=X>>8,Ht[At++]=X&255):(Ht[At++]=223,wo.setUint32(At,X),At+=4);let G;if(this.coercibleKeyAsNumber)for(let j=0;j<X;j++){G=N[j];let q=Number(G);C(isNaN(q)?G:q),C(F[G])}else for(let j=0;j<X;j++)C(G=N[j]),C(F[G])}:F=>{Ht[At++]=222;let N=At-n;At+=2;let X=0;for(let G in F)(typeof F.hasOwnProperty!="function"||F.hasOwnProperty(G))&&(C(G),C(F[G]),X++);if(X>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');Ht[N+++n]=X>>8,Ht[N+n]=X&255},k=this.useRecords===!1?A:e.progressiveRecords&&!d?F=>{let N,X=i.transitions||(i.transitions=Object.create(null)),G=At++-n,j;for(let q in F)if(typeof F.hasOwnProperty!="function"||F.hasOwnProperty(q)){if(N=X[q],N)X=N;else{let te=Object.keys(F),W=X;X=i.transitions;let $=0;for(let J=0,ne=te.length;J<ne;J++){let ie=te[J];N=X[ie],N||(N=X[ie]=Object.create(null),$++),X=N}G+n+1==At?(At--,H(X,te,$)):K(X,te,G,$),j=!0,X=W[q]}C(F[q])}if(!j){let q=X[QE];q?Ht[G+n]=q:K(X,Object.keys(F),G,0)}}:F=>{let N,X=i.transitions||(i.transitions=Object.create(null)),G=0;for(let q in F)(typeof F.hasOwnProperty!="function"||F.hasOwnProperty(q))&&(N=X[q],N||(N=X[q]=Object.create(null),G++),X=N);let j=X[QE];j?j>=96&&d?(Ht[At++]=((j-=96)&31)+96,Ht[At++]=j>>5):Ht[At++]=j:H(X,X.__keys__||Object.keys(F),G);for(let q in F)(typeof F.hasOwnProperty!="function"||F.hasOwnProperty(q))&&C(F[q])},M=typeof this.useRecords=="function"&&this.useRecords,I=M?F=>{M(F)?k(F):A(F)}:k,z=F=>{let N;if(F>16777216){if(F-n>O$)throw new Error("Packed buffer would be larger than maximum buffer size");N=Math.min(O$,Math.round(Math.max((F-n)*(F>67108864?1.25:2),4194304)/4096)*4096)}else N=(Math.max(F-n<<2,Ht.length-1)>>12)+1<<12;let X=new _k(N);return wo=X.dataView||(X.dataView=new DataView(X.buffer,0,N)),F=Math.min(F,Ht.length),Ht.copy?Ht.copy(X,0,n,F):X.set(Ht.slice(n,F)),At-=n,n=0,Zu=X.length-10,Ht=X},H=(F,N,X)=>{let G=i.nextId;G||(G=64),G<m&&this.shouldShareStructure&&!this.shouldShareStructure(N)?(G=i.nextOwnId,G<p||(G=m),i.nextOwnId=G+1):(G>=p&&(G=m),i.nextId=G+1);let j=N.highByte=G>=96&&d?G-96>>5:-1;F[QE]=G,F.__keys__=N,i[G-64]=N,G<m?(N.isShared=!0,i.sharedLength=G-63,r=!0,j>=0?(Ht[At++]=(G&31)+96,Ht[At++]=j):Ht[At++]=G):(j>=0?(Ht[At++]=213,Ht[At++]=114,Ht[At++]=(G&31)+96,Ht[At++]=j):(Ht[At++]=212,Ht[At++]=114,Ht[At++]=G),X&&(y+=v*X),g.length>=h&&(g.shift()[QE]=0),g.push(F),C(N))},K=(F,N,X,G)=>{let j=Ht,q=At,te=Zu,W=n;Ht=fC,At=0,n=0,Ht||(fC=Ht=new _k(8192)),Zu=Ht.length-10,H(F,N,G),fC=Ht;let $=At;if(Ht=j,At=q,Zu=te,n=W,$>1){let J=At+$-1;J>Zu&&z(J);let ne=X+n;Ht.copyWithin(ne+$,ne+1,At),Ht.set(fC.slice(0,$),ne),At=J}else Ht[X+n]=fC[0]},P=F=>{let N=tNe(F,Ht,n,At,i,z,(X,G,j)=>{if(j)return r=!0;At=G;let q=Ht;return C(X),x(),q!==Ht?{position:At,targetView:wo,target:Ht}:At},this);if(N===0)return I(F);At=N}}useBuffer(e){Ht=e,Ht.dataView||(Ht.dataView=new DataView(Ht.buffer,Ht.byteOffset,Ht.byteLength)),wo=Ht.dataView,At=0}set position(e){At=e}get position(){return At}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}ire=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,Xne];g5=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?uL(t,16,e):fL(hx?Lo.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==sre&&this.moreTypes?uL(t,nre.indexOf(n.name),e):fL(t,e)}},{pack(t,e){this.moreTypes?uL(t,17,e):fL(hx?Lo.from(t):new Uint8Array(t),e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function uL(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function fL(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function I$(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function sNe(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function N$(t,e,n){if(Na.length>0){wo.setUint32(Na.position+t,At+n-Na.position-t),Na.stringsPosition=At-t;let r=Na;Na=null,e(r[0]),e(r[1])}}function oNe(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let ore=new iNe({useRecords:!1});ore.pack;ore.pack;const aNe=512,cNe=1024,lNe=2048;function iF(t,e,n={}){if(ge(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];ge(a)&&(s=a);const c=n[s];ge(c)&&(o=c(o)),r[s]=o}return r}catch(r){Pr(ut,"","format",r.message)}}function uNe(t,e){return t%e}function fNe(t,e){return Math.floor(t/e)}function dx(t,e){return{x:uNe(t,e),y:fNe(t,e)}}function P$(t,e){const n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function Wc(t,e){return t.x+t.y*e}function hNe(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function D$(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}function By(t){return ge(t)&&ge(t.x)&&ge(t.y)}function Ja(t,e){switch(e){case pn.NORTH:--t.y;break;case pn.SOUTH:++t.y;break;case pn.WEST:--t.x;break;case pn.EAST:++t.x;break}return t}function _1(t,e){return t<0?pn.WEST:t>0?pn.EAST:e<0?pn.NORTH:e>0?pn.SOUTH:pn.IDLE}function p0(t,e){return _1(e.x-t.x,e.y-t.y)}const are={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",mid:"MID",over:"OVER",under:"UNDER",ground:"GROUND",within:"WITHIN",awayby:"AWAYBY"};function om(t){return Rr(t)&&cre(t[0])}function cre(t){return ge(pn[t])&&Sn(t)}function lre(t){const e=pn[t];return ge(e)?e:pn.IDLE}function b3(t){if(Sn(t))return are[hr(t)]}function dNe(t){if(om(t))return t;if(cre(t))return[t];const e=b3(t);if(ge(e))return[e]}function L$(t){const e=Ee.words[t],n=dNe(e);return om(n)?[n,t+1]:[void 0,t]}function ure(t){const e=[];let[n,r]=L$(t);for(;om(n);){switch(e.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[a,c,l]=Gt(Ee.words,r,[yt.NUMBER,yt.NUMBER]);e.push(a,c),r=l;break}case"FLEE":case"FIND":{const[a,c]=Gt(Ee.words,r,[yt.KIND]);console.info("kind",a),r=c;break}case"TO":{const[a,c,l]=Gt(Ee.words,r,[yt.DIR,yt.DIR]),u=Ee.element?.x??0,h=Ee.element?.y??0;a.destpt.x-=u,a.destpt.y-=h,c.destpt.x-=u,c.destpt.y-=h,e.push(u+a.destpt.x+c.destpt.x,h+a.destpt.y+c.destpt.y),r=l;break}case"WITHIN":case"AWAYBY":{const[a,c]=Gt(Ee.words,r,[yt.NUMBER]);e.push(a),r=c;break}}const i=r;switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":case"WITHIN":case"AWAYBY":break;default:return[e,r]}const[s,o]=L$(i);n=s,r=o}return e.length?[e,r]:[void 0,t]}function pNe(t){if(ge(t)&&(t<en.ONBLACK||t>en.ONCLEAR))return t}function sF(t){return ge(t)&&t>en.WHITE&&t<en.ONCLEAR?t-en.ONBLACK:void 0}const E3={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR",blblack:"BLBLACK",bldkblue:"BLDKBLUE",bldkgreen:"BLDKGREEN",bldkcyan:"BLDKCYAN",bldkred:"BLDKRED",bldkpurple:"BLDKPURPLE",bldkyellow:"BLDKYELLOW",blltgray:"BLLTGRAY",bldkgray:"BLDKGRAY",blblue:"BLBLUE",blgreen:"BLGREEN",blcyan:"BLCYAN",blred:"BLRED",blpurple:"BLPURPLE",blyellow:"BLYELLOW",blwhite:"BLWHITE",blbrown:"BLDKYELLOW",bldkwhite:"BLLTGRAY",blltgrey:"BLLTGRAY",blgray:"BLLTGRAY",blgrey:"BLLTGRAY",bldkgrey:"BLDKGRAY",blltblack:"BLDKGRAY"};function $f(t){return Rr(t)&&fre(t[0])}function mNe(t){return $f(t)&&t[0].startsWith("ON")}function fre(t){return ge(en[t])&&Sn(t)}function OA(t){if(Sn(t))return E3[hr(t)]}function S3(t,e){return[ge(t)?`${en[t]}`:void 0,ge(e)?`ON${en[e]}`:void 0].filter(ge)}function LI(t){return t.map(e=>en[e]).find(e=>ge(e)&&e<en.ONBLACK)}function UI(t){return t.map(e=>en[e]).find(e=>ge(e)&&e>=en.ONBLACK)}function gNe(t){if($f(t))return t;if(fre(t))return[t];const e=OA(t);if(ge(e))return[e]}function U$(t){const e=Ee.words[t],n=gNe(e);return $f(n)?[n,t+1]:[void 0,t]}function BI(t){const e=[];let n=t;const r=parseFloat(Ee.words[t]);if(an(r))return[S3(r,void 0),t+1];const[i,s]=U$(t);$f(i)&&(e.push(...i),n=s);const[o,a]=U$(s);return mNe(o)&&(e.push(...o),n=a),e.length?[e,n]:[void 0,t]}function hre(t){const e={};for(let n=0;n<t.length;++n){const r=t[n],i=en[r];ge(i)&&(i<en.ONBLACK||i>en.ONCLEAR?e.color=i:e.bg=sF(i))}return e}function T1(t){return Rr(t)&&typeof t[0]=="string"}function _Ne(t){const e=Ee.words[t];return Sn(e)?[e,t+1]:[void 0,t]}function hL(t){const e=Ee.words[t];if(T1(e))return[e,t+1];const[n,r]=BI(t),[i,s]=_Ne(r);return Sn(i)&&(i==="empty"||tb({kind:i}))?[[i,n],s]:[void 0,t]}function IA(t){if(!T1(t))return;const[e]=t;return e}function FI(t){if(!T1(t))return;const[,e]=t,n=ge(e)?LI(e):void 0;return ge(n)?n:void 0}function dre(t){if(!T1(t))return;const[,e]=t,n=ge(e)?UI(e):void 0;return ge(n)?sF(n):void 0}function vNe(t){const e=document.createElement("canvas");if(e.width=t?.width||1,e.height=t?.height||1,t){const n=e.getContext("2d"),r=n?.getImageData(0,0,t.width,t.height);if(r&&n){let i=0;const{data:s}=r;for(let o=0;o<s.length;o+=4){const a=t.bits[i];s[o]=a,s[o+1]=a,s[o+2]=a,s[o+3]=255,i+=1}n.putImageData(r,0,0)}}return e}function oF(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}function dL(t,e,n){return{width:t,height:e,size:t*e,bits:new Uint8Array(n)}}function pL(t,e,n){if(!ge(t))return;const r=Math.round(t.height/n),i=Math.round(t.width/e),s=e+2,o=n+2,a=i*e,c=i*s,l=r*o,u=oF(c,l);for(let h=0;h<r;++h)for(let d=0;d<i;++d)for(let m=0;m<n;++m)for(let p=0;p<e;++p){const g=d*e+p,y=h*n+m,v=t.bits[g+y*a],x=d*s+p+1,E=h*o+m+1,C=x+E*c;u.bits[C]=v,p===0&&(u.bits[C-1]=v),p===sf-1&&(u.bits[C+1]=v),m===0&&(u.bits[C-c]=v),m===of-1&&(u.bits[C+c]=v)}return u}function lE(t){const e=Math.floor(t.length/ux);if(e*ux!==t.length)return;const n=oF(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function yNe(t,e){return t&1<<e?255:0}function uE(t){const e=Math.floor(t.length/f5);if(e*f5!==t.length)return;const n=Math.ceil(e/Jp),r=sf*Jp,i=oF(r,of*n);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*of+a,u=t[c];for(let h=0;h<sf;++h){const d=s*sf+h;i.bits[d+l*r]=yNe(u,7-h)}++a,a===of&&(a=0,++s,s===Jp&&(s=0,++o))}return i}/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const B$="0123456789abcdef",pre=[],jI=[];for(let t=0;t<256;t++)pre[t]=B$[t>>4&15]+B$[t&15],t<16&&(t<10?jI[48+t]=t:jI[87+t]=t);const mre=t=>{const e=t.length;let n="",r=0;for(;r<e;)n+=pre[t[r++]];return n},Hd=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=jI[t.charCodeAt(s++)]<<4|jI[t.charCodeAt(s++)];return r};var F$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bNe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var vk=0;vk<F$.length;vk++)bNe[F$.charCodeAt(vk)]=vk;new TextDecoder;new TextEncoder;const j$=typeof window<"u"?window:self,z$=j$.crypto||j$.msCrypto||{};z$.subtle||z$.webkitSubtle;const Xx=Hd("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),Yx=Hd("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f"),mv=globalThis||void 0||self;var gre=typeof mv=="object"&&mv&&mv.Object===Object&&mv,ENe=typeof self=="object"&&self&&self.Object===Object&&self,X0=gre||ENe||Function("return this")(),am=X0.Symbol,_re=Object.prototype,SNe=_re.hasOwnProperty,xNe=_re.toString,hC=am?am.toStringTag:void 0;function TNe(t){var e=SNe.call(t,hC),n=t[hC];try{t[hC]=void 0;var r=!0}catch{}var i=xNe.call(t);return r&&(e?t[hC]=n:delete t[hC]),i}var wNe=Object.prototype,RNe=wNe.toString;function CNe(t){return RNe.call(t)}var ANe="[object Null]",MNe="[object Undefined]",H$=am?am.toStringTag:void 0;function hb(t){return t==null?t===void 0?MNe:ANe:H$&&H$ in Object(t)?TNe(t):CNe(t)}function mg(t){return t!=null&&typeof t=="object"}var kNe="[object Symbol]";function x3(t){return typeof t=="symbol"||mg(t)&&hb(t)==kNe}function T3(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var hs=Array.isArray,q$=am?am.prototype:void 0,V$=q$?q$.toString:void 0;function vre(t){if(typeof t=="string")return t;if(hs(t))return T3(t,vre)+"";if(x3(t))return V$?V$.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var ONe=/\s/;function INe(t){for(var e=t.length;e--&&ONe.test(t.charAt(e)););return e}var NNe=/^\s+/;function PNe(t){return t&&t.slice(0,INe(t)+1).replace(NNe,"")}function cm(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var G$=NaN,DNe=/^[-+]0x[0-9a-f]+$/i,LNe=/^0b[01]+$/i,UNe=/^0o[0-7]+$/i,BNe=parseInt;function FNe(t){if(typeof t=="number")return t;if(x3(t))return G$;if(cm(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=cm(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=PNe(t);var n=LNe.test(t);return n||UNe.test(t)?BNe(t.slice(2),n?2:8):DNe.test(t)?G$:+t}var $$=1/0,jNe=17976931348623157e292;function zNe(t){if(!t)return t===0?t:0;if(t=FNe(t),t===$$||t===-$$){var e=t<0?-1:1;return e*jNe}return t===t?t:0}function w3(t){var e=zNe(t),n=e%1;return e===e?n?e-n:e:0}function px(t){return t}var HNe="[object AsyncFunction]",qNe="[object Function]",VNe="[object GeneratorFunction]",GNe="[object Proxy]";function Bv(t){if(!cm(t))return!1;var e=hb(t);return e==qNe||e==VNe||e==HNe||e==GNe}var mL=X0["__core-js_shared__"],W$=(function(){var t=/[^.]+$/.exec(mL&&mL.keys&&mL.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function $Ne(t){return!!W$&&W$ in t}var WNe=Function.prototype,KNe=WNe.toString;function fE(t){if(t!=null){try{return KNe.call(t)}catch{}try{return t+""}catch{}}return""}var XNe=/[\\^$.*+?()[\]{}|]/g,YNe=/^\[object .+?Constructor\]$/,ZNe=Function.prototype,JNe=Object.prototype,QNe=ZNe.toString,e3e=JNe.hasOwnProperty,t3e=RegExp("^"+QNe.call(e3e).replace(XNe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function n3e(t){if(!cm(t)||$Ne(t))return!1;var e=Bv(t)?t3e:YNe;return e.test(fE(t))}function r3e(t,e){return t?.[e]}function hE(t,e){var n=r3e(t,e);return n3e(n)?n:void 0}var _5=hE(X0,"WeakMap"),K$=Object.create,i3e=(function(){function t(){}return function(e){if(!cm(e))return{};if(K$)return K$(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}})();function s3e(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function gl(){}function o3e(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var a3e=800,c3e=16,l3e=Date.now;function u3e(t){var e=0,n=0;return function(){var r=l3e(),i=c3e-(r-n);if(n=r,i>0){if(++e>=a3e)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function f3e(t){return function(){return t}}var zI=(function(){try{var t=hE(Object,"defineProperty");return t({},"",{}),t}catch{}})(),h3e=zI?function(t,e){return zI(t,"toString",{configurable:!0,enumerable:!1,value:f3e(e),writable:!0})}:px,d3e=u3e(h3e);function yre(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function bre(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function p3e(t){return t!==t}function m3e(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function aF(t,e,n){return e===e?m3e(t,e,n):bre(t,p3e,n)}function Ere(t,e){var n=t==null?0:t.length;return!!n&&aF(t,e,0)>-1}var g3e=9007199254740991,_3e=/^(?:0|[1-9]\d*)$/;function R3(t,e){var n=typeof t;return e=e??g3e,!!e&&(n=="number"||n!="symbol"&&_3e.test(t))&&t>-1&&t%1==0&&t<e}function cF(t,e,n){e=="__proto__"&&zI?zI(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function MM(t,e){return t===e||t!==t&&e!==e}var v3e=Object.prototype,y3e=v3e.hasOwnProperty;function C3(t,e,n){var r=t[e];(!(y3e.call(t,e)&&MM(r,n))||n===void 0&&!(e in t))&&cF(t,e,n)}function lF(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?cF(n,a,c):C3(n,a,c)}return n}var X$=Math.max;function b3e(t,e,n){return e=X$(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=X$(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),s3e(t,this,a)}}function uF(t,e){return d3e(b3e(t,e,px),t+"")}var E3e=9007199254740991;function fF(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=E3e}function Y0(t){return t!=null&&fF(t.length)&&!Bv(t)}function Sre(t,e,n){if(!cm(n))return!1;var r=typeof e;return(r=="number"?Y0(n)&&R3(e,n.length):r=="string"&&e in n)?MM(n[e],t):!1}function S3e(t){return uF(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&Sre(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var x3e=Object.prototype;function kM(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||x3e;return t===n}function T3e(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var w3e="[object Arguments]";function Y$(t){return mg(t)&&hb(t)==w3e}var xre=Object.prototype,R3e=xre.hasOwnProperty,C3e=xre.propertyIsEnumerable,A3=Y$((function(){return arguments})())?Y$:function(t){return mg(t)&&R3e.call(t,"callee")&&!C3e.call(t,"callee")};function A3e(){return!1}var Tre=typeof Vd=="object"&&Vd&&!Vd.nodeType&&Vd,Z$=Tre&&typeof Jl=="object"&&Jl&&!Jl.nodeType&&Jl,M3e=Z$&&Z$.exports===Tre,J$=M3e?X0.Buffer:void 0,k3e=J$?J$.isBuffer:void 0,NA=k3e||A3e,O3e="[object Arguments]",I3e="[object Array]",N3e="[object Boolean]",P3e="[object Date]",D3e="[object Error]",L3e="[object Function]",U3e="[object Map]",B3e="[object Number]",F3e="[object Object]",j3e="[object RegExp]",z3e="[object Set]",H3e="[object String]",q3e="[object WeakMap]",V3e="[object ArrayBuffer]",G3e="[object DataView]",$3e="[object Float32Array]",W3e="[object Float64Array]",K3e="[object Int8Array]",X3e="[object Int16Array]",Y3e="[object Int32Array]",Z3e="[object Uint8Array]",J3e="[object Uint8ClampedArray]",Q3e="[object Uint16Array]",ePe="[object Uint32Array]",ta={};ta[$3e]=ta[W3e]=ta[K3e]=ta[X3e]=ta[Y3e]=ta[Z3e]=ta[J3e]=ta[Q3e]=ta[ePe]=!0;ta[O3e]=ta[I3e]=ta[V3e]=ta[N3e]=ta[G3e]=ta[P3e]=ta[D3e]=ta[L3e]=ta[U3e]=ta[B3e]=ta[F3e]=ta[j3e]=ta[z3e]=ta[H3e]=ta[q3e]=!1;function tPe(t){return mg(t)&&fF(t.length)&&!!ta[hb(t)]}function M3(t){return function(e){return t(e)}}var wre=typeof Vd=="object"&&Vd&&!Vd.nodeType&&Vd,oA=wre&&typeof Jl=="object"&&Jl&&!Jl.nodeType&&Jl,nPe=oA&&oA.exports===wre,gL=nPe&&gre.process,Yy=(function(){try{var t=oA&&oA.require&&oA.require("util").types;return t||gL&&gL.binding&&gL.binding("util")}catch{}})(),Q$=Yy&&Yy.isTypedArray,hF=Q$?M3(Q$):tPe,rPe=Object.prototype,iPe=rPe.hasOwnProperty;function Rre(t,e){var n=hs(t),r=!n&&A3(t),i=!n&&!r&&NA(t),s=!n&&!r&&!i&&hF(t),o=n||r||i||s,a=o?T3e(t.length,String):[],c=a.length;for(var l in t)(e||iPe.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||R3(l,c)))&&a.push(l);return a}function Cre(t,e){return function(n){return t(e(n))}}var sPe=Cre(Object.keys,Object),oPe=Object.prototype,aPe=oPe.hasOwnProperty;function Are(t){if(!kM(t))return sPe(t);var e=[];for(var n in Object(t))aPe.call(t,n)&&n!="constructor"&&e.push(n);return e}function lm(t){return Y0(t)?Rre(t):Are(t)}var cPe=Object.prototype,lPe=cPe.hasOwnProperty,Xh=S3e(function(t,e){if(kM(e)||Y0(e)){lF(e,lm(e),t);return}for(var n in e)lPe.call(e,n)&&C3(t,n,e[n])});function uPe(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var fPe=Object.prototype,hPe=fPe.hasOwnProperty;function dPe(t){if(!cm(t))return uPe(t);var e=kM(t),n=[];for(var r in t)r=="constructor"&&(e||!hPe.call(t,r))||n.push(r);return n}function Mre(t){return Y0(t)?Rre(t,!0):dPe(t)}var pPe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,mPe=/^\w*$/;function dF(t,e){if(hs(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||x3(t)?!0:mPe.test(t)||!pPe.test(t)||e!=null&&t in Object(e)}var PA=hE(Object,"create");function gPe(){this.__data__=PA?PA(null):{},this.size=0}function _Pe(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var vPe="__lodash_hash_undefined__",yPe=Object.prototype,bPe=yPe.hasOwnProperty;function EPe(t){var e=this.__data__;if(PA){var n=e[t];return n===vPe?void 0:n}return bPe.call(e,t)?e[t]:void 0}var SPe=Object.prototype,xPe=SPe.hasOwnProperty;function TPe(t){var e=this.__data__;return PA?e[t]!==void 0:xPe.call(e,t)}var wPe="__lodash_hash_undefined__";function RPe(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=PA&&e===void 0?wPe:e,this}function j1(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}j1.prototype.clear=gPe;j1.prototype.delete=_Pe;j1.prototype.get=EPe;j1.prototype.has=TPe;j1.prototype.set=RPe;function CPe(){this.__data__=[],this.size=0}function k3(t,e){for(var n=t.length;n--;)if(MM(t[n][0],e))return n;return-1}var APe=Array.prototype,MPe=APe.splice;function kPe(t){var e=this.__data__,n=k3(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():MPe.call(e,n,1),--this.size,!0}function OPe(t){var e=this.__data__,n=k3(e,t);return n<0?void 0:e[n][1]}function IPe(t){return k3(this.__data__,t)>-1}function NPe(t,e){var n=this.__data__,r=k3(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Fv(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Fv.prototype.clear=CPe;Fv.prototype.delete=kPe;Fv.prototype.get=OPe;Fv.prototype.has=IPe;Fv.prototype.set=NPe;var DA=hE(X0,"Map");function PPe(){this.size=0,this.__data__={hash:new j1,map:new(DA||Fv),string:new j1}}function DPe(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function O3(t,e){var n=t.__data__;return DPe(e)?n[typeof e=="string"?"string":"hash"]:n.map}function LPe(t){var e=O3(this,t).delete(t);return this.size-=e?1:0,e}function UPe(t){return O3(this,t).get(t)}function BPe(t){return O3(this,t).has(t)}function FPe(t,e){var n=O3(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function jv(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}jv.prototype.clear=PPe;jv.prototype.delete=LPe;jv.prototype.get=UPe;jv.prototype.has=BPe;jv.prototype.set=FPe;var jPe="Expected a function";function pF(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(jPe);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(pF.Cache||jv),n}pF.Cache=jv;var zPe=500;function HPe(t){var e=pF(t,function(r){return n.size===zPe&&n.clear(),r}),n=e.cache;return e}var qPe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,VPe=/\\(\\)?/g,GPe=HPe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(qPe,function(n,r,i,s){e.push(i?s.replace(VPe,"$1"):r||n)}),e});function kre(t){return t==null?"":vre(t)}function I3(t,e){return hs(t)?t:dF(t,e)?[t]:GPe(kre(t))}function OM(t){if(typeof t=="string"||x3(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function mF(t,e){e=I3(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[OM(e[n++])];return n&&n==r?t:void 0}function $Pe(t,e,n){var r=t==null?void 0:mF(t,e);return r===void 0?n:r}function gF(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var eW=am?am.isConcatSpreadable:void 0;function WPe(t){return hs(t)||A3(t)||!!(eW&&t&&t[eW])}function _F(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=WPe),i||(i=[]);++s<o;){var a=t[s];n(a)?gF(i,a):r||(i[i.length]=a)}return i}function Vh(t){var e=t==null?0:t.length;return e?_F(t):[]}var Ore=Cre(Object.getPrototypeOf,Object);function vF(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function KPe(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:vF(t,e,n)}var XPe="\\ud800-\\udfff",YPe="\\u0300-\\u036f",ZPe="\\ufe20-\\ufe2f",JPe="\\u20d0-\\u20ff",QPe=YPe+ZPe+JPe,eDe="\\ufe0e\\ufe0f",tDe="\\u200d",nDe=RegExp("["+tDe+XPe+QPe+eDe+"]");function Ire(t){return nDe.test(t)}function rDe(t){return t.split("")}var Nre="\\ud800-\\udfff",iDe="\\u0300-\\u036f",sDe="\\ufe20-\\ufe2f",oDe="\\u20d0-\\u20ff",aDe=iDe+sDe+oDe,cDe="\\ufe0e\\ufe0f",lDe="["+Nre+"]",v5="["+aDe+"]",y5="\\ud83c[\\udffb-\\udfff]",uDe="(?:"+v5+"|"+y5+")",Pre="[^"+Nre+"]",Dre="(?:\\ud83c[\\udde6-\\uddff]){2}",Lre="[\\ud800-\\udbff][\\udc00-\\udfff]",fDe="\\u200d",Ure=uDe+"?",Bre="["+cDe+"]?",hDe="(?:"+fDe+"(?:"+[Pre,Dre,Lre].join("|")+")"+Bre+Ure+")*",dDe=Bre+Ure+hDe,pDe="(?:"+[Pre+v5+"?",v5,Dre,Lre,lDe].join("|")+")",mDe=RegExp(y5+"(?="+y5+")|"+pDe+dDe,"g");function gDe(t){return t.match(mDe)||[]}function _De(t){return Ire(t)?gDe(t):rDe(t)}function vDe(t){return function(e){e=kre(e);var n=Ire(e)?_De(e):void 0,r=n?n[0]:e.charAt(0),i=n?KPe(n,1).join(""):e.slice(1);return r[t]()+i}}var Fre=vDe("toUpperCase");function yDe(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function bDe(){this.__data__=new Fv,this.size=0}function EDe(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function SDe(t){return this.__data__.get(t)}function xDe(t){return this.__data__.has(t)}var TDe=200;function wDe(t,e){var n=this.__data__;if(n instanceof Fv){var r=n.__data__;if(!DA||r.length<TDe-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new jv(r)}return n.set(t,e),this.size=n.size,this}function I0(t){var e=this.__data__=new Fv(t);this.size=e.size}I0.prototype.clear=bDe;I0.prototype.delete=EDe;I0.prototype.get=SDe;I0.prototype.has=xDe;I0.prototype.set=wDe;function RDe(t,e){return t&&lF(e,lm(e),t)}var jre=typeof Vd=="object"&&Vd&&!Vd.nodeType&&Vd,tW=jre&&typeof Jl=="object"&&Jl&&!Jl.nodeType&&Jl,CDe=tW&&tW.exports===jre,nW=CDe?X0.Buffer:void 0,rW=nW?nW.allocUnsafe:void 0;function ADe(t,e){var n=t.length,r=rW?rW(n):new t.constructor(n);return t.copy(r),r}function yF(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function zre(){return[]}var MDe=Object.prototype,kDe=MDe.propertyIsEnumerable,iW=Object.getOwnPropertySymbols,bF=iW?function(t){return t==null?[]:(t=Object(t),yF(iW(t),function(e){return kDe.call(t,e)}))}:zre;function ODe(t,e){return lF(t,bF(t),e)}var IDe=Object.getOwnPropertySymbols,NDe=IDe?function(t){for(var e=[];t;)gF(e,bF(t)),t=Ore(t);return e}:zre;function Hre(t,e,n){var r=e(t);return hs(t)?r:gF(r,n(t))}function b5(t){return Hre(t,lm,bF)}function PDe(t){return Hre(t,Mre,NDe)}var E5=hE(X0,"DataView"),S5=hE(X0,"Promise"),FS=hE(X0,"Set"),sW="[object Map]",DDe="[object Object]",oW="[object Promise]",aW="[object Set]",cW="[object WeakMap]",lW="[object DataView]",LDe=fE(E5),UDe=fE(DA),BDe=fE(S5),FDe=fE(FS),jDe=fE(_5),Vp=hb;(E5&&Vp(new E5(new ArrayBuffer(1)))!=lW||DA&&Vp(new DA)!=sW||S5&&Vp(S5.resolve())!=oW||FS&&Vp(new FS)!=aW||_5&&Vp(new _5)!=cW)&&(Vp=function(t){var e=hb(t),n=e==DDe?t.constructor:void 0,r=n?fE(n):"";if(r)switch(r){case LDe:return lW;case UDe:return sW;case BDe:return oW;case FDe:return aW;case jDe:return cW}return e});var zDe=Object.prototype,HDe=zDe.hasOwnProperty;function qDe(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&HDe.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var HI=X0.Uint8Array;function VDe(t){var e=new t.constructor(t.byteLength);return new HI(e).set(new HI(t)),e}function GDe(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var $De=/\w*$/;function WDe(t){var e=new t.constructor(t.source,$De.exec(t));return e.lastIndex=t.lastIndex,e}var uW=am?am.prototype:void 0,fW=uW?uW.valueOf:void 0;function KDe(t){return fW?Object(fW.call(t)):{}}function XDe(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var YDe="[object Boolean]",ZDe="[object Date]",JDe="[object Map]",QDe="[object Number]",eLe="[object RegExp]",tLe="[object Set]",nLe="[object String]",rLe="[object Symbol]",iLe="[object ArrayBuffer]",sLe="[object DataView]",oLe="[object Float32Array]",aLe="[object Float64Array]",cLe="[object Int8Array]",lLe="[object Int16Array]",uLe="[object Int32Array]",fLe="[object Uint8Array]",hLe="[object Uint8ClampedArray]",dLe="[object Uint16Array]",pLe="[object Uint32Array]";function mLe(t,e,n){var r=t.constructor;switch(e){case iLe:return VDe(t);case YDe:case ZDe:return new r(+t);case sLe:return GDe(t);case oLe:case aLe:case cLe:case lLe:case uLe:case fLe:case hLe:case dLe:case pLe:return XDe(t);case JDe:return new r;case QDe:case nLe:return new r(t);case eLe:return WDe(t);case tLe:return new r;case rLe:return KDe(t)}}function gLe(t){return typeof t.constructor=="function"&&!kM(t)?i3e(Ore(t)):{}}var _Le="[object Map]";function vLe(t){return mg(t)&&Vp(t)==_Le}var hW=Yy&&Yy.isMap,yLe=hW?M3(hW):vLe,bLe="[object Set]";function ELe(t){return mg(t)&&Vp(t)==bLe}var dW=Yy&&Yy.isSet,SLe=dW?M3(dW):ELe,qre="[object Arguments]",xLe="[object Array]",TLe="[object Boolean]",wLe="[object Date]",RLe="[object Error]",Vre="[object Function]",CLe="[object GeneratorFunction]",ALe="[object Map]",MLe="[object Number]",Gre="[object Object]",kLe="[object RegExp]",OLe="[object Set]",ILe="[object String]",NLe="[object Symbol]",PLe="[object WeakMap]",DLe="[object ArrayBuffer]",LLe="[object DataView]",ULe="[object Float32Array]",BLe="[object Float64Array]",FLe="[object Int8Array]",jLe="[object Int16Array]",zLe="[object Int32Array]",HLe="[object Uint8Array]",qLe="[object Uint8ClampedArray]",VLe="[object Uint16Array]",GLe="[object Uint32Array]",Po={};Po[qre]=Po[xLe]=Po[DLe]=Po[LLe]=Po[TLe]=Po[wLe]=Po[ULe]=Po[BLe]=Po[FLe]=Po[jLe]=Po[zLe]=Po[ALe]=Po[MLe]=Po[Gre]=Po[kLe]=Po[OLe]=Po[ILe]=Po[NLe]=Po[HLe]=Po[qLe]=Po[VLe]=Po[GLe]=!0;Po[RLe]=Po[Vre]=Po[PLe]=!1;function IO(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!cm(t))return t;var a=hs(t);if(a)return o=qDe(t),o3e(t,o);var c=Vp(t),l=c==Vre||c==CLe;if(NA(t))return ADe(t);if(c==Gre||c==qre||l&&!i)return o=l?{}:gLe(t),ODe(t,RDe(o,t));if(!Po[c])return i?t:{};o=mLe(t,c),s||(s=new I0);var u=s.get(t);if(u)return u;s.set(t,o),SLe(t)?t.forEach(function(m){o.add(IO(m,e,n,m,t,s))}):yLe(t)&&t.forEach(function(m,p){o.set(p,IO(m,e,n,p,t,s))});var h=b5,d=a?void 0:h(t);return yre(d||t,function(m,p){d&&(p=m,m=t[p]),C3(o,p,IO(m,e,n,p,t,s))}),o}var $Le=4;function Nu(t){return IO(t,$Le)}function IM(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var WLe="__lodash_hash_undefined__";function KLe(t){return this.__data__.set(t,WLe),this}function XLe(t){return this.__data__.has(t)}function mx(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new jv;++e<n;)this.add(t[e])}mx.prototype.add=mx.prototype.push=KLe;mx.prototype.has=XLe;function $re(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function EF(t,e){return t.has(e)}var YLe=1,ZLe=2;function Wre(t,e,n,r,i,s){var o=n&YLe,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var h=-1,d=!0,m=n&ZLe?new mx:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var p=t[h],g=e[h];if(r)var y=o?r(g,p,h,e,t,s):r(p,g,h,t,e,s);if(y!==void 0){if(y)continue;d=!1;break}if(m){if(!$re(e,function(v,x){if(!EF(m,x)&&(p===v||i(p,v,n,r,s)))return m.push(x)})){d=!1;break}}else if(!(p===g||i(p,g,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function JLe(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function SF(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var QLe=1,e4e=2,t4e="[object Boolean]",n4e="[object Date]",r4e="[object Error]",i4e="[object Map]",s4e="[object Number]",o4e="[object RegExp]",a4e="[object Set]",c4e="[object String]",l4e="[object Symbol]",u4e="[object ArrayBuffer]",f4e="[object DataView]",pW=am?am.prototype:void 0,_L=pW?pW.valueOf:void 0;function h4e(t,e,n,r,i,s,o){switch(n){case f4e:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case u4e:return!(t.byteLength!=e.byteLength||!s(new HI(t),new HI(e)));case t4e:case n4e:case s4e:return MM(+t,+e);case r4e:return t.name==e.name&&t.message==e.message;case o4e:case c4e:return t==e+"";case i4e:var a=JLe;case a4e:var c=r&QLe;if(a||(a=SF),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=e4e,o.set(t,e);var u=Wre(a(t),a(e),r,i,s,o);return o.delete(t),u;case l4e:if(_L)return _L.call(t)==_L.call(e)}return!1}var d4e=1,p4e=Object.prototype,m4e=p4e.hasOwnProperty;function g4e(t,e,n,r,i,s){var o=n&d4e,a=b5(t),c=a.length,l=b5(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in e:m4e.call(e,d)))return!1}var m=s.get(t),p=s.get(e);if(m&&p)return m==e&&p==t;var g=!0;s.set(t,e),s.set(e,t);for(var y=o;++h<c;){d=a[h];var v=t[d],x=e[d];if(r)var E=o?r(x,v,d,e,t,s):r(v,x,d,t,e,s);if(!(E===void 0?v===x||i(v,x,n,r,s):E)){g=!1;break}y||(y=d=="constructor")}if(g&&!y){var C=t.constructor,A=e.constructor;C!=A&&"constructor"in t&&"constructor"in e&&!(typeof C=="function"&&C instanceof C&&typeof A=="function"&&A instanceof A)&&(g=!1)}return s.delete(t),s.delete(e),g}var _4e=1,mW="[object Arguments]",gW="[object Array]",yk="[object Object]",v4e=Object.prototype,_W=v4e.hasOwnProperty;function y4e(t,e,n,r,i,s){var o=hs(t),a=hs(e),c=o?gW:Vp(t),l=a?gW:Vp(e);c=c==mW?yk:c,l=l==mW?yk:l;var u=c==yk,h=l==yk,d=c==l;if(d&&NA(t)){if(!NA(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new I0),o||hF(t)?Wre(t,e,n,r,i,s):h4e(t,e,c,n,r,i,s);if(!(n&_4e)){var m=u&&_W.call(t,"__wrapped__"),p=h&&_W.call(e,"__wrapped__");if(m||p){var g=m?t.value():t,y=p?e.value():e;return s||(s=new I0),i(g,y,n,r,s)}}return d?(s||(s=new I0),g4e(t,e,n,r,i,s)):!1}function xF(t,e,n,r,i){return t===e?!0:t==null||e==null||!mg(t)&&!mg(e)?t!==t&&e!==e:y4e(t,e,n,r,xF,i)}var b4e=1,E4e=2;function S4e(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new I0,h;if(!(h===void 0?xF(l,c,b4e|E4e,r,u):h))return!1}}return!0}function Kre(t){return t===t&&!cm(t)}function x4e(t){for(var e=lm(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Kre(i)]}return e}function Xre(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function T4e(t){var e=x4e(t);return e.length==1&&e[0][2]?Xre(e[0][0],e[0][1]):function(n){return n===t||S4e(n,t,e)}}function w4e(t,e){return t!=null&&e in Object(t)}function Yre(t,e,n){e=I3(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=OM(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&fF(i)&&R3(o,i)&&(hs(t)||A3(t)))}function R4e(t,e){return t!=null&&Yre(t,e,w4e)}var C4e=1,A4e=2;function M4e(t,e){return dF(t)&&Kre(e)?Xre(OM(t),e):function(n){var r=$Pe(n,t);return r===void 0&&r===e?R4e(n,t):xF(e,r,C4e|A4e)}}function k4e(t){return function(e){return e?.[t]}}function O4e(t){return function(e){return mF(e,t)}}function I4e(t){return dF(t)?k4e(OM(t)):O4e(t)}function Z0(t){return typeof t=="function"?t:t==null?px:typeof t=="object"?hs(t)?M4e(t[0],t[1]):T4e(t):I4e(t)}function N4e(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function P4e(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var D4e=P4e();function L4e(t,e){return t&&D4e(t,e,lm)}function U4e(t,e){return function(n,r){if(n==null)return n;if(!Y0(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var dE=U4e(L4e);function B4e(t,e,n,r){return dE(t,function(i,s,o){e(r,i,n(i),o)}),r}function F4e(t,e){return function(n,r){var i=hs(n)?N4e:B4e,s=e?e():{};return i(n,t,Z0(r),s)}}var Zre=Object.prototype,j4e=Zre.hasOwnProperty,TF=uF(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&Sre(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=Mre(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||MM(u,Zre[l])&&!j4e.call(t,l))&&(t[l]=s[l])}return t});function vW(t){return mg(t)&&Y0(t)}var z4e=200;function H4e(t,e,n,r){var i=-1,s=Ere,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=z4e&&(s=EF,o=!1,e=new mx(e));e:for(;++i<a;){var u=t[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(e[d]===h)continue e;c.push(u)}else s(e,h,r)||c.push(u)}return c}var N3=uF(function(t,e){return vW(t)?H4e(t,_F(e,1,vW,!0)):[]});function gx(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Cu(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:w3(e),vF(t,e<0?0:e,r)):[]}function LA(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:w3(e),e=r-e,vF(t,0,e<0?0:e)):[]}function q4e(t){return typeof t=="function"?t:px}function jr(t,e){var n=hs(t)?yre:dE;return n(t,q4e(e))}function V4e(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function G4e(t,e){var n=!0;return dE(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function dg(t,e,n){var r=hs(t)?V4e:G4e;return r(t,Z0(e))}function Jre(t,e){var n=[];return dE(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function hm(t,e){var n=hs(t)?yF:Jre;return n(t,Z0(e))}function $4e(t){return function(e,n,r){var i=Object(e);if(!Y0(e)){var s=Z0(n);e=lm(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var W4e=Math.max;function K4e(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:w3(n);return i<0&&(i=W4e(r+i,0)),bre(t,Z0(e),i)}var _x=$4e(K4e);function gg(t){return t&&t.length?t[0]:void 0}function X4e(t,e){var n=-1,r=Y0(t)?Array(t.length):[];return dE(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function nr(t,e){var n=hs(t)?T3:X4e;return n(t,Z0(e))}function tm(t,e){return _F(nr(t,e))}var Y4e=Object.prototype,Z4e=Y4e.hasOwnProperty,Qre=F4e(function(t,e,n){Z4e.call(t,n)?t[n].push(e):cF(t,n,[e])}),J4e=Object.prototype,Q4e=J4e.hasOwnProperty;function eUe(t,e){return t!=null&&Q4e.call(t,e)}function Ir(t,e){return t!=null&&Yre(t,e,eUe)}var tUe="[object String]";function Yh(t){return typeof t=="string"||!hs(t)&&mg(t)&&hb(t)==tUe}function nUe(t,e){return T3(e,function(n){return t[n]})}function Kc(t){return t==null?[]:nUe(t,lm(t))}var rUe=Math.max;function Jf(t,e,n,r){t=Y0(t)?t:Kc(t),n=n?w3(n):0;var i=t.length;return n<0&&(n=rUe(i+n,0)),Yh(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&aF(t,e,n)>-1}function yW(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return aF(t,e,i)}var iUe="[object Map]",sUe="[object Set]",oUe=Object.prototype,aUe=oUe.hasOwnProperty;function Fo(t){if(t==null)return!0;if(Y0(t)&&(hs(t)||typeof t=="string"||typeof t.splice=="function"||NA(t)||hF(t)||A3(t)))return!t.length;var e=Vp(t);if(e==iUe||e==sUe)return!t.size;if(kM(t))return!Are(t).length;for(var n in t)if(aUe.call(t,n))return!1;return!0}var cUe="[object RegExp]";function lUe(t){return mg(t)&&hb(t)==cUe}var bW=Yy&&Yy.isRegExp,Mv=bW?M3(bW):lUe;function kv(t){return t===void 0}var uUe="Expected a function";function fUe(t){if(typeof t!="function")throw new TypeError(uUe);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function hUe(t,e,n,r){if(!cm(t))return t;e=I3(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=OM(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=cm(u)?u:R3(e[i+1])?[]:{})}C3(a,c,l),a=a[c]}return t}function dUe(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=mF(t,o);n(a,o)&&hUe(s,I3(o,t),a)}return s}function wg(t,e){if(t==null)return{};var n=T3(PDe(t),function(r){return[r]});return e=Z0(e),dUe(t,n,function(r,i){return e(r,i[0])})}function pUe(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function Zh(t,e,n){var r=hs(t)?yDe:pUe,i=arguments.length<3;return r(t,Z0(e),n,i,dE)}function P3(t,e){var n=hs(t)?yF:Jre;return n(t,fUe(Z0(e)))}function mUe(t,e){var n;return dE(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function wF(t,e,n){var r=hs(t)?$re:mUe;return r(t,Z0(e))}var gUe=1/0,_Ue=FS&&1/SF(new FS([,-0]))[1]==gUe?function(t){return new FS(t)}:gl,vUe=200;function yUe(t,e,n){var r=-1,i=Ere,s=t.length,o=!0,a=[],c=a;if(s>=vUe){var l=_Ue(t);if(l)return SF(l);o=!1,i=EF,c=new mx}else c=a;e:for(;++r<s;){var u=t[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue e;a.push(u)}else i(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function D3(t){return t&&t.length?yUe(t):[]}function x5(t){console&&console.error&&console.error(`Error: ${t}`)}function eie(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function tie(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function nie(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function bUe(t){return EUe(t)?t.LABEL:t.name}function EUe(t){return Yh(t.LABEL)&&t.LABEL!==""}class J0{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),jr(this.definition,n=>{n.accept(e)})}}class Jh extends J0{constructor(e){super([]),this.idx=1,Xh(this,wg(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Zx extends J0{constructor(e){super(e.definition),this.orgText="",Xh(this,wg(e,n=>n!==void 0))}}class Qh extends J0{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Xh(this,wg(e,n=>n!==void 0))}}class Gh extends J0{constructor(e){super(e.definition),this.idx=1,Xh(this,wg(e,n=>n!==void 0))}}class Q0 extends J0{constructor(e){super(e.definition),this.idx=1,Xh(this,wg(e,n=>n!==void 0))}}class e_ extends J0{constructor(e){super(e.definition),this.idx=1,Xh(this,wg(e,n=>n!==void 0))}}class yl extends J0{constructor(e){super(e.definition),this.idx=1,Xh(this,wg(e,n=>n!==void 0))}}class Rg extends J0{constructor(e){super(e.definition),this.idx=1,Xh(this,wg(e,n=>n!==void 0))}}class Cg extends J0{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Xh(this,wg(e,n=>n!==void 0))}}class Ua{constructor(e){this.idx=1,Xh(this,wg(e,n=>n!==void 0))}accept(e){e.visit(this)}}function SUe(t){return nr(t,NO)}function NO(t){function e(n){return nr(n,NO)}if(t instanceof Jh){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Yh(t.label)&&(n.label=t.label),n}else{if(t instanceof Qh)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Gh)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Q0)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof e_)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:NO(new Ua({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Rg)return{type:"RepetitionWithSeparator",idx:t.idx,separator:NO(new Ua({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof yl)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Cg)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Ua){const n={type:"Terminal",name:t.terminalType.name,label:bUe(t.terminalType),idx:t.idx};Yh(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=Mv(r)?r.source:r),n}else{if(t instanceof Zx)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class pE{visit(e){const n=e;switch(n.constructor){case Jh:return this.visitNonTerminal(n);case Qh:return this.visitAlternative(n);case Gh:return this.visitOption(n);case Q0:return this.visitRepetitionMandatory(n);case e_:return this.visitRepetitionMandatoryWithSeparator(n);case Rg:return this.visitRepetitionWithSeparator(n);case yl:return this.visitRepetition(n);case Cg:return this.visitAlternation(n);case Ua:return this.visitTerminal(n);case Zx:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function xUe(t){return t instanceof Qh||t instanceof Gh||t instanceof yl||t instanceof Q0||t instanceof e_||t instanceof Rg||t instanceof Ua||t instanceof Zx}function qI(t,e=[]){return t instanceof Gh||t instanceof yl||t instanceof Rg?!0:t instanceof Cg?wF(t.definition,r=>qI(r,e)):t instanceof Jh&&Jf(e,t)?!1:t instanceof J0?(t instanceof Jh&&e.push(t),dg(t.definition,r=>qI(r,e))):!1}function TUe(t){return t instanceof Cg}function m0(t){if(t instanceof Jh)return"SUBRULE";if(t instanceof Gh)return"OPTION";if(t instanceof Cg)return"OR";if(t instanceof Q0)return"AT_LEAST_ONE";if(t instanceof e_)return"AT_LEAST_ONE_SEP";if(t instanceof Rg)return"MANY_SEP";if(t instanceof yl)return"MANY";if(t instanceof Ua)return"CONSUME";throw Error("non exhaustive match")}class L3{walk(e,n=[]){jr(e.definition,(r,i)=>{const s=Cu(e.definition,i+1);if(r instanceof Jh)this.walkProdRef(r,s,n);else if(r instanceof Ua)this.walkTerminal(r,s,n);else if(r instanceof Qh)this.walkFlat(r,s,n);else if(r instanceof Gh)this.walkOption(r,s,n);else if(r instanceof Q0)this.walkAtLeastOne(r,s,n);else if(r instanceof e_)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Rg)this.walkManySep(r,s,n);else if(r instanceof yl)this.walkMany(r,s,n);else if(r instanceof Cg)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new Gh({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=EW(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new Gh({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=EW(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);jr(e.definition,s=>{const o=new Qh({definition:[s]});this.walk(o,i)})}}function EW(t,e,n){return[new Gh({definition:[new Ua({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function NM(t){if(t instanceof Jh)return NM(t.referencedRule);if(t instanceof Ua)return CUe(t);if(xUe(t))return wUe(t);if(TUe(t))return RUe(t);throw Error("non exhaustive match")}function wUe(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=qI(s),e=e.concat(NM(s)),r=r+1,i=n.length>r;return D3(e)}function RUe(t){const e=nr(t.definition,n=>NM(n));return D3(Vh(e))}function CUe(t){return[t.terminalType]}const rie="_~IN~_";class AUe extends L3{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=kUe(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new Qh({definition:s}),a=NM(o);this.follows[i]=a}}function MUe(t){const e={};return jr(t,n=>{const r=new AUe(n).startWalking();Xh(e,r)}),e}function kUe(t,e){return t.name+e+rie}function zr(t){return t.charCodeAt(0)}function vL(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function dC(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function eS(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function OUe(){throw Error("Internal Error - Should never get here!")}function SW(t){return t.type==="Character"}const VI=[];for(let t=zr("0");t<=zr("9");t++)VI.push(t);const GI=[zr("_")].concat(VI);for(let t=zr("a");t<=zr("z");t++)GI.push(t);for(let t=zr("A");t<=zr("Z");t++)GI.push(t);const xW=[zr(" "),zr("\f"),zr(`
`),zr("\r"),zr("	"),zr("\v"),zr("	"),zr(""),zr(""),zr(""),zr(""),zr(""),zr(""),zr(""),zr(""),zr(""),zr(""),zr(""),zr(""),zr(""),zr("\u2028"),zr("\u2029"),zr(""),zr(""),zr(""),zr("\uFEFF")],IUe=/[0-9a-fA-F]/,bk=/[0-9]/,NUe=/[1-9]/;class PUe{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":dC(r,"global");break;case"i":dC(r,"ignoreCase");break;case"m":dC(r,"multiLine");break;case"u":dC(r,"unicode");break;case"y":dC(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}eS(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return OUe()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;eS(n);break}if(!(e===!0&&n===void 0)&&eS(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),eS(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[zr(`
`),zr("\r"),zr("\u2028"),zr("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=VI;break;case"D":e=VI,n=!0;break;case"s":e=xW;break;case"S":e=xW,n=!0;break;case"w":e=GI;break;case"W":e=GI,n=!0;break}if(eS(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=zr("\f");break;case"n":e=zr(`
`);break;case"r":e=zr("\r");break;case"t":e=zr("	");break;case"v":e=zr("\v");break}if(eS(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:zr("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:zr(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:zr(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,SW(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,SW(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else vL(r.value,e),e.push(zr("-")),vL(i.value,e)}else vL(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:zr("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(NUe.test(e)===!1)throw Error("Expecting a positive integer");for(;bk.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(bk.test(e)===!1)throw Error("Expecting an integer");for(;bk.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:zr(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return bk.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(IUe.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class RF{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let PO={};const DUe=new PUe;function U3(t){const e=t.toString();if(PO.hasOwnProperty(e))return PO[e];{const n=DUe.pattern(e);return PO[e]=n,n}}function LUe(){PO={}}const iie="Complement Sets are not supported for first char optimization",$I=`Unable to use "first char" lexer optimizations:
`;function UUe(t,e=!1){try{const n=U3(t);return T5(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===iie)e&&eie(`${$I}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),x5(`${$I}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function T5(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)T5(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Ek(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(iie);jr(o.value,c=>{if(typeof c=="number")Ek(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Ek(u,e,n);else{for(let u=l.from;u<=l.to&&u<WC;u++)Ek(u,e,n);if(l.to>=WC){const u=l.from>=WC?l.from:WC,h=l.to,d=Zy(u),m=Zy(h);for(let p=d;p<=m;p++)e[p]=p}}}});break;case"Group":T5(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&w5(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Kc(e)}function Ek(t,e,n){const r=Zy(t);e[r]=r,n===!0&&BUe(t,e)}function BUe(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=Zy(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Zy(i.charCodeAt(0));e[s]=s}}}function TW(t,e){return _x(t.value,n=>{if(typeof n=="number")return Jf(e,n);{const r=n;return _x(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function w5(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?hs(t.value)?dg(t.value,w5):w5(t.value):!1}class FUe extends RF{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Jf(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?TW(e,this.targetCharCodes)===void 0&&(this.found=!0):TW(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function CF(t,e){if(e instanceof RegExp){const n=U3(e),r=new FUe(t);return r.visit(n),r.found}else return _x(e,n=>Jf(t,n.charCodeAt(0)))!==void 0}const z1="PATTERN",$C="defaultMode",Sk="modes";let sie=typeof new RegExp("(?:)").sticky=="boolean";function jUe(t,e){e=TF(e,{useSticky:sie,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(x,E)=>E()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{l6e()});let r;n("Reject Lexer.NA",()=>{r=P3(t,x=>x[z1]===eu.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=nr(r,x=>{const E=x[z1];if(Mv(E)){const C=E.source;return C.length===1&&C!=="^"&&C!=="$"&&C!=="."&&!E.ignoreCase?C:C.length===2&&C[0]==="\\"&&!Jf(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],C[1])?C[1]:e.useSticky?RW(E):wW(E)}else{if(Bv(E))return i=!0,{exec:E};if(typeof E=="object")return i=!0,E;if(typeof E=="string"){if(E.length===1)return E;{const C=E.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),A=new RegExp(C);return e.useSticky?RW(A):wW(A)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=nr(r,x=>x.tokenTypeIdx),a=nr(r,x=>{const E=x.GROUP;if(E!==eu.SKIPPED){if(Yh(E))return E;if(kv(E))return!1;throw Error("non exhaustive match")}}),c=nr(r,x=>{const E=x.LONGER_ALT;if(E)return hs(E)?nr(E,A=>yW(r,A)):[yW(r,E)]}),l=nr(r,x=>x.PUSH_MODE),u=nr(r,x=>Ir(x,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const x=cie(e.lineTerminatorCharacters);h=nr(r,E=>!1),e.positionTracking!=="onlyOffset"&&(h=nr(r,E=>Ir(E,"LINE_BREAKS")?!!E.LINE_BREAKS:aie(E,x)===!1&&CF(x,E.PATTERN)))});let d,m,p,g;n("Misc Mapping #2",()=>{d=nr(r,oie),m=nr(s,o6e),p=Zh(r,(x,E)=>{const C=E.GROUP;return Yh(C)&&C!==eu.SKIPPED&&(x[C]=[]),x},{}),g=nr(s,(x,E)=>({pattern:s[E],longerAlt:c[E],canLineTerminator:h[E],isCustom:d[E],short:m[E],group:a[E],push:l[E],pop:u[E],tokenTypeIdx:o[E],tokenType:r[E]}))});let y=!0,v=[];return e.safeMode||n("First Char Optimization",()=>{v=Zh(r,(x,E,C)=>{if(typeof E.PATTERN=="string"){const A=E.PATTERN.charCodeAt(0),k=Zy(A);yL(x,k,g[C])}else if(hs(E.START_CHARS_HINT)){let A;jr(E.START_CHARS_HINT,k=>{const M=typeof k=="string"?k.charCodeAt(0):k,I=Zy(M);A!==I&&(A=I,yL(x,I,g[C]))})}else if(Mv(E.PATTERN))if(E.PATTERN.unicode)y=!1,e.ensureOptimizations&&x5(`${$I}	Unable to analyze < ${E.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const A=UUe(E.PATTERN,e.ensureOptimizations);Fo(A)&&(y=!1),jr(A,k=>{yL(x,k,g[C])})}else e.ensureOptimizations&&x5(`${$I}	TokenType: <${E.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),y=!1;return x},[])}),{emptyGroups:p,patternIdxToConfig:g,charCodeToPatternIdxToConfig:v,hasCustom:i,canBeOptimized:y}}function zUe(t,e){let n=[];const r=qUe(t);n=n.concat(r.errors);const i=VUe(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(HUe(s)),n=n.concat(JUe(s)),n=n.concat(QUe(s,e)),n=n.concat(e6e(s)),n}function HUe(t){let e=[];const n=hm(t,r=>Mv(r[z1]));return e=e.concat($Ue(n)),e=e.concat(XUe(n)),e=e.concat(YUe(n)),e=e.concat(ZUe(n)),e=e.concat(WUe(n)),e}function qUe(t){const e=hm(t,i=>!Ir(i,z1)),n=nr(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:oc.MISSING_PATTERN,tokenTypes:[i]})),r=N3(t,e);return{errors:n,valid:r}}function VUe(t){const e=hm(t,i=>{const s=i[z1];return!Mv(s)&&!Bv(s)&&!Ir(s,"exec")&&!Yh(s)}),n=nr(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:oc.INVALID_PATTERN,tokenTypes:[i]})),r=N3(t,e);return{errors:n,valid:r}}const GUe=/[^\\][$]/;function $Ue(t){class e extends RF{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=hm(t,i=>{const s=i.PATTERN;try{const o=U3(s),a=new e;return a.visit(o),a.found}catch{return GUe.test(s.source)}});return nr(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:oc.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function WUe(t){const e=hm(t,r=>r.PATTERN.test(""));return nr(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:oc.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const KUe=/[^\\[][\^]|^\^/;function XUe(t){class e extends RF{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=hm(t,i=>{const s=i.PATTERN;try{const o=U3(s),a=new e;return a.visit(o),a.found}catch{return KUe.test(s.source)}});return nr(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:oc.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function YUe(t){const e=hm(t,r=>{const i=r[z1];return i instanceof RegExp&&(i.multiline||i.global)});return nr(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:oc.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function ZUe(t){const e=[];let n=nr(t,s=>Zh(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Jf(e,a)&&a.PATTERN!==eu.NA&&(e.push(a),o.push(a)),o),[]));n=IM(n);const r=hm(n,s=>s.length>1);return nr(r,s=>{const o=nr(s,c=>c.name);return{message:`The same RegExp pattern ->${gg(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:oc.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function JUe(t){const e=hm(t,r=>{if(!Ir(r,"GROUP"))return!1;const i=r.GROUP;return i!==eu.SKIPPED&&i!==eu.NA&&!Yh(i)});return nr(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:oc.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function QUe(t,e){const n=hm(t,i=>i.PUSH_MODE!==void 0&&!Jf(e,i.PUSH_MODE));return nr(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:oc.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function e6e(t){const e=[],n=Zh(t,(r,i,s)=>{const o=i.PATTERN;return o===eu.NA||(Yh(o)?r.push({str:o,idx:s,tokenType:i}):Mv(o)&&n6e(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return jr(t,(r,i)=>{jr(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&t6e(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:oc.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function t6e(t,e){if(Mv(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Bv(e))return e(t,0,[],{});if(Ir(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function n6e(t){return _x([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function wW(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function RW(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function r6e(t,e,n){const r=[];return Ir(t,$C)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+$C+`> property in its definition
`,type:oc.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ir(t,Sk)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Sk+`> property in its definition
`,type:oc.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ir(t,Sk)&&Ir(t,$C)&&!Ir(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${$C}: <${t.defaultMode}>which does not exist
`,type:oc.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ir(t,Sk)&&jr(t.modes,(i,s)=>{jr(i,(o,a)=>{if(kv(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:oc.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ir(o,"LONGER_ALT")){const c=hs(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];jr(c,l=>{!kv(l)&&!Jf(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:oc.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function i6e(t,e,n){const r=[];let i=!1;const s=IM(Vh(Kc(t.modes))),o=P3(s,c=>c[z1]===eu.NA),a=cie(n);return e&&jr(o,c=>{const l=aie(c,a);if(l!==!1){const h={message:c6e(c,l),type:l.issue,tokenType:c};r.push(h)}else Ir(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):CF(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:oc.NO_LINE_BREAKS_FLAGS}),r}function s6e(t){const e={},n=lm(t);return jr(n,r=>{const i=t[r];if(hs(i))e[r]=[];else throw Error("non exhaustive match")}),e}function oie(t){const e=t.PATTERN;if(Mv(e))return!1;if(Bv(e))return!0;if(Ir(e,"exec"))return!0;if(Yh(e))return!1;throw Error("non exhaustive match")}function o6e(t){return Yh(t)&&t.length===1?t.charCodeAt(0):!1}const a6e={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function aie(t,e){if(Ir(t,"LINE_BREAKS"))return!1;if(Mv(t.PATTERN)){try{CF(e,t.PATTERN)}catch(n){return{issue:oc.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Yh(t.PATTERN))return!1;if(oie(t))return{issue:oc.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function c6e(t,e){if(e.issue===oc.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===oc.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function cie(t){return nr(t,n=>Yh(n)?n.charCodeAt(0):n)}function yL(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const WC=256;let DO=[];function Zy(t){return t<WC?t:DO[t]}function l6e(){if(Fo(DO)){DO=new Array(65536);for(let t=0;t<65536;t++)DO[t]=t>255?255+~~(t/255):t}}function PM(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function WI(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let CW=1;const lie={};function DM(t){const e=u6e(t);f6e(e),d6e(e),h6e(e),jr(e,n=>{n.isParent=n.categoryMatches.length>0})}function u6e(t){let e=Nu(t),n=t,r=!0;for(;r;){n=IM(Vh(nr(n,s=>s.CATEGORIES)));const i=N3(n,e);e=e.concat(i),Fo(i)?r=!1:n=i}return e}function f6e(t){jr(t,e=>{fie(e)||(lie[CW]=e,e.tokenTypeIdx=CW++),AW(e)&&!hs(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),AW(e)||(e.CATEGORIES=[]),p6e(e)||(e.categoryMatches=[]),m6e(e)||(e.categoryMatchesMap={})})}function h6e(t){jr(t,e=>{e.categoryMatches=[],jr(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(lie[r].tokenTypeIdx)})})}function d6e(t){jr(t,e=>{uie([],e)})}function uie(t,e){jr(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),jr(e.CATEGORIES,n=>{const r=t.concat(e);Jf(r,n)||uie(r,n)})}function fie(t){return Ir(t,"tokenTypeIdx")}function AW(t){return Ir(t,"CATEGORIES")}function p6e(t){return Ir(t,"categoryMatches")}function m6e(t){return Ir(t,"categoryMatchesMap")}function g6e(t){return Ir(t,"tokenTypeIdx")}const _6e={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var oc;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(oc||(oc={}));const KC={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:_6e,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(KC);let eu=class{constructor(e,n=KC){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=tie(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Xh({},KC,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===KC.lineTerminatorsPattern)this.config.lineTerminatorsPattern=a6e;else if(this.config.lineTerminatorCharacters===KC.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),hs(e)?i={modes:{defaultMode:Nu(e)},defaultMode:$C}:(s=!1,i=Nu(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(r6e(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(i6e(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},jr(i.modes,(a,c)=>{i.modes[c]=P3(a,l=>kv(l))});const o=lm(i.modes);if(jr(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(zUe(a,o))}),Fo(this.lexerDefinitionErrors)){DM(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=jUe(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Xh({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Fo(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=nr(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}jr(this.lexerDefinitionWarning,a=>{eie(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(sie?(this.chopInput=px,this.match=this.matchWithTest):(this.updateLastIndex=gl,this.match=this.matchWithExec),s&&(this.handleModes=gl),this.trackStartLines===!1&&(this.computeNewColumn=px),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=gl),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Zh(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!Fo(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{LUe()}),this.TRACE_INIT("toFastProperties",()=>{nie(this)})})}tokenize(e,n=this.defaultMode){if(!Fo(this.lexerDefinitionErrors)){const i=nr(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,h,d,m,p,g,y,v;const x=e,E=x.length;let C=0,A=0;const k=this.hasCustom?0:Math.floor(e.length/10),M=new Array(k),I=[];let z=this.trackStartLines?1:void 0,H=this.trackStartLines?1:void 0;const K=s6e(this.emptyGroups),P=this.trackStartLines,F=this.config.lineTerminatorsPattern;let N=0,X=[],G=[];const j=[],q=[];Object.freeze(q);let te;function W(){return X}function $(xe){const Ne=Zy(xe),Re=G[Ne];return Re===void 0?q:Re}const J=xe=>{if(j.length===1&&xe.tokenType.PUSH_MODE===void 0){const Ne=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(xe);I.push({offset:xe.startOffset,line:xe.startLine,column:xe.startColumn,length:xe.image.length,message:Ne})}else{j.pop();const Ne=gx(j);X=this.patternIdxToConfig[Ne],G=this.charCodeToPatternIdxToConfig[Ne],N=X.length;const Re=this.canModeBeOptimized[Ne]&&this.config.safeMode===!1;G&&Re?te=$:te=W}};function ne(xe){j.push(xe),G=this.charCodeToPatternIdxToConfig[xe],X=this.patternIdxToConfig[xe],N=X.length,N=X.length;const Ne=this.canModeBeOptimized[xe]&&this.config.safeMode===!1;G&&Ne?te=$:te=W}ne.call(this,n);let ie;const ae=this.config.recoveryEnabled;for(;C<E;){c=null;const xe=x.charCodeAt(C),Ne=te(xe),Re=Ne.length;for(r=0;r<Re;r++){ie=Ne[r];const Se=ie.pattern;l=null;const ze=ie.short;if(ze!==!1?xe===ze&&(c=Se):ie.isCustom===!0?(v=Se.exec(x,C,M,K),v!==null?(c=v[0],v.payload!==void 0&&(l=v.payload)):c=null):(this.updateLastIndex(Se,C),c=this.match(Se,e,C)),c!==null){if(a=ie.longerAlt,a!==void 0){const Be=a.length;for(s=0;s<Be;s++){const Je=X[a[s]],at=Je.pattern;if(u=null,Je.isCustom===!0?(v=at.exec(x,C,M,K),v!==null?(o=v[0],v.payload!==void 0&&(u=v.payload)):o=null):(this.updateLastIndex(at,C),o=this.match(at,e,C)),o&&o.length>c.length){c=o,l=u,ie=Je;break}}}break}}if(c!==null){if(h=c.length,d=ie.group,d!==void 0&&(m=ie.tokenTypeIdx,p=this.createTokenInstance(c,C,m,ie.tokenType,z,H,h),this.handlePayload(p,l),d===!1?A=this.addToken(M,A,p):K[d].push(p)),e=this.chopInput(e,h),C=C+h,H=this.computeNewColumn(H,h),P===!0&&ie.canLineTerminator===!0){let Se=0,ze,Be;F.lastIndex=0;do ze=F.test(c),ze===!0&&(Be=F.lastIndex-1,Se++);while(ze===!0);Se!==0&&(z=z+Se,H=h-Be,this.updateTokenEndLineColumnLocation(p,d,Be,Se,z,H,h))}this.handleModes(ie,J,ne,p)}else{const Se=C,ze=z,Be=H;let Je=ae===!1;for(;Je===!1&&C<E;)for(e=this.chopInput(e,1),C++,i=0;i<N;i++){const at=X[i],re=at.pattern,Le=at.short;if(Le!==!1?x.charCodeAt(C)===Le&&(Je=!0):at.isCustom===!0?Je=re.exec(x,C,M,K)!==null:(this.updateLastIndex(re,C),Je=re.exec(e)!==null),Je===!0)break}if(g=C-Se,H=this.computeNewColumn(H,g),y=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(x,Se,g,ze,Be),I.push({offset:Se,line:ze,column:Be,length:g,message:y}),ae===!1)break}}return this.hasCustom||(M.length=A),{tokens:M,groups:K,errors:I}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};eu.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";eu.NA=/NOT_APPLICABLE/;function aA(t){return hie(t)?t.LABEL:t.name}function hie(t){return Yh(t.LABEL)&&t.LABEL!==""}const v6e="parent",MW="categories",kW="label",OW="group",IW="push_mode",NW="pop_mode",PW="longer_alt",DW="line_breaks",LW="start_chars_hint";function Qd(t){return y6e(t)}function y6e(t){const e=t.pattern,n={};if(n.name=t.name,kv(e)||(n.PATTERN=e),Ir(t,v6e))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ir(t,MW)&&(n.CATEGORIES=t[MW]),DM([n]),Ir(t,kW)&&(n.LABEL=t[kW]),Ir(t,OW)&&(n.GROUP=t[OW]),Ir(t,NW)&&(n.POP_MODE=t[NW]),Ir(t,IW)&&(n.PUSH_MODE=t[IW]),Ir(t,PW)&&(n.LONGER_ALT=t[PW]),Ir(t,DW)&&(n.LINE_BREAKS=t[DW]),Ir(t,LW)&&(n.START_CHARS_HINT=t[LW]),n}const H1=Qd({name:"EOF",pattern:eu.NA});DM([H1]);function LM(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function b6e(t,e){return PM(t,e)}const die={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${hie(t)?`--> ${aA(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+gg(e).image+"'";if(r)return s+r+a;{const c=Zh(t,(d,m)=>d.concat(m),[]),l=nr(c,d=>`[${nr(d,m=>aA(m)).join(", ")}]`),h=`one of these possible Token sequences:
${nr(l,(d,m)=>`  ${m+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+gg(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${nr(t,l=>`[${nr(l,u=>aA(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(die);const E6e={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},v1={buildDuplicateFoundError(t,e){function n(u){return u instanceof Ua?u.terminalType.name:u instanceof Jh?u.nonTerminalName:""}const r=t.name,i=gg(e),s=i.idx,o=m0(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=nr(t.prefixPath,i=>aA(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=nr(t.prefixPath,i=>aA(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=m0(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=nr(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Zx?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function S6e(t,e){const n=new x6e(t,e);return n.resolveRefs(),n.errors}class x6e extends pE{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){jr(Kc(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Yf.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class T6e extends L3{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Nu(this.path.ruleStack).reverse(),this.occurrenceStack=Nu(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){Fo(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class w6e extends T6e{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Qh({definition:i});this.possibleTokTypes=NM(s),this.found=!0}}}class B3 extends L3{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class R6e extends B3{walkMany(e,n,r){if(e.idx===this.occurrence){const i=gg(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ua&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class UW extends B3{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=gg(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ua&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class C6e extends B3{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=gg(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ua&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class BW extends B3{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=gg(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ua&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function R5(t,e,n=[]){n=Nu(n);let r=[],i=0;function s(a){return a.concat(Cu(t,i+1))}function o(a){const c=R5(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof Qh)return o(a.definition);if(a instanceof Jh)return o(a.definition);if(a instanceof Gh)r=o(a.definition);else if(a instanceof Q0){const c=a.definition.concat([new yl({definition:a.definition})]);return o(c)}else if(a instanceof e_){const c=[new Qh({definition:a.definition}),new yl({definition:[new Ua({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Rg){const c=a.definition.concat([new yl({definition:[new Ua({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof yl){const c=a.definition.concat([new yl({definition:a.definition})]);r=o(c)}else{if(a instanceof Cg)return jr(a.definition,c=>{Fo(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ua)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Cu(t,i)}),r}function pie(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Fo(h);){const d=h.pop();if(d===o){a&&gx(h).idx<=l&&h.pop();continue}const m=d.def,p=d.idx,g=d.ruleStack,y=d.occurrenceStack;if(Fo(m))continue;const v=m[0];if(v===i){const x={idx:p,def:Cu(m),ruleStack:LA(g),occurrenceStack:LA(y)};h.push(x)}else if(v instanceof Ua)if(p<c-1){const x=p+1,E=e[x];if(n(E,v.terminalType)){const C={idx:x,def:Cu(m),ruleStack:g,occurrenceStack:y};h.push(C)}}else if(p===c-1)u.push({nextTokenType:v.terminalType,nextTokenOccurrence:v.idx,ruleStack:g,occurrenceStack:y}),a=!0;else throw Error("non exhaustive match");else if(v instanceof Jh){const x=Nu(g);x.push(v.nonTerminalName);const E=Nu(y);E.push(v.idx);const C={idx:p,def:v.definition.concat(s,Cu(m)),ruleStack:x,occurrenceStack:E};h.push(C)}else if(v instanceof Gh){const x={idx:p,def:Cu(m),ruleStack:g,occurrenceStack:y};h.push(x),h.push(o);const E={idx:p,def:v.definition.concat(Cu(m)),ruleStack:g,occurrenceStack:y};h.push(E)}else if(v instanceof Q0){const x=new yl({definition:v.definition,idx:v.idx}),E=v.definition.concat([x],Cu(m)),C={idx:p,def:E,ruleStack:g,occurrenceStack:y};h.push(C)}else if(v instanceof e_){const x=new Ua({terminalType:v.separator}),E=new yl({definition:[x].concat(v.definition),idx:v.idx}),C=v.definition.concat([E],Cu(m)),A={idx:p,def:C,ruleStack:g,occurrenceStack:y};h.push(A)}else if(v instanceof Rg){const x={idx:p,def:Cu(m),ruleStack:g,occurrenceStack:y};h.push(x),h.push(o);const E=new Ua({terminalType:v.separator}),C=new yl({definition:[E].concat(v.definition),idx:v.idx}),A=v.definition.concat([C],Cu(m)),k={idx:p,def:A,ruleStack:g,occurrenceStack:y};h.push(k)}else if(v instanceof yl){const x={idx:p,def:Cu(m),ruleStack:g,occurrenceStack:y};h.push(x),h.push(o);const E=new yl({definition:v.definition,idx:v.idx}),C=v.definition.concat([E],Cu(m)),A={idx:p,def:C,ruleStack:g,occurrenceStack:y};h.push(A)}else if(v instanceof Cg)for(let x=v.definition.length-1;x>=0;x--){const E=v.definition[x],C={idx:p,def:E.definition.concat(Cu(m)),ruleStack:g,occurrenceStack:y};h.push(C),h.push(o)}else if(v instanceof Qh)h.push({idx:p,def:v.definition.concat(Cu(m)),ruleStack:g,occurrenceStack:y});else if(v instanceof Zx)h.push(A6e(v,p,g,y));else throw Error("non exhaustive match")}return u}function A6e(t,e,n,r){const i=Nu(n);i.push(t.name);const s=Nu(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var ic;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(ic||(ic={}));function mie(t){if(t instanceof Gh||t==="Option")return ic.OPTION;if(t instanceof yl||t==="Repetition")return ic.REPETITION;if(t instanceof Q0||t==="RepetitionMandatory")return ic.REPETITION_MANDATORY;if(t instanceof e_||t==="RepetitionMandatoryWithSeparator")return ic.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Rg||t==="RepetitionWithSeparator")return ic.REPETITION_WITH_SEPARATOR;if(t instanceof Cg||t==="Alternation")return ic.ALTERNATION;throw Error("non exhaustive match")}function M6e(t,e,n,r,i,s){const o=AF(t,e,n),a=vie(o)?WI:PM;return s(o,r,a,i)}function k6e(t,e,n,r,i,s){const o=MF(t,e,i,n),a=vie(o)?WI:PM;return s(o[0],a,r)}function O6e(t,e,n,r){const i=t.length,s=dg(t,o=>dg(o,a=>a.length===1));if(e)return function(o){const a=nr(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let d=0;d<u;d++){const m=l[d],p=m.length;for(let g=0;g<p;g++){const y=this.LA(g+1);if(n(y,m[g])===!1)continue e}return c}}};if(s&&!r){const o=nr(t,c=>Vh(c)),a=Zh(o,(c,l,u)=>(jr(l,h=>{Ir(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),jr(h.categoryMatches,d=>{Ir(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const m=this.LA(d+1);if(n(m,u[d])===!1)continue e}return o}}}}function I6e(t,e,n){const r=dg(t,s=>s.length===1),i=t.length;if(r&&!n){const s=Vh(t);if(s.length===1&&Fo(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Zh(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,jr(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class N6e extends L3{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,ic.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,ic.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,ic.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,ic.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,ic.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class gie extends pE{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,ic.OPTION)}visitRepetition(e){this.checkIsTarget(e,ic.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,ic.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,ic.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,ic.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,ic.ALTERNATION)}}function FW(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function bL(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function P6e(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function _ie(t,e){const n=nr(t,o=>R5([o],1)),r=FW(n.length),i=nr(n,o=>{const a={};return jr(o,c=>{const l=bL(c.partialPath);jr(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=FW(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,m=bL(h);if(P6e(i,m,c)||Fo(d)||h.length===e){const g=r[c];if(C5(g,h)===!1){g.push(h);for(let y=0;y<m.length;y++){const v=m[y];i[c][v]=!0}}}else{const g=R5(d,o+1,h);s[c]=s[c].concat(g),jr(g,y=>{const v=bL(y.partialPath);jr(v,x=>{i[c][x]=!0})})}}}}return r}function AF(t,e,n,r){const i=new gie(t,ic.ALTERNATION,r);return e.accept(i),_ie(i.result,n)}function MF(t,e,n,r){const i=new gie(t,n);e.accept(i);const s=i.result,a=new N6e(e,t,n).startWalking(),c=new Qh({definition:s}),l=new Qh({definition:a});return _ie([c,l],r)}function C5(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function D6e(t,e){return t.length<e.length&&dg(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function vie(t){return dg(t,e=>dg(e,n=>dg(n,r=>Fo(r.categoryMatches))))}function L6e(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return nr(e,n=>Object.assign({type:Yf.CUSTOM_LOOKAHEAD_VALIDATION},n))}function U6e(t,e,n,r){const i=tm(t,c=>B6e(c,n)),s=Y6e(t,e,n),o=tm(t,c=>$6e(c,n)),a=tm(t,c=>z6e(c,t,r,n));return i.concat(s,o,a)}function B6e(t,e){const n=new j6e;t.accept(n);const r=n.allProductions,i=Qre(r,F6e),s=wg(i,a=>a.length>1);return nr(Kc(s),a=>{const c=gg(a),l=e.buildDuplicateFoundError(t,a),u=m0(c),h={message:l,type:Yf.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=yie(c);return d&&(h.parameter=d),h})}function F6e(t){return`${m0(t)}_#_${t.idx}_#_${yie(t)}`}function yie(t){return t instanceof Ua?t.terminalType.name:t instanceof Jh?t.nonTerminalName:""}class j6e extends pE{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function z6e(t,e,n,r){const i=[];if(Zh(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:Yf.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function H6e(t,e,n){const r=[];let i;return Jf(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Yf.INVALID_RULE_OVERRIDE,ruleName:t})),r}function bie(t,e,n,r=[]){const i=[],s=LO(e.definition);if(Fo(s))return[];{const o=t.name;Jf(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Yf.LEFT_RECURSION,ruleName:o});const c=N3(s,r.concat([t])),l=tm(c,u=>{const h=Nu(r);return h.push(u),bie(t,u,n,h)});return i.concat(l)}}function LO(t){let e=[];if(Fo(t))return e;const n=gg(t);if(n instanceof Jh)e.push(n.referencedRule);else if(n instanceof Qh||n instanceof Gh||n instanceof Q0||n instanceof e_||n instanceof Rg||n instanceof yl)e=e.concat(LO(n.definition));else if(n instanceof Cg)e=Vh(nr(n.definition,s=>LO(s.definition)));else if(!(n instanceof Ua))throw Error("non exhaustive match");const r=qI(n),i=t.length>1;if(r&&i){const s=Cu(t);return e.concat(LO(s))}else return e}class kF extends pE{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function q6e(t,e){const n=new kF;t.accept(n);const r=n.alternations;return tm(r,s=>{const o=LA(s.definition);return tm(o,(a,c)=>{const l=pie([a],[],PM,1);return Fo(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:Yf.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function V6e(t,e,n){const r=new kF;t.accept(r);let i=r.alternations;return i=P3(i,o=>o.ignoreAmbiguities===!0),tm(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=AF(a,t,c,o),u=K6e(l,o,t,n),h=X6e(l,o,t,n);return u.concat(h)})}class G6e extends pE{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function $6e(t,e){const n=new kF;t.accept(n);const r=n.alternations;return tm(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Yf.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function W6e(t,e,n){const r=[];return jr(t,i=>{const s=new G6e;i.accept(s);const o=s.allProductions;jr(o,a=>{const c=mie(a),l=a.maxLookahead||e,u=a.idx,d=MF(u,i,c,l)[0];if(Fo(Vh(d))){const m=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:m,type:Yf.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function K6e(t,e,n,r){const i=[],s=Zh(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||jr(c,u=>{const h=[l];jr(t,(d,m)=>{l!==m&&C5(d,u)&&e.definition[m].ignoreAmbiguities!==!0&&h.push(m)}),h.length>1&&!C5(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return nr(s,a=>{const c=nr(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Yf.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function X6e(t,e,n,r){const i=Zh(t,(o,a,c)=>{const l=nr(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return IM(tm(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=hm(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&D6e(d.path,l));return nr(u,d=>{const m=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:m,prefixPath:d.path}),type:Yf.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:m}})}))}function Y6e(t,e,n){const r=[],i=nr(e,s=>s.name);return jr(t,s=>{const o=s.name;if(Jf(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:Yf.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function Z6e(t){const e=TF(t,{errMsgProvider:E6e}),n={};return jr(t.rules,r=>{n[r.name]=r}),S6e(n,e.errMsgProvider)}function J6e(t){return t=TF(t,{errMsgProvider:v1}),U6e(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const Eie="MismatchedTokenException",Sie="NoViableAltException",xie="EarlyExitException",Tie="NotAllInputParsedException",wie=[Eie,Sie,xie,Tie];Object.freeze(wie);function KI(t){return Jf(wie,t.name)}class F3 extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Rie extends F3{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Eie}}class Q6e extends F3{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Sie}}class e5e extends F3{constructor(e,n){super(e,n),this.name=Tie}}class t5e extends F3{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=xie}}const EL={},Cie="InRuleRecoveryException";class n5e extends Error{constructor(e){super(e),this.name=Cie}}class r5e{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ir(e,"recoveryEnabled")?e.recoveryEnabled:Ov.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=i5e)}getTokenToInsert(e){const n=LM(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),m=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new Rie(m,l,this.LA(0));p.resyncedTokens=LA(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new n5e("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||Fo(n))return!1;const r=this.LA(1);return _x(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Jf(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=_x(e,s=>b6e(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return EL;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return nr(e,(r,i)=>i===0?EL:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=nr(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return Vh(e)}getFollowSetFromFollowKey(e){if(e===EL)return[H1];const n=e.ruleName+e.idxInCallingRule+rie+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,H1)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return LA(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=Nu(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return nr(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function i5e(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),m=this.getGAstProductions()[d];c=new s(m,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=H1,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const s5e=4,db=8,Aie=1<<db,Mie=2<<db,A5=3<<db,M5=4<<db,k5=5<<db,UO=6<<db;function SL(t,e,n){return n|e|t}class o5e{constructor(e){var n;this.maxLookahead=(n=e?.maxLookahead)!==null&&n!==void 0?n:Ov.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(Fo(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return tm(e,n=>bie(n,n,v1))}validateEmptyOrAlternatives(e){return tm(e,n=>q6e(n,v1))}validateAmbiguousAlternationAlternatives(e,n){return tm(e,r=>V6e(r,n,v1))}validateSomeNonEmptyLookaheadPath(e,n){return W6e(e,n,v1)}buildLookaheadForAlternation(e){return M6e(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,O6e)}buildLookaheadForOptional(e){return k6e(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,mie(e.prodType),I6e)}}class a5e{initLooksAhead(e){this.dynamicTokensEnabled=Ir(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Ov.dynamicTokensEnabled,this.maxLookahead=Ir(e,"maxLookahead")?e.maxLookahead:Ov.maxLookahead,this.lookaheadStrategy=Ir(e,"lookaheadStrategy")?e.lookaheadStrategy:new o5e({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){jr(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=l5e(n);jr(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${m0(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=SL(this.fullRuleNameToShort[n.name],Aie,l.idx);this.setLaFuncCache(d,h)})}),jr(i,l=>{this.computeLookaheadFunc(n,l.idx,A5,"Repetition",l.maxLookahead,m0(l))}),jr(s,l=>{this.computeLookaheadFunc(n,l.idx,Mie,"Option",l.maxLookahead,m0(l))}),jr(o,l=>{this.computeLookaheadFunc(n,l.idx,M5,"RepetitionMandatory",l.maxLookahead,m0(l))}),jr(a,l=>{this.computeLookaheadFunc(n,l.idx,UO,"RepetitionMandatoryWithSeparator",l.maxLookahead,m0(l))}),jr(c,l=>{this.computeLookaheadFunc(n,l.idx,k5,"RepetitionWithSeparator",l.maxLookahead,m0(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=SL(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return SL(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class c5e extends pE{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const xk=new c5e;function l5e(t){xk.reset(),t.accept(xk);const e=xk.dslMethods;return xk.reset(),e}function jW(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function zW(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function u5e(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function f5e(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const h5e="name";function kie(t,e){Object.defineProperty(t,h5e,{enumerable:!1,configurable:!0,writable:!1,value:e})}function d5e(t,e){const n=lm(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function p5e(t,e){const n=function(){};kie(n,t+"BaseSemantics");const r={visit:function(i,s){if(hs(i)&&(i=i[0]),!kv(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=g5e(this,e);if(!Fo(i)){const s=nr(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function m5e(t,e,n){const r=function(){};kie(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return jr(e,s=>{i[s]=d5e}),r.prototype=i,r.prototype.constructor=r,r}var O5;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(O5||(O5={}));function g5e(t,e){return _5e(t,e)}function _5e(t,e){const n=hm(e,i=>Bv(t[i])===!1),r=nr(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:O5.MISSING_METHOD,methodName:i}));return IM(r)}class v5e{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Ir(e,"nodeLocationTracking")?e.nodeLocationTracking:Ov.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=gl,this.cstFinallyStateUpdate=gl,this.cstPostTerminal=gl,this.cstPostNonTerminal=gl,this.cstPostRule=gl;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=zW,this.setNodeLocationFromNode=zW,this.cstPostRule=gl,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=gl,this.setNodeLocationFromNode=gl,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=jW,this.setNodeLocationFromNode=jW,this.cstPostRule=gl,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=gl,this.setNodeLocationFromNode=gl,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=gl,this.setNodeLocationFromNode=gl,this.cstPostRule=gl,this.setInitialNodeLocation=gl;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];u5e(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];f5e(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(kv(this.baseCstVisitorConstructor)){const e=p5e(this.className,lm(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(kv(this.baseCstVisitorWithDefaultsConstructor)){const e=m5e(this.className,lm(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class y5e{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):YI}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?YI:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class b5e{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=ZI){if(Jf(this.definedRulesNames,e)){const o={message:v1.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Yf.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=ZI){const i=H6e(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(KI(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return SUe(Kc(this.gastProductionsCache))}}class E5e{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=WI,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ir(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(hs(e)){if(Fo(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(hs(e))this.tokensMap=Zh(e,(s,o)=>(s[o.name]=o,s),{});else if(Ir(e,"modes")&&dg(Vh(Kc(e.modes)),g6e)){const s=Vh(Kc(e.modes)),o=D3(s);this.tokensMap=Zh(o,(a,c)=>(a[c.name]=c,a),{})}else if(cm(e))this.tokensMap=Nu(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=H1;const r=Ir(e,"modes")?Vh(Kc(e.modes)):Kc(e),i=dg(r,s=>Fo(s.categoryMatches));this.tokenMatcher=i?WI:PM,DM(Kc(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ir(r,"resyncEnabled")?r.resyncEnabled:ZI.resyncEnabled,s=Ir(r,"recoveryValueFunc")?r.recoveryValueFunc:ZI.recoveryValueFunc,o=this.ruleShortNameIdx<<s5e+db;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(KI(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(Mie,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(M5,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,ic.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,M5,e,C6e)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(UO,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,BW],a,UO,e,BW)}else throw this.raiseEarlyExitException(e,ic.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(A5,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,A5,e,R6e,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(k5,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,UW],a,k5,e,UW)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,UO,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(Aie,n),i=hs(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new e5e(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw KI(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Rie(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===Cie?r:s}}else throw r}saveRecogState(){const e=this.errors,n=Nu(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),H1)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class S5e{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Ir(e,"errorMessageProvider")?e.errorMessageProvider:Ov.errorMessageProvider}SAVE_ERROR(e){if(KI(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Nu(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Nu(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=MF(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new t5e(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=AF(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Q6e(c,this.LA(1),a))}}class x5e{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(kv(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return pie([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=gg(e.ruleStack),i=this.getGAstProductions()[n];return new w6e(i,e).startWalking()}}const j3={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(j3);const HW=!0,qW=Math.pow(2,db)-1,Oie=Qd({name:"RECORDING_PHASE_TOKEN",pattern:eu.NA});DM([Oie]);const Iie=LM(Oie,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Iie);const T5e={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class w5e{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return YI}topLevelRuleRecord(e,n){try{const r=new Zx({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return pC.call(this,Gh,e,n)}atLeastOneInternalRecord(e,n){pC.call(this,Q0,n,e)}atLeastOneSepFirstInternalRecord(e,n){pC.call(this,e_,n,e,HW)}manyInternalRecord(e,n){pC.call(this,yl,n,e)}manySepFirstInternalRecord(e,n){pC.call(this,Rg,n,e,HW)}orInternalRecord(e,n){return R5e.call(this,e,n)}subruleInternalRecord(e,n,r){if(XI(n),!e||Ir(e,"ruleName")===!1){const a=new Error(`<SUBRULE${VW(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=gx(this.recordingProdStack),s=e.ruleName,o=new Jh({idx:n,nonTerminalName:s,label:r?.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?T5e:j3}consumeInternalRecord(e,n,r){if(XI(n),!fie(e)){const o=new Error(`<CONSUME${VW(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=gx(this.recordingProdStack),s=new Ua({idx:n,terminalType:e,label:r?.LABEL});return i.definition.push(s),Iie}}function pC(t,e,n,r=!1){XI(n);const i=gx(this.recordingProdStack),s=Bv(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),Ir(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),j3}function R5e(t,e){XI(e);const n=gx(this.recordingProdStack),r=hs(t)===!1,i=r===!1?t:t.DEF,s=new Cg({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});Ir(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=wF(i,a=>Bv(a.GATE));return s.hasPredicates=o,n.definition.push(s),jr(i,a=>{const c=new Qh({definition:[]});s.definition.push(c),Ir(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ir(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),j3}function VW(t){return t===0?"":`${t}`}function XI(t){if(t<0||t>qW){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${qW+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class C5e{initPerformanceTracer(e){if(Ir(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ov.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=tie(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function A5e(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const YI=LM(H1,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(YI);const Ov=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:die,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),ZI=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Yf;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Yf||(Yf={}));let OF=class Nie{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{nie(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),jr(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=Z6e({rules:Kc(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(Fo(r)&&this.skipValidations===!1){const i=J6e({rules:Kc(this.gastProductionsCache),tokenTypes:Kc(this.tokensMap),errMsgProvider:v1,grammarName:n}),s=L6e({lookaheadStrategy:this.lookaheadStrategy,rules:Kc(this.gastProductionsCache),tokenTypes:Kc(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Fo(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=MUe(Kc(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Kc(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Kc(this.gastProductionsCache))})),!Nie.DEFER_DEFINITION_ERRORS_HANDLING&&!Fo(this.definitionErrors))throw e=nr(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Ir(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ir(n,"skipValidations")?n.skipValidations:Ov.skipValidations}};OF.DEFER_DEFINITION_ERRORS_HANDLING=!1;A5e(OF,[r5e,a5e,v5e,y5e,E5e,b5e,S5e,x5e,w5e,C5e]);class M5e extends OF{constructor(e,n=Ov){const r=Nu(n);r.outputCst=!0,super(e,r)}}function k5e(t){const e=new O5e,n=Kc(t);return nr(n,r=>e.visitRule(r))}class O5e extends pE{visitRule(e){const n=this.visitEach(e.definition),r=Qre(n,s=>s.propertyName),i=nr(r,(s,o)=>{const a=!wF(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=nr(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:Tk(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:Tk(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:Tk(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:Tk(e)}]}visitEachAndOverrideWith(e,n){return nr(this.visitEach(e),r=>Xh({},r,n))}visitEach(e){return Vh(nr(e,n=>this.visit(n)))}}function Tk(t){return t instanceof Jh?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function I5e(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(Vh(nr(t,r=>N5e(r)))),e.includeVisitorInterface&&(n=n.concat(U5e(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function N5e(t){const e=P5e(t),n=D5e(t);return[e,n]}function P5e(t){const e=Pie(t.name),n=IF(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function D5e(t){return`export type ${IF(t.name)} = {
  ${nr(t.properties,n=>L5e(n)).join(`
  `)}
};`}function L5e(t){const e=F5e(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function U5e(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${nr(e,n=>B5e(n)).join(`
  `)}
}`}function B5e(t){const e=IF(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function F5e(t){if(hs(t)){const e=D3(nr(t,r=>GW(r)));return"("+Zh(e,(r,i)=>r+" | "+i)+")"}else return GW(t)}function GW(t){return t.kind==="token"?"IToken":Pie(t.name)}function Pie(t){return Fre(t)+"CstNode"}function IF(t){return Fre(t)+"CstChildren"}const j5e={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function z5e(t,e){const n=Object.assign(Object.assign({},j5e),e),r=k5e(t);return I5e(r,n)}const UM=lx(32,126).map(t=>String.fromCharCode(t));function vi(t){return Qd({...t,name:`token_${t.name}`})}function $t(t){return vi({name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:cc})}const UA=vi({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Die=vi({name:"whitespace",pattern:/ +/,group:eu.SKIPPED}),Lie=vi({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:eu.SKIPPED}),q1=vi({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),ov=vi({name:"command",pattern:/#/,start_chars_hint:["#"]});let Uie=!1;const H5e="@#/?':!",q5e=/^(by|at|away|toward|find|flee|to|cw|ccw|opp|rndp)/i;function V5e(t,e){if(!Uie)return null;let n=e;const r=t[n-1]??"";if(n>0&&r!==" "&&r!==`
`)return null;if(t[n]===" "){for(;t[n]===" ";)n++;if(H5e.includes(t[n]))return null}for(;n>0&&`$"@#':!/?
`.includes(t[n])===!1;)n--;switch(t[n]){case"?":case"/":{const o=t.substring(n+1,e+1).toLowerCase();if(o.indexOf(" ")<1||q5e.test(o))return null;break}case"#":return null;case'"':{for(n--;n>0&&t[n]===" ";)n--;if(!(n<1||t[n]===`
`))return null;break}case"@":case"'":case":":case"!":return null}let i=e;for(t[i]==='"'&&++i;i<t.length&&t[i]!==`
`;)i++;const s=t.substring(e,i);return s.trim().length===0||s.toLowerCase()==="do"?null:[s]}const BA=vi({name:"text",pattern:V5e,line_breaks:!1,start_chars_hint:UM}),FA=vi({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),vx=vi({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),jA=vi({name:"hyperlink",pattern:/![^;\n]*/,start_chars_hint:["!"]}),NF=vi({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),cc=vi({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:UM}),cA=vi({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),JI=vi({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Bie=$t("isterrain"),Fie=$t("isobject"),jie=$t("issolid"),zie=$t("iswalk"),Hie=$t("isswim"),qie=$t("isbullet"),Vie=$t("isghost"),Gie=$t("iswalking"),$ie=$t("iswalkable"),Wie=$t("isswimming"),Kie=$t("isswimmable"),Xie=$t("black"),Yie=$t("dkblue"),Zie=$t("dkgreen"),Jie=$t("dkcyan"),Qie=$t("dkred"),ese=$t("dkpurple"),tse=$t("dkyellow"),nse=$t("ltgray"),rse=$t("dkgray"),ise=$t("blue"),sse=$t("green"),ose=$t("cyan"),ase=$t("red"),cse=$t("purple"),lse=$t("yellow"),use=$t("white"),fse=$t("brown"),hse=$t("dkwhite"),dse=$t("ltgrey"),pse=$t("gray"),mse=$t("grey"),gse=$t("dkgrey"),_se=$t("ltblack"),vse=$t("onblack"),yse=$t("ondkblue"),bse=$t("ondkgreen"),Ese=$t("ondkcyan"),Sse=$t("ondkred"),xse=$t("ondkpurple"),Tse=$t("ondkyellow"),wse=$t("onltgray"),Rse=$t("ondkgray"),Cse=$t("onblue"),Ase=$t("ongreen"),Mse=$t("oncyan"),kse=$t("onred"),Ose=$t("onpurple"),Ise=$t("onyellow"),Nse=$t("onwhite"),Pse=$t("onbrown"),Dse=$t("ondkwhite"),Lse=$t("onltgrey"),Use=$t("ongray"),Bse=$t("ongrey"),Fse=$t("ondkgrey"),jse=$t("onltblack"),zse=$t("onclear"),Hse=$t("blblack"),qse=$t("bldkblue"),Vse=$t("bldkgreen"),Gse=$t("bldkcyan"),$se=$t("bldkred"),Wse=$t("bldkpurple"),Kse=$t("bldkyellow"),Xse=$t("blltgray"),Yse=$t("bldkgray"),Zse=$t("blblue"),Jse=$t("blgreen"),Qse=$t("blcyan"),eoe=$t("blred"),toe=$t("blpurple"),noe=$t("blyellow"),roe=$t("blwhite"),ioe=$t("blbrown"),soe=$t("bldkwhite"),ooe=$t("blltgrey"),aoe=$t("blgray"),coe=$t("blgrey"),loe=$t("bldkgrey"),uoe=$t("blltblack"),foe=$t("idle"),hoe=$t("up"),doe=$t("down"),poe=$t("left"),moe=$t("right"),goe=$t("by"),_oe=$t("at"),voe=$t("flow"),yoe=$t("seek"),boe=$t("rndns"),Eoe=$t("rndne"),Soe=$t("rnd"),xoe=$t("cw"),Toe=$t("ccw"),woe=$t("opp"),Roe=$t("rndp"),Coe=$t("away"),Aoe=$t("toward"),Moe=$t("find"),koe=$t("flee"),Ooe=$t("to"),Ioe=$t("i"),Noe=$t("u"),Poe=$t("north"),Doe=$t("n"),Loe=$t("d"),Uoe=$t("south"),Boe=$t("s"),Foe=$t("l"),joe=$t("west"),zoe=$t("w"),Hoe=$t("r"),qoe=$t("east"),Voe=$t("e"),Goe=$t("over"),$oe=$t("under"),Woe=$t("ground"),Koe=$t("within"),Xoe=$t("awayby"),Yoe=vi({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:cc}),Zoe=$t("contact"),Joe=$t("blocked"),Qoe=$t("any"),eae=$t("countof"),tae=$t("abs"),nae=$t("intceil"),rae=$t("intfloor"),iae=$t("intround"),sae=$t("clamp"),oae=$t("min"),aae=$t("max"),cae=$t("pick"),lae=$t("pickwith"),uae=$t("random"),fae=$t("randomwith"),hae=$t("run"),dae=$t("runwith"),pae=vi({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),PF=vi({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:cc}),DF=vi({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:cc}),LF=vi({name:"islessthan",pattern:/<|below/i,longer_alt:cc}),UF=vi({name:"isgreaterthan",pattern:/>|above/i,longer_alt:cc}),BF=vi({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:cc}),FF=vi({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:cc}),QI=vi({name:"or",pattern:/or/i,longer_alt:cc}),eN=vi({name:"not",pattern:/not/i,longer_alt:cc}),tN=vi({name:"and",pattern:/and/i,longer_alt:cc}),nN=vi({name:"plus",pattern:/\+/}),rN=vi({name:"minus",pattern:/-/}),jF=vi({name:"power",pattern:/\*\*/}),zF=vi({name:"multiply",pattern:/\*/}),w1=vi({name:"divide",pattern:/\//}),HF=vi({name:"moddivide",pattern:/%/}),qF=vi({name:"floordivide",pattern:/%%/}),zA=vi({name:"query",pattern:/\?/}),VF=vi({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),GF=vi({name:"rparen",pattern:/\)/,pop_mode:!0}),$F=vi({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:UM,longer_alt:cc}),mae=vi({name:"command_toast",pattern:/toast .*/i,start_chars_hint:UM,longer_alt:cc}),gae=vi({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:UM,longer_alt:cc}),R1=vi({name:"if",pattern:/if|try|take|give|duplicate/i,longer_alt:cc}),C1=vi({name:"do",pattern:new RegExp("(?<!(zap |send |restore ))(?<=\\s)do","i"),start_chars_hint:["d"],longer_alt:cc}),iN=$t("done"),A1=$t("else"),WF=$t("while"),KF=$t("repeat"),XF=$t("waitfor"),YF=vi({name:"foreach",pattern:/foreach|for/i,longer_alt:cc}),ZF=$t("break"),JF=$t("continue");function _ae(t,e){return[...t,doe,...e,JI,Bie,Fie,jie,$ie,Gie,zie,Kie,Wie,Hie,qie,Vie,Xie,Yie,Zie,Jie,Qie,ese,tse,nse,rse,ise,sse,ose,ase,cse,lse,use,fse,hse,dse,pse,mse,gse,_se,vse,yse,bse,Ese,Sse,xse,Tse,wse,Rse,Cse,Ase,Mse,kse,Ose,Ise,Nse,Pse,Dse,Lse,Use,Bse,Fse,jse,zse,Hse,qse,Vse,Gse,$se,Wse,Kse,Xse,Yse,Zse,Jse,Qse,eoe,toe,noe,roe,ioe,soe,ooe,aoe,coe,loe,uoe,foe,hoe,poe,moe,goe,_oe,voe,yoe,Roe,boe,Eoe,Soe,xoe,Toe,woe,Koe,Xoe,Coe,Aoe,Moe,koe,Ooe,Poe,Uoe,joe,qoe,Goe,$oe,Woe,Yoe,Zoe,Joe,Qoe,eae,tae,nae,rae,iae,sae,oae,aae,lae,cae,fae,uae,dae,hae,pae,PF,DF,BF,LF,FF,UF,QI,eN,tN,nN,rN,jF,zF,w1,qF,HF,zA,VF,GF,Ioe,Noe,Doe,Loe,Boe,Foe,zoe,Hoe,Voe,cA,cc]}const vae=_ae([BA,q1,$F,mae,gae,ov,FA,vx,jA,NF,UA,Die],[ZF,JF,iN,C1,A1,YF,R1,KF,XF,WF]),G5e=new eu({defaultMode:"use_newlines",modes:{use_newlines:vae,ignore_newlines:_ae([Lie],[])}},{skipValidations:!B0,ensureOptimizations:B0,positionTracking:"full"});function yae(t){Uie=!0;const e=G5e.tokenize(t||` 
`),[n]=(Rr(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(LM(UA,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function I5(t,e,n=!0){if(n){const[r,...i]=e;switch(hr(r??"")){default:return{type:qn.OBJECT,values:e};case"loader":return{type:qn.LOADER,values:i};case"board":return{type:qn.BOARD,values:i};case"object":return{type:qn.OBJECT,values:i};case"terrain":return{type:qn.TERRAIN,values:i};case"charset":return{type:qn.CHARSET,values:i};case"palette":return{type:qn.PALETTE,values:i}}}else{const[r,i,...s]=e,o=hr(i??""),a=[r,t,...s];switch(o){default:return{type:qn.CONST,values:e};case"rn":case"range":return{type:qn.RANGE,values:a};case"sl":case"select":return{type:qn.SELECT,values:a};case"nm":case"number":return{type:qn.NUMBER,values:a};case"tx":case"text":return{type:qn.TEXT,values:a};case"hk":case"hotkey":return{type:qn.HOTKEY,values:a};case"copyit":return{type:qn.COPYIT,values:a};case"openit":return{type:qn.OPENIT,values:a};case"zssedit":return{type:qn.ZSSEDIT,values:a};case"charedit":return{type:qn.CHAREDIT,values:a};case"coloredit":return{type:qn.COLOREDIT,values:a}}}}function wy(t){switch(t){case qn.LOADER:return"loader";case qn.BOARD:return"board";case qn.OBJECT:return"object";case qn.TERRAIN:return"terrain";case qn.CHARSET:return"charset";case qn.PALETTE:return"palette";case qn.CONST:return"const";case qn.RANGE:return"range";case qn.SELECT:return"select";case qn.NUMBER:return"number";case qn.TEXT:return"text";case qn.HOTKEY:return"hotkey";case qn.COPYIT:return"copyit";case qn.OPENIT:return"openit";case qn.VIEWIT:return"viewit";case qn.ZSSEDIT:return"zssedit";case qn.CHAREDIT:return"charedit";case qn.COLOREDIT:return"coloredit"}}function $W(){return{id:va()}}function Rc(t){return t?.category===N1.ISOBJECT}function HA(t,e){if(!ge(t)||!$f(e))return;const{color:n,bg:r}=hre(e);ge(n)&&(t.color=n),ge(r)&&(t.bg=r)}function $5e(t,e){return{id:va(),code:t,...e}}function wk(t){const e={...BM(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function bae(t){const e=yae(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===q1){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=I5(Sn(c)?c:"",l,r),h=u.values.join(" ");switch(r=!1,u.type){case qn.LOADER:n.type=Tr.LOADER,n.name=h;break;case qn.BOARD:n.type=Tr.BOARD,n.name=h;break;case qn.OBJECT:n.type=Tr.OBJECT,n.name=h||"object";break;case qn.TERRAIN:n.type=Tr.TERRAIN,n.name=h;break;case qn.CHARSET:n.type=Tr.CHARSET,n.name=h;break;case qn.PALETTE:n.type=Tr.PALETTE,n.name=h;break;case qn.CONST:{const[d,...m]=u.values;if(Sn(d)){const p=hr(d),g=m.join(" ");if(Sn(g)){const y=parseFloat(g);n[p]=an(y)?y:g}else n[p]=1}break}case qn.RANGE:case qn.SELECT:case qn.NUMBER:case qn.TEXT:case qn.HOTKEY:case qn.ZSSEDIT:case qn.CHAREDIT:case qn.COLOREDIT:{const[d,...m]=u.values;if(Sn(d)){const p=hr(d);n[p]=[wy(u.type),...m]}break}}}}return n}function BM(t){return ge(t)?(ge(t.stats?.type)||(t.stats=bae(t.code),ge(t.stats.type)||(t.stats.type=Tr.OBJECT)),t.stats):{}}function Eae(t){switch(t){default:case Tr.ERROR:return"error";case Tr.LOADER:return wy(qn.LOADER);case Tr.BOARD:return wy(qn.BOARD);case Tr.OBJECT:return wy(qn.OBJECT);case Tr.TERRAIN:return wy(qn.TERRAIN);case Tr.CHARSET:return wy(qn.CHARSET);case Tr.PALETTE:return wy(qn.PALETTE)}}function Jy(t){return BM(t).type??Tr.ERROR}function tS(t){return Eae(Jy(t))}function Xl(t){return BM(t).name??""}function W5e(t,e){return BM(t)[e]}const Rk=new Xi;function K5e(t){if(!Sn(t))return;const e=OA(t);if(ge(e)&&ge(en[e]))return en[e];const n=hr(t),r=pn[n];if(ge(r))return r}function N5(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(Rr(s)){const[o,...a]=s;switch(o){case"text":ge(e[i])||(e[i]="");break;case"range":ge(e[i])||(e[i]=4);break;case"number":ge(e[i])||(e[i]=0);break;case"select":if(!ge(e[i])){const[,c]=a;e[i]=c}break}continue}switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":e[i]=s;break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":e[i]=K5e(s)??s;break;case"isitem":e.item=1;break;case"notitem":e.item=0;break;case"ispushable":e.pushable=s===""?1:s;break;case"notpushable":e.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=Qn.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=Qn.ISSWIM;break;case"issolid":e.collision=Qn.ISSOLID;break;case"isbullet":e.collision=Qn.ISBULLET;break;case"isghost":e.collision=Qn.ISGHOST;break;case"isbreakable":e.breakable=1;break;case"notbreakable":e.breakable=0;break}}}function Tl(t){if(ge(t))switch(Jy(t)){default:return;case Tr.ERROR:return t.code??"";case Tr.LOADER:return t.code??"";case Tr.BOARD:{ge(t.board)||(t.board=q3()),t.board.id=t.id,t.board.name=Xl(t);const e=wk(t);return ge(e.isdark)&&(t.board.isdark=1),ge(e.notdark)&&(t.board.isdark=0),an(e.startx)&&(t.board.startx=e.startx),an(e.starty)&&(t.board.starty=e.starty),Sn(e.over)&&(hr(e.over)==="empty"?t.board.over=void 0:t.board.over=e.over),Sn(e.under)&&(hr(e.under)==="empty"?t.board.under=void 0:t.board.under=e.under),Sn(e.camera)&&(hr(e.camera)==="empty"?t.board.camera=void 0:t.board.camera=e.camera),Sn(e.graphics)&&(hr(e.graphics)==="empty"?t.board.graphics=void 0:t.board.graphics=e.graphics),an(e.facing)&&(t.board.facing=e.facing),Sn(e.facing)&&hr(e.facing)==="empty"&&(t.board.facing=void 0),Sn(e.exitnorth)&&(t.board.exitnorth=e.exitnorth),Sn(e.exitsouth)&&(t.board.exitsouth=e.exitsouth),Sn(e.exitwest)&&(t.board.exitwest=e.exitwest),Sn(e.exiteast)&&(t.board.exiteast=e.exiteast),an(e.timelimit)&&(t.board.timelimit=e.timelimit),ge(e.restartonzap)&&(t.board.restartonzap=1),ge(e.norestartonzap)&&(t.board.restartonzap=0),an(e.maxplayershots)&&(t.board.maxplayershots=e.maxplayershots),t.board}case Tr.OBJECT:return ge(t.object)||(t.object=$W()),t.object.id=t.id,t.object.code=t.code,t.object.name=Xl(t),t.object.category=N1.ISOBJECT,N5(wk(t),t.object),t.object;case Tr.TERRAIN:return ge(t.terrain)||(t.terrain=$W()),t.terrain.id=t.id,t.terrain.name=Xl(t),t.terrain.category=N1.ISTERRAIN,N5(wk(t),t.terrain),t.terrain;case Tr.PALETTE:{if(ge(t.palette)||(t.palette=lE(Yx)),ge(t.palette?.bits)){const e=wk(t),n=Cv(e);for(let r=0;r<n.length;++r){const i=n[r].toLowerCase(),s=e[i];if(i.startsWith("color")&&Sn(s)){const o=parseFloat(i.replace("color",""));if(o>=0&&o<=15){Rk.set(s);const a=o*ux,c=Rk.r*63,l=Rk.g*63,u=Rk.b*63;t.palette.bits[a+0]=Vr(c,0,63),t.palette.bits[a+1]=Vr(l,0,63),t.palette.bits[a+2]=Vr(u,0,63)}}}}return t.palette}case Tr.CHARSET:return ge(t.charset)||(t.charset=uE(Xx)),t.charset}}function Sae(t){return{id:va(),name:fte(),timestamp:0,activelist:[],pages:t,flags:{}}}function xae(t){ge(t)&&(t.token=`${Ixe()}${Bd(1111,9999)}`)}function qA(t,e){if(!ge(t))return;const n=hr(e);return t.pages.find(i=>i.id===e||n===Xl(i))}function Xd(t,e,n){if(!ge(t))return;const r=hr(n);return t.pages.find(s=>Jy(s)===e&&(s.id===n||r===Xl(s)))}function P5(t,e,n){let r=Xd(t,e,n);if(!ge(r)){const i=Eae(e);return r=$5e(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),X5e(t,r),[r,!0]}return[r,!1]}function D5(t,e,n){if(!ge(t))return[];const r=hr(n);return t.pages.filter(s=>Jy(s)===e).filter(s=>{const o=BM(s),a=hr(Xl(s));return s.id===n||r===a||ge(o[n])})}function mC(t){return ge(t)?na(t.pages).sort((n,r)=>{const i=Jy(n),s=Jy(r);return i===s?Xl(n).localeCompare(Xl(r)):s-i}):[]}function X5e(t,e){if(!ge(t)||!ge(e))return!1;const n=qA(t,e.id);return ge(n)?!1:(t.pages.push(e),xae(t),!0)}function Tae(t,e){const n=qA(t,e);if(ge(t)&&ge(n)){const r=hr(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==Xl(i)),xae(t),n}}function ed(t,e=1,n=en.WHITE,r=en.BLACK){const i=t?.kinddata;return{name:hr(t?.name??i?.name),char:t?.displaychar??i?.displaychar??t?.char??i?.char??e,color:t?.displaycolor??i?.displaycolor??t?.color??i?.color??n,bg:t?.displaybg??i?.displaybg??t?.bg??i?.bg??r,light:t?.light??i?.light??0}}function z3(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function Y5e(t,e){t&&delete t.flags[e]}function sN(t,e,n){return z3(t,e)?.[n]}function L5(t,e,n,r){const i=z3(t,e);return i&&(i[n]=r),r}function H3(t,e){const n=t??Qn.ISWALK,r=e??Qn.ISWALK;if(n===Qn.ISGHOST||r===Qn.ISGHOST)return!1;switch(n){case Qn.ISWALK:return r!==Qn.ISWALK;case Qn.ISSWIM:return r!==Qn.ISSWIM;case Qn.ISSOLID:return!0;case Qn.ISBULLET:return r!==Qn.ISWALK&&r!==Qn.ISSWIM}}function VA(t,e,n){const r=t?.objects[n];if(ge(r))return r;const i=Jx(t,"player");return ge(e)?(e.x<0&&(e.x=Bd(0,wn-1)),e.y<0&&(e.y=Bd(0,Nr-1)),Rae(e,i)):Wp(...i)}function Jx(t,e){const n=t?.named?.[e];return ge(n)?[...n.values()].map(i=>typeof i=="string"?t?.objects[i]:t?.terrain[i]).filter(ge):[]}function Z5e(t){const e=[];for(let n=0;n<Nr;++n)for(let r=0;r<wn;++r){const i={x:r,y:n},s=ro(t,i);!s?.name&&!s?.kind&&e.push(i)}return e}function U5(t,e,n,r){if(!ge(t))return!1;const i=ed(t);return!(ge(e)&&e!==i.name||ge(n)&&n!==i.color||ge(r)&&r!==i.bg)}function oN(t,e){const n=IA(e),r=FI(e),i=dre(e);return Jx(t,n??"").filter(s=>U5(s,n,r,i))}function WW(t,e){const n=ge(e)?LI(e):void 0,r=ge(e)?UI(e):void 0,i=[];if(ge(t)){for(let o=0;o<t.terrain.length;++o){const a=t.terrain[o];ge(a)&&U5(a,void 0,n,r)&&i.push(a)}const s=Object.values(t.objects);for(let o=0;o<s.length;++o){const a=s[o];U5(a,void 0,n,r)&&i.push(a)}}return i}function wae(t,e){return ge(t)?e.map(n=>{if(typeof n=="string"){const r=t.objects[n];if(ge(r))return r;const i=Jx(t,hr(n));if(i.length)return i}else if(By(n)&&n.x>=0&&n.x<wn&&n.y>=0&&n.y<Nr){const r=n.x+n.y*wn,i=t.lookup?.[r];return ge(i)?t.objects[i]:t.terrain[r]}}).flat().filter(ge):[]}function Rae(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function Wf(t){if(!ge(t)||ge(t.lookup)&&ge(t.named))return;const e=new Array(wn*Nr).fill(void 0),n={},r=Object.values(t.objects);for(let o=0;o<r.length;++o){const a=r[o];if(ge(a.x)&&ge(a.y)&&ge(a.id)&&!ge(a.removed)&&Yr(a,"collision")!==Qn.ISGHOST){a.category=N1.ISOBJECT,e[a.x+a.y*wn]=a.id,Sn(a.code)&&!ge(a.name)&&N5(bae(a.code),a);const c=ed(a);n[c.name]||(n[c.name]=new Set),n[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<t.terrain.length;++o){const a=t.terrain[o];if(ge(a)){a.x=i,a.y=s,a.category=N1.ISTERRAIN;const c=ed(tb(a));n[c.name]||(n[c.name]=new Set),n[c.name].add(o)}++i,i>=wn&&(i=0,++s)}t.lookup=e,t.named=n}function GA(t){ge(t)&&(delete t.named,delete t.lookup,Wf(t))}function B5(t,e,n){if(!ge(t)||!ge(t.named)||!ge(e))return;const r=hr(e.name??e.kinddata?.name??"");t.named[r]||(t.named[r]=new Set),t.named[r].add(e?.id??n??"")}function Cae(t,e){if(!(!ge(t)||!ge(t.lookup)||!ge(e?.id))&&!ge(e.removed)&&Yr(e,"collision")!==Qn.ISGHOST){const n=e.x??0,r=e.y??0;t.lookup[n+r*wn]=e.id}}function J5e(t,e){if(ge(t)&&ge(e?.x)&&ge(e.y)){const n=ed(e),r=$A(t,e);ge(t.named?.[n.name])&&t.named[n.name].delete(r)}}function QF(t,e){if(ge(t)&&ge(e?.id)){if(ge(t.lookup)&&ge(e.x)&&ge(e.y)){const r=e.x+e.y*wn;t.lookup[r]===e.id&&(t.lookup[r]=void 0)}const n=ed(e);ge(t.named?.[n.name])&&ge(e.id)&&t.named[n.name].delete(e.id)}}function Q5e(t,e,n,r){if(!ge(t))return;ge(t.distmaps)||(t.distmaps={});const i=`${e}.${n.x}.${n.y}.${r.x}.${r.y}`;let s=t.distmaps[i];if(!ge(s)){s=new Array(fg).fill(-2);const o=[{...r}];let a=0;for(;o.length;){const c=o.shift();if(ge(c)&&yx(c)){const l=Wc(c,wn);if(s[l]===-2){const u=V1(t,c.x,c.y);H3(e,Yr(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}t.distmaps[i]=s}return s}function KW(t,e){return yx(t)?e[Wc(t,wn)]:-1}function XW(t,e,n,r,i){if(!ge(t))return;const s=Q5e(t,e,n,r);if(!ge(s))return;const o=[{x:n.x,y:n.y-1},{x:n.x,y:n.y+1},{x:n.x-1,y:n.y},{x:n.x+1,y:n.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=KW(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=KW(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function eBe(){return new Array(wn*Nr).map(()=>{})}function q3(t=Ah){const e={terrain:eBe(),objects:{},id:"",name:""};return t(e)}function yx(t){return hNe(t.x,t.y,0,wn-1,Nr-1,0)}function $A(t,e){return!ge(t)||!ge(e?.x)||!ge(e?.y)||e.x<0||e.x>=wn||e.y<0||e.y>=Nr?-1:e.x+e.y*wn}function ro(t,e){const n=$A(t,e);if(n<0||!ge(t?.lookup))return;const r=Gd(t,t.lookup[n]??"");return ge(r)?r:t.terrain[n]}function tBe(t,e){const n=Gd(t,e);if(ge(n))return n;const r=parseFloat(e),i=dx(isNaN(r)?-1:r,wn);return V1(t,i.x,i.y)}function V1(t,e,n){return(e>=0&&e<wn)??(n>=0&&n<Nr)?t?.terrain[e+n*wn]:void 0}function ku(t,e){if(!ge(t)||!ge(e)||!ge(e.x)||!ge(e.y)||e.x<0||e.x>=wn||e.y<0||e.y>=Nr)return;const n=na(e),r=e.x+e.y*wn;return t.terrain[r]=n,delete t.distmaps,t.terrain[r]}function nBe(t,e){if(!ge(t)||!ge(e))return;const n=na(e);return n.id=n.id??va(),t.objects[n.id]=n,t.objects[n.id]}function rBe(t,e,n){return ku(t,{...e,kind:n})}function Aae(t,e,n,r){return nBe(t,{...e,kind:n,id:r})}function Gd(t,e){if(t)return t.objects[e]}function iBe(t){return ge(t)?[...Object.values(t.objects)]:[]}function YW(t,e){const n=$A(t,e);if(n<0||!ge(t?.lookup))return;const r=Gd(t,t.lookup[n]??"");if(ge(r))return r}function $d(t,e,n){return!ge(e)||ed(e).name==="player"?!1:(e.id?(e.removed=n,QF(t,e)):(ku(t,{x:e?.x??0,y:e?.y??0}),J5e(t,e)),!0)}function sBe(t,e,n){if(!ge(t)||!ge(e))return;const r=t.objects[n];if(ge(r))return r;if(By(e))return Rae(e,Jx(t,"player"))}function XC(t,e,n,r,i){const s=pn.MID;if(!ge(t)||!ge(e))return{dir:r,startpt:i,destpt:i,layer:s,targets:[]};const o={x:e.x??0,y:e.y??0},a={x:o.x+(e.stepx??0),y:o.y+(e.stepy??0)},c=p0(o,a),l=wn-1,u=Nr-1;for(let h=0;h<r.length;++h){const d=lre(r[h]);switch(d){case pn.IDLE:break;case pn.NORTH:case pn.SOUTH:case pn.WEST:case pn.EAST:Ja(o,d);break;case pn.BY:{const[m,p]=r.slice(h+1);an(m)&&an(p)&&(o.x=Vr(o.x+m,0,l),o.y=Vr(o.y+p,0,u)),h+=2;break}case pn.TO:{const[m,p]=r.slice(h+1);an(m)&&an(p)&&(o.x=Vr(m,0,l),o.y=Vr(p,0,u)),h+=2;break}case pn.AT:{const[m,p]=r.slice(h+1);an(m)&&an(p)&&(o.x=Vr(m,0,l),o.y=Vr(p,0,u)),h+=2;break}case pn.FLOW:Ja(o,c);break;case pn.SEEK:{const m=sBe(t,e,n);By(m)&&Ja(o,p0(i,m));break}case pn.RNDNS:Ja(o,Wp(pn.NORTH,pn.SOUTH));break;case pn.RNDNE:Ja(o,Wp(pn.NORTH,pn.EAST));break;case pn.RND:Ja(o,Wp(pn.NORTH,pn.SOUTH,pn.WEST,pn.EAST));break;case pn.CW:case pn.CCW:case pn.OPP:case pn.RNDP:{const m=XC(t,e,n,r.slice(h+1),i);switch(o.x=i.x,o.y=i.y,d){case pn.CW:switch(p0(i,m.destpt)){case pn.NORTH:Ja(o,pn.EAST);break;case pn.SOUTH:Ja(o,pn.WEST);break;case pn.EAST:Ja(o,pn.SOUTH);break;case pn.WEST:Ja(o,pn.NORTH);break}break;case pn.CCW:switch(p0(i,m.destpt)){case pn.NORTH:Ja(o,pn.WEST);break;case pn.SOUTH:Ja(o,pn.EAST);break;case pn.EAST:Ja(o,pn.NORTH);break;case pn.WEST:Ja(o,pn.SOUTH);break}break;case pn.OPP:switch(p0(i,m.destpt)){case pn.NORTH:Ja(o,pn.SOUTH);break;case pn.SOUTH:Ja(o,pn.NORTH);break;case pn.EAST:Ja(o,pn.WEST);break;case pn.WEST:Ja(o,pn.EAST);break}break;case pn.RNDP:switch(p0(i,m.destpt)){case pn.NORTH:case pn.SOUTH:o.x+=Wp(-1,1);break;case pn.WEST:case pn.EAST:o.y+=Wp(-1,1);break}break}return{dir:r,startpt:i,destpt:o,layer:s,targets:[]}}case pn.FLEE:break;case pn.AWAY:{const[m,p]=r.slice(h+1);if(an(m)&&an(p)){const g={x:Vr(m,0,l),y:Vr(p,0,u)},y=g.x-o.x,v=g.y-o.y;if(Math.abs(y)>1||Math.abs(v)>1){const x=Yr(e,"collision"),E=XW(t,x,o,g,!0);ge(E)&&E.x!==m&&E.y!==p&&!YW(t,E)&&(o.x=E.x,o.y=E.y)}else{const x=_1(-y,-v);Ja(o,x)}}h+=2;break}case pn.FIND:break;case pn.TOWARD:{const[m,p]=r.slice(h+1);if(an(m)&&an(p)){const g={x:Vr(m,0,l),y:Vr(p,0,u)},y=g.x-o.x,v=g.y-o.y;if(Math.abs(y)>1||Math.abs(v)>1){const x=Yr(e,"collision"),E=XW(t,x,o,g,!1);ge(E)&&E.x!==m&&E.y!==p&&!YW(t,E)&&(o.x=E.x,o.y=E.y)}else{const x=_1(y,v);Ja(o,x)}}h+=2;break}case pn.MID:case pn.OVER:case pn.UNDER:case pn.GROUND:{const m=XC(t,e,n,r.slice(h+1),i);return m.layer=d,m}case pn.WITHIN:{const[m]=r.slice(h+1),p=XC(t,e,n,r.slice(h+2),i);if(p.targets.length===0&&an(m)&&m>0)for(let g=-m;g<=m;++g)for(let y=-m;y<=m;++y){const v={x:p.destpt.x+y,y:p.destpt.y+g};yx(v)&&p.targets.push(v)}return an(m)&&m>0?{...p,targets:p.targets.filter(g=>By(g)?P$(g,p.destpt)<=m:!1)}:p}case pn.AWAYBY:{const[m]=r.slice(h+1),p=XC(t,e,n,r.slice(h+2),i);if(p.targets.length===0)for(let g=-wn;g<=wn;++g)for(let y=-wn;y<=wn;++y){const v={x:p.destpt.x+y,y:p.destpt.y+g};yx(v)&&p.targets.push(v)}return an(m)&&m>0?{...p,targets:p.targets.filter(g=>By(g)?P$(g,p.destpt)>=m:!1)}:p}}}return{dir:r,startpt:i,destpt:o,layer:s,targets:[]}}function V3(t,e,n,r=!1){if(!ge(t)||!ge(t.lookup)||n.x<0||n.x>=wn||n.y<0||n.y>=Nr)return{name:"edge",kind:"edge",collision:Qn.ISSOLID,x:n.x,y:n.y};const i=n.x+n.y*wn,s=Gd(t,t.lookup[i]??"404");if(ge(s))return r&&$p(s.id)?void 0:s;const o=t.terrain[i];if(ge(o)&&H3(e,Yr(o,"collision")))return o}function oBe(t,e,n){const r=Gd(t,e?.id??""),i=r?.x??-1,s=r?.y??-1;if(i-n.x===0&&s-n.y===0)return!0;const o=Yr(r,"collision");return ge(V3(t,o,n))}function F5(t,e,n){const r=Gd(t,e?.id??"");if(!ge(t)||!ge(r)||!ge(r.x)||!ge(r.y)||!ge(t.lookup)||n.x<0||n.x>=wn||n.y<0||n.y>=Nr)return{name:"edge",kind:"edge",collision:Qn.ISSOLID,x:n.x,y:n.y};if(r.x-n.x===0&&r.y-n.y===0)return;const i=$A(t,r),s=$A(t,n),o=Yr(r,"collision");if(o===Qn.ISGHOST){r.x=n.x,r.y=n.y;return}const a=$p(r?.id),c=Gd(t,t.lookup[s]??"");if(Yr(c,"collision")===Qn.ISGHOST)return;const l=$p(c?.id??"");if(ge(c)&&(!a||!l))return{...c};const u=t.terrain[s],h=u?.collision??u?.kinddata?.collision??Qn.ISWALK;if(H3(o,h))return{...u,x:n.x,y:n.y};r.x=n.x,r.y=n.y,ge(r.removed)||(t.lookup[i]=void 0,t.lookup[s]=r.id??"")}function Mae(t,e,n){const r=[],i=[];if(!ge(t))return{objectelements:r,terrainelements:i};function s(a,c){switch(n){case"all":return!0;case"self":return a?.id===e;case"others":return a?.id!==e;case"terrain":return c===!0;case"object":return c===!1}const l=Yr(a,n);return ge(l)||ed(a).name===n||Yr(a,"group")===n}const o=Object.values(t.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&r.push(c)}for(let a=0;a<fg;++a){const c=t.terrain[a];ge(c)&&s(c,!0)&&i.push(c)}return{objectelements:r,terrainelements:i}}const kae={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function WA(t){return Rr(t)&&Oae(t[0])}function Oae(t){return ge(N1[t])&&Sn(t)}function Iae(t){if(Sn(t))return kae[hr(t)]}function ZW(t){if(WA(t))return t;if(Oae(t))return[t];const e=Iae(t);if(ge(e))return[e]}function aBe(t){const e=Ee.words[t],n=ZW(e);if(WA(n))return[n,t+1];const[r,i]=Lf(t),s=ZW(r);return WA(s)?[s,i]:[void 0,t]}const Nae={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Qn.ISSOLID,Qn.ISWALK,Qn.ISSWIM,Qn.ISBULLET,Qn.ISGHOST,Qn.ISWALK,Qn.ISSWIM;function aN(t){return Rr(t)&&j5(t[0])}function j5(t){return ge(Qn[t])&&Sn(t)}function cBe(t){if(Sn(t))return Nae[hr(t)]}function lBe(t){const e=Ee.words[t];if(aN(e))return[e,t+1];if(j5(e))return[[e],t+1];const[n,r]=Lf(t);return aN(n)?[n,r]:j5(n)?[[n],r]:[void 0,t]}function nS(t,e=0){const n=[];let r=t;for(;r<Ee.words.length;){const[i,s]=Lf(r);if(Rr(i)&&!om(i)&&!WA(i)&&!aN(i)&&!$f(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),e>0&&n.length>=e)return[n,r]}return[n,r]}function Lf(t){const e=Ee.words[t],n=t+1;if(Iae(e)){const[r,i]=aBe(t);if(ge(r))return[r,i]}if(cBe(e)){const[r,i]=lBe(t);if(ge(r))return[r,i]}if(OA(e)){const[r,i]=BI(t);if(ge(r))return[r,i]}if(Sn(e)&&hr(e)==="rnd"){const[r,i]=Lf(n),[s,o]=Lf(i);return an(r)&&an(s)?[Bd(r,s),o]:an(r)?[Bd(0,r),i]:[Bd(0,1),n]}if(b3(e)){const[r,i]=ure(t);if(ge(r))return[r,i]}if(!ge(e))return[void 0,t];if(an(e)||Rr(e))return[e,n];if(Sn(e)){const r=hr(e),i=Ee.get?.(e);if(ge(i))return[i,n];switch(r){case"aligned":case"alligned":{const s=VA(Ee.board,{x:Ee.element?.x??-1,y:Ee.element?.y??-1},Ee.elementfocus);return!ge(Ee.element)||!ge(s)?[0,n]:[Ee.element.x===s.x||Ee.element.y===s.y?1:0,n]}case"contact":{const s=VA(Ee.board,{x:Ee.element?.x??-1,y:Ee.element?.y??-1},Ee.elementfocus);if(!ge(Ee.element)||!ge(s))return[0,n];const o=(s.x??0)-(Ee.element?.x??0),a=(s.y??0)-(Ee.element?.y??0);return[o===0&&Math.abs(a)<2||a===0&&Math.abs(o)<2?1:0,n]}case"blocked":{const[s,o]=Gt(Ee.words,n,[yt.DIR]);return[oBe(Ee.board,Ee.element,s.destpt)?1:0,o]}case"any":{const[s]=Gt(Ee.words,n,[yt.ANY]);if(om(s)){const[l,u,h]=Gt(Ee.words,n,[yt.DIR,yt.COLOR_OR_KIND]);if(l.targets.length){const[m,p]=u,g=[];for(let y=0;y<l.targets.length;++y){const v=l.targets[y],x=["any","at",v.x,v.y,p,m].filter(C=>C!==void 0),[E]=Gt(x,0,[yt.ANY]);Rr(E)&&E.length&&g.push(...E)}return[g,h]}let d;switch(l.layer){default:case pn.MID:ro(Ee.board,l.destpt);break;case pn.GROUND:V1(Ee.board,l.destpt.x,l.destpt.y);break}if(ge(d)){const m=ed(d);if($f(u))return[LI(u)===m.color||UI(u)===m.bg?[d]:[],h];const p=hr(IA(u)),g=FI(u);if((p.length&&p!==m.name||ge(g)&&g!==m.color)===!1)return[[d],h]}return[[],h]}const[o,a]=Gt(Ee.words,n,[yt.COLOR_OR_KIND]);return $f(o)?[WW(Ee.board,o),a]:[oN(Ee.board,o),a]}case"countof":{const[s]=Gt(Ee.words,n,[yt.ANY]);if(om(s)){const[l,u,h]=Gt(Ee.words,n,[yt.DIR,yt.COLOR_OR_KIND]);if(l.targets.length){let m=0;const[p,g]=u;for(let y=0;y<l.targets.length;++y){const v=l.targets[y],x=["countof","at",v.x,v.y,g,p].filter(C=>C!==void 0),[E]=Gt(x,0,[yt.ANY]);an(E)&&(m+=E)}return[m,h]}let d;switch(l.layer){default:case pn.MID:ro(Ee.board,l.destpt);break;case pn.GROUND:V1(Ee.board,l.destpt.x,l.destpt.y);break}if(ge(d)){const m=ed(d);if($f(u))return[LI(u)===m.color||UI(u)===m.bg?1:0,h];const p=hr(IA(u)),g=FI(u),y=p.length?p===m.name:!0,v=ge(g)?g===m.color:!0;if(y&&v)return[1,h]}return[0,h]}const[o,a]=Gt(Ee.words,n,[yt.COLOR_OR_KIND]);return $f(o)?[WW(Ee.board,o).length,a]:[oN(Ee.board,o).length,a]}case"rnd":return[Bd(0,1),n];case"abs":{const[s,o]=Gt(Ee.words,n,[yt.NUMBER]);return[Math.abs(s),o]}case"intceil":{const[s,o]=Gt(Ee.words,n,[yt.NUMBER]);return[Math.ceil(s),o]}case"intfloor":{const[s,o]=Gt(Ee.words,n,[yt.NUMBER]);return[Math.floor(s),o]}case"intround":{const[s,o]=Gt(Ee.words,n,[yt.NUMBER]);return[Math.round(s),o]}case"clamp":{const[s,o,a,c]=Gt(Ee.words,n,[yt.NUMBER,yt.NUMBER,yt.NUMBER]);return[Vr(s,o,a),c]}case"min":{const[s,o]=nS(n);return[Math.min(...s),o]}case"max":{const[s,o]=nS(n);return[Math.max(...s),o]}case"pick":{const[s,o]=nS(n);return[Wp(s),o]}case"pickwith":{const[s,o]=Gt(Ee.words,n,[yt.NUMBER_OR_STRING]),[a,c]=nS(o);return[UIe(`${s}`,a),c]}case"random":{const[s,o]=nS(n,2),[a,c]=s;return[Bd(a,c??0),o]}case"randomwith":{const[s,o]=Gt(Ee.words,n,[yt.NUMBER_OR_STRING]),[a,c]=nS(o,2),[l,u]=a;return[Kee(`${s}`,l,u??0),c]}case"run":{const[s,o]=Gt(Ee.words,n,[yt.NAME]);return yN(s),[Ee.get?.("arg"),o]}case"runwith":{const[s,o,a]=Gt(Ee.words,n,[yt.ANY,yt.NAME]);return ge(Ee.element)&&(Ee.element.arg=s),yN(o),[Ee.get?.("arg"),a]}}}return[e,n]}const Ee={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var yt=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.COLOR_OR_KIND=7]="COLOR_OR_KIND",t[t.MAYBE_KIND=8]="MAYBE_KIND",t[t.MAYBE_NAME=9]="MAYBE_NAME",t[t.MAYBE_NUMBER=10]="MAYBE_NUMBER",t[t.MAYBE_STRING=11]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",t[t.ANY=13]="ANY",t))(yt||{});function Vl(t,e,n){throw console.info(n,Ee.element,Ee.elementid,Ee.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function JW(t){const e={x:Ee.element?.x??0,y:Ee.element?.y??0};return XC(Ee.board,Ee.element,Ee.elementfocus,t,e)}function Gt(t,e,n){const r=Ee.words;Ee.words=t;const i=[];let s=e;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=hL(s);T1(a)?(s=c,i.push(a)):Vl("kind",a,t);break}case 0:{if(OA(t[s])===void 0){const[a,c]=Lf(s);$f(a)?(s=c,i.push(a)):an(a)?(s=c,i.push(S3(a,void 0))):Vl("color",a,t)}else{const[a,c]=BI(s);$f(a)?(s=c,i.push(a)):Vl("color",a,t)}break}case 2:{if(b3(t[s])===void 0){const[a,c]=Lf(s);om(a)?(s=c,i.push(JW(a))):Vl("direction",a,t)}else{const[a,c]=ure(s);om(a)?(s=c,i.push(JW(a))):Vl("direction",a,t)}break}case 3:{const a=Ee.words[s];Sn(a)||Vl("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=Lf(s);if(Sn(a)){const l=parseFloat(a);an(l)?i.push(l):Vl("number",a,t)}else an(a)?i.push(a):Vl("number",a,t);s=c;break}case 5:{const[a,c]=Lf(s);Sn(a)||Vl("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=Lf(s);let l=a;if(Sn(l)){const u=parseFloat(l);an(u)&&(l=u)}else an(l)||Vl("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=hL(s);if(T1(a))s=c,i.push(a);else if(OA(t[s])===void 0){const[l,u]=Lf(s);$f(l)?(s=u,i.push(l)):Vl("color",l,t)}else{const[l,u]=BI(s);$f(l)?(s=u,i.push(l)):Vl("color or kind",l,t)}break}case 8:{const[a,c]=hL(s);a!==void 0&&!T1(a)&&Vl("optional kind",a,t),s=c,i.push(a);break}case 9:{const a=Ee.words[s];a!==void 0&&!Sn(a)&&Vl("optional string",a,t),++s,i.push(a);break}case 10:{const[a,c]=Lf(s);if(Sn(a)){const l=parseFloat(a);an(l)?i.push(l):Vl("optional number",a,t)}else an(a)||a===void 0?i.push(a):Vl("optional number",a,t);s=c;break}case 11:{const[a,c]=Lf(s);a!==void 0&&!Sn(a)&&Vl("optional string",a,t),s=c,i.push(a);break}case 12:{const[a,c]=Lf(s);let l=a;if(Sn(l)){const u=parseFloat(l);an(u)&&(l=u)}else l!==void 0&&!an(l)&&Vl("number or string",l,t);s=c,i.push(l);break}case 13:{const[a,c]=Lf(s);s=c,i.push(a);break}}return Ee.words=r,[...i,s]}function Oh(t,e,n,r){const[i,s]=Gt(r,0,[yt.NUMBER_OR_STRING,yt.MAYBE_NUMBER_OR_STRING]);Qee(ut,t,e,n,i,s)}const uBe=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function e7(t,e,n){const[r,i]=Gt(n,0,[yt.NUMBER_OR_STRING]);if(an(r))jD(ut,t,e,"volume",r);else if(uBe.includes(hr(r))){const[s,o]=Gt(n,i,[yt.NUMBER_OR_STRING,yt.MAYBE_NUMBER_OR_STRING]);Qee(ut,t,e,r,s,o)}else{const[s]=Gt(n,i,[yt.MAYBE_NUMBER_OR_STRING]);if(an(s)){const o=n.length-i,a=new Array(o).fill(yt.NUMBER),c=Gt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;jD(ut,t,e,r,l)}else{const[o]=Gt(n,i,[yt.MAYBE_NUMBER_OR_STRING]);jD(ut,t,e,r,o)}}}function my(t,e){const[n]=Gt(t,0,[yt.MAYBE_NAME]);ISe(ut,Ee.elementfocus,Ee.board?.id??"",n??"",e)}const G3=Uv().command("tts",(t,e)=>{const[n,r]=Gt(e,0,[yt.STRING,yt.STRING]);return MSe(ut,Ee.elementfocus,n,r),0}).command("ttsqueue",(t,e)=>{const[n,r]=Gt(e,0,[yt.STRING,yt.STRING]);return kSe(ut,Ee.elementfocus,n,r),0}).command("bpm",(t,e)=>{const[n]=Gt(e,0,[yt.NUMBER]);return NSe(ut,Ee.elementfocus,n),0}).command("vol",(t,e)=>{const[n]=Gt(e,0,[yt.NUMBER]);return PSe(ut,Ee.elementfocus,n),0}).command("bgvol",(t,e)=>{const[n]=Gt(e,0,[yt.NUMBER]);return DSe(ut,Ee.elementfocus,n),0}).command("ttsvol",(t,e)=>{const[n]=Gt(e,0,[yt.NUMBER]);return LSe(ut,Ee.elementfocus,n),0}).command("play",(t,e)=>{const[n]=Gt(e,0,[yt.MAYBE_NAME]);return OSe(ut,Ee.elementfocus,Ee.board?.id??"",n??""),0}).command("bgplay",(t,e)=>(my(e,""),0)).command("bgplayon64n",(t,e)=>(my(e,"@64n"),0)).command("bgplayon32n",(t,e)=>(my(e,"@32n"),0)).command("bgplayon16n",(t,e)=>(my(e,"@16n"),0)).command("bgplayon8n",(t,e)=>(my(e,"@8n"),0)).command("bgplayon4n",(t,e)=>(my(e,"@4n"),0)).command("bgplayon2n",(t,e)=>(my(e,"@2n"),0)).command("bgplayon1n",(t,e)=>(my(e,"@1m"),0)).command("synth",(t,e)=>{for(let n=0;n<4;++n)e7(Ee.elementfocus,n,e);return 0}).command("synthrecord",(t,e)=>{const[n]=Gt(e,0,[yt.MAYBE_STRING]);return USe(ut,Ee.elementfocus,n??""),0}).command("synthflush",()=>(BSe(ut,Ee.elementfocus),0)).command("echo",(t,e)=>{for(let n=0;n<2;++n)Oh(Ee.elementfocus,n,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let n=0;n<2;++n)Oh(Ee.elementfocus,n,"fc",e);return 0}).command("phaser",(t,e)=>{for(let n=0;n<2;++n)Oh(Ee.elementfocus,n,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let n=0;n<2;++n)Oh(Ee.elementfocus,n,"reverb",e);return 0}).command("distort",(t,e)=>{for(let n=0;n<2;++n)Oh(Ee.elementfocus,n,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let n=0;n<2;++n)Oh(Ee.elementfocus,n,"vibrato",e);return 0}).command("autowah",(t,e)=>{for(let n=0;n<2;++n)Oh(Ee.elementfocus,n,"autowah",e);return 0});for(let t=0;t<4;++t)G3.command(`synth${t+1}`,(e,n)=>(e7(Ee.elementfocus,t,n),0));G3.command("synth5",(t,e)=>{for(let n=4;n<8;++n)e7(Ee.elementfocus,n,e);return 0});for(let t=0;t<3;++t){const e=t+1;G3.command(`echo${e}`,(n,r)=>(Oh(Ee.elementfocus,t,"echo",r),0)).command(`fcrush${e}`,(n,r)=>(Oh(Ee.elementfocus,t,"fcrush",r),0)).command(`phaser${e}`,(n,r)=>(Oh(Ee.elementfocus,t,"phaser",r),0)).command(`reverb${e}`,(n,r)=>(Oh(Ee.elementfocus,t,"reverb",r),0)).command(`distort${e}`,(n,r)=>(Oh(Ee.elementfocus,t,"distort",r),0)).command(`vibrato${e}`,(n,r)=>(Oh(Ee.elementfocus,t,"vibrato",r),0)).command(`autowah${e}`,(n,r)=>(Oh(Ee.elementfocus,t,"autowah",r),0))}function QW(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ro(e,{x:s,y:i});Rc(o)&&$d(e,o,t.timestamp),ku(e,{x:s,y:i})}}function fBe(t,e,n){for(let r=e.y;r<=n.y;++r)for(let i=e.x;i<=n.x;++i)ku(t,{x:i,y:r})}function eK(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ro(e,{x:s,y:i});Rc(o)&&$d(e,o,t.timestamp),ku(e,{x:s,y:i})}}function G1(t,e){ge(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.displaychar=e.displaychar,t.displaycolor=e.displaycolor,t.displaybg=e.displaybg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.p4=e.p4,t.p5=e.p5,t.p6=e.p6,t.code=e.code,t.item=e.item,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.lightdir=e.lightdir,t.stepx=e.stepx,t.stepy=e.stepy,t.shootx=e.shootx,t.shooty=e.shooty,t.pushable=e.pushable,t.collision=e.collision,t.breakable=e.breakable,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function $3(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return hBe(t,e,n,"",i)}if(!ge(Ee.book))return;const s=Ee.book,o=Xd(s,Tr.BOARD,t),a=Tl(o);if(!ge(a))return;const c=Xd(s,Tr.BOARD,e),l=Tl(c);if(!ge(l))return;Wf(a),Wf(l);let u=!1;if(ge(a)&&ge(l)){switch(i){case"all":QW(s,l,n,r);break;case"object":eK(s,l,n,r);break;case"terrain":fBe(l,n,r);break;default:u=!0;break}for(let h=n.y;h<=r.y;++h)for(let d=n.x;d<=r.x;++d){let m=!1,p=!1;switch(i){case"all":m=!0,p=!0;break;case"object":m=!0;break;case"terrain":p=!0;break}const g={x:d,y:h};let y,v=ro(a,g);if(Rc(v)?(y=V1(a,d,h),$p(v?.id)&&(v=void 0)):(y=v,v=void 0),ge(y)&&(p||u&&Yr(y,"group")===i)){u&&QW(s,l,g,g);const x=nm(l,[y.kind??""],g);G1(x,y)}if(ge(v)&&(m||u&&Yr(v,"group")===i)){u&&eK(s,l,g,g);const x=nm(l,[v.kind??""],g);G1(x,v)}}GA(l)}}function hBe(t,e,n,r,i){if(!ge(Ee.book))return;const s=Ee.book,o=Xd(s,Tr.BOARD,t),a=Tl(o);if(!ge(a))return;const c=Xd(s,Tr.BOARD,e),l=Tl(c);if(ge(l)&&(Wf(a),Wf(l),ge(a)&&ge(l))){const{terrainelements:u,objectelements:h}=Mae(a,r,i);if(u.length===0&&h.length===0)return;const d={x:wn,y:Nr};for(let m=0;m<u.length;++m){const p=u[m];an(p.x)&&(d.x=Math.min(d.x,p.x)),an(p.y)&&(d.y=Math.min(d.y,p.y))}for(let m=0;m<h.length;++m){const p=h[m];an(p.x)&&(d.x=Math.min(d.x,p.x)),an(p.y)&&(d.y=Math.min(d.y,p.y))}for(let m=0;m<u.length;++m){const p=u[m],g={x:n.x+(p.x??0)-d.x,y:n.y+(p.y??0)-d.y},y=ro(l,g);ge(y)&&(Rc(y)&&$d(l,y,s.timestamp),ku(l,g));const v=nm(l,[p.kind??""],g);G1(v,p)}for(let m=0;m<h.length;++m){const p=h[m],g={x:n.x+(p.x??0)-d.x,y:n.y+(p.y??0)-d.y},y=nm(l,[p.kind??""],g);G1(y,p)}GA(l)}}function rc(t){return`${t??""}`}function Ru(t,e){const n=parseFloat(rc(t));return isNaN(n)?e:n}function Kf(t,e){return typeof t==typeof e?t:e}function dBe(t,e,n){if(!ge(t))return;L5(t,e,"board",n);const r=qf(n);ge(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function AS(t,e,n,r,i=!1){const s=dle(e);if(!ge(t)||!ge(s))return;const o=Gd(s,e);if(!Rc(o)||!o?.id)return;const a=qf(n);if(!ge(a))return;Wf(a);const c=V3(a,Qn.ISWALK,r,!0);if(i===!1&&ge(c))if(Yr(c,"item"))xc(e,o,c,"touch");else return;QF(s,o),delete s.objects[o.id],o.x=r.x,o.y=r.y,a.objects[o.id]=o,B5(a,o),Cae(a,o),L5(t,e,"enterx",r.x),L5(t,e,"entery",r.y),dBe(t,e,a.id)}function pBe(t){const n=(t?.activelist??[]).map(r=>{const i=sN(t,r,"board");return Sn(i)?i:""});return BIe(n)}function Pae(t){const e=pBe(t),n=new Set,r=[];for(let i=0;i<e.length;++i){const s=qf(e[i]);if(ge(s)&&!n.has(s.id)){if(Sn(s.over))if(Sn(s.overboard)){const o=qf(s.overboard);ge(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=qf(s.over);ge(o)&&(s.overboard=o.id)}else Sn(s.overboard)&&delete s.overboard;if(r.push(s),Sn(s.under))if(Sn(s.underboard)){const o=qf(s.underboard);ge(o)||delete s.underboard}else{const o=qf(s.under);ge(o)&&(s.underboard=o.id)}else Sn(s.underboard)&&delete s.underboard}}return r}const mBe=lx(32,126).map(t=>String.fromCharCode(t)),Dae=Qd({name:"Whitespace",pattern:/ +/}),gBe=Qd({name:"WhitespaceSkipped",pattern:/ +/,group:eu.SKIPPED}),W3=Qd({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),K3=Qd({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:mBe}),X3=Qd({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Y3=Qd({name:"EscapedDollar",pattern:"$$"}),Z3=Qd({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),J3=Qd({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),Q3=Qd({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function _Be(t,e=""){return Qd({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const vBe=Object.keys(E3),Lae=vBe.map(t=>_Be(`\\$(${t})`,t)),yBe=[Dae,W3,...Lae,X3,K3,J3,Y3,Q3,Z3],bBe=new eu(yBe,{skipValidations:!B0,ensureOptimizations:B0}),EBe=new eu([gBe,W3,...Lae,X3,K3,J3,Y3,Q3,Z3],{skipValidations:!B0,ensureOptimizations:B0}),tK=/\$CENTER/i;function t7(t){if(tK.test(t))return t.replace(tK,"")}function FM(t,e=!1){return e?EBe.tokenize(t):bBe.tokenize(t)}function zv(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function n7(t){t.active={...t.reset}}function r7(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case Y3:s("$");break;case J3:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case X3:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case W3:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=E3[l],h=pNe(en[u]),d=sF(en[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):ge(h)?e.active.color=h:ge(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(ge(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){n7(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;bx(u,u+l.length,e.active.color,e.active.bg,e),eP(u,l,e)}}}function Cr(t,e,n){const r=FM(t);r.tokens&&(r7(r.tokens,e),n&&n7(e),e.changed())}function nK(t){const e=FM(t);if(!e.tokens)return"";const n=e.tokens.filter(r=>{switch(r.tokenType){case Dae:case W3:case X3:case K3:case J3:case Y3:case Q3:case Z3:return!0;default:return!1}}).map(r=>r.image).join("");return n.trim().length===0?"":n}function pb(t,e,n){const r=FM(t);if(!r.tokens)return;const i=zv(e,n,en.WHITE,en.BLACK);return i.measureonly=!0,r7(r.tokens,i),i.x>0&&++i.y,i}function eP(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function bx(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function SBe(t,e,n,r){const i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;++o)r.bg[o]=n;r.changed()}function Dp(t,e,n,r,i,s,o){const a=Math.min(n,r),c=Math.max(n,r);if(a>e||c<0)return;const l=Math.max(0,a),u=Math.min(e,c);bx(t+l,t+u,i,s,o)}function rK(t,e,n,r,i,s){const o=Math.min(n,r),a=Math.max(n,r);if(o>e||a<0)return;const c=Math.max(0,o),l=Math.min(e,a);SBe(t+c,t+l,i,s)}function z5(t,e,n){const r=LM(K3,t,0,0,0,0,0,0);r7([r],e),n&&n7(e),e.changed()}function dm(t){const e=t.reset.leftedge??0,n=t.reset.rightedge??t.width-1,r=t.reset.topedge??0,i=t.reset.bottomedge??t.height-1,s=n-e+1,o=i-r+1;return{left:e,right:n,top:r,bottom:i,width:s,height:o}}function Ck(t,e,n){if(!ge(Ee.element?.x)||!ge(Ee.element.y))return 0;if(Ee.elementisplayer){const a=Ee.board?.maxplayershots??0;if(a>0&&iBe(Ee.board).filter(l=>!l.removed&&$p(l.party)&&Yr(l,"collision")===Qn.ISBULLET).length>=a)return t.set("didshoot",0),t.yield(),0}const[r,i]=Gt(e,0,[yt.DIR,yt.MAYBE_KIND]);Ee.element.shootx=Vr(r.destpt.x-r.startpt.x,-1,1),Ee.element.shooty=Vr(r.destpt.y-r.startpt.y,-1,1);const s=i??["bullet"],o=$Ve(Ee.board,s,{x:Ee.element.x,y:Ee.element.y});if(ge(o)){ge(n)&&(o.arg=n),o.cycle=1,o.party=Ee.elementid,o.collision=Qn.ISBULLET,o.breakable=1,o.stepx=r.destpt.x-Ee.element.x,o.stepy=r.destpt.y-Ee.element.y,o.bg=en.ONCLEAR;const a=tb(o),c=o.code??a?.code??"";YVe(Ee.book,Ee.board,o,c)}return Ee.elementisplayer&&t.set("didshoot",ge(o)?1:0),t.yield(),0}function YC(t,e,n){if(!By(Ee.element)||!ge(Ee.book)||!ge(Ee.board)||!ge(Ee.element))return 0;const[r,i]=Gt(t,0,[yt.DIR,yt.KIND]);if(r.targets.length){for(let d=0;d<r.targets.length;++d){const m=r.targets[d];YC(["at",m.x,m.y,...i],e,n)}return 0}const{destpt:s}=r;if(s.x<0||s.x>=wn||s.y<0||s.y>=Nr)return 0;const[o]=i,a={x:Ee.element?.x??0,y:Ee.element?.y??0},c=tb({kind:o}),l=Yr(c,"collision");if(l===Qn.ISGHOST)return nm(Ee.board,i,r.destpt,e),0;let u=ro(Ee.board,r.destpt);if(Yr(u,"pushable")){const d=na(r.destpt),m=Ja(d,p0(a,d));Fd(Ee.book,Ee.board,u,m),u=ro(Ee.board,r.destpt)}if(o==="empty")return $d(Ee.board,u,Ee.timestamp),0;if(Rc(u)&&$d(Ee.board,u,Ee.timestamp),Rc(c)||nm(Ee.board,i,r.destpt,e),Rc(c)){const d=V3(Ee.board,l,r.destpt);if(!ge(d)){const m=nm(Ee.board,i,r.destpt,e);ge(m)&&ge(n)&&(m.arg=n)}}return 0}function Ak(t,e,n){if(!ge(Ee.book)||!ge(Ee.board))return 1;const[r,i]=Gt(e,0,[yt.DIR,yt.DIR]),s=ro(Ee.board,r.destpt);if(ge(s)&&ge(s.kind)){const o=Yr(s,"collision"),a=V3(Ee.board,o,i.destpt);if(ge(a))return 1;const c=nm(Ee.board,[s.kind],i.destpt);if(!ge(c))return 1;G1(c,s),ge(n)&&(c.arg=n)}else return 1;return 0}const xBe={x:0,y:0},TBe={x:wn-1,y:Nr-1},wBe="all",RBe=Uv().command("build",(t,e)=>{if(!ge(Ee.book)||!ge(Ee.board)||!ge(Ee.element))return 0;const[n,r]=Gt(e,0,[yt.NAME,yt.MAYBE_STRING]),i=q3();if(ge(i)){if(Sn(r)){const s=qf(r);ge(s)&&$3(s.id,i.id,xBe,TBe,wBe)}t.set(n,i.id)}return 0}).command("goto",(t,e)=>{if(!ge(Ee.book)||!ge(Ee.board))return 0;const[n,r]=Gt(e,0,[yt.STRING]),[i,s]=Gt(e,r,[yt.MAYBE_NUMBER,yt.MAYBE_NUMBER]),o=qf(n);if(!ge(o))return 0;const a={x:i??o.startx??Math.round(wn*.5),y:s??o.starty??Math.round(Nr*.5)},c=ed(Ee.element);if(c.name!=="player"){const l=Yr(Ee.element,"color"),u=Yr(Ee.element,"bg"),h=S3(l,u),d=oN(o,[c.name,h]),[m]=d.sort((p,g)=>{const y=p.y??1e4,v=g.y??1e4,x=y-v;if(x!==0)return x;const E=p.x??1e4,C=g.x??1e4;return E-C});ge(m)&&an(m.x)&&an(m.y)&&(a.x=m.x,a.y=m.y)}return AS(Ee.book,Ee.elementfocus,o.id,a,!0),0}).command("transport",(t,e)=>{if(!ge(Ee.book)||!ge(Ee.board)||!ge(Ee.element))return 0;const[n]=Gt(e,0,[yt.STRING]),r=Gd(Ee.board,n);if(ge(Ee.element?.x)&&ge(Ee.element.y)&&ge(r?.x)&&ge(r.y)){let i=!0;const s={x:Ee.element.x,y:Ee.element.y},o=s.x-r.x,a=s.y-r.y;if(Yr(Ee.element,"shootx")!==o||Yr(Ee.element,"shooty")!==a)return 0;for(;i&&(s.x+=o,s.y+=a,!(s.x<0||s.x>=wn||s.y<0||s.y>=Nr));){const c=ro(Ee.board,s);c?.kind===Ee.element.kind&&Yr(c,"shootx")===-o&&Yr(c,"shooty")===-a&&Fd(Ee.book,Ee.board,r,{x:s.x+o,y:s.y+a})&&(i=!1)}i&&Fd(Ee.book,Ee.board,r,{x:Ee.element.x+o,y:Ee.element.y+a})}return 0}).command("shove",(t,e)=>{if(!ge(Ee.book)||!ge(Ee.board))return 0;const[n,r]=Gt(e,0,[yt.DIR,yt.DIR]),i=ro(Ee.board,n.destpt);if(Rc(i)){const s=n.destpt.x+(r.destpt.x-r.startpt.x),o=n.destpt.y+(r.destpt.y-r.startpt.y);Fd(Ee.book,Ee.board,i,{x:s,y:o})}return 0}).command("push",(t,e)=>{if(!ge(Ee.book)||!ge(Ee.board))return 0;const[n,r]=Gt(e,0,[yt.DIR,yt.DIR]),i=ro(Ee.board,n.destpt);if(Rc(i)&&Yr(i,"pushable")){const s=n.destpt.x+(r.destpt.x-r.startpt.x),o=n.destpt.y+(r.destpt.y-r.startpt.y);Fd(Ee.book,Ee.board,i,{x:s,y:o})}return 0}).command("duplicate",Ak).command("duplicatewith",(t,e)=>{const[n,r]=Gt(e,0,[yt.ANY]);return Ak(e.slice(r),n)}).command("dupe",Ak).command("dupewith",(t,e)=>{const[n,r]=Gt(e,0,[yt.ANY]);return Ak(e.slice(r),n)}).command("write",(t,e)=>{if(!ge(Ee.book)||!ge(Ee.board))return 0;const[n,r,i]=Gt(e,0,[yt.DIR,yt.COLOR]),s=e.slice(i).map(rc).join(" "),{color:o,bg:a}=hre(r),c=pb(s,256,1)?.measuredwidth??1,l=zv(256,1,o??en.WHITE,a??en.BLACK);Cr(s,l,!1);const u=c-1;switch(p0(n.startpt,n.destpt)){case pn.EAST:for(let d=0;d<c;++d)ku(Ee.board,{x:n.destpt.x+d,y:n.destpt.y,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break;case pn.WEST:for(let d=0;d<c;++d)ku(Ee.board,{x:n.destpt.x+d-u,y:n.destpt.y,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break;case pn.NORTH:for(let d=0;d<c;++d)ku(Ee.board,{x:n.destpt.x,y:n.destpt.y+d-u,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break;case pn.SOUTH:for(let d=0;d<c;++d)ku(Ee.board,{x:n.destpt.x,y:n.destpt.y+d,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break}return 0}).command("change",(t,e)=>{if(!ge(Ee.book)||!ge(Ee.board))return 0;const[n,r]=Gt(e,0,[yt.KIND,yt.KIND]);(IA(n)??"")==="empty"&&Z5e(Ee.board).forEach(c=>{nm(Ee.board,r,c)});const s=IA(r),o=FI(r),a=dre(r);return oN(Ee.board,n).forEach(c=>{if(ge(o)&&(c.color=o),ge(a)&&(c.bg=a),ed(c).name!==s){const u=Yr(c,"color"),h=Yr(c,"bg");if($d(Ee.board,c,Ee.timestamp),s!=="empty"){const d={x:c.x??0,y:c.y??0},m=nm(Ee.board,r,d);ge(m)&&(m.color=u,m.bg=h)}}}),0}).command("put",(t,e)=>YC(e)).command("putwith",(t,e)=>{const[n,r]=Gt(e,0,[yt.ANY]);return YC(e.slice(r),void 0,n)}).command("oneof",(t,e)=>{const[n,r]=Gt(e,0,[yt.ANY]);return ge(Ee.board)&&Gd(Ee.board,n)?0:YC(e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=Gt(e,0,[yt.ANY,yt.ANY]);return ge(Ee.board)&&Gd(Ee.board,r)?0:YC(e.slice(i),r,n)}).command("shoot",Ck).command("shootwith",(t,e)=>{const[n,r]=Gt(e,0,[yt.ANY]);return Ck(t,e.slice(r),n)}).command("throwstar",(t,e)=>Ck(t,[...e,"star"])).command("throwstarwith",(t,e)=>{const[n,r]=Gt(e,0,[yt.ANY]);return Ck(t,[...e.slice(r),"star"],n)}),pg=()=>new Map,H5=t=>{const e=pg();return t.forEach((n,r)=>{e.set(r,n)}),e},mb=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},CBe=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},ABe=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},Ex=()=>new Set,xL=t=>t[t.length-1],MBe=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},$1=Array.from,kBe=(t,e)=>{for(let n=0;n<t.length;n++)if(e(t[n],n,t))return!0;return!1},q5=Array.isArray;class Uae{constructor(){this._observers=pg()}on(e,n){return mb(this._observers,e,Ex).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return $1((this._observers.get(e)||pg()).values()).forEach(r=>r(...n))}destroy(){this._observers=pg()}}const Qy=Math.floor,BO=Math.abs,Bae=(t,e)=>t<e?t:e,mE=(t,e)=>t>e?t:e,Fae=t=>t!==0?t<0:1/t<0,iK=1,sK=2,TL=4,wL=8,KA=32,bv=64,Wd=128,tP=31,V5=63,M1=127,OBe=2147483647,jae=Number.MAX_SAFE_INTEGER,IBe=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Qy(t)===t),NBe=t=>t.toLowerCase(),PBe=/^\s*/g,DBe=t=>t.replace(PBe,""),LBe=/([A-Z])/g,oK=(t,e)=>DBe(t.replace(LBe,n=>`${e}${NBe(n)}`)),UBe=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},XA=typeof TextEncoder<"u"?new TextEncoder:null,BBe=t=>XA.encode(t),FBe=XA?BBe:UBe;let lA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});lA&&lA.decode(new Uint8Array).length===1&&(lA=null);class jM{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const nP=()=>new jM,jBe=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},C0=t=>{const e=new Uint8Array(jBe(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},zBe=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(mE(n,e)*2),t.cpos=0)},Wl=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},G5=Wl,Ts=(t,e)=>{for(;e>M1;)Wl(t,Wd|M1&e),e=Qy(e/128);Wl(t,M1&e)},i7=(t,e)=>{const n=Fae(e);for(n&&(e=-e),Wl(t,(e>V5?Wd:0)|(n?bv:0)|V5&e),e=Qy(e/64);e>0;)Wl(t,(e>M1?Wd:0)|M1&e),e=Qy(e/128)},$5=new Uint8Array(3e4),HBe=$5.length/3,qBe=(t,e)=>{if(e.length<HBe){const n=XA.encodeInto(e,$5).written||0;Ts(t,n);for(let r=0;r<n;r++)Wl(t,$5[r])}else Od(t,FBe(e))},VBe=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;Ts(t,r);for(let i=0;i<r;i++)Wl(t,n.codePointAt(i))},jS=XA&&XA.encodeInto?qBe:VBe,rP=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Bae(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(mE(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},Od=(t,e)=>{Ts(t,e.byteLength),rP(t,e)},s7=(t,e)=>{zBe(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},GBe=(t,e)=>s7(t,4).setFloat32(0,e,!1),$Be=(t,e)=>s7(t,8).setFloat64(0,e,!1),WBe=(t,e)=>s7(t,8).setBigInt64(0,e,!1),aK=new DataView(new ArrayBuffer(4)),KBe=t=>(aK.setFloat32(0,t),aK.getFloat32(0)===t),YA=(t,e)=>{switch(typeof e){case"string":Wl(t,119),jS(t,e);break;case"number":IBe(e)&&BO(e)<=OBe?(Wl(t,125),i7(t,e)):KBe(e)?(Wl(t,124),GBe(t,e)):(Wl(t,123),$Be(t,e));break;case"bigint":Wl(t,122),WBe(t,e);break;case"object":if(e===null)Wl(t,126);else if(q5(e)){Wl(t,117),Ts(t,e.length);for(let n=0;n<e.length;n++)YA(t,e[n])}else if(e instanceof Uint8Array)Wl(t,116),Od(t,e);else{Wl(t,118);const n=Object.keys(e);Ts(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];jS(t,i),YA(t,e[i])}}break;case"boolean":Wl(t,e?120:121);break;default:Wl(t,127)}};class cK extends jM{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Ts(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const lK=t=>{t.count>0&&(i7(t.encoder,t.count===1?t.s:-t.s),t.count>1&&Ts(t.encoder,t.count-2))};class FO{constructor(){this.encoder=new jM,this.s=0,this.count=0}write(e){this.s===e?this.count++:(lK(this),this.count=1,this.s=e)}toUint8Array(){return lK(this),C0(this.encoder)}}const uK=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);i7(t.encoder,e),t.count>1&&Ts(t.encoder,t.count-2)}};class RL{constructor(){this.encoder=new jM,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(uK(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return uK(this),C0(this.encoder)}}class XBe{constructor(){this.sarr=[],this.s="",this.lensE=new FO}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new jM;return this.sarr.push(this.s),this.s="",jS(e,this.sarr.join("")),rP(e,this.lensE.toUint8Array()),C0(e)}}const eb=t=>new Error(t),N0=()=>{throw eb("Method unimplemented")},F0=()=>{throw eb("Unexpected case")},zae=eb("Unexpected end of array"),Hae=eb("Integer out of Range");let iP=class{constructor(e){this.arr=e,this.pos=0}};const Qx=t=>new iP(t),YBe=t=>t.pos!==t.arr.length,ZBe=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Id=t=>ZBe(t,Bi(t)),Sx=t=>t.arr[t.pos++],Bi=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&M1)*n,n*=128,i<Wd)return e;if(e>jae)throw Hae}throw zae},o7=t=>{let e=t.arr[t.pos++],n=e&V5,r=64;const i=(e&bv)>0?-1:1;if((e&Wd)===0)return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&M1)*r,r*=128,e<Wd)return i*n;if(n>jae)throw Hae}throw zae},JBe=t=>{let e=Bi(t);if(e===0)return"";{let n=String.fromCodePoint(Sx(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Sx(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},QBe=t=>lA.decode(Id(t)),zS=lA?QBe:JBe,a7=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},e8e=t=>a7(t,4).getFloat32(0,!1),t8e=t=>a7(t,8).getFloat64(0,!1),n8e=t=>a7(t,8).getBigInt64(0,!1),r8e=[t=>{},t=>null,o7,e8e,t8e,n8e,t=>!1,t=>!0,zS,t=>{const e=Bi(t),n={};for(let r=0;r<e;r++){const i=zS(t);n[i]=ZA(t)}return n},t=>{const e=Bi(t),n=[];for(let r=0;r<e;r++)n.push(ZA(t));return n},Id],ZA=t=>r8e[127-Sx(t)](t);class fK extends iP{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),YBe(this)?this.count=Bi(this)+1:this.count=-1),this.count--,this.s}}class jO extends iP{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=o7(this);const e=Fae(this.s);this.count=1,e&&(this.s=-this.s,this.count=Bi(this)+2)}return this.count--,this.s}}class CL extends iP{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=o7(this),n=e&1;this.diff=Qy(e/2),this.count=1,n&&(this.count=Bi(this)+2)}return this.s+=this.diff,this.count--,this.s}}class i8e{constructor(e){this.decoder=new jO(e),this.str=zS(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const s8e=crypto.getRandomValues.bind(crypto),qae=()=>s8e(new Uint32Array(1))[0],o8e="10000000-1000-4000-8000"+-1e11,a8e=()=>o8e.replace(/[018]/g,t=>(t^qae()&15>>t/4).toString(16)),c8e=Date.now,hK=t=>new Promise(t);Promise.all.bind(Promise);const dK=t=>t===void 0?null:t;class l8e{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Vae=new l8e,u8e=!0;try{typeof localStorage<"u"&&localStorage&&(Vae=localStorage,u8e=!1)}catch{}const f8e=Vae,h8e=Object.assign,d8e=Object.keys,p8e=(t,e)=>{for(const n in t)e(t[n],n)},pK=t=>d8e(t).length,m8e=t=>{for(const e in t)return!1;return!0},g8e=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},_8e=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),v8e=(t,e)=>t===e||pK(t)===pK(e)&&g8e(t,(n,r)=>(n!==void 0||_8e(e,r))&&e[r]===n),y8e=Object.freeze,Gae=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Gae(t[e])}return y8e(t)},c7=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&c7(t,e,n+1)}},b8e=t=>t,E8e=(t,e)=>e.includes(t);var $ae={};const JA=typeof Sa<"u"&&Sa.release&&/node|io\.js/.test(Sa.release.name)&&Object.prototype.toString.call(typeof Sa<"u"?Sa:0)==="[object process]";let r0;const S8e=()=>{if(r0===void 0)if(JA){r0=pg();const t=Sa.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&r0.set(e,""),e=r):e!==null&&(r0.set(e,r),e=null)}e!==null&&r0.set(e,"")}else typeof location=="object"?(r0=pg(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");r0.set(`--${oK(e,"-")}`,n),r0.set(`-${oK(e,"-")}`,n)}})):r0=pg();return r0},W5=t=>S8e().has(t),cN=t=>dK(JA?$ae[t.toUpperCase().replaceAll("-","_")]:f8e.getItem(t)),Wae=t=>W5("--"+t)||cN(t)!==null;Wae("production");const x8e=JA&&E8e($ae.FORCE_COLOR,["true","1","2"]),T8e=x8e||!W5("--no-colors")&&!Wae("no-color")&&(!JA||Sa.stdout.isTTY)&&(!JA||W5("--color")||cN("COLORTERM")!==null||(cN("TERM")||"").includes("color")),w8e=t=>new Uint8Array(t),R8e=t=>{const e=w8e(t.byteLength);return e.set(t),e};class C8e{constructor(e,n){this.left=e,this.right=n}}const G_=(t,e)=>new C8e(t,e);typeof DOMParser<"u"&&new DOMParser;const A8e=t=>CBe(t,(e,n)=>`${n}:${e};`).join(""),Hv=Symbol,Kae=Hv(),Xae=Hv(),M8e=Hv(),k8e=Hv(),O8e=Hv(),Yae=Hv(),I8e=Hv(),l7=Hv(),N8e=Hv(),P8e=t=>{t.length===1&&t[0]?.constructor===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const i=t[r];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const i=t[r];i instanceof Symbol||n.push(i)}return n},D8e={[Kae]:G_("font-weight","bold"),[Xae]:G_("font-weight","normal"),[M8e]:G_("color","blue"),[O8e]:G_("color","green"),[k8e]:G_("color","grey"),[Yae]:G_("color","red"),[I8e]:G_("color","purple"),[l7]:G_("color","orange"),[N8e]:G_("color","black")},L8e=t=>{t.length===1&&t[0]?.constructor===Function&&(t=t[0]());const e=[],n=[],r=pg();let i=[],s=0;for(;s<t.length;s++){const o=t[s],a=D8e[o];if(a!==void 0)r.set(a.left,a.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){const c=A8e(r);s>0||c.length>0?(e.push("%c"+o),n.push(c)):e.push(o)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const o=t[s];o instanceof Symbol||i.push(o)}return i},Zae=T8e?L8e:P8e,U8e=(...t)=>{console.log(...Zae(t)),Qae.forEach(e=>e.print(t))},Jae=(...t)=>{console.warn(...Zae(t)),t.unshift(l7),Qae.forEach(e=>e.print(t))},Qae=Ex(),ece=t=>({[Symbol.iterator](){return this},next:t}),B8e=(t,e)=>ece(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),AL=(t,e)=>ece(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class u7{constructor(e,n){this.clock=e,this.len=n}}class eT{constructor(){this.clients=new Map}}const xx=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let c=0,l=r[c];c<r.length&&l.clock<a;l=r[++c])lce(t,s,l.clock,l.len,n)}}),F8e=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Qy((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},zM=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&F8e(n,e.clock)!==null},f7=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=mE(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},K5=t=>{const e=new eT;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)MBe(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return f7(e),e},QA=(t,e,n,r)=>{mb(t.clients,e,()=>[]).push(new u7(n,r))},j8e=()=>new eT,z8e=t=>{const e=j8e();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new u7(a,c))}}i.length>0&&e.clients.set(r,i)}),e},tT=(t,e)=>{Ts(t.restEncoder,e.clients.size),$1(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),Ts(t.restEncoder,n);const i=r.length;Ts(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},h7=t=>{const e=new eT,n=Bi(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Bi(t.restDecoder),s=Bi(t.restDecoder);if(s>0){const o=mb(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new u7(t.readDsClock(),t.readDsLen()))}}return e},mK=(t,e,n)=>{const r=new eT,i=Bi(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Bi(t.restDecoder),a=Bi(t.restDecoder),c=n.clients.get(o)||[],l=bl(n,o);for(let u=0;u<a;u++){const h=t.readDsClock(),d=h+t.readDsLen();if(h<l){l<d&&QA(r,o,l,d-l);let m=j0(c,h),p=c[m];for(!p.deleted&&p.id.clock<h&&(c.splice(m+1,0,gN(e,p,h-p.id.clock)),m++);m<c.length&&(p=c[m++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(m,0,gN(e,p,d-p.id.clock)),p.delete(e))}else QA(r,o,h,d-h)}}if(r.clients.size>0){const s=new W1;return Ts(s.restEncoder,0),tT(s,r),s.toUint8Array()}return null},tce=qae;class gE extends Uae{constructor({guid:e=a8e(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=tce(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new ace,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=hK(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>hK(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Ro(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set($1(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Ro(this,e,n)}get(e,n=tu){const r=mb(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==tu&&i!==n)if(i===tu){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,qS)}getText(e=""){return this.get(e,z0)}getMap(e=""){return this.get(e,wx)}getXmlElement(e=""){return this.get(e,Rx)}getXmlFragment(e=""){return this.get(e,K1)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,$1(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new gE({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Ro(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class nce{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Bi(this.restDecoder)}readDsLen(){return Bi(this.restDecoder)}}class rce extends nce{readLeftID(){return Fi(Bi(this.restDecoder),Bi(this.restDecoder))}readRightID(){return Fi(Bi(this.restDecoder),Bi(this.restDecoder))}readClient(){return Bi(this.restDecoder)}readInfo(){return Sx(this.restDecoder)}readString(){return zS(this.restDecoder)}readParentInfo(){return Bi(this.restDecoder)===1}readTypeRef(){return Bi(this.restDecoder)}readLen(){return Bi(this.restDecoder)}readAny(){return ZA(this.restDecoder)}readBuf(){return R8e(Id(this.restDecoder))}readJSON(){return JSON.parse(zS(this.restDecoder))}readKey(){return zS(this.restDecoder)}}class H8e{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Bi(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Bi(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Tx extends H8e{constructor(e){super(e),this.keys=[],Bi(e),this.keyClockDecoder=new CL(Id(e)),this.clientDecoder=new jO(Id(e)),this.leftClockDecoder=new CL(Id(e)),this.rightClockDecoder=new CL(Id(e)),this.infoDecoder=new fK(Id(e),Sx),this.stringDecoder=new i8e(Id(e)),this.parentInfoDecoder=new fK(Id(e),Sx),this.typeRefDecoder=new jO(Id(e)),this.lenDecoder=new jO(Id(e))}readLeftID(){return new HS(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new HS(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ZA(this.restDecoder)}readBuf(){return Id(this.restDecoder)}readJSON(){return ZA(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class q8e{constructor(){this.restEncoder=nP()}toUint8Array(){return C0(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Ts(this.restEncoder,e)}writeDsLen(e){Ts(this.restEncoder,e)}}class HM extends q8e{writeLeftID(e){Ts(this.restEncoder,e.client),Ts(this.restEncoder,e.clock)}writeRightID(e){Ts(this.restEncoder,e.client),Ts(this.restEncoder,e.clock)}writeClient(e){Ts(this.restEncoder,e)}writeInfo(e){G5(this.restEncoder,e)}writeString(e){jS(this.restEncoder,e)}writeParentInfo(e){Ts(this.restEncoder,e?1:0)}writeTypeRef(e){Ts(this.restEncoder,e)}writeLen(e){Ts(this.restEncoder,e)}writeAny(e){YA(this.restEncoder,e)}writeBuf(e){Od(this.restEncoder,e)}writeJSON(e){jS(this.restEncoder,JSON.stringify(e))}writeKey(e){jS(this.restEncoder,e)}}class V8e{constructor(){this.restEncoder=nP(),this.dsCurrVal=0}toUint8Array(){return C0(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,Ts(this.restEncoder,n)}writeDsLen(e){e===0&&F0(),Ts(this.restEncoder,e-1),this.dsCurrVal+=e}}class W1 extends V8e{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new RL,this.clientEncoder=new FO,this.leftClockEncoder=new RL,this.rightClockEncoder=new RL,this.infoEncoder=new cK(G5),this.stringEncoder=new XBe,this.parentInfoEncoder=new cK(G5),this.typeRefEncoder=new FO,this.lenEncoder=new FO}toUint8Array(){const e=nP();return Ts(e,0),Od(e,this.keyClockEncoder.toUint8Array()),Od(e,this.clientEncoder.toUint8Array()),Od(e,this.leftClockEncoder.toUint8Array()),Od(e,this.rightClockEncoder.toUint8Array()),Od(e,C0(this.infoEncoder)),Od(e,this.stringEncoder.toUint8Array()),Od(e,C0(this.parentInfoEncoder)),Od(e,this.typeRefEncoder.toUint8Array()),Od(e,this.lenEncoder.toUint8Array()),rP(e,C0(this.restEncoder)),C0(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){YA(this.restEncoder,e)}writeBuf(e){Od(this.restEncoder,e)}writeJSON(e){YA(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const G8e=(t,e,n,r)=>{r=mE(r,e[0].id.clock);const i=j0(e,r);Ts(t.restEncoder,e.length-i),t.writeClient(n),Ts(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},d7=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{bl(e,s)>i&&r.set(s,i)}),p7(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Ts(t.restEncoder,r.size),$1(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{G8e(t,e.clients.get(i),i,s)})},$8e=(t,e)=>{const n=pg(),r=Bi(t.restDecoder);for(let i=0;i<r;i++){const s=Bi(t.restDecoder),o=new Array(s),a=t.readClient();let c=Bi(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(tP&u){case 0:{const h=t.readLen();o[l]=new Kp(Fi(a,c),h),c+=h;break}case 10:{const h=Bi(t.restDecoder);o[l]=new Xp(Fi(a,c),h),c+=h;break}default:{const h=(u&(bv|Wd))===0,d=new ia(Fi(a,c),null,(u&Wd)===Wd?t.readLeftID():null,null,(u&bv)===bv?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(u&KA)===KA?t.readString():null,Mce(t,u));o[l]=d,c+=d.length}}}}return n},W8e=(t,e,n)=>{const r=[];let i=$1(n.keys()).sort((m,p)=>m-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let m=n.get(i[i.length-1]);for(;m.refs.length===m.i;)if(i.pop(),i.length>0)m=n.get(i[i.length-1]);else return null;return m};let o=s();if(o===null)return null;const a=new ace,c=new Map,l=(m,p)=>{const g=c.get(m);(g==null||g>p)&&c.set(m,p)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const m of r){const p=m.id.client,g=n.get(p);g?(g.i--,a.clients.set(p,g.refs.slice(g.i)),n.delete(p),g.i=0,g.refs=[]):a.clients.set(p,[m]),i=i.filter(y=>y!==p)}r.length=0};for(;;){if(u.constructor!==Xp){const p=mb(h,u.id.client,()=>bl(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const g=u.getMissing(t,e);if(g!==null){r.push(u);const y=n.get(g)||{refs:[],i:0};if(y.refs.length===y.i)l(g,bl(e,g)),d();else{u=y.refs[y.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const m=new W1;return d7(m,a,new Map),Ts(m.restEncoder,0),{missing:c,update:m.toUint8Array()}}return null},K8e=(t,e)=>d7(t,e.doc.store,e.beforeState),X8e=(t,e,n,r=new Tx(t))=>Ro(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=$8e(r,o),l=W8e(i,a,c),u=a.pendingStructs;if(u){for(const[d,m]of u.missing)if(m<bl(a,d)){s=!0;break}if(l){for(const[d,m]of l.missing){const p=u.missing.get(d);(p==null||p>m)&&u.missing.set(d,m)}u.update=uN([u.update,l.update])}}else a.pendingStructs=l;const h=mK(r,i,a);if(a.pendingDs){const d=new Tx(Qx(a.pendingDs));Bi(d.restDecoder);const m=mK(d,i,a);h&&m?a.pendingDs=uN([h,m]):a.pendingDs=h||m}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,ice(i.doc,d)}},n,!1),ice=(t,e,n,r=Tx)=>{const i=Qx(e);X8e(i,t,n,new r(i))},gK=(t,e,n)=>ice(t,e,n,rce),Y8e=(t,e,n=new Map)=>{d7(t,e.store,n),tT(t,z8e(e.store))},Z8e=(t,e=new Uint8Array([0]),n=new W1)=>{const r=sce(e);Y8e(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(hFe(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===HM)return uFe(i.map((s,o)=>o===0?s:pFe(s)));if(n.constructor===W1)return uN(i)}return i[0]},J8e=(t,e)=>Z8e(t,e,new HM),Q8e=t=>{const e=new Map,n=Bi(t.restDecoder);for(let r=0;r<n;r++){const i=Bi(t.restDecoder),s=Bi(t.restDecoder);e.set(i,s)}return e},sce=t=>Q8e(new nce(Qx(t)));class eFe{constructor(){this.l=[]}}const _K=()=>new eFe,vK=(t,e)=>t.l.push(e),yK=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},oce=(t,e,n)=>c7(t.l,[e,n]);class HS{constructor(e,n){this.client=e,this.clock=n}}const Mk=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Fi=(t,e)=>new HS(t,e),tFe=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw F0()},lN=(t,e)=>{for(;e!==null;){if(e.parent===t)return!0;e=e.parent._item}return!1},pS=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!zM(e.ds,t.id),X5=(t,e)=>{const n=mb(t.meta,X5,Ex),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<bl(r,s)&&Ph(t,Fi(s,i))}),xx(t,e.ds,i=>{}),n.add(e))};class ace{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const p7=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},bl=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},cce=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw F0()}n.push(e)},j0=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=Qy(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=Qy((n+r)/2)}throw F0()},nFe=(t,e)=>{const n=t.clients.get(e.client);return n[j0(n,e.clock)]},zO=nFe,Y5=(t,e,n)=>{const r=j0(e,n),i=e[r];return i.id.clock<n&&i instanceof ia?(e.splice(r+1,0,gN(t,i,n-i.id.clock)),r+1):r},Ph=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Y5(t,n,e.clock)]},bK=(t,e,n)=>{const r=e.clients.get(n.client),i=j0(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Kp&&r.splice(i+1,0,gN(t,s,n.clock-s.id.clock+1)),s},rFe=(t,e,n)=>{const r=t.clients.get(e.id.client);r[j0(r,e.id.clock)]=n},lce=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=Y5(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&Y5(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class iFe{constructor(e,n,r){this.doc=e,this.deleteSet=new eT,this.beforeState=p7(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const EK=(t,e)=>e.deleteSet.clients.size===0&&!ABe(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(f7(e.deleteSet),K8e(t,e),tT(t,e.deleteSet),!0),SK=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&mb(t.changed,e,Ex).add(n)},HO=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ia&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},sFe=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=j0(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof ia&&h.deleted&&!h.keep&&n(h)&&h.gc(e,!1)}}}},oFe=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Bae(i.length-1,1+j0(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+HO(i,c)}})},uce=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{f7(s),n.afterState=p7(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),oce(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),c7(a,[]),n._needFormattingCleanup&&AFe(n)}finally{r.gc&&sFe(s,i,r.gcFilter),oFe(s,i),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const m=i.clients.get(h),p=mE(j0(m,d),1);for(let g=m.length-1;g>=p;)g-=1+HO(m,g)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,m=i.clients.get(h),p=j0(m,d);p+1<m.length&&HO(m,p+1)>1||p>0&&HO(m,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(U8e(l7,Kae,"[yjs] ",Xae,Yae,"Changed the client-id because another client seems to be using it."),r.clientID=tce()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new HM;EK(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new W1;EK(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):uce(t,e+1)}}},Ro=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new iFe(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&uce(i,0)}}return o};class aFe{constructor(e,n){this.insertions=n,this.deletions=e,this.meta=new Map}}const xK=(t,e,n)=>{xx(t,n.deletions,r=>{r instanceof ia&&e.scope.some(i=>i===t.doc||lN(i,r))&&S7(r,!1)})},TK=(t,e,n)=>{let r=null;const i=t.doc,s=t.scope;Ro(i,a=>{for(;e.length>0&&t.currStackItem===null;){const c=i.store,l=e.pop(),u=new Set,h=[];let d=!1;xx(a,l.insertions,m=>{if(m instanceof ia){if(m.redone!==null){let{item:p,diff:g}=t7e(c,m.id);g>0&&(p=Ph(a,Fi(p.id.client,p.id.clock+g))),m=p}!m.deleted&&s.some(p=>p===a.doc||lN(p,m))&&h.push(m)}}),xx(a,l.deletions,m=>{m instanceof ia&&s.some(p=>p===a.doc||lN(p,m))&&!zM(l.insertions,m.id)&&u.add(m)}),u.forEach(m=>{d=Ace(a,m,u,l.insertions,t.ignoreRemoteMapChanges,t)!==null||d});for(let m=h.length-1;m>=0;m--){const p=h[m];t.deleteFilter(p)&&(p.delete(a),d=!0)}t.currStackItem=d?l:null}a.changed.forEach((c,l)=>{c.has(null)&&l._searchMarker&&(l._searchMarker.length=0)}),r=a},t);const o=t.currStackItem;if(o!=null){const a=r.changedParentTypes;t.emit("stack-item-popped",[{stackItem:o,type:n,changedParentTypes:a,origin:t},t]),t.currStackItem=null}return o};class cFe extends Uae{constructor(e,{captureTimeout:n=500,captureTransaction:r=c=>!0,deleteFilter:i=()=>!0,trackedOrigins:s=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:a=q5(e)?e[0].doc:e instanceof gE?e:e.doc}={}){super(),this.scope=[],this.doc=a,this.addToScope(e),this.deleteFilter=i,s.add(this),this.trackedOrigins=s,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=n,this.afterTransactionHandler=c=>{if(!this.captureTransaction(c)||!this.scope.some(y=>c.changedParentTypes.has(y)||y===this.doc)||!this.trackedOrigins.has(c.origin)&&(!c.origin||!this.trackedOrigins.has(c.origin.constructor)))return;const l=this.undoing,u=this.redoing,h=l?this.redoStack:this.undoStack;l?this.stopCapturing():u||this.clear(!1,!0);const d=new eT;c.afterState.forEach((y,v)=>{const x=c.beforeState.get(v)||0,E=y-x;E>0&&QA(d,v,x,E)});const m=c8e();let p=!1;if(this.lastChange>0&&m-this.lastChange<this.captureTimeout&&h.length>0&&!l&&!u){const y=h[h.length-1];y.deletions=K5([y.deletions,c.deleteSet]),y.insertions=K5([y.insertions,d])}else h.push(new aFe(c.deleteSet,d)),p=!0;!l&&!u&&(this.lastChange=m),xx(c,c.deleteSet,y=>{y instanceof ia&&this.scope.some(v=>v===c.doc||lN(v,y))&&S7(y,!0)});const g=[{stackItem:h[h.length-1],origin:c.origin,type:l?"redo":"undo",changedParentTypes:c.changedParentTypes},this];p?this.emit("stack-item-added",g):this.emit("stack-item-updated",g)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(e){const n=new Set(this.scope);e=q5(e)?e:[e],e.forEach(r=>{n.has(r)||(n.add(r),(r instanceof tu?r.doc!==this.doc:r!==this.doc)&&Jae("[yjs#509] Not same Y.Doc"),this.scope.push(r))})}addTrackedOrigin(e){this.trackedOrigins.add(e)}removeTrackedOrigin(e){this.trackedOrigins.delete(e)}clear(e=!0,n=!0){(e&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{e&&(this.undoStack.forEach(i=>xK(r,this,i)),this.undoStack=[]),n&&(this.redoStack.forEach(i=>xK(r,this,i)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:e,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let e;try{e=TK(this,this.undoStack,"undo")}finally{this.undoing=!1}return e}redo(){this.redoing=!0;let e;try{e=TK(this,this.redoStack,"redo")}finally{this.redoing=!1}return e}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*lFe(t){const e=Bi(t.restDecoder);for(let n=0;n<e;n++){const r=Bi(t.restDecoder),i=t.readClient();let s=Bi(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Bi(t.restDecoder);yield new Xp(Fi(i,s),c),s+=c}else if((tP&a)!==0){const c=(a&(bv|Wd))===0,l=new ia(Fi(i,s),null,(a&Wd)===Wd?t.readLeftID():null,null,(a&bv)===bv?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&KA)===KA?t.readString():null,Mce(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new Kp(Fi(i,s),c),s+=c}}}}class m7{constructor(e,n){this.gen=lFe(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Xp);return this.curr}}class g7{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const uFe=t=>uN(t,rce,HM),fFe=(t,e)=>{if(t.constructor===Kp){const{client:n,clock:r}=t.id;return new Kp(Fi(n,r+e),t.length-e)}else if(t.constructor===Xp){const{client:n,clock:r}=t.id;return new Xp(Fi(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new ia(Fi(r,i+e),null,Fi(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},uN=(t,e=Tx,n=W1)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(Qx(u)));let i=r.map(u=>new m7(u,!0)),s=null;const o=new n,a=new g7(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,m)=>{if(d.curr.id.client===m.curr.id.client){const p=d.curr.id.clock-m.curr.id.clock;return p===0?d.curr.constructor===m.curr.constructor?0:d.curr.constructor===Xp?1:-1:p}else return m.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let d=u.curr,m=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),m=!0;if(d===null||d.id.client!==h||m&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)ky(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===Xp)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{ky(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Xp(Fi(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===Xp?s.struct.length-=p:d=fFe(d,p)),s.struct.mergeWith(d)||(ky(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==Xp;d=u.next())ky(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(ky(a,s.struct,s.offset),s=null),_7(a);const c=r.map(u=>h7(u)),l=K5(c);return tT(o,l),o.toUint8Array()},hFe=(t,e,n=Tx,r=W1)=>{const i=sce(e),s=new r,o=new g7(s),a=new n(Qx(t)),c=new m7(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=i.get(h)||0;if(c.curr.constructor===Xp){c.next();continue}if(u.id.clock+u.length>d)for(ky(o,u,mE(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)ky(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}_7(o);const l=h7(a);return tT(s,l),s.toUint8Array()},fce=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:C0(t.encoder.restEncoder)}),t.encoder.restEncoder=nP(),t.written=0)},ky=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&fce(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),Ts(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},_7=t=>{fce(t);const e=t.encoder.restEncoder;Ts(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];Ts(e,r.written),rP(e,r.restEncoder)}},dFe=(t,e,n,r)=>{const i=new n(Qx(t)),s=new m7(i,!1),o=new r,a=new g7(o);for(let l=s.curr;l!==null;l=s.next())ky(a,e(l),0);_7(a);const c=h7(i);return tT(o,c),o.toUint8Array()},pFe=t=>dFe(t,b8e,Tx,HM),wK="You must not compute changes after the event-handler fired.";class sP{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=mFe(this.currentTarget,this.target))}deletes(e){return zM(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw eb(wK);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=xL(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=xL(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=xL(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw eb(wK);const n=this.target,r=Ex(),i=Ex(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const mFe=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},af=()=>{Jae("Invalid access: Add Yjs type to a document before reading data.")},hce=80;let v7=0;class gFe{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=v7++}}const _Fe=t=>{t.timestamp=v7++},dce=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=v7++},vFe=(t,e,n)=>{if(t.length>=hce){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return dce(r,e,n),r}else{const r=new gFe(e,n);return t.push(r),r}},oP=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>BO(e-s.index)<BO(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,_Fe(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&BO(n.index-i)<r.parent.length/hce?(dce(n,r,i),n):vFe(t._searchMarker,r,i)},eM=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=mE(e,i.index+n))}},aP=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;mb(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;oce(r._eH,n,e)};class tu{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=_K(),this._dEH=_K(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw N0()}clone(){throw N0()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){vK(this._eH,e)}observeDeep(e){vK(this._dEH,e)}unobserve(e){yK(this._eH,e)}unobserveDeep(e){yK(this._dEH,e)}toJSON(){}}const pce=(t,e,n)=>{t.doc??af(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},mce=t=>{t.doc??af();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},tM=(t,e)=>{let n=0,r=t._start;for(t.doc??af();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},gce=(t,e)=>{const n=[];return tM(t,(r,i)=>{n.push(e(r,i,t))}),n},yFe=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},_ce=(t,e)=>{t.doc??af();const n=oP(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},fN=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new ia(Fi(o,bl(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new X1(l)),i.integrate(t,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new ia(Fi(o,bl(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new qM(new Uint8Array(h))),i.integrate(t,0);break;case gE:i=new ia(Fi(o,bl(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new VM(h)),i.integrate(t,0);break;default:if(h instanceof tu)i=new ia(Fi(o,bl(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new qv(h)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},vce=()=>eb("Length exceeded!"),yce=(t,e,n,r)=>{if(n>e._length)throw vce();if(n===0)return e._searchMarker&&eM(e._searchMarker,n,r.length),fN(t,e,null,r);const i=n,s=oP(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ph(t,Fi(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&eM(e._searchMarker,i,r.length),fN(t,e,o,r)},bFe=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return fN(t,e,i,n)},bce=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=oP(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ph(t,Fi(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ph(t,Fi(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw vce();e._searchMarker&&eM(e._searchMarker,i,-s+r)},hN=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},y7=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new X1([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new X1([r]);break;case Uint8Array:a=new qM(r);break;case gE:a=new VM(r);break;default:if(r instanceof tu)a=new qv(r);else throw new Error("Unexpected content type")}new ia(Fi(o,bl(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},b7=(t,e)=>{t.doc??af();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Ece=t=>{const e={};return t.doc??af(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},Sce=(t,e)=>{t.doc??af();const n=t._map.get(e);return n!==void 0&&!n.deleted},EFe=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&pS(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},kk=t=>(t.doc??af(),B8e(t._map.entries(),e=>!e[1].deleted));class SFe extends sP{}class qS extends tu{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new qS;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new qS}clone(){const e=new qS;return e.insert(0,this.toArray().map(n=>n instanceof tu?n.clone():n)),e}get length(){return this.doc??af(),this._length}_callObserver(e,n){super._callObserver(e,n),aP(this,e,new SFe(this,e))}insert(e,n){this.doc!==null?Ro(this.doc,r=>{yce(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Ro(this.doc,n=>{bFe(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Ro(this.doc,r=>{bce(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return _ce(this,e)}toArray(){return mce(this)}slice(e=0,n=this.length){return pce(this,e,n)}toJSON(){return this.map(e=>e instanceof tu?e.toJSON():e)}map(e){return gce(this,e)}forEach(e){tM(this,e)}[Symbol.iterator](){return yFe(this)}_write(e){e.writeTypeRef(WFe)}}const xFe=t=>new qS;class TFe extends sP{constructor(e,n,r){super(e,n),this.keysChanged=r}}class wx extends tu{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new wx}clone(){const e=new wx;return this.forEach((n,r)=>{e.set(r,n instanceof tu?n.clone():n)}),e}_callObserver(e,n){aP(this,e,new TFe(this,e,n))}toJSON(){this.doc??af();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof tu?i.toJSON():i}}),e}get size(){return[...kk(this)].length}keys(){return AL(kk(this),e=>e[0])}values(){return AL(kk(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return AL(kk(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??af(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ro(this.doc,n=>{hN(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Ro(this.doc,r=>{y7(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return b7(this,e)}has(e){return Sce(this,e)}clear(){this.doc!==null?Ro(this.doc,e=>{this.forEach(function(n,r,i){hN(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(KFe)}}const wFe=t=>new wx,Dy=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&v8e(t,e);class Z5{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&F0(),this.right.content.constructor){case wl:this.right.deleted||nT(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const RK=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case wl:e.right.deleted||nT(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Ph(t,Fi(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Ok=(t,e,n,r)=>{const i=new Map,s=r?oP(e,n):null;if(s){const o=new Z5(s.p.left,s.p,s.index,i);return RK(t,o,n-s.index)}else{const o=new Z5(null,e._start,0,i);return RK(t,o,n)}},xce=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===wl&&Dy(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new ia(Fi(s,bl(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new wl(a,o));u.integrate(t,0),n.right=u,n.forward()})},nT=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Tce=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===wl&&Dy(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},wce=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Dy(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new ia(Fi(s,bl(i.store,s)),u,u&&u.lastId,h,h&&h.id,e,null,new wl(a,c)),n.right.integrate(t,0),n.forward()}}return o},ML=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,m)=>{i[m]===void 0&&(i[m]=null)});const s=t.doc,o=s.clientID;Tce(n,i);const a=wce(t,e,n,i),c=r.constructor===String?new H0(r):r instanceof tu?new qv(r):new _E(r);let{left:l,right:u,index:h}=n;e._searchMarker&&eM(e._searchMarker,n.index,c.getLength()),u=new ia(Fi(o,bl(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=h,n.forward(),xce(t,e,n,a)},CK=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;Tce(n,i);const a=wce(t,e,n,i);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===wl));){if(!n.right.deleted)switch(n.right.content.constructor){case wl:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(Dy(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Ph(t,Fi(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new ia(Fi(o,bl(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new H0(c)),n.right.integrate(t,0),n.forward()}xce(t,e,n,a)},Rce=(t,e,n,r,i)=>{let s=e;const o=pg();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===wl){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case wl:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(e.delete(t),a++,!c&&(i.get(u)??null)===h&&d!==h&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&nT(i,l);break}}}e=e.right}return a},RFe=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===wl){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},CFe=t=>{let e=0;return Ro(t.doc,n=>{let r=t._start,i=t._start,s=pg();const o=H5(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case wl:nT(o,i.content);break;default:e+=Rce(n,r,i,s,o),s=H5(o),r=i;break}i=i.right}}),e},AFe=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&lce(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===wl&&o.constructor!==Kp&&e.add(o.parent)})}Ro(n,r=>{xx(t,t.deleteSet,i=>{if(i instanceof Kp||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===wl?e.add(s):RFe(r,i)});for(const i of e)CFe(i)})},AK=(t,e,n)=>{const r=n,i=H5(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case qv:case _E:case H0:n<e.right.length&&Ph(t,Fi(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&Rce(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&eM(o._searchMarker,e.index,-r+n),e};class MFe extends sP{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Ro(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let m=null;switch(a){case"delete":h>0&&(m={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(m={insert:l},i.size>0&&(m.attributes={},i.forEach((p,g)=>{p!==null&&(m.attributes[g]=p)}))),l="";break;case"retain":u>0&&(m={retain:u},m8e(c)||(m.attributes=h8e({},c))),u=0;break}m&&n.push(m),a=null}};for(;o!==null;){switch(o.content.constructor){case qv:case _E:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case H0:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case wl:{const{key:m,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const g=i.get(m)??null;Dy(g,p)?p!==null&&o.delete(r):(a==="retain"&&d(),Dy(p,s.get(m)??null)?delete c[m]:c[m]=p)}}else if(this.deletes(o)){s.set(m,p);const g=i.get(m)??null;Dy(g,p)||(a==="retain"&&d(),c[m]=g)}else if(!o.deleted){s.set(m,p);const g=c[m];g!==void 0&&(Dy(g,p)?g!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[m]:c[m]=p))}o.deleted||(a==="insert"&&d(),nT(i,o.content));break}}o=o.right}for(d();n.length>0;){const m=n[n.length-1];if(m.retain!==void 0&&m.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class z0 extends tu{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??af(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new z0}clone(){const e=new z0;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new MFe(this,e,n);aP(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??af();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===H0&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Ro(this.doc,r=>{const i=new Z5(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ML(r,this,i,a,o.attributes||{})}else o.retain!==void 0?CK(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&AK(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??af();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;s.forEach((p,g)=>{d=!0,h[g]=p});const m={insert:a};d&&(m.attributes=h),i.push(m),a=""}}const u=()=>{for(;c!==null;){if(pS(c,e)||n!==void 0&&pS(c,n))switch(c.content.constructor){case H0:{const h=s.get("ychange");e!==void 0&&!pS(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!pS(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case qv:case _E:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((m,p)=>{d[p]=m})}i.push(h);break}case wl:pS(c,e)&&(l(),nT(s,c.content));break}c=c.right}l()};return e||n?Ro(o,h=>{e&&X5(h,e),n&&X5(h,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?Ro(i,s=>{const o=Ok(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),ML(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?Ro(i,s=>{const o=Ok(s,this,e,!r);ML(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Ro(r,i=>{AK(i,Ok(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?Ro(i,s=>{const o=Ok(s,this,e,!1);o.right!==null&&CK(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Ro(this.doc,n=>{hN(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Ro(this.doc,r=>{y7(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return b7(this,e)}getAttributes(){return Ece(this)}_write(e){e.writeTypeRef(XFe)}}const kFe=t=>new z0;class kL{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??af()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===Rx||n.constructor===K1)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class K1 extends tu{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new K1}clone(){const e=new K1;return e.insert(0,this.toArray().map(n=>n instanceof tu?n.clone():n)),e}get length(){return this.doc??af(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new kL(this,e)}querySelector(e){e=e.toUpperCase();const r=new kL(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),$1(new kL(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){aP(this,e,new NFe(this,n,e))}toString(){return gce(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),tM(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?Ro(this.doc,r=>{yce(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Ro(this.doc,r=>{const i=e&&e instanceof tu?e._item:e;fN(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw eb("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?Ro(this.doc,r=>{bce(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return mce(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return _ce(this,e)}slice(e=0,n=this.length){return pce(this,e,n)}forEach(e){tM(this,e)}_write(e){e.writeTypeRef(ZFe)}}const OFe=t=>new K1;class Rx extends K1{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Rx(this.nodeName)}clone(){const e=new Rx(this.nodeName),n=this.getAttributes();return p8e(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof tu?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ro(this.doc,n=>{hN(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Ro(this.doc,r=>{y7(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return b7(this,e)}hasAttribute(e){return Sce(this,e)}getAttributes(e){return e?EFe(this,e):Ece(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return tM(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(YFe),e.writeKey(this.nodeName)}}const IFe=t=>new Rx(t.readKey());class NFe extends sP{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class dN extends wx{constructor(e){super(),this.hookName=e}_copy(){return new dN(this.hookName)}clone(){const e=new dN(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(JFe),e.writeKey(this.hookName)}}const PFe=t=>new dN(t.readKey());class pN extends z0{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new pN}clone(){const e=new pN;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(QFe)}}const DFe=t=>new pN;class E7{constructor(e,n){this.id=e,this.length=n}get deleted(){throw N0()}mergeWith(e){return!1}write(e,n,r){throw N0()}integrate(e,n){throw N0()}}const LFe=0;class Kp extends E7{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),cce(e.doc.store,this)}write(e,n){e.writeInfo(LFe),e.writeLen(this.length-n)}getMissing(e,n){return null}}class qM{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new qM(this.content)}splice(e){throw N0()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const UFe=t=>new qM(t.readBuf());class nM{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new nM(this.len)}splice(e){const n=new nM(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){QA(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const BFe=t=>new nM(t.readLen()),Cce=(t,e)=>new gE({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class VM{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new VM(Cce(this.doc.guid,this.opts))}splice(e){throw N0()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const FFe=t=>new VM(Cce(t.readString(),t.readAny()));class _E{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new _E(this.embed)}splice(e){throw N0()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const jFe=t=>new _E(t.readJSON());class wl{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new wl(this.key,this.value)}splice(e){throw N0()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const zFe=t=>new wl(t.readKey(),t.readJSON());class mN{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new mN(this.arr)}splice(e){const n=new mN(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const HFe=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new mN(n)},qFe=cN("node_env")==="development";class X1{constructor(e){this.arr=e,qFe&&Gae(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new X1(this.arr)}splice(e){const n=new X1(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const VFe=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new X1(n)};class H0{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new H0(this.str)}splice(e){const n=new H0(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const GFe=t=>new H0(t.readString()),$Fe=[xFe,wFe,kFe,IFe,OFe,PFe,DFe],WFe=0,KFe=1,XFe=2,YFe=3,ZFe=4,JFe=5,QFe=6;class qv{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new qv(this.type._copy())}splice(e){throw N0()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const e7e=t=>new qv($Fe[t.readTypeRef()](t)),t7e=(t,e)=>{let n=e,r=0,i;do r>0&&(n=Fi(n.client,n.clock+r)),i=zO(t,n),r=n.clock-i.id.clock,n=i.redone;while(n!==null&&i instanceof ia);return{item:i,diff:r}},S7=(t,e)=>{for(;t!==null&&t.keep!==e;)t.keep=e,t=t.parent._item},gN=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new ia(Fi(r,i+n),e,Fi(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Fi(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s},MK=(t,e)=>kBe(t,n=>zM(n.deletions,e)),Ace=(t,e,n,r,i,s)=>{const o=t.doc,a=o.store,c=o.clientID,l=e.redone;if(l!==null)return Ph(t,l);let u=e.parent._item,h=null,d;if(u!==null&&u.deleted===!0){if(u.redone===null&&(!n.has(u)||Ace(t,u,n,r,i,s)===null))return null;for(;u.redone!==null;)u=Ph(t,u.redone)}const m=u===null?e.parent:u.content.type;if(e.parentSub===null){for(h=e.left,d=e;h!==null;){let v=h;for(;v!==null&&v.parent._item!==u;)v=v.redone===null?null:Ph(t,v.redone);if(v!==null&&v.parent._item===u){h=v;break}h=h.left}for(;d!==null;){let v=d;for(;v!==null&&v.parent._item!==u;)v=v.redone===null?null:Ph(t,v.redone);if(v!==null&&v.parent._item===u){d=v;break}d=d.right}}else if(d=null,e.right&&!i){for(h=e;h!==null&&h.right!==null&&(h.right.redone||zM(r,h.right.id)||MK(s.undoStack,h.right.id)||MK(s.redoStack,h.right.id));)for(h=h.right;h.redone;)h=Ph(t,h.redone);if(h&&h.right!==null)return null}else h=m._map.get(e.parentSub)||null;const p=bl(a,c),g=Fi(c,p),y=new ia(g,h,h&&h.lastId,d,d&&d.id,m,e.parentSub,e.content.copy());return e.redone=g,S7(y,!0),y.integrate(t,0),y};class ia extends E7{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?sK:0}set marker(e){(this.info&wL)>0!==e&&(this.info^=wL)}get marker(){return(this.info&wL)>0}get keep(){return(this.info&iK)>0}set keep(e){this.keep!==e&&(this.info^=iK)}get countable(){return(this.info&sK)>0}get deleted(){return(this.info&TL)>0}set deleted(e){this.deleted!==e&&(this.info^=TL)}markDeleted(){this.info|=TL}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=bl(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=bl(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===HS&&this.id.client!==this.parent.client&&this.parent.clock>=bl(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=bK(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ph(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Kp||this.right&&this.right.constructor===Kp)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ia?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ia&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===HS){const r=zO(n,this.parent);r.constructor===Kp?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=bK(e,e.doc.store,Fi(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Mk(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Mk(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(zO(e.doc.store,i.origin)))s.has(zO(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),cce(e.doc.store,this),this.content.integrate(e,this),SK(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Kp(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Fi(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Mk(e.origin,this.lastId)&&this.right===e&&Mk(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),QA(e.deleteSet,this.id.client,this.id.clock,this.length),SK(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw F0();this.content.gc(e),n?rFe(e,this,new Kp(this.id,this.length)):this.content=new nM(this.length)}write(e,n){const r=n>0?Fi(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&tP|(r===null?0:Wd)|(i===null?0:bv)|(s===null?0:KA);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=tFe(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===HS?(e.writeParentInfo(!1),e.writeLeftID(a)):F0();s!==null&&e.writeString(s)}this.content.write(e,n)}}const Mce=(t,e)=>n7e[e&tP](t),n7e=[()=>{F0()},BFe,HFe,UFe,GFe,jFe,zFe,e7e,VFe,FFe,()=>{F0()}],r7e=10;class Xp extends E7{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){F0()}write(e,n){e.writeInfo(r7e),Ts(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const kce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof mv<"u"?mv:{},Oce="__ $YJS$ __";kce[Oce]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");kce[Oce]=!0;let kK=!1;const Dh=new gE;function Ice(t){const e=Dh.getMap(),[,n]=et.useState(0);if(et.useEffect(()=>{function r(){n(i=>1-i)}return e.observe(r),()=>{e.unobserve(r)}},[e,n]),e.has(t))return e.get(t)}function GM(t){const e=Ice(t);if(an(e))return e}function Nce(t){const e=Ice(t);if(!(!ge(e)||!(e instanceof z0)))return e}function Pce(t,e,n){const r=Dh.getMap();if(!r.has(t))switch(e){case 0:case 1:r.set(t,n);break}}function i7e(t,e){Pce(t,0,e)}function Dce(t,e){const n=new z0(e);Pce(t,1,n)}function Hf(t,e){Dh.getMap().set(t,e)}function s7e(t,e){const n=Dh.getMap(),r=new z0(e);n.set(t,r)}function Lce(t,e){const n=Dh.getMap();function r(i){const s=n.get(t);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&e(s)}return n.has(t)&&e(n.get(t)),n.observeDeep(r),()=>{n.observeDeep(r)}}function o7e(t,e){return Lce(t,n=>{an(n)&&e(n)})}function a7e(t,e){return Lce(t,n=>{n instanceof z0&&e(n.toJSON())})}const s1=lb("modem",["second"],t=>{if(s1.session(t))switch(t.target){case"second":!kK&&t.data%2===0&&s1.emit(t.player,"modem:join");break;case"join":t.sender!==s1.id()&&s1.reply(t,"joinack",mre(J8e(Dh)));break;case"joinack":t.sender!==s1.id()&&(kK=!0,gK(Dh,Hd(t.data),Dh));break;case"sync":{t.sender!==s1.id()&&ge(t.data)&&gK(Dh,Hd(t.data),Dh);break}}});function Uce(t,e){e!==Dh&&s1.emit("","modem:sync",mre(t))}Dh.on("update",Uce);Dh.on("destroy",()=>{Dh.off("update",Uce)});const c7e=`desc;$DKGRAYname and type of codepage
`,l7e=Object.freeze(Object.defineProperty({__proto__:null,default:c7e},Symbol.toStringTag,{value:"Module"})),u7e="desc;changes object into specified element",f7e=Object.freeze(Object.defineProperty({__proto__:null,default:u7e},Symbol.toStringTag,{value:"Module"})),h7e="desc;like #play but for sound effects",d7e=Object.freeze(Object.defineProperty({__proto__:null,default:h7e},Symbol.toStringTag,{value:"Module"})),p7e="",m7e=Object.freeze(Object.defineProperty({__proto__:null,default:p7e},Symbol.toStringTag,{value:"Module"})),g7e="",_7e=Object.freeze(Object.defineProperty({__proto__:null,default:g7e},Symbol.toStringTag,{value:"Module"})),v7e="",y7e=Object.freeze(Object.defineProperty({__proto__:null,default:v7e},Symbol.toStringTag,{value:"Module"})),b7e="",E7e=Object.freeze(Object.defineProperty({__proto__:null,default:b7e},Symbol.toStringTag,{value:"Module"})),S7e="",x7e=Object.freeze(Object.defineProperty({__proto__:null,default:S7e},Symbol.toStringTag,{value:"Module"})),T7e="",w7e=Object.freeze(Object.defineProperty({__proto__:null,default:T7e},Symbol.toStringTag,{value:"Module"})),R7e="",C7e=Object.freeze(Object.defineProperty({__proto__:null,default:R7e},Symbol.toStringTag,{value:"Module"})),A7e="",M7e=Object.freeze(Object.defineProperty({__proto__:null,default:A7e},Symbol.toStringTag,{value:"Module"})),k7e="",O7e=Object.freeze(Object.defineProperty({__proto__:null,default:k7e},Symbol.toStringTag,{value:"Module"})),I7e="",N7e=Object.freeze(Object.defineProperty({__proto__:null,default:I7e},Symbol.toStringTag,{value:"Module"})),P7e="",D7e=Object.freeze(Object.defineProperty({__proto__:null,default:P7e},Symbol.toStringTag,{value:"Module"})),L7e="",U7e=Object.freeze(Object.defineProperty({__proto__:null,default:L7e},Symbol.toStringTag,{value:"Module"})),B7e="",F7e=Object.freeze(Object.defineProperty({__proto__:null,default:B7e},Symbol.toStringTag,{value:"Module"})),j7e="",z7e=Object.freeze(Object.defineProperty({__proto__:null,default:j7e},Symbol.toStringTag,{value:"Module"})),H7e="",q7e=Object.freeze(Object.defineProperty({__proto__:null,default:H7e},Symbol.toStringTag,{value:"Module"})),V7e=`desc;$DKGRAYstarts a section of an if-do-done block
`,G7e=Object.freeze(Object.defineProperty({__proto__:null,default:V7e},Symbol.toStringTag,{value:"Module"})),$7e=`desc;$DKGRAYcompletes an if-do-done block
`,W7e=Object.freeze(Object.defineProperty({__proto__:null,default:$7e},Symbol.toStringTag,{value:"Module"})),K7e="",X7e=Object.freeze(Object.defineProperty({__proto__:null,default:K7e},Symbol.toStringTag,{value:"Module"})),Y7e="",Z7e=Object.freeze(Object.defineProperty({__proto__:null,default:Y7e},Symbol.toStringTag,{value:"Module"})),J7e="",Q7e=Object.freeze(Object.defineProperty({__proto__:null,default:J7e},Symbol.toStringTag,{value:"Module"})),e9e=`desc;$DKGRAYelse logic in an if-do-done block
`,t9e=Object.freeze(Object.defineProperty({__proto__:null,default:e9e},Symbol.toStringTag,{value:"Module"})),n9e=`desc;$DKGRAYconditional else logic in an if-do-done block
`,r9e=Object.freeze(Object.defineProperty({__proto__:null,default:n9e},Symbol.toStringTag,{value:"Module"})),i9e="",s9e=Object.freeze(Object.defineProperty({__proto__:null,default:i9e},Symbol.toStringTag,{value:"Module"})),o9e="",a9e=Object.freeze(Object.defineProperty({__proto__:null,default:o9e},Symbol.toStringTag,{value:"Module"})),c9e="",l9e=Object.freeze(Object.defineProperty({__proto__:null,default:c9e},Symbol.toStringTag,{value:"Module"})),u9e="",f9e=Object.freeze(Object.defineProperty({__proto__:null,default:u9e},Symbol.toStringTag,{value:"Module"})),h9e="",d9e=Object.freeze(Object.defineProperty({__proto__:null,default:h9e},Symbol.toStringTag,{value:"Module"})),p9e="",m9e=Object.freeze(Object.defineProperty({__proto__:null,default:p9e},Symbol.toStringTag,{value:"Module"})),g9e="",_9e=Object.freeze(Object.defineProperty({__proto__:null,default:g9e},Symbol.toStringTag,{value:"Module"})),v9e="",y9e=Object.freeze(Object.defineProperty({__proto__:null,default:v9e},Symbol.toStringTag,{value:"Module"})),b9e=`desc;$DKGRAYhalt until the next cycle
`,E9e=Object.freeze(Object.defineProperty({__proto__:null,default:b9e},Symbol.toStringTag,{value:"Module"})),S9e=`desc;$DKGRAYevals condition for true or false
`,x9e=Object.freeze(Object.defineProperty({__proto__:null,default:S9e},Symbol.toStringTag,{value:"Module"})),T9e="",w9e=Object.freeze(Object.defineProperty({__proto__:null,default:T9e},Symbol.toStringTag,{value:"Module"})),R9e="",C9e=Object.freeze(Object.defineProperty({__proto__:null,default:R9e},Symbol.toStringTag,{value:"Module"})),A9e="",M9e=Object.freeze(Object.defineProperty({__proto__:null,default:A9e},Symbol.toStringTag,{value:"Module"})),k9e="",O9e=Object.freeze(Object.defineProperty({__proto__:null,default:k9e},Symbol.toStringTag,{value:"Module"})),I9e="",N9e=Object.freeze(Object.defineProperty({__proto__:null,default:I9e},Symbol.toStringTag,{value:"Module"})),P9e="",D9e=Object.freeze(Object.defineProperty({__proto__:null,default:P9e},Symbol.toStringTag,{value:"Module"})),L9e="",U9e=Object.freeze(Object.defineProperty({__proto__:null,default:L9e},Symbol.toStringTag,{value:"Module"})),B9e="",F9e=Object.freeze(Object.defineProperty({__proto__:null,default:B9e},Symbol.toStringTag,{value:"Module"})),j9e="",z9e=Object.freeze(Object.defineProperty({__proto__:null,default:j9e},Symbol.toStringTag,{value:"Module"})),H9e="",q9e=Object.freeze(Object.defineProperty({__proto__:null,default:H9e},Symbol.toStringTag,{value:"Module"})),V9e="",G9e=Object.freeze(Object.defineProperty({__proto__:null,default:V9e},Symbol.toStringTag,{value:"Module"})),$9e="",W9e=Object.freeze(Object.defineProperty({__proto__:null,default:$9e},Symbol.toStringTag,{value:"Module"})),K9e="",X9e=Object.freeze(Object.defineProperty({__proto__:null,default:K9e},Symbol.toStringTag,{value:"Module"})),Y9e="",Z9e=Object.freeze(Object.defineProperty({__proto__:null,default:Y9e},Symbol.toStringTag,{value:"Module"})),J9e="",Q9e=Object.freeze(Object.defineProperty({__proto__:null,default:J9e},Symbol.toStringTag,{value:"Module"})),eje="",tje=Object.freeze(Object.defineProperty({__proto__:null,default:eje},Symbol.toStringTag,{value:"Module"})),nje="",rje=Object.freeze(Object.defineProperty({__proto__:null,default:nje},Symbol.toStringTag,{value:"Module"})),ije="",sje=Object.freeze(Object.defineProperty({__proto__:null,default:ije},Symbol.toStringTag,{value:"Module"})),oje="",aje=Object.freeze(Object.defineProperty({__proto__:null,default:oje},Symbol.toStringTag,{value:"Module"})),cje="",lje=Object.freeze(Object.defineProperty({__proto__:null,default:cje},Symbol.toStringTag,{value:"Module"})),uje="",fje=Object.freeze(Object.defineProperty({__proto__:null,default:uje},Symbol.toStringTag,{value:"Module"})),hje=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,dje=Object.freeze(Object.defineProperty({__proto__:null,default:hje},Symbol.toStringTag,{value:"Module"})),pje="",mje=Object.freeze(Object.defineProperty({__proto__:null,default:pje},Symbol.toStringTag,{value:"Module"})),gje="",_je=Object.freeze(Object.defineProperty({__proto__:null,default:gje},Symbol.toStringTag,{value:"Module"})),vje="",yje=Object.freeze(Object.defineProperty({__proto__:null,default:vje},Symbol.toStringTag,{value:"Module"})),bje="",Eje=Object.freeze(Object.defineProperty({__proto__:null,default:bje},Symbol.toStringTag,{value:"Module"})),Sje="",xje=Object.freeze(Object.defineProperty({__proto__:null,default:Sje},Symbol.toStringTag,{value:"Module"})),Tje="",wje=Object.freeze(Object.defineProperty({__proto__:null,default:Tje},Symbol.toStringTag,{value:"Module"})),Rje="",Cje=Object.freeze(Object.defineProperty({__proto__:null,default:Rje},Symbol.toStringTag,{value:"Module"})),Aje="",Mje=Object.freeze(Object.defineProperty({__proto__:null,default:Aje},Symbol.toStringTag,{value:"Module"})),kje="",Oje=Object.freeze(Object.defineProperty({__proto__:null,default:kje},Symbol.toStringTag,{value:"Module"})),Ije="",Nje=Object.freeze(Object.defineProperty({__proto__:null,default:Ije},Symbol.toStringTag,{value:"Module"})),Pje="",Dje=Object.freeze(Object.defineProperty({__proto__:null,default:Pje},Symbol.toStringTag,{value:"Module"})),Lje="",Uje=Object.freeze(Object.defineProperty({__proto__:null,default:Lje},Symbol.toStringTag,{value:"Module"})),Bje="",Fje=Object.freeze(Object.defineProperty({__proto__:null,default:Bje},Symbol.toStringTag,{value:"Module"})),jje="",zje=Object.freeze(Object.defineProperty({__proto__:null,default:jje},Symbol.toStringTag,{value:"Module"})),Hje="",qje=Object.freeze(Object.defineProperty({__proto__:null,default:Hje},Symbol.toStringTag,{value:"Module"})),Vje="",Gje=Object.freeze(Object.defineProperty({__proto__:null,default:Vje},Symbol.toStringTag,{value:"Module"})),$je="",Wje=Object.freeze(Object.defineProperty({__proto__:null,default:$je},Symbol.toStringTag,{value:"Module"})),Kje="",Xje=Object.freeze(Object.defineProperty({__proto__:null,default:Kje},Symbol.toStringTag,{value:"Module"})),Yje="",Zje=Object.freeze(Object.defineProperty({__proto__:null,default:Yje},Symbol.toStringTag,{value:"Module"})),Jje=`desc;$DKGRAYdesignates an inactive label or comment
`,Qje=Object.freeze(Object.defineProperty({__proto__:null,default:Jje},Symbol.toStringTag,{value:"Module"})),eze=`desc;$DKGRAYadds hyperlink text

`,tze=Object.freeze(Object.defineProperty({__proto__:null,default:eze},Symbol.toStringTag,{value:"Module"})),nze=`desc;$DKGRAYsends the given message when hotkey is pressed

`,rze=Object.freeze(Object.defineProperty({__proto__:null,default:nze},Symbol.toStringTag,{value:"Module"})),ize=`desc;$DKGRAYread number input into given stat/flag
`,sze=Object.freeze(Object.defineProperty({__proto__:null,default:ize},Symbol.toStringTag,{value:"Module"})),oze=`desc;$DKGRAYa slider input from 1 to 9 

`,aze=Object.freeze(Object.defineProperty({__proto__:null,default:oze},Symbol.toStringTag,{value:"Module"})),cze=`desc;$DKGRAYlist with label value pairs to pick from
`,lze=Object.freeze(Object.defineProperty({__proto__:null,default:cze},Symbol.toStringTag,{value:"Module"})),uze=`desc;$DKGRAYread text input into given stat/flag
`,fze=Object.freeze(Object.defineProperty({__proto__:null,default:uze},Symbol.toStringTag,{value:"Module"})),hze=`desc;$DKGRAYdesignates a starting point for running code
`,dze=Object.freeze(Object.defineProperty({__proto__:null,default:hze},Symbol.toStringTag,{value:"Module"})),pze=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,mze=Object.freeze(Object.defineProperty({__proto__:null,default:pze},Symbol.toStringTag,{value:"Module"})),gze=`desc;$DKGRAYwill move the object in the given direction
`,_ze=Object.freeze(Object.defineProperty({__proto__:null,default:gze},Symbol.toStringTag,{value:"Module"})),vze=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,yze=Object.freeze(Object.defineProperty({__proto__:null,default:vze},Symbol.toStringTag,{value:"Module"})),bze=`desc;$DKGRAYcustom 8x14 charset
`,Eze=Object.freeze(Object.defineProperty({__proto__:null,default:bze},Symbol.toStringTag,{value:"Module"})),Sze=`desc;$DKGRAYsets stat to given value

`,xze=Object.freeze(Object.defineProperty({__proto__:null,default:Sze},Symbol.toStringTag,{value:"Module"})),Tze=`desc;$DKGRAYsends the given message when hotkey is pressed

`,wze=Object.freeze(Object.defineProperty({__proto__:null,default:Tze},Symbol.toStringTag,{value:"Module"})),Rze=`desc;$DKGRAYread external content and/or handle events
`,Cze=Object.freeze(Object.defineProperty({__proto__:null,default:Rze},Symbol.toStringTag,{value:"Module"})),Aze=`desc;$DKGRAYread number input into given stat/flag
`,Mze=Object.freeze(Object.defineProperty({__proto__:null,default:Aze},Symbol.toStringTag,{value:"Module"})),kze=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,Oze=Object.freeze(Object.defineProperty({__proto__:null,default:kze},Symbol.toStringTag,{value:"Module"})),Ize=`desc;$DKGRAYcustom palette colors
`,Nze=Object.freeze(Object.defineProperty({__proto__:null,default:Ize},Symbol.toStringTag,{value:"Module"})),Pze=`desc;$DKGRAYa slider input from 1 to 9 

`,Dze=Object.freeze(Object.defineProperty({__proto__:null,default:Pze},Symbol.toStringTag,{value:"Module"})),Lze=`desc;$DKGRAYlist with label value pairs to pick from
`,Uze=Object.freeze(Object.defineProperty({__proto__:null,default:Lze},Symbol.toStringTag,{value:"Module"})),Bze=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,Fze=Object.freeze(Object.defineProperty({__proto__:null,default:Bze},Symbol.toStringTag,{value:"Module"})),jze=`desc;$DKGRAYread text input into given stat/flag
`,zze=Object.freeze(Object.defineProperty({__proto__:null,default:jze},Symbol.toStringTag,{value:"Module"})),Hze=`desc;$DKGRAYadds text
`,qze=Object.freeze(Object.defineProperty({__proto__:null,default:Hze},Symbol.toStringTag,{value:"Module"})),Vze=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,Gze=Object.freeze(Object.defineProperty({__proto__:null,default:Vze},Symbol.toStringTag,{value:"Module"})),$ze=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,Wze=Object.freeze(Object.defineProperty({__proto__:null,default:$ze},Symbol.toStringTag,{value:"Module"})),Kze=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,Xze=Object.freeze(Object.defineProperty({__proto__:null,default:Kze},Symbol.toStringTag,{value:"Module"})),Yze=`$white no pages found
$white use @ to create a page
$white @board name of board
$white @object name of object
$white @terrain name of terrain
$white You can omit the type and it will default to object
$white @object name of object
$white @name of object`,Zze=Object.freeze(Object.defineProperty({__proto__:null,default:Yze},Symbol.toStringTag,{value:"Module"})),Jze=`header;player settings
#set user "name goes here"
`,Qze=Object.freeze(Object.defineProperty({__proto__:null,default:Jze},Symbol.toStringTag,{value:"Module"})),eHe=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,tHe=Object.freeze(Object.defineProperty({__proto__:null,default:eHe},Symbol.toStringTag,{value:"Module"})),nHe=`section;#autowah on
#autowah <number>
$white 0-100, 0 is off, 100 is full volume
#autowah basefrequency <frequency>
$white The frequency the filter is set to at the
$white low point of the wah.
#autowah octaves <number>
$white The number of octaves above the baseFrequency 
$white the filter will sweep to when fully open.
#autowah sensitivity <number>
$white The decibel threshold sensitivity for 
$white the incoming signal.
$white Normal range of -40 to 0.
#autowah gain <number>
$white Controls the loudness of the effect.
#autowah follower <seconds>
$white Sets the smoothing time for the effect.`,rHe=Object.freeze(Object.defineProperty({__proto__:null,default:nHe},Symbol.toStringTag,{value:"Module"})),iHe=`section;#distort on
#distort <number>
$white 0-100, 0 is off, 100 is full volume
#distort distortion <number>
$white 0 or higher, controls strength of effect.
#distort oversample <2x|4x|none>
$white oversample improves quality.`,sHe=Object.freeze(Object.defineProperty({__proto__:null,default:iHe},Symbol.toStringTag,{value:"Module"})),oHe=`section;#echo on
#echo <number>
$white 0-100, 0 is off, 100 is full volume
#echo delaytime <seconds>
$white duration between echos.
#echo feedback <number>
$white A number that is between [0, 1]
$white 1 is forever feedback and 0 is none.`,aHe=Object.freeze(Object.defineProperty({__proto__:null,default:oHe},Symbol.toStringTag,{value:"Module"})),cHe=`!fcrushscroll hk f F next;#fcrush on
!echoscroll hk e E next;#echo on
!reverbscroll hk r R next;#reverb on
!phaserscroll hk p P next;#phaser on
!distortscroll hk d D next;#distort on
!vibratoscroll hk v V next;#vibrato on
!autowahscroll hk a A next;#autowah on`,lHe=Object.freeze(Object.defineProperty({__proto__:null,default:cHe},Symbol.toStringTag,{value:"Module"})),uHe=`section;#fcrush on
#fcrush <number>
$white 0-100, 0 is off, 100 is full volume
#fcrush rate <number>
$white 1 or higher, more rate, more crush`,fHe=Object.freeze(Object.defineProperty({__proto__:null,default:uHe},Symbol.toStringTag,{value:"Module"})),hHe=`section;helper scrolls
!termscroll hk t T next;terminal commands
!dictionary hk d D next;dictionary of commands
!charscroll hk a A next;char
!colorscroll hk c C next;color
!bgscroll hk b B next;bg
!notesscroll hk n N next;notes
!synthscroll hk s S next;synth
!effectsscroll hk e E next;effects
!voicescroll hk v V next;tts voices
`,dHe=Object.freeze(Object.defineProperty({__proto__:null,default:hHe},Symbol.toStringTag,{value:"Module"})),pHe=`"duration             cdefgab = notes 
"y = 64th note        x = rest
"t = 32nd note        
"s = 16th note        drums
"i = eight note       0 = hihat
"q = quarter note     1 = open hihat
"h = half note        2 = cowbell
"w = whole note       p = clap
"mods                 4 = high snare
"3 = triplet          5 = high woodblock
". = time and a half  6 = low snare
"# = sharp            7 = low tom
"! = flat             8 = low woodblock
"+ = increase octave  9 = bass drum
"- = decrease octave`,mHe=Object.freeze(Object.defineProperty({__proto__:null,default:pHe},Symbol.toStringTag,{value:"Module"})),gHe=`section;sine, square, triangle, sawtooth
#synth phase <degrees>
$white The phase is the starting position within 
$white the oscillator's cycle. For example a phase 
$white of 180 would start halfway through the
$white oscillator's cycle.
section;amsine, amsquare, amtriangle, amsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
section;fmsine, fmsquare, fmtriangle, fmsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
#synth modindex <degrees>
$white The modulation index which is in essence
$white the depth or amount of the modulation.
$white In other terms it is the ratio of the 
$white frequency of the modulating signal (mf) 
$white to the amplitude of the modulating signal 
$white (ma) -- as in ma/mf
section;fatsine, fatsquare, fattriangle, fatsawtooth
#synth phase <degrees>
#synth count <number>
$white This sets the number of oscillators to 
$white spread along the given range.
#synth spread <cents>
$white This signals the number of cents between
$white oscillators.`,_He=Object.freeze(Object.defineProperty({__proto__:null,default:gHe},Symbol.toStringTag,{value:"Module"})),vHe=`section;#phaser on
#phaser <number>
$white 0-100, 0 is off, 100 is full volume
#phaser frequency <frequency>
$white The rate of oscilation of the effect.
#phaser octaves <number>
$white Controls the range of the effect.
#phaser basefrequency <frequency>
$white The base frequency of the filters.
`,yHe=Object.freeze(Object.defineProperty({__proto__:null,default:vHe},Symbol.toStringTag,{value:"Module"})),bHe=`section;pulse
#synth width <range>
$white A number that is between [-1, 1] altering
$white this value changes the shape of the square
$white wave`,EHe=Object.freeze(Object.defineProperty({__proto__:null,default:bHe},Symbol.toStringTag,{value:"Module"})),SHe=`section;pwm
#synth modfreq <frequency>
$white This sets the frequency of change for the 
$white pulse width of this oscillator.`,xHe=Object.freeze(Object.defineProperty({__proto__:null,default:SHe},Symbol.toStringTag,{value:"Module"})),THe=`section;#reverb on
#reverb <number>
$white 0-100, 0 is off, 100 is full volume
#reverb predelay <seconds>
$white The amount of time before the reverb
$white is fully ramped in.
#reverb decay <seconds>
$white The duration of the reverb.
`,wHe=Object.freeze(Object.defineProperty({__proto__:null,default:THe},Symbol.toStringTag,{value:"Module"})),RHe=`switching voices
#synth <sine, square, triangle, sawtooth> 
#synth <pwm, pulse, bells, doot>
#synth <retro, buzz, clang, metallic>

voice settings
#synth restart - resets voice to default
#synth vol <db> - control volume
#synth port <seconds>
#synth env <attack> <delay> <sustain> <release>

voice specific 
!oscscroll hk o O next;sine, square, triangle, sawtooth
!pwmscroll hk m M next;pwm
!pulsescroll hk p P next;pulse`,CHe=Object.freeze(Object.defineProperty({__proto__:null,default:RHe},Symbol.toStringTag,{value:"Module"})),AHe=`press$white C$yellow to chat
press$white #$yellow to run a quick command
section;dev-tools
#gadget
$white toggles inspector tool on/off
#zztrandom
$white downloads random from the museumofzzt api
#zztsearch <field> <value>
$white searches the museumofzzt api for zzt games
section;multi-player
#set user <name>
$white sets your display name when talking to others
#joincode OR ctrl+O 
$white starts a multi-player session showing a
$white QR code. It also provides are sharable link
$white you can give to other to join the game.`,MHe=Object.freeze(Object.defineProperty({__proto__:null,default:AHe},Symbol.toStringTag,{value:"Module"})),kHe=`section;#vibrato on
#vibrato <number>
$white 0-100, 0 is off, 100 is full volume
#vibrato maxdelay <seconds>
$white longer delay increases the vibrato`,OHe=Object.freeze(Object.defineProperty({__proto__:null,default:kHe},Symbol.toStringTag,{value:"Module"})),IHe=`!copyit "ar-SA-HamedNeural";ar-SA-HamedNeural
!copyit "ar-SA-ZariyahNeural";ar-SA-ZariyahNeural
!copyit "de-DE-AmalaNeural";de-DE-AmalaNeural
!copyit "de-DE-ConradNeural";de-DE-ConradNeural
!copyit "de-DE-KatjaNeural";de-DE-KatjaNeural
!copyit "de-DE-KillianNeural";de-DE-KillianNeural
!copyit "en-US-AnaNeural";en-US-AnaNeural
!copyit "en-US-AndrewNeural";en-US-AndrewNeural
!copyit "en-US-AriaNeural";en-US-AriaNeural
!copyit "en-US-ChristopherNeural";en-US-ChristopherNeural
!copyit "en-US-EricNeural";en-US-EricNeural
!copyit "en-US-GuyNeural";en-US-GuyNeural
!copyit "en-US-JennyNeural";en-US-JennyNeural
!copyit "en-US-MichelleNeural";en-US-MichelleNeural
!copyit "en-US-RogerNeural";en-US-RogerNeural
!copyit "en-US-SteffanNeural";en-US-SteffanNeural
!copyit "es-ES-AlvaroNeural";es-ES-AlvaroNeural
!copyit "es-ES-ElviraNeural";es-ES-ElviraNeural
!copyit "fr-FR-DeniseNeural";fr-FR-DeniseNeural
!copyit "fr-FR-EloiseNeural";fr-FR-EloiseNeural
!copyit "fr-FR-HenriNeural";fr-FR-HenriNeural`,NHe=Object.freeze(Object.defineProperty({__proto__:null,default:IHe},Symbol.toStringTag,{value:"Module"})),qO={},mS={};function PHe(){return{id:va(),board:"",layers:[],scroll:[],sidebar:[]}}const DHe=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit","bgedit"]),LHe=new Set(["tx","text"]),UHe={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},OK={};let BHe=t=>{let e=OK[t];return ge(e)||(OK[t]=e=PHe()),e};function OL(t){return BHe(t)}function x7(t){return ge(qO[t])||(qO[t]=[]),qO[t]}function FHe(t,e,n){Object.values(mS).forEach(r=>{if(r[e]!==void 0){const i=fb(t.id(),e);an(n)&&Hf(i,n),Sn(n)&&s7e(i,n)}})}function jHe(t){const e=x7(t);return qO[t]=[],e}function IK(t){const e=[];let n;for(let r=0;r<t.length;++r){const i=t[r],s=Sn(i)&&ge(t7(i));ge(n)&&n!==s&&e.push(" "),e.push(i),n=s}return e}function zHe(t,e){x7(t).push(e)}function HHe(t,e,n,r,i=()=>0,s=Ah){const o=[e,n,...r],a=hr(`${o[3]}`),c={...Ee};function l(u,h){ge(h)&&h!==i(u)&&(Ee.board=c.board,Ee.element=c.element,Ee.elementfocus=c.elementfocus,s(u,h))}if(DHe.has(a)){const u=`${o[2]}`;mS[e]=mS[e]??{};const h=i(u)??UHe[a];if(mS[e][u]===void 0){const d=fb(e,u);an(h)&&i7e(d,h),Sn(h)&&Dce(d,h),LHe.has(a)?mS[e][u]=a7e(d,m=>{l(u,m)}):mS[e][u]=o7e(d,m=>{l(u,m)})}}x7(t).push(o)}const NK=Object.assign({"./editor/codepagename.txt":l7e,"./editor/command/become.txt":f7e,"./editor/command/bgplay.txt":d7e,"./editor/command/bgvol.txt":m7e,"./editor/command/bind.txt":_7e,"./editor/command/board.txt":y7e,"./editor/command/bpm.txt":E7e,"./editor/command/break.txt":x7e,"./editor/command/change.txt":w7e,"./editor/command/char.txt":C7e,"./editor/command/charset.txt":M7e,"./editor/command/clear.txt":O7e,"./editor/command/color.txt":N7e,"./editor/command/continue.txt":D7e,"./editor/command/copy.txt":U7e,"./editor/command/cycle.txt":F7e,"./editor/command/die.txt":z7e,"./editor/command/distort.txt":q7e,"./editor/command/do.txt":G7e,"./editor/command/done.txt":W7e,"./editor/command/duplicate.txt":X7e,"./editor/command/echo.txt":Z7e,"./editor/command/edge.txt":Q7e,"./editor/command/else.txt":t9e,"./editor/command/elseif.txt":r9e,"./editor/command/end.txt":s9e,"./editor/command/endgame.txt":a9e,"./editor/command/endwith.txt":l9e,"./editor/command/fcrush.txt":f9e,"./editor/command/fetch.txt":d9e,"./editor/command/fetchwith.txt":m9e,"./editor/command/foreach.txt":_9e,"./editor/command/go.txt":y9e,"./editor/command/idle.txt":E9e,"./editor/command/if.txt":x9e,"./editor/command/lock.txt":w9e,"./editor/command/oneof.txt":C9e,"./editor/command/oneofwith.txt":M9e,"./editor/command/palette.txt":O9e,"./editor/command/phaser.txt":N9e,"./editor/command/pivot.txt":D9e,"./editor/command/play.txt":U9e,"./editor/command/put.txt":F9e,"./editor/command/putwith.txt":z9e,"./editor/command/readbin.txt":q9e,"./editor/command/readjson.txt":G9e,"./editor/command/readline.txt":W9e,"./editor/command/readrexpaint.txt":X9e,"./editor/command/remix.txt":Z9e,"./editor/command/repeat.txt":Q9e,"./editor/command/restore.txt":tje,"./editor/command/reverb.txt":rje,"./editor/command/revert.txt":sje,"./editor/command/run.txt":aje,"./editor/command/runwith.txt":lje,"./editor/command/set.txt":fje,"./editor/command/shoot.txt":dje,"./editor/command/shootwith.txt":mje,"./editor/command/shove.txt":_je,"./editor/command/snapshot.txt":yje,"./editor/command/synth.txt":Eje,"./editor/command/toast.txt":xje,"./editor/command/tts.txt":wje,"./editor/command/ttsvol.txt":Cje,"./editor/command/twitchbroadcast.txt":Mje,"./editor/command/twitchchat.txt":Oje,"./editor/command/unlock.txt":Nje,"./editor/command/vibrato.txt":Dje,"./editor/command/vol.txt":Uje,"./editor/command/waitfor.txt":Fje,"./editor/command/walk.txt":zje,"./editor/command/weave.txt":qje,"./editor/command/while.txt":Gje,"./editor/command/with.txt":Wje,"./editor/command/write.txt":Xje,"./editor/command/zap.txt":Zje,"./editor/comment.txt":Qje,"./editor/hyperlink.txt":tze,"./editor/hyperlink/hotkey.txt":rze,"./editor/hyperlink/number.txt":sze,"./editor/hyperlink/range.txt":aze,"./editor/hyperlink/select.txt":lze,"./editor/hyperlink/text.txt":fze,"./editor/label.txt":dze,"./editor/shortgo.txt":mze,"./editor/shorttry.txt":_ze,"./editor/stat/board.txt":yze,"./editor/stat/charset.txt":Eze,"./editor/stat/const.txt":xze,"./editor/stat/hotkey.txt":wze,"./editor/stat/loader.txt":Cze,"./editor/stat/number.txt":Mze,"./editor/stat/object.txt":Oze,"./editor/stat/palette.txt":Nze,"./editor/stat/range.txt":Dze,"./editor/stat/select.txt":Uze,"./editor/stat/terrain.txt":Fze,"./editor/stat/text.txt":zze,"./editor/text.txt":qze,"./help/controls.txt":Gze,"./help/developer.txt":Wze,"./help/menu.txt":Xze,"./help/nopages.txt":Zze,"./help/player.txt":Qze,"./help/text.txt":tHe,"./refscroll/autowahscroll.txt":rHe,"./refscroll/distortscroll.txt":sHe,"./refscroll/echoscroll.txt":aHe,"./refscroll/effectsscroll.txt":lHe,"./refscroll/fcrushscroll.txt":fHe,"./refscroll/menu.txt":dHe,"./refscroll/notesscroll.txt":mHe,"./refscroll/oscscroll.txt":_He,"./refscroll/phaserscroll.txt":yHe,"./refscroll/pulsescroll.txt":EHe,"./refscroll/pwmscroll.txt":xHe,"./refscroll/reverbscroll.txt":wHe,"./refscroll/synthscroll.txt":CHe,"./refscroll/termscroll.txt":MHe,"./refscroll/vibratoscroll.txt":OHe,"./refscroll/voicescroll.txt":NHe}),Bce={};Cv(NK).forEach(t=>{const e=t.replace(".txt","").replace("./","").replaceAll("/",":");Bce[e]=NK[t].default});function Fce(t){const e=hr(t.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=Bce[e];if(ge(n))return n;const{target:r,path:i}=P1(e);switch(r){case"editor":{const s=P1(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function jce(t,e){const n=(t??"").split(`
`);for(let r=0;r<n.length;++r)e(n[r].split(";"))}function qHe(t,e){const[n,...r]=e,i=r[0]??"",s=r[1]??"";switch(hr(n.trim())){case"header":ug(ut,t,i);break;case"section":r1(ut,t,i);break;case"option":Ih(ut,t,i,s);break;default:n.trimStart().startsWith("!")?l5(ut,t,n.trimStart().slice(1),i):oi(ut,t,n);break}}function VHe(t){const e={};return jce(t,n=>{const[r,...i]=n,s=i[0]??"";e[r]=s}),e}function Fy(t,e=!1){const[n,r]=Gt(t,0,[yt.ANY]);if(e&&om(n)){const[i,s,o]=Gt(t,0,[yt.DIR,yt.NAME]);return s.startsWith(":")?{targetdir:i,label:s.substring(1).trim(),args:t.slice(o)}:{targetdir:i,label:s,args:t.slice(o)}}else if(Sn(n)){const[i,s,o]=Gt(t,0,[yt.NAME,yt.ANY]);return Sn(s)&&s.startsWith(":")?(console.info(s,"??"),{targetname:i,label:s.substring(1).trim(),args:t.slice(o)}):{targetname:"self",label:i,args:t.slice(r)}}return{targetname:"",label:"",args:[]}}function zb(){lxe(ut,kS())}function gS(t){jce(Fce(`help:${t}`),e=>qHe(Ee.elementfocus,e))}function PK(t){switch(t.label){case"helpmenu":gS("menu");break;case"helpcontrols":gS("controls");break;case"helptext":gS("text");break;case"helpdeveloper":gS("developer");break;case"helpplayer":gS("player");break;default:{const e=A0(qp.MAIN),n=Pae(e);ge(t.targetname)?vN(t.targetname,t.label,void 0,n):ge(t.targetdir)&&vN(t.targetdir.destpt,t.label,void 0,n);break}}}const GHe=Uv().command("endgame",()=>(nte(ut,Ee.elementfocus),0)).command("shortsend",(t,e)=>{const n=Fy(e);return PK(n),n.targetname==="self"&&qh(ut,Ee.elementfocus,void 0,"text",`cli:${n.label}`,n.args.join(" ")),0}).command("send",(t,e)=>{const n=Fy(e,!0);return PK(n),0}).command("stat",(t,e)=>(txe(ut,Ee.elementfocus,e.map(rc).join(" ")),0)).command("text",(t,e)=>{const n=e.map(rc).join(" ");if(ge(Ee.element)&&Ee.elementisplayer){const{user:r}=zy(Ee.elementid),i=Sn(r)?r:"player";Ee.element.tickertext=`${i}:$WHITE ${n}`,Ee.element.tickertime=Ee.timestamp;const s=ed(Ee.element);fSe(ut,Ee.elementid,`$${en[s.color]}$ON${en[s.bg]}$${s.char}$ONCLEAR$CYAN ${i}:$WHITE ${n}`),qh(ut,Ee.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=rc(n),s=Fy(r);if(ge(s.targetname)){const{user:o}=zy(Ee.elementid),a=Sn(o)?o:"player",c=ed(Ee.element),l=`$${en[c.color]}$ON${en[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;Ei(ut,Ee.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(t,e)=>{const[n,r]=Gt(e,0,[yt.MAYBE_NAME,yt.MAYBE_STRING]);return Sn(n)&&Sn(r)?gH(ut,Ee.elementfocus,n,r):jSe(ut,Ee.elementfocus),0}).command("bookcreate",(t,e)=>{const[n]=Gt(e,0,[yt.MAYBE_NAME]),r=fle(n);return ge(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=Gt(e,0,[yt.NAME]),r=av(n);return ge(r)?(gH(ut,Ee.elementfocus,"selected",r.id),zb()):Pr(ut,Ee.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(t,e)=>{const[n]=Gt(e,0,[yt.NAME]),r=A0(qp.MAIN),i=av(n);return ge(i)&&(r===i&&ule(qp.MAIN,""),KVe(n),Ei(ut,Ee.elementfocus,`trashed [book] ${i.name}`),zb(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[n]=Gt(e,0,[yt.NAME]),r=qf(n);return ge(r)&&AS(Ee.book,Ee.elementfocus,r.id,{x:Bd(0,wn-1),y:Bd(0,Nr-1)},!0),0}).command("pageopen",(t,e)=>{const[n,r]=Gt(e,0,[yt.NAME,yt.MAYBE_NAME]);let i,s;const o=nv();for(let a=0;a<o.length&&(s=o[a],i=qA(s,n),!ge(i));++a);if(ge(i)&&ge(s)){const a=Xl(i),c=[i.id,r];Dce(ste(s.id,c),i.code);const l=tS(i);qSe(ut,Ee.elementfocus,s.id,c,l,`${a} - ${s.name}`)}else Pr(ut,"pageopen",`page ${n} not found`,Ee.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[n]=Gt(e,0,[yt.NAME]),r=jy(qp.MAIN),i=Tae(r,n);if(ge(n)){const s=Xl(i),o=tS(i);Ei(ut,Ee.elementfocus,`trashed [${o}] ${s}`),zb(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(rc).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{r1(ut,Ee.elementfocus,"books");const t=A0(qp.MAIN);Ih(ut,Ee.elementfocus,"main",`${t?.name??"empty"} $GREEN${t?.id??""}`);const e=A0(qp.MAIN);Ih(ut,Ee.elementfocus,"content",`${e?.name??"empty"} ${e?.id??""}`),Y8(ut,Ee.elementfocus,7);const n=nv();return n.length?n.forEach(r=>{oi(ut,Ee.elementfocus,`!bookopen ${r.id};${r.name}`)}):tv(ut,Ee.elementfocus,"no books found"),oi(ut,Ee.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=jy(qp.MAIN);if(!ge(t))return 0;r1(ut,Ee.elementfocus,"pages"),Ih(ut,Ee.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?mC(t).forEach(r=>{const i=Xl(r),s=tS(r);oi(ut,Ee.elementfocus,`!pageopen ${r.id};$blue[${s}]$white ${i}`)}):(oi(ut,Ee.elementfocus,""),gS("nopages"));const e=nv();for(let n=0;n<e.length;++n){const r=e[n];r.id!==t.id&&(Ih(ut,Ee.elementfocus,"content",`${r.name} $GREEN${r.id}`),mC(r).forEach(s=>{const o=Xl(s),a=tS(s);oi(ut,Ee.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{r1(ut,Ee.elementfocus,"boards");const t=jy(qp.MAIN);if(ge(t)){Ih(ut,Ee.elementfocus,"main",`${t.name} $GREEN${t.id}`);const n=mC(t);n.filter(r=>Jy(r)===Tr.BOARD).forEach(r=>{const i=Xl(r);oi(ut,Ee.elementfocus,`!boardopen ${r.id};$blue[#goto]$white ${i}`)}),n.length===0&&(oi(ut,Ee.elementfocus,""),tv(ut,Ee.elementfocus,"$white no boards found"),tv(ut,Ee.elementfocus,"$white use @ to create a board"),tv(ut,Ee.elementfocus,"$white @board name of board"))}const e=nv();for(let n=0;n<e.length;++n){const r=e[n];r.id!==t.id&&(Ih(ut,Ee.elementfocus,"content",`${r.name} $GREEN${r.id}`),mC(r).filter(s=>Jy(s)===Tr.BOARD).forEach(s=>{const o=Xl(s);oi(ut,Ee.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{r1(ut,Ee.elementfocus,"$REDTRASH"),tv(ut,Ee.elementfocus,"books");const t=nv();t.length&&(t.forEach(n=>{oi(ut,Ee.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),oi(ut,Ee.elementfocus,""));const e=A0(qp.MAIN);return ge(e)&&(tv(ut,Ee.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=Xl(n);oi(ut,Ee.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),oi(ut,Ee.elementfocus,"")),0}).command("dev",()=>(zb(),TSe(ut,Ee.elementfocus),0)).command("share",()=>(zb(),wSe(ut,Ee.elementfocus),0)).command("save",()=>(zb(),0)).command("fork",()=>(uxe(ut,Ee.elementfocus),0)).command("itchiopublish",()=>(fxe(ut,Ee.elementfocus),0)).command("nuke",()=>(RSe(ut,Ee.elementfocus),0)).command("restart",()=>(axe(ut,Ee.elementfocus),zb(),0)).command("export",()=>{ug(ut,Ee.elementfocus,"E X P O R T"),r1(ut,Ee.elementfocus,"books");const t=nv();return t.length&&t.forEach(e=>oi(ut,Ee.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[n]=Gt(e,0,[yt.NAME]),r=av(n);return ge(r)&&(ug(ut,Ee.elementfocus,"E X P O R T"),r1(ut,Ee.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=mC(r);oi(ut,Ee.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Xl(s),a=tS(s);oi(ut,Ee.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[n]=Gt(e,0,[yt.NAME]),r=av(n);return ge(r)&&mH(ut,Ee.elementfocus,na(r),`${r.name}.book.json`),0}).command("pageexport",(t,e)=>{const[n]=Gt(e,0,[yt.NAME]),{target:r,path:i}=P1(n),s=av(r),o=qA(s,i);return ge(o)&&mH(ut,Ee.elementfocus,na(o),`${Xl(o)}.${tS(o)}.json`),0}).command("gadget",()=>(zSe(ut,Ee.elementfocus),0)).command("findany",(t,e)=>{const[n]=Gt(e,0,[yt.ANY]);if(Rr(n)){const r=n.filter(By);_H(ut,Ee.elementfocus,r)}else _H(ut,Ee.elementfocus,[]);return 0}).command("zztsearch",(t,e)=>{const[n,r]=Gt(e,0,[yt.NAME,yt.MAYBE_NAME]),i=ge(r)?n:"title",s=ge(r)?r:n;return WSe(ut,Ee.elementfocus,i,s),0}).command("zztrandom",()=>(KSe(ut,Ee.elementfocus),0)).command("admin",()=>($Se(ut,Ee.elementfocus),0)).command("joincode",(t,e)=>{const[n]=Gt(e,0,[yt.MAYBE_NAME]),r=dle(Ee.elementfocus);return ge(r)?vSe(ut,Ee.elementfocus,!!n):Pr(ut,Ee.elementfocus,"multiplayer","need to have an active player on a board in order to start multiplayer"),0}).command("jointab",(t,e)=>{const[n]=Gt(e,0,[yt.MAYBE_NAME]);return ySe(ut,Ee.elementfocus,!!n),0}).command("broadcast",(t,e)=>{const[n]=Gt(e,0,[yt.MAYBE_NAME]);return n?hSe(ut,Ee.elementfocus,n):dSe(ut,Ee.elementfocus),0}).command("startlookingglass",()=>(CSe(ut,Ee.elementfocus),0)),$He=Uv().command("toast",(t,e)=>{const n=e.map(rc).join("");return Jee(ut,Ee.elementfocus,n),0}).command("ticker",(t,e)=>{const n=e.map(rc).join("");return ge(Ee.element)&&(Ee.element.tickertext=n,Ee.element.tickertime=Ee.timestamp),0}).command("palette",(t,e)=>{const[n]=Gt(e,0,[yt.NAME]),r=aY(),i=_g(Tr.PALETTE,n);return ge(i)?(r.palette=i.id,Ei(ut,Ee.elementfocus,`loaded palette ${n}`)):Pr(ut,Ee.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(t,e)=>{const[n]=Gt(e,0,[yt.NAME]),r=aY(),i=_g(Tr.CHARSET,n);return ge(i)?(r.charset=i.id,Ei(ut,Ee.elementfocus,`loaded charset ${n}`)):Pr(ut,Ee.elementfocus,"not-found",`unabled to find charset ${n}`),0}),WHe=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),DK=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","arg"]),KHe=["NORTH","SOUTH","WEST","EAST"];function XHe(t,e,n){const r=zy(t);if(an(r.inputcurrent)||(r.inputcurrent=0),Rr(r.inputqueue)||(r.inputqueue=[]),r.inputcurrent>0)return r;const[i]=r.inputqueue,[s=rn.NONE,o=0]=i??[rn.NONE,0];switch(r.inputmove=[],r.inputok=0,r.inputcancel=0,r.inputmenu=0,r.inputalt=o&J8?1:0,r.inputctrl=o&Q8?1:0,r.inputshift=o&eF?1:0,s){case rn.MOVE_UP:case rn.MOVE_DOWN:case rn.MOVE_LEFT:case rn.MOVE_RIGHT:{const a=KHe[s-rn.MOVE_UP];if(Sn(e)&&e==="fpv"&&an(n))switch(Math.round(n/90)){default:case 0:r.inputmove=[a];break;case 1:switch(a){default:case"NORTH":r.inputmove=["EAST"];break;case"EAST":r.inputmove=["SOUTH"];break;case"SOUTH":r.inputmove=["WEST"];break;case"WEST":r.inputmove=["NORTH"];break}break;case 2:switch(a){default:case"NORTH":r.inputmove=["SOUTH"];break;case"EAST":r.inputmove=["WEST"];break;case"SOUTH":r.inputmove=["NORTH"];break;case"WEST":r.inputmove=["EAST"];break}break;case 3:switch(a){default:case"NORTH":r.inputmove=["WEST"];break;case"EAST":r.inputmove=["NORTH"];break;case"SOUTH":r.inputmove=["EAST"];break;case"WEST":r.inputmove=["SOUTH"];break}break}else r.inputmove=[a];break}case rn.OK_BUTTON:r.inputok=1;break;case rn.CANCEL_BUTTON:r.inputcancel=1;break;case rn.MENU_BUTTON:r.inputmenu=1;break}return r.inputcurrent=s,r.inputqueue=r.inputqueue.filter(a=>{const[c]=a;return c!==rn.NONE&&c!==s}),r}function YHe(t){const e=kae[t];if(ge(e))return e;const n=Nae[t];if(ge(n))return n;const r=E3[t];if(ge(r))return r;const i=are[t];if(ge(i))return i}function LK(){if($d(Ee.board,Ee.element,Ee.timestamp),!!Yr(Ee.element,"item")){const e={x:Ee.element?.x??-1,y:Ee.element?.y??-1},n=VA(Ee.board,e,Ee.elementfocus);ge(n)&&(n.x=e.x,n.y=e.y)}}const ZHe=Uv({get(t,e){const n=YHe(e);if(ge(n))return[!0,n];if(Ee.elementisplayer&&WHe.has(e)){const c=t.get("graphics"),l=t.get("facing"),u=XHe(Ee.elementid,c,l)[e];return[ge(u),u]}const r=VA(Ee.board,{x:Ee.element?.x??-1,y:Ee.element?.y??-1},Ee.elementfocus),i=r?.id??Ee.elementfocus??kS(),s=Ee.element?.sender,o=tBe(Ee.board,Sn(s)?s:"");switch(e){case"camera":case"graphics":case"facing":{const c=zy(i)[e];return[!0,ge(c)?c:Ee.board?.[e]??0]}case"isdark":return[!0,Ee.board?.isdark?1:0];case"startx":return[!0,Ee.board?.startx??0];case"starty":return[!0,Ee.board?.starty??0];case"over":return[!0,Ee.board?.over??""];case"under":return[!0,Ee.board?.under??""];case"exitnorth":return[!0,Ee.board?.exitnorth??""];case"exitsouth":return[!0,Ee.board?.exitsouth??""];case"exitwest":return[!0,Ee.board?.exitwest??""];case"exiteast":return[!0,Ee.board?.exiteast??""];case"timelimit":return[!0,Ee.board?.timelimit??0];case"restartonzap":return[!0,Ee.board?.restartonzap??0];case"maxplayershots":return[!0,Ee.board?.maxplayershots??0];case"b1":return[!0,Ee.board?.b1??0];case"b2":return[!0,Ee.board?.b1??0];case"b3":return[!0,Ee.board?.b1??0];case"b4":return[!0,Ee.board?.b1??0];case"b5":return[!0,Ee.board?.b1??0];case"b6":return[!0,Ee.board?.b1??0];case"b7":return[!0,Ee.board?.b1??0];case"b8":return[!0,Ee.board?.b1??0];case"b9":return[!0,Ee.board?.b1??0];case"b10":return[!0,Ee.board?.b1??0];case"currenttick":return[!0,Ee.timestamp];case"boardid":return[!0,Ee.board?.id??""];case"playerid":return[!0,i];case"playerx":return[!0,r?.x??-1];case"playery":return[!0,r?.y??-1];case"thisid":return[!0,Ee.element?.id??""];case"thisx":return[!0,Ee.element?.x??-1];case"thisy":return[!0,Ee.element?.y??-1];case"senderid":return[!0,o?.id??""];case"senderx":return[!0,o?.x??-1];case"sendery":return[!0,o?.y??-1];default:{if(DK.has(e))return[!0,Yr(Ee.element,e)??0];break}}const a=zy(i)[e];return[ge(a),a]},set(t,e,n){const r={x:Ee.element?.x??-1,y:Ee.element?.y??-1},s=VA(Ee.board,r,Ee.elementfocus)?.id??Ee.elementfocus;switch(e){case"camera":case"graphics":break;case"facing":n=(n%360+360)%360;break;case"isdark":if(ge(Ee.board))return Ee.board.isdark=n?1:0,[!0,Ee.board.isdark];break;case"startx":if(ge(Ee.board))return Ee.board.startx=Ru(n,0),[!0,Ee.board.startx];break;case"starty":if(ge(Ee.board))return Ee.board.starty=Ru(n,0),[!0,Ee.board.starty];break;case"over":if(ge(Ee.board)){const a=rc(n);return Ee.board.over!==a&&(Ee.board.overboard=void 0),Ee.board.over=a,[!0,a]}break;case"under":if(ge(Ee.board)){const a=rc(n);return Ee.board.under!==a&&(Ee.board.underboard=void 0),Ee.board.under=a,[!0,a]}break;case"exitnorth":if(ge(Ee.board))return[!0,Ee.board.exitnorth=rc(n)];break;case"exitsouth":if(ge(Ee.board))return[!0,Ee.board.exitsouth=rc(n)];break;case"exitwest":if(ge(Ee.board))return[!0,Ee.board.exitwest=rc(n)];break;case"exiteast":if(ge(Ee.board))return[!0,Ee.board.exiteast=rc(n)];break;case"timelimit":if(ge(Ee.board))return[!0,Ee.board.timelimit=Ru(n,0)];break;case"restartonzap":if(ge(Ee.board))return[!0,Ee.board.restartonzap=n?1:0];break;case"maxplayershots":if(ge(Ee.board))return[!0,Ee.board.maxplayershots=Ru(n,0)];break;case"b1":if(ge(Ee.board))return[!0,Ee.board.b1=Ru(n,0)];break;case"b2":if(ge(Ee.board))return[!0,Ee.board.b2=Ru(n,0)];break;case"b3":if(ge(Ee.board))return[!0,Ee.board.b3=Ru(n,0)];break;case"b4":if(ge(Ee.board))return[!0,Ee.board.b4=Ru(n,0)];break;case"b5":if(ge(Ee.board))return[!0,Ee.board.b5=Ru(n,0)];break;case"b6":if(ge(Ee.board))return[!0,Ee.board.b6=Ru(n,0)];break;case"b7":if(ge(Ee.board))return[!0,Ee.board.b7=Ru(n,0)];break;case"b8":if(ge(Ee.board))return[!0,Ee.board.b8=Ru(n,0)];break;case"b9":if(ge(Ee.board))return[!0,Ee.board.b9=Ru(n,0)];break;case"b10":if(ge(Ee.board))return[!0,Ee.board.b10=Ru(n,0)];break;case"currenttick":case"boardid":return[!0,n];case"playerid":case"playerx":case"playery":return[!0,n];case"thisid":case"thisx":case"thisy":return[!0,n];case"senderid":return ge(Ee.element)&&(Ee.element.sender=n),[!0,n];case"senderx":case"sendery":return[!0,n];default:{if(DK.has(e))return ge(Ee.element)&&(Ee.element[e]=n),[!0,n];break}}const o=zy(s);return ge(o)?(o[e]=n,[!0,n]):[!1,n]},everytick(t){if(Ee.elementisplayer){const e=t.get("health");an(e)&&e<=0&&(t.endofprogram(),nte(ut,Ee.elementid))}!Ee.element?.removed&&ge(Ee.element?.x)&&ge(Ee.element.y)&&ge(Ee.element.stepx)&&ge(Ee.element.stepy)&&(Ee.element.stepx||Ee.element.stepy)&&Fd(Ee.book,Ee.board,Ee.element,{x:Ee.element.x+Ee.element.stepx,y:Ee.element.y+Ee.element.stepy})}}).command("clear",(t,e)=>{for(let n=0;n<e.length;++n)t.set(rc(e[n]),0);return 0}).command("set",(t,e)=>{const[n,r]=Gt(e,0,[yt.NAME,yt.ANY]);return t.set(n,r??1),0}).command("become",(t,e)=>{const[n]=Gt(e,0,[yt.KIND]);Wf(Ee.board);const r=ed(Ee.element),[i,s]=n,o=[...S3(r.color,r.bg),...s??[]],a=[i,o];if(QF(Ee.board,Ee.element),$d(Ee.board,Ee.element,Ee.timestamp)){const c={x:Ee.element?.x??0,y:Ee.element?.y??0};nm(Ee.board,a,c)}return t.endofprogram(),0}).command("bind",(t,e)=>{const[n]=Gt(e,0,[yt.NAME]),r=Jx(Ee.board,n);return ge(Ee.element)&&r.length>0&&(Ee.element.code=Wp(...r).code??"",ZVe(Ee.elementid)),0}).command("char",(t,e)=>{const[n]=Gt(e,0,[yt.ANY]);if(om(n)){const[r,i]=Gt(e,0,[yt.DIR,yt.NUMBER]),s=ro(Ee.board,r.destpt);ge(s)&&(s.char=i)}else ge(Ee.element)&&an(n)&&(Ee.element.char=n);return 0}).command("color",(t,e)=>{const[n]=Gt(e,0,[yt.ANY]);if(om(n)){const[r,i]=Gt(e,0,[yt.DIR,yt.COLOR]),s=ro(Ee.board,r.destpt);ge(s)&&HA(Ee.element,i)}else{const[r]=Gt(e,0,[yt.COLOR]);ge(Ee.element)&&ge(r)&&HA(Ee.element,r)}return 0}).command("go",(t,e)=>{if(ge(Ee.element)){const[n]=Gt(e,0,[yt.DIR]);if(Fd(Ee.book,Ee.board,Ee.element,n.destpt),t.yield(),Ee.element.x===n.destpt.x&&Ee.element.y===n.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!ge(Ee.element))return 0;const[n]=Gt(e,0,[yt.DIR]),r=Ee.element.x??0,i=Ee.element.y??0;return Ee.element.stepx=n.destpt.x-r,Ee.element.stepy=n.destpt.y-i,0}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=Gt(e,0,[yt.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(rc(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(rc(e[0])),0)).command("cycle",(t,e)=>{if(ge(Ee.element)){const[n]=Gt(e,0,[yt.NUMBER]);Ee.element.cycle=Vr(Math.round(n),1,255)}return 0}).command("die",t=>(LK(),t.endofprogram(),0)).command("dieonend",()=>(LK(),0)).command("run",(t,e)=>{const[n]=Gt(e,0,[yt.NAME]);return yN(n),0}).command("runwith",(t,e)=>{const[n,r]=Gt(e,0,[yt.ANY,yt.NAME]);return t.set("arg",n),yN(r),0}),zce={};function JHe(t){return zce[t]?.format}function VS(t){return zce[t]?.content}function UK(t,e){if(!ge(t))return;const n=hr(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const QHe=(t,e)=>{const n=VS(t.id());if(!ge(n))return 0;const[r,i]=Gt(e,0,[yt.NAME]),s=hr(r);switch(s){case"seek":{const[o]=Gt(e,i,[yt.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=Gt(e,i,[yt.NAME]);t.set(o,UK(n,s));break}case"text":{const[o,a]=Gt(e,i,[yt.NAME,yt.NAME]),c=UK(n,o);if(an(c)&&Sn(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(l);t.set(a,h),n.cursor+=c}break}case"palette":{const[o]=Gt(e,i,[yt.NAME]),[a]=P5(Ee.book,Tr.PALETTE,o),c=Tl(a);if(ge(c)){const l=Kne*ux,u=lE(new Uint8Array(n.bytes.buffer,n.cursor,l));ge(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=Gt(e,i,[yt.NAME]),[a]=P5(Ee.book,Tr.CHARSET,o),c=Tl(a);if(ge(c)){const l=Jp*h5*f5,u=uE(new Uint8Array(n.bytes.buffer,n.cursor,l));ge(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},Cx=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",_N=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!_N(t[n],e[n]))return!1;return!0}if(Cx(t)&&Cx(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!_N(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},Ik=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(Cx(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},eqe=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",BK=t=>t>="0"&&t<="9"||t==="-",tqe=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var Ut;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(Ut||(Ut={}));const FK={"(":Ut.TOK_LPAREN,")":Ut.TOK_RPAREN,"*":Ut.TOK_STAR,",":Ut.TOK_COMMA,".":Ut.TOK_DOT,":":Ut.TOK_COLON,"@":Ut.TOK_CURRENT,$:Ut.TOK_ROOT,"]":Ut.TOK_RBRACKET,"{":Ut.TOK_LBRACE,"}":Ut.TOK_RBRACE},nqe={"!":!0,"<":!0,"=":!0,">":!0},rqe={"	":!0,"\n":!0,"\r":!0," ":!0};class iqe{constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(eqe(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:Ut.TOK_UNQUOTEDIDENTIFIER,value:i});else if(FK[e[this._current]]!==void 0)n.push({start:this._current,type:FK[e[this._current]],value:e[this._current]}),this._current+=1;else if(BK(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:Ut.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:Ut.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);n.push({start:r,type:Ut.TOK_LITERAL,value:o})}else if(nqe[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if(rqe[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:Ut.TOK_AND,value:"&&"})):n.push({start:r,type:Ut.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:Ut.TOK_OR,value:"||"})):n.push({start:r,type:Ut.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&tqe(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;BK(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:Ut.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:Ut.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:Ut.TOK_FLATTEN,value:"[]"}):{start:n,type:Ut.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:Ut.TOK_NE,value:"!="}):{start:n,type:Ut.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:Ut.TOK_LTE,value:"<="}):{start:n,type:Ut.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:Ut.TOK_GTE,value:">="}):{start:n,type:Ut.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:Ut.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const r=["true","false","null"],i="-0123456789";if(e==="")return!1;if('[{"'.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const sqe=new iqe,Ju={[Ut.TOK_EOF]:0,[Ut.TOK_UNQUOTEDIDENTIFIER]:0,[Ut.TOK_QUOTEDIDENTIFIER]:0,[Ut.TOK_RBRACKET]:0,[Ut.TOK_RPAREN]:0,[Ut.TOK_COMMA]:0,[Ut.TOK_RBRACE]:0,[Ut.TOK_NUMBER]:0,[Ut.TOK_CURRENT]:0,[Ut.TOK_EXPREF]:0,[Ut.TOK_ROOT]:0,[Ut.TOK_PIPE]:1,[Ut.TOK_OR]:2,[Ut.TOK_AND]:3,[Ut.TOK_EQ]:5,[Ut.TOK_GT]:5,[Ut.TOK_LT]:5,[Ut.TOK_GTE]:5,[Ut.TOK_LTE]:5,[Ut.TOK_NE]:5,[Ut.TOK_FLATTEN]:9,[Ut.TOK_STAR]:20,[Ut.TOK_FILTER]:21,[Ut.TOK_DOT]:40,[Ut.TOK_NOT]:45,[Ut.TOK_LBRACE]:50,[Ut.TOK_LBRACKET]:55,[Ut.TOK_LPAREN]:60};class oqe{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==Ut.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...sqe.tokenize(e),{type:Ut.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<Ju[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case Ut.TOK_LITERAL:return{type:"Literal",value:e.value};case Ut.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case Ut.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===Ut.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case Ut.TOK_NOT:return r=this.expression(Ju.Not),{type:"NotExpression",children:[r]};case Ut.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===Ut.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(Ju.Star),{type:"ValueProjection",children:[n,r]};case Ut.TOK_FILTER:return this.led(e.type,{type:"Identity"});case Ut.TOK_LBRACE:return this.parseMultiselectHash();case Ut.TOK_FLATTEN:return n={type:Ut.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(Ju.Flatten),{type:"Projection",children:[n,r]};case Ut.TOK_LBRACKET:return this.lookahead(0)===Ut.TOK_NUMBER||this.lookahead(0)===Ut.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===Ut.TOK_STAR&&this.lookahead(1)===Ut.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(Ju.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case Ut.TOK_CURRENT:return{type:Ut.TOK_CURRENT};case Ut.TOK_ROOT:return{type:Ut.TOK_ROOT};case Ut.TOK_EXPREF:return i=this.expression(Ju.Expref),{type:"ExpressionReference",children:[i]};case Ut.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==Ut.TOK_RPAREN;)this.lookahead(0)===Ut.TOK_CURRENT?(i={type:Ut.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(Ut.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case Ut.TOK_DOT:const i=Ju.Dot;return this.lookahead(0)!==Ut.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case Ut.TOK_PIPE:return r=this.expression(Ju.Pipe),{type:Ut.TOK_PIPE,children:[n,r]};case Ut.TOK_OR:return r=this.expression(Ju.Or),{type:"OrExpression",children:[n,r]};case Ut.TOK_AND:return r=this.expression(Ju.And),{type:"AndExpression",children:[n,r]};case Ut.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==Ut.TOK_RPAREN;)this.lookahead(0)===Ut.TOK_CURRENT?(a={type:Ut.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===Ut.TOK_COMMA&&this.match(Ut.TOK_COMMA),o.push(a);return this.match(Ut.TOK_RPAREN),{name:s,type:"Function",children:o};case Ut.TOK_FILTER:const l=this.expression(0);return this.match(Ut.TOK_RBRACKET),r=this.lookahead(0)===Ut.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(Ju.Filter),{type:"FilterProjection",children:[n,r,l]};case Ut.TOK_FLATTEN:const u={type:Ut.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(Ju.Flatten);return{type:"Projection",children:[u,h]};case Ut.TOK_EQ:case Ut.TOK_NE:case Ut.TOK_GT:case Ut.TOK_GTE:case Ut.TOK_LT:case Ut.TOK_LTE:return this.parseComparator(n,e);case Ut.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===Ut.TOK_NUMBER||d.type===Ut.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(Ut.TOK_STAR),this.match(Ut.TOK_RBRACKET),r=this.parseProjectionRHS(Ju.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===Ut.TOK_COLON||this.lookahead(1)===Ut.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(Ut.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(Ju.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==Ut.TOK_RBRACKET&&n<3;){if(r===Ut.TOK_COLON)n+=1,this.advance();else if(r===Ut.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(Ut.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression(Ju[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([Ut.TOK_UNQUOTEDIDENTIFIER,Ut.TOK_QUOTEDIDENTIFIER,Ut.TOK_STAR].includes(n))return this.expression(e);if(n===Ut.TOK_LBRACKET)return this.match(Ut.TOK_LBRACKET),this.parseMultiselectList();if(n===Ut.TOK_LBRACE)return this.match(Ut.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(Ju[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===Ut.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===Ut.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===Ut.TOK_DOT)return this.match(Ut.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==Ut.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===Ut.TOK_COMMA&&(this.match(Ut.TOK_COMMA),this.lookahead(0)===Ut.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(Ut.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[Ut.TOK_UNQUOTEDIDENTIFIER,Ut.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(Ut.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===Ut.TOK_COMMA)this.match(Ut.TOK_COMMA);else if(this.lookahead(0)===Ut.TOK_RBRACE){this.match(Ut.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const aqe=new oqe;var fn;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(fn||(fn={}));class cqe{constructor(e){this.TYPE_NAME_TABLE={[fn.TYPE_NUMBER]:"number",[fn.TYPE_ANY]:"any",[fn.TYPE_STRING]:"string",[fn.TYPE_ARRAY]:"array",[fn.TYPE_OBJECT]:"object",[fn.TYPE_BOOLEAN]:"boolean",[fn.TYPE_EXPREF]:"expression",[fn.TYPE_NULL]:"null",[fn.TYPE_ARRAY_NUMBER]:"Array<number>",[fn.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>Cx(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===fn.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[fn.TYPE_NUMBER,fn.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===fn.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[fn.TYPE_NUMBER,fn.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==fn.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===fn.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![fn.TYPE_NUMBER,fn.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),h=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return u>h?1:u<h?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===fn.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===fn.TYPE_NUMBER?n:r===fn.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===fn.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case fn.TYPE_NUMBER:return"number";case fn.TYPE_STRING:return"string";case fn.TYPE_ARRAY:return"array";case fn.TYPE_OBJECT:return"object";case fn.TYPE_BOOLEAN:return"boolean";case fn.TYPE_EXPREF:return"expref";case fn.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[fn.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[fn.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[fn.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[fn.TYPE_STRING,fn.TYPE_ARRAY]},{types:[fn.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[fn.TYPE_STRING]},{types:[fn.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[fn.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[fn.TYPE_STRING]},{types:[fn.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[fn.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[fn.TYPE_STRING,fn.TYPE_ARRAY,fn.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[fn.TYPE_EXPREF]},{types:[fn.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[fn.TYPE_ARRAY_NUMBER,fn.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[fn.TYPE_ARRAY]},{types:[fn.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[fn.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[fn.TYPE_ARRAY_NUMBER,fn.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[fn.TYPE_ARRAY]},{types:[fn.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[fn.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[fn.TYPE_STRING,fn.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[fn.TYPE_ARRAY_STRING,fn.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[fn.TYPE_ARRAY]},{types:[fn.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[fn.TYPE_STRING]},{types:[fn.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[fn.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[fn.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[fn.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[fn.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[fn.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[fn.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(g=>{var y;return(y=!g.optional)!==null&&y!==void 0?y:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,h=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let d,m,p;for(let g=0;g<r.length;g+=1){p=!1,d=r[g].types,m=this.getTypeName(n[g]);let y;for(y=0;y<d.length;y+=1)if(m!==void 0&&this.typeMatches(m,d[y],n[g])){p=!0;break}if(!p&&m!==void 0){const v=d.map(x=>this.TYPE_NAME_TABLE[x]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${g+1} to be type (${v}) but received type ${this.TYPE_NAME_TABLE[m]} instead.`)}}}typeMatches(e,n,r){if(n===fn.TYPE_ANY)return!0;if(n===fn.TYPE_ARRAY_STRING||n===fn.TYPE_ARRAY_NUMBER||n===fn.TYPE_ARRAY){if(n===fn.TYPE_ARRAY)return e===fn.TYPE_ARRAY;if(e===fn.TYPE_ARRAY){let i;n===fn.TYPE_ARRAY_NUMBER?i=fn.TYPE_NUMBER:n===fn.TYPE_ARRAY_STRING&&(i=fn.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return fn.TYPE_STRING;case"[object Number]":return fn.TYPE_NUMBER;case"[object Array]":return fn.TYPE_ARRAY;case"[object Boolean]":return fn.TYPE_BOOLEAN;case"[object Null]":return fn.TYPE_NULL;case"[object Object]":return e.jmespathType===Ut.TOK_EXPREF?fn.TYPE_EXPREF:fn.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class lqe{constructor(){this._rootValue=null,this.runtime=new cqe(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,o,a,c,l,u,h,d,m;switch(e.type){case"Field":return n===null?null:Cx(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),d=1;d<e.children.length;d+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=e.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const g=[...e.children],y=this.computeSliceParams(n.length,g),[v,x,E]=y;if(s=[],E>0)for(d=v;d<x;d+=E)s.push(n[d]);else for(d=v;d>x;d+=E)s.push(n[d]);return s;case"Projection":if(m=this.visit(e.children[0],n),!Array.isArray(m))return null;for(h=[],d=0;d<m.length;d+=1)i=this.visit(e.children[1],m[d]),i!==null&&h.push(i);return h;case"ValueProjection":if(m=this.visit(e.children[0],n),!Cx(m))return null;h=[];const C=Object.values(m);for(d=0;d<C.length;d+=1)i=this.visit(e.children[1],C[d]),i!==null&&h.push(i);return h;case"FilterProjection":if(m=this.visit(e.children[0],n),!Array.isArray(m))return null;const A=[],k=[];for(d=0;d<m.length;d+=1)r=this.visit(e.children[2],m[d]),Ik(r)||A.push(m[d]);for(let P=0;P<A.length;P+=1)i=this.visit(e.children[1],A[P]),i!==null&&k.push(i);return k;case"Comparator":switch(o=this.visit(e.children[0],n),a=this.visit(e.children[1],n),e.name){case Ut.TOK_EQ:s=_N(o,a);break;case Ut.TOK_NE:s=!_N(o,a);break;case Ut.TOK_GT:s=o>a;break;case Ut.TOK_GTE:s=o>=a;break;case Ut.TOK_LT:s=o<a;break;case Ut.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case Ut.TOK_FLATTEN:const M=this.visit(e.children[0],n);if(!Array.isArray(M))return null;let I=[];for(d=0;d<M.length;d+=1)i=M[d],Array.isArray(i)?I=[...I,...i]:I.push(i);return I;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],d=0;d<e.children.length;d+=1)h.push(this.visit(e.children[d],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let z;for(d=0;d<e.children.length;d+=1)z=e.children[d],h[z.name]=this.visit(z.value,n);return h;case"OrExpression":return r=this.visit(e.children[0],n),Ik(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return o=this.visit(e.children[0],n),Ik(o)?o:this.visit(e.children[1],n);case"NotExpression":return o=this.visit(e.children[0],n),Ik(o);case"Literal":return e.value;case Ut.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case Ut.TOK_CURRENT:return n;case Ut.TOK_ROOT:return this._rootValue;case"Function":const H=[];for(let P=0;P<e.children.length;P+=1)H.push(this.visit(e.children[P],n));return this.runtime.callFunction(e.name,H);case"ExpressionReference":const K=e.children[0];return K.jmespathType=Ut.TOK_EXPREF,K;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const uqe=new lqe;fn.TYPE_ANY;fn.TYPE_ARRAY;fn.TYPE_ARRAY_NUMBER;fn.TYPE_ARRAY_STRING;fn.TYPE_BOOLEAN;fn.TYPE_EXPREF;fn.TYPE_NULL;fn.TYPE_NUMBER;fn.TYPE_OBJECT;fn.TYPE_STRING;function fqe(t,e){const n=aqe.parse(e);return uqe.search(n,t)}const hqe=(t,e)=>{const n=VS(t.id());if(!ge(n))return 0;const[r,i]=Gt(e,0,[yt.NAME,yt.NAME]),s=fqe(n.json,r);return t.set(i,s),0},dqe=(t,e)=>{const n=VS(t.id());if(!ge(n))return 0;const[r,i]=Gt(e,0,[yt.NAME]);switch(hr(r)){case"seek":{const[o]=Gt(e,i,[yt.NUMBER]);n.cursor=Vr(o,0,n.lines.length-1);break}case"line":n.cursor=Vr(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[h,d]=Gt(e,u,[yt.NAME]);t.set(h,c[l]??0),++l,u=d}break}}return 0};function jK(t){const e=A0(qp.MAIN),n=Pae(e);ge(t.targetdir)?vN(t.targetdir.destpt,t.label,void 0,n):ge(t.targetname)&&vN(t.targetname,t.label,void 0,n)}const pqe=Uv({get(t,e){const n=JHe(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const r=VS(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=VS(t.id());switch(e){case"filename":return[!0,r.filename]}break}case"binary":{const r=VS(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("endgame",()=>0).command("shortsend",(t,e)=>{const n=Fy(e);return jK(n),0}).command("send",(t,e)=>{const n=Fy(e,!0);return jK(n),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(rc).join(" ");return Ei(ut,Ee.elementfocus,"$GREEN",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=rc(n),s=Fy(r);return ge(s.targetname)&&Ei(ut,Ee.elementfocus,`!${s.targetname}:${s.label};${i}`),0}).command("readline",dqe).command("readjson",hqe).command("readbin",QHe).command("withboard",(t,e)=>{const[n]=Gt(e,0,[yt.STRING]),r=qf(n);return ge(r)&&(Ee.board=r,Ee.element={x:-1,y:-1}),0});function zK(t,e,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=Gt(i,a,[yt.ANY]);Rr(c)&&!om(c)&&!WA(c)&&!aN(c)&&!$f(c)?o.push(...c):o.push(c),a=l}switch(hr(r)){case"get":case"post:json":gSe(ut,Ee.elementfocus,t,e,n,r,o);break}return 0}const mqe=Uv().command("fetch",(t,e)=>{const[n,r,i="get",s]=Gt(e,0,[yt.NAME,yt.NAME,yt.MAYBE_STRING]);return zK(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",o]=Gt(e,0,[yt.ANY,yt.NAME,yt.NAME,yt.MAYBE_STRING]);return zK(n,r,i,s,e,o),0}).command("chat",(t,e)=>{const[n]=Gt(e,0,[yt.MAYBE_NAME]);return n?pSe(ut,Ee.elementfocus,n):mSe(ut,Ee.elementfocus),0});function gC(t,e,n){if(ge(Ee.board)){switch(n){case"shot":case"bombed":Yr(e,"breakable")&&$d(Ee.board,e,Ee.timestamp);break}ge(e?.id)&&t.send(Ee.elementfocus,e.id,n)}}function HK(t,e){if(ge(e.targetname)){const n=Object.keys(Ee.board?.objects??{});switch(e.targetname){case"all":for(let r=0;r<n.length;++r){const i=n[r],s=Gd(Ee.board,i);ge(s)&&gC(t,s,e.label)}break;case"others":for(let r=0;r<n.length;++r){const i=n[r],s=Gd(Ee.board,i);i!==t.id()&&ge(s)&&gC(t,s,e.label)}break;case"self":Ee.elementid!==t.id()?t.send(Ee.elementfocus,Ee.elementid,e.label):t.message({session:ut.session(),player:Ee.elementfocus,id:va(),sender:Ee.elementid,target:e.label});break;default:{const r=wae(Ee.board,[e.targetname]);for(let i=0;i<r.length;++i){const s=r[i];ge(s)&&gC(t,s,e.label)}break}}}else if(ge(e.targetdir))if(e.targetdir.targets.length)for(let n=0;n<e.targetdir.targets.length;++n){const r=ro(Ee.board,e.targetdir.targets[n]);ge(r)&&gC(t,r,e.label)}else{const n=ro(Ee.board,e.targetdir.destpt);ge(n)&&gC(t,n,e.label)}}const gqe=Uv({set(t,e,n){return FHe(t,e,n),[!1,void 0]},aftertick(){const t=jHe(Ee.elementid),[e]=t;if(t.length===1&&Sn(e)){if(ge(Ee.element))if(e.trim().length===0){const n=OL(Ee.elementid);n.sidebar=[]}else Ee.element.tickertext=e,Ee.element.tickertime=Ee.timestamp}else if(t.length>1)if(Ee.elementisplayer){const n=OL(Ee.elementid);n.sidebar=IK(t)}else{const n=OL(Ee.elementfocus);n.scrollname=Ee.element?.name??Ee.element?.kinddata?.name??"",n.scroll=IK(t)}}}).command("endgame",t=>(t.set("health",0),0)).command("shortsend",(t,e)=>{const n=Fy(e);return HK(t,n),0}).command("send",(t,e)=>{const n=Fy(e,!0);return HK(t,n),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(rc).join("");return zHe(Ee.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=rc(n);return HHe(Ee.elementid,t.id(),i,r,t.get,t.set),0});function _qe(t,e,n,r,i){if(!ge(Ee.book))return;const s=Ee.book,o=Xd(s,Tr.BOARD,t),a=Tl(o);if(!ge(a))return;const c=q3(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Wf(a),Wf(c);const h=-Math.tan(e*.5),d=Math.sin(e),m=Math.round(12.5*h),p=Math.round(12.5*d),g=new Array(Nr).fill(0);D$(m,0,-m,Nr-1).forEach(C=>{C.x<0?g[C.y]=Math.min(g[C.y],C.x):g[C.y]=Math.max(g[C.y],C.x)});const v=new Array(wn).fill(0);D$(0,p,wn-1,-p).forEach(C=>{C.y<0?v[C.x]=Math.min(v[C.x],C.y):v[C.x]=Math.max(v[C.x],C.y)});const E=[g,v,g];for(let C=0;C<E.length;++C){const A=E[C];if(C!==1){for(let k=0;k<Nr;++k){const M=A[k],I=k*wn;for(let z=0;z<wn;z++){const H=(z+M+wn)%wn;u&&(c.terrain[H+I]=a.terrain[z+I])}}if(l){const k=Object.keys(a.objects);for(let M=0;M<k.length;++M){const I=k[M],{x:z,y:H}=a.objects[I];if(ge(z)&&ge(H)){const K=A[H];a.objects[I].x=(z+K+wn)%wn,a.objects[I].lx=a.objects[I].x}}}}if(C===1){for(let k=0;k<wn;++k){const M=A[k];for(let I=0;I<Nr;++I){const z=(I+M+Nr)%Nr;u&&(c.terrain[k+z*wn]=a.terrain[k+I*wn])}}if(l){const k=Object.keys(a.objects);for(let M=0;M<k.length;++M){const I=k[M],{x:z,y:H}=a.objects[I];if(ge(z)&&ge(H)){const K=A[z];a.objects[I].y=(H+K+Nr)%Nr,a.objects[I].ly=a.objects[I].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Wf(c),Wf(a)}}var IL,qK;function vqe(){if(qK)return IL;qK=1;function t(e,n){let r=0,i=0,s=0;for(;s<e.length;s++)r+=e[s];for(s=0,n*=r;n&&s<e.length;){if(i+=e[s],n<=i)return s;s++}return 0}return IL=t,IL}var NL,VK;function Hce(){if(VK)return NL;VK=1;const t=vqe(),e=function(){};return e.prototype.FMX=0,e.prototype.FMY=0,e.prototype.FMXxFMY=0,e.prototype.T=0,e.prototype.N=0,e.prototype.initiliazedField=!1,e.prototype.generationComplete=!1,e.prototype.wave=null,e.prototype.compatible=null,e.prototype.weightLogWeights=null,e.prototype.sumOfWeights=0,e.prototype.sumOfWeightLogWeights=0,e.prototype.startingEntropy=0,e.prototype.sumsOfOnes=null,e.prototype.sumsOfWeights=null,e.prototype.sumsOfWeightLogWeights=null,e.prototype.entropies=null,e.prototype.propagator=null,e.prototype.observed=null,e.prototype.distribution=null,e.prototype.stack=null,e.prototype.stackSize=0,e.prototype.DX=[-1,0,1,0],e.prototype.DY=[0,1,0,-1],e.prototype.opposite=[2,3,0,1],e.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let n=0;n<this.FMXxFMY;n++){this.wave[n]=new Array(this.T),this.compatible[n]=new Array(this.T);for(let r=0;r<this.T;r++)this.compatible[n][r]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let n=0;n<this.T;n++)this.weightLogWeights[n]=this.weights[n]*Math.log(this.weights[n]),this.sumOfWeights+=this.weights[n],this.sumOfWeightLogWeights+=this.weightLogWeights[n];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},e.prototype.observe=function(n){let r=1e3,i=-1;for(let a=0;a<this.FMXxFMY;a++){if(this.onBoundary(a%this.FMX,a/this.FMX|0))continue;const c=this.sumsOfOnes[a];if(c===0)return!1;const l=this.entropies[a];if(c>1&&l<=r){const u=1e-6*n();l+u<r&&(r=l+u,i=a)}}if(i===-1){this.observed=new Array(this.FMXxFMY);for(let a=0;a<this.FMXxFMY;a++)for(let c=0;c<this.T;c++)if(this.wave[a][c]){this.observed[a]=c;break}return!0}for(let a=0;a<this.T;a++)this.distribution[a]=this.wave[i][a]?this.weights[a]:0;const s=t(this.distribution,n()),o=this.wave[i];for(let a=0;a<this.T;a++)o[a]!==(a===s)&&this.ban(i,a);return null},e.prototype.propagate=function(){for(;this.stackSize>0;){const n=this.stack[this.stackSize-1];this.stackSize--;const r=n[0],i=r%this.FMX,s=r/this.FMX|0;for(let o=0;o<4;o++){const a=this.DX[o],c=this.DY[o];let l=i+a,u=s+c;if(this.onBoundary(l,u))continue;l<0?l+=this.FMX:l>=this.FMX&&(l-=this.FMX),u<0?u+=this.FMY:u>=this.FMY&&(u-=this.FMY);const h=l+u*this.FMX,d=this.propagator[o][n[1]],m=this.compatible[h];for(let p=0;p<d.length;p++){const g=d[p],y=m[g];y[o]--,y[o]==0&&this.ban(h,g)}}}},e.prototype.singleIteration=function(n){const r=this.observe(n);return r!==null?(this.generationComplete=r,!!r):(this.propagate(),null)},e.prototype.iterate=function(n,r){this.wave||this.initialize(),this.initiliazedField||this.clear(),n=n||0,r=r||Math.random;for(let i=0;i<n||n===0;i++){const s=this.singleIteration(r);if(s!==null)return!!s}return!0},e.prototype.generate=function(n){for(n=n||Math.random,this.wave||this.initialize(),this.clear();;){const r=this.singleIteration(n);if(r!==null)return!!r}},e.prototype.isGenerationComplete=function(){return this.generationComplete},e.prototype.ban=function(n,r){const i=this.compatible[n][r];for(let o=0;o<4;o++)i[o]=0;this.wave[n][r]=!1,this.stack[this.stackSize]=[n,r],this.stackSize++,this.sumsOfOnes[n]-=1,this.sumsOfWeights[n]-=this.weights[r],this.sumsOfWeightLogWeights[n]-=this.weightLogWeights[r];const s=this.sumsOfWeights[n];this.entropies[n]=Math.log(s)-this.sumsOfWeightLogWeights[n]/s},e.prototype.clear=function(){for(let n=0;n<this.FMXxFMY;n++){for(let r=0;r<this.T;r++){this.wave[n][r]=!0;for(let i=0;i<4;i++)this.compatible[n][r][i]=this.propagator[this.opposite[i]][r].length}this.sumsOfOnes[n]=this.weights.length,this.sumsOfWeights[n]=this.sumOfWeights,this.sumsOfWeightLogWeights[n]=this.sumOfWeightLogWeights,this.entropies[n]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1},NL=e,NL}var PL,GK;function yqe(){if(GK)return PL;GK=1;const t=Hce(),e=function(r,i,s,o,a,c,l,u,h,d){d=d||0,this.N=o,this.FMX=a,this.FMY=c,this.FMXxFMY=a*c,this.periodic=u;const m=i,p=new Array(m);for(let K=0;K<m;K++)p[K]=new Array(s);this.colors=[];const g={};for(let K=0;K<s;K++)for(let P=0;P<i;P++){const F=(K*i+P)*4,N=[r[F],r[F+1],r[F+2],r[F+3]],X=N.join("-");g.hasOwnProperty(X)||(g[X]=this.colors.length,this.colors.push(N)),p[P][K]=g[X]}const y=this.colors.length,v=Math.pow(y,o*o),x=function(P){let F=new Array(o*o);for(let N=0;N<o;N++)for(let X=0;X<o;X++)F[X+N*o]=P(X,N);return F},E=function(P,F){return x(function(N,X){return p[(P+N)%i][(F+X)%s]})},C=function(P){return x(function(F,N){return P[o-1-N+F*o]})},A=function(P){return x(function(F,N){return P[o-1-F+N*o]})},k=function(P){let F=0,N=1;for(let X=0;X<P.length;X++)F+=P[P.length-1-X]*N,N*=y;return F},M=function(P){let F=P,N=v;const X=new Array(o*o);for(let G=0;G<X.length;G++){N/=y;let j=0;for(;F>=N;)F-=N,j++;X[G]=j}return X},I={},z=[];for(let K=0;K<(l?s:s-o+1);K++)for(let P=0;P<(l?i:i-o+1);P++){const F=new Array(8);F[0]=E(P,K),F[1]=A(F[0]),F[2]=C(F[0]),F[3]=A(F[2]),F[4]=C(F[2]),F[5]=A(F[4]),F[6]=C(F[4]),F[7]=A(F[6]);for(let N=0;N<h;N++){const X=k(F[N]);I[X]?I[X]++:(z.push(X),I[X]=1)}}this.T=z.length,this.ground=(d+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let K=0;K<this.T;K++){const P=parseInt(z[K],10);this.patterns[K]=M(P),this.weights[K]=I[P]}const H=function(P,F,N,X){const G=N<0?0:N,j=N<0?N+o:o,q=X<0?0:X,te=X<0?X+o:o;for(let W=q;W<te;W++)for(let $=G;$<j;$++)if(P[$+o*W]!=F[$-N+o*(W-X)])return!1;return!0};this.propagator=new Array(4);for(let K=0;K<4;K++){this.propagator[K]=new Array(this.T);for(let P=0;P<this.T;P++){const F=[];for(let N=0;N<this.T;N++)H(this.patterns[P],this.patterns[N],this.DX[K],this.DY[K])&&F.push(N);this.propagator[K][P]=F}}};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(n,r){return!this.periodic&&(n+this.N>this.FMX||r+this.N>this.FMY||n<0||r<0)},e.prototype.clear=function(){if(t.prototype.clear.call(this),this.ground!==0){for(let n=0;n<this.FMX;n++){for(let r=0;r<this.T;r++)r!==this.ground&&this.ban(n+(this.FMY-1)*this.FMX,r);for(let r=0;r<this.FMY-1;r++)this.ban(n+r*this.FMX,this.ground)}this.propagate()}},e.prototype.graphics=function(n){return n=n||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(n):this.graphicsIncomplete(n),n},e.prototype.graphicsComplete=function(n){for(let r=0;r<this.FMY;r++){const i=r<this.FMY-this.N+1?0:this.N-1;for(let s=0;s<this.FMX;s++){const o=s<this.FMX-this.N+1?0:this.N-1,a=(r*this.FMX+s)*4,c=this.colors[this.patterns[this.observed[s-o+(r-i)*this.FMX]][o+i*this.N]];n[a]=c[0],n[a+1]=c[1],n[a+2]=c[2],n[a+3]=c[3]}}},e.prototype.graphicsIncomplete=function(n){for(let r=0;r<this.FMXxFMY;r++){const i=r%this.FMX,s=r/this.FMX|0;let o=0,a=0,c=0,l=0,u=0;for(let d=0;d<this.N;d++)for(let m=0;m<this.N;m++){let p=i-m;p<0&&(p+=this.FMX);let g=s-d;if(g<0&&(g+=this.FMY),this.onBoundary(p,g))continue;const y=p+g*this.FMX;for(let v=0;v<this.T;v++)if(this.wave[y][v]){o++;const x=this.colors[this.patterns[v][m+d*this.N]];a+=x[0],c+=x[1],l+=x[2],u+=x[3]}}const h=r*4;n[h]=a/o,n[h+1]=c/o,n[h+2]=l/o,n[h+3]=u/o}},PL=e,PL}var DL,$K;function bqe(){if($K)return DL;$K=1;const t=Hce(),e=function(r,i,s,o,a){const c=r.tilesize||16;this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=a,this.tilesize=c;const l=!!r.unique;let u=null;i&&r.subsets&&r.subsets[i]&&(u=r.subsets[i]);const h=function(k){const M=new Array(c*c);for(let I=0;I<c;I++)for(let z=0;z<c;z++)M[z+I*c]=k(z,I);return M},d=function(k){return h(function(M,I){return k[c-1-I+M*c]})},m=function(k){return h(function(M,I){return k[c-1-M+I*c]})};this.tiles=[];const p=[],g=[],y={};let v,x,E;for(let A=0;A<r.tiles.length;A++){const k=r.tiles[A];if(u!==null&&u.indexOf(k.name)===-1)continue;switch(k.symmetry){case"L":E=4,v=function(I){return(I+1)%4},x=function(I){return I%2===0?I+1:I-1};break;case"T":E=4,v=function(I){return(I+1)%4},x=function(I){return I%2===0?I:4-I};break;case"I":E=2,v=function(I){return 1-I},x=function(I){return I};break;case"\\":E=2,v=function(I){return 1-I},x=function(I){return 1-I};break;case"F":E=8,v=function(I){return I<4?(I+1)%4:4+(I-1)%4},x=function(I){return I<4?I+4:I-4};break;default:E=1,v=function(I){return I},x=function(I){return I};break}this.T=g.length,y[k.name]=this.T;for(let I=0;I<E;I++)g.push([this.T+I,this.T+v(I),this.T+v(v(I)),this.T+v(v(v(I))),this.T+x(I),this.T+x(v(I)),this.T+x(v(v(I))),this.T+x(v(v(v(I))))]);let M;if(l)for(let I=0;I<E;I++)M=k.bitmap[I],this.tiles.push(h(function(z,H){return[M[(c*H+z)*4],M[(c*H+z)*4+1],M[(c*H+z)*4+2],M[(c*H+z)*4+3]]}));else{M=k.bitmap,this.tiles.push(h(function(I,z){return[M[(c*z+I)*4],M[(c*z+I)*4+1],M[(c*z+I)*4+2],M[(c*z+I)*4+3]]}));for(let I=1;I<E;I++)this.tiles.push(I<4?d(this.tiles[this.T+I-1]):m(this.tiles[this.T+I-4]))}for(let I=0;I<E;I++)p.push(k.weight||1)}this.T=g.length,this.weights=p,this.propagator=new Array(4);const C=new Array(4);for(let A=0;A<4;A++){this.propagator[A]=new Array(this.T),C[A]=new Array(this.T);for(let k=0;k<this.T;k++){C[A][k]=new Array(this.T);for(let M=0;M<this.T;M++)C[A][k][M]=!1}}for(let A=0;A<r.neighbors.length;A++){const k=r.neighbors[A],M=k.left.split(" ").filter(function(F){return F.length}),I=k.right.split(" ").filter(function(F){return F.length});if(u!==null&&(u.indexOf(M[0])===-1||u.indexOf(I[0])===-1))continue;const z=g[y[M[0]]][M.length==1?0:parseInt(M[1],10)],H=g[z][1],K=g[y[I[0]]][I.length==1?0:parseInt(I[1],10)],P=g[K][1];C[0][K][z]=!0,C[0][g[K][6]][g[z][6]]=!0,C[0][g[z][4]][g[K][4]]=!0,C[0][g[z][2]][g[K][2]]=!0,C[1][P][H]=!0,C[1][g[H][6]][g[P][6]]=!0,C[1][g[P][4]][g[H][4]]=!0,C[1][g[H][2]][g[P][2]]=!0}for(let A=0;A<this.T;A++)for(let k=0;k<this.T;k++)C[2][A][k]=C[0][k][A],C[3][A][k]=C[1][k][A];for(let A=0;A<4;A++)for(let k=0;k<this.T;k++){const M=[],I=C[A][k];for(let z=0;z<this.T;z++)I[z]&&M.push(z);this.propagator[A][k]=M}};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(n,r){return!this.periodic&&(n<0||r<0||n>=this.FMX||r>=this.FMY)},e.prototype.graphics=function(n,r){return n=n||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(n):this.graphicsIncomplete(n,r),n},e.prototype.graphicsComplete=function(n){for(let r=0;r<this.FMX;r++)for(let i=0;i<this.FMY;i++){const s=this.tiles[this.observed[r+i*this.FMX]];for(let o=0;o<this.tilesize;o++)for(let a=0;a<this.tilesize;a++){const c=(r*this.tilesize+a+(i*this.tilesize+o)*this.FMX*this.tilesize)*4,l=s[a+o*this.tilesize];n[c]=l[0],n[c+1]=l[1],n[c+2]=l[2],n[c+3]=l[3]}}},e.prototype.graphicsIncomplete=function(n,r){(!r||r.length!==4)&&(r=!1);for(let i=0;i<this.FMX;i++)for(let s=0;s<this.FMY;s++){const o=this.wave[i+s*this.FMX];let a=0,c=0;for(let u=0;u<this.T;u++)o[u]&&(a++,c+=this.weights[u]);const l=1/c;for(let u=0;u<this.tilesize;u++)for(let h=0;h<this.tilesize;h++){const d=(i*this.tilesize+h+(s*this.tilesize+u)*this.FMX*this.tilesize)*4;if(r&&a===this.T)n[d]=r[0],n[d+1]=r[1],n[d+2]=r[2],n[d+3]=r[3];else{let m=0,p=0,g=0,y=0;for(let v=0;v<this.T;v++)if(o[v]){const x=this.tiles[v][h+u*this.tilesize],E=this.weights[v]*l;m+=x[0]*E,p+=x[1]*E,g+=x[2]*E,y+=x[3]*E}n[d]=m,n[d+1]=p,n[d+2]=g,n[d+3]=y}}}},DL=e,DL}var LL,WK;function Eqe(){return WK||(WK=1,LL={OverlappingModel:yqe(),SimpleTiledModel:bqe()}),LL}var Sqe=Eqe();const xqe=su(Sqe),KK=5;function Tqe(t,e,n,r,i,s,o){if(!ge(Ee.book))return!1;const a=Ee.book,c=Xd(a,Tr.BOARD,t),l=Xd(a,Tr.BOARD,e),u=Tl(c),h=Tl(l);if(!ge(u)||!ge(h))return!1;Wf(u),Wf(h);let d=0;const m=new Map,p=new Map;let g=0;const y=32,v=new Uint8Array(fg*4);for(let M=0;M<Nr;++M)for(let I=0;I<wn;++I){const z=ro(h,{x:I,y:M}),H=z?.char??0,K=z?.color??y,P=z?.bg??y;v[g++]=H,v[g++]=K,v[g++]=P;const F=tb(z),N=hr(F?.name??"empty"),X=m.get(N);an(X)?v[g++]=X:(m.set(N,d),p.set(d,N),v[g++]=d++)}const x=s.x-i.x+1,E=s.y-i.y+1,C=new xqe.OverlappingModel(v,wn,Nr,n,x,E,!1,!1,r,0);let A=0;for(;A<KK&&!C.generate();++A);if(A===KK)return!1;g=0;const k=C.graphics();for(let M=i.y;M<=s.y;++M)for(let I=i.x;I<=s.x;++I){const z={x:I,y:M},H=k[g++],K=k[g++],P=k[g++];switch(d=k[g++],o){case"all":{const G=ro(u,{x:I,y:M});Rc(G)&&$d(u,G,a.timestamp),ku(u,{x:I,y:M});break}case"object":{const G=ro(u,{x:I,y:M});Rc(G)&&$d(u,G,a.timestamp);break}case"terrain":ku(u,{x:I,y:M});break}let F=p.get(d)??"";const N=tb({kind:F});switch(o){case"all":break;case"object":Rc(N)||(F="");break;case"terrain":Rc(N)&&(F="");break;default:if(Yr(N,"group")!==o&&(F=""),F){const G=ro(u,{x:I,y:M});Rc(G)&&$d(u,G,a.timestamp),ku(u,{x:I,y:M})}break}const X=F?nm(u,[F],z):void 0;if(!(!ge(X)||!ge(N))&&(G1(X,N),H>0&&(X.char=H),K<y&&(X.color=K),P<y&&(X.bg=P),Rc(X))){const G=Wp(Jx(h,F));ge(G)&&(ku(u,{...V1(h,G.x??0,G.y??0),x:I,y:M}),G1(X,G))}}return!0}function qce(t){return`zss_snapshot_${t}`}const Vce={x:0,y:0},Gce={x:wn-1,y:Nr-1},$ce="all";function wqe(t){const e=Xd(Ee.book,Tr.BOARD,t),n=Tl(e);if(!ge(n))return;const r=qce(n.id);Tae(Ee.book,r);const[i]=GVe(qp.MAIN,r,Tr.BOARD),s=Tl(i);if(ge(s))return $3(t,s.id,Vce,Gce,$ce),s}function Rqe(t){const e=Xd(Ee.book,Tr.BOARD,t),n=Tl(e);if(!ge(n))return;const r=qce(n.id),i=Xd(Ee.book,Tr.BOARD,r),s=Tl(i);if(ge(s))return $3(s.id,t,Vce,Gce,$ce),s}function Cqe(t,e,n,r,i,s){switch(s){case"all":case"object":case"terrain":break;default:return Aqe(t,e,i,s)}if(!ge(Ee.book))return;const o=Ee.book,a=Xd(o,Tr.BOARD,t),c=Tl(a);if(!ge(c))return;const l=q3();Wf(c);for(let u=n.y;u<=r.y;++u)for(let h=n.x;h<=r.x;++h){let d=!1,m=!1;switch(s){case"all":d=!0,m=!0;break;case"object":d=!0;break;case"terrain":m=!0;break}const p=(h+e.x+wn)%wn,g=(u+e.y+Nr)%Nr;if(d){const y=ro(c,{x:h,y:u});Rc(y)&&ge(y?.x)&&ge(y?.y)&&(y.x=p,y.lx=p,y.y=g,y.ly=g)}m&&(l.terrain[p+g*wn]=c.terrain[h+u*wn])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),GA(c)}function Aqe(t,e,n,r){if(!ge(Ee.book))return;const i=Ee.book,s=Xd(i,Tr.BOARD,t),o=Tl(s);if(!ge(o))return;Wf(o);const{terrainelements:a,objectelements:c}=Mae(o,n,r);if(a.length===0&&c.length===0)return;e.x<0&&(a.sort((p,g)=>{const y=p.x??0,v=g.x??0;return y-v}),c.sort((p,g)=>{const y=p.x??0,v=g.x??0;return y-v})),e.x>0&&(a.sort((p,g)=>{const y=p.x??0;return(g.x??0)-y}),c.sort((p,g)=>{const y=p.x??0;return(g.x??0)-y})),e.y<0&&(a.sort((p,g)=>{const y=p.y??0,v=g.y??0;return y-v}),c.sort((p,g)=>{const y=p.y??0,v=g.y??0;return y-v})),e.y>0&&(a.sort((p,g)=>{const y=p.y??0;return(g.y??0)-y}),c.sort((p,g)=>{const y=p.y??0;return(g.y??0)-y}));const l=c.map(p=>p.id??""),u=a.map(p=>Wc({x:p.x??0,y:p.y??0},wn)),h=[],d=[];for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},v=ro(o,y);ge(v)&&Rc(v)&&(h.push(v.id??""),h.push(v.id??""),d.push(Wc({x:v.x??0,y:v.y??0},wn)))}let m=!1;for(let p=0;p<a.length;++p){const g=a[p],y=Yr(g,"collision"),v={x:g.x??-1,y:g.y??-1},x=Wc(v,wn),E={x:v.x+e.x,y:v.y+e.y};if(yx(E)){const C=ro(o,E),A=C?.id??"",k=Wc({x:C?.x??0,y:C?.y??0},wn),M=Yr(C,"collision");if(ge(C)&&Rc(C)&&h.includes(A)!==!0&&l.includes(A)!==!0){let I=!1;const z=d.includes(x),H=z?ro(o,v):void 0,K=z?Yr(H,"pushable"):!1,P=z&&K;if(tB(g,C)&&(y!==Qn.ISWALK||z)){let F=z;ge(H)&&K&&(m=Fd(i,o,H,{x:(H.x??0)-e.x,y:(H.y??0)-e.y})!==!0,m||(F=!1)),(F||y!==Qn.ISWALK)&&(m=Fd(i,o,C,{x:(C.x??0)+e.x,y:(C.y??0)+e.y})!==!0,m&&(I=P))}else(y!==Qn.ISWALK||P)&&(m=!0,I=P);I&&ge(H)&&(m=Fd(i,o,H,{x:(H.x??0)-e.x,y:(H.y??0)-e.y})!==!0)}else M===Qn.ISSOLID&&u.includes(k)===!1&&(m=!0)}else m=!0}if(!m){for(let p=0;p<c.length;++p){const g=c[p],y=Yr(g,"collision"),v={x:g.x??0,y:g.y??0},x={x:v.x+e.x,y:v.y+e.y};if(yx(x)){const E=ro(o,x),C=E?.id??"",A=Yr(E,"collision"),k=Yr(E,"group");ge(E)&&Rc(E)&&h.includes(C)&&l.includes(C)!==!0?tB(g,E)?m=Fd(i,o,E,x)!==!0:m=!0:H3(y,A)&&r!==k&&(m=!0)}else m=!0}if(!m){for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},v={x:y.x+e.x,y:y.y+e.y},x=V1(o,v.x,v.y);if(ge(g)&&ge(x)){ku(o,{...g,x:v.x,y:v.y}),ku(o,{...x,x:y.x,y:y.y});const E=ro(o,y);Rc(E)&&ge(E)&&(E.x=(E.x??0)+e.x,E.y=(E.y??0)+e.y,E.lx=(E.lx??0)+e.x,E.ly=(E.ly??0)+e.y)}}GA(o);for(let p=0;p<c.length;++p){const g=c[p],y={x:g.x??-1,y:g.y??-1},v={x:y.x+e.x,y:y.y+e.y};if(!Fd(i,o,g,v))break}GA(o)}}}function Nk(t,e){let n="all";const r={x:0,y:0},i={x:wn-1,y:Nr-1};for(let s=e;s<t.length;){const[o,a]=Gt(t,s,[yt.MAYBE_NUMBER_OR_STRING]);if(Sn(o))n=hr(o),s=a;else if(an(o)){const[c,l,u,h]=Gt(t,a,[yt.NUMBER,yt.MAYBE_NUMBER,yt.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=h}else break}return{targetset:n,pt1:r,pt2:i}}function XK(t,e){const n=nv();for(let r=0;r<n.length;++r){const i=n[r],s=Wp(D5(i,t,e));if(ge(s))return s}}const Mqe=Uv().command("snapshot",()=>(!ge(Ee.book)||!ge(Ee.board)||wqe(Ee.board.id),0)).command("revert",()=>(!ge(Ee.book)||!ge(Ee.board)||Rqe(Ee.board.id),0)).command("copy",(t,e)=>{if(!ge(Ee.book)||!ge(Ee.board))return 0;const[n,r]=Gt(e,0,[yt.STRING]),i=XK(Tr.BOARD,n);if(ge(i)){const s=Nk(e,r);$3(i.id,Ee.board.id,s.pt1,s.pt2,s.targetset)}return 0}).command("remix",(t,e)=>{if(!ge(Ee.book)||!ge(Ee.board))return 0;const[n,r,i,s]=Gt(e,0,[yt.STRING,yt.NUMBER,yt.NUMBER]),o=XK(Tr.BOARD,n);if(ge(o)){const a=Nk(e,s);Tqe(Ee.board.id,o.id,r,i,a.pt1,a.pt2,a.targetset)}return 0}).command("weave",(t,e)=>{if(!ge(Ee.book)||!ge(Ee.board))return 0;const[n,r]=Gt(e,0,[yt.DIR]),i={x:n.destpt.x-(Ee.element?.x??0),y:n.destpt.y-(Ee.element?.y??0)},s=Nk(e,r);return Cqe(Ee.board.id,i,s.pt1,s.pt2,Ee.elementid,s.targetset),0}).command("pivot",(t,e)=>{if(!ge(Ee.book)||!ge(Ee.board))return 0;const[n,r]=Gt(e,0,[yt.NUMBER]),i=Nk(e,r);return _qe(Ee.board.id,BEe(n),i.pt1,i.pt2,i.targetset),0});var T7=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(T7||{});const kqe={audio:G3,board:RBe,cli:GHe,display:$He,element:ZHe,runtime:gqe,loader:pqe,network:mqe,transform:Mqe},UL=["audio","board","display","network","transform","element"],Oqe={0:[],1:["cli",...UL],2:["loader",...UL],3:["runtime",...UL]},Iqe={0:new Map,1:new Map,2:new Map,3:new Map};function $M(t){return(Oqe[t]??[]).map(n=>kqe[n]).filter(ge)}function Nqe(t,e){const n=Iqe[t];if(!n.has(e)){let r;const i=$M(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!ge(r));++s);n.set(e,r)}return n.get(e)}function Pqe(t,e,n){const r=$M(t);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(e,n);if(o)return[o,a]}}return[!1,void 0]}function Dqe(t,e,n,r){const i=$M(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,n,r);if(a)return[a,r]}}return[!1,void 0]}function Lqe(t,e){const n=$M(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}function Uqe(t,e){const n=$M(t);for(let r=0;r<n.length;++r)n[r].aftertick(e)}var _C={},BL={},FL={},jL={},YK;function Bqe(){if(YK)return jL;YK=1;const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return jL.encode=function(e){if(0<=e&&e<t.length)return t[e];throw new TypeError("Must be between 0 and 63: "+e)},jL}var ZK;function Wce(){if(ZK)return FL;ZK=1;const t=Bqe(),e=5,n=1<<e,r=n-1,i=n;function s(o){return o<0?(-o<<1)+1:(o<<1)+0}return FL.encode=function(a){let c="",l,u=s(a);do l=u&r,u>>>=e,u>0&&(l|=i),c+=t.encode(l);while(u>0);return c},FL}var eg={},Hb={},ZC={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var Fqe=ZC.exports,JK;function jqe(){return JK||(JK=1,(function(t,e){(function(n){var r=e&&!e.nodeType&&e,i=t&&!t.nodeType&&t,s=typeof Zp=="object"&&Zp;(s.global===s||s.window===s||s.self===s)&&(n=s);var o,a=2147483647,c=36,l=1,u=26,h=38,d=700,m=72,p=128,g="-",y=/^xn--/,v=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},C=c-l,A=Math.floor,k=String.fromCharCode,M;function I(W){throw new RangeError(E[W])}function z(W,$){for(var J=W.length,ne=[];J--;)ne[J]=$(W[J]);return ne}function H(W,$){var J=W.split("@"),ne="";J.length>1&&(ne=J[0]+"@",W=J[1]),W=W.replace(x,".");var ie=W.split("."),ae=z(ie,$).join(".");return ne+ae}function K(W){for(var $=[],J=0,ne=W.length,ie,ae;J<ne;)ie=W.charCodeAt(J++),ie>=55296&&ie<=56319&&J<ne?(ae=W.charCodeAt(J++),(ae&64512)==56320?$.push(((ie&1023)<<10)+(ae&1023)+65536):($.push(ie),J--)):$.push(ie);return $}function P(W){return z(W,function($){var J="";return $>65535&&($-=65536,J+=k($>>>10&1023|55296),$=56320|$&1023),J+=k($),J}).join("")}function F(W){return W-48<10?W-22:W-65<26?W-65:W-97<26?W-97:c}function N(W,$){return W+22+75*(W<26)-(($!=0)<<5)}function X(W,$,J){var ne=0;for(W=J?A(W/d):W>>1,W+=A(W/$);W>C*u>>1;ne+=c)W=A(W/C);return A(ne+(C+1)*W/(W+h))}function G(W){var $=[],J=W.length,ne,ie=0,ae=p,xe=m,Ne,Re,Se,ze,Be,Je,at,re,Le;for(Ne=W.lastIndexOf(g),Ne<0&&(Ne=0),Re=0;Re<Ne;++Re)W.charCodeAt(Re)>=128&&I("not-basic"),$.push(W.charCodeAt(Re));for(Se=Ne>0?Ne+1:0;Se<J;){for(ze=ie,Be=1,Je=c;Se>=J&&I("invalid-input"),at=F(W.charCodeAt(Se++)),(at>=c||at>A((a-ie)/Be))&&I("overflow"),ie+=at*Be,re=Je<=xe?l:Je>=xe+u?u:Je-xe,!(at<re);Je+=c)Le=c-re,Be>A(a/Le)&&I("overflow"),Be*=Le;ne=$.length+1,xe=X(ie-ze,ne,ze==0),A(ie/ne)>a-ae&&I("overflow"),ae+=A(ie/ne),ie%=ne,$.splice(ie++,0,ae)}return P($)}function j(W){var $,J,ne,ie,ae,xe,Ne,Re,Se,ze,Be,Je=[],at,re,Le,He;for(W=K(W),at=W.length,$=p,J=0,ae=m,xe=0;xe<at;++xe)Be=W[xe],Be<128&&Je.push(k(Be));for(ne=ie=Je.length,ie&&Je.push(g);ne<at;){for(Ne=a,xe=0;xe<at;++xe)Be=W[xe],Be>=$&&Be<Ne&&(Ne=Be);for(re=ne+1,Ne-$>A((a-J)/re)&&I("overflow"),J+=(Ne-$)*re,$=Ne,xe=0;xe<at;++xe)if(Be=W[xe],Be<$&&++J>a&&I("overflow"),Be==$){for(Re=J,Se=c;ze=Se<=ae?l:Se>=ae+u?u:Se-ae,!(Re<ze);Se+=c)He=Re-ze,Le=c-ze,Je.push(k(N(ze+He%Le,0))),Re=A(He/Le);Je.push(k(N(Re,0))),ae=X(J,re,ne==ie),J=0,++ne}++J,++$}return Je.join("")}function q(W){return H(W,function($){return y.test($)?G($.slice(4).toLowerCase()):$})}function te(W){return H(W,function($){return v.test($)?"xn--"+j($):$})}if(o={version:"1.4.1",ucs2:{decode:K,encode:P},decode:G,encode:j,toASCII:te,toUnicode:q},r&&i)if(t.exports==r)i.exports=o;else for(M in o)o.hasOwnProperty(M)&&(r[M]=o[M]);else n.punycode=o})(Fqe)})(ZC,ZC.exports)),ZC.exports}var zL,QK;function rT(){return QK||(QK=1,zL=TypeError),zL}const zqe={},Hqe=Object.freeze(Object.defineProperty({__proto__:null,default:zqe},Symbol.toStringTag,{value:"Module"})),qqe=ZQ(Hqe);var HL,eX;function cP(){if(eX)return HL;eX=1;var t=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&t?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,n=t&&e&&typeof e.get=="function"?e.get:null,r=t&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=i&&s&&typeof s.get=="function"?s.get:null,a=i&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,l=c?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,h=u?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,m=d?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,g=Object.prototype.toString,y=Function.prototype.toString,v=String.prototype.match,x=String.prototype.slice,E=String.prototype.replace,C=String.prototype.toUpperCase,A=String.prototype.toLowerCase,k=RegExp.prototype.test,M=Array.prototype.concat,I=Array.prototype.join,z=Array.prototype.slice,H=Math.floor,K=typeof BigInt=="function"?BigInt.prototype.valueOf:null,P=Object.getOwnPropertySymbols,F=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,N=typeof Symbol=="function"&&typeof Symbol.iterator=="object",X=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===N||!0)?Symbol.toStringTag:null,G=Object.prototype.propertyIsEnumerable,j=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(Te){return Te.__proto__}:null);function q(Te,ye){if(Te===1/0||Te===-1/0||Te!==Te||Te&&Te>-1e3&&Te<1e3||k.call(/e/,ye))return ye;var Ye=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof Te=="number"){var Pe=Te<0?-H(-Te):H(Te);if(Pe!==Te){var We=String(Pe),Ve=x.call(ye,We.length+1);return E.call(We,Ye,"$&_")+"."+E.call(E.call(Ve,/([0-9]{3})/g,"$&_"),/_$/,"")}}return E.call(ye,Ye,"$&_")}var te=qqe,W=te.custom,$=re(W)?W:null,J={__proto__:null,double:'"',single:"'"},ne={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};HL=function Te(ye,Ye,Pe,We){var Ve=Ye||{};if(Ue(Ve,"quoteStyle")&&!Ue(J,Ve.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ue(Ve,"maxStringLength")&&(typeof Ve.maxStringLength=="number"?Ve.maxStringLength<0&&Ve.maxStringLength!==1/0:Ve.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Xe=Ue(Ve,"customInspect")?Ve.customInspect:!0;if(typeof Xe!="boolean"&&Xe!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ue(Ve,"indent")&&Ve.indent!==null&&Ve.indent!=="	"&&!(parseInt(Ve.indent,10)===Ve.indent&&Ve.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ue(Ve,"numericSeparator")&&typeof Ve.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var lt=Ve.numericSeparator;if(typeof ye>"u")return"undefined";if(ye===null)return"null";if(typeof ye=="boolean")return ye?"true":"false";if(typeof ye=="string")return Ft(ye,Ve);if(typeof ye=="number"){if(ye===0)return 1/0/ye>0?"0":"-0";var qe=String(ye);return lt?q(ye,qe):qe}if(typeof ye=="bigint"){var rt=String(ye)+"n";return lt?q(ye,rt):rt}var it=typeof Ve.depth>"u"?5:Ve.depth;if(typeof Pe>"u"&&(Pe=0),Pe>=it&&it>0&&typeof ye=="object")return Ne(ye)?"[Array]":"[Object]";var nt=le(Ve,Pe);if(typeof We>"u")We=[];else if(ve(We,ye)>=0)return"[Circular]";function ct(zi,ds,ps){if(ds&&(We=z.call(We),We.push(ds)),ps){var je={depth:Ve.depth};return Ue(Ve,"quoteStyle")&&(je.quoteStyle=Ve.quoteStyle),Te(zi,je,Pe+1,We)}return Te(zi,Ve,Pe+1,We)}if(typeof ye=="function"&&!Se(ye)){var Qt=fe(ye),tn=Me(ye,ct);return"[Function"+(Qt?": "+Qt:" (anonymous)")+"]"+(tn.length>0?" { "+I.call(tn,", ")+" }":"")}if(re(ye)){var Ot=N?E.call(String(ye),/^(Symbol\(.*\))_[^)]*$/,"$1"):F.call(ye);return typeof ye=="object"&&!N?Mt(Ot):Ot}if(tt(ye)){for(var qt="<"+A.call(String(ye.nodeName)),vt=ye.attributes||[],Kt=0;Kt<vt.length;Kt++)qt+=" "+vt[Kt].name+"="+ie(ae(vt[Kt].value),"double",Ve);return qt+=">",ye.childNodes&&ye.childNodes.length&&(qt+="..."),qt+="</"+A.call(String(ye.nodeName))+">",qt}if(Ne(ye)){if(ye.length===0)return"[]";var _n=Me(ye,ct);return nt&&!Q(_n)?"["+we(_n,nt)+"]":"[ "+I.call(_n,", ")+" ]"}if(ze(ye)){var Wt=Me(ye,ct);return!("cause"in Error.prototype)&&"cause"in ye&&!G.call(ye,"cause")?"{ ["+String(ye)+"] "+I.call(M.call("[cause]: "+ct(ye.cause),Wt),", ")+" }":Wt.length===0?"["+String(ye)+"]":"{ ["+String(ye)+"] "+I.call(Wt,", ")+" }"}if(typeof ye=="object"&&Xe){if($&&typeof ye[$]=="function"&&te)return te(ye,{depth:it-Pe});if(Xe!=="symbol"&&typeof ye.inspect=="function")return ye.inspect()}if(Ae(ye)){var dn=[];return r&&r.call(ye,function(zi,ds){dn.push(ct(ds,ye,!0)+" => "+ct(zi,ye))}),ce("Map",n.call(ye),dn,nt)}if(Qe(ye)){var Mn=[];return a&&a.call(ye,function(zi){Mn.push(ct(zi,ye))}),ce("Set",o.call(ye),Mn,nt)}if(pe(ye))return Ie("WeakMap");if(Ze(ye))return Ie("WeakSet");if(Ge(ye))return Ie("WeakRef");if(Je(ye))return Mt(ct(Number(ye)));if(Le(ye))return Mt(ct(K.call(ye)));if(at(ye))return Mt(p.call(ye));if(Be(ye))return Mt(ct(String(ye)));if(typeof window<"u"&&ye===window)return"{ [object Window] }";if(typeof globalThis<"u"&&ye===globalThis||typeof Zp<"u"&&ye===Zp)return"{ [object globalThis] }";if(!Re(ye)&&!Se(ye)){var Ln=Me(ye,ct),is=j?j(ye)===Object.prototype:ye instanceof Object||ye.constructor===Object,ni=ye instanceof Object?"":"null prototype",fi=!is&&X&&Object(ye)===ye&&X in ye?x.call(De(ye),8,-1):ni?"Object":"",Ps=is||typeof ye.constructor!="function"?"":ye.constructor.name?ye.constructor.name+" ":"",Ds=Ps+(fi||ni?"["+I.call(M.call([],fi||[],ni||[]),": ")+"] ":"");return Ln.length===0?Ds+"{}":nt?Ds+"{"+we(Ln,nt)+"}":Ds+"{ "+I.call(Ln,", ")+" }"}return String(ye)};function ie(Te,ye,Ye){var Pe=Ye.quoteStyle||ye,We=J[Pe];return We+Te+We}function ae(Te){return E.call(String(Te),/"/g,"&quot;")}function xe(Te){return!X||!(typeof Te=="object"&&(X in Te||typeof Te[X]<"u"))}function Ne(Te){return De(Te)==="[object Array]"&&xe(Te)}function Re(Te){return De(Te)==="[object Date]"&&xe(Te)}function Se(Te){return De(Te)==="[object RegExp]"&&xe(Te)}function ze(Te){return De(Te)==="[object Error]"&&xe(Te)}function Be(Te){return De(Te)==="[object String]"&&xe(Te)}function Je(Te){return De(Te)==="[object Number]"&&xe(Te)}function at(Te){return De(Te)==="[object Boolean]"&&xe(Te)}function re(Te){if(N)return Te&&typeof Te=="object"&&Te instanceof Symbol;if(typeof Te=="symbol")return!0;if(!Te||typeof Te!="object"||!F)return!1;try{return F.call(Te),!0}catch{}return!1}function Le(Te){if(!Te||typeof Te!="object"||!K)return!1;try{return K.call(Te),!0}catch{}return!1}var He=Object.prototype.hasOwnProperty||function(Te){return Te in this};function Ue(Te,ye){return He.call(Te,ye)}function De(Te){return g.call(Te)}function fe(Te){if(Te.name)return Te.name;var ye=v.call(y.call(Te),/^function\s*([\w$]+)/);return ye?ye[1]:null}function ve(Te,ye){if(Te.indexOf)return Te.indexOf(ye);for(var Ye=0,Pe=Te.length;Ye<Pe;Ye++)if(Te[Ye]===ye)return Ye;return-1}function Ae(Te){if(!n||!Te||typeof Te!="object")return!1;try{n.call(Te);try{o.call(Te)}catch{return!0}return Te instanceof Map}catch{}return!1}function pe(Te){if(!l||!Te||typeof Te!="object")return!1;try{l.call(Te,l);try{h.call(Te,h)}catch{return!0}return Te instanceof WeakMap}catch{}return!1}function Ge(Te){if(!m||!Te||typeof Te!="object")return!1;try{return m.call(Te),!0}catch{}return!1}function Qe(Te){if(!o||!Te||typeof Te!="object")return!1;try{o.call(Te);try{n.call(Te)}catch{return!0}return Te instanceof Set}catch{}return!1}function Ze(Te){if(!h||!Te||typeof Te!="object")return!1;try{h.call(Te,h);try{l.call(Te,l)}catch{return!0}return Te instanceof WeakSet}catch{}return!1}function tt(Te){return!Te||typeof Te!="object"?!1:typeof HTMLElement<"u"&&Te instanceof HTMLElement?!0:typeof Te.nodeName=="string"&&typeof Te.getAttribute=="function"}function Ft(Te,ye){if(Te.length>ye.maxStringLength){var Ye=Te.length-ye.maxStringLength,Pe="... "+Ye+" more character"+(Ye>1?"s":"");return Ft(x.call(Te,0,ye.maxStringLength),ye)+Pe}var We=ne[ye.quoteStyle||"single"];We.lastIndex=0;var Ve=E.call(E.call(Te,We,"\\$1"),/[\x00-\x1f]/g,bt);return ie(Ve,"single",ye)}function bt(Te){var ye=Te.charCodeAt(0),Ye={8:"b",9:"t",10:"n",12:"f",13:"r"}[ye];return Ye?"\\"+Ye:"\\x"+(ye<16?"0":"")+C.call(ye.toString(16))}function Mt(Te){return"Object("+Te+")"}function Ie(Te){return Te+" { ? }"}function ce(Te,ye,Ye,Pe){var We=Pe?we(Ye,Pe):I.call(Ye,", ");return Te+" ("+ye+") {"+We+"}"}function Q(Te){for(var ye=0;ye<Te.length;ye++)if(ve(Te[ye],`
`)>=0)return!1;return!0}function le(Te,ye){var Ye;if(Te.indent==="	")Ye="	";else if(typeof Te.indent=="number"&&Te.indent>0)Ye=I.call(Array(Te.indent+1)," ");else return null;return{base:Ye,prev:I.call(Array(ye+1),Ye)}}function we(Te,ye){if(Te.length===0)return"";var Ye=`
`+ye.prev+ye.base;return Ye+I.call(Te,","+Ye)+`
`+ye.prev}function Me(Te,ye){var Ye=Ne(Te),Pe=[];if(Ye){Pe.length=Te.length;for(var We=0;We<Te.length;We++)Pe[We]=Ue(Te,We)?ye(Te[We],Te):""}var Ve=typeof P=="function"?P(Te):[],Xe;if(N){Xe={};for(var lt=0;lt<Ve.length;lt++)Xe["$"+Ve[lt]]=Ve[lt]}for(var qe in Te)Ue(Te,qe)&&(Ye&&String(Number(qe))===qe&&qe<Te.length||N&&Xe["$"+qe]instanceof Symbol||(k.call(/[^\w$]/,qe)?Pe.push(ye(qe,Te)+": "+ye(Te[qe],Te)):Pe.push(qe+": "+ye(Te[qe],Te))));if(typeof P=="function")for(var rt=0;rt<Ve.length;rt++)G.call(Te,Ve[rt])&&Pe.push("["+ye(Ve[rt])+"]: "+ye(Te[Ve[rt]],Te));return Pe}return HL}var qL,tX;function Vqe(){if(tX)return qL;tX=1;var t=cP(),e=rT(),n=function(a,c,l){for(var u=a,h;(h=u.next)!=null;u=h)if(h.key===c)return u.next=h.next,l||(h.next=a.next,a.next=h),h},r=function(a,c){if(a){var l=n(a,c);return l&&l.value}},i=function(a,c,l){var u=n(a,c);u?u.value=l:a.next={key:c,next:a.next,value:l}},s=function(a,c){return a?!!n(a,c):!1},o=function(a,c){if(a)return n(a,c,!0)};return qL=function(){var c,l={assert:function(u){if(!l.has(u))throw new e("Side channel does not contain "+t(u))},delete:function(u){var h=c&&c.next,d=o(c,u);return d&&h&&h===d&&(c=void 0),!!d},get:function(u){return r(c,u)},has:function(u){return s(c,u)},set:function(u,h){c||(c={next:void 0}),i(c,u,h)}};return l},qL}var VL,nX;function Kce(){return nX||(nX=1,VL=Object),VL}var GL,rX;function Gqe(){return rX||(rX=1,GL=Error),GL}var $L,iX;function $qe(){return iX||(iX=1,$L=EvalError),$L}var WL,sX;function Wqe(){return sX||(sX=1,WL=RangeError),WL}var KL,oX;function Kqe(){return oX||(oX=1,KL=ReferenceError),KL}var XL,aX;function Xqe(){return aX||(aX=1,XL=SyntaxError),XL}var YL,cX;function Yqe(){return cX||(cX=1,YL=URIError),YL}var ZL,lX;function Zqe(){return lX||(lX=1,ZL=Math.abs),ZL}var JL,uX;function Jqe(){return uX||(uX=1,JL=Math.floor),JL}var QL,fX;function Qqe(){return fX||(fX=1,QL=Math.max),QL}var e4,hX;function eVe(){return hX||(hX=1,e4=Math.min),e4}var t4,dX;function tVe(){return dX||(dX=1,t4=Math.pow),t4}var n4,pX;function nVe(){return pX||(pX=1,n4=Math.round),n4}var r4,mX;function rVe(){return mX||(mX=1,r4=Number.isNaN||function(e){return e!==e}),r4}var i4,gX;function iVe(){if(gX)return i4;gX=1;var t=rVe();return i4=function(n){return t(n)||n===0?n:n<0?-1:1},i4}var s4,_X;function sVe(){return _X||(_X=1,s4=Object.getOwnPropertyDescriptor),s4}var o4,vX;function Xce(){if(vX)return o4;vX=1;var t=sVe();if(t)try{t([],"length")}catch{t=null}return o4=t,o4}var a4,yX;function oVe(){if(yX)return a4;yX=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return a4=t,a4}var c4,bX;function aVe(){return bX||(bX=1,c4=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[n]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,n);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),c4}var l4,EX;function cVe(){if(EX)return l4;EX=1;var t=typeof Symbol<"u"&&Symbol,e=aVe();return l4=function(){return typeof t!="function"||typeof Symbol!="function"||typeof t("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},l4}var u4,SX;function Yce(){return SX||(SX=1,u4=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),u4}var f4,xX;function Zce(){if(xX)return f4;xX=1;var t=Kce();return f4=t.getPrototypeOf||null,f4}var h4,TX;function lVe(){if(TX)return h4;TX=1;var t="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,n=Math.max,r="[object Function]",i=function(c,l){for(var u=[],h=0;h<c.length;h+=1)u[h]=c[h];for(var d=0;d<l.length;d+=1)u[d+c.length]=l[d];return u},s=function(c,l){for(var u=[],h=l,d=0;h<c.length;h+=1,d+=1)u[d]=c[h];return u},o=function(a,c){for(var l="",u=0;u<a.length;u+=1)l+=a[u],u+1<a.length&&(l+=c);return l};return h4=function(c){var l=this;if(typeof l!="function"||e.apply(l)!==r)throw new TypeError(t+l);for(var u=s(arguments,1),h,d=function(){if(this instanceof h){var v=l.apply(this,i(u,arguments));return Object(v)===v?v:this}return l.apply(c,i(u,arguments))},m=n(0,l.length-u.length),p=[],g=0;g<m;g++)p[g]="$"+g;if(h=Function("binder","return function ("+o(p,",")+"){ return binder.apply(this,arguments); }")(d),l.prototype){var y=function(){};y.prototype=l.prototype,h.prototype=new y,y.prototype=null}return h},h4}var d4,wX;function lP(){if(wX)return d4;wX=1;var t=lVe();return d4=Function.prototype.bind||t,d4}var p4,RX;function w7(){return RX||(RX=1,p4=Function.prototype.call),p4}var m4,CX;function Jce(){return CX||(CX=1,m4=Function.prototype.apply),m4}var g4,AX;function uVe(){return AX||(AX=1,g4=typeof Reflect<"u"&&Reflect&&Reflect.apply),g4}var _4,MX;function fVe(){if(MX)return _4;MX=1;var t=lP(),e=Jce(),n=w7(),r=uVe();return _4=r||t.call(n,e),_4}var v4,kX;function Qce(){if(kX)return v4;kX=1;var t=lP(),e=rT(),n=w7(),r=fVe();return v4=function(s){if(s.length<1||typeof s[0]!="function")throw new e("a function is required");return r(t,n,s)},v4}var y4,OX;function hVe(){if(OX)return y4;OX=1;var t=Qce(),e=Xce(),n;try{n=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!n&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return y4=r&&typeof r.get=="function"?t([r.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,y4}var b4,IX;function dVe(){if(IX)return b4;IX=1;var t=Yce(),e=Zce(),n=hVe();return b4=t?function(i){return t(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:n?function(i){return n(i)}:null,b4}var E4,NX;function pVe(){if(NX)return E4;NX=1;var t=Function.prototype.call,e=Object.prototype.hasOwnProperty,n=lP();return E4=n.call(t,e),E4}var S4,PX;function R7(){if(PX)return S4;PX=1;var t,e=Kce(),n=Gqe(),r=$qe(),i=Wqe(),s=Kqe(),o=Xqe(),a=rT(),c=Yqe(),l=Zqe(),u=Jqe(),h=Qqe(),d=eVe(),m=tVe(),p=nVe(),g=iVe(),y=Function,v=function(Se){try{return y('"use strict"; return ('+Se+").constructor;")()}catch{}},x=Xce(),E=oVe(),C=function(){throw new a},A=x?(function(){try{return arguments.callee,C}catch{try{return x(arguments,"callee").get}catch{return C}}})():C,k=cVe()(),M=dVe(),I=Zce(),z=Yce(),H=Jce(),K=w7(),P={},F=typeof Uint8Array>"u"||!M?t:M(Uint8Array),N={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?t:ArrayBuffer,"%ArrayIteratorPrototype%":k&&M?M([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":P,"%AsyncGenerator%":P,"%AsyncGeneratorFunction%":P,"%AsyncIteratorPrototype%":P,"%Atomics%":typeof Atomics>"u"?t:Atomics,"%BigInt%":typeof BigInt>"u"?t:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?t:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":n,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?t:Float16Array,"%Float32Array%":typeof Float32Array>"u"?t:Float32Array,"%Float64Array%":typeof Float64Array>"u"?t:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?t:FinalizationRegistry,"%Function%":y,"%GeneratorFunction%":P,"%Int8Array%":typeof Int8Array>"u"?t:Int8Array,"%Int16Array%":typeof Int16Array>"u"?t:Int16Array,"%Int32Array%":typeof Int32Array>"u"?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":k&&M?M(M([][Symbol.iterator]())):t,"%JSON%":typeof JSON=="object"?JSON:t,"%Map%":typeof Map>"u"?t:Map,"%MapIteratorPrototype%":typeof Map>"u"||!k||!M?t:M(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":x,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?t:Promise,"%Proxy%":typeof Proxy>"u"?t:Proxy,"%RangeError%":i,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?t:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?t:Set,"%SetIteratorPrototype%":typeof Set>"u"||!k||!M?t:M(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":k&&M?M(""[Symbol.iterator]()):t,"%Symbol%":k?Symbol:t,"%SyntaxError%":o,"%ThrowTypeError%":A,"%TypedArray%":F,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?t:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?t:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?t:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?t:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?t:WeakMap,"%WeakRef%":typeof WeakRef>"u"?t:WeakRef,"%WeakSet%":typeof WeakSet>"u"?t:WeakSet,"%Function.prototype.call%":K,"%Function.prototype.apply%":H,"%Object.defineProperty%":E,"%Object.getPrototypeOf%":I,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":h,"%Math.min%":d,"%Math.pow%":m,"%Math.round%":p,"%Math.sign%":g,"%Reflect.getPrototypeOf%":z};if(M)try{null.error}catch(Se){var X=M(M(Se));N["%Error.prototype%"]=X}var G=function Se(ze){var Be;if(ze==="%AsyncFunction%")Be=v("async function () {}");else if(ze==="%GeneratorFunction%")Be=v("function* () {}");else if(ze==="%AsyncGeneratorFunction%")Be=v("async function* () {}");else if(ze==="%AsyncGenerator%"){var Je=Se("%AsyncGeneratorFunction%");Je&&(Be=Je.prototype)}else if(ze==="%AsyncIteratorPrototype%"){var at=Se("%AsyncGenerator%");at&&M&&(Be=M(at.prototype))}return N[ze]=Be,Be},j={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},q=lP(),te=pVe(),W=q.call(K,Array.prototype.concat),$=q.call(H,Array.prototype.splice),J=q.call(K,String.prototype.replace),ne=q.call(K,String.prototype.slice),ie=q.call(K,RegExp.prototype.exec),ae=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,xe=/\\(\\)?/g,Ne=function(ze){var Be=ne(ze,0,1),Je=ne(ze,-1);if(Be==="%"&&Je!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(Je==="%"&&Be!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var at=[];return J(ze,ae,function(re,Le,He,Ue){at[at.length]=He?J(Ue,xe,"$1"):Le||re}),at},Re=function(ze,Be){var Je=ze,at;if(te(j,Je)&&(at=j[Je],Je="%"+at[0]+"%"),te(N,Je)){var re=N[Je];if(re===P&&(re=G(Je)),typeof re>"u"&&!Be)throw new a("intrinsic "+ze+" exists, but is not available. Please file an issue!");return{alias:at,name:Je,value:re}}throw new o("intrinsic "+ze+" does not exist!")};return S4=function(ze,Be){if(typeof ze!="string"||ze.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Be!="boolean")throw new a('"allowMissing" argument must be a boolean');if(ie(/^%?[^%]*%?$/,ze)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Je=Ne(ze),at=Je.length>0?Je[0]:"",re=Re("%"+at+"%",Be),Le=re.name,He=re.value,Ue=!1,De=re.alias;De&&(at=De[0],$(Je,W([0,1],De)));for(var fe=1,ve=!0;fe<Je.length;fe+=1){var Ae=Je[fe],pe=ne(Ae,0,1),Ge=ne(Ae,-1);if((pe==='"'||pe==="'"||pe==="`"||Ge==='"'||Ge==="'"||Ge==="`")&&pe!==Ge)throw new o("property names with quotes must have matching quotes");if((Ae==="constructor"||!ve)&&(Ue=!0),at+="."+Ae,Le="%"+at+"%",te(N,Le))He=N[Le];else if(He!=null){if(!(Ae in He)){if(!Be)throw new a("base intrinsic for "+ze+" exists, but the property is not available.");return}if(x&&fe+1>=Je.length){var Qe=x(He,Ae);ve=!!Qe,ve&&"get"in Qe&&!("originalValue"in Qe.get)?He=Qe.get:He=He[Ae]}else ve=te(He,Ae),He=He[Ae];ve&&!Ue&&(N[Le]=He)}}return He},S4}var x4,DX;function ele(){if(DX)return x4;DX=1;var t=R7(),e=Qce(),n=e([t("%String.prototype.indexOf%")]);return x4=function(i,s){var o=t(i,!!s);return typeof o=="function"&&n(i,".prototype.")>-1?e([o]):o},x4}var T4,LX;function tle(){if(LX)return T4;LX=1;var t=R7(),e=ele(),n=cP(),r=rT(),i=t("%Map%",!0),s=e("Map.prototype.get",!0),o=e("Map.prototype.set",!0),a=e("Map.prototype.has",!0),c=e("Map.prototype.delete",!0),l=e("Map.prototype.size",!0);return T4=!!i&&function(){var h,d={assert:function(m){if(!d.has(m))throw new r("Side channel does not contain "+n(m))},delete:function(m){if(h){var p=c(h,m);return l(h)===0&&(h=void 0),p}return!1},get:function(m){if(h)return s(h,m)},has:function(m){return h?a(h,m):!1},set:function(m,p){h||(h=new i),o(h,m,p)}};return d},T4}var w4,UX;function mVe(){if(UX)return w4;UX=1;var t=R7(),e=ele(),n=cP(),r=tle(),i=rT(),s=t("%WeakMap%",!0),o=e("WeakMap.prototype.get",!0),a=e("WeakMap.prototype.set",!0),c=e("WeakMap.prototype.has",!0),l=e("WeakMap.prototype.delete",!0);return w4=s?function(){var h,d,m={assert:function(p){if(!m.has(p))throw new i("Side channel does not contain "+n(p))},delete:function(p){if(s&&p&&(typeof p=="object"||typeof p=="function")){if(h)return l(h,p)}else if(r&&d)return d.delete(p);return!1},get:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?o(h,p):d&&d.get(p)},has:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?c(h,p):!!d&&d.has(p)},set:function(p,g){s&&p&&(typeof p=="object"||typeof p=="function")?(h||(h=new s),a(h,p,g)):r&&(d||(d=r()),d.set(p,g))}};return m}:r,w4}var R4,BX;function gVe(){if(BX)return R4;BX=1;var t=rT(),e=cP(),n=Vqe(),r=tle(),i=mVe(),s=i||r||n;return R4=function(){var a,c={assert:function(l){if(!c.has(l))throw new t("Side channel does not contain "+e(l))},delete:function(l){return!!a&&a.delete(l)},get:function(l){return a&&a.get(l)},has:function(l){return!!a&&a.has(l)},set:function(l,u){a||(a=s()),a.set(l,u)}};return c},R4}var C4,FX;function C7(){if(FX)return C4;FX=1;var t=String.prototype.replace,e=/%20/g,n={RFC1738:"RFC1738",RFC3986:"RFC3986"};return C4={default:n.RFC3986,formatters:{RFC1738:function(r){return t.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:n.RFC1738,RFC3986:n.RFC3986},C4}var A4,jX;function nle(){if(jX)return A4;jX=1;var t=C7(),e=Object.prototype.hasOwnProperty,n=Array.isArray,r=(function(){for(var y=[],v=0;v<256;++v)y.push("%"+((v<16?"0":"")+v.toString(16)).toUpperCase());return y})(),i=function(v){for(;v.length>1;){var x=v.pop(),E=x.obj[x.prop];if(n(E)){for(var C=[],A=0;A<E.length;++A)typeof E[A]<"u"&&C.push(E[A]);x.obj[x.prop]=C}}},s=function(v,x){for(var E=x&&x.plainObjects?{__proto__:null}:{},C=0;C<v.length;++C)typeof v[C]<"u"&&(E[C]=v[C]);return E},o=function y(v,x,E){if(!x)return v;if(typeof x!="object"&&typeof x!="function"){if(n(v))v.push(x);else if(v&&typeof v=="object")(E&&(E.plainObjects||E.allowPrototypes)||!e.call(Object.prototype,x))&&(v[x]=!0);else return[v,x];return v}if(!v||typeof v!="object")return[v].concat(x);var C=v;return n(v)&&!n(x)&&(C=s(v,E)),n(v)&&n(x)?(x.forEach(function(A,k){if(e.call(v,k)){var M=v[k];M&&typeof M=="object"&&A&&typeof A=="object"?v[k]=y(M,A,E):v.push(A)}else v[k]=A}),v):Object.keys(x).reduce(function(A,k){var M=x[k];return e.call(A,k)?A[k]=y(A[k],M,E):A[k]=M,A},C)},a=function(v,x){return Object.keys(x).reduce(function(E,C){return E[C]=x[C],E},v)},c=function(y,v,x){var E=y.replace(/\+/g," ");if(x==="iso-8859-1")return E.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(E)}catch{return E}},l=1024,u=function(v,x,E,C,A){if(v.length===0)return v;var k=v;if(typeof v=="symbol"?k=Symbol.prototype.toString.call(v):typeof v!="string"&&(k=String(v)),E==="iso-8859-1")return escape(k).replace(/%u[0-9a-f]{4}/gi,function(F){return"%26%23"+parseInt(F.slice(2),16)+"%3B"});for(var M="",I=0;I<k.length;I+=l){for(var z=k.length>=l?k.slice(I,I+l):k,H=[],K=0;K<z.length;++K){var P=z.charCodeAt(K);if(P===45||P===46||P===95||P===126||P>=48&&P<=57||P>=65&&P<=90||P>=97&&P<=122||A===t.RFC1738&&(P===40||P===41)){H[H.length]=z.charAt(K);continue}if(P<128){H[H.length]=r[P];continue}if(P<2048){H[H.length]=r[192|P>>6]+r[128|P&63];continue}if(P<55296||P>=57344){H[H.length]=r[224|P>>12]+r[128|P>>6&63]+r[128|P&63];continue}K+=1,P=65536+((P&1023)<<10|z.charCodeAt(K)&1023),H[H.length]=r[240|P>>18]+r[128|P>>12&63]+r[128|P>>6&63]+r[128|P&63]}M+=H.join("")}return M},h=function(v){for(var x=[{obj:{o:v},prop:"o"}],E=[],C=0;C<x.length;++C)for(var A=x[C],k=A.obj[A.prop],M=Object.keys(k),I=0;I<M.length;++I){var z=M[I],H=k[z];typeof H=="object"&&H!==null&&E.indexOf(H)===-1&&(x.push({obj:k,prop:z}),E.push(H))}return i(x),v},d=function(v){return Object.prototype.toString.call(v)==="[object RegExp]"},m=function(v){return!v||typeof v!="object"?!1:!!(v.constructor&&v.constructor.isBuffer&&v.constructor.isBuffer(v))},p=function(v,x){return[].concat(v,x)},g=function(v,x){if(n(v)){for(var E=[],C=0;C<v.length;C+=1)E.push(x(v[C]));return E}return x(v)};return A4={arrayToObject:s,assign:a,combine:p,compact:h,decode:c,encode:u,isBuffer:m,isRegExp:d,maybeMap:g,merge:o},A4}var M4,zX;function _Ve(){if(zX)return M4;zX=1;var t=gVe(),e=nle(),n=C7(),r=Object.prototype.hasOwnProperty,i={brackets:function(y){return y+"[]"},comma:"comma",indices:function(y,v){return y+"["+v+"]"},repeat:function(y){return y}},s=Array.isArray,o=Array.prototype.push,a=function(g,y){o.apply(g,s(y)?y:[y])},c=Date.prototype.toISOString,l=n.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:n.formatters[l],indices:!1,serializeDate:function(y){return c.call(y)},skipNulls:!1,strictNullHandling:!1},h=function(y){return typeof y=="string"||typeof y=="number"||typeof y=="boolean"||typeof y=="symbol"||typeof y=="bigint"},d={},m=function g(y,v,x,E,C,A,k,M,I,z,H,K,P,F,N,X,G,j){for(var q=y,te=j,W=0,$=!1;(te=te.get(d))!==void 0&&!$;){var J=te.get(y);if(W+=1,typeof J<"u"){if(J===W)throw new RangeError("Cyclic object value");$=!0}typeof te.get(d)>"u"&&(W=0)}if(typeof z=="function"?q=z(v,q):q instanceof Date?q=P(q):x==="comma"&&s(q)&&(q=e.maybeMap(q,function(Le){return Le instanceof Date?P(Le):Le})),q===null){if(A)return I&&!X?I(v,u.encoder,G,"key",F):v;q=""}if(h(q)||e.isBuffer(q)){if(I){var ne=X?v:I(v,u.encoder,G,"key",F);return[N(ne)+"="+N(I(q,u.encoder,G,"value",F))]}return[N(v)+"="+N(String(q))]}var ie=[];if(typeof q>"u")return ie;var ae;if(x==="comma"&&s(q))X&&I&&(q=e.maybeMap(q,I)),ae=[{value:q.length>0?q.join(",")||null:void 0}];else if(s(z))ae=z;else{var xe=Object.keys(q);ae=H?xe.sort(H):xe}var Ne=M?String(v).replace(/\./g,"%2E"):String(v),Re=E&&s(q)&&q.length===1?Ne+"[]":Ne;if(C&&s(q)&&q.length===0)return Re+"[]";for(var Se=0;Se<ae.length;++Se){var ze=ae[Se],Be=typeof ze=="object"&&ze&&typeof ze.value<"u"?ze.value:q[ze];if(!(k&&Be===null)){var Je=K&&M?String(ze).replace(/\./g,"%2E"):String(ze),at=s(q)?typeof x=="function"?x(Re,Je):Re:Re+(K?"."+Je:"["+Je+"]");j.set(y,W);var re=t();re.set(d,j),a(ie,g(Be,at,x,E,C,A,k,M,x==="comma"&&X&&s(q)?null:I,z,H,K,P,F,N,X,G,re))}}return ie},p=function(y){if(!y)return u;if(typeof y.allowEmptyArrays<"u"&&typeof y.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof y.encodeDotInKeys<"u"&&typeof y.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(y.encoder!==null&&typeof y.encoder<"u"&&typeof y.encoder!="function")throw new TypeError("Encoder has to be a function.");var v=y.charset||u.charset;if(typeof y.charset<"u"&&y.charset!=="utf-8"&&y.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var x=n.default;if(typeof y.format<"u"){if(!r.call(n.formatters,y.format))throw new TypeError("Unknown format option provided.");x=y.format}var E=n.formatters[x],C=u.filter;(typeof y.filter=="function"||s(y.filter))&&(C=y.filter);var A;if(y.arrayFormat in i?A=y.arrayFormat:"indices"in y?A=y.indices?"indices":"repeat":A=u.arrayFormat,"commaRoundTrip"in y&&typeof y.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var k=typeof y.allowDots>"u"?y.encodeDotInKeys===!0?!0:u.allowDots:!!y.allowDots;return{addQueryPrefix:typeof y.addQueryPrefix=="boolean"?y.addQueryPrefix:u.addQueryPrefix,allowDots:k,allowEmptyArrays:typeof y.allowEmptyArrays=="boolean"?!!y.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:A,charset:v,charsetSentinel:typeof y.charsetSentinel=="boolean"?y.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!y.commaRoundTrip,delimiter:typeof y.delimiter>"u"?u.delimiter:y.delimiter,encode:typeof y.encode=="boolean"?y.encode:u.encode,encodeDotInKeys:typeof y.encodeDotInKeys=="boolean"?y.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof y.encoder=="function"?y.encoder:u.encoder,encodeValuesOnly:typeof y.encodeValuesOnly=="boolean"?y.encodeValuesOnly:u.encodeValuesOnly,filter:C,format:x,formatter:E,serializeDate:typeof y.serializeDate=="function"?y.serializeDate:u.serializeDate,skipNulls:typeof y.skipNulls=="boolean"?y.skipNulls:u.skipNulls,sort:typeof y.sort=="function"?y.sort:null,strictNullHandling:typeof y.strictNullHandling=="boolean"?y.strictNullHandling:u.strictNullHandling}};return M4=function(g,y){var v=g,x=p(y),E,C;typeof x.filter=="function"?(C=x.filter,v=C("",v)):s(x.filter)&&(C=x.filter,E=C);var A=[];if(typeof v!="object"||v===null)return"";var k=i[x.arrayFormat],M=k==="comma"&&x.commaRoundTrip;E||(E=Object.keys(v)),x.sort&&E.sort(x.sort);for(var I=t(),z=0;z<E.length;++z){var H=E[z],K=v[H];x.skipNulls&&K===null||a(A,m(K,H,k,M,x.allowEmptyArrays,x.strictNullHandling,x.skipNulls,x.encodeDotInKeys,x.encode?x.encoder:null,x.filter,x.sort,x.allowDots,x.serializeDate,x.format,x.formatter,x.encodeValuesOnly,x.charset,I))}var P=A.join(x.delimiter),F=x.addQueryPrefix===!0?"?":"";return x.charsetSentinel&&(x.charset==="iso-8859-1"?F+="utf8=%26%2310003%3B&":F+="utf8=%E2%9C%93&"),P.length>0?F+P:""},M4}var k4,HX;function vVe(){if(HX)return k4;HX=1;var t=nle(),e=Object.prototype.hasOwnProperty,n=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:t.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(d){return d.replace(/&#(\d+);/g,function(m,p){return String.fromCharCode(parseInt(p,10))})},s=function(d,m,p){if(d&&typeof d=="string"&&m.comma&&d.indexOf(",")>-1)return d.split(",");if(m.throwOnLimitExceeded&&p>=m.arrayLimit)throw new RangeError("Array limit exceeded. Only "+m.arrayLimit+" element"+(m.arrayLimit===1?"":"s")+" allowed in an array.");return d},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",c=function(m,p){var g={__proto__:null},y=p.ignoreQueryPrefix?m.replace(/^\?/,""):m;y=y.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var v=p.parameterLimit===1/0?void 0:p.parameterLimit,x=y.split(p.delimiter,p.throwOnLimitExceeded?v+1:v);if(p.throwOnLimitExceeded&&x.length>v)throw new RangeError("Parameter limit exceeded. Only "+v+" parameter"+(v===1?"":"s")+" allowed.");var E=-1,C,A=p.charset;if(p.charsetSentinel)for(C=0;C<x.length;++C)x[C].indexOf("utf8=")===0&&(x[C]===a?A="utf-8":x[C]===o&&(A="iso-8859-1"),E=C,C=x.length);for(C=0;C<x.length;++C)if(C!==E){var k=x[C],M=k.indexOf("]="),I=M===-1?k.indexOf("="):M+1,z,H;I===-1?(z=p.decoder(k,r.decoder,A,"key"),H=p.strictNullHandling?null:""):(z=p.decoder(k.slice(0,I),r.decoder,A,"key"),H=t.maybeMap(s(k.slice(I+1),p,n(g[z])?g[z].length:0),function(P){return p.decoder(P,r.decoder,A,"value")})),H&&p.interpretNumericEntities&&A==="iso-8859-1"&&(H=i(String(H))),k.indexOf("[]=")>-1&&(H=n(H)?[H]:H);var K=e.call(g,z);K&&p.duplicates==="combine"?g[z]=t.combine(g[z],H):(!K||p.duplicates==="last")&&(g[z]=H)}return g},l=function(d,m,p,g){var y=0;if(d.length>0&&d[d.length-1]==="[]"){var v=d.slice(0,-1).join("");y=Array.isArray(m)&&m[v]?m[v].length:0}for(var x=g?m:s(m,p,y),E=d.length-1;E>=0;--E){var C,A=d[E];if(A==="[]"&&p.parseArrays)C=p.allowEmptyArrays&&(x===""||p.strictNullHandling&&x===null)?[]:t.combine([],x);else{C=p.plainObjects?{__proto__:null}:{};var k=A.charAt(0)==="["&&A.charAt(A.length-1)==="]"?A.slice(1,-1):A,M=p.decodeDotInKeys?k.replace(/%2E/g,"."):k,I=parseInt(M,10);!p.parseArrays&&M===""?C={0:x}:!isNaN(I)&&A!==M&&String(I)===M&&I>=0&&p.parseArrays&&I<=p.arrayLimit?(C=[],C[I]=x):M!=="__proto__"&&(C[M]=x)}x=C}return x},u=function(m,p,g,y){if(m){var v=g.allowDots?m.replace(/\.([^.[]+)/g,"[$1]"):m,x=/(\[[^[\]]*])/,E=/(\[[^[\]]*])/g,C=g.depth>0&&x.exec(v),A=C?v.slice(0,C.index):v,k=[];if(A){if(!g.plainObjects&&e.call(Object.prototype,A)&&!g.allowPrototypes)return;k.push(A)}for(var M=0;g.depth>0&&(C=E.exec(v))!==null&&M<g.depth;){if(M+=1,!g.plainObjects&&e.call(Object.prototype,C[1].slice(1,-1))&&!g.allowPrototypes)return;k.push(C[1])}if(C){if(g.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+g.depth+" and strictDepth is true");k.push("["+v.slice(C.index)+"]")}return l(k,p,g,y)}},h=function(m){if(!m)return r;if(typeof m.allowEmptyArrays<"u"&&typeof m.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof m.decodeDotInKeys<"u"&&typeof m.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(m.decoder!==null&&typeof m.decoder<"u"&&typeof m.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof m.charset<"u"&&m.charset!=="utf-8"&&m.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof m.throwOnLimitExceeded<"u"&&typeof m.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var p=typeof m.charset>"u"?r.charset:m.charset,g=typeof m.duplicates>"u"?r.duplicates:m.duplicates;if(g!=="combine"&&g!=="first"&&g!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var y=typeof m.allowDots>"u"?m.decodeDotInKeys===!0?!0:r.allowDots:!!m.allowDots;return{allowDots:y,allowEmptyArrays:typeof m.allowEmptyArrays=="boolean"?!!m.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof m.allowPrototypes=="boolean"?m.allowPrototypes:r.allowPrototypes,allowSparse:typeof m.allowSparse=="boolean"?m.allowSparse:r.allowSparse,arrayLimit:typeof m.arrayLimit=="number"?m.arrayLimit:r.arrayLimit,charset:p,charsetSentinel:typeof m.charsetSentinel=="boolean"?m.charsetSentinel:r.charsetSentinel,comma:typeof m.comma=="boolean"?m.comma:r.comma,decodeDotInKeys:typeof m.decodeDotInKeys=="boolean"?m.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof m.decoder=="function"?m.decoder:r.decoder,delimiter:typeof m.delimiter=="string"||t.isRegExp(m.delimiter)?m.delimiter:r.delimiter,depth:typeof m.depth=="number"||m.depth===!1?+m.depth:r.depth,duplicates:g,ignoreQueryPrefix:m.ignoreQueryPrefix===!0,interpretNumericEntities:typeof m.interpretNumericEntities=="boolean"?m.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof m.parameterLimit=="number"?m.parameterLimit:r.parameterLimit,parseArrays:m.parseArrays!==!1,plainObjects:typeof m.plainObjects=="boolean"?m.plainObjects:r.plainObjects,strictDepth:typeof m.strictDepth=="boolean"?!!m.strictDepth:r.strictDepth,strictNullHandling:typeof m.strictNullHandling=="boolean"?m.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof m.throwOnLimitExceeded=="boolean"?m.throwOnLimitExceeded:!1}};return k4=function(d,m){var p=h(m);if(d===""||d===null||typeof d>"u")return p.plainObjects?{__proto__:null}:{};for(var g=typeof d=="string"?c(d,p):d,y=p.plainObjects?{__proto__:null}:{},v=Object.keys(g),x=0;x<v.length;++x){var E=v[x],C=u(E,g[E],p,typeof d=="string");y=t.merge(y,C,p)}return p.allowSparse===!0?y:t.compact(y)},k4}var O4,qX;function yVe(){if(qX)return O4;qX=1;var t=_Ve(),e=vVe(),n=C7();return O4={formats:n,parse:e,stringify:t},O4}var VX;function bVe(){if(VX)return Hb;VX=1;var t=jqe();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var n=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),c=["%","/","?",";","#"].concat(a),l=["/","?","#"],u=255,h=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},p={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=yVe();function v(A,k,M){if(A&&typeof A=="object"&&A instanceof e)return A;var I=new e;return I.parse(A,k,M),I}e.prototype.parse=function(A,k,M){if(typeof A!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof A);var I=A.indexOf("?"),z=I!==-1&&I<A.indexOf("#")?"?":"#",H=A.split(z),K=/\\/g;H[0]=H[0].replace(K,"/"),A=H.join(z);var P=A;if(P=P.trim(),!M&&A.split("#").length===1){var F=i.exec(P);if(F)return this.path=P,this.href=P,this.pathname=F[1],F[2]?(this.search=F[2],k?this.query=y.parse(this.search.substr(1)):this.query=this.search.substr(1)):k&&(this.search="",this.query={}),this}var N=n.exec(P);if(N){N=N[0];var X=N.toLowerCase();this.protocol=X,P=P.substr(N.length)}if(M||N||P.match(/^\/\/[^@/]+@[^@/]+/)){var G=P.substr(0,2)==="//";G&&!(N&&p[N])&&(P=P.substr(2),this.slashes=!0)}if(!p[N]&&(G||N&&!g[N])){for(var j=-1,q=0;q<l.length;q++){var te=P.indexOf(l[q]);te!==-1&&(j===-1||te<j)&&(j=te)}var W,$;j===-1?$=P.lastIndexOf("@"):$=P.lastIndexOf("@",j),$!==-1&&(W=P.slice(0,$),P=P.slice($+1),this.auth=decodeURIComponent(W)),j=-1;for(var q=0;q<c.length;q++){var te=P.indexOf(c[q]);te!==-1&&(j===-1||te<j)&&(j=te)}j===-1&&(j=P.length),this.host=P.slice(0,j),P=P.slice(j),this.parseHost(),this.hostname=this.hostname||"";var J=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!J)for(var ne=this.hostname.split(/\./),q=0,ie=ne.length;q<ie;q++){var ae=ne[q];if(ae&&!ae.match(h)){for(var xe="",Ne=0,Re=ae.length;Ne<Re;Ne++)ae.charCodeAt(Ne)>127?xe+="x":xe+=ae[Ne];if(!xe.match(h)){var Se=ne.slice(0,q),ze=ne.slice(q+1),Be=ae.match(d);Be&&(Se.push(Be[1]),ze.unshift(Be[2])),ze.length&&(P="/"+ze.join(".")+P),this.hostname=Se.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),J||(this.hostname=t.toASCII(this.hostname));var Je=this.port?":"+this.port:"",at=this.hostname||"";this.host=at+Je,this.href+=this.host,J&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),P[0]!=="/"&&(P="/"+P))}if(!m[X])for(var q=0,ie=a.length;q<ie;q++){var re=a[q];if(P.indexOf(re)!==-1){var Le=encodeURIComponent(re);Le===re&&(Le=escape(re)),P=P.split(re).join(Le)}}var He=P.indexOf("#");He!==-1&&(this.hash=P.substr(He),P=P.slice(0,He));var Ue=P.indexOf("?");if(Ue!==-1?(this.search=P.substr(Ue),this.query=P.substr(Ue+1),k&&(this.query=y.parse(this.query)),P=P.slice(0,Ue)):k&&(this.search="",this.query={}),P&&(this.pathname=P),g[X]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var Je=this.pathname||"",De=this.search||"";this.path=Je+De}return this.href=this.format(),this};function x(A){return typeof A=="string"&&(A=v(A)),A instanceof e?A.format():e.prototype.format.call(A)}e.prototype.format=function(){var A=this.auth||"";A&&(A=encodeURIComponent(A),A=A.replace(/%3A/i,":"),A+="@");var k=this.protocol||"",M=this.pathname||"",I=this.hash||"",z=!1,H="";this.host?z=A+this.host:this.hostname&&(z=A+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(z+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(H=y.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var K=this.search||H&&"?"+H||"";return k&&k.substr(-1)!==":"&&(k+=":"),this.slashes||(!k||g[k])&&z!==!1?(z="//"+(z||""),M&&M.charAt(0)!=="/"&&(M="/"+M)):z||(z=""),I&&I.charAt(0)!=="#"&&(I="#"+I),K&&K.charAt(0)!=="?"&&(K="?"+K),M=M.replace(/[?#]/g,function(P){return encodeURIComponent(P)}),K=K.replace("#","%23"),k+z+M+K+I};function E(A,k){return v(A,!1,!0).resolve(k)}e.prototype.resolve=function(A){return this.resolveObject(v(A,!1,!0)).format()};function C(A,k){return A?v(A,!1,!0).resolveObject(k):k}return e.prototype.resolveObject=function(A){if(typeof A=="string"){var k=new e;k.parse(A,!1,!0),A=k}for(var M=new e,I=Object.keys(this),z=0;z<I.length;z++){var H=I[z];M[H]=this[H]}if(M.hash=A.hash,A.href==="")return M.href=M.format(),M;if(A.slashes&&!A.protocol){for(var K=Object.keys(A),P=0;P<K.length;P++){var F=K[P];F!=="protocol"&&(M[F]=A[F])}return g[M.protocol]&&M.hostname&&!M.pathname&&(M.pathname="/",M.path=M.pathname),M.href=M.format(),M}if(A.protocol&&A.protocol!==M.protocol){if(!g[A.protocol]){for(var N=Object.keys(A),X=0;X<N.length;X++){var G=N[X];M[G]=A[G]}return M.href=M.format(),M}if(M.protocol=A.protocol,!A.host&&!p[A.protocol]){for(var ie=(A.pathname||"").split("/");ie.length&&!(A.host=ie.shift()););A.host||(A.host=""),A.hostname||(A.hostname=""),ie[0]!==""&&ie.unshift(""),ie.length<2&&ie.unshift(""),M.pathname=ie.join("/")}else M.pathname=A.pathname;if(M.search=A.search,M.query=A.query,M.host=A.host||"",M.auth=A.auth,M.hostname=A.hostname||A.host,M.port=A.port,M.pathname||M.search){var j=M.pathname||"",q=M.search||"";M.path=j+q}return M.slashes=M.slashes||A.slashes,M.href=M.format(),M}var te=M.pathname&&M.pathname.charAt(0)==="/",W=A.host||A.pathname&&A.pathname.charAt(0)==="/",$=W||te||M.host&&A.pathname,J=$,ne=M.pathname&&M.pathname.split("/")||[],ie=A.pathname&&A.pathname.split("/")||[],ae=M.protocol&&!g[M.protocol];if(ae&&(M.hostname="",M.port=null,M.host&&(ne[0]===""?ne[0]=M.host:ne.unshift(M.host)),M.host="",A.protocol&&(A.hostname=null,A.port=null,A.host&&(ie[0]===""?ie[0]=A.host:ie.unshift(A.host)),A.host=null),$=$&&(ie[0]===""||ne[0]==="")),W)M.host=A.host||A.host===""?A.host:M.host,M.hostname=A.hostname||A.hostname===""?A.hostname:M.hostname,M.search=A.search,M.query=A.query,ne=ie;else if(ie.length)ne||(ne=[]),ne.pop(),ne=ne.concat(ie),M.search=A.search,M.query=A.query;else if(A.search!=null){if(ae){M.host=ne.shift(),M.hostname=M.host;var xe=M.host&&M.host.indexOf("@")>0?M.host.split("@"):!1;xe&&(M.auth=xe.shift(),M.hostname=xe.shift(),M.host=M.hostname)}return M.search=A.search,M.query=A.query,(M.pathname!==null||M.search!==null)&&(M.path=(M.pathname?M.pathname:"")+(M.search?M.search:"")),M.href=M.format(),M}if(!ne.length)return M.pathname=null,M.search?M.path="/"+M.search:M.path=null,M.href=M.format(),M;for(var Ne=ne.slice(-1)[0],Re=(M.host||A.host||ne.length>1)&&(Ne==="."||Ne==="..")||Ne==="",Se=0,ze=ne.length;ze>=0;ze--)Ne=ne[ze],Ne==="."?ne.splice(ze,1):Ne===".."?(ne.splice(ze,1),Se++):Se&&(ne.splice(ze,1),Se--);if(!$&&!J)for(;Se--;Se)ne.unshift("..");$&&ne[0]!==""&&(!ne[0]||ne[0].charAt(0)!=="/")&&ne.unshift(""),Re&&ne.join("/").substr(-1)!=="/"&&ne.push("");var Be=ne[0]===""||ne[0]&&ne[0].charAt(0)==="/";if(ae){M.hostname=Be?"":ne.length?ne.shift():"",M.host=M.hostname;var xe=M.host&&M.host.indexOf("@")>0?M.host.split("@"):!1;xe&&(M.auth=xe.shift(),M.hostname=xe.shift(),M.host=M.hostname)}return $=$||M.host&&ne.length,$&&!Be&&ne.unshift(""),ne.length>0?M.pathname=ne.join("/"):(M.pathname=null,M.path=null),(M.pathname!==null||M.search!==null)&&(M.path=(M.pathname?M.pathname:"")+(M.search?M.search:"")),M.auth=A.auth||M.auth,M.slashes=M.slashes||A.slashes,M.href=M.format(),M},e.prototype.parseHost=function(){var A=this.host,k=r.exec(A);k&&(k=k[0],k!==":"&&(this.port=k.substr(1)),A=A.substr(0,A.length-k.length)),A&&(this.hostname=A)},Hb.parse=v,Hb.resolve=E,Hb.resolveObject=C,Hb.format=x,Hb.Url=e,Hb}var I4,GX;function EVe(){return GX||(GX=1,I4=typeof URL=="function"?URL:bVe().URL),I4}var $X;function uP(){if($X)return eg;$X=1;const t=EVe();function e(H,K,P){if(K in H)return H[K];if(arguments.length===3)return P;throw new Error('"'+K+'" is a required argument.')}eg.getArg=e;const n=(function(){return!("__proto__"in Object.create(null))})();function r(H){return H}function i(H){return o(H)?"$"+H:H}eg.toSetString=n?r:i;function s(H){return o(H)?H.slice(1):H}eg.fromSetString=n?r:s;function o(H){if(!H)return!1;const K=H.length;if(K<9||H.charCodeAt(K-1)!==95||H.charCodeAt(K-2)!==95||H.charCodeAt(K-3)!==111||H.charCodeAt(K-4)!==116||H.charCodeAt(K-5)!==111||H.charCodeAt(K-6)!==114||H.charCodeAt(K-7)!==112||H.charCodeAt(K-8)!==95||H.charCodeAt(K-9)!==95)return!1;for(let P=K-10;P>=0;P--)if(H.charCodeAt(P)!==36)return!1;return!0}function a(H,K){return H===K?0:H===null?1:K===null?-1:H>K?1:-1}function c(H,K){let P=H.generatedLine-K.generatedLine;return P!==0||(P=H.generatedColumn-K.generatedColumn,P!==0)||(P=a(H.source,K.source),P!==0)||(P=H.originalLine-K.originalLine,P!==0)||(P=H.originalColumn-K.originalColumn,P!==0)?P:a(H.name,K.name)}eg.compareByGeneratedPositionsInflated=c;function l(H){return JSON.parse(H.replace(/^\)]}'[^\n]*\n/,""))}eg.parseSourceMapInput=l;const u="http:",h=`${u}//host`;function d(H){return K=>{const P=v(K),F=g(K),N=new t(K,F);H(N);const X=N.toString();return P==="absolute"?X:P==="scheme-relative"?X.slice(u.length):P==="path-absolute"?X.slice(h.length):x(F,X)}}function m(H,K){return new t(H,K).toString()}function p(H,K){let P=0;do{const F=H+P++;if(K.indexOf(F)===-1)return F}while(!0)}function g(H){const K=H.split("..").length-1,P=p("p",H);let F=`${h}/`;for(let N=0;N<K;N++)F+=`${P}/`;return F}const y=/^[A-Za-z0-9\+\-\.]+:/;function v(H){return H[0]==="/"?H[1]==="/"?"scheme-relative":"path-absolute":y.test(H)?"absolute":"path-relative"}function x(H,K){typeof H=="string"&&(H=new t(H)),typeof K=="string"&&(K=new t(K));const P=K.pathname.split("/"),F=H.pathname.split("/");for(F.length>0&&!F[F.length-1]&&F.pop();P.length>0&&F.length>0&&P[0]===F[0];)P.shift(),F.shift();return F.map(()=>"..").concat(P).join("/")+K.search+K.hash}const E=d(H=>{H.pathname=H.pathname.replace(/\/?$/,"/")}),C=d(H=>{H.href=new t(".",H.toString()).toString()}),A=d(H=>{});eg.normalize=A;function k(H,K){const P=v(K),F=v(H);if(H=E(H),P==="absolute")return m(K,void 0);if(F==="absolute")return m(K,H);if(P==="scheme-relative")return A(K);if(F==="scheme-relative")return m(K,m(H,h)).slice(u.length);if(P==="path-absolute")return A(K);if(F==="path-absolute")return m(K,m(H,h)).slice(h.length);const N=g(K+H),X=m(K,m(H,N));return x(N,X)}eg.join=k;function M(H,K){const P=I(H,K);return typeof P=="string"?P:A(K)}eg.relative=M;function I(H,K){if(v(H)!==v(K))return null;const F=g(H+K),N=new t(H,F),X=new t(K,F);try{new t("",X.toString())}catch{return null}return X.protocol!==N.protocol||X.user!==N.user||X.password!==N.password||X.hostname!==N.hostname||X.port!==N.port?null:x(N,X)}function z(H,K,P){H&&v(K)==="path-absolute"&&(K=K.replace(/^\//,""));let F=A(K||"");return H&&(F=k(H,F)),P&&(F=k(C(P),F)),F}return eg.computeSourceURL=z,eg}var N4={},WX;function rle(){if(WX)return N4;WX=1;class t{constructor(){this._array=[],this._set=new Map}static fromArray(n,r){const i=new t;for(let s=0,o=n.length;s<o;s++)i.add(n[s],r);return i}size(){return this._set.size}add(n,r){const i=this.has(n),s=this._array.length;(!i||r)&&this._array.push(n),i||this._set.set(n,s)}has(n){return this._set.has(n)}indexOf(n){const r=this._set.get(n);if(r>=0)return r;throw new Error('"'+n+'" is not in the set.')}at(n){if(n>=0&&n<this._array.length)return this._array[n];throw new Error("No element indexed by "+n)}toArray(){return this._array.slice()}}return N4.ArraySet=t,N4}var P4={},KX;function SVe(){if(KX)return P4;KX=1;const t=uP();function e(r,i){const s=r.generatedLine,o=i.generatedLine,a=r.generatedColumn,c=i.generatedColumn;return o>s||o==s&&c>=a||t.compareByGeneratedPositionsInflated(r,i)<=0}class n{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(i,s){this._array.forEach(i,s)}add(i){e(this._last,i)?(this._last=i,this._array.push(i)):(this._sorted=!1,this._array.push(i))}toArray(){return this._sorted||(this._array.sort(t.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}}return P4.MappingList=n,P4}var XX;function ile(){if(XX)return BL;XX=1;const t=Wce(),e=uP(),n=rle().ArraySet,r=SVe().MappingList;class i{constructor(o){o||(o={}),this._file=e.getArg(o,"file",null),this._sourceRoot=e.getArg(o,"sourceRoot",null),this._skipValidation=e.getArg(o,"skipValidation",!1),this._sources=new n,this._names=new n,this._mappings=new r,this._sourcesContents=null}static fromSourceMap(o){const a=o.sourceRoot,c=new i({file:o.file,sourceRoot:a});return o.eachMapping(function(l){const u={generated:{line:l.generatedLine,column:l.generatedColumn}};l.source!=null&&(u.source=l.source,a!=null&&(u.source=e.relative(a,u.source)),u.original={line:l.originalLine,column:l.originalColumn},l.name!=null&&(u.name=l.name)),c.addMapping(u)}),o.sources.forEach(function(l){let u=l;a!=null&&(u=e.relative(a,l)),c._sources.has(u)||c._sources.add(u);const h=o.sourceContentFor(l);h!=null&&c.setSourceContent(l,h)}),c}addMapping(o){const a=e.getArg(o,"generated"),c=e.getArg(o,"original",null);let l=e.getArg(o,"source",null),u=e.getArg(o,"name",null);this._skipValidation||this._validateMapping(a,c,l,u),l!=null&&(l=String(l),this._sources.has(l)||this._sources.add(l)),u!=null&&(u=String(u),this._names.has(u)||this._names.add(u)),this._mappings.add({generatedLine:a.line,generatedColumn:a.column,originalLine:c&&c.line,originalColumn:c&&c.column,source:l,name:u})}setSourceContent(o,a){let c=o;this._sourceRoot!=null&&(c=e.relative(this._sourceRoot,c)),a!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(c)]=a):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(c)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(o,a,c){let l=a;if(a==null){if(o.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);l=o.file}const u=this._sourceRoot;u!=null&&(l=e.relative(u,l));const h=this._mappings.toArray().length>0?new n:this._sources,d=new n;this._mappings.unsortedForEach(function(m){if(m.source===l&&m.originalLine!=null){const y=o.originalPositionFor({line:m.originalLine,column:m.originalColumn});y.source!=null&&(m.source=y.source,c!=null&&(m.source=e.join(c,m.source)),u!=null&&(m.source=e.relative(u,m.source)),m.originalLine=y.line,m.originalColumn=y.column,y.name!=null&&(m.name=y.name))}const p=m.source;p!=null&&!h.has(p)&&h.add(p);const g=m.name;g!=null&&!d.has(g)&&d.add(g)},this),this._sources=h,this._names=d,o.sources.forEach(function(m){const p=o.sourceContentFor(m);p!=null&&(c!=null&&(m=e.join(c,m)),u!=null&&(m=e.relative(u,m)),this.setSourceContent(m,p))},this)}_validateMapping(o,a,c,l){if(a&&typeof a.line!="number"&&typeof a.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(o&&"line"in o&&"column"in o&&o.line>0&&o.column>=0&&!a&&!c&&!l)){if(!(o&&"line"in o&&"column"in o&&a&&"line"in a&&"column"in a&&o.line>0&&o.column>=0&&a.line>0&&a.column>=0&&c))throw new Error("Invalid mapping: "+JSON.stringify({generated:o,source:c,original:a,name:l}))}}_serializeMappings(){let o=0,a=1,c=0,l=0,u=0,h=0,d="",m,p,g,y;const v=this._mappings.toArray();for(let x=0,E=v.length;x<E;x++){if(p=v[x],m="",p.generatedLine!==a)for(o=0;p.generatedLine!==a;)m+=";",a++;else if(x>0){if(!e.compareByGeneratedPositionsInflated(p,v[x-1]))continue;m+=","}m+=t.encode(p.generatedColumn-o),o=p.generatedColumn,p.source!=null&&(y=this._sources.indexOf(p.source),m+=t.encode(y-h),h=y,m+=t.encode(p.originalLine-1-l),l=p.originalLine-1,m+=t.encode(p.originalColumn-c),c=p.originalColumn,p.name!=null&&(g=this._names.indexOf(p.name),m+=t.encode(g-u),u=g)),d+=m}return d}_generateSourcesContent(o,a){return o.map(function(c){if(!this._sourcesContents)return null;a!=null&&(c=e.relative(a,c));const l=e.toSetString(c);return Object.prototype.hasOwnProperty.call(this._sourcesContents,l)?this._sourcesContents[l]:null},this)}toJSON(){const o={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(o.file=this._file),this._sourceRoot!=null&&(o.sourceRoot=this._sourceRoot),this._sourcesContents&&(o.sourcesContent=this._generateSourcesContent(o.sources,o.sourceRoot)),o}toString(){return JSON.stringify(this.toJSON())}}return i.prototype._version=3,BL.SourceMapGenerator=i,BL}var vC={},D4={},YX;function xVe(){return YX||(YX=1,(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a===t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(D4)),D4}var Pk={exports:{}},ZX;function sle(){if(ZX)return Pk.exports;ZX=1;let t=null;return Pk.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Pk.exports.initialize=e=>{t=e},Pk.exports}var L4,JX;function TVe(){if(JX)return L4;JX=1;const t=sle();function e(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let n=null;return L4=function(){if(n)return n;const i=[];return n=t().then(s=>WebAssembly.instantiate(s,{env:{mapping_callback(o,a,c,l,u,h,d,m,p,g){const y=new e;y.generatedLine=o+1,y.generatedColumn=a,c&&(y.lastGeneratedColumn=l-1),u&&(y.source=h,y.originalLine=d+1,y.originalColumn=m,p&&(y.name=g)),i[i.length-1](y)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(s=>({exports:s.instance.exports,withMappingCallback:(o,a)=>{i.push(o);try{a()}finally{i.pop()}}})).then(null,s=>{throw n=null,s}),n},L4}var QX;function wVe(){if(QX)return vC;QX=1;const t=uP(),e=xVe(),n=rle().ArraySet;Wce();const r=sle(),i=TVe(),s=Symbol("smcInternal");class o{constructor(d,m){return d==s?Promise.resolve(this):l(d,m)}static initialize(d){r.initialize(d["lib/mappings.wasm"])}static fromSourceMap(d,m){return u(d,m)}static async with(d,m,p){const g=await new o(d,m);try{return await p(g)}finally{g.destroy()}}eachMapping(d,m,p){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(d){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}o.prototype._version=3,o.GENERATED_ORDER=1,o.ORIGINAL_ORDER=2,o.GREATEST_LOWER_BOUND=1,o.LEAST_UPPER_BOUND=2,vC.SourceMapConsumer=o;class a extends o{constructor(d,m){return super(s).then(p=>{let g=d;typeof d=="string"&&(g=t.parseSourceMapInput(d));const y=t.getArg(g,"version"),v=t.getArg(g,"sources").map(String),x=t.getArg(g,"names",[]),E=t.getArg(g,"sourceRoot",null),C=t.getArg(g,"sourcesContent",null),A=t.getArg(g,"mappings"),k=t.getArg(g,"file",null),M=t.getArg(g,"x_google_ignoreList",null);if(y!=p._version)throw new Error("Unsupported version: "+y);return p._sourceLookupCache=new Map,p._names=n.fromArray(x.map(String),!0),p._sources=n.fromArray(v,!0),p._absoluteSources=n.fromArray(p._sources.toArray().map(function(I){return t.computeSourceURL(E,I,m)}),!0),p.sourceRoot=E,p.sourcesContent=C,p._mappings=A,p._sourceMapURL=m,p.file=k,p.x_google_ignoreList=M,p._computedColumnSpans=!1,p._mappingsPtr=0,p._wasm=null,i().then(I=>(p._wasm=I,p))})}_findSourceIndex(d){const m=this._sourceLookupCache.get(d);if(typeof m=="number")return m;const p=t.computeSourceURL(null,d,this._sourceMapURL);if(this._absoluteSources.has(p)){const y=this._absoluteSources.indexOf(p);return this._sourceLookupCache.set(d,y),y}const g=t.computeSourceURL(this.sourceRoot,d,this._sourceMapURL);if(this._absoluteSources.has(g)){const y=this._absoluteSources.indexOf(g);return this._sourceLookupCache.set(d,y),y}return-1}static fromSourceMap(d,m){return new a(d.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const d=this._mappings,m=d.length,p=this._wasm.exports.allocate_mappings(m)>>>0,g=new Uint8Array(this._wasm.exports.memory.buffer,p,m);for(let v=0;v<m;v++)g[v]=d.charCodeAt(v);const y=this._wasm.exports.parse_mappings(p);if(!y){const v=this._wasm.exports.get_last_error();let x=`Error parsing mappings (code ${v}): `;switch(v){case 1:x+="the mappings contained a negative line, column, source index, or name index";break;case 2:x+="the mappings contained a number larger than 2**32";break;case 3:x+="reached EOF while in the middle of parsing a VLQ";break;case 4:x+="invalid base 64 character while parsing a VLQ";break;default:x+="unknown error code";break}throw new Error(x)}this._mappingsPtr=y}eachMapping(d,m,p){const g=m||null,y=p||o.GENERATED_ORDER;this._wasm.withMappingCallback(v=>{v.source!==null&&(v.source=this._absoluteSources.at(v.source),v.name!==null&&(v.name=this._names.at(v.name))),this._computedColumnSpans&&v.lastGeneratedColumn===null&&(v.lastGeneratedColumn=1/0),d.call(g,v)},()=>{switch(y){case o.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case o.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(d){let m=t.getArg(d,"source");const p=t.getArg(d,"line"),g=d.column||0;if(m=this._findSourceIndex(m),m<0)return[];if(p<1)throw new Error("Line numbers must be >= 1");if(g<0)throw new Error("Column numbers must be >= 0");const y=[];return this._wasm.withMappingCallback(v=>{let x=v.lastGeneratedColumn;this._computedColumnSpans&&x===null&&(x=1/0),y.push({line:v.generatedLine,column:v.generatedColumn,lastColumn:x})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),m,p-1,"column"in d,g)}),y}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(d){const m={generatedLine:t.getArg(d,"line"),generatedColumn:t.getArg(d,"column")};if(m.generatedLine<1)throw new Error("Line numbers must be >= 1");if(m.generatedColumn<0)throw new Error("Column numbers must be >= 0");let p=t.getArg(d,"bias",o.GREATEST_LOWER_BOUND);p==null&&(p=o.GREATEST_LOWER_BOUND);let g;if(this._wasm.withMappingCallback(y=>g=y,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),m.generatedLine-1,m.generatedColumn,p)}),g&&g.generatedLine===m.generatedLine){let y=t.getArg(g,"source",null);y!==null&&(y=this._absoluteSources.at(y));let v=t.getArg(g,"name",null);return v!==null&&(v=this._names.at(v)),{source:y,line:t.getArg(g,"originalLine",null),column:t.getArg(g,"originalColumn",null),name:v}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(d){return d==null}):!1}sourceContentFor(d,m){if(!this.sourcesContent)return null;const p=this._findSourceIndex(d);if(p>=0)return this.sourcesContent[p];if(m)return null;throw new Error('"'+d+'" is not in the SourceMap.')}generatedPositionFor(d){let m=t.getArg(d,"source");if(m=this._findSourceIndex(m),m<0)return{line:null,column:null,lastColumn:null};const p={source:m,originalLine:t.getArg(d,"line"),originalColumn:t.getArg(d,"column")};if(p.originalLine<1)throw new Error("Line numbers must be >= 1");if(p.originalColumn<0)throw new Error("Column numbers must be >= 0");let g=t.getArg(d,"bias",o.GREATEST_LOWER_BOUND);g==null&&(g=o.GREATEST_LOWER_BOUND);let y;if(this._wasm.withMappingCallback(v=>y=v,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),p.source,p.originalLine-1,p.originalColumn,g)}),y&&y.source===p.source){let v=y.lastGeneratedColumn;return this._computedColumnSpans&&v===null&&(v=1/0),{line:t.getArg(y,"generatedLine",null),column:t.getArg(y,"generatedColumn",null),lastColumn:v}}return{line:null,column:null,lastColumn:null}}}a.prototype.consumer=o,vC.BasicSourceMapConsumer=a;class c extends o{constructor(d,m){return super(s).then(p=>{let g=d;typeof d=="string"&&(g=t.parseSourceMapInput(d));const y=t.getArg(g,"version"),v=t.getArg(g,"sections");if(y!=p._version)throw new Error("Unsupported version: "+y);let x={line:-1,column:0};return Promise.all(v.map(E=>{if(E.url)throw new Error("Support for url field in sections not implemented.");const C=t.getArg(E,"offset"),A=t.getArg(C,"line"),k=t.getArg(C,"column");if(A<x.line||A===x.line&&k<x.column)throw new Error("Section offsets must be ordered and non-overlapping.");return x=C,new o(t.getArg(E,"map"),m).then(I=>({generatedOffset:{generatedLine:A+1,generatedColumn:k+1},consumer:I}))})).then(E=>(p._sections=E,p))})}get sources(){const d=[];for(let m=0;m<this._sections.length;m++)for(let p=0;p<this._sections[m].consumer.sources.length;p++)d.push(this._sections[m].consumer.sources[p]);return d}originalPositionFor(d){const m={generatedLine:t.getArg(d,"line"),generatedColumn:t.getArg(d,"column")},p=e.search(m,this._sections,function(y,v){const x=y.generatedLine-v.generatedOffset.generatedLine;return x||y.generatedColumn-(v.generatedOffset.generatedColumn-1)}),g=this._sections[p];return g?g.consumer.originalPositionFor({line:m.generatedLine-(g.generatedOffset.generatedLine-1),column:m.generatedColumn-(g.generatedOffset.generatedLine===m.generatedLine?g.generatedOffset.generatedColumn-1:0),bias:d.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(d){return d.consumer.hasContentsOfAllSources()})}sourceContentFor(d,m){for(let p=0;p<this._sections.length;p++){const y=this._sections[p].consumer.sourceContentFor(d,!0);if(y)return y}if(m)return null;throw new Error('"'+d+'" is not in the SourceMap.')}_findSectionIndex(d){for(let m=0;m<this._sections.length;m++){const{consumer:p}=this._sections[m];if(p._findSourceIndex(d)!==-1)return m}return-1}generatedPositionFor(d){const m=this._findSectionIndex(t.getArg(d,"source")),p=m>=0?this._sections[m]:null,g=m>=0&&m+1<this._sections.length?this._sections[m+1]:null,y=p&&p.consumer.generatedPositionFor(d);if(y&&y.line!==null){const v=p.generatedOffset.generatedLine-1,x=p.generatedOffset.generatedColumn-1;return y.line===1&&(y.column+=x,typeof y.lastColumn=="number"&&(y.lastColumn+=x)),y.lastColumn===1/0&&g&&y.line===g.generatedOffset.generatedLine&&(y.lastColumn=g.generatedOffset.generatedColumn-2),y.line+=v,y}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(d){const m=this._findSectionIndex(t.getArg(d,"source")),p=m>=0?this._sections[m]:null,g=m>=0&&m+1<this._sections.length?this._sections[m+1]:null;return p?p.consumer.allGeneratedPositionsFor(d).map(y=>{const v=p.generatedOffset.generatedLine-1,x=p.generatedOffset.generatedColumn-1;return y.line===1&&(y.column+=x,typeof y.lastColumn=="number"&&(y.lastColumn+=x)),y.lastColumn===1/0&&g&&y.line===g.generatedOffset.generatedLine&&(y.lastColumn=g.generatedOffset.generatedColumn-2),y.line+=v,y}):[]}eachMapping(d,m,p){this._sections.forEach((g,y)=>{const v=y+1<this._sections.length?this._sections[y+1]:null,{generatedOffset:x}=g,E=x.generatedLine-1,C=x.generatedColumn-1;g.consumer.eachMapping(function(A){A.generatedLine===1&&(A.generatedColumn+=C,typeof A.lastGeneratedColumn=="number"&&(A.lastGeneratedColumn+=C)),A.lastGeneratedColumn===1/0&&v&&A.generatedLine===v.generatedOffset.generatedLine&&(A.lastGeneratedColumn=v.generatedOffset.generatedColumn-2),A.generatedLine+=E,d.call(this,A)},m,p)})}computeColumnSpans(){for(let d=0;d<this._sections.length;d++)this._sections[d].consumer.computeColumnSpans()}destroy(){for(let d=0;d<this._sections.length;d++)this._sections[d].consumer.destroy()}}vC.IndexedSourceMapConsumer=c;function l(h,d){let m=h;typeof h=="string"&&(m=t.parseSourceMapInput(h));const p=m.sections!=null?new c(m,d):new a(m,d);return Promise.resolve(p)}function u(h,d){return a.fromSourceMap(h,d)}return vC}var U4={},eY;function RVe(){if(eY)return U4;eY=1;const t=ile().SourceMapGenerator,e=uP(),n=/(\r?\n)/,r=10,i="$$$isSourceNode$$$";class s{constructor(a,c,l,u,h){this.children=[],this.sourceContents={},this.line=a??null,this.column=c??null,this.source=l??null,this.name=h??null,this[i]=!0,u!=null&&this.add(u)}static fromStringWithSourceMap(a,c,l){const u=new s,h=a.split(n);let d=0;const m=function(){const E=A(),C=A()||"";return E+C;function A(){return d<h.length?h[d++]:void 0}};let p=1,g=0,y=null,v;return c.eachMapping(function(E){if(y!==null)if(p<E.generatedLine)x(y,m()),p++,g=0;else{v=h[d]||"";const C=v.substr(0,E.generatedColumn-g);h[d]=v.substr(E.generatedColumn-g),g=E.generatedColumn,x(y,C),y=E;return}for(;p<E.generatedLine;)u.add(m()),p++;g<E.generatedColumn&&(v=h[d]||"",u.add(v.substr(0,E.generatedColumn)),h[d]=v.substr(E.generatedColumn),g=E.generatedColumn),y=E},this),d<h.length&&(y&&x(y,m()),u.add(h.splice(d).join(""))),c.sources.forEach(function(E){const C=c.sourceContentFor(E);C!=null&&(l!=null&&(E=e.join(l,E)),u.setSourceContent(E,C))}),u;function x(E,C){if(E===null||E.source===void 0)u.add(C);else{const A=l?e.join(l,E.source):E.source;u.add(new s(E.originalLine,E.originalColumn,A,C,E.name))}}}add(a){if(Array.isArray(a))a.forEach(function(c){this.add(c)},this);else if(a[i]||typeof a=="string")a&&this.children.push(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}prepend(a){if(Array.isArray(a))for(let c=a.length-1;c>=0;c--)this.prepend(a[c]);else if(a[i]||typeof a=="string")this.children.unshift(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}walk(a){let c;for(let l=0,u=this.children.length;l<u;l++)c=this.children[l],c[i]?c.walk(a):c!==""&&a(c,{source:this.source,line:this.line,column:this.column,name:this.name})}join(a){let c,l;const u=this.children.length;if(u>0){for(c=[],l=0;l<u-1;l++)c.push(this.children[l]),c.push(a);c.push(this.children[l]),this.children=c}return this}replaceRight(a,c){const l=this.children[this.children.length-1];return l[i]?l.replaceRight(a,c):typeof l=="string"?this.children[this.children.length-1]=l.replace(a,c):this.children.push("".replace(a,c)),this}setSourceContent(a,c){this.sourceContents[e.toSetString(a)]=c}walkSourceContents(a){for(let l=0,u=this.children.length;l<u;l++)this.children[l][i]&&this.children[l].walkSourceContents(a);const c=Object.keys(this.sourceContents);for(let l=0,u=c.length;l<u;l++)a(e.fromSetString(c[l]),this.sourceContents[c[l]])}toString(){let a="";return this.walk(function(c){a+=c}),a}toStringWithSourceMap(a){const c={code:"",line:1,column:0},l=new t(a);let u=!1,h=null,d=null,m=null,p=null;return this.walk(function(g,y){c.code+=g,y.source!==null&&y.line!==null&&y.column!==null?((h!==y.source||d!==y.line||m!==y.column||p!==y.name)&&l.addMapping({source:y.source,original:{line:y.line,column:y.column},generated:{line:c.line,column:c.column},name:y.name}),h=y.source,d=y.line,m=y.column,p=y.name,u=!0):u&&(l.addMapping({generated:{line:c.line,column:c.column}}),h=null,u=!1);for(let v=0,x=g.length;v<x;v++)g.charCodeAt(v)===r?(c.line++,c.column=0,v+1===x?(h=null,u=!1):u&&l.addMapping({source:y.source,original:{line:y.line,column:y.column},generated:{line:c.line,column:c.column},name:y.name})):c.column++}),this.walkSourceContents(function(g,y){l.setSourceContent(g,y)}),{code:c.code,map:l}}}return U4.SourceNode=s,U4}var tY;function CVe(){return tY||(tY=1,_C.SourceMapGenerator=ile().SourceMapGenerator,_C.SourceMapConsumer=wVe().SourceMapConsumer,_C.SourceNode=RVe().SourceNode),_C}var AVe=CVe();let nY=0;const rY=B0,MVe=["Command","lines"];class kVe extends M5e{constructor(){super(vae,{traceInitPerf:B0,skipValidations:!B0,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"}),this.performSelfAnalysis()}PEEK(e,n,...r){console.info(e,r.map(i=>[i.image,i.tokenType]),n)}RULED(e,n,r){const i=MVe.some(s=>e.includes(s));return this.RULE(e,()=>{const o=(nY++).toString().padStart(3),a=i?"font-weight: bold;":"";if(rY&&!this.RECORDING_PHASE){const c=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${o}%c> ${e} ${c.join(" ")}`,a)}n(),rY&&!this.RECORDING_PHASE&&console.info(`${o}%c< ${e} `,a),nY--},r)}program=this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))});line=this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(UA)}])});stmt=this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])});inline_go=this.RULED("inline_go",()=>{this.SUBRULE(this.short_go),this.OPTION(()=>this.SUBRULE(this.inline))});inline_try=this.RULED("inline_try",()=>{this.SUBRULE(this.short_try),this.OPTION(()=>this.SUBRULE(this.inline))});inline_command=this.RULED("inline_command",()=>{this.SUBRULE(this.stmt_command),this.OPTION(()=>this.SUBRULE(this.inline))});inline=this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.structured_cmd)},{ALT:()=>this.SUBRULE(this.inline_go)},{ALT:()=>this.SUBRULE(this.inline_try)},{ALT:()=>this.SUBRULE(this.inline_command)}])});stmt_label=this.RULED("stmt_label",()=>{this.CONSUME(vx)});stmt_stat=this.RULED("stmt_stat",()=>{this.CONSUME(q1)});stmt_text=this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(BA)}])});stmt_comment=this.RULED("stmt_comment",()=>{this.CONSUME(FA)});stmt_hyperlink=this.RULED("stmt_hyperlink",()=>{this.CONSUME(jA),this.CONSUME(NF)});stmt_command=this.RULED("stmt_command",()=>{this.CONSUME(ov),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])});structured_cmd=this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])});short_go=this.RULED("short_go",()=>{this.CONSUME(w1),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});short_try=this.RULED("short_try",()=>{this.CONSUME(zA),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});command_if=this.RULED("command_if",()=>{this.CONSUME(R1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))});command_if_block=this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(C1),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(UA)),this.CONSUME4(ov),this.CONSUME4(iN)}}])});command_block=this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(C1),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(ov),this.CONSUME(iN)}}])});command_fork=this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(C1),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])});command_else_if=this.RULED("command_else_if",()=>{this.CONSUME(ov),this.CONSUME(A1),this.CONSUME(R1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))});command_else=this.RULED("command_else",()=>{this.CONSUME(ov),this.CONSUME(A1),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))});command_while=this.RULED("command_while",()=>{this.CONSUME(WF),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_repeat=this.RULED("command_repeat",()=>{this.CONSUME(KF),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_waitfor=this.RULED("command_waitfor",()=>{this.CONSUME(XF),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_foreach=this.RULED("command_foreach",()=>{this.CONSUME(YF),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_break=this.RULED("command_break",()=>{this.CONSUME(ZF)});command_continue=this.RULED("command_continue",()=>{this.CONSUME(JF)});command_play=this.RULED("command_play",()=>{this.CONSUME($F)});command_toast=this.RULED("command_toast",()=>{this.CONSUME(mae)});command_ticker=this.RULED("command_ticker",()=>{this.CONSUME(gae)});expr=this.RULED("expr",()=>{this.SUBRULE1(this.and_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(QI),this.SUBRULE2(this.and_test,{LABEL:"RHS"})})});and_test=this.RULED("and_test",()=>{this.SUBRULE1(this.not_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(tN),this.SUBRULE2(this.not_test,{LABEL:"RHS"})})});not_test=this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(eN),this.SUBRULE1(this.not_test,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.comparison)}])});comparison=this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr,{LABEL:"LHS"}),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr,{LABEL:"RHS"})})});comp_op=this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(PF)},{ALT:()=>this.CONSUME(DF)},{ALT:()=>this.CONSUME(LF)},{ALT:()=>this.CONSUME(UF)},{ALT:()=>this.CONSUME(BF)},{ALT:()=>this.CONSUME(FF)}])});expr_value=this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(QI),this.SUBRULE2(this.and_test_value,{LABEL:"RHS"})})});and_test_value=this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(tN),this.SUBRULE2(this.not_test_value,{LABEL:"RHS"})})});not_test_value=this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(eN),this.SUBRULE1(this.not_test_value,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])});arith_expr=this.RULED("arith_expr",()=>{this.OR([{ALT:()=>this.SUBRULE(this.token_expr,{LABEL:"LHS"})},{ALT:()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item,{LABEL:"RHS"}))}}])});arith_expr_item=this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(nN)},{ALT:()=>this.CONSUME(rN)}]),this.SUBRULE(this.term)});term=this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))});term_item=this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(zF)},{ALT:()=>this.CONSUME(w1)},{ALT:()=>this.CONSUME(HF)},{ALT:()=>this.CONSUME(qF)}]),this.SUBRULE(this.factor)});factor=this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(nN)},{ALT:()=>this.CONSUME(rN)}]),this.SUBRULE(this.factor,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE(this.power)}])});power=this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(jF),this.SUBRULE(this.factor)})});words=this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))});kind=this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)});category=this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(Bie)},{ALT:()=>this.CONSUME(Fie)}])});collision=this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(jie)},{ALT:()=>this.CONSUME(zie)},{ALT:()=>this.CONSUME(Hie)},{ALT:()=>this.CONSUME(qie)},{ALT:()=>this.CONSUME(Vie)},{ALT:()=>this.CONSUME(Gie)},{ALT:()=>this.CONSUME($ie)},{ALT:()=>this.CONSUME(Wie)},{ALT:()=>this.CONSUME(Kie)}])});color=this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(Xie)},{ALT:()=>this.CONSUME(Yie)},{ALT:()=>this.CONSUME(Zie)},{ALT:()=>this.CONSUME(Jie)},{ALT:()=>this.CONSUME(Qie)},{ALT:()=>this.CONSUME(ese)},{ALT:()=>this.CONSUME(tse)},{ALT:()=>this.CONSUME(nse)},{ALT:()=>this.CONSUME(rse)},{ALT:()=>this.CONSUME(ise)},{ALT:()=>this.CONSUME(sse)},{ALT:()=>this.CONSUME(ose)},{ALT:()=>this.CONSUME(ase)},{ALT:()=>this.CONSUME(cse)},{ALT:()=>this.CONSUME(lse)},{ALT:()=>this.CONSUME(use)},{ALT:()=>this.CONSUME(fse)},{ALT:()=>this.CONSUME(hse)},{ALT:()=>this.CONSUME(dse)},{ALT:()=>this.CONSUME(pse)},{ALT:()=>this.CONSUME(mse)},{ALT:()=>this.CONSUME(gse)},{ALT:()=>this.CONSUME(_se)},{ALT:()=>this.CONSUME(vse)},{ALT:()=>this.CONSUME(yse)},{ALT:()=>this.CONSUME(bse)},{ALT:()=>this.CONSUME(Ese)},{ALT:()=>this.CONSUME(Sse)},{ALT:()=>this.CONSUME(xse)},{ALT:()=>this.CONSUME(Tse)},{ALT:()=>this.CONSUME(wse)},{ALT:()=>this.CONSUME(Rse)},{ALT:()=>this.CONSUME(Cse)},{ALT:()=>this.CONSUME(Ase)},{ALT:()=>this.CONSUME(Mse)},{ALT:()=>this.CONSUME(kse)},{ALT:()=>this.CONSUME(Ose)},{ALT:()=>this.CONSUME(Ise)},{ALT:()=>this.CONSUME(Nse)},{ALT:()=>this.CONSUME(Pse)},{ALT:()=>this.CONSUME(Dse)},{ALT:()=>this.CONSUME(Lse)},{ALT:()=>this.CONSUME(Use)},{ALT:()=>this.CONSUME(Bse)},{ALT:()=>this.CONSUME(Fse)},{ALT:()=>this.CONSUME(jse)},{ALT:()=>this.CONSUME(zse)},{ALT:()=>this.CONSUME(Hse)},{ALT:()=>this.CONSUME(qse)},{ALT:()=>this.CONSUME(Vse)},{ALT:()=>this.CONSUME(Gse)},{ALT:()=>this.CONSUME($se)},{ALT:()=>this.CONSUME(Wse)},{ALT:()=>this.CONSUME(Kse)},{ALT:()=>this.CONSUME(Xse)},{ALT:()=>this.CONSUME(Yse)},{ALT:()=>this.CONSUME(Zse)},{ALT:()=>this.CONSUME(Jse)},{ALT:()=>this.CONSUME(Qse)},{ALT:()=>this.CONSUME(eoe)},{ALT:()=>this.CONSUME(toe)},{ALT:()=>this.CONSUME(noe)},{ALT:()=>this.CONSUME(roe)},{ALT:()=>this.CONSUME(ioe)},{ALT:()=>this.CONSUME(soe)},{ALT:()=>this.CONSUME(ooe)},{ALT:()=>this.CONSUME(aoe)},{ALT:()=>this.CONSUME(coe)},{ALT:()=>this.CONSUME(loe)},{ALT:()=>this.CONSUME(uoe)}])});dir_mod=this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(xoe)},{ALT:()=>this.CONSUME(Toe)},{ALT:()=>this.CONSUME(woe)},{ALT:()=>this.CONSUME(Roe)},{ALT:()=>this.CONSUME(Goe)},{ALT:()=>this.CONSUME($oe)},{ALT:()=>this.CONSUME(Woe)},{ALT:()=>this.SUBRULE(this.dir_within)},{ALT:()=>this.SUBRULE(this.dir_awayby)}])});dir_by=this.RULED("dir_by",()=>{this.CONSUME(goe),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_at=this.RULED("dir_at",()=>{this.CONSUME(_oe),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_away=this.RULED("dir_away",()=>{this.CONSUME(Coe),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_toward=this.RULED("dir_toward",()=>{this.CONSUME(Aoe),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_find=this.RULED("dir_find",()=>{this.CONSUME(Moe),this.SUBRULE1(this.kind)});dir_flee=this.RULED("dir_flee",()=>{this.CONSUME(koe),this.SUBRULE1(this.kind)});dir_to=this.RULED("dir_to",()=>{this.CONSUME(Ooe),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)});dir_within=this.RULED("dir_within",()=>{this.CONSUME(Koe),this.SUBRULE1(this.simple_token)});dir_awayby=this.RULED("dir_awayby",()=>{this.CONSUME(Xoe),this.SUBRULE1(this.simple_token)});dir=this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(foe)},{ALT:()=>this.CONSUME(hoe)},{ALT:()=>this.CONSUME(doe)},{ALT:()=>this.CONSUME(poe)},{ALT:()=>this.CONSUME(moe)},{ALT:()=>this.SUBRULE(this.dir_by)},{ALT:()=>this.SUBRULE(this.dir_at)},{ALT:()=>this.SUBRULE(this.dir_away)},{ALT:()=>this.SUBRULE(this.dir_toward)},{ALT:()=>this.CONSUME(voe)},{ALT:()=>this.CONSUME(yoe)},{ALT:()=>this.CONSUME(boe)},{ALT:()=>this.CONSUME(Eoe)},{ALT:()=>this.CONSUME(Soe)},{ALT:()=>this.SUBRULE(this.dir_find)},{ALT:()=>this.SUBRULE(this.dir_flee)},{ALT:()=>this.SUBRULE(this.dir_to)},{ALT:()=>this.CONSUME(Ioe)},{ALT:()=>this.CONSUME(Noe)},{ALT:()=>this.CONSUME(Poe)},{ALT:()=>this.CONSUME(Doe)},{ALT:()=>this.CONSUME(Loe)},{ALT:()=>this.CONSUME(Uoe)},{ALT:()=>this.CONSUME(Boe)},{ALT:()=>this.CONSUME(Foe)},{ALT:()=>this.CONSUME(joe)},{ALT:()=>this.CONSUME(zoe)},{ALT:()=>this.CONSUME(Hoe)},{ALT:()=>this.CONSUME(qoe)},{ALT:()=>this.CONSUME(Voe)}])});expr_any=this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])});token_expr_any=this.RULED("token_expr_any",()=>{this.CONSUME(Qoe),this.SUBRULE(this.expr_any)});token_expr_count=this.RULED("token_expr_count",()=>{this.CONSUME(eae),this.SUBRULE(this.expr_any)});token_expr_blocked=this.RULED("token_expr_blocked",()=>{this.CONSUME(Joe),this.SUBRULE(this.dir)});token_expr_abs=this.RULED("token_expr_abs",()=>{this.CONSUME(tae),this.SUBRULE(this.simple_token)});token_expr_intceil=this.RULED("token_expr_intceil",()=>{this.CONSUME(nae),this.SUBRULE(this.simple_token)});token_expr_intfloor=this.RULED("token_expr_intfloor",()=>{this.CONSUME(rae),this.SUBRULE(this.simple_token)});token_expr_intround=this.RULED("token_expr_intround",()=>{this.CONSUME(iae),this.SUBRULE(this.simple_token)});token_expr_clamp=this.RULED("token_expr_clamp",()=>{this.CONSUME(sae),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)});token_expr_min=this.RULED("token_expr_min",()=>{this.CONSUME(oae),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_max=this.RULED("token_expr_max",()=>{this.CONSUME(aae),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pick=this.RULED("token_expr_pick",()=>{this.CONSUME(cae),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pickwith=this.RULED("token_expr_pickwith",()=>{this.CONSUME(lae),this.SUBRULE1(this.simple_token),this.AT_LEAST_ONE(()=>this.SUBRULE2(this.simple_token))});token_expr_random=this.RULED("token_expr_random",()=>{this.CONSUME(uae),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))});token_expr_randomwith=this.RULED("token_expr_randomwith",()=>{this.CONSUME(fae),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))});token_expr_run=this.RULED("token_expr_run",()=>{this.CONSUME(hae),this.SUBRULE(this.string_token)});token_expr_runwith=this.RULED("token_expr_runwith",()=>{this.CONSUME(dae),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)});token_expr=this.RULED("token_expr",()=>{this.OR([{ALT:()=>this.CONSUME(Yoe)},{ALT:()=>this.CONSUME(Zoe)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])});string_token=this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(cc)},{ALT:()=>this.CONSUME(cA)}])});simple_token=this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(JI)},{ALT:()=>this.CONSUME(cc)},{ALT:()=>this.CONSUME(cA)},{ALT:()=>this.SUBRULE(this.color)}])});token=this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(vx)},{ALT:()=>this.CONSUME(cA)},{ALT:()=>this.CONSUME(cc)},{ALT:()=>this.CONSUME(JI)},{ALT:()=>this.CONSUME(pae)},{ALT:()=>{this.CONSUME(VF),this.SUBRULE(this.expr),this.CONSUME(GF)}}])})}const MS=new kVe;if(GIe){const t=MS.getGAstProductions(),e=z5e(t);console.info(e)}const OVe=MS.getBaseCstVisitorConstructor();var Bn=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(Bn||{}),o1=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(o1||{}),a0=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(a0||{}),VO=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(VO||{});function Ec(t,e){const[n]=t??[];return(n?.image??e).trimStart().replaceAll(/^"|"$/g,"")}class IVe extends OVe{unique=0;constructor(){super(),B0&&this.validateVisitor()}visit(e){if(Rr(e)&&(e=e[0]),!!ge(e))return this[e.name](e.children,e.location)}createcodenode(e,n){return[{...n,...e,lineindex:0}]}createstringnode(e,n){return this.createcodenode(e,{type:12,literal:1,value:n})}createtemplatenode(e,n){return this.createcodenode(e,{type:12,literal:2,value:n})}createmarknode(e,n,r){return this.createlinenode(e,this.createcodenode(e,{type:3,id:n,comment:r}))}creategotonode(e,n,r){return this.createlinenode(e,this.createcodenode(e,{type:4,id:n,comment:r}))}createlinenode(e,n){return this.createcodenode(e,{type:2,stmts:n})}createapinode(e,n,r){return this.createlinenode(e,this.createcodenode(e,{type:1,words:r,method:n}))}createlogicnode(e,n,r,i){return this.createlinenode(e,this.createcodenode(e,{type:14,skip:r,words:i,method:n}))}createcountnode(e){return this.createcodenode(e,{type:5,index:this.unique++})}createexprnodeondemand(e,n){return e.length===1?e[0]:this.createcodenode(n,{type:31,words:e})[0]}go(e){return Array.isArray(e)?e.map(n=>this.visit(n)).flat():ge(e)?[this.visit(e)].flat():[]}program(e,n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(e.line)].flat()})}line(e){return e.stmt?this.go(e.stmt):[]}stmt(e){return e.stmt_label?this.go(e.stmt_label):e.stmt_stat?this.go(e.stmt_stat):e.stmt_text?this.go(e.stmt_text):e.stmt_comment?this.go(e.stmt_comment):e.stmt_hyperlink?this.go(e.stmt_hyperlink):e.stmt_command?this.go(e.stmt_command):e.short_go?this.go(e.short_go):e.short_try?this.go(e.short_try):[]}inline_go(e){const n=[];return e.short_go&&n.push(...this.go(e.short_go)),e.inline&&n.push(...this.go(e.inline)),n}inline_try(e){const n=[];return e.short_try&&n.push(...this.go(e.short_try)),e.inline&&n.push(...this.go(e.inline)),n}inline_command(e){const n=[];return e.stmt_command&&n.push(...this.go(e.stmt_command)),e.inline&&n.push(...this.go(e.inline)),n}inline(e){const n=[];return e.stmt_stat&&n.push(...this.go(e.stmt_stat)),e.stmt_text&&n.push(...this.go(e.stmt_text)),e.stmt_comment&&n.push(...this.go(e.stmt_comment)),e.stmt_hyperlink&&n.push(...this.go(e.stmt_hyperlink)),e.inline_go&&n.push(...this.go(e.inline_go)),e.inline_try&&n.push(...this.go(e.inline_try)),e.inline_command&&n.push(...this.go(e.inline_command)),e.structured_cmd&&n.push(...this.go(e.structured_cmd)),n}stmt_label(e,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:Ec(e.token_label,":").slice(1).trim()}))}stmt_stat(e,n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:Ec(e.token_stat,"@").slice(1)}))}stmt_text(e,n){const r=Ec(e.token_text,"");return this.createlinenode(n,this.createcodenode(n,{type:6,value:r}))}stmt_comment(e,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:Ec(e.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(e,n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:Ec(e.token_hyperlink,"!").slice(1),text:Ec(e.token_hyperlinktext,";").slice(1)}))}stmt_command(e,n){return e.structured_cmd?this.go(e.structured_cmd):this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(e.words)}))}structured_cmd(e){return e.command_if?this.go(e.command_if):e.command_while?this.go(e.command_while):e.command_repeat?this.go(e.command_repeat):e.command_waitfor?this.go(e.command_waitfor):e.command_foreach?this.go(e.command_foreach):e.command_break?this.go(e.command_break):e.command_continue?this.go(e.command_continue):[]}short_go(e,n){return e.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}short_try(e,n){return e.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}command_if(e,n){const[r]=this.createlogicnode(n,Ec(e.token_if,"if").toLowerCase(),"",this.go(e.words)),[i]=this.go(e.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(e,n){const r=va(),i=va();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(e.inline),this.go(e.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(e.command_else_if),this.go(e.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(e){return[this.go(e.inline),this.go(e.line)].flat()}command_fork(e){return[this.go(e.inline),this.go(e.line)].flat()}command_else_if(e,n){const r=va(),i=va();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,Ec(e.token_if,"if"),r,this.go(e.words)),this.go(e.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(e,n){const r=[];return e.words&&r.push(...this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(e.words)}))),e.command_fork&&r.push(...this.go(e.command_fork)),this.createcodenode(n,{type:17,lines:r})}command_while(e,n){const r=va(),i=va();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(e.words)),this.go(e.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(e,n){const r=va(),i=va(),o=[this.createcountnode(n),this.go(e.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(e.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(e,n){const r=va(),i=va(),o=[this.createcountnode(n),this.go(e.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(e.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(e,n){const r=va();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(e.words))].flat()})}command_break(e,n){return this.createcodenode(n,{type:19,goto:0})}command_continue(e,n){return this.createcodenode(n,{type:20,goto:0})}command_play(e,n){const r=Ec(e.token_command_play,"").trim(),[i,...s]=r.split(" ");return[this.createstringnode(n,i),this.createstringnode(n,s.join(" "))].flat()}command_toast(e,n){const i=Ec(e.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(n,"toast"),this.createtemplatenode(n,i)].flat()}command_ticker(e,n){const i=Ec(e.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(n,"ticker"),this.createtemplatenode(n,i)].flat()}expr(e,n){return e.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),n),this.createexprnodeondemand(this.go(e.RHS),n)]}):this.go(e.LHS)}and_test(e,n){return e.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),n),this.createexprnodeondemand(this.go(e.RHS),n)]}):this.go(e.LHS)}not_test(e,n){return e.comparison?this.go(e.comparison):e.LHS?this.createcodenode(n,{type:26,items:this.go(e.LHS)}):[]}comparison(e,n){if(e.RHS){const[r]=this.go(e.comp_op);return this.createcodenode(n,{type:27,compare:r,lhs:this.createexprnodeondemand(this.go(e.LHS),n),rhs:this.createexprnodeondemand(this.go(e.RHS),n)})}return this.go(e.LHS)}comp_op(e,n){return e.token_iseq?this.createcodenode(n,{type:28,method:0}):e.token_isnoteq?this.createcodenode(n,{type:28,method:1}):e.token_islessthan?this.createcodenode(n,{type:28,method:2}):e.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):e.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):e.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(e,n){return e.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),n),this.createexprnodeondemand(this.go(e.RHS),n)]}):this.go(e.LHS)}and_test_value(e,n){return e.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),n),this.createexprnodeondemand(this.go(e.RHS),n)]}):this.go(e.LHS)}not_test_value(e,n){return e.arith_expr?this.go(e.arith_expr):e.LHS?this.createcodenode(n,{type:26,items:this.go(e.LHS)}):[]}arith_expr(e,n){if(e.LHS)return this.go(e.LHS);const r=this.go(e.term);return e.RHS?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(e.RHS)}):r}arith_expr_item(e,n){return this.createcodenode(n,{type:30,operator:e.token_plus?1:2,rhs:this.go(e.term)[0]})}term(e,n){return e.term_item?this.createcodenode(n,{type:29,lhs:this.go(e.factor)[0],items:this.go(e.term_item)}):this.go(e.factor)}term_item(e,n){let r=0;return e.token_multiply&&(r=4),e.token_divide&&(r=5),e.token_moddivide&&(r=6),e.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(e.factor)[0]})}factor(e,n){if(e.power)return this.go(e.power);let r=0;return e.token_plus&&(r=8),e.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(e.LHS)[0]})})}power(e,n){const r=this.go(e.token);return e.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(e.factor)[0]})}):r}words(e){return this.go(e.expr)}kind(e){return[this.go(e.color),this.go(e.string_token)].flat()}category(e,n){return e.token_isterrain?this.createcodenode(n,{type:12,literal:1,value:"isterrain"}):e.token_isobject?this.createcodenode(n,{type:12,literal:1,value:"isobject"}):[]}collision(e,n){return e.token_iswalkable?this.createcodenode(n,{type:12,literal:1,value:"iswalkable"}):e.token_iswalking?this.createcodenode(n,{type:12,literal:1,value:"iswalking"}):e.token_iswalk?this.createcodenode(n,{type:12,literal:1,value:"iswalk"}):e.token_isswimmable?this.createcodenode(n,{type:12,literal:1,value:"isswimmable"}):e.token_isswimming?this.createcodenode(n,{type:12,literal:1,value:"isswimming"}):e.token_isswim?this.createcodenode(n,{type:12,literal:1,value:"isswim"}):e.token_issolid?this.createcodenode(n,{type:12,literal:1,value:"issolid"}):e.token_isbullet?this.createcodenode(n,{type:12,literal:1,value:"isbullet"}):e.token_isghost?this.createcodenode(n,{type:12,literal:1,value:"isghost"}):[]}color(e,n){let r="ERROR";return e.token_black&&(r="black"),e.token_dkblue&&(r="dkblue"),e.token_dkgreen&&(r="dkgreen"),e.token_dkcyan&&(r="dkcyan"),e.token_dkred&&(r="dkred"),e.token_dkpurple&&(r="dkpurple"),e.token_dkyellow&&(r="dkyellow"),e.token_ltgray&&(r="ltgray"),e.token_dkgray&&(r="dkgray"),e.token_blue&&(r="blue"),e.token_green&&(r="green"),e.token_cyan&&(r="cyan"),e.token_red&&(r="red"),e.token_purple&&(r="purple"),e.token_yellow&&(r="yellow"),e.token_white&&(r="white"),e.token_brown&&(r="brown"),e.token_dkwhite&&(r="dkwhite"),e.token_ltgrey&&(r="ltgrey"),e.token_gray&&(r="gray"),e.token_grey&&(r="grey"),e.token_dkgrey&&(r="dkgrey"),e.token_ltblack&&(r="ltblack"),e.token_onblack&&(r="onblack"),e.token_ondkblue&&(r="ondkblue"),e.token_ondkgreen&&(r="ondkgreen"),e.token_ondkcyan&&(r="ondkcyan"),e.token_ondkred&&(r="ondkred"),e.token_ondkpurple&&(r="ondkpurple"),e.token_ondkyellow&&(r="ondkyellow"),e.token_onltgray&&(r="onltgray"),e.token_ondkgray&&(r="ondkgray"),e.token_onblue&&(r="onblue"),e.token_ongreen&&(r="ongreen"),e.token_oncyan&&(r="oncyan"),e.token_onred&&(r="onred"),e.token_onpurple&&(r="onpurple"),e.token_onyellow&&(r="onyellow"),e.token_onwhite&&(r="onwhite"),e.token_onbrown&&(r="onbrown"),e.token_ondkwhite&&(r="ondkwhite"),e.token_onltgrey&&(r="onltgrey"),e.token_ongray&&(r="ongray"),e.token_ongrey&&(r="ongrey"),e.token_ondkgrey&&(r="ondkgrey"),e.token_onltblack&&(r="onltblack"),e.token_onclear&&(r="onclear"),e.token_blblack&&(r="blblack"),e.token_bldkblue&&(r="blblue"),e.token_bldkgreen&&(r="blgreen"),e.token_bldkcyan&&(r="bldkcyan"),e.token_bldkred&&(r="bldkred"),e.token_bldkpurple&&(r="bldkpurple"),e.token_bldkyellow&&(r="bldkyellow"),e.token_blltgray&&(r="blltgray"),e.token_bldkgray&&(r="bldkgray"),e.token_blblue&&(r="blblue"),e.token_blgreen&&(r="blgreen"),e.token_blcyan&&(r="blcyan"),e.token_blred&&(r="blred"),e.token_blpurple&&(r="blpurple"),e.token_blyellow&&(r="blyellow"),e.token_blwhite&&(r="blwhite"),e.token_blbrown&&(r="blbrown"),e.token_bldkwhite&&(r="bldkwhite"),e.token_blltgrey&&(r="blltgrey"),e.token_blgray&&(r="blgray"),e.token_blgrey&&(r="blgrey"),e.token_bldkgrey&&(r="bldkgrey"),e.token_blltblack&&(r="blltblack"),this.createcodenode(n,{type:12,literal:1,value:r})}dir_mod(e,n){if(e.dir_within)return this.go(e.dir_within);if(e.dir_awayby)return this.go(e.dir_awayby);let r="ERROR";return e.token_cw&&(r="cw"),e.token_ccw&&(r="ccw"),e.token_opp&&(r="opp"),e.token_rndp&&(r="rndp"),e.token_over&&(r="over"),e.token_under&&(r="under"),e.token_ground&&(r="ground"),this.createcodenode(n,{type:12,literal:1,value:r})}dir_by(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"by"}),...this.go(e.simple_token)]}dir_at(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"at"}),...this.go(e.simple_token)]}dir_away(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"away"}),...this.go(e.simple_token)]}dir_toward(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"toward"}),...this.go(e.simple_token)]}dir_find(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"find"}),...this.go(e.kind)]}dir_flee(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"flee"}),...this.go(e.kind)]}dir_to(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"to"}),...this.go(e.dir)]}dir_within(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"within"}),...this.go(e.simple_token)]}dir_awayby(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"awayby"}),...this.go(e.simple_token)]}dir(e,n){const r=this.go(e.dir_mod)??[];return e.token_i&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"i"})),e.token_idle&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"idle"})),e.token_n&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"n"})),e.token_u&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"u"})),e.token_north&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"north"})),e.token_up&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"up"})),e.token_s&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"s"})),e.token_d&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"d"})),e.token_south&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"south"})),e.token_down&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"down"})),e.token_w&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"w"})),e.token_l&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"l"})),e.token_west&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"west"})),e.token_left&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"left"})),e.token_e&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"e"})),e.token_r&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"r"})),e.token_east&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"east"})),e.token_right&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"right"})),e.token_rnd&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"rnd"})),e.token_rndne&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"rndne"})),e.token_rndns&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"rndns"})),e.token_flow&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"flow"})),e.token_seek&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"seek"})),e.dir_by&&r.push(...this.go(e.dir_by)),e.dir_at&&r.push(...this.go(e.dir_at)),e.dir_away&&r.push(...this.go(e.dir_away)),e.dir_toward&&r.push(...this.go(e.dir_toward)),e.dir_find&&r.push(...this.go(e.dir_find)),e.dir_flee&&r.push(...this.go(e.dir_flee)),e.dir_to&&r.push(...this.go(e.dir_to)),r.flat()}expr_any(e){return[this.go(e.dir),this.go(e.kind),this.go(e.color)].flat()}token_expr_any(e,n){return[this.createcodenode(n,{type:12,literal:1,value:"any"}),this.go(e.expr_any)].flat()}token_expr_count(e,n){return[this.createcodenode(n,{type:12,literal:1,value:"countof"}),this.go(e.expr_any)].flat()}token_expr_blocked(e,n){return[this.createcodenode(n,{type:12,literal:1,value:"blocked"}),this.go(e.dir)].flat()}token_expr_abs(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"abs"}),...this.go(e.simple_token)]}token_expr_intceil(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intceil"}),...this.go(e.simple_token)]}token_expr_intfloor(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intfloor"}),...this.go(e.simple_token)]}token_expr_intround(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intround"}),...this.go(e.simple_token)]}token_expr_clamp(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"clamp"}),...this.go(e.simple_token)]}token_expr_min(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"min"}),...this.go(e.simple_token)]}token_expr_max(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"max"}),...this.go(e.simple_token)]}token_expr_pick(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pick"}),...this.go(e.simple_token)]}token_expr_pickwith(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pickwith"}),...this.go(e.simple_token)]}token_expr_random(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"random"}),...this.go(e.simple_token)]}token_expr_randomwith(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"randomwith"}),...this.go(e.simple_token)]}token_expr_run(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"run"}),...this.go(e.string_token)]}token_expr_runwith(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"runwith"}),...this.go(e.simple_token),...this.go(e.string_token)]}token_expr(e,n){return e.token_expr_aligned?this.createcodenode(n,{type:12,literal:1,value:"aligned"}):e.token_contact?this.createcodenode(n,{type:12,literal:1,value:"contact"}):e.token_expr_any?this.go(e.token_expr_any):e.token_expr_count?this.go(e.token_expr_count):e.token_expr_blocked?this.go(e.token_expr_blocked):e.token_expr_abs?this.go(e.token_expr_abs):e.token_expr_intceil?this.go(e.token_expr_intceil):e.token_expr_intfloor?this.go(e.token_expr_intfloor):e.token_expr_intround?this.go(e.token_expr_intround):e.token_expr_clamp?this.go(e.token_expr_clamp):e.token_expr_min?this.go(e.token_expr_min):e.token_expr_max?this.go(e.token_expr_max):e.token_expr_pick?this.go(e.token_expr_pick):e.token_expr_pickwith?this.go(e.token_expr_pickwith):e.token_expr_random?this.go(e.token_expr_random):e.token_expr_randomwith?this.go(e.token_expr_randomwith):e.token_expr_run?this.go(e.token_expr_run):e.token_expr_runwith?this.go(e.token_expr_runwith):[]}string_token(e,n){if(e.token_stringliteraldouble){const r=Ec(e.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=Ec(e.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:r})}return[]}simple_token(e,n){if(e.token_stringliteraldouble){const r=Ec(e.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=Ec(e.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(e.token_numberliteral){const r=parseFloat(Ec(e.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return e.color?this.go(e.color):[]}token(e,n){if(e.category)return this.go(e.category);if(e.collision)return this.go(e.collision);if(e.color)return this.go(e.color);if(e.dir)return this.go(e.dir);if(e.command_play)return this.go(e.command_play);if(e.command_toast)return this.go(e.command_toast);if(e.command_ticker)return this.go(e.command_ticker);if(e.token_label){const r=Ec(e.token_label,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(e.token_stringliteraldouble){const r=Ec(e.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=Ec(e.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(e.token_numberliteral){const r=parseFloat(Ec(e.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}if(e.token_lparen)return[this.createexprnodeondemand(this.go(e.expr),n)];if(e.token_stop){const r=Ec(e.token_stop,"");return this.createcodenode(n,{type:12,literal:1,value:r})}return[]}}const NVe=new IVe,Lh={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},fP="zss.js";function ts(t,e){return new AVe.SourceNode(t.startLine??1,t.startColumn??1,fP,e)}function J5(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Dk(t){return`'${J5(t)}'`}function B4(t){const e=FM(t);return e.errors.length?t:`['${e.tokens.map(r=>{if(r.tokenType===Z3){const i=J5(r.image.substring(1));return hr(i)==="center"?"$CENTER":`', api.get('${i}'), '`}return J5(r.image)}).join("")}'].join('')`}function yC(t){return t.filter(e=>e!==void 0).map(ks)}function iY(t){return ts(t,"")}function PVe(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function _l(t,e,n){return ts(t,[`api.${e}(`,...PVe(n,", "),")"])}function DVe(t){if(t.type===Bn.COMPARE&&t.compare.type===Bn.COMPARE_ITEM)switch(t.compare.method){case o1.IS_EQ:return _l(t,"isEq",[ks(t.lhs),ks(t.rhs)]);case o1.IS_NOT_EQ:return _l(t,"isNotEq",[ks(t.lhs),ks(t.rhs)]);case o1.IS_LESS_THAN:return _l(t,"isLessThan",[ks(t.lhs),ks(t.rhs)]);case o1.IS_GREATER_THAN:return _l(t,"isGreaterThan",[ks(t.lhs),ks(t.rhs)]);case o1.IS_LESS_THAN_OR_EQ:return _l(t,"isLessThanOrEq",[ks(t.lhs),ks(t.rhs)]);case o1.IS_GREATER_THAN_OR_EQ:return _l(t,"isGreaterThanOrEq",[ks(t.lhs),ks(t.rhs)])}return ts(t,"")}function qb(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",ks(n),")"])}function sY(t,e,n){return t.prepend(`api.${e}(`),t.add([ks(n),")"])}function LVe(t,e){if(t.type===Bn.OPERATOR_ITEM)switch(t.operator){case a0.PLUS:return qb(e,"opPlus",t.rhs);case a0.MINUS:return qb(e,"opMinus",t.rhs);case a0.POWER:return qb(e,"opPower",t.rhs);case a0.MULTIPLY:return qb(e,"opMultiply",t.rhs);case a0.DIVIDE:return qb(e,"opDivide",t.rhs);case a0.MOD_DIVIDE:return qb(e,"opModDivide",t.rhs);case a0.FLOOR_DIVIDE:return qb(e,"opFloorDivide",t.rhs);case a0.UNI_PLUS:return sY(e,"opUniPlus",t.rhs);case a0.UNI_MINUS:return sY(e,"opUniMinus",t.rhs)}return ts(t,"")}function UVe(t){if(t.type===Bn.OPERATOR){const e=t.lhs?ks(t.lhs):ts(t,"");return t.items.forEach(n=>LVe(n,e)),e}return ts(t,"")}function Lk(t,e){return ts(t,[_l(t,"jump",[`${e}`]),"; continue;"])}function $_(t){return Lh.linelookup[t??""]??-1}function Q5(t,e){Lh.linelookup[t]=e}function _S(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case Bn.WHILE:case Bn.REPEAT:case Bn.FOREACH:case Bn.ELSE_IF:i.type===e&&(i.done=n);break;case Bn.IF_BLOCK:case Bn.IF_CHECK:i.type===e&&(i.skip=n);break;case Bn.LINE:_S(i.stmts,e,n);break}}}function ole(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case Bn.WHILE:case Bn.REPEAT:case Bn.FOREACH:case Bn.ELSE_IF:i.type===e&&Q5(i.done,n);break;case Bn.IF_BLOCK:case Bn.IF_CHECK:i.type===e&&Q5(i.skip,n);break;case Bn.LINE:ole(i.stmts,e,n);break}}}function ks(t){switch(t.type){case Bn.PROGRAM:return ts(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { return 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(ks).flat(),`default:
`,`  return 0;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${fP}`]);case Bn.API:return ts(t,["  ",_l(t,t.method,yC(t.words)),`;
`]);case Bn.LINE:return ts(t,[`case ${t.lineindex}:
`,...t.stmts.map(ks).flat(),`  break;
`]);case Bn.MARK:return ts(t,`  // ${t.comment}
`);case Bn.GOTO:{const e=$_(t.id);return ts(t,["  ",Lk(t,e),`
`])}case Bn.COUNT:return ts(t,`${t.index}`);case Bn.LITERAL:switch(t.literal){case VO.NUMBER:return ts(t,`${t.value}`);case VO.STRING:return ts(t,Dk(t.value));case VO.TEMPLATE:return ts(t,B4(t.value))}return iY(t);case Bn.TEXT:return ts(t,["  ",_l(t,"text",[B4(t.value)]),`;
`]);case Bn.STAT:if(Lh.isfirststat){Lh.isfirststat=!1;const e=t.value.trim().split(" ").map(Dk);return ts(t,["  ",_l(t,"stat",e),`;
`])}return ts(t,`  // skipped ${t.value}
`);case Bn.LABEL:{const e=hr(t.name),n=t.active?"label":"comment";Lh.labels[e]||(Lh.labels[e]=[]);const r=(t.active?1:-1)*t.lineindex;return Lh.labels[e].push(r),ts(t,`  // ${r} '${e}' ${n}
`)}case Bn.HYPERLINK:return ts(t,["  ",_l(t,"hyperlink",[B4(t.text),...t.link.split(" ").filter(e=>e.length>0).map(Dk)]),`;
`]);case Bn.MOVE:{const e=_l(t,"command",[Dk("go"),yC(t.words)].flat());return t.wait?ts(t,["  if (",e,`) { continue; };
`]):ts(t,["  ",e,`;
`])}case Bn.COMMAND:return ts(t,["  if (",_l(t,"command",yC(t.words)),`) { continue; };
`]);case Bn.IF:{const e=t.block?.type===Bn.IF_BLOCK?t.block:void 0;if(ge(e)){_S([t.check],Bn.IF_CHECK,e.skip);const n=ts(t,ks(t.check));return e.lines.forEach(r=>n.add(ks(r))),ole(e.altlines,Bn.ELSE_IF,$_(e.done)),e.altlines.forEach(r=>n.add(ks(r))),n}return ts(t,ks(t.check))}case Bn.IF_CHECK:{const e=$_(t.skip);return e===-1?ts(t,["  ",_l(t,t.method,yC(t.words)),`;
`]):ts(t,["  if (!",_l(t,t.method,yC(t.words)),") { ",Lk(t,e),` }
`])}case Bn.ELSE_IF:case Bn.ELSE:{const e=ts(t,"");return t.lines.forEach(n=>e.add(ks(n))),e}case Bn.WHILE:{const e=$_(t.loop),n=$_(t.done),r=ts(t,"");return _S(t.lines,Bn.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Bn.BREAK:i.goto=n;break;case Bn.CONTINUE:i.goto=e;break}r.add(ks(i))}),r}case Bn.REPEAT:{const e=$_(t.loop),n=$_(t.done),r=ts(t,"");return _S(t.lines,Bn.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Bn.BREAK:i.goto=n;break;case Bn.CONTINUE:i.goto=e;break}r.add(ks(i))}),r}case Bn.WAITFOR:{const e=ts(t,"");return _S(t.lines,Bn.IF_CHECK,t.loop),t.lines.forEach(n=>{e.add(ks(n))}),e}case Bn.FOREACH:{const e=$_(t.loop),n=$_(t.done),r=ts(t,"");return _S(t.lines,Bn.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Bn.BREAK:i.goto=n;break;case Bn.CONTINUE:i.goto=e;break}r.add(ks(i))}),r}case Bn.BREAK:return ts(t,["  ",Lk(t,t.goto),`
`]);case Bn.CONTINUE:return ts(t,["  ",Lk(t,t.goto),`
`]);case Bn.OR:return _l(t,"or",t.items.map(ks));case Bn.AND:return _l(t,"and",t.items.map(ks));case Bn.NOT:return _l(t,"not",t.items.map(ks));case Bn.COMPARE:return DVe(t);case Bn.OPERATOR:return UVe(t);case Bn.EXPR:return _l(t,"expr",t.words.map(ks));default:return console.error("<unsupported node>",t.type,t),iY(t)}}function c0(t){if(ge(t))switch(t.type===Bn.LINE&&++Lh.lineindex,t.lineindex=Lh.lineindex,t.type){case Bn.PROGRAM:t.lines.forEach(c0);break;case Bn.LINE:t.stmts.forEach(c0);break;case Bn.MARK:Q5(t.id,t.lineindex);break;case Bn.IF:c0(t.check),c0(t.block);break;case Bn.IF_BLOCK:t.lines.forEach(c0),t.altlines.forEach(c0);break;case Bn.ELSE_IF:t.lines.forEach(c0);break;case Bn.ELSE:case Bn.WHILE:case Bn.REPEAT:case Bn.FOREACH:case Bn.WAITFOR:t.lines.forEach(c0);break;case Bn.MOVE:case Bn.COMMAND:case Bn.IF_CHECK:t.words.forEach(c0);break}}function ale(t){Lh.labels={},Lh.internal=1,Lh.lineindex=0,Lh.isfirststat=!0,c0(t)}function BVe(t){return ale(t),{...ks(t).toStringWithSourceMap({file:`${fP}.map`}),...Lh}}function oY(t){return Rr(t)?t.length>0?1:0:t??0}function FVe(t){return`${t}_chip`}function cle(t=""){return`vm:${t??""}`}function jVe(t,e,n){const r=FVe(t),i=zy(r);let s;const o=na(Object.entries(n.labels??{}));(!Rr(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(n.errors?.length??0)!==0?1:0);function a(l,u){Ee.words=u;const h=Nqe(e,l);return ge(h)?h(c,u):l!=="send"?a("shortsend",[l,...u]):0}const c={halt(){WVe(r)},id(){return t},set(l,u){const[h,d]=Dqe(e,c,l,u);if(h)return d},get(l){const[u,h]=Pqe(e,c,l);if(u)return h},tick(l){const u=an(i.ps)?i.ps:0,h=u%l===0;if(i.ps=u+1,h===!1)return!1;Lqe(e,c);const d=c.shouldtick();if(d){i.lc=0,i.ys=0,Ee.get=c.get;try{s?.(c)||(i.es=1)}catch(m){Pr(ut,Ee.elementfocus,"crash",m.message),i.es=1}}return Uqe(e,c),d},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return an(i.lc)?++i.lc>En.HALT_AT_COUNT:!0},haslabel(l){if(Rr(i.lb))for(let u=0;u<i.lb.length;++u){const[h,d]=i.lb[u];if(h===l)return(d.find(p=>an(p)&&p>0)??0)>0}return!1},hm(){if(Rr(i.mg)&&Rr(i.lb)){const[l]=i.mg;if(ge(l))for(let u=0;u<i.lb.length;++u){const[h,d]=i.lb[u];if(h===l)return d.find(m=>an(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(l){i.ec=l},sy(){return!!i.ys||c.shouldhalt()},send(l,u,h,d){ut.emit(l,`${cle(u)}:${h}`,d)},lock(l){i.lk=l},unlock(){i.lk=""},message(l){i.lk&&l.sender!==i.lk||c.haslabel(l.target)&&(i.mg=[l.target,l.data,l.sender,l.player])},zap(l){if(Rr(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l){const d=h[1].findIndex(m=>m>0);if(d>=0&&ge(h[1])){h[1][d]*=-1;break}}}},restore(l){if(Rr(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l)for(let d=0;d<h[1].length;d++)h[1][d]=Math.abs(h[1][d])}},getcase(){i.ec=an(i.ec)?i.ec:1;const l=c.hm();if(l&&Rr(i.mg)){const[,u,h,d]=i.mg;c.set("senderid",h),ge(u)&&c.set("arg",u),d&&(c.set("player",d),Ee.elementfocus=d),i.mg=void 0,i.ys=0,i.es=0,i.ec=l}return i.ec},nextcase(){const l=an(i.ec)?i.ec:1;return i.ec=l+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(l){const u=VIe.parse(l),[h]=u.filter(d=>d.fileName===fP);return{line:h?.lineNumber??0,column:h?.columnNumber??0}},text(l){return a("text",[l])},stat(...l){return a("stat",l)},hyperlink(...l){return a("hyperlink",l)},command(...l){if(l.length===0)return 0;const[u,...h]=l;return a(hr(rc(u)),h)},if(...l){const[u,h]=Gt(l,0,[yt.ANY]),d=oY(u);return d&&h<l.length&&c.command(...l.slice(h)),d?1:0},try(...l){const[,u]=Gt(l,0,[yt.DIR]),h=c.command("go",...l);return h&&u<l.length&&c.command(...l.slice(u)),h?1:0},take(...l){const[u,h,d]=Gt(l,0,[yt.NAME,yt.ANY]),m=an(h),p=m?d:1,g=c.get(u),y=m?h:1;if(!an(g))return p<l.length&&c.command(...l.slice(p)),1;const v=g-y;return v<0?(p<l.length&&c.command(...l.slice(p)),1):(c.set(u,v),0)},give(...l){const[u,h,d]=Gt(l,0,[yt.NAME,yt.ANY]),m=an(h),p=m?d:1,g=c.get(u),y=m?h:1,v=g===void 0?1:0;return v&&p<l.length&&c.command(...l.slice(p)),c.set(u,Ru(g,0)+y),v},duplicate(...l){return c.command("duplicate",...l)},repeatstart(l,...u){const[h,d]=Gt(u,0,[yt.NUMBER]),m=`repeatcount${l}`,p=`repeatwords${l}`;i[m]=h,i[p]=d<u.length?u.slice(d):void 0},repeat(l){const u=`repeatcount${l}`,h=`repeatwords${l}`;if(!an(i[u]))return 0;const d=i[u];i[u]=d-1;const m=d>0,p=i[h];return m&&Rr(p)&&c.command(...p),m?1:0},foreachstart(l,...u){const[h,d,m,p]=Gt(u,0,[yt.NAME,yt.NUMBER,yt.NUMBER,yt.MAYBE_NUMBER]);let g=Math.min(d,m),y=Math.max(d,m);const v=(p??0)||1;if(v<0){const x=g;g=y,y=x}return c.set(h,g-v),0},foreach(l,...u){const[h,d,m,p,g]=Gt(u,0,[yt.NAME,yt.NUMBER,yt.NUMBER,yt.MAYBE_NUMBER]);let y=Math.min(d,m),v=Math.max(d,m);const x=(p??0)||1;if(x<0){const A=y;y=v,v=A}let E=c.get(h);!an(E)||E<y||E>v?E=y:E+=x;const C=E<=v?1:0;return C&&(c.set(h,E),g<u.length&&c.command(...u.slice(g))),C},waitfor(...l){const[u]=Gt(l,0,[yt.ANY]),h=oY(u);return h||c.yield(),h?1:0},or(...l){let u=0;for(let h=0;h<l.length;){const[d,m]=Gt(l,h,[yt.ANY]);if(u=d,u)break;h=m}return u},and(...l){let u=0;for(let h=0;h<l.length;){const[d,m]=Gt(l,h,[yt.ANY]);if(u=d,!u)break;h=m}return u},not(...l){const[u]=Gt(l,0,[yt.ANY]);return u?0:1},expr(...l){const[u]=Gt(l,0,[yt.ANY]);return u},isEq(l,u){const[h]=Gt([l],0,[yt.ANY]),[d]=Gt([u],0,[yt.ANY]);return typeof h=="object"||typeof d=="object"?Ty(h,d)?1:0:h===d?1:0},isNotEq(l,u){return this.isEq(l,u)?0:1},isLessThan(l,u){const[h]=Gt([l],0,[yt.NUMBER]),[d]=Gt([u],0,[yt.NUMBER]);return h<d?1:0},isGreaterThan(l,u){const[h]=Gt([l],0,[yt.NUMBER]),[d]=Gt([u],0,[yt.NUMBER]);return h>d?1:0},isLessThanOrEq(l,u){const[h]=Gt([l],0,[yt.NUMBER]),[d]=Gt([u],0,[yt.NUMBER]);return h<=d?1:0},isGreaterThanOrEq(l,u){const[h]=Gt([l],0,[yt.NUMBER]),[d]=Gt([u],0,[yt.NUMBER]);return h>=d?1:0},opPlus(l,u){const[h]=Gt([l],0,[yt.ANY]),[d]=Gt([u],0,[yt.ANY]);return h+d},opMinus(l,u){const[h]=Gt([l],0,[yt.ANY]),[d]=Gt([u],0,[yt.ANY]);return h-d},opPower(l,u){const[h]=Gt([l],0,[yt.NUMBER]),[d]=Gt([u],0,[yt.NUMBER]);return Math.pow(h,d)},opMultiply(l,u){const[h]=Gt([l],0,[yt.NUMBER]),[d]=Gt([u],0,[yt.NUMBER]);return h*d},opDivide(l,u){const[h]=Gt([l],0,[yt.NUMBER]),[d]=Gt([u],0,[yt.NUMBER]);return h/d},opModDivide(l,u){const[h]=Gt([l],0,[yt.NUMBER]),[d]=Gt([u],0,[yt.NUMBER]);return h%d},opFloorDivide(l,u){const[h]=Gt([l],0,[yt.NUMBER]),[d]=Gt([u],0,[yt.NUMBER]);return Math.floor(h/d)},opUniPlus(l){const[u]=Gt([l],0,[yt.NUMBER]);return+u},opUniMinus(l){const[u]=Gt([l],0,[yt.NUMBER]);return-u}};return s=n.code,c}function eB(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];Rr(r)?r.forEach(i=>{e.push(eB(i))}):e.push(eB(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>n?.start??0)),end:Math.max(...e.filter(n=>n).map(n=>n?.end??0))},t.range}function lle(t){const e=yae(`${t}
`);if(e.errors.length>0)return e;MS.input=e.tokens;const n=MS.program();if(MS.errors.length>0)return{tokens:e.tokens,errors:MS.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=NVe.go(n);return r?(eB(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}function zVe(t,e){const n=`compile-${t}`;console.time(n);const r=lle(e);if(console.timeEnd(n),E$&&console.info(e,r.errors),r.errors&&r.errors.length>0)return console.info(e,r.tokens,r.errors),r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=BVe(r.ast);if(i.code){E$&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Function("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Function("api"," ")}}}return{...r,...i,source:"",code:new Function("api"," ")}}function HVe(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=zVe(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return ge(s)?s.isended():!0},halt(i){const s=e[i];return ge(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];ge(o)&&o.set("arg",s)},tick(i,s,o,a,c){let l=e[i];if(!ge(e[i])){const u=n(a,c);if(l=e[i]=jVe(i,s,u),u.errors?.length){const[h]=u.errors,d=(h?.line??2)-1,m=c.replaceAll(`\r
`,"").split(`
`).map((E,C)=>[E,C]),p=m.slice(d-2,d);for(let E=0;E<p.length;++E){const[C,A]=p[E];Pr(ut,kS(),"build",`$grey${A+1} $grey${C}`)}const[g,y]=m[d]??[];if(Sn(g)&&ge(y)){const E=(h.column??1)-1,C=E+h.length,A=E<g.length?g:`${g}*`,k=A.substring(0,E),M=A.substring(E,C),I=A.substring(C);Pr(ut,kS(),"build",`$red${y+1} $grey${k}$red${M}$grey${I}`)}const v=m.slice(d+1,d+3);for(let E=0;E<v.length;++E){const[C,A]=v[E];Pr(ut,kS(),"build",`$grey${A+1} $grey${C}`)}const x=h.message.split(`
`).slice(0,4).join(" ");return Pr(ut,kS(),"build",x),!1}}return!!l?.tick(o)},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=P1(i.target),a=e[s];if(ge(a)){const c={...i,target:o};a.message(c)}}};return r}new Vn;const A7=HVe();var qp=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.GADGETSTORE="gadgetstore",t))(qp||{});const pm={session:va(),operator:"",software:{main:"",content:""},books:new Map};function kS(){return pm.operator}function nv(){return[...pm.books.values()]}function qVe(){const[t]=pm.books.values();return t}function av(t){const e=hr(t);return pm.books.get(t)??nv().find(n=>n.name===e)}function ule(t,e){ge(av(e))&&(pm.software[t]=e)}function A0(t){return av(pm.software[t])}function fle(t){const e=Sae([]);return Sn(t)&&(e.name=t),hle(e),Ei(ut,pm.operator,`created [book] ${e.name}`),e}function VVe(t){let e=av(t);return ge(e)||(e=Sae([]),e.name=t),hle(e),Ei(ut,pm.operator,`created [book] ${e.name}`),e}function jy(t,e){let n=ge(e)?VVe(e):A0(t);return ge(n)||(ge(n)||(n=qVe()),ge(n)||(n=fle(e)),ge(n)&&Ei(ut,pm.operator,`opened [book] ${n.name} for ${t}`)),ule(t,n.id),n}function GVe(t,e,n){return P5(jy(t),n,e)}function _g(t,e){const n=A0("main"),r=Wp(D5(n,t,e));if(ge(r))return r;const i=nv();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==n?.id){const a=Wp(D5(o,t,e));if(ge(a))return a}}}function tb(t){if(ge(t?.kinddata))return t.kinddata;if(!Sn(t?.kind)||!t.kind)return;const e=_g(Tr.OBJECT,t.kind);if(ge(e))return t.kinddata=Tl(e),t.kinddata;const n=_g(Tr.TERRAIN,t.kind);if(ge(n))return t.kinddata=Tl(n),t.kinddata}function Yr(t,e){const n=t?.kinddata,r=n?.id??"",i=t?.[e];if(ge(i))return i;const s=n?.[e];if(ge(s))return s;const o=_g(Tr.OBJECT,r)??_g(Tr.TERRAIN,r),a=W5e(o,e);if(ge(a))return a;switch(e){case"group":return"";case"cycle":return NIe;case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"item":case"pushable":case"breakable":return 0;case"collision":return Qn.ISWALK;default:return}}function tB(t,e){const n={x:t?.x??-1,y:t?.y??-1},r={x:e?.x??-1,y:e?.y??-1},i=p0(n,r),s=Yr(e,"pushable");return an(s)?s!==0:Sn(s)?s.trim().split(" ").map(o=>lre(b3(o))).some(o=>o===i):!1}function nm(t,e,n,r){if(!ge(t)||!ge(e))return;const[i,s]=e,o=_g(Tr.OBJECT,i);if(ge(o)){const c=Aae(t,n,i,r);if(ge(c))return HA(c,s),tb(c),Yr(c,"collision")!==Qn.ISGHOST&&(Cae(t,c),B5(t,c)),c}const a=_g(Tr.TERRAIN,i);if(ge(a)){const c=rBe(t,n,i);if(ge(c)){HA(c,s),tb(c);const l=Wc(n,wn);return B5(t,c,l),c}}}function $Ve(t,e,n){if(!ge(t)||!ge(e))return;const[r,i]=e,s=_g(Tr.OBJECT,r);if(ge(s)){const o=Aae(t,n,r);return HA(o,i),o}}function qf(t){const e=_g(Tr.BOARD,t);return Tl(e)}function zy(t){const e=jy("main");return z3(e,t)}function aY(){const t=jy("main");return z3(t,"main")}function WVe(t){const e=jy("main");return Y5e(e,t)}function hle(t){return pm.books.set(t.id,t),t.id}function KVe(t){const e=av(t);e&&pm.books.delete(e.id)}function dle(t){const e=A0("main"),n=sN(e,t,"board"),r=_g(Tr.BOARD,n);return Tl(r)}function xc(t,e,n,r){if(Sn(n.id))if(Sn(e.id))yH(ut,t,e.id,n.id,r);else{const i=`${Wc({x:e.x??0,y:e.y??0},wn)}`;yH(ut,t,i,n.id,r)}}function XVe(t,e,n,r){const i=n.id??"";if(r.x<0){const s=qf(e?.exitwest??"");ge(s)&&AS(t,i,s.id,{x:wn-1,y:r.y})}else if(r.x>=wn){const s=qf(e?.exiteast??"");ge(s)&&AS(t,i,s.id,{x:0,y:r.y})}else if(r.y<0){const s=qf(e?.exitnorth??"");ge(s)&&AS(t,i,s.id,{x:r.x,y:Nr-1})}else if(r.y>=Nr){const s=qf(e?.exitsouth??"");ge(s)&&AS(t,i,s.id,{x:r.x,y:0})}}function cY(t,e,n,r){const i=sN(t,r,"enterx"),s=sN(t,r,"entery");an(i)&&an(s)&&ge(n)&&F5(e,n,{x:i,y:s})}function Fd(t,e,n,r,i={}){if(!ge(n?.id))return!1;let s=F5(e,n,r);const o=Yr(n,"collision");if(ge(s)&&o!==Qn.ISBULLET){const a=$p(n?.id),c=!!Yr(s,"item"),l=tB(n,s),u=s.id??"";if(l&&(!a||!c)&&!i[u]){i[u]=!0;const h=p0({x:n.x??0,y:n.y??0},r),d=Ja({x:s.x??0,y:s.y??0},h);Fd(t,e,s,d)}s=F5(e,n,r)}if(ge(s)){const a=$p(n.id),c=$p(n.party??n.id),l=Yr(n,"collision")===Qn.ISBULLET,u=n.kind??"";let h="";n.party&&c&&(h=n.party),a&&(h=n.id);const d=$p(s.id),m=$p(s.party??s.id),p=Yr(s,"collision")===Qn.ISBULLET,g=s.kind??"",y=c===m;let v="";if(s.party&&m&&(v=s.party),d&&(v=s.id??""),a&&g==="edge")XVe(t,e,n,r);else if(a)d?(xc(y?"":v,s,n,"thud"),xc(y?"":h,n,s,"bump")):p?(e?.restartonzap&&cY(t,e,n,h),xc(y?"":v,s,n,y?"partyshot":"shot"),xc(h,n,s,"thud")):(xc(y?"":v,s,n,"thud"),xc(y?"":h,n,s,"touch"));else if(l)if(d)e?.restartonzap&&cY(t,e,s,v),xc(y?"":v,s,n,"thud"),xc(y?"":h,n,s,y?"partyshot":"shot");else if(p)xc(y?"":v,s,n,"thud"),xc(y?"":h,n,s,"thud");else switch(xc(y?"":v,s,n,"thud"),g){case"object":case"scroll":xc(y?"":h,n,s,"shot");break;default:xc(y?"":h,n,s,y?"partyshot":"shot");break}else if(d)xc(y?"":v,s,n,"thud"),xc(y?"":h,n,s,"bump");else if(p){switch(u){case"object":case"scroll":xc(y?"":h,n,s,"shot");break;default:xc(y?"":h,n,s,y?"partyshot":"shot");break}xc(y?"":h,n,s,"thud")}else xc(y?"":v,s,n,"thud"),xc(y?"":h,n,s,"bump");if(l&&Yr(s,"breakable"))if(ge(s?.id)){const x=ro(e,{x:s.x??-1,y:s.y??-1});ge(x)&&$d(Ee.board,x,Ee.timestamp)}else ku(e,{x:r.x,y:r.y});return!1}return!0}function YVe(t,e,n,r){if(!ge(t)||!ge(e)||!ge(n))return;const i={...Ee};Ee.book=t,Ee.board=e,Ee.element=n,Ee.elementid=n.id??"",Ee.elementisplayer=$p(Ee.elementid);const s=Ee.element.player??pm.operator;Ee.elementfocus=Ee.elementisplayer?Ee.elementid:s;const o=Yr(n,"cycle"),a=n.id??"",c=hr(n.name??n.kinddata?.name??"");if(A7.tick(a,T7.RUNTIME,o,c,r),an(n?.tickertime)&&Ee.timestamp-n.tickertime>v3*5&&(n.tickertime=0,n.tickertext=""),Ee.elementisplayer){const l=zy(Ee.elementid);an(l.inputcurrent)&&(l.inputcurrent=0)}Cv(i).forEach(l=>{Ee[l]=i[l]})}function ZVe(t){A7.halt(t)}function vN(t,e,n,r){const i=A0("main");if(!ge(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(ge(c.id)){const l=`${cle(c.id)}:${e}`;ut.emit("",l,n)}}}if(By(t)){for(let o=0;o<r.length;++o){const a=r[o],c=ro(a,t);ge(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(hr(t)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(wae(a,[t]));break}}}}function yN(t){const e=jy("main"),n=qA(e,t);if(!ge(e)||!ge(n)||!ge(Ee.element))return;const r={...Ee},i=`${t}_run`,s=hr(Ee.element.name??Ee.element.kinddata?.name??""),o=n?.code??"";A7.once(i,T7.RUNTIME,s,o),Cv(r).forEach(a=>{Ee[a]=r[a]})}async function ple(t){const e=new FormData;e.append("url",t);const n=new Request("https://bytes.zed.cafe",{method:"POST",body:e});return await(await fetch(n)).text()}function mle(){return window.location.href.includes("/join/")}function bN(){return window.location.href.includes("/locked/")}const JVe=t=>t;function M7(t,e=JVe){const n=zd.useSyncExternalStore(t.subscribe,zd.useCallback(()=>e(t.getState()),[t,e]),zd.useCallback(()=>e(t.getInitialState()),[t,e]));return zd.useDebugValue(n),n}const lY=t=>{const e=c3(t),n=r=>M7(e,r);return Object.assign(n,e),n},gb=t=>t?lY(t):lY;function uY(t){const e=et.useRef(null);return n=>{const r=t(n);return(e.current===void 0||r===void 0?e.current===r:Ty(e.current,r))?e.current:e.current=r}}const Si=gb(()=>({desync:!1,zsswords:{cli:[],loader:[],runtime:[],flags:[],stats:[],kinds:[],altkinds:[],colors:[],dirs:[],dirmods:[],exprs:[]},gadget:{id:"",board:"",layers:[],tickers:[],scrollname:"",scroll:[],sidebar:[]},slim:[]}));var Yp=(t=>(t[t.TOP=0]="TOP",t[t.FULL=1]="FULL",t[t.BOTTOM=2]="BOTTOM",t[t.SPLIT_X=3]="SPLIT_X",t[t.MAX=4]="MAX",t))(Yp||{});const js=gb(t=>({layout:0,inspector:bN(),quickterminal:!1,toast:"",terminal:{open:!0,info:[],logs:[]},editor:{open:!1,book:"",path:[],type:"",title:""},reset(){t({layout:0,inspector:bN(),quickterminal:!1,toast:"",terminal:{open:!0,logs:[]},editor:{open:!1,book:"",path:[],type:"",title:""}})}})),uo=gb(t=>({scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""],reset(){t({scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""]})}})),_a=gb(t=>({xscroll:0,yscroll:0,cursor:0,select:void 0,reset(){t({xscroll:0,yscroll:0,cursor:0,select:void 0})}})),rv=gb(t=>({pts:[],cursor:void 0,select:void 0,reset(){t({pts:[],cursor:void 0,select:void 0})}}));function gle(t){return t.generateMipmaps=!1,t.minFilter=rf,t.magFilter=rf,t.needsUpdate=!0,t}function g0(t){if(ge(t))return gle(new H0e(vNe(t)))}const WM=et.createContext(zv(1,1,15,1));function ou(){return et.useContext(WM)}const _le=gb(()=>({blink:!1}));setInterval(()=>{_le.setState(t=>({blink:!t.blink}))},333);function ep(){return _le(t=>t.blink)}function vle(){return c3(t=>{function e(){t(n=>({render:n.render+1}))}return{dither:[],render:0,changed(){queueMicrotask(e)}}})}function QVe(t){t.fill(0)}function F4(t,e,n,r,i,s){if(r<0||r>=e||i<0||i>=n)return-1;t[r+i*e]=s}const yle=et.createContext(vle());function eGe(t,e,n){const[r]=et.useState(()=>vle()),i=t*e,s=r.getState();return s.dither.length!==i&&(s.dither=new Array(i).fill(n),s.render=0),r}function ble(){return c3(t=>{function e(){t(n=>({render:n.render+1}))}return{width:0,height:0,char:[],color:[],bg:[],render:0,changed(){queueMicrotask(e)}}})}function KM(t,e,n,r){t.char.fill(e),t.color.fill(n),t.bg.fill(r)}function ec(t,e,n,r,i,s){if(r<0||r>=e||i<0||i>=n)return;const o=r+i*e;Cv(s).forEach(a=>{const c=s[a];ge(c)&&(t[a][o]=c)})}const k7=et.createContext(ble());function vE(t,e,n,r,i){const[s]=et.useState(()=>ble()),o=t*e,a=s.getState();return a.char.length!==o&&(a.width=t,a.height=e,a.char=new Array(o).fill(n),a.color=new Array(o).fill(r),a.bg=new Array(o).fill(i),a.render=0),s}function Ele(){return et.useContext(k7).getState()}const j4=lE(Yx),bC=uE(Xx),Ba=gb(t=>({palette:j4,charset:bC,mood:"",viewimage:"",screen:{},reset(){const e=ge(bC)?pL(bC,sf,of):void 0;t({palette:j4,mood:"",viewimage:"",screen:{},palettedata:fx(j4),charset:bC,charsetdata:g0(bC),spritecharset:e,spritecharsetdata:g0(e)})},setmood(e){t(n=>Ty(n.mood,e)?n:{...n,mood:e})},setviewimage(e){t(n=>Ty(n.viewimage,e)?n:{...n,viewimage:e})},setpalette(e){t(n=>Ty(n.palette,e)?n:{...n,palette:e,palettedata:fx(e)})},setcharset(e){t(n=>{if(Ty(n.charset,e))return n;const r=ge(e)?pL(e,sf,of):void 0;return{...n,charset:e,charsetdata:g0(e),spritecharset:r,spritecharsetdata:g0(r)}})},setaltcharset(e){t(n=>{if(Ty(n.altcharset,e))return n;const r=ge(e)?pL(e,sf,of):void 0;return{...n,altcharset:e,altcharsetdata:g0(e),spritealtcharset:r,spritealtcharsetdata:g0(r)}})},setscreen(e,n){t(r=>Ty(r.screen,n)?r:{...r,screen:{...r.screen,[e]:n}})}}));Ba.getState().reset();const Fh=gb(()=>({active:!0,insetcols:20,insetrows:20,islowrez:!1,islandscape:!0,sidebaropen:!0,keyboardalt:!1,keyboardctrl:!1,keyboardshift:!1,showtouchcontrols:!1,checknumbers:"",wordlist:[],wordlistflag:""}));function ra(t,e,n){n().catch(r=>{console.error(r),Pr(t,e,"crash",r?.message)})}async function Ax(t){return vxe(t)}async function rM(t,e){return bxe(t,e)}function tGe(t){try{return sessionStorage.getItem(t)??void 0}catch(e){Pr(Or,Do,`readsession ${t}`,e.message)}}function nGe(t,e){try{ge(e)?sessionStorage.setItem(t,e):sessionStorage.removeItem(t)}catch(n){Pr(Or,Do,`writesession ${t} <- ${e}`,n.message)}}function Sle(){try{const t=location.hash.slice(1);if(t.length)return t}catch(t){Pr(Or,Do,"crash",t.message)}return""}async function nB(){const t=Sle();if(t.length){const e=await fGe(t);return ge(e)&&e.length>t.length?e:t}return""}async function xle(){const t=await U8("cli");Z8(Do,t)}function rGe(){R0(Or,Do,"#pages")}function iGe(t,e){const n=t==="error"?"$red":"$blue",r=e.map(s=>`${s}`).join(" ");return r.startsWith("!")?`!${r}`:`$onclear${n}${r}`}const fY=/\((\d+)\)/;function Uk(t){const{terminal:e}=js.getState(),n=iGe(t.target,t.data),[r=""]=e.logs,i=[...e.logs],s=nK(r).replace(fY,""),o=nK(n),a=s.indexOf(o);if(o.length&&s.length&&a===0){const c=fY.exec(r);if(ge(c)){const l=parseFloat(c[1])+1;i.shift(),i.unshift(`(${l})${n}`)}else i.shift(),i.unshift(`(2)${n}`)}else i.unshift(n);js.setState(c=>({terminal:{...c.terminal,logs:i}}))}function sGe(t){const{layout:e,editor:n}=js.getState();let i=e+(t?1:-1);if(i<0&&(i+=Yp.MAX),i>=Yp.MAX&&(i-=Yp.MAX),!n.open)switch(i){case Yp.SPLIT_X:i=Yp.TOP;break}js.setState({layout:i})}async function Tle(t){if(t.length===0){Pr(Or,Do,"content","no content found"),await xle(),tte(Or,Do),g8(Or,Do);return}YSe(Or,Do,t)}let iM="";window.addEventListener("hashchange",()=>{ra(Or,Do,async()=>{const t=Sle();if(iM!==t){iM=t;const e=await nB();await Tle(e)}})});async function wle(t,e,n){if(t.length>2048){const i=await uGe(t);return wle(i,e,n)}const r=`#${t}`;if(location.hash!==r){iM=t,location.hash=r;const i=`wrote ${n.length} chars [${n.slice(0,8)}...${n.slice(-8)}]`;e.includes("autosave")||Ei(Or,Do,i),document.title=e}}function Rle(t){switch(t){case"crt":return"on";default:return"off"}}async function GO(t){const e=await Ax(`config_${t}`);return e?e&&e!=="off"?"on":"off":Rle(t)}async function oGe(t,e){return Ei(Or,Do,`writing config ${t}`),rM(`config_${t}`,()=>e)}async function aGe(){const t=["config_crt","config_lowrez","config_scanlines","config_voice2text"];return(await yxe(t)).map((n,r)=>{const s=t[r].replace("config_","");return n?[s,n&&n!=="off"?"on":"off"]:[s,Rle(s)]})}async function cGe(){return Ax("HISTORYBUFFER")}async function lGe(t){return rM("HISTORYBUFFER",()=>t)}async function uGe(t){let e=await Ax(t);if(e===void 0){for(;e===void 0;){const n=_8({addAdverb:!0,capitalize:!1,adjectiveCount:2});await Ax(n)===void 0&&(e=n)}await rM(t,()=>e),await rM(e,()=>t)}return e}async function fGe(t){return await Ax(t)}let z4=0;const hY=10,Do=tGe("PLAYER")??Oxe();nGe("PLAYER",Do);let dY;function ui(){return Do}const Or=lb("register",["ready","second","info","error","log","chat","toast"],function(t){if(Or.session(t)){switch(t.target){case"ready":case"chat":case"toast":case"second":break;default:if(t.player!==Do)return;break}switch(t.target){case"ready":{ra(Or,t.player,async()=>{const e=await cGe();ge(e)&&uo.setState({buffer:e.filter(n=>n.includes("#broadcast")===!1)}),await Kl(256),Ei(Or,Do,`myplayerid ${Do}`),GSe(Or,Do)});break}case"refresh":ra(Or,t.player,async()=>{Fh.setState({active:!1}),await Kl(512),js.getState().reset(),Ba.getState().reset(),_a.getState().reset(),uo.getState().reset(),rv.getState().reset(),Si.setState({gadget:{id:"",board:"",layers:[],tickers:[],scrollname:"",scroll:[],sidebar:[]}}),await Kl(512),Fh.setState({active:!0})});break;case"ackoperator":SSe(Or,Do),ra(Or,t.player,async()=>{const e=await nB();mle()?_Se(Or,Do,e):(XSe(Or,Do,bN()),await Tle(e))});break;case"loginready":ra(Or,t.player,async()=>{const e=await Ax("storage");JSe(Or,Do,e??{}),tte(Or,Do)});break;case"loginfail":ra(Or,t.player,async()=>{await xle(),rGe(),g8(Or,Do),qh(Or,t.player,void 0,"text","sim:load","")});break;case"acklogin":xI(Or,Do),qh(Or,t.player,void 0,"text","sim:load","");break;case"ackzsswords":{Si.setState({zsswords:t.data});const e=[],n=Object.values(t.data);for(let r=0;r<n.length;++r)e.push(...n[r]);break}case"storage":ra(Or,t.player,async()=>{ge(t.data)&&await rM("storage",()=>t.data)});break;case"copy":Sn(t.data)&&ge(po())&&po().writeText(t.data).then(()=>tv(Or,t.player,"copied!")).catch(e=>console.error(e));break;case"copyjsonfile":if(Rr(t.data)&&ge(po())){const[e,n]=t.data,r=new Blob([JSON.stringify({exported:n,data:e},null,2)],{type:"text/plain"});po().write([new ClipboardItem({[r.type]:r})]).then(()=>tv(Or,t.player,"copied!")).catch(i=>console.error(i))}break;case"downloadjsonfile":if(Rr(t.data)){const[e,n]=t.data;try{const r=new Blob([JSON.stringify({exported:n,data:e},null,2)],{type:"application/json;charset=utf-8"}),i=URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download=n,s.click(),URL.revokeObjectURL(i)}catch(r){console.error(r)}}break;case"dev":ra(Or,t.player,async function(){bN()?(ug(Or,t.player,"unlocking terminal"),await Kl(100),location.href=location.href.replace("/locked/#","/#")):(ug(Or,t.player,"creating locked terminal"),await Kl(100),location.href=location.href.replace("/#","/locked/#"))});break;case"share":ra(Or,t.player,async function(){const e=await nB(),n=`#${e}`;iM=e,location.hash=n;const r=await ple(location.href);u5(Or,t.player,r,r)});break;case"nuke":ra(Or,t.player,async function(){ug(Or,t.player,"nuke in"),Ih(Or,t.player,"3","..."),await Kl(1e3),Ih(Or,t.player,"2","..."),await Kl(1e3),Ih(Or,t.player,"1","..."),await Kl(1e3),ug(Or,t.player,"BYE"),await Kl(100),location.hash="",iM=location.hash,location.reload()});break;case"savemem":ra(Or,t.player,async function(){if(Rr(t.data)){const[e,n]=t.data;Sn(e)&&Sn(n)&&await wle(n,e,n)}});break;case"forkmem":if(Rr(t.data)){const[e]=t.data;Sn(e)&&window.open(location.href.replace("/locked/#","/#").replace(/#.*/,`#${e}`),"_blank")}break;case"itchiopublishmem":ra(Or,t.player,async()=>{if(Rr(t.data)){const[e,n]=t.data;Sn(e)&&Sn(n)&&await Yxe(e,n)}});break;case"config":ra(Or,t.player,async()=>{if(Rr(t.data)){const[e,n]=t.data;await oGe(e,n)}});break;case"configshow":ra(Or,t.player,async()=>{const e=await aGe();ug(Or,t.player,"config");for(let n=0;n<e.length;++n)Ih(Or,t.player,e[n][0],e[n][1])});break;case"second":++z4,z4>=hY&&(z4-=hY,rte(Or,Do));break;case"inspector":js.setState(e=>{const n=ge(t.data)?!!t.data:!e.inspector;return Ei(Or,t.player,`gadget inspector ${n?"$greenon":"$redoff"}`),n&&Ei(Or,t.player,"mouse click or tap elements to inspect"),{inspector:n}});break;case"findany":Rr(t.data)&&rv.setState({pts:t.data});break;case"log":Uk(t);break;case"chat":Uk(t);break;case"info":Uk(t);break;case"error":Uk(t);break;case"toast":if(ge(t.data)){clearTimeout(dY),js.setState({toast:t.data});const e=Math.max(t.data.length*150,3e3),n=Math.min(e,14e3);dY=setTimeout(()=>js.setState({toast:""}),n)}break;case"terminal:full":js.setState(e=>({layout:Yp.FULL,terminal:{...e.terminal,open:!0}}));break;case"terminal:open":js.setState(e=>({terminal:{...e.terminal,open:!0}}));break;case"terminal:quickopen":if(t.data&&Sn(t.data)){const e=uo.getState().buffer;e[0]=t.data,uo.setState({buffer:e,bufferindex:0,xcursor:t.data.length,ycursor:0,xselect:void 0,yselect:void 0})}js.setState({quickterminal:!0,layout:Yp.TOP});break;case"terminal:close":js.setState(e=>({quickterminal:!1,terminal:{...e.terminal,open:!1}}));break;case"terminal:toggle":js.setState(e=>({terminal:{...e.terminal,open:!e.terminal.open}}));break;case"terminal:inclayout":aSe(t.data)&&sGe(t.data);break;case"editor:open":if(Rr(t.data)){const[e,n,r,i]=t.data;js.setState(()=>({editor:{open:!0,player:t.player,book:e,path:n,type:r,title:i}}))}break;case"editor:close":js.setState(e=>({editor:{...e.editor,open:!1}}));break}}}),Cle="15.1.22",pY=(t,e,n)=>({endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}),mY=(t,e,n)=>({endTime:e,insertTime:n,type:"linearRampToValue",value:t}),rB=(t,e)=>({startTime:e,type:"setValue",value:t}),Ale=(t,e,n)=>({duration:n,startTime:e,type:"setValueCurve",values:t}),Mle=(t,e,{startTime:n,target:r,timeConstant:i})=>r+(e-r)*Math.exp((n-t)/i),OS=t=>t.type==="exponentialRampToValue",EN=t=>t.type==="linearRampToValue",Ry=t=>OS(t)||EN(t),O7=t=>t.type==="setValue",ev=t=>t.type==="setValueCurve",SN=(t,e,n,r)=>{const i=t[e];return i===void 0?r:Ry(i)||O7(i)?i.value:ev(i)?i.values[i.values.length-1]:Mle(n,SN(t,e-1,i.startTime,r),i)},gY=(t,e,n,r,i)=>n===void 0?[r.insertTime,i]:Ry(n)?[n.endTime,n.value]:O7(n)?[n.startTime,n.value]:ev(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,SN(t,e-1,n.startTime,i)],iB=t=>t.type==="cancelAndHold",sB=t=>t.type==="cancelScheduledValues",gy=t=>iB(t)||sB(t)?t.cancelTime:OS(t)||EN(t)?t.endTime:t.startTime,_Y=(t,e,n,{endTime:r,value:i})=>n===i?i:0<n&&0<i||n<0&&i<0?n*(i/n)**((t-e)/(r-e)):0,vY=(t,e,n,{endTime:r,value:i})=>n+(t-e)/(r-e)*(i-n),hGe=(t,e)=>{const n=Math.floor(e),r=Math.ceil(e);return n===r?t[n]:(1-(e-n))*t[n]+(1-(r-e))*t[r]},dGe=(t,{duration:e,startTime:n,values:r})=>{const i=(t-n)/e*(r.length-1);return hGe(r,i)},Bk=t=>t.type==="setTarget";class pGe{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const n=gy(e);if(iB(e)||sB(e)){const r=this._automationEvents.findIndex(s=>sB(e)&&ev(s)?s.startTime+s.duration>=n:gy(s)>=n),i=this._automationEvents[r];if(r!==-1&&(this._automationEvents=this._automationEvents.slice(0,r)),iB(e)){const s=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Ry(i)){if(s!==void 0&&Bk(s))throw new Error("The internal list is malformed.");const o=s===void 0?i.insertTime:ev(s)?s.startTime+s.duration:gy(s),a=s===void 0?this._defaultValue:ev(s)?s.values[s.values.length-1]:s.value,c=OS(i)?_Y(n,o,a,i):vY(n,o,a,i),l=OS(i)?pY(c,n,this._currenTime):mY(c,n,this._currenTime);this._automationEvents.push(l)}if(s!==void 0&&Bk(s)&&this._automationEvents.push(rB(this.getValue(n),n)),s!==void 0&&ev(s)&&s.startTime+s.duration>n){const o=n-s.startTime,a=(s.values.length-1)/s.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=s.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const d=l*h%1;u[h]=s.values[h-1]*(1-d)+s.values[h]*d}this._automationEvents[this._automationEvents.length-1]=Ale(u,s.startTime,o)}}}else{const r=this._automationEvents.findIndex(o=>gy(o)>n),i=r===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(i!==void 0&&ev(i)&&gy(i)+i.duration>n)return!1;const s=OS(e)?pY(e.value,e.endTime,this._currenTime):EN(e)?mY(e.value,n,this._currenTime):e;if(r===-1)this._automationEvents.push(s);else{if(ev(e)&&n+e.duration>gy(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,s)}}return!0}flush(e){const n=this._automationEvents.findIndex(r=>gy(r)>e);if(n>1){const r=this._automationEvents.slice(n-1),i=r[0];Bk(i)&&r.unshift(rB(SN(this._automationEvents,n-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=r}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const n=this._automationEvents.findIndex(o=>gy(o)>e),r=this._automationEvents[n],i=(n===-1?this._automationEvents.length:n)-1,s=this._automationEvents[i];if(s!==void 0&&Bk(s)&&(r===void 0||!Ry(r)||r.insertTime>e))return Mle(e,SN(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(s!==void 0&&O7(s)&&(r===void 0||!Ry(r)))return s.value;if(s!==void 0&&ev(s)&&(r===void 0||!Ry(r)||s.startTime+s.duration>e))return e<s.startTime+s.duration?dGe(e,s):s.values[s.values.length-1];if(s!==void 0&&Ry(s)&&(r===void 0||!Ry(r)))return s.value;if(r!==void 0&&OS(r)){const[o,a]=gY(this._automationEvents,i,s,r,this._defaultValue);return _Y(e,o,a,r)}if(r!==void 0&&EN(r)){const[o,a]=gY(this._automationEvents,i,s,r,this._defaultValue);return vY(e,o,a,r)}return this._defaultValue}}const mGe=t=>({cancelTime:t,type:"cancelAndHold"}),gGe=t=>({cancelTime:t,type:"cancelScheduledValues"}),_Ge=(t,e)=>({endTime:e,type:"exponentialRampToValue",value:t}),vGe=(t,e)=>({endTime:e,type:"linearRampToValue",value:t}),yGe=(t,e,n)=>({startTime:e,target:t,timeConstant:n,type:"setTarget"}),bGe=()=>new DOMException("","AbortError"),EGe=t=>(e,n,[r,i,s],o)=>{t(e[i],[n,r,s],a=>a[0]===n&&a[1]===r,o)},SGe=t=>(e,n,r)=>{const i=[];for(let s=0;s<r.numberOfInputs;s+=1)i.push(new Set);t.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:n})},xGe=t=>(e,n)=>{t.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:n})},Mx=new WeakSet,kle=new WeakMap,I7=new WeakMap,Ole=new WeakMap,N7=new WeakMap,hP=new WeakMap,Ile=new WeakMap,oB=new WeakMap,aB=new WeakMap,cB=new WeakMap,Nle={construct(){return Nle}},TGe=t=>{try{const e=new Proxy(t,Nle);new e}catch{return!1}return!0},yY=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,bY=(t,e)=>{const n=[];let r=t.replace(/^[\s]+/,""),i=r.match(yY);for(;i!==null;){const s=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,e).toString());n.push(o),r=r.slice(i[0].length).replace(/^[\s]+/,""),i=r.match(yY)}return[n.join(";"),r]},EY=t=>{if(t!==void 0&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},SY=t=>{if(!TGe(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(t.prototype===null||typeof t.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},wGe=(t,e,n,r,i,s,o,a,c,l,u,h,d)=>{let m=0;return(p,g,y={credentials:"omit"})=>{const v=u.get(p);if(v!==void 0&&v.has(g))return Promise.resolve();const x=l.get(p);if(x!==void 0){const A=x.get(g);if(A!==void 0)return A}const E=s(p),C=E.audioWorklet===void 0?i(g).then(([A,k])=>{const[M,I]=bY(A,k),z=`${M};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${I}
})})(window,'_AWGS')`;return n(z)}).then(()=>{const A=d._AWGS.pop();if(A===void 0)throw new SyntaxError;r(E.currentTime,E.sampleRate,()=>A(class{},void 0,(k,M)=>{if(k.trim()==="")throw e();const I=aB.get(E);if(I!==void 0){if(I.has(k))throw e();SY(M),EY(M.parameterDescriptors),I.set(k,M)}else SY(M),EY(M.parameterDescriptors),aB.set(E,new Map([[k,M]]))},E.sampleRate,void 0,void 0))}):Promise.all([i(g),Promise.resolve(t(h,h))]).then(([[A,k],M])=>{const I=m+1;m=I;const[z,H]=bY(A,k),N=`${z};((AudioWorkletProcessor,registerProcessor)=>{${H}
})(${M?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${M?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${M?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${I}',class extends AudioWorkletProcessor{process(){return !1}})`,X=new Blob([N],{type:"application/javascript; charset=utf-8"}),G=URL.createObjectURL(X);return E.audioWorklet.addModule(G,y).then(()=>{if(a(E))return E;const j=o(E);return j.audioWorklet.addModule(G,y).then(()=>j)}).then(j=>{if(c===null)throw new SyntaxError;try{new c(j,`__sac${I}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(G))});return x===void 0?l.set(p,new Map([[g,C]])):x.set(g,C),C.then(()=>{const A=u.get(p);A===void 0?u.set(p,new Set([g])):A.add(g)}).finally(()=>{const A=l.get(p);A!==void 0&&A.delete(g)}),C}},vg=(t,e)=>{const n=t.get(e);if(n===void 0)throw new Error("A value with the given key could not be found.");return n},dP=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(n.length===0)throw Error("No element was found.");const[r]=n;return t.delete(r),r},Ple=(t,e,n,r)=>{const i=vg(t,e),s=dP(i,o=>o[0]===n&&o[1]===r);return i.size===0&&t.delete(e),s},XM=t=>vg(Ile,t),kx=t=>{if(Mx.has(t))throw new Error("The AudioNode is already stored.");Mx.add(t),XM(t).forEach(e=>e(!0))},Dle=t=>"port"in t,YM=t=>{if(!Mx.has(t))throw new Error("The AudioNode is not stored.");Mx.delete(t),XM(t).forEach(e=>e(!1))},lB=(t,e)=>{!Dle(t)&&e.every(n=>n.size===0)&&YM(t)},RGe=(t,e,n,r,i,s,o,a,c,l,u,h,d)=>{const m=new WeakMap;return(p,g,y,v,x)=>{const{activeInputs:E,passiveInputs:C}=s(g),{outputs:A}=s(p),k=a(p),M=I=>{const z=c(g),H=c(p);if(I){const K=Ple(C,p,y,v);t(E,p,K,!1),!x&&!h(p)&&n(H,z,y,v),d(g)&&kx(g)}else{const K=r(E,p,y,v);e(C,v,K,!1),!x&&!h(p)&&i(H,z,y,v);const P=o(g);if(P===0)u(g)&&lB(g,E);else{const F=m.get(g);F!==void 0&&clearTimeout(F),m.set(g,setTimeout(()=>{u(g)&&lB(g,E)},P*1e3))}}};return l(A,[g,y,v],I=>I[0]===g&&I[1]===y&&I[2]===v,!0)?(k.add(M),u(p)?t(E,p,[y,v,M],!0):e(C,v,[p,y,M],!0),!0):!1}},CGe=t=>(e,n,[r,i,s],o)=>{const a=e.get(r);a===void 0?e.set(r,new Set([[i,n,s]])):t(a,[i,n,s],c=>c[0]===i&&c[1]===n,o)},AGe=t=>(e,n)=>{const r=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(r).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(r),r.disconnect()};n.addEventListener("ended",i)},MGe=t=>(e,n)=>{t(e).add(n)},kGe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},OGe=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...kGe,...c},h=r(l,u),d=s(l)?e():null;super(a,!1,h,d),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},hf=(t,e)=>t.context===e,IGe=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!hf(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},xN=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},t_=()=>new DOMException("","IndexSizeError"),P7=t=>{t.getChannelData=(e=>n=>{try{return e.call(t,n)}catch(r){throw r.code===12?t_():r}})(t.getChannelData)},NGe={numberOfChannels:1},PGe=(t,e,n,r,i,s,o,a)=>{let c=null;return class Lle{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:m}={...NGe,...u};c===null&&(c=new i(1,1,44100));const p=r!==null&&e(s,s)?new r({length:h,numberOfChannels:d,sampleRate:m}):c.createBuffer(d,h,m);if(p.numberOfChannels===0)throw n();return typeof p.copyFromChannel!="function"?(o(p),P7(p)):e(xN,()=>xN(p))||a(p),t.add(p),p}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===Lle.prototype||t.has(u)}}},Nh=-34028234663852886e22,zf=-Nh,Ev=t=>Mx.has(t),DGe={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},LGe=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const h=s(l),d={...DGe,...u},m=i(h,d),p=o(h),g=p?e():null;super(l,!1,m,g),this._audioBufferSourceNodeRenderer=g,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=m,this._onended=null,this._playbackRate=n(this,p,m.playbackRate,zf,Nh)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){kx(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),Ev(this)&&YM(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},UGe=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=n(l);const d=hf(h,u);if(!d){const m={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,m),o!==null&&h.start(...o),a!==null&&h.stop(a)}return s.set(u,h),d?await t(u,l.playbackRate,h.playbackRate):await r(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},BGe=t=>"playbackRate"in t,FGe=t=>"frequency"in t&&"gain"in t,jGe=t=>"offset"in t,zGe=t=>!("frequency"in t)&&"gain"in t,HGe=t=>"detune"in t&&"frequency"in t&&!("gain"in t),qGe=t=>"pan"in t,Xf=t=>vg(kle,t),ZM=t=>vg(Ole,t),uB=(t,e)=>{const{activeInputs:n}=Xf(t);n.forEach(i=>i.forEach(([s])=>{e.includes(t)||uB(s,[...e,t])}));const r=BGe(t)?[t.playbackRate]:Dle(t)?Array.from(t.parameters.values()):FGe(t)?[t.Q,t.detune,t.frequency,t.gain]:jGe(t)?[t.offset]:zGe(t)?[t.gain]:HGe(t)?[t.detune,t.frequency]:qGe(t)?[t.pan]:[];for(const i of r){const s=ZM(i);s!==void 0&&s.activeInputs.forEach(([o])=>uB(o,e))}Ev(t)&&YM(t)},Ule=t=>{uB(t.destination,[])},VGe=t=>t===void 0||typeof t=="number"||typeof t=="string"&&(t==="balanced"||t==="interactive"||t==="playback"),GGe=(t,e,n,r,i,s,o,a,c)=>class extends t{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(p){throw p.code===12&&p.message==="sampleRate is not in range"?n():p}if(h===null)throw r();if(!VGe(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw n();super(h,2);const{latencyHint:d}=u,{sampleRate:m}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:d==="balanced"?512/m:d==="interactive"||d===void 0?256/m:d==="playback"?1024/m:Math.max(2,Math.min(128,Math.round(d*m/128)))*128/m,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const p=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",p)};h.addEventListener("statechange",p)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Ule(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},$Ge=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const h=s(l),d=o(h),m=i(h,u,d),p=d?e(a):null;super(l,!1,m,p),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=m}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},WGe=t=>{const e=new WeakMap,n=async(r,i)=>{const s=i.destination;return e.set(i,s),await t(r,i,s),s};return{render(r,i){const s=e.get(i);return s!==void 0?Promise.resolve(s):n(r,i)}}},KGe=(t,e,n,r,i,s,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const A=new Float32Array(1),k=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),M=o(l);let I=!1,z=[0,0,-1,0,1,0],H=[0,0,0];const K=()=>{if(I)return;I=!0;const X=r(l,256,9,0);X.onaudioprocess=({inputBuffer:G})=>{const j=[s(G,A,0),s(G,A,1),s(G,A,2),s(G,A,3),s(G,A,4),s(G,A,5)];j.some((te,W)=>te!==z[W])&&(u.setOrientation(...j),z=j);const q=[s(G,A,6),s(G,A,7),s(G,A,8)];q.some((te,W)=>te!==H[W])&&(u.setPosition(...q),H=q)},k.connect(X)},P=X=>G=>{G!==z[X]&&(z[X]=G,u.setOrientation(...z))},F=X=>G=>{G!==H[X]&&(H[X]=G,u.setPosition(...H))},N=(X,G,j)=>{const q=n(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:G});q.connect(k,0,X),q.start(),Object.defineProperty(q.offset,"defaultValue",{get(){return G}});const te=t({context:c},M,q.offset,zf,Nh);return a(te,"value",W=>()=>W.call(te),W=>$=>{try{W.call(te,$)}catch(J){if(J.code!==9)throw J}K(),M&&j($)}),te.cancelAndHoldAtTime=(W=>M?()=>{throw i()}:(...$)=>{const J=W.apply(te,$);return K(),J})(te.cancelAndHoldAtTime),te.cancelScheduledValues=(W=>M?()=>{throw i()}:(...$)=>{const J=W.apply(te,$);return K(),J})(te.cancelScheduledValues),te.exponentialRampToValueAtTime=(W=>M?()=>{throw i()}:(...$)=>{const J=W.apply(te,$);return K(),J})(te.exponentialRampToValueAtTime),te.linearRampToValueAtTime=(W=>M?()=>{throw i()}:(...$)=>{const J=W.apply(te,$);return K(),J})(te.linearRampToValueAtTime),te.setTargetAtTime=(W=>M?()=>{throw i()}:(...$)=>{const J=W.apply(te,$);return K(),J})(te.setTargetAtTime),te.setValueAtTime=(W=>M?()=>{throw i()}:(...$)=>{const J=W.apply(te,$);return K(),J})(te.setValueAtTime),te.setValueCurveAtTime=(W=>M?()=>{throw i()}:(...$)=>{const J=W.apply(te,$);return K(),J})(te.setValueCurveAtTime),te};return{forwardX:N(0,0,P(0)),forwardY:N(1,0,P(1)),forwardZ:N(2,-1,P(2)),positionX:N(6,0,F(0)),positionY:N(7,0,F(1)),positionZ:N(8,0,F(2)),upX:N(3,0,P(3)),upY:N(4,1,P(4)),upZ:N(5,0,P(5))}},{forwardX:d,forwardY:m,forwardZ:p,positionX:g,positionY:y,positionZ:v,upX:x,upY:E,upZ:C}=u.forwardX===void 0?h():u;return{get forwardX(){return d},get forwardY(){return m},get forwardZ(){return p},get positionX(){return g},get positionY(){return y},get positionZ(){return v},get upX(){return x},get upY(){return E},get upZ(){return C}}},TN=t=>"context"in t,JM=t=>TN(t[0]),yE=(t,e,n,r)=>{for(const i of t)if(n(i)){if(r)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},xY=(t,e,[n,r],i)=>{yE(t,[e,n,r],s=>s[0]===e&&s[1]===n,i)},TY=(t,[e,n,r],i)=>{const s=t.get(e);s===void 0?t.set(e,new Set([[n,r]])):yE(s,[n,r],o=>o[0]===n,i)},iT=t=>"inputs"in t,wN=(t,e,n,r)=>{if(iT(e)){const i=e.inputs[r];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,r),[e,n,r]},Ble=(t,e,n)=>{for(const r of t)if(r[0]===e&&r[1]===n)return t.delete(r),r;return null},XGe=(t,e,n)=>dP(t,r=>r[0]===e&&r[1]===n),Fle=(t,e)=>{if(!XM(t).delete(e))throw new Error("Missing the expected event listener.")},jle=(t,e,n)=>{const r=vg(t,e),i=dP(r,s=>s[0]===n);return r.size===0&&t.delete(e),i},RN=(t,e,n,r)=>{iT(e)?t.disconnect(e.inputs[r],n,0):t.disconnect(e,n,r)},oa=t=>vg(I7,t),sM=t=>vg(N7,t),Y1=t=>oB.has(t),$O=t=>!Mx.has(t),wY=(t,e)=>new Promise(n=>{if(e!==null)n(!0);else{const r=t.createScriptProcessor(256,1,1),i=t.createGain(),s=t.createBuffer(1,2,44100),o=s.getChannelData(0);o[0]=1,o[1]=1;const a=t.createBufferSource();a.buffer=s,a.loop=!0,a.connect(r).connect(t.destination),a.connect(i),a.disconnect(i),r.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?n(!0):n(!1),a.stop(),r.onaudioprocess=null,a.disconnect(r),r.disconnect(t.destination)},a.start()}}),H4=(t,e)=>{const n=new Map;for(const r of t)for(const i of r){const s=n.get(i);n.set(i,s===void 0?1:s+1)}n.forEach((r,i)=>e(i,r))},CN=t=>"context"in t,YGe=t=>{const e=new Map;t.connect=(n=>(r,i=0,s=0)=>{const o=CN(r)?n(r,i,s):n(r,i),a=e.get(r);return a===void 0?e.set(r,[{input:s,output:i}]):a.every(c=>c.input!==s||c.output!==i)&&a.push({input:s,output:i}),o})(t.connect.bind(t)),t.disconnect=(n=>(r,i,s)=>{if(n.apply(t),r===void 0)e.clear();else if(typeof r=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==r);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(r))if(i===void 0)e.delete(r);else{const o=e.get(r);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==s||s===void 0));a.length===0?e.delete(r):e.set(r,a)}}for(const[o,a]of e)a.forEach(c=>{CN(o)?t.connect(o,c.output,c.input):t.connect(o,c.output)})})(t.disconnect)},ZGe=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=ZM(e),{outputs:o}=Xf(t),a=XM(t),c=l=>{const u=oa(t),h=sM(e);if(l){const d=jle(s,t,n);xY(i,t,d,!1),!r&&!Y1(t)&&u.connect(h,n)}else{const d=XGe(i,t,n);TY(s,d,!1),!r&&!Y1(t)&&u.disconnect(h,n)}};return yE(o,[e,n],l=>l[0]===e&&l[1]===n,!0)?(a.add(c),Ev(t)?xY(i,t,[n,c],!0):TY(s,[t,n,c],!0),!0):!1},JGe=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=Xf(e),o=Ble(i[r],t,n);return o===null?[Ple(s,t,n,r)[2],!1]:[o[2],!0]},QGe=(t,e,n)=>{const{activeInputs:r,passiveInputs:i}=ZM(e),s=Ble(r,t,n);return s===null?[jle(i,t,n)[1],!1]:[s[2],!0]},D7=(t,e,n,r,i)=>{const[s,o]=JGe(t,n,r,i);if(s!==null&&(Fle(t,s),o&&!e&&!Y1(t)&&RN(oa(t),oa(n),r,i)),Ev(n)){const{activeInputs:a}=Xf(n);lB(n,a)}},L7=(t,e,n,r)=>{const[i,s]=QGe(t,n,r);i!==null&&(Fle(t,i),s&&!e&&!Y1(t)&&oa(t).disconnect(sM(n),r))},e$e=(t,e)=>{const n=Xf(t),r=[];for(const i of n.outputs)JM(i)?D7(t,e,...i):L7(t,e,...i),r.push(i[0]);return n.outputs.clear(),r},t$e=(t,e,n)=>{const r=Xf(t),i=[];for(const s of r.outputs)s[1]===n&&(JM(s)?D7(t,e,...s):L7(t,e,...s),i.push(s[0]),r.outputs.delete(s));return i},n$e=(t,e,n,r,i)=>{const s=Xf(t);return Array.from(s.outputs).filter(o=>o[0]===n&&(r===void 0||o[1]===r)&&(i===void 0||o[2]===i)).map(o=>(JM(o)?D7(t,e,...o):L7(t,e,...o),s.outputs.delete(o),o[0]))},r$e=(t,e,n,r,i,s,o,a,c,l,u,h,d,m,p,g)=>class extends l{constructor(v,x,E,C){super(E),this._context=v,this._nativeAudioNode=E;const A=u(v);h(A)&&n(wY,()=>wY(A,g))!==!0&&YGe(E),I7.set(this,E),Ile.set(this,new Set),v.state!=="closed"&&x&&kx(this),t(this,C,E)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(v){this._nativeAudioNode.channelCount=v}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(v){this._nativeAudioNode.channelCountMode=v}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(v){this._nativeAudioNode.channelInterpretation=v}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(v,x=0,E=0){if(x<0||x>=this._nativeAudioNode.numberOfOutputs)throw i();const C=u(this._context),A=p(C);if(d(v)||m(v))throw s();if(TN(v)){const I=oa(v);try{const H=wN(this._nativeAudioNode,I,x,E),K=$O(this);(A||K)&&this._nativeAudioNode.disconnect(...H),this.context.state!=="closed"&&!K&&$O(v)&&kx(v)}catch(H){throw H.code===12?s():H}if(e(this,v,x,E,A)){const H=c([this],v);H4(H,r(A))}return v}const k=sM(v);if(k.name==="playbackRate"&&k.maxValue===1024)throw o();try{this._nativeAudioNode.connect(k,x),(A||$O(this))&&this._nativeAudioNode.disconnect(k,x)}catch(I){throw I.code===12?s():I}if(ZGe(this,v,x,A)){const I=c([this],v);H4(I,r(A))}}disconnect(v,x,E){let C;const A=u(this._context),k=p(A);if(v===void 0)C=e$e(this,k);else if(typeof v=="number"){if(v<0||v>=this.numberOfOutputs)throw i();C=t$e(this,k,v)}else{if(x!==void 0&&(x<0||x>=this.numberOfOutputs)||TN(v)&&E!==void 0&&(E<0||E>=v.numberOfInputs))throw i();if(C=n$e(this,k,v,x,E),C.length===0)throw s()}for(const M of C){const I=c([this],M);H4(I,a)}}},i$e=(t,e,n,r,i,s,o,a,c,l,u,h,d)=>(m,p,g,y=null,v=null)=>{const x=g.value,E=new pGe(x),C=p?r(E):null,A={get defaultValue(){return x},get maxValue(){return y===null?g.maxValue:y},get minValue(){return v===null?g.minValue:v},get value(){return g.value},set value(k){g.value=k,A.setValueAtTime(k,m.context.currentTime)},cancelAndHoldAtTime(k){if(typeof g.cancelAndHoldAtTime=="function")C===null&&E.flush(m.context.currentTime),E.add(i(k)),g.cancelAndHoldAtTime(k);else{const M=Array.from(E).pop();C===null&&E.flush(m.context.currentTime),E.add(i(k));const I=Array.from(E).pop();g.cancelScheduledValues(k),M!==I&&I!==void 0&&(I.type==="exponentialRampToValue"?g.exponentialRampToValueAtTime(I.value,I.endTime):I.type==="linearRampToValue"?g.linearRampToValueAtTime(I.value,I.endTime):I.type==="setValue"?g.setValueAtTime(I.value,I.startTime):I.type==="setValueCurve"&&g.setValueCurveAtTime(I.values,I.startTime,I.duration))}return A},cancelScheduledValues(k){return C===null&&E.flush(m.context.currentTime),E.add(s(k)),g.cancelScheduledValues(k),A},exponentialRampToValueAtTime(k,M){if(k===0)throw new RangeError;if(!Number.isFinite(M)||M<0)throw new RangeError;const I=m.context.currentTime;return C===null&&E.flush(I),Array.from(E).length===0&&(E.add(l(x,I)),g.setValueAtTime(x,I)),E.add(o(k,M)),g.exponentialRampToValueAtTime(k,M),A},linearRampToValueAtTime(k,M){const I=m.context.currentTime;return C===null&&E.flush(I),Array.from(E).length===0&&(E.add(l(x,I)),g.setValueAtTime(x,I)),E.add(a(k,M)),g.linearRampToValueAtTime(k,M),A},setTargetAtTime(k,M,I){return C===null&&E.flush(m.context.currentTime),E.add(c(k,M,I)),g.setTargetAtTime(k,M,I),A},setValueAtTime(k,M){return C===null&&E.flush(m.context.currentTime),E.add(l(k,M)),g.setValueAtTime(k,M),A},setValueCurveAtTime(k,M,I){const z=k instanceof Float32Array?k:new Float32Array(k);if(h!==null&&h.name==="webkitAudioContext"){const H=M+I,K=m.context.sampleRate,P=Math.ceil(M*K),F=Math.floor(H*K),N=F-P,X=new Float32Array(N);for(let j=0;j<N;j+=1){const q=(z.length-1)/I*((P+j)/K-M),te=Math.floor(q),W=Math.ceil(q);X[j]=te===W?z[te]:(1-(q-te))*z[te]+(1-(W-q))*z[W]}C===null&&E.flush(m.context.currentTime),E.add(u(X,M,I)),g.setValueCurveAtTime(X,M,I);const G=F/K;G<H&&d(A,X[X.length-1],G),d(A,z[z.length-1],H)}else C===null&&E.flush(m.context.currentTime),E.add(u(z,M,I)),g.setValueCurveAtTime(z,M,I);return A}};return n.set(A,g),e.set(A,m),t(A,C),A},s$e=t=>({replay(e){for(const n of t)if(n.type==="exponentialRampToValue"){const{endTime:r,value:i}=n;e.exponentialRampToValueAtTime(i,r)}else if(n.type==="linearRampToValue"){const{endTime:r,value:i}=n;e.linearRampToValueAtTime(i,r)}else if(n.type==="setTarget"){const{startTime:r,target:i,timeConstant:s}=n;e.setTargetAtTime(i,r,s)}else if(n.type==="setValue"){const{startTime:r,value:i}=n;e.setValueAtTime(i,r)}else if(n.type==="setValueCurve"){const{duration:r,startTime:i,values:s}=n;e.setValueCurveAtTime(s,i,r)}else throw new Error("Can't apply an unknown automation.")}});class zle{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,n=null){return this._map.forEach((r,i)=>e.call(n,r,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const o$e={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},a$e=(t,e,n,r,i,s,o,a,c,l,u,h,d,m)=>class extends e{constructor(g,y,v){var x;const E=a(g),C=c(E),A=u({...o$e,...v});d(A);const k=aB.get(E),M=k?.get(y),I=C||E.state!=="closed"?E:(x=o(E))!==null&&x!==void 0?x:E,z=i(I,C?null:g.baseLatency,l,y,M,A),H=C?r(y,A,M):null;super(g,!0,z,H);const K=[];z.parameters.forEach((F,N)=>{const X=n(this,C,F);K.push([N,X])}),this._nativeAudioWorkletNode=z,this._onprocessorerror=null,this._parameters=new zle(K),C&&t(E,this);const{activeInputs:P}=s(this);h(z,P)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(g){const y=typeof g=="function"?m(this,g):null;this._nativeAudioWorkletNode.onprocessorerror=y;const v=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=v!==null&&v===y?g:v}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function AN(t,e,n,r,i){if(typeof t.copyFromChannel=="function")e[n].byteLength===0&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],r,i);else{const s=t.getChannelData(r);if(e[n].byteLength===0)e[n]=s.slice(i,i+128);else{const o=new Float32Array(s.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(o)}}}const Hle=(t,e,n,r,i)=>{typeof t.copyToChannel=="function"?e[n].byteLength!==0&&t.copyToChannel(e[n],r,i):e[n].byteLength!==0&&t.getChannelData(r).set(e[n],i)},MN=(t,e)=>{const n=[];for(let r=0;r<t;r+=1){const i=[],s=typeof e=="number"?e:e[r];for(let o=0;o<s;o+=1)i.push(new Float32Array(128));n.push(i)}return n},c$e=(t,e)=>{const n=vg(cB,t),r=oa(e);return vg(n,r)},l$e=async(t,e,n,r,i,s,o)=>{const a=e===null?Math.ceil(t.context.length/128)*128:e.length,c=r.channelCount*r.numberOfInputs,l=i.reduce((y,v)=>y+v,0),u=l===0?null:n.createBuffer(l,a,n.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");const h=Xf(t),d=await c$e(n,t),m=MN(r.numberOfInputs,r.channelCount),p=MN(r.numberOfOutputs,i),g=Array.from(t.parameters.keys()).reduce((y,v)=>({...y,[v]:new Float32Array(128)}),{});for(let y=0;y<a;y+=128){if(r.numberOfInputs>0&&e!==null)for(let v=0;v<r.numberOfInputs;v+=1)for(let x=0;x<r.channelCount;x+=1)AN(e,m[v],x,x,y);s.parameterDescriptors!==void 0&&e!==null&&s.parameterDescriptors.forEach(({name:v},x)=>{AN(e,g,v,c+x,y)});for(let v=0;v<r.numberOfInputs;v+=1)for(let x=0;x<i[v];x+=1)p[v][x].byteLength===0&&(p[v][x]=new Float32Array(128));try{const v=m.map((E,C)=>h.activeInputs[C].size===0?[]:E),x=o(y/n.sampleRate,n.sampleRate,()=>d.process(v,p,g));if(u!==null)for(let E=0,C=0;E<r.numberOfOutputs;E+=1){for(let A=0;A<i[E];A+=1)Hle(u,p[E],A,C+A,y);C+=i[E]}if(!x)break}catch(v){t.dispatchEvent(new ErrorEvent("processorerror",{colno:v.colno,filename:v.filename,lineno:v.lineno,message:v.message}));break}}return u},u$e=(t,e,n,r,i,s,o,a,c,l,u,h,d,m,p,g)=>(y,v,x)=>{const E=new WeakMap;let C=null;const A=async(k,M)=>{let I=u(k),z=null;const H=hf(I,M),K=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(h===null){const P=K.reduce((G,j)=>G+j,0),F=i(M,{channelCount:Math.max(1,P),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,P)}),N=[];for(let G=0;G<k.numberOfOutputs;G+=1)N.push(r(M,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:K[G]}));const X=o(M,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1});X.connect=e.bind(null,N),X.disconnect=c.bind(null,N),z=[F,N,X]}else H||(I=new h(M,y));if(E.set(M,z===null?I:z[2]),z!==null){if(C===null){if(x===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const j=k.channelCount*k.numberOfInputs,q=x.parameterDescriptors===void 0?0:x.parameterDescriptors.length,te=j+q;C=l$e(k,te===0?null:await(async()=>{const $=new d(te,Math.ceil(k.context.length/128)*128,M.sampleRate),J=[],ne=[];for(let xe=0;xe<v.numberOfInputs;xe+=1)J.push(o($,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),ne.push(i($,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const ie=await Promise.all(Array.from(k.parameters.values()).map(async xe=>{const Ne=s($,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:xe.value});return await m($,xe,Ne.offset),Ne})),ae=r($,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,j+q)});for(let xe=0;xe<v.numberOfInputs;xe+=1){J[xe].connect(ne[xe]);for(let Ne=0;Ne<v.channelCount;Ne+=1)ne[xe].connect(ae,Ne,xe*v.channelCount+Ne)}for(const[xe,Ne]of ie.entries())Ne.connect(ae,0,j+xe),Ne.start(0);return ae.connect($.destination),await Promise.all(J.map(xe=>p(k,$,xe))),g($)})(),M,v,K,x,l)}const P=await C,F=n(M,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[N,X,G]=z;P!==null&&(F.buffer=P,F.start(0)),F.connect(N);for(let j=0,q=0;j<k.numberOfOutputs;j+=1){const te=X[j];for(let W=0;W<K[j];W+=1)N.connect(te,q+W,W);q+=K[j]}return G}if(H)for(const[P,F]of k.parameters.entries())await t(M,F,I.parameters.get(P));else for(const[P,F]of k.parameters.entries())await m(M,F,I.parameters.get(P));return await p(k,M,I),I};return{render(k,M){a(M,k);const I=E.get(M);return I!==void 0?Promise.resolve(I):A(k,M)}}},f$e=(t,e,n,r,i,s,o,a,c,l,u,h,d,m,p,g,y,v,x,E)=>class extends p{constructor(A,k){super(A,k),this._nativeContext=A,this._audioWorklet=t===void 0?void 0:{addModule:(M,I)=>t(this,M,I)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(A,k,M){return new n({length:k,numberOfChannels:A,sampleRate:M})}createBufferSource(){return new r(this)}createChannelMerger(A=6){return new s(this,{numberOfInputs:A})}createChannelSplitter(A=6){return new o(this,{numberOfOutputs:A})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(A=1){return new u(this,{maxDelayTime:A})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(A,k){return new m(this,{feedback:k,feedforward:A})}createOscillator(){return new g(this)}createPanner(){return new y(this)}createPeriodicWave(A,k,M={disableNormalization:!1}){return new v(this,{...M,imag:k,real:A})}createStereoPanner(){return new x(this)}createWaveShaper(){return new E(this)}decodeAudioData(A,k,M){return l(this._nativeContext,A).then(I=>(typeof k=="function"&&k(I),I),I=>{throw typeof M=="function"&&M(I),I})}},h$e={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},d$e=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const h=s(l),d={...h$e,...u},m=i(h,d),p=o(h),g=p?n():null;super(l,!1,m,g),this._Q=e(this,p,m.Q,zf,Nh),this._detune=e(this,p,m.detune,1200*Math.log2(zf),-1200*Math.log2(zf)),this._frequency=e(this,p,m.frequency,l.sampleRate/2,0),this._gain=e(this,p,m.gain,40*Math.log10(zf),Nh),this._nativeBiquadFilterNode=m,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(d){throw d.code===11?r():d}if(l.length!==u.length||u.length!==h.length)throw r()}},p$e=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=hf(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return s.set(c,l),u?(await t(c,a.Q,l.Q),await t(c,a.detune,l.detune),await t(c,a.frequency,l.frequency),await t(c,a.gain,l.gain)):(await r(c,a.Q,l.Q),await r(c,a.detune,l.detune),await r(c,a.frequency,l.frequency),await r(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},m$e=(t,e)=>(n,r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t.get(n);if(s!==void 0)return s;try{const o=r();return o instanceof Promise?(t.set(n,o),o.catch(()=>!1).then(a=>(t.delete(n),e.set(n,a),a))):(e.set(n,o),o)}catch{return e.set(n,!1),!1}},g$e={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},_$e=(t,e,n,r,i)=>class extends t{constructor(o,a){const c=r(o),l={...g$e,...a},u=n(c,l),h=i(c)?e():null;super(o,!1,u,h)}},v$e=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!hf(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},y$e={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},b$e=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u=s({...y$e,...c}),h=n(l,u),d=i(l)?e():null;super(a,!1,h,d)}},E$e=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!hf(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},S$e=t=>(e,n,r)=>t(n,e,r),x$e=t=>(e,n,r=0,i=0)=>{const s=e[r];if(s===void 0)throw t();return CN(n)?s.connect(n,0,i):s.connect(n,0)},T$e=t=>(e,n)=>{const r=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return r.buffer=i,r.loop=!0,r.connect(n),r.start(),()=>{r.stop(),r.disconnect(n)}},w$e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},R$e=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),h={...w$e,...l},d=r(u,h),m=s(u),p=m?n():null;super(c,!1,d,p),this._constantSourceNodeRenderer=p,this._nativeConstantSourceNode=d,this._offset=e(this,m,d.offset,zf,Nh),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){kx(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),Ev(this)&&YM(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},C$e=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=n(l);const d=hf(h,u);if(!d){const m={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,m),o!==null&&h.start(o),a!==null&&h.stop(a)}return s.set(u,h),d?await t(u,l.offset,h.offset):await r(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},A$e=t=>e=>(t[0]=e,t[0]),M$e={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},k$e=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u={...M$e,...c},h=n(l,u),m=i(l)?e():null;super(a,!1,h,m),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&s(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,s(this,0)}else this._isBufferNullified=!1,s(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},O$e=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!hf(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=t(o,l)}return r.set(o,a),iT(a)?await n(s,o,a.inputs[0]):await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},I$e=(t,e)=>(n,r,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,r,i)}catch(s){throw s.name==="SyntaxError"?t():s}},N$e=()=>new DOMException("","DataCloneError"),RY=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise(r=>{const i=()=>{n.onmessage=null,e.close(),n.close(),r()};n.onmessage=()=>i();try{e.postMessage(t,[t])}catch{}finally{i()}})},P$e=(t,e,n,r,i,s,o,a,c,l,u)=>(h,d)=>{const m=o(h)?h:s(h);if(i.has(d)){const p=n();return Promise.reject(p)}try{i.add(d)}catch{}return e(c,()=>c(m))?m.decodeAudioData(d).then(p=>(RY(d).catch(()=>{}),e(a,()=>a(p))||u(p),t.add(p),p)):new Promise((p,g)=>{const y=async()=>{try{await RY(d)}catch{}},v=x=>{g(x),y()};try{m.decodeAudioData(d,x=>{typeof x.copyFromChannel!="function"&&(l(x),P7(x)),t.add(x),y().then(()=>p(x))},x=>{v(x===null?r():x)})}catch(x){v(x)}})},D$e=(t,e,n,r,i,s,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=s(c.context),d=a(h);if(u===l){if(e.delete(c),!d&&o(c)){const m=r(c),{outputs:p}=n(c);for(const g of p)if(JM(g)){const y=r(g[0]);t(m,y,g[1],g[2])}else{const y=i(g[0]);m.connect(y,g[1])}}}else e.set(c,u-l)},L$e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},U$e=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),h={...L$e,...l},d=r(u,h),m=s(u),p=m?n(h.maxDelayTime):null;super(c,!1,d,p),this._delayTime=e(this,m,d.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},B$e=(t,e,n,r,i)=>s=>{const o=new WeakMap,a=async(c,l)=>{let u=n(c);const h=hf(u,l);if(!h){const d={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:s};u=e(l,d)}return o.set(l,u),h?await t(l,c.delayTime,u.delayTime):await r(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},F$e=t=>(e,n,r,i)=>t(e[i],s=>s[0]===n&&s[1]===r),j$e=t=>(e,n)=>{t(e).delete(n)},z$e=t=>"delayTime"in t,H$e=(t,e,n)=>function r(i,s){const o=TN(s)?s:n(t,s);if(z$e(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>r([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},Fk=(t,e,n)=>{const r=e[n];if(r===void 0)throw t();return r},q$e=t=>(e,n=void 0,r=void 0,i=0)=>n===void 0?e.forEach(s=>s.disconnect()):typeof n=="number"?Fk(t,e,n).disconnect():CN(n)?r===void 0?e.forEach(s=>s.disconnect(n)):i===void 0?Fk(t,e,r).disconnect(n,0):Fk(t,e,r).disconnect(n,0,i):r===void 0?e.forEach(s=>s.disconnect(n)):Fk(t,e,r).disconnect(n,0),V$e={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},G$e=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const h=s(l),d={...V$e,...u},m=r(h,d),p=o(h),g=p?n():null;super(l,!1,m,g),this._attack=e(this,p,m.attack),this._knee=e(this,p,m.knee),this._nativeDynamicsCompressorNode=m,this._ratio=e(this,p,m.ratio),this._release=e(this,p,m.release),this._threshold=e(this,p,m.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},$$e=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=hf(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return s.set(c,l),u?(await t(c,a.attack,l.attack),await t(c,a.knee,l.knee),await t(c,a.ratio,l.ratio),await t(c,a.release,l.release),await t(c,a.threshold,l.threshold)):(await r(c,a.attack,l.attack),await r(c,a.knee,l.knee),await r(c,a.ratio,l.ratio),await r(c,a.release,l.release),await r(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},W$e=()=>new DOMException("","EncodingError"),K$e=t=>e=>new Promise((n,r)=>{if(t===null){r(new SyntaxError);return}const i=t.document.head;if(i===null)r(new SyntaxError);else{const s=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=t.onerror,l=()=>{t.onerror=c,URL.revokeObjectURL(a)};t.onerror=(u,h,d,m,p)=>{if(h===a||h===t.location.href&&d===1&&m===1)return l(),r(p),!1;if(c!==null)return c(u,h,d,m,p)},s.onerror=()=>{l(),r(new SyntaxError)},s.onload=()=>{l(),n()},s.src=a,s.type="module",i.appendChild(s)}}),X$e=t=>class{constructor(n){this._nativeEventTarget=n,this._listeners=new WeakMap}addEventListener(n,r,i){if(r!==null){let s=this._listeners.get(r);s===void 0&&(s=t(this,r),typeof r=="function"&&this._listeners.set(r,s)),this._nativeEventTarget.addEventListener(n,s,i)}}dispatchEvent(n){return this._nativeEventTarget.dispatchEvent(n)}removeEventListener(n,r,i){const s=r===null?void 0:this._listeners.get(r);this._nativeEventTarget.removeEventListener(n,s===void 0?null:s,i)}},Y$e=t=>(e,n,r)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get(){return Math.round(e*n)}},currentTime:{configurable:!0,get(){return e}}});try{return r()}finally{t!==null&&(delete t.currentFrame,delete t.currentTime)}},Z$e=t=>async e=>{try{const n=await fetch(e);if(n.ok)return[await n.text(),n.url]}catch{}throw t()},J$e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Q$e=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...J$e,...c},h=r(l,u),d=s(l),m=d?n():null;super(a,!1,h,m),this._gain=e(this,d,h.gain,zf,Nh)}get gain(){return this._gain}},eWe=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=hf(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return s.set(c,l),u?await t(c,a.gain,l.gain):await r(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},tWe=(t,e)=>n=>e(t,n),nWe=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer},rWe=t=>e=>{var n;return(n=t.get(e))!==null&&n!==void 0?n:0},iWe=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer},sWe=t=>e=>t.get(e),nu=()=>new DOMException("","InvalidStateError"),oWe=t=>e=>{const n=t.get(e);if(n===void 0)throw nu();return n},aWe=(t,e)=>n=>{let r=t.get(n);if(r!==void 0)return r;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new e(1,1,44100),t.set(n,r),r},cWe=t=>e=>{const n=t.get(e);if(n===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return n},pP=()=>new DOMException("","InvalidAccessError"),lWe=t=>{t.getFrequencyResponse=(e=>(n,r,i)=>{if(n.length!==r.length||r.length!==i.length)throw pP();return e.call(t,n,r,i)})(t.getFrequencyResponse)},uWe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},fWe=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u=i(l),h={...uWe,...c},d=e(l,u?null:a.baseLatency,h),m=u?n(h.feedback,h.feedforward):null;super(a,!1,d,m),lWe(d),this._nativeIIRFilterNode=d,s(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},qle=(t,e,n,r,i,s,o,a,c,l,u)=>{const h=l.length;let d=a;for(let m=0;m<h;m+=1){let p=n[0]*l[m];for(let g=1;g<i;g+=1){const y=d-g&c-1;p+=n[g]*s[y],p-=t[g]*o[y]}for(let g=i;g<r;g+=1)p+=n[g]*s[d-g&c-1];for(let g=i;g<e;g+=1)p-=t[g]*o[d-g&c-1];s[d]=l[m],o[d]=p,d=d+1&c-1,u[m]=p}return d},hWe=(t,e,n,r)=>{const i=n instanceof Float64Array?n:new Float64Array(n),s=r instanceof Float64Array?r:new Float64Array(r),o=i.length,a=s.length,c=Math.min(o,a);if(i[0]!==1){for(let p=0;p<o;p+=1)s[p]/=i[0];for(let p=1;p<a;p+=1)i[p]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),d=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),m=t.numberOfChannels;for(let p=0;p<m;p+=1){const g=t.getChannelData(p),y=d.getChannelData(p);u.fill(0),h.fill(0),qle(i,o,s,a,c,u,h,0,l,g,y)}return d},dWe=(t,e,n,r,i)=>(s,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let d=null,m=e(u);const p=hf(m,h);if(h.createIIRFilter===void 0?d=t(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(m=h.createIIRFilter(o,s)),a.set(h,d===null?m:d),d!==null){if(c===null){if(n===null)throw new Error("Missing the native OfflineAudioContext constructor.");const y=new n(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await r(u,y,y.destination);const v=await i(y);return hWe(v,h,s,o)})()}const g=await c;return d.buffer=g,d.start(0),d}return await r(u,h,m),m};return{render(u,h){const d=a.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},pWe=(t,e,n,r,i,s)=>o=>(a,c)=>{const l=t.get(a);if(l===void 0){if(!o&&s(a)){const u=r(a),{outputs:h}=n(a);for(const d of h)if(JM(d)){const m=r(d[0]);e(u,m,d[1],d[2])}else{const m=i(d[0]);u.disconnect(m,d[1])}}t.set(a,c)}else t.set(a,l+c)},mWe=(t,e)=>n=>{const r=t.get(n);return e(r)||e(n)},gWe=(t,e)=>n=>t.has(n)||e(n),_We=(t,e)=>n=>t.has(n)||e(n),vWe=(t,e)=>n=>{const r=t.get(n);return e(r)||e(n)},yWe=t=>e=>t!==null&&e instanceof t,bWe=t=>e=>t!==null&&typeof t.AudioNode=="function"&&e instanceof t.AudioNode,EWe=t=>e=>t!==null&&typeof t.AudioParam=="function"&&e instanceof t.AudioParam,SWe=(t,e)=>n=>t(n)||e(n),xWe=t=>e=>t!==null&&e instanceof t,TWe=t=>t!==null&&t.isSecureContext,wWe=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s),c=e(a,o);if(r(a))throw TypeError();super(s,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},RWe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},CWe=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s);if(r(a))throw new TypeError;const c={...RWe,...o},l=e(a,c);super(s,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},AWe=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s),c=e(a,o);if(r(a))throw new TypeError;super(s,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},MWe=(t,e,n)=>class extends t{constructor(i,s){const o=n(i),a=e(o,s);super(i,!0,a,null)}},kWe=(t,e,n,r,i,s)=>class extends n{constructor(a,c){super(a),this._nativeContext=a,hP.set(this,a),r(a)&&i.set(a,new Set),this._destination=new t(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?s(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},oM=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,()=>{});return n===void 0?!1:(n.catch(()=>{}),!0)}catch{}return!1},OWe=(t,e)=>(n,r,i)=>{const s=new Set;return n.connect=(o=>(a,c=0,l=0)=>{const u=s.size===0;if(e(a))return o.call(n,a,c,l),t(s,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&r(),a;o.call(n,a,c),t(s,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&r()})(n.connect),n.disconnect=(o=>(a,c,l)=>{const u=s.size>0;if(a===void 0)o.apply(n),s.clear();else if(typeof a=="number"){o.call(n,a);for(const d of s)d[1]===a&&s.delete(d)}else{e(a)?o.call(n,a,c,l):o.call(n,a,c);for(const d of s)d[0]===a&&(c===void 0||d[1]===c)&&(l===void 0||d[2]===l)&&s.delete(d)}const h=s.size===0;u&&h&&i()})(n.disconnect),n},Ea=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n]&&(t[n]=r)},Rl=(t,e)=>{Ea(t,e,"channelCount"),Ea(t,e,"channelCountMode"),Ea(t,e,"channelInterpretation")},CY=t=>typeof t.getFloatTimeDomainData=="function",IWe=t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const r=Math.max(n.length,t.fftSize);for(let i=0;i<r;i+=1)e[i]=(n[i]-128)*.0078125;return e}},NWe=(t,e)=>(n,r)=>{const i=n.createAnalyser();if(Rl(i,r),!(r.maxDecibels>r.minDecibels))throw e();return Ea(i,r,"fftSize"),Ea(i,r,"maxDecibels"),Ea(i,r,"minDecibels"),Ea(i,r,"smoothingTimeConstant"),t(CY,()=>CY(i))||IWe(i),i},PWe=t=>t===null?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null,sc=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n].value&&(t[n].value=r)},DWe=t=>{t.start=(e=>{let n=!1;return(r=0,i=0,s)=>{if(n)throw nu();e.call(t,r,i,s),n=!0}})(t.start)},U7=t=>{t.start=(e=>(n=0,r=0,i)=>{if(typeof i=="number"&&i<0||r<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,r,i)})(t.start)},B7=t=>{t.stop=(e=>(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})(t.stop)},LWe=(t,e,n,r,i,s,o,a,c,l,u)=>(h,d)=>{const m=h.createBufferSource();return Rl(m,d),sc(m,d,"playbackRate"),Ea(m,d,"buffer"),Ea(m,d,"loop"),Ea(m,d,"loopEnd"),Ea(m,d,"loopStart"),e(n,()=>n(h))||DWe(m),e(r,()=>r(h))||c(m),e(i,()=>i(h))||l(m,h),e(s,()=>s(h))||U7(m),e(o,()=>o(h))||u(m,h),e(a,()=>a(h))||B7(m),t(h,m),m},UWe=t=>t===null?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null,BWe=(t,e)=>(n,r,i)=>{const s=n.destination;if(s.channelCount!==r)try{s.channelCount=r}catch{}i&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:r});const o=t(n,{channelCount:r,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{s.channelCount=c}catch(l){if(c>s.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>s.maxChannelCount}),o.connect(s),o},FWe=t=>t===null?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null,jWe=t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}},zWe=(t,e,n,r,i)=>(s,o,a,c,l,u)=>{if(a!==null)try{const h=new a(s,c,u),d=new Map;let m=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>m,set:p=>{typeof m=="function"&&h.removeEventListener("processorerror",m),m=typeof p=="function"?p:null,typeof m=="function"&&h.addEventListener("processorerror",m)}}}),h.addEventListener=(p=>(...g)=>{if(g[0]==="processorerror"){const y=typeof g[1]=="function"?g[1]:typeof g[1]=="object"&&g[1]!==null&&typeof g[1].handleEvent=="function"?g[1].handleEvent:null;if(y!==null){const v=d.get(g[1]);v!==void 0?g[1]=v:(g[1]=x=>{x.type==="error"?(Object.defineProperties(x,{type:{value:"processorerror"}}),y(x)):y(new ErrorEvent(g[0],{...x}))},d.set(y,g[1]))}}return p.call(h,"error",g[1],g[2]),p.call(h,...g)})(h.addEventListener),h.removeEventListener=(p=>(...g)=>{if(g[0]==="processorerror"){const y=d.get(g[1]);y!==void 0&&(d.delete(g[1]),g[1]=y)}return p.call(h,"error",g[1],g[2]),p.call(h,g[0],g[1],g[2])})(h.removeEventListener),u.numberOfOutputs!==0){const p=n(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(p).connect(s.destination),i(h,()=>p.disconnect(),()=>p.connect(s.destination))}return h}catch(h){throw h.code===11?r():h}if(l===void 0)throw r();return jWe(u),e(s,o,l,u)},Vle=(t,e)=>t===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),HWe=t=>new Promise((e,n)=>{const{port1:r,port2:i}=new MessageChannel;r.onmessage=({data:s})=>{r.close(),i.close(),e(s)},r.onmessageerror=({data:s})=>{r.close(),i.close(),n(s)},i.postMessage(t)}),qWe=async(t,e)=>{const n=await HWe(e);return new t(n)},VWe=(t,e,n,r)=>{let i=cB.get(t);i===void 0&&(i=new WeakMap,cB.set(t,i));const s=qWe(n,r);return i.set(e,s),s},GWe=(t,e,n,r,i,s,o,a,c,l,u,h,d)=>(m,p,g,y)=>{if(y.numberOfInputs===0&&y.numberOfOutputs===0)throw c();const v=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(v.some(Le=>Le<1))throw c();if(v.length!==y.numberOfOutputs)throw e();if(y.channelCountMode!=="explicit")throw c();const x=y.channelCount*y.numberOfInputs,E=v.reduce((Le,He)=>Le+He,0),C=g.parameterDescriptors===void 0?0:g.parameterDescriptors.length;if(x+C>6||E>6)throw c();const A=new MessageChannel,k=[],M=[];for(let Le=0;Le<y.numberOfInputs;Le+=1)k.push(o(m,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),M.push(i(m,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const I=[];if(g.parameterDescriptors!==void 0)for(const{defaultValue:Le,maxValue:He,minValue:Ue,name:De}of g.parameterDescriptors){const fe=s(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:y.parameterData[De]!==void 0?y.parameterData[De]:Le===void 0?0:Le});Object.defineProperties(fe.offset,{defaultValue:{get:()=>Le===void 0?0:Le},maxValue:{get:()=>He===void 0?zf:He},minValue:{get:()=>Ue===void 0?Nh:Ue}}),I.push(fe)}const z=r(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,x+C)}),H=Vle(p,m.sampleRate),K=a(m,H,x+C,Math.max(1,E)),P=i(m,{channelCount:Math.max(1,E),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,E)}),F=[];for(let Le=0;Le<y.numberOfOutputs;Le+=1)F.push(r(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[Le]}));for(let Le=0;Le<y.numberOfInputs;Le+=1){k[Le].connect(M[Le]);for(let He=0;He<y.channelCount;He+=1)M[Le].connect(z,He,Le*y.channelCount+He)}const N=new zle(g.parameterDescriptors===void 0?[]:g.parameterDescriptors.map(({name:Le},He)=>{const Ue=I[He];return Ue.connect(z,0,x+He),Ue.start(0),[Le,Ue.offset]}));z.connect(K);let X=y.channelInterpretation,G=null;const j=y.numberOfOutputs===0?[K]:F,q={get bufferSize(){return H},get channelCount(){return y.channelCount},set channelCount(Le){throw n()},get channelCountMode(){return y.channelCountMode},set channelCountMode(Le){throw n()},get channelInterpretation(){return X},set channelInterpretation(Le){for(const He of k)He.channelInterpretation=Le;X=Le},get context(){return K.context},get inputs(){return k},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},get onprocessorerror(){return G},set onprocessorerror(Le){typeof G=="function"&&q.removeEventListener("processorerror",G),G=typeof Le=="function"?Le:null,typeof G=="function"&&q.addEventListener("processorerror",G)},get parameters(){return N},get port(){return A.port2},addEventListener(...Le){return K.addEventListener(Le[0],Le[1],Le[2])},connect:t.bind(null,j),disconnect:l.bind(null,j),dispatchEvent(...Le){return K.dispatchEvent(Le[0])},removeEventListener(...Le){return K.removeEventListener(Le[0],Le[1],Le[2])}},te=new Map;A.port1.addEventListener=(Le=>(...He)=>{if(He[0]==="message"){const Ue=typeof He[1]=="function"?He[1]:typeof He[1]=="object"&&He[1]!==null&&typeof He[1].handleEvent=="function"?He[1].handleEvent:null;if(Ue!==null){const De=te.get(He[1]);De!==void 0?He[1]=De:(He[1]=fe=>{u(m.currentTime,m.sampleRate,()=>Ue(fe))},te.set(Ue,He[1]))}}return Le.call(A.port1,He[0],He[1],He[2])})(A.port1.addEventListener),A.port1.removeEventListener=(Le=>(...He)=>{if(He[0]==="message"){const Ue=te.get(He[1]);Ue!==void 0&&(te.delete(He[1]),He[1]=Ue)}return Le.call(A.port1,He[0],He[1],He[2])})(A.port1.removeEventListener);let W=null;Object.defineProperty(A.port1,"onmessage",{get:()=>W,set:Le=>{typeof W=="function"&&A.port1.removeEventListener("message",W),W=typeof Le=="function"?Le:null,typeof W=="function"&&(A.port1.addEventListener("message",W),A.port1.start())}}),g.prototype.port=A.port1;let $=null;VWe(m,q,g,y).then(Le=>$=Le);const ne=MN(y.numberOfInputs,y.channelCount),ie=MN(y.numberOfOutputs,v),ae=g.parameterDescriptors===void 0?[]:g.parameterDescriptors.reduce((Le,{name:He})=>({...Le,[He]:new Float32Array(128)}),{});let xe=!0;const Ne=()=>{y.numberOfOutputs>0&&K.disconnect(P);for(let Le=0,He=0;Le<y.numberOfOutputs;Le+=1){const Ue=F[Le];for(let De=0;De<v[Le];De+=1)P.disconnect(Ue,He+De,De);He+=v[Le]}},Re=new Map;K.onaudioprocess=({inputBuffer:Le,outputBuffer:He})=>{if($!==null){const Ue=h(q);for(let De=0;De<H;De+=128){for(let fe=0;fe<y.numberOfInputs;fe+=1)for(let ve=0;ve<y.channelCount;ve+=1)AN(Le,ne[fe],ve,ve,De);g.parameterDescriptors!==void 0&&g.parameterDescriptors.forEach(({name:fe},ve)=>{AN(Le,ae,fe,x+ve,De)});for(let fe=0;fe<y.numberOfInputs;fe+=1)for(let ve=0;ve<v[fe];ve+=1)ie[fe][ve].byteLength===0&&(ie[fe][ve]=new Float32Array(128));try{const fe=ne.map((Ae,pe)=>{if(Ue[pe].size>0)return Re.set(pe,H/128),Ae;const Qe=Re.get(pe);return Qe===void 0?[]:(Ae.every(Ze=>Ze.every(tt=>tt===0))&&(Qe===1?Re.delete(pe):Re.set(pe,Qe-1)),Ae)});xe=u(m.currentTime+De/m.sampleRate,m.sampleRate,()=>$.process(fe,ie,ae));for(let Ae=0,pe=0;Ae<y.numberOfOutputs;Ae+=1){for(let Ge=0;Ge<v[Ae];Ge+=1)Hle(He,ie[Ae],Ge,pe+Ge,De);pe+=v[Ae]}}catch(fe){xe=!1,q.dispatchEvent(new ErrorEvent("processorerror",{colno:fe.colno,filename:fe.filename,lineno:fe.lineno,message:fe.message}))}if(!xe){for(let fe=0;fe<y.numberOfInputs;fe+=1){k[fe].disconnect(M[fe]);for(let ve=0;ve<y.channelCount;ve+=1)M[De].disconnect(z,ve,fe*y.channelCount+ve)}if(g.parameterDescriptors!==void 0){const fe=g.parameterDescriptors.length;for(let ve=0;ve<fe;ve+=1){const Ae=I[ve];Ae.disconnect(z,0,x+ve),Ae.stop()}}z.disconnect(K),K.onaudioprocess=null,Se?Ne():Je();break}}}};let Se=!1;const ze=o(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Be=()=>K.connect(ze).connect(m.destination),Je=()=>{K.disconnect(ze),ze.disconnect()},at=()=>{if(xe){Je(),y.numberOfOutputs>0&&K.connect(P);for(let Le=0,He=0;Le<y.numberOfOutputs;Le+=1){const Ue=F[Le];for(let De=0;De<v[Le];De+=1)P.connect(Ue,He+De,De);He+=v[Le]}}Se=!0},re=()=>{xe&&(Be(),Ne()),Se=!1};return Be(),d(q,at,re)},Gle=(t,e)=>{const n=t.createBiquadFilter();return Rl(n,e),sc(n,e,"Q"),sc(n,e,"detune"),sc(n,e,"frequency"),sc(n,e,"gain"),Ea(n,e,"type"),n},$We=(t,e)=>(n,r)=>{const i=n.createChannelMerger(r.numberOfInputs);return t!==null&&t.name==="webkitAudioContext"&&e(n,i),Rl(i,r),i},WWe=t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:n=>{if(n!==e)throw nu()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:n=>{if(n!=="explicit")throw nu()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:n=>{if(n!=="discrete")throw nu()}})},QM=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return Rl(n,e),WWe(n),n},KWe=(t,e,n,r,i)=>(s,o)=>{if(s.createConstantSource===void 0)return n(s,o);const a=s.createConstantSource();return Rl(a,o),sc(a,o,"offset"),e(r,()=>r(s))||U7(a),e(i,()=>i(s))||B7(a),t(s,a),a},sT=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),XWe=(t,e,n,r)=>(i,{offset:s,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=n(i,{...o,gain:s}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(p){l.channelCount=p},get channelCountMode(){return l.channelCountMode},set channelCountMode(p){l.channelCountMode=p},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(p){l.channelInterpretation=p},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(p){c.onended=p},addEventListener(...p){return c.addEventListener(p[0],p[1],p[2])},dispatchEvent(...p){return c.dispatchEvent(p[0])},removeEventListener(...p){return c.removeEventListener(p[0],p[1],p[2])},start(p=0){c.start.call(c,p)},stop(p=0){c.stop.call(c,p)}},d=()=>c.connect(l),m=()=>c.disconnect(l);return t(i,c),r(sT(h,l),d,m)},YWe=(t,e)=>(n,r)=>{const i=n.createConvolver();if(Rl(i,r),r.disableNormalization===i.normalize&&(i.normalize=!r.disableNormalization),Ea(i,r,"buffer"),r.channelCount>2||(e(i,"channelCount",s=>()=>s.call(i),s=>o=>{if(o>2)throw t();return s.call(i,o)}),r.channelCountMode==="max"))throw t();return e(i,"channelCountMode",s=>()=>s.call(i),s=>o=>{if(o==="max")throw t();return s.call(i,o)}),i},$le=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return Rl(n,e),sc(n,e,"delayTime"),n},ZWe=t=>(e,n)=>{const r=e.createDynamicsCompressor();if(Rl(r,n),n.channelCount>2||n.channelCountMode==="max")throw t();return sc(r,n,"attack"),sc(r,n,"knee"),sc(r,n,"ratio"),sc(r,n,"release"),sc(r,n,"threshold"),r},td=(t,e)=>{const n=t.createGain();return Rl(n,e),sc(n,e,"gain"),n},JWe=t=>(e,n,r)=>{if(e.createIIRFilter===void 0)return t(e,n,r);const i=e.createIIRFilter(r.feedforward,r.feedback);return Rl(i,r),i};function QWe(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function eKe(t,e){return[t[0]*e[0]-t[1]*e[1],t[0]*e[1]+t[1]*e[0]]}function AY(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)n=eKe(n,e),n[0]+=t[r];return n}const tKe=(t,e,n,r)=>(i,s,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=Vle(s,i.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),m=u instanceof Float64Array?u:new Float64Array(u),p=d.length,g=m.length,y=Math.min(p,g);if(p===0||p>20)throw r();if(d[0]===0)throw e();if(g===0||g>20)throw r();if(m[0]===0)throw e();if(d[0]!==1){for(let I=0;I<g;I+=1)m[I]/=d[0];for(let I=1;I<p;I+=1)d[I]/=d[0]}const v=n(i,h,o,o);v.channelCount=o,v.channelCountMode=a,v.channelInterpretation=c;const x=32,E=[],C=[],A=[];for(let I=0;I<o;I+=1){E.push(0);const z=new Float32Array(x),H=new Float32Array(x);z.fill(0),H.fill(0),C.push(z),A.push(H)}v.onaudioprocess=I=>{const z=I.inputBuffer,H=I.outputBuffer,K=z.numberOfChannels;for(let P=0;P<K;P+=1){const F=z.getChannelData(P),N=H.getChannelData(P);E[P]=qle(d,p,m,g,y,C[P],A[P],E[P],x,F,N)}};const k=i.sampleRate/2;return sT({get bufferSize(){return h},get channelCount(){return v.channelCount},set channelCount(I){v.channelCount=I},get channelCountMode(){return v.channelCountMode},set channelCountMode(I){v.channelCountMode=I},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(I){v.channelInterpretation=I},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},addEventListener(...I){return v.addEventListener(I[0],I[1],I[2])},dispatchEvent(...I){return v.dispatchEvent(I[0])},getFrequencyResponse(I,z,H){if(I.length!==z.length||z.length!==H.length)throw t();const K=I.length;for(let P=0;P<K;P+=1){const F=-Math.PI*(I[P]/k),N=[Math.cos(F),Math.sin(F)],X=AY(m,N),G=AY(d,N),j=QWe(X,G);z[P]=Math.sqrt(j[0]*j[0]+j[1]*j[1]),H[P]=Math.atan2(j[1],j[0])}},removeEventListener(...I){return v.removeEventListener(I[0],I[1],I[2])}},v)},nKe=(t,e)=>t.createMediaElementSource(e.mediaElement),rKe=(t,e)=>{const n=t.createMediaStreamDestination();return Rl(n,e),n.numberOfOutputs===1&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n},iKe=(t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort((s,o)=>s.id<o.id?-1:s.id>o.id?1:0);const r=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(i,"mediaStream",{value:e}),i},sKe=(t,e)=>(n,{mediaStreamTrack:r})=>{if(typeof n.createMediaStreamTrackSource=="function")return n.createMediaStreamTrackSource(r);const i=new MediaStream([r]),s=n.createMediaStreamSource(i);if(r.kind!=="audio")throw t();if(e(n))throw new TypeError;return s},oKe=t=>t===null?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null,aKe=(t,e,n,r,i,s)=>(o,a)=>{const c=o.createOscillator();return Rl(c,a),sc(c,a,"detune"),sc(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):Ea(c,a,"type"),e(n,()=>n(o))||U7(c),e(r,()=>r(o))||s(c,o),e(i,()=>i(o))||B7(c),t(o,c),c},cKe=t=>(e,n)=>{const r=e.createPanner();return r.orientationX===void 0?t(e,n):(Rl(r,n),sc(r,n,"orientationX"),sc(r,n,"orientationY"),sc(r,n,"orientationZ"),sc(r,n,"positionX"),sc(r,n,"positionY"),sc(r,n,"positionZ"),Ea(r,n,"coneInnerAngle"),Ea(r,n,"coneOuterAngle"),Ea(r,n,"coneOuterGain"),Ea(r,n,"distanceModel"),Ea(r,n,"maxDistance"),Ea(r,n,"panningModel"),Ea(r,n,"refDistance"),Ea(r,n,"rolloffFactor"),r)},lKe=(t,e,n,r,i,s,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:m,distanceModel:p,maxDistance:g,orientationX:y,orientationY:v,orientationZ:x,panningModel:E,positionX:C,positionY:A,positionZ:k,refDistance:M,rolloffFactor:I,...z})=>{const H=u.createPanner();if(z.channelCount>2||z.channelCountMode==="max")throw o();Rl(H,z);const K={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},P=n(u,{...K,channelInterpretation:"speakers",numberOfInputs:6}),F=r(u,{...z,gain:1}),N=r(u,{...K,gain:1}),X=r(u,{...K,gain:0}),G=r(u,{...K,gain:0}),j=r(u,{...K,gain:0}),q=r(u,{...K,gain:0}),te=r(u,{...K,gain:0}),W=i(u,256,6,1),$=s(u,{...K,curve:new Float32Array([1,1]),oversample:"none"});let J=[y,v,x],ne=[C,A,k];const ie=new Float32Array(1);W.onaudioprocess=({inputBuffer:Re})=>{const Se=[c(Re,ie,0),c(Re,ie,1),c(Re,ie,2)];Se.some((Be,Je)=>Be!==J[Je])&&(H.setOrientation(...Se),J=Se);const ze=[c(Re,ie,3),c(Re,ie,4),c(Re,ie,5)];ze.some((Be,Je)=>Be!==ne[Je])&&(H.setPosition(...ze),ne=ze)},Object.defineProperty(X.gain,"defaultValue",{get:()=>0}),Object.defineProperty(G.gain,"defaultValue",{get:()=>0}),Object.defineProperty(j.gain,"defaultValue",{get:()=>0}),Object.defineProperty(q.gain,"defaultValue",{get:()=>0}),Object.defineProperty(te.gain,"defaultValue",{get:()=>0});const ae={get bufferSize(){},get channelCount(){return H.channelCount},set channelCount(Re){if(Re>2)throw o();F.channelCount=Re,H.channelCount=Re},get channelCountMode(){return H.channelCountMode},set channelCountMode(Re){if(Re==="max")throw o();F.channelCountMode=Re,H.channelCountMode=Re},get channelInterpretation(){return H.channelInterpretation},set channelInterpretation(Re){F.channelInterpretation=Re,H.channelInterpretation=Re},get coneInnerAngle(){return H.coneInnerAngle},set coneInnerAngle(Re){H.coneInnerAngle=Re},get coneOuterAngle(){return H.coneOuterAngle},set coneOuterAngle(Re){H.coneOuterAngle=Re},get coneOuterGain(){return H.coneOuterGain},set coneOuterGain(Re){if(Re<0||Re>1)throw e();H.coneOuterGain=Re},get context(){return H.context},get distanceModel(){return H.distanceModel},set distanceModel(Re){H.distanceModel=Re},get inputs(){return[F]},get maxDistance(){return H.maxDistance},set maxDistance(Re){if(Re<0)throw new RangeError;H.maxDistance=Re},get numberOfInputs(){return H.numberOfInputs},get numberOfOutputs(){return H.numberOfOutputs},get orientationX(){return N.gain},get orientationY(){return X.gain},get orientationZ(){return G.gain},get panningModel(){return H.panningModel},set panningModel(Re){H.panningModel=Re},get positionX(){return j.gain},get positionY(){return q.gain},get positionZ(){return te.gain},get refDistance(){return H.refDistance},set refDistance(Re){if(Re<0)throw new RangeError;H.refDistance=Re},get rolloffFactor(){return H.rolloffFactor},set rolloffFactor(Re){if(Re<0)throw new RangeError;H.rolloffFactor=Re},addEventListener(...Re){return F.addEventListener(Re[0],Re[1],Re[2])},dispatchEvent(...Re){return F.dispatchEvent(Re[0])},removeEventListener(...Re){return F.removeEventListener(Re[0],Re[1],Re[2])}};h!==ae.coneInnerAngle&&(ae.coneInnerAngle=h),d!==ae.coneOuterAngle&&(ae.coneOuterAngle=d),m!==ae.coneOuterGain&&(ae.coneOuterGain=m),p!==ae.distanceModel&&(ae.distanceModel=p),g!==ae.maxDistance&&(ae.maxDistance=g),y!==ae.orientationX.value&&(ae.orientationX.value=y),v!==ae.orientationY.value&&(ae.orientationY.value=v),x!==ae.orientationZ.value&&(ae.orientationZ.value=x),E!==ae.panningModel&&(ae.panningModel=E),C!==ae.positionX.value&&(ae.positionX.value=C),A!==ae.positionY.value&&(ae.positionY.value=A),k!==ae.positionZ.value&&(ae.positionZ.value=k),M!==ae.refDistance&&(ae.refDistance=M),I!==ae.rolloffFactor&&(ae.rolloffFactor=I),(J[0]!==1||J[1]!==0||J[2]!==0)&&H.setOrientation(...J),(ne[0]!==0||ne[1]!==0||ne[2]!==0)&&H.setPosition(...ne);const xe=()=>{F.connect(H),t(F,$,0,0),$.connect(N).connect(P,0,0),$.connect(X).connect(P,0,1),$.connect(G).connect(P,0,2),$.connect(j).connect(P,0,3),$.connect(q).connect(P,0,4),$.connect(te).connect(P,0,5),P.connect(W).connect(u.destination)},Ne=()=>{F.disconnect(H),a(F,$,0,0),$.disconnect(N),N.disconnect(P),$.disconnect(X),X.disconnect(P),$.disconnect(G),G.disconnect(P),$.disconnect(j),j.disconnect(P),$.disconnect(q),q.disconnect(P),$.disconnect(te),te.disconnect(P),P.disconnect(W),W.disconnect(u.destination)};return l(sT(ae,H),xe,Ne)},uKe=t=>(e,{disableNormalization:n,imag:r,real:i})=>{const s=r instanceof Float32Array?r:new Float32Array(r),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,s,{disableNormalization:n});if(Array.from(r).length<2)throw t();return a},e2=(t,e,n,r)=>t.createScriptProcessor(e,n,r),fKe=(t,e)=>(n,r)=>{const i=r.channelCountMode;if(i==="clamped-max")throw e();if(n.createStereoPanner===void 0)return t(n,r);const s=n.createStereoPanner();return Rl(s,r),sc(s,r,"pan"),Object.defineProperty(s,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),s},hKe=(t,e,n,r,i,s)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(p,g,y,v)=>{const x=new Float32Array(16385),E=new Float32Array(16385);for(let z=0;z<16385;z+=1){const H=z/16384*c;x[z]=Math.cos(H),E[z]=Math.sin(H)}const C=n(p,{...l,gain:0}),A=r(p,{...u,curve:x}),k=r(p,{...u,curve:a}),M=n(p,{...l,gain:0}),I=r(p,{...u,curve:E});return{connectGraph(){g.connect(C),g.connect(k.inputs===void 0?k:k.inputs[0]),g.connect(M),k.connect(y),y.connect(A.inputs===void 0?A:A.inputs[0]),y.connect(I.inputs===void 0?I:I.inputs[0]),A.connect(C.gain),I.connect(M.gain),C.connect(v,0,0),M.connect(v,0,1)},disconnectGraph(){g.disconnect(C),g.disconnect(k.inputs===void 0?k:k.inputs[0]),g.disconnect(M),k.disconnect(y),y.disconnect(A.inputs===void 0?A:A.inputs[0]),y.disconnect(I.inputs===void 0?I:I.inputs[0]),A.disconnect(C.gain),I.disconnect(M.gain),C.disconnect(v,0,0),M.disconnect(v,0,1)}}},d=(p,g,y,v)=>{const x=new Float32Array(16385),E=new Float32Array(16385),C=new Float32Array(16385),A=new Float32Array(16385),k=Math.floor(16385/2);for(let j=0;j<16385;j+=1)if(j>k){const q=(j-k)/(16384-k)*c;x[j]=Math.cos(q),E[j]=Math.sin(q),C[j]=0,A[j]=1}else{const q=j/(16384-k)*c;x[j]=1,E[j]=0,C[j]=Math.cos(q),A[j]=Math.sin(q)}const M=e(p,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),I=n(p,{...l,gain:0}),z=r(p,{...u,curve:x}),H=n(p,{...l,gain:0}),K=r(p,{...u,curve:E}),P=r(p,{...u,curve:a}),F=n(p,{...l,gain:0}),N=r(p,{...u,curve:C}),X=n(p,{...l,gain:0}),G=r(p,{...u,curve:A});return{connectGraph(){g.connect(M),g.connect(P.inputs===void 0?P:P.inputs[0]),M.connect(I,0),M.connect(H,0),M.connect(F,1),M.connect(X,1),P.connect(y),y.connect(z.inputs===void 0?z:z.inputs[0]),y.connect(K.inputs===void 0?K:K.inputs[0]),y.connect(N.inputs===void 0?N:N.inputs[0]),y.connect(G.inputs===void 0?G:G.inputs[0]),z.connect(I.gain),K.connect(H.gain),N.connect(F.gain),G.connect(X.gain),I.connect(v,0,0),F.connect(v,0,0),H.connect(v,0,1),X.connect(v,0,1)},disconnectGraph(){g.disconnect(M),g.disconnect(P.inputs===void 0?P:P.inputs[0]),M.disconnect(I,0),M.disconnect(H,0),M.disconnect(F,1),M.disconnect(X,1),P.disconnect(y),y.disconnect(z.inputs===void 0?z:z.inputs[0]),y.disconnect(K.inputs===void 0?K:K.inputs[0]),y.disconnect(N.inputs===void 0?N:N.inputs[0]),y.disconnect(G.inputs===void 0?G:G.inputs[0]),z.disconnect(I.gain),K.disconnect(H.gain),N.disconnect(F.gain),G.disconnect(X.gain),I.disconnect(v,0,0),F.disconnect(v,0,0),H.disconnect(v,0,1),X.disconnect(v,0,1)}}},m=(p,g,y,v,x)=>{if(g===1)return h(p,y,v,x);if(g===2)return d(p,y,v,x);throw i()};return(p,{channelCount:g,channelCountMode:y,pan:v,...x})=>{if(y==="max")throw i();const E=t(p,{...x,channelCount:1,channelCountMode:y,numberOfInputs:2}),C=n(p,{...x,channelCount:g,channelCountMode:y,gain:1}),A=n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:v});let{connectGraph:k,disconnectGraph:M}=m(p,g,C,A,E);Object.defineProperty(A.gain,"defaultValue",{get:()=>0}),Object.defineProperty(A.gain,"maxValue",{get:()=>1}),Object.defineProperty(A.gain,"minValue",{get:()=>-1});const I={get bufferSize(){},get channelCount(){return C.channelCount},set channelCount(P){C.channelCount!==P&&(z&&M(),{connectGraph:k,disconnectGraph:M}=m(p,P,C,A,E),z&&k()),C.channelCount=P},get channelCountMode(){return C.channelCountMode},set channelCountMode(P){if(P==="clamped-max"||P==="max")throw i();C.channelCountMode=P},get channelInterpretation(){return C.channelInterpretation},set channelInterpretation(P){C.channelInterpretation=P},get context(){return C.context},get inputs(){return[C]},get numberOfInputs(){return C.numberOfInputs},get numberOfOutputs(){return C.numberOfOutputs},get pan(){return A.gain},addEventListener(...P){return C.addEventListener(P[0],P[1],P[2])},dispatchEvent(...P){return C.dispatchEvent(P[0])},removeEventListener(...P){return C.removeEventListener(P[0],P[1],P[2])}};let z=!1;const H=()=>{k(),z=!0},K=()=>{M(),z=!1};return s(sT(I,E),H,K)}},dKe=(t,e,n,r,i,s,o)=>(a,c)=>{const l=a.createWaveShaper();if(s!==null&&s.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return n(a,c);Rl(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();Ea(l,{curve:u},"curve"),Ea(l,c,"oversample");let h=null,d=!1;return o(l,"curve",g=>()=>g.call(l),g=>y=>(g.call(l,y),d&&(r(y)&&h===null?h=t(a,l):!r(y)&&h!==null&&(h(),h=null)),y)),i(l,()=>{d=!0,r(l.curve)&&(h=t(a,l))},()=>{d=!1,h!==null&&(h(),h=null)})},pKe=(t,e,n,r,i)=>(s,{curve:o,oversample:a,...c})=>{const l=s.createWaveShaper(),u=s.createWaveShaper();Rl(l,c),Rl(u,c);const h=n(s,{...c,gain:1}),d=n(s,{...c,gain:-1}),m=n(s,{...c,gain:1}),p=n(s,{...c,gain:-1});let g=null,y=!1,v=null;const x={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(A){h.channelCount=A,d.channelCount=A,l.channelCount=A,m.channelCount=A,u.channelCount=A,p.channelCount=A},get channelCountMode(){return l.channelCountMode},set channelCountMode(A){h.channelCountMode=A,d.channelCountMode=A,l.channelCountMode=A,m.channelCountMode=A,u.channelCountMode=A,p.channelCountMode=A},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(A){h.channelInterpretation=A,d.channelInterpretation=A,l.channelInterpretation=A,m.channelInterpretation=A,u.channelInterpretation=A,p.channelInterpretation=A},get context(){return l.context},get curve(){return v},set curve(A){if(A!==null&&A.length<2)throw e();if(A===null)l.curve=A,u.curve=A;else{const k=A.length,M=new Float32Array(k+2-k%2),I=new Float32Array(k+2-k%2);M[0]=A[0],I[0]=-A[k-1];const z=Math.ceil((k+1)/2),H=(k+1)/2-1;for(let K=1;K<z;K+=1){const P=K/z*H,F=Math.floor(P),N=Math.ceil(P);M[K]=F===N?A[F]:(1-(P-F))*A[F]+(1-(N-P))*A[N],I[K]=F===N?-A[k-1-F]:-((1-(P-F))*A[k-1-F])-(1-(N-P))*A[k-1-N]}M[z]=k%2===1?A[z-1]:(A[z-2]+A[z-1])/2,l.curve=M,u.curve=I}v=A,y&&(r(v)&&g===null?g=t(s,h):g!==null&&(g(),g=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(A){l.oversample=A,u.oversample=A},addEventListener(...A){return h.addEventListener(A[0],A[1],A[2])},dispatchEvent(...A){return h.dispatchEvent(A[0])},removeEventListener(...A){return h.removeEventListener(A[0],A[1],A[2])}};o!==null&&(x.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==x.oversample&&(x.oversample=a);const E=()=>{h.connect(l).connect(m),h.connect(d).connect(u).connect(p).connect(m),y=!0,r(v)&&(g=t(s,h))},C=()=>{h.disconnect(l),l.disconnect(m),h.disconnect(d),d.disconnect(u),u.disconnect(p),p.disconnect(m),y=!1,g!==null&&(g(),g=null)};return i(sT(x,m),E,C)},Qf=()=>new DOMException("","NotSupportedError"),mKe={numberOfChannels:1},gKe=(t,e,n,r,i)=>class extends t{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:d}={...mKe,...l},m=r(h,u,d);e(oM,()=>oM(m))||m.addEventListener("statechange",(()=>{let p=0;const g=y=>{this._state==="running"&&(p>0?(m.removeEventListener("statechange",g),y.stopImmediatePropagation(),this._waitForThePromiseToSettle(y)):p+=1)};return g})()),super(m,h),this._length=u,this._nativeOfflineAudioContext=m,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Ule(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},_Ke={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},vKe=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),h={..._Ke,...l},d=n(u,h),m=s(u),p=m?r():null,g=c.sampleRate/2;super(c,!1,d,p),this._detune=e(this,m,d.detune,153600,-153600),this._frequency=e(this,m,d.frequency,g,-g),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=p,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){kx(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),Ev(this)&&YM(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},yKe=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let d=n(u);const m=hf(d,h);if(!m){const p={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:o===null?void 0:o,type:d.type};d=e(h,p),a!==null&&d.start(a),c!==null&&d.stop(c)}return s.set(h,d),m?(await t(h,u.detune,d.detune),await t(h,u.frequency,d.frequency)):(await r(h,u.detune,d.detune),await r(h,u.frequency,d.frequency)),await i(u,h,d),d};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const d=s.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},bKe={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},EKe=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),h={...bKe,...l},d=n(u,h),m=s(u),p=m?r():null;super(c,!1,d,p),this._nativePannerNode=d,this._orientationX=e(this,m,d.orientationX,zf,Nh),this._orientationY=e(this,m,d.orientationY,zf,Nh),this._orientationZ=e(this,m,d.orientationZ,zf,Nh),this._positionX=e(this,m,d.positionX,zf,Nh),this._positionY=e(this,m,d.positionY,zf,Nh),this._positionZ=e(this,m,d.positionZ,zf,Nh),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},SKe=(t,e,n,r,i,s,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const d=async(m,p)=>{let g=null,y=s(m);const v={channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation},x={...v,coneInnerAngle:y.coneInnerAngle,coneOuterAngle:y.coneOuterAngle,coneOuterGain:y.coneOuterGain,distanceModel:y.distanceModel,maxDistance:y.maxDistance,panningModel:y.panningModel,refDistance:y.refDistance,rolloffFactor:y.rolloffFactor},E=hf(y,p);if("bufferSize"in y)g=r(p,{...v,gain:1});else if(!E){const C={...x,orientationX:y.orientationX.value,orientationY:y.orientationY.value,orientationZ:y.orientationZ.value,positionX:y.positionX.value,positionY:y.positionY.value,positionZ:y.positionZ.value};y=i(p,C)}if(u.set(p,g===null?y:g),g!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const K=new o(6,m.context.length,p.sampleRate),P=e(K,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});P.connect(K.destination),h=(async()=>{const F=await Promise.all([m.orientationX,m.orientationY,m.orientationZ,m.positionX,m.positionY,m.positionZ].map(async(N,X)=>{const G=n(K,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:X===0?1:0});return await a(K,N,G.offset),G}));for(let N=0;N<6;N+=1)F[N].connect(P,0,N),F[N].start(0);return l(K)})()}const C=await h,A=r(p,{...v,gain:1});await c(m,p,A);const k=[];for(let K=0;K<C.numberOfChannels;K+=1)k.push(C.getChannelData(K));let M=[k[0][0],k[1][0],k[2][0]],I=[k[3][0],k[4][0],k[5][0]],z=r(p,{...v,gain:1}),H=i(p,{...x,orientationX:M[0],orientationY:M[1],orientationZ:M[2],positionX:I[0],positionY:I[1],positionZ:I[2]});A.connect(z).connect(H.inputs[0]),H.connect(g);for(let K=128;K<C.length;K+=128){const P=[k[0][K],k[1][K],k[2][K]],F=[k[3][K],k[4][K],k[5][K]];if(P.some((N,X)=>N!==M[X])||F.some((N,X)=>N!==I[X])){M=P,I=F;const N=K/p.sampleRate;z.gain.setValueAtTime(0,N),z=r(p,{...v,gain:0}),H=i(p,{...x,orientationX:M[0],orientationY:M[1],orientationZ:M[2],positionX:I[0],positionY:I[1],positionZ:I[2]}),z.gain.setValueAtTime(1,N),A.connect(z).connect(H.inputs[0]),H.connect(g)}}return g}return E?(await t(p,m.orientationX,y.orientationX),await t(p,m.orientationY,y.orientationY),await t(p,m.orientationZ,y.orientationZ),await t(p,m.positionX,y.positionX),await t(p,m.positionY,y.positionY),await t(p,m.positionZ,y.positionZ)):(await a(p,m.orientationX,y.orientationX),await a(p,m.orientationY,y.orientationY),await a(p,m.orientationZ,y.orientationZ),await a(p,m.positionX,y.positionX),await a(p,m.positionY,y.positionY),await a(p,m.positionZ,y.positionZ)),iT(y)?await c(m,p,y.inputs[0]):await c(m,p,y),y};return{render(m,p){const g=u.get(p);return g!==void 0?Promise.resolve(g):d(m,p)}}},xKe={disableNormalization:!1},TKe=(t,e,n,r)=>class Wle{constructor(s,o){const a=e(s),c=r({...xKe,...o}),l=t(a,c);return n.add(l),l}static[Symbol.hasInstance](s){return s!==null&&typeof s=="object"&&Object.getPrototypeOf(s)===Wle.prototype||n.has(s)}},wKe=(t,e)=>(n,r,i)=>(t(r).replay(i),e(r,n,i)),RKe=(t,e,n)=>async(r,i,s)=>{const o=t(r);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const d=await e(l).render(l,i),m=r.context.destination;!n(l)&&(r!==m||!n(r))&&d.connect(s,u,c)})).reduce((a,c)=>[...a,...c],[]))},CKe=(t,e,n)=>async(r,i,s)=>{const o=e(r);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await t(a).render(a,i);n(a)||u.connect(s,c)}))},AKe=(t,e,n,r)=>i=>t(oM,()=>oM(i))?Promise.resolve(t(r,r)).then(s=>{if(!s){const o=n(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(s=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),s(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),MKe=t=>(e,n)=>{t.set(e,n)},kKe=t=>(e,n)=>t.set(e,n),OKe=(t,e,n,r,i,s,o,a)=>(c,l)=>n(c).render(c,l).then(()=>Promise.all(Array.from(r(l)).map(u=>n(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),P7(u)):e(s,()=>s(u))||a(u),t.add(u),u)),IKe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},NKe=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...IKe,...c},h=n(l,u),d=s(l),m=d?r():null;super(a,!1,h,m),this._pan=e(this,d,h.pan)}get pan(){return this._pan}},PKe=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=hf(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return s.set(c,l),u?await t(c,a.pan,l.pan):await r(c,a.pan,l.pan),iT(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},DKe=t=>()=>{if(t===null)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0},LKe=(t,e)=>async()=>{if(t===null)return!0;if(e===null)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new e(1,128,44100),i=URL.createObjectURL(n);let s=!1,o=!1;try{await r.audioWorklet.addModule(i);const a=new t(r,"a",{numberOfOutputs:0}),c=r.createOscillator();a.port.onmessage=()=>s=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await r.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return s&&!o},UKe=(t,e)=>()=>{if(e===null)return Promise.resolve(!1);const n=new e(1,1,44100),r=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{n.oncomplete=()=>{r.disconnect(),i(n.currentTime!==0)},n.startRendering()})},BKe=()=>new DOMException("","UnknownError"),FKe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},jKe=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),h={...FKe,...l},d=n(u,h),p=s(u)?r():null;super(c,!0,d,p),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},zKe=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!hf(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=t(o,l)}return r.set(o,a),iT(a)?await n(s,o,a.inputs[0]):await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},HKe=()=>typeof window>"u"?null:window,qKe=(t,e)=>n=>{n.copyFromChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,l=n.getChannelData(a),u=r.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)r[h]=l[h+o]},n.copyToChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,l=n.getChannelData(a),u=r.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=r[h]}},VKe=t=>e=>{e.copyFromChannel=(n=>(r,i,s=0)=>{const o=t(s),a=t(i);if(o<e.length)return n.call(e,r,a,o)})(e.copyFromChannel),e.copyToChannel=(n=>(r,i,s=0)=>{const o=t(s),a=t(i);if(o<e.length)return n.call(e,r,a,o)})(e.copyToChannel)},GKe=t=>(e,n)=>{const r=n.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=r),t(e,"buffer",i=>()=>{const s=i.call(e);return s===r?null:s},i=>s=>i.call(e,s===null?r:s))},$Ke=(t,e)=>(n,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource();e(r,()=>{const a=r.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(r,0,c)},()=>i.disconnect(r))},Kle=(t,e,n)=>t.copyFromChannel===void 0?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),Xle=t=>{if(t===null)return!1;const e=t.length;return e%2!==0?t[Math.floor(e/2)]!==0:t[e/2-1]+t[e/2]!==0},t2=(t,e,n,r)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:s,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(s),set:r(o)})},WKe=t=>({...t,outputChannelCount:t.outputChannelCount!==void 0?t.outputChannelCount:t.numberOfInputs===1&&t.numberOfOutputs===1?[t.channelCount]:Array.from({length:t.numberOfOutputs},()=>1)}),KKe=t=>({...t,channelCount:t.numberOfOutputs}),XKe=t=>{const{imag:e,real:n}=t;return e===void 0?n===void 0?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,()=>0),real:n}:n===void 0?{...t,imag:e,real:Array.from(e,()=>0)}:{...t,imag:e,real:n}},Yle=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(r){if(r.code!==9)throw r;Yle(t,e,n+1e-7)}},YKe=t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},ZKe=t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0},JKe=t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},F7=t=>{const e=t.createOscillator();try{e.start(-1)}catch(n){return n instanceof RangeError}return!1},Zle=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},j7=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(n){return n instanceof RangeError}return!1},QKe=t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}},eXe=t=>{t.start=(e=>(n=0,r=0,i)=>{const s=t.buffer,o=s===null?r:Math.min(s.duration,r);s!==null&&o>s.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})(t.start)},Jle=(t,e)=>{const n=e.createGain();t.connect(n);const r=(i=>()=>{i.call(t,n),t.removeEventListener("ended",r)})(t.disconnect);t.addEventListener("ended",r),sT(t,n),t.stop=(i=>{let s=!1;return(o=0)=>{if(s)try{i.call(t,o)}catch{n.gain.setValueAtTime(0,o)}else i.call(t,o),s=!0}})(t.stop)},oT=(t,e)=>n=>{const r={value:t};return Object.defineProperties(n,{currentTarget:r,target:r}),typeof e=="function"?e.call(t,n):e.handleEvent.call(t,n)},tXe=EGe(yE),nXe=CGe(yE),rXe=F$e(dP),Qle=new WeakMap,iXe=rWe(Qle),Ag=m$e(new Map,new WeakMap),q0=HKe(),eue=NWe(Ag,t_),z7=nWe(Xf),Pu=RKe(Xf,z7,Y1),sXe=IGe(eue,oa,Pu),zo=oWe(hP),Vv=oKe(q0),go=xWe(Vv),tue=new WeakMap,nue=X$e(oT),n2=UWe(q0),H7=yWe(n2),q7=bWe(q0),rue=EWe(q0),aM=FWe(q0),Ac=r$e(SGe(kle),RGe(tXe,nXe,wN,rXe,RN,Xf,iXe,XM,oa,yE,Ev,Y1,$O),Ag,pWe(oB,RN,Xf,oa,sM,Ev),t_,pP,Qf,D$e(wN,oB,Xf,oa,sM,zo,Ev,go),H$e(tue,Xf,vg),nue,zo,H7,q7,rue,go,aM),oXe=OGe(Ac,sXe,t_,eue,zo,go),V7=new WeakSet,MY=PWe(q0),iue=A$e(new Uint32Array(1)),G7=qKe(iue,t_),$7=VKe(iue),sue=PGe(V7,Ag,Qf,MY,Vv,DKe(MY),G7,$7),mP=AGe(td),oue=CKe(z7,ZM,Y1),n_=S$e(oue),aT=LWe(mP,Ag,YKe,ZKe,JKe,F7,Zle,j7,eXe,GKe(t2),Jle),r_=wKe(iWe(ZM),oue),aXe=UGe(n_,aT,oa,r_,Pu),Mg=i$e(xGe(Ole),tue,N7,s$e,mGe,gGe,_Ge,vGe,yGe,rB,Ale,n2,Yle),cXe=LGe(Ac,aXe,Mg,nu,aT,zo,go,oT),lXe=$Ge(Ac,WGe,t_,nu,BWe(td,t2),zo,go,Pu),uXe=p$e(n_,Gle,oa,r_,Pu),bE=kKe(Qle),fXe=d$e(Ac,Mg,uXe,pP,Gle,zo,go,bE),_b=OWe(yE,q7),hXe=$Ke(nu,_b),vb=$We(n2,hXe),dXe=v$e(vb,oa,Pu),pXe=_$e(Ac,dXe,vb,zo,go),mXe=E$e(QM,oa,Pu),gXe=b$e(Ac,mXe,QM,zo,go,KKe),_Xe=XWe(mP,aT,td,_b),cT=KWe(mP,Ag,_Xe,F7,j7),vXe=C$e(n_,cT,oa,r_,Pu),yXe=R$e(Ac,Mg,vXe,cT,zo,go,oT),aue=YWe(Qf,t2),bXe=O$e(aue,oa,Pu),EXe=k$e(Ac,bXe,aue,zo,go,bE),SXe=B$e(n_,$le,oa,r_,Pu),xXe=U$e(Ac,Mg,SXe,$le,zo,go,bE),cue=ZWe(Qf),TXe=$$e(n_,cue,oa,r_,Pu),wXe=G$e(Ac,Mg,TXe,cue,Qf,zo,go,bE),RXe=eWe(n_,td,oa,r_,Pu),CXe=Q$e(Ac,Mg,RXe,td,zo,go),AXe=tKe(pP,nu,e2,Qf),gP=AKe(Ag,td,e2,UKe(td,Vv)),MXe=dWe(aT,oa,Vv,Pu,gP),kXe=JWe(AXe),OXe=fWe(Ac,kXe,MXe,zo,go,bE),IXe=KGe(Mg,vb,cT,e2,Qf,Kle,go,t2),lue=new WeakMap,NXe=kWe(lXe,IXe,nue,go,lue,oT),uue=aKe(mP,Ag,F7,Zle,j7,Jle),PXe=yKe(n_,uue,oa,r_,Pu),DXe=vKe(Ac,Mg,uue,PXe,zo,go,oT),fue=T$e(aT),LXe=pKe(fue,nu,td,Xle,_b),_P=dKe(fue,nu,LXe,Xle,_b,n2,t2),UXe=lKe(wN,nu,vb,td,e2,_P,Qf,RN,Kle,_b),hue=cKe(UXe),BXe=SKe(n_,vb,cT,td,hue,oa,Vv,r_,Pu,gP),FXe=EKe(Ac,Mg,hue,BXe,zo,go,bE),jXe=uKe(t_),zXe=TKe(jXe,zo,new WeakSet,XKe),HXe=hKe(vb,QM,td,_P,Qf,_b),due=fKe(HXe,Qf),qXe=PKe(n_,due,oa,r_,Pu),VXe=NKe(Ac,Mg,due,qXe,zo,go),GXe=zKe(_P,oa,Pu),$Xe=jKe(Ac,nu,_P,GXe,zo,go,bE),pue=TWe(q0),W7=Y$e(q0),mue=new WeakMap,WXe=aWe(mue,Vv),KXe=pue?wGe(Ag,Qf,K$e(q0),W7,Z$e(bGe),zo,WXe,go,aM,new WeakMap,new WeakMap,LKe(aM,Vv),q0):void 0,XXe=SWe(H7,go),YXe=P$e(V7,Ag,N$e,W$e,new WeakSet,zo,XXe,xN,oM,G7,$7),gue=f$e(KXe,oXe,sue,cXe,fXe,pXe,gXe,yXe,EXe,YXe,xXe,wXe,CXe,OXe,NXe,DXe,FXe,zXe,VXe,$Xe),ZXe=wWe(Ac,nKe,zo,go),JXe=CWe(Ac,rKe,zo,go),QXe=AWe(Ac,iKe,zo,go),eYe=sKe(nu,go),tYe=MWe(Ac,eYe,zo),nYe=GGe(gue,nu,Qf,BKe,ZXe,JXe,QXe,tYe,n2),K7=cWe(lue),rYe=MGe(K7),_ue=x$e(t_),iYe=j$e(K7),vue=q$e(t_),yue=new WeakMap,sYe=tWe(yue,vg),oYe=GWe(_ue,t_,nu,vb,QM,cT,td,e2,Qf,vue,W7,sYe,_b),aYe=zWe(nu,oYe,td,Qf,_b),cYe=u$e(n_,_ue,aT,vb,QM,cT,td,iYe,vue,W7,oa,aM,Vv,r_,Pu,gP),lYe=sWe(mue),uYe=MKe(yue),kY=pue?a$e(rYe,Ac,Mg,cYe,aYe,Xf,lYe,zo,go,aM,WKe,uYe,QKe,oT):void 0,fYe=I$e(Qf,Vv),hYe=OKe(V7,Ag,z7,K7,gP,xN,G7,$7),dYe=gKe(gue,Ag,nu,fYe,hYe),pYe=mWe(hP,H7),mYe=gWe(I7,q7),gYe=_We(N7,rue),_Ye=vWe(hP,go);function Kd(t){return t===void 0}function Ai(t){return t!==void 0}function vYe(t){return typeof t=="function"}function yg(t){return typeof t=="number"}function Hy(t){return Object.prototype.toString.call(t)==="[object Object]"&&t.constructor===Object}function bue(t){return typeof t=="boolean"}function $h(t){return Array.isArray(t)}function Iv(t){return typeof t=="string"}function jk(t){return Iv(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}function Lr(t,e){if(!t)throw new Error(e)}function Qp(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function Eue(t){!t.isOffline&&t.state!=="running"&&vP('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Sue=!1,OY=!1;function IY(t){Sue=t}function yYe(t){Kd(t)&&Sue&&!OY&&(OY=!0,vP("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let xue=console;function bYe(...t){xue.log(...t)}function vP(...t){xue.warn(...t)}function EYe(t){return new nYe(t)}function SYe(t,e,n){return new dYe(t,e,n)}const Ud=typeof self=="object"?self:null,xYe=Ud&&(Ud.hasOwnProperty("AudioContext")||Ud.hasOwnProperty("webkitAudioContext"));function TYe(t,e,n){return Lr(Ai(kY),"AudioWorkletNode only works in a secure context (https or localhost)"),new(t instanceof Ud?.BaseAudioContext?Ud?.AudioWorkletNode:kY)(t,e,n)}var fB=function(t,e){return fB=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},fB(t,e)};function yP(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");fB(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var kN=function(){return kN=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},kN.apply(this,arguments)};function Tue(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function _o(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function wue(t,e){return function(n,r){e(n,r,t)}}function Rue(t,e,n,r,i,s){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var a=r.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&t?r.static?t:t.prototype:null,u=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,d=!1,m=n.length-1;m>=0;m--){var p={};for(var g in r)p[g]=g==="access"?{}:r[g];for(var g in r.access)p.access[g]=r.access[g];p.addInitializer=function(v){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(v||null))};var y=(0,n[m])(a==="accessor"?{get:u.get,set:u.set}:u[c],p);if(a==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=o(y.get))&&(u.get=h),(h=o(y.set))&&(u.set=h),(h=o(y.init))&&i.unshift(h)}else(h=o(y))&&(a==="field"?i.unshift(h):u[c]=h)}l&&Object.defineProperty(l,r.name,u),d=!0}function Cue(t,e,n){for(var r=arguments.length>2,i=0;i<e.length;i++)n=r?e[i].call(t,n):e[i].call(t);return r?n:void 0}function Aue(t){return typeof t=="symbol"?t:"".concat(t)}function Mue(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function kue(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function jo(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function r2(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var bP=Object.create?(function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]});function Oue(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&bP(e,t,n)}function ON(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function EE(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Iue(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(EE(arguments[e]));return t}function Nue(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function cM(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Ox(t){return this instanceof Ox?(this.v=t,this):new Ox(t)}function Pue(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(m){return function(p){return Promise.resolve(p).then(m,h)}}function a(m,p){r[m]&&(i[m]=function(g){return new Promise(function(y,v){s.push([m,g,y,v])>1||c(m,g)})},p&&(i[m]=p(i[m])))}function c(m,p){try{l(r[m](p))}catch(g){d(s[0][3],g)}}function l(m){m.value instanceof Ox?Promise.resolve(m.value.v).then(u,h):d(s[0][2],m)}function u(m){c("next",m)}function h(m){c("throw",m)}function d(m,p){m(p),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Due(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:Ox(t[i](o)),done:!1}:s?s(o):o}:s}}function Lue(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof ON=="function"?ON(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Uue(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var wYe=Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e},hB=function(t){return hB=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},hB(t)};function Bue(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=hB(t),r=0;r<n.length;r++)n[r]!=="default"&&bP(e,t,n[r]);return wYe(e,t),e}function Fue(t){return t&&t.__esModule?t:{default:t}}function jue(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function zue(t,e,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n}function Hue(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function que(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,i;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(i=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(s){return Promise.reject(s)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var RYe=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function Vue(t){function e(s){t.error=t.hasError?new RYe(s,t.error,"An error was suppressed during disposal."):s,t.hasError=!0}var n,r=0;function i(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(i);if(n.dispose){var s=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(s).then(i,function(o){return e(o),i()})}else r|=1}catch(o){e(o)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return i()}function Gue(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,i,s,o){return r?e?".jsx":".js":i&&(!s||!o)?n:i+s+"."+o.toLowerCase()+"js"}):t}const CYe={__extends:yP,__assign:kN,__rest:Tue,__decorate:_o,__param:wue,__esDecorate:Rue,__runInitializers:Cue,__propKey:Aue,__setFunctionName:Mue,__metadata:kue,__awaiter:jo,__generator:r2,__createBinding:bP,__exportStar:Oue,__values:ON,__read:EE,__spread:Iue,__spreadArrays:Nue,__spreadArray:cM,__await:Ox,__asyncGenerator:Pue,__asyncDelegator:Due,__asyncValues:Lue,__makeTemplateObject:Uue,__importStar:Bue,__importDefault:Fue,__classPrivateFieldGet:jue,__classPrivateFieldSet:zue,__classPrivateFieldIn:Hue,__addDisposableResource:que,__disposeResources:Vue,__rewriteRelativeImportExtension:Gue},AYe=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:que,get __assign(){return kN},__asyncDelegator:Due,__asyncGenerator:Pue,__asyncValues:Lue,__await:Ox,__awaiter:jo,__classPrivateFieldGet:jue,__classPrivateFieldIn:Hue,__classPrivateFieldSet:zue,__createBinding:bP,__decorate:_o,__disposeResources:Vue,__esDecorate:Rue,__exportStar:Oue,__extends:yP,__generator:r2,__importDefault:Fue,__importStar:Bue,__makeTemplateObject:Uue,__metadata:kue,__param:wue,__propKey:Aue,__read:EE,__rest:Tue,__rewriteRelativeImportExtension:Gue,__runInitializers:Cue,__setFunctionName:Mue,__spread:Iue,__spreadArray:cM,__spreadArrays:Nue,__values:ON,default:CYe},Symbol.toStringTag,{value:"Module"}));class MYe{constructor(e,n,r,i){this._callback=e,this._type=n,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=r,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),n=URL.createObjectURL(e),r=new Worker(n);r.onmessage=this._callback.bind(this),this._worker=r}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var n;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((n=this._worker)===null||n===void 0||n.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function Z1(t){return gYe(t)}function qy(t){return mYe(t)}function WO(t){return _Ye(t)}function vS(t){return pYe(t)}function kYe(t){return t instanceof sue}function OYe(t,e){return t==="value"||Z1(e)||qy(e)||kYe(e)}function Vy(t,...e){if(!e.length)return t;const n=e.shift();if(Hy(t)&&Hy(n))for(const r in n)OYe(r,n[r])?t[r]=n[r]:Hy(n[r])?(t[r]||Object.assign(t,{[r]:{}}),Vy(t[r],n[r])):Object.assign(t,{[r]:n[r]});return Vy(t,...e)}function IYe(t,e){return t.length===e.length&&t.every((n,r)=>e[r]===n)}function Gn(t,e,n=[],r){const i={},s=Array.from(e);if(Hy(s[0])&&r&&!Reflect.has(s[0],r)&&(Object.keys(s[0]).some(a=>Reflect.has(t,a))||(Vy(i,{[r]:s[0]}),n.splice(n.indexOf(r),1),s.shift())),s.length===1&&Hy(s[0]))Vy(i,s[0]);else for(let o=0;o<n.length;o++)Ai(s[o])&&(i[n[o]]=s[o]);return Vy(t,i)}function NYe(t){return t.constructor.getDefaults()}function P0(t,e){return Kd(t)?e:t}function M0(t,e){return e.forEach(n=>{Reflect.has(t,n)&&delete t[n]}),t}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class Gv{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Ud&&this.toString()===Ud.TONE_DEBUG_CLASS)&&bYe(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Gv.version=Cle;const X7=1e-6;function Ix(t,e){return t>e+X7}function dB(t,e){return Ix(t,e)||cg(t,e)}function IN(t,e){return t+X7<e}function cg(t,e){return Math.abs(t-e)<X7}function PYe(t,e,n){return Math.max(Math.min(t,n),e)}class rm extends Gv{constructor(){super(),this.name="Timeline",this._timeline=[];const e=Gn(rm.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(Lr(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const n=this._timeline[this.length-1];Lr(dB(e.time,n.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const n=this._search(e.time);this._timeline.splice(n+1,0,e)}if(this.length>this.memory){const n=this.length-this.memory;this._timeline.splice(0,n)}return this}remove(e){const n=this._timeline.indexOf(e);return n!==-1&&this._timeline.splice(n,1),this}get(e,n="time"){const r=this._search(e,n);return r!==-1?this._timeline[r]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,n="time"){const r=this._search(e,n);return r+1<this._timeline.length?this._timeline[r+1]:null}getBefore(e){const n=this._timeline.length;if(n>0&&this._timeline[n-1].time<e)return this._timeline[n-1];const r=this._search(e);return r-1>=0?this._timeline[r-1]:null}cancel(e){if(this._timeline.length>1){let n=this._search(e);if(n>=0)if(cg(this._timeline[n].time,e)){for(let r=n;r>=0&&cg(this._timeline[r].time,e);r--)n=r;this._timeline=this._timeline.slice(0,n)}else this._timeline=this._timeline.slice(0,n+1);else this._timeline=[]}else this._timeline.length===1&&dB(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const n=this._search(e);return n>=0&&(this._timeline=this._timeline.slice(n+1)),this}previousEvent(e){const n=this._timeline.indexOf(e);return n>0?this._timeline[n-1]:null}_search(e,n="time"){if(this._timeline.length===0)return-1;let r=0;const i=this._timeline.length;let s=i;if(i>0&&this._timeline[i-1][n]<=e)return i-1;for(;r<s;){let o=Math.floor(r+(s-r)/2);const a=this._timeline[o],c=this._timeline[o+1];if(cg(a[n],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(cg(u[n],e))o=l;else break}return o}else{if(IN(a[n],e)&&Ix(c[n],e))return o;Ix(a[n],e)?s=o:r=o+1}}return-1}_iterate(e,n=0,r=this._timeline.length-1){this._timeline.slice(n,r+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,n){const r=this._search(e);return r!==-1&&this._iterate(n,0,r),this}forEachAfter(e,n){const r=this._search(e);return this._iterate(n,r+1),this}forEachBetween(e,n,r){let i=this._search(e),s=this._search(n);return i!==-1&&s!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[s].time===n&&(s-=1),this._iterate(r,i,s)):i===-1&&this._iterate(r,0,s),this}forEachFrom(e,n){let r=this._search(e);for(;r>=0&&this._timeline[r].time>=e;)r--;return this._iterate(n,r+1),this}forEachAtTime(e,n){const r=this._search(e);if(r!==-1&&cg(this._timeline[r].time,e)){let i=r;for(let s=r;s>=0&&cg(this._timeline[s].time,e);s--)i=s;this._iterate(s=>{n(s)},i,r)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const $ue=[];function EP(t){$ue.push(t)}function DYe(t){$ue.forEach(e=>e(t))}const Wue=[];function SP(t){Wue.push(t)}function LYe(t){Wue.forEach(e=>e(t))}class i2 extends Gv{constructor(){super(...arguments),this.name="Emitter"}on(e,n){return e.split(/\W+/).forEach(i=>{Kd(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(n)}),this}once(e,n){const r=(...i)=>{n(...i),this.off(e,r)};return this.on(e,r),this}off(e,n){return e.split(/\W+/).forEach(i=>{if(Kd(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(Kd(n))this._events[i]=[];else{const s=this._events[i];for(let o=s.length-1;o>=0;o--)s[o]===n&&s.splice(o,1)}}),this}emit(e,...n){if(this._events&&this._events.hasOwnProperty(e)){const r=this._events[e].slice(0);for(let i=0,s=r.length;i<s;i++)r[i].apply(this,n)}return this}static mixin(e){["on","once","off","emit"].forEach(n=>{const r=Object.getOwnPropertyDescriptor(i2.prototype,n);Object.defineProperty(e.prototype,n,r)})}dispose(){return super.dispose(),this._events=void 0,this}}class Kue extends i2{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class lT extends Kue{constructor(){var e,n;super(),this.name="Context",this._constants=new Map,this._timeouts=new rm,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const r=Gn(lT.getDefaults(),arguments,["context"]);r.context?(this._context=r.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=EYe({latencyHint:r.latencyHint}),this._latencyHint=r.latencyHint),this._ticker=new MYe(this.emit.bind(this,"tick"),r.clockSource,r.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((n=arguments[0])===null||n===void 0)&&n.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=r.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(DYe(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,n,r){return this._context.createBuffer(e,n,r)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,n){return this._context.createIIRFilter(e,n)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,n,r){return this._context.createPeriodicWave(e,n,r)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return Lr(vS(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return Lr(vS(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return Lr(vS(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){Lr(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){Lr(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){Lr(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){Lr(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,n){return TYe(this.rawContext,e,n)}addAudioWorkletModule(e){return jo(this,void 0,void 0,function*(){Lr(Ai(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return jo(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return vS(this._context)?this._context.resume():Promise.resolve()}close(){return jo(this,void 0,void 0,function*(){vS(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&LYe(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const n=this._context.createBuffer(1,128,this._context.sampleRate),r=n.getChannelData(0);for(let s=0;s<r.length;s++)r[s]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=n,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();this._timeouts.forEachBefore(e,n=>{n.callback(),this._timeouts.remove(n)})}setTimeout(e,n){this._timeoutIds++;const r=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:r+n}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(n=>{n.id===e&&this._timeouts.remove(n)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,n){const r=++this._timeoutIds,i=()=>{const s=this.now();this._timeouts.add({callback:()=>{e(),i()},id:r,time:s+n})};return i(),r}}class UYe extends Kue{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,n,r){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,n){return{}}createPanner(){return{}}createPeriodicWave(e,n,r){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,n){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return jo(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,n){return 0}clearTimeout(e){return this}setInterval(e,n){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function Mi(t,e){$h(e)?e.forEach(n=>Mi(t,n)):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function s2(t,e){$h(e)?e.forEach(n=>s2(t,n)):Object.defineProperty(t,e,{writable:!0})}const Hs=()=>{};class ho extends Gv{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Hs;const e=Gn(ho.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,Iv(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:Hs,onload:Hs,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:sa().sampleRate}set(e){return e instanceof ho?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return jo(this,void 0,void 0,function*(){const n=ho.load(e).then(r=>{this.set(r),this.onload(this)});ho.downloads.push(n);try{yield n}finally{const r=ho.downloads.indexOf(n);ho.downloads.splice(r,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const n=$h(e)&&e[0].length>0,r=n?e.length:1,i=n?e[0].length:e.length,s=sa(),o=s.createBuffer(r,i,s.sampleRate),a=!n&&r===1?[e]:e;for(let c=0;c<r;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(yg(e))this.fromArray(this.toArray(e));else{let n=new Float32Array(this.length);const r=this.numberOfChannels;for(let i=0;i<r;i++){const s=this.toArray(i);for(let o=0;o<s.length;o++)n[o]+=s[o]}n=n.map(i=>i/r),this.fromArray(n)}return this}toArray(e){if(yg(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const n=[];for(let r=0;r<this.numberOfChannels;r++)n[r]=this.getChannelData(r);return n}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,n=this.duration){Lr(this.loaded,"Buffer is not loaded");const r=Math.floor(e*this.sampleRate),i=Math.floor(n*this.sampleRate);Lr(r<i,"The start time must be less than the end time");const s=i-r,o=sa().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(r,i),a);return new ho(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new ho().fromArray(e)}static fromUrl(e){return jo(this,void 0,void 0,function*(){return yield new ho().load(e)})}static load(e){return jo(this,void 0,void 0,function*(){const n=ho.baseUrl===""||ho.baseUrl.endsWith("/")?ho.baseUrl:ho.baseUrl+"/",r=yield fetch(n+e);if(!r.ok)throw new Error(`could not load url: ${e}`);const i=yield r.arrayBuffer();return yield sa().decodeAudioData(i)})}static supportsType(e){const n=e.split("."),r=n[n.length-1];return document.createElement("audio").canPlayType("audio/"+r)!==""}static loaded(){return jo(this,void 0,void 0,function*(){for(yield Promise.resolve();ho.downloads.length;)yield ho.downloads[0]})}}ho.baseUrl="";ho.downloads=[];class o2 extends lT{constructor(){super({clockSource:"offline",context:WO(arguments[0])?arguments[0]:SYe(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:WO(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=WO(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return jo(this,void 0,void 0,function*(){let n=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,n++;const r=Math.floor(this.sampleRate/128);e&&n%r===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return jo(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const n=yield this._context.startRendering();return new ho(n)})}close(){return Promise.resolve()}}const Xue=new UYe;let y1=Xue;function sa(){return y1===Xue&&xYe&&NN(new lT),y1}function NN(t,e=!1){e&&y1.dispose(),vS(t)?y1=new lT(t):WO(t)?y1=new o2(t):y1=t}function BYe(){return y1.resume()}if(Ud&&!Ud.TONE_SILENCE_LOGGING){const e=` * Tone.js v${Cle} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function Yue(t){return Math.pow(10,t/20)}function Zue(t){return 20*(Math.log(t)/Math.LN10)}function Jue(t){return Math.pow(2,t/12)}let xP=440;function FYe(){return xP}function jYe(t){xP=t}function b1(t){return Math.round(Que(t))}function Que(t){return 69+12*Math.log2(t/xP)}function efe(t){return xP*Math.pow(2,(t-69)/12)}class Y7 extends Gv{constructor(e,n,r){super(),this.defaultUnits="s",this._val=n,this._units=r,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,n)=>{const r=parseInt(e,10),i=n==="."?1.5:1;return r===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/r)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const n=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(n)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,n,r)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),n&&n!=="0"&&(i+=this._beatsToUnits(parseFloat(n))),r&&r!=="0"&&(i+=this._beatsToUnits(parseFloat(r)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Y7&&this.fromType(this._val),Kd(this._val))return this._noArg();if(Iv(this._val)&&Kd(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Hy(this._val)){let e=0;for(const n in this._val)if(Ai(this._val[n])){const r=this._val[n],i=new this.constructor(this.context,n).valueOf()*r;e+=i}return e}if(Ai(this._units)){const e=this._expressions[this._units],n=this._val.toString().trim().match(e.regexp);return n?e.method.apply(this,n.slice(1)):e.method.call(this,this._val)}else return Iv(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class em extends Y7{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const n=new em(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(n))},regexp:/^@(.+)/}})}quantize(e,n=1){const r=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/r)*r-i;return i+a*n}toNotation(){const e=this.toSeconds(),n=["1m"];for(let s=1;s<9;s++){const o=Math.pow(2,s);n.push(o+"n."),n.push(o+"n"),n.push(o+"t")}n.push("0");let r=n[0],i=new em(this.context,n[0]).toSeconds();return n.forEach(s=>{const o=new em(this.context,s).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(r=s,i=o)}),r}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let n=this.valueOf()/e;n=parseFloat(n.toFixed(4));const r=Math.floor(n/this._getTimeSignature());let i=n%1*4;n=Math.floor(n)%this._getTimeSignature();const s=i.toString();return s.length>3&&(i=parseFloat(parseFloat(s).toFixed(3))),[r,n,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return b1(this.toFrequency())}_now(){return this.context.now()}}function $l(t,e){return new em(sa(),t,e)}class jh extends em{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return FYe()}static set A4(e){jYe(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:jh.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,n){const i=zYe[e.toLowerCase()]+(parseInt(n,10)+1)*12;return this.defaultUnits==="midi"?i:jh.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,n,r){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),n&&n!=="0"&&(i*=this._beatsToUnits(parseFloat(n))),r&&r!=="0"&&(i*=this._beatsToUnits(parseFloat(r)/4)),i}}})}transpose(e){return new jh(this.context,this.valueOf()*Jue(e))}harmonize(e){return e.map(n=>this.transpose(n))}toMidi(){return b1(this.valueOf())}toNote(){const e=this.toFrequency(),n=Math.log2(e/jh.A4);let r=Math.round(12*n)+57;const i=Math.floor(r/12);return i<0&&(r+=-12*i),HYe[r%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),n=this.valueOf()/e;return Math.floor(n*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return efe(e)}static ftom(e){return b1(e)}}const zYe={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},HYe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function NY(t,e){return new jh(sa(),t,e)}class GS extends em{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class cf extends Gv{constructor(){super();const e=Gn(cf.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:sa()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return yYe(e),new em(this.context,e).toSeconds()}toFrequency(e){return new jh(this.context,e).toFrequency()}toTicks(e){return new GS(this.context,e).toTicks()}_getPartialProperties(e){const n=this.get();return Object.keys(n).forEach(r=>{Kd(e[r])&&delete n[r]}),n}get(){const e=NYe(this);return Object.keys(e).forEach(n=>{if(Reflect.has(this,n)){const r=this[n];Ai(r)&&Ai(r.value)&&Ai(r.setValueAtTime)?e[n]=r.value:r instanceof cf?e[n]=r._getPartialProperties(e[n]):$h(r)||yg(r)||Iv(r)||bue(r)?e[n]=r:delete e[n]}}),e}set(e){return Object.keys(e).forEach(n=>{Reflect.has(this,n)&&Ai(this[n])&&(this[n]&&Ai(this[n].value)&&Ai(this[n].setValueAtTime)?this[n].value!==e[n]&&(this[n].value=e[n]):this[n]instanceof cf?this[n].set(e[n]):this[n]=e[n])}),this}}class a2 extends rm{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const n=this.get(e);return n!==null?n.state:this._initial}setStateAtTime(e,n,r){return Qp(n,0),this.add(Object.assign({},r,{state:e,time:n})),this}getLastState(e,n){const r=this._search(n);for(let i=r;i>=0;i--){const s=this._timeline[i];if(s.state===e)return s}}getNextState(e,n){const r=this._search(n);if(r!==-1)for(let i=r;i<this._timeline.length;i++){const s=this._timeline[i];if(s.state===e)return s}}}class Zr extends cf{constructor(){const e=Gn(Zr.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,Lr(Ai(e.param)&&(Z1(e.param)||e.param instanceof Zr),"param must be an AudioParam");!Z1(e.param);)e.param=e.param._param;this._swappable=Ai(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new rm(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,Ai(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(cf.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return Ai(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return Ai(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,n){return this.units===n}_assertRange(e){return Ai(this.maxValue)&&Ai(this.minValue)&&Qp(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?Yue(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?Zue(e):e}setValueAtTime(e,n){const r=this.toSeconds(n),i=this._fromType(e);return Lr(isFinite(i)&&isFinite(r),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,r),this._events.add({time:r,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,r),this}getValueAtTime(e){const n=Math.max(this.toSeconds(e),0),r=this._events.getAfter(n),i=this._events.get(n);let s=this._initialValue;if(i===null)s=this._initialValue;else if(i.type==="setTargetAtTime"&&(r===null||r.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(s=this._exponentialApproach(i.time,a,i.value,i.constant,n))}else if(r===null)s=i.value;else if(r.type==="linearRampToValueAtTime"||r.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}r.type==="linearRampToValueAtTime"?s=this._linearInterpolate(i.time,o,r.time,r.value,n):s=this._exponentialInterpolate(i.time,o,r.time,r.value,n)}else s=i.value;return this._toType(s)}setRampPoint(e){e=this.toSeconds(e);let n=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(n)===0&&(n=this._toType(this._minOutput)),this.setValueAtTime(n,e),this}linearRampToValueAtTime(e,n){const r=this._fromType(e),i=this.toSeconds(n);return Lr(isFinite(r)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._assertRange(r),this._events.add({time:i,type:"linearRampToValueAtTime",value:r}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(r,i),this}exponentialRampToValueAtTime(e,n){let r=this._fromType(e);r=cg(r,0)?this._minOutput:r,this._assertRange(r);const i=this.toSeconds(n);return Lr(isFinite(r)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:r}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(r,i),this}exponentialRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialRampToValueAtTime(e,r+this.toSeconds(n)),this}linearRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.linearRampToValueAtTime(e,r+this.toSeconds(n)),this}targetRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialApproachValueAtTime(e,r,n),this}exponentialApproachValueAtTime(e,n,r){n=this.toSeconds(n),r=this.toSeconds(r);const i=Math.log(r+1)/Math.log(200);return this.setTargetAtTime(e,n,i),this.cancelAndHoldAtTime(n+r*.9),this.linearRampToValueAtTime(e,n+r),this}setTargetAtTime(e,n,r){const i=this._fromType(e);Lr(isFinite(r)&&r>0,"timeConstant must be a number greater than 0");const s=this.toSeconds(n);return this._assertRange(i),Lr(isFinite(i)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._events.add({constant:r,time:s,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,s,r),this._param.setTargetAtTime(i,s,r),this}setValueCurveAtTime(e,n,r,i=1){r=this.toSeconds(r),n=this.toSeconds(n);const s=this._fromType(e[0])*i;this.setValueAtTime(this._toType(s),n);const o=r/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),n+a*o)}return this}cancelScheduledValues(e){const n=this.toSeconds(e);return Lr(isFinite(n),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(n),this._param.cancelScheduledValues(n),this.log(this.units,"cancelScheduledValues",n),this}cancelAndHoldAtTime(e){const n=this.toSeconds(e),r=this._fromType(this.getValueAtTime(n));Lr(isFinite(n),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",n,"value="+r);const i=this._events.get(n),s=this._events.getAfter(n);return i&&cg(i.time,n)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(n),this._events.cancel(n+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),s.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(r),n):s.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(r),n)),this._events.add({time:n,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,n),this}rampTo(e,n=.1,r){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,n,r):this.linearRampTo(e,n,r),this}apply(e){const n=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(n),n);const r=this._events.get(n);if(r&&r.type==="setTargetAtTime"){const i=this._events.getAfter(r.time),s=i?i.time:n+2,o=(s-n)/10;for(let a=n;a<s;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){Lr(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const n=this.input;return n.disconnect(this._param),this.apply(e),this._param=e,n.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,n,r,i,s){return r+(n-r)*Math.exp(-(s-e)/i)}_linearInterpolate(e,n,r,i,s){return n+(i-n)*((s-e)/(r-e))}_exponentialInterpolate(e,n,r,i,s){return n*Math.pow(i/n,(s-e)/(r-e))}}class Jn extends cf{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return Ai(this.input)?Z1(this.input)||this.input instanceof Zr?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Ai(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return Ai(e)&&(e instanceof Jn||qy(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(r=>{r.channelCount=e.channelCount,r.channelCountMode=e.channelCountMode,r.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();Lr(e.length>0,"ToneAudioNode does not have any internal nodes");const n=e[0];return{channelCount:n.channelCount,channelCountMode:n.channelCountMode,channelInterpretation:n.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelInterpretation:e}))}connect(e,n=0,r=0){return bg(this,e,n,r),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return vP("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,n=0,r=0){return tfe(this,e,n,r),this}chain(...e){return J1(this,...e),this}fan(...e){return e.forEach(n=>this.connect(n)),this}dispose(){return super.dispose(),Ai(this.input)&&(this.input instanceof Jn?this.input.dispose():qy(this.input)&&this.input.disconnect()),Ai(this.output)&&(this.output instanceof Jn?this.output.dispose():qy(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function J1(...t){const e=t.shift();t.reduce((n,r)=>(n instanceof Jn?n.connect(r):qy(n)&&bg(n,r),r),e)}function bg(t,e,n=0,r=0){for(Lr(Ai(t),"Cannot connect from undefined node"),Lr(Ai(e),"Cannot connect to undefined node"),(e instanceof Jn||qy(e))&&Lr(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Lr(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Jn||e instanceof Zr;)Ai(e.input)&&(e=e.input);for(;t instanceof Jn;)Ai(t.output)&&(t=t.output);Z1(e)?t.connect(e,n):t.connect(e,n,r)}function tfe(t,e,n=0,r=0){if(Ai(e))for(;e instanceof Jn;)e=e.input;for(;!qy(t);)Ai(t.output)&&(t=t.output);Z1(e)?t.disconnect(e,n):qy(e)?t.disconnect(e,n,r):t.disconnect()}class Jr extends Jn{constructor(){const e=Gn(Jr.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new Zr({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),Mi(this,"gain")}static getDefaults(){return Object.assign(Jn.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Nx extends Jn{constructor(e){super(e),this.onended=Hs,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Jr({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(n){const r=this.toSeconds(n);return this._startTime!==-1&&r>=this._startTime&&(this._stopTime===-1||r<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(Jn.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Hs})}_startGain(e,n=1){Lr(this._startTime===-1,"Source cannot be started more than once");const r=this.toSeconds(this._fadeIn);return this._startTime=e+r,this._startTime=Math.max(this._startTime,this.context.currentTime),r>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(n,e+r):this._gainNode.gain.exponentialApproachValueAtTime(n,e,r)):this._gainNode.gain.setValueAtTime(n,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){Lr(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const n=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+n,this._stopTime=Math.max(this._stopTime,this.now()),n>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,n,e):this._gainNode.gain.targetRampTo(0,n,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const r=this._curve==="exponential"?n*2:0;this._stopSource(this.now()+r),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Hs&&(this.onended(this),this.onended=Hs,!this.context.isOffline)){const e=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(e):setTimeout(e,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Lr(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Hs,this}}class Z7 extends Nx{constructor(){const e=Gn(Z7.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),bg(this._source,this._gainNode),this.offset=new Zr({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Nx.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const n=this.toSeconds(e);return this.log("start",n),this._startGain(n),this._source.start(n),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Yi extends Jn{constructor(){const e=Gn(Yi.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new Z7({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Jn.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,n=0,r=0){return TP(this,e,n,r),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,n){return this._param.setValueAtTime(e,n),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,n){return this._param.linearRampToValueAtTime(e,n),this}exponentialRampToValueAtTime(e,n){return this._param.exponentialRampToValueAtTime(e,n),this}exponentialRampTo(e,n,r){return this._param.exponentialRampTo(e,n,r),this}linearRampTo(e,n,r){return this._param.linearRampTo(e,n,r),this}targetRampTo(e,n,r){return this._param.targetRampTo(e,n,r),this}exponentialApproachValueAtTime(e,n,r){return this._param.exponentialApproachValueAtTime(e,n,r),this}setTargetAtTime(e,n,r){return this._param.setTargetAtTime(e,n,r),this}setValueCurveAtTime(e,n,r,i){return this._param.setValueCurveAtTime(e,n,r,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,n,r){return this._param.rampTo(e,n,r),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function TP(t,e,n,r){(e instanceof Zr||Z1(e)||e instanceof Yi&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Yi&&(e.overridden=!0)),bg(t,e,n,r)}class J7 extends Zr{constructor(){const e=Gn(J7.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new rm(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Zr.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,n,r){n=this.toSeconds(n),this.setRampPoint(n);const i=this._fromType(e),s=this._events.get(n),o=Math.round(Math.max(1/r,1));for(let a=0;a<=o;a++){const c=r*a+n,l=this._exponentialApproach(s.time,s.value,i,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,n){const r=this.toSeconds(n);super.setValueAtTime(e,n);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,n){const r=this.toSeconds(n);super.linearRampToValueAtTime(e,n);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,n){n=this.toSeconds(n);const r=this._fromType(e),i=this._events.get(n),s=Math.round(Math.max((n-i.time)*10,1)),o=(n-i.time)/s;for(let a=0;a<=s;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,n,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,n){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Kd(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const r=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(n));const s=this._events.get(n);return s&&s.time===n&&s.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(n-this.sampleTime))),.5*(n-e.time)*(r+i)+e.ticks}getTicksAtTime(e){const n=this.toSeconds(e),r=this._events.get(n);return Math.max(this._getTicksUntilEvent(r,n),0)}getDurationOfTicks(e,n){const r=this.toSeconds(n),i=this.getTicksAtTime(n);return this.getTimeOfTick(i+e)-r}getTimeOfTick(e){const n=this._events.get(e,"ticks"),r=this._events.getAfter(e,"ticks");if(n&&n.ticks===e)return n.time;if(n&&r&&r.type==="linearRampToValueAtTime"&&n.value!==r.value){const i=this._fromType(this.getValueAtTime(n.time)),o=(this._fromType(this.getValueAtTime(r.time))-i)/(r.time-n.time),a=Math.sqrt(Math.pow(i,2)-2*o*(n.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+n.time}else return n?n.value===0?1/0:n.time+(e-n.ticks)/n.value:e/this._initialValue}ticksToTime(e,n){return this.getDurationOfTicks(e,n)}timeToTicks(e,n){const r=this.toSeconds(n),i=this.toSeconds(e),s=this.getTicksAtTime(r);return this.getTicksAtTime(r+i)-s}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const n=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(n,0)}}class Q7 extends Yi{constructor(){const e=Gn(Q7.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new J7({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Yi.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,n){return this._param.ticksToTime(e,n)}timeToTicks(e,n){return this._param.timeToTicks(e,n)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,n){return this._param.getDurationOfTicks(e,n)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class e9 extends cf{constructor(){const e=Gn(e9.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new a2,this._tickOffset=new rm,this._ticksAtTime=new rm,this._secondsAtTime=new rm,this.frequency=new Q7({context:this.context,units:e.units,value:e.frequency}),Mi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},cf.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,n){const r=this.toSeconds(e);return this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),Ai(n)&&this.setTicksAtTime(n,r),this._ticksAtTime.cancel(r),this._secondsAtTime.cancel(r)),this}stop(e){const n=this.toSeconds(e);if(this._state.getValueAtTime(n)==="stopped"){const r=this._state.get(n);r&&r.time>0&&(this._tickOffset.cancel(r.time),this._state.cancel(r.time))}return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this.setTicksAtTime(0,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n),this}pause(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)==="started"&&(this._state.setStateAtTime("paused",n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const n=this.toSeconds(e),r=this._state.getLastState("stopped",n),i=this._ticksAtTime.get(n),s={state:"paused",time:n};this._state.add(s);let o=i||r,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,n+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==s.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(s),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const n=this.now(),r=this.frequency.timeToTicks(e,n);this.setTicksAtTime(r,n)}getSecondsAtTime(e){e=this.toSeconds(e);const n=this._state.getLastState("stopped",e),r={state:"paused",time:e};this._state.add(r);const i=this._secondsAtTime.get(e);let s=i||n,o=i?i.seconds:0,a=null;return this._state.forEachBetween(s.time,e+this.sampleTime,c=>{let l=s.time;const u=this._tickOffset.get(c.time);u&&u.time>=s.time&&(o=u.seconds,l=u.time),s.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!==r.time&&(a={state:c.state,time:c.time,seconds:o})),s=c}),this._state.remove(r),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,n){return n=this.toSeconds(n),this._tickOffset.cancel(n),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,n),ticks:e,time:n}),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,n=this.now()){const r=this._tickOffset.get(n),i=this._state.get(n),s=Math.max(r.time,i.time),o=this.frequency.getTicksAtTime(s)+e-r.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,n,r){let i=this._state.get(e);this._state.forEachBetween(e,n,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,r),i=o});let s=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=cg(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<n;){try{r(h,Math.round(this.getTicksAtTime(h)))}catch(d){s=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class wP extends cf{constructor(){const e=Gn(wP.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=Hs,this._lastUpdate=0,this._state=new a2("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new e9({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Mi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(cf.getDefaults(),{callback:Hs,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,n){Eue(this.context);const r=this.toSeconds(e);return this.log("start",r),this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),this._tickSource.start(r,n),r<this._lastUpdate&&this.emit("start",r,n)),this}stop(e){const n=this.toSeconds(e);return this.log("stop",n),this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._tickSource.stop(n),n<this._lastUpdate&&this.emit("stop",n),this}pause(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)==="started"&&(this._state.setStateAtTime("paused",n),this._tickSource.pause(n),n<this._lastUpdate&&this.emit("pause",n)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,n){return this._tickSource.setTicksAtTime(e,n),this}getTimeOfTick(e,n=this.now()){return this._tickSource.getTimeOfTick(e,n)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,n){const r=this.toSeconds(n),i=this.getTicksAtTime(r);return this._tickSource.getTimeOfTick(i+e,r)}_loop(){const e=this._lastUpdate,n=this.now();this._lastUpdate=n,this.log("loop",e,n),e!==n&&(this._state.forEachBetween(e,n,r=>{switch(r.state){case"started":const i=this._tickSource.getTicksAtTime(r.time);this.emit("start",r.time,i);break;case"stopped":r.time!==0&&this.emit("stop",r.time);break;case"paused":this.emit("pause",r.time);break}}),this._tickSource.forEachTickBetween(e,n,(r,i)=>{this.callback(r,i)}))}getStateAtTime(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}i2.mixin(wP);class Px extends Jn{constructor(){const e=Gn(Px.getDefaults(),arguments,["delayTime","maxDelay"]);super(e),this.name="Delay";const n=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(n,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(n),this.delayTime=new Zr({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),Mi(this,"delayTime")}static getDefaults(){return Object.assign(Jn.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class Mh extends Jn{constructor(){const e=Gn(Mh.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new Jr({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,Mi(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(Jn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class t9 extends Jn{constructor(){const e=Gn(t9.getDefaults(),arguments);super(e),this.name="Destination",this.input=new Mh({context:this.context}),this.output=new Jr({context:this.context}),this.volume=this.input.volume,J1(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Jn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),J1(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}EP(t=>{t.destination=new t9({context:t})});SP(t=>{t.destination.dispose()});class qYe extends Jn{constructor(){super(...arguments),this.name="Listener",this.positionX=new Zr({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Zr({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Zr({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Zr({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Zr({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Zr({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Zr({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Zr({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Zr({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Jn.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}EP(t=>{t.listener=new qYe({context:t})});SP(t=>{t.listener.dispose()});function VYe(t,e){return jo(this,arguments,void 0,function*(n,r,i=2,s=sa().sampleRate){const o=sa(),a=new o2(i,r,s);NN(a),yield n(a);const c=a.render();NN(o);const l=yield c;return new ho(l)})}class n9 extends Gv{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=Gn(n9.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(n=>{this._loadingCount++;const r=e.urls[n];this.add(n,r,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Hs,onload:Hs,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return Lr(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,n])=>n.loaded)}add(e,n,r=Hs,i=Hs){return Iv(n)?(this.baseUrl&&n.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new ho(this.baseUrl+n,r,i))):this._buffers.set(e.toString(),new ho(n,r,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class PN extends jh{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return b1(super._frequencyToUnits(e))}_ticksToUnits(e){return b1(super._ticksToUnits(e))}_beatsToUnits(e){return b1(super._beatsToUnits(e))}_secondsToUnits(e){return b1(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return efe(this.toMidi())}transpose(e){return new PN(this.context,this.toMidi()+e)}}class vl extends GS{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class GYe extends cf{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new rm,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,n){return this._events.add({callback:e,time:this.toSeconds(n)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;this._events.forEachBefore(e+this.anticipation,n=>{e-n.time<=this.expiration&&n.callback(),this._events.remove(n)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}EP(t=>{t.draw=new GYe({context:t})});SP(t=>{t.draw.dispose()});class $Ye extends Gv{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){Lr(Ai(e.time),"Events must have a time property"),Lr(Ai(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let n=new WYe(e.time,e.time+e.duration,e);for(this._root===null?this._root=n:this._root.insert(n),this._length++;n!==null;)n.updateHeight(),n.updateMax(),this._rebalance(n),n=n.parent;return this}remove(e){if(this._root!==null){const n=[];this._root.search(e.time,n);for(const r of n)if(r.event===e){this._removeNode(r),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,n=>this.remove(n)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,n){e.parent!==null?(e.isLeftChild()?e.parent.left=n:e.parent.right=n,this._rebalance(e.parent)):this._setRoot(n)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const n=e.getBalance();let r,i=null;if(n>0)if(e.left.right===null)r=e.left,r.right=e.right,i=r;else{for(r=e.left.right;r.right!==null;)r=r.right;r.parent&&(r.parent.right=r.left,i=r.parent,r.left=e.left,r.right=e.right)}else if(e.right.left===null)r=e.right,r.left=e.left,i=r;else{for(r=e.right.left;r.left!==null;)r=r.left;r.parent&&(r.parent.left=r.right,i=r.parent,r.left=e.left,r.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=r:e.parent.right=r:this._setRoot(r),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const n=e.parent,r=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),n!==null?r?n.left=i:n.right=i:this._setRoot(i)}_rotateRight(e){const n=e.parent,r=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),n!==null?r?n.left=i:n.right=i:this._setRoot(i)}_rebalance(e){const n=e.getBalance();n>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):n<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const n=[];if(this._root.search(e,n),n.length>0){let r=n[0];for(let i=1;i<n.length;i++)n[i].low>r.low&&(r=n[i]);return r.event}}return null}forEach(e){if(this._root!==null){const n=[];this._root.traverse(r=>n.push(r)),n.forEach(r=>{r.event&&e(r.event)})}return this}forEachAtTime(e,n){if(this._root!==null){const r=[];this._root.search(e,r),r.forEach(i=>{i.event&&n(i.event)})}return this}forEachFrom(e,n){if(this._root!==null){const r=[];this._root.searchAfter(e,r),r.forEach(i=>{i.event&&n(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class WYe{constructor(e,n,r){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=r,this.low=e,this.high=n,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,n){e>this.max||(this.left!==null&&this.left.search(e,n),this.low<=e&&this.high>e&&n.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,n))}searchAfter(e,n){this.low>=e&&(n.push(this),this.left!==null&&this.left.searchAfter(e,n)),this.right!==null&&this.right.searchAfter(e,n)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class KYe extends Gv{constructor(e){super(),this.name="TimelineValue",this._timeline=new rm({memory:10}),this._initialValue=e}set(e,n){return this._timeline.add({value:e,time:n}),this}get(e){const n=this._timeline.get(e);return n?n.value:this._initialValue}}class Eg extends Jn{constructor(){super(Gn(Eg.getDefaults(),arguments,["context"]))}connect(e,n=0,r=0){return TP(this,e,n,r),this}}class yb extends Eg{constructor(){const e=Gn(yb.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,$h(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):vYe(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Yi.getDefaults(),{length:1024})}setMap(e,n=1024){const r=new Float32Array(n);for(let i=0,s=n;i<s;i++){const o=i/(s-1)*2-1;r[i]=e(o,i)}return this.curve=r,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const n=["none","2x","4x"].some(r=>r.includes(e));Lr(n,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class RP extends Eg{constructor(){const e=Gn(RP.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new yb({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Eg.getDefaults(),{value:1})}_expFunc(e){return n=>Math.pow(Math.abs(n),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class nb{constructor(e,n){this.id=nb._eventId++,this._remainderTime=0;const r=Object.assign(nb.getDefaults(),n);this.transport=e,this.callback=r.callback,this._once=r.once,this.time=Math.floor(r.time),this._remainderTime=r.time-this.time}static getDefaults(){return{callback:Hs,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const n=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*n),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}nb._eventId=0;class r9 extends nb{constructor(e,n){super(e,n),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const r=Object.assign(r9.getDefaults(),n);this.duration=r.duration,this._interval=r.interval,this._nextTick=r.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},nb.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return IN(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new vl(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){IN(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new vl(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const n=this.transport.getTicksAtTime(e);Ix(n,this.time)&&(this._nextTick=this.floatTime+Math.ceil((n-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class CP extends cf{constructor(){const e=Gn(CP.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new KYe(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new rm,this._repeatedEvents=new $Ye,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new wP({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),Mi(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(cf.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,n){if(this._loop.get(e)&&n>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),n=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&n%this._ppq!==0&&n%(this._swingTicks*2)!==0){const r=n%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(r*Math.PI)*this._swingAmount;e+=new vl(this.context,this._swingTicks*2/3).toSeconds()*i}IY(!0),this._timeline.forEachAtTime(n,r=>r.invoke(e)),IY(!1)}schedule(e,n){const r=new nb(this,{callback:e,time:new GS(this.context,n).toTicks()});return this._addEvent(r,this._timeline)}scheduleRepeat(e,n,r,i=1/0){const s=new r9(this,{callback:e,duration:new em(this.context,i).toTicks(),interval:new em(this.context,n).toTicks(),time:new GS(this.context,r).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(e,n){const r=new nb(this,{callback:e,once:!0,time:new GS(this.context,n).toTicks()});return this._addEvent(r,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const n=this._scheduledEvents[e.toString()];n.timeline.remove(n.event),n.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,n){return this._scheduledEvents[e.id.toString()]={event:e,timeline:n},n.add(e),e.id}cancel(e=0){const n=this.toTicks(e);return this._timeline.forEachFrom(n,r=>this.clear(r.id)),this._repeatedEvents.forEachFrom(n,r=>this.clear(r.id)),this}_bindClockEvents(){this._clock.on("start",(e,n)=>{n=new vl(this.context,n).toSeconds(),this.emit("start",e,n)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,n){this.context.resume();let r;return Ai(n)&&(r=this.toTicks(n)),this._clock.start(e,r),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){$h(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new em(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new em(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,n){return this.loopStart=e,this.loopEnd=n,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new vl(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),n=this._clock.getTicksAtTime(e);return new vl(this.context,n).toBarsBeatsSixteenths()}set position(e){const n=this.toTicks(e);this.ticks=n}get seconds(){return this._clock.seconds}set seconds(e){const n=this.now(),r=this._clock.frequency.timeToTicks(e,n);this.ticks=r}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const n=this.now();if(this.state==="started"){const r=this._clock.getTicksAtTime(n),i=this._clock.frequency.getDurationOfTicks(Math.ceil(r)-r,n),s=n+i;this.emit("stop",s),this._clock.setTicksAtTime(e,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this.emit("ticks",n),this._clock.setTicksAtTime(e,n)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const n=this.now(),r=this.getTicksAtTime(n),i=e-r%e;return this._clock.nextTickTime(i,n)}}syncSignal(e,n){const r=this.now();let i=this.bpm,s=1/(60/i.getValueAtTime(r)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/s,l=new Jr(c),u=new RP(-1),h=new Jr(c);i.chain(l,u,h),i=h,s=1/s,o=[l,u,h]}n||(e.getValueAtTime(r)!==0?n=e.getValueAtTime(r)/s:n=0);const a=new Jr(n);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let n=this._syncedSignals.length-1;n>=0;n--){const r=this._syncedSignals[n];r.signal===e&&(r.nodes.forEach(i=>i.dispose()),r.signal.value=r.initial,this._syncedSignals.splice(n,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),s2(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}i2.mixin(CP);EP(t=>{t.transport=new CP({context:t})});SP(t=>{t.transport.dispose()});class ru extends Jn{constructor(e){super(e),this.input=void 0,this._state=new a2("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Hs,this._syncedStop=Hs,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Mh({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,Mi(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(Jn.getDefaults(),{mute:!1,onstop:Hs,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,n,r){let i=Kd(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")Lr(Ix(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,n,r);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const s=this._state.get(i);s&&(s.offset=this.toSeconds(P0(n,0)),s.duration=r?this.toSeconds(r):void 0);const o=this.context.transport.schedule(a=>{this._start(a,n,r)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else Eue(this.context),this._start(i,n,r);return this}stop(e){let n=Kd(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(n=this._clampToCurrentTime(n),this._state.getValueAtTime(n)==="started"||Ai(this._state.getNextState("started",n))){if(this.log("stop",n),!this._synced)this._stop(n);else{const r=this.context.transport.schedule(this._stop.bind(this),n);this._scheduled.push(r)}this._state.cancel(n),this._state.setStateAtTime("stopped",n)}return this}restart(e,n,r){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,n,r)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,n)=>{if(Ix(n,0)){const r=this._state.get(n);if(r&&r.state==="started"&&r.time!==n){const i=n-this.toSeconds(r.time);let s;r.duration&&(s=this.toSeconds(r.duration)-i),this._start(e,this.toSeconds(r.offset)+i,s)}}},this._syncedStop=e=>{const n=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(n)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Hs,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class c2 extends Nx{constructor(){const e=Gn(c2.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,bg(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Zr({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new ho(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Nx.getDefaults(),{url:new ho,loop:!1,loopEnd:0,loopStart:0,onload:Hs,onerror:Hs,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,n,r,i=1){Lr(this.buffer.loaded,"buffer is either not set or not loaded");const s=this.toSeconds(e);this._startGain(s,i),this.loop?n=P0(n,this.loopStart):n=P0(n,0);let o=Math.max(this.toSeconds(n),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;dB(o,a)&&(o=(o-c)%l+c),cg(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,IN(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,o)),Ai(r)){let a=this.toSeconds(r);a=Math.max(a,0),this.stop(s+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Q1 extends ru{constructor(){const e=Gn(Q1.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(ru.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(Lr(e in PY,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const n=this.now();this._stop(n),this._start(n)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const n=PY[this._type];this._source=new c2({url:n,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(n.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const rS=44100*5,q4=2,W_={brown:null,pink:null,white:null},PY={get brown(){if(!W_.brown){const t=[];for(let e=0;e<q4;e++){const n=new Float32Array(rS);t[e]=n;let r=0;for(let i=0;i<rS;i++){const s=Math.random()*2-1;n[i]=(r+.02*s)/1.02,r=n[i],n[i]*=3.5}}W_.brown=new ho().fromArray(t)}return W_.brown},get pink(){if(!W_.pink){const t=[];for(let e=0;e<q4;e++){const n=new Float32Array(rS);t[e]=n;let r,i,s,o,a,c,l;r=i=s=o=a=c=l=0;for(let u=0;u<rS;u++){const h=Math.random()*2-1;r=.99886*r+h*.0555179,i=.99332*i+h*.0750759,s=.969*s+h*.153852,o=.8665*o+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,n[u]=r+i+s+o+a+c+l+h*.5362,n[u]*=.11,l=h*.115926}}W_.pink=new ho().fromArray(t)}return W_.pink},get white(){if(!W_.white){const t=[];for(let e=0;e<q4;e++){const n=new Float32Array(rS);t[e]=n;for(let r=0;r<rS;r++)n[r]=Math.random()*2-1}W_.white=new ho().fromArray(t)}return W_.white}};function SE(t,e){return jo(this,void 0,void 0,function*(){const n=e/t.context.sampleRate,r=new o2(1,n,t.context.sampleRate);return new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:r})).toDestination().start(0),(yield r.render()).getChannelData(0)})}class i9 extends Nx{constructor(){const e=Gn(i9.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],bg(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Zr({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Zr({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),Mi(this,["frequency","detune"])}static getDefaults(){return Object.assign(Nx.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const n=this.toSeconds(e);return this.log("start",n),this._startGain(n),this._oscillator.start(n),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Da extends ru{constructor(){const e=Gn(Da.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new Yi({context:this.context,units:"frequency",value:e.frequency}),Mi(this,"frequency"),this.detune=new Yi({context:this.context,units:"cents",value:e.detune}),Mi(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(ru.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const n=this.toSeconds(e),r=new i9({context:this.context,onended:()=>this.onstop(this)});this._oscillator=r,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(n)}_stop(e){const n=this.toSeconds(e);this._oscillator&&this._oscillator.stop(n)}_restart(e){const n=this.toSeconds(e);return this.log("restart",n),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(n),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Da._periodicWaveCache.find(n=>n.phase===this._phase&&IYe(n.partials,this._partials));{const e=Da._periodicWaveCache.find(n=>n.type===this._type&&n.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const n=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&n)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const r=this._getCachedPeriodicWave();if(Ai(r)){const{partials:i,wave:s}=r;this._wave=s,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,s]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,s);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Da._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),Da._periodicWaveCache.length>100&&Da._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Qp(e,0);let n=this._type;const r=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(r&&(n=r[1]),this._type!=="custom")e===0?this.type=n:this.type=n+e.toString();else{const i=new Float32Array(e);this._partials.forEach((s,o)=>i[o]=s),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,n){let i=2048;const s=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[s,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(s[c]=-u*Math.sin(n*c),o[c]=u*Math.cos(n*c)):(s[c]=0,o[c]=0)}return[s,o]}_inverseFFT(e,n,r){let i=0;const s=e.length;for(let o=0;o<s;o++)i+=e[o]*Math.cos(o*r)+n[o]*Math.sin(o*r);return i}getInitialValue(){const[e,n]=this._getRealImaginary(this._type,0);let r=0;const i=Math.PI*2,s=32;for(let o=0;o<s;o++)r=Math.max(this._inverseFFT(e,n,o/s*i),r);return PYe(-this._inverseFFT(e,n,this._phase)/r,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return jo(this,arguments,void 0,function*(e=1024){return SE(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Da._periodicWaveCache=[];class s9 extends Eg{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new yb({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class V0 extends Yi{constructor(){const e=Gn(V0.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new Jr({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Yi.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class AP extends ru{constructor(){const e=Gn(AP.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new s9({context:this.context}),this._modulationNode=new Jr({context:this.context}),this._carrier=new Da({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Da({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new V0({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Mi(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Da.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return jo(this,arguments,void 0,function*(e=1024){return SE(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class l2 extends ru{constructor(){const e=Gn(l2.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new Jr({context:this.context,gain:0}),this._carrier=new Da({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Yi({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Da({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new V0({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new V0({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Mi(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Da.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return jo(this,arguments,void 0,function*(e=1024){return SE(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class u2 extends ru{constructor(){const e=Gn(u2.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new Jr({context:this.context,gain:0}),this._thresh=new yb({context:this.context,mapping:n=>n<=0?-1:1}),this.width=new Yi({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Da({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Mi(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(ru.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return jo(this,arguments,void 0,function*(e=1024){return SE(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class MP extends ru{constructor(){const e=Gn(MP.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new Yi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Yi({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,Mi(this,["frequency","detune"])}static getDefaults(){return Object.assign(Da.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(n=>n.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(n=>n.stop(e))}_restart(e){this._forEach(n=>n.restart(e))}_forEach(e){for(let n=0;n<this._oscillators.length;n++)e(this._oscillators[n],n)}get type(){return this._type}set type(e){this._type=e,this._forEach(n=>n.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const n=-e/2,r=e/(this._oscillators.length-1);this._forEach((i,s)=>i.detune.value=n+r*s)}}get count(){return this._oscillators.length}set count(e){if(Qp(e,1),this._oscillators.length!==e){this._forEach(n=>n.dispose()),this._oscillators=[];for(let n=0;n<e;n++){const r=new Da({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+n/e*360,partialCount:this._partialCount,onstop:n===0?()=>this.onstop(this):Hs});this.type==="custom"&&(r.partials=this._partials),this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.detune.overridden=!1,r.connect(this.output),this._oscillators[n]=r}this.spread=this._spread,this.state==="started"&&this._forEach(n=>n.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((n,r)=>n.phase=this._phase+r/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(n=>n.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(n=>n.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(n=>n.partialCount=e),this._type=this._oscillators[0].type}asArray(){return jo(this,arguments,void 0,function*(e=1024){return SE(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class kP extends ru{constructor(){const e=Gn(kP.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new V0({context:this.context,value:2}),this._pulse=new u2({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Da({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Mi(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(ru.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return jo(this,arguments,void 0,function*(e=1024){return SE(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const DY={am:AP,fat:MP,fm:l2,oscillator:Da,pulse:u2,pwm:kP};class Dx extends ru{constructor(){const e=Gn(Dx.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new Yi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Yi({context:this.context,units:"cents",value:e.detune}),Mi(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Da.getDefaults(),l2.getDefaults(),AP.getDefaults(),MP.getDefaults(),u2.getDefaults(),kP.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(n=>this._sourceType===n)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const n=DY[e],r=this.now();if(this._oscillator){const i=this._oscillator;i.stop(r),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new n({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(r)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let n="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(n=this._oscillator.type),e==="fm"?this.type="fm"+n:e==="am"?this.type="am"+n:e==="fat"?this.type="fat"+n:e==="oscillator"?this.type=n:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,n){return e instanceof DY[n]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&yg(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&yg(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Iv(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return jo(this,arguments,void 0,function*(e=1024){return SE(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class o9 extends Yi{constructor(){super(Gn(o9.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new Jr({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,J1(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Yi.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class Lx extends Eg{constructor(){const e=Gn(Lx.getDefaults(),arguments,["min","max"]);super(e),this.name="Scale",this._mult=this.input=new V0({context:this.context,value:e.max-e.min}),this._add=this.output=new o9({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Eg.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class a9 extends Eg{constructor(){super(Gn(a9.getDefaults(),arguments)),this.name="Zero",this._gain=new Jr({context:this.context}),this.output=this._gain,this.input=void 0,bg(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),tfe(this.context.getConstant(0),this._gain),this}}class eE extends Jn{constructor(){const e=Gn(eE.getDefaults(),arguments,["frequency","min","max"]);super(e),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Zr.prototype._fromType,this._toType=Zr.prototype._toType,this._is=Zr.prototype._is,this._clampValue=Zr.prototype._clampValue,this._oscillator=new Da(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Jr({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Yi({context:this.context,units:"audioRange",value:0}),this._zeros=new a9({context:this.context}),this._a2g=new s9({context:this.context}),this._scaler=this.output=new Lx({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Mi(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(Da.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const n=this.min,r=this.max;this._units=e,this.min=n,this.max=r}get state(){return this._oscillator.state}connect(e,n,r){return(e instanceof Zr||e instanceof Yi)&&(this.convert=e.convert,this.units=e.units),TP(this,e,n,r),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function nfe(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Qp(s,t,e),n.set(this,s)}})}}function $v(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Qp(this.toSeconds(s),t,e),n.set(this,s)}})}}class f2 extends ru{constructor(){const e=Gn(f2.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new ho({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(ru.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Hs,onerror:Hs,playbackRate:1,reverse:!1})}load(e){return jo(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=Hs){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,n,r){return super.start(e,n,r),this}_start(e,n,r){this._loop?n=P0(n,this._loopStart):n=P0(n,0);const i=this.toSeconds(n),s=r;r=P0(r,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(r);o=o/this._playbackRate,e=this.toSeconds(e);const a=new c2({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&Kd(s)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const n=this.toSeconds(e);this._activeSources.forEach(r=>r.stop(n))}restart(e,n,r){return super.restart(e,n,r),this}_restart(e,n,r){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,n,r)}seek(e,n){const r=this.toSeconds(n);if(this._state.getValueAtTime(r)==="started"){const i=this.toSeconds(e);this._stop(r),this._start(r,i)}return this}setLoopPoints(e,n){return this.loopStart=e,this.loopEnd=n,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Qp(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Qp(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(n=>{n.loop=e}),e)){const n=this._state.getNextState("stopped",this.now());n&&this._state.cancel(n.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const n=this.now(),r=this._state.getNextState("stopped",n);r&&r.implicitEnd&&(this._state.cancel(r.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,n)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}_o([$v(0)],f2.prototype,"fadeIn",void 0);_o([$v(0)],f2.prototype,"fadeOut",void 0);class XYe extends Eg{constructor(){super(...arguments),this.name="Abs",this._abs=new yb({context:this.context,mapping:e=>Math.abs(e)<.001?0:Math.abs(e)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class YYe extends Eg{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new yb({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class c9 extends Lx{constructor(){const e=Gn(c9.getDefaults(),arguments,["min","max","exponent"]);super(e),this.name="ScaleExp",this.input=this._exp=new RP({context:this.context,value:e.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(Lx.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(e){this._exp.value=e}dispose(){return super.dispose(),this._exp.dispose(),this}}class Yd extends Jn{constructor(){const e=Gn(Yd.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new Yi({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(Jn.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,n){if(Iv(e))return e;{let r;for(r in zk)if(zk[r][n]===e)return r;return e}}_setCurve(e,n,r){if(Iv(r)&&Reflect.has(zk,r)){const i=zk[r];Hy(i)?e!=="_decayCurve"&&(this[e]=i[n]):this[e]=i}else if($h(r)&&e!=="_decayCurve")this[e]=r;else throw new Error("Envelope: invalid curve: "+r)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,n=1){this.log("triggerAttack",e,n),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(n,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(n,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(n,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,n)}if(s&&this.sustain<1){const a=n*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,s+c):this._sig.exponentialApproachValueAtTime(a,c,s)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const n=this.getValueAtTime(e);if(n>0){const r=this.toSeconds(this.release);r<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,r,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,r,e):(Lr($h(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,r,n))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,n,r=1){return n=this.toSeconds(n),this.triggerAttack(n,r),this.triggerRelease(n+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,n=0,r=0){return TP(this,e,n,r),this}asArray(){return jo(this,arguments,void 0,function*(e=1024){const n=e/this.context.sampleRate,r=new o2(1,n,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=i+this.toSeconds(this.release),o=s*.1,a=s+o,c=new this.constructor(Object.assign(this.get(),{attack:n*this.toSeconds(this.attack)/a,decay:n*this.toSeconds(this.decay)/a,release:n*this.toSeconds(this.release)/a,context:r}));return c._sig.toDestination(),c.triggerAttackRelease(n*(i+o)/a,0),(yield r.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}_o([$v(0)],Yd.prototype,"attack",void 0);_o([$v(0)],Yd.prototype,"decay",void 0);_o([nfe(0,1)],Yd.prototype,"sustain",void 0);_o([$v(0)],Yd.prototype,"release",void 0);const zk=(()=>{let e,n;const r=[];for(e=0;e<128;e++)r[e]=Math.sin(e/127*(Math.PI/2));const i=[],s=6.4;for(e=0;e<127;e++){n=e/127;const d=Math.sin(n*(Math.PI*2)*s-Math.PI/2)+1;i[e]=d/10+n*.83}i[127]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/127*a)/a;const c=[];for(e=0;e<128;e++)n=e/127,c[e]=.5*(1-Math.cos(Math.PI*n));const l=[];for(e=0;e<128;e++){n=e/127;const d=Math.pow(n,3)*4+.2,m=Math.cos(d*Math.PI*2*n);l[e]=Math.abs(m*(1-n))}function u(d){const m=new Array(d.length);for(let p=0;p<d.length;p++)m[p]=1-d[p];return m}function h(d){return d.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:r,Out:h(r)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class G0 extends Jn{constructor(){const e=Gn(G0.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=n=>this._original_triggerRelease(n),this._volume=this.output=new Mh({context:this.context,volume:e.volume}),this.volume=this._volume.volume,Mi(this,"volume")}static getDefaults(){return Object.assign(Jn.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,n){const r=this["_original_"+e]=this[e];this[e]=(...i)=>{const s=i[n],o=this.context.transport.schedule(a=>{i[n]=a,r.apply(this,i)},s);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,n,r,i){const s=this.toSeconds(r),o=this.toSeconds(n);return this.triggerAttack(e,s,i),this.triggerRelease(s+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Sg extends G0{constructor(){const e=Gn(Sg.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(G0.getDefaults(),{detune:0,onsilence:Hs,portamento:0})}triggerAttack(e,n,r=1){this.log("triggerAttack",e,n,r);const i=this.toSeconds(n);return this._triggerEnvelopeAttack(i,r),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const n=this.toSeconds(e);return this._triggerEnvelopeRelease(n),this}setNote(e,n){const r=this.toSeconds(n),i=e instanceof jh?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(r)>.05){const s=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,s,r)}else this.frequency.setValueAtTime(i,r);return this}}_o([$v(0)],Sg.prototype,"portamento",void 0);class OP extends Yd{constructor(){super(Gn(OP.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Jr({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class ef extends Sg{constructor(){const e=Gn(ef.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new Dx(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new OP(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),Mi(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Sg.getDefaults(),{envelope:Object.assign(M0(Yd.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(M0(Dx.getDefaults(),[...Object.keys(ru.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,n){if(this.envelope.triggerAttack(e,n),this.oscillator.start(e),this.envelope.sustain===0){const r=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+r+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class DN extends Sg{constructor(){const e=Gn(DN.getDefaults(),arguments);super(e),this.name="ModulationSynth",this._carrier=new ef({context:this.context,oscillator:e.oscillator,envelope:e.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new ef({context:this.context,oscillator:e.modulation,envelope:e.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new Yi({context:this.context,units:"frequency"}),this.detune=new Yi({context:this.context,value:e.detune,units:"cents"}),this.harmonicity=new V0({context:this.context,value:e.harmonicity,minValue:0}),this._modulationNode=new Jr({context:this.context,gain:0}),Mi(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(Sg.getDefaults(),{harmonicity:3,oscillator:Object.assign(M0(Dx.getDefaults(),[...Object.keys(ru.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(M0(Yd.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(M0(Dx.getDefaults(),[...Object.keys(ru.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(M0(Yd.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(e,n){this._carrier._triggerEnvelopeAttack(e,n),this._modulator._triggerEnvelopeAttack(e,n)}_triggerEnvelopeRelease(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class Ux extends Jn{constructor(){const e=Gn(Ux.getDefaults(),arguments,["frequency","type"]);super(e),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Zr({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new Zr({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new Zr({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new Zr({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(Jn.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){Lr(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const n=new Float32Array(e);for(let o=0;o<e;o++){const c=Math.pow(o/e,2)*19980+20;n[o]=c}const r=new Float32Array(e),i=new Float32Array(e),s=this.context.createBiquadFilter();return s.type=this.type,s.Q.value=this.Q.value,s.frequency.value=this.frequency.value,s.gain.value=this.gain.value,s.getFrequencyResponse(n,r,i),r}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Au extends Jn{constructor(){const e=Gn(Au.getDefaults(),arguments,["frequency","type","rolloff"]);super(e),this.name="Filter",this.input=new Jr({context:this.context}),this.output=new Jr({context:this.context}),this._filters=[],this._filters=[],this.Q=new Yi({context:this.context,units:"positive",value:e.Q}),this.frequency=new Yi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Yi({context:this.context,units:"cents",value:e.detune}),this.gain=new Yi({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,Mi(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(Jn.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){Lr(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(r=>r.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const n=yg(e)?e:parseInt(e,10),r=[-12,-24,-48,-96];let i=r.indexOf(n);Lr(i!==-1,`rolloff can only be ${r.join(", ")}`),i+=1,this._rolloff=n,this.input.disconnect(),this._filters.forEach(s=>s.disconnect()),this._filters=new Array(i);for(let s=0;s<i;s++){const o=new Ux({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[s]=o}this._internalChannels=this._filters,J1(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const n=new Ux({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),r=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{n.getFrequencyResponse(e).forEach((s,o)=>r[o]*=s)}),n.dispose(),r}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),s2(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class l9 extends DN{constructor(){const e=Gn(l9.getDefaults(),arguments);super(e),this.name="FMSynth",this.modulationIndex=new V0({context:this.context,value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(DN.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const LY=[1,1.483,1.932,2.546,2.63,3.897];class u9 extends Sg{constructor(){const e=Gn(u9.getDefaults(),arguments);super(e),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[],this.detune=new Yi({context:this.context,units:"cents",value:e.detune}),this.frequency=new Yi({context:this.context,units:"frequency"}),this._amplitude=new Jr({context:this.context,gain:0}).connect(this.output),this._highpass=new Au({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let n=0;n<LY.length;n++){const r=new l2({context:this.context,harmonicity:e.harmonicity,modulationIndex:e.modulationIndex,modulationType:"square",onstop:n===0?()=>this.onsilence(this):Hs,type:"square"});r.connect(this._highpass),this._oscillators[n]=r;const i=new V0({context:this.context,value:LY[n]});this._freqMultipliers[n]=i,this.frequency.chain(i,r.frequency),this.detune.connect(r.detune)}this._filterFreqScaler=new Lx({context:this.context,max:7e3,min:this.toFrequency(e.resonance)}),this.envelope=new Yd({attack:e.envelope.attack,attackCurve:"linear",context:this.context,decay:e.envelope.decay,release:e.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=e.octaves,this.octaves=e.octaves}static getDefaults(){return Vy(Sg.getDefaults(),{envelope:Object.assign(M0(Yd.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(e,n=1){return this.envelope.triggerAttack(e,n),this._oscillators.forEach(r=>r.start(e)),this.envelope.sustain===0&&this._oscillators.forEach(r=>{r.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(e){return this.envelope.triggerRelease(e),this._oscillators.forEach(n=>n.stop(e+this.toSeconds(this.envelope.release))),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(e){this._oscillators.forEach(n=>n.modulationIndex.value=e)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(e){this._oscillators.forEach(n=>n.harmonicity.value=e)}get resonance(){return this._filterFreqScaler.min}set resonance(e){this._filterFreqScaler.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,e)}dispose(){return super.dispose(),this._oscillators.forEach(e=>e.dispose()),this._freqMultipliers.forEach(e=>e.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class uT extends ef{constructor(){const e=Gn(uT.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,Mi(this,["oscillator","envelope"])}static getDefaults(){return Vy(Sg.getDefaults(),ef.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,n){const r=this.toSeconds(n),i=this.toFrequency(e instanceof jh?e.toFrequency():e),s=i*this.octaves;return this.oscillator.frequency.setValueAtTime(s,r),this.oscillator.frequency.exponentialRampToValueAtTime(i,r+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}_o([nfe(0)],uT.prototype,"octaves",void 0);_o([$v(0)],uT.prototype,"pitchDecay",void 0);class Cy extends G0{constructor(){const e=Gn(Cy.getDefaults(),arguments);super(e),this.name="NoiseSynth",this.noise=new Q1(Object.assign({context:this.context},e.noise)),this.envelope=new OP(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(G0.getDefaults(),{envelope:Object.assign(M0(Yd.getDefaults(),Object.keys(Jn.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(M0(Q1.getDefaults(),Object.keys(ru.getDefaults())),{type:"white"})})}triggerAttack(e,n=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,n),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,n,r=1){return n=this.toSeconds(n),e=this.toSeconds(e),this.triggerAttack(n,r),this.triggerRelease(n+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const rfe=new Set;function f9(t){rfe.add(t)}function ife(t,e){const n=`registerProcessor("${t}", ${e})`;rfe.add(n)}const ZYe=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;f9(ZYe);const JYe=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;f9(JYe);const QYe=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;f9(QYe);const eZe="feedback-comb-filter",tZe=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;ife(eZe,tZe);class h9 extends Jn{constructor(){const e=Gn(h9.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OnePoleFilter",this._frequency=e.frequency,this._type=e.type,this.input=new Jr({context:this.context}),this.output=new Jr({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(Jn.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const e=this._filter,n=this.toFrequency(this._frequency),r=1/(2*Math.PI*n);if(this._type==="lowpass"){const i=1/(r*this.context.sampleRate),s=i-1;this._filter=this.context.createIIRFilter([i,0],[1,s])}else{const i=1/(r*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,i])}this.input.chain(this._filter,this.output),e&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(e),e.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(e){this._frequency=e,this._createFilter()}get type(){return this._type}set type(e){this._type=e,this._createFilter()}getFrequencyResponse(e=128){const n=new Float32Array(e);for(let s=0;s<e;s++){const a=Math.pow(s/e,2)*19980+20;n[s]=a}const r=new Float32Array(e),i=new Float32Array(e);return this._filter.getFrequencyResponse(n,r,i),r}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class d9 extends G0{constructor(){const e=Gn(d9.getDefaults(),arguments,["voice","options"]);super(e),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=i=>this.releaseAll(i),Lr(!yg(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const n=e.voice.getDefaults();this.options=Object.assign(n,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const r=this._voices.indexOf(this._dummyVoice);this._voices.splice(r,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(G0.getDefaults(),{maxPolyphony:32,options:{},voice:ef})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const n=this._activeVoices.findIndex(r=>r.voice===e);this._activeVoices.splice(n,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return Lr(e instanceof Sg,"Voice must extend Monophonic class"),e.connect(this.output),this._voices.push(e),e}else vP("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),n=this._voices.indexOf(e);this._voices.splice(n,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,n,r){e.forEach(i=>{const s=new PN(this.context,i).toMidi(),o=this._getNextAvailableVoice();o&&(o.triggerAttack(i,n,r),this._activeVoices.push({midi:s,voice:o,released:!1}),this.log("triggerAttack",i,n))})}_triggerRelease(e,n){e.forEach(r=>{const i=new PN(this.context,r).toMidi(),s=this._activeVoices.find(({midi:o,released:a})=>o===i&&!a);s&&(s.voice.triggerRelease(n),s.released=!0,this.log("triggerRelease",r,n))})}_scheduleEvent(e,n,r,i){Lr(!this.disposed,"Synth was already disposed"),r<=this.now()?e==="attack"?this._triggerAttack(n,r,i):this._triggerRelease(n,r):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(e,n,r,i)},r-this.now())}triggerAttack(e,n,r){Array.isArray(e)||(e=[e]);const i=this.toSeconds(n);return this._scheduleEvent("attack",e,i,r),this}triggerRelease(e,n){Array.isArray(e)||(e=[e]);const r=this.toSeconds(n);return this._scheduleEvent("release",e,r),this}triggerAttackRelease(e,n,r,i){const s=this.toSeconds(r);if(this.triggerAttack(e,s,i),$h(n)){Lr($h(e),"If the duration is an array, the notes must also be an array"),e=e;for(let o=0;o<e.length;o++){const a=n[Math.min(o,n.length-1)],c=this.toSeconds(a);Lr(c>0,"The duration must be greater than 0"),this.triggerRelease(e[o],s+c)}}else{const o=this.toSeconds(n);Lr(o>0,"The duration must be greater than 0"),this.triggerRelease(e,s+o)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(e){const n=M0(e,["onsilence","context"]);return this.options=Vy(this.options,n),this._voices.forEach(r=>r.set(n)),this._dummyVoice.set(n),this}get(){return this._dummyVoice.get()}releaseAll(e){const n=this.toSeconds(e);return this._activeVoices.forEach(({voice:r})=>{r.triggerRelease(n)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class h2 extends G0{constructor(){const e=Gn(h2.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const n={};Object.keys(e.urls).forEach(r=>{const i=parseInt(r,10);if(Lr(jk(r)||yg(i)&&isFinite(i),`url key is neither a note or midi pitch: ${r}`),jk(r)){const s=new jh(this.context,r).toMidi();n[s]=e.urls[r]}else yg(i)&&isFinite(i)&&(n[i]=e.urls[i])}),this._buffers=new n9({urls:n,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(G0.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Hs,onerror:Hs,release:.1,urls:{}})}_findClosest(e){let r=0;for(;r<96;){if(this._buffers.has(e+r))return-r;if(this._buffers.has(e-r))return r;r++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,n,r=1){return this.log("triggerAttack",e,n,r),Array.isArray(e)||(e=[e]),e.forEach(i=>{const s=Que(new jh(this.context,i).toFrequency()),o=Math.round(s),a=s-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=Jue(c+a),d=new c2({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(n,0,u.duration/h,r),$h(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const m=this._activeSources.get(o),p=m.indexOf(d);p!==-1&&m.splice(p,1)}}}),this}triggerRelease(e,n){return this.log("triggerRelease",e,n),Array.isArray(e)||(e=[e]),e.forEach(r=>{const i=new jh(this.context,r).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const s=this._activeSources.get(i);n=this.toSeconds(n),s.forEach(o=>{o.stop(n)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const n=this.toSeconds(e);return this._activeSources.forEach(r=>{for(;r.length;)r.shift().stop(n)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,n,r,i=1){const s=this.toSeconds(r);return this.triggerAttack(e,s,i),$h(n)?(Lr($h(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=n[Math.min(a,n.length-1)];this.triggerRelease(o,s+this.toSeconds(c))})):this.triggerRelease(e,s+this.toSeconds(n)),this}add(e,n,r){if(Lr(jk(e)||isFinite(e),`note must be a pitch or midi: ${e}`),jk(e)){const i=new jh(this.context,e).toMidi();this._buffers.add(i,n,r)}else this._buffers.add(e,n,r);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(n=>n.dispose())}),this._activeSources.clear(),this}}_o([$v(0)],h2.prototype,"attack",void 0);_o([$v(0)],h2.prototype,"release",void 0);class IS extends cf{constructor(){const e=Gn(IS.getDefaults(),arguments,["callback","value"]);super(e),this.name="ToneEvent",this._state=new a2("stopped"),this._startOffset=0,this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this._playbackRate=e.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(cf.getDefaults(),{callback:Hs,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(e=-1){this._state.forEachFrom(e,n=>{let r;if(n.state==="started"){n.id!==-1&&this.context.transport.clear(n.id);const i=n.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||yg(this._loop)&&this._loop>1){r=1/0,yg(this._loop)&&(r=this._loop*this._getLoopDuration());const s=this._state.getAfter(i);s!==null&&(r=Math.min(r,s.time-i)),r!==1/0&&(r=new vl(this.context,r));const o=new vl(this.context,this._getLoopDuration());n.id=this.context.transport.scheduleRepeat(this._tick.bind(this),o,new vl(this.context,i),r)}else n.id=this.context.transport.schedule(this._tick.bind(this),new vl(this.context,i))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e}get probability(){return this._probability}set probability(e){this._probability=e}get humanize(){return this._humanize}set humanize(e){this._humanize=e}start(e){const n=this.toTicks(e);return this._state.getValueAtTime(n)==="stopped"&&(this._state.add({id:-1,state:"started",time:n}),this._rescheduleEvents(n)),this}stop(e){this.cancel(e);const n=this.toTicks(e);if(this._state.getValueAtTime(n)==="started"){this._state.setStateAtTime("stopped",n,{id:-1});const r=this._state.getBefore(n);let i=n;r!==null&&(i=r.time),this._rescheduleEvents(i)}return this}cancel(e){e=P0(e,-1/0);const n=this.toTicks(e);return this._state.forEachFrom(n,r=>{this.context.transport.clear(r.id)}),this._state.cancel(n),this}_tick(e){const n=this.context.transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(n)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let r=.02;bue(this.humanize)||(r=this.toSeconds(this.humanize)),e+=(Math.random()*2-1)*r}this.callback(e,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(e){this._loop=e,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._rescheduleEvents()}get loopEnd(){return new vl(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}get loopStart(){return new vl(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const e=this.context.transport.ticks,n=this._state.get(e);if(n!==null&&n.state==="started"){const r=this._getLoopDuration();return(e-n.time)%r/r}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class lM extends IS{constructor(){const e=Gn(lM.getDefaults(),arguments,["callback","events"]);super(e),this.name="Part",this._state=new a2("stopped"),this._events=new Set,this._state.increasing=!0,e.events.forEach(n=>{$h(n)?this.add(n[0],n[1]):this.add(n)})}static getDefaults(){return Object.assign(IS.getDefaults(),{events:[]})}start(e,n){const r=this.toTicks(e);if(this._state.getValueAtTime(r)!=="started"){n=P0(n,this._loop?this._loopStart:0),this._loop?n=P0(n,this._loopStart):n=P0(n,0);const i=this.toTicks(n);this._state.add({id:-1,offset:i,state:"started",time:r}),this._forEach(s=>{this._startNote(s,r,i)})}return this}_startNote(e,n,r){n-=r,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<r&&(n+=this._getLoopDuration()),e.start(new vl(this.context,n))):e.startOffset<this._loopStart&&e.startOffset>=r&&(e.loop=!1,e.start(new vl(this.context,n))):e.startOffset>=r&&e.start(new vl(this.context,n))}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e,this._forEach(n=>{n.startOffset+=this._startOffset})}stop(e){const n=this.toTicks(e);return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._forEach(r=>{r.stop(e)}),this}at(e,n){const r=new GS(this.context,e).toTicks(),i=new vl(this.context,1).toSeconds(),s=this._events.values();let o=s.next();for(;!o.done;){const a=o.value;if(Math.abs(r-a.startOffset)<i)return Ai(n)&&(a.value=n),a;o=s.next()}return Ai(n)?(this.add(e,n),this.at(e)):null}add(e,n){e instanceof Object&&Reflect.has(e,"time")&&(n=e,e=n.time);const r=this.toTicks(e);let i;return n instanceof IS?(i=n,i.callback=this._tick.bind(this)):i=new IS({callback:this._tick.bind(this),context:this.context,value:n}),i.startOffset=r,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(e){this._state.forEach(n=>{n.state==="started"?this._startNote(e,n.time,n.offset):e.stop(new vl(this.context,n.time))})}remove(e,n){return Hy(e)&&e.hasOwnProperty("time")&&(n=e,e=n.time),e=this.toTicks(e),this._events.forEach(r=>{r.startOffset===e&&(Kd(n)||Ai(n)&&r.value===n)&&(this._events.delete(r),r.dispose())}),this}clear(){return this._forEach(e=>e.dispose()),this._events.clear(),this}cancel(e){return this._forEach(n=>n.cancel(e)),this._state.cancel(this.toTicks(e)),this}_forEach(e){return this._events&&this._events.forEach(n=>{n instanceof lM?n._forEach(e):e(n)}),this}_setAll(e,n){this._forEach(r=>{r[e]=n})}_tick(e,n){this.mute||this.callback(e,n)}_testLoopBoundries(e){this._loop&&(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd)?e.cancel(0):e.state==="stopped"&&this._restartEvent(e)}get probability(){return this._probability}set probability(e){this._probability=e,this._setAll("probability",e)}get humanize(){return this._humanize}set humanize(e){this._humanize=e,this._setAll("humanize",e)}get loop(){return this._loop}set loop(e){this._loop=e,this._forEach(n=>{n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.loop=e,this._testLoopBoundries(n)})}get loopEnd(){return new vl(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._forEach(n=>{n.loopEnd=e,this._testLoopBoundries(n)})}get loopStart(){return new vl(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._forEach(n=>{n.loopStart=this.loopStart,this._testLoopBoundries(n)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._setAll("playbackRate",e)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}class IP extends Jn{constructor(){const e=Gn(IP.getDefaults(),arguments,["fade"]);super(e),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new YYe({context:this.context}),this.a=new Jr({context:this.context,gain:0}),this.b=new Jr({context:this.context,gain:0}),this.output=new Jr({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new Yi({context:this.context,units:"normalRange",value:e.fade}),Mi(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",bg(this._split,this.a.gain,0),bg(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(Jn.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}let nd=class extends Jn{constructor(e){super(e),this.name="Effect",this._dryWet=new IP({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Jr({context:this.context}),this.effectReturn=new Jr({context:this.context}),this.input=new Jr({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Mi(this,"wet")}static getDefaults(){return Object.assign(Jn.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}};class p9 extends Jn{constructor(){const e=Gn(p9.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new Zr({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",Mi(this,"pan")}static getDefaults(){return Object.assign(Jn.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class m9 extends Jn{constructor(){const e=Gn(m9.getDefaults(),arguments,["smoothing"]);super(e),this.name="Follower",this._abs=this.input=new XYe({context:this.context}),this._lowpass=this.output=new h9({context:this.context,frequency:1/this.toSeconds(e.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=e.smoothing}static getDefaults(){return Object.assign(Jn.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(e){this._smoothing=e,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class g9 extends nd{constructor(){const e=Gn(g9.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);super(e),this.name="AutoWah",this._follower=new m9({context:this.context,smoothing:e.follower}),this._sweepRange=new c9({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this._inputBoost=new Jr({context:this.context}),this._bandpass=new Au({context:this.context,rolloff:-48,frequency:0,Q:e.Q}),this._peaking=new Au({context:this.context,type:"peaking"}),this._peaking.gain.value=e.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=e.sensitivity,Mi(this,["gain","Q"])}static getDefaults(){return Object.assign(nd.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(e){this._follower.smoothing=e}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){this._baseFrequency=this.toFrequency(e),this._setSweepRange()}get sensitivity(){return Zue(1/this._inputBoost.gain.value)}set sensitivity(e){this._inputBoost.gain.value=1/Yue(e)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}const nZe="bit-crusher",rZe=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;ife(nZe,rZe);class NP extends Jn{constructor(){const e=Gn(NP.getDefaults(),arguments,["channels"]);super(e),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(e.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(Jn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class d2 extends Jn{constructor(){const e=Gn(d2.getDefaults(),arguments,["channels"]);super(e),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(Jn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class LN extends Jn{constructor(e){super(e),this.name="StereoEffect",this.input=new Jr({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new IP({context:this.context,fade:e.wet}),this.wet=this._dryWet.fade,this._split=new NP({context:this.context,channels:2}),this._merge=new d2({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),Mi(this,["wet"])}connectEffectLeft(...e){this._split.connect(e[0],0,0),J1(...e),bg(e[e.length-1],this._merge,0,0)}connectEffectRight(...e){this._split.connect(e[0],1,0),J1(...e),bg(e[e.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(Jn.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class UY extends LN{constructor(e){super(e),this.feedback=new Yi({context:this.context,value:e.feedback,units:"normalRange"}),this._feedbackL=new Jr({context:this.context}),this._feedbackR=new Jr({context:this.context}),this._feedbackSplit=new NP({context:this.context,channels:2}),this._feedbackMerge=new d2({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),Mi(this,["feedback"])}static getDefaults(){return Object.assign(LN.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class _9 extends UY{constructor(){const e=Gn(_9.getDefaults(),arguments,["frequency","delayTime","depth"]);super(e),this.name="Chorus",this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new eE({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new eE({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Px({context:this.context}),this._delayNodeR=new Px({context:this.context}),this.frequency=this._lfoL.frequency,Mi(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=e.type,this.spread=e.spread}static getDefaults(){return Object.assign(UY.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(e){this._depth=e;const n=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-n,0),this._lfoL.max=this._delayTime+n,this._lfoR.min=Math.max(this._delayTime-n,0),this._lfoR.max=this._delayTime+n}get delayTime(){return this._delayTime*1e3}set delayTime(e){this._delayTime=e/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(e){this._lfoL.type=e,this._lfoR.type=e}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}start(e){return this._lfoL.start(e),this._lfoR.start(e),this}stop(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class uM extends nd{constructor(){const e=Gn(uM.getDefaults(),arguments,["distortion"]);super(e),this.name="Distortion",this._shaper=new yb({context:this.context,length:4096}),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample}static getDefaults(){return Object.assign(nd.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(e){this._distortion=e;const n=e*100,r=Math.PI/180;this._shaper.setMap(i=>Math.abs(i)<.001?0:(3+n)*i*20*r/(Math.PI+n*Math.abs(i)))}get oversample(){return this._shaper.oversample}set oversample(e){this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.dispose(),this}}class BY extends nd{constructor(e){super(e),this.name="FeedbackEffect",this._feedbackGain=new Jr({context:this.context,gain:e.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Mi(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(nd.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class v9 extends BY{constructor(){const e=Gn(v9.getDefaults(),arguments,["delayTime","feedback"]);super(e),this.name="FeedbackDelay",this._delayNode=new Px({context:this.context,delayTime:e.delayTime,maxDelay:e.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Mi(this,"delayTime")}static getDefaults(){return Object.assign(BY.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class y9 extends LN{constructor(){const e=Gn(y9.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);super(e),this.name="Phaser",this._lfoL=new eE({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new eE({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this.Q=new Yi({context:this.context,value:e.Q,units:"positive"}),this._filtersL=this._makeFilters(e.stages,this._lfoL),this._filtersR=this._makeFilters(e.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=e.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=e.baseFrequency,this.octaves=e.octaves,this._lfoL.start(),this._lfoR.start(),Mi(this,["frequency","Q"])}static getDefaults(){return Object.assign(LN.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(e,n){const r=[];for(let i=0;i<e;i++){const s=this.context.createBiquadFilter();s.type="allpass",this.Q.connect(s.Q),n.connect(s.frequency),r.push(s)}return r}get octaves(){return this._octaves}set octaves(e){this._octaves=e;const n=this._baseFrequency*Math.pow(2,e);this._lfoL.max=n,this._lfoR.max=n}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){this._baseFrequency=this.toFrequency(e),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(e=>e.disconnect()),this._filtersR.forEach(e=>e.disconnect()),this.frequency.dispose(),this}}class b9 extends nd{constructor(){const e=Gn(b9.getDefaults(),arguments,["decay"]);super(e),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const n=this.toSeconds(e.decay);Qp(n,.001),this._decay=n;const r=this.toSeconds(e.preDelay);Qp(r,0),this._preDelay=r,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(nd.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),Qp(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),Qp(e,0),this._preDelay=e,this.generate()}generate(){return jo(this,void 0,void 0,function*(){const e=this.ready,n=new o2(2,this._decay+this._preDelay,this.context.sampleRate),r=new Q1({context:n}),i=new Q1({context:n}),s=new d2({context:n});r.connect(s,0,0),i.connect(s,0,1);const o=new Jr({context:n}).toDestination();s.connect(o),r.start(0),i.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=n.render();return this.ready=a.then(Hs),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class PP extends nd{constructor(){const e=Gn(PP.getDefaults(),arguments,["frequency","depth"]);super(e),this.name="Vibrato",this._delayNode=new Px({context:this.context,delayTime:0,maxDelay:e.maxDelay}),this._lfo=new eE({context:this.context,type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,Mi(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(nd.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Vc extends Jn{constructor(){const e=Gn(Vc.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new Jr({context:this.context}),Vc._allSolos.has(this.context)||Vc._allSolos.set(this.context,new Set),Vc._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(Jn.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Vc._allSolos.get(this.context).forEach(n=>n._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Vc._soloed.has(this.context)||Vc._soloed.set(this.context,new Set),Vc._soloed.get(this.context).add(this)}_removeSolo(){Vc._soloed.has(this.context)&&Vc._soloed.get(this.context).delete(this)}_isSoloed(){return Vc._soloed.has(this.context)&&Vc._soloed.get(this.context).has(this)}_noSolos(){return!Vc._soloed.has(this.context)||Vc._soloed.has(this.context)&&Vc._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Vc._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Vc._allSolos=new Map;Vc._soloed=new Map;class E9 extends Jn{constructor(){const e=Gn(E9.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new p9({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Mh({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,Mi(this,["pan","volume"])}static getDefaults(){return Object.assign(Jn.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class kh extends Jn{constructor(){const e=Gn(kh.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new Vc({solo:e.solo,context:this.context}),this._panVol=this.output=new E9({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Mi(this,["pan","volume"])}static getDefaults(){return Object.assign(Jn.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return kh.buses.has(e)||kh.buses.set(e,new Jr({context:this.context})),kh.buses.get(e)}send(e,n=0){const r=this._getBus(e),i=new Jr({context:this.context,units:"decibels",gain:n});return this.connect(i),i.connect(r),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}kh.buses=new Map;class S9 extends Jn{constructor(){const e=Gn(S9.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(e),this.name="MultibandSplit",this.input=new Jr({context:this.context}),this.output=void 0,this.low=new Au({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Au({context:this.context,frequency:0,type:"highpass"}),this.mid=new Au({context:this.context,frequency:0,type:"lowpass"}),this.high=new Au({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new Yi({context:this.context,units:"frequency",value:e.lowFrequency}),this.highFrequency=new Yi({context:this.context,units:"frequency",value:e.highFrequency}),this.Q=new Yi({context:this.context,units:"positive",value:e.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),Mi(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(Jn.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),s2(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class x9 extends Jn{constructor(){const e=Gn(x9.getDefaults(),arguments,["threshold","ratio"]);super(e),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new Zr({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new Zr({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new Zr({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new Zr({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new Zr({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),Mi(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(Jn.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class uA extends Jn{constructor(){const e=Gn(uA.getDefaults(),arguments,["low","mid","high"]);super(e),this.name="EQ3",this.output=new Jr({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new S9({context:this.context,highFrequency:e.highFrequency,lowFrequency:e.lowFrequency}),this._lowGain=new Jr({context:this.context,gain:e.low,units:"decibels"}),this._midGain=new Jr({context:this.context,gain:e.mid,units:"decibels"}),this._highGain=new Jr({context:this.context,gain:e.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),Mi(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(Jn.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),s2(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}sa().transport;function pB(){return sa().transport}sa().destination;sa().destination;function iZe(){return sa().destination}sa().listener;sa().draw;function sZe(){return sa().draw}sa();function sfe(t){return t!==null&&typeof t=="object"&&"name"in t&&typeof t.name=="string"}function ofe(t){return t!==null&&typeof t=="object"&&"step"in t&&typeof t.step=="number"&&"alt"in t&&typeof t.alt=="number"&&!isNaN(t.step)&&!isNaN(t.alt)}var afe=[0,2,4,-1,1,3,5],cfe=afe.map(t=>Math.floor(t*7/12));function lfe(t){const{step:e,alt:n,oct:r,dir:i=1}=t,s=afe[e]+7*n;if(r===void 0)return[i*s];const o=r-cfe[e]-4*n;return[i*s,i*o]}var oZe=[3,0,4,1,5,2,6];function aZe(t){const[e,n,r]=t,i=oZe[cZe(e)],s=Math.floor((e+1)/7);if(n===void 0)return{step:i,alt:s,dir:r};const o=n+4*s+cfe[i];return{step:i,alt:s,oct:o,dir:r}}function cZe(t){const e=(t+1)%7;return e<0?7+e:e}var FY=(t,e)=>Array(Math.abs(e)+1).join(t),mB=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),lZe="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",uZe="(AA|A|P|M|m|d|dd)([-+]?\\d+)",fZe=new RegExp("^"+lZe+"|"+uZe+"$");function hZe(t){const e=fZe.exec(`${t}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var jY={};function UN(t){return typeof t=="string"?jY[t]||(jY[t]=dZe(t)):ofe(t)?UN(mZe(t)):sfe(t)?UN(t.name):mB}var zY=[0,2,4,5,7,9,11],ufe="PMMPPMM";function dZe(t){const e=hZe(t);if(e[0]==="")return mB;const n=+e[0],r=e[1],i=(Math.abs(n)-1)%7,s=ufe[i];if(s==="M"&&r==="P")return mB;const o=s==="M"?"majorable":"perfectable",a=""+n+r,c=n<0?-1:1,l=n===8||n===-8?n:c*(i+1),u=pZe(o,r),h=Math.floor((Math.abs(n)-1)/7),d=c*(zY[i]+u+12*h),m=(c*(zY[i]+u)%12+12)%12,p=lfe({step:i,alt:u,oct:h,dir:c});return{empty:!1,name:a,num:n,q:r,step:i,alt:u,dir:c,type:o,simple:l,semitones:d,chroma:m,coord:p,oct:h}}function pZe(t,e){return e==="M"&&t==="majorable"||e==="P"&&t==="perfectable"?0:e==="m"&&t==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(t==="perfectable"?e.length:e.length+1):0}function mZe(t){const{step:e,alt:n,oct:r=0,dir:i}=t;if(!i)return"";const s=e+1+7*r,o=s===0?e+1:s,a=i<0?"-":"",c=ufe[e]==="M"?"majorable":"perfectable";return a+o+gZe(c,n)}function gZe(t,e){return e===0?t==="majorable"?"M":"P":e===-1&&t==="majorable"?"m":e>0?FY("A",e):FY("d",t==="perfectable"?e:e+1)}var HY=(t,e)=>Array(Math.abs(e)+1).join(t),ffe=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),qY=new Map,_Ze=t=>"CDEFGAB".charAt(t),vZe=t=>t<0?HY("b",-t):HY("#",t),yZe=t=>t[0]==="b"?-t.length:t.length;function fM(t){const e=JSON.stringify(t),n=qY.get(e);if(n)return n;const r=typeof t=="string"?TZe(t):ofe(t)?fM(wZe(t)):sfe(t)?fM(t.name):ffe;return qY.set(e,r),r}var bZe=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function EZe(t){const e=bZe.exec(t);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function SZe(t){return fM(aZe(t))}var xZe=(t,e)=>(t%e+e)%e,V4=[0,2,4,5,7,9,11];function TZe(t){const e=EZe(t);if(e[0]===""||e[3]!=="")return ffe;const n=e[0],r=e[1],i=e[2],s=(n.charCodeAt(0)+3)%7,o=yZe(r),a=i.length?+i:void 0,c=lfe({step:s,alt:o,oct:a}),l=n+r+i,u=n+r,h=(V4[s]+o+120)%12,d=a===void 0?xZe(V4[s]+o,12)-1188:V4[s]+o+12*(a+1),m=d>=0&&d<=127?d:null,p=a===void 0?null:Math.pow(2,(d-69)/12)*440;return{empty:!1,acc:r,alt:o,chroma:h,coord:c,freq:p,height:d,letter:n,midi:m,name:l,oct:a,pc:u,step:s}}function wZe(t){const{step:e,alt:n,oct:r}=t,i=_Ze(e);if(!i)return"";const s=i+vZe(n);return r||r===0?s+r:s}function hfe(t,e){const n=fM(t),r=Array.isArray(e)?e:UN(e).coord;if(n.empty||!r||r.length<2)return"";const i=n.coord,s=i.length===1?[i[0]+r[0]]:[i[0]+r[0],i[1]+r[1]];return SZe(s).name}function dfe(t,e){const n=e.length,r=(t%n+n)%n;return e.slice(r,n).concat(e.slice(0,r))}var tE={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},pfe=t=>Number(t).toString(2).padStart(12,"0"),VY=t=>parseInt(t,2),RZe=/^[01]{12}$/;function mfe(t){return RZe.test(t)}var CZe=t=>typeof t=="number"&&t>=0&&t<=4095,AZe=t=>t&&mfe(t.chroma),GY={[tE.chroma]:tE};function gfe(t){const e=mfe(t)?t:CZe(t)?pfe(t):Array.isArray(t)?NZe(t):AZe(t)?t.chroma:tE.chroma;return GY[e]=GY[e]||IZe(e)}var MZe=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function kZe(t){const e=[];for(let n=0;n<12;n++)t.charAt(n)==="1"&&e.push(MZe[n]);return e}function OZe(t){const e=t.split("");return e.map((n,r)=>dfe(r,e).join(""))}function IZe(t){const e=VY(t),n=OZe(t).map(VY).filter(s=>s>=2048).sort()[0],r=pfe(n),i=kZe(t);return{empty:!1,name:"",setNum:e,chroma:t,normalized:r,intervals:i}}function NZe(t){if(t.length===0)return tE.chroma;let e;const n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let r=0;r<t.length;r++)e=fM(t[r]),e.empty&&(e=UN(t[r])),e.empty||(n[e.chroma]=1);return n.join("")}var PZe=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],DZe=PZe;({...tE});var _fe=[],KO={};function LZe(t,e,n){const r=BZe(t),i={...gfe(t),name:n||"",quality:r,intervals:t,aliases:e};_fe.push(i),i.name&&(KO[i.name]=i),KO[i.setNum]=i,KO[i.chroma]=i,i.aliases.forEach(s=>UZe(i,s))}function UZe(t,e){KO[e]=t}function BZe(t){const e=n=>t.indexOf(n)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}DZe.forEach(([t,e,n])=>LZe(t.split(" "),n.split(" "),e));_fe.sort((t,e)=>t.setNum-e.setNum);var FZe=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],jZe=FZe,zZe={...tE,intervals:[],aliases:[]},fA={};function HZe(t){return fA[t]||zZe}function qZe(t,e,n=[]){const r={...gfe(t),name:e,intervals:t,aliases:n};return fA[r.name]=r,fA[r.setNum]=r,fA[r.chroma]=r,r.aliases.forEach(i=>VZe(r,i)),r}function VZe(t,e){fA[e]=t}jZe.forEach(([t,e,...n])=>qZe(t.split(" "),e,n));var GZe=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],$Ze=GZe;$Ze.forEach(([t,e,n])=>void 0);var WZe=hfe;function KZe(t,e){return WZe(t,[0,e])}var T9=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],$Y={...tE,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},XZe=T9.map(YZe),gB={};XZe.forEach(t=>{gB[t.name]=t,t.aliases.forEach(e=>{gB[e]=t})});function vfe(t){return typeof t=="string"?gB[t.toLowerCase()]||$Y:t&&t.name?vfe(t.name):$Y}function YZe(t){const[e,n,r,i,s,o,a]=t,c=a?[a]:[],l=Number(n).toString(2);return{empty:!1,intervals:HZe(i).intervals,modeNum:e,chroma:l,normalized:l,name:i,setNum:n,alt:r,triad:s,seventh:o,aliases:c}}function yfe(t){return(e,n)=>{const r=vfe(e);if(r.empty)return[];const i=dfe(r.modeNum,t),s=r.intervals.map(o=>hfe(n,o));return i.map((o,a)=>s[a]+o)}}yfe(T9.map(t=>t[4]));yfe(T9.map(t=>t[5]));function ZZe(t,e){const n=new uA(-6,6,10).connect(t),r=new Au(8e3,"highpass",-12);r.connect(n);const i=new Cy;i.set({envelope:{attack:.001,decay:.05,sustain:.001,release:.05}}),i.connect(r);function s(Re,Se){i.triggerAttackRelease(Re,Se)}const o=new uA(-6,3,8).connect(t),a=new Au(6e3,"highpass",-12);a.connect(o);const c=new Cy;c.set({envelope:{attack:.001,decay:.2,sustain:.1,release:.3}}),c.connect(a);function l(Re,Se){c.triggerAttackRelease(Re,Se)}function u(Re){s("16n",Re)}function h(Re){l("8n",Re)}const d=new Au(350,"bandpass").connect(t),m=new Jr().connect(d);m.gain.value=0;const p=new d9().connect(m);p.volume.value=16,p.maxPolyphony=8,p.set({envelope:{attack:.001,decay:.01,sustain:.1,release:.1},oscillator:{type:"square"}});function g(Re,Se){const ze=$l("64n").toSeconds()+$l(Re).toSeconds();m.gain.setValueAtTime(.5,Se),m.gain.exponentialRampToValueAtTime(.01,ze+Se),p.triggerAttackRelease([800,540],Re,Se)}const y=new uA(-10,10,-1).connect(t);y.connect(e);const v=new Au(800,"highpass",-12);v.connect(y);const x=new Cy;x.set({envelope:{attack:.01,decay:.1,sustain:.1,release:.1}}),x.connect(v);function E(Re,Se){x.triggerAttackRelease(Re,Se)}const C=new uM().connect(t);C.set({distortion:.666});const A=new ef;A.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),A.connect(C);const k=new Au;k.set({type:"highpass",frequency:1e4}),k.connect(C);const M=new Cy;M.set({envelope:{attack:.01,decay:.1,sustain:0,release:.1}}),M.connect(k);function I(Re,Se){const ze=$l("512n").toSeconds(),Be=$l("32n").toSeconds();A.triggerAttackRelease(1e4,Re,Se,1),A.frequency.exponentialRampToValueAtTime(300,Se+ze),A.frequency.exponentialRampToValueAtTime(100,Se+Be),M.triggerAttackRelease("8n",Se,.333),M.volume.setValueAtTime(1,Se),M.volume.exponentialRampToValueAtTime(0,Se+$l("32n").toSeconds())}const z=new Au;z.set({type:"bandpass",frequency:256,Q:.17}),z.connect(t);const H=new ef;H.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),H.connect(z);const K=new ef;K.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),K.connect(z);function P(Re,Se){H.triggerAttackRelease(2e3,Re,Se),H.frequency.exponentialRampToValueAtTime(1e3,Se+$l("32n").toSeconds()),K.triggerAttackRelease(999,Re,Se),K.frequency.exponentialRampToValueAtTime(888,Se+$l("256n").toSeconds())}const F=new uM().connect(t);F.set({distortion:.876});const N=new ef;N.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),N.connect(F);const X=new Au;X.set({type:"highpass",frequency:1e4}),X.connect(F);const G=new Cy;G.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}}),G.connect(X);function j(Re,Se){const ze=$l("512n").toSeconds(),Be=$l("32n").toSeconds();N.triggerAttackRelease(1e4,Re,Se,1),N.frequency.exponentialRampToValueAtTime(150,Se+ze),N.frequency.exponentialRampToValueAtTime(100,Se+Be),G.triggerAttackRelease("8n",Se,.25),G.volume.setValueAtTime(1,Se),G.volume.exponentialRampToValueAtTime(0,Se+$l("32n").toSeconds())}const q=new ef().connect(t);q.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"sawtooth"}});const te=new ef().connect(t);q.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"triangle"}});const W=new Cy().connect(t);W.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}});function $(Re,Se){const ze=$l("256n").toSeconds(),Be=$l(Re).toSeconds()-ze;q.triggerAttackRelease("C4",Be,Se,1),q.frequency.exponentialRampToValueAtTime(NY("C0").toFrequency(),Se+Be),te.triggerAttackRelease("C5",Be,Se,.5),te.frequency.exponentialRampToValueAtTime(NY("C0").toFrequency(),Se+Be);const Je=$l("4n").toSeconds();W.triggerAttackRelease("8n",Se),W.volume.setValueAtTime(1,Se),W.volume.exponentialRampToValueAtTime(0,Se+Je)}const J=new Au;J.set({type:"bandpass",frequency:256,Q:.17}),J.connect(t);const ne=new ef;ne.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),ne.connect(J);const ie=new ef;ie.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),ie.connect(J);function ae(Re,Se){ne.triggerAttackRelease(2e3,Re,Se),ne.frequency.exponentialRampToValueAtTime(100,Se+$l("32n").toSeconds()),ie.triggerAttackRelease(699,Re,Se),ie.frequency.exponentialRampToValueAtTime(399,Se+$l("256n").toSeconds())}const xe=new uT().connect(t);xe.set({octaves:8,volume:8,pitchDecay:.125}),xe.connect(e);function Ne(Re){xe.triggerAttackRelease("C1","8n",Re)}return{ticktrigger:u,tweettrigger:h,cowbelltrigger:g,claptrigger:E,hisnaretrigger:I,hiwoodblocktrigger:P,lowsnaretrigger:j,lowtomtrigger:$,lowwoodblocktrigger:ae,basstrigger:Ne}}const JZe="data:text/javascript;base64,Ly8gQSBkb3duc2FtcGxpbmcvZGVncmFkaW5nIHByb2Nlc3NpbmcgZWZmZWN0Ci8vIFNhbXBsZSBhbmQgaG9sZHMgdGhlIHNpZ25hbCBiYXNlZCBvbiBhbiBpbmNyZW1lbnRpbmcgY291bnRlcgovLyB3cml0dGVuIGJ5IFRpbW8gSG9vZ2xhbmQsIChjKSAyMDIzLCB3d3cudGltb2hvb2dsYW5kLmNvbQovLwoKY2xhc3MgU3ludGhGQ3J1c2hXb3JrbGV0UHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCkgewogICAgcmV0dXJuIFsKICAgICAgewogICAgICAgIG5hbWU6ICdyYXRlJywKICAgICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgICAgbWluVmFsdWU6IDEsCiAgICAgICAgbWF4VmFsdWU6IDUxMiwKICAgICAgfSwKICAgIF0KICB9CgogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoKQogICAgLy8gdGhlIGZyYW1lIGNvdW50ZXIKICAgIHRoaXMuY291bnQgPSAwCiAgICAvLyBzYW1wbGUgYW5kIGhvbGQgdmFyaWFibGUgYXJyYXkKICAgIHRoaXMuc2FoID0gW10KICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXQogICAgY29uc3Qgb3V0cHV0ID0gb3V0cHV0c1swXQoKICAgIC8vIGlmIHRoZXJlIGlzIGFueXRoaW5nIHRvIHByb2Nlc3MKICAgIGlmIChpbnB1dC5sZW5ndGggPiAwKSB7CiAgICAgIC8vIGZvciB0aGUgbGVuZ3RoIG9mIHRoZSBzYW1wbGUgYXJyYXkgKGdlbmVyYWxseSAxMjgpCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRbMF0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBmb3IgZXZlcnkgY2hhbm5lbAogICAgICAgIGZvciAobGV0IGNoYW5uZWwgPSAwOyBjaGFubmVsIDwgaW5wdXQubGVuZ3RoOyArK2NoYW5uZWwpIHsKICAgICAgICAgIC8vIGlmIGNvdW50ZXIgZXF1YWxzIDAsIHNhbXBsZSBhbmQgaG9sZAogICAgICAgICAgaWYgKHRoaXMuY291bnQgJSBwYXJhbWV0ZXJzLnJhdGUgPT09IDApIHsKICAgICAgICAgICAgdGhpcy5zYWhbY2hhbm5lbF0gPSBpbnB1dFtjaGFubmVsXVtpXQogICAgICAgICAgfQogICAgICAgICAgLy8gb3V0cHV0IHRoZSBjdXJyZW50bHkgaGVsZCBzYW1wbGUKICAgICAgICAgIG91dHB1dFtjaGFubmVsXVtpXSA9IHRoaXMuc2FoW2NoYW5uZWxdCiAgICAgICAgfQogICAgICAgIC8vIGluY3JlbWVudCBzYW1wbGUgY291bnRlcgogICAgICAgIHRoaXMuY291bnQrKwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWUKICB9Cn0KCnJlZ2lzdGVyUHJvY2Vzc29yKCdmY3J1c2hwcm9jZXNzb3InLCBTeW50aEZDcnVzaFdvcmtsZXRQcm9jZXNzb3IpCg==";class w9 extends nd{name="FrequencyCrusher";rate;_audioworkletnode=this.context.createAudioWorkletNode("fcrushprocessor");constructor(){const e=Gn(w9.getDefaults(),arguments,["rate"]);super(e),this.rate=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("rate"),value:e.rate,minValue:1,maxValue:512}),this.connectEffect(this._audioworkletnode)}static getDefaults(){return Object.assign(nd.getDefaults(),{rate:64})}dispose(){return super.dispose(),this._audioworkletnode.disconnect(),this}}function QZe(){return sa().rawContext.audioWorklet.addModule(JZe)}function Bf(t){return 20*Math.log10(t)-35}function eJe(){const t=new b9,e=na(t.get()),n=new v9,r=na(n.get()),i=new y9,s=na(i.get()),o=new uM,a=na(o.get()),c=new PP,l=na(c.get()),u=new w9,h=na(u.get()),d=new g9,m=na(d.get());function p(){t.set({...e,wet:1}),n.set({...r,wet:1,delayTime:"8n",maxDelay:"8n",feedback:.666}),i.set({...s,wet:1,frequency:5,octaves:.5,baseFrequency:400}),o.set({...a,wet:1,oversample:"4x"}),c.set({...l,wet:1,depth:0,maxDelay:.5}),u.set({...h,wet:1,rate:32}),d.set({...m,wet:1})}function g(){return{fc:na(u.get()),echo:na(n.get()),reverb:na(t.get()),phaser:na(i.get()),vibrato:na(c.get()),distortion:na(o.get())}}function y(x){u.set(x.fc),n.set(x.echo),t.set(x.reverb),i.set(x.phaser),c.set(x.vibrato),o.set(x.distortion)}function v(){u.dispose(),n.dispose(),t.dispose(),i.dispose(),c.dispose(),o.dispose()}return p(),{fc:u,echo:n,reverb:t,phaser:i,vibrato:c,distortion:o,applyreset:p,getreplay:g,setreplay:y,autowah:d,fcrush:u,distort:o,destroy:v}}function G4(t){const e=sa().isOffline?"offline":"",n=new kh(Bf(0)),r=new kh(Bf(0)),i=new kh(Bf(0)),s=new kh(Bf(0)),o=new kh(Bf(0)),a=new kh(Bf(0)),c=new kh(Bf(0));n.receive(`${e}fc${t}`),r.receive(`${e}echo${t}`),i.receive(`${e}reverb${t}`),s.receive(`${e}phaser${t}`),o.receive(`${e}vibrato${t}`),a.receive(`${e}distortion${t}`),c.receive(`${e}autowah${t}`);const l=new kh;l.send(`${e}fc${t}`),l.send(`${e}echo${t}`),l.send(`${e}reverb${t}`),l.send(`${e}phaser${t}`),l.send(`${e}vibrato${t}`),l.send(`${e}distortion${t}`),l.send(`${e}autowah${t}`);function u(){return{fc:n.volume.value,echo:r.volume.value,reverb:i.volume.value,phaser:s.volume.value,vibrato:o.volume.value,distortion:a.volume.value,autowah:c.volume.value}}function h(m){n.volume.value=m.fc,r.volume.value=m.echo,i.volume.value=m.reverb,s.volume.value=m.phaser,o.volume.value=m.vibrato,a.volume.value=m.distortion,c.volume.value=m.autowah}function d(){n.dispose(),r.dispose(),i.dispose(),s.dispose(),o.dispose(),a.dispose(),c.dispose(),l.dispose()}return{sendtofx:l,fc:n,echo:r,reverb:i,phaser:s,vibrato:o,distortion:a,autowah:c,fcrush:n,distort:a,getreplay:u,setreplay:h,destroy:d}}function tJe(t){return new Int8Array(t)}function nJe(t){return new Int16Array(t)}function bfe(t){return new Int32Array(t)}function Efe(t){return new Float32Array(t)}function rJe(t){return new Float64Array(t)}function Sfe(t){if(t.length==1)return Efe(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(Sfe(t));return n}function xfe(t){if(t.length==1)return bfe(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(xfe(t));return n}function Tfe(t){if(t.length==1)return nJe(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(Tfe(t));return n}function wfe(t){if(t.length==1)return new Array(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(wfe(t));return n}var Rfe={};Rfe.fill=function(t,e,n,r){if(arguments.length==2)for(var i=0;i<t.length;i++)t[i]=arguments[1];else for(var i=e;i<n;i++)t[i]=r};var p2={};p2.arraycopy=function(t,e,n,r,i){for(var s=e+i;e<s;)n[r++]=t[e++]};p2.out={};p2.out.println=function(t){console.log(t)};p2.out.printf=function(){console.log.apply(console,arguments)};var DP={};DP.SQRT2=1.4142135623730951;DP.FAST_LOG10=function(t){return Math.log10(t)};DP.FAST_LOG10_X=function(t,e){return Math.log10(t)*e};function Nv(t){this.ordinal=t}Nv.short_block_allowed=new Nv(0);Nv.short_block_coupled=new Nv(1);Nv.short_block_dispensed=new Nv(2);Nv.short_block_forced=new Nv(3);var Cfe={};Cfe.MAX_VALUE=34028235e31;function Zd(t){this.ordinal=t}Zd.vbr_off=new Zd(0);Zd.vbr_mt=new Zd(1);Zd.vbr_rh=new Zd(2);Zd.vbr_abr=new Zd(3);Zd.vbr_mtrh=new Zd(4);Zd.vbr_default=Zd.vbr_mtrh;var iJe=function(t){},Ta={System:p2,VbrMode:Zd,Float:Cfe,ShortBlock:Nv,Util:DP,Arrays:Rfe,new_array_n:wfe,new_byte:tJe,new_double:rJe,new_float:Efe,new_float_n:Sfe,new_int:bfe,new_int_n:xfe,new_short_n:Tfe,assert:iJe},$4,WY;function sJe(){if(WY)return $4;WY=1;var t=Ta,e=t.System,n=t.Util,r=t.Arrays,i=t.new_float,s=df();function o(){var a=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*n.SQRT2*.5/2384e-9,.017876148*n.SQRT2*.5/2384e-9,.003134727*n.SQRT2*.5/2384e-9,.002457142*n.SQRT2*.5/2384e-9,971317e-9*n.SQRT2*.5/2384e-9,218868e-9*n.SQRT2*.5/2384e-9,101566e-9*n.SQRT2*.5/2384e-9,13828e-9*n.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],c=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],l=c[s.SHORT_TYPE],u=c[s.SHORT_TYPE],h=c[s.SHORT_TYPE],d=c[s.SHORT_TYPE],m=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function p(v,x,E){for(var C=10,A=x+238-14-286,k=-15;k<0;k++){var M,I,z;M=a[C+-10],I=v[A+-224]*M,z=v[x+224]*M,M=a[C+-9],I+=v[A+-160]*M,z+=v[x+160]*M,M=a[C+-8],I+=v[A+-96]*M,z+=v[x+96]*M,M=a[C+-7],I+=v[A+-32]*M,z+=v[x+32]*M,M=a[C+-6],I+=v[A+32]*M,z+=v[x+-32]*M,M=a[C+-5],I+=v[A+96]*M,z+=v[x+-96]*M,M=a[C+-4],I+=v[A+160]*M,z+=v[x+-160]*M,M=a[C+-3],I+=v[A+224]*M,z+=v[x+-224]*M,M=a[C+-2],I+=v[x+-256]*M,z-=v[A+256]*M,M=a[C+-1],I+=v[x+-192]*M,z-=v[A+192]*M,M=a[C+0],I+=v[x+-128]*M,z-=v[A+128]*M,M=a[C+1],I+=v[x+-64]*M,z-=v[A+64]*M,M=a[C+2],I+=v[x+0]*M,z-=v[A+0]*M,M=a[C+3],I+=v[x+64]*M,z-=v[A+-64]*M,M=a[C+4],I+=v[x+128]*M,z-=v[A+-128]*M,M=a[C+5],I+=v[x+192]*M,z-=v[A+-192]*M,I*=a[C+6],M=z-I,E[30+k*2]=z+I,E[31+k*2]=a[C+7]*M,C+=18,x--,A++}{var I,z,H,K;z=v[x+-16]*a[C+-10],I=v[x+-32]*a[C+-2],z+=(v[x+-48]-v[x+16])*a[C+-9],I+=v[x+-96]*a[C+-1],z+=(v[x+-80]+v[x+48])*a[C+-8],I+=v[x+-160]*a[C+0],z+=(v[x+-112]-v[x+80])*a[C+-7],I+=v[x+-224]*a[C+1],z+=(v[x+-144]+v[x+112])*a[C+-6],I-=v[x+32]*a[C+2],z+=(v[x+-176]-v[x+144])*a[C+-5],I-=v[x+96]*a[C+3],z+=(v[x+-208]+v[x+176])*a[C+-4],I-=v[x+160]*a[C+4],z+=(v[x+-240]-v[x+208])*a[C+-3],I-=v[x+224],H=I-z,K=I+z,z=E[14],I=E[15]-z,E[31]=K+z,E[30]=H+I,E[15]=H-I,E[14]=K-z}{var P;P=E[28]-E[0],E[0]+=E[28],E[28]=P*a[C+-36+7],P=E[29]-E[1],E[1]+=E[29],E[29]=P*a[C+-36+7],P=E[26]-E[2],E[2]+=E[26],E[26]=P*a[C+-72+7],P=E[27]-E[3],E[3]+=E[27],E[27]=P*a[C+-72+7],P=E[24]-E[4],E[4]+=E[24],E[24]=P*a[C+-108+7],P=E[25]-E[5],E[5]+=E[25],E[25]=P*a[C+-108+7],P=E[22]-E[6],E[6]+=E[22],E[22]=P*n.SQRT2,P=E[23]-E[7],E[7]+=E[23],E[23]=P*n.SQRT2-E[7],E[7]-=E[6],E[22]-=E[7],E[23]-=E[22],P=E[6],E[6]=E[31]-P,E[31]=E[31]+P,P=E[7],E[7]=E[30]-P,E[30]=E[30]+P,P=E[22],E[22]=E[15]-P,E[15]=E[15]+P,P=E[23],E[23]=E[14]-P,E[14]=E[14]+P,P=E[20]-E[8],E[8]+=E[20],E[20]=P*a[C+-180+7],P=E[21]-E[9],E[9]+=E[21],E[21]=P*a[C+-180+7],P=E[18]-E[10],E[10]+=E[18],E[18]=P*a[C+-216+7],P=E[19]-E[11],E[11]+=E[19],E[19]=P*a[C+-216+7],P=E[16]-E[12],E[12]+=E[16],E[16]=P*a[C+-252+7],P=E[17]-E[13],E[13]+=E[17],E[17]=P*a[C+-252+7],P=-E[20]+E[24],E[20]+=E[24],E[24]=P*a[C+-216+7],P=-E[21]+E[25],E[21]+=E[25],E[25]=P*a[C+-216+7],P=E[4]-E[8],E[4]+=E[8],E[8]=P*a[C+-216+7],P=E[5]-E[9],E[5]+=E[9],E[9]=P*a[C+-216+7],P=E[0]-E[12],E[0]+=E[12],E[12]=P*a[C+-72+7],P=E[1]-E[13],E[1]+=E[13],E[13]=P*a[C+-72+7],P=E[16]-E[28],E[16]+=E[28],E[28]=P*a[C+-72+7],P=-E[17]+E[29],E[17]+=E[29],E[29]=P*a[C+-72+7],P=n.SQRT2*(E[2]-E[10]),E[2]+=E[10],E[10]=P,P=n.SQRT2*(E[3]-E[11]),E[3]+=E[11],E[11]=P,P=n.SQRT2*(-E[18]+E[26]),E[18]+=E[26],E[26]=P-E[18],P=n.SQRT2*(-E[19]+E[27]),E[19]+=E[27],E[27]=P-E[19],P=E[2],E[19]-=E[3],E[3]-=P,E[2]=E[31]-P,E[31]+=P,P=E[3],E[11]-=E[19],E[18]-=P,E[3]=E[30]-P,E[30]+=P,P=E[18],E[27]-=E[11],E[19]-=P,E[18]=E[15]-P,E[15]+=P,P=E[19],E[10]-=P,E[19]=E[14]-P,E[14]+=P,P=E[10],E[11]-=P,E[10]=E[23]-P,E[23]+=P,P=E[11],E[26]-=P,E[11]=E[22]-P,E[22]+=P,P=E[26],E[27]-=P,E[26]=E[7]-P,E[7]+=P,P=E[27],E[27]=E[6]-P,E[6]+=P,P=n.SQRT2*(E[0]-E[4]),E[0]+=E[4],E[4]=P,P=n.SQRT2*(E[1]-E[5]),E[1]+=E[5],E[5]=P,P=n.SQRT2*(E[16]-E[20]),E[16]+=E[20],E[20]=P,P=n.SQRT2*(E[17]-E[21]),E[17]+=E[21],E[21]=P,P=-n.SQRT2*(E[8]-E[12]),E[8]+=E[12],E[12]=P-E[8],P=-n.SQRT2*(E[9]-E[13]),E[9]+=E[13],E[13]=P-E[9],P=-n.SQRT2*(E[25]-E[29]),E[25]+=E[29],E[29]=P-E[25],P=-n.SQRT2*(E[24]+E[28]),E[24]-=E[28],E[28]=P-E[24],P=E[24]-E[16],E[24]=P,P=E[20]-P,E[20]=P,P=E[28]-P,E[28]=P,P=E[25]-E[17],E[25]=P,P=E[21]-P,E[21]=P,P=E[29]-P,E[29]=P,P=E[17]-E[1],E[17]=P,P=E[9]-P,E[9]=P,P=E[25]-P,E[25]=P,P=E[5]-P,E[5]=P,P=E[21]-P,E[21]=P,P=E[13]-P,E[13]=P,P=E[29]-P,E[29]=P,P=E[1]-E[0],E[1]=P,P=E[16]-P,E[16]=P,P=E[17]-P,E[17]=P,P=E[8]-P,E[8]=P,P=E[9]-P,E[9]=P,P=E[24]-P,E[24]=P,P=E[25]-P,E[25]=P,P=E[4]-P,E[4]=P,P=E[5]-P,E[5]=P,P=E[20]-P,E[20]=P,P=E[21]-P,E[21]=P,P=E[12]-P,E[12]=P,P=E[13]-P,E[13]=P,P=E[28]-P,E[28]=P,P=E[29]-P,E[29]=P,P=E[0],E[0]+=E[31],E[31]-=P,P=E[1],E[1]+=E[30],E[30]-=P,P=E[16],E[16]+=E[15],E[15]-=P,P=E[17],E[17]+=E[14],E[14]-=P,P=E[8],E[8]+=E[23],E[23]-=P,P=E[9],E[9]+=E[22],E[22]-=P,P=E[24],E[24]+=E[7],E[7]-=P,P=E[25],E[25]+=E[6],E[6]-=P,P=E[4],E[4]+=E[27],E[27]-=P,P=E[5],E[5]+=E[26],E[26]-=P,P=E[20],E[20]+=E[11],E[11]-=P,P=E[21],E[21]+=E[10],E[10]-=P,P=E[12],E[12]+=E[19],E[19]-=P,P=E[13],E[13]+=E[18],E[18]-=P,P=E[28],E[28]+=E[3],E[3]-=P,P=E[29],E[29]+=E[2],E[2]-=P}}function g(v,x){for(var E=0;E<3;E++){var C,A,k,M,I,z;M=v[x+6]*c[s.SHORT_TYPE][0]-v[x+15],C=v[x+0]*c[s.SHORT_TYPE][2]-v[x+9],A=M+C,k=M-C,M=v[x+15]*c[s.SHORT_TYPE][0]+v[x+6],C=v[x+9]*c[s.SHORT_TYPE][2]+v[x+0],I=M+C,z=-M+C,C=(v[x+3]*c[s.SHORT_TYPE][1]-v[x+12])*2069978111953089e-26,M=(v[x+12]*c[s.SHORT_TYPE][1]+v[x+3])*2069978111953089e-26,v[x+0]=A*190752519173728e-25+C,v[x+15]=-I*190752519173728e-25+M,k=k*.8660254037844387*1907525191737281e-26,I=I*.5*1907525191737281e-26+M,v[x+3]=k-I,v[x+6]=k+I,A=A*.5*1907525191737281e-26-C,z=z*.8660254037844387*1907525191737281e-26,v[x+9]=A+z,v[x+12]=A-z,x++}}function y(v,x,E){var C,A;{var k,M,I,z,H,K,P,F;k=E[17]-E[9],I=E[15]-E[11],z=E[14]-E[12],H=E[0]+E[8],K=E[1]+E[7],P=E[2]+E[6],F=E[3]+E[5],v[x+17]=H+P-F-(K-E[4]),A=(H+P-F)*u[19]+(K-E[4]),C=(k-I-z)*u[18],v[x+5]=C+A,v[x+6]=C-A,M=(E[16]-E[10])*u[18],K=K*u[19]+E[4],C=k*u[12]+M+I*u[13]+z*u[14],A=-H*u[16]+K-P*u[17]+F*u[15],v[x+1]=C+A,v[x+2]=C-A,C=k*u[13]-M-I*u[14]+z*u[12],A=-H*u[17]+K-P*u[15]+F*u[16],v[x+9]=C+A,v[x+10]=C-A,C=k*u[14]-M+I*u[12]-z*u[13],A=H*u[15]-K+P*u[16]-F*u[17],v[x+13]=C+A,v[x+14]=C-A}{var N,X,G,j,q,te,W,$;N=E[8]-E[0],G=E[6]-E[2],j=E[5]-E[3],q=E[17]+E[9],te=E[16]+E[10],W=E[15]+E[11],$=E[14]+E[12],v[x+0]=q+W+$+(te+E[13]),C=(q+W+$)*u[19]-(te+E[13]),A=(N-G+j)*u[18],v[x+11]=C+A,v[x+12]=C-A,X=(E[7]-E[1])*u[18],te=E[13]-te*u[19],C=q*u[15]-te+W*u[16]+$*u[17],A=N*u[14]+X+G*u[12]+j*u[13],v[x+3]=C+A,v[x+4]=C-A,C=-q*u[17]+te-W*u[15]-$*u[16],A=N*u[13]+X-G*u[14]-j*u[12],v[x+7]=C+A,v[x+8]=C-A,C=-q*u[16]+te-W*u[17]-$*u[15],A=N*u[12]-X+G*u[13]-j*u[14],v[x+15]=C+A,v[x+16]=C-A}}this.mdct_sub48=function(v,x,E){for(var C=x,A=286,k=0;k<v.channels_out;k++){for(var M=0;M<v.mode_gr;M++){for(var I,z=v.l3_side.tt[M][k],H=z.xr,K=0,P=v.sb_sample[k][1-M],F=0,N=0;N<18/2;N++)for(p(C,A,P[F]),p(C,A+32,P[F+1]),F+=2,A+=64,I=1;I<32;I+=2)P[F-1][I]*=-1;for(I=0;I<32;I++,K+=18){var X=z.block_type,G=v.sb_sample[k][M],j=v.sb_sample[k][1-M];if(z.mixed_block_flag!=0&&I<2&&(X=0),v.amp_filter[I]<1e-12)r.fill(H,K+0,K+18,0);else{if(v.amp_filter[I]<1)for(var N=0;N<18;N++)j[N][m[I]]*=v.amp_filter[I];if(X==s.SHORT_TYPE){for(var N=-12/4;N<0;N++){var q=c[s.SHORT_TYPE][N+3];H[K+N*3+9]=G[9+N][m[I]]*q-G[8-N][m[I]],H[K+N*3+18]=G[14-N][m[I]]*q+G[15+N][m[I]],H[K+N*3+10]=G[15+N][m[I]]*q-G[14-N][m[I]],H[K+N*3+19]=j[2-N][m[I]]*q+j[3+N][m[I]],H[K+N*3+11]=j[3+N][m[I]]*q-j[2-N][m[I]],H[K+N*3+20]=j[8-N][m[I]]*q+j[9+N][m[I]]}g(H,K)}else{for(var te=i(18),N=-36/4;N<0;N++){var W,$;W=c[X][N+27]*j[N+9][m[I]]+c[X][N+36]*j[8-N][m[I]],$=c[X][N+9]*G[N+9][m[I]]-c[X][N+18]*G[8-N][m[I]],te[N+9]=W-$*l[3+N+9],te[N+18]=W*l[3+N+9]+$}y(H,K,te)}}if(X!=s.SHORT_TYPE&&I!=0)for(var N=7;N>=0;--N){var J,ne;J=H[K+N]*h[20+N]+H[K+-1-N]*d[28+N],ne=H[K+N]*d[28+N]-H[K+-1-N]*h[20+N],H[K+-1-N]=J,H[K+N]=ne}}}if(C=E,A=286,v.mode_gr==1)for(var ie=0;ie<18;ie++)e.arraycopy(v.sb_sample[k][1][ie],0,v.sb_sample[k][0][ie],0,32)}}}return $4=o,$4}var W4,KY;function Afe(){if(KY)return W4;KY=1;var t=df(),e=Ta,n=e.System,r=e.new_float,i=e.new_float_n;function s(){this.l=r(t.SBMAX_l),this.s=i([t.SBMAX_s,3]);var o=this;this.assign=function(a){n.arraycopy(a.l,0,o.l,0,t.SBMAX_l);for(var c=0;c<t.SBMAX_s;c++)for(var l=0;l<3;l++)o.s[c][l]=a.s[c][l]}}return W4=s,W4}var K4,XY;function oJe(){if(XY)return K4;XY=1;var t=Afe();function e(){this.thm=new t,this.en=new t}return K4=e,K4}function xg(t){var e=t;this.ordinal=function(){return e}}xg.STEREO=new xg(0);xg.JOINT_STEREO=new xg(1);xg.DUAL_CHANNEL=new xg(2);xg.MONO=new xg(3);xg.NOT_SET=new xg(4);var m2=xg,X4,YY;function df(){if(YY)return X4;YY=1;var t=Ta,e=t.System,n=t.VbrMode,r=t.new_array_n,i=t.new_float,s=t.new_float_n,o=t.new_int,a=t.assert;c.ENCDELAY=576,c.POSTDELAY=1152,c.MDCTDELAY=48,c.FFTOFFSET=224+c.MDCTDELAY,c.DECDELAY=528,c.SBLIMIT=32,c.CBANDS=64,c.SBPSY_l=21,c.SBPSY_s=12,c.SBMAX_l=22,c.SBMAX_s=13,c.PSFB21=6,c.PSFB12=6,c.BLKSIZE=1024,c.HBLKSIZE=c.BLKSIZE/2+1,c.BLKSIZE_s=256,c.HBLKSIZE_s=c.BLKSIZE_s/2+1,c.NORM_TYPE=0,c.START_TYPE=1,c.SHORT_TYPE=2,c.STOP_TYPE=3,c.MPG_MD_LR_LR=0,c.MPG_MD_LR_I=1,c.MPG_MD_MS_LR=2,c.MPG_MD_MS_I=3,c.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function c(){var l=sJe(),u=oJe(),h=m2,d=c.FFTOFFSET,m=c.MPG_MD_MS_LR,p=null;this.psy=null;var g=null,y=null,v=null;this.setModules=function(k,M,I,z){p=k,this.psy=M,g=M,y=z,v=I};var x=new l;function E(k){var M,I;if(k.ATH.useAdjust==0){k.ATH.adjust=1;return}if(I=k.loudness_sq[0][0],M=k.loudness_sq[1][0],k.channels_out==2?(I+=k.loudness_sq[0][1],M+=k.loudness_sq[1][1]):(I+=I,M+=M),k.mode_gr==2&&(I=Math.max(I,M)),I*=.5,I*=k.ATH.aaSensitivityP,I>.03125)k.ATH.adjust>=1?k.ATH.adjust=1:k.ATH.adjust<k.ATH.adjustLimit&&(k.ATH.adjust=k.ATH.adjustLimit),k.ATH.adjustLimit=1;else{var z=31.98*I+625e-6;k.ATH.adjust>=z?(k.ATH.adjust*=z*.075+.925,k.ATH.adjust<z&&(k.ATH.adjust=z)):k.ATH.adjustLimit>=z?k.ATH.adjust=z:k.ATH.adjust<k.ATH.adjustLimit&&(k.ATH.adjust=k.ATH.adjustLimit),k.ATH.adjustLimit=z}}function C(k){var M,I;for(a(0<=k.bitrate_index&&k.bitrate_index<16),a(0<=k.mode_ext&&k.mode_ext<4),k.bitrate_stereoMode_Hist[k.bitrate_index][4]++,k.bitrate_stereoMode_Hist[15][4]++,k.channels_out==2&&(k.bitrate_stereoMode_Hist[k.bitrate_index][k.mode_ext]++,k.bitrate_stereoMode_Hist[15][k.mode_ext]++),M=0;M<k.mode_gr;++M)for(I=0;I<k.channels_out;++I){var z=k.l3_side.tt[M][I].block_type|0;k.l3_side.tt[M][I].mixed_block_flag!=0&&(z=4),k.bitrate_blockType_Hist[k.bitrate_index][z]++,k.bitrate_blockType_Hist[k.bitrate_index][5]++,k.bitrate_blockType_Hist[15][z]++,k.bitrate_blockType_Hist[15][5]++}}function A(k,M){var I=k.internal_flags,z,H;if(I.lame_encode_frame_init==0){var K,P,F=i(2014),N=i(2014);for(I.lame_encode_frame_init=1,K=0,P=0;K<286+576*(1+I.mode_gr);++K)K<576*I.mode_gr?(F[K]=0,I.channels_out==2&&(N[K]=0)):(F[K]=M[0][P],I.channels_out==2&&(N[K]=M[1][P]),++P);for(H=0;H<I.mode_gr;H++)for(z=0;z<I.channels_out;z++)I.l3_side.tt[H][z].block_type=c.SHORT_TYPE;x.mdct_sub48(I,F,N),a(576>=c.FFTOFFSET),a(I.mf_size>=c.BLKSIZE+k.framesize-c.FFTOFFSET),a(I.mf_size>=512+k.framesize-32)}}this.lame_encode_mp3_frame=function(k,M,I,z,H,K){var P,F=r([2,2]);F[0][0]=new u,F[0][1]=new u,F[1][0]=new u,F[1][1]=new u;var N=r([2,2]);N[0][0]=new u,N[0][1]=new u,N[1][0]=new u,N[1][1]=new u;var X,G=[null,null],j=k.internal_flags,q=s([2,4]),te=[.5,.5],W=[[0,0],[0,0]],$=[[0,0],[0,0]],J,ne,ie;if(G[0]=M,G[1]=I,j.lame_encode_frame_init==0&&A(k,G),j.padding=0,(j.slot_lag-=j.frac_SpF)<0&&(j.slot_lag+=k.out_samplerate,j.padding=1),j.psymodel!=0){var ae,xe=[null,null],Ne=0,Re=o(2);for(ie=0;ie<j.mode_gr;ie++){for(ne=0;ne<j.channels_out;ne++)xe[ne]=G[ne],Ne=576+ie*576-c.FFTOFFSET;if(k.VBR==n.vbr_mtrh||k.VBR==n.vbr_mt?ae=g.L3psycho_anal_vbr(k,xe,Ne,ie,F,N,W[ie],$[ie],q[ie],Re):ae=g.L3psycho_anal_ns(k,xe,Ne,ie,F,N,W[ie],$[ie],q[ie],Re),ae!=0)return-4;for(k.mode==h.JOINT_STEREO&&(te[ie]=q[ie][2]+q[ie][3],te[ie]>0&&(te[ie]=q[ie][3]/te[ie])),ne=0;ne<j.channels_out;ne++){var Se=j.l3_side.tt[ie][ne];Se.block_type=Re[ne],Se.mixed_block_flag=0}}}else for(ie=0;ie<j.mode_gr;ie++)for(ne=0;ne<j.channels_out;ne++)j.l3_side.tt[ie][ne].block_type=c.NORM_TYPE,j.l3_side.tt[ie][ne].mixed_block_flag=0,$[ie][ne]=W[ie][ne]=700;if(E(j),x.mdct_sub48(j,G[0],G[1]),j.mode_ext=c.MPG_MD_LR_LR,k.force_ms)j.mode_ext=c.MPG_MD_MS_LR;else if(k.mode==h.JOINT_STEREO){var ze=0,Be=0;for(ie=0;ie<j.mode_gr;ie++)for(ne=0;ne<j.channels_out;ne++)ze+=$[ie][ne],Be+=W[ie][ne];if(ze<=1*Be){var Je=j.l3_side.tt[0],at=j.l3_side.tt[j.mode_gr-1];Je[0].block_type==Je[1].block_type&&at[0].block_type==at[1].block_type&&(j.mode_ext=c.MPG_MD_MS_LR)}}if(j.mode_ext==m?(X=N,J=$):(X=F,J=W),k.analysis&&j.pinfo!=null)for(ie=0;ie<j.mode_gr;ie++)for(ne=0;ne<j.channels_out;ne++)j.pinfo.ms_ratio[ie]=j.ms_ratio[ie],j.pinfo.ms_ener_ratio[ie]=te[ie],j.pinfo.blocktype[ie][ne]=j.l3_side.tt[ie][ne].block_type,j.pinfo.pe[ie][ne]=J[ie][ne],e.arraycopy(j.l3_side.tt[ie][ne].xr,0,j.pinfo.xr[ie][ne],0,576),j.mode_ext==m&&(j.pinfo.ers[ie][ne]=j.pinfo.ers[ie][ne+2],e.arraycopy(j.pinfo.energy[ie][ne+2],0,j.pinfo.energy[ie][ne],0,j.pinfo.energy[ie][ne].length));if(k.VBR==n.vbr_off||k.VBR==n.vbr_abr){var re,Le;for(re=0;re<18;re++)j.nsPsy.pefirbuf[re]=j.nsPsy.pefirbuf[re+1];for(Le=0,ie=0;ie<j.mode_gr;ie++)for(ne=0;ne<j.channels_out;ne++)Le+=J[ie][ne];for(j.nsPsy.pefirbuf[18]=Le,Le=j.nsPsy.pefirbuf[9],re=0;re<9;re++)Le+=(j.nsPsy.pefirbuf[re]+j.nsPsy.pefirbuf[18-re])*c.fircoef[re];for(Le=670*5*j.mode_gr*j.channels_out/Le,ie=0;ie<j.mode_gr;ie++)for(ne=0;ne<j.channels_out;ne++)J[ie][ne]*=Le}if(j.iteration_loop.iteration_loop(k,J,te,X),p.format_bitstream(k),P=p.copy_buffer(j,z,H,K,1),k.bWriteVbrTag&&y.addVbrFrame(k),k.analysis&&j.pinfo!=null){for(ne=0;ne<j.channels_out;ne++){var He;for(He=0;He<d;He++)j.pinfo.pcmdata[ne][He]=j.pinfo.pcmdata[ne][He+k.framesize];for(He=d;He<1600;He++)j.pinfo.pcmdata[ne][He]=G[ne][He-d]}v.set_frame_pinfo(k,X)}return C(j),P}}return X4=c,X4}var Mfe=Ta,ZY=Mfe.Util,JY=Mfe.new_float,Sc=df();function aJe(){var t=JY(Sc.BLKSIZE),e=JY(Sc.BLKSIZE_s/2),n=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function r(s,o,a){var c=0,l,u,h;a<<=1;var d=o+a;l=4;do{var m,p,g,y,v,x,E;E=l>>1,y=l,v=l<<1,x=v+y,l=v<<1,u=o,h=u+E;do{var C,A,k,M;A=s[u+0]-s[u+y],C=s[u+0]+s[u+y],M=s[u+v]-s[u+x],k=s[u+v]+s[u+x],s[u+v]=C-k,s[u+0]=C+k,s[u+x]=A-M,s[u+y]=A+M,A=s[h+0]-s[h+y],C=s[h+0]+s[h+y],M=ZY.SQRT2*s[h+x],k=ZY.SQRT2*s[h+v],s[h+v]=C-k,s[h+0]=C+k,s[h+x]=A-M,s[h+y]=A+M,h+=l,u+=l}while(u<d);for(p=n[c+0],m=n[c+1],g=1;g<E;g++){var I,z;I=1-2*m*m,z=2*m*p,u=o+g,h=o+y-g;do{var H,K,P,C,A,F,k,N,M,X;K=z*s[u+y]-I*s[h+y],H=I*s[u+y]+z*s[h+y],A=s[u+0]-H,C=s[u+0]+H,F=s[h+0]-K,P=s[h+0]+K,K=z*s[u+x]-I*s[h+x],H=I*s[u+x]+z*s[h+x],M=s[u+v]-H,k=s[u+v]+H,X=s[h+v]-K,N=s[h+v]+K,K=m*k-p*X,H=p*k+m*X,s[u+v]=C-H,s[u+0]=C+H,s[h+x]=F-K,s[h+y]=F+K,K=p*N-m*M,H=m*N+p*M,s[h+v]=P-H,s[h+0]=P+H,s[u+x]=A-K,s[u+y]=A+K,h+=l,u+=l}while(u<d);I=p,p=I*n[c+0]-m*n[c+1],m=I*n[c+1]+m*n[c+0]}c+=2}while(l<a)}var i=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(s,o,a,c,l){for(var u=0;u<3;u++){var h=Sc.BLKSIZE_s/2,d=65535&576/3*(u+1),m=Sc.BLKSIZE_s/8-1;do{var p,g,y,v,x,E=i[m<<2]&255;p=e[E]*c[a][l+E+d],x=e[127-E]*c[a][l+E+d+128],g=p-x,p=p+x,y=e[E+64]*c[a][l+E+d+64],x=e[63-E]*c[a][l+E+d+192],v=y-x,y=y+x,h-=4,o[u][h+0]=p+y,o[u][h+2]=p-y,o[u][h+1]=g+v,o[u][h+3]=g-v,p=e[E+1]*c[a][l+E+d+1],x=e[126-E]*c[a][l+E+d+129],g=p-x,p=p+x,y=e[E+65]*c[a][l+E+d+65],x=e[62-E]*c[a][l+E+d+193],v=y-x,y=y+x,o[u][h+Sc.BLKSIZE_s/2+0]=p+y,o[u][h+Sc.BLKSIZE_s/2+2]=p-y,o[u][h+Sc.BLKSIZE_s/2+1]=g+v,o[u][h+Sc.BLKSIZE_s/2+3]=g-v}while(--m>=0);r(o[u],h,Sc.BLKSIZE_s/2)}},this.fft_long=function(s,o,a,c,l){var u=Sc.BLKSIZE/8-1,h=Sc.BLKSIZE/2;do{var d,m,p,g,y,v=i[u]&255;d=t[v]*c[a][l+v],y=t[v+512]*c[a][l+v+512],m=d-y,d=d+y,p=t[v+256]*c[a][l+v+256],y=t[v+768]*c[a][l+v+768],g=p-y,p=p+y,h-=4,o[h+0]=d+p,o[h+2]=d-p,o[h+1]=m+g,o[h+3]=m-g,d=t[v+1]*c[a][l+v+1],y=t[v+513]*c[a][l+v+513],m=d-y,d=d+y,p=t[v+257]*c[a][l+v+257],y=t[v+769]*c[a][l+v+769],g=p-y,p=p+y,o[h+Sc.BLKSIZE/2+0]=d+p,o[h+Sc.BLKSIZE/2+2]=d-p,o[h+Sc.BLKSIZE/2+1]=m+g,o[h+Sc.BLKSIZE/2+3]=m-g}while(--u>=0);r(o,h,Sc.BLKSIZE/2)},this.init_fft=function(s){for(var o=0;o<Sc.BLKSIZE;o++)t[o]=.42-.5*Math.cos(2*Math.PI*(o+.5)/Sc.BLKSIZE)+.08*Math.cos(4*Math.PI*(o+.5)/Sc.BLKSIZE);for(var o=0;o<Sc.BLKSIZE_s/2;o++)e[o]=.5*(1-Math.cos(2*Math.PI*(o+.5)/Sc.BLKSIZE_s))}}var cJe=aJe,Wv=Ta,iS=Wv.VbrMode,QY=Wv.Float,sS=Wv.ShortBlock,xh=Wv.Util,lJe=Wv.Arrays,qc=Wv.new_float,Lp=Wv.new_float_n,Vb=Wv.new_int,Xr=Wv.assert,uJe=cJe,Yt=df();function fJe(){var t=m2,e=new uJe,n=2.302585092994046,r=2,i=16,s=2,o=16,a=.34,c=1/(14752*14752)/(Yt.BLKSIZE/2),l=.01,u=.8,h=.6,d=.3,m=3.5,p=21,g=.2302585093;function y(Q,le){for(var we=0,Me=0;Me<Yt.BLKSIZE/2;++Me)we+=Q[Me]*le.ATH.eql_w[Me];return we*=c,we}function v(Q,le,we,Me,Te,ye,Ye,Pe,We,Ve,Xe){var lt=Q.internal_flags;if(We<2)e.fft_long(lt,Me[Te],We,Ve,Xe),e.fft_short(lt,ye[Ye],We,Ve,Xe);else if(We==2){for(var qe=Yt.BLKSIZE-1;qe>=0;--qe){var rt=Me[Te+0][qe],it=Me[Te+1][qe];Me[Te+0][qe]=(rt+it)*xh.SQRT2*.5,Me[Te+1][qe]=(rt-it)*xh.SQRT2*.5}for(var nt=2;nt>=0;--nt)for(var qe=Yt.BLKSIZE_s-1;qe>=0;--qe){var rt=ye[Ye+0][nt][qe],it=ye[Ye+1][nt][qe];ye[Ye+0][nt][qe]=(rt+it)*xh.SQRT2*.5,ye[Ye+1][nt][qe]=(rt-it)*xh.SQRT2*.5}}le[0]=Me[Te+0][0],le[0]*=le[0];for(var qe=Yt.BLKSIZE/2-1;qe>=0;--qe){var ct=Me[Te+0][Yt.BLKSIZE/2-qe],Qt=Me[Te+0][Yt.BLKSIZE/2+qe];le[Yt.BLKSIZE/2-qe]=(ct*ct+Qt*Qt)*.5}for(var nt=2;nt>=0;--nt){we[nt][0]=ye[Ye+0][nt][0],we[nt][0]*=we[nt][0];for(var qe=Yt.BLKSIZE_s/2-1;qe>=0;--qe){var ct=ye[Ye+0][nt][Yt.BLKSIZE_s/2-qe],Qt=ye[Ye+0][nt][Yt.BLKSIZE_s/2+qe];we[nt][Yt.BLKSIZE_s/2-qe]=(ct*ct+Qt*Qt)*.5}}{for(var tn=0,qe=11;qe<Yt.HBLKSIZE;qe++)tn+=le[qe];lt.tot_ener[We]=tn}if(Q.analysis){for(var qe=0;qe<Yt.HBLKSIZE;qe++)lt.pinfo.energy[Pe][We][qe]=lt.pinfo.energy_save[We][qe],lt.pinfo.energy_save[We][qe]=le[qe];lt.pinfo.pe[Pe][We]=lt.pe[We]}Q.athaa_loudapprox==2&&We<2&&(lt.loudness_sq[Pe][We]=lt.loudness_sq_save[We],lt.loudness_sq_save[We]=y(le,lt))}var x=8,E=23,C=15,A,k,M,I=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function z(){A=Math.pow(10,(x+1)/16),k=Math.pow(10,(E+1)/16),M=Math.pow(10,C/10)}var H=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],K=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],P=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function F(Q,le,we,Me,Te,ye){var Ye;if(le>Q)if(le<Q*k)Ye=le/Q;else return Q+le;else{if(Q>=le*k)return Q+le;Ye=Q/le}if(Q+=le,Me+3<=6){if(Ye>=A)return Q;var Pe=0|xh.FAST_LOG10_X(Ye,16);return Q*K[Pe]}var Pe=0|xh.FAST_LOG10_X(Ye,16);if(le=Te.ATH.cb_l[we]*Te.ATH.adjust,Q<M*le){if(Q>le){var We,Ve;return We=1,Pe<=13&&(We=P[Pe]),Ve=xh.FAST_LOG10_X(Q/le,10/15),Q*((H[Pe]-We)*Ve+We)}return Pe>13?Q:Q*P[Pe]}return Q*H[Pe]}var N=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function X(Q,le,we){var Me;if(Q<0&&(Q=0),le<0&&(le=0),Q<=0)return le;if(le<=0)return Q;if(le>Q?Me=le/Q:Me=Q/le,-2<=we&&we<=2){if(Me>=A)return Q+le;var Te=0|xh.FAST_LOG10_X(Me,16);return(Q+le)*N[Te]}return Me<k?Q+le:(Q<le&&(Q=le),Q)}function G(Q,le){var we=Q.internal_flags;if(we.channels_out>1){for(var Me=0;Me<Yt.SBMAX_l;Me++){var Te=we.thm[0].l[Me],ye=we.thm[1].l[Me];we.thm[0].l[Me]+=ye*le,we.thm[1].l[Me]+=Te*le}for(var Me=0;Me<Yt.SBMAX_s;Me++)for(var Ye=0;Ye<3;Ye++){var Te=we.thm[0].s[Me][Ye],ye=we.thm[1].s[Me][Ye];we.thm[0].s[Me][Ye]+=ye*le,we.thm[1].s[Me][Ye]+=Te*le}}}function j(Q){for(var le=0;le<Yt.SBMAX_l;le++)if(!(Q.thm[0].l[le]>1.58*Q.thm[1].l[le]||Q.thm[1].l[le]>1.58*Q.thm[0].l[le])){var we=Q.mld_l[le]*Q.en[3].l[le],Me=Math.max(Q.thm[2].l[le],Math.min(Q.thm[3].l[le],we));we=Q.mld_l[le]*Q.en[2].l[le];var Te=Math.max(Q.thm[3].l[le],Math.min(Q.thm[2].l[le],we));Q.thm[2].l[le]=Me,Q.thm[3].l[le]=Te}for(var le=0;le<Yt.SBMAX_s;le++)for(var ye=0;ye<3;ye++)if(!(Q.thm[0].s[le][ye]>1.58*Q.thm[1].s[le][ye]||Q.thm[1].s[le][ye]>1.58*Q.thm[0].s[le][ye])){var we=Q.mld_s[le]*Q.en[3].s[le][ye],Me=Math.max(Q.thm[2].s[le][ye],Math.min(Q.thm[3].s[le][ye],we));we=Q.mld_s[le]*Q.en[2].s[le][ye];var Te=Math.max(Q.thm[3].s[le][ye],Math.min(Q.thm[2].s[le][ye],we));Q.thm[2].s[le][ye]=Me,Q.thm[3].s[le][ye]=Te}}function q(Q,le,we){var Me=le,Te=Math.pow(10,we);le*=2,Me*=2;for(var ye=0;ye<Yt.SBMAX_l;ye++){var Ye,Pe,We,Ve;if(Ve=Q.ATH.cb_l[Q.bm_l[ye]]*Te,Ye=Math.min(Math.max(Q.thm[0].l[ye],Ve),Math.max(Q.thm[1].l[ye],Ve)),Pe=Math.max(Q.thm[2].l[ye],Ve),We=Math.max(Q.thm[3].l[ye],Ve),Ye*le<Pe+We){var Xe=Ye*Me/(Pe+We);Pe*=Xe,We*=Xe}Q.thm[2].l[ye]=Math.min(Pe,Q.thm[2].l[ye]),Q.thm[3].l[ye]=Math.min(We,Q.thm[3].l[ye])}Te*=Yt.BLKSIZE_s/Yt.BLKSIZE;for(var ye=0;ye<Yt.SBMAX_s;ye++)for(var lt=0;lt<3;lt++){var Ye,Pe,We,Ve;if(Ve=Q.ATH.cb_s[Q.bm_s[ye]]*Te,Ye=Math.min(Math.max(Q.thm[0].s[ye][lt],Ve),Math.max(Q.thm[1].s[ye][lt],Ve)),Pe=Math.max(Q.thm[2].s[ye][lt],Ve),We=Math.max(Q.thm[3].s[ye][lt],Ve),Ye*le<Pe+We){var Xe=Ye*le/(Pe+We);Pe*=Xe,We*=Xe}Q.thm[2].s[ye][lt]=Math.min(Q.thm[2].s[ye][lt],Pe),Q.thm[3].s[ye][lt]=Math.min(Q.thm[3].s[ye][lt],We)}}function te(Q,le,we,Me,Te){var ye,Ye,Pe=0,We=0;for(ye=Ye=0;ye<Yt.SBMAX_s;++Ye,++ye){for(var Ve=Q.bo_s[ye],Xe=Q.npart_s,lt=Ve<Xe?Ve:Xe;Ye<lt;)Xr(le[Ye]>=0),Xr(we[Ye]>=0),Pe+=le[Ye],We+=we[Ye],Ye++;if(Q.en[Me].s[ye][Te]=Pe,Q.thm[Me].s[ye][Te]=We,Ye>=Xe){++ye;break}Xr(le[Ye]>=0),Xr(we[Ye]>=0);{var qe=Q.PSY.bo_s_weight[ye],rt=1-qe;Pe=qe*le[Ye],We=qe*we[Ye],Q.en[Me].s[ye][Te]+=Pe,Q.thm[Me].s[ye][Te]+=We,Pe=rt*le[Ye],We=rt*we[Ye]}}for(;ye<Yt.SBMAX_s;++ye)Q.en[Me].s[ye][Te]=0,Q.thm[Me].s[ye][Te]=0}function W(Q,le,we,Me){var Te,ye,Ye=0,Pe=0;for(Te=ye=0;Te<Yt.SBMAX_l;++ye,++Te){for(var We=Q.bo_l[Te],Ve=Q.npart_l,Xe=We<Ve?We:Ve;ye<Xe;)Xr(le[ye]>=0),Xr(we[ye]>=0),Ye+=le[ye],Pe+=we[ye],ye++;if(Q.en[Me].l[Te]=Ye,Q.thm[Me].l[Te]=Pe,ye>=Ve){++Te;break}Xr(le[ye]>=0),Xr(we[ye]>=0);{var lt=Q.PSY.bo_l_weight[Te],qe=1-lt;Ye=lt*le[ye],Pe=lt*we[ye],Q.en[Me].l[Te]+=Ye,Q.thm[Me].l[Te]+=Pe,Ye=qe*le[ye],Pe=qe*we[ye]}}for(;Te<Yt.SBMAX_l;++Te)Q.en[Me].l[Te]=0,Q.thm[Me].l[Te]=0}function $(Q,le,we,Me,Te,ye){var Ye=Q.internal_flags,Pe,We;for(We=Pe=0;We<Ye.npart_s;++We){for(var Ve=0,Xe=Ye.numlines_s[We],lt=0;lt<Xe;++lt,++Pe){var qe=le[ye][Pe];Ve+=qe}we[We]=Ve}for(Xr(We==Ye.npart_s),Pe=We=0;We<Ye.npart_s;We++){var rt=Ye.s3ind_s[We][0],it=Ye.s3_ss[Pe++]*we[rt];for(++rt;rt<=Ye.s3ind_s[We][1];)it+=Ye.s3_ss[Pe]*we[rt],++Pe,++rt;{var nt=s*Ye.nb_s1[Te][We];Me[We]=Math.min(it,nt)}if(Ye.blocktype_old[Te&1]==Yt.SHORT_TYPE){var nt=o*Ye.nb_s2[Te][We],ct=Me[We];Me[We]=Math.min(nt,ct)}Ye.nb_s2[Te][We]=Ye.nb_s1[Te][We],Ye.nb_s1[Te][We]=it,Xr(Me[We]>=0)}for(;We<=Yt.CBANDS;++We)we[We]=0,Me[We]=0}function J(Q,le,we,Me){var Te=Q.internal_flags;Q.short_blocks==sS.short_block_coupled&&!(le[0]!=0&&le[1]!=0)&&(le[0]=le[1]=0);for(var ye=0;ye<Te.channels_out;ye++)Me[ye]=Yt.NORM_TYPE,Q.short_blocks==sS.short_block_dispensed&&(le[ye]=1),Q.short_blocks==sS.short_block_forced&&(le[ye]=0),le[ye]!=0?(Xr(Te.blocktype_old[ye]!=Yt.START_TYPE),Te.blocktype_old[ye]==Yt.SHORT_TYPE&&(Me[ye]=Yt.STOP_TYPE)):(Me[ye]=Yt.SHORT_TYPE,Te.blocktype_old[ye]==Yt.NORM_TYPE&&(Te.blocktype_old[ye]=Yt.START_TYPE),Te.blocktype_old[ye]==Yt.STOP_TYPE&&(Te.blocktype_old[ye]=Yt.SHORT_TYPE)),we[ye]=Te.blocktype_old[ye],Te.blocktype_old[ye]=Me[ye]}function ne(Q,le,we){return we>=1?Q:we<=0?le:le>0?Math.pow(Q/le,we)*le:0}var ie=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function ae(Q,le){for(var we=309.07,Me=0;Me<Yt.SBMAX_s-1;Me++)for(var Te=0;Te<3;Te++){var ye=Q.thm.s[Me][Te];if(ye>0){var Ye=ye*le,Pe=Q.en.s[Me][Te];Pe>Ye&&(Pe>Ye*1e10?we+=ie[Me]*(10*n):we+=ie[Me]*xh.FAST_LOG10(Pe/Ye))}}return we}var xe=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function Ne(Q,le){for(var we=281.0575,Me=0;Me<Yt.SBMAX_l-1;Me++){var Te=Q.thm.l[Me];if(Te>0){var ye=Te*le,Ye=Q.en.l[Me];Ye>ye&&(Ye>ye*1e10?we+=xe[Me]*(10*n):we+=xe[Me]*xh.FAST_LOG10(Ye/ye))}}return we}function Re(Q,le,we,Me,Te){var ye,Ye;for(ye=Ye=0;ye<Q.npart_l;++ye){var Pe=0,We=0,Ve;for(Ve=0;Ve<Q.numlines_l[ye];++Ve,++Ye){var Xe=le[Ye];Pe+=Xe,We<Xe&&(We=Xe)}we[ye]=Pe,Me[ye]=We,Te[ye]=Pe*Q.rnumlines_l[ye],Xr(Q.rnumlines_l[ye]>=0),Xr(we[ye]>=0),Xr(Me[ye]>=0),Xr(Te[ye]>=0)}}function Se(Q,le,we,Me){var Te=I.length-1,ye=0,Ye=we[ye]+we[ye+1];if(Ye>0){var Pe=le[ye];Pe<le[ye+1]&&(Pe=le[ye+1]),Xr(Q.numlines_l[ye]+Q.numlines_l[ye+1]-1>0),Ye=20*(Pe*2-Ye)/(Ye*(Q.numlines_l[ye]+Q.numlines_l[ye+1]-1));var We=0|Ye;We>Te&&(We=Te),Me[ye]=We}else Me[ye]=0;for(ye=1;ye<Q.npart_l-1;ye++)if(Ye=we[ye-1]+we[ye]+we[ye+1],Ye>0){var Pe=le[ye-1];Pe<le[ye]&&(Pe=le[ye]),Pe<le[ye+1]&&(Pe=le[ye+1]),Xr(Q.numlines_l[ye-1]+Q.numlines_l[ye]+Q.numlines_l[ye+1]-1>0),Ye=20*(Pe*3-Ye)/(Ye*(Q.numlines_l[ye-1]+Q.numlines_l[ye]+Q.numlines_l[ye+1]-1));var We=0|Ye;We>Te&&(We=Te),Me[ye]=We}else Me[ye]=0;if(Xr(ye==Q.npart_l-1),Ye=we[ye-1]+we[ye],Ye>0){var Pe=le[ye-1];Pe<le[ye]&&(Pe=le[ye]),Xr(Q.numlines_l[ye-1]+Q.numlines_l[ye]-1>0),Ye=20*(Pe*2-Ye)/(Ye*(Q.numlines_l[ye-1]+Q.numlines_l[ye]-1));var We=0|Ye;We>Te&&(We=Te),Me[ye]=We}else Me[ye]=0;Xr(ye==Q.npart_l-1)}var ze=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(Q,le,we,Me,Te,ye,Ye,Pe,We,Ve){var Xe=Q.internal_flags,lt=Lp([2,Yt.BLKSIZE]),qe=Lp([2,3,Yt.BLKSIZE_s]),rt=qc(Yt.CBANDS+1),it=qc(Yt.CBANDS+1),nt=qc(Yt.CBANDS+2),ct=Vb(2),Qt=Vb(2),tn,Ot,qt,vt,Kt,_n,Wt,dn,Mn=Lp([2,576]),Ln,is=Vb(Yt.CBANDS+2),ni=Vb(Yt.CBANDS+2);for(lJe.fill(ni,0),tn=Xe.channels_out,Q.mode==t.JOINT_STEREO&&(tn=4),Q.VBR==iS.vbr_off?Ln=Xe.ResvMax==0?0:Xe.ResvSize/Xe.ResvMax*.5:Q.VBR==iS.vbr_rh||Q.VBR==iS.vbr_mtrh||Q.VBR==iS.vbr_mt?Ln=.6:Ln=1,Ot=0;Ot<Xe.channels_out;Ot++){var fi=le[Ot],Ps=we+576-350-p+192;for(vt=0;vt<576;vt++){var Ds,zi;for(Ds=fi[Ps+vt+10],zi=0,Kt=0;Kt<(p-1)/2-1;Kt+=2)Ds+=ze[Kt]*(fi[Ps+vt+Kt]+fi[Ps+vt+p-Kt]),zi+=ze[Kt+1]*(fi[Ps+vt+Kt+1]+fi[Ps+vt+p-Kt-1]);Mn[Ot][vt]=Ds+zi}Te[Me][Ot].en.assign(Xe.en[Ot]),Te[Me][Ot].thm.assign(Xe.thm[Ot]),tn>2&&(ye[Me][Ot].en.assign(Xe.en[Ot+2]),ye[Me][Ot].thm.assign(Xe.thm[Ot+2]))}for(Ot=0;Ot<tn;Ot++){var ds,ps,je=qc(12),gt=[0,0,0,0],Pt=qc(12),Dt=1,St,nn=qc(Yt.CBANDS),xn=qc(Yt.CBANDS),ln=[0,0,0,0],Un=qc(Yt.HBLKSIZE),ur=Lp([3,Yt.HBLKSIZE_s]);for(Xr(Xe.npart_s<=Yt.CBANDS),Xr(Xe.npart_l<=Yt.CBANDS),vt=0;vt<3;vt++)je[vt]=Xe.nsPsy.last_en_subshort[Ot][vt+6],Xr(Xe.nsPsy.last_en_subshort[Ot][vt+4]>0),Pt[vt]=je[vt]/Xe.nsPsy.last_en_subshort[Ot][vt+4],gt[0]+=je[vt];if(Ot==2)for(vt=0;vt<576;vt++){var cr,Fn;cr=Mn[0][vt],Fn=Mn[1][vt],Mn[0][vt]=cr+Fn,Mn[1][vt]=cr-Fn}{var dr=Mn[Ot&1],Dr=0;for(vt=0;vt<9;vt++){for(var ws=Dr+64,Ar=1;Dr<ws;Dr++)Ar<Math.abs(dr[Dr])&&(Ar=Math.abs(dr[Dr]));Xe.nsPsy.last_en_subshort[Ot][vt]=je[vt+3]=Ar,gt[1+vt/3]+=Ar,Ar>je[vt+3-2]?(Xr(je[vt+3-2]>0),Ar=Ar/je[vt+3-2]):je[vt+3-2]>Ar*10?Ar=je[vt+3-2]/(Ar*10):Ar=0,Pt[vt+3]=Ar}}if(Q.analysis){var Ur=Pt[0];for(vt=1;vt<12;vt++)Ur<Pt[vt]&&(Ur=Pt[vt]);Xe.pinfo.ers[Me][Ot]=Xe.pinfo.ers_save[Ot],Xe.pinfo.ers_save[Ot]=Ur}for(St=Ot==3?Xe.nsPsy.attackthre_s:Xe.nsPsy.attackthre,vt=0;vt<12;vt++)ln[vt/3]==0&&Pt[vt]>St&&(ln[vt/3]=vt%3+1);for(vt=1;vt<4;vt++){var rr;gt[vt-1]>gt[vt]?(Xr(gt[vt]>0),rr=gt[vt-1]/gt[vt]):(Xr(gt[vt-1]>0),rr=gt[vt]/gt[vt-1]),rr<1.7&&(ln[vt]=0,vt==1&&(ln[0]=0))}for(ln[0]!=0&&Xe.nsPsy.lastAttacks[Ot]!=0&&(ln[0]=0),(Xe.nsPsy.lastAttacks[Ot]==3||ln[0]+ln[1]+ln[2]+ln[3]!=0)&&(Dt=0,ln[1]!=0&&ln[0]!=0&&(ln[1]=0),ln[2]!=0&&ln[1]!=0&&(ln[2]=0),ln[3]!=0&&ln[2]!=0&&(ln[3]=0)),Ot<2?Qt[Ot]=Dt:Dt==0&&(Qt[0]=Qt[1]=0),We[Ot]=Xe.tot_ener[Ot],ps=qe,ds=lt,v(Q,Un,ur,ds,Ot&1,ps,Ot&1,Me,Ot,le,we),Re(Xe,Un,rt,nn,xn),Se(Xe,nn,xn,is),dn=0;dn<3;dn++){var pr,un;for($(Q,ur,it,nt,Ot,dn),te(Xe,it,nt,Ot,dn),Wt=0;Wt<Yt.SBMAX_s;Wt++){if(un=Xe.thm[Ot].s[Wt][dn],un*=u,ln[dn]>=2||ln[dn+1]==1){var Er=dn!=0?dn-1:2,Ar=ne(Xe.thm[Ot].s[Wt][Er],un,h*Ln);un=Math.min(un,Ar)}if(ln[dn]==1){var Er=dn!=0?dn-1:2,Ar=ne(Xe.thm[Ot].s[Wt][Er],un,d*Ln);un=Math.min(un,Ar)}else if(dn!=0&&ln[dn-1]==3||dn==0&&Xe.nsPsy.lastAttacks[Ot]==3){var Er=dn!=2?dn+1:0,Ar=ne(Xe.thm[Ot].s[Wt][Er],un,d*Ln);un=Math.min(un,Ar)}pr=je[dn*3+3]+je[dn*3+4]+je[dn*3+5],je[dn*3+5]*6<pr&&(un*=.5,je[dn*3+4]*6<pr&&(un*=.5)),Xe.thm[Ot].s[Wt][dn]=un}}for(Xe.nsPsy.lastAttacks[Ot]=ln[2],_n=0,qt=0;qt<Xe.npart_l;qt++){for(var Co=Xe.s3ind[qt][0],io=rt[Co]*I[is[Co]],aa=Xe.s3_ll[_n++]*io;++Co<=Xe.s3ind[qt][1];)io=rt[Co]*I[is[Co]],aa=F(aa,Xe.s3_ll[_n++]*io,Co,Co-qt,Xe);aa*=.158489319246111,Xe.blocktype_old[Ot&1]==Yt.SHORT_TYPE?nt[qt]=aa:nt[qt]=ne(Math.min(aa,Math.min(r*Xe.nb_1[Ot][qt],i*Xe.nb_2[Ot][qt])),aa,Ln),Xe.nb_2[Ot][qt]=Xe.nb_1[Ot][qt],Xe.nb_1[Ot][qt]=aa}for(;qt<=Yt.CBANDS;++qt)rt[qt]=0,nt[qt]=0;W(Xe,rt,nt,Ot)}if((Q.mode==t.STEREO||Q.mode==t.JOINT_STEREO)&&Q.interChRatio>0&&G(Q,Q.interChRatio),Q.mode==t.JOINT_STEREO){var ki;j(Xe),ki=Q.msfix,Math.abs(ki)>0&&q(Xe,ki,Q.ATHlower*Xe.ATH.adjust)}for(J(Q,Qt,Ve,ct),Ot=0;Ot<tn;Ot++){var kn,Gr=0,$n,Zi;Ot>1?(kn=Pe,Gr=-2,$n=Yt.NORM_TYPE,(Ve[0]==Yt.SHORT_TYPE||Ve[1]==Yt.SHORT_TYPE)&&($n=Yt.SHORT_TYPE),Zi=ye[Me][Ot-2]):(kn=Ye,Gr=0,$n=Ve[Ot],Zi=Te[Me][Ot]),$n==Yt.SHORT_TYPE?kn[Gr+Ot]=ae(Zi,Xe.masking_lower):kn[Gr+Ot]=Ne(Zi,Xe.masking_lower),Q.analysis&&(Xe.pinfo.pe[Me][Ot]=kn[Gr+Ot])}return 0};function Be(Q,le,we,Me,Te,ye,Ye,Pe){var We=Q.internal_flags;if(Me<2)e.fft_long(We,Ye[Pe],Me,le,we);else if(Me==2)for(var Ve=Yt.BLKSIZE-1;Ve>=0;--Ve){var Xe=Ye[Pe+0][Ve],lt=Ye[Pe+1][Ve];Ye[Pe+0][Ve]=(Xe+lt)*xh.SQRT2*.5,Ye[Pe+1][Ve]=(Xe-lt)*xh.SQRT2*.5}ye[0]=Ye[Pe+0][0],ye[0]*=ye[0];for(var Ve=Yt.BLKSIZE/2-1;Ve>=0;--Ve){var qe=Ye[Pe+0][Yt.BLKSIZE/2-Ve],rt=Ye[Pe+0][Yt.BLKSIZE/2+Ve];ye[Yt.BLKSIZE/2-Ve]=(qe*qe+rt*rt)*.5}{for(var it=0,Ve=11;Ve<Yt.HBLKSIZE;Ve++)it+=ye[Ve];We.tot_ener[Me]=it}if(Q.analysis){for(var Ve=0;Ve<Yt.HBLKSIZE;Ve++)We.pinfo.energy[Te][Me][Ve]=We.pinfo.energy_save[Me][Ve],We.pinfo.energy_save[Me][Ve]=ye[Ve];We.pinfo.pe[Te][Me]=We.pe[Me]}}function Je(Q,le,we,Me,Te,ye,Ye,Pe){var We=Q.internal_flags;if(Te==0&&Me<2&&e.fft_short(We,Ye[Pe],Me,le,we),Me==2)for(var Ve=Yt.BLKSIZE_s-1;Ve>=0;--Ve){var Xe=Ye[Pe+0][Te][Ve],lt=Ye[Pe+1][Te][Ve];Ye[Pe+0][Te][Ve]=(Xe+lt)*xh.SQRT2*.5,Ye[Pe+1][Te][Ve]=(Xe-lt)*xh.SQRT2*.5}ye[Te][0]=Ye[Pe+0][Te][0],ye[Te][0]*=ye[Te][0];for(var Ve=Yt.BLKSIZE_s/2-1;Ve>=0;--Ve){var qe=Ye[Pe+0][Te][Yt.BLKSIZE_s/2-Ve],rt=Ye[Pe+0][Te][Yt.BLKSIZE_s/2+Ve];ye[Te][Yt.BLKSIZE_s/2-Ve]=(qe*qe+rt*rt)*.5}}function at(Q,le,we,Me){var Te=Q.internal_flags;Q.athaa_loudapprox==2&&we<2&&(Te.loudness_sq[le][we]=Te.loudness_sq_save[we],Te.loudness_sq_save[we]=y(Me,Te))}var re=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Le(Q,le,we,Me,Te,ye,Ye,Pe,We,Ve){for(var Xe=Lp([2,576]),lt=Q.internal_flags,qe=lt.channels_out,rt=Q.mode==t.JOINT_STEREO?4:qe,it=0;it<qe;it++){firbuf=le[it];for(var nt=we+576-350-p+192,ct=0;ct<576;ct++){var Qt,tn;Qt=firbuf[nt+ct+10],tn=0;for(var Ot=0;Ot<(p-1)/2-1;Ot+=2)Qt+=re[Ot]*(firbuf[nt+ct+Ot]+firbuf[nt+ct+p-Ot]),tn+=re[Ot+1]*(firbuf[nt+ct+Ot+1]+firbuf[nt+ct+p-Ot-1]);Xe[it][ct]=Qt+tn}Te[Me][it].en.assign(lt.en[it]),Te[Me][it].thm.assign(lt.thm[it]),rt>2&&(ye[Me][it].en.assign(lt.en[it+2]),ye[Me][it].thm.assign(lt.thm[it+2]))}for(var it=0;it<rt;it++){var qt=qc(12),vt=qc(12),Kt=[0,0,0,0],_n=Xe[it&1],Wt=0,dn=it==3?lt.nsPsy.attackthre_s:lt.nsPsy.attackthre,Mn=1;if(it==2)for(var ct=0,Ot=576;Ot>0;++ct,--Ot){var Ln=Xe[0][ct],is=Xe[1][ct];Xe[0][ct]=Ln+is,Xe[1][ct]=Ln-is}for(var ct=0;ct<3;ct++)vt[ct]=lt.nsPsy.last_en_subshort[it][ct+6],Xr(lt.nsPsy.last_en_subshort[it][ct+4]>0),qt[ct]=vt[ct]/lt.nsPsy.last_en_subshort[it][ct+4],Kt[0]+=vt[ct];for(var ct=0;ct<9;ct++){for(var ni=Wt+64,fi=1;Wt<ni;Wt++)fi<Math.abs(_n[Wt])&&(fi=Math.abs(_n[Wt]));lt.nsPsy.last_en_subshort[it][ct]=vt[ct+3]=fi,Kt[1+ct/3]+=fi,fi>vt[ct+3-2]?(Xr(vt[ct+3-2]>0),fi=fi/vt[ct+3-2]):vt[ct+3-2]>fi*10?fi=vt[ct+3-2]/(fi*10):fi=0,qt[ct+3]=fi}for(var ct=0;ct<3;++ct){var Ps=vt[ct*3+3]+vt[ct*3+4]+vt[ct*3+5],Ds=1;vt[ct*3+5]*6<Ps&&(Ds*=.5,vt[ct*3+4]*6<Ps&&(Ds*=.5)),Pe[it][ct]=Ds}if(Q.analysis){for(var zi=qt[0],ct=1;ct<12;ct++)zi<qt[ct]&&(zi=qt[ct]);lt.pinfo.ers[Me][it]=lt.pinfo.ers_save[it],lt.pinfo.ers_save[it]=zi}for(var ct=0;ct<12;ct++)We[it][ct/3]==0&&qt[ct]>dn&&(We[it][ct/3]=ct%3+1);for(var ct=1;ct<4;ct++){var ds=Kt[ct-1],ps=Kt[ct],je=Math.max(ds,ps);je<4e4&&ds<1.7*ps&&ps<1.7*ds&&(ct==1&&We[it][0]<=We[it][ct]&&(We[it][0]=0),We[it][ct]=0)}We[it][0]<=lt.nsPsy.lastAttacks[it]&&(We[it][0]=0),(lt.nsPsy.lastAttacks[it]==3||We[it][0]+We[it][1]+We[it][2]+We[it][3]!=0)&&(Mn=0,We[it][1]!=0&&We[it][0]!=0&&(We[it][1]=0),We[it][2]!=0&&We[it][1]!=0&&(We[it][2]=0),We[it][3]!=0&&We[it][2]!=0&&(We[it][3]=0)),it<2?Ve[it]=Mn:Mn==0&&(Ve[0]=Ve[1]=0),Ye[it]=lt.tot_ener[it]}}function He(Q,le,we){if(we==0)for(var Me=0;Me<Q.npart_s;Me++)Q.nb_s2[le][Me]=Q.nb_s1[le][Me],Q.nb_s1[le][Me]=0}function Ue(Q,le){for(var we=0;we<Q.npart_l;we++)Q.nb_2[le][we]=Q.nb_1[le][we],Q.nb_1[le][we]=0}function De(Q,le,we,Me){var Te=I.length-1,ye=0,Ye=we[ye]+we[ye+1];if(Ye>0){var Pe=le[ye];Pe<le[ye+1]&&(Pe=le[ye+1]),Xr(Q.numlines_s[ye]+Q.numlines_s[ye+1]-1>0),Ye=20*(Pe*2-Ye)/(Ye*(Q.numlines_s[ye]+Q.numlines_s[ye+1]-1));var We=0|Ye;We>Te&&(We=Te),Me[ye]=We}else Me[ye]=0;for(ye=1;ye<Q.npart_s-1;ye++)if(Ye=we[ye-1]+we[ye]+we[ye+1],Xr(ye+1<Q.npart_s),Ye>0){var Pe=le[ye-1];Pe<le[ye]&&(Pe=le[ye]),Pe<le[ye+1]&&(Pe=le[ye+1]),Xr(Q.numlines_s[ye-1]+Q.numlines_s[ye]+Q.numlines_s[ye+1]-1>0),Ye=20*(Pe*3-Ye)/(Ye*(Q.numlines_s[ye-1]+Q.numlines_s[ye]+Q.numlines_s[ye+1]-1));var We=0|Ye;We>Te&&(We=Te),Me[ye]=We}else Me[ye]=0;if(Xr(ye==Q.npart_s-1),Ye=we[ye-1]+we[ye],Ye>0){var Pe=le[ye-1];Pe<le[ye]&&(Pe=le[ye]),Xr(Q.numlines_s[ye-1]+Q.numlines_s[ye]-1>0),Ye=20*(Pe*2-Ye)/(Ye*(Q.numlines_s[ye-1]+Q.numlines_s[ye]-1));var We=0|Ye;We>Te&&(We=Te),Me[ye]=We}else Me[ye]=0;Xr(ye==Q.npart_s-1)}function fe(Q,le,we,Me,Te,ye){var Ye=Q.internal_flags,Pe=new float[Yt.CBANDS],We=qc(Yt.CBANDS),Ve,Xe,lt,qe=new int[Yt.CBANDS];for(lt=Xe=0;lt<Ye.npart_s;++lt){var rt=0,it=0,nt=Ye.numlines_s[lt];for(Ve=0;Ve<nt;++Ve,++Xe){var ct=le[ye][Xe];rt+=ct,it<ct&&(it=ct)}we[lt]=rt,Pe[lt]=it,We[lt]=rt/nt,Xr(We[lt]>=0)}for(Xr(lt==Ye.npart_s);lt<Yt.CBANDS;++lt)Pe[lt]=0,We[lt]=0;for(De(Ye,Pe,We,qe),Xe=lt=0;lt<Ye.npart_s;lt++){var Qt=Ye.s3ind_s[lt][0],tn=Ye.s3ind_s[lt][1],Ot,qt,vt,Kt,_n;for(Ot=qe[Qt],qt=1,Kt=Ye.s3_ss[Xe]*we[Qt]*I[qe[Qt]],++Xe,++Qt;Qt<=tn;)Ot+=qe[Qt],qt+=1,vt=Ye.s3_ss[Xe]*we[Qt]*I[qe[Qt]],Kt=X(Kt,vt,Qt-lt),++Xe,++Qt;Ot=(1+2*Ot)/(2*qt),_n=I[Ot]*.5,Kt*=_n,Me[lt]=Kt,Ye.nb_s2[Te][lt]=Ye.nb_s1[Te][lt],Ye.nb_s1[Te][lt]=Kt,vt=Pe[lt],vt*=Ye.minval_s[lt],vt*=_n,Me[lt]>vt&&(Me[lt]=vt),Ye.masking_lower>1&&(Me[lt]*=Ye.masking_lower),Me[lt]>we[lt]&&(Me[lt]=we[lt]),Ye.masking_lower<1&&(Me[lt]*=Ye.masking_lower),Xr(Me[lt]>=0)}for(;lt<Yt.CBANDS;++lt)we[lt]=0,Me[lt]=0}function ve(Q,le,we,Me,Te){var ye=qc(Yt.CBANDS),Ye=qc(Yt.CBANDS),Pe=Vb(Yt.CBANDS+2),We;Re(Q,le,we,ye,Ye),Se(Q,ye,Ye,Pe);var Ve=0;for(We=0;We<Q.npart_l;We++){var Xe,lt,qe,rt,it=Q.s3ind[We][0],nt=Q.s3ind[We][1],ct=0,Qt=0;for(ct=Pe[it],Qt+=1,lt=Q.s3_ll[Ve]*we[it]*I[Pe[it]],++Ve,++it;it<=nt;)ct+=Pe[it],Qt+=1,Xe=Q.s3_ll[Ve]*we[it]*I[Pe[it]],rt=X(lt,Xe,it-We),lt=rt,++Ve,++it;if(ct=(1+2*ct)/(2*Qt),qe=I[ct]*.5,lt*=qe,Q.blocktype_old[Te&1]==Yt.SHORT_TYPE){var tn=r*Q.nb_1[Te][We];tn>0?Me[We]=Math.min(lt,tn):Me[We]=Math.min(lt,we[We]*d)}else{var Ot=i*Q.nb_2[Te][We],qt=r*Q.nb_1[Te][We],tn;Ot<=0&&(Ot=lt),qt<=0&&(qt=lt),Q.blocktype_old[Te&1]==Yt.NORM_TYPE?tn=Math.min(qt,Ot):tn=qt,Me[We]=Math.min(lt,tn)}Q.nb_2[Te][We]=Q.nb_1[Te][We],Q.nb_1[Te][We]=lt,Xe=ye[We],Xe*=Q.minval_l[We],Xe*=qe,Me[We]>Xe&&(Me[We]=Xe),Q.masking_lower>1&&(Me[We]*=Q.masking_lower),Me[We]>we[We]&&(Me[We]=we[We]),Q.masking_lower<1&&(Me[We]*=Q.masking_lower),Xr(Me[We]>=0)}for(;We<Yt.CBANDS;++We)we[We]=0,Me[We]=0}function Ae(Q,le){var we=Q.internal_flags;Q.short_blocks==sS.short_block_coupled&&!(le[0]!=0&&le[1]!=0)&&(le[0]=le[1]=0);for(var Me=0;Me<we.channels_out;Me++)Q.short_blocks==sS.short_block_dispensed&&(le[Me]=1),Q.short_blocks==sS.short_block_forced&&(le[Me]=0)}function pe(Q,le,we){for(var Me=Q.internal_flags,Te=0;Te<Me.channels_out;Te++){var ye=Yt.NORM_TYPE;le[Te]!=0?(Xr(Me.blocktype_old[Te]!=Yt.START_TYPE),Me.blocktype_old[Te]==Yt.SHORT_TYPE&&(ye=Yt.STOP_TYPE)):(ye=Yt.SHORT_TYPE,Me.blocktype_old[Te]==Yt.NORM_TYPE&&(Me.blocktype_old[Te]=Yt.START_TYPE),Me.blocktype_old[Te]==Yt.STOP_TYPE&&(Me.blocktype_old[Te]=Yt.SHORT_TYPE)),we[Te]=Me.blocktype_old[Te],Me.blocktype_old[Te]=ye}}function Ge(Q,le,we,Me,Te,ye,Ye){for(var Pe=ye*2,We=ye>0?Math.pow(10,Te):1,Ve,Xe,lt=0;lt<Ye;++lt){var qe=Q[2][lt],rt=Q[3][lt],it=le[0][lt],nt=le[1][lt],ct=le[2][lt],Qt=le[3][lt];if(it<=1.58*nt&&nt<=1.58*it){var tn=we[lt]*rt,Ot=we[lt]*qe;Xe=Math.max(ct,Math.min(Qt,tn)),Ve=Math.max(Qt,Math.min(ct,Ot))}else Xe=ct,Ve=Qt;if(ye>0){var qt,vt,Kt=Me[lt]*We;if(qt=Math.min(Math.max(it,Kt),Math.max(nt,Kt)),ct=Math.max(Xe,Kt),Qt=Math.max(Ve,Kt),vt=ct+Qt,vt>0&&qt*Pe<vt){var _n=qt*Pe/vt;ct*=_n,Qt*=_n}Xe=Math.min(ct,Xe),Ve=Math.min(Qt,Ve)}Xe>qe&&(Xe=qe),Ve>rt&&(Ve=rt),le[2][lt]=Xe,le[3][lt]=Ve}}this.L3psycho_anal_vbr=function(Q,le,we,Me,Te,ye,Ye,Pe,We,Ve){var Xe=Q.internal_flags,lt,qe,rt=qc(Yt.HBLKSIZE),it=Lp([3,Yt.HBLKSIZE_s]),nt=Lp([2,Yt.BLKSIZE]),ct=Lp([2,3,Yt.BLKSIZE_s]),Qt=Lp([4,Yt.CBANDS]),tn=Lp([4,Yt.CBANDS]),Ot=Lp([4,3]),qt=.6,vt=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Kt=Vb(2),_n=Q.mode==t.JOINT_STEREO?4:Xe.channels_out;Le(Q,le,we,Me,Te,ye,We,Ot,vt,Kt),Ae(Q,Kt);{for(var Wt=0;Wt<_n;Wt++){var dn=Wt&1;lt=nt,Be(Q,le,we,Wt,Me,rt,lt,dn),at(Q,Me,Wt,rt),Kt[dn]!=0?ve(Xe,rt,Qt[Wt],tn[Wt],Wt):Ue(Xe,Wt)}Kt[0]+Kt[1]==2&&Q.mode==t.JOINT_STEREO&&Ge(Qt,tn,Xe.mld_cb_l,Xe.ATH.cb_l,Q.ATHlower*Xe.ATH.adjust,Q.msfix,Xe.npart_l);for(var Wt=0;Wt<_n;Wt++){var dn=Wt&1;Kt[dn]!=0&&W(Xe,Qt[Wt],tn[Wt],Wt)}}{for(var Mn=0;Mn<3;Mn++){for(var Wt=0;Wt<_n;++Wt){var dn=Wt&1;Kt[dn]!=0?He(Xe,Wt,Mn):(qe=ct,Je(Q,le,we,Wt,Mn,it,qe,dn),fe(Q,it,Qt[Wt],tn[Wt],Wt,Mn))}Kt[0]+Kt[1]==0&&Q.mode==t.JOINT_STEREO&&Ge(Qt,tn,Xe.mld_cb_s,Xe.ATH.cb_s,Q.ATHlower*Xe.ATH.adjust,Q.msfix,Xe.npart_s);for(var Wt=0;Wt<_n;++Wt){var dn=Wt&1;Kt[dn]==0&&te(Xe,Qt[Wt],tn[Wt],Wt,Mn)}}for(var Wt=0;Wt<_n;Wt++){var dn=Wt&1;if(Kt[dn]==0)for(var Ln=0;Ln<Yt.SBMAX_s;Ln++){for(var is=qc(3),Mn=0;Mn<3;Mn++){var ni=Xe.thm[Wt].s[Ln][Mn];if(ni*=u,vt[Wt][Mn]>=2||vt[Wt][Mn+1]==1){var fi=Mn!=0?Mn-1:2,Ps=ne(Xe.thm[Wt].s[Ln][fi],ni,h*qt);ni=Math.min(ni,Ps)}else if(vt[Wt][Mn]==1){var fi=Mn!=0?Mn-1:2,Ps=ne(Xe.thm[Wt].s[Ln][fi],ni,d*qt);ni=Math.min(ni,Ps)}else if(Mn!=0&&vt[Wt][Mn-1]==3||Mn==0&&Xe.nsPsy.lastAttacks[Wt]==3){var fi=Mn!=2?Mn+1:0,Ps=ne(Xe.thm[Wt].s[Ln][fi],ni,d*qt);ni=Math.min(ni,Ps)}ni*=Ot[Wt][Mn],is[Mn]=ni}for(var Mn=0;Mn<3;Mn++)Xe.thm[Wt].s[Ln][Mn]=is[Mn]}}}for(var Wt=0;Wt<_n;Wt++)Xe.nsPsy.lastAttacks[Wt]=vt[Wt][2];pe(Q,Kt,Ve);for(var Wt=0;Wt<_n;Wt++){var Ds,zi,ds,ps;Wt>1?(Ds=Pe,zi=-2,ds=Yt.NORM_TYPE,(Ve[0]==Yt.SHORT_TYPE||Ve[1]==Yt.SHORT_TYPE)&&(ds=Yt.SHORT_TYPE),ps=ye[Me][Wt-2]):(Ds=Ye,zi=0,ds=Ve[Wt],ps=Te[Me][Wt]),ds==Yt.SHORT_TYPE?Ds[zi+Wt]=ae(ps,Xe.masking_lower):Ds[zi+Wt]=Ne(ps,Xe.masking_lower),Q.analysis&&(Xe.pinfo.pe[Me][Wt]=Ds[zi+Wt])}return 0};function Qe(Q,le){var we=Q,Me;return we>=0?Me=-we*27:Me=we*le,Me<=-72?0:Math.exp(Me*g)}function Ze(Q){var le=0,we=0;{var Me=0,Te,ye;for(Me=0;Qe(Me,Q)>1e-20;Me-=1);for(Te=Me,ye=0;Math.abs(ye-Te)>1e-12;)Me=(ye+Te)/2,Qe(Me,Q)>0?ye=Me:Te=Me;le=Te}{var Me=0,Te,ye;for(Me=0;Qe(Me,Q)>1e-20;Me+=1);for(Te=0,ye=Me;Math.abs(ye-Te)>1e-12;)Me=(ye+Te)/2,Qe(Me,Q)>0?Te=Me:ye=Me;we=ye}{var Ye=0,Pe=1e3,We;for(We=0;We<=Pe;++We){var Me=le+We*(we-le)/Pe,Ve=Qe(Me,Q);Ye+=Ve}{var Xe=(Pe+1)/(Ye*(we-le));return Xe}}}function tt(Q){var le,we,Me,Te;return le=Q,le>=0?le*=3:le*=1.5,le>=.5&&le<=2.5?(Te=le-.5,we=8*(Te*Te-2*Te)):we=0,le+=.474,Me=15.811389+7.5*le-17.5*Math.sqrt(1+le*le),Me<=-60?0:(le=Math.exp((we+Me)*g),le/=.6609193,le)}function Ft(Q){return Q<0&&(Q=0),Q=Q*.001,13*Math.atan(.76*Q)+3.5*Math.atan(Q*Q/(7.5*7.5))}function bt(Q,le,we,Me,Te,ye,Ye,Pe,We,Ve,Xe,lt){var qe=qc(Yt.CBANDS+1),rt=Pe/(lt>15?2*576:384),it=Vb(Yt.HBLKSIZE),nt;Pe/=We;var ct=0,Qt=0;for(nt=0;nt<Yt.CBANDS;nt++){var tn,Ot;for(tn=Ft(Pe*ct),qe[nt]=Pe*ct,Ot=ct;Ft(Pe*Ot)-tn<a&&Ot<=We/2;Ot++);for(Q[nt]=Ot-ct,Qt=nt+1;ct<Ot;)Xr(ct<Yt.HBLKSIZE),it[ct++]=nt;if(ct>We/2){ct=We/2,++nt;break}}Xr(nt<Yt.CBANDS),qe[nt]=Pe*ct;for(var qt=0;qt<lt;qt++){var vt,Kt,_n,Wt,dn;_n=Ve[qt],Wt=Ve[qt+1],vt=0|Math.floor(.5+Xe*(_n-.5)),vt<0&&(vt=0),Kt=0|Math.floor(.5+Xe*(Wt-.5)),Kt>We/2&&(Kt=We/2),we[qt]=(it[vt]+it[Kt])/2,le[qt]=it[Kt];var Mn=rt*Wt;Ye[qt]=(Mn-qe[le[qt]])/(qe[le[qt]+1]-qe[le[qt]]),Ye[qt]<0?Ye[qt]=0:Ye[qt]>1&&(Ye[qt]=1),dn=Ft(Pe*Ve[qt]*Xe),dn=Math.min(dn,15.5)/15.5,ye[qt]=Math.pow(10,1.25*(1-Math.cos(Math.PI*dn))-2.5)}ct=0;for(var Ln=0;Ln<Qt;Ln++){var is=Q[Ln],tn,ni;tn=Ft(Pe*ct),ni=Ft(Pe*(ct+is-1)),Me[Ln]=.5*(tn+ni),tn=Ft(Pe*(ct-.5)),ni=Ft(Pe*(ct+is-.5)),Te[Ln]=ni-tn,ct+=is}return Qt}function Mt(Q,le,we,Me,Te,ye){var Ye=Lp([Yt.CBANDS,Yt.CBANDS]),Pe,We=0;if(ye)for(var Ve=0;Ve<le;Ve++)for(Pe=0;Pe<le;Pe++){var Xe=tt(we[Ve]-we[Pe])*Me[Pe];Ye[Ve][Pe]=Xe*Te[Ve]}else for(Pe=0;Pe<le;Pe++)for(var lt=15+Math.min(21/we[Pe],12),qe=Ze(lt),Ve=0;Ve<le;Ve++){var Xe=qe*Qe(we[Ve]-we[Pe],lt)*Me[Pe];Ye[Ve][Pe]=Xe*Te[Ve]}for(var Ve=0;Ve<le;Ve++){for(Pe=0;Pe<le&&!(Ye[Ve][Pe]>0);Pe++);for(Q[Ve][0]=Pe,Pe=le-1;Pe>0&&!(Ye[Ve][Pe]>0);Pe--);Q[Ve][1]=Pe,We+=Q[Ve][1]-Q[Ve][0]+1}for(var rt=qc(We),it=0,Ve=0;Ve<le;Ve++)for(Pe=Q[Ve][0];Pe<=Q[Ve][1];Pe++)rt[it++]=Ye[Ve][Pe];return rt}function Ie(Q){var le=Ft(Q);return le=Math.min(le,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*le))-2.5)}this.psymodel_init=function(Q){var le=Q.internal_flags,we,Me=!0,Te=13,ye=24,Ye=0,Pe=0,We=-8.25,Ve=-4.5,Xe=qc(Yt.CBANDS),lt=qc(Yt.CBANDS),qe=qc(Yt.CBANDS),rt=Q.out_samplerate;switch(Q.experimentalZ){default:case 0:Me=!0;break;case 1:Me=!(Q.VBR==iS.vbr_mtrh||Q.VBR==iS.vbr_mt);break;case 2:Me=!1;break;case 3:Te=8,Ye=-1.75,Pe=-.0125,We=-8.25,Ve=-2.25;break}for(le.ms_ener_ratio_old=.25,le.blocktype_old[0]=le.blocktype_old[1]=Yt.NORM_TYPE,we=0;we<4;++we){for(var ct=0;ct<Yt.CBANDS;++ct)le.nb_1[we][ct]=1e20,le.nb_2[we][ct]=1e20,le.nb_s1[we][ct]=le.nb_s2[we][ct]=1;for(var it=0;it<Yt.SBMAX_l;it++)le.en[we].l[it]=1e20,le.thm[we].l[it]=1e20;for(var ct=0;ct<3;++ct){for(var it=0;it<Yt.SBMAX_s;it++)le.en[we].s[it][ct]=1e20,le.thm[we].s[it][ct]=1e20;le.nsPsy.lastAttacks[we]=0}for(var ct=0;ct<9;ct++)le.nsPsy.last_en_subshort[we][ct]=10}for(le.loudness_sq_save[0]=le.loudness_sq_save[1]=0,le.npart_l=bt(le.numlines_l,le.bo_l,le.bm_l,Xe,lt,le.mld_l,le.PSY.bo_l_weight,rt,Yt.BLKSIZE,le.scalefac_band.l,Yt.BLKSIZE/(2*576),Yt.SBMAX_l),Xr(le.npart_l<Yt.CBANDS),we=0;we<le.npart_l;we++){var nt=Ye;Xe[we]>=Te&&(nt=Pe*(Xe[we]-Te)/(ye-Te)+Ye*(ye-Xe[we])/(ye-Te)),qe[we]=Math.pow(10,nt/10),le.numlines_l[we]>0?le.rnumlines_l[we]=1/le.numlines_l[we]:le.rnumlines_l[we]=0}le.s3_ll=Mt(le.s3ind,le.npart_l,Xe,lt,qe,Me);var ct=0;for(we=0;we<le.npart_l;we++){var Qt;Qt=QY.MAX_VALUE;for(var tn=0;tn<le.numlines_l[we];tn++,ct++){var Ot=rt*ct/(1e3*Yt.BLKSIZE),qt;qt=this.ATHformula(Ot*1e3,Q)-20,qt=Math.pow(10,.1*qt),qt*=le.numlines_l[we],Qt>qt&&(Qt=qt)}le.ATH.cb_l[we]=Qt,Qt=-20+Xe[we]*20/10,Qt>6&&(Qt=100),Qt<-15&&(Qt=-15),Qt-=8,le.minval_l[we]=Math.pow(10,Qt/10)*le.numlines_l[we]}for(le.npart_s=bt(le.numlines_s,le.bo_s,le.bm_s,Xe,lt,le.mld_s,le.PSY.bo_s_weight,rt,Yt.BLKSIZE_s,le.scalefac_band.s,Yt.BLKSIZE_s/384,Yt.SBMAX_s),Xr(le.npart_s<Yt.CBANDS),ct=0,we=0;we<le.npart_s;we++){var Qt,nt=We;Xe[we]>=Te&&(nt=Ve*(Xe[we]-Te)/(ye-Te)+We*(ye-Xe[we])/(ye-Te)),qe[we]=Math.pow(10,nt/10),Qt=QY.MAX_VALUE;for(var tn=0;tn<le.numlines_s[we];tn++,ct++){var Ot=rt*ct/(1e3*Yt.BLKSIZE_s),qt;qt=this.ATHformula(Ot*1e3,Q)-20,qt=Math.pow(10,.1*qt),qt*=le.numlines_s[we],Qt>qt&&(Qt=qt)}le.ATH.cb_s[we]=Qt,Qt=-7+Xe[we]*7/12,Xe[we]>12&&(Qt*=1+Math.log(1+Qt)*3.1),Xe[we]<12&&(Qt*=1+Math.log(1-Qt)*2.3),Qt<-15&&(Qt=-15),Qt-=8,le.minval_s[we]=Math.pow(10,Qt/10)*le.numlines_s[we]}le.s3_ss=Mt(le.s3ind_s,le.npart_s,Xe,lt,qe,Me),z(),e.init_fft(le),le.decay=Math.exp(-1*n/(l*rt/192));{var vt;vt=m,Q.exp_nspsytune&2&&(vt=1),Math.abs(Q.msfix)>0&&(vt=Q.msfix),Q.msfix=vt;for(var Kt=0;Kt<le.npart_l;Kt++)le.s3ind[Kt][1]>le.npart_l-1&&(le.s3ind[Kt][1]=le.npart_l-1)}var _n=576*le.mode_gr/rt;if(le.ATH.decay=Math.pow(10,-12/10*_n),le.ATH.adjust=.01,le.ATH.adjustLimit=1,Xr(le.bo_l[Yt.SBMAX_l-1]<=le.npart_l),Xr(le.bo_s[Yt.SBMAX_s-1]<=le.npart_s),Q.ATHtype!=-1){var Ot,Wt=Q.out_samplerate/Yt.BLKSIZE,dn=0;for(Ot=0,we=0;we<Yt.BLKSIZE/2;++we)Ot+=Wt,le.ATH.eql_w[we]=1/Math.pow(10,this.ATHformula(Ot,Q)/10),dn+=le.ATH.eql_w[we];for(dn=1/dn,we=Yt.BLKSIZE/2;--we>=0;)le.ATH.eql_w[we]*=dn}{for(var Kt=ct=0;Kt<le.npart_s;++Kt)for(we=0;we<le.numlines_s[Kt];++we)++ct;for(var Kt=ct=0;Kt<le.npart_l;++Kt)for(we=0;we<le.numlines_l[Kt];++we)++ct}for(ct=0,we=0;we<le.npart_l;we++){var Ot=rt*(ct+le.numlines_l[we]/2)/(1*Yt.BLKSIZE);le.mld_cb_l[we]=Ie(Ot),ct+=le.numlines_l[we]}for(;we<Yt.CBANDS;++we)le.mld_cb_l[we]=1;for(ct=0,we=0;we<le.npart_s;we++){var Ot=rt*(ct+le.numlines_s[we]/2)/(1*Yt.BLKSIZE_s);le.mld_cb_s[we]=Ie(Ot),ct+=le.numlines_s[we]}for(;we<Yt.CBANDS;++we)le.mld_cb_s[we]=1;return 0};function ce(Q,le){Q<-.3&&(Q=3410),Q/=1e3,Q=Math.max(.1,Q);var we=3.64*Math.pow(Q,-.8)-6.8*Math.exp(-.6*Math.pow(Q-3.4,2))+6*Math.exp(-.15*Math.pow(Q-8.7,2))+(.6+.04*le)*.001*Math.pow(Q,4);return we}this.ATHformula=function(Q,le){var we;switch(le.ATHtype){case 0:we=ce(Q,9);break;case 1:we=ce(Q,-1);break;case 2:we=ce(Q,0);break;case 3:we=ce(Q,1)+6;break;case 4:we=ce(Q,le.ATHcurve);break;default:we=ce(Q,0);break}return we}}var hJe=fJe,dJe=m2;function pJe(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=dJe.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var mJe=pJe,gJe=df(),kfe={};kfe.SFBMAX=gJe.SBMAX_s*3;var LP=kfe,Ofe=Ta,_Je=Ofe.new_float,Gb=Ofe.new_int,Y4=LP;function vJe(){this.xr=_Je(576),this.l3_enc=Gb(576),this.scalefac=Gb(Y4.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=Gb(3),this.subblock_gain=Gb(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=Gb(Y4.SFBMAX),this.window=Gb(Y4.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=Gb(4),this.max_nonzero_coeff=0;var t=this;function e(r){return new Int32Array(r)}function n(r){return new Float32Array(r)}this.assign=function(r){t.xr=n(r.xr),t.l3_enc=e(r.l3_enc),t.scalefac=e(r.scalefac),t.xrpow_max=r.xrpow_max,t.part2_3_length=r.part2_3_length,t.big_values=r.big_values,t.count1=r.count1,t.global_gain=r.global_gain,t.scalefac_compress=r.scalefac_compress,t.block_type=r.block_type,t.mixed_block_flag=r.mixed_block_flag,t.table_select=e(r.table_select),t.subblock_gain=e(r.subblock_gain),t.region0_count=r.region0_count,t.region1_count=r.region1_count,t.preflag=r.preflag,t.scalefac_scale=r.scalefac_scale,t.count1table_select=r.count1table_select,t.part2_length=r.part2_length,t.sfb_lmax=r.sfb_lmax,t.sfb_smin=r.sfb_smin,t.psy_lmax=r.psy_lmax,t.sfbmax=r.sfbmax,t.psymax=r.psymax,t.sfbdivide=r.sfbdivide,t.width=e(r.width),t.window=e(r.window),t.count1bits=r.count1bits,t.sfb_partition_table=r.sfb_partition_table.slice(0),t.slen=e(r.slen),t.max_nonzero_coeff=r.max_nonzero_coeff}}var R9=vJe,yJe=Ta,eZ=yJe.new_int,bJe=R9;function EJe(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[eZ(4),eZ(4)];for(var t=0;t<2;t++)for(var e=0;e<2;e++)this.tt[t][e]=new bJe}var SJe=EJe,Ife=Ta,Hk=Ife.System,qk=Ife.new_int,Vk=df();function xJe(t,e,n,r){this.l=qk(1+Vk.SBMAX_l),this.s=qk(1+Vk.SBMAX_s),this.psfb21=qk(1+Vk.PSFB21),this.psfb12=qk(1+Vk.PSFB12);var i=this.l,s=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],Hk.arraycopy(this.arrL,0,i,0,Math.min(this.arrL.length,this.l.length)),Hk.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),Hk.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),Hk.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Nfe=xJe,C9=Ta,Z4=C9.new_float,TJe=C9.new_float_n,wJe=C9.new_int,tZ=df();function RJe(){this.last_en_subshort=TJe([4,9]),this.lastAttacks=wJe(4),this.pefirbuf=Z4(19),this.longfact=Z4(tZ.SBMAX_l),this.shortfact=Z4(tZ.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var CJe=RJe;function AJe(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var MJe=AJe,fT=Ta,kJe=fT.new_byte,OJe=fT.new_double,Up=fT.new_float,$b=fT.new_float_n,tg=fT.new_int,Gk=fT.new_int_n,IJe=SJe,NJe=Nfe,PJe=CJe,DJe=MJe,nZ=Afe(),Qa=df(),LJe=LP;Sv.MFSIZE=3*1152+Qa.ENCDELAY-Qa.MDCTDELAY;Sv.MAX_HEADER_BUF=256;Sv.MAX_BITS_PER_CHANNEL=4095;Sv.MAX_BITS_PER_GRANULE=7680;Sv.BPC=320;function Sv(){var t=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=$b([2,Sv.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new IJe,this.ms_ratio=Up(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=tg(2),this.CurrentStep=tg(2),this.masking_lower=0,this.bv_scf=tg(576),this.pseudohalf=tg(LJe.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*Sv.BPC+1),this.itime=OJe(2),this.sideinfo_len=0,this.sb_sample=$b([2,2,18,Qa.SBLIMIT]),this.amp_filter=Up(32);function e(){this.write_timing=0,this.ptr=0,this.buf=kJe(t)}this.header=new Array(Sv.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new NJe,this.minval_l=Up(Qa.CBANDS),this.minval_s=Up(Qa.CBANDS),this.nb_1=$b([4,Qa.CBANDS]),this.nb_2=$b([4,Qa.CBANDS]),this.nb_s1=$b([4,Qa.CBANDS]),this.nb_s2=$b([4,Qa.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Up(4),this.loudness_sq=$b([2,2]),this.loudness_sq_save=Up(2),this.mld_l=Up(Qa.SBMAX_l),this.mld_s=Up(Qa.SBMAX_s),this.bm_l=tg(Qa.SBMAX_l),this.bo_l=tg(Qa.SBMAX_l),this.bm_s=tg(Qa.SBMAX_s),this.bo_s=tg(Qa.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Gk([Qa.CBANDS,2]),this.s3ind_s=Gk([Qa.CBANDS,2]),this.numlines_s=tg(Qa.CBANDS),this.numlines_l=tg(Qa.CBANDS),this.rnumlines_l=Up(Qa.CBANDS),this.mld_cb_l=Up(Qa.CBANDS),this.mld_cb_s=Up(Qa.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Up(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=tg(2),this.nsPsy=new PJe,this.VBR_seek_table=new DJe,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Gk([16,5]),this.bitrate_blockType_Hist=Gk([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var n=0;n<this.en.length;n++)this.en[n]=new nZ;for(var n=0;n<this.thm.length;n++)this.thm[n]=new nZ;for(var n=0;n<this.header.length;n++)this.header[n]=new e}var UP=Sv,UJe=Ta,Wb=UJe.new_float,Kb=df();function BJe(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=Wb(Kb.SBMAX_l),this.s=Wb(Kb.SBMAX_s),this.psfb21=Wb(Kb.PSFB21),this.psfb12=Wb(Kb.PSFB12),this.cb_l=Wb(Kb.CBANDS),this.cb_s=Wb(Kb.CBANDS),this.eql_w=Wb(Kb.BLKSIZE/2)}var FJe=BJe,Pfe=Ta,Th=Pfe.System,rZ=Pfe.Arrays;ac.STEPS_per_dB=100;ac.MAX_dB=120;ac.GAIN_NOT_ENOUGH_SAMPLES=-24601;ac.GAIN_ANALYSIS_ERROR=0;ac.GAIN_ANALYSIS_OK=1;ac.INIT_GAIN_ANALYSIS_ERROR=0;ac.INIT_GAIN_ANALYSIS_OK=1;ac.YULE_ORDER=10;ac.MAX_ORDER=ac.YULE_ORDER;ac.MAX_SAMP_FREQ=48e3;ac.RMS_WINDOW_TIME_NUMERATOR=1;ac.RMS_WINDOW_TIME_DENOMINATOR=20;ac.MAX_SAMPLES_PER_WINDOW=ac.MAX_SAMP_FREQ*ac.RMS_WINDOW_TIME_NUMERATOR/ac.RMS_WINDOW_TIME_DENOMINATOR+1;function ac(){var t=64.82,e=.95,n=ac.RMS_WINDOW_TIME_NUMERATOR,r=ac.RMS_WINDOW_TIME_DENOMINATOR,i=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(h,d,m,p,g,y){for(;g--!=0;)m[p]=1e-10+h[d+0]*y[0]-m[p-1]*y[1]+h[d-1]*y[2]-m[p-2]*y[3]+h[d-2]*y[4]-m[p-3]*y[5]+h[d-3]*y[6]-m[p-4]*y[7]+h[d-4]*y[8]-m[p-5]*y[9]+h[d-5]*y[10]-m[p-6]*y[11]+h[d-6]*y[12]-m[p-7]*y[13]+h[d-7]*y[14]-m[p-8]*y[15]+h[d-8]*y[16]-m[p-9]*y[17]+h[d-9]*y[18]-m[p-10]*y[19]+h[d-10]*y[20],++p,++d}function a(h,d,m,p,g,y){for(;g--!=0;)m[p]=h[d+0]*y[0]-m[p-1]*y[1]+h[d-1]*y[2]-m[p-2]*y[3]+h[d-2]*y[4],++p,++d}function c(h,d){for(var m=0;m<MAX_ORDER;m++)h.linprebuf[m]=h.lstepbuf[m]=h.loutbuf[m]=h.rinprebuf[m]=h.rstepbuf[m]=h.routbuf[m]=0;switch(0|d){case 48e3:h.reqindex=0;break;case 44100:h.reqindex=1;break;case 32e3:h.reqindex=2;break;case 24e3:h.reqindex=3;break;case 22050:h.reqindex=4;break;case 16e3:h.reqindex=5;break;case 12e3:h.reqindex=6;break;case 11025:h.reqindex=7;break;case 8e3:h.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return h.sampleWindow=0|(d*n+r-1)/r,h.lsum=0,h.rsum=0,h.totsamp=0,rZ.ill(h.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(h,d){return c(h,d)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(h.linpre=MAX_ORDER,h.rinpre=MAX_ORDER,h.lstep=MAX_ORDER,h.rstep=MAX_ORDER,h.lout=MAX_ORDER,h.rout=MAX_ORDER,rZ.fill(h.B,0),INIT_GAIN_ANALYSIS_OK)};function l(h){return h*h}this.AnalyzeSamples=function(h,d,m,p,g,y,v){var x,E,C,A,k,M,I;if(y==0)return GAIN_ANALYSIS_OK;switch(I=0,k=y,v){case 1:p=d,g=m;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(y<MAX_ORDER?(Th.arraycopy(d,m,h.linprebuf,MAX_ORDER,y),Th.arraycopy(p,g,h.rinprebuf,MAX_ORDER,y)):(Th.arraycopy(d,m,h.linprebuf,MAX_ORDER,MAX_ORDER),Th.arraycopy(p,g,h.rinprebuf,MAX_ORDER,MAX_ORDER));k>0;){M=k>h.sampleWindow-h.totsamp?h.sampleWindow-h.totsamp:k,I<MAX_ORDER?(x=h.linpre+I,E=h.linprebuf,C=h.rinpre+I,A=h.rinprebuf,M>MAX_ORDER-I&&(M=MAX_ORDER-I)):(x=m+I,E=d,C=g+I,A=p),o(E,x,h.lstepbuf,h.lstep+h.totsamp,M,i[h.reqindex]),o(A,C,h.rstepbuf,h.rstep+h.totsamp,M,i[h.reqindex]),a(h.lstepbuf,h.lstep+h.totsamp,h.loutbuf,h.lout+h.totsamp,M,s[h.reqindex]),a(h.rstepbuf,h.rstep+h.totsamp,h.routbuf,h.rout+h.totsamp,M,s[h.reqindex]),x=h.lout+h.totsamp,E=h.loutbuf,C=h.rout+h.totsamp,A=h.routbuf;for(var z=M%8;z--!=0;)h.lsum+=l(E[x++]),h.rsum+=l(A[C++]);for(z=M/8;z--!=0;)h.lsum+=l(E[x+0])+l(E[x+1])+l(E[x+2])+l(E[x+3])+l(E[x+4])+l(E[x+5])+l(E[x+6])+l(E[x+7]),x+=8,h.rsum+=l(A[C+0])+l(A[C+1])+l(A[C+2])+l(A[C+3])+l(A[C+4])+l(A[C+5])+l(A[C+6])+l(A[C+7]),C+=8;if(k-=M,I+=M,h.totsamp+=M,h.totsamp==h.sampleWindow){var H=ac.STEPS_per_dB*10*Math.log10((h.lsum+h.rsum)/h.totsamp*.5+1e-37),K=H<=0?0:0|H;K>=h.A.length&&(K=h.A.length-1),h.A[K]++,h.lsum=h.rsum=0,Th.arraycopy(h.loutbuf,h.totsamp,h.loutbuf,0,MAX_ORDER),Th.arraycopy(h.routbuf,h.totsamp,h.routbuf,0,MAX_ORDER),Th.arraycopy(h.lstepbuf,h.totsamp,h.lstepbuf,0,MAX_ORDER),Th.arraycopy(h.rstepbuf,h.totsamp,h.rstepbuf,0,MAX_ORDER),h.totsamp=0}if(h.totsamp>h.sampleWindow)return GAIN_ANALYSIS_ERROR}return y<MAX_ORDER?(Th.arraycopy(h.linprebuf,y,h.linprebuf,0,MAX_ORDER-y),Th.arraycopy(h.rinprebuf,y,h.rinprebuf,0,MAX_ORDER-y),Th.arraycopy(d,m,h.linprebuf,MAX_ORDER-y,y),Th.arraycopy(p,g,h.rinprebuf,MAX_ORDER-y,y)):(Th.arraycopy(d,m+y-MAX_ORDER,h.linprebuf,0,MAX_ORDER),Th.arraycopy(p,g+y-MAX_ORDER,h.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function u(h,d){var m,p=0;for(m=0;m<d;m++)p+=h[m];if(p==0)return GAIN_NOT_ENOUGH_SAMPLES;var g=0|Math.ceil(p*(1-e));for(m=d;m-- >0&&!((g-=h[m])<=0););return t-m/ac.STEPS_per_dB}this.GetTitleGain=function(h){for(var d=u(h.A,h.A.length),m=0;m<h.A.length;m++)h.B[m]+=h.A[m],h.A[m]=0;for(var m=0;m<MAX_ORDER;m++)h.linprebuf[m]=h.lstepbuf[m]=h.loutbuf[m]=h.rinprebuf[m]=h.rstepbuf[m]=h.routbuf[m]=0;return h.totsamp=0,h.lsum=h.rsum=0,d}}var Dfe=ac,Lfe=Ta,oS=Lfe.new_float,iZ=Lfe.new_int,wh=Dfe;function jJe(){this.linprebuf=oS(wh.MAX_ORDER*2),this.linpre=0,this.lstepbuf=oS(wh.MAX_SAMPLES_PER_WINDOW+wh.MAX_ORDER),this.lstep=0,this.loutbuf=oS(wh.MAX_SAMPLES_PER_WINDOW+wh.MAX_ORDER),this.lout=0,this.rinprebuf=oS(wh.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=oS(wh.MAX_SAMPLES_PER_WINDOW+wh.MAX_ORDER),this.rstep=0,this.routbuf=oS(wh.MAX_SAMPLES_PER_WINDOW+wh.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=iZ(0|wh.STEPS_per_dB*wh.MAX_dB),this.B=iZ(0|wh.STEPS_per_dB*wh.MAX_dB)}var zJe=jJe;function HJe(t){this.bits=t}var Ufe=HJe,A9=Ta,sZ=A9.new_float,qJe=A9.new_int,oZ=A9.assert,VJe=Ufe,aZ=df(),GJe=LP,$Je=UP;function WJe(t){var e=t;this.quantize=e,this.iteration_loop=function(n,r,i,s){var o=n.internal_flags,a=sZ(GJe.SFBMAX),c=sZ(576),l=qJe(2),u=0,h,d=o.l3_side,m=new VJe(u);this.quantize.rv.ResvFrameBegin(n,m),u=m.bits;for(var p=0;p<o.mode_gr;p++){h=this.quantize.qupvt.on_pe(n,r,l,u,p,p),o.mode_ext==aZ.MPG_MD_MS_LR&&(this.quantize.ms_convert(o.l3_side,p),this.quantize.qupvt.reduce_side(l,i[p],u,h));for(var g=0;g<o.channels_out;g++){var y,v,x=d.tt[p][g];x.block_type!=aZ.SHORT_TYPE?(y=0,v=o.PSY.mask_adjust-y):(y=0,v=o.PSY.mask_adjust_short-y),o.masking_lower=Math.pow(10,v*.1),this.quantize.init_outer_loop(o,x),this.quantize.init_xrpow(o,x,c)&&(this.quantize.qupvt.calc_xmin(n,s[p][g],x,a),this.quantize.outer_loop(n,x,a,c,g,l[g])),this.quantize.iteration_finish_one(o,p,g),oZ(x.part2_3_length<=$Je.MAX_BITS_PER_CHANNEL),oZ(x.part2_3_length<=l[g])}}this.quantize.rv.ResvFrameEnd(o,u)}}var KJe=WJe;function us(t,e,n,r){this.xlen=t,this.linmax=e,this.table=n,this.hlen=r}var cn={};cn.t1HB=[1,1,1,0];cn.t2HB=[1,2,1,3,1,1,3,2,0];cn.t3HB=[3,2,1,1,1,1,3,2,0];cn.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];cn.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];cn.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];cn.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];cn.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];cn.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];cn.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];cn.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];cn.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];cn.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];cn.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];cn.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];cn.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];cn.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];cn.t1l=[1,4,3,5];cn.t2l=[1,4,7,4,5,7,6,7,8];cn.t3l=[2,3,7,4,4,7,6,7,8];cn.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];cn.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];cn.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];cn.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];cn.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];cn.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];cn.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];cn.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];cn.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];cn.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];cn.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];cn.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];cn.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];cn.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];cn.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];cn.ht=[new us(0,0,null,null),new us(2,0,cn.t1HB,cn.t1l),new us(3,0,cn.t2HB,cn.t2l),new us(3,0,cn.t3HB,cn.t3l),new us(0,0,null,null),new us(4,0,cn.t5HB,cn.t5l),new us(4,0,cn.t6HB,cn.t6l),new us(6,0,cn.t7HB,cn.t7l),new us(6,0,cn.t8HB,cn.t8l),new us(6,0,cn.t9HB,cn.t9l),new us(8,0,cn.t10HB,cn.t10l),new us(8,0,cn.t11HB,cn.t11l),new us(8,0,cn.t12HB,cn.t12l),new us(16,0,cn.t13HB,cn.t13l),new us(0,0,null,cn.t16_5l),new us(16,0,cn.t15HB,cn.t15l),new us(1,1,cn.t16HB,cn.t16l),new us(2,3,cn.t16HB,cn.t16l),new us(3,7,cn.t16HB,cn.t16l),new us(4,15,cn.t16HB,cn.t16l),new us(6,63,cn.t16HB,cn.t16l),new us(8,255,cn.t16HB,cn.t16l),new us(10,1023,cn.t16HB,cn.t16l),new us(13,8191,cn.t16HB,cn.t16l),new us(4,15,cn.t24HB,cn.t24l),new us(5,31,cn.t24HB,cn.t24l),new us(6,63,cn.t24HB,cn.t24l),new us(7,127,cn.t24HB,cn.t24l),new us(8,255,cn.t24HB,cn.t24l),new us(9,511,cn.t24HB,cn.t24l),new us(11,2047,cn.t24HB,cn.t24l),new us(13,8191,cn.t24HB,cn.t24l),new us(0,0,cn.t32HB,cn.t32l),new us(0,0,cn.t33HB,cn.t33l)];cn.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];cn.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];cn.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];cn.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];cn.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];cn.scfsi_band=[0,6,11,16,21];var M9=cn,J4,cZ;function Bfe(){if(cZ)return J4;cZ=1;var t=Nfe,e=Ta,n=e.VbrMode,r=e.Float,i=e.Util,s=e.new_float,o=e.new_int,a=e.assert,c=df(),l=Ufe,u=UP;h.Q_MAX=257,h.Q_MAX2=116,h.LARGE_BITS=1e5,h.IXMAX_VAL=8206;function h(){var d=k9(),m=null,p=null,g=null;this.setModules=function(X,G,j){m=X,p=G,g=j};function y(X){return a(0<=X+h.Q_MAX2&&X<h.Q_MAX),I[X+h.Q_MAX2]}this.IPOW20=function(X){return a(0<=X&&X<h.Q_MAX),z[X]};var v=2220446049250313e-31,x=h.IXMAX_VAL,E=x+2,C=h.Q_MAX,A=h.Q_MAX2;h.LARGE_BITS;var k=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var M=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=M,this.sfBandIndex=[new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var I=s(C+A+1),z=s(C),H=s(E),K=s(E);this.adj43=K;function P(X,G){var j=g.ATHformula(G,X);return j-=k,j=Math.pow(10,j/10+X.ATHlower),j}function F(X){for(var G=X.internal_flags.ATH.l,j=X.internal_flags.ATH.psfb21,q=X.internal_flags.ATH.s,te=X.internal_flags.ATH.psfb12,W=X.internal_flags,$=X.out_samplerate,J=0;J<c.SBMAX_l;J++){var ne=W.scalefac_band.l[J],ie=W.scalefac_band.l[J+1];G[J]=r.MAX_VALUE;for(var ae=ne;ae<ie;ae++){var xe=ae*$/1152,Ne=P(X,xe);G[J]=Math.min(G[J],Ne)}}for(var J=0;J<c.PSFB21;J++){var ne=W.scalefac_band.psfb21[J],ie=W.scalefac_band.psfb21[J+1];j[J]=r.MAX_VALUE;for(var ae=ne;ae<ie;ae++){var xe=ae*$/1152,Ne=P(X,xe);j[J]=Math.min(j[J],Ne)}}for(var J=0;J<c.SBMAX_s;J++){var ne=W.scalefac_band.s[J],ie=W.scalefac_band.s[J+1];q[J]=r.MAX_VALUE;for(var ae=ne;ae<ie;ae++){var xe=ae*$/384,Ne=P(X,xe);q[J]=Math.min(q[J],Ne)}q[J]*=W.scalefac_band.s[J+1]-W.scalefac_band.s[J]}for(var J=0;J<c.PSFB12;J++){var ne=W.scalefac_band.psfb12[J],ie=W.scalefac_band.psfb12[J+1];te[J]=r.MAX_VALUE;for(var ae=ne;ae<ie;ae++){var xe=ae*$/384,Ne=P(X,xe);te[J]=Math.min(te[J],Ne)}te[J]*=W.scalefac_band.s[13]-W.scalefac_band.s[12]}if(X.noATH){for(var J=0;J<c.SBMAX_l;J++)G[J]=1e-20;for(var J=0;J<c.PSFB21;J++)j[J]=1e-20;for(var J=0;J<c.SBMAX_s;J++)q[J]=1e-20;for(var J=0;J<c.PSFB12;J++)te[J]=1e-20}W.ATH.floor=10*Math.log10(P(X,-1))}this.iteration_init=function(X){var G=X.internal_flags,j=G.l3_side,q;if(G.iteration_init_init==0){for(G.iteration_init_init=1,j.main_data_begin=0,F(X),H[0]=0,q=1;q<E;q++)H[q]=Math.pow(q,4/3);for(q=0;q<E-1;q++)K[q]=q+1-Math.pow(.5*(H[q]+H[q+1]),.75);for(K[q]=.5,q=0;q<C;q++)z[q]=Math.pow(2,(q-210)*-.1875);for(q=0;q<=C+A;q++)I[q]=Math.pow(2,(q-210-A)*.25);m.huffman_init(G);{var te,W,$,J;for(q=X.exp_nspsytune>>2&63,q>=32&&(q-=64),te=Math.pow(10,q/4/10),q=X.exp_nspsytune>>8&63,q>=32&&(q-=64),W=Math.pow(10,q/4/10),q=X.exp_nspsytune>>14&63,q>=32&&(q-=64),$=Math.pow(10,q/4/10),q=X.exp_nspsytune>>20&63,q>=32&&(q-=64),J=$*Math.pow(10,q/4/10),q=0;q<c.SBMAX_l;q++){var ne;q<=6?ne=te:q<=13?ne=W:q<=20?ne=$:ne=J,G.nsPsy.longfact[q]=ne}for(q=0;q<c.SBMAX_s;q++){var ne;q<=5?ne=te:q<=10?ne=W:q<=11?ne=$:ne=J,G.nsPsy.shortfact[q]=ne}}}},this.on_pe=function(X,G,j,q,te,W){var $=X.internal_flags,J=0,ne,ie=o(2),ae,xe=new l(J),Ne=p.ResvMaxBits(X,q,xe,W);J=xe.bits;var Re=J+Ne;for(Re>u.MAX_BITS_PER_GRANULE&&(Re=u.MAX_BITS_PER_GRANULE),ne=0,ae=0;ae<$.channels_out;++ae)j[ae]=Math.min(u.MAX_BITS_PER_CHANNEL,J/$.channels_out),ie[ae]=0|j[ae]*G[te][ae]/700-j[ae],ie[ae]>q*3/4&&(ie[ae]=q*3/4),ie[ae]<0&&(ie[ae]=0),ie[ae]+j[ae]>u.MAX_BITS_PER_CHANNEL&&(ie[ae]=Math.max(0,u.MAX_BITS_PER_CHANNEL-j[ae])),ne+=ie[ae];if(ne>Ne)for(ae=0;ae<$.channels_out;++ae)ie[ae]=Ne*ie[ae]/ne;for(ae=0;ae<$.channels_out;++ae)j[ae]+=ie[ae],Ne-=ie[ae];for(ne=0,ae=0;ae<$.channels_out;++ae)ne+=j[ae];if(ne>u.MAX_BITS_PER_GRANULE){var Se=0;for(ae=0;ae<$.channels_out;++ae)j[ae]*=u.MAX_BITS_PER_GRANULE,j[ae]/=ne,Se+=j[ae]}return Re},this.reduce_side=function(X,G,j,q){a(X[0]+X[1]<=u.MAX_BITS_PER_GRANULE);var te=.33*(.5-G)/.5;te<0&&(te=0),te>.5&&(te=.5);var W=0|te*.5*(X[0]+X[1]);W>u.MAX_BITS_PER_CHANNEL-X[0]&&(W=u.MAX_BITS_PER_CHANNEL-X[0]),W<0&&(W=0),X[1]>=125&&(X[1]-W>125?(X[0]<j&&(X[0]+=W),X[1]-=W):(X[0]+=X[1]-125,X[1]=125)),W=X[0]+X[1],W>q&&(X[0]=q*X[0]/W,X[1]=q*X[1]/W),a(X[0]<=u.MAX_BITS_PER_CHANNEL),a(X[1]<=u.MAX_BITS_PER_CHANNEL),a(X[0]+X[1]<=u.MAX_BITS_PER_GRANULE)},this.athAdjust=function(X,G,j){var q=90.30873362,te=94.82444863,W=i.FAST_LOG10_X(G,10),$=X*X,J=0;return W-=j,$>1e-20&&(J=1+i.FAST_LOG10_X($,10/q)),J<0&&(J=0),W*=J,W+=j+q-te,Math.pow(10,.1*W)},this.calc_xmin=function(X,G,j,q){var te=0,W=X.internal_flags,$,J=0,ne=0,ie=W.ATH,ae=j.xr,xe=X.VBR==n.vbr_mtrh?1:0,Ne=W.masking_lower;for((X.VBR==n.vbr_mtrh||X.VBR==n.vbr_mt)&&(Ne=1),$=0;$<j.psy_lmax;$++){var Re,Se,ze,Be,Je,at;X.VBR==n.vbr_rh||X.VBR==n.vbr_mtrh?Se=athAdjust(ie.adjust,ie.l[$],ie.floor):Se=ie.adjust*ie.l[$],Je=j.width[$],ze=Se/Je,Be=v,at=Je>>1,Re=0;do{var re,Le;re=ae[J]*ae[J],Re+=re,Be+=re<ze?re:ze,J++,Le=ae[J]*ae[J],Re+=Le,Be+=Le<ze?Le:ze,J++}while(--at>0);if(Re>Se&&ne++,$==c.SBPSY_l){var He=Se*W.nsPsy.longfact[$];Be<He&&(Be=He)}if(xe!=0&&(Se=Be),!X.ATHonly){var Ue=G.en.l[$];if(Ue>0){var He;He=Re*G.thm.l[$]*Ne/Ue,xe!=0&&(He*=W.nsPsy.longfact[$]),Se<He&&(Se=He)}}xe!=0?q[te++]=Se:q[te++]=Se*W.nsPsy.longfact[$]}var De=575;if(j.block_type!=c.SHORT_TYPE)for(var fe=576;fe--!=0&&d.EQ(ae[fe],0);)De=fe;j.max_nonzero_coeff=De;for(var ve=j.sfb_smin;$<j.psymax;ve++,$+=3){var Je,Ae,pe;for(X.VBR==n.vbr_rh||X.VBR==n.vbr_mtrh?pe=athAdjust(ie.adjust,ie.s[ve],ie.floor):pe=ie.adjust*ie.s[ve],Je=j.width[$],Ae=0;Ae<3;Ae++){var Re=0,Se,ze,Be,at=Je>>1;ze=pe/Je,Be=v;do{var re,Le;re=ae[J]*ae[J],Re+=re,Be+=re<ze?re:ze,J++,Le=ae[J]*ae[J],Re+=Le,Be+=Le<ze?Le:ze,J++}while(--at>0);if(Re>pe&&ne++,ve==c.SBPSY_s){var He=pe*W.nsPsy.shortfact[ve];Be<He&&(Be=He)}if(xe!=0?Se=Be:Se=pe,!X.ATHonly&&!X.ATHshort){var Ue=G.en.s[ve][Ae];if(Ue>0){var He;He=Re*G.thm.s[ve][Ae]*Ne/Ue,xe!=0&&(He*=W.nsPsy.shortfact[ve]),Se<He&&(Se=He)}}xe!=0?q[te++]=Se:q[te++]=Se*W.nsPsy.shortfact[ve]}X.useTemporal&&(q[te-3]>q[te-3+1]&&(q[te-3+1]+=(q[te-3]-q[te-3+1])*W.decay),q[te-3+1]>q[te-3+2]&&(q[te-3+2]+=(q[te-3+1]-q[te-3+2])*W.decay))}return ne};function N(X){this.s=X}this.calc_noise_core=function(X,G,j,q){var te=0,W=G.s,$=X.l3_enc;if(W>X.count1)for(;j--!=0;){var J;J=X.xr[W],W++,te+=J*J,J=X.xr[W],W++,te+=J*J}else if(W>X.big_values){var ne=s(2);for(ne[0]=0,ne[1]=q;j--!=0;){var J;J=Math.abs(X.xr[W])-ne[$[W]],W++,te+=J*J,J=Math.abs(X.xr[W])-ne[$[W]],W++,te+=J*J}}else for(;j--!=0;){var J;J=Math.abs(X.xr[W])-H[$[W]]*q,W++,te+=J*J,J=Math.abs(X.xr[W])-H[$[W]]*q,W++,te+=J*J}return G.s=W,te},this.calc_noise=function(X,G,j,q,te){var W=0,$=0,J,ne,ie=0,ae=0,xe=0,Ne=-20,Re=0,Se=X.scalefac,ze=0;for(q.over_SSD=0,J=0;J<X.psymax;J++){var Be=X.global_gain-(Se[ze++]+(X.preflag!=0?M[J]:0)<<X.scalefac_scale+1)-X.subblock_gain[X.window[J]]*8,Je=0;if(te!=null&&te.step[J]==Be)Je=te.noise[J],Re+=X.width[J],j[W++]=Je/G[$++],Je=te.noise_log[J];else{var at=y(Be);if(ne=X.width[J]>>1,Re+X.width[J]>X.max_nonzero_coeff){var re;re=X.max_nonzero_coeff-Re+1,re>0?ne=re>>1:ne=0}var Le=new N(Re);Je=this.calc_noise_core(X,Le,ne,at),Re=Le.s,te!=null&&(te.step[J]=Be,te.noise[J]=Je),Je=j[W++]=Je/G[$++],Je=i.FAST_LOG10(Math.max(Je,1e-20)),te!=null&&(te.noise_log[J]=Je)}if(te!=null&&(te.global_gain=X.global_gain),xe+=Je,Je>0){var He;He=Math.max(0|Je*10+.5,1),q.over_SSD+=He*He,ie++,ae+=Je}Ne=Math.max(Ne,Je)}return q.over_count=ie,q.tot_noise=xe,q.over_noise=ae,q.max_noise=Ne,ie},this.set_pinfo=function(X,G,j,q,te){var W=X.internal_flags,$,J,ne,ie,ae,xe=G.scalefac_scale==0?.5:1,Ne=G.scalefac,Re=s(L3Side.SFBMAX),Se=s(L3Side.SFBMAX),ze=new CalcNoiseResult;calc_xmin(X,j,G,Re),calc_noise(G,Re,Se,ze,null);var Be=0;for(J=G.sfb_lmax,G.block_type!=c.SHORT_TYPE&&G.mixed_block_flag==0&&(J=22),$=0;$<J;$++){var Je=W.scalefac_band.l[$],at=W.scalefac_band.l[$+1],re=at-Je;for(ie=0;Be<at;Be++)ie+=G.xr[Be]*G.xr[Be];ie/=re,ae=1e15,W.pinfo.en[q][te][$]=ae*ie,W.pinfo.xfsf[q][te][$]=ae*Re[$]*Se[$]/re,j.en.l[$]>0&&!X.ATHonly?ie=ie/j.en.l[$]:ie=0,W.pinfo.thr[q][te][$]=ae*Math.max(ie*j.thm.l[$],W.ATH.l[$]),W.pinfo.LAMEsfb[q][te][$]=0,G.preflag!=0&&$>=11&&(W.pinfo.LAMEsfb[q][te][$]=-xe*M[$]),$<c.SBPSY_l&&(a(Ne[$]>=0),W.pinfo.LAMEsfb[q][te][$]-=xe*Ne[$])}if(G.block_type==c.SHORT_TYPE)for(J=$,$=G.sfb_smin;$<c.SBMAX_s;$++)for(var Je=W.scalefac_band.s[$],at=W.scalefac_band.s[$+1],re=at-Je,Le=0;Le<3;Le++){for(ie=0,ne=Je;ne<at;ne++)ie+=G.xr[Be]*G.xr[Be],Be++;ie=Math.max(ie/re,1e-20),ae=1e15,W.pinfo.en_s[q][te][3*$+Le]=ae*ie,W.pinfo.xfsf_s[q][te][3*$+Le]=ae*Re[J]*Se[J]/re,j.en.s[$][Le]>0?ie=ie/j.en.s[$][Le]:ie=0,(X.ATHonly||X.ATHshort)&&(ie=0),W.pinfo.thr_s[q][te][3*$+Le]=ae*Math.max(ie*j.thm.s[$][Le],W.ATH.s[$]),W.pinfo.LAMEsfb_s[q][te][3*$+Le]=-2*G.subblock_gain[Le],$<c.SBPSY_s&&(W.pinfo.LAMEsfb_s[q][te][3*$+Le]-=xe*Ne[J]),J++}W.pinfo.LAMEqss[q][te]=G.global_gain,W.pinfo.LAMEmainbits[q][te]=G.part2_3_length+G.part2_length,W.pinfo.LAMEsfbits[q][te]=G.part2_length,W.pinfo.over[q][te]=ze.over_count,W.pinfo.max_noise[q][te]=ze.max_noise*10,W.pinfo.over_noise[q][te]=ze.over_noise*10,W.pinfo.tot_noise[q][te]=ze.tot_noise*10,W.pinfo.over_SSD[q][te]=ze.over_SSD}}return J4=h,J4}var Q4,lZ;function Ffe(){if(lZ)return Q4;lZ=1;var t=Ta,e=t.System,n=t.Arrays,r=t.new_int,i=t.assert,s=df(),o=M9,a=R9,c=Bfe();function l(){var u=null;this.qupvt=null,this.setModules=function(W){this.qupvt=W,u=W};function h(W){this.bits=0|W}var d=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function m(W,$,J,ne,ie,ae){var xe=.5946/$;for(W=W>>1;W--!=0;)ie[ae++]=xe>J[ne++]?0:1,ie[ae++]=xe>J[ne++]?0:1}function p(W,$,J,ne,ie,ae){W=W>>1;var xe=W%2;for(W=W>>1;W--!=0;){var Ne,Re,Se,ze,Be,Je,at,re;Ne=J[ne++]*$,Re=J[ne++]*$,Be=0|Ne,Se=J[ne++]*$,Je=0|Re,ze=J[ne++]*$,at=0|Se,Ne+=u.adj43[Be],re=0|ze,Re+=u.adj43[Je],ie[ae++]=0|Ne,Se+=u.adj43[at],ie[ae++]=0|Re,ze+=u.adj43[re],ie[ae++]=0|Se,ie[ae++]=0|ze}if(xe!=0){var Ne,Re,Be,Je;Ne=J[ne++]*$,Re=J[ne++]*$,Be=0|Ne,Je=0|Re,Ne+=u.adj43[Be],Re+=u.adj43[Je],ie[ae++]=0|Ne,ie[ae++]=0|Re}}function g(W,$,J,ne,ie){var ae,xe,Ne=0,Re,Se=0,ze=0,Be=0,Je=$,at=0,re=Je,Le=0,He=W,Ue=0;for(Re=ie!=null&&ne.global_gain==ie.global_gain,ne.block_type==s.SHORT_TYPE?xe=38:xe=21,ae=0;ae<=xe;ae++){var De=-1;if((Re||ne.block_type==s.NORM_TYPE)&&(De=ne.global_gain-(ne.scalefac[ae]+(ne.preflag!=0?u.pretab[ae]:0)<<ne.scalefac_scale+1)-ne.subblock_gain[ne.window[ae]]*8),i(ne.width[ae]>=0),Re&&ie.step[ae]==De)Se!=0&&(p(Se,J,He,Ue,re,Le),Se=0),ze!=0&&(m(ze,J,He,Ue,re,Le),ze=0);else{var fe=ne.width[ae];if(Ne+ne.width[ae]>ne.max_nonzero_coeff){var ve;ve=ne.max_nonzero_coeff-Ne+1,n.fill($,ne.max_nonzero_coeff,576,0),fe=ve,fe<0&&(fe=0),ae=xe+1}if(Se==0&&ze==0&&(re=Je,Le=at,He=W,Ue=Be),ie!=null&&ie.sfb_count1>0&&ae>=ie.sfb_count1&&ie.step[ae]>0&&De>=ie.step[ae]?(Se!=0&&(p(Se,J,He,Ue,re,Le),Se=0,re=Je,Le=at,He=W,Ue=Be),ze+=fe):(ze!=0&&(m(ze,J,He,Ue,re,Le),ze=0,re=Je,Le=at,He=W,Ue=Be),Se+=fe),fe<=0){ze!=0&&(m(ze,J,He,Ue,re,Le),ze=0),Se!=0&&(p(Se,J,He,Ue,re,Le),Se=0);break}}ae<=xe&&(at+=ne.width[ae],Be+=ne.width[ae],Ne+=ne.width[ae])}Se!=0&&(p(Se,J,He,Ue,re,Le),Se=0),ze!=0&&(m(ze,J,He,Ue,re,Le),ze=0)}function y(W,$,J){var ne=0,ie=0;do{var ae=W[$++],xe=W[$++];ne<ae&&(ne=ae),ie<xe&&(ie=xe)}while($<J);return ne<ie&&(ne=ie),ne}function v(W,$,J,ne,ie,ae){var xe=o.ht[ne].xlen*65536+o.ht[ie].xlen,Ne=0,Re;do{var Se=W[$++],ze=W[$++];Se!=0&&(Se>14&&(Se=15,Ne+=xe),Se*=16),ze!=0&&(ze>14&&(ze=15,Ne+=xe),Se+=ze),Ne+=o.largetbl[Se]}while($<J);return Re=Ne&65535,Ne>>=16,Ne>Re&&(Ne=Re,ne=ie),ae.bits+=Ne,ne}function x(W,$,J,ne){var ie=0,ae=o.ht[1].hlen;do{var xe=W[$+0]*2+W[$+1];$+=2,ie+=ae[xe]}while($<J);return ne.bits+=ie,1}function E(W,$,J,ne,ie){var ae=0,xe,Ne=o.ht[ne].xlen,Re;ne==2?Re=o.table23:Re=o.table56;do{var Se=W[$+0]*Ne+W[$+1];$+=2,ae+=Re[Se]}while($<J);return xe=ae&65535,ae>>=16,ae>xe&&(ae=xe,ne++),ie.bits+=ae,ne}function C(W,$,J,ne,ie){var ae=0,xe=0,Ne=0,Re=o.ht[ne].xlen,Se=o.ht[ne].hlen,ze=o.ht[ne+1].hlen,Be=o.ht[ne+2].hlen;do{var Je=W[$+0]*Re+W[$+1];$+=2,ae+=Se[Je],xe+=ze[Je],Ne+=Be[Je]}while($<J);var at=ne;return ae>xe&&(ae=xe,at++),ae>Ne&&(ae=Ne,at=ne+2),ie.bits+=ae,at}var A=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function k(W,$,J,ne){var ie=y(W,$,J);switch(ie){case 0:return ie;case 1:return x(W,$,J,ne);case 2:case 3:return E(W,$,J,A[ie-1],ne);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return C(W,$,J,A[ie-1],ne);default:if(ie>c.IXMAX_VAL)return ne.bits=c.LARGE_BITS,-1;ie-=15;var ae;for(ae=24;ae<32&&!(o.ht[ae].linmax>=ie);ae++);var xe;for(xe=ae-8;xe<24&&!(o.ht[xe].linmax>=ie);xe++);return v(W,$,J,xe,ae,ne)}}this.noquant_count_bits=function(W,$,J){var ne=$.l3_enc,ie=Math.min(576,$.max_nonzero_coeff+2>>1<<1);for(J!=null&&(J.sfb_count1=0);ie>1&&!(ne[ie-1]|ne[ie-2]);ie-=2);$.count1=ie;for(var ae=0,xe=0;ie>3;ie-=4){var Ne;if(((ne[ie-1]|ne[ie-2]|ne[ie-3]|ne[ie-4])&2147483647)>1)break;Ne=((ne[ie-4]*2+ne[ie-3])*2+ne[ie-2])*2+ne[ie-1],ae+=o.t32l[Ne],xe+=o.t33l[Ne]}var Re=ae;if($.count1table_select=0,ae>xe&&(Re=xe,$.count1table_select=1),$.count1bits=Re,$.big_values=ie,ie==0)return Re;if($.block_type==s.SHORT_TYPE)ae=3*W.scalefac_band.s[3],ae>$.big_values&&(ae=$.big_values),xe=$.big_values;else if($.block_type==s.NORM_TYPE){if(ae=$.region0_count=W.bv_scf[ie-2],xe=$.region1_count=W.bv_scf[ie-1],i(ae+xe+2<s.SBPSY_l),xe=W.scalefac_band.l[ae+xe+2],ae=W.scalefac_band.l[ae+1],xe<ie){var Se=new h(Re);$.table_select[2]=k(ne,xe,ie,Se),Re=Se.bits}}else $.region0_count=7,$.region1_count=s.SBMAX_l-1-7-1,ae=W.scalefac_band.l[8],xe=ie,ae>xe&&(ae=xe);if(ae=Math.min(ae,ie),xe=Math.min(xe,ie),0<ae){var Se=new h(Re);$.table_select[0]=k(ne,0,ae,Se),Re=Se.bits}if(ae<xe){var Se=new h(Re);$.table_select[1]=k(ne,ae,xe,Se),Re=Se.bits}if(W.use_best_huffman==2&&($.part2_3_length=Re,best_huffman_divide(W,$),Re=$.part2_3_length),J!=null&&$.block_type==s.NORM_TYPE){for(var ze=0;W.scalefac_band.l[ze]<$.big_values;)ze++;J.sfb_count1=ze}return Re},this.count_bits=function(W,$,J,ne){var ie=J.l3_enc,ae=c.IXMAX_VAL/u.IPOW20(J.global_gain);if(J.xrpow_max>ae)return c.LARGE_BITS;if(g($,ie,u.IPOW20(J.global_gain),J,ne),W.substep_shaping&2)for(var xe=0,Ne=J.global_gain+J.scalefac_scale,Re=.634521682242439/u.IPOW20(Ne),Se=0;Se<J.sfbmax;Se++){var ze=J.width[Se];if(W.pseudohalf[Se]==0)xe+=ze;else{var Be;for(Be=xe,xe+=ze;Be<xe;++Be)ie[Be]=$[Be]>=Re?ie[Be]:0}}return this.noquant_count_bits(W,J,ne)};function M(W,$,J,ne,ie,ae,xe){for(var Ne=$.big_values,Re=0;Re<=22;Re++)ne[Re]=c.LARGE_BITS;for(var Re=0;Re<16;Re++){var Se=W.scalefac_band.l[Re+1];if(Se>=Ne)break;var ze=0,Be=new h(ze),Je=k(J,0,Se,Be);ze=Be.bits;for(var at=0;at<8;at++){var re=W.scalefac_band.l[Re+at+2];if(re>=Ne)break;var Le=ze;Be=new h(Le);var He=k(J,Se,re,Be);Le=Be.bits,ne[Re+at]>Le&&(ne[Re+at]=Le,ie[Re+at]=Re,ae[Re+at]=Je,xe[Re+at]=He)}}}function I(W,$,J,ne,ie,ae,xe,Ne){for(var Re=$.big_values,Se=2;Se<s.SBMAX_l+1;Se++){var ze=W.scalefac_band.l[Se];if(ze>=Re)break;var Be=ie[Se-2]+$.count1bits;if(J.part2_3_length<=Be)break;var Je=new h(Be),at=k(ne,ze,Re,Je);Be=Je.bits,!(J.part2_3_length<=Be)&&(J.assign($),J.part2_3_length=Be,J.region0_count=ae[Se-2],J.region1_count=Se-2-ae[Se-2],J.table_select[0]=xe[Se-2],J.table_select[1]=Ne[Se-2],J.table_select[2]=at)}}this.best_huffman_divide=function(W,$){var J=new a,ne=$.l3_enc,ie=r(23),ae=r(23),xe=r(23),Ne=r(23);if(!($.block_type==s.SHORT_TYPE&&W.mode_gr==1)){J.assign($),$.block_type==s.NORM_TYPE&&(M(W,$,ne,ie,ae,xe,Ne),I(W,J,$,ne,ie,ae,xe,Ne));var Re=J.big_values;if(!(Re==0||(ne[Re-2]|ne[Re-1])>1)&&(Re=$.count1+2,!(Re>576))){J.assign($),J.count1=Re;for(var Se=0,ze=0;Re>J.big_values;Re-=4){var Be=((ne[Re-4]*2+ne[Re-3])*2+ne[Re-2])*2+ne[Re-1];Se+=o.t32l[Be],ze+=o.t33l[Be]}if(J.big_values=Re,J.count1table_select=0,Se>ze&&(Se=ze,J.count1table_select=1),J.count1bits=Se,J.block_type==s.NORM_TYPE)I(W,J,$,ne,ie,ae,xe,Ne);else{if(J.part2_3_length=Se,Se=W.scalefac_band.l[8],Se>Re&&(Se=Re),Se>0){var Je=new h(J.part2_3_length);J.table_select[0]=k(ne,0,Se,Je),J.part2_3_length=Je.bits}if(Re>Se){var Je=new h(J.part2_3_length);J.table_select[1]=k(ne,Se,Re,Je),J.part2_3_length=Je.bits}$.part2_3_length>J.part2_3_length&&$.assign(J)}}}};var z=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],H=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],K=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],P=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];l.slen1_tab=K,l.slen2_tab=P;function F(W,$){for(var J,ne=$.tt[1][W],ie=$.tt[0][W],ae=0;ae<o.scfsi_band.length-1;ae++){for(J=o.scfsi_band[ae];J<o.scfsi_band[ae+1]&&!(ie.scalefac[J]!=ne.scalefac[J]&&ne.scalefac[J]>=0);J++);if(J==o.scfsi_band[ae+1]){for(J=o.scfsi_band[ae];J<o.scfsi_band[ae+1];J++)ne.scalefac[J]=-1;$.scfsi[W][ae]=1}}var xe=0,Ne=0;for(J=0;J<11;J++)ne.scalefac[J]!=-1&&(Ne++,xe<ne.scalefac[J]&&(xe=ne.scalefac[J]));for(var Re=0,Se=0;J<s.SBPSY_l;J++)ne.scalefac[J]!=-1&&(Se++,Re<ne.scalefac[J]&&(Re=ne.scalefac[J]));for(var ae=0;ae<16;ae++)if(xe<z[ae]&&Re<H[ae]){var ze=K[ae]*Ne+P[ae]*Se;ne.part2_length>ze&&(ne.part2_length=ze,ne.scalefac_compress=ae)}}this.best_scalefac_store=function(W,$,J,ne){var ie=ne.tt[$][J],ae,xe,Ne,Re,Se=0;for(Ne=0,ae=0;ae<ie.sfbmax;ae++){var ze=ie.width[ae];for(Ne+=ze,Re=-ze;Re<0&&ie.l3_enc[Re+Ne]==0;Re++);Re==0&&(ie.scalefac[ae]=Se=-2)}if(ie.scalefac_scale==0&&ie.preflag==0){var Be=0;for(ae=0;ae<ie.sfbmax;ae++)ie.scalefac[ae]>0&&(Be|=ie.scalefac[ae]);if(!(Be&1)&&Be!=0){for(ae=0;ae<ie.sfbmax;ae++)ie.scalefac[ae]>0&&(ie.scalefac[ae]>>=1);ie.scalefac_scale=Se=1}}if(ie.preflag==0&&ie.block_type!=s.SHORT_TYPE&&W.mode_gr==2){for(ae=11;ae<s.SBPSY_l&&!(ie.scalefac[ae]<u.pretab[ae]&&ie.scalefac[ae]!=-2);ae++);if(ae==s.SBPSY_l){for(ae=11;ae<s.SBPSY_l;ae++)ie.scalefac[ae]>0&&(ie.scalefac[ae]-=u.pretab[ae]);ie.preflag=Se=1}}for(xe=0;xe<4;xe++)ne.scfsi[J][xe]=0;for(W.mode_gr==2&&$==1&&ne.tt[0][J].block_type!=s.SHORT_TYPE&&ne.tt[1][J].block_type!=s.SHORT_TYPE&&(F(J,ne),Se=0),ae=0;ae<ie.sfbmax;ae++)ie.scalefac[ae]==-2&&(ie.scalefac[ae]=0);Se!=0&&(W.mode_gr==2?this.scale_bitcount(ie):this.scale_bitcount_lsf(W,ie))};function N(W,$){for(var J=0;J<$;++J)if(W[J]<0)return!1;return!0}var X=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],G=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],j=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(W){var $,J,ne=0,ie=0,ae,xe=W.scalefac;if(i(N(xe,W.sfbmax)),W.block_type==s.SHORT_TYPE)ae=X,W.mixed_block_flag!=0&&(ae=G);else if(ae=j,W.preflag==0){for(J=11;J<s.SBPSY_l&&!(xe[J]<u.pretab[J]);J++);if(J==s.SBPSY_l)for(W.preflag=1,J=11;J<s.SBPSY_l;J++)xe[J]-=u.pretab[J]}for(J=0;J<W.sfbdivide;J++)ne<xe[J]&&(ne=xe[J]);for(;J<W.sfbmax;J++)ie<xe[J]&&(ie=xe[J]);for(W.part2_length=c.LARGE_BITS,$=0;$<16;$++)ne<z[$]&&ie<H[$]&&W.part2_length>ae[$]&&(W.part2_length=ae[$],W.scalefac_compress=$);return W.part2_length==c.LARGE_BITS};var q=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(W,$){var J,ne,ie,ae,xe,Ne,Re,Se,ze=r(4),Be=$.scalefac;for($.preflag!=0?J=2:J=0,Re=0;Re<4;Re++)ze[Re]=0;if($.block_type==s.SHORT_TYPE){ne=1;var Je=u.nr_of_sfb_block[J][ne];for(Se=0,ie=0;ie<4;ie++)for(ae=Je[ie]/3,Re=0;Re<ae;Re++,Se++)for(xe=0;xe<3;xe++)Be[Se*3+xe]>ze[ie]&&(ze[ie]=Be[Se*3+xe])}else{ne=0;var Je=u.nr_of_sfb_block[J][ne];for(Se=0,ie=0;ie<4;ie++)for(ae=Je[ie],Re=0;Re<ae;Re++,Se++)Be[Se]>ze[ie]&&(ze[ie]=Be[Se])}for(Ne=!1,ie=0;ie<4;ie++)ze[ie]>q[J][ie]&&(Ne=!0);if(!Ne){var at,re,Le,He;for($.sfb_partition_table=u.nr_of_sfb_block[J][ne],ie=0;ie<4;ie++)$.slen[ie]=te[ze[ie]];switch(at=$.slen[0],re=$.slen[1],Le=$.slen[2],He=$.slen[3],J){case 0:$.scalefac_compress=(at*5+re<<4)+(Le<<2)+He;break;case 1:$.scalefac_compress=400+(at*5+re<<2)+Le;break;case 2:$.scalefac_compress=500+at*3+re;break;default:e.err.printf(`intensity stereo not implemented yet
`);break}}if(!Ne)for(i($.sfb_partition_table!=null),$.part2_length=0,ie=0;ie<4;ie++)$.part2_length+=$.slen[ie]*$.sfb_partition_table[ie];return Ne};var te=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(W){for(var $=2;$<=576;$+=2){for(var J=0,ne;W.scalefac_band.l[++J]<$;);for(ne=d[J][0];W.scalefac_band.l[ne+1]>$;)ne--;for(ne<0&&(ne=d[J][0]),W.bv_scf[$-2]=ne,ne=d[J][1];W.scalefac_band.l[ne+W.bv_scf[$-2]+2]>$;)ne--;ne<0&&(ne=d[J][1]),W.bv_scf[$-1]=ne}}}return Q4=l,Q4}var eU,uZ;function k9(){if(uZ)return eU;uZ=1;var t=Ta,e=t.System,n=t.Arrays,r=t.new_byte,i=t.new_float_n,s=t.new_int,o=t.assert,a=Ffe(),c=M9,l=df(),u=UP;h.EQ=function(d,m){return Math.abs(d)>Math.abs(m)?Math.abs(d-m)<=Math.abs(d)*1e-6:Math.abs(d-m)<=Math.abs(m)*1e-6},h.NEQ=function(d,m){return!h.EQ(d,m)};function h(){var d=O9(),m=this,p=32773,g=null,y=null,v=null,x=null;this.setModules=function($,J,ne,ie){g=$,y=J,v=ne,x=ie};var E=null,C=0,A=0,k=0;this.getframebits=function($){var J=$.internal_flags,ne;J.bitrate_index!=0?ne=c.bitrate_table[$.version][J.bitrate_index]:ne=$.brate;var ie=0|($.version+1)*72e3*ne/$.out_samplerate+J.padding;return 8*ie};function M($){e.arraycopy($.header[$.w_ptr].buf,0,E,A,$.sideinfo_len),A+=$.sideinfo_len,C+=$.sideinfo_len*8,$.w_ptr=$.w_ptr+1&u.MAX_HEADER_BUF-1}function I($,J,ne){for(;ne>0;){var ie;k==0&&(k=8,A++,o(A<d.LAME_MAXMP3BUFFER),o($.header[$.w_ptr].write_timing>=C),$.header[$.w_ptr].write_timing==C&&M($),E[A]=0),ie=Math.min(ne,k),ne-=ie,k-=ie,E[A]|=J>>ne<<k,C+=ie}}function z($,J,ne){for(;ne>0;){var ie;k==0&&(k=8,A++,o(A<d.LAME_MAXMP3BUFFER),E[A]=0),ie=Math.min(ne,k),ne-=ie,k-=ie,E[A]|=J>>ne<<k,C+=ie}}function H($,J){var ne=$.internal_flags,ie;if(J>=8&&(I(ne,76,8),J-=8),J>=8&&(I(ne,65,8),J-=8),J>=8&&(I(ne,77,8),J-=8),J>=8&&(I(ne,69,8),J-=8),J>=32){var ae=v.getLameShortVersion();if(J>=32)for(ie=0;ie<ae.length&&J>=8;++ie)J-=8,I(ne,ae.charAt(ie),8)}for(;J>=1;J-=1)I(ne,ne.ancillary_flag,1),ne.ancillary_flag^=$.disable_reservoir?0:1}function K($,J,ne){for(var ie=$.header[$.h_ptr].ptr;ne>0;){var ae=Math.min(ne,8-(ie&7));ne-=ae,$.header[$.h_ptr].buf[ie>>3]|=J>>ne<<8-(ie&7)-ae,ie+=ae}$.header[$.h_ptr].ptr=ie}function P($,J){$<<=8;for(var ne=0;ne<8;ne++)$<<=1,J<<=1,(J^$)&65536&&(J^=p);return J}this.CRC_writeheader=function($,J){var ne=65535;ne=P(J[2]&255,ne),ne=P(J[3]&255,ne);for(var ie=6;ie<$.sideinfo_len;ie++)ne=P(J[ie]&255,ne);J[4]=byte(ne>>8),J[5]=byte(ne&255)};function F($,J){var ne=$.internal_flags,ie,ae,xe;if(ie=ne.l3_side,ne.header[ne.h_ptr].ptr=0,n.fill(ne.header[ne.h_ptr].buf,0,ne.sideinfo_len,0),$.out_samplerate<16e3?K(ne,4094,12):K(ne,4095,12),K(ne,$.version,1),K(ne,1,2),K(ne,$.error_protection?0:1,1),K(ne,ne.bitrate_index,4),K(ne,ne.samplerate_index,2),K(ne,ne.padding,1),K(ne,$.extension,1),K(ne,$.mode.ordinal(),2),K(ne,ne.mode_ext,2),K(ne,$.copyright,1),K(ne,$.original,1),K(ne,$.emphasis,2),$.error_protection&&K(ne,0,16),$.version==1){for(o(ie.main_data_begin>=0),K(ne,ie.main_data_begin,9),ne.channels_out==2?K(ne,ie.private_bits,3):K(ne,ie.private_bits,5),xe=0;xe<ne.channels_out;xe++){var Ne;for(Ne=0;Ne<4;Ne++)K(ne,ie.scfsi[xe][Ne],1)}for(ae=0;ae<2;ae++)for(xe=0;xe<ne.channels_out;xe++){var Re=ie.tt[ae][xe];K(ne,Re.part2_3_length+Re.part2_length,12),K(ne,Re.big_values/2,9),K(ne,Re.global_gain,8),K(ne,Re.scalefac_compress,4),Re.block_type!=l.NORM_TYPE?(K(ne,1,1),K(ne,Re.block_type,2),K(ne,Re.mixed_block_flag,1),Re.table_select[0]==14&&(Re.table_select[0]=16),K(ne,Re.table_select[0],5),Re.table_select[1]==14&&(Re.table_select[1]=16),K(ne,Re.table_select[1],5),K(ne,Re.subblock_gain[0],3),K(ne,Re.subblock_gain[1],3),K(ne,Re.subblock_gain[2],3)):(K(ne,0,1),Re.table_select[0]==14&&(Re.table_select[0]=16),K(ne,Re.table_select[0],5),Re.table_select[1]==14&&(Re.table_select[1]=16),K(ne,Re.table_select[1],5),Re.table_select[2]==14&&(Re.table_select[2]=16),K(ne,Re.table_select[2],5),o(0<=Re.region0_count&&Re.region0_count<16),o(0<=Re.region1_count&&Re.region1_count<8),K(ne,Re.region0_count,4),K(ne,Re.region1_count,3)),K(ne,Re.preflag,1),K(ne,Re.scalefac_scale,1),K(ne,Re.count1table_select,1)}}else for(o(ie.main_data_begin>=0),K(ne,ie.main_data_begin,8),K(ne,ie.private_bits,ne.channels_out),ae=0,xe=0;xe<ne.channels_out;xe++){var Re=ie.tt[ae][xe];K(ne,Re.part2_3_length+Re.part2_length,12),K(ne,Re.big_values/2,9),K(ne,Re.global_gain,8),K(ne,Re.scalefac_compress,9),Re.block_type!=l.NORM_TYPE?(K(ne,1,1),K(ne,Re.block_type,2),K(ne,Re.mixed_block_flag,1),Re.table_select[0]==14&&(Re.table_select[0]=16),K(ne,Re.table_select[0],5),Re.table_select[1]==14&&(Re.table_select[1]=16),K(ne,Re.table_select[1],5),K(ne,Re.subblock_gain[0],3),K(ne,Re.subblock_gain[1],3),K(ne,Re.subblock_gain[2],3)):(K(ne,0,1),Re.table_select[0]==14&&(Re.table_select[0]=16),K(ne,Re.table_select[0],5),Re.table_select[1]==14&&(Re.table_select[1]=16),K(ne,Re.table_select[1],5),Re.table_select[2]==14&&(Re.table_select[2]=16),K(ne,Re.table_select[2],5),o(0<=Re.region0_count&&Re.region0_count<16),o(0<=Re.region1_count&&Re.region1_count<8),K(ne,Re.region0_count,4),K(ne,Re.region1_count,3)),K(ne,Re.scalefac_scale,1),K(ne,Re.count1table_select,1)}$.error_protection&&CRC_writeheader(ne,ne.header[ne.h_ptr].buf);{var Se=ne.h_ptr;o(ne.header[Se].ptr==ne.sideinfo_len*8),ne.h_ptr=Se+1&u.MAX_HEADER_BUF-1,ne.header[ne.h_ptr].write_timing=ne.header[Se].write_timing+J,ne.h_ptr==ne.w_ptr&&e.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function N($,J){var ne=c.ht[J.count1table_select+32],ie,ae=0,xe=J.big_values,Ne=J.big_values;for(o(J.count1table_select<2),ie=(J.count1-J.big_values)/4;ie>0;--ie){var Re=0,Se=0,ze;ze=J.l3_enc[xe+0],ze!=0&&(Se+=8,J.xr[Ne+0]<0&&Re++),ze=J.l3_enc[xe+1],ze!=0&&(Se+=4,Re*=2,J.xr[Ne+1]<0&&Re++),ze=J.l3_enc[xe+2],ze!=0&&(Se+=2,Re*=2,J.xr[Ne+2]<0&&Re++),ze=J.l3_enc[xe+3],ze!=0&&(Se++,Re*=2,J.xr[Ne+3]<0&&Re++),xe+=4,Ne+=4,I($,Re+ne.table[Se],ne.hlen[Se]),ae+=ne.hlen[Se]}return ae}function X($,J,ne,ie,ae){var xe=c.ht[J],Ne=0;if(J==0)return Ne;for(var Re=ne;Re<ie;Re+=2){var Se=0,ze=0,Be=xe.xlen,Je=xe.xlen,at=0,re=ae.l3_enc[Re],Le=ae.l3_enc[Re+1];if(re!=0&&(ae.xr[Re]<0&&at++,Se--),J>15){if(re>14){var He=re-15;o(He<=xe.linmax),at|=He<<1,ze=Be,re=15}if(Le>14){var Ue=Le-15;o(Ue<=xe.linmax),at<<=Be,at|=Ue,ze+=Be,Le=15}Je=16}Le!=0&&(at<<=1,ae.xr[Re+1]<0&&at++,Se--),re=re*Je+Le,ze-=Se,Se+=xe.hlen[re],I($,xe.table[re],Se),I($,at,ze),Ne+=Se+ze}return Ne}function G($,J){var ne=3*$.scalefac_band.s[3];ne>J.big_values&&(ne=J.big_values);var ie=X($,J.table_select[0],0,ne,J);return ie+=X($,J.table_select[1],ne,J.big_values,J),ie}function j($,J){var ne,ie,ae,xe;ne=J.big_values;var Ne=J.region0_count+1;return o(Ne<$.scalefac_band.l.length),ae=$.scalefac_band.l[Ne],Ne+=J.region1_count+1,o(Ne<$.scalefac_band.l.length),xe=$.scalefac_band.l[Ne],ae>ne&&(ae=ne),xe>ne&&(xe=ne),ie=X($,J.table_select[0],0,ae,J),ie+=X($,J.table_select[1],ae,xe,J),ie+=X($,J.table_select[2],xe,ne,J),ie}function q($){var J,ne,ie,ae,xe=0,Ne=$.internal_flags,Re=Ne.l3_side;if($.version==1)for(J=0;J<2;J++)for(ne=0;ne<Ne.channels_out;ne++){var Se=Re.tt[J][ne],ze=a.slen1_tab[Se.scalefac_compress],Be=a.slen2_tab[Se.scalefac_compress];for(ae=0,ie=0;ie<Se.sfbdivide;ie++)Se.scalefac[ie]!=-1&&(I(Ne,Se.scalefac[ie],ze),ae+=ze);for(;ie<Se.sfbmax;ie++)Se.scalefac[ie]!=-1&&(I(Ne,Se.scalefac[ie],Be),ae+=Be);o(ae==Se.part2_length),Se.block_type==l.SHORT_TYPE?ae+=G(Ne,Se):ae+=j(Ne,Se),ae+=N(Ne,Se),o(ae==Se.part2_3_length+Se.part2_length),xe+=ae}else for(J=0,ne=0;ne<Ne.channels_out;ne++){var Se=Re.tt[J][ne],Je,at,re=0;if(o(Se.sfb_partition_table!=null),ae=0,ie=0,at=0,Se.block_type==l.SHORT_TYPE){for(;at<4;at++){var Le=Se.sfb_partition_table[at]/3,He=Se.slen[at];for(Je=0;Je<Le;Je++,ie++)I(Ne,Math.max(Se.scalefac[ie*3+0],0),He),I(Ne,Math.max(Se.scalefac[ie*3+1],0),He),I(Ne,Math.max(Se.scalefac[ie*3+2],0),He),re+=3*He}ae+=G(Ne,Se)}else{for(;at<4;at++){var Le=Se.sfb_partition_table[at],He=Se.slen[at];for(Je=0;Je<Le;Je++,ie++)I(Ne,Math.max(Se.scalefac[ie],0),He),re+=He}ae+=j(Ne,Se)}ae+=N(Ne,Se),o(ae==Se.part2_3_length),o(re==Se.part2_length),xe+=re+ae}return xe}function te(){this.total=0}function W($,J){var ne=$.internal_flags,ie,ae,xe,Ne,Re;return Re=ne.w_ptr,Ne=ne.h_ptr-1,Ne==-1&&(Ne=u.MAX_HEADER_BUF-1),ie=ne.header[Ne].write_timing-C,J.total=ie,ie>=0&&(ae=1+Ne-Re,Ne<Re&&(ae=1+Ne-Re+u.MAX_HEADER_BUF),ie-=ae*8*ne.sideinfo_len),xe=m.getframebits($),ie+=xe,J.total+=xe,J.total%8!=0?J.total=1+J.total/8:J.total=J.total/8,J.total+=A+1,ie<0&&e.err.println(`strange error flushing buffer ... 
`),ie}this.flush_bitstream=function($){var J=$.internal_flags,ne,ie,ae=J.h_ptr-1;if(ae==-1&&(ae=u.MAX_HEADER_BUF-1),ne=J.l3_side,!((ie=W($,new te))<0)){if(H($,ie),o(J.header[ae].write_timing+this.getframebits($)==C),J.ResvSize=0,ne.main_data_begin=0,J.findReplayGain){var xe=g.GetTitleGain(J.rgdata);o(NEQ(xe,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),J.RadioGain=Math.floor(xe*10+.5)|0}J.findPeakSample&&(J.noclipGainChange=Math.ceil(Math.log10(J.PeakSample/32767)*20*10)|0,J.noclipGainChange>0&&(EQ($.scale,1)||EQ($.scale,0))?J.noclipScale=Math.floor(32767/J.PeakSample*100)/100:J.noclipScale=-1)}},this.add_dummy_byte=function($,J,ne){for(var ie=$.internal_flags,ae;ne-- >0;)for(z(ie,J,8),ae=0;ae<u.MAX_HEADER_BUF;++ae)ie.header[ae].write_timing+=8},this.format_bitstream=function($){var J=$.internal_flags,ne;ne=J.l3_side;var ie=this.getframebits($);H($,ne.resvDrain_pre),F($,ie);var ae=8*J.sideinfo_len;if(ae+=q($),H($,ne.resvDrain_post),ae+=ne.resvDrain_post,ne.main_data_begin+=(ie-ae)/8,W($,new te)!=J.ResvSize&&e.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),ne.main_data_begin*8!=J.ResvSize&&(e.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*ne.main_data_begin,J.ResvSize,ne.resvDrain_post,ne.resvDrain_pre,8*J.sideinfo_len,ae-ne.resvDrain_post-8*J.sideinfo_len,ae,ae%8,ie),e.err.println("This is a fatal error.  It has several possible causes:"),e.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),e.err.println(" 9%%  Your system is overclocked"),e.err.println(" 1%%  bug in LAME encoding library"),J.ResvSize=ne.main_data_begin*8),C>1e9){var xe;for(xe=0;xe<u.MAX_HEADER_BUF;++xe)J.header[xe].write_timing-=C;C=0}return 0},this.copy_buffer=function($,J,ne,ie,ae){var xe=A+1;if(xe<=0)return 0;if(ie!=0&&xe>ie)return-1;if(e.arraycopy(E,0,J,ne,xe),A=-1,k=0,ae!=0){var Ne=s(1);if(Ne[0]=$.nMusicCRC,x.updateMusicCRC(Ne,J,ne,xe),$.nMusicCRC=Ne[0],xe>0&&($.VBR_seek_table.nBytesWritten+=xe),$.decode_on_the_fly){for(var Re=i([2,1152]),Se=xe,ze=-1,Be;ze!=0;)if(ze=y.hip_decode1_unclipped($.hip,J,ne,Se,Re[0],Re[1]),Se=0,ze==-1&&(ze=0),ze>0){if($.findPeakSample){for(Be=0;Be<ze;Be++)Re[0][Be]>$.PeakSample?$.PeakSample=Re[0][Be]:-Re[0][Be]>$.PeakSample&&($.PeakSample=-Re[0][Be]);if($.channels_out>1)for(Be=0;Be<ze;Be++)Re[1][Be]>$.PeakSample?$.PeakSample=Re[1][Be]:-Re[1][Be]>$.PeakSample&&($.PeakSample=-Re[1][Be])}if($.findReplayGain&&g.AnalyzeSamples($.rgdata,Re[0],0,Re[1],0,ze,$.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return xe},this.init_bit_stream_w=function($){E=r(d.LAME_MAXMP3BUFFER),$.h_ptr=$.w_ptr=0,$.header[$.h_ptr].write_timing=0,A=-1,k=0,C=0}}return eU=h,eU}var tU,fZ;function O9(){if(fZ)return tU;fZ=1;var t=Ta,e=t.System,n=t.VbrMode,r=t.ShortBlock,i=t.new_float,s=t.new_int_n,o=t.new_short_n,a=t.assert,c=hJe,l=mJe,u=UP,h=FJe,d=zJe,m=KJe,p=k9(),g=M9,y=df();function v(){var x=m2,E=this,C=128*1024;v.V9=410,v.V8=420,v.V7=430,v.V6=440,v.V5=450,v.V4=460,v.V3=470,v.V2=480,v.V1=490,v.V0=500,v.R3MIX=1e3,v.STANDARD=1001,v.EXTREME=1002,v.INSANE=1003,v.STANDARD_FAST=1004,v.EXTREME_FAST=1005,v.MEDIUM=1006,v.MEDIUM_FAST=1007;var A=16384+C;v.LAME_MAXMP3BUFFER=A;var k,M,I,z,H,K=new c,P,F,N;this.enc=new y,this.setModules=function(fe,ve,Ae,pe,Ge,Qe,Ze,tt,Ft){k=fe,M=ve,I=Ae,z=pe,H=Ge,P=Qe,F=tt,N=Ft,this.enc.setModules(M,K,z,P)};function X(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=i(y.SBMAX_l),this.bo_s_weight=i(y.SBMAX_s)}function G(){this.lowerlimit=0}function j(fe,ve){this.lowpass=ve}var q=4294479419;function te(fe){var ve;return fe.class_id=q,ve=fe.internal_flags=new u,fe.mode=x.NOT_SET,fe.original=1,fe.in_samplerate=44100,fe.num_channels=2,fe.num_samples=-1,fe.bWriteVbrTag=!0,fe.quality=-1,fe.short_blocks=null,ve.subblock_gain=-1,fe.lowpassfreq=0,fe.highpassfreq=0,fe.lowpasswidth=-1,fe.highpasswidth=-1,fe.VBR=n.vbr_off,fe.VBR_q=4,fe.ATHcurve=-1,fe.VBR_mean_bitrate_kbps=128,fe.VBR_min_bitrate_kbps=0,fe.VBR_max_bitrate_kbps=0,fe.VBR_hard_min=0,ve.VBR_min_bitrate=1,ve.VBR_max_bitrate=13,fe.quant_comp=-1,fe.quant_comp_short=-1,fe.msfix=-1,ve.resample_ratio=1,ve.OldValue[0]=180,ve.OldValue[1]=180,ve.CurrentStep[0]=4,ve.CurrentStep[1]=4,ve.masking_lower=1,ve.nsPsy.attackthre=-1,ve.nsPsy.attackthre_s=-1,fe.scale=-1,fe.athaa_type=-1,fe.ATHtype=-1,fe.athaa_loudapprox=-1,fe.athaa_sensitivity=0,fe.useTemporal=null,fe.interChRatio=-1,ve.mf_samples_to_encode=y.ENCDELAY+y.POSTDELAY,fe.encoder_padding=0,ve.mf_size=y.ENCDELAY-y.MDCTDELAY,fe.findReplayGain=!1,fe.decode_on_the_fly=!1,ve.decode_on_the_fly=!1,ve.findReplayGain=!1,ve.findPeakSample=!1,ve.RadioGain=0,ve.AudiophileGain=0,ve.noclipGainChange=0,ve.noclipScale=-1,fe.preset=0,fe.write_id3tag_automatic=!0,0}this.lame_init=function(){var fe=new l;return te(fe),fe.lame_allocated_gfp=1,fe};function W(fe){return fe>1?0:fe<=0?1:Math.cos(Math.PI/2*fe)}this.nearestBitrateFullIndex=function(fe){var ve=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],Ae=0,pe=0,Ge=0,Qe=0;Qe=ve[16],Ge=16,pe=ve[16],Ae=16;for(var Ze=0;Ze<16;Ze++)if(Math.max(fe,ve[Ze+1])!=fe){Qe=ve[Ze+1],Ge=Ze+1,pe=ve[Ze],Ae=Ze;break}return Qe-fe>fe-pe?Ae:Ge};function $(fe,ve){var Ae=44100;return ve>=48e3?Ae=48e3:ve>=44100?Ae=44100:ve>=32e3?Ae=32e3:ve>=24e3?Ae=24e3:ve>=22050?Ae=22050:ve>=16e3?Ae=16e3:ve>=12e3?Ae=12e3:ve>=11025?Ae=11025:ve>=8e3&&(Ae=8e3),fe==-1?Ae:(fe<=15960&&(Ae=44100),fe<=15250&&(Ae=32e3),fe<=11220&&(Ae=24e3),fe<=9970&&(Ae=22050),fe<=7230&&(Ae=16e3),fe<=5420&&(Ae=12e3),fe<=4510&&(Ae=11025),fe<=3970&&(Ae=8e3),ve<Ae?ve>44100?48e3:ve>32e3?44100:ve>24e3?32e3:ve>22050?24e3:ve>16e3?22050:ve>12e3?16e3:ve>11025?12e3:ve>8e3?11025:8e3:Ae)}function J(fe,ve){switch(fe){case 44100:return ve.version=1,0;case 48e3:return ve.version=1,1;case 32e3:return ve.version=1,2;case 22050:return ve.version=0,0;case 24e3:return ve.version=0,1;case 16e3:return ve.version=0,2;case 11025:return ve.version=0,0;case 12e3:return ve.version=0,1;case 8e3:return ve.version=0,2;default:return ve.version=0,-1}}function ne(fe,ve,Ae){Ae<16e3&&(ve=2);for(var pe=g.bitrate_table[ve][1],Ge=2;Ge<=14;Ge++)g.bitrate_table[ve][Ge]>0&&Math.abs(g.bitrate_table[ve][Ge]-fe)<Math.abs(pe-fe)&&(pe=g.bitrate_table[ve][Ge]);return pe}function ie(fe,ve,Ae){Ae<16e3&&(ve=2);for(var pe=0;pe<=14;pe++)if(g.bitrate_table[ve][pe]>0&&g.bitrate_table[ve][pe]==fe)return pe;return-1}function ae(fe,ve){var Ae=[new j(8,2e3),new j(16,3700),new j(24,3900),new j(32,5500),new j(40,7e3),new j(48,7500),new j(56,1e4),new j(64,11e3),new j(80,13500),new j(96,15100),new j(112,15600),new j(128,17e3),new j(160,17500),new j(192,18600),new j(224,19400),new j(256,19700),new j(320,20500)],pe=E.nearestBitrateFullIndex(ve);fe.lowerlimit=Ae[pe].lowpass}function xe(fe){var ve=fe.internal_flags,Ae=32,pe=-1;if(ve.lowpass1>0){for(var Ge=999,Qe=0;Qe<=31;Qe++){var Ze=Qe/31;Ze>=ve.lowpass2&&(Ae=Math.min(Ae,Qe)),ve.lowpass1<Ze&&Ze<ve.lowpass2&&(Ge=Math.min(Ge,Qe))}Ge==999?ve.lowpass1=(Ae-.75)/31:ve.lowpass1=(Ge-.75)/31,ve.lowpass2=Ae/31}if(ve.highpass2>0&&ve.highpass2<.9*(.75/31)&&(ve.highpass1=0,ve.highpass2=0,e.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),ve.highpass2>0){for(var tt=-1,Qe=0;Qe<=31;Qe++){var Ze=Qe/31;Ze<=ve.highpass1&&(pe=Math.max(pe,Qe)),ve.highpass1<Ze&&Ze<ve.highpass2&&(tt=Math.max(tt,Qe))}ve.highpass1=pe/31,tt==-1?ve.highpass2=(pe+.75)/31:ve.highpass2=(tt+.75)/31}for(var Qe=0;Qe<32;Qe++){var Ft,bt,Ze=Qe/31;ve.highpass2>ve.highpass1?Ft=W((ve.highpass2-Ze)/(ve.highpass2-ve.highpass1+1e-20)):Ft=1,ve.lowpass2>ve.lowpass1?bt=W((Ze-ve.lowpass1)/(ve.lowpass2-ve.lowpass1+1e-20)):bt=1,ve.amp_filter[Qe]=Ft*bt}}function Ne(fe){var ve=fe.internal_flags;switch(fe.quality){default:case 9:ve.psymodel=0,ve.noise_shaping=0,ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 8:fe.quality=7;case 7:ve.psymodel=1,ve.noise_shaping=0,ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 6:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 5:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 4:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 3:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=1,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 2:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.substep_shaping==0&&(ve.substep_shaping=2),ve.noise_shaping_amp=1,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 1:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.substep_shaping==0&&(ve.substep_shaping=2),ve.noise_shaping_amp=2,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 0:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.substep_shaping==0&&(ve.substep_shaping=2),ve.noise_shaping_amp=2,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break}}function Re(fe){var ve=fe.internal_flags;fe.frameNum=0,fe.write_id3tag_automatic&&F.id3tag_write_v2(fe),ve.bitrate_stereoMode_Hist=s([16,5]),ve.bitrate_blockType_Hist=s([16,6]),ve.PeakSample=0,fe.bWriteVbrTag&&P.InitVbrTag(fe)}this.lame_init_params=function(fe){var ve=fe.internal_flags;if(ve.Class_ID=0,ve.ATH==null&&(ve.ATH=new h),ve.PSY==null&&(ve.PSY=new X),ve.rgdata==null&&(ve.rgdata=new d),ve.channels_in=fe.num_channels,ve.channels_in==1&&(fe.mode=x.MONO),ve.channels_out=fe.mode==x.MONO?1:2,ve.mode_ext=y.MPG_MD_MS_LR,fe.mode==x.MONO&&(fe.force_ms=!1),fe.VBR==n.vbr_off&&fe.VBR_mean_bitrate_kbps!=128&&fe.brate==0&&(fe.brate=fe.VBR_mean_bitrate_kbps),fe.VBR==n.vbr_off||fe.VBR==n.vbr_mtrh||fe.VBR==n.vbr_mt||(fe.free_format=!1),fe.VBR==n.vbr_off&&fe.brate==0&&p.EQ(fe.compression_ratio,0)&&(fe.compression_ratio=11.025),fe.VBR==n.vbr_off&&fe.compression_ratio>0&&(fe.out_samplerate==0&&(fe.out_samplerate=map2MP3Frequency(int(.97*fe.in_samplerate))),fe.brate=0|fe.out_samplerate*16*ve.channels_out/(1e3*fe.compression_ratio),ve.samplerate_index=J(fe.out_samplerate,fe),fe.free_format||(fe.brate=ne(fe.brate,fe.version,fe.out_samplerate))),fe.out_samplerate!=0&&(fe.out_samplerate<16e3?(fe.VBR_mean_bitrate_kbps=Math.max(fe.VBR_mean_bitrate_kbps,8),fe.VBR_mean_bitrate_kbps=Math.min(fe.VBR_mean_bitrate_kbps,64)):fe.out_samplerate<32e3?(fe.VBR_mean_bitrate_kbps=Math.max(fe.VBR_mean_bitrate_kbps,8),fe.VBR_mean_bitrate_kbps=Math.min(fe.VBR_mean_bitrate_kbps,160)):(fe.VBR_mean_bitrate_kbps=Math.max(fe.VBR_mean_bitrate_kbps,32),fe.VBR_mean_bitrate_kbps=Math.min(fe.VBR_mean_bitrate_kbps,320))),fe.lowpassfreq==0){var Ae=16e3;switch(fe.VBR){case n.vbr_off:{var pe=new G;ae(pe,fe.brate),Ae=pe.lowerlimit;break}case n.vbr_abr:{var pe=new G;ae(pe,fe.VBR_mean_bitrate_kbps),Ae=pe.lowerlimit;break}case n.vbr_rh:{var Ge=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=fe.VBR_q&&fe.VBR_q<=9){var Qe=Ge[fe.VBR_q],Ze=Ge[fe.VBR_q+1],tt=fe.VBR_q_frac;Ae=linear_int(Qe,Ze,tt)}else Ae=19500;break}default:{var Ge=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=fe.VBR_q&&fe.VBR_q<=9){var Qe=Ge[fe.VBR_q],Ze=Ge[fe.VBR_q+1],tt=fe.VBR_q_frac;Ae=linear_int(Qe,Ze,tt)}else Ae=19500}}fe.mode==x.MONO&&(fe.VBR==n.vbr_off||fe.VBR==n.vbr_abr)&&(Ae*=1.5),fe.lowpassfreq=Ae|0}if(fe.out_samplerate==0&&(2*fe.lowpassfreq>fe.in_samplerate&&(fe.lowpassfreq=fe.in_samplerate/2),fe.out_samplerate=$(fe.lowpassfreq|0,fe.in_samplerate)),fe.lowpassfreq=Math.min(20500,fe.lowpassfreq),fe.lowpassfreq=Math.min(fe.out_samplerate/2,fe.lowpassfreq),fe.VBR==n.vbr_off&&(fe.compression_ratio=fe.out_samplerate*16*ve.channels_out/(1e3*fe.brate)),fe.VBR==n.vbr_abr&&(fe.compression_ratio=fe.out_samplerate*16*ve.channels_out/(1e3*fe.VBR_mean_bitrate_kbps)),fe.bWriteVbrTag||(fe.findReplayGain=!1,fe.decode_on_the_fly=!1,ve.findPeakSample=!1),ve.findReplayGain=fe.findReplayGain,ve.decode_on_the_fly=fe.decode_on_the_fly,ve.decode_on_the_fly&&(ve.findPeakSample=!0),ve.findReplayGain&&k.InitGainAnalysis(ve.rgdata,fe.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return fe.internal_flags=null,-6;switch(ve.decode_on_the_fly&&!fe.decode_only&&(ve.hip!=null&&N.hip_decode_exit(ve.hip),ve.hip=N.hip_decode_init()),ve.mode_gr=fe.out_samplerate<=24e3?1:2,fe.framesize=576*ve.mode_gr,fe.encoder_delay=y.ENCDELAY,ve.resample_ratio=fe.in_samplerate/fe.out_samplerate,fe.VBR){case n.vbr_mt:case n.vbr_rh:case n.vbr_mtrh:{var Ft=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];fe.compression_ratio=Ft[fe.VBR_q]}break;case n.vbr_abr:fe.compression_ratio=fe.out_samplerate*16*ve.channels_out/(1e3*fe.VBR_mean_bitrate_kbps);break;default:fe.compression_ratio=fe.out_samplerate*16*ve.channels_out/(1e3*fe.brate);break}if(fe.mode==x.NOT_SET&&(fe.mode=x.JOINT_STEREO),fe.highpassfreq>0?(ve.highpass1=2*fe.highpassfreq,fe.highpasswidth>=0?ve.highpass2=2*(fe.highpassfreq+fe.highpasswidth):ve.highpass2=2*fe.highpassfreq,ve.highpass1/=fe.out_samplerate,ve.highpass2/=fe.out_samplerate):(ve.highpass1=0,ve.highpass2=0),fe.lowpassfreq>0?(ve.lowpass2=2*fe.lowpassfreq,fe.lowpasswidth>=0?(ve.lowpass1=2*(fe.lowpassfreq-fe.lowpasswidth),ve.lowpass1<0&&(ve.lowpass1=0)):ve.lowpass1=2*fe.lowpassfreq,ve.lowpass1/=fe.out_samplerate,ve.lowpass2/=fe.out_samplerate):(ve.lowpass1=0,ve.lowpass2=0),xe(fe),ve.samplerate_index=J(fe.out_samplerate,fe),ve.samplerate_index<0)return fe.internal_flags=null,-1;if(fe.VBR==n.vbr_off){if(fe.free_format)ve.bitrate_index=0;else if(fe.brate=ne(fe.brate,fe.version,fe.out_samplerate),ve.bitrate_index=ie(fe.brate,fe.version,fe.out_samplerate),ve.bitrate_index<=0)return fe.internal_flags=null,-1}else ve.bitrate_index=1;fe.analysis&&(fe.bWriteVbrTag=!1),ve.pinfo!=null&&(fe.bWriteVbrTag=!1),M.init_bit_stream_w(ve);for(var bt=ve.samplerate_index+3*fe.version+6*(fe.out_samplerate<16e3?1:0),Mt=0;Mt<y.SBMAX_l+1;Mt++)ve.scalefac_band.l[Mt]=z.sfBandIndex[bt].l[Mt];for(var Mt=0;Mt<y.PSFB21+1;Mt++){var Ie=(ve.scalefac_band.l[22]-ve.scalefac_band.l[21])/y.PSFB21,ce=ve.scalefac_band.l[21]+Mt*Ie;ve.scalefac_band.psfb21[Mt]=ce}ve.scalefac_band.psfb21[y.PSFB21]=576;for(var Mt=0;Mt<y.SBMAX_s+1;Mt++)ve.scalefac_band.s[Mt]=z.sfBandIndex[bt].s[Mt];for(var Mt=0;Mt<y.PSFB12+1;Mt++){var Ie=(ve.scalefac_band.s[13]-ve.scalefac_band.s[12])/y.PSFB12,ce=ve.scalefac_band.s[12]+Mt*Ie;ve.scalefac_band.psfb12[Mt]=ce}ve.scalefac_band.psfb12[y.PSFB12]=192,fe.version==1?ve.sideinfo_len=ve.channels_out==1?21:36:ve.sideinfo_len=ve.channels_out==1?13:21,fe.error_protection&&(ve.sideinfo_len+=2),Re(fe),ve.Class_ID=q;{var Q;for(Q=0;Q<19;Q++)ve.nsPsy.pefirbuf[Q]=700*ve.mode_gr*ve.channels_out;fe.ATHtype==-1&&(fe.ATHtype=4)}switch(a(fe.VBR_q<=9),a(fe.VBR_q>=0),fe.VBR){case n.vbr_mt:fe.VBR=n.vbr_mtrh;case n.vbr_mtrh:{fe.useTemporal==null&&(fe.useTemporal=!1),I.apply_preset(fe,500-fe.VBR_q*10,0),fe.quality<0&&(fe.quality=LAME_DEFAULT_QUALITY),fe.quality<5&&(fe.quality=0),fe.quality>5&&(fe.quality=5),ve.PSY.mask_adjust=fe.maskingadjust,ve.PSY.mask_adjust_short=fe.maskingadjust_short,fe.experimentalY?ve.sfb21_extra=!1:ve.sfb21_extra=fe.out_samplerate>44e3,ve.iteration_loop=new VBRNewIterationLoop(H);break}case n.vbr_rh:{I.apply_preset(fe,500-fe.VBR_q*10,0),ve.PSY.mask_adjust=fe.maskingadjust,ve.PSY.mask_adjust_short=fe.maskingadjust_short,fe.experimentalY?ve.sfb21_extra=!1:ve.sfb21_extra=fe.out_samplerate>44e3,fe.quality>6&&(fe.quality=6),fe.quality<0&&(fe.quality=LAME_DEFAULT_QUALITY),ve.iteration_loop=new VBROldIterationLoop(H);break}default:{var le;ve.sfb21_extra=!1,fe.quality<0&&(fe.quality=LAME_DEFAULT_QUALITY),le=fe.VBR,le==n.vbr_off&&(fe.VBR_mean_bitrate_kbps=fe.brate),I.apply_preset(fe,fe.VBR_mean_bitrate_kbps,0),fe.VBR=le,ve.PSY.mask_adjust=fe.maskingadjust,ve.PSY.mask_adjust_short=fe.maskingadjust_short,le==n.vbr_off?ve.iteration_loop=new m(H):ve.iteration_loop=new ABRIterationLoop(H);break}}if(a(fe.scale>=0),fe.VBR!=n.vbr_off){if(ve.VBR_min_bitrate=1,ve.VBR_max_bitrate=14,fe.out_samplerate<16e3&&(ve.VBR_max_bitrate=8),fe.VBR_min_bitrate_kbps!=0&&(fe.VBR_min_bitrate_kbps=ne(fe.VBR_min_bitrate_kbps,fe.version,fe.out_samplerate),ve.VBR_min_bitrate=ie(fe.VBR_min_bitrate_kbps,fe.version,fe.out_samplerate),ve.VBR_min_bitrate<0)||fe.VBR_max_bitrate_kbps!=0&&(fe.VBR_max_bitrate_kbps=ne(fe.VBR_max_bitrate_kbps,fe.version,fe.out_samplerate),ve.VBR_max_bitrate=ie(fe.VBR_max_bitrate_kbps,fe.version,fe.out_samplerate),ve.VBR_max_bitrate<0))return-1;fe.VBR_min_bitrate_kbps=g.bitrate_table[fe.version][ve.VBR_min_bitrate],fe.VBR_max_bitrate_kbps=g.bitrate_table[fe.version][ve.VBR_max_bitrate],fe.VBR_mean_bitrate_kbps=Math.min(g.bitrate_table[fe.version][ve.VBR_max_bitrate],fe.VBR_mean_bitrate_kbps),fe.VBR_mean_bitrate_kbps=Math.max(g.bitrate_table[fe.version][ve.VBR_min_bitrate],fe.VBR_mean_bitrate_kbps)}return fe.tune&&(ve.PSY.mask_adjust+=fe.tune_value_a,ve.PSY.mask_adjust_short+=fe.tune_value_a),Ne(fe),a(fe.scale>=0),fe.athaa_type<0?ve.ATH.useAdjust=3:ve.ATH.useAdjust=fe.athaa_type,ve.ATH.aaSensitivityP=Math.pow(10,fe.athaa_sensitivity/-10),fe.short_blocks==null&&(fe.short_blocks=r.short_block_allowed),fe.short_blocks==r.short_block_allowed&&(fe.mode==x.JOINT_STEREO||fe.mode==x.STEREO)&&(fe.short_blocks=r.short_block_coupled),fe.quant_comp<0&&(fe.quant_comp=1),fe.quant_comp_short<0&&(fe.quant_comp_short=0),fe.msfix<0&&(fe.msfix=0),fe.exp_nspsytune=fe.exp_nspsytune|1,fe.internal_flags.nsPsy.attackthre<0&&(fe.internal_flags.nsPsy.attackthre=c.NSATTACKTHRE),fe.internal_flags.nsPsy.attackthre_s<0&&(fe.internal_flags.nsPsy.attackthre_s=c.NSATTACKTHRE_S),a(fe.scale>=0),fe.scale<0&&(fe.scale=1),fe.ATHtype<0&&(fe.ATHtype=4),fe.ATHcurve<0&&(fe.ATHcurve=4),fe.athaa_loudapprox<0&&(fe.athaa_loudapprox=2),fe.interChRatio<0&&(fe.interChRatio=0),fe.useTemporal==null&&(fe.useTemporal=!0),ve.slot_lag=ve.frac_SpF=0,fe.VBR==n.vbr_off&&(ve.slot_lag=ve.frac_SpF=(fe.version+1)*72e3*fe.brate%fe.out_samplerate|0),z.iteration_init(fe),K.psymodel_init(fe),a(fe.scale>=0),0};function Se(fe,ve){(fe.in_buffer_0==null||fe.in_buffer_nsamples<ve)&&(fe.in_buffer_0=i(ve),fe.in_buffer_1=i(ve),fe.in_buffer_nsamples=ve)}this.lame_encode_flush=function(fe,ve,Ae,pe){var Ge=fe.internal_flags,Qe=o([2,1152]),Ze=0,tt,Ft,bt,Mt,Ie=Ge.mf_samples_to_encode-y.POSTDELAY,ce=ze(fe);if(Ge.mf_samples_to_encode<1)return 0;for(tt=0,fe.in_samplerate!=fe.out_samplerate&&(Ie+=16*fe.out_samplerate/fe.in_samplerate),bt=fe.framesize-Ie%fe.framesize,bt<576&&(bt+=fe.framesize),fe.encoder_padding=bt,Mt=(Ie+bt)/fe.framesize;Mt>0&&Ze>=0;){var Q=ce-Ge.mf_size,le=fe.frameNum;Q*=fe.in_samplerate,Q/=fe.out_samplerate,Q>1152&&(Q=1152),Q<1&&(Q=1),Ft=pe-tt,pe==0&&(Ft=0),Ze=this.lame_encode_buffer(fe,Qe[0],Qe[1],Q,ve,Ae,Ft),Ae+=Ze,tt+=Ze,Mt-=le!=fe.frameNum?1:0}if(Ge.mf_samples_to_encode=0,Ze<0||(Ft=pe-tt,pe==0&&(Ft=0),M.flush_bitstream(fe),Ze=M.copy_buffer(Ge,ve,Ae,Ft,1),Ze<0))return Ze;if(Ae+=Ze,tt+=Ze,Ft=pe-tt,pe==0&&(Ft=0),fe.write_id3tag_automatic){if(F.id3tag_write_v1(fe),Ze=M.copy_buffer(Ge,ve,Ae,Ft,0),Ze<0)return Ze;tt+=Ze}return tt},this.lame_encode_buffer=function(fe,ve,Ae,pe,Ge,Qe,Ze){var tt=fe.internal_flags,Ft=[null,null];if(tt.Class_ID!=q)return-3;if(pe==0)return 0;Se(tt,pe),Ft[0]=tt.in_buffer_0,Ft[1]=tt.in_buffer_1;for(var bt=0;bt<pe;bt++)Ft[0][bt]=ve[bt],tt.channels_in>1&&(Ft[1][bt]=Ae[bt]);return Be(fe,Ft[0],Ft[1],pe,Ge,Qe,Ze)};function ze(fe){var ve=y.BLKSIZE+fe.framesize-y.FFTOFFSET;return ve=Math.max(ve,512+fe.framesize-32),ve}function Be(fe,ve,Ae,pe,Ge,Qe,Ze){var tt=fe.internal_flags,Ft=0,bt,Mt,Ie,ce,Q,le=[null,null],we=[null,null];if(tt.Class_ID!=q)return-3;if(pe==0)return 0;if(Q=M.copy_buffer(tt,Ge,Qe,Ze,0),Q<0)return Q;if(Qe+=Q,Ft+=Q,we[0]=ve,we[1]=Ae,p.NEQ(fe.scale,0)&&p.NEQ(fe.scale,1))for(Mt=0;Mt<pe;++Mt)we[0][Mt]*=fe.scale,tt.channels_out==2&&(we[1][Mt]*=fe.scale);if(p.NEQ(fe.scale_left,0)&&p.NEQ(fe.scale_left,1))for(Mt=0;Mt<pe;++Mt)we[0][Mt]*=fe.scale_left;if(p.NEQ(fe.scale_right,0)&&p.NEQ(fe.scale_right,1))for(Mt=0;Mt<pe;++Mt)we[1][Mt]*=fe.scale_right;if(fe.num_channels==2&&tt.channels_out==1)for(Mt=0;Mt<pe;++Mt)we[0][Mt]=.5*(we[0][Mt]+we[1][Mt]),we[1][Mt]=0;ce=ze(fe),le[0]=tt.mfbuf[0],le[1]=tt.mfbuf[1];for(var Me=0;pe>0;){var Te=[null,null],ye=0,Ye=0;Te[0]=we[0],Te[1]=we[1];var Pe=new at;if(De(fe,le,Te,Me,pe,Pe),ye=Pe.n_in,Ye=Pe.n_out,tt.findReplayGain&&!tt.decode_on_the_fly&&k.AnalyzeSamples(tt.rgdata,le[0],tt.mf_size,le[1],tt.mf_size,Ye,tt.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(pe-=ye,Me+=ye,tt.channels_out==2,tt.mf_size+=Ye,a(tt.mf_size<=u.MFSIZE),tt.mf_samples_to_encode<1&&(tt.mf_samples_to_encode=y.ENCDELAY+y.POSTDELAY),tt.mf_samples_to_encode+=Ye,tt.mf_size>=ce){var We=Ze-Ft;if(Ze==0&&(We=0),bt=Je(fe,le[0],le[1],Ge,Qe,We),bt<0)return bt;for(Qe+=bt,Ft+=bt,tt.mf_size-=fe.framesize,tt.mf_samples_to_encode-=fe.framesize,Ie=0;Ie<tt.channels_out;Ie++)for(Mt=0;Mt<tt.mf_size;Mt++)le[Ie][Mt]=le[Ie][Mt+fe.framesize]}}return Ft}function Je(fe,ve,Ae,pe,Ge,Qe){var Ze=E.enc.lame_encode_mp3_frame(fe,ve,Ae,pe,Ge,Qe);return fe.frameNum++,Ze}function at(){this.n_in=0,this.n_out=0}function re(){this.num_used=0}function Le(fe,ve){return ve!=0?Le(ve,fe%ve):fe}function He(fe,ve,Ae){var pe=Math.PI*ve;fe/=Ae,fe<0&&(fe=0),fe>1&&(fe=1);var Ge=fe-.5,Qe=.42-.5*Math.cos(2*fe*Math.PI)+.08*Math.cos(4*fe*Math.PI);return Math.abs(Ge)<1e-9?pe/Math.PI:Qe*Math.sin(Ae*pe*Ge)/(Math.PI*Ae*Ge)}function Ue(fe,ve,Ae,pe,Ge,Qe,Ze,tt,Ft){var bt=fe.internal_flags,Mt,Ie=0,ce,Q=fe.out_samplerate/Le(fe.out_samplerate,fe.in_samplerate);Q>u.BPC&&(Q=u.BPC);var le=Math.abs(bt.resample_ratio-Math.floor(.5+bt.resample_ratio))<1e-4?1:0,we=1/bt.resample_ratio;we>1&&(we=1);var Me=31;Me%2==0&&--Me,Me+=le;var Te=Me+1;if(bt.fill_buffer_resample_init==0){for(bt.inbuf_old[0]=i(Te),bt.inbuf_old[1]=i(Te),Mt=0;Mt<=2*Q;++Mt)bt.blackfilt[Mt]=i(Te);for(bt.itime[0]=0,bt.itime[1]=0,Ie=0;Ie<=2*Q;Ie++){var ye=0,Ye=(Ie-Q)/(2*Q);for(Mt=0;Mt<=Me;Mt++)ye+=bt.blackfilt[Ie][Mt]=He(Mt-Ye,we,Me);for(Mt=0;Mt<=Me;Mt++)bt.blackfilt[Ie][Mt]/=ye}bt.fill_buffer_resample_init=1}var Pe=bt.inbuf_old[Ft];for(ce=0;ce<pe;ce++){var We,Ve;if(We=ce*bt.resample_ratio,Ie=0|Math.floor(We-bt.itime[Ft]),Me+Ie-Me/2>=Ze)break;var Ye=We-bt.itime[Ft]-(Ie+.5*(Me%2));Ve=0|Math.floor(Ye*2*Q+Q+.5);var Xe=0;for(Mt=0;Mt<=Me;++Mt){var lt=0|Mt+Ie-Me/2,qe;qe=lt<0?Pe[Te+lt]:Ge[Qe+lt],Xe+=qe*bt.blackfilt[Ve][Mt]}ve[Ae+ce]=Xe}if(tt.num_used=Math.min(Ze,Me+Ie-Me/2),bt.itime[Ft]+=tt.num_used-ce*bt.resample_ratio,tt.num_used>=Te)for(Mt=0;Mt<Te;Mt++)Pe[Mt]=Ge[Qe+tt.num_used+Mt-Te];else{var rt=Te-tt.num_used;for(Mt=0;Mt<rt;++Mt)Pe[Mt]=Pe[Mt+tt.num_used];for(Ie=0;Mt<Te;++Mt,++Ie)Pe[Mt]=Ge[Qe+Ie];a(Ie==tt.num_used)}return ce}function De(fe,ve,Ae,pe,Ge,Qe){var Ze=fe.internal_flags;if(Ze.resample_ratio<.9999||Ze.resample_ratio>1.0001)for(var tt=0;tt<Ze.channels_out;tt++){var Ft=new re;Qe.n_out=Ue(fe,ve[tt],Ze.mf_size,fe.framesize,Ae[tt],pe,Ge,Ft,tt),Qe.n_in=Ft.num_used}else{Qe.n_out=Math.min(fe.framesize,Ge),Qe.n_in=Qe.n_out;for(var bt=0;bt<Qe.n_out;++bt)ve[0][Ze.mf_size+bt]=Ae[0][pe+bt],Ze.channels_out==2&&(ve[1][Ze.mf_size+bt]=Ae[1][pe+bt])}}}return tU=v,tU}var XJe=Ta,i0=XJe.VbrMode;function YJe(){var t=O9();function e(u,h,d,m,p,g,y,v,x,E,C,A,k,M,I){this.vbr_q=u,this.quant_comp=h,this.quant_comp_s=d,this.expY=m,this.st_lrm=p,this.st_s=g,this.masking_adj=y,this.masking_adj_short=v,this.ath_lower=x,this.ath_curve=E,this.ath_sensitivity=C,this.interch=A,this.safejoint=k,this.sfb21mod=M,this.msfix=I}function n(u,h,d,m,p,g,y,v,x,E,C,A,k,M){this.quant_comp=h,this.quant_comp_s=d,this.safejoint=m,this.nsmsfix=p,this.st_lrm=g,this.st_s=y,this.nsbass=v,this.scale=x,this.masking_adj=E,this.ath_lower=C,this.ath_curve=A,this.interch=k,this.sfscale=M}var r;this.setModules=function(u){r=u};var i=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],s=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function o(u,h,d){var m=u.VBR==i0.vbr_rh?i:s,p=u.VBR_q_frac,g=m[h],y=m[h+1],v=g;g.st_lrm=g.st_lrm+p*(y.st_lrm-g.st_lrm),g.st_s=g.st_s+p*(y.st_s-g.st_s),g.masking_adj=g.masking_adj+p*(y.masking_adj-g.masking_adj),g.masking_adj_short=g.masking_adj_short+p*(y.masking_adj_short-g.masking_adj_short),g.ath_lower=g.ath_lower+p*(y.ath_lower-g.ath_lower),g.ath_curve=g.ath_curve+p*(y.ath_curve-g.ath_curve),g.ath_sensitivity=g.ath_sensitivity+p*(y.ath_sensitivity-g.ath_sensitivity),g.interch=g.interch+p*(y.interch-g.interch),g.msfix=g.msfix+p*(y.msfix-g.msfix),l(u,v.vbr_q),d!=0?u.quant_comp=v.quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=v.quant_comp),d!=0?u.quant_comp_short=v.quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=v.quant_comp_s),v.expY!=0&&(u.experimentalY=v.expY!=0),d!=0?u.internal_flags.nsPsy.attackthre=v.st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=v.st_lrm),d!=0?u.internal_flags.nsPsy.attackthre_s=v.st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=v.st_s),d!=0?u.maskingadjust=v.masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=v.masking_adj),d!=0?u.maskingadjust_short=v.masking_adj_short:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=v.masking_adj_short),d!=0?u.ATHlower=-v.ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-v.ath_lower/10),d!=0?u.ATHcurve=v.ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=v.ath_curve),d!=0?u.athaa_sensitivity=v.ath_sensitivity:Math.abs(u.athaa_sensitivity- -1)>0||(u.athaa_sensitivity=v.ath_sensitivity),v.interch>0&&(d!=0?u.interChRatio=v.interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=v.interch)),v.safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|v.safejoint),v.sfb21mod>0&&(u.exp_nspsytune=u.exp_nspsytune|v.sfb21mod<<20),d!=0?u.msfix=v.msfix:Math.abs(u.msfix- -1)>0||(u.msfix=v.msfix),d==0&&(u.VBR_q=h,u.VBR_q_frac=p)}var a=[new n(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new n(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new n(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new n(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new n(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new n(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new n(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new n(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new n(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new n(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new n(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new n(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new n(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new n(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new n(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function c(u,h,d){var m=h,p=r.nearestBitrateFullIndex(h);if(u.VBR=i0.vbr_abr,u.VBR_mean_bitrate_kbps=m,u.VBR_mean_bitrate_kbps=Math.min(u.VBR_mean_bitrate_kbps,320),u.VBR_mean_bitrate_kbps=Math.max(u.VBR_mean_bitrate_kbps,8),u.brate=u.VBR_mean_bitrate_kbps,u.VBR_mean_bitrate_kbps>320&&(u.disable_reservoir=!0),a[p].safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|2),a[p].sfscale>0&&(u.internal_flags.noise_shaping=2),Math.abs(a[p].nsbass)>0){var g=int(a[p].nsbass*4);g<0&&(g+=64),u.exp_nspsytune=u.exp_nspsytune|g<<2}return d!=0?u.quant_comp=a[p].quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=a[p].quant_comp),d!=0?u.quant_comp_short=a[p].quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=a[p].quant_comp_s),d!=0?u.msfix=a[p].nsmsfix:Math.abs(u.msfix- -1)>0||(u.msfix=a[p].nsmsfix),d!=0?u.internal_flags.nsPsy.attackthre=a[p].st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=a[p].st_lrm),d!=0?u.internal_flags.nsPsy.attackthre_s=a[p].st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=a[p].st_s),d!=0?u.scale=a[p].scale:Math.abs(u.scale- -1)>0||(u.scale=a[p].scale),d!=0?u.maskingadjust=a[p].masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=a[p].masking_adj),a[p].masking_adj>0?d!=0?u.maskingadjust_short=a[p].masking_adj*.9:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[p].masking_adj*.9):d!=0?u.maskingadjust_short=a[p].masking_adj*1.1:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[p].masking_adj*1.1),d!=0?u.ATHlower=-a[p].ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-a[p].ath_lower/10),d!=0?u.ATHcurve=a[p].ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=a[p].ath_curve),d!=0?u.interChRatio=a[p].interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=a[p].interch),h}this.apply_preset=function(u,h,d){switch(h){case t.R3MIX:{h=t.V3,u.VBR=i0.vbr_mtrh;break}case t.MEDIUM:{h=t.V4,u.VBR=i0.vbr_rh;break}case t.MEDIUM_FAST:{h=t.V4,u.VBR=i0.vbr_mtrh;break}case t.STANDARD:{h=t.V2,u.VBR=i0.vbr_rh;break}case t.STANDARD_FAST:{h=t.V2,u.VBR=i0.vbr_mtrh;break}case t.EXTREME:{h=t.V0,u.VBR=i0.vbr_rh;break}case t.EXTREME_FAST:{h=t.V0,u.VBR=i0.vbr_mtrh;break}case t.INSANE:return h=320,u.preset=h,c(u,h,d),u.VBR=i0.vbr_off,h}switch(u.preset=h,h){case t.V9:return o(u,9,d),h;case t.V8:return o(u,8,d),h;case t.V7:return o(u,7,d),h;case t.V6:return o(u,6,d),h;case t.V5:return o(u,5,d),h;case t.V4:return o(u,4,d),h;case t.V3:return o(u,3,d),h;case t.V2:return o(u,2,d),h;case t.V1:return o(u,1,d),h;case t.V0:return o(u,0,d),h}return 8<=h&&h<=320?c(u,h,d):(u.preset=0,h)};function l(u,h){var d=0;return 0>h&&(d=-1,h=0),9<h&&(d=-1,h=9),u.VBR_q=h,u.VBR_q_frac=0,d}}var ZJe=YJe;function JJe(){this.setModules=function(t,e){}}var QJe=JJe;function eQe(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var tQe=eQe,jfe=Ta,hZ=jfe.new_float,nQe=jfe.new_int;function rQe(){this.global_gain=0,this.sfb_count1=0,this.step=nQe(39),this.noise=hZ(39),this.noise_log=hZ(39)}var iQe=rQe,hT=Ta,_y=hT.System,dZ=hT.VbrMode,nU=hT.Util,aS=hT.Arrays,EC=hT.new_float,SC=hT.assert,sQe=QJe,rU=tQe,oQe=iQe,fs=df(),pZ=R9,mZ=LP;function aQe(){var t;this.rv=null;var e;this.qupvt=null;var n,r=new sQe,i;this.setModules=function(v,x,E,C){t=v,e=x,this.rv=x,n=E,this.qupvt=E,i=C,r.setModules(n,i)},this.ms_convert=function(v,x){for(var E=0;E<576;++E){var C=v.tt[x][0].xr[E],A=v.tt[x][1].xr[E];v.tt[x][0].xr[E]=(C+A)*(nU.SQRT2*.5),v.tt[x][1].xr[E]=(C-A)*(nU.SQRT2*.5)}};function s(v,x,E,C){C=0;for(var A=0;A<=E;++A){var k=Math.abs(v.xr[A]);C+=k,x[A]=Math.sqrt(k*Math.sqrt(k)),x[A]>v.xrpow_max&&(v.xrpow_max=x[A])}return C}this.init_xrpow=function(v,x,E){var C=0,A=0|x.max_nonzero_coeff;if(x.xrpow_max=0,aS.fill(E,A,576,0),C=s(x,E,A,C),C>1e-20){var k=0;v.substep_shaping&2&&(k=1);for(var M=0;M<x.psymax;M++)v.pseudohalf[M]=k;return!0}return aS.fill(x.l3_enc,0,576,0),!1};function o(v,x){var E=v.ATH,C=x.xr;if(x.block_type!=fs.SHORT_TYPE)for(var A=!1,k=fs.PSFB21-1;k>=0&&!A;k--){var M=v.scalefac_band.psfb21[k],I=v.scalefac_band.psfb21[k+1],z=n.athAdjust(E.adjust,E.psfb21[k],E.floor);v.nsPsy.longfact[21]>1e-12&&(z*=v.nsPsy.longfact[21]);for(var H=I-1;H>=M;H--)if(Math.abs(C[H])<z)C[H]=0;else{A=!0;break}}else for(var K=0;K<3;K++)for(var A=!1,k=fs.PSFB12-1;k>=0&&!A;k--){var M=v.scalefac_band.s[12]*3+(v.scalefac_band.s[13]-v.scalefac_band.s[12])*K+(v.scalefac_band.psfb12[k]-v.scalefac_band.psfb12[0]),I=M+(v.scalefac_band.psfb12[k+1]-v.scalefac_band.psfb12[k]),P=n.athAdjust(E.adjust,E.psfb12[k],E.floor);v.nsPsy.shortfact[12]>1e-12&&(P*=v.nsPsy.shortfact[12]);for(var H=I-1;H>=M;H--)if(Math.abs(C[H])<P)C[H]=0;else{A=!0;break}}}this.init_outer_loop=function(v,x){x.part2_3_length=0,x.big_values=0,x.count1=0,x.global_gain=210,x.scalefac_compress=0,x.table_select[0]=0,x.table_select[1]=0,x.table_select[2]=0,x.subblock_gain[0]=0,x.subblock_gain[1]=0,x.subblock_gain[2]=0,x.subblock_gain[3]=0,x.region0_count=0,x.region1_count=0,x.preflag=0,x.scalefac_scale=0,x.count1table_select=0,x.part2_length=0,x.sfb_lmax=fs.SBPSY_l,x.sfb_smin=fs.SBPSY_s,x.psy_lmax=v.sfb21_extra?fs.SBMAX_l:fs.SBPSY_l,x.psymax=x.psy_lmax,x.sfbmax=x.sfb_lmax,x.sfbdivide=11;for(var E=0;E<fs.SBMAX_l;E++)x.width[E]=v.scalefac_band.l[E+1]-v.scalefac_band.l[E],x.window[E]=3;if(x.block_type==fs.SHORT_TYPE){var C=EC(576);x.sfb_smin=0,x.sfb_lmax=0,x.mixed_block_flag!=0&&(x.sfb_smin=3,x.sfb_lmax=v.mode_gr*2+4),x.psymax=x.sfb_lmax+3*((v.sfb21_extra?fs.SBMAX_s:fs.SBPSY_s)-x.sfb_smin),x.sfbmax=x.sfb_lmax+3*(fs.SBPSY_s-x.sfb_smin),x.sfbdivide=x.sfbmax-18,x.psy_lmax=x.sfb_lmax;var A=v.scalefac_band.l[x.sfb_lmax];_y.arraycopy(x.xr,0,C,0,576);for(var E=x.sfb_smin;E<fs.SBMAX_s;E++)for(var k=v.scalefac_band.s[E],M=v.scalefac_band.s[E+1],I=0;I<3;I++)for(var z=k;z<M;z++)x.xr[A++]=C[3*z+I];for(var H=x.sfb_lmax,E=x.sfb_smin;E<fs.SBMAX_s;E++)x.width[H]=x.width[H+1]=x.width[H+2]=v.scalefac_band.s[E+1]-v.scalefac_band.s[E],x.window[H]=0,x.window[H+1]=1,x.window[H+2]=2,H+=3}x.count1bits=0,x.sfb_partition_table=n.nr_of_sfb_block[0][0],x.slen[0]=0,x.slen[1]=0,x.slen[2]=0,x.slen[3]=0,x.max_nonzero_coeff=575,aS.fill(x.scalefac,0),o(v,x)};function a(v){this.ordinal=v}a.BINSEARCH_NONE=new a(0),a.BINSEARCH_UP=new a(1),a.BINSEARCH_DOWN=new a(2);function c(v,x,E,C,A){var k,M=v.CurrentStep[C],I=!1,z=v.OldValue[C],H=a.BINSEARCH_NONE;for(x.global_gain=z,E-=x.part2_length;;){var K;if(k=i.count_bits(v,A,x,null),M==1||k==E)break;k>E?(H==a.BINSEARCH_DOWN&&(I=!0),I&&(M/=2),H=a.BINSEARCH_UP,K=M):(H==a.BINSEARCH_UP&&(I=!0),I&&(M/=2),H=a.BINSEARCH_DOWN,K=-M),x.global_gain+=K,x.global_gain<0&&(x.global_gain=0,I=!0),x.global_gain>255&&(x.global_gain=255,I=!0)}for(SC(x.global_gain>=0),SC(x.global_gain<256);k>E&&x.global_gain<255;)x.global_gain++,k=i.count_bits(v,A,x,null);return v.CurrentStep[C]=z-x.global_gain>=4?4:2,v.OldValue[C]=x.global_gain,x.part2_3_length=k,k}this.trancate_smallspectrums=function(v,x,E,C){var A=EC(mZ.SFBMAX);if(!(!(v.substep_shaping&4)&&x.block_type==fs.SHORT_TYPE||v.substep_shaping&128)){n.calc_noise(x,E,A,new rU,null);for(var M=0;M<576;M++){var k=0;x.l3_enc[M]!=0&&(k=Math.abs(x.xr[M])),C[M]=k}var M=0,I=8;x.block_type==fs.SHORT_TYPE&&(I=6);do{var z,H,K,P,F=x.width[I];if(M+=F,!(A[I]>=1)&&(aS.sort(C,M-F,F),!BitStream.EQ(C[M-1],0))){z=(1-A[I])*E[I],H=0,P=0;do{var N;for(K=1;P+K<F&&!BitStream.NEQ(C[P+M-F],C[P+M+K-F]);K++);if(N=C[P+M-F]*C[P+M-F]*K,z<N){P!=0&&(H=C[P+M-F-1]);break}z-=N,P+=K}while(P<F);if(!BitStream.EQ(H,0))do Math.abs(x.xr[M-F])<=H&&(x.l3_enc[M-F]=0);while(--F>0)}}while(++I<x.psymax);x.part2_3_length=i.noquant_count_bits(v,x,null)}};function l(v){for(var x=0;x<v.sfbmax;x++)if(v.scalefac[x]+v.subblock_gain[v.window[x]]==0)return!1;return!0}function u(v){return nU.FAST_LOG10(.368+.632*v*v*v)}function h(v,x){for(var E=1e-37,C=0;C<x.psymax;C++)E+=u(v[C]);return Math.max(1e-20,E)}function d(v,x,E,C,A){var k;switch(v){default:case 9:{x.over_count>0?(k=E.over_SSD<=x.over_SSD,E.over_SSD==x.over_SSD&&(k=E.bits<x.bits)):k=E.max_noise<0&&E.max_noise*10+E.bits<=x.max_noise*10+x.bits;break}case 0:k=E.over_count<x.over_count||E.over_count==x.over_count&&E.over_noise<x.over_noise||E.over_count==x.over_count&&BitStream.EQ(E.over_noise,x.over_noise)&&E.tot_noise<x.tot_noise;break;case 8:E.max_noise=h(A,C);case 1:k=E.max_noise<x.max_noise;break;case 2:k=E.tot_noise<x.tot_noise;break;case 3:k=E.tot_noise<x.tot_noise&&E.max_noise<x.max_noise;break;case 4:k=E.max_noise<=0&&x.max_noise>.2||E.max_noise<=0&&x.max_noise<0&&x.max_noise>E.max_noise-.2&&E.tot_noise<x.tot_noise||E.max_noise<=0&&x.max_noise>0&&x.max_noise>E.max_noise-.2&&E.tot_noise<x.tot_noise+x.over_noise||E.max_noise>0&&x.max_noise>-.05&&x.max_noise>E.max_noise-.1&&E.tot_noise+E.over_noise<x.tot_noise+x.over_noise||E.max_noise>0&&x.max_noise>-.1&&x.max_noise>E.max_noise-.15&&E.tot_noise+E.over_noise+E.over_noise<x.tot_noise+x.over_noise+x.over_noise;break;case 5:k=E.over_noise<x.over_noise||BitStream.EQ(E.over_noise,x.over_noise)&&E.tot_noise<x.tot_noise;break;case 6:k=E.over_noise<x.over_noise||BitStream.EQ(E.over_noise,x.over_noise)&&(E.max_noise<x.max_noise||BitStream.EQ(E.max_noise,x.max_noise)&&E.tot_noise<=x.tot_noise);break;case 7:k=E.over_count<x.over_count||E.over_noise<x.over_noise;break}return x.over_count==0&&(k=k&&E.bits<x.bits),k}function m(v,x,E,C,A){var k=v.internal_flags,M;x.scalefac_scale==0?M=1.2968395546510096:M=1.6817928305074292;for(var I=0,z=0;z<x.sfbmax;z++)I<E[z]&&(I=E[z]);var H=k.noise_shaping_amp;switch(H==3&&(A?H=2:H=1),H){case 2:break;case 1:I>1?I=Math.pow(I,.5):I*=.95;break;case 0:default:I>1?I=1:I*=.95;break}for(var K=0,z=0;z<x.sfbmax;z++){var P=x.width[z],F;if(K+=P,!(E[z]<I)){if(k.substep_shaping&2&&(k.pseudohalf[z]=k.pseudohalf[z]==0?1:0,k.pseudohalf[z]==0&&k.noise_shaping_amp==2))return;for(x.scalefac[z]++,F=-P;F<0;F++)C[K+F]*=M,C[K+F]>x.xrpow_max&&(x.xrpow_max=C[K+F]);if(k.noise_shaping_amp==2)return}}}function p(v,x){for(var E=1.2968395546510096,C=0,A=0;A<v.sfbmax;A++){var k=v.width[A],M=v.scalefac[A];if(v.preflag!=0&&(M+=n.pretab[A]),C+=k,M&1){M++;for(var I=-k;I<0;I++)x[C+I]*=E,x[C+I]>v.xrpow_max&&(v.xrpow_max=x[C+I])}v.scalefac[A]=M>>1}v.preflag=0,v.scalefac_scale=1}function g(v,x,E){var C,A=x.scalefac;for(C=0;C<x.sfb_lmax;C++)if(A[C]>=16)return!0;for(var k=0;k<3;k++){var M=0,I=0;for(C=x.sfb_lmax+k;C<x.sfbdivide;C+=3)M<A[C]&&(M=A[C]);for(;C<x.sfbmax;C+=3)I<A[C]&&(I=A[C]);if(!(M<16&&I<8)){if(x.subblock_gain[k]>=7)return!0;x.subblock_gain[k]++;var z=v.scalefac_band.l[x.sfb_lmax];for(C=x.sfb_lmax+k;C<x.sfbmax;C+=3){var H,K=x.width[C],P=A[C];if(P=P-(4>>x.scalefac_scale),P>=0){A[C]=P,z+=K*3;continue}A[C]=0;{var F=210+(P<<x.scalefac_scale+1);H=n.IPOW20(F)}z+=K*(k+1);for(var N=-K;N<0;N++)E[z+N]*=H,E[z+N]>x.xrpow_max&&(x.xrpow_max=E[z+N]);z+=K*(3-k-1)}{var H=n.IPOW20(202);z+=x.width[C]*(k+1);for(var N=-x.width[C];N<0;N++)E[z+N]*=H,E[z+N]>x.xrpow_max&&(x.xrpow_max=E[z+N])}}}return!1}function y(v,x,E,C,A){var k=v.internal_flags;m(v,x,E,C,A);var M=l(x);return M?!1:(k.mode_gr==2?M=i.scale_bitcount(x):M=i.scale_bitcount_lsf(k,x),M?(k.noise_shaping>1&&(aS.fill(k.pseudohalf,0),x.scalefac_scale==0?(p(x,C),M=!1):x.block_type==fs.SHORT_TYPE&&k.subblock_gain>0&&(M=g(k,x,C)||l(x))),M||(k.mode_gr==2?M=i.scale_bitcount(x):M=i.scale_bitcount_lsf(k,x)),!M):!0)}this.outer_loop=function(v,x,E,C,A,k){var M=v.internal_flags,I=new pZ,z=EC(576),H=EC(mZ.SFBMAX),K=new rU,P,F=new oQe,N=9999999,X=!1,G=!1,j=0;if(c(M,x,k,A,C),M.noise_shaping==0)return 100;n.calc_noise(x,E,H,K,F),K.bits=x.part2_3_length,I.assign(x);var q=0;for(_y.arraycopy(C,0,z,0,576);!X;){do{var te=new rU,W,$=255;if(M.substep_shaping&2?W=20:W=3,M.sfb21_extra&&(H[I.sfbmax]>1||I.block_type==fs.SHORT_TYPE&&(H[I.sfbmax+1]>1||H[I.sfbmax+2]>1))||!y(v,I,H,C,G))break;I.scalefac_scale!=0&&($=254);var J=k-I.part2_length;if(J<=0)break;for(;(I.part2_3_length=i.count_bits(M,C,I,F))>J&&I.global_gain<=$;)I.global_gain++;if(I.global_gain>$)break;if(K.over_count==0){for(;(I.part2_3_length=i.count_bits(M,C,I,F))>N&&I.global_gain<=$;)I.global_gain++;if(I.global_gain>$)break}if(n.calc_noise(I,E,H,te,F),te.bits=I.part2_3_length,x.block_type!=fs.SHORT_TYPE?P=v.quant_comp:P=v.quant_comp_short,P=d(P,K,te,I,H)?1:0,P!=0)N=x.part2_3_length,K=te,x.assign(I),q=0,_y.arraycopy(C,0,z,0,576);else if(M.full_outer_loop==0&&(++q>W&&K.over_count==0||M.noise_shaping_amp==3&&G&&q>30||M.noise_shaping_amp==3&&G&&I.global_gain-j>15))break}while(I.global_gain+I.scalefac_scale<255);M.noise_shaping_amp==3?G?X=!0:(I.assign(x),_y.arraycopy(z,0,C,0,576),q=0,j=I.global_gain,G=!0):X=!0}return SC(x.global_gain+x.scalefac_scale<=255),v.VBR==dZ.vbr_rh||v.VBR==dZ.vbr_mtrh?_y.arraycopy(z,0,C,0,576):M.substep_shaping&1&&trancate_smallspectrums(M,x,E,C),K.over_count},this.iteration_finish_one=function(v,x,E){var C=v.l3_side,A=C.tt[x][E];i.best_scalefac_store(v,x,E,C),v.use_best_huffman==1&&i.best_huffman_divide(v,A),e.ResvAdjust(v,A)},this.VBR_encode_granule=function(v,x,E,C,A,k,M){var I=v.internal_flags,z=new pZ,H=EC(576),K=M,P=M+1,F=(M+k)/2,N,X,G=0,j=I.sfb21_extra;SC(K<=LameInternalFlags.MAX_BITS_PER_CHANNEL),aS.fill(z.l3_enc,0);do F>K-42?I.sfb21_extra=!1:I.sfb21_extra=j,X=outer_loop(v,x,E,C,A,F),X<=0?(G=1,P=x.part2_3_length,z.assign(x),_y.arraycopy(C,0,H,0,576),M=P-32,N=M-k,F=(M+k)/2):(k=F+32,N=M-k,F=(M+k)/2,G!=0&&(G=2,x.assign(z),_y.arraycopy(H,0,C,0,576)));while(N>12);I.sfb21_extra=j,G==2&&_y.arraycopy(z.l3_enc,0,x.l3_enc,0,576),SC(x.part2_3_length<=K)},this.get_framebits=function(v,x){var E=v.internal_flags;E.bitrate_index=E.VBR_min_bitrate;var C=t.getframebits(v);E.bitrate_index=1,C=t.getframebits(v);for(var A=1;A<=E.VBR_max_bitrate;A++){E.bitrate_index=A;var k=new MeanBits(C);x[A]=e.ResvFrameBegin(v,k),C=k.bits}},this.VBR_old_prepare=function(v,x,E,C,A,k,M,I,z){var H=v.internal_flags,K,P=0,F=1,N=0;H.bitrate_index=H.VBR_max_bitrate;var X=e.ResvFrameBegin(v,new MeanBits(0))/H.mode_gr;get_framebits(v,k);for(var G=0;G<H.mode_gr;G++){var j=n.on_pe(v,x,I[G],X,G,0);H.mode_ext==fs.MPG_MD_MS_LR&&(ms_convert(H.l3_side,G),n.reduce_side(I[G],E[G],X,j));for(var q=0;q<H.channels_out;++q){var te=H.l3_side.tt[G][q];te.block_type!=fs.SHORT_TYPE?(P=1.28/(1+Math.exp(3.5-x[G][q]/300))-.05,K=H.PSY.mask_adjust-P):(P=2.56/(1+Math.exp(3.5-x[G][q]/300))-.14,K=H.PSY.mask_adjust_short-P),H.masking_lower=Math.pow(10,K*.1),init_outer_loop(H,te),z[G][q]=n.calc_xmin(v,C[G][q],te,A[G][q]),z[G][q]!=0&&(F=0),M[G][q]=126,N+=I[G][q]}}for(var G=0;G<H.mode_gr;G++)for(var q=0;q<H.channels_out;q++)N>k[H.VBR_max_bitrate]&&(I[G][q]*=k[H.VBR_max_bitrate],I[G][q]/=N),M[G][q]>I[G][q]&&(M[G][q]=I[G][q]);return F},this.bitpressure_strategy=function(v,x,E,C){for(var A=0;A<v.mode_gr;A++)for(var k=0;k<v.channels_out;k++){for(var M=v.l3_side.tt[A][k],I=x[A][k],z=0,H=0;H<M.psy_lmax;H++)I[z++]*=1+.029*H*H/fs.SBMAX_l/fs.SBMAX_l;if(M.block_type==fs.SHORT_TYPE)for(var H=M.sfb_smin;H<fs.SBMAX_s;H++)I[z++]*=1+.029*H*H/fs.SBMAX_s/fs.SBMAX_s,I[z++]*=1+.029*H*H/fs.SBMAX_s/fs.SBMAX_s,I[z++]*=1+.029*H*H/fs.SBMAX_s/fs.SBMAX_s;C[A][k]=0|Math.max(E[A][k],.9*C[A][k])}},this.VBR_new_prepare=function(v,x,E,C,A,k){var M=v.internal_flags,I=1,z=0,H=0,K;if(v.free_format){M.bitrate_index=0;var P=new MeanBits(z);K=e.ResvFrameBegin(v,P),z=P.bits,A[0]=K}else{M.bitrate_index=M.VBR_max_bitrate;var P=new MeanBits(z);e.ResvFrameBegin(v,P),z=P.bits,get_framebits(v,A),K=A[M.VBR_max_bitrate]}for(var F=0;F<M.mode_gr;F++){n.on_pe(v,x,k[F],z,F,0),M.mode_ext==fs.MPG_MD_MS_LR&&ms_convert(M.l3_side,F);for(var N=0;N<M.channels_out;++N){var X=M.l3_side.tt[F][N];M.masking_lower=Math.pow(10,M.PSY.mask_adjust*.1),init_outer_loop(M,X),n.calc_xmin(v,E[F][N],X,C[F][N])!=0&&(I=0),H+=k[F][N]}}for(var F=0;F<M.mode_gr;F++)for(var N=0;N<M.channels_out;N++)H>K&&(k[F][N]*=K,k[F][N]/=H);return I},this.calc_target_bits=function(v,x,E,C,A,k){var M=v.internal_flags,I=M.l3_side,z,H,K,P,F=0;M.bitrate_index=M.VBR_max_bitrate;var N=new MeanBits(F);for(k[0]=e.ResvFrameBegin(v,N),F=N.bits,M.bitrate_index=1,F=t.getframebits(v)-M.sideinfo_len*8,A[0]=F/(M.mode_gr*M.channels_out),F=v.VBR_mean_bitrate_kbps*v.framesize*1e3,M.substep_shaping&1&&(F*=1.09),F/=v.out_samplerate,F-=M.sideinfo_len*8,F/=M.mode_gr*M.channels_out,z=.93+.07*(11-v.compression_ratio)/(11-5.5),z<.9&&(z=.9),z>1&&(z=1),H=0;H<M.mode_gr;H++){var X=0;for(K=0;K<M.channels_out;K++){if(C[H][K]=int(z*F),x[H][K]>700){var G=int((x[H][K]-700)/1.4),j=I.tt[H][K];C[H][K]=int(z*F),j.block_type==fs.SHORT_TYPE&&G<F/2&&(G=F/2),G>F*3/2?G=F*3/2:G<0&&(G=0),C[H][K]+=G}C[H][K]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(C[H][K]=LameInternalFlags.MAX_BITS_PER_CHANNEL),X+=C[H][K]}if(X>LameInternalFlags.MAX_BITS_PER_GRANULE)for(K=0;K<M.channels_out;++K)C[H][K]*=LameInternalFlags.MAX_BITS_PER_GRANULE,C[H][K]/=X}if(M.mode_ext==fs.MPG_MD_MS_LR)for(H=0;H<M.mode_gr;H++)n.reduce_side(C[H],E[H],F*M.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(P=0,H=0;H<M.mode_gr;H++)for(K=0;K<M.channels_out;K++)C[H][K]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(C[H][K]=LameInternalFlags.MAX_BITS_PER_CHANNEL),P+=C[H][K];if(P>k[0])for(H=0;H<M.mode_gr;H++)for(K=0;K<M.channels_out;K++)C[H][K]*=k[0],C[H][K]/=P}}var cQe=aQe,lQe=Ta,gZ=lQe.assert;function uQe(){var t;this.setModules=function(e){t=e},this.ResvFrameBegin=function(e,n){var r=e.internal_flags,i,s=r.l3_side,o=t.getframebits(e);n.bits=(o-r.sideinfo_len*8)/r.mode_gr;var a=8*256*r.mode_gr-8;e.brate>320?i=8*int(e.brate*1e3/(e.out_samplerate/1152)/8+.5):(i=8*1440,e.strict_ISO&&(i=8*int(32e4/(e.out_samplerate/1152)/8+.5))),r.ResvMax=i-o,r.ResvMax>a&&(r.ResvMax=a),(r.ResvMax<0||e.disable_reservoir)&&(r.ResvMax=0);var c=n.bits*r.mode_gr+Math.min(r.ResvSize,r.ResvMax);return c>i&&(c=i),gZ(r.ResvMax%8==0),gZ(r.ResvMax>=0),s.resvDrain_pre=0,r.pinfo!=null&&(r.pinfo.mean_bits=n.bits/2,r.pinfo.resvsize=r.ResvSize),c},this.ResvMaxBits=function(e,n,r,i){var s=e.internal_flags,o,a=s.ResvSize,c=s.ResvMax;i!=0&&(a+=n),s.substep_shaping&1&&(c*=.9),r.bits=n,a*10>c*9?(o=a-c*9/10,r.bits+=o,s.substep_shaping|=128):(o=0,s.substep_shaping&=127,!e.disable_reservoir&&!(s.substep_shaping&1)&&(r.bits-=.1*n));var l=a<s.ResvMax*6/10?a:s.ResvMax*6/10;return l-=o,l<0&&(l=0),l},this.ResvAdjust=function(e,n){e.ResvSize-=n.part2_3_length+n.part2_length},this.ResvFrameEnd=function(e,n){var r,i=e.l3_side;e.ResvSize+=n*e.mode_gr;var s=0;i.resvDrain_post=0,i.resvDrain_pre=0,(r=e.ResvSize%8)!=0&&(s+=r),r=e.ResvSize-s-e.ResvMax,r>0&&(s+=r);{var o=Math.min(i.main_data_begin*8,s)/8;i.resvDrain_pre+=8*o,s-=8*o,e.ResvSize-=8*o,i.main_data_begin-=o}i.resvDrain_post+=s,e.ResvSize-=s}}var fQe=uQe;function hQe(){var t="http://www.mp3dev.org/",e=3,n=98,r=4,i=0,s=93;this.getLameVersion=function(){return e+"."+n+"."+r},this.getLameShortVersion=function(){return e+"."+n+"."+r},this.getLameVeryShortVersion=function(){return"LAME"+e+"."+n+"r"},this.getPsyVersion=function(){return i+"."+s},this.getLameUrl=function(){return t},this.getLameOsBitness=function(){return"32bits"}}var dQe=hQe,dT=Ta,pQe=dT.System,iU=dT.VbrMode,_Z=dT.ShortBlock,mQe=dT.Arrays,$k=dT.new_byte,gQe=dT.assert;hM.NUMTOCENTRIES=100;hM.MAXFRAMESIZE=2880;function hM(){var t,e,n;this.setModules=function(F,N,X){t=F,e=N,n=X};var r=1,i=2,s=4,o=8,a=hM.NUMTOCENTRIES,c=hM.MAXFRAMESIZE,l=a+4+4+4+4+4,u=l+9+1+1+8+1+1+3+1+1+2+4+2+2,h=128,d=64,m=32,p=null,g="Xing",y="Info",v=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function x(F,N){if(F.nVbrNumFrames++,F.sum+=N,F.seen++,!(F.seen<F.want)&&(F.pos<F.size&&(F.bag[F.pos]=F.sum,F.pos++,F.seen=0),F.pos==F.size)){for(var X=1;X<F.size;X+=2)F.bag[X/2]=F.bag[X];F.want*=2,F.pos/=2}}function E(F,N){if(!(F.pos<=0))for(var X=1;X<a;++X){var G=X/a,j,q,te=0|Math.floor(G*F.pos);te>F.pos-1&&(te=F.pos-1),j=F.bag[te],q=F.sum;var W=0|256*j/q;W>255&&(W=255),N[X]=255&W}}this.addVbrFrame=function(F){var N=F.internal_flags,X=Tables.bitrate_table[F.version][N.bitrate_index];gQe(N.VBR_seek_table.bag!=null),x(N.VBR_seek_table,X)};function C(F,N){var X=F[N+0]&255;return X<<=8,X|=F[N+1]&255,X<<=8,X|=F[N+2]&255,X<<=8,X|=F[N+3]&255,X}function A(F,N,X){F[N+0]=255&(X>>24&255),F[N+1]=255&(X>>16&255),F[N+2]=255&(X>>8&255),F[N+3]=255&(X&255)}function k(F,N,X){F[N+0]=255&(X>>8&255),F[N+1]=255&(X&255)}function M(F,N){return new String(F,N,g.length(),p).equals(g)||new String(F,N,y.length(),p).equals(y)}function I(F,N,X){return 255&(F<<N|X&~(-1<<N))}function z(F,N){var X=F.internal_flags;N[0]=I(N[0],8,255),N[1]=I(N[1],3,7),N[1]=I(N[1],1,F.out_samplerate<16e3?0:1),N[1]=I(N[1],1,F.version),N[1]=I(N[1],2,1),N[1]=I(N[1],1,F.error_protection?0:1),N[2]=I(N[2],4,X.bitrate_index),N[2]=I(N[2],2,X.samplerate_index),N[2]=I(N[2],1,0),N[2]=I(N[2],1,F.extension),N[3]=I(N[3],2,F.mode.ordinal()),N[3]=I(N[3],2,X.mode_ext),N[3]=I(N[3],1,F.copyright),N[3]=I(N[3],1,F.original),N[3]=I(N[3],2,F.emphasis),N[0]=255;var G=255&(N[1]&241),j;F.version==1?j=h:F.out_samplerate<16e3?j=m:j=d,F.VBR==iU.vbr_off&&(j=F.brate);var q;F.free_format?q=0:q=255&16*t.BitrateIndex(j,F.version,F.out_samplerate),F.version==1?(N[1]=255&(G|10),G=255&(N[2]&13),N[2]=255&(q|G)):(N[1]=255&(G|2),G=255&(N[2]&13),N[2]=255&(q|G))}this.getVbrTag=function(F){var N=new VBRTagData,X=0;N.flags=0;var G=F[X+1]>>3&1,j=F[X+2]>>2&3,q=F[X+3]>>6&3,te=F[X+2]>>4&15;if(te=Tables.bitrate_table[G][te],F[X+1]>>4==14?N.samprate=Tables.samplerate_table[2][j]:N.samprate=Tables.samplerate_table[G][j],G!=0?q!=3?X+=36:X+=21:q!=3?X+=21:X+=13,!M(F,X))return null;X+=4,N.hId=G;var W=N.flags=C(F,X);if(X+=4,W&r&&(N.frames=C(F,X),X+=4),W&i&&(N.bytes=C(F,X),X+=4),W&s){if(N.toc!=null)for(var $=0;$<a;$++)N.toc[$]=F[X+$];X+=a}N.vbrScale=-1,W&o&&(N.vbrScale=C(F,X),X+=4),N.headersize=(G+1)*72e3*te/N.samprate,X+=21;var J=F[X+0]<<4;J+=F[X+1]>>4;var ne=(F[X+1]&15)<<8;return ne+=F[X+2]&255,(J<0||J>3e3)&&(J=-1),(ne<0||ne>3e3)&&(ne=-1),N.encDelay=J,N.encPadding=ne,N},this.InitVbrTag=function(F){var N=F.internal_flags,X;F.version==1?X=h:F.out_samplerate<16e3?X=m:X=d,F.VBR==iU.vbr_off&&(X=F.brate);var G=(F.version+1)*72e3*X/F.out_samplerate,j=N.sideinfo_len+u;if(N.VBR_seek_table.TotalFrameSize=G,G<j||G>c){F.bWriteVbrTag=!1;return}N.VBR_seek_table.nVbrNumFrames=0,N.VBR_seek_table.nBytesWritten=0,N.VBR_seek_table.sum=0,N.VBR_seek_table.seen=0,N.VBR_seek_table.want=1,N.VBR_seek_table.pos=0,N.VBR_seek_table.bag==null&&(N.VBR_seek_table.bag=new int[400],N.VBR_seek_table.size=400);var q=$k(c);z(F,q);for(var te=N.VBR_seek_table.TotalFrameSize,W=0;W<te;++W)e.add_dummy_byte(F,q[W]&255,1)};function H(F,N){var X=N^F;return N=N>>8^v[X&255],N}this.updateMusicCRC=function(F,N,X,G){for(var j=0;j<G;++j)F[0]=H(N[X+j],F[0])};function K(F,N,X,G,j){var q=F.internal_flags,te=0,W=F.encoder_delay,$=F.encoder_padding,J=100-10*F.VBR_q-F.quality,ne=n.getLameVeryShortVersion(),ie,ae=0,xe,Ne=[1,5,3,2,4,0,3],Re=0|(F.lowpassfreq/100+.5>255?255:F.lowpassfreq/100+.5),Se=0,ze=0,Be=0,Je=F.internal_flags.noise_shaping,at=0,re=0,Le=0,He=0,Ue=0,De=(F.exp_nspsytune&1)!=0,fe=(F.exp_nspsytune&2)!=0,ve=!1,Ae=!1,pe=F.internal_flags.nogap_total,Ge=F.internal_flags.nogap_current,Qe=F.ATHtype,Ze=0,tt;switch(F.VBR){case vbr_abr:tt=F.VBR_mean_bitrate_kbps;break;case vbr_off:tt=F.brate;break;default:tt=F.VBR_min_bitrate_kbps}switch(F.VBR.ordinal()<Ne.length?ie=Ne[F.VBR.ordinal()]:ie=0,xe=16*ae+ie,q.findReplayGain&&(q.RadioGain>510&&(q.RadioGain=510),q.RadioGain<-510&&(q.RadioGain=-510),ze=8192,ze|=3072,q.RadioGain>=0?ze|=q.RadioGain:(ze|=512,ze|=-q.RadioGain)),q.findPeakSample&&(Se=Math.abs(0|q.PeakSample/32767*Math.pow(2,23)+.5)),pe!=-1&&(Ge>0&&(Ae=!0),Ge<pe-1&&(ve=!0)),Ze=Qe+((De?1:0)<<4)+((fe?1:0)<<5)+((ve?1:0)<<6)+((Ae?1:0)<<7),J<0&&(J=0),F.mode){case MONO:at=0;break;case STEREO:at=1;break;case DUAL_CHANNEL:at=2;break;case JOINT_STEREO:F.force_ms?at=4:at=3;break;case NOT_SET:default:at=7;break}F.in_samplerate<=32e3?Le=0:F.in_samplerate==48e3?Le=2:F.in_samplerate>48e3?Le=3:Le=1,(F.short_blocks==_Z.short_block_forced||F.short_blocks==_Z.short_block_dispensed||F.lowpassfreq==-1&&F.highpassfreq==-1||F.scale_left<F.scale_right||F.scale_left>F.scale_right||F.disable_reservoir&&F.brate<320||F.noATH||F.ATHonly||Qe==0||F.in_samplerate<=32e3)&&(re=1),He=Je+(at<<2)+(re<<5)+(Le<<6),Ue=q.nMusicCRC,A(X,G+te,J),te+=4;for(var Ft=0;Ft<9;Ft++)X[G+te+Ft]=255&ne.charAt(Ft);te+=9,X[G+te]=255&xe,te++,X[G+te]=255&Re,te++,A(X,G+te,Se),te+=4,k(X,G+te,ze),te+=2,k(X,G+te,Be),te+=2,X[G+te]=255&Ze,te++,tt>=255?X[G+te]=255:X[G+te]=255&tt,te++,X[G+te]=255&W>>4,X[G+te+1]=255&(W<<4)+($>>8),X[G+te+2]=255&$,te+=3,X[G+te]=255&He,te++,X[G+te++]=0,k(X,G+te,F.preset),te+=2,A(X,G+te,N),te+=4,k(X,G+te,Ue),te+=2;for(var bt=0;bt<te;bt++)j=H(X[G+bt],j);return k(X,G+te,j),te+=2,te}function P(F){F.seek(0);var N=$k(10);F.readFully(N);var X;return new String(N,"ISO-8859-1").startsWith("ID3")?X=0:X=((N[6]&127)<<21|(N[7]&127)<<14|(N[8]&127)<<7|N[9]&127)+N.length,X}this.getLameTagFrame=function(F,N){var X=F.internal_flags;if(!F.bWriteVbrTag||X.Class_ID!=Lame.LAME_ID||X.VBR_seek_table.pos<=0)return 0;if(N.length<X.VBR_seek_table.TotalFrameSize)return X.VBR_seek_table.TotalFrameSize;mQe.fill(N,0,X.VBR_seek_table.TotalFrameSize,0),z(F,N);var G=$k(a);if(F.free_format)for(var j=1;j<a;++j)G[j]=255&255*j/100;else E(X.VBR_seek_table,G);var q=X.sideinfo_len;F.error_protection&&(q-=2),F.VBR==iU.vbr_off?(N[q++]=255&y.charAt(0),N[q++]=255&y.charAt(1),N[q++]=255&y.charAt(2),N[q++]=255&y.charAt(3)):(N[q++]=255&g.charAt(0),N[q++]=255&g.charAt(1),N[q++]=255&g.charAt(2),N[q++]=255&g.charAt(3)),A(N,q,r+i+s+o),q+=4,A(N,q,X.VBR_seek_table.nVbrNumFrames),q+=4;var te=X.VBR_seek_table.nBytesWritten+X.VBR_seek_table.TotalFrameSize;A(N,q,0|te),q+=4,pQe.arraycopy(G,0,N,q,G.length),q+=G.length,F.error_protection&&e.CRC_writeheader(X,N);for(var W=0,j=0;j<q;j++)W=H(N[j],W);return q+=K(F,te,N,q,W),X.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(F,N){var X=F.internal_flags;if(X.VBR_seek_table.pos<=0||(N.seek(N.length()),N.length()==0))return-1;var G=P(N);N.seek(G);var j=$k(c),q=getLameTagFrame(F,j);return q>j.length?-1:(q<1||N.write(j,0,q),0)}}var _Qe=hM,zfe=Ta,vZ=zfe.new_byte,vQe=zfe.assert,yQe=O9(),bQe=ZJe,EQe=Dfe,SQe=Bfe(),xQe=cQe,TQe=Ffe(),wQe=fQe,RQe=m2,CQe=k9();df();var AQe=dQe,MQe=_Qe;function kQe(){this.setModules=function(t,e){}}function OQe(){this.setModules=function(t,e,n){}}function IQe(){}function NQe(){this.setModules=function(t,e){}}function PQe(t,e,n){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),t=1,e=44100,n=128);var r=new yQe,i=new kQe,s=new EQe,o=new CQe,a=new bQe,c=new SQe,l=new xQe,u=new MQe,h=new AQe,d=new NQe,m=new wQe,p=new TQe,g=new OQe,y=new IQe;r.setModules(s,o,a,c,l,u,h,d,y),o.setModules(s,y,h,u),d.setModules(o,h),a.setModules(r),l.setModules(o,m,c,p),c.setModules(p,m,r.enc.psy),m.setModules(o),p.setModules(c),u.setModules(r,o,h),i.setModules(g,y),g.setModules(h,d,a);var v=r.lame_init();v.num_channels=t,v.in_samplerate=e,v.brate=n,v.mode=RQe.STEREO,v.quality=3,v.bWriteVbrTag=!1,v.disable_reservoir=!0,v.write_id3tag_automatic=!1,r.lame_init_params(v);var x=1152,E=0|1.25*x+7200,C=vZ(E);this.encodeBuffer=function(A,k){t==1&&(k=A),vQe(A.length==k.length),A.length>x&&(x=A.length,E=0|1.25*x+7200,C=vZ(E));var M=r.lame_encode_buffer(v,A,k,A.length,C,0,E);return new Int8Array(C.subarray(0,M))},this.flush=function(){var A=r.lame_encode_flush(v,C,0,E);return new Int8Array(C.subarray(0,A))}}function _0(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function BP(t){return t.charCodeAt(0)<<24|t.charCodeAt(1)<<16|t.charCodeAt(2)<<8|t.charCodeAt(3)}_0.RIFF=BP("RIFF");_0.WAVE=BP("WAVE");_0.fmt_=BP("fmt ");_0.data=BP("data");_0.readHeader=function(t){var e=new _0,n=t.getUint32(0,!1);if(_0.RIFF==n&&(t.getUint32(4,!0),_0.WAVE==t.getUint32(8,!1)&&_0.fmt_==t.getUint32(12,!1))){var r=t.getUint32(16,!0),i=20;switch(r){case 16:case 18:e.channels=t.getUint16(i+2,!0),e.sampleRate=t.getUint32(i+4,!0);break;default:throw"extended fmt chunk not implemented"}i+=r;for(var s=_0.data,o=0;s!=n&&(n=t.getUint32(i,!1),o=t.getUint32(i+4,!0),s!=n);)i+=o+8;return e.dataLen=o,e.dataOffset=i+8,e}};var DQe=PQe;async function LQe(t){const e=ui(),n=t.getChannelData(0),r=t.sampleRate,i=new DQe(1,r,128),s=1152,o=[];for(let c=0;c<n.length;c+=s){o.length%64===0&&oi(ut,e,`encoding chunk (${c}/${n.length})`);const l=new Int16Array(s);for(let h=0;h<s;h++)c+h<n.length&&(l[h]=n[c+h]<0?n[c+h]*32768:n[c+h]*32767);const u=i.encodeBuffer(l);u.length>0&&o.push(u),o.length%16===0&&await Kl(10)}const a=i.flush();return a.length>0&&o.push(a),oi(ut,e,`total chunks ${o.length+1}`),await Kl(100),new Uint8Array(o.reduce((c,l)=>{const u=new Uint8Array(c.length+l.length);return u.set(c,0),u.set(l,c.length),u},new Uint8Array(0)))}const yZ=4,UQe={a:1,b:2,c:3,d:4,e:5,f:6,g:7,x:8,A:1,B:2,C:3,D:4,E:5,F:6,G:7,X:8,"#":9,"!":10,y:13,t:14,s:15,i:16,q:17,h:18,w:19,Y:13,T:14,S:15,I:16,Q:17,H:18,W:19,3:20,".":21,"+":11,"-":12,0:22,1:23,2:24,p:25,4:26,5:27,6:29,7:28,8:30,9:31},Hfe="64n";function BQe(t){return $l({[Hfe]:t}).toNotation()}function FQe(t){return $l({[Hfe]:t}).toSeconds()}function jQe(t,e,n,r=!0){let i=e,s=4,o=2,a="",c="";const l=[];function u(){c="",a="",i+=FQe(o)}function h(){const d=BQe(o);c===null?(l.push([i,[t,d,c]]),u()):an(c)?(l.push([i,[t,d,c]]),u()):c.startsWith("#")?(l.push([i,[t,d,c]]),u()):c!==""&&(l.push([i,[t,d,`${c}${a}${s}`]]),u())}if(Sn(n))c=n;else for(let d=0;d<n.length;++d){switch(n[d]){case 9:case 10:break;default:h();break}switch(n[d]){case 1:c="A";break;case 2:c="B";break;case 3:c="C";break;case 4:c="D";break;case 5:c="E";break;case 6:c="F";break;case 7:c="G";break;case 8:c=null;break;case 9:a+="#";break;case 10:a+="b";break;case 11:s<8&&++s;break;case 12:s>0&&--s;break;case 13:o=1;break;case 14:o=2;break;case 15:o=4;break;case 16:o=8;break;case 17:o=16;break;case 18:o=32;break;case 19:o=64;break;case 20:o=Math.round(o/3);break;case 21:o=Math.round(o*3/2);break;case 22:c=0;break;case 23:c=1;break;case 24:c=2;break;case 25:c=3;break;case 26:c=4;break;case 27:c=5;break;case 29:c=6;break;case 28:c=7;break;case 30:c=8;break;case 31:c=9;break}}return h(),r&&l.push([i,[t,"8n",-1]]),l}function bZ(t){const e=[],n=t.split(";");for(let r=0;r<n.length;++r){const i=[],s=n[r];if(s.startsWith("#"))e.push(s);else{for(let o=0;o<s.length;++o){const a=UQe[s[o]];ge(a)&&i.push(a)}e.push(i)}}return e}const zQe="/assets/sidechainworklet-ByNOiUo8.js";class I9 extends nd{name="SidechainCompressor";threshold;ratio;attack;release;mix;makeupGain;sidechain=new Jr;_audioworkletnode=this.context.createAudioWorkletNode("sidechaincompressorprocessor",{numberOfInputs:2,outputChannelCount:[2]});constructor(){const e=Gn(I9.getDefaults(),arguments,["threshold","ratio","attack","release","mix","makeupGain"]);super(e),this.threshold=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("threshold"),value:e.threshold,minValue:-128,maxValue:0}),this.ratio=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("ratio"),value:e.ratio,minValue:1,maxValue:128}),this.attack=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("attack"),value:e.attack,minValue:1e-4,maxValue:128}),this.release=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("release"),value:e.release,minValue:1e-4,maxValue:128}),this.mix=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("mix"),value:e.mix,minValue:0,maxValue:1}),this.makeupGain=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("makeupGain"),value:e.makeupGain,minValue:-128,maxValue:60}),this.connectEffect(this._audioworkletnode),this.sidechain.connect(this._audioworkletnode,0,1)}static getDefaults(){return Object.assign(nd.getDefaults(),{threshold:-28,ratio:4,attack:.005,release:.005,mix:1,makeupGain:0})}dispose(){return super.dispose(),this._audioworkletnode.disconnect(),this}}function HQe(){return sa().rawContext.audioWorklet.addModule(zQe)}var no=(t=>(t[t.SYNTH=0]="SYNTH",t[t.RETRO_NOISE=1]="RETRO_NOISE",t[t.BUZZ_NOISE=2]="BUZZ_NOISE",t[t.CLANG_NOISE=3]="CLANG_NOISE",t[t.METALLIC_NOISE=4]="METALLIC_NOISE",t[t.BELLS=5]="BELLS",t[t.DOOT=6]="DOOT",t))(no||{});const EZ=131072;function qQe(t){const e=sa().createBuffer(1,EZ,sa().sampleRate);let n=1;const r=e.getChannelData(0);for(let i=0;i<EZ;i++){t===4?r[i]=(n&1)*4*(Math.random()*14+1)-8:r[i]=(n&1)*2-1;let s=n>>1;if((n+s&1)==1)switch(t){default:case 1:s+=16384;break;case 3:s+=32768;break;case 2:s+=40;break;case 4:s+=60;break}n=s}return e}function K_(t){let e,n;function r(){switch(e?.type){case 0:{e.synth.set({...n,envelope:{...n.envelope,attack:.01,decay:.01,sustain:.5,release:.01},oscillator:{...n.oscillator,type:"square"}});break}case 1:{e.synth.set({...n,attack:.01,decay:.01,sustain:.5,release:.01});break}case 5:{e.synth.set({...n,harmonicity:1.5,modulationIndex:30,oscillator:{type:"sine"},modulation:{type:"square"},envelope:{attack:.01,decay:3,sustain:.3,release:6},modulationEnvelope:{attack:.5,decay:1,sustain:.2,release:4}});break}case 6:{e.synth.set({...n});break}}}function i(){return{type:e?.type,synth:e?.synth.get()}}function s(a){e?.synth.set(a.synth)}function o(){e?.synth.dispose()}switch(t){case 0:return e={type:t,synth:new ef},n=na(e.synth.get()),r(),{source:e,applyreset:r,getreplay:i,setreplay:s,destroy:o};case 1:case 2:case 3:case 4:return e={type:t,synth:new h2({volume:-44,urls:{C4:qQe(t)}}),filter1:new Ux({type:"lowshelf",gain:-32,frequency:440}),filter2:new Ux({type:"highshelf",gain:32,frequency:440})},n=na(e.synth.get()),r(),{source:e,applyreset:r,getreplay:i,setreplay:s,destroy:o};case 5:return e={type:5,synth:new l9,sparkle:new u9({volume:-16,envelope:{attack:.001,decay:1.4,release:.321},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5})},n=na(e.synth.get()),r(),{source:e,applyreset:r,getreplay:i,setreplay:s,destroy:o};case 6:return e={type:t,synth:new uT},n=na(e.synth.get()),r(),{source:e,applyreset:r,getreplay:i,setreplay:s,destroy:o}}}async function qfe(){await QZe(),await HQe()}function Vfe(){const t=iZe(),e=new Mh;e.connect(t);let n;sa().isOffline||(n=sa().createMediaStreamDestination(),e.connect(n));const r=new Jr(10),i=new PP({maxDelay:.005,frequency:1.5,depth:.2,type:"sine",wet:.6}),s=new _9({frequency:.6,delayTime:7,depth:.7,type:"sine",spread:128,wet:.5}),o=new Q1({type:"pink",volume:-42}),a=new Mh,c=new s9,l=new Da(Math.PI*.25,"sine");l.chain(c,a.volume),l.start(),o.start(),o.chain(a,s),i.chain(s,e);const u=new x9({threshold:-24,ratio:4,attack:.003,release:.25,knee:30});r.chain(u,i);const h=new I9({threshold:-42,ratio:4,attack:.005,release:.005,mix:.777,makeupGain:24});h.connect(r);const d=new Mh(-12),m=new Mh(-32),p=new Mh(Bf(20));p.connect(h);const g=new Mh(Bf(100));g.connect(r);const y=new Mh;y.connect(r),y.connect(d);const v=new Mh;v.connect(r),v.connect(d),d.connect(h.sidechain),m.connect(h.sidechain);const x=[K_(no.SYNTH),K_(no.SYNTH),K_(no.SYNTH),K_(no.SYNTH),K_(no.SYNTH),K_(no.SYNTH),K_(no.SYNTH),K_(no.SYNTH)],E=eJe(),C=[G4(1),G4(2),G4(3)];for(let Be=0;Be<C.length;++Be){const Je=C[Be];Je.fc.connect(E.fc),Je.echo.connect(E.echo),Je.reverb.connect(E.reverb),Je.phaser.connect(E.phaser),Je.vibrato.connect(E.vibrato),Je.distortion.connect(E.distortion),Je.autowah.connect(E.autowah);const re=Be<2?p:y;E.fc.connect(re),E.echo.connect(re),E.reverb.connect(re),E.phaser.connect(re),E.vibrato.connect(re),E.distortion.connect(re),E.autowah.connect(re)}function A(Be){return Be<4?Math.floor(Be/2):2}function k(Be){const Je=A(Be),re=Be<4?p:y;switch(x[Be]?.source.type){case no.RETRO_NOISE:case no.BUZZ_NOISE:case no.CLANG_NOISE:case no.METALLIC_NOISE:break;default:x[Be]?.source.synth.connect(re),x[Be]?.source.synth.connect(C[Je].sendtofx);break}switch(x[Be]?.source.type){case no.RETRO_NOISE:case no.BUZZ_NOISE:case no.CLANG_NOISE:case no.METALLIC_NOISE:x[Be]?.source.synth.chain(x[Be]?.source.filter1,x[Be]?.source.filter2,re),x[Be]?.source.synth.chain(x[Be]?.source.filter1,x[Be]?.source.filter2,C[Je].sendtofx);break;case no.BELLS:{x[Be]?.source.sparkle.connect(re),x[Be]?.source.sparkle.connect(C[Je].sendtofx);break}}}for(let Be=0;Be<x.length;++Be)k(Be);function M(Be,Je){x[Be]?.source.type!==Je&&(x[Be]?.source.synth.dispose(),x[Be]=K_(Je),k(Be))}const I=ZZe(g,m);let z=new lM(G),H=0,K=0,P=[];function F(Be,Je,at){Be.forEach((re,Le)=>{M(Le,re.type),x[Le].setreplay(re)}),E.setreplay(Je),at.forEach((re,Le)=>{C[Le].setreplay(re)})}function N(){P=[],H=0,K=0}function X(Be){if(P.length){const Je=ui(),at=P.map(pe=>{const[Ge]=pe;return Ge}),re=Math.min(...at),Le=Math.max(...at),He=Math.ceil(Le-re+5),Ue=[];for(let pe=0;pe<P.length;++pe){const[Ge,Qe]=P[pe];Ue.push([Ge-re+.1,Qe])}const De=x.map(pe=>pe.getreplay()),fe=E.getreplay(),ve=C.map(pe=>pe.getreplay());let Ae;VYe(async({transport:pe})=>{oi(ut,Je,"create synth"),await qfe(),Ae=Vfe(),oi(ut,Je,"synth waiting for setup"),await Kl(2e3),Ae.setplayvolume(40),Ae.applyreplay(De,fe,ve),Ae.synthreplay(Ue,Le),oi(ut,Je,"rendering audio"),pe.start(0)},He).then(pe=>(oi(ut,Je,"rendering complete, exporting mp3"),LQe(pe))).then(pe=>{const Ge=document.createElement("a");Ge.href=URL.createObjectURL(new Blob([pe],{type:"audio/mp3"})),Ge.download=`${Be||fte()}.mp3`,oi(ut,Je,`saving file ${Ge.download}`),Ge.click(),Ae?.destroy()}).catch(pe=>{Pr(ut,Je,"synthrecord",pe)})}N()}function G(Be,Je){if(Je===null)return;if(K>0){const Ue=Math.round(Be/K*100);Ue!==H&&(H=Ue,oi(ut,ui(),`${Ue}%`))}else P.push([Be,Je]);const[at,re,Le]=Je,He=A(at);if(Sn(Le)&&ge(x[at])&&ge(C[He]))if(Le.startsWith("#"))sZe().schedule(()=>cxe(ut,"",Le.slice(1)),Be);else{switch(x[at].source.type){case no.BELLS:x[at].source.synth.detune.value=Bd(-3,3),x[at].source.sparkle.triggerAttackRelease(KZe(Le,2),re,Be);break}x[at].source.synth.triggerAttackRelease(Le,re,Be);const Ue=x[at].source.synth.toSeconds(re),De="128n",fe=x[at].source.synth.toSeconds(De);E.vibrato.depth.rampTo(1,"2n",Be),E.vibrato.depth.rampTo(0,De,Be+Ue-fe),E.vibrato.frequency.rampTo(5,"4n",Be),E.vibrato.frequency.rampTo(1,De,Be+Ue-fe)}if(an(Le))switch(Le){case 0:I.ticktrigger(Be);break;case 1:I.tweettrigger(Be);break;case 2:I.cowbelltrigger(re,Be);break;case 3:I.claptrigger(re,Be);break;case 4:I.hisnaretrigger(re,Be);break;case 5:I.hiwoodblocktrigger(re,Be);break;case 6:I.lowsnaretrigger(re,Be);break;case 7:I.lowtomtrigger(re,Be);break;case 8:I.lowwoodblocktrigger(re,Be);break;case 9:I.basstrigger(Be);break;case-1:--W,W===0&&(z.clear(),te=-1);break}}function j(Be,Je,at,re=!0){let Le=Je;const He=jQe(Be,Je,at,re),Ue=He[He.length-1];ge(Ue)&&(Le=Math.max(Le,Ue[0]));for(let De=0;De<He.length;++De){const[fe,ve]=He[De];z.add(fe,ve)}return Le}function q(Be,Je){H=0,K=Je;for(let at=0;at<Be.length;++at){const[re,Le]=Be[at];z.add(re,Le)}}let te=-1,W=0,$=yZ;function J(Be){const Je=bZ(Be);te===-1&&(te=pB().now()),W+=Je.length;const at=te;for(let re=0;re<Je.length&&re<x.length;++re){const Le=j(re,at,Je[re]);te=Math.max(te,Le)}}function ne(Be,Je){const at=bZ(Be),re=$l(Je||"+0.05").toSeconds();for(let Le=0;Le<at.length;++Le)j($++,re,at[Le],!1),$>=x.length&&($=yZ)}function ie(){z.clear(),te=-1,W=0}function ae(Be){ie(),pB().bpm.setValueAtTime(Be,0),z=new lM(G),z.start(0)}function xe(Be){e.volume.value=Bf(Be*.25)}function Ne(Be){y.volume.value=Bf(Be)}function Re(Be){new f2(Be).connect(v).start(0)}function Se(Be){v.volume.value=Be}Se(25),xe(80),Ne(100),z.start(0);function ze(){x.forEach(Be=>Be.destroy()),C.forEach(Be=>Be.destroy()),E.destroy(),e.dispose()}return{destroy:ze,broadcastdestination:n,addplay:J,addbgplay:ne,stopplay:ie,applyreplay:F,synthrecord:X,synthflush:N,synthreplay:q,addttsaudiobuffer:Re,setbpm:ae,setplayvolume:xe,setbgplayvolume:Ne,setttsvolume:Se,SOURCE:x,FX:C,FXCHAIN:E,changesource:M}}const VQe=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]+/,GQe=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]*/;function $Qe(t,e){if(Sn(t)){const n=hr(t);if(VQe.test(n))return Rr(e);switch(n){case"pwm":case"pulse":case"retro":case"buzz":case"clang":case"metallic":case"bells":case"doot":return!0;default:return GQe.test(n)}}return!1}function WQe(t,e,n,r,i){if(!ge(e))return;const s=e.SOURCE[n];if(!ge(s)){Pr(ut,t,"synth",`unknown voice ${n}`);return}switch(r){case"reset":case"restart":s.applyreset();return;case"vol":case"volume":an(i)&&(s.source.synth.volume.value=i);return;case"port":case"portamento":if(an(i))switch(s.source.type){case no.SYNTH:s.source.synth.portamento=i;break;case no.RETRO_NOISE:Pr(ut,t,"synth","portamento for retro synth not supported");break}return;case"env":case"envelope":if(Rr(i)){const[o,a,c,l]=i;s.source.synth.set({envelope:{attack:o,decay:a,sustain:c,release:l}})}return;default:if(Sn(r)){if($Qe(r,i)){switch(r){case"retro":e.changesource(n,no.RETRO_NOISE);break;case"buzz":e.changesource(n,no.BUZZ_NOISE);break;case"clang":e.changesource(n,no.CLANG_NOISE);break;case"metallic":e.changesource(n,no.METALLIC_NOISE);break;case"bells":e.changesource(n,no.BELLS);break;case"doot":e.changesource(n,no.DOOT);break;default:e.changesource(n,no.SYNTH),s.source.synth.set({oscillator:{type:r}}),Rr(i)&&s.source.synth.set({oscillator:{type:r,partials:i,partialCount:i.length}}),an(i)&&s.source.synth.set({oscillator:{type:r,partials:[i],partialCount:1}});break}return}switch(s.source.type){case no.SYNTH:{switch(s.source.synth.get().oscillator.type){case"pwm":switch(r){case"modfreq":case"modulationfrequency":an(i)&&s.source.synth.set({oscillator:{modulationFrequency:i}});return}break;case"pulse":switch(r){case"width":an(i)&&s.source.synth.set({oscillator:{width:i}});return}break;case"custom":case"sine":case"square":case"triangle":case"sawtooth":switch(r){case"phase":an(i)&&s.source.synth.set({oscillator:{phase:i}});return}break;case"amcustom":case"amsine":case"amsquare":case"amtriangle":case"amsawtooth":switch(r){case"harmonicity":an(i)&&s.source.synth.set({oscillator:{harmonicity:i}});return;case"modtype":case"modulationtype":Sn(i)&&s.source.synth.set({oscillator:{modulationType:i}});return;case"modenv":case"modulationenvelope":if(Rr(i)){const[a,c,l,u]=i;s.source.synth.set({oscillator:{modulationEnvelope:{attack:a,decay:c,sustain:l,release:u}}});return}break}break;case"fmcustom":case"fmsine":case"fmsquare":case"fmtriangle":case"fmsawtooth":switch(r){case"harmonicity":if(an(i)){s.source.synth.set({oscillator:{harmonicity:i}});return}break;case"modindex":if(an(i)){s.source.synth.set({oscillator:{modulationIndex:i}});return}break;case"modtype":if(Sn(i)){s.source.synth.set({oscillator:{modulationType:i}});return}break;case"modenv":if(Rr(i)){const[a,c,l,u]=i;s.source.synth.set({oscillator:{modulationEnvelope:{attack:a,decay:c,sustain:l,release:u}}});return}break}break;case"fatcustom":case"fatsine":case"fatsquare":case"fattriangle":case"fatsawtooth":switch(r){case"count":if(an(i)){s.source.synth.set({oscillator:{count:i}});return}break;case"phase":if(an(i)){s.source.synth.set({oscillator:{phase:i}});return}break;case"spread":if(an(i)){s.source.synth.set({oscillator:{spread:i}});return}break}break}return}}Pr(ut,t,"synth",`unknown config ${r}`)}break}}function KQe(t,e,n,r,i){if(!ge(e))return;if(n<0||n>=e.FX.length){Pr(ut,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.autowah;switch(r){case"basefrequency":if(an(i)){s.set({baseFrequency:i});return}break;case"octaves":if(an(i)){s.set({octaves:i});return}break;case"sensitivity":if(an(i)){s.set({sensitivity:i});return}break;case"gain":if(an(i)){s.set({gain:i});return}break;case"follower":if(an(i)){s.set({follower:i});return}break}Pr(ut,t,"synth",`unknown autowah config ${r} with ${i}`)}function XQe(t,e,n,r,i){if(!ge(e)||n<0||n>=e.FX.length){Pr(ut,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.distortion;switch(r){case"distortion":if(an(i)){s.set({distortion:i});return}break;case"oversample":if(Sn(i)){s.set({oversample:i});return}break}Pr(ut,t,"kind",`unknown distortion ${r} or ${i}`)}function YQe(t,e,n,r,i){if(!ge(e)||n<0||n>=e.FX.length){Pr(ut,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.echo;switch(r){case"delaytime":if(an(i)){s.set({delayTime:i});return}break;case"feedback":if(an(i)){s.set({feedback:i});return}break}Pr(ut,t,"kind",`unknown echo ${r} or ${i}`)}function ZQe(t,e,n,r,i){if(!ge(e)||n<0||n>=e.FX.length){Pr(ut,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.fcrush;switch(r){case"rate":if(an(i)){s.set({rate:i});return}break}Pr(ut,t,"kind",`unknown fcrush ${r} or ${i}`)}function JQe(t,e,n,r,i){if(!ge(e)||n<0||n>=e.FX.length){Pr(ut,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.phaser;switch(r){case"frequency":if(an(i)){s.set({frequency:i});return}break;case"octaves":if(an(i)){s.set({octaves:i});return}break;case"basefrequency":s.set({baseFrequency:i});return}Pr(ut,t,"kind",`unknown phaser ${r} or ${i}`)}function QQe(t,e,n,r,i){if(!ge(e)||n<0||n>=e.FX.length){Pr(ut,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.reverb;switch(r){case"decay":if(an(i)){s.set({decay:i});return}break;case"predelay":if(an(i)){s.set({preDelay:i});return}break}Pr(ut,t,"kind",`unknown reverb ${r} or ${i}`)}function eet(t,e,n,r,i){if(!ge(e))return;if(n<0||n>=e.FX.length){Pr(ut,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.vibrato;switch(r){case"maxdelay":if(an(i)){s.set({maxDelay:i});return}break}Pr(ut,t,"synth",`unknown vibrato config ${r} with ${i}`)}function tet(t,e,n,r,i,s){if(!ge(e))return;if(n<0||n>=e.FX.length){Pr(ut,t,"synth",`index ${n} out of bounds`);return}const o=e.FX[n][r];if(ge(o)){switch(i){case"on":switch(r){case"vibrato":o.volume.value=Bf(80);break;default:o.volume.value=Bf(20);break}break;case"off":o.volume.value=Bf(0);break;default:if(an(i))o.volume.value=Bf(i);else switch(r){case"fc":case"fcrush":ZQe(t,e,n,i,s);break;case"echo":YQe(t,e,n,i,s);break;case"phaser":JQe(t,e,n,i,s);break;case"reverb":QQe(t,e,n,i,s);break;case"distort":case"distortion":XQe(t,e,n,i,s);break;case"vibrato":eet(t,e,n,i,s);break;case"autowah":KQe(t,e,n,i,s);break}break}return}Pr(ut,t,"synth",`unknown fx ${r}`)}let sU=Promise,Gfe=t=>{let e=0,n=0,r,i,s,o,a=()=>{e--,--n?c():o=s?.()},c=()=>{if(r&&e<t){e++;let l=r;r=r.a,l.p().then(u=>(l.b(u),a()),u=>(l.c(u),a()))}};return{add(l){let u={p:l},h=new sU((d,m)=>{u.b=d,u.c=m});return r?i=i.a=u:i=r=u,n++,c(),h},done:()=>n?o||(o=new sU(l=>s=l)):sU.resolve(),clear(){r=i=null,n=e},active:()=>e,size:()=>n}};const XO={"ar-SA":["ar-SA-HamedNeural","ar-SA-ZariyahNeural"],"de-DE":["de-DE-AmalaNeural","de-DE-ConradNeural","de-DE-KatjaNeural","de-DE-KillianNeural"],"en-US":["en-US-AriaNeural","en-US-AnaNeural","en-US-ChristopherNeural","en-US-EricNeural","en-US-GuyNeural","en-US-JennyNeural","en-US-MichelleNeural","en-US-RogerNeural","en-US-SteffanNeural"],"es-ES":["es-ES-AlvaroNeural","es-ES-ElviraNeural"],"fr-FR":["fr-FR-DeniseNeural","fr-FR-EloiseNeural","fr-FR-HenriNeural"],"ja-JP":["ja-JP-KeitaNeural","ja-JP-NanamiNeural"],"ko-KR":["ko-KR-InJoonNeural","ko-KR-SunHiNeural"],"pt-BR":["pt-BR-AntonioNeural","pt-BR-FranciscaNeural"],"ru-RU":["ru-RU-DmitryNeural","ru-RU-SvetlanaNeural"],"zh-CN":["zh-CN-XiaoxiaoNeural","zh-CN-XiaoyiNeural","zh-CN-YunjianNeural","zh-CN-liaoning-XiaobeiNeural","zh-CN-shaanxi-XiaoniNeural","zh-CN-YunxiNeural","zh-CN-YunxiaNeural","zh-CN-YunyangNeural"],"zh-TW":["zh-TW-HsiaoChenNeural","zh-TW-YunJheNeural","zh-TW-HsiaoYuNeural"]},YO={"ar-SA-HamedNeural":"","ar-SA-ZariyahNeural":"","de-DE-AmalaNeural":"Amala","de-DE-BerndNeural":"Bernd","de-DE-ChristophNeural":"Christoph","de-DE-ConradNeural":"Conrad","de-DE-ElkeNeural":"Elke","de-DE-GiselaNeural":"Gisela","de-DE-KasperNeural":"Kasper","de-DE-KatjaNeural":"Katja","de-DE-KillianNeural":"Killian","de-DE-KlarissaNeural":"Klarissa","de-DE-KlausNeural":"Klaus","de-DE-LouisaNeural":"Louisa","de-DE-MajaNeural":"Maja","de-DE-RalfNeural":"Ralf","de-DE-TanjaNeural":"Tanja","en-US-AIGenerate1Neural":"AIGenerate1","en-US-AIGenerate2Neural":"AIGenerate2","en-US-AmberNeural":"Amber","en-US-AnaNeural":"Ana","en-US-AndrewNeural":"Andrew","en-US-AriaNeural":"Aria","en-US-AshleyNeural":"Ashley","en-US-BlueNeural":"Blue","en-US-BrandonNeural":"Brandon","en-US-BrianNeural":"Brian","en-US-ChristopherNeural":"Christopher","en-US-CoraNeural":"Cora","en-US-DavisNeural":"Davis","en-US-ElizabethNeural":"Elizabeth","en-US-EmmaNeural":"Emma","en-US-EricNeural":"Eric","en-US-GuyNeural":"Guy","en-US-JacobNeural":"Jacob","en-US-JaneNeural":"Jane","en-US-JasonNeural":"Jason","en-US-JennyMultilingualNeural":"Jenny Multilingual","en-US-JennyMultilingualV2Neural":"Jenny Multilingual V2","en-US-JennyNeural":"Jenny","en-US-MichelleNeural":"Michelle","en-US-MonicaNeural":"Monica","en-US-NancyNeural":"Nancy","en-US-RogerNeural":"Roger","en-US-RyanMultilingualNeural":"Ryan Multilingual","en-US-SaraNeural":"Sara","en-US-SteffanNeural":"Steffan","en-US-TonyNeural":"Tony","es-ES-AbrilNeural":"Abril","es-ES-AlvaroNeural":"lvaro","es-ES-ArnauNeural":"Arnau","es-ES-DarioNeural":"Dario","es-ES-EliasNeural":"Elias","es-ES-ElviraNeural":"Elvira","es-ES-EstrellaNeural":"Estrella","es-ES-IreneNeural":"Irene","es-ES-LaiaNeural":"Laia","es-ES-LiaNeural":"Lia","es-ES-NilNeural":"Nil","es-ES-SaulNeural":"Saul","es-ES-TeoNeural":"Teo","es-ES-TrianaNeural":"Triana","es-ES-VeraNeural":"Vera","fr-FR-AlainNeural":"Alain","fr-FR-BrigitteNeural":"Brigitte","fr-FR-CelesteNeural":"Celeste","fr-FR-ClaudeNeural":"Claude","fr-FR-CoralieNeural":"Coralie","fr-FR-DeniseNeural":"Denise","fr-FR-EloiseNeural":"Eloise","fr-FR-HenriNeural":"Henri","fr-FR-JacquelineNeural":"Jacqueline","fr-FR-JeromeNeural":"Jerome","fr-FR-JosephineNeural":"Josephine","fr-FR-MauriceNeural":"Maurice","fr-FR-YvesNeural":"Yves","fr-FR-YvetteNeural":"Yvette","ja-JP-AoiNeural":"","ja-JP-DaichiNeural":"","ja-JP-KeitaNeural":"","ja-JP-MayuNeural":"","ja-JP-NanamiNeural":"","ja-JP-NaokiNeural":"","ja-JP-ShioriNeural":"","ko-KR-BongJinNeural":"","ko-KR-GookMinNeural":"","ko-KR-InJoonNeural":"","ko-KR-JiMinNeural":"","ko-KR-SeoHyeonNeural":"","ko-KR-SoonBokNeural":"","ko-KR-SunHiNeural":"","ko-KR-YuJinNeural":"","pt-BR-AntonioNeural":"Antnio","pt-BR-BrendaNeural":"Brenda","pt-BR-DonatoNeural":"Donato","pt-BR-ElzaNeural":"Elza","pt-BR-FabioNeural":"Fabio","pt-BR-FranciscaNeural":"Francisca","pt-BR-GiovannaNeural":"Giovanna","pt-BR-HumbertoNeural":"Humberto","pt-BR-JulioNeural":"Julio","pt-BR-LeilaNeural":"Leila","pt-BR-LeticiaNeural":"Leticia","pt-BR-ManuelaNeural":"Manuela","pt-BR-NicolauNeural":"Nicolau","pt-BR-ValerioNeural":"Valerio","pt-BR-YaraNeural":"Yara","ru-RU-DariyaNeural":"","ru-RU-DmitryNeural":"","ru-RU-SvetlanaNeural":"","wuu-CN-XiaotongNeural":"","wuu-CN-YunzheNeural":"","yue-CN-XiaoMinNeural":"","yue-CN-YunSongNeural":"","zh-CN-XiaochenNeural":"","zh-CN-XiaohanNeural":"","zh-CN-XiaomengNeural":"","zh-CN-XiaomoNeural":"","zh-CN-XiaoqiuNeural":"","zh-CN-XiaorouNeural":"","zh-CN-XiaoruiNeural":"","zh-CN-XiaoshuangNeural":"","zh-CN-XiaoxiaoNeural":"","zh-CN-XiaoxuanNeural":"","zh-CN-XiaoyanNeural":"","zh-CN-XiaoyiNeural":"","zh-CN-XiaoyouNeural":"","zh-CN-XiaozhenNeural":"","zh-CN-YunfengNeural":"","zh-CN-YunhaoNeural":"","zh-CN-YunjianNeural":"","zh-CN-YunjieNeural":"","zh-CN-YunxiNeural":"","zh-CN-YunxiaNeural":"","zh-CN-YunyangNeural":"","zh-CN-YunyeNeural":"","zh-CN-YunzeNeural":"","zh-CN-guangxi-YunqiNeural":"","zh-CN-henan-YundengNeural":"","zh-CN-liaoning-XiaobeiNeural":"","zh-CN-liaoning-YunbiaoNeural":"","zh-CN-shaanxi-XiaoniNeural":"","zh-CN-shandong-YunxiangNeural":"","zh-CN-sichuan-YunxiNeural":"","zh-TW-HsiaoChenNeural":"","zh-TW-HsiaoYuNeural":"","zh-TW-YunJheNeural":""};function BN(t){"@babel/helpers - typeof";return BN=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},BN(t)}function _B(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_B=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(G,j,q){G[j]=q.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(G,j,q){return Object.defineProperty(G,j,{value:q,enumerable:!0,configurable:!0,writable:!0}),G[j]}try{l({},"")}catch{l=function(q,te,W){return q[te]=W}}function u(G,j,q,te){var W=j&&j.prototype instanceof v?j:v,$=Object.create(W.prototype),J=new N(te||[]);return i($,"_invoke",{value:H(G,q,J)}),$}function h(G,j,q){try{return{type:"normal",arg:G.call(j,q)}}catch(te){return{type:"throw",arg:te}}}e.wrap=u;var d="suspendedStart",m="suspendedYield",p="executing",g="completed",y={};function v(){}function x(){}function E(){}var C={};l(C,o,function(){return this});var A=Object.getPrototypeOf,k=A&&A(A(X([])));k&&k!==n&&r.call(k,o)&&(C=k);var M=E.prototype=v.prototype=Object.create(C);function I(G){["next","throw","return"].forEach(function(j){l(G,j,function(q){return this._invoke(j,q)})})}function z(G,j){function q(W,$,J,ne){var ie=h(G[W],G,$);if(ie.type!=="throw"){var ae=ie.arg,xe=ae.value;return xe&&BN(xe)=="object"&&r.call(xe,"__await")?j.resolve(xe.__await).then(function(Ne){q("next",Ne,J,ne)},function(Ne){q("throw",Ne,J,ne)}):j.resolve(xe).then(function(Ne){ae.value=Ne,J(ae)},function(Ne){return q("throw",Ne,J,ne)})}ne(ie.arg)}var te;i(this,"_invoke",{value:function($,J){function ne(){return new j(function(ie,ae){q($,J,ie,ae)})}return te=te?te.then(ne,ne):ne()}})}function H(G,j,q){var te=d;return function(W,$){if(te===p)throw new Error("Generator is already running");if(te===g){if(W==="throw")throw $;return{value:t,done:!0}}for(q.method=W,q.arg=$;;){var J=q.delegate;if(J){var ne=K(J,q);if(ne){if(ne===y)continue;return ne}}if(q.method==="next")q.sent=q._sent=q.arg;else if(q.method==="throw"){if(te===d)throw te=g,q.arg;q.dispatchException(q.arg)}else q.method==="return"&&q.abrupt("return",q.arg);te=p;var ie=h(G,j,q);if(ie.type==="normal"){if(te=q.done?g:m,ie.arg===y)continue;return{value:ie.arg,done:q.done}}ie.type==="throw"&&(te=g,q.method="throw",q.arg=ie.arg)}}}function K(G,j){var q=j.method,te=G.iterator[q];if(te===t)return j.delegate=null,q==="throw"&&G.iterator.return&&(j.method="return",j.arg=t,K(G,j),j.method==="throw")||q!=="return"&&(j.method="throw",j.arg=new TypeError("The iterator does not provide a '"+q+"' method")),y;var W=h(te,G.iterator,j.arg);if(W.type==="throw")return j.method="throw",j.arg=W.arg,j.delegate=null,y;var $=W.arg;return $?$.done?(j[G.resultName]=$.value,j.next=G.nextLoc,j.method!=="return"&&(j.method="next",j.arg=t),j.delegate=null,y):$:(j.method="throw",j.arg=new TypeError("iterator result is not an object"),j.delegate=null,y)}function P(G){var j={tryLoc:G[0]};1 in G&&(j.catchLoc=G[1]),2 in G&&(j.finallyLoc=G[2],j.afterLoc=G[3]),this.tryEntries.push(j)}function F(G){var j=G.completion||{};j.type="normal",delete j.arg,G.completion=j}function N(G){this.tryEntries=[{tryLoc:"root"}],G.forEach(P,this),this.reset(!0)}function X(G){if(G||G===""){var j=G[o];if(j)return j.call(G);if(typeof G.next=="function")return G;if(!isNaN(G.length)){var q=-1,te=function W(){for(;++q<G.length;)if(r.call(G,q))return W.value=G[q],W.done=!1,W;return W.value=t,W.done=!0,W};return te.next=te}}throw new TypeError(BN(G)+" is not iterable")}return x.prototype=E,i(M,"constructor",{value:E,configurable:!0}),i(E,"constructor",{value:x,configurable:!0}),x.displayName=l(E,c,"GeneratorFunction"),e.isGeneratorFunction=function(G){var j=typeof G=="function"&&G.constructor;return!!j&&(j===x||(j.displayName||j.name)==="GeneratorFunction")},e.mark=function(G){return Object.setPrototypeOf?Object.setPrototypeOf(G,E):(G.__proto__=E,l(G,c,"GeneratorFunction")),G.prototype=Object.create(M),G},e.awrap=function(G){return{__await:G}},I(z.prototype),l(z.prototype,a,function(){return this}),e.AsyncIterator=z,e.async=function(G,j,q,te,W){W===void 0&&(W=Promise);var $=new z(u(G,j,q,te),W);return e.isGeneratorFunction(j)?$:$.next().then(function(J){return J.done?J.value:$.next()})},I(M),l(M,c,"Generator"),l(M,o,function(){return this}),l(M,"toString",function(){return"[object Generator]"}),e.keys=function(G){var j=Object(G),q=[];for(var te in j)q.push(te);return q.reverse(),function W(){for(;q.length;){var $=q.pop();if($ in j)return W.value=$,W.done=!1,W}return W.done=!0,W}},e.values=X,N.prototype={constructor:N,reset:function(j){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!j)for(var q in this)q.charAt(0)==="t"&&r.call(this,q)&&!isNaN(+q.slice(1))&&(this[q]=t)},stop:function(){this.done=!0;var j=this.tryEntries[0].completion;if(j.type==="throw")throw j.arg;return this.rval},dispatchException:function(j){if(this.done)throw j;var q=this;function te(ae,xe){return J.type="throw",J.arg=j,q.next=ae,xe&&(q.method="next",q.arg=t),!!xe}for(var W=this.tryEntries.length-1;W>=0;--W){var $=this.tryEntries[W],J=$.completion;if($.tryLoc==="root")return te("end");if($.tryLoc<=this.prev){var ne=r.call($,"catchLoc"),ie=r.call($,"finallyLoc");if(ne&&ie){if(this.prev<$.catchLoc)return te($.catchLoc,!0);if(this.prev<$.finallyLoc)return te($.finallyLoc)}else if(ne){if(this.prev<$.catchLoc)return te($.catchLoc,!0)}else{if(!ie)throw new Error("try statement without catch or finally");if(this.prev<$.finallyLoc)return te($.finallyLoc)}}}},abrupt:function(j,q){for(var te=this.tryEntries.length-1;te>=0;--te){var W=this.tryEntries[te];if(W.tryLoc<=this.prev&&r.call(W,"finallyLoc")&&this.prev<W.finallyLoc){var $=W;break}}$&&(j==="break"||j==="continue")&&$.tryLoc<=q&&q<=$.finallyLoc&&($=null);var J=$?$.completion:{};return J.type=j,J.arg=q,$?(this.method="next",this.next=$.finallyLoc,y):this.complete(J)},complete:function(j,q){if(j.type==="throw")throw j.arg;return j.type==="break"||j.type==="continue"?this.next=j.arg:j.type==="return"?(this.rval=this.arg=j.arg,this.method="return",this.next="end"):j.type==="normal"&&q&&(this.next=q),y},finish:function(j){for(var q=this.tryEntries.length-1;q>=0;--q){var te=this.tryEntries[q];if(te.finallyLoc===j)return this.complete(te.completion,te.afterLoc),F(te),y}},catch:function(j){for(var q=this.tryEntries.length-1;q>=0;--q){var te=this.tryEntries[q];if(te.tryLoc===j){var W=te.completion;if(W.type==="throw"){var $=W.arg;F(te)}return $}}throw new Error("illegal catch attempt")},delegateYield:function(j,q,te){return this.delegate={iterator:X(j),resultName:q,nextLoc:te},this.method==="next"&&(this.arg=t),y}},e}function SZ(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(l){n(l);return}a.done?e(c):Promise.resolve(c).then(r,i)}function net(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(c){SZ(s,r,i,o,a,"next",c)}function a(c){SZ(s,r,i,o,a,"throw",c)}o(void 0)})}}var ret=(function(){var t=net(_B().mark(function e(n){var r;return _B().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r=new AudioContext,s.next=3,r.decodeAudioData(n);case 3:return s.abrupt("return",s.sent);case 4:case"end":return s.stop()}},e)}));return function(n){return t.apply(this,arguments)}})();const iet={"ar-SA":"","de-DE":"Deutsch","en-US":"English","es-ES":"Espaol","fr-FR":"Franais","ja-JP":"","ko-KR":"","pt-BR":"Portugus","ru-RU":"","zh-CN":"","zh-TW":""};function set(t,e){return uet(t)||cet(t,e)||aet(t,e)||oet()}function oet(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aet(t,e){if(t){if(typeof t=="string")return xZ(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xZ(t,e)}}function xZ(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function cet(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(n=n.call(t)).next,e!==0)for(;!(c=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function uet(t){if(Array.isArray(t))return t}var fet=function(){return Object.entries(iet).map(function(e){var n=set(e,2),r=n[0],i=n[1];return{label:i,value:r}})};const het="modulepreload",det=function(t){return"/"+t},TZ={},pet=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let l=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};var o=l;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");i=l(n.map(u=>{if(u=det(u),u in TZ)return;TZ[u]=!0;const h=u.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${d}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":het,h||(m.as="script"),m.crossOrigin="",m.href=u,c&&m.setAttribute("nonce",c),document.head.appendChild(m),h)return new Promise((p,g)=>{m.addEventListener("load",p),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return i.then(a=>{for(const c of a||[])c.status==="rejected"&&s(c.reason);return e().catch(s)})},$fe="%[a-f0-9]{2}",wZ=new RegExp("("+$fe+")|([^%]+?)","gi"),RZ=new RegExp("("+$fe+")+","gi");function vB(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;const n=t.slice(0,e),r=t.slice(e);return Array.prototype.concat.call([],vB(n),vB(r))}function met(t){try{return decodeURIComponent(t)}catch{let e=t.match(wZ)||[];for(let n=1;n<e.length;n++)t=vB(e,n).join(""),e=t.match(wZ)||[];return t}}function get(t){const e={"%FE%FF":"","%FF%FE":""};let n=RZ.exec(t);for(;n;){try{e[n[0]]=decodeURIComponent(n[0])}catch{const i=met(n[0]);i!==n[0]&&(e[n[0]]=i)}n=RZ.exec(t)}e["%C2"]="";const r=Object.keys(e);for(const i of r)t=t.replace(new RegExp(i,"g"),e[i]);return t}function _et(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return decodeURIComponent(t)}catch{return get(t)}}function vet(t,e){const n={};if(Array.isArray(e))for(const r of e){const i=Object.getOwnPropertyDescriptor(t,r);i?.enumerable&&Object.defineProperty(n,r,i)}else for(const r of Reflect.ownKeys(t)){const i=Object.getOwnPropertyDescriptor(t,r);if(i.enumerable){const s=t[r];e(r,s,t)&&Object.defineProperty(n,r,i)}}return n}function Wfe(t,e){if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(t===""||e==="")return[];const n=t.indexOf(e);return n===-1?[]:[t.slice(0,n),t.slice(n+e.length)]}const yet=t=>t==null,bet=t=>encodeURIComponent(t).replaceAll(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),yB=Symbol("encodeFragmentIdentifier");function Eet(t){switch(t.arrayFormat){case"index":return e=>(n,r)=>{const i=n.length;return r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[Gc(e,t),"[",i,"]"].join("")]:[...n,[Gc(e,t),"[",Gc(i,t),"]=",Gc(r,t)].join("")]};case"bracket":return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[Gc(e,t),"[]"].join("")]:[...n,[Gc(e,t),"[]=",Gc(r,t)].join("")];case"colon-list-separator":return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[Gc(e,t),":list="].join("")]:[...n,[Gc(e,t),":list=",Gc(r,t)].join("")];case"comma":case"separator":case"bracket-separator":{const e=t.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(r,i)=>i===void 0||t.skipNull&&i===null||t.skipEmptyString&&i===""?r:(i=i===null?"":i,r.length===0?[[Gc(n,t),e,Gc(i,t)].join("")]:[[r,Gc(i,t)].join(t.arrayFormatSeparator)])}default:return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,Gc(e,t)]:[...n,[Gc(e,t),"=",Gc(r,t)].join("")]}}function xet(t){let e;switch(t.arrayFormat){case"index":return(n,r,i)=>{if(e=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!e){i[n]=r;return}i[n]===void 0&&(i[n]={}),i[n][e[1]]=r};case"bracket":return(n,r,i)=>{if(e=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!e){i[n]=r;return}if(i[n]===void 0){i[n]=[r];return}i[n]=[...i[n],r]};case"colon-list-separator":return(n,r,i)=>{if(e=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!e){i[n]=r;return}if(i[n]===void 0){i[n]=[r];return}i[n]=[...i[n],r]};case"comma":case"separator":return(n,r,i)=>{const s=typeof r=="string"&&r.includes(t.arrayFormatSeparator),o=typeof r=="string"&&!s&&iv(r,t).includes(t.arrayFormatSeparator);r=o?iv(r,t):r;const a=s||o?r.split(t.arrayFormatSeparator).map(c=>iv(c,t)):r===null?r:iv(r,t);i[n]=a};case"bracket-separator":return(n,r,i)=>{const s=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!s){i[n]=r&&iv(r,t);return}const o=r===null?[]:iv(r,t).split(t.arrayFormatSeparator);if(i[n]===void 0){i[n]=o;return}i[n]=[...i[n],...o]};default:return(n,r,i)=>{if(i[n]===void 0){i[n]=r;return}i[n]=[...[i[n]].flat(),r]}}}function Kfe(t){if(typeof t!="string"||t.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function Gc(t,e){return e.encode?e.strict?bet(t):encodeURIComponent(t):t}function iv(t,e){return e.decode?_et(t):t}function Xfe(t){return Array.isArray(t)?t.sort():typeof t=="object"?Xfe(Object.keys(t)).sort((e,n)=>Number(e)-Number(n)).map(e=>t[e]):t}function Yfe(t){const e=t.indexOf("#");return e!==-1&&(t=t.slice(0,e)),t}function Tet(t){let e="";const n=t.indexOf("#");return n!==-1&&(e=t.slice(n)),e}function CZ(t,e,n){return n==="string"&&typeof t=="string"?t:typeof n=="function"&&typeof t=="string"?n(t):n==="boolean"&&t===null?!0:n==="boolean"&&t!==null&&(t.toLowerCase()==="true"||t.toLowerCase()==="false")?t.toLowerCase()==="true":n==="boolean"&&t!==null&&(t.toLowerCase()==="1"||t.toLowerCase()==="0")?t.toLowerCase()==="1":n==="string[]"&&e.arrayFormat!=="none"&&typeof t=="string"?[t]:n==="number[]"&&e.arrayFormat!=="none"&&!Number.isNaN(Number(t))&&typeof t=="string"&&t.trim()!==""?[Number(t)]:n==="number"&&!Number.isNaN(Number(t))&&typeof t=="string"&&t.trim()!==""?Number(t):e.parseBooleans&&t!==null&&(t.toLowerCase()==="true"||t.toLowerCase()==="false")?t.toLowerCase()==="true":e.parseNumbers&&!Number.isNaN(Number(t))&&typeof t=="string"&&t.trim()!==""?Number(t):t}function N9(t){t=Yfe(t);const e=t.indexOf("?");return e===-1?"":t.slice(e+1)}function P9(t,e){e={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null),...e},Kfe(e.arrayFormatSeparator);const n=xet(e),r=Object.create(null);if(typeof t!="string"||(t=t.trim().replace(/^[?#&]/,""),!t))return r;for(const i of t.split("&")){if(i==="")continue;const s=e.decode?i.replaceAll("+"," "):i;let[o,a]=Wfe(s,"=");o===void 0&&(o=s),a=a===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?a:iv(a,e),n(iv(o,e),a,r)}for(const[i,s]of Object.entries(r))if(typeof s=="object"&&s!==null&&e.types[i]!=="string")for(const[o,a]of Object.entries(s)){const c=e.types[i]?e.types[i].replace("[]",""):void 0;s[o]=CZ(a,e,c)}else typeof s=="object"&&s!==null&&e.types[i]==="string"?r[i]=Object.values(s).join(e.arrayFormatSeparator):r[i]=CZ(s,e,e.types[i]);return e.sort===!1?r:(e.sort===!0?Object.keys(r).sort():Object.keys(r).sort(e.sort)).reduce((i,s)=>{const o=r[s];return i[s]=o&&typeof o=="object"&&!Array.isArray(o)?Xfe(o):o,i},Object.create(null))}function Zfe(t,e){if(!t)return"";e={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...e},Kfe(e.arrayFormatSeparator);const n=o=>e.skipNull&&yet(t[o])||e.skipEmptyString&&t[o]==="",r=Eet(e),i={};for(const[o,a]of Object.entries(t))n(o)||(i[o]=a);const s=Object.keys(i);return e.sort!==!1&&s.sort(e.sort),s.map(o=>{const a=t[o];return a===void 0?"":a===null?Gc(o,e):Array.isArray(a)?a.length===0&&e.arrayFormat==="bracket-separator"?Gc(o,e)+"[]":a.reduce(r(o),[]).join("&"):Gc(o,e)+"="+Gc(a,e)}).filter(o=>o.length>0).join("&")}function Jfe(t,e){e={decode:!0,...e};let[n,r]=Wfe(t,"#");return n===void 0&&(n=t),{url:n?.split("?")?.[0]??"",query:P9(N9(t),e),...e&&e.parseFragmentIdentifier&&r?{fragmentIdentifier:iv(r,e)}:{}}}function Qfe(t,e){e={encode:!0,strict:!0,[yB]:!0,...e};const n=Yfe(t.url).split("?")[0]||"",r=N9(t.url),i={...P9(r,{sort:!1,...e}),...t.query};let s=Zfe(i,e);s&&=`?${s}`;let o=Tet(t.url);if(typeof t.fragmentIdentifier=="string"){const a=new URL(n);a.hash=t.fragmentIdentifier,o=e[yB]?a.hash:`#${t.fragmentIdentifier}`}return`${n}${s}${o}`}function ehe(t,e,n){n={parseFragmentIdentifier:!0,[yB]:!1,...n};const{url:r,query:i,fragmentIdentifier:s}=Jfe(t,n);return Qfe({url:r,query:vet(i,e),fragmentIdentifier:s},n)}function wet(t,e,n){const r=Array.isArray(e)?i=>!e.includes(i):(i,s)=>!e(i,s);return ehe(t,r,n)}const Ret=Object.freeze(Object.defineProperty({__proto__:null,exclude:wet,extract:N9,parse:P9,parseUrl:Jfe,pick:ehe,stringify:Zfe,stringifyUrl:Qfe},Symbol.toStringTag,{value:"Module"})),Tu=[];for(let t=0;t<256;++t)Tu.push((t+256).toString(16).slice(1));function Cet(t,e=0){return(Tu[t[e+0]]+Tu[t[e+1]]+Tu[t[e+2]]+Tu[t[e+3]]+"-"+Tu[t[e+4]]+Tu[t[e+5]]+"-"+Tu[t[e+6]]+Tu[t[e+7]]+"-"+Tu[t[e+8]]+Tu[t[e+9]]+"-"+Tu[t[e+10]]+Tu[t[e+11]]+Tu[t[e+12]]+Tu[t[e+13]]+Tu[t[e+14]]+Tu[t[e+15]]).toLowerCase()}let oU;const Aet=new Uint8Array(16);function Met(){if(!oU){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");oU=crypto.getRandomValues.bind(crypto)}return oU(Aet)}const ket=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),AZ={randomUUID:ket};function Oet(t,e,n){if(AZ.randomUUID&&!t)return AZ.randomUUID();t=t||{};const r=t.random??t.rng?.()??Met();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Cet(r)}var Iet=function(e,n){var r=n.voice;return'<voice name="'.concat(r,'">').concat(e,"</voice>")},Net=function(e,n){var r=n.style;return r?'<mstts:express-as style="'.concat(r,'">').concat(e,"</mstts:express-as>"):e},Pet=function(e,n){var r=n.pitch,i=n.rate;return!r&&!i?e:'<prosody pitch="'.concat(Math.floor((r||1)*100),'%" rate="').concat(Math.floor((i||1)*100),'%">').concat(e,"</prosody>")},Det=function(e){return'<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="https://www.w3.org/2001/mstts" xml:lang="en-US">'.concat(e,"</speak>")},Let=function(e,n){var r=Pet(e,n);return r=Net(r,n),r=Iet(r,n),r=Det(r),r};function Uet(t,e){return zet(t)||jet(t,e)||Fet(t,e)||Bet()}function Bet(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fet(t,e){if(t){if(typeof t=="string")return MZ(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return MZ(t,e)}}function MZ(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function jet(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(n=n.call(t)).next,e!==0)for(;!(c=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function zet(t){if(Array.isArray(t))return t}var kZ=function(e,n){for(var r=[],i=0,s=Object.entries(e);i<s.length;i++){var o=Uet(s[i],2),a=o[0],c=o[1];r.push("".concat(a,":").concat(c))}return r.push("",n),r.join(`\r
`)};function Het(t,e){return Get(t)||Vet(t,e)||the(t,e)||qet()}function qet(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vet(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(n=n.call(t)).next,e!==0)for(;!(c=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function Get(t){if(Array.isArray(t))return t}function $et(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=the(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function the(t,e){if(t){if(typeof t=="string")return OZ(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return OZ(t,e)}}function OZ(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Wet=function(e){var n={},r=$et(e.slice(0,e.indexOf(`\r
\r
`)).split(`\r
`)),i;try{for(r.s();!(i=r.n()).done;){var s=i.value,o=s.split(":",2),a=Het(o,2),c=a[0],l=a[1];n[c]=l}}catch(u){r.e(u)}finally{r.f()}return{data:e.slice(e.indexOf(`\r
\r
`)+4),headers:n}};function FN(t){"@babel/helpers - typeof";return FN=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},FN(t)}function E1(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */E1=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(G,j,q){G[j]=q.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(G,j,q){return Object.defineProperty(G,j,{value:q,enumerable:!0,configurable:!0,writable:!0}),G[j]}try{l({},"")}catch{l=function(q,te,W){return q[te]=W}}function u(G,j,q,te){var W=j&&j.prototype instanceof v?j:v,$=Object.create(W.prototype),J=new N(te||[]);return i($,"_invoke",{value:H(G,q,J)}),$}function h(G,j,q){try{return{type:"normal",arg:G.call(j,q)}}catch(te){return{type:"throw",arg:te}}}e.wrap=u;var d="suspendedStart",m="suspendedYield",p="executing",g="completed",y={};function v(){}function x(){}function E(){}var C={};l(C,o,function(){return this});var A=Object.getPrototypeOf,k=A&&A(A(X([])));k&&k!==n&&r.call(k,o)&&(C=k);var M=E.prototype=v.prototype=Object.create(C);function I(G){["next","throw","return"].forEach(function(j){l(G,j,function(q){return this._invoke(j,q)})})}function z(G,j){function q(W,$,J,ne){var ie=h(G[W],G,$);if(ie.type!=="throw"){var ae=ie.arg,xe=ae.value;return xe&&FN(xe)=="object"&&r.call(xe,"__await")?j.resolve(xe.__await).then(function(Ne){q("next",Ne,J,ne)},function(Ne){q("throw",Ne,J,ne)}):j.resolve(xe).then(function(Ne){ae.value=Ne,J(ae)},function(Ne){return q("throw",Ne,J,ne)})}ne(ie.arg)}var te;i(this,"_invoke",{value:function($,J){function ne(){return new j(function(ie,ae){q($,J,ie,ae)})}return te=te?te.then(ne,ne):ne()}})}function H(G,j,q){var te=d;return function(W,$){if(te===p)throw new Error("Generator is already running");if(te===g){if(W==="throw")throw $;return{value:t,done:!0}}for(q.method=W,q.arg=$;;){var J=q.delegate;if(J){var ne=K(J,q);if(ne){if(ne===y)continue;return ne}}if(q.method==="next")q.sent=q._sent=q.arg;else if(q.method==="throw"){if(te===d)throw te=g,q.arg;q.dispatchException(q.arg)}else q.method==="return"&&q.abrupt("return",q.arg);te=p;var ie=h(G,j,q);if(ie.type==="normal"){if(te=q.done?g:m,ie.arg===y)continue;return{value:ie.arg,done:q.done}}ie.type==="throw"&&(te=g,q.method="throw",q.arg=ie.arg)}}}function K(G,j){var q=j.method,te=G.iterator[q];if(te===t)return j.delegate=null,q==="throw"&&G.iterator.return&&(j.method="return",j.arg=t,K(G,j),j.method==="throw")||q!=="return"&&(j.method="throw",j.arg=new TypeError("The iterator does not provide a '"+q+"' method")),y;var W=h(te,G.iterator,j.arg);if(W.type==="throw")return j.method="throw",j.arg=W.arg,j.delegate=null,y;var $=W.arg;return $?$.done?(j[G.resultName]=$.value,j.next=G.nextLoc,j.method!=="return"&&(j.method="next",j.arg=t),j.delegate=null,y):$:(j.method="throw",j.arg=new TypeError("iterator result is not an object"),j.delegate=null,y)}function P(G){var j={tryLoc:G[0]};1 in G&&(j.catchLoc=G[1]),2 in G&&(j.finallyLoc=G[2],j.afterLoc=G[3]),this.tryEntries.push(j)}function F(G){var j=G.completion||{};j.type="normal",delete j.arg,G.completion=j}function N(G){this.tryEntries=[{tryLoc:"root"}],G.forEach(P,this),this.reset(!0)}function X(G){if(G||G===""){var j=G[o];if(j)return j.call(G);if(typeof G.next=="function")return G;if(!isNaN(G.length)){var q=-1,te=function W(){for(;++q<G.length;)if(r.call(G,q))return W.value=G[q],W.done=!1,W;return W.value=t,W.done=!0,W};return te.next=te}}throw new TypeError(FN(G)+" is not iterable")}return x.prototype=E,i(M,"constructor",{value:E,configurable:!0}),i(E,"constructor",{value:x,configurable:!0}),x.displayName=l(E,c,"GeneratorFunction"),e.isGeneratorFunction=function(G){var j=typeof G=="function"&&G.constructor;return!!j&&(j===x||(j.displayName||j.name)==="GeneratorFunction")},e.mark=function(G){return Object.setPrototypeOf?Object.setPrototypeOf(G,E):(G.__proto__=E,l(G,c,"GeneratorFunction")),G.prototype=Object.create(M),G},e.awrap=function(G){return{__await:G}},I(z.prototype),l(z.prototype,a,function(){return this}),e.AsyncIterator=z,e.async=function(G,j,q,te,W){W===void 0&&(W=Promise);var $=new z(u(G,j,q,te),W);return e.isGeneratorFunction(j)?$:$.next().then(function(J){return J.done?J.value:$.next()})},I(M),l(M,c,"Generator"),l(M,o,function(){return this}),l(M,"toString",function(){return"[object Generator]"}),e.keys=function(G){var j=Object(G),q=[];for(var te in j)q.push(te);return q.reverse(),function W(){for(;q.length;){var $=q.pop();if($ in j)return W.value=$,W.done=!1,W}return W.done=!0,W}},e.values=X,N.prototype={constructor:N,reset:function(j){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!j)for(var q in this)q.charAt(0)==="t"&&r.call(this,q)&&!isNaN(+q.slice(1))&&(this[q]=t)},stop:function(){this.done=!0;var j=this.tryEntries[0].completion;if(j.type==="throw")throw j.arg;return this.rval},dispatchException:function(j){if(this.done)throw j;var q=this;function te(ae,xe){return J.type="throw",J.arg=j,q.next=ae,xe&&(q.method="next",q.arg=t),!!xe}for(var W=this.tryEntries.length-1;W>=0;--W){var $=this.tryEntries[W],J=$.completion;if($.tryLoc==="root")return te("end");if($.tryLoc<=this.prev){var ne=r.call($,"catchLoc"),ie=r.call($,"finallyLoc");if(ne&&ie){if(this.prev<$.catchLoc)return te($.catchLoc,!0);if(this.prev<$.finallyLoc)return te($.finallyLoc)}else if(ne){if(this.prev<$.catchLoc)return te($.catchLoc,!0)}else{if(!ie)throw new Error("try statement without catch or finally");if(this.prev<$.finallyLoc)return te($.finallyLoc)}}}},abrupt:function(j,q){for(var te=this.tryEntries.length-1;te>=0;--te){var W=this.tryEntries[te];if(W.tryLoc<=this.prev&&r.call(W,"finallyLoc")&&this.prev<W.finallyLoc){var $=W;break}}$&&(j==="break"||j==="continue")&&$.tryLoc<=q&&q<=$.finallyLoc&&($=null);var J=$?$.completion:{};return J.type=j,J.arg=q,$?(this.method="next",this.next=$.finallyLoc,y):this.complete(J)},complete:function(j,q){if(j.type==="throw")throw j.arg;return j.type==="break"||j.type==="continue"?this.next=j.arg:j.type==="return"?(this.rval=this.arg=j.arg,this.method="return",this.next="end"):j.type==="normal"&&q&&(this.next=q),y},finish:function(j){for(var q=this.tryEntries.length-1;q>=0;--q){var te=this.tryEntries[q];if(te.finallyLoc===j)return this.complete(te.completion,te.afterLoc),F(te),y}},catch:function(j){for(var q=this.tryEntries.length-1;q>=0;--q){var te=this.tryEntries[q];if(te.tryLoc===j){var W=te.completion;if(W.type==="throw"){var $=W.arg;F(te)}return $}}throw new Error("illegal catch attempt")},delegateYield:function(j,q,te){return this.delegate={iterator:X(j),resultName:q,nextLoc:te},this.method==="next"&&(this.arg=t),y}},e}function IZ(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(l){n(l);return}a.done?e(c):Promise.resolve(c).then(r,i)}function bB(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(c){IZ(s,r,i,o,a,"next",c)}function a(c){IZ(s,r,i,o,a,"throw",c)}o(void 0)})}}var Ket="wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1",nhe="6A5AA1D4EAFF4E9FB37E23D68491D6F4",Xet="1-132.0.2957.140",Yet=BigInt("11644473600"),Zet=JSON.stringify({context:{synthesis:{audio:{metadataoptions:{sentenceBoundaryEnabled:!1,wordBoundaryEnabled:!0},outputFormat:"audio-24khz-48kbitrate-mono-mp3"}}}}),Jet=function(e){var n=new Date().toString(),r={"Content-Type":"application/json; charset=utf-8",Path:"speech.config","X-Timestamp":n},i={"Content-Type":"application/ssml+xml",Path:"ssml","X-RequestId":e,"X-Timestamp":n};return{configHeader:r,contentHeader:i}};function Qet(){return EB.apply(this,arguments)}function EB(){return EB=bB(E1().mark(function t(){var e,n,r,i,s;return E1().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e=BigInt(Math.floor(Date.now()/1e3+Number(Yet)))*BigInt("10000000"),n=e-e%BigInt("3000000000"),r=n+nhe,a.next=5,pet(()=>import("./getSHA256-q1aNYYJS.js"),[]);case 5:return i=a.sent,s=i.hash(r),a.abrupt("return",s.toUpperCase());case 8:case"end":return a.stop()}},t)})),EB.apply(this,arguments)}var rhe=(function(){var t=bB(E1().mark(function e(n){var r,i,s,o,a,c,l,u,h,d,m,p,g,y=arguments;return E1().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(r=n.payload,i=y.length>1&&y[1]!==void 0?y[1]:{},s=i.proxyUrl,o=i.token,a=r.input,c=r.options,l=Oet().replaceAll("-",""),x.t0=Ret,x.t1=l,!o){x.next=10;break}x.t2=o,x.next=13;break;case 10:return x.next=12,Qet();case 12:x.t2=x.sent;case 13:return x.t3=x.t2,x.t4=o||Xet,x.t5=o||nhe,x.t6={ConnectionId:x.t1,"Sec-MS-GEC":x.t3,"Sec-MS-GEC-Version":x.t4,TrustedClientToken:x.t5},x.t7=s||Ket,x.t8={query:x.t6,url:x.t7},u=x.t0.stringifyUrl.call(x.t0,x.t8),h=Jet(l),d=h.configHeader,m=h.contentHeader,p=kZ(d,Zet),g=kZ(m,Let(a,c)),x.abrupt("return",new Promise(function(E,C){var A=new WebSocket(u);A.binaryType="arraybuffer";var k=function(){A.send(p),A.send(g)},M=new ArrayBuffer(0),I=(function(){var H=bB(E1().mark(function K(P){var F,N,X,G,j,q,te,W;return E1().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:if(typeof P.data!="string"){J.next=13;break}F=Wet(P.data),N=F.headers,J.t0=N.Path,J.next=J.t0==="turn.end"?5:11;break;case 5:if(A.close(),M.byteLength){J.next=8;break}return J.abrupt("return");case 8:return X=new Response(M),E(X),J.abrupt("break",11);case 11:J.next=14;break;case 13:P.data instanceof ArrayBuffer&&(G=new DataView(P.data),j=G.getInt16(0),P.data.byteLength>j+2&&(q=P.data.slice(2+j),te=new ArrayBuffer(M.byteLength+q.byteLength),W=new Uint8Array(te),W.set(new Uint8Array(M),0),W.set(new Uint8Array(q),M.byteLength),M=te));case 14:case"end":return J.stop()}},K)}));return function(P){return H.apply(this,arguments)}})(),z=function(){C(new Error("WebSocket error occurred.")),A.close()};A.addEventListener("open",k),A.addEventListener("message",I),A.addEventListener("error",z)}));case 24:case"end":return x.stop()}},e)}));return function(n){return t.apply(this,arguments)}})(),ett=function(e){var n=e&&XO[e]?XO[e]||[]:Vh(Object.values(XO));return n.map(function(r){return{label:YO?.[r]||r,value:r}})};function nE(t){"@babel/helpers - typeof";return nE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nE(t)}function a1(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */a1=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(G,j,q){G[j]=q.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(G,j,q){return Object.defineProperty(G,j,{value:q,enumerable:!0,configurable:!0,writable:!0}),G[j]}try{l({},"")}catch{l=function(q,te,W){return q[te]=W}}function u(G,j,q,te){var W=j&&j.prototype instanceof v?j:v,$=Object.create(W.prototype),J=new N(te||[]);return i($,"_invoke",{value:H(G,q,J)}),$}function h(G,j,q){try{return{type:"normal",arg:G.call(j,q)}}catch(te){return{type:"throw",arg:te}}}e.wrap=u;var d="suspendedStart",m="suspendedYield",p="executing",g="completed",y={};function v(){}function x(){}function E(){}var C={};l(C,o,function(){return this});var A=Object.getPrototypeOf,k=A&&A(A(X([])));k&&k!==n&&r.call(k,o)&&(C=k);var M=E.prototype=v.prototype=Object.create(C);function I(G){["next","throw","return"].forEach(function(j){l(G,j,function(q){return this._invoke(j,q)})})}function z(G,j){function q(W,$,J,ne){var ie=h(G[W],G,$);if(ie.type!=="throw"){var ae=ie.arg,xe=ae.value;return xe&&nE(xe)=="object"&&r.call(xe,"__await")?j.resolve(xe.__await).then(function(Ne){q("next",Ne,J,ne)},function(Ne){q("throw",Ne,J,ne)}):j.resolve(xe).then(function(Ne){ae.value=Ne,J(ae)},function(Ne){return q("throw",Ne,J,ne)})}ne(ie.arg)}var te;i(this,"_invoke",{value:function($,J){function ne(){return new j(function(ie,ae){q($,J,ie,ae)})}return te=te?te.then(ne,ne):ne()}})}function H(G,j,q){var te=d;return function(W,$){if(te===p)throw new Error("Generator is already running");if(te===g){if(W==="throw")throw $;return{value:t,done:!0}}for(q.method=W,q.arg=$;;){var J=q.delegate;if(J){var ne=K(J,q);if(ne){if(ne===y)continue;return ne}}if(q.method==="next")q.sent=q._sent=q.arg;else if(q.method==="throw"){if(te===d)throw te=g,q.arg;q.dispatchException(q.arg)}else q.method==="return"&&q.abrupt("return",q.arg);te=p;var ie=h(G,j,q);if(ie.type==="normal"){if(te=q.done?g:m,ie.arg===y)continue;return{value:ie.arg,done:q.done}}ie.type==="throw"&&(te=g,q.method="throw",q.arg=ie.arg)}}}function K(G,j){var q=j.method,te=G.iterator[q];if(te===t)return j.delegate=null,q==="throw"&&G.iterator.return&&(j.method="return",j.arg=t,K(G,j),j.method==="throw")||q!=="return"&&(j.method="throw",j.arg=new TypeError("The iterator does not provide a '"+q+"' method")),y;var W=h(te,G.iterator,j.arg);if(W.type==="throw")return j.method="throw",j.arg=W.arg,j.delegate=null,y;var $=W.arg;return $?$.done?(j[G.resultName]=$.value,j.next=G.nextLoc,j.method!=="return"&&(j.method="next",j.arg=t),j.delegate=null,y):$:(j.method="throw",j.arg=new TypeError("iterator result is not an object"),j.delegate=null,y)}function P(G){var j={tryLoc:G[0]};1 in G&&(j.catchLoc=G[1]),2 in G&&(j.finallyLoc=G[2],j.afterLoc=G[3]),this.tryEntries.push(j)}function F(G){var j=G.completion||{};j.type="normal",delete j.arg,G.completion=j}function N(G){this.tryEntries=[{tryLoc:"root"}],G.forEach(P,this),this.reset(!0)}function X(G){if(G||G===""){var j=G[o];if(j)return j.call(G);if(typeof G.next=="function")return G;if(!isNaN(G.length)){var q=-1,te=function W(){for(;++q<G.length;)if(r.call(G,q))return W.value=G[q],W.done=!1,W;return W.value=t,W.done=!0,W};return te.next=te}}throw new TypeError(nE(G)+" is not iterable")}return x.prototype=E,i(M,"constructor",{value:E,configurable:!0}),i(E,"constructor",{value:x,configurable:!0}),x.displayName=l(E,c,"GeneratorFunction"),e.isGeneratorFunction=function(G){var j=typeof G=="function"&&G.constructor;return!!j&&(j===x||(j.displayName||j.name)==="GeneratorFunction")},e.mark=function(G){return Object.setPrototypeOf?Object.setPrototypeOf(G,E):(G.__proto__=E,l(G,c,"GeneratorFunction")),G.prototype=Object.create(M),G},e.awrap=function(G){return{__await:G}},I(z.prototype),l(z.prototype,a,function(){return this}),e.AsyncIterator=z,e.async=function(G,j,q,te,W){W===void 0&&(W=Promise);var $=new z(u(G,j,q,te),W);return e.isGeneratorFunction(j)?$:$.next().then(function(J){return J.done?J.value:$.next()})},I(M),l(M,c,"Generator"),l(M,o,function(){return this}),l(M,"toString",function(){return"[object Generator]"}),e.keys=function(G){var j=Object(G),q=[];for(var te in j)q.push(te);return q.reverse(),function W(){for(;q.length;){var $=q.pop();if($ in j)return W.value=$,W.done=!1,W}return W.done=!0,W}},e.values=X,N.prototype={constructor:N,reset:function(j){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!j)for(var q in this)q.charAt(0)==="t"&&r.call(this,q)&&!isNaN(+q.slice(1))&&(this[q]=t)},stop:function(){this.done=!0;var j=this.tryEntries[0].completion;if(j.type==="throw")throw j.arg;return this.rval},dispatchException:function(j){if(this.done)throw j;var q=this;function te(ae,xe){return J.type="throw",J.arg=j,q.next=ae,xe&&(q.method="next",q.arg=t),!!xe}for(var W=this.tryEntries.length-1;W>=0;--W){var $=this.tryEntries[W],J=$.completion;if($.tryLoc==="root")return te("end");if($.tryLoc<=this.prev){var ne=r.call($,"catchLoc"),ie=r.call($,"finallyLoc");if(ne&&ie){if(this.prev<$.catchLoc)return te($.catchLoc,!0);if(this.prev<$.finallyLoc)return te($.finallyLoc)}else if(ne){if(this.prev<$.catchLoc)return te($.catchLoc,!0)}else{if(!ie)throw new Error("try statement without catch or finally");if(this.prev<$.finallyLoc)return te($.finallyLoc)}}}},abrupt:function(j,q){for(var te=this.tryEntries.length-1;te>=0;--te){var W=this.tryEntries[te];if(W.tryLoc<=this.prev&&r.call(W,"finallyLoc")&&this.prev<W.finallyLoc){var $=W;break}}$&&(j==="break"||j==="continue")&&$.tryLoc<=q&&q<=$.finallyLoc&&($=null);var J=$?$.completion:{};return J.type=j,J.arg=q,$?(this.method="next",this.next=$.finallyLoc,y):this.complete(J)},complete:function(j,q){if(j.type==="throw")throw j.arg;return j.type==="break"||j.type==="continue"?this.next=j.arg:j.type==="return"?(this.rval=this.arg=j.arg,this.method="return",this.next="end"):j.type==="normal"&&q&&(this.next=q),y},finish:function(j){for(var q=this.tryEntries.length-1;q>=0;--q){var te=this.tryEntries[q];if(te.finallyLoc===j)return this.complete(te.completion,te.afterLoc),F(te),y}},catch:function(j){for(var q=this.tryEntries.length-1;q>=0;--q){var te=this.tryEntries[q];if(te.tryLoc===j){var W=te.completion;if(W.type==="throw"){var $=W.arg;F(te)}return $}}throw new Error("illegal catch attempt")},delegateYield:function(j,q,te){return this.delegate={iterator:X(j),resultName:q,nextLoc:te},this.method==="next"&&(this.arg=t),y}},e}function NZ(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(l){n(l);return}a.done?e(c):Promise.resolve(c).then(r,i)}function aU(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(c){NZ(s,r,i,o,a,"next",c)}function a(c){NZ(s,r,i,o,a,"throw",c)}o(void 0)})}}function ttt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ntt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ihe(r.key),r)}}function rtt(t,e,n){return e&&ntt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function v0(t,e,n){return e=ihe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ihe(t){var e=itt(t,"string");return nE(e)=="symbol"?e:String(e)}function itt(t,e){if(nE(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(nE(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var g2=(function(){function t(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.serviceUrl,i=n.locale,s=n.headers;ttt(this,t),v0(this,"locale",void 0),v0(this,"serviceUrl",void 0),v0(this,"headers",void 0),v0(this,"fetch",(function(){var o=aU(a1().mark(function a(c){var l;return a1().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,e.serviceUrl?fetch(e.serviceUrl,{body:JSON.stringify(c),headers:e.headers,method:"POST"}):rhe({payload:c});case 2:return l=h.sent,h.abrupt("return",l);case 4:case"end":return h.stop()}},a)}));return function(a){return o.apply(this,arguments)}})()),v0(this,"create",(function(){var o=aU(a1().mark(function a(c){return a1().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",e.fetch(c));case 1:case"end":return u.stop()}},a)}));return function(a){return o.apply(this,arguments)}})()),v0(this,"createAudio",(function(){var o=aU(a1().mark(function a(c){var l,u;return a1().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,e.create(c);case 2:return l=d.sent,d.next=5,l.arrayBuffer();case 5:return u=d.sent,d.abrupt("return",ret(u));case 7:case"end":return d.stop()}},a)}));return function(a){return o.apply(this,arguments)}})()),this.locale=i,this.serviceUrl=r,this.headers=s}return rtt(t,[{key:"voiceOptions",get:function(){return ett(this.locale)}}]),t})();v0(g2,"localeOptions",fet());v0(g2,"voiceList",XO);v0(g2,"voiceName",YO);v0(g2,"createRequest",rhe);let cU;async function she(t,e){return new Promise(n=>{ge(cU)||(cU=new g2({locale:"en-US"}));const r=setTimeout(()=>n(void 0),5e3);cU.createAudio({input:e,options:{voice:t}}).then(i=>{clearTimeout(r),n(i)})})}async function stt(t,e,n){if(!ge(t)||n.trim()==="")return;const r=await she(e,n);ge(r)&&t.addttsaudiobuffer(r)}const ott=Gfe(1);async function att(t,e){if(!ge(t))return;t.addttsaudiobuffer(e);const n=Math.max(1e3,Math.round(e.duration*1e3));await Kl(n)}const ctt=Gfe(1);async function ltt(t,e,n){const r=await she(e,n);ott.add(async()=>{ge(r)&&await att(t,r)})}function utt(t,e,n){ctt.add(async()=>{await ltt(t,e,n)})}const ftt=Date.now(),Pd={get value(){return(Date.now()-ftt)/1e3%1e6}},htt=120;let ohe=0;function ahe(t){ohe=htt/t}const dtt=136;ahe(dtt);const _2={get value(){return ohe}};function v2(t){const e=t.clone();return e.uniforms.time=Pd,e.uniforms.interval=_2,e}let Wk=!1,ZO=!1;function y2(){ZO||Wk||(Wk=!0,NN(new lT({latencyHint:"playback"}),!0),BYe().then(()=>{if(!ZO){try{const t=navigator;ge(t.audioSession)&&(t.audioSession.type="playback")}catch{}return qfe().then(()=>{Wk=!1,ZO=!0,ASe(f1,ui())})}}).catch(t=>{Wk=!1,Pr(f1,ui(),"audio",t.toString())}))}let wu;function ptt(){return wu?.broadcastdestination}const f1=lb("synth",[],t=>{if(!f1.session(t)||(ZO&&!ge(wu)&&(wu=Vfe(),pB().start()),!ge(wu)))return;const e=ui();switch(t.target){case"audioenabled":if(t.player!==e)return;break}const n=Si.getState().gadget.board;switch(t.target){case"audioenabled":Ei(f1,t.player,"audio is enabled!"),ra(f1,t.player,async()=>{await Kl(2e3),qh(f1,t.player,void 0,"text","audio:enabled","")});break;case"bpm":if(an(t.data)){const r=Math.round(t.data);wu.setbpm(r),ahe(r)}break;case"playvolume":an(t.data)&&wu.setplayvolume(t.data);break;case"bgplayvolume":an(t.data)&&wu.setbgplayvolume(t.data);break;case"ttsvolume":an(t.data)&&wu.setttsvolume(t.data);break;case"play":if(Rr(t.data)){const[r,i]=t.data;if(r&&r!==n)return;i.trim()===""?wu.stopplay():wu.addplay(i)}break;case"bgplay":if(Rr(t.data)){const[r,i,s]=t.data;if(r&&r!==n)return;wu.addbgplay(i,s)}break;case"voice":if(Rr(t.data)){const[r,i,s]=t.data;WQe(t.player,wu,r,i,s)}break;case"voicefx":if(Rr(t.data)){const[r,i,s,o]=t.data;tet(t.player,wu,r,i,s,o)}break;case"record":Sn(t.data)&&wu.synthrecord(t.data);break;case"flush":wu.synthflush();break;case"tts":ra(f1,t.player,async()=>{if(Rr(t.data)){const[r,i]=t.data;await stt(wu,r,i)}});break;case"ttsqueue":if(Rr(t.data)){const[r,i]=t.data;utt(wu,r,i)}break}});function rE(){return rE=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},rE.apply(null,arguments)}var mtt=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/n)*Math.atan(Math.sin(2*Math.PI*e*i)/n)},gtt=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function im(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:gtt,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,c="velocity_"+e;if(t.__damp===void 0&&(t.__damp={}),t.__damp[c]===void 0&&(t.__damp[c]=0),Math.abs(t[e]-n)<=a)return t[e]=n,!1;r=Math.max(1e-4,r);var l=2/r,u=o(l*i),h=t[e]-n,d=n,m=s*r;h=Math.min(Math.max(h,-m),m),n=t[e]-h;var p=(t.__damp[c]+l*h)*i;t.__damp[c]=(t.__damp[c]-l*p)*u;var g=n+(h+p)*u;return d-t[e]>0==g>d&&(g=d,t.__damp[c]=(g-d)/i),t[e]=g,!0}function lU(t,e,n,r,i,s,o,a){return im(t,e,t[e]+UEe(t[e],n),r,i,s,o,a)}var cS=new jt,PZ,DZ,LZ;function rb(t,e,n,r,i,s,o){return typeof e=="number"?cS.setScalar(e):Array.isArray(e)?cS.set(e[0],e[1],e[2]):cS.copy(e),PZ=im(t,"x",cS.x,n,r,i,s,o),DZ=im(t,"y",cS.y,n,r,i,s,o),LZ=im(t,"z",cS.z,n,r,i,s,o),PZ||DZ||LZ}var xC=new U0,UZ,BZ,FZ;function SB(t,e,n,r,i,s,o){return Array.isArray(e)?xC.set(e[0],e[1],e[2],e[3]):xC.copy(e),UZ=lU(t,"x",xC.x,n,r,i,s,o),BZ=lU(t,"y",xC.y,n,r,i,s,o),FZ=lU(t,"z",xC.z,n,r,i,s,o),UZ||BZ||FZ}const jZ=t=>Symbol.iterator in t,zZ=t=>"entries"in t,HZ=(t,e)=>{const n=t instanceof Map?t:new Map(t.entries()),r=e instanceof Map?e:new Map(e.entries());if(n.size!==r.size)return!1;for(const[i,s]of n)if(!Object.is(s,r.get(i)))return!1;return!0},_tt=(t,e)=>{const n=t[Symbol.iterator](),r=e[Symbol.iterator]();let i=n.next(),s=r.next();for(;!i.done&&!s.done;){if(!Object.is(i.value,s.value))return!1;i=n.next(),s=r.next()}return!!i.done&&!!s.done};function vtt(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null||Object.getPrototypeOf(t)!==Object.getPrototypeOf(e)?!1:jZ(t)&&jZ(e)?zZ(t)&&zZ(e)?HZ(t,e):_tt(t,e):HZ({entries:()=>Object.entries(t)},{entries:()=>Object.entries(e)})}function iu(t){const e=zd.useRef(void 0);return n=>{const r=t(n);return vtt(e.current,r)?e.current:e.current=r}}function che(t,e,n){const r=Hh(m=>m.size),i=Hh(m=>m.viewport),s=typeof t=="number"?t:r.width*i.dpr,o=typeof e=="number"?e:r.height*i.dpr,a=(typeof t=="number"?n:t)||{},{samples:c=0,depth:l,...u}=a,h=l??a.depthBuffer,d=et.useMemo(()=>{const m=new Iu(s,o,{minFilter:nf,magFilter:nf,type:ab,...u});return h&&(m.depthTexture=new o3(s,o,hg)),m.samples=c,m},[]);return et.useLayoutEffect(()=>{d.setSize(s,o),c&&(d.samples=c)},[c,d,s,o]),et.useEffect(()=>()=>d.dispose(),[]),d}const ytt=t=>typeof t=="function",btt=et.forwardRef(({envMap:t,resolution:e=256,frames:n=1/0,children:r,makeDefault:i,...s},o)=>{const a=Hh(({set:y})=>y),c=Hh(({camera:y})=>y),l=Hh(({size:y})=>y),u=et.useRef(null);et.useImperativeHandle(o,()=>u.current,[]);const h=et.useRef(null),d=che(e);et.useLayoutEffect(()=>{s.manual||u.current.updateProjectionMatrix()},[l,s]),et.useLayoutEffect(()=>{u.current.updateProjectionMatrix()}),et.useLayoutEffect(()=>{if(i){const y=c;return a(()=>({camera:u.current})),()=>a(()=>({camera:y}))}},[u,i,a]);let m=0,p=null;const g=ytt(r);return Jd(y=>{g&&(n===1/0||m<n)&&(h.current.visible=!1,y.gl.setRenderTarget(d),p=y.scene.background,t&&(y.scene.background=t),y.gl.render(y.scene,u.current),y.scene.background=p,y.gl.setRenderTarget(null),h.current.visible=!0,m++)}),et.createElement(et.Fragment,null,et.createElement("orthographicCamera",rE({left:l.width/-2,right:l.width/2,top:l.height/2,bottom:l.height/-2,ref:u},s),!g&&r),et.createElement("group",{ref:h},g&&r(d.texture)))});var JO={exports:{}},Ett=JO.exports,qZ;function Stt(){return qZ||(qZ=1,(function(t,e){(function(n,r){t.exports=r()})(Ett,function(){var n=function(){function r(m){return o.appendChild(m.dom),m}function i(m){for(var p=0;p<o.children.length;p++)o.children[p].style.display=p===m?"block":"none";s=m}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(m){m.preventDefault(),i(++s%o.children.length)},!1);var a=(performance||Date).now(),c=a,l=0,u=r(new n.Panel("FPS","#0ff","#002")),h=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=r(new n.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:o,addPanel:r,showPanel:i,begin:function(){a=(performance||Date).now()},end:function(){l++;var m=(performance||Date).now();if(h.update(m-a,200),m>c+1e3&&(u.update(1e3*l/(m-c),100),c=m,l=0,d)){var p=performance.memory;d.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return m},update:function(){a=this.end()},domElement:o,setMode:i}};return n.Panel=function(r,i,s){var o=1/0,a=0,c=Math.round,l=c(window.devicePixelRatio||1),u=80*l,h=48*l,d=3*l,m=2*l,p=3*l,g=15*l,y=74*l,v=30*l,x=document.createElement("canvas");x.width=u,x.height=h,x.style.cssText="width:80px;height:48px";var E=x.getContext("2d");return E.font="bold "+9*l+"px Helvetica,Arial,sans-serif",E.textBaseline="top",E.fillStyle=s,E.fillRect(0,0,u,h),E.fillStyle=i,E.fillText(r,d,m),E.fillRect(p,g,y,v),E.fillStyle=s,E.globalAlpha=.9,E.fillRect(p,g,y,v),{dom:x,update:function(C,A){o=Math.min(o,C),a=Math.max(a,C),E.fillStyle=s,E.globalAlpha=1,E.fillRect(0,0,u,g),E.fillStyle=i,E.fillText(c(C)+" "+r+" ("+c(o)+"-"+c(a)+")",d,m),E.drawImage(x,p+l,g,y-l,v,p,g,y-l,v),E.fillRect(p+y-l,g,l,v),E.fillStyle=s,E.globalAlpha=.9,E.fillRect(p+y-l,g,l,c((1-C/A)*v))}}},n})})(JO)),JO.exports}var xtt=Stt();const Ttt=su(xtt);function uU(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(l){try{c(r.next(l))}catch(u){s(u)}}function a(l){try{c(r.throw(l))}catch(u){s(u)}}function c(l){var u;l.done?i(l.value):(u=l.value,u instanceof n?u:new n((function(h){h(u)}))).then(o,a)}c((r=r.apply(t,[])).next())}))}const wtt=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function VZ(t){return t=t.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const lhe=typeof window>"u",u0=(()=>{if(lhe)return;const{userAgent:t,platform:e,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(t),i=e==="iPad"||e==="MacIntel"&&n>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(t)||r||i,isSafari12:/Version\/12.+Safari/.test(t),isFirefox:/Firefox/.test(t)}})();function Rtt(t,e,n){if(!n)return[e];const r=(function(l){const u=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,h=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,d=l.createShader(35633),m=l.createShader(35632),p=l.createProgram();if(!(m&&d&&p))return;l.shaderSource(d,u),l.shaderSource(m,h),l.compileShader(d),l.compileShader(m),l.attachShader(p,d),l.attachShader(p,m),l.linkProgram(p),l.detachShader(p,d),l.detachShader(p,m),l.deleteShader(d),l.deleteShader(m),l.useProgram(p);const g=l.createBuffer();l.bindBuffer(34962,g),l.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const y=l.getAttribLocation(p,"aPosition");l.vertexAttribPointer(y,3,5126,!1,0,0),l.enableVertexAttribArray(y),l.clearColor(1,1,1,1),l.clear(16384),l.viewport(0,0,1,1),l.drawArrays(4,0,3);const v=new Uint8Array(4);return l.readPixels(0,0,1,1,6408,5121,v),l.deleteProgram(p),l.deleteBuffer(g),v.join("")})(t),i="801621810",s="8016218135",o="80162181161",a=u0?.isIpad?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["a15",i,15],["m1",i,15],["m2",i,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15],["a15",i,15],["a16",i,15],["a17",i,15]];let c;return r==="80162181255"?c=a.filter((([,,l])=>l>=14)):(c=a.filter((([,l])=>l===r)),c.length||(c=a)),c.map((([l])=>`apple ${l} gpu`))}class GZ extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const fU=[],$Z=[];function Ctt(t,e){if(t===e)return 0;const n=t;t.length>e.length&&(t=e,e=n);let r=t.length,i=e.length;for(;r>0&&t.charCodeAt(~-r)===e.charCodeAt(~-i);)r--,i--;let s,o=0;for(;o<r&&t.charCodeAt(o)===e.charCodeAt(o);)o++;if(r-=o,i-=o,r===0)return i;let a,c,l=0,u=0,h=0;for(;u<r;)$Z[u]=t.charCodeAt(o+u),fU[u]=++u;for(;h<i;)for(s=e.charCodeAt(o+h),a=h++,l=h,u=0;u<r;u++)c=s===$Z[u]?a:a+1,a=fU[u],l=fU[u]=a>l?c>l?l+1:c:c>a?a+1:c;return l}function Att(t){return t!=null}const Mtt=({mobileTiers:t=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:n={},glContext:r,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>uU(void 0,void 0,void 0,(function*(){const o={};if(lhe)return{tier:0,type:"SSR"};const{isIpad:a=!!u0?.isIpad,isMobile:c=!!u0?.isMobile,screenSize:l=window.screen,loadBenchmarks:u=(A=>uU(void 0,void 0,void 0,(function*(){const k=yield fetch(`${s}/${A}`).then((M=>M.json()));if(parseInt(k.shift().split(".")[0],10)<4)throw new GZ("Detect GPU benchmark data is out of date. Please update to version 4x");return k})))}=n;let{renderer:h}=n;const d=(A,k,M,I,z)=>({device:z,fps:I,gpu:M,isMobile:c,tier:A,type:k});let m,p="";if(h)h=VZ(h),m=[h];else{const A=r||(function(M,I=!1){const z={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:I,powerPreference:"high-performance",stencil:!1};M&&delete z.powerPreference;const H=window.document.createElement("canvas"),K=H.getContext("webgl",z)||H.getContext("experimental-webgl",z);return K??void 0})(u0?.isSafari12,i);if(!A)return d(0,"WEBGL_UNSUPPORTED");const k=u0?.isFirefox?null:A.getExtension("WEBGL_debug_renderer_info");if(h=k?A.getParameter(k.UNMASKED_RENDERER_WEBGL):A.getParameter(A.RENDERER),!h)return d(1,"FALLBACK");p=h,h=VZ(h),m=(function(M,I,z){return I==="apple gpu"?Rtt(M,I,z):[I]})(A,h,c)}const g=(yield Promise.all(m.map((function(A){var k;return uU(this,void 0,void 0,(function*(){const M=(ne=>{const ie=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const ae of ie)if(ne.includes(ae))return ae})(A);if(!M)return;const I=`${c?"m":"d"}-${M}${a?"-ipad":""}.json`,z=o[I]=(k=o[I])!==null&&k!==void 0?k:u(I);let H;try{H=yield z}catch(ne){if(ne instanceof GZ)throw ne;return}const K=(function(ne){var ie;const ae=(ne=ne.replace(/\([^)]+\)/,"")).match(/\d+/)||ne.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(ie=ae?.join("").replace(/\W|amd/g,""))!==null&&ie!==void 0?ie:""})(A);let P=H.filter((([,ne])=>ne===K));P.length||(P=H.filter((([ne])=>ne.includes(A))));const F=P.length;if(F===0)return;const N=A.split(/[.,()\[\]/\s]/g).sort().filter(((ne,ie,ae)=>ie===0||ne!==ae[ie-1])).join(" ");let X,[G,,,,j]=F>1?P.map((ne=>[ne,Ctt(N,ne[2])])).sort((([,ne],[,ie])=>ne-ie))[0][0]:P[0],q=Number.MAX_VALUE;const{devicePixelRatio:te}=window,W=l.width*te*l.height*te;for(const ne of j){const[ie,ae]=ne,xe=ie*ae,Ne=Math.abs(W-xe);Ne<q&&(q=Ne,X=ne)}if(!X)return;const[,,$,J]=X;return[q,$,G,J]}))})))).filter(Att).sort((([A=Number.MAX_VALUE,k],[M=Number.MAX_VALUE,I])=>A===M?k-I:A-M));if(!g.length){const A=wtt.find((k=>h.includes(k)));return A?d(0,"BLOCKLISTED",A):d(1,"FALLBACK",`${h} (${p})`)}const[,y,v,x]=g[0];if(y===-1)return d(0,"BLOCKLISTED",v,y,x);const E=c?t:e;let C=0;for(let A=0;A<E.length;A++)y>=E[A]&&(C=A);return d(C,"BENCHMARK",v,y,x)})),ktt=t=>Mee(()=>Mtt(t),["useDetectGPU"]),WZ=(t,e)=>{t.updateRanges[0]=e};function Ott(t){return typeof t=="function"}const KZ=new Ks,XZ=new Ks,Kk=[],TC=new Uh;class Itt extends TS{constructor(){super(),this.color=new Xi("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,n){const r=this.instance.current;if(!r||!r.geometry||!r.material)return;TC.geometry=r.geometry;const i=r.matrixWorld,s=r.userData.instances.indexOf(this.instanceKey);if(!(s===-1||s>r.count)){r.getMatrixAt(s,KZ),XZ.multiplyMatrices(i,KZ),TC.matrixWorld=XZ,r.material instanceof cb?TC.material.side=r.material.side:TC.material.side=r.material[0].side,TC.raycast(e,Kk);for(let o=0,a=Kk.length;o<a;o++){const c=Kk[o];c.instanceId=s,c.object=this,n.push(c)}Kk.length=0}}}const uhe=et.createContext(null),YZ=new Ks,ZZ=new Ks,Ntt=new Ks,JZ=new jt,QZ=new zx,eJ=new jt,Ptt=t=>t.isInstancedBufferAttribute,cv=et.forwardRef(({context:t,children:e,...n},r)=>{et.useMemo(()=>f8({PositionMesh:Itt}),[]);const i=et.useRef(null);et.useImperativeHandle(r,()=>i.current,[]);const{subscribe:s,getParent:o}=et.useContext(t||uhe);return et.useLayoutEffect(()=>s(i),[]),et.createElement("positionMesh",rE({instance:o(),instanceKey:i,ref:i},n),e)}),Oy=et.forwardRef(({context:t,children:e,range:n,limit:r=1e3,frames:i=1/0,...s},o)=>{const[{localContext:a,instance:c}]=et.useState(()=>{const x=et.createContext(null);return{localContext:x,instance:et.forwardRef((E,C)=>et.createElement(cv,rE({context:x},E,{ref:C})))}}),l=et.useRef(null);et.useImperativeHandle(o,()=>l.current,[]);const[u,h]=et.useState([]),[[d,m]]=et.useState(()=>{const x=new Float32Array(r*16);for(let E=0;E<r;E++)Ntt.identity().toArray(x,E*16);return[x,new Float32Array([...new Array(r*3)].map(()=>1))]});et.useEffect(()=>{l.current.instanceMatrix.needsUpdate=!0});let p=0,g=0;const y=et.useRef([]);et.useLayoutEffect(()=>{y.current=Object.entries(l.current.geometry.attributes).filter(([x,E])=>Ptt(E))}),Jd(()=>{if(i===1/0||p<i){l.current.updateMatrix(),l.current.updateMatrixWorld(),YZ.copy(l.current.matrixWorld).invert(),g=Math.min(r,n!==void 0?n:r,u.length),l.current.count=g,WZ(l.current.instanceMatrix,{start:0,count:g*16}),WZ(l.current.instanceColor,{start:0,count:g*3});for(let x=0;x<u.length;x++){const E=u[x].current;E.matrixWorld.decompose(JZ,QZ,eJ),ZZ.compose(JZ,QZ,eJ).premultiply(YZ),ZZ.toArray(d,x*16),l.current.instanceMatrix.needsUpdate=!0,E.color.toArray(m,x*3),l.current.instanceColor.needsUpdate=!0}p++}});const v=et.useMemo(()=>({getParent:()=>l,subscribe:x=>(h(E=>[...E,x]),()=>h(E=>E.filter(C=>C.current!==x.current)))}),[]);return et.createElement("instancedMesh",rE({userData:{instances:u,limit:r,frames:i},matrixAutoUpdate:!1,ref:l,args:[null,null,0],raycast:()=>null},s),et.createElement("instancedBufferAttribute",{attach:"instanceMatrix",args:[d,16],usage:Gj}),et.createElement("instancedBufferAttribute",{attach:"instanceColor",args:[m,3],usage:Gj}),Ott(e)?et.createElement(a.Provider,{value:v},e(c)):t?et.createElement(t.Provider,{value:v},e):et.createElement(uhe.Provider,{value:v},e))});function Dtt(t,e){const n=t+"Geometry";return et.forwardRef(({args:r,children:i,...s},o)=>{const a=et.useRef(null);return et.useImperativeHandle(o,()=>a.current),et.useLayoutEffect(()=>void e?.(a.current)),et.createElement("mesh",rE({ref:a},s),et.createElement(n,{attach:"geometry",args:r}),i)})}const Ltt=Dtt("plane");/**
 * postprocessing v6.37.7 build Mon Aug 04 2025
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2025 Raoul van Rschen
 * @license Zlib
 */var hU=1/1e3,Utt=1e3,Btt=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(t){typeof document<"u"&&document.hidden!==void 0&&(t?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=t)}get delta(){return this._delta*hU}get fixedDelta(){return this._fixedDelta*hU}set fixedDelta(t){this._fixedDelta=t*Utt}get elapsed(){return this._elapsed*hU}update(t){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(t!==void 0?t:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(t){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Ftt=(()=>{const t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),n=new $0;return n.setAttribute("position",new Pa(t,3)),n.setAttribute("uv",new Pa(e,2)),n})(),rd=class xB{static get fullscreenGeometry(){return Ftt}constructor(e="Pass",n=new mI,r=new r8){this.name=e,this.renderer=null,this.scene=n,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const n=this.fullscreenMaterial;n!==null&&(n.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let n=this.screen;n!==null?n.material=e:(n=new Uh(xB.fullscreenGeometry,e),n.frustumCulled=!1,this.scene===null&&(this.scene=new mI),this.scene.add(n),this.screen=n)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,n=iE){}render(e,n,r,i,s){throw new Error("Render method not implemented!")}setSize(e,n){}initialize(e,n,r){}dispose(){for(const e of Object.keys(this)){const n=this[e];(n instanceof Iu||n instanceof cb||n instanceof El||n instanceof xB)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},jtt=class extends rd{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(t,e,n,r,i){const s=t.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},ztt=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,b2="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",fhe=class extends Fa{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new yn(null),opacity:new yn(1)},blending:Ou,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ztt,vertexShader:b2})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}getOpacity(t){return this.uniforms.opacity.value}setOpacity(t){this.uniforms.opacity.value=t}},hhe=class extends rd{constructor(t,e=!0){super("CopyPass"),this.fullscreenMaterial=new fhe,this.needsSwap=!1,this.renderTarget=t,t===void 0&&(this.renderTarget=new Iu(1,1,{minFilter:nf,magFilter:nf,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(t){this.autoResize=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(t){this.autoResize=t}render(t,e,n,r,i){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){this.autoResize&&this.renderTarget.setSize(t,e)}initialize(t,e,n){n!==void 0&&(this.renderTarget.texture.type=n,n!==xa?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":t!==null&&t.outputColorSpace===rs&&(this.renderTarget.texture.colorSpace=rs))}},tJ=new Xi,dhe=class extends rd{constructor(t=!0,e=!0,n=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=t,this.depth=e,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(t,e,n){this.color=t,this.depth=e,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(t){this.overrideClearColor=t}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(t){this.overrideClearAlpha=t}render(t,e,n,r,i){const s=this.overrideClearColor,o=this.overrideClearAlpha,a=t.getClearAlpha(),c=s!==null,l=o>=0;c?(t.getClearColor(tJ),t.setClearColor(s,l?o:a)):l&&t.setClearAlpha(o),t.setRenderTarget(this.renderToScreen?null:e),t.clear(this.color,this.depth,this.stencil),c?t.setClearColor(tJ,a):l&&t.setClearAlpha(a)}},Htt=class extends rd{constructor(t,e){super("MaskPass",t,e),this.needsSwap=!1,this.clearPass=new dhe(!1,!1,!0),this.inverse=!1}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get inverted(){return this.inverse}set inverted(t){this.inverse=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(t){this.inverted=t}render(t,e,n,r,i){const s=t.getContext(),o=t.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,h=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,u,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(t,null):(l.render(t,e),l.render(t,n))),this.renderToScreen?(t.setRenderTarget(null),t.render(a,c)):(t.setRenderTarget(e),t.render(a,c),t.setRenderTarget(n),t.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},phe=class{constructor(e=null,{depthBuffer:n=!0,stencilBuffer:r=!1,multisampling:i=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(n,r,s,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new hhe,this.depthTexture=null,this.passes=[],this.timer=new Btt,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const n=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(n.depthBuffer,n.stencilBuffer,n.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const n=e.getSize(new Vn),r=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===xa&&e.outputColorSpace===rs&&(this.inputBuffer.texture.colorSpace=rs,this.outputBuffer.texture.colorSpace=rs,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(n.width,n.height);for(const s of this.passes)s.initialize(e,r,i)}}replaceRenderer(e,n=!0){const r=this.renderer,i=r.domElement.parentNode;return this.setRenderer(e),n&&i!==null&&(i.removeChild(r.domElement),i.appendChild(e.domElement)),r}createDepthTexture(){const e=this.depthTexture=new o3;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=ex,e.type=QS):e.type=Wy,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,n,r,i){const s=this.renderer,o=s===null?new Vn:s.getDrawingBufferSize(new Vn),a={minFilter:nf,magFilter:nf,stencilBuffer:n,depthBuffer:e,type:r},c=new Iu(o.width,o.height,a);return i>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=i),r===xa&&s!==null&&s.outputColorSpace===rs&&(c.texture.colorSpace=rs),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const n of this.passes)n.mainScene=e}setMainCamera(e){for(const n of this.passes)n.mainCamera=e}addPass(e,n){const r=this.passes,i=this.renderer,s=i.getDrawingBufferSize(new Vn),o=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(s.width,s.height),e.initialize(i,o,a),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),n!==void 0?r.splice(n,0,e):r.push(e),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(e of r)e.setDepthTexture(c)}else e.setDepthTexture(this.depthTexture)}removePass(e){const n=this.passes,r=n.indexOf(e);if(r!==-1&&n.splice(r,1).length>0){if(this.depthTexture!==null){const o=(c,l)=>c||l.needsDepthTexture;n.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===n.length&&(e.renderToScreen=!1,n.length>0&&(n[n.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const n=this.renderer,r=this.copyPass;let i=this.inputBuffer,s=this.outputBuffer,o=!1,a,c,l;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const u of this.passes)u.enabled&&(u.render(n,i,s,e,o),u.needsSwap&&(o&&(r.renderToScreen=u.renderToScreen,a=n.getContext(),c=n.state.buffers.stencil,c.setFunc(a.NOTEQUAL,1,4294967295),r.render(n,i,s,e,o),c.setFunc(a.EQUAL,1,4294967295)),l=i,i=s,s=l),u instanceof Htt?o=!0:u instanceof jtt&&(o=!1))}setSize(e,n,r){const i=this.renderer,s=i.getSize(new Vn);(e===void 0||n===void 0)&&(e=s.width,n=s.height),(s.width!==e||s.height!==n)&&i.setSize(e,n,r);const o=i.getDrawingBufferSize(new Vn);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),rd.fullscreenGeometry.dispose()}},Wh={NONE:0,DEPTH:1,CONVOLUTION:2},Os={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},qtt=class{constructor(){this.shaderParts=new Map([[Os.FRAGMENT_HEAD,null],[Os.FRAGMENT_MAIN_UV,null],[Os.FRAGMENT_MAIN_IMAGE,null],[Os.VERTEX_HEAD,null],[Os.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Wh.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Rv}},dU=!1,nJ=class{constructor(t=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(t),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let n;if(e.material.flatShading)switch(e.material.side){case Zl:n=this.materialsFlatShadedDoubleSide;break;case Ql:n=this.materialsFlatShadedBackSide;break;default:n=this.materialsFlatShaded;break}else switch(e.material.side){case Zl:n=this.materialsDoubleSide;break;case Ql:n=this.materialsBackSide;break;default:n=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=n[2]:e.isInstancedMesh?e.material=n[1]:e.material=n[0],++this.meshCount}}}cloneMaterial(t){if(!(t instanceof Fa))return t.clone();const e=t.uniforms,n=new Map;for(const i in e){const s=e[i].value;s.isRenderTargetTexture&&(e[i].value=null,n.set(i,s))}const r=t.clone();for(const i of n)e[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(t){if(this.disposeMaterials(),this.material=t,t!==null){const e=this.materials=[this.cloneMaterial(t),this.cloneMaterial(t),this.cloneMaterial(t)];for(const n of e)n.uniforms=Object.assign({},t.uniforms),n.side=wv;e[2].skinning=!0,this.materialsBackSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.side=Ql,r}),this.materialsDoubleSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.side=Zl,r}),this.materialsFlatShaded=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=Ql,r}),this.materialsFlatShadedDoubleSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=Zl,r})}}render(t,e,n){const r=t.shadowMap.enabled;if(t.shadowMap.enabled=!1,dU){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),t.render(e,n);for(const s of i)s[0].material=s[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,t.render(e,n),e.overrideMaterial=i}t.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of t)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return dU}static set workaroundEnabled(t){dU=t}},vy=-1,qd=class extends Dv{constructor(t,e=vy,n=vy,r=1){super(),this.resizable=t,this.baseSize=new Vn(1,1),this.preferredSize=new Vn(e,n),this.target=this.preferredSize,this.s=r,this.effectiveSize=new Vn,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const t=this.baseSize,e=this.preferredSize,n=this.effectiveSize,r=this.scale;e.width!==vy?n.width=e.width:e.height!==vy?n.width=Math.round(e.height*(t.width/Math.max(t.height,1))):n.width=Math.round(t.width*r),e.height!==vy?n.height=e.height:e.width!==vy?n.height=Math.round(e.width/Math.max(t.width/Math.max(t.height,1),1)):n.height=Math.round(t.height*r)}get width(){return this.effectiveSize.width}set width(t){this.preferredWidth=t}get height(){return this.effectiveSize.height}set height(t){this.preferredHeight=t}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(t){this.s!==t&&(this.s=t,this.preferredSize.setScalar(vy),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(t){this.scale=t}get baseWidth(){return this.baseSize.width}set baseWidth(t){this.baseSize.width!==t&&(this.baseSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(t){this.baseWidth=t}get baseHeight(){return this.baseSize.height}set baseHeight(t){this.baseSize.height!==t&&(this.baseSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(t){this.baseHeight=t}setBaseSize(t,e){(this.baseSize.width!==t||this.baseSize.height!==e)&&(this.baseSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(t){this.preferredSize.width!==t&&(this.preferredSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(t){this.preferredWidth=t}get preferredHeight(){return this.preferredSize.height}set preferredHeight(t){this.preferredSize.height!==t&&(this.preferredSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(t){this.preferredHeight=t}setPreferredSize(t,e){(this.preferredSize.width!==t||this.preferredSize.height!==e)&&(this.preferredSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(t){this.s=t.scale,this.baseSize.set(t.baseWidth,t.baseHeight),this.preferredSize.set(t.preferredWidth,t.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return vy}},bi={ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Vtt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),opacity);}",Gtt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}",$tt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),opacity);}",Wtt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),opacity);}",Ktt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),opacity);}",Xtt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),opacity);}",Ytt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),opacity);}",Ztt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),opacity);}",Jtt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),opacity);}",Qtt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),opacity);}",ent="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),opacity);}",tnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),opacity);}",nnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),opacity);}",rnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),opacity);}",snt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),opacity);}",ont="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),opacity);}",ant="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}",cnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),opacity);}",lnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}",unt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),opacity);}",fnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),opacity);}",hnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),opacity);}",dnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",pnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),opacity);}",mnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),opacity);}",gnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),opacity);}",_nt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),opacity);}",vnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),opacity);}",ynt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),opacity);}",bnt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Ent="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),opacity);}",Snt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),opacity);}",xnt=new Map([[bi.ADD,Vtt],[bi.ALPHA,Gtt],[bi.AVERAGE,$tt],[bi.COLOR,Wtt],[bi.COLOR_BURN,Ktt],[bi.COLOR_DODGE,Xtt],[bi.DARKEN,Ytt],[bi.DIFFERENCE,Ztt],[bi.DIVIDE,Jtt],[bi.DST,null],[bi.EXCLUSION,Qtt],[bi.HARD_LIGHT,ent],[bi.HARD_MIX,tnt],[bi.HUE,nnt],[bi.INVERT,rnt],[bi.INVERT_RGB,snt],[bi.LIGHTEN,ont],[bi.LINEAR_BURN,ant],[bi.LINEAR_DODGE,cnt],[bi.LINEAR_LIGHT,lnt],[bi.LUMINOSITY,unt],[bi.MULTIPLY,fnt],[bi.NEGATION,hnt],[bi.NORMAL,dnt],[bi.OVERLAY,pnt],[bi.PIN_LIGHT,mnt],[bi.REFLECT,gnt],[bi.SATURATION,_nt],[bi.SCREEN,vnt],[bi.SOFT_LIGHT,ynt],[bi.SRC,bnt],[bi.SUBTRACT,Ent],[bi.VIVID_LIGHT,Snt]]),Tnt=class extends Dv{constructor(t,e=1){super(),this._blendFunction=t,this.opacity=new yn(e)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this._blendFunction}set blendFunction(t){this._blendFunction=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return xnt.get(this.blendFunction)}},Tg=class extends Dv{constructor(t,e,{attributes:n=Wh.NONE,blendFunction:r=bi.NORMAL,defines:i=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=t,this.renderer=null,this.attributes=n,this.fragmentShader=e,this.vertexShader=a,this.defines=i,this.uniforms=s,this.extensions=o,this.blendMode=new Tnt(r),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=Rv,this._outputColorSpace=b0}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(t){this._inputColorSpace=t,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t,this.setChanged()}set mainScene(t){}set mainCamera(t){}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,e=iE){}update(t,e,n){}setSize(t,e){}initialize(t,e,n){}dispose(){for(const t of Object.keys(this)){const e=this[t];(e instanceof Iu||e instanceof cb||e instanceof El||e instanceof rd)&&this[t].dispose()}}},E2={MEDIUM:2,LARGE:3,VERY_LARGE:4},wnt=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Rnt="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Cnt=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Ant=class extends Fa{constructor(t=new La){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new yn(null),texelSize:new yn(new La),scale:new yn(1),kernel:new yn(0)},blending:Ou,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:wnt,vertexShader:Rnt}),this.setTexelSize(t.x,t.y),this.kernelSize=E2.MEDIUM}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.inputBuffer=t}get kernelSequence(){return Cnt[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(){return this.uniforms.scale.value}setScale(t){this.uniforms.scale.value=t}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(t){this.uniforms.kernel.value=t}setKernel(t){this.kernel=t}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e,t*.5,e*.5)}setSize(t,e){const n=1/t,r=1/e;this.uniforms.texelSize.value.set(n,r,n*.5,r*.5)}},mhe=class extends rd{constructor({kernelSize:t=E2.MEDIUM,resolutionScale:e=.5,width:n=qd.AUTO_SIZE,height:r=qd.AUTO_SIZE,resolutionX:i=n,resolutionY:s=r}={}){super("KawaseBlurPass"),this.renderTargetA=new Iu(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new qd(this,i,s,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new Ant,this._blurMaterial.kernelSize=t,this.copyMaterial=new fhe}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(t){this._blurMaterial=t}get dithering(){return this.copyMaterial.dithering}set dithering(t){this.copyMaterial.dithering=t}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(t){this.blurMaterial.kernelSize=t}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get scale(){return this.blurMaterial.scale}set scale(t){this.blurMaterial.scale=t}getScale(){return this.blurMaterial.scale}setScale(t){this.blurMaterial.scale=t}getKernelSize(){return this.kernelSize}setKernelSize(t){this.kernelSize=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,n,r,i){const s=this.scene,o=this.camera,a=this.renderTargetA,c=this.renderTargetB,l=this.blurMaterial,u=l.kernelSequence;let h=e;this.fullscreenMaterial=l;for(let d=0,m=u.length;d<m;++d){const p=(d&1)===0?a:c;l.kernel=u[d],l.inputBuffer=h.texture,t.setRenderTarget(p),t.render(s,o),h=p}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,t.setRenderTarget(this.renderToScreen?null:n),t.render(s,o)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e);const r=n.width,i=n.height;this.renderTargetA.setSize(r,i),this.renderTargetB.setSize(r,i),this.blurMaterial.setSize(t,e)}initialize(t,e,n){n!==void 0&&(this.renderTargetA.texture.type=n,this.renderTargetB.texture.type=n,n!==xa?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):t!==null&&t.outputColorSpace===rs&&(this.renderTargetA.texture.colorSpace=rs,this.renderTargetB.texture.colorSpace=rs))}static get AUTO_SIZE(){return qd.AUTO_SIZE}},Mnt=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,knt=class extends Fa{constructor(t=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:EM.replace(/\D+/g,"")},uniforms:{inputBuffer:new yn(null),threshold:new yn(0),smoothing:new yn(1),range:new yn(null)},blending:Ou,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Mnt,vertexShader:b2}),this.colorOutput=t,this.luminanceRange=e}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get threshold(){return this.uniforms.threshold.value}set threshold(t){this.smoothing>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=t}getThreshold(){return this.threshold}setThreshold(t){this.threshold=t}get smoothing(){return this.uniforms.smoothing.value}set smoothing(t){this.threshold>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=t}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(t){this.smoothing=t}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(t){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(t){t?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(t){return this.colorOutput}setColorOutputEnabled(t){this.colorOutput=t}get useRange(){return this.luminanceRange!==null}set useRange(t){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(t){t!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=t,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(t){this.luminanceRange=t}},Ont=class extends rd{constructor({renderTarget:t,luminanceRange:e,colorOutput:n,resolutionScale:r=1,width:i=qd.AUTO_SIZE,height:s=qd.AUTO_SIZE,resolutionX:o=i,resolutionY:a=s}={}){super("LuminancePass"),this.fullscreenMaterial=new knt(n,e),this.needsSwap=!1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Iu(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new qd(this,o,a,r);c.addEventListener("change",l=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(t,e,n,r,i){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height)}initialize(t,e,n){n!==void 0&&n!==xa&&(this.renderTarget.texture.type=n,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Int=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Nnt="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Pnt=class extends Fa{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new yn(null),texelSize:new yn(new Vn)},blending:Ou,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Int,vertexShader:Nnt})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},Dnt=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,Lnt="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",Unt=class extends Fa{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new yn(null),supportBuffer:new yn(null),texelSize:new yn(new Vn),radius:new yn(.85)},blending:Ou,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Dnt,vertexShader:Lnt})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}set supportBuffer(t){this.uniforms.supportBuffer.value=t}get radius(){return this.uniforms.radius.value}set radius(t){this.uniforms.radius.value=t}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},Bnt=class extends rd{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Iu(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Pnt,this.upsamplingMaterial=new Unt,this.resolution=new Vn}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(t){if(this.levels!==t){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let n=0;n<t;++n){const r=e.clone();r.texture.name="Downsampling.Mipmap"+n,this.downsamplingMipmaps.push(r)}this.upsamplingMipmaps.push(e);for(let n=1,r=t-1;n<r;++n){const i=e.clone();i.texture.name="Upsampling.Mipmap"+n,this.upsamplingMipmaps.push(i)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(t){this.upsamplingMaterial.radius=t}render(t,e,n,r,i){const{scene:s,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:c}=this,{downsamplingMipmaps:l,upsamplingMipmaps:u}=this;let h=e;this.fullscreenMaterial=a;for(let d=0,m=l.length;d<m;++d){const p=l[d];a.setSize(h.width,h.height),a.inputBuffer=h.texture,t.setRenderTarget(p),t.render(s,o),h=p}this.fullscreenMaterial=c;for(let d=u.length-1;d>=0;--d){const m=u[d];c.setSize(h.width,h.height),c.inputBuffer=h.texture,c.supportBuffer=l[d].texture,t.setRenderTarget(m),t.render(s,o),h=m}}setSize(t,e){const n=this.resolution;n.set(t,e);let r=n.width,i=n.height;for(let s=0,o=this.downsamplingMipmaps.length;s<o;++s)r=Math.round(r*.5),i=Math.round(i*.5),this.downsamplingMipmaps[s].setSize(r,i),s<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[s].setSize(r,i)}initialize(t,e,n){if(n!==void 0){const r=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const i of r)i.texture.type=n;if(n!==xa)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(t!==null&&t.outputColorSpace===rs)for(const i of r)i.texture.colorSpace=rs}}dispose(){super.dispose();for(const t of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))t.dispose()}},Fnt=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,max(inputColor.a,texel.a));}`,jnt=class extends Tg{constructor({blendFunction:t=bi.SCREEN,luminanceThreshold:e=1,luminanceSmoothing:n=.03,mipmapBlur:r=!0,intensity:i=1,radius:s=.85,levels:o=8,kernelSize:a=E2.LARGE,resolutionScale:c=.5,width:l=qd.AUTO_SIZE,height:u=qd.AUTO_SIZE,resolutionX:h=l,resolutionY:d=u}={}){super("BloomEffect",Fnt,{blendFunction:t,uniforms:new Map([["map",new yn(null)],["intensity",new yn(i)]])}),this.renderTarget=new Iu(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new mhe({kernelSize:a}),this.luminancePass=new Ont({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=n,this.mipmapBlurPass=new Bnt,this.mipmapBlurPass.enabled=r,this.mipmapBlurPass.radius=s,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=r?this.mipmapBlurPass.texture:this.renderTarget.texture;const m=this.resolution=new qd(this,h,d,c);m.addEventListener("change",p=>this.setSize(m.baseWidth,m.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get dithering(){return this.blurPass.dithering}set dithering(t){this.blurPass.dithering=t}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(t){this.blurPass.kernelSize=t}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(t){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(t){this.uniforms.get("intensity").value=t}getIntensity(){return this.intensity}setIntensity(t){this.intensity=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}update(t,e,n){const r=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(t,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(t,i.renderTarget):this.blurPass.render(t,i.renderTarget,r)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(t,e):this.blurPass.render(t,e,r)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height),this.blurPass.resolution.copy(n),this.luminancePass.setSize(t,e),this.mipmapBlurPass.setSize(t,e)}initialize(t,e,n){this.blurPass.initialize(t,e,n),this.luminancePass.initialize(t,e,n),this.mipmapBlurPass.initialize(t,e,n),n!==void 0&&(this.renderTarget.texture.type=n,t!==null&&t.outputColorSpace===rs&&(this.renderTarget.texture.colorSpace=rs))}},NS={RED:0,GREEN:1,BLUE:2,ALPHA:3},D9={DISCARD:0,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},znt=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,Xk=class extends Fa{constructor(t=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:t?"2":"1"},uniforms:{inputBuffer:new yn(null),cocBuffer:new yn(null),texelSize:new yn(new Vn),kernel64:new yn(null),kernel16:new yn(null),scale:new yn(1)},blending:Ou,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:znt,vertexShader:b2}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set cocBuffer(t){this.uniforms.cocBuffer.value=t}setCoCBuffer(t){this.uniforms.cocBuffer.value=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(t){return this.scale}setScale(t){this.scale=t}generateKernel(){const t=2.39996323,e=new Float64Array(128),n=new Float64Array(32);let r=0,i=0;for(let s=0,o=Math.sqrt(80);s<80;++s){const a=s*t,c=Math.sqrt(s)/o,l=c*Math.cos(a),u=c*Math.sin(a);s%5===0?(n[i++]=l,n[i++]=u):(e[r++]=l,e[r++]=u)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=n}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e)}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}};function rJ(t,e,n){return t*(e-n)-e}function TB(t,e,n){return Math.min(Math.max((t+e)/(e-n),0),1)}var Hnt=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,qnt=class extends Fa{constructor(t){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new yn(null),focusDistance:new yn(0),focusRange:new yn(0),cameraNear:new yn(.3),cameraFar:new yn(1e3)},blending:Ou,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Hnt,vertexShader:b2}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(t)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=iE){this.depthBuffer=t,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(t){this.uniforms.focusDistance.value=t}get worldFocusDistance(){return-rJ(this.focusDistance,this.near,this.far)}set worldFocusDistance(t){this.focusDistance=TB(-t,this.near,this.far)}getFocusDistance(t){this.uniforms.focusDistance.value=t}setFocusDistance(t){this.uniforms.focusDistance.value=t}get focalLength(){return this.focusRange}set focalLength(t){this.focusRange=t}get focusRange(){return this.uniforms.focusRange.value}set focusRange(t){this.uniforms.focusRange.value=t}get worldFocusRange(){return-rJ(this.focusRange,this.near,this.far)}set worldFocusRange(t){this.focusRange=TB(-t,this.near,this.far)}getFocalLength(t){return this.focusRange}setFocalLength(t){this.focusRange=t}adoptCameraSettings(t){this.copyCameraSettings(t)}copyCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof jf?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Vnt=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,Gnt=class extends Fa{constructor(t=null){super({name:"MaskMaterial",uniforms:{maskTexture:new yn(t),inputBuffer:new yn(null),strength:new yn(1)},blending:Ou,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Vnt,vertexShader:b2}),this.colorChannel=NS.RED,this.maskFunction=D9.DISCARD}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set maskTexture(t){this.uniforms.maskTexture.value=t,delete this.defines.MASK_PRECISION_HIGH,t.type!==xa&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(t){this.maskTexture=t}set colorChannel(t){this.defines.COLOR_CHANNEL=t.toFixed(0),this.needsUpdate=!0}setColorChannel(t){this.colorChannel=t}set maskFunction(t){this.defines.MASK_FUNCTION=t.toFixed(0),this.needsUpdate=!0}setMaskFunction(t){this.maskFunction=t}get inverted(){return this.defines.INVERTED!==void 0}set inverted(t){this.inverted&&!t?delete this.defines.INVERTED:t&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(t){this.inverted=t}get strength(){return this.uniforms.strength.value}set strength(t){this.uniforms.strength.value=t}getStrength(){return this.strength}setStrength(t){this.strength=t}},lS=class extends rd{constructor(t,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=t,this.input=e}setInput(t){this.input=t}render(t,e,n,r,i){const s=this.fullscreenMaterial.uniforms;e!==null&&s!==void 0&&s[this.input]!==void 0&&(s[this.input].value=e.texture),t.setRenderTarget(this.renderToScreen?null:n),t.render(this.scene,this.camera)}initialize(t,e,n){n!==void 0&&n!==xa&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},$nt=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,Wnt=class extends Tg{constructor(t,{blendFunction:e,worldFocusDistance:n,worldFocusRange:r,focusDistance:i=0,focalLength:s=.1,focusRange:o=s,bokehScale:a=1,resolutionScale:c=1,width:l=qd.AUTO_SIZE,height:u=qd.AUTO_SIZE,resolutionX:h=l,resolutionY:d=u}={}){super("DepthOfFieldEffect",$nt,{blendFunction:e,attributes:Wh.DEPTH,uniforms:new Map([["nearColorBuffer",new yn(null)],["farColorBuffer",new yn(null)],["nearCoCBuffer",new yn(null)],["farCoCBuffer",new yn(null)],["scale",new yn(1)]])}),this.camera=t,this.renderTarget=new Iu(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new lS(new qnt(t));const m=this.cocMaterial;m.focusDistance=i,m.focusRange=o,n!==void 0&&(m.worldFocusDistance=n),r!==void 0&&(m.worldFocusRange=r),this.blurPass=new mhe({resolutionScale:c,resolutionX:h,resolutionY:d,kernelSize:E2.MEDIUM}),this.maskPass=new lS(new Gnt(this.renderTargetCoC.texture));const p=this.maskPass.fullscreenMaterial;p.colorChannel=NS.GREEN,this.maskFunction=D9.MULTIPLY_RGB,this.bokehNearBasePass=new lS(new Xk(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new lS(new Xk(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new lS(new Xk(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new lS(new Xk(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const g=this.resolution=new qd(this,h,d,c);g.addEventListener("change",y=>this.setSize(g.baseWidth,g.baseHeight)),this.bokehScale=a}set mainCamera(t){this.camera=t,this.cocMaterial.copyCameraSettings(t)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(t){this.maskFunction!==t&&(this.defines.set("MASK_FUNCTION",t.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=t,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(t){this.bokehNearBasePass.fullscreenMaterial.scale=t,this.bokehNearFillPass.fullscreenMaterial.scale=t,this.bokehFarBasePass.fullscreenMaterial.scale=t,this.bokehFarFillPass.fullscreenMaterial.scale=t,this.maskPass.fullscreenMaterial.strength=t,this.uniforms.get("scale").value=t}getBokehScale(){return this.bokehScale}setBokehScale(t){this.bokehScale=t}getTarget(){return this.target}setTarget(t){this.target=t}calculateFocusDistance(t){const e=this.camera,n=e.position.distanceTo(t);return TB(-n,e.near,e.far)}setDepthTexture(t,e=iE){this.cocMaterial.depthBuffer=t,this.cocMaterial.depthPacking=e}update(t,e,n){const r=this.renderTarget,i=this.renderTargetCoC,s=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(t,null,i),this.blurPass.render(t,i,s),this.maskPass.render(t,e,o),this.bokehFarBasePass.render(t,o,r),this.bokehFarFillPass.render(t,r,this.renderTargetFar),this.bokehNearBasePass.render(t,e,r),this.bokehNearFillPass.render(t,r,this.renderTargetNear)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e);const r=n.width,i=n.height;this.cocPass.setSize(t,e),this.blurPass.setSize(t,e),this.maskPass.setSize(t,e),this.renderTargetFar.setSize(t,e),this.renderTargetCoC.setSize(t,e),this.renderTargetMasked.setSize(t,e),this.renderTarget.setSize(r,i),this.renderTargetNear.setSize(r,i),this.renderTargetCoCBlurred.setSize(r,i),this.bokehNearBasePass.fullscreenMaterial.setSize(t,e),this.bokehNearFillPass.fullscreenMaterial.setSize(t,e),this.bokehFarBasePass.fullscreenMaterial.setSize(t,e),this.bokehFarFillPass.fullscreenMaterial.setSize(t,e)}initialize(t,e,n){this.cocPass.initialize(t,e,n),this.maskPass.initialize(t,e,n),this.bokehNearBasePass.initialize(t,e,n),this.bokehNearFillPass.initialize(t,e,n),this.bokehFarBasePass.initialize(t,e,n),this.bokehFarFillPass.initialize(t,e,n),this.blurPass.initialize(t,e,xa),t.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),n!==void 0&&(this.renderTarget.texture.type=n,this.renderTargetNear.texture.type=n,this.renderTargetFar.texture.type=n,this.renderTargetMasked.texture.type=n,t!==null&&t.outputColorSpace===rs&&(this.renderTarget.texture.colorSpace=rs,this.renderTargetNear.texture.colorSpace=rs,this.renderTargetFar.texture.colorSpace=rs,this.renderTargetMasked.texture.colorSpace=rs))}},Iy={DISABLED:0,SPORADIC:1,CONSTANT_MILD:2,CONSTANT_WILD:3};function Knt(t,e,n){const r=new Map([[SM,1],[ZB,2],[Vf,4]]);let i;if(r.has(e)||console.error("Invalid noise texture format"),n===xa){i=new Uint8Array(t*r.get(e));for(let s=0,o=i.length;s<o;++s)i[s]=Math.random()*255+.5}else{i=new Float32Array(t*r.get(e));for(let s=0,o=i.length;s<o;++s)i[s]=Math.random()}return i}var iJ=class extends s3{constructor(t,e,n=SM,r=xa){super(Knt(t*e,n,r),t,e,n,r),this.needsUpdate=!0}},Xnt="uniform lowp sampler2D perturbationMap;uniform bool active;uniform float columns;uniform float random;uniform vec2 seeds;uniform vec2 distortion;void mainUv(inout vec2 uv){if(active){if(uv.y<distortion.x+columns&&uv.y>distortion.x-columns*random){float sx=clamp(ceil(seeds.x),0.0,1.0);uv.y=sx*(1.0-(uv.y+distortion.y))+(1.0-sx)*distortion.y;}if(uv.x<distortion.y+columns&&uv.x>distortion.y-columns*random){float sy=clamp(ceil(seeds.y),0.0,1.0);uv.x=sy*distortion.x+(1.0-sy)*(1.0-(uv.x+distortion.x));}vec2 normal=texture2D(perturbationMap,uv*random*random).rg;uv+=normal*seeds*(random*0.2);}}",Yk="Glitch.Generated";function Rh(t,e){return t+Math.random()*(e-t)}var Ynt=class extends Tg{constructor({chromaticAberrationOffset:t=null,delay:e=new Vn(1.5,3.5),duration:n=new Vn(.6,1),strength:r=new Vn(.3,1),columns:i=.05,ratio:s=.85,perturbationMap:o=null,dtSize:a=64}={}){if(super("GlitchEffect",Xnt,{uniforms:new Map([["perturbationMap",new yn(null)],["columns",new yn(i)],["active",new yn(!1)],["random",new yn(1)],["seeds",new yn(new Vn)],["distortion",new yn(new Vn)]])}),o===null){const c=new iJ(a,a,Vf);c.name=Yk,this.perturbationMap=c}else this.perturbationMap=o;this.time=0,this.distortion=this.uniforms.get("distortion").value,this.delay=e,this.duration=n,this.breakPoint=new Vn(Rh(this.delay.x,this.delay.y),Rh(this.duration.x,this.duration.y)),this.strength=r,this.mode=Iy.SPORADIC,this.ratio=s,this.chromaticAberrationOffset=t}get seeds(){return this.uniforms.get("seeds").value}get active(){return this.uniforms.get("active").value}isActive(){return this.active}get minDelay(){return this.delay.x}set minDelay(t){this.delay.x=t}getMinDelay(){return this.delay.x}setMinDelay(t){this.delay.x=t}get maxDelay(){return this.delay.y}set maxDelay(t){this.delay.y=t}getMaxDelay(){return this.delay.y}setMaxDelay(t){this.delay.y=t}get minDuration(){return this.duration.x}set minDuration(t){this.duration.x=t}getMinDuration(){return this.duration.x}setMinDuration(t){this.duration.x=t}get maxDuration(){return this.duration.y}set maxDuration(t){this.duration.y=t}getMaxDuration(){return this.duration.y}setMaxDuration(t){this.duration.y=t}get minStrength(){return this.strength.x}set minStrength(t){this.strength.x=t}getMinStrength(){return this.strength.x}setMinStrength(t){this.strength.x=t}get maxStrength(){return this.strength.y}set maxStrength(t){this.strength.y=t}getMaxStrength(){return this.strength.y}setMaxStrength(t){this.strength.y=t}getMode(){return this.mode}setMode(t){this.mode=t}getGlitchRatio(){return 1-this.ratio}setGlitchRatio(t){this.ratio=Math.min(Math.max(1-t,0),1)}get columns(){return this.uniforms.get("columns").value}set columns(t){this.uniforms.get("columns").value=t}getGlitchColumns(){return this.columns}setGlitchColumns(t){this.columns=t}getChromaticAberrationOffset(){return this.chromaticAberrationOffset}setChromaticAberrationOffset(t){this.chromaticAberrationOffset=t}get perturbationMap(){return this.uniforms.get("perturbationMap").value}set perturbationMap(t){const e=this.perturbationMap;e!==null&&e.name===Yk&&e.dispose(),t.minFilter=t.magFilter=rf,t.wrapS=t.wrapT=hI,t.generateMipmaps=!1,this.uniforms.get("perturbationMap").value=t}getPerturbationMap(){return this.perturbationMap}setPerturbationMap(t){this.perturbationMap=t}generatePerturbationMap(t=64){const e=new iJ(t,t,Vf);return e.name=Yk,e}update(t,e,n){const r=this.mode,i=this.breakPoint,s=this.chromaticAberrationOffset,o=this.strength;let a=this.time,c=!1,l=0,u=0,h;r!==Iy.DISABLED&&(r===Iy.SPORADIC&&(a+=n,h=a>i.x,a>=i.x+i.y&&(i.set(Rh(this.delay.x,this.delay.y),Rh(this.duration.x,this.duration.y)),a=0)),l=Math.random(),this.uniforms.get("random").value=l,h&&l>this.ratio||r===Iy.CONSTANT_WILD?(c=!0,l*=o.y*.03,u=Rh(-Math.PI,Math.PI),this.seeds.set(Rh(-o.y,o.y),Rh(-o.y,o.y)),this.distortion.set(Rh(0,1),Rh(0,1))):(h||r===Iy.CONSTANT_MILD)&&(c=!0,l*=o.x*.03,u=Rh(-Math.PI,Math.PI),this.seeds.set(Rh(-o.x,o.x),Rh(-o.x,o.x)),this.distortion.set(Rh(0,1),Rh(0,1))),this.time=a),s!==null&&(c?s.set(Math.cos(u),Math.sin(u)).multiplyScalar(l):s.set(0,0)),this.uniforms.get("active").value=c}dispose(){const t=this.perturbationMap;t!==null&&t.name===Yk&&t.dispose()}},ghe=class extends rd{constructor(t,e,n=null){super("RenderPass",t,e),this.needsSwap=!1,this.clearPass=new dhe,this.overrideMaterialManager=n===null?null:new nJ(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get renderToScreen(){return super.renderToScreen}set renderToScreen(t){super.renderToScreen=t,this.clearPass.renderToScreen=t}get overrideMaterial(){const t=this.overrideMaterialManager;return t!==null?t.material:null}set overrideMaterial(t){const e=this.overrideMaterialManager;t!==null?e!==null?e.setMaterial(t):this.overrideMaterialManager=new nJ(t):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(t){this.overrideMaterial=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getSelection(){return this.selection}setSelection(t){this.selection=t}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(t){this.skipShadowMapUpdate=t}getClearPass(){return this.clearPass}render(t,e,n,r,i){const s=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=s.background,u=t.shadowMap.autoUpdate,h=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(t.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(t,e),t.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(t,s,o):t.render(s,o),o.layers.mask=c,s.background=l,t.shadowMap.autoUpdate=u}},yS={DEFAULT:0,ESKIL:1},Znt=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*(1.0+time)));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,Jnt=class extends Tg{constructor({blendFunction:t=bi.SCREEN,premultiply:e=!1}={}){super("NoiseEffect",Znt,{blendFunction:t}),this.premultiply=e}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(t){this.premultiply!==t&&(t?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(t){this.premultiply=t}},Qnt=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,ert=class extends Tg{constructor({blendFunction:t,eskil:e=!1,technique:n=e?yS.ESKIL:yS.DEFAULT,offset:r=.5,darkness:i=.5}={}){super("VignetteEffect",Qnt,{blendFunction:t,defines:new Map([["VIGNETTE_TECHNIQUE",n.toFixed(0)]]),uniforms:new Map([["offset",new yn(r)],["darkness",new yn(i)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(t){this.technique!==t&&(this.defines.set("VIGNETTE_TECHNIQUE",t.toFixed(0)),this.setChanged())}get eskil(){return this.technique===yS.ESKIL}set eskil(t){this.technique=t?yS.ESKIL:yS.DEFAULT}getTechnique(){return this.technique}setTechnique(t){this.technique=t}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}get darkness(){return this.uniforms.get("darkness").value}set darkness(t){this.uniforms.get("darkness").value=t}getDarkness(){return this.darkness}setDarkness(t){this.darkness=t}},trt=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,nrt="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",rrt=class extends Fa{constructor(t,e,n,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:EM.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new yn(null),depthBuffer:new yn(null),resolution:new yn(new Vn),texelSize:new yn(new Vn),cameraNear:new yn(.3),cameraFar:new yn(1e3),aspect:new yn(1),time:new yn(0)},blending:Ou,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),t&&this.setShaderParts(t),e&&this.setDefines(e),n&&this.setUniforms(n),this.copyCameraSettings(r)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=iE){this.depthBuffer=t,this.depthPacking=e}setShaderData(t){this.setShaderParts(t.shaderParts),this.setDefines(t.defines),this.setUniforms(t.uniforms),this.setExtensions(t.extensions)}setShaderParts(t){return this.fragmentShader=trt.replace(Os.FRAGMENT_HEAD,t.get(Os.FRAGMENT_HEAD)||"").replace(Os.FRAGMENT_MAIN_UV,t.get(Os.FRAGMENT_MAIN_UV)||"").replace(Os.FRAGMENT_MAIN_IMAGE,t.get(Os.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=nrt.replace(Os.VERTEX_HEAD,t.get(Os.VERTEX_HEAD)||"").replace(Os.VERTEX_MAIN_SUPPORT,t.get(Os.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(t){for(const e of t.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(t){for(const e of t.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(t){this.extensions={};for(const e of t)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(t){this.encodeOutput!==t&&(t?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(t){return this.encodeOutput}setOutputEncodingEnabled(t){this.encodeOutput=t}get time(){return this.uniforms.time.value}set time(t){this.uniforms.time.value=t}setDeltaTime(t){this.uniforms.time.value+=t}adoptCameraSettings(t){this.copyCameraSettings(t)}copyCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof jf?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(t,e){const n=this.uniforms;n.resolution.value.set(t,e),n.texelSize.value.set(1/t,1/e),n.aspect.value=t/e}static get Section(){return Os}};function sJ(t,e,n){for(const r of e){const i="$1"+t+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const o of n.entries())o[1]!==null&&n.set(o[0],o[1].replace(s,i))}}function irt(t,e,n){let r=e.getFragmentShader(),i=e.getVertexShader();const s=r!==void 0&&/mainImage/.test(r),o=r!==void 0&&/mainUv/.test(r);if(n.attributes|=e.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&(n.attributes&Wh.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=n.shaderParts;let l=c.get(Os.FRAGMENT_HEAD)||"",u=c.get(Os.FRAGMENT_MAIN_UV)||"",h=c.get(Os.FRAGMENT_MAIN_IMAGE)||"",d=c.get(Os.VERTEX_HEAD)||"",m=c.get(Os.VERTEX_MAIN_SUPPORT)||"";const p=new Set,g=new Set;if(o&&(u+=`	${t}MainUv(UV);
`,n.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const x=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);m+=`	${t}MainSupport(`,m+=x?`vUv);
`:`);
`;for(const E of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const C of E[1].split(/\s*,\s*/))n.varyings.add(C),p.add(C),g.add(C);for(const E of i.matchAll(a))g.add(E[1])}for(const x of r.matchAll(a))g.add(x[1]);for(const x of e.defines.keys())g.add(x.replace(/\([\w\s,]*\)/g,""));for(const x of e.uniforms.keys())g.add(x);g.delete("while"),g.delete("for"),g.delete("if"),e.uniforms.forEach((x,E)=>n.uniforms.set(t+E.charAt(0).toUpperCase()+E.slice(1),x)),e.defines.forEach((x,E)=>n.defines.set(t+E.charAt(0).toUpperCase()+E.slice(1),x));const y=new Map([["fragment",r],["vertex",i]]);sJ(t,g,n.defines),sJ(t,g,y),r=y.get("fragment"),i=y.get("vertex");const v=e.blendMode;if(n.blendModes.set(v.blendFunction,v),s){e.inputColorSpace!==null&&e.inputColorSpace!==n.colorSpace&&(h+=e.inputColorSpace===rs?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==b0?n.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(n.colorSpace=e.inputColorSpace);const x=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${t}MainImage(color0, UV, `,(n.attributes&Wh.DEPTH)!==0&&x.test(r)&&(h+="depth, ",n.readDepth=!0),h+=`color1);
	`;const E=t+"BlendOpacity";n.uniforms.set(E,v.opacity),h+=`color0 = blend${v.blendFunction}(color0, color1, ${E});

	`,l+=`uniform float ${E};

`}if(l+=r+`
`,i!==null&&(d+=i+`
`),c.set(Os.FRAGMENT_HEAD,l),c.set(Os.FRAGMENT_MAIN_UV,u),c.set(Os.FRAGMENT_MAIN_IMAGE,h),c.set(Os.VERTEX_HEAD,d),c.set(Os.VERTEX_MAIN_SUPPORT,m),e.extensions!==null)for(const x of e.extensions)n.extensions.add(x)}}var _he=class extends rd{constructor(t,...e){super("EffectPass"),this.fullscreenMaterial=new rrt(null,null,null,t),this.listener=n=>this.handleEvent(n),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(t){for(const e of this.effects)e.mainScene=t}set mainCamera(t){this.fullscreenMaterial.copyCameraSettings(t);for(const e of this.effects)e.mainCamera=t}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(t){this.fullscreenMaterial.encodeOutput=t}get dithering(){return this.fullscreenMaterial.dithering}set dithering(t){const e=this.fullscreenMaterial;e.dithering=t,e.needsUpdate=!0}setEffects(t){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=t.sort((e,n)=>n.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const t=new qtt;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===bi.DST)t.attributes|=o.getAttributes()&Wh.DEPTH;else{if((t.attributes&o.getAttributes()&Wh.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${o.name})`);irt("e"+e++,o,t)}let n=t.shaderParts.get(Os.FRAGMENT_HEAD),r=t.shaderParts.get(Os.FRAGMENT_MAIN_IMAGE),i=t.shaderParts.get(Os.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const o of t.blendModes.values())n+=o.getShaderCode().replace(s,`blend${o.blendFunction}`)+`
`;(t.attributes&Wh.DEPTH)!==0?(t.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,t.colorSpace===rs&&(r+=`color0 = sRGBToLinear(color0);
	`),t.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,t.defines.set("UV","transformedUv")):t.defines.set("UV","vUv"),t.shaderParts.set(Os.FRAGMENT_HEAD,n),t.shaderParts.set(Os.FRAGMENT_MAIN_IMAGE,r),t.shaderParts.set(Os.FRAGMENT_MAIN_UV,i);for(const[o,a]of t.shaderParts)a!==null&&t.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(t)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(t,e=iE){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e;for(const n of this.effects)n.setDepthTexture(t,e)}render(t,e,n,r,i){for(const s of this.effects)s.update(t,e,r);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=r*this.timeScale,t.setRenderTarget(this.renderToScreen?null:n),t.render(this.scene,this.camera)}}setSize(t,e){this.fullscreenMaterial.setSize(t,e);for(const n of this.effects)n.setSize(t,e)}initialize(t,e,n){this.renderer=t;for(const r of this.effects)r.initialize(t,e,n);this.updateMaterial(),n!==void 0&&n!==xa&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const t of this.effects)t.removeEventListener("change",this.listener),t.dispose()}handleEvent(t){switch(t.type){case"change":this.recompile();break}}};function hA(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}new Vn;new Vn;function vhe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Bp=function t(e,n,r){var i=this;vhe(this,t),hA(this,"dot2",function(s,o){return i.x*s+i.y*o}),hA(this,"dot3",function(s,o,a){return i.x*s+i.y*o+i.z*a}),this.x=e,this.y=n,this.z=r},srt=[new Bp(1,1,0),new Bp(-1,1,0),new Bp(1,-1,0),new Bp(-1,-1,0),new Bp(1,0,1),new Bp(-1,0,1),new Bp(1,0,-1),new Bp(-1,0,-1),new Bp(0,1,1),new Bp(0,-1,1),new Bp(0,1,-1),new Bp(0,-1,-1)],oJ=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],aJ=new Array(512),cJ=new Array(512),ort=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var n=0;n<256;n++){var r;n&1?r=oJ[n]^e&255:r=oJ[n]^e>>8&255,aJ[n]=aJ[n+256]=r,cJ[n]=cJ[n+256]=srt[r%12]}};ort(0);function art(t){if(typeof t=="number")t=Math.abs(t);else if(typeof t=="string"){var e=t;t=0;for(var n=0;n<e.length;n++)t=(t+(n+1)*(e.charCodeAt(n)%96))%2147483647}return t===0&&(t=311),t}function lJ(t){var e=art(t);return function(){var n=e*48271%2147483647;return e=n,n/2147483647}}var crt=function t(e){var n=this;vhe(this,t),hA(this,"seed",0),hA(this,"init",function(r){n.seed=r,n.value=lJ(r)}),hA(this,"value",lJ(this.seed)),this.init(e)};new crt(Math.random());const L9=et.createContext(null);let lrt=0;const uJ=new WeakMap,S2=(t,e)=>function({blendFunction:n=e?.blendFunction,opacity:r=e?.opacity,...i}){let s=uJ.get(t);if(!s){const c=`@react-three/postprocessing/${t.name}-${lrt++}`;f8({[c]:t}),uJ.set(t,s=c)}const o=Hh(c=>c.camera),a=zd.useMemo(()=>[...e?.args??[],...i.args??[{...e,...i}]],[JSON.stringify(i)]);return ke.jsx(s,{camera:o,"blendMode-blendFunction":n,"blendMode-opacity-value":r,...i,args:a})},Zk=(t,e)=>{const n=t[e];return zd.useMemo(()=>typeof n=="number"?new Vn(n,n):n?new Vn(...n):new Vn,[n])},U9=et.forwardRef(function({blendFunction:t,worldFocusDistance:e,worldFocusRange:n,focusDistance:r,focusRange:i,focalLength:s,bokehScale:o,resolutionScale:a,resolutionX:c,resolutionY:l,width:u,height:h,target:d,depthTexture:m,...p},g){const{camera:y}=et.useContext(L9),v=d!=null,x=et.useMemo(()=>{const E=new Wnt(y,{blendFunction:t,worldFocusDistance:e,worldFocusRange:n,focusDistance:r,focusRange:i,focalLength:s,bokehScale:o,resolutionScale:a,resolutionX:c,resolutionY:l,width:u,height:h});v&&(E.target=new jt),m&&E.setDepthTexture(m.texture,m.packing);const C=E.maskPass;return C.maskFunction=D9.MULTIPLY_RGB_SET_ALPHA,E},[y,t,e,n,r,i,s,o,a,c,l,u,h,v,m]);return et.useEffect(()=>()=>{x.dispose()},[x]),ke.jsx("primitive",{...p,ref:g,object:x,target:d})}),urt=S2(jnt,{blendFunction:0}),frt=et.forwardRef(function({active:t=!0,...e},n){const r=Hh(l=>l.invalidate),i=Zk(e,"delay"),s=Zk(e,"duration"),o=Zk(e,"strength"),a=Zk(e,"chromaticAberrationOffset"),c=et.useMemo(()=>new Ynt({...e,delay:i,duration:s,strength:o,chromaticAberrationOffset:a}),[i,s,e,o,a]);return et.useLayoutEffect(()=>{c.mode=t?e.mode||Iy.SPORADIC:Iy.DISABLED,r()},[t,c,r,e.mode]),et.useEffect(()=>()=>{c.dispose?.()},[c]),ke.jsx("primitive",{ref:n,object:c,dispose:null})}),hrt=S2(Jnt,{blendFunction:5}),drt=S2(ert);var um=typeof window<"u"?window:{screen:{},navigator:{}},Bx=(um.matchMedia||(function(){return{matches:!1}})).bind(um),prt={get passive(){return!0}},yhe=function(){};um.addEventListener&&um.addEventListener("p",yhe,prt);um.removeEventListener&&um.removeEventListener("p",yhe,!1);var B9="ontouchstart"in um,mrt="TouchEvent"in um,grt=B9||mrt&&Bx("(any-pointer: coarse)").matches,fJ=(um.navigator.maxTouchPoints||0)>0||grt,bhe=um.navigator.userAgent||"",_rt=Bx("(pointer: coarse)").matches&&/iPad|Macintosh/.test(bhe)&&Math.min(um.screen.width||0,um.screen.height||0)>=768,Ehe=(Bx("(pointer: coarse)").matches||!Bx("(pointer: fine)").matches&&B9)&&!/Windows.*Firefox/.test(bhe),vrt=Bx("(any-pointer: fine)").matches||Bx("(any-hover: hover)").matches||_rt||!B9,wB=fJ&&(vrt||!Ehe)?"hybrid":fJ?"touchOnly":"mouseOnly",yrt=wB==="mouseOnly"?"mouse":wB==="touchOnly"||Ehe?"touch":"mouse";const brt=`  
vec3 halftone(vec3 texcolor, vec2 st, float frequency) {
  float n = 0.1 * snoise(st * 200.0); // Fractal noise
  n += 0.05 * snoise(st * 400.0);
  n += 0.025 * snoise(st * 800.0);

  // Perform a rough RGB-to-CMYK conversion
  vec4 cmyk;
  // CMY = 1-RGB
  cmyk.xyz = 1.0 - texcolor;
  // Black generation: K = min(C,M,Y)
  cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); 
  // Grey component replacement: subtract K from CMY
  cmyk.xyz -= cmyk.w; 

  // K based modifier
  float flex = pow(cmyk.w, 3.11);

  // Distance to nearest point in a grid of
  // (frequency x frequency) points over the unit square
  
  float t = 0.1 + 0.1 * n + 0.11 * flex + 0.1 * cmyk.y;

  // K component: 45 degrees screen angle
  vec2 Kst = frequency * mat2(0.707, -0.707, 0.707, 0.707) * st;
  vec2 Kuv = 2.0 * fract(Kst) - 1.0; 
  float k = aastep(0.0, sqrt(cmyk.w) + t - length(Kuv) + n);
  
  // C component: 15 degrees screen angle
  vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966) * st;
  vec2 Cuv = 2.0 * fract(Cst) - 1.0;
  float c = aastep(0.0, sqrt(cmyk.x) + t - length(Cuv) + n);
  
  // M component: -15 degrees screen angle
  vec2 Mst = frequency * mat2(0.966, 0.259, -0.259, 0.966) * st;
  vec2 Muv = 2.0 * fract(Mst) - 1.0;
  float m = aastep(0.0, sqrt(cmyk.y) + t - length(Muv) + n);

  // Y component: 0 degrees screen angle
  vec2 Yst = frequency * st; // 0 deg 
  vec2 Yuv = 2.0 * fract(Yst) - 1.0;
  float y = aastep(0.0, sqrt(cmyk.z) + t - length(Yuv) + n);

  // CMY screen in RGB
  vec3 black = vec3(n + 0.01);
  vec3 rgbscreen = 1.0 - vec3(c,m,y) + n;
  
  // Blend in K for final color
  vec3 factor = mix(rgbscreen, black, 1.1 * k + 0.3 * n);

  // Blend with og color
  return mix(factor, texcolor, 0.777);
}

vec3 halftone(vec3 texcolor, vec2 st) {
  return halftone(texcolor, st, 412.321);
}
`,Ert=`
float blendLighten(float base, float blend) {
	return max(blend,base);
}

vec3 blendLighten(vec3 base, vec3 blend) {
	return vec3(blendLighten(base.r,blend.r),blendLighten(base.g,blend.g),blendLighten(base.b,blend.b));
}

vec3 blendLighten(vec3 base, vec3 blend, float opacity) {
	return (blendLighten(base, blend) * opacity + base * (1.0 - opacity));
}

float blendDarken(float base, float blend) {
	return min(blend,base);
}

vec3 blendDarken(vec3 base, vec3 blend) {
	return vec3(blendDarken(base.r,blend.r),blendDarken(base.g,blend.g),blendDarken(base.b,blend.b));
}

vec3 blendDarken(vec3 base, vec3 blend, float opacity) {
	return (blendDarken(base, blend) * opacity + base * (1.0 - opacity));
}
`,Srt=`
float aastep(float threshold, float value) {
  float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;
  return smoothstep(threshold-afwidth, threshold+afwidth, value);
}
`,x2=`
//
// Description : Array and textureless GLSL 2D simplex noise function.
//      Author : Ian McEwan, Ashima Arts.
//  Maintainer : ijm
//     Lastmod : 20110822 (ijm)
//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
//               Distributed under the MIT License. See LICENSE file.
//               https://github.com/ashima/webgl-noise
//

vec3 mod289(vec3 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec2 mod289(vec2 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec3 permute(vec3 x) {
  return mod289(((x*34.0)+1.0)*x);
}

float snoise(vec2 v) {
  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0
                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)
                     -0.577350269189626,  // -1.0 + 2.0 * C.x
                      0.024390243902439); // 1.0 / 41.0
// First corner
  vec2 i  = floor(v + dot(v, C.yy) );
  vec2 x0 = v -   i + dot(i, C.xx);

// Other corners
  vec2 i1;
  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0
  //i1.y = 1.0 - i1.x;
  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
  // x0 = x0 - 0.0 + 0.0 * C.xx ;
  // x1 = x0 - i1 + 1.0 * C.xx ;
  // x2 = x0 - 1.0 + 2.0 * C.xx ;
  vec4 x12 = x0.xyxy + C.xxzz;
  x12.xy -= i1;

// Permutations
  i = mod289(i); // Avoid truncation effects in permutation
  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
    + i.x + vec3(0.0, i1.x, 1.0 ));

  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
  m = m*m ;
  m = m*m ;

// Gradients: 41 points uniformly over a line, mapped onto a diamond.
// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;

// Normalise gradients implicitly by scaling m
// Approximation of: m *= inversesqrt( a0*a0 + h*h );
  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );

// Compute final noise value at P
  vec3 g;
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
  return 130.0 * dot(m, g);
}
`,xrt=`
#ifdef ASPECT_CORRECTION
	uniform float scale;
#else
	uniform mat3 uvTransform;
#endif

varying vec2 vUv2;

void mainSupport(const in vec2 uv) {
	#ifdef ASPECT_CORRECTION
		vUv2 = uv * vec2(aspect, 1.0) * scale;
	#else
		vUv2 = (uvTransform * vec3(uv, 1.0)).xy;
	#endif
}
`,Trt=`
uniform float viewheight;
uniform sampler2D splat;

${Ert}
${Srt}
${x2}
${brt}

float rectdistance(vec2 uv) {
  vec2 tl = vec2(-1.0);
  vec2 br = vec2(1.0);
  vec2 d = max(tl - uv, uv - br);
  return abs(length(max(vec2(0.0), d)) + min(0.0, max(d.x, d.y)));
}

vec2 bendy(const in vec2 xn, float dn, float sn) {
  // config
  float distortion = 0.0173 + dn; // 0.0173, 0.511
  float scale = 0.991 + sn; // 1.0, 0.7
  // calc
  vec3 xDistorted = vec3((1.0 + vec2(distortion, distortion) * dot(xn, xn)) * xn, 1.0);
  mat3 kk = mat3(
    vec3(1.0, 0.0, 0.0),
    vec3(0.0, 1.0, 0.0),
    vec3(0.0, 0.0, 1.0)
  );
  return (kk * xDistorted).xy * scale;
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
	#ifdef UV_TRANSFORM
		vec4 bright = texture2D(splat, vUv2);
		vec4 dark = texture2D(splat, 1.0 - vUv2);
	#else
		vec4 bright = texture2D(splat, uv);
		vec4 dark = texture2D(splat, 1.0 - uv);
	#endif
  
  float n = 0.1 * snoise(uv.st * 200.0); // Fractal noise
  n += 0.05 * snoise(uv.st * 400.0);
  n += 0.025 * snoise(uv.st * 800.0);

  vec2 xn = 2.0 * (uv.st - 0.5);
  float fz = 0.005;
  vec2 edge = bendy(xn, fz * n, -fz * n);
  vec2 bent = edge.xy * 0.5 + 0.5;

  float edgetime = time * 0.3;
  float edgetime2 = time * 2.0;
  vec2 edgewiggle = vec2(cos(edgetime) * 0.1, sin(edgetime) * 0.096);
  vec2 edgewiggle2 = vec2(cos(edgetime2) * 0.005, sin(edgetime2) * 0.005);
  vec2 edgeshine = vec2(edge.x * 5.0 + 3.5, edge.y - 0.3) + edgewiggle + edgewiggle2;
  vec2 edgeshine2 = vec2(edge.x, edge.y * 2.0 - 0.5) + edgewiggle + edgewiggle2;
  vec2 edgeshine3 = vec2(edge.x * 3.0 - 2.1, edge.y + 0.3) + edgewiggle + edgewiggle2;
  
  float dx = rectdistance(xn);
  float bx = rectdistance(edge);
  float ex = rectdistance(edgeshine);
  float ex2 = rectdistance(edgeshine2);
  float ex3 = rectdistance(edgeshine3);

  // apply shape
  float doot = max(abs(edge.x), abs(edge.y));
  if (doot < 1.0) {
    // display
    outputColor = texture2D(inputBuffer, bent);

    // apply scratches
    outputColor.rgb = blendLighten(outputColor.rgb, bright.rgb, 0.079);
    outputColor.rgb = blendDarken(outputColor.rgb, dark.rgb, 0.0666);

    // apply halftones
    outputColor.rgb = halftone(outputColor.rgb, uv.st);
  
  } else if (doot > 1.004) {
    // display shell
    // rbgb 205 205 193
    vec3 matte = vec3(205.0 / 255.0, 205.0 / 255.0, 193.0 / 255.0);
    vec3 dkmatte = mix(matte, vec3(0.0), 0.5);
    float mx = pow(1.0 - bx, 16.0) + n;
    outputColor = vec4(mix(matte, dkmatte, mx), inputColor.a);

  } else {
    // border
    outputColor = vec4(mix(vec3(0.0), outputColor.rgb, 0.5), inputColor.a);
  }

  // apply reflection shine
  if (doot < 0.98) {
    float vvv = 0.34;
    if (edge.x > -0.9 && edge.x < -0.5 && edge.y > -0.5) {
      float sh = clamp(0.0, vvv, ex + n * 0.333);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(bx * 3.0)) * (6.0 + sin(edgetime));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
    if (edge.y > -0.3 && edge.y < 0.7) {
      float sh = clamp(0.0, vvv, ex2 + n * 0.15);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(dx * 3.0)) * (4.0 + cos(edgetime * 1.5));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
    if (edge.x > 0.4 && edge.y < 0.8) {
      float sh = clamp(0.0, vvv, ex3 + n * 0.25);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(bx * 2.0)) * (3.0 + sin(-edgetime));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
  }

  // apply inner shade
  if (doot >= 0.5 && doot < 1.0) {
    float sh = clamp(0.0, 1.0, 1.0 - bx - 0.7);
    vec3 shade = mix(outputColor.rgb, vec3(0.0), pow(sh, 4.0));
    outputColor = vec4(shade, inputColor.a);
  }

  // apply outer shade
  if (doot >= 0.97) {
    float sh = clamp(0.0, 1.0, bx * 24.0);
    vec3 dkout = mix(vec3(0.0), outputColor.rgb, 0.81);
    vec3 shade = mix(dkout, outputColor.rgb, sh);
    outputColor = vec4(shade, inputColor.a);
  }
}
`;class wrt extends Tg{constructor({splat:e,viewheight:n}={}){super("CRTShapeEffect",Trt,{blendFunction:bi.NORMAL,attributes:Wh.CONVOLUTION,defines:new Map([["TEXEL","texel"],["TEXTURE_PRECISION_HIGH","1"]]),uniforms:new Map([["splat",new yn(e)],["viewheight",new yn(n??128)]])})}get splat(){return this.uniforms.get("splat")?.value}set splat(e){const{splat:n,uniforms:r,defines:i}=this,s=r.get("splat"),o=r.get("uvTransform");n!==e&&s&&o&&(s.value=e,o.value=e.matrix,i.delete("TEXTURE_PRECISION_HIGH"),e!==null&&(e.matrixAutoUpdate?(i.set("UV_TRANSFORM","1"),this.setVertexShader(xrt)):(i.delete("UV_TRANSFORM"),this.setVertexShader(null)),e.type!==xa&&i.set("TEXTURE_PRECISION_HIGH","1"),(n===null||n?.type!==e.type)&&this.setChanged()))}getTexture(){return this.splat}setTexture(e){this.splat=e}get aspectCorrection(){return this.defines.has("ASPECT_CORRECTION")}set aspectCorrection(e){this.aspectCorrection!==e&&(e?this.defines.set("ASPECT_CORRECTION","1"):this.defines.delete("ASPECT_CORRECTION"),this.setChanged())}get uvTransform(){return!!this.splat?.matrixAutoUpdate}set uvTransform(e){const n=this.splat;ge(n)&&(n.matrixAutoUpdate=e)}setTextureSwizzleRGBA(e,n=e,r=e,i=e){const s="rgba";let o="";(e!==NS.RED||n!==NS.GREEN||r!==NS.BLUE||i!==NS.ALPHA)&&(o=[".",s[e],s[n],s[r],s[i]].join("")),this.defines.set("TEXEL","texel"+o),this.setChanged()}update(){this.splat?.matrixAutoUpdate&&this.splat.updateMatrix()}}const Rrt=S2(wrt);function F9(t){const e=new Set;function n(s){cSe(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),xA.invoke(s))}const r=lb("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){xA.disconnect(r)}return{forward:n,disconnect:i}}function Crt(t){switch(t.target){case"tick":case"tock":case"ready":return!0}return!1}function Art(t){switch(t.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"chat":case"toast":case"second":return!0;default:{const e=P1(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}function Mrt(t){switch(t.target){case"tick":case"tock":case"second":return!0}return!1}function She(t){const e=P1(t.target);switch(e.target){case"vm":case"modem":case"gadgetserver":return!0}switch(e.path){case"sync":case"desync":case"joinack":return!0}return!1}function krt(t){return new Worker("/assets/simspace-BqzMW3r2.js",{name:t?.name})}function Ort(t){return new Worker("/assets/stubspace-MWP3_jzt.js",{name:t?.name})}let X_,RB;function Irt(t=!1){if(ge(X_))return;lSe(ut),X_=t?new Ort:new krt;const{forward:e,disconnect:n}=F9(i=>{ge(X_)&&She(i)&&X_.postMessage(i)});function r(i){return e(i.data)}X_.addEventListener("message",r),RB=()=>{n(),ge(X_)&&(X_.removeEventListener("message",r),X_.terminate()),X_=void 0}}function Nrt(){RB?.(),RB=void 0}function xhe(t,e,n,r){const i=e*n*4;for(let s=0,o=0;s<i;++o)t.image.data[s]=r[o]*255,s+=4;return t.needsUpdate=!0,t}function The(t,e){const n=new Uint8Array(4*t*e);return new s3(n,t,e)}const Prt=new Fa({transparent:!1,side:Zl,uniforms:{color:{value:new Xi(0,0,0)},data:{value:null}},vertexShader:`
      varying vec2 vUv;
    
      void main() {
        vec4 mvPosition = vec4(position, 1.0);
        #ifdef USE_INSTANCING
        	mvPosition = instanceMatrix * mvPosition;
        #endif        
        mvPosition = modelViewMatrix * mvPosition;
        gl_Position = projectionMatrix * mvPosition;
        
        vUv = uv;
      }
    `,fragmentShader:`
      uniform vec3 color;
      uniform sampler2D data;
  
      varying vec2 vUv;

      // adapted from https://www.shadertoy.com/view/Mlt3z8
      float bayerDither2x2( vec2 v ) {
        return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
      }

      float bayerDither4x4( vec2 v ) {
        vec2 P1 = mod( v, 2.0 );
        vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
        return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
      }

      void main() {
        float alpha = texture2D(data, vUv).r;
        if (alpha < 1.0) {
          vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
          if ( bayerDither4x4( ditherCoord ) / 16.0 >= alpha ) {
            discard;
          }
        }

        gl_FragColor.rgba = vec4(color.xyz, 1.0);
      }
    `});function whe(){return v2(Prt)}const Ff=[0,1,0],x0=[1,1,0],Ld=[1,0,0],T0=[0,0,0],Drt=new Float32Array([...Ff,...Ld,...x0,...Ff,...T0,...Ld]),Rhe=new Float32Array([...Ff.slice(0,2),...Ld.slice(0,2),...x0.slice(0,2),...Ff.slice(0,2),...T0.slice(0,2),...Ld.slice(0,2)]);function Lrt(t,e,n,r,i,s){const o=e*n*4;for(let a=0,c=0;a<o;++c){const l=r[c]??0;t.image.data[a++]=l%Jp,t.image.data[a++]=Math.floor(l/Jp),t.image.data[a++]=i[c]??16,t.image.data[a++]=s[c]??16}return t.needsUpdate=!0,t}function Urt(t,e){const n=new Uint8Array(4*t*e),r=new s3(n,t,e,i3,xa);return r.internalFormat="RGBA8UI",r}function j9(t,e){const n=t*En.DRAW_CHAR_WIDTH(),r=e*En.DRAW_CHAR_HEIGHT();return{position:Drt.map((s,o)=>{switch(o%3){case 0:return s*n;case 1:return s*r;default:return s}}),uv:Rhe}}const hJ=[0,1,1],pU=[1,1,1],Jk=[1,0,1],mU=[0,0,1],Brt=new Float32Array([...Ff,...pU,...x0,...Ff,...hJ,...pU,...T0,...Jk,...Ld,...T0,...mU,...Jk,...x0,...Jk,...Ld,...x0,...pU,...Jk,...Ff,...mU,...T0,...Ff,...hJ,...mU]),Frt=new Float32Array([...Ff.slice(0,2),...Ld.slice(0,2),...x0.slice(0,2),...Ff.slice(0,2),...T0.slice(0,2),...Ld.slice(0,2),...Ff.slice(0,2),...Ld.slice(0,2),...x0.slice(0,2),...Ff.slice(0,2),...T0.slice(0,2),...Ld.slice(0,2),...x0.slice(0,2),...T0.slice(0,2),...Ff.slice(0,2),...x0.slice(0,2),...Ld.slice(0,2),...T0.slice(0,2),...Ff.slice(0,2),...Ld.slice(0,2),...x0.slice(0,2),...Ff.slice(0,2),...T0.slice(0,2),...Ld.slice(0,2)]);function jrt(t,e){const n=t*En.DRAW_CHAR_WIDTH(),r=e*En.DRAW_CHAR_HEIGHT();return{position:Brt.map((s,o)=>{switch(o%3){case 0:return s*n;case 1:return s*r;default:return s*r}}),uv:Frt}}const dJ=[0,0,0],zrt=[1,0,0],pJ=[1,0,1],Hrt=[0,0,1],qrt=new Float32Array([...dJ,...pJ,...zrt,...dJ,...Hrt,...pJ]);function Vrt(t,e){const n=t*En.DRAW_CHAR_WIDTH(),r=e*En.DRAW_CHAR_HEIGHT();return{position:qrt.map((s,o)=>{switch(o%3){case 0:return s*n;case 1:return s*r;default:return s*r}}),uv:Rhe}}const Grt=fx(lE(Yx)),mJ=g0(uE(Xx)),$rt=new Fa({transparent:!1,side:Zl,uniforms:{time:Pd,interval:_2,palette:new yn(Grt),map:new yn(mJ),alt:new yn(mJ),data:new yn(null),size:new yn(new Vn),step:new yn(new Vn),flip:new yn(!0)},vertexShader:`
    varying vec2 vUv;
    void main() {
      vec4 mvPosition = vec4(position, 1.0);
      #ifdef USE_INSTANCING
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
      vUv = uv;
    }
  `,fragmentShader:`
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform usampler2D data;
    uniform vec3 palette[16];
    uniform vec2 size;
    uniform vec2 step;
    uniform bool flip;
    varying vec2 vUv;

    ${x2}

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vUv * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      uvec4 tiledata = texture(data, vUv);
      int colori = int(tiledata.z);
      int bgi = int(tiledata.w);

      vec2 charPosition = mod(vUv, size) / size;
      vec2 uv = vec2(charPosition.x * step.x, charPosition.y * step.y);
      
      vec3 color;
      if (colori > 31) {
        vec3 bg = palette[bgi];
        color = palette[colori - 33];
        float cycle = mod(time * 2.5, interval * 2.0) / interval;
        color = mix(bg, color, cyclefromtime());
      } else {
        color = palette[colori % 16];
      }

      uv.x += step.x * float(tiledata.x);
      uv.y += step.y * float(tiledata.y);
      if (flip) {
        uv.y = 1.0 - uv.y;
      }

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${en.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function Wrt(){return v2($rt)}function xv({width:t,height:e,alphas:n}){const[r]=et.useState(()=>whe());et.useEffect(()=>{r.uniforms.data.value=The(t,e)},[r.uniforms.data,t,e]),et.useEffect(()=>{xhe(r.uniforms.data.value,t,e,n)},[r,r.uniforms.data.value,t,e,n]);const{position:i,uv:s}=et.useMemo(()=>j9(t,e),[t,e]);return ke.jsxs("mesh",{children:[ke.jsx("primitive",{object:r,attach:"material"}),ke.jsxs("bufferGeometry",{children:[ke.jsx("bufferAttribute",{attach:"attributes-position",args:[i,3]}),ke.jsx("bufferAttribute",{attach:"attributes-uv",args:[s,2]})]})]})}function Krt({width:t,height:e,alpha:n}){const r=et.useMemo(()=>new Array(t*e).fill(n),[t,e,n]);return ke.jsx(xv,{width:t,height:e,alphas:r})}const wC=new Z0e,Xb=new Vn;function z9({width:t,height:e,top:n,left:r,right:i,bottom:s,scale:o=.125,alpha:a=.25}){const c=et.useMemo(()=>{const l=new Array(t*e);wC.min.x=r,wC.min.y=n,wC.max.x=i,wC.max.y=s,Xb.x=0,Xb.y=0;for(let u=0;u<l.length;++u)l[u]=a0e.smootherstep(1-wC.distanceToPoint(Xb)*o,0,1)*a,++Xb.x,Xb.x>=t&&(Xb.x=0,++Xb.y);return l},[t,e,n,r,i,s,o,a]);return ke.jsx(xv,{width:t,height:e,alphas:c})}function gJ(){}const Xrt=zd.forwardRef(function({args:e,children:n,...r},i){const s=zd.useRef(null);return zd.useImperativeHandle(i,()=>s.current),ke.jsxs("mesh",{ref:s,...r,children:[ke.jsx("planeGeometry",{attach:"geometry",args:e}),n]})}),D0=zd.forwardRef(function({blocking:e=!1,cursor:n="default",x:r=0,y:i=0,z:s=0,width:o=1,height:a=1,opacity:c=1,visible:l=!0,color:u="white",...h},d){const m=o*.5,p=a*.5,g=[(r+m)*En.DRAW_CHAR_WIDTH(),(i+p)*En.DRAW_CHAR_HEIGHT(),s];return ke.jsx(Xrt,{ref:d,args:[o*En.DRAW_CHAR_WIDTH(),a*En.DRAW_CHAR_HEIGHT()],userData:{blocking:e,cursor:n},onClick:e?gJ:void 0,onPointerMove:e?gJ:void 0,position:g,...h,children:ke.jsx("meshBasicMaterial",{color:u,opacity:c,visible:l,transparent:c!==1})})});function L0({width:t,height:e,char:n,color:r,bg:i,fliptexture:s=!0}){const o=Ba(p=>p.palettedata),a=Ba(p=>p.charsetdata),c=Ba(p=>p.altcharsetdata),[l]=et.useState(()=>Wrt()),{width:u=0,height:h=0}=a?.image??{};et.useEffect(()=>{t===0||e===0||(l.uniforms.data.value=Urt(t,e))},[l.uniforms.data,t,e]),et.useEffect(()=>{t===0||e===0||Lrt(l.uniforms.data.value,t,e,n,r,i)},[l.uniforms.data.value,t,e,n,r,i]),et.useEffect(()=>{t===0||e===0||!a||(l.uniforms.map.value=a,l.uniforms.alt.value=c??a,l.uniforms.palette.value=o,l.uniforms.size.value.x=1/t,l.uniforms.size.value.y=1/e,l.uniforms.step.value.x=1/Math.round(u/sf),l.uniforms.step.value.y=1/Math.round(h/of),l.uniforms.flip.value=s,l.needsUpdate=!0)},[o,a,c,l,t,e,u,h,s]);const{position:d,uv:m}=et.useMemo(()=>j9(t,e),[t,e]);return ke.jsxs("mesh",{children:[ke.jsxs("bufferGeometry",{children:[ke.jsx("bufferAttribute",{attach:"attributes-position",args:[d,3]}),ke.jsx("bufferAttribute",{attach:"attributes-uv",args:[m,2]})]}),ke.jsx("primitive",{object:l,attach:"material"})]})}function xE({store:t,children:e}){return ke.jsx(k7.Provider,{value:t,children:e})}function TE({width:t,height:e}){const n=et.useContext(k7),[r,i,s]=M7(n,iu(o=>[o.char,o.color,o.bg,o.render]));return t>0&&e>0&&ke.jsx(L0,{char:r.slice(),color:i.slice(),bg:s.slice(),width:t,height:e})}const ib=navigator.userAgent.includes("Mac"),Yrt=navigator.userAgent.includes("Linux"),Fp=ib?"cmd":"ctrl";function T2({x:t,y:e,width:n,height:r,debug:i,...s}){const o=En.DRAW_CHAR_WIDTH(),a=En.DRAW_CHAR_HEIGHT();return ke.jsx(Ltt,{...s,args:[n*o,r*a],position:[(t??0)*o+n*o*.5,(e??0)*a+r*a*.5,0],children:ke.jsx("meshBasicMaterial",{transparent:!0,opacity:i?.7:0,color:"red"})})}const _J=ib?"Meta":"Ctrl";function Qk({x:t,y:e,letters:n,digit:r,usealt:i,usectrl:s}){const o=ou(),{keyboardshift:a,keyboardctrl:c,keyboardalt:l}=Fh();if(o.x=t,o.y=e,Cr("$219$219$219$219$219",o,!1),o.x=t,o.y=e+1,Cr("$219$178$178$178$219",o,!1),o.x=t,o.y=e+2,Cr("$219$219$219$219$219",o,!1),n&&(o.x=t+(n.startsWith("$")?2:Math.round(2.5-n.length*.5)),o.y=e,Cr(a?n.toUpperCase():n.toLowerCase(),o,!1)),r.trim().length===1){o.x=t+2,o.y=e+2;const u=r==="$"?"$$":r;Cr(a?u.toUpperCase():u.toLowerCase(),o,!1)}return ke.jsx(T2,{x:t,y:e,width:5,height:3,onPointerDown:()=>{let u="";l&&i&&(u+="{Alt>}"),c&&s&&(u+=`{${_J}>}`),a&&(u+="{Shift>}"),u+=r.length===1?r.replace("[","[[").replace("{","{{"):r,l&&i&&(u+="{/Alt}"),c&&s&&(u+=`{/${_J}}`),a&&(u+="{/Shift}"),og.keyboard(u).catch(Ah)}})}function Y_({x:t,y:e,letters:n,onToggle:r}){const i=ou();return i.x=t,i.y=e,Cr("$178$178$178$178$178",i,!1),i.x=t,i.y=e+1,Cr("$178$177$177$177$178",i,!1),i.x=t,i.y=e+2,Cr("$178$178$178$178$178",i,!1),n&&(i.x=t+Math.round(2.5-n.length*.5),i.y=e,Cr(n,i,!1)),ke.jsx(T2,{x:t,y:e,width:5,height:3,onPointerDown:()=>{r()}})}function Zrt({width:t}){const e=ou(),{keyboardalt:n,keyboardctrl:r,keyboardshift:i}=Fh(),s=t-18,o=t-12,a=t-6,c=Math.round(t*.5)-3,l=a,u=12;e.x=l,e.y=u,Cr("$178$178$178$178$178",e,!1),e.x=l,e.y=u+1,Cr("$178$177$177$177$178",e,!1),e.x=l,e.y=u+2,Cr("$178$178$178$178$178",e,!1);const h="shoot";e.x=l+Math.round(2.5-h.length*.5),e.y=u,Cr(h,e,!1);function d(){og.keyboard("{/Shift}").catch(Ah)}return ke.jsxs(ke.Fragment,{children:[ke.jsx(Y_,{x:1,y:0,letters:r?"CTRL":"ctrl",onToggle:()=>{Fh.setState({keyboardctrl:!r})}}),ke.jsx(Y_,{x:7,y:1,letters:n?"ALT":"alt",onToggle:()=>{Fh.setState({keyboardalt:!n})}}),ke.jsx(Y_,{x:13,y:0,letters:i?"SHIFT":"shift",onToggle:()=>{Fh.setState({keyboardshift:!i})}}),ke.jsx(Y_,{x:s,y:0,letters:"menu",onToggle:()=>{og.keyboard("[Tab]").catch(Ah)}}),ke.jsx(Y_,{x:o,y:1,letters:"okay",onToggle:()=>{og.keyboard("[Enter]").catch(Ah)}}),ke.jsx(Y_,{x:a,y:0,letters:"cancel",onToggle:()=>{og.keyboard("[Escape]").catch(Ah)}}),ke.jsx(Y_,{x:1,y:12,letters:"?",onToggle:()=>{og.keyboard("{Shift>}?{/Shift}").catch(Ah)}}),ke.jsx(Y_,{x:7,y:13,letters:"#",onToggle:()=>{og.keyboard("3").catch(Ah)}}),ke.jsx(Y_,{x:13,y:12,letters:"c",onToggle:()=>{og.keyboard("c").catch(Ah)}}),ke.jsx(Qk,{x:c,y:0,letters:"$24",digit:"[ArrowUp]",usealt:!0}),ke.jsx(Qk,{x:c,y:13,letters:"$25",digit:"[ArrowDown]",usealt:!0}),ke.jsx(Qk,{x:t-6,y:6,letters:"$26",digit:"[ArrowRight]",usealt:!0,usectrl:!0}),ke.jsx(Qk,{x:0,y:6,letters:"$27",digit:"[ArrowLeft]",usealt:!0,usectrl:!0}),ke.jsx(T2,{x:a,y:12,width:5,height:3,onPointerDown:()=>{og.keyboard("{Shift>}").catch(Ah)},onPointerUp:d,onPointerLeave:d,onPointerCancel:d})]})}var QO={exports:{}},Jrt=QO.exports,vJ;function Qrt(){return vJ||(vJ=1,(function(t,e){(function(n,r){t.exports=r()})(Jrt,(()=>(()=>{var n={944:function(o){var a;a=()=>(()=>{var c={d:(v,x)=>{for(var E in x)c.o(x,E)&&!c.o(v,E)&&Object.defineProperty(v,E,{enumerable:!0,get:x[E]})},o:(v,x)=>Object.prototype.hasOwnProperty.call(v,x)},l={};function u(v){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},u(v)}function h(v,x){var E=typeof Symbol<"u"&&v[Symbol.iterator]||v["@@iterator"];if(!E){if(Array.isArray(v)||(E=m(v))||x){E&&(v=E);var C=0,A=function(){};return{s:A,n:function(){return C>=v.length?{done:!0}:{done:!1,value:v[C++]}},e:function(z){throw z},f:A}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var k,M=!0,I=!1;return{s:function(){E=E.call(v)},n:function(){var z=E.next();return M=z.done,z},e:function(z){I=!0,k=z},f:function(){try{M||E.return==null||E.return()}finally{if(I)throw k}}}}function d(v,x){return(function(E){if(Array.isArray(E))return E})(v)||(function(E,C){var A=E==null?null:typeof Symbol<"u"&&E[Symbol.iterator]||E["@@iterator"];if(A!=null){var k,M,I,z,H=[],K=!0,P=!1;try{if(I=(A=A.call(E)).next,C!==0)for(;!(K=(k=I.call(A)).done)&&(H.push(k.value),H.length!==C);K=!0);}catch(F){P=!0,M=F}finally{try{if(!K&&A.return!=null&&(z=A.return(),Object(z)!==z))return}finally{if(P)throw M}}return H}})(v,x)||m(v,x)||(function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function m(v,x){if(v){if(typeof v=="string")return p(v,x);var E=Object.prototype.toString.call(v).slice(8,-1);return E==="Object"&&v.constructor&&(E=v.constructor.name),E==="Map"||E==="Set"?Array.from(v):E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E)?p(v,x):void 0}}function p(v,x){(x==null||x>v.length)&&(x=v.length);for(var E=0,C=new Array(x);E<x;E++)C[E]=v[E];return C}function g(v,x){if(!(v instanceof x))throw new TypeError("Cannot call a class as a function")}c.d(l,{default:()=>y});var y=(function(){function v(){var C=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];g(this,v),this.strict=C,this.defaults=new Map,this.validators=new Map,this.types=new Map,this.optional=new Set,this.required=new Set}var x,E;return x=v,(E=[{key:"allowExtra",value:function(){return this.strict=!1,this}},{key:"setDefaults",value:function(C){var A=this;return Object.entries(C).forEach((function(k){var M=d(k,2),I=M[0],z=M[1];return A.defaults.set(I,z)})),this}},{key:"setValidators",value:function(C){var A=this;return Object.entries(C).forEach((function(k){var M=d(k,2),I=M[0],z=M[1];return A.validators.set(I,z)})),this}},{key:"setTypes",value:function(C){var A=this;return Object.entries(C).forEach((function(k){var M=d(k,2),I=M[0],z=M[1];return A.types.set(I,z)})),this}},{key:"setOptional",value:function(C){var A=this;return C.forEach((function(k){return A.optional.add(k)})),this}},{key:"setRequired",value:function(C){var A=this;return C.forEach((function(k){return A.required.add(k)})),this}},{key:"resolve",value:function(C){return this.validate(Object.assign(this.getDefaults(),C))}},{key:"getDefaults",value:function(){var C,A={},k=h(this.defaults);try{for(k.s();!(C=k.n()).done;){var M=d(C.value,2),I=M[0],z=M[1];A[I]=z}}catch(H){k.e(H)}finally{k.f()}return A}},{key:"validate",value:function(C){for(var A in C)this.validators.has(A)&&(C[A]=this.validators.get(A)(C[A]));for(var k in C){if(!this.optionExists(k))throw new Error('Unkown option "'.concat(k,'".'));this.checkType(k,C[k])}var M,I=h(this.required.values());try{for(I.s();!(M=I.n()).done;){var z=M.value;if(C[z]===void 0)throw new Error('Option "'.concat(z,'" is required.'))}}catch(H){I.e(H)}finally{I.f()}return C}},{key:"checkType",value:function(C,A){if(this.types.has(C)){var k=this.types.get(C),M=u(A);if(M!==k)throw new Error('Wrong value for option "'.concat(C,'": expected type "').concat(k,'", got "').concat(M,'".'))}}},{key:"optionExists",value:function(C){return!this.strict||this.defaults.has(C)||this.validators.has(C)||this.optional.has(C)||this.required.has(C)||this.types.has(C)}}])&&(function(C,A){for(var k=0;k<A.length;k++){var M=A[k];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(C,(I=(function(z,H){if(u(z)!=="object"||z===null)return z;var K=z[Symbol.toPrimitive];if(K!==void 0){var P=K.call(z,"string");if(u(P)!=="object")return P;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(z)})(M.key),u(I)==="symbol"?I:String(I)),M)}var I})(x.prototype,E),Object.defineProperty(x,"prototype",{writable:!1}),v})();return l.default})(),o.exports=a()},162:function(o){o.exports=(()=>{var a={d:(u,h)=>{for(var d in h)a.o(h,d)&&!a.o(u,d)&&Object.defineProperty(u,d,{enumerable:!0,get:h[d]})},o:(u,h)=>Object.prototype.hasOwnProperty.call(u,h)},c={};a.d(c,{default:()=>l});var l=(function(){function u(){(function(d,m){if(!(d instanceof m))throw new TypeError("Cannot call a class as a function")})(this,u),this._events={},this.on=this.addEventListener,this.off=this.removeEventListener}var h;return(h=[{key:"emit",value:function(d,m){if(Object.prototype.hasOwnProperty.call(this._events,d))for(var p=this._events[d],g={type:d,detail:m},y=p.length,v=0;v<y;v++)this.handle(p[v],g)}},{key:"handle",value:function(d,m){d(m)}},{key:"addEventListener",value:function(d,m){Object.prototype.hasOwnProperty.call(this._events,d)||(this._events[d]=[]),this._events[d].indexOf(m)<0&&this._events[d].push(m)}},{key:"removeEventListener",value:function(d,m){if(Object.prototype.hasOwnProperty.call(this._events,d)){var p=this._events[d],g=p.indexOf(m);g>=0&&p.splice(g,1),p.length===0&&delete this._events[d]}}}])&&(function(d,m){for(var p=0;p<m.length;p++){var g=m[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(d,g.key,g)}})(u.prototype,h),u})();return c.default})()}},r={};function i(o){var a=r[o];if(a!==void 0)return a.exports;var c=r[o]={exports:{}};return n[o].call(c.exports,c,c.exports,i),c.exports}i.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return i.d(a,{a}),a},i.d=(o,a)=>{for(var c in a)i.o(a,c)&&!i.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:a[c]})},i.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{GamepadHandler:()=>C,GamepadListener:()=>j});var o=i(162),a=i.n(o),c=i(944),l=i.n(c);function u(q){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(te){return typeof te}:function(te){return te&&typeof Symbol=="function"&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te},u(q)}function h(q,te){if(!(q instanceof te))throw new TypeError("Cannot call a class as a function")}function d(q,te){for(var W=0;W<te.length;W++){var $=te[W];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(q,y($.key),$)}}function m(q,te){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(W,$){return W.__proto__=$,W},m(q,te)}function p(q,te){if(te&&(u(te)==="object"||typeof te=="function"))return te;if(te!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(W){if(W===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return W})(q)}function g(q){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(te){return te.__proto__||Object.getPrototypeOf(te)},g(q)}function y(q){var te=(function(W,$){if(u(W)!=="object"||W===null)return W;var J=W[Symbol.toPrimitive];if(J!==void 0){var ne=J.call(W,"string");if(u(ne)!=="object")return ne;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(W)})(q);return u(te)==="symbol"?te:String(te)}var v,x,E,C=(function(q){(function(xe,Ne){if(typeof Ne!="function"&&Ne!==null)throw new TypeError("Super expression must either be null or a function");xe.prototype=Object.create(Ne&&Ne.prototype,{constructor:{value:xe,writable:!0,configurable:!0}}),Object.defineProperty(xe,"prototype",{writable:!1}),Ne&&m(xe,Ne)})(ae,q);var te,W,$,J,ne,ie=(J=ae,ne=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var xe,Ne=g(J);if(ne){var Re=g(this).constructor;xe=Reflect.construct(Ne,arguments,Re)}else xe=Ne.apply(this,arguments);return p(this,xe)});function ae(xe,Ne){var Re,Se=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return h(this,ae),(Re=ie.call(this)).index=xe,Re.gamepad=Ne,Re.options=Re.constructor.resolveOptions(Se),Re.axes=new Array(Ne.axes.length).fill(null),Re.buttons=new Array(Ne.buttons.length).fill(null),Re.initAxes(),Re.initButtons(),Re}return te=ae,$=[{key:"resolveOptions",value:function(xe){var Ne,Re,Se,ze,Be=xe.axis,Je=xe.button;return{axis:this.optionResolver.resolve((Ne=(Re=Be??Je)!==null&&Re!==void 0?Re:xe)!==null&&Ne!==void 0?Ne:{}),button:this.optionResolver.resolve((Se=(ze=Je??Be)!==null&&ze!==void 0?ze:xe)!==null&&Se!==void 0?Se:{})}}}],(W=[{key:"initAxes",value:function(){for(var xe=this.axes.length,Ne=0;Ne<xe;Ne++)this.axes[Ne]=this.resolveAxisValue(Ne)}},{key:"initButtons",value:function(){for(var xe=this.buttons.length,Ne=0;Ne<xe;Ne++)this.buttons[Ne]=this.resolveButtonValue(Ne)}},{key:"update",value:function(xe){this.gamepad=xe,this.updateAxis(),this.updateButtons()}},{key:"updateAxis",value:function(){for(var xe=this.axes.length,Ne=0;Ne<xe;Ne++)this.setAxisValue(Ne,this.resolveAxisValue(Ne))}},{key:"updateButtons",value:function(){for(var xe=this.buttons.length,Ne=0;Ne<xe;Ne++)this.setButtonValue(Ne,this.resolveButtonValue(Ne))}},{key:"setAxisValue",value:function(xe,Ne){this.axes[xe]!==Ne&&(this.axes[xe]=Ne,this.emit("axis",{gamepad:this.gamepad,index:this.index,axis:xe,value:Ne}))}},{key:"setButtonValue",value:function(xe,Ne){this.buttons[xe]!==Ne&&(this.buttons[xe]=Ne,this.emit("button",{gamepad:this.gamepad,index:this.index,button:xe,pressed:this.gamepad.buttons[xe].pressed,value:Ne}))}},{key:"resolveAxisValue",value:function(xe){var Ne=this.options.axis,Re=Ne.deadZone,Se=Ne.analog,ze=Ne.precision,Be=this.gamepad.axes[xe];return Re&&Be<Re&&Be>-Re?0:Se?ze?Math.round(Be*ze)/ze:Be:Be>0?1:Be<0?-1:0}},{key:"resolveButtonValue",value:function(xe){var Ne=this.options.button,Re=Ne.deadZone,Se=Ne.analog,ze=Ne.precision,Be=this.gamepad.buttons[xe].value;return Re>0&&Be<Re&&Be>-Re?0:Se?ze?Math.round(Be*ze)/ze:Be:Be===0?0:1}}])&&d(te.prototype,W),$&&d(te,$),Object.defineProperty(te,"prototype",{writable:!1}),ae})(a());function A(q){return A=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(te){return typeof te}:function(te){return te&&typeof Symbol=="function"&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te},A(q)}function k(q,te){for(var W=0;W<te.length;W++){var $=te[W];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(q,M($.key),$)}}function M(q){var te=(function(W,$){if(A(W)!=="object"||W===null)return W;var J=W[Symbol.toPrimitive];if(J!==void 0){var ne=J.call(W,"string");if(A(ne)!=="object")return ne;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(W)})(q);return A(te)==="symbol"?te:String(te)}v=C,x="optionResolver",E=new(l())().setDefaults({analog:!0,deadZone:0,precision:0}).setTypes({analog:"boolean",deadZone:"number",precision:"number"}).setValidators({deadZone:function(q){return Math.max(Math.min(q,1),0)},precision:function(q){return q>0?Math.pow(10,q):0}}),(x=y(x))in v?Object.defineProperty(v,x,{value:E,enumerable:!0,configurable:!0,writable:!0}):v[x]=E;var I=(function(){function q($){(function(J,ne){if(!(J instanceof ne))throw new TypeError("Cannot call a class as a function")})(this,q),this.callback=$,this.frame=null,this.update=this.update.bind(this)}var te,W;return te=q,(W=[{key:"setCallback",value:function($){this.callback=$}},{key:"start",value:function(){this.frame||(this.frame=window.requestAnimationFrame(this.update))}},{key:"stop",value:function(){this.frame&&(window.cancelAnimationFrame(this.frame),this.frame=null)}},{key:"update",value:function(){this.frame=window.requestAnimationFrame(this.update),this.callback()}}])&&k(te.prototype,W),Object.defineProperty(te,"prototype",{writable:!1}),q})();function z(q){return z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(te){return typeof te}:function(te){return te&&typeof Symbol=="function"&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te},z(q)}function H(q,te){if(!(q instanceof te))throw new TypeError("Cannot call a class as a function")}function K(q,te){for(var W=0;W<te.length;W++){var $=te[W];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(q,P($.key),$)}}function P(q){var te=(function(W,$){if(z(W)!=="object"||W===null)return W;var J=W[Symbol.toPrimitive];if(J!==void 0){var ne=J.call(W,"string");if(z(ne)!=="object")return ne;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(W)})(q);return z(te)==="symbol"?te:String(te)}function F(q,te){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(W,$){return W.__proto__=$,W},F(q,te)}function N(q,te){if(te&&(z(te)==="object"||typeof te=="function"))return te;if(te!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return X(q)}function X(q){if(q===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return q}function G(q){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(te){return te.__proto__||Object.getPrototypeOf(te)},G(q)}var j=(function(q){(function(ae,xe){if(typeof xe!="function"&&xe!==null)throw new TypeError("Super expression must either be null or a function");ae.prototype=Object.create(xe&&xe.prototype,{constructor:{value:ae,writable:!0,configurable:!0}}),Object.defineProperty(ae,"prototype",{writable:!1}),xe&&F(ae,xe)})(ie,q);var te,W,$,J,ne=($=ie,J=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var ae,xe=G($);if(J){var Ne=G(this).constructor;ae=Reflect.construct(xe,arguments,Ne)}else ae=xe.apply(this,arguments);return N(this,ae)});function ie(){var ae,xe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(H(this,ie),ae=ne.call(this),typeof navigator.getGamepads!="function")throw new Error("This browser does not support gamepad API.");return ae.options=xe,ae.onAxis=ae.onAxis.bind(X(ae)),ae.update=ae.update.bind(X(ae)),ae.start=ae.start.bind(X(ae)),ae.stop=ae.stop.bind(X(ae)),ae.discover=ae.discover.bind(X(ae)),ae.onButton=ae.onButton.bind(X(ae)),ae.handlers=new Array(4).fill(null),ae.loop=new I(ae.update),window.addEventListener("error",ae.stop),ae}return te=ie,(W=[{key:"start",value:function(){this.loop.start()}},{key:"stop",value:function(){this.loop.stop()}},{key:"update",value:function(){var ae=navigator.getGamepads();this.discover(ae[0],0),this.discover(ae[1],1),this.discover(ae[2],2),this.discover(ae[3],3)}},{key:"discover",value:function(ae,xe){ae?(this.handlers[xe]===null&&this.registerHandler(xe,ae),this.handlers[xe].update(ae)):this.handlers[xe]&&this.removeGamepad(xe)}},{key:"registerHandler",value:function(ae,xe){var Ne=new C(ae,xe,this.options);this.handlers[ae]=Ne,Ne.addEventListener("axis",this.onAxis),Ne.addEventListener("button",this.onButton),this.emit("gamepad:connected",{index:ae,gamepad:xe}),this.emit("gamepad:".concat(ae,":connected"),{index:ae,gamepad:xe})}},{key:"removeGamepad",value:function(ae){var xe=this.handlers[ae];xe.removeEventListener("axis",this.onAxis),xe.removeEventListener("button",this.onButton),this.handlers[ae]=null,this.emit("gamepad:disconnected",{index:ae}),this.emit("gamepad:".concat(ae,":disconnected"),{index:ae})}},{key:"onAxis",value:function(ae){var xe=ae.detail.index;this.emit("gamepad:axis",ae.detail),this.emit("gamepad:".concat(xe,":axis"),ae.detail),this.emit("gamepad:".concat(xe,":axis:").concat(ae.detail.axis),ae.detail)}},{key:"onButton",value:function(ae){var xe=ae.detail.index;this.emit("gamepad:button",ae.detail),this.emit("gamepad:".concat(xe,":button"),ae.detail),this.emit("gamepad:".concat(xe,":button:").concat(ae.detail.button),ae.detail)}}])&&K(te.prototype,W),Object.defineProperty(te,"prototype",{writable:!1}),ie})(a())})(),s})()))})(QO)),QO.exports}var eit=Qrt(),ng={},yJ;function tit(){if(yJ)return ng;yJ=1,Object.defineProperty(ng,"__esModule",{value:!0});for(var t=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),e={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},n={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:t?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},r={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},i=1;i<20;i++)r["f"+i]=111+i;function s(d,m,p){m&&!("byKey"in m)&&(p=m,m=null),Array.isArray(d)||(d=[d]);var g=d.map(function(x){return c(x,m)}),y=function(E){return g.some(function(C){return l(C,E)})},v=p==null?y:y(p);return v}function o(d,m){return s(d,m)}function a(d,m){return s(d,{byKey:!0},m)}function c(d,m){var p=m&&m.byKey,g={};d=d.replace("++","+add");var y=d.split("+"),v=y.length;for(var x in e)g[e[x]]=!1;var E=!0,C=!1,A=void 0;try{for(var k=y[Symbol.iterator](),M;!(E=(M=k.next()).done);E=!0){var I=M.value,z=I.endsWith("?")&&I.length>1;z&&(I=I.slice(0,-1));var H=h(I),K=e[H];if(I.length>1&&!K&&!n[I]&&!r[H])throw new TypeError('Unknown modifier: "'+I+'"');(v===1||!K)&&(p?g.key=H:g.which=u(I)),K&&(g[K]=z?null:!0)}}catch(P){C=!0,A=P}finally{try{!E&&k.return&&k.return()}finally{if(C)throw A}}return g}function l(d,m){for(var p in d){var g=d[p],y=void 0;if(g!=null&&(p==="key"&&m.key!=null?y=m.key.toLowerCase():p==="which"?y=g===91&&m.which===93?91:m.which:y=m[p],!(y==null&&g===!1)&&y!==g))return!1}return!0}function u(d){d=h(d);var m=r[d]||d.toUpperCase().charCodeAt(0);return m}function h(d){return d=d.toLowerCase(),d=n[d]||d,d}return ng.default=s,ng.isHotkey=s,ng.isCodeHotkey=o,ng.isKeyHotkey=a,ng.parseHotkey=c,ng.compareHotkey=l,ng.toKeyCode=u,ng.toKeyName=h,ng}var nit=tit();const bJ=su(nit);function Che(t){return{all:t=t||new Map,on:function(e,n){var r=t.get(e);r?r.push(n):t.set(e,[n])},off:function(e,n){var r=t.get(e);r&&(n?r.splice(r.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var r=t.get(e);r&&r.slice().map(function(i){i(n)}),(r=t.get("*"))&&r.slice().map(function(i){i(e,n)})}}}const k1={};function H9(t){return`${ui()}local${t}`}const rit=1e3,bS={};let gU=0,EJ=performance.now();const Fx=v3*10,SJ=[rn.MOVE_UP,rn.MOVE_DOWN,rn.MOVE_LEFT,rn.MOVE_RIGHT,rn.OK_BUTTON,rn.CANCEL_BUTTON,rn.MENU_BUTTON];function Ahe(){const t=performance.now(),e=t-EJ,n=Cv(k1);for(let r=0;r<n.length;++r){const i=parseFloat(n[r]);if(bS[i]=bS[i]??0,bS[i]+=e,bS[i]>=Fx){bS[i]-=Fx;const s=k1[i],o={alt:!!s[rn.ALT],ctrl:!!s[rn.CTRL],shift:!!s[rn.SHIFT]};for(let a=0;a<SJ.length;++a){const c=SJ[a];s[c]&&khe(i,c,o)}}}if(++gU,EJ=t,setTimeout(Ahe,10),gU>rit){gU=0;const r=Cv(k1);for(let i=1;i<r.length;++i){const s=parseFloat(r[i]);rte(ut,H9(s))}}}Ahe();function q9(t){return k1[t]=k1[t]??{[rn.NONE]:!1,[rn.ALT]:!1,[rn.CTRL]:!1,[rn.SHIFT]:!1,[rn.MOVE_UP]:!1,[rn.MOVE_DOWN]:!1,[rn.MOVE_LEFT]:!1,[rn.MOVE_RIGHT]:!1,[rn.OK_BUTTON]:!1,[rn.CANCEL_BUTTON]:!1,[rn.MENU_BUTTON]:!1},k1[t]}function Bo(t,e){const n=q9(t);n[e]||(bS[t]=Fx*-2,khe(t,e,{alt:n[rn.ALT],ctrl:n[rn.CTRL],shift:n[rn.SHIFT]})),n[e]=!0}function Ss(t,e){const n=q9(t);n[e]=!1}const y0={root:Che(),ignorehotkeys:!1},Mhe=et.createContext(y0.root);function w2(t){return{alt:t.altKey,ctrl:ib?t.metaKey:t.ctrlKey,shift:t.shiftKey}}function khe(t,e,n){if(t===0)y0.root.emit(rn[e],n);else{let r=0;const i=H9(t);n.alt&&(r|=J8),n.ctrl&&(r|=Q8),n.shift&&(r|=eF),ite(ut,i,e,r)}}window.addEventListener("wheel",t=>{t.preventDefault()},{passive:!1});window.addEventListener("keydown",t=>{const e=hr(t.key),n=w2(t),r=ui();switch(e){case"s":case"r":case"j":case"o":case"f":case"z":case"y":case"e":case"k":case"a":case"p":case"h":case"[":case"]":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"delete":case"backspace":(n.alt||n.ctrl||n.shift)&&t.preventDefault();break;case"tab":case"arrowleft":case"arrowright":case"arrowup":case"arrowdown":case"/":t.preventDefault();break}switch(n.alt?Bo(0,rn.ALT):Ss(0,rn.ALT),n.ctrl?Bo(0,rn.CTRL):Ss(0,rn.CTRL),n.shift?Bo(0,rn.SHIFT):Ss(0,rn.SHIFT),e){case"arrowleft":Bo(0,rn.MOVE_LEFT);break;case"arrowright":Bo(0,rn.MOVE_RIGHT);break;case"arrowup":Bo(0,rn.MOVE_UP);break;case"arrowdown":Bo(0,rn.MOVE_DOWN);break;case"enter":Bo(0,rn.OK_BUTTON);break;case"esc":case"escape":Bo(0,rn.CANCEL_BUTTON);break;case"tab":Bo(0,rn.MENU_BUTTON);break;case"r":n.ctrl&&FSe(ut,r);break;case"s":n.ctrl&&R0(ut,r,"#save");break;case"j":n.ctrl&&R0(ut,r,n.shift?"#jointab hush":"#jointab");break;case"o":n.ctrl&&R0(ut,r,n.shift?"#joincode hush":"#joincode");break;case"l":break;case"f":n.ctrl&&R0(ut,r,"#fork");break;case"k":n.ctrl&&nxe(ut,r)}y0.root.emit("keydown",t)},{capture:!0});window.addEventListener("keyup",t=>{const e=hr(t.key),n=w2(t);switch(n.alt?Bo(0,rn.ALT):Ss(0,rn.ALT),n.ctrl?Bo(0,rn.CTRL):Ss(0,rn.CTRL),n.shift?Bo(0,rn.SHIFT):Ss(0,rn.SHIFT),e){case"meta":Ss(0,rn.MOVE_LEFT),Ss(0,rn.MOVE_RIGHT),Ss(0,rn.MOVE_UP),Ss(0,rn.MOVE_DOWN);break;case"arrowleft":Ss(0,rn.MOVE_LEFT);break;case"arrowright":Ss(0,rn.MOVE_RIGHT);break;case"arrowup":Ss(0,rn.MOVE_UP);break;case"arrowdown":Ss(0,rn.MOVE_DOWN);break;case"enter":Ss(0,rn.OK_BUTTON);break;case"esc":case"escape":Ss(0,rn.CANCEL_BUTTON);break;case"tab":Ss(0,rn.MENU_BUTTON);break}},{capture:!0});lb("userinput",[],t=>{switch(t.target){case"up":an(t.data)&&Ss(0,t.data);break;case"down":an(t.data)&&Bo(0,t.data);break}});const Ohe=0,Ihe=1,Nhe=2,Phe=3,iit=4,sit=5,oit=6,ait=7,cit=9,lit=12,uit=13,fit=14,hit=15,_U={[Phe]:rn.MOVE_UP,[Ohe]:rn.MOVE_DOWN,[Nhe]:rn.MOVE_LEFT,[Ihe]:rn.MOVE_RIGHT,[iit]:rn.OK_BUTTON,[sit]:rn.CANCEL_BUTTON,[oit]:rn.SHIFT,[ait]:rn.SHIFT,[cit]:rn.MENU_BUTTON,[lit]:rn.MOVE_UP,[uit]:rn.MOVE_DOWN,[fit]:rn.MOVE_LEFT,[hit]:rn.MOVE_RIGHT},vU={};function dit(t){return vU[t]=vU[t]??{},vU[t]}function pit(t,e,n){const r=dit(t),i=_1(r[0]??0,r[1]??0),s=_1(r[2]??0,r[3]??0);r[e]=n;const o=_1(r[0]??0,r[1]??0),a=_1(r[2]??0,r[3]??0);if(i!==o)switch(Ss(t,rn.MOVE_LEFT),Ss(t,rn.MOVE_RIGHT),Ss(t,rn.MOVE_UP),Ss(t,rn.MOVE_DOWN),o){case pn.NORTH:Bo(t,rn.MOVE_UP);break;case pn.SOUTH:Bo(t,rn.MOVE_DOWN);break;case pn.WEST:Bo(t,rn.MOVE_LEFT);break;case pn.EAST:Bo(t,rn.MOVE_RIGHT);break}if(s!==a)switch(a===pn.IDLE?Ss(t,rn.SHIFT):Bo(t,rn.SHIFT),Ss(t,rn.MOVE_LEFT),Ss(t,rn.MOVE_RIGHT),Ss(t,rn.MOVE_UP),Ss(t,rn.MOVE_DOWN),a){case pn.NORTH:Bo(t,rn.MOVE_UP);break;case pn.SOUTH:Bo(t,rn.MOVE_DOWN);break;case pn.WEST:Bo(t,rn.MOVE_LEFT);break;case pn.EAST:Bo(t,rn.MOVE_RIGHT);break}}const R2=new eit.GamepadListener({analog:!1,deadZone:.3});R2.on("gamepad:connected",t=>{const e=ui();Ei(ut,e,`connected ${t.detail.gamepad.id}`),q9(t.detail.index),t.detail.index>0&&QSe(ut,H9(t.detail.index))});R2.on("gamepad:disconnected",t=>{const e=ui();Ei(ut,e,`disconnected gamepad ${t.detail.index}`),delete k1[t.detail.index]});R2.on("gamepad:axis",t=>{pit(t.detail.index,t.detail.axis,t.detail.value)});R2.on("gamepad:button",t=>{const e=t.detail.index;switch(t.detail.button){case Nhe:case Ihe:case Phe:case Ohe:Ss(e,rn.MOVE_UP),Ss(e,rn.MOVE_DOWN),Ss(e,rn.MOVE_LEFT),Ss(e,rn.MOVE_RIGHT),t.detail.value?(Bo(t.detail.index,rn.SHIFT),Bo(t.detail.index,_U[t.detail.button])):Ss(t.detail.index,rn.SHIFT);break;default:t.detail.value?Bo(t.detail.index,_U[t.detail.button]):Ss(t.detail.index,_U[t.detail.button]);break}});R2.start();const xJ="keyup";function $S({hotkey:t,althotkey:e,children:n}){return et.useEffect(()=>{const r=bJ(t,{byKey:!0}),i=ge(e)?bJ(e,{byKey:!0}):void 0;function s(o){y0.ignorehotkeys===!1&&(r(o)||i?.(o))&&n()}return document.addEventListener(xJ,s,!1),()=>document.removeEventListener(xJ,s,!1)},[t,e,n]),null}function ja(t){const e=et.useContext(Mhe);return et.useEffect(()=>{const n=Object.entries(t);return n.forEach(([r,i])=>e.on(r,i)),()=>{n.forEach(([r,i])=>e.off(r,i))}},[e,t]),null}function bb({blockhotkeys:t,children:e}){const[n]=et.useState(()=>Che());return et.useEffect(()=>{const r=y0.root,i=y0.ignorehotkeys;return y0.root=n,y0.ignorehotkeys=!!t,()=>{y0.root=r,y0.ignorehotkeys=i}},[n,t]),ke.jsx(Mhe.Provider,{value:n,children:e})}function mit(t){const{keyboardshift:e,keyboardctrl:n,keyboardalt:r}=Fh.getState();let i="";switch(r&&(i+="{Alt>}"),n&&(i+="{Ctrl>}"),e&&(i+="{Shift>}"),t){case 0:i+="[ArrowLeft]";break;case 45:i+="[ArrowLeft][ArrowUp]";break;case 90:i+="[ArrowUp]";break;case 135:i+="[ArrowRight][ArrowUp]";break;case 180:i+="[ArrowRight]";break;case 225:i+="[ArrowRight][ArrowDown]";break;case 270:i+="[ArrowDown]";break;case 315:i+="[ArrowLeft][ArrowDown]";break;case 360:i+="[ArrowLeft]";break}r&&(i+="{/Alt}"),n&&(i+="{/Ctrl}"),e&&(i+="{/Shift}"),og.keyboard(i).catch(Ah)}const git=Fx/1e3,RC=new Vn,jN=new jt;function yU(t,e){const n=En.DRAW_CHAR_WIDTH(),r=En.DRAW_CHAR_HEIGHT(),i=jN.x+n*.5,s=jN.y+r*.5;return{cx:Math.floor(t*.5)+Math.floor(i/n),cy:Math.floor(e*.5)+Math.floor(s/r)}}const TJ=4;function _it({width:t,height:e,onUp:n,onDrawStick:r}){const[i]=et.useState({startx:-1,starty:-1,tipx:-1,tipy:-1,pointerid:-1,presscount:0,inputacc:Fx});function s(o){i.pointerid===o.pointerId&&(--i.presscount,i.startx=-1,i.starty=-1,i.tipx=-1,i.tipy=-1,i.pointerid=-1,n())}return Jd((o,a)=>{if(i.inputacc+=a,i.inputacc>=git&&i.presscount>0){i.inputacc=0;const{cx:c,cy:l}=yU(t,e);if(RC.set(i.startx-c,i.starty-l),i.tipx!==-1||RC.length()>TJ){const u=Wee(FEe(RC.angle()),45);mit(u)}}}),ke.jsx(T2,{width:t,height:e,onPointerDown:o=>{if(++i.presscount,i.startx===-1){o.intersections[0].object.worldToLocal(jN.copy(o.intersections[0].point));const{cx:a,cy:c}=yU(t,e);i.startx=a,i.starty=c,i.tipx=-1,i.tipy=-1,i.pointerid=o.pointerId,i.inputacc=Fx}},onPointerMove:o=>{if(o.pointerId===i.pointerid&&o.intersections[0]){o.intersections[0].object.worldToLocal(jN.copy(o.intersections[0].point));const{cx:a,cy:c}=yU(t,e);RC.set(i.startx-a,i.starty-c),RC.length()>TJ*.25&&(i.tipx=a,i.tipy=c,r(i.startx,i.starty,i.tipx,i.tipy))}},onPointerUp:s,onPointerLeave:s,onPointerCancel:s})}const CC=new Vn,vit=177,yit=en.WHITE,bit=en.DKPURPLE;function Eit({width:t,height:e,onReset:n}){const r=ou();KM(r,vit,yit,bit);const i=Math.floor(t*.333),s=Math.round(t*.666);for(let o=0;o<e;++o)for(let a=i;a<=s;++a)ec(r,t,e,a,o,{char:176});return ke.jsxs(ke.Fragment,{children:[ke.jsx(T2,{x:0,y:-3,width:t,height:3,onPointerDown:()=>{Fh.setState(o=>({...o,sidebaropen:!o.sidebaropen}))}}),ke.jsx(Zrt,{width:t}),ke.jsx(_it,{width:t,height:e,onUp:n,onDrawStick:(o,a,c,l)=>{for(let u=0;u<5;++u)r.x=o-3,r.y=a-2+u,Cr("$dkblue$177$177$177$177$177$177$177",r,!1);CC.x=c-o,CC.y=l-a,CC.normalize().multiplyScalar(4);for(let u=0;u<3;++u)r.x=o+Math.round(CC.x)-1,r.y=a+Math.round(CC.y)-1+u,Cr("$blue$219$219$219",r,!1)}})]})}function Sit({width:t,height:e}){const[n,r]=et.useState(0),i=Kv(),s=177,o=en.WHITE,a=en.DKPURPLE,c=vE(t,e,s,o,a),l={...zv(t,e,o,a),...c.getState()};return i.cols<10||i.rows<10?null:ke.jsxs(xE,{store:c,children:[ke.jsx(WM.Provider,{value:l,children:ke.jsx(Eit,{width:t,height:e,onReset:()=>{KM(l,s,o,a),r(Math.random())}},n)}),ke.jsx(TE,{width:t,height:e})]})}const Dhe=et.createContext({cols:1,rows:1,marginx:1,marginy:1});function Kv(){return et.useContext(Dhe)}function xit({children:t}){const{viewport:e}=Hh(),{width:n,height:r}=e.getCurrentViewport(),{islandscape:i,showtouchcontrols:s}=Fh(),o=n/En.DRAW_CHAR_WIDTH();let a=Math.floor(o);const c=r/En.DRAW_CHAR_HEIGHT();let l=Math.floor(c);const u=(n-a*En.DRAW_CHAR_WIDTH())*.5,h=(r-l*En.DRAW_CHAR_HEIGHT())*.5;let d=0,m=0;const p=Math.round(o);let g=Math.round(c);return s&&(i?(d=5*En.DRAW_CHAR_WIDTH(),a-=10):(l=Math.floor(c)-16,g-=l,m=l*En.DRAW_CHAR_HEIGHT())),et.useEffect(()=>{Fh.setState(y=>({...y,insetcols:p,insetrows:g}))},[p,g]),ke.jsx(Dhe.Provider,{value:{cols:a,rows:l,marginx:u,marginy:h},children:a>=10&&l>=10&&ke.jsx("group",{"scale-x":-1,"rotation-z":Math.PI,children:ke.jsxs("group",{position:[n*-.5+u,r*-.5+h,0],children:[ke.jsx("group",{position:[d,0,0],children:t}),s&&ke.jsx("group",{position:[0,m,1],children:ke.jsx(Sit,{width:p,height:g},p*g)})]})})})}const Eb=et.createContext({sendmessage(){},sendclose(){},didclose(){}}),wJ={input:{color:"$white",active:"$yellow"}};function id(t){return t?wJ.input.active:wJ.input.color}function V9(t,e){return`vm:${t}:${e}`}function JC(t,e,n=0,r=""){return`${t.substring(0,e)}${r}${t.substring(e+n)}`}function sd(t,e,n){ge(e)&&(n.x=t?1:0,n.y=e,n.disablewrap=!0)}const xy=32,Lhe=8,CB=new jt;function Tit(){const t=En.DRAW_CHAR_WIDTH(),e=En.DRAW_CHAR_HEIGHT(),n=Math.floor(CB.x/t),r=Math.floor(CB.y/e);return{x:xy*.5+n,y:Lhe*.5+r}}function wit({sidebar:t,chip:e,row:n,label:r,args:i,context:s}){sd(t,n,s);const[o]=[Kf(i[0],"")],a=fb(e,o),l=GM(a)??0,u=ep(),[h,d]=et.useState(!1);et.useLayoutEffect(()=>{d(!0)},[]);const m=`${l}`.padStart(3,"0"),p=r.trim(),g=s.x-1,y=s.y+2,v=[`$green${p} ${m}
$white`];for(let z=0;z<256;++z)if(z%xy===0&&v.push(`
`),z===l){const H=u?"$green$onwhite":"$white$ongreen";v.push(`${H}$${z}$white$ondkblue`)}else v.push(`$${z}`);const x=v.join("");Cr(x,s,!0);const E=et.useContext(Eb),C=et.useCallback(()=>{l>=xy&&Hf(a,l-xy)},[a,l]),A=et.useCallback(()=>{l>0&&Hf(a,l-1)},[a,l]),k=et.useCallback(()=>{l<255&&Hf(a,l+1)},[a,l]),M=et.useCallback(()=>{l<=255-xy&&Hf(a,l+xy)},[a,l]),I=et.useCallback(()=>{E.sendclose()},[E]);return ke.jsx("group",{position:[g*En.DRAW_CHAR_WIDTH(),y*En.DRAW_CHAR_HEIGHT(),1],children:h&&ke.jsxs(bb,{blockhotkeys:!0,children:[ke.jsx(D0,{blocking:!0,visible:!1,width:xy,height:Lhe,onClick:z=>{z.intersections[0].object.worldToLocal(CB.copy(z.intersections[0].point));const H=Wc(Tit(),xy);H>=0&&H<=255&&(Hf(a,H),E.sendclose())}}),ke.jsx(ja,{MOVE_LEFT:A,MOVE_UP:C,MOVE_RIGHT:k,MOVE_DOWN:M,OK_BUTTON:I,CANCEL_BUTTON:I})]})})}const ES=8,Uhe=2,AB=new jt;function Rit(){const t=En.DRAW_CHAR_WIDTH(),e=En.DRAW_CHAR_HEIGHT(),n=Math.floor(AB.x/t),r=Math.floor(AB.y/e);return{x:ES*.5+n,y:Uhe*.5+r}}function Cit(t){switch(t){case"dkyellow":return", brown";case"ltgray":return", ltgrey, gray, grey";case"dkgray":return", dkgrey, ltblack";case"ondkyellow":return", onbrown";case"onltgray":return", onltgrey, ongray, ongrey";case"ondkgray":return", ondkgrey, onltblack";case"bldkyellow":return", blbrown";case"blltgray":return", blltgrey, blgray, blgrey";case"bldkgray":return", bldkgrey, blltblack"}return""}const Ait=[...lx(0,15),...lx(33,48)],Mit=[...lx(0,15),32];function RJ({sidebar:t,chip:e,row:n,label:r,args:i,context:s,isbg:o=!1}){sd(t,n,s);const[a]=[Kf(i[0],"")],c=fb(e,a),u=GM(c)??0,h=ep(),[d,m]=et.useState(!1);et.useLayoutEffect(()=>{m(!0)},[]);const p=o?Mit:Ait,g=p.indexOf(u),y=`${u}`.padStart(2,"0"),v=r.trim(),x=(en[u]||en[en.BLACK]).toLowerCase(),E=Cit(x).padEnd(32," "),C=s.x-1,A=s.y+2,k=[`$green${v} ${y} ${x}${E}
$white`];for(let N=0;N<p.length;++N){N%ES===0&&k.push(`
`);const X=p[N],G=(en[X]||en[en.BLACK]).toLowerCase();if(X===u)if(h){const j=N%16<8?"white":"black";k.push(X>32?"$onwhite$219":`$${j}$219`)}else k.push(`$onblack$${G}$219`);else k.push(`$onblack$${G}$219`)}k.push("$white"),Cr(k.join(""),s,!0);const M=et.useContext(Eb),I=et.useCallback(N=>{const X=p[Vr(N,0,p.length-1)];Hf(c,X)},[p,c]),z=et.useCallback(()=>{I(g-ES)},[I,g]),H=et.useCallback(()=>{I(g-1)},[I,g]),K=et.useCallback(()=>{I(g+1)},[I,g]),P=et.useCallback(()=>{I(g+ES)},[I,g]),F=et.useCallback(()=>{M.sendclose()},[M]);return ke.jsx("group",{position:[C*En.DRAW_CHAR_WIDTH(),A*En.DRAW_CHAR_HEIGHT(),1],children:d&&ke.jsxs(bb,{blockhotkeys:!0,children:[ke.jsx(D0,{blocking:!0,visible:!1,width:ES,height:Uhe,onClick:N=>{N.intersections[0].object.worldToLocal(AB.copy(N.intersections[0].point));const X=Rit(),G=Wc(X,ES);G>=0&&G<=16&&(Hf(c,G),M.sendclose())}}),ke.jsx(ja,{MOVE_LEFT:H,MOVE_UP:z,MOVE_RIGHT:K,MOVE_DOWN:P,OK_BUTTON:F,CANCEL_BUTTON:F})]})})}function kit({sidebar:t,item:e,row:n,context:r}){sd(t,n,r);const i=dm(r),s=t7(e);if(ge(s)){const o=i.width-3,c=pb(s,o,3)?.measuredwidth??1,l=Vr(Math.floor(o*.5-c*.5),0,o);Cr(`${" ".repeat(l)}$WHITE${s}${ge(n)?`
`:""}`,r,!0)}else Cr(`${e}${ge(n)?`
`:""}`,r,!0);return null}function Oit({sidebar:t,row:e,active:n,label:r,args:i,context:s}){const o=et.useContext(Eb),a=et.useCallback(()=>{if(ge(po())){const l=[Kf(i[0],""),i[1]],[,...u]=l,h=u.join(" ");po().writeText(h).then(()=>{Jee(ut,ui(),`copied! ${h}`),o.sendclose()}).catch(d=>console.error(d))}},[i,o]),c=id(!!n);return sd(t,e,s),Cr(`  $purple$16 $yellowCOPYIT ${c}${r}`,s,!0),n&&ke.jsx(ja,{OK_BUTTON:a})}function Iit({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){sd(t,n,o);const[a,c,l,u]=[Kf(s[0],""),Kf(s[1],""),Kf(s[2],""),Kf(s[3],"")],h=l||` ${c.toUpperCase()} `,d=id(r),m=o.x-.25,p=o.y-.25,g=`${o.iseven?"$black$onltgray":"$black$ondkcyan"}${h}${d}$onclear ${i}${ge(n)?`
`:""}`;Cr(g,o,!0);const y=et.useContext(Eb),v=et.useCallback(()=>{y.sendmessage(V9(e,a),[]),u||y.sendclose()},[e,y,a,u]);return ke.jsxs("group",{position:[m*En.DRAW_CHAR_WIDTH(),p*En.DRAW_CHAR_HEIGHT(),1],children:[ke.jsx(D0,{visible:!1,width:h.length+.5,height:1.5,blocking:!0,onClick:v}),r&&ke.jsx(ja,{OK_BUTTON:v}),c&&ke.jsx($S,{hotkey:c,children:v})]})}function Nit({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){sd(t,n,o);const a=s.map(m=>Kf(m,"")),[c,...l]=a,u=id(r);Cr(`  $purple$16 ${u}${i}
`,o,!0);const h=et.useContext(Eb),d=et.useCallback(()=>{h.sendmessage(V9(e,c),l),h.sendclose()},[h,e,c,l]);return r&&ke.jsx(ja,{OK_BUTTON:d})}const eO=-111111;function Pit({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){sd(t,n,o);const[a,c,l]=[Kf(s[0],""),Ru(s[1],eO),Ru(s[2],eO)];let u,h;c===eO?(u=0,h=31):l===eO?(u=0,h=c):(u=c,h=l);const d=fb(e,a),m=GM(d),p=m??0,g=ep(),[y,v]=et.useState(""),[x,E]=et.useState(0),[C,A]=et.useState(!1);let k=`${p}`;const M=i.trim(),I=id(r);C&&(k=g?JC(y,x,1,"$219+"):y),o.writefullwidth=32,Cr(` # ${I}${M} $green${k}`,o,!1),o.writefullwidth=void 0;const z=et.useCallback(P=>{const F=P.alt?10:1;Hf(d,Math.min(h,p+F))},[h,p,d]),H=et.useCallback(P=>{const F=P.alt?10:1;Hf(d,Math.max(u,p-F))},[u,p,d]),K=et.useCallback(()=>{A(P=>{const F=!P;if(F){const N=`${m}`;v(N),E(N.length)}else{const N=parseFloat(y),X=isNaN(N)?0:N;Hf(a,Math.min(h,Math.max(u,X)))}return F})},[h,u,y,a,m]);return m!==void 0&&ke.jsxs(ke.Fragment,{children:[r&&!C&&ke.jsx(ja,{MOVE_LEFT:H,MOVE_RIGHT:z,OK_BUTTON:K}),C&&ke.jsxs(bb,{blockhotkeys:!0,children:[ke.jsx($S,{hotkey:"ctrl+c",children:()=>{console.info("copy")}}),ke.jsx($S,{hotkey:"ctrl+v",children:()=>{console.info("paste")}}),ke.jsx($S,{hotkey:"ctrl+a",children:()=>{console.info("select all")}}),ke.jsx(ja,{MOVE_LEFT:()=>{E(P=>Math.max(0,P-1))},MOVE_RIGHT:()=>{E(P=>Math.min(y.length,P+1))},CANCEL_BUTTON:K,OK_BUTTON:K,keydown:P=>{switch(hr(P.key)){case"delete":y.length>0&&v(F=>JC(F,x,1));break;case"backspace":x>0&&(v(F=>JC(F,x-1,1)),E(F=>Math.max(0,F-1)));break}P.key.length===1&&y.length<o.width*.5&&(v(F=>JC(F,x,0,P.key)),E(F=>F+1))}})]})]})}function Dit({sidebar:t,row:e,active:n,label:r,args:i,context:s}){const o=et.useCallback(()=>{const[,c,...l]=i,u=l.join(" "),h=ui();switch(c){case"wiki":ra(ut,h,async()=>{const d=await U8(u);Z8(h,d)});break;case"inline":window.location.href=u;break;default:window.open(`${c} ${u}`.trim(),"_blank");break}},[i]),a=id(!!n);return sd(t,e,s),Cr(`  $purple$16 $yellowOPENIT ${a}${r}`,s,!0),n&&ke.jsx(ja,{OK_BUTTON:o})}function Lit({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){sd(t,n,o);const[a,c,l]=[Kf(s[0],""),Kf(s[1],""),Kf(s[2],"")];let u,h;c===""?(u="L ",h=" H"):l===""?(u="L ",h=` ${c}`):(u=`${c} `,h=` ${l}`);const d=0,m=8,p=fb(e,a),y=GM(p)??0,v=ep(),x=i.trim(),E=id(r);Cr(`$red $29 ${E}${x} `,o,!1);const A=JC("----:----",y,1,`$green${r?v?"$26":"$27":"$4"}${E}`).replaceAll("-","$7").replaceAll(":","$9");Cr(`${E}${u}${A}${h} $green${y+1}`,o,!1);const k=et.useCallback(I=>{const z=I.alt?10:1;Hf(p,Math.min(m,y+z))},[m,y,p]),M=et.useCallback(I=>{const z=I.alt?10:1;Hf(p,Math.max(d,y-z))},[d,y,p]);return ke.jsx(ke.Fragment,{children:r&&ke.jsx(ja,{MOVE_LEFT:M,MOVE_RIGHT:k})})}function Uit({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){sd(t,n,o);const[a,...c]=[Kf(s[0],""),...s.slice(1)],l=[],u=[];for(let A=0;A<c.length;A+=2)l.push(c[A]),u.push(c[A+1]);const h=fb(e,a),m=`${GM(h)??0}`;let p=u.indexOf(m);p<0&&(p=0);const g=ep(),y=i.trim(),v=id(r);Cr(`$dkred ? ${v}${y} `,o,!1);const x=r?g?"$26":"$27":"/";Cr(`${p+1}$green${x}${v}${u.length}`,o,!1),o.writefullwidth=32,Cr(` $green${l[p]}`,o,!1),o.writefullwidth=void 0;const E=et.useCallback(()=>{const A=Math.min(0,p-1),k=parseFloat(u[A]);Number.isInteger(k)&&Hf(h,k)},[p,h]),C=et.useCallback(()=>{const A=Math.max(u.length-1,p+1),k=parseFloat(u[A]);Number.isInteger(k)&&Hf(h,k)},[p,h]);return ke.jsx(ke.Fragment,{children:r&&ke.jsx(ja,{MOVE_LEFT:E,MOVE_RIGHT:C})})}function Bit({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){sd(t,n,o);const a=Kf(s[0],""),c=fb(e,a),l=Nce(c),u=l?.toJSON()??"",h=ep(),[d,m]=et.useState(0),[p,g]=et.useState(!1),[y,v]=et.useState(void 0),x=`${u} `,E=i.trim(),C=id(r);Cr(`$green $20 ${C}${E} $green`,o,!1);const A=o.x,M=o.y*o.width;o.writefullwidth=32,Cr(`${x}`,o,!1),o.writefullwidth=void 0;const I=ge(y),z=o.width-A-2,H=I?Math.min(y,d):d;let K=I?Math.max(y,d):d;I&&(K!==H&&K===d&&--K,bx(A+H+M,A+K+M,15,8,o)),p&&h&&eP(A+d+M,"",o);function P(){ge(l)&&(m(H),v(void 0),l.delete(H,K-H+1))}return ke.jsxs(ke.Fragment,{children:[r&&ke.jsx(ja,{OK_BUTTON:()=>{l&&(g(!0),m(l.length),v(void 0))}}),p&&ke.jsx(bb,{blockhotkeys:!0,children:ke.jsx(ja,{MOVE_LEFT:F=>{F.shift?ge(y)||v(Vr(d-1,0,u.length)):v(void 0),m(N=>Vr(N-1,0,u.length))},MOVE_RIGHT:F=>{F.shift?ge(y)||v(d):v(void 0),m(N=>Vr(N+1,0,u.length))},CANCEL_BUTTON:()=>{g(!1),m(u.length),v(void 0)},OK_BUTTON:()=>g(!1),keydown:F=>{if(!l)return;const{key:N}=F,X=hr(N),G={alt:F.altKey,ctrl:ib?F.metaKey:F.ctrlKey,shift:F.shiftKey},j=l.toJSON();switch(X){case"delete":I?P():j.length>0&&l.delete(d,1);break;case"backspace":I?P():d>0&&(l.delete(d-1,1),m(q=>Math.max(0,q-1)));break;default:if(G.ctrl)switch(X){case"a":v(0),m(j.length);break;case"c":ge(po())&&po().writeText(l.toJSON()).catch(q=>console.error(q));break;case"v":ge(po())&&po().readText().then(q=>{I&&P(),l.insert(d,q),m(d+q.length)}).catch(q=>console.error(q));break;case"x":ge(po())&&po().writeText(l.toJSON()).then(()=>P()).catch(q=>console.error(q));break}else G.alt||F.key.length===1&&j.length<z&&(l.insert(d,F.key),m(q=>q+1));break}}})})]})}function Fit({sidebar:t,row:e,active:n,label:r,args:i,context:s}){const{setviewimage:o}=Ba(),a=et.useCallback(()=>{const[,...l]=i,u=l.join(" ");o(u)},[o,i]),c=id(!!n);return sd(t,e,s),Cr(`  $purple$16 $cyanVIEWIT ${c}${r}`,s,!0),n&&ke.jsx(ja,{OK_BUTTON:a})}function jit({chip:t,row:e,active:n,label:r,args:i,context:s}){sd(!1,e,s);const[o]=[Kf(i[0],"")],a="z",c=` ${a.toUpperCase()} `,l=id(n),u=s.x-.25,h=s.y-.25;Cr(`${s.iseven?"$black$onltgray":"$black$ondkcyan"}${c}${l}$onclear ${r}${ge(e)?`
`:""}`,s,!0);const d=et.useContext(Eb),m=et.useCallback(()=>{d.sendmessage(V9(t,o),[])},[d,t,o]);return ke.jsxs("group",{position:[u*En.DRAW_CHAR_WIDTH(),h*En.DRAW_CHAR_HEIGHT(),1],children:[ke.jsx(D0,{visible:!1,width:c.length+.5,height:1.5,blocking:!0,onClick:m}),n&&ke.jsx(ja,{OK_BUTTON:m}),ke.jsx($S,{hotkey:a,children:m})]})}function zit({sidebar:t,row:e,item:n,active:r}){const i=ui(),s=ou();if(sd(t,e,s),s.iseven=s.y%2===0,typeof n=="string")return ke.jsx(kit,{sidebar:t,player:i,item:n,row:e,context:s});if(Rr(n)){const[o,a,c,l,...u]=n;if(typeof o!="string"||typeof a!="string"||typeof c!="string")return null;const h={sidebar:t,player:i,chip:o,row:e,active:r,label:a,args:[c,...u],context:s},d=Sn(l)?l:"";switch(hr(d)){default:case"hyperlink":return ke.jsx(Nit,{...h});case"hk":case"hotkey":return ke.jsx(Iit,{...h});case"rn":case"range":return ke.jsx(Lit,{...h});case"sl":case"select":return ke.jsx(Uit,{...h});case"nm":case"number":return ke.jsx(Pit,{...h});case"tx":case"text":return ke.jsx(Bit,{...h});case"copyit":return ke.jsx(Oit,{...h});case"openit":return ke.jsx(Dit,{...h});case"viewit":return ke.jsx(Fit,{...h});case"zssedit":return ke.jsx(jit,{...h});case"charedit":return ke.jsx(wit,{...h});case"coloredit":return ke.jsx(RJ,{...h});case"bgedit":return ke.jsx(RJ,{isbg:!0,...h})}}return null}function Bhe({inline:t=!1,xmargin:e=1,ymargin:n=1,selected:r=-1,width:i,height:s,color:o,bg:a,text:c}){const l=vE(i,s,0,o,a),u=l.getState(),h={...zv(i,s,o,a,n,e,i-e,s-n),...l.getState(),x:e,y:n};return KM(u,0,o,a),ke.jsxs(xE,{store:l,children:[ke.jsx(TE,{width:i,height:s}),ke.jsx(WM.Provider,{value:h,children:c.map((d,m)=>ke.jsx(zit,{row:t?void 0:m,item:d,active:m===r,sidebar:e!==0},m))})]})}const Hit=t=>{const e="nativeEvent"in t?t.nativeEvent:t;return{deltaX:e.deltaX||0,deltaY:e.deltaY||0,deltaZ:e.deltaZ||0,timeStamp:e.timeStamp}},qit=t=>[t.deltaX,t.deltaY,t.deltaZ],tO=t=>{const e=qit(t).map(Math.abs);return Math.max(...e)};var Ay;(function(t){t.ALL_OTHER_CHECKS_FAILED="ALL_OTHER_CHECKS_FAILED",t.NO_PREVIOUS_EVENT_TO_COMPARE="NO_PREVIOUS_EVENT_TO_COMPARE",t.PAST_TIMESTAMP_EVENT="PAST_TIMESTAMP_EVENT",t.ENOUGH_TIME_PASSED="ENOUGH_TIME_PASSED",t.NON_DECREASING_DELTAS_OF_KNOWN_HUMAN="NON_DECREASING_DELTAS_OF_KNOWN_HUMAN",t.DELTA_MODULE_HAS_BEEN_INCREASING="DELTA_MODULE_HAS_BEEN_INCREASING"})(Ay||(Ay={}));class Vit{sensitivity;delay;increasingDeltasThreshold;previousEvents;constructor({sensitivity:e=2,delay:n=100,increasingDeltasThreshold:r=3}={}){this.sensitivity=Math.max(1,e),this.delay=Math.max(1,n),this.increasingDeltasThreshold=Math.max(2,r),this.previousEvents=[]}check(e){if(!(("nativeEvent"in e?e.nativeEvent:e)instanceof Event))throw new Error(`"${e}" is not a valid event`);const r=Hit(e);if(tO(r)<this.sensitivity)return!1;const{isHuman:i}=this.isHuman(r);return i?this.previousEvents=[r]:r.timeStamp>(this.previousEvents.at(-1)?.timeStamp||0)&&this.previousEvents.push(r),i}isHuman(e){const n=this.previousEvents.at(-1);if(!n)return{isHuman:!0,reason:Ay.NO_PREVIOUS_EVENT_TO_COMPARE};if(e.timeStamp<n.timeStamp)return{isHuman:!1,reason:Ay.PAST_TIMESTAMP_EVENT};if(e.timeStamp>n.timeStamp+this.delay)return{isHuman:!0,reason:Ay.ENOUGH_TIME_PASSED};const s=tO(e),o=tO(n);if(s>=o){if(this.previousEvents.length===1)return{isHuman:!0,reason:Ay.NON_DECREASING_DELTAS_OF_KNOWN_HUMAN};if(this.increasingDeltasThreshold<=2||this.previousEvents.length>=this.increasingDeltasThreshold&&this.previousEvents.slice(-this.increasingDeltasThreshold).map(tO).every((u,h,d)=>h===0||u>d[h-1]))return{isHuman:!0,reason:Ay.DELTA_MODULE_HAS_BEEN_INCREASING}}return{isHuman:!1,reason:Ay.ALL_OTHER_CHECKS_FAILED}}}const Git=new Vit({sensitivity:ib?7:2}),CJ=4,$it=.75;function Wit(t){const e=Vr(t,-CJ,CJ);return Math.round(e*$it)}function G9({debug:t=!1,disabled:e=!1,blocking:n=!0,cursor:r="pointer",x:i=0,y:s=0,width:o=30,height:a=10,children:c,onScroll:l,...u}){return ke.jsxs("group",{...u,children:[ke.jsx(D0,{blocking:n,cursor:r,visible:t,x:i,y:s,width:o,height:a,onWheel:h=>{e||!Git.check(h)||l?.(Wit(h.deltaY))}}),c]})}const Kit=2,Xit=14,Fhe=Xit*Kit;function Yit(t){return Wee(t,Fhe*.5)}function Zit(t,e,n,r,i=1.235){function s(a){return mtt(a,r)}im(t.userData,e,n,i,r,Fhe*12,s),t.position[e]=Yit(t.userData[e]);const o=n-t.position.y;return Math.abs(o)<.1}function Jit({name:t,width:e,height:n,context:r}){const i=Ele();for(let c=1;c<e-1;++c)c>2&&c<e-1&&ec(i,e,n,c,1,{char:205,color:15}),ec(i,e,n,c,n-1,{char:205,color:15});ec(i,e,n,e-2,0,{char:196,color:15}),ec(i,e,n,1,0,{char:205,color:15}),ec(i,e,n,2,0,{char:187,color:15}),ec(i,e,n,2,1,{char:200,color:15});for(let c=1;c<n-1;++c)ec(i,e,n,0,c,{char:179,color:15}),ec(i,e,n,e-1,c,{char:179,color:15});for(let c=2;c<n-1;++c)ec(i,e,n,1,c,{char:0,color:15}),ec(i,e,n,e-2,c,{char:0,color:15});ec(i,e,n,0,0,{char:213,color:15}),ec(i,e,n,e-1,0,{char:191,color:15}),ec(i,e,n,e-1,1,{char:181,color:15}),ec(i,e,n,0,n-1,{char:212,color:15}),ec(i,e,n,e-1,n-1,{char:190,color:15});const s=` ${t} `,a=pb(s,e,n)?.x??s.length;return r.x=Math.round(e*.5),r.x-=Math.round(a*.5),r.y++,Cr(s,r,!0),null}function Qit({store:t,children:e}){return ke.jsx(yle.Provider,{value:t,children:e})}function est({width:t,height:e}){const n=et.useContext(yle),[r]=M7(n,iu(i=>[i.dither,i.render]));return t>0&&e>0&&ke.jsx(xv,{alphas:r.slice(),width:t,height:e})}function AJ({x:t,y:e,color:n,on:r=232,off:i=7,alt:s}){const o=ep(),a=Ele(),c=et.useRef(0),l=ge(s)?c.current%2===0?r:s:r;return ec(a,a.width,a.height,t,e,{char:o?l:i,color:n}),a.changed(),o&&++c.current,null}function tst({row:t,width:e,height:n,panelwidth:r,panelheight:i,children:s}){const o=eGe(r,i,0),a=[.001,.05,.1,.2],c=.4,{dither:l}=o.getState();QVe(l);for(let u=0;u<r;++u){F4(l,r,i,u,t,c);for(let h=0;h<a.length;++h){const d=a.length-h;F4(l,r,i,u,t-d,a[h]),F4(l,r,i,u,t+d,a[h])}}return ke.jsxs(ke.Fragment,{children:[ke.jsx(TE,{width:e,height:n}),ke.jsxs("group",{position:[2*En.DRAW_CHAR_WIDTH(),2*En.DRAW_CHAR_HEIGHT(),0],children:[ke.jsx(Qit,{store:o,children:ke.jsx(est,{width:r,height:i})}),s,ke.jsx(AJ,{x:1,y:1}),ke.jsx(AJ,{x:1,y:2+t,on:26,alt:27,off:45,color:12})]})]})}function $9({line:t,color:e,margin:n,y:r,leftedge:i,rightedge:s,context:o}){const a=ep(),l=`$${(en[e]??"").toLowerCase()} ${t.replaceAll(`
`,"").trim()} --=--`,h=pb(l,1e4,1)?.measuredwidth??1,[d,m]=et.useState(0);et.useEffect(()=>{m(p=>a?p:(p-1)%h)},[a,h]),o.disablewrap=!0,o.active.leftedge=n,o.active.rightedge=s-n;for(let p=i+n+d;p<=s;p+=h)o.x=p,o.y=r,Cr(l,o,!1);return o.active.leftedge=0,o.active.rightedge=s,o.disablewrap=!1,null}function nst({width:t,height:e,color:n,bg:r,text:i,shouldclose:s}){const{viewport:o}=Hh(),a=t-3,c=e-3,l=vE(t,e,0,n,r),u=et.useContext(Eb),h=i.length-1,d=Si(I=>I.gadget.scrollname??""),m={...zv(t,e,n,r,0,0,t,e),...l.getState()},[p,g]=et.useState(()=>{const I=i.findIndex(z=>Rr(z));return I>=0&&I<=8?I:0});let y=p-Math.floor(c*.5);y=Math.min(i.length-c,y),y=Math.max(0,y);const v=i.slice(y,y+c),x=p-y,E=et.useRef(null),C=et.useCallback(()=>{s&&u.didclose()},[s,u]),A=et.useCallback(I=>{const z=I.ctrl?h:I.alt?10:1;g(H=>Math.max(0,H-z))},[g,h]),k=et.useCallback(I=>{const z=I.ctrl?h:I.alt?10:1;g(H=>Math.min(h,H+z))},[g,h]),M=et.useCallback(I=>{g(z=>Vr(Math.round(z+I),0,h))},[g,h]);return et.useEffect(()=>{if(E.current&&!s){const I=o.height;E.current.position.y=I,E.current.userData.y=I,E.current.userData.vy=0}},[s]),Jd(et.useCallback((I,z)=>{if(ge(E.current)){const H=s?e*2*-En.DRAW_CHAR_HEIGHT():0;Zit(E.current,"y",H,z)&&C()}},[s,C,e])),ke.jsxs("group",{ref:E,"position-y":1e6,children:[ke.jsx(G9,{blocking:!0,x:0,y:0,width:t,height:e,onScroll:I=>M(I*.5)}),ke.jsxs(bb,{children:[ke.jsx(ja,{MOVE_UP:A,MOVE_DOWN:k,CANCEL_BUTTON:u.sendclose}),ke.jsxs(xE,{store:l,children:[ke.jsx(Jit,{name:d,width:t,height:e,context:m}),ke.jsx($9,{margin:3,color:en.BLUE,y:0,leftedge:0,rightedge:t,line:`
   up/down$white.SCROLL UP/DOWN   $blue
esc/cancel$white.CLOSE SCROLL   $blue
alt+up/down$white.JUMP 10 LINES   $blue
`,context:m}),ke.jsx(tst,{row:x,width:t,height:e,panelwidth:a,panelheight:c,children:ke.jsx(Bhe,{width:a,height:c,xmargin:0,ymargin:0,color:n,bg:en.ONCLEAR,text:v,selected:x})})]})]})]})}function rst(){const t=rv(iu(r=>r.pts)),e=vE(wn,Nr,0,en.BLBLACK,en.ONCLEAR),n=e.getState();KM(n,0,en.BLBLACK,en.ONCLEAR);for(let r=0;r<t.length;++r){const i=t[r];ec(n,wn,Nr,i.x,i.y,{char:177})}return ke.jsx("group",{"position-z":100,children:ke.jsx(xE,{store:e,children:ke.jsx(TE,{width:wn,height:Nr})})})}const zN=new jt;function MJ(){const t=En.DRAW_CHAR_WIDTH(),e=En.DRAW_CHAR_HEIGHT(),n=Math.floor(zN.x/t),r=Math.floor((zN.y+e*.5)/e);return{x:n,y:Nr*.5+r}}function ist(){const t=js(u=>u.inspector),[e,n]=rv(iu(u=>[u.cursor,u.select])),r=dx(e??0,wn),i=dx(n??e??0,wn),s={x:Math.min(r.x,i.x),y:Math.min(r.y,i.y)},o={x:Math.max(r.x,i.x),y:Math.max(r.y,i.y)},a=o.x-s.x+1,c=o.y-s.y+1;function l(){an(rv.getState().cursor)&&rxe(ut,ui(),s,o),rv.setState(()=>({cursor:void 0,select:void 0}))}return ke.jsxs(ke.Fragment,{children:[t&&ke.jsx(D0,{visible:!0,opacity:0,color:"black",x:0,y:0,z:-1,width:wn,height:Nr,cursor:"pointer",onPointerDown:u=>{u.intersections[0].object.worldToLocal(zN.copy(u.intersections[0].point));const h=MJ();rv.setState(()=>({cursor:Wc(h,wn)}))},onPointerMove:u=>{if(ge(rv.getState().cursor)){u.intersections[0].object.worldToLocal(zN.copy(u.intersections[0].point));const h=MJ();rv.setState(()=>({select:Wc(h,wn)}))}},onPointerUp:l,onPointerOut:l,onPointerCancel:l}),ge(e)&&ke.jsxs(ke.Fragment,{children:[ke.jsx(D0,{x:s.x+.25,y:s.y+.25,z:100,width:a-.5,height:c-.5,color:"black",opacity:.3}),ke.jsx(D0,{x:s.x,y:s.y,z:101,width:a,height:c,color:"white",opacity:.25})]})]})}function sst(){return js(e=>e.inspector)&&ke.jsxs(ke.Fragment,{children:[ke.jsx(ist,{}),ke.jsx(rst,{})]})}const ost=v3,ast=fx(lE(Yx)),kJ=g0(uE(Xx)),cst=new Fa({transparent:!1,side:Zl,uniforms:{time:Pd,interval:_2,smoothrate:new yn(ost),palette:new yn(ast),map:new yn(kJ),alt:new yn(kJ),dpr:new yn(1),screenwidth:new yn(1),screenheight:new yn(1),pointSize:{value:new Vn(1,1)},rows:new yn(1),step:new yn(new Vn),size:new yn(new Vn),pixel:new yn(new Vn),flip:new yn(!0)},vertexShader:`
    attribute float visible;
    attribute vec4 charData;
    attribute vec3 lastPosition;
    attribute vec2 lastColor;
    attribute vec2 lastBg;
    attribute vec2 animShake;
    attribute vec2 animBounce;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;
    uniform float screenwidth;
    uniform float screenheight;
    uniform float tindex;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    ${x2}

    float PI = radians(180.0);

    float rand(float co) {
      return fract(sin(co*(91.3458)) * 47453.5453);
    }

    vec3 colorFromIndex(float index) {
      return palette[int(index)];
    }

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = colorFromIndex(index);
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vCharData.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      vVisible = visible;

      float deltaPosition = clamp((time - lastPosition.z) * smoothrate, 0.0, 1.0);
      vec2 animPosition = mix(lastPosition.xy, position.xy, deltaPosition);

      float deltaShake = 1.0 - animDelta(animShake.y, smoothrate * 0.5, 1.0); 
      animPosition += vec2(
        deltaShake - rand(cos(time) + animShake.x) * deltaShake * 2.0,
        deltaShake - rand(sin(time) + animShake.x) * deltaShake * 2.0
      ) * 0.5;

      float deltaBounce = 1.0 - abs(1.0 - animDelta(animBounce.y, smoothrate, 2.0));
      animPosition.y -= smoothstep(0.0, 1.0, deltaBounce);

      float deltaColor = animDelta(lastColor.y, smoothrate, 1.0);
      int sourceColori = int(lastColor.x);
      int destColori = int(charData.z);

      vec3 sourceColor;
      if (sourceColori > 32) {
        sourceColor = palette[sourceColori - 33];
      } else {
        sourceColor = palette[sourceColori % 16];
      }

      vec3 destColor;
      if (destColori > 32) {
        destColor = palette[destColori - 33];
      } else {
        destColor = palette[destColori % 16];
      }

      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastBg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastBg.x);
      vec4 destBg = bgFromIndex(charData.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      if (destColori > 31) {
        vColor = mix(vBg.rgb, vColor, cyclefromtime());
      }

      vCharData.xy = charData.xy;

      animPosition *= pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x -= 1.0;

      // model space
      vec4 mvPosition = vec4(animPosition, 0.0, 1.0);
      #ifdef USE_INSTANCING
      	mvPosition = instanceMatrix * mvPosition;
      #endif
      mvPosition = modelViewMatrix * mvPosition;
  
      // transform to screenspace 
      gl_Position = projectionMatrix * mvPosition;

      // this handles things being scaled
      float fov = 2.0 * atan(1.0 / projectionMatrix[1][1]) * 180.0 / PI;
      float heightOfNearPlane = screenheight / (2.0 * tan(0.5 * fov * PI / 180.0));
      gl_PointSize = (heightOfNearPlane * pointSize.y) / gl_Position.w;
    }
  `,fragmentShader:`
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 size;
    uniform vec2 pixel;
    uniform vec2 pointSize;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      float xscale = pointSize.y / pointSize.x;
      float xpadding = (pointSize.y - pointSize.x) / pointSize.y;
      float px = gl_PointCoord.x * xscale - xpadding;      
      
      if (vVisible == 0.0 || px < 0.0 || px > 1.0) {
        discard;
      }
      
      float py = gl_PointCoord.y;
      if (flip) {
        py = 1.0 - py;
      }

      vec2 idx = vec2(px, py) * size * pixel;
      vec2 lookup = vec2(vCharData.x, rows - vCharData.y) * step * pixel;
      vec2 uv = lookup + idx + vec2(1.0, 1.0) * pixel;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function lst(){return v2(cst)}const ust=v3,fst=fx(lE(Yx)),OJ=g0(uE(Xx)),hst=new Fa({transparent:!1,side:Zl,uniforms:{time:Pd,interval:_2,smoothrate:new yn(ust),palette:new yn(fst),map:new yn(OJ),alt:new yn(OJ),dpr:new yn(1),screenwidth:new yn(1),screenheight:new yn(1),pointSize:new yn(new Vn),rows:new yn(1),step:new yn(new Vn),size:new yn(new Vn),pixel:new yn(new Vn),flip:new yn(!0)},vertexShader:`
    attribute float visible;
    attribute vec4 charData;
    attribute vec3 lastPosition;
    attribute vec2 lastColor;
    attribute vec2 lastBg;
    attribute vec2 animShake;
    attribute vec2 animBounce;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;
    uniform float tindex;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    ${x2}

    float rand(float co) {
      return fract(sin(co*(91.3458)) * 47453.5453);
    }

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = palette[int(index)];
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vCharData.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      vVisible = visible;

      float deltaPosition = clamp((time - lastPosition.z) * smoothrate, 0.0, 1.0);
      vec2 animPosition = mix(lastPosition.xy, position.xy, deltaPosition);

      float deltaShake = 1.0 - animDelta(animShake.y, smoothrate * 0.5, 1.0); 
      animPosition += vec2(
        deltaShake - rand(cos(time) + animShake.x) * deltaShake * 2.0,
        deltaShake - rand(sin(time) + animShake.x) * deltaShake * 2.0
      ) * 0.5;

      float deltaBounce = 1.0 - abs(1.0 - animDelta(animBounce.y, smoothrate, 2.0));
      animPosition.y -= smoothstep(0.0, 1.0, deltaBounce);

      float deltaColor = animDelta(lastColor.y, smoothrate, 1.0);
      int sourceColori = int(lastColor.x);
      int destColori = int(charData.z);

      vec3 sourceColor;
      if (sourceColori > 32) {
        sourceColor = palette[sourceColori - 33];
      } else {
        sourceColor = palette[sourceColori % 16];
      }

      vec3 destColor;
      if (destColori > 32) {
        destColor = palette[destColori - 33];
      } else {
        destColor = palette[destColori % 16];
      }

      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastBg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastBg.x);
      vec4 destBg = bgFromIndex(charData.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      if (destColori > 31) {
        vColor = mix(vBg.rgb, vColor, cyclefromtime());
      }

      vCharData.xy = charData.xy;

      animPosition *= pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x -= 1.0;

      vec4 mvPosition = vec4(animPosition, 0.0, 1.0);
      #ifdef USE_INSTANCING
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;

      // this handles things being scaled
      gl_PointSize = pointSize.y * modelViewMatrix[0][0] * dpr;
    }
  `,fragmentShader:`
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 size;
    uniform vec2 pixel;
    uniform vec2 pointSize;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      float xscale = pointSize.y / pointSize.x;
      float xpadding = (pointSize.y - pointSize.x) / pointSize.y;
      float px = gl_PointCoord.x * xscale - xpadding;      
      if (vVisible == 0.0 || px < 0.0 || px > 1.0) {
        discard;
      }
      float py = gl_PointCoord.y;
      if (flip) {
        py = 1.0 - py;
      }

      vec2 idx = vec2(px, py) * size * pixel;
      vec2 lookup = vec2(vCharData.x, rows - vCharData.y) * step * pixel;
      vec2 uv = lookup + idx + vec2(1.0, 1.0) * pixel;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function dst(){return v2(hst)}const IJ=2048;function pst({sprites:t}){const e=et.useRef(null),n=et.useRef([]);return et.useMemo(()=>{n.current.length===0&&(n.current=Array.from({length:IJ},()=>({id:"",x:0,y:0,char:0,color:0,bg:0,stat:0})));const r={};for(let o=0;o<t.length;++o)r[t[o].id]=t[o];const i=new Set(n.current.map(o=>o.id));let s=0;for(let o=0;o<IJ;++o)if(n.current[o].id){const a=r[n.current[o].id];ge(a)?n.current[o]={...a}:n.current[o].id=""}else if(s<t.length){for(;i.has(t[s]?.id)===!0;)++s;s<t.length&&(n.current[o]={...t[s++]})}},[t]),et.useEffect(()=>{const{current:r}=e,{current:i}=n;if(!r||!i)return;let s=r.getAttribute("visible"),o=r.getAttribute("lastVisible"),a=r.getAttribute("position"),c=r.getAttribute("charData"),l=r.getAttribute("lastPosition"),u=r.getAttribute("lastColor"),h=r.getAttribute("lastBg"),d=r.getAttribute("animShake"),m=r.getAttribute("animBounce");if(!s||s.count!==i.length){s=new Pa(new Float32Array(i.length),1),o=new Pa(new Float32Array(i.length),1),a=new Pa(new Float32Array(i.length*3),3),c=new Pa(new Float32Array(i.length*4),4),l=new Pa(new Float32Array(i.length*3),3),u=new Pa(new Float32Array(i.length*2),2),h=new Pa(new Float32Array(i.length*2),2),d=new Pa(new Float32Array(i.length*2),2),m=new Pa(new Float32Array(i.length*2),2);for(let p=0;p<i.length;++p){const g=i[p],y=g.id?1:0;s.setX(p,y),o.setX(p,y),a.setXY(p,g.x,g.y),c.setXYZW(p,g.char%Jp,Math.floor(g.char/Jp),g.color,g.bg),l.setXYZ(p,g.x,g.y,Pd.value),u.setXY(p,g.color,Pd.value),h.setXY(p,g.bg,Pd.value),d.setXY(p,0,Pd.value-1e6),m.setXY(p,0,Pd.value-1e6)}r.setAttribute("visible",s),r.setAttribute("lastVisible",o),r.setAttribute("position",a),r.setAttribute("charData",c),r.setAttribute("lastPosition",l),r.setAttribute("lastColor",u),r.setAttribute("lastBg",h),r.setAttribute("animShake",d),r.setAttribute("animBounce",m)}else for(let p=0;p<i.length;++p){const g=i[p],y=a.getX(p),v=a.getY(p),x=c.getX(p),E=c.getY(p),C=c.getZ(p),A=c.getW(p);o.setX(p,s.getX(p)),o.needsUpdate=!0,s.setX(p,g.id?1:0),s.needsUpdate=!0;const k=o.getX(p)===0&&s.getX(p)===1;(k||y!==g.x||v!==g.y)&&(l.setXYZ(p,k?g.x:y,k?g.y:v,Pd.value),l.needsUpdate=!0,a.setXY(p,g.x,g.y),a.needsUpdate=!0),(k||C!==g.color)&&(u.setXY(p,k?g.color:C,Pd.value),u.needsUpdate=!0,c.setZ(p,g.color),c.needsUpdate=!0),(k||A!==g.bg)&&(h.setXY(p,k?g.bg:A,Pd.value),h.needsUpdate=!0,c.setW(p,g.bg),c.needsUpdate=!0);const M=g.char%Jp,I=Math.floor(g.char/Jp);(x!==M||E!==I)&&(c.setXY(p,M,I),c.needsUpdate=!0)}r.computeBoundingBox(),r.computeBoundingSphere()},[t]),ke.jsx("bufferGeometry",{ref:e})}function dM({sprites:t,scale:e=1,fliptexture:n=!0,withbillboards:r=!1}){const{viewport:i}=Hh(),s=Ba(h=>h.palettedata),o=Ba(h=>h.spritecharsetdata),a=Ba(h=>h.spritealtcharsetdata),c=et.useMemo(()=>r?lst():dst(),[r]),{width:l=0,height:u=0}=o?.image??{};return et.useEffect(()=>{if(!o)return;const h=sf+2,d=of+2,m=Math.round(u/d);c.uniforms.palette.value=s,c.uniforms.map.value=o,c.uniforms.alt.value=a??o,c.uniforms.dpr.value=e,c.uniforms.screenwidth.value=i.width,c.uniforms.screenheight.value=i.height,c.uniforms.rows.value=m-1,c.uniforms.step.value.x=h,c.uniforms.step.value.y=d,c.uniforms.size.value.x=sf,c.uniforms.size.value.y=of,c.uniforms.pixel.value.x=1/l,c.uniforms.pixel.value.y=1/u,c.uniforms.pointSize.value.x=En.DRAW_CHAR_WIDTH(),c.uniforms.pointSize.value.y=En.DRAW_CHAR_HEIGHT(),c.uniforms.flip.value=n,c.needsUpdate=!0},[s,o,a,c,l,u,n,i.width,i.height,e]),ke.jsxs("points",{frustumCulled:!1,children:[ke.jsx(pst,{sprites:t}),ke.jsx("primitive",{object:c,attach:"material"})]})}function Tv({id:t,z:e,from:n}){const r=Si(iu(i=>i.gadget[n]?.find(s=>s.id===t)));switch(r?.type){default:case zs.BLANK:case zs.MEDIA:return null;case zs.TILES:return ke.jsx("group",{position:[0,0,e],children:ke.jsx(L0,{width:r.width,height:r.height,char:[...r.char],color:[...r.color],bg:[...r.bg]})},r.id);case zs.SPRITES:return ke.jsx("group",{position:[0,0,e],children:ke.jsx(dM,{sprites:[...r.sprites],fliptexture:!1})},r.id);case zs.DITHER:return ke.jsx("group",{position:[0,0,e],children:ke.jsx(xv,{width:r.width,height:r.height,alphas:[...r.alphas]})},r.id)}}function FP({id:t,from:e}){const n=Ba(),r=Si(iu(s=>s.gadget[e]?.find(o=>o.id===t))),i=r?.type===zs.MEDIA?r:void 0;return et.useEffect(()=>{switch(i?.mime){case"image/palette":Rr(i.media)&&n.setpalette(dL(ux,Kne,i.media));break;case"image/charset":Rr(i.media)&&n.setcharset(dL(Jp*sf,h5*of,i.media));break;case"image/altcharset":Rr(i.media)&&n.setaltcharset(dL(Jp*sf,h5*of,i.media));break;case"text/mood":Sn(i.media)&&n.setmood(i.media);break;case"text/players":Sn(i.media);break}},[n,i]),null}const NJ=t=>(t.getAttributes()&Wh.CONVOLUTION)===Wh.CONVOLUTION,mst=et.memo(et.forwardRef(({children:t,camera:e,width:n,height:r},i)=>{const{gl:s,scene:o}=Hh(),[a]=et.useMemo(()=>{const u=new phe(s,{depthBuffer:!0,stencilBuffer:!1,multisampling:0,frameBufferType:ab});return u.autoRenderToScreen=!1,u.addPass(new ghe(o,e)),[u]},[e,s,o]);Jd((u,h)=>{a.setSize(n,r),a.render(h)},1);const c=et.useRef(null);et.useLayoutEffect(()=>{const u=[],h=c.current.__r3f;if(h&&a){const d=h.children;for(let m=0;m<d.length;m++){const p=d[m].object;if(p instanceof Tg){const g=[p];if(!NJ(p)){let v=null;for(;(v=d[m+1]?.object)instanceof Tg&&!NJ(v);)g.push(v),m++}const y=new _he(e,...g);u.push(y)}else p instanceof rd&&u.push(p)}for(const m of u)a?.addPass(m)}return()=>{for(const d of u)a?.removePass(d)}},[a,t,e]);const l=et.useMemo(()=>({composer:a,normalPass:null,downSamplingPass:null,resolutionScale:void 0,camera:e,scene:o}),[a,e,o]);return et.useImperativeHandle(i,()=>a,[a]),ke.jsx(L9.Provider,{value:l,children:ke.jsx("group",{ref:c,children:t})})})),gst=et.forwardRef(function({children:e,fbo:n,...r},i){const[s]=et.useState(()=>new mI);return et.useImperativeHandle(i,()=>n,[n]),ke.jsxs(ke.Fragment,{children:[TEe(ke.jsxs(ke.Fragment,{children:[e,ke.jsx("group",{onPointerOver:()=>null})]}),s),ke.jsx("primitive",{object:n.texture,...r})]})});function _st({fbo:t,effects:e}){const{mood:n}=Ba(),[r]=et.useState(()=>new hhe(t,!0));return et.useEffect(()=>()=>{r.dispose()},[r]),ke.jsxs(ke.Fragment,{children:[n.includes("dark")&&ke.jsxs(et.Fragment,{children:[ke.jsx(frt,{delay:[10,120],duration:[.1,3],strength:[0,1],mode:Iy.SPORADIC,active:!0,ratio:.5}),ke.jsx(hrt,{opacity:.5,premultiply:!0,blendFunction:bi.DARKEN})]},"mood"),n.includes("bright")&&ke.jsx(et.Fragment,{children:ke.jsx(urt,{intensity:.111,mipmapBlur:!1,luminanceThreshold:.5,luminanceSmoothing:.001,kernelSize:E2.VERY_LARGE})},"mood"),e,ke.jsx("primitive",{object:r,dispose:null})]})}function jP({camera:t,viewwidth:e,viewheight:n,effects:r,children:i}){const{mood:s}=Ba(),{viewport:o}=Hh(),a=che(e*o.dpr,n*o.dpr,{samples:0,stencilBuffer:!1,depthBuffer:!0,generateMipmaps:!1}),c=e*.5,l=n*.5;return ke.jsx(ke.Fragment,{children:ke.jsxs("mesh",{position:[c,l,0],children:[ke.jsx("planeGeometry",{args:[e,n]}),ke.jsx("meshBasicMaterial",{transparent:!0,children:ke.jsxs(gst,{attach:"map",fbo:a,children:[i,ke.jsx(mst,{camera:t,width:e,height:n,children:ke.jsx(_st,{fbo:a,effects:r})},s)]})})]})})}function vst({width:t,height:e}){const n=Kv(),r=t*En.DRAW_CHAR_WIDTH(),i=e*En.DRAW_CHAR_HEIGHT(),s=et.useRef(null),o=et.useRef(null),a=et.useRef(null),c=et.useRef(null),l=et.useRef(null),[,u]=et.useState(!1);et.useLayoutEffect(()=>{u(!0)},[]),Jd((A,k)=>{if(!s.current||!o.current||!a.current||!c.current||!l.current)return;const M=Kx(Si.getState().gadget.layers??[]);ge(s.current.userData.focusx)||(s.current.userData={focusx:M.focusx,focusy:M.focusy,tfocusx:M.focusx,tfocusy:M.focusy,facing:M.facing},a.current.scale.setScalar(M.viewscale));const I=En.DRAW_CHAR_WIDTH(),z=En.DRAW_CHAR_HEIGHT(),H=wn*I,K=Nr*z,P=.25;rb(a.current.scale,M.viewscale,P,k);const F=a.current.scale.x,N=s.current.userData.focusx+.5,X=s.current.userData.focusy+.5,G=N*I*F+H*-.5,j=X*z*F+K*-.5;rb(o.current.position,[-G,-j,0],.05,k),r>H*F?s.current.userData.tfocusx=wn*.5:s.current.userData.tfocusx=M.focusx,i>K*F?s.current.userData.tfocusy=Nr*.5:s.current.userData.tfocusy=M.focusy,im(s.current.userData,"focusx",s.current.userData.tfocusx,P),im(s.current.userData,"focusy",s.current.userData.tfocusy,P),c.current.position.x=r*.5-H*.5+o.current.position.x,c.current.position.y=i*.5-K*.5+o.current.position.y,l.current.scale.setScalar(F),s.current.position.x=A.size.width*.5,s.current.position.y=A.size.height*.5,s.current.updateProjectionMatrix()}),Si(A=>A.gadget.over?.length??0),Si(A=>A.gadget.under?.length??0),Si(A=>A.gadget.layers?.length??0);const{over:h=[],under:d=[],layers:m=[]}=Si.getState().gadget,p=d.length===0,g=En.DRAW_CHAR_WIDTH(),y=En.DRAW_CHAR_HEIGHT(),v=wn*g,x=Nr*y,E=v*-.5+n.marginx,C=x*-.5-n.marginy;return ke.jsxs(ke.Fragment,{children:[m.map(A=>ke.jsx(FP,{id:A.id,from:"layers"},`media${A.id}`)),ke.jsx("group",{ref:c,children:ke.jsx("group",{ref:l,children:ke.jsx(sst,{})})}),ke.jsx("orthographicCamera",{ref:s,left:r*-.5,right:r*.5,top:i*-.5,bottom:i*.5,near:1,far:2e3,position:[0,0,1e3]}),s.current&&ke.jsx(jP,{camera:s.current,viewwidth:r,viewheight:i,effects:ke.jsx(ke.Fragment,{}),children:ke.jsx("group",{position:[E,C,0],children:ke.jsx("group",{ref:o,children:ke.jsxs("group",{ref:a,children:[p&&ke.jsx(D0,{color:"black",width:wn,height:Nr}),d.map((A,k)=>ke.jsx(Tv,{from:"under",id:A.id,z:k*2},A.id)),m.map((A,k)=>ke.jsx(Tv,{from:"layers",id:A.id,z:d.length+k*2},A.id)),h.map((A,k)=>ke.jsx(Tv,{from:"over",id:A.id,z:d.length+m.length+k*2},A.id))]})})})})]})}const yst=fx(lE(Yx)),PJ=g0(uE(Xx)),bst=new Fa({transparent:!1,side:Zl,uniforms:{time:Pd,interval:_2,palette:new yn(yst),map:new yn(PJ),alt:new yn(PJ),cols:new yn(1),rows:new yn(1),step:new yn(new Vn)},vertexShader:`
    uniform float time;
    uniform float interval;

    varying vec2 vUv;
    varying vec3 vColor;

    void main() {
      vUv = uv;
      vColor.xyz = instanceColor.xyz;
      
      vec4 mvPosition = vec4(position, 1.0);
      #ifdef USE_INSTANCING
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
    }
  `,fragmentShader:`
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform vec3 palette[16];
    uniform vec2 step;
    uniform float cols;
    uniform float rows;

    varying vec2 vUv;
    varying vec3 vColor;

    ${x2}

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(gl_FragCoord.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }
      
    void main() {
      // r = char, g = color, b = bg
      int tc = int(cols);
      int ti = int(vColor.r);
      float tx = float(ti % tc);
      float ty = rows - floor(vColor.r / cols);

      int colori = int(vColor.g);
      int bgi = int(vColor.b);

      vec3 color;
      if (colori > 31) {
        vec3 bg = palette[bgi];
        color = palette[colori - 33];
        float cycle = mod(time * 2.5, interval * 2.0) / interval;
        color = mix(bg, color, cyclefromtime());
      } else {
        color = palette[colori % 16];
      }

      vec3 bg = palette[bgi];

      vec2 uv = vUv * step + vec2(tx * step.x, ty * step.y);
      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${en.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function W9(){return v2(bst)}function K9(){const[t]=et.useState(()=>whe());et.useEffect(()=>{t.uniforms.data.value=The(1,1)},[t.uniforms.data]),et.useEffect(()=>{xhe(t.uniforms.data.value,1,1,[.5])},[t,t.uniforms.data.value]);const{position:e,uv:n}=et.useMemo(()=>j9(1,1),[]);return ke.jsxs(ke.Fragment,{children:[ke.jsxs("bufferGeometry",{children:[ke.jsx("bufferAttribute",{attach:"attributes-position",args:[e,3]}),ke.jsx("bufferAttribute",{attach:"attributes-uv",args:[n,2]})]}),ke.jsx("primitive",{object:t,attach:"material"})]})}function Est(){const t=Ba(c=>c.palettedata),e=Ba(c=>c.charsetdata),n=Ba(c=>c.altcharsetdata),[r]=et.useState(()=>W9()),{width:i=0,height:s=0}=e?.image??{};et.useEffect(()=>{r.uniforms.map.value=e,r.uniforms.alt.value=n??e,r.uniforms.palette.value=t;const c=Math.round(i/sf),l=Math.round(s/of);r.uniforms.cols.value=c,r.uniforms.rows.value=l-1,r.uniforms.step.value.x=1/c,r.uniforms.step.value.y=1/l,r.needsUpdate=!0},[t,e,n,r,i,s]);const{position:o,uv:a}=et.useMemo(()=>jrt(1,1),[]);return ke.jsxs(ke.Fragment,{children:[ke.jsxs("bufferGeometry",{children:[ke.jsx("bufferAttribute",{attach:"attributes-position",args:[o,3]}),ke.jsx("bufferAttribute",{attach:"attributes-uv",args:[a,2]})]}),ke.jsx("primitive",{object:r,attach:"material"})]})}function DJ(){const t=Ba(c=>c.palettedata),e=Ba(c=>c.charsetdata),n=Ba(c=>c.altcharsetdata),[r]=et.useState(()=>W9()),{width:i=0,height:s=0}=e?.image??{};et.useEffect(()=>{r.uniforms.map.value=e,r.uniforms.alt.value=n??e,r.uniforms.palette.value=t;const c=Math.round(i/sf),l=Math.round(s/of);r.uniforms.cols.value=c,r.uniforms.rows.value=l-1,r.uniforms.step.value.x=1/c,r.uniforms.step.value.y=1/l,r.needsUpdate=!0},[t,e,n,r,i,s]);const{position:o,uv:a}=et.useMemo(()=>Vrt(1,1),[]);return ke.jsxs(ke.Fragment,{children:[ke.jsxs("bufferGeometry",{children:[ke.jsx("bufferAttribute",{attach:"attributes-position",args:[o,3]}),ke.jsx("bufferAttribute",{attach:"attributes-uv",args:[a,2]})]}),ke.jsx("primitive",{object:r,attach:"material"})]})}function jhe(){const t=Ba(c=>c.palettedata),e=Ba(c=>c.charsetdata),n=Ba(c=>c.altcharsetdata),[r]=et.useState(()=>W9()),i=En.DRAW_CHAR_WIDTH(),s=En.DRAW_CHAR_HEIGHT(),{width:o=0,height:a=0}=e?.image??{};return et.useEffect(()=>{r.uniforms.map.value=e,r.uniforms.alt.value=n??e,r.uniforms.palette.value=t;const c=Math.round(o/sf),l=Math.round(a/of);r.uniforms.cols.value=c,r.uniforms.rows.value=l-1,r.uniforms.step.value.x=1/c,r.uniforms.step.value.y=1/l,r.needsUpdate=!0},[t,e,n,r,o,a]),ke.jsxs(ke.Fragment,{children:[ke.jsx("boxGeometry",{args:[i,s,s]}),ke.jsx("primitive",{object:r,attach:"material"})]})}function X9(t,e,n,r){return{char:t.map((i,s)=>{switch(r[s]){case Qn.ISSWIM:case Qn.ISSOLID:return 0}return i}),color:e.map((i,s)=>{switch(r[s]){case Qn.ISSWIM:case Qn.ISSOLID:return en.ONCLEAR}return i}),bg:n.map((i,s)=>{switch(r[s]){case Qn.ISSWIM:case Qn.ISSOLID:return en.ONCLEAR}return i})}}function zhe(t,e,n,r){return{char:t.map((i,s)=>{switch(r[s]){case Qn.ISSOLID:return i}return 0}),color:e.map((i,s)=>{switch(r[s]){case Qn.ISSOLID:return i}return 0}),bg:n.map((i,s)=>{switch(r[s]){case Qn.ISSOLID:return i}return en.ONCLEAR})}}function Y9(t,e,n,r){return{char:t.map((i,s)=>{switch(r[s]){case Qn.ISSWIM:return i}return 176}),color:e.map((i,s)=>{switch(r[s]){case Qn.ISSWIM:return i}return en.DKGRAY}),bg:n.map((i,s)=>{switch(r[s]){case Qn.ISSWIM:return i}return en.BLACK})}}function Sst({id:t,z:e,from:n}){const r=ui(),i=et.useRef(null),s=et.useRef(null),o=et.useRef(null);Jd(()=>{ge(i.current)&&(i.current.computeBoundingBox(),i.current.computeBoundingSphere()),ge(s.current)&&(s.current.computeBoundingBox(),s.current.computeBoundingSphere()),ge(o.current)&&(o.current.computeBoundingBox(),o.current.computeBoundingSphere())});const a=Si(iu(h=>h.gadget[n]?.find(d=>d.id===t))),c=En.DRAW_CHAR_WIDTH(),l=En.DRAW_CHAR_HEIGHT(),u=Kx(Si.getState().gadget.layers??[]);switch(a?.type){default:case zs.BLANK:case zs.MEDIA:return null;case zs.TILES:{const h=X9(a.char,a.color,a.bg,a.stats),d=Y9(a.char,a.color,a.bg,a.stats);return ke.jsx(ke.Fragment,{children:ke.jsxs("group",{position:[0,0,e],children:[ke.jsx(L0,{width:a.width,height:a.height,char:h.char,color:h.color,bg:h.bg}),ke.jsx("group",{"position-z":l*-.5,children:ke.jsx(L0,{width:a.width,height:a.height,char:d.char,color:d.color,bg:d.bg})}),ke.jsxs(Oy,{ref:s,limit:fg,children:[ke.jsx(jhe,{}),a.stats.map((m,p)=>{const g=dx(p,wn);switch(m){case Qn.ISSOLID:return ke.jsx(cv,{position:[(g.x+.5)*c,(g.y+.5)*l,l*.5],scale:[.9,.9,.9],color:[177,en.DKGRAY,en.BLACK]},p)}return null}).filter(m=>m)]}),ke.jsxs(Oy,{ref:i,limit:fg,children:[ke.jsx(Est,{}),a.stats.map((m,p)=>{const g=dx(p,wn);switch(m){case Qn.ISSOLID:return ke.jsx(cv,{position:[g.x*c,g.y*l,0],color:[a.char[p],a.color[p],a.bg[p]]},p)}return null}).filter(m=>m)]})]},a.id)})}case zs.SPRITES:{const h=.5714285714285714,d=a.sprites.filter(p=>p.stat!==Qn.ISSWIM),m=a.sprites.filter(p=>p.stat===Qn.ISSWIM);return ke.jsxs("group",{position:[0,0,e],children:[ke.jsxs(Oy,{ref:i,limit:fg,children:[ke.jsx(K9,{}),a.sprites.map((p,g)=>ke.jsx(cv,{scale:[1,h,1],position:[p.x*c,(p.y-h+.5+.25)*l,l*-.5+.5]},g))]}),ke.jsxs(Oy,{ref:s,limit:fg,children:[ke.jsx(DJ,{}),d.filter(p=>p.pid!==r).map((p,g)=>ke.jsx(cv,{rotation:[0,0,u.facing],position:[(p.x+1)*c,(p.y-h+.5+.25)*l,l*-.5],color:[p.char,p.color,p.bg]},g))]}),ke.jsxs(Oy,{ref:o,limit:fg,children:[ke.jsx(DJ,{}),m.filter(p=>p.pid!==r).map((p,g)=>ke.jsx(cv,{position:[p.x*c,p.y*l,l*-.5],color:[p.char,p.color,p.bg]},g))]})]},a.id)}case zs.DITHER:return ke.jsx("group",{position:[0,0,e],children:ke.jsx(xv,{width:a.width,height:a.height,alphas:[...a.alphas]})},a.id)}}function xst(t){switch(t.type){case zs.TILES:return 0;case zs.DITHER:return En.DRAW_CHAR_HEIGHT()+1;case zs.SPRITES:return En.DRAW_CHAR_HEIGHT()*.5}return 0}function Tst(t){switch(t){case mo.NEAR:return .1;default:case mo.MID:return .2;case mo.FAR:return .3}}function wst(t){switch(t){case mo.NEAR:return 64;default:case mo.MID:return 16;case mo.FAR:return 0}}function Rst(t){switch(t){case mo.NEAR:return 25;default:case mo.MID:return 45;case mo.FAR:return 90}}function Cst({width:t,height:e}){const n=Kv(),r=En.DRAW_CHAR_WIDTH(),i=En.DRAW_CHAR_HEIGHT(),s=t*r,o=e*i,a=et.useRef(null),c=et.useRef(null),l=et.useRef(null),u=et.useRef(null),h=et.useRef(null),[,d]=et.useState(!1);et.useLayoutEffect(()=>{d(!0)},[]),Jd((x,E)=>{if(!a.current||!c.current||!l.current||!u.current||!h.current)return;const C=Kx(Si.getState().gadget.layers??[]),A=En.DRAW_CHAR_WIDTH(),k=En.DRAW_CHAR_HEIGHT(),M=wn*A,I=Nr*k,z=t*A,H=e*k;ge(u.current.userData.focusx)||(u.current.userData={focusx:C.focusx}),c.current.position.x=0,c.current.position.y=H-I;const K=Vr(z/M,1,10);l.current.position.x=z-M*K,l.current.position.y=0,l.current.scale.setScalar(K);const P=.05;let F=C.focusx-.5,N=C.focusy+.5;F*=-A,N*=-k,SB(a.current.rotation,[0,Math.PI+C.facing,0],P,E),SB(u.current.rotation,[Tst(C.viewscale),0,0],P,E),rb(a.current.position,[x.size.width*.5-F,x.size.height*.5-k*.25+1,N],P,E),rb(u.current.position,[0,0,wst(C.viewscale)],P,E),h.current.bokehScale=5,h.current.cocMaterial.worldFocusRange=1200,h.current.cocMaterial.worldFocusDistance=100,im(u.current,"fov",Rst(C.viewscale),P,E),u.current.updateProjectionMatrix()}),Si(x=>x.gadget.over?.length??0),Si(x=>x.gadget.under?.length??0),Si(x=>x.gadget.layers?.length??0);const{over:m=[],under:p=[],layers:g=[]}=Si.getState().gadget,y=p.length*2+2,v=y+2;return ke.jsxs(ke.Fragment,{children:[g.map(x=>ke.jsx(FP,{id:x.id,from:"layers"},`media${x.id}`)),ke.jsx("group",{ref:a,children:ke.jsx("perspectiveCamera",{ref:u,near:1,far:3e3,aspect:-s/o})}),ke.jsx("group",{ref:l,children:p.map((x,E)=>ke.jsx(Tv,{from:"under",id:x.id,z:E*2},x.id))}),ke.jsx("group",{"position-z":y,children:u.current&&ke.jsx(jP,{camera:u.current,viewwidth:s,viewheight:o,effects:ke.jsx(ke.Fragment,{children:ke.jsx(U9,{ref:h})}),children:ke.jsx("group",{position:[-n.marginx,-n.marginy,-512],children:ke.jsx("group",{rotation:[Math.PI*-.5,0,0],position:[0,i*-.75,0],children:g.map(x=>ke.jsx(Sst,{id:x.id,from:"layers",z:xst(x)},x.id))})})})}),ke.jsx("group",{ref:c,"position-z":v,children:m.map((x,E)=>ke.jsx(Tv,{from:"over",id:x.id,z:E*2},x.id))})]})}function Ast({id:t,z:e,from:n}){const r=et.useRef(null);Jd(()=>{ge(r.current)&&(r.current.computeBoundingBox(),r.current.computeBoundingSphere())});const i=Si(iu(a=>a.gadget[n]?.find(c=>c.id===t))),s=En.DRAW_CHAR_WIDTH(),o=En.DRAW_CHAR_HEIGHT();switch(i?.type){default:case zs.BLANK:case zs.MEDIA:return null;case zs.TILES:{const a=X9(i.char,i.color,i.bg,i.stats),c=zhe(i.char,i.color,i.bg,i.stats),l=Y9(i.char,i.color,i.bg,i.stats);return ke.jsx(ke.Fragment,{children:ke.jsxs("group",{position:[0,0,e],children:[ke.jsx(L0,{width:i.width,height:i.height,char:a.char,color:a.color,bg:a.bg}),ke.jsx("group",{"position-z":o*-.5,children:ke.jsx(L0,{width:i.width,height:i.height,char:l.char,color:l.color,bg:l.bg})}),ke.jsxs(Oy,{ref:r,limit:fg,children:[ke.jsx(jhe,{}),i.stats.map((u,h)=>{const d=dx(h,wn);switch(u){case Qn.ISSOLID:return ke.jsx(cv,{position:[(d.x+.5)*s,(d.y+.5)*o,o*.5],color:[177,en.DKGRAY,en.BLACK]},h)}return null}).filter(u=>u)]}),ke.jsx("group",{"position-z":o+1,children:ke.jsx(L0,{width:i.width,height:i.height,char:c.char,color:c.color,bg:c.bg})})]},i.id)})}case zs.SPRITES:{const a=.5714285714285714,c=i.sprites.filter(u=>u.stat!==Qn.ISSWIM),l=i.sprites.filter(u=>u.stat===Qn.ISSWIM);return ke.jsxs("group",{position:[0,0,e],children:[ke.jsxs(Oy,{ref:r,limit:fg,children:[ke.jsx(K9,{}),i.sprites.map((u,h)=>ke.jsx(cv,{scale:[1,a,1],position:[u.x*s,(u.y+.25)*o,o*-.75+.5]},h))]}),ke.jsx(dM,{sprites:[...c],scale:1.5,fliptexture:!1}),ke.jsx("group",{"position-z":o*-.5,children:ke.jsx(dM,{sprites:[...l],scale:1.5,fliptexture:!1})})]},i.id)}case zs.DITHER:return ke.jsx("group",{position:[0,0,e],children:ke.jsx(xv,{width:i.width,height:i.height,alphas:[...i.alphas]})},i.id)}}function Mst(t){switch(t.type){case zs.TILES:return 0;case zs.DITHER:return En.DRAW_CHAR_HEIGHT()+1;case zs.SPRITES:return En.DRAW_CHAR_HEIGHT()*.75}return 0}function kst(t){switch(t){case mo.NEAR:return 6;default:case mo.MID:return 3;case mo.FAR:return 1.2}}function Ost({width:t,height:e}){const n=Kv(),r=t*En.DRAW_CHAR_WIDTH(),i=e*En.DRAW_CHAR_HEIGHT(),s=et.useRef(null),o=et.useRef(null),a=et.useRef(null),c=et.useRef(null),l=et.useRef(null),u=et.useRef(null),[,h]=et.useState(!1);et.useLayoutEffect(()=>{h(!0)},[]),Jd((v,x)=>{if(!s.current||!o.current||!a.current||!c.current||!l.current||!u.current)return;const E=Kx(Si.getState().gadget.layers??[]),C=En.DRAW_CHAR_WIDTH(),A=En.DRAW_CHAR_HEIGHT(),k=t*En.DRAW_CHAR_WIDTH(),M=e*En.DRAW_CHAR_HEIGHT();ge(c.current.userData.focusx)||(s.current.scale.setScalar(E.viewscale),c.current.userData={focusx:E.focusx,focusy:E.focusy,focuslx:E.focusx,focusly:E.focusy,focusvx:0,focusvy:0,facing:E.facing,focusz:0}),o.current.position.x=0,o.current.position.y=M-A;const I=Vr(k/C,1,10);a.current.position.x=k-C*I,a.current.position.y=0,a.current.scale.setScalar(I);const z=.125,H=c.current.userData.focusx+.5,K=c.current.userData.focusy+.5,P=H*C,F=K*A;switch(rb(s.current.scale,kst(E.viewscale),z,x),rb(c.current.position,[-P,-F,0],z,x),im(c.current.userData,"focusx",E.focusx,z),im(c.current.userData,"focusy",E.focusy,z),l.current.position.x=v.size.width*.5,l.current.position.y=v.size.height*.5,l.current.updateProjectionMatrix(),E.viewscale){case mo.NEAR:u.current.bokehScale=10,u.current.cocMaterial.worldFocusRange=600,u.current.cocMaterial.worldFocusDistance=1e3;break;default:case mo.MID:u.current.bokehScale=10,u.current.cocMaterial.worldFocusRange=1e3,u.current.cocMaterial.worldFocusDistance=1e3;break;case mo.FAR:u.current.bokehScale=10,u.current.cocMaterial.worldFocusRange=1500,u.current.cocMaterial.worldFocusDistance=1e3;break}}),Si(v=>v.gadget.over?.length??0),Si(v=>v.gadget.under?.length??0),Si(v=>v.gadget.layers?.length??0);const{over:d=[],under:m=[],layers:p=[]}=Si.getState().gadget,g=m.length*2+2,y=g+2;return ke.jsxs(ke.Fragment,{children:[ke.jsxs("group",{"position-z":g,children:[p.map(v=>ke.jsx(FP,{id:v.id,from:"layers"},`media${v.id}`)),ke.jsx("orthographicCamera",{ref:l,left:r*-.5,right:r*.5,top:i*-.5,bottom:i*.5,near:1,far:2e3,position:[0,0,1e3]}),l.current&&ke.jsx(jP,{camera:l.current,viewwidth:r,viewheight:i,effects:ke.jsx(ke.Fragment,{children:ke.jsx(U9,{ref:u})}),children:ke.jsx("group",{position:[n.marginx,n.marginy,-500],children:ke.jsx("group",{rotation:[Math.PI*.25,0,Math.PI*-.25],children:ke.jsx("group",{ref:s,children:ke.jsx("group",{ref:c,children:p.map(v=>ke.jsx(Ast,{id:v.id,from:"layers",z:Mst(v)},v.id))})})})})})]}),ke.jsx("group",{ref:a,children:m.map((v,x)=>ke.jsx(Tv,{from:"under",id:v.id,z:x*2},v.id))}),ke.jsx("group",{ref:o,"position-z":y,children:d.map((v,x)=>ke.jsx(Tv,{from:"over",id:v.id,z:x*2},v.id))})]})}function Ist({id:t,z:e,from:n}){const r=et.useRef(null);Jd(()=>{ge(r.current)&&(r.current.computeBoundingBox(),r.current.computeBoundingSphere())});const i=Si(iu(a=>a.gadget[n]?.find(c=>c.id===t))),s=En.DRAW_CHAR_WIDTH(),o=En.DRAW_CHAR_HEIGHT();switch(i?.type){default:case zs.BLANK:case zs.MEDIA:return null;case zs.TILES:{const a=X9(i.char,i.color,i.bg,i.stats),c=zhe(i.char,i.color,i.bg,i.stats),l=Y9(i.char,i.color,i.bg,i.stats);return ke.jsxs("group",{position:[0,0,e],children:[ke.jsx(L0,{width:i.width,height:i.height,char:a.char,color:a.color,bg:a.bg}),ke.jsx("group",{"position-z":o*-.25,children:ke.jsx(L0,{width:i.width,height:i.height,char:l.char,color:l.color,bg:l.bg})}),ke.jsx("group",{"position-z":o*.25,children:ke.jsx(L0,{width:i.width,height:i.height,char:c.char,color:c.color,bg:c.bg})})]},i.id)}case zs.SPRITES:{const a=.5714285714285714,c=i.sprites.filter(u=>u.stat!==Qn.ISSWIM),l=i.sprites.filter(u=>u.stat===Qn.ISSWIM);return ke.jsxs("group",{position:[0,0,e],children:[ke.jsxs(Oy,{ref:r,limit:fg,children:[ke.jsx(K9,{}),i.sprites.map((u,h)=>ke.jsx(cv,{scale:[1,a,1],position:[u.x*s,(u.y+.5)*o,o*-.5+.5]},h))]}),ke.jsx(dM,{sprites:[...c],withbillboards:!0,fliptexture:!1}),ke.jsx("group",{"position-z":o*-.5,children:ke.jsx(dM,{sprites:[...l],withbillboards:!0,fliptexture:!1})})]},i.id)}case zs.DITHER:{const a=new Array((i.width+2)*(i.height+2)).fill(0);for(let l=1;l<wn-1;++l){const u=i.alphas[Wc({x:1+l,y:0},wn)],h=i.alphas[Wc({x:1+l,y:Nr-1},wn)];a[Wc({x:1+l,y:0},wn+2)]=u,a[Wc({x:1+l,y:Nr},wn+2)]=h}for(let l=1;l<Nr-1;++l){const u=i.alphas[Wc({x:0,y:1+l},wn)],h=i.alphas[Wc({x:wn-1,y:1+l},wn)];a[Wc({x:0,y:1+l},wn+2)]=u,a[Wc({x:wn,y:1+l},wn+2)]=h}const c=En.DRAW_CHAR_HEIGHT();return ke.jsxs(ke.Fragment,{children:[ke.jsx("group",{position:[0,0,e],children:ke.jsx(xv,{width:i.width,height:i.height,alphas:[...i.alphas]})},`under${i.id}`),ke.jsx("group",{position:[0,0,e+c],children:ke.jsx(xv,{width:i.width,height:i.height,alphas:[...i.alphas]})},`mid${i.id}`),ke.jsx("group",{position:[0,0,e+c],children:ke.jsx(xv,{width:i.width+2,height:i.height+2,alphas:a})},`over${i.id}`)]})}}}function Nst(t){switch(t.type){case zs.TILES:return 0;case zs.DITHER:return En.DRAW_CHAR_HEIGHT()+1;case zs.SPRITES:return En.DRAW_CHAR_HEIGHT()*.5}return 0}function Pst(t,e){switch(t){case mo.NEAR:return e*.11;default:case mo.MID:return e*.082;case mo.FAR:return e*.04}}function Dst(t){switch(t){case mo.NEAR:return 160;default:case mo.MID:return 320;case mo.FAR:return 768}}function Lst(t){switch(t){case mo.NEAR:return .888;default:case mo.MID:return .777;case mo.FAR:return .444}}function Ust({width:t,height:e}){const n=Kv(),r=t*En.DRAW_CHAR_WIDTH(),i=e*En.DRAW_CHAR_HEIGHT(),s=et.useRef(null),o=et.useRef(null),a=et.useRef(null),c=et.useRef(null),l=et.useRef(null),u=et.useRef(null),[,h]=et.useState(!1);et.useLayoutEffect(()=>{h(!0)},[]),Jd((M,I)=>{if(!s.current||!o.current||!a.current||!c.current||!l.current||!u.current)return;const z=Kx(Si.getState().gadget.layers??[]),H=En.DRAW_CHAR_WIDTH(),K=En.DRAW_CHAR_HEIGHT(),P=wn*H,F=Nr*K;ge(c.current.userData.focusx)||(c.current.userData={focusx:z.focusx,focusy:z.focusy}),o.current.position.x=0,o.current.position.y=i-K;const N=Vr(r/H,1,10);a.current.position.x=r-H*N,a.current.position.y=0,a.current.scale.setScalar(N);const X=.125;let G=c.current.userData.focusx+.5,j=c.current.userData.focusy+.5;switch(G*=-En.DRAW_CHAR_WIDTH(),j*=-En.DRAW_CHAR_HEIGHT(),G+=P*.5,j+=F*.5,rb(l.current.position,[M.size.width*.5,M.size.height*.5+Pst(z.viewscale,i),Dst(z.viewscale)],X,I),SB(s.current.rotation,[Lst(z.viewscale),0,0],X,I),rb(c.current.position,[G,j,0],X,I),im(c.current.userData,"focusx",z.focusx,X),im(c.current.userData,"focusy",z.focusy,X),l.current.rotation.z=Math.PI,l.current.updateProjectionMatrix(),z.viewscale){case mo.NEAR:u.current.bokehScale=10,u.current.cocMaterial.worldFocusRange=600,u.current.cocMaterial.worldFocusDistance=500;break;default:case mo.MID:u.current.bokehScale=10,u.current.cocMaterial.worldFocusRange=600,u.current.cocMaterial.worldFocusDistance=600;break;case mo.FAR:u.current.bokehScale=10,u.current.cocMaterial.worldFocusRange=1e3,u.current.cocMaterial.worldFocusDistance=1100;break}}),Si(M=>M.gadget.over?.length??0),Si(M=>M.gadget.under?.length??0),Si(M=>M.gadget.layers?.length??0);const{over:d=[],under:m=[],layers:p=[]}=Si.getState().gadget,g=En.DRAW_CHAR_WIDTH(),y=En.DRAW_CHAR_HEIGHT(),v=wn*g,x=Nr*y,E=v*-.5+n.marginx,C=x*-.5+-n.marginy,A=m.length*2+2,k=A+2;return ke.jsxs(ke.Fragment,{children:[p.map(M=>ke.jsx(FP,{id:M.id,from:"layers"},`media${M.id}`)),ke.jsx("perspectiveCamera",{ref:l,near:1,far:2e3,aspect:-r/i}),ke.jsx("group",{"position-z":A,children:l.current&&ke.jsx(jP,{camera:l.current,viewwidth:r,viewheight:i,effects:ke.jsx(ke.Fragment,{children:ke.jsx(U9,{ref:u})}),children:ke.jsx("group",{position:[E,C,-1e3],children:ke.jsx("group",{ref:s,children:ke.jsx("group",{ref:c,children:p.map(M=>ke.jsx(Ist,{id:M.id,from:"layers",z:Nst(M)},M.id))})})})})}),ke.jsx("group",{ref:a,children:m.map((M,I)=>ke.jsx(Tv,{from:"under",id:M.id,z:I*2},M.id))}),ke.jsx("group",{ref:o,"position-z":k,children:d.map((M,I)=>ke.jsx(Tv,{from:"over",id:M.id,z:I*2},M.id))})]})}function Bst({width:t,height:e}){const n=vE(t,e,0,en.WHITE,en.ONCLEAR),r=Si(s=>s.gadget.tickers),i=et.useMemo(()=>({...zv(t,e,en.WHITE,en.BLACK),...n.getState()}),[t,e,n]);if(ge(r)){i.x=0,i.y=2,i.disablewrap=!0;const s=n.getState();KM(s,0,en.WHITE,en.ONCLEAR);for(let o=0;o<r.length;++o){const a=r[o];Cr(a,i,!1),i.x=0,i.y++}}return ke.jsx(xE,{store:n,children:ke.jsx(TE,{width:t,height:e})})}function Yb(t,e,n){let r=0;n.alt&&(r|=J8),n.ctrl&&(r|=Q8),n.shift&&(r|=eF),$p(t)&&ite(ut,t,e,r)}function Fst({width:t,height:e}){const n=ui();Si(s=>s.gadget.id),Si(s=>s.gadget.layers?.length??0);const r=Si(s=>Kx(s.gadget.layers??[]).graphics),i=1.2;return ke.jsxs(ke.Fragment,{children:[ke.jsx(ja,{MOVE_LEFT:s=>Yb(n,rn.MOVE_LEFT,s),MOVE_RIGHT:s=>Yb(n,rn.MOVE_RIGHT,s),MOVE_UP:s=>Yb(n,rn.MOVE_UP,s),MOVE_DOWN:s=>Yb(n,rn.MOVE_DOWN,s),OK_BUTTON:s=>Yb(n,rn.OK_BUTTON,s),CANCEL_BUTTON:s=>Yb(n,rn.CANCEL_BUTTON,s),MENU_BUTTON:s=>Yb(n,rn.MENU_BUTTON,s),keydown:s=>{const o=hr(s.key),a=w2(s),c=ui();switch(o){case"c":vH(ut,c,"");break;case"#":case"3":vH(ut,c,"#");break;case"p":a.ctrl&&ote(ut,c);break;case"a":a.ctrl&&ixe(ut,c);break}}}),r==="flat"&&ke.jsx(vst,{width:t,height:e}),r==="mode7"&&ke.jsx(Ust,{width:t,height:e}),r==="iso"&&ke.jsx(Ost,{width:t,height:e}),r==="fpv"&&ke.jsx(Cst,{width:t,height:e}),ke.jsx("group",{"position-z":512,scale:[i,i,i],children:ke.jsx(Bst,{width:Math.floor(t/i),height:Math.floor(e/i)})})]})}function LJ({rect:t,islandscape:e=!0,sidebaropen:n=!0,shouldclose:r=!1}){switch(t.type){case 0:return ke.jsx("group",{"position-z":512,children:ke.jsx(Bhe,{width:t.width,height:t.height,color:14,bg:1,text:t.text,xmargin:e?1:n?3:10,ymargin:e&&!n?6:0})});case 1:return ke.jsx(nst,{width:t.width,height:t.height,color:14,bg:1,text:t.text,shouldclose:r});case 2:return ke.jsx(Fst,{width:t.width,height:t.height})}return null}const uS=20;function jst(){const t=Kv(),{islandscape:e,sidebaropen:n,insetrows:r,showtouchcontrols:i}=Fh(),s=Si(uY(p=>p.gadget.scroll??[])),o=s.length===0,[a,c]=et.useState(!1),l=Si(uY(p=>p.gadget.sidebar??[]));if(t.cols<10||t.rows<10)return null;const u={name:"main",type:2,x:0,y:0,text:[],width:t.cols,height:t.rows},h=[];if(l.length)if(i)if(e){const p=n?uS+5:uS,g=n?uS:4,y={name:"sidebar",type:0,x:u.x+u.width-g,y:u.y,width:p,height:u.height,text:l};u.width-=g,h.push(y)}else{const p=n?r-7:r,g=n?p:4,y={name:"sidebar",type:0,x:0,y:u.y+u.height-g,width:u.width,height:p,text:l};u.height-=g,h.push(y)}else{const p={name:"sidebar",type:0,x:u.x+u.width-uS,y:u.y,width:uS,height:u.height,text:l};u.width-=uS,h.push(p)}const d={name:"scroll",type:1,x:0,y:0,width:Vr(50,24,u.width-2),height:Vr(18,8,u.height-8),text:s};d.x=u.x+Math.floor((u.width-d.width)*.5),d.y=u.y+Math.floor((u.height-d.height)*.5),!o&&!a&&c(!0),h.unshift(u);const m=ui();return ke.jsxs(Eb.Provider,{value:{sendmessage(p,g){ut.emit(m,p,g)},sendclose(){xSe(ut,m)},didclose(){c(!1)}},children:[ke.jsx("group",{position:[-En.DRAW_CHAR_WIDTH(),-En.DRAW_CHAR_HEIGHT(),-524],children:ke.jsx(D0,{visible:!0,color:new Xi(.076,.076,0),width:t.cols+2,height:t.rows+2})}),ke.jsx("group",{position:[0,0,-512],children:h.map(p=>ke.jsx("group",{position:[p.x*En.DRAW_CHAR_WIDTH(),p.y*En.DRAW_CHAR_HEIGHT(),0],children:ke.jsx(LJ,{islandscape:!i||e,sidebaropen:!i||n,rect:p})},p.name))}),a&&ke.jsxs(zd.Fragment,{children:[ke.jsx("group",{position:[0,0,800],children:ke.jsx(Krt,{width:t.cols,height:t.rows,alpha:.14})}),ke.jsx("group",{position:[d.x*En.DRAW_CHAR_WIDTH(),d.y*En.DRAW_CHAR_HEIGHT(),900],children:ke.jsx(LJ,{rect:d,shouldclose:o})})]},"scroll")]})}const zst=250,Hst=249,HN=en.BLUE,qst=en.WHITE,Vst=en.DKGRAY,Z9=en.BLACK;function pT(t){return t?en.ONCLEAR:en.DKBLUE}function Gst(t){return Math.round(t*.5)}const Hhe=et.createContext({sendmessage(){}});function Gy(t,e,n,r){const i=dm(r);r.iseven=r.y%2===0,r.active.bg=t?Z9:r.reset.bg,r.active.leftedge=i.left,r.active.rightedge=i.right,r.active.topedge=i.top,r.active.bottomedge=i.bottom,r.x=r.active.leftedge+e,r.y=r.active.topedge+n}function h1(t,e,n,r,i,s,o,a){const c=dm(i);i.iseven=i.y%2===0,i.active.color=en.WHITE,i.active.bg=i.reset.bg,i.active.leftedge=c.left+s,i.active.rightedge=c.right-s,i.active.topedge=c.top+o,i.active.bottomedge=c.bottom-a,i.x=i.active.leftedge+n,i.y=i.active.topedge+r}function $st(t){let e=0;return t.split(/\r?\n/).map(r=>{const i=e,s=`${r}
`;return e+=s.length,{start:i,code:s,end:i+r.length}})}function Wst(t){return t.reduce((e,n)=>{const r=n.code.length;return r>e?r:e},0)}function Kst(t,e){for(let n=0;n<e.length;++n)if(t<=e[n].end)return n;return 0}function J9({bump:t}){const e=ou(),n=dm(e),{quickterminal:r}=js(),i=pT(r);if(t&&n.top++,r){for(let s=n.top;s<=n.bottom;++s)for(let o=n.left;o<=n.right;++o)ec(e,e.width,e.height,o,s,{char:0,color:HN,bg:i});return null}for(let s=n.top;s<=n.bottom;++s)for(let o=n.left;o<=n.right;++o){let a=0;(o+s)%2===0&&(a=Math.abs(Math.round(Math.cos(o*s*.01)))?zst:Hst),ec(e,e.width,e.height,o,s,{char:a,color:HN,bg:i})}return null}const bU=en.WHITE,dA=en.GREEN,Tc=en.YELLOW,Xst=en.CYAN,Dd=en.DKGREEN,UJ=en.DKCYAN,Yst=en.GREEN,eI=en.DKPURPLE,qhe=en.WHITE,Zst=en.LTGRAY,Jst=en.DKGRAY,BJ=en.DKRED,Qst=en.DKRED,EU=en.DKYELLOW,eot={[UA.tokenTypeIdx??0]:bU,[Die.tokenTypeIdx??0]:bU,[Lie.tokenTypeIdx??0]:bU,[q1.tokenTypeIdx??0]:eI,[ov.tokenTypeIdx??0]:Tc,[BA.tokenTypeIdx??0]:dA,[FA.tokenTypeIdx??0]:Xst,[vx.tokenTypeIdx??0]:Qst,[jA.tokenTypeIdx??0]:Tc,[NF.tokenTypeIdx??0]:Tc,[cc.tokenTypeIdx??0]:dA,[cA.tokenTypeIdx??0]:dA,[JI.tokenTypeIdx??0]:qhe,[PF.tokenTypeIdx??0]:Tc,[DF.tokenTypeIdx??0]:Tc,[LF.tokenTypeIdx??0]:Tc,[UF.tokenTypeIdx??0]:Tc,[BF.tokenTypeIdx??0]:Tc,[FF.tokenTypeIdx??0]:Tc,[QI.tokenTypeIdx??0]:EU,[eN.tokenTypeIdx??0]:EU,[tN.tokenTypeIdx??0]:EU,[nN.tokenTypeIdx??0]:Tc,[rN.tokenTypeIdx??0]:Tc,[jF.tokenTypeIdx??0]:Tc,[zF.tokenTypeIdx??0]:Tc,[w1.tokenTypeIdx??0]:Tc,[HF.tokenTypeIdx??0]:Tc,[qF.tokenTypeIdx??0]:Tc,[zA.tokenTypeIdx??0]:Tc,[VF.tokenTypeIdx??0]:Tc,[GF.tokenTypeIdx??0]:Tc,[$F.tokenTypeIdx??0]:Yst,[R1.tokenTypeIdx??0]:Dd,[C1.tokenTypeIdx??0]:UJ,[iN.tokenTypeIdx??0]:UJ,[A1.tokenTypeIdx??0]:Dd,[WF.tokenTypeIdx??0]:Dd,[KF.tokenTypeIdx??0]:Dd,[XF.tokenTypeIdx??0]:Dd,[YF.tokenTypeIdx??0]:Dd,[ZF.tokenTypeIdx??0]:Dd,[JF.tokenTypeIdx??0]:Dd};en.DKPURPLE;const tot=en.DKYELLOW,not=en.DKPURPLE,rot=en.CYAN,iot=en.DKCYAN,sot=en.RED,oot=en.WHITE,aot=en.LTGRAY,cot=en.YELLOW,Vhe=new Map;function rg(t,e){Vhe.set(t,e)}function FJ(t){const e=[];let n=0;for(let r=0;r<t.length;++r){switch(t[r]){case";":n=0;break;case" ":break;default:n===0&&(n=1);break;case"#":n===0&&(n=2);break}switch(n){case 0:e.push(en.LTGRAY);break;case 1:e.push(fot(t[r]));break;case 2:e.push(en.CYAN);break}}return e.push(en.BLUE),e}function lot(t){if(t.startsWith("play ")){const e=new Array(5).fill(Dd);return e.push(...FJ(t.slice(5))),e}else if(t.startsWith("bgplay ")){const e=new Array(7).fill(Dd);return e.push(...FJ(t.slice(7))),e}return Vhe.get(t)??en.GREEN}const wE=en.GREEN,uot=en.DKGREEN,i_=en.PURPLE,RE=en.DKCYAN,Ghe=en.CYAN,$he=en.YELLOW,Whe=en.DKYELLOW,Khe=new Map;function Ns(t,e){Khe.set(t,e)}function fot(t){return Khe.get(t)??en.GREEN}function hot(){const t=ou(),e=dm(t),[n,r,i]=js(iu(v=>[v.quickterminal,v.editor.type,v.editor.title])),s=en.WHITE,o=pT(n);for(let v=e.top;v<e.bottom;++v)ec(t,t.width,t.height,e.left,v,{char:179,color:s,bg:o}),ec(t,t.width,t.height,e.right,v,{char:179,color:s,bg:o});h1(!1,!1,0,0,t,0,0,0),Cr("$213$205$187",t,!0),h1(!1,!1,t.width-3,0,t,0,0,0),Cr("$196$196$191",t,!0);const a="$205".repeat(e.width-2);h1(!1,!1,0,e.height-1,t,0,0,0),Cr(`$212${a}$190`,t,!0);const c=ep(),l="$205".repeat(e.width-4);h1(!1,!1,0,1,t,0,0,0),Cr(`$179$${c?"7":"232"}$200${l}$181`,t,!0);const h=` ${`$blue[${r}] `}$green${i}$white `,m=pb(h,e.width,e.height)?.measuredwidth??1,p=e.width-2,g=2+Math.round(p*.5)-Math.round(m*.5);h1(!1,!1,g,1,t,0,0,0),Cr(h,t,!0);const y=ib?`shift+${Fp}+z`:`${Fp}+y`;return ke.jsx($9,{margin:3,color:en.BLUE,y:e.top,leftedge:0,rightedge:e.width-1,line:`
    esc/cancel$white.CLOSE   $blue
    tab$white.CHANGE LAYOUT   $blue
    hold shift$white.SELECT TEXT   $blue
    alt+up/down$white.JUMP 10 LINES   $blue
    alt+left/right$white.JUMP 10 COLS   $blue
    ${Fp}+up/down$white.JUMP TOP/BOTTOM   $blue
    ${Fp}+left/right$white.JUMP TO START/END OF LINE   $blue
    ${Fp}+a$white.SELECT ALL   $blue
    ${Fp}+c$white.COPY   $blue
    ${Fp}+x$white.CUT   $blue
    ${Fp}+v$white.PASTE   $blue
    ${Fp}+z$white.UNDO   $blue
    ${y}$white.REDO   $blue
    ${Fp}+p$white.TEST SELECTED CODE   $blue
    ${Fp}+k$white.OPEN REFSCROLL   $blue
    ${Fp}+e$white.COPY CODEPAGE TO CLIPBOARD AS JSON   $blue
    `,context:t})}function dot({xcursor:t,ycursor:e,xoffset:n,yoffset:r,rows:i,codepage:s}){const o=ep(),a=ou(),c=_a(),l=ui(),u=et.useRef(void 0),h=dm(a),d=js(j=>j.editor.path),m=ge(s)?s.toJSON():"",p=i.length-1,g=t+1-n,y=e+2-r;if(ge(s)){const j=u.current?.x!==g||u.current?.y!==y;if(o||j){const q=h.left+g,te=h.top+y;if(te>h.top+1&&te<h.bottom&&q>h.left&&q<h.right){const W=q+te*a.width;eP(W,"",a),bx(W,W,en.WHITE,en.DKBLUE,a)}}}u.current={x:g,y};const v=i[p].end,x=i[e];let E=c.cursor,C=c.cursor,A=!1;ge(c.select)&&(A=!0,E=Math.min(c.cursor,c.select),C=Math.max(c.cursor,c.select),c.cursor!==c.select&&--C);const k=C-E+1,M=A?m.substring(E,C+1):"";function I(j){j?ge(c.select)||_a.setState({select:c.cursor}):_a.setState({select:void 0})}const z=et.useCallback(function(j,q,te){q>0&&s?.delete(j,q),ge(te)&&s?.insert(j,te),_a.setState({cursor:j+(te??"").length,select:void 0})},[s]),H=et.useCallback(function(j,q,te){q>0&&s?.delete(j,q),ge(te)&&s?.insert(j,te),_a.setState({cursor:j+(te??"").length})},[s]);function K(){if(A){const j=M.split(`
`);for(let q=0;q<j.length;++q){const te=j[q],W=te.trim();W.startsWith("'")?j[q]=te.replace(/' ?/,""):W&&(j[q]=`' ${te}`)}z(E,k,j.join(`
`))}}function P(j=!0){if(A){const q=M.split(`
`);for(let te=0;te<q.length;++te){const W=q[te];j?q[te].startsWith(" ")&&(q[te]=W.substring(1)):q[te]=` ${W}`}H(E,k,q.join(`
`))}}function F(){A&&(_a.setState({cursor:E}),z(E,k))}function N(){_a.setState({cursor:v,select:void 0})}const X=et.useCallback(function(j){const q=Math.round(e+j);if(q<0)_a.setState({cursor:0});else if(q>p)_a.setState({cursor:v});else{const te=i[q];_a.setState({cursor:te.start+Math.min(t,te.code.length-1)})}},[v,i,p,t,e]),G=et.useMemo(()=>s?new cFe(s):void 0,[s]);return et.useEffect(()=>{function j(te){te.stackItem.meta.set("cursor",c.cursor)}function q(te){if(te.stackItem.meta.has("cursor")){const W=te.stackItem.meta.get("cursor");_a.setState({cursor:W})}}return G?.on("stack-item-added",j),G?.on("stack-item-popped",q),()=>{G?.off("stack-item-added",j),G?.off("stack-item-popped",q)}},[G,c.cursor]),ke.jsxs(ke.Fragment,{children:[ke.jsx(G9,{blocking:!0,x:h.left,y:h.top,width:h.width,height:h.height,onScroll:j=>X(j*.75)}),ke.jsx(ja,{keydown:j=>{if(!ge(s))return;const{key:q}=j,te=hr(q),W=w2(j);switch(te){case"arrowleft":if(I(W.shift),W.ctrl)_a.setState({cursor:x.start});else{const $=c.cursor-(W.alt?10:1);_a.setState({cursor:Vr($,0,v)})}break;case"arrowright":if(I(W.shift),W.ctrl)_a.setState({cursor:x.end});else{const $=c.cursor+(W.alt?10:1);_a.setState({cursor:Vr($,0,v)})}break;case"arrowup":I(W.shift),W.ctrl?_a.setState({cursor:0}):X(W.alt?-10:-1);break;case"arrowdown":I(W.shift),W.ctrl?_a.setState({cursor:v}):X(W.alt?10:1);break;case"enter":ge(s)&&(s.insert(c.cursor,`
`),_a.setState({cursor:c.cursor+1}));break;case"esc":case"escape":W.shift||W.alt||W.ctrl?xI(ut,l):VSe(ut,l);break;case"tab":ete(ut,l,!W.shift);break;case"delete":A?F():z(c.cursor,1);break;case"backspace":A?F():m.length>0&&z(Math.max(c.cursor-1,0),1);break;default:if(W.ctrl)switch(te){case"e":exe(ut,l,d);break;case"z":ib&&W.shift?G?.redo():G?.undo();break;case"y":ib||G?.redo();break;case"a":_a.setState({cursor:v,select:0});break;case"c":ge(po())?po().writeText(M).catch($=>Pr(ut,l,"clipboard",$)):N();break;case"v":ge(po())?po().readText().then($=>{const J=$.replaceAll("\r","");A?z(E,k,J):z(c.cursor,0,J)}).catch($=>Pr(ut,l,"clipboard",$)):N();break;case"x":ge(po())&&A?po().writeText(M).then(()=>F()).catch($=>Pr(ut,l,"clipboard",$)):N();break;case"p":A?(R0(ut,l,M),Ei(ut,l,`running $WHITE${M.substring(0,16)}...$BLUE`)):(R0(ut,l,x.code),Ei(ut,l,`running $WHITE${x.code.substring(0,16)}...$BLUE`));break;case"'":K();break}else if(!W.alt){if(j.key.length===1)if(A)j.key==="'"?K():j.key===" "?P(j.shiftKey):z(E,k,j.key);else{const $=c.cursor+j.key.length;s.insert(c.cursor,j.key),_a.setState({cursor:$})}}break}}})]})}function jJ(t){const[e]=t.substring(1).split(";");return e.split(" ")}let tI;function ig(t){const e=VHe(Fce(t));Object.keys(e).length&&(tI=e)}function pot({ycursor:t,xoffset:e,yoffset:n,rows:r,codepage:i}){const s=ep(),o=ou(),a=_a(),{quickterminal:c}=js(),l=et.useMemo(()=>{if(r.length){const y=r[r.length-1];return[...r,{code:"",start:y.end+1,end:y.end+1}]}return[]},[r]);if(!ge(i)){const y=(s?"|":"-").repeat(3);return h1(!1,!1,0,0,o,1,2,1),Cr(` ${y} LOADING ${y}`,o,!0),null}const u=o.width-2,h=dm(o);h.right=u-1;let d=a.cursor,m=a.cursor,p=!1;ge(a.select)&&(p=!0,d=Math.min(a.cursor,a.select),m=Math.max(a.cursor,a.select),a.cursor!==a.select&&--m);const g=h.left+1-4;h1(!1,!1,-e,-n,o,1,2,1);for(let y=0;y<l.length;++y){if(o.y<=h.top+1){++o.y;continue}const v=l[y],x=l[y-1],E=y===t,C=y-1===t,A=v.code.replaceAll(`
`,""),k=g-e;o.x=k,o.iseven=o.y%2===0,o.active.bg=E?Z9:pT(c),o.disablewrap=!0,o.active.rightedge=u;const[M]=v.errors??[],I=`${y+1}`.padStart(3," ");z5(`${y<r.length?I:"   "} ${A} `,o,!1);const z=1+o.y*o.width;Dp(z,h.right,-e-3,-e,Zst,o.active.bg,o);let H=-1;const K=Vr(a.cursor-v.start,1,v.end-v.start);if(ge(v.tokens))for(let P=0;P<v.tokens.length;++P){const F=v.tokens[P];E&&K>=(F.startColumn??1)&&K<=(F.endColumn??1)&&(H=P);const N=(F.startColumn??1)-1-e,X=(F.endColumn??1)-1-e,G=eot[F.tokenTypeIdx];if(ge(G))switch(G){case eI:{const j=jJ(F.image);switch(I5("",j,!!F.payload).type){case qn.BOARD:case qn.LOADER:case qn.OBJECT:case qn.TERRAIN:case qn.CHARSET:case qn.PALETTE:{Dp(z,h.right,N,X,eI,o.active.bg,o);break}case qn.CONST:case qn.RANGE:case qn.SELECT:case qn.NUMBER:case qn.TEXT:case qn.HOTKEY:case qn.COPYIT:case qn.OPENIT:case qn.ZSSEDIT:case qn.CHAREDIT:case qn.COLOREDIT:{const[te]=j;Dp(z,h.right,N,N+te.length,eI,o.active.bg,o),j.length>1&&Dp(z,h.right,N+te.length+1,X,qhe,o.active.bg,o);break}default:Dp(z,h.right,N,X,en.DKRED,o.active.bg,o);break}break}case Tc:{Dp(z,h.right,N,N,G,o.active.bg,o),N!==X&&Dp(z,h.right,N+1,X,dA,o.active.bg,o);break}case dA:{const j=lot(F.image);if(Rr(j))for(let q=0;q<j.length;++q)Dp(z,h.right,N+q,X+q,j[q],o.active.bg,o);else Dp(z,h.right,N,X,j,o.active.bg,o);break}default:Dp(z,h.right,N,X,G,o.active.bg,o);break}}if(p&&v.start<=m&&v.end>=d){const P=Math.max(v.start,d)-v.start-e,F=Math.min(v.end,m)-v.start-e,N=h.width-3,X=Math.max(0,P),G=Math.min(N,F);X<=N&&G>=g&&Dp(z,h.right,X,G,qst,Vst,o)}if(E&&ge(v.tokens)){let P;if(ge(v.asts)){for(let F=0;F<(v.asts?.length??0);++F)v.asts[F].type===Bn.IF&&(P=v.asts[F]);ge(P)||(P=v.asts.find(F=>K<=(F.endColumn??0)))}tI=void 0;for(let F=H;F>=0;--F){const N=v.tokens[F-1],X=v.tokens[F],G=v.tokens[F+1];switch(X.tokenTypeIdx){case ov.tokenTypeIdx:case C1.tokenTypeIdx:case R1.tokenTypeIdx:case A1.tokenTypeIdx:case q1.tokenTypeIdx:case vx.tokenTypeIdx:case FA.tokenTypeIdx:case jA.tokenTypeIdx:case zA.tokenTypeIdx:case w1.tokenTypeIdx:case BA.tokenTypeIdx:if(X.tokenTypeIdx===w1.tokenTypeIdx&&(!ge(P)||X.startColumn!==P.startColumn))continue;break;default:continue}switch(X.tokenTypeIdx){case ov.tokenTypeIdx:{ig(`editor:command:${G.image}`);break}case C1.tokenTypeIdx:{ig("editor:command:do");break}case R1.tokenTypeIdx:{ig(N.tokenTypeIdx===A1.tokenTypeIdx?"editor:command:elseif":"editor:command:if");break}case A1.tokenTypeIdx:{ig(G.tokenTypeIdx===R1.tokenTypeIdx?"editor:command:elseif":"editor:command:else");break}case q1.tokenTypeIdx:{const j=jJ(X.image),q=I5("",j,!!X.payload);ig(`editor:stat:${wy(q.type)}`);break}case vx.tokenTypeIdx:{ig("editor:label");break}case FA.tokenTypeIdx:{ig("editor:comment");break}case jA.tokenTypeIdx:{ig("editor:hyperlink");break}case zA.tokenTypeIdx:{ig("editor:shorttry");break}case w1.tokenTypeIdx:{ig("editor:shortgo");break}case BA.tokenTypeIdx:{ig("editor:text");break}}break}Sn(tI?.desc)&&Cr(tI.desc,o,!1)}if(C&&ge(x.errors)){o.x=k;const[P]=x.errors,F=`${P.message}`.replaceAll(`
`," ");z5(F,o,!1),Dp(z,h.right,0,F.length-1,en.WHITE,BJ,o)}else if(ge(M)){const P=3+(M.column??1),F=M.length??1;rK(z,h.right,0,2,BJ,o),rK(z,h.right,P,P+F-1,Jst,o)}if(++o.y,o.y>=h.bottom)break}return o.disablewrap=!1,o.active.rightedge=o.width,null}function SU(t){switch(t){case"stat":case"text":case"hyperlink":return!1;default:return!0}}Ns("a",wE);Ns("b",wE);Ns("c",wE);Ns("d",wE);Ns("e",wE);Ns("f",wE);Ns("g",wE);Ns("x",uot);Ns("#",Whe);Ns("!",Whe);Ns("y",RE);Ns("t",RE);Ns("s",RE);Ns("i",RE);Ns("q",RE);Ns("h",RE);Ns("w",RE);Ns("3",Ghe);Ns(".",Ghe);Ns("+",$he);Ns("-",$he);Ns("0",i_);Ns("1",i_);Ns("2",i_);Ns("p",i_);Ns("4",i_);Ns("5",i_);Ns("6",i_);Ns("7",i_);Ns("8",i_);Ns("9",i_);Ns(";",Tc);function zJ(){const t=ui(),[e]=js(iu(K=>[K.editor])),[n,r,i,s,o,a,c,l,u,h,d]=Si(iu(K=>[K.zsswords.cli,K.zsswords.loader,K.zsswords.runtime,K.zsswords.flags,K.zsswords.stats,K.zsswords.kinds,K.zsswords.altkinds,K.zsswords.colors,K.zsswords.dirs,K.zsswords.dirmods,K.zsswords.exprs]));et.useEffect(()=>{n.filter(SU).forEach(K=>rg(K,Dd)),r.filter(SU).forEach(K=>rg(K,Dd)),i.filter(SU).forEach(K=>rg(K,Dd)),s.forEach(K=>rg(K,tot)),o.forEach(K=>rg(K,not)),a.forEach(K=>rg(K,rot)),c.forEach(K=>rg(K,iot)),l.forEach(K=>rg(K,sot)),u.forEach(K=>rg(K,oot)),h.forEach(K=>rg(K,aot)),d.forEach(K=>rg(K,cot))},[n,r,i,s,o,a,c,l,u,h,d]);const m=ou(),p=_a(),g=Nce(ste(e.book,e.path)),y=dm(m);et.useEffect(()=>(sxe(ut,t,e.book,e.path),()=>{oxe(ut,t,e.book,e.path)}),[e.book,e.path,t]);const v=ge(g)?g.toJSON():"",x=$st(v),E=Kst(p.cursor,x),C=p.cursor-x[E].start,A=Wst(x),k=lle(v);if(ge(k.tokens)){let K=!0;for(let P=0;P<k.tokens.length;++P){const F=k.tokens[P];F.tokenTypeIdx===q1.tokenTypeIdx&&(F.payload=K,K=!1);const N=x[(F.startLine??1)-1];ge(N)&&(N.tokens=N.tokens??[],N.tokens.push(F))}}if(k?.ast?.type===Bn.PROGRAM){ale(k.ast);const K=[];for(let P=1;P<k.ast.lines.length;++P)K.push(k.ast.lines[P]);for(;K.length;){const P=K.pop();if(an(P?.type)){switch(P.type){case Bn.LINE:case Bn.IF:if(an(P.startLine)){const N=x[P.startLine-1];N.asts=N.asts??[],N.asts.unshift(P)}break}const F=Cv(P);for(let N=0;N<F.length;++N){const X=F[N],G=P[X];Rr(G)?K.push(...G):typeof G=="object"&&K.push(G)}}}}if(ge(k.errors))for(let K=0;K<k.errors.length;++K){const P=k.errors[K],F=x[(P.line??1)-1];ge(F)&&(F.errors=F.errors??[],F.errors.push(P))}const M={rows:x,xcursor:C,ycursor:E,codepage:g,xoffset:-4+p.xscroll,yoffset:p.yscroll},I=32,z=(Math.round(A/I)+1)*I,H=x.length;return et.useEffect(()=>{setTimeout(()=>{_a.setState(K=>{let P=K.xscroll;const F=C-P,N=y.width-3;let X=Math.round(Vr(Math.abs(F)*.5,1,I));X<8&&(X=1),F>N-8&&(P+=X),F<8&&(P-=X);let G=K.yscroll;const j=E-G,q=y.height-4,te=Math.round(q*.5);let W=Math.round(Vr(Math.abs(j)*.25,1,te));return W<8&&(W=1),j>q-4&&(G+=W),j<4&&(G-=W),{xscroll:Math.round(Vr(P,0,z)),yscroll:Math.round(Vr(G,0,H))}})},16)},[C,z,p.xscroll,E,H,p.yscroll,y.width,y.height]),ke.jsxs(ke.Fragment,{children:[ke.jsx(J9,{bump:!0}),ke.jsx(hot,{}),ke.jsx(pot,{...M}),ke.jsx(dot,{...M})]})}function mot(t,e,n,r){const i=t.slice(0,e),s=t.slice(e+n);return`${i}${r??""}${s}`}function got(t){const[e,n]=t.split(":"),r=ge(n);return[r?e:"self",r?n:t]}const _ot=self.SpeechRecognition??self.webkitSpeechRecognition??self.mozSpeechRecognition??self.msSpeechRecognition??self.oSpeechRecognition;class vot{recognition;constructor(e,n,r,i=navigator.language){if(!("webkitSpeechRecognition"in window))throw new Error("This browser doesn't support speech recognition. Try Google Chrome.");this.recognition=new _ot,this.recognition.interimResults=!!r,this.recognition.lang=i;let s="";this.recognition.onresult=o=>{let a="";for(let c=o.resultIndex;c<o.results.length;c+=1){const l=o.results[c][0].transcript;o.results[c].isFinal?(s+=l,e(s),s=""):this.recognition.interimResults&&(a+=l,r(a))}},this.recognition.onend=()=>{n()}}startListening(){this.recognition.start()}stopListening(){this.recognition.stop()}}function yot({quickterminal:t,voice2text:e,tapeycursor:n,logrowtotalheight:r}){const i=ep(),s=ou(),o=uo(),a=ui(),c=dm(s),l=o.buffer[o.bufferindex];let u=o.xcursor,h=o.xcursor,d=!1;ge(o.xselect)&&ge(o.yselect)&&(d=!0,u=Math.min(o.xcursor,o.xselect),h=Math.max(o.xcursor,o.xselect),o.xcursor!==o.xselect&&--h);const m=h-u+1,p=o.ycursor===0,g=d?l.substring(u,h+1):l,y=et.useCallback(function(H,K,P){o.bufferindex>0&&uo.setState({bufferindex:0}),o.buffer[0]=mot(l,H,K,P),uo.setState({buffer:o.buffer,xselect:void 0,xcursor:H+(P??"").length})},[l,o.buffer,o.bufferindex]),v=et.useCallback(function(H){o.bufferindex>0&&uo.setState({bufferindex:0}),o.buffer[0]=H,uo.setState({buffer:o.buffer,xselect:void 0,xcursor:H.length})},[o.buffer,o.bufferindex]);function x(H){const K=o.buffer.length-1,P=Vr(H,0,K);uo.setState({bufferindex:P,xcursor:o.buffer[P].length,ycursor:0,xselect:void 0,yselect:void 0})}function E(H){H?ge(o.xselect)||uo.setState({xselect:o.xcursor,yselect:o.ycursor}):uo.setState({xselect:void 0,yselect:void 0})}function C(){ge(o.xselect)&&(uo.setState({xcursor:u,xselect:void 0,yselect:void 0}),y(u,m))}function A(){uo.setState({scroll:0,xcursor:l.length,ycursor:0,xselect:void 0,yselect:void 0})}if(s.reset.bg=pT(t),!t){Gy(!1,0,0,s);const H="main:0.68.12 - if lost try #help";s.x=1,Cr(`$dkcyan${H}`,s,!0)}const k="$196",I="$205".repeat(c.width-6);Gy(!1,0,c.height-2,s),s.active.color=en.WHITE,Cr(`  ${k}${I}${k}  `,s,!0);const z=l.padEnd(c.width," ");if(Gy(!1,0,c.height-1,s),s.active.color=en.WHITE,z5(z,s,!0),ge(o.xselect)&&ge(o.yselect)&&o.xcursor!==o.xselect){const H=Math.min(o.xcursor,o.xselect),K=Math.min(o.ycursor,o.yselect),P=Math.max(o.xcursor,o.xselect)-1,F=Math.max(o.ycursor,o.yselect);for(let N=K;N<=F;++N){const X=H+(c.bottom-N)*c.width,G=P+(c.bottom-N)*c.width;bx(X,G,15,8,s)}}if(i){const H=c.left+o.xcursor,K=c.top+n;if(K>=c.top&&K<=c.bottom&&H>=c.left&&H<=c.right){const P=H+K*s.width;eP(P,"",s),bx(P,P,en.WHITE,s.reset.bg,s)}}return et.useEffect(()=>{let H;if(!e||!t)return;const{buffer:K,bufferindex:P}=uo.getState(),F=K[P];if(F.includes("#"))return;function N(j){v(`${F}${j}`),setTimeout(()=>{og.keyboard("[Enter]").catch(Ah)},512)}function X(){}function G(j){v(`${F}${j}`)}try{H=new vot(N,X,G),H?.startListening()}catch(j){console.error(j.message)}return()=>{H?.stopListening(),H=void 0}},[e,t,v]),ke.jsxs(ke.Fragment,{children:[ke.jsx(G9,{blocking:!0,x:c.left,y:c.top,width:c.width,height:c.height,onScroll:H=>{E(!1),uo.setState({ycursor:Vr(Math.round(o.ycursor-H),0,r)})}}),ke.jsx(ja,{keydown:H=>{const{key:K}=H,P=hr(K),F=w2(H);switch(P){case"arrowleft":E(F.shift),F.ctrl?uo.setState({xcursor:0}):uo.setState({xcursor:Vr(o.xcursor-(F.alt?10:1),0,c.right)});break;case"arrowright":E(F.shift),F.ctrl?uo.setState({xcursor:p?l.length:c.right}):uo.setState({xcursor:Vr(o.xcursor+(F.alt?10:1),0,c.right)});break;case"arrowup":F.ctrl?x(o.bufferindex+1):(E(F.shift),uo.setState({ycursor:Vr(Math.round(o.ycursor+(F.alt?10:1)),0,r)}));break;case"arrowdown":F.ctrl?x(o.bufferindex-1):(E(F.shift),uo.setState({ycursor:Vr(Math.round(o.ycursor-(F.alt?10:1)),0,r)}));break;case"enter":{const N=d?g:l;if(N.length)if(p){const X=["",N,...o.buffer.slice(1).filter(G=>G!==N)].filter(G=>G.includes("#broadcast")===!1);lGe(X).catch(G=>Pr(ut,a,"terminalinput",G.message)),uo.setState({xcursor:0,bufferindex:0,xselect:void 0,yselect:void 0,buffer:X}),R0(ut,a,N),t&&xI(ut,a)}else A();break}case"esc":case"escape":xI(ut,a);break;case"tab":ete(ut,a,!F.shift);break;case"delete":p?d?C():l.length>0&&y(o.xcursor,1):A();break;case"backspace":p?d?C():o.xcursor>0&&y(o.xcursor-1,1):A();break;default:if(F.ctrl)switch(P){case"e":R0(ut,a,"#export");break;case"p":ote(ut,a);break;case"a":uo.setState({xselect:0,yselect:0,xcursor:l.length,ycursor:0});break;case"c":p&&ge(po())?po().writeText(g).catch(N=>console.error(N)):A();break;case"v":p&&ge(po())?po().readText().then(N=>{try{const G=JSON.parse(N);if(Sn(G.exported)&&ge(G.data)){qh(ut,a,void 0,"json",`file:${G.exported}`,JSON.stringify(G));return}}catch(G){console.error(G)}const X=N.replaceAll("\r","");d?y(u,m,X):y(o.xcursor,0,X)}).catch(N=>console.error(N)):A();break;case"x":p&&ge(po())?po().writeText(g).then(()=>C()).catch(N=>console.error(N)):A();break}else F.alt||H.key.length===1&&(p&&o.xcursor<=l.length?d?(y(u,m,H.key),uo.setState({xselect:void 0})):y(o.xcursor,0,H.key):A());break}}})]})}function bot({active:t,prefix:e,label:n,words:r,y:i}){const s=ou(),o=et.useCallback(()=>{setTimeout(()=>{if(ge(po())){const[,...c]=r,l=c.join(" ");po().writeText(l).then(()=>tv(ut,ui(),"copied!")).catch(u=>console.error(u))}},100)},[r]),a=id(!!t);return Gy(!!t,0,i,s),Cr(`${e} $purple$16 $yellowCOPYIT ${a}${n}`,s,!0),t&&ke.jsx(ja,{OK_BUTTON:o})}function Eot({active:t,prefix:e,label:n,words:r,y:i}){const s=ou(),o=et.useContext(Hhe),a=et.useCallback(()=>{const[l,...u]=r;setTimeout(()=>{o.sendmessage(l,u)},100)},[r,o]),c=id(!!t);return Gy(!!t,0,i,s),Cr(`${e} $purple$16 ${c}${n}`,s,!0),t&&ke.jsx(ja,{OK_BUTTON:a})}function Sot({active:t,prefix:e,label:n,words:r,y:i}){const s=ou(),o=et.useCallback(()=>{const[,c,...l]=r,u=l.join(" ");setTimeout(()=>{const h=ui();switch(c){case"wiki":ra(ut,h,async()=>{const d=await U8(u);Z8(h,d)});break;case"inline":window.location.href=u;break;default:window.open(`${c} ${u}`.trim(),"_blank");break}},100)},[r]),a=id(!!t);return Gy(!!t,0,i,s),Cr(`${e} $purple$16 $yellowOPENIT ${a}${n}`,s,!0),t&&ke.jsx(ja,{OK_BUTTON:o})}function xot({active:t,prefix:e,label:n,words:r,y:i}){const s=ou(),{setviewimage:o}=Ba(),a=et.useCallback(()=>{const[,...l]=r,u=l.join(" ");setTimeout(()=>o(u),100)},[o,r]),c=id(!!t);return Gy(!!t,0,i,s),Cr(`${e} $purple$16 $CYANVIEWIT ${c}${n}`,s,!0),t&&ke.jsx(ja,{OK_BUTTON:a})}function Xhe({active:t,text:e,y:n}){const r=ou(),{quickterminal:i}=js(),s=dm(r),o=e.startsWith("!");Gy(!!t,0,n,r),r.reset.bg=t?Z9:pT(i),r.active.bottomedge=s.bottom;const a=t7(e);if(ge(a)){const c=s.width-3,u=pb(a,c,3)?.measuredwidth??1,h=Vr(Math.floor(c*.5-u*.5),0,c);Cr(`${" ".repeat(h)}$WHITE${a}`,r,!0)}else Cr(o?"":e,r,!0);if(o){const[c,...l]=e.slice(1).split("!"),u=`${l.join("!")}`;let h="PRESS ME";const d=[],m=FM(u,!0);for(let v=0;v<m.tokens.length;v++){const x=m.tokens[v];switch(x.tokenType){case Q3:h=x.image.slice(1);break;default:d.push(x.image);break}}const[p,...g]=d,y={active:t,prefix:c,label:h,words:g,y:n};switch(hr(p)){case"copyit":return ke.jsx(bot,{...y,words:d});case"openit":return ke.jsx(Sot,{...y,words:d});case"viewit":return ke.jsx(xot,{...y,words:d});default:case"hyperlink":return ke.jsx(Eot,{...y,words:d});case"hk":case"hotkey":return null;case"rn":case"range":return null;case"sl":case"select":return null;case"nm":case"number":return null;case"tx":case"text":return null;case"zssedit":return null;case"charedit":return null;case"coloredit":return null}}return null}function Tot({active:t,text:e,y:n}){return ep(),ke.jsx(Xhe,{active:t,text:e,y:n})}function wot(t,e,n){return t.startsWith("!")?1:pb(t,e,n)?.y??1}function Rot(){const[t]=js(iu(h=>[h.editor.open])),e=js(iu(h=>h.terminal.logs)),n=ou(),r=uo(),i=dm(n),s=n.width-1,o=e.map(h=>wot(h,s,i.height)),a=i.bottom-i.top-(t?0:2);let c=a+1;const l=o.map(h=>(c-=h,c)),u=i.bottom-r.ycursor+r.scroll;return ke.jsx(ke.Fragment,{children:ke.jsx(WM.Provider,{value:n,children:e.map((h,d)=>{const m=l[d]+r.scroll,p=o[d],g=m+p;return g<0||m<0||m>a?null:!t&&u>=m&&u<g?ke.jsx(Tot,{active:!0,text:h,y:m},d):ke.jsx(Xhe,{text:h,y:m},d)})})})}function Cot(t,e,n){return t.startsWith("!")?1:pb(t,e,n)?.y??1}function HJ(){const t=ui(),{quickterminal:e}=js(),[n]=js(iu(p=>[p.editor.open])),r=js(iu(p=>p.terminal.logs)),[i,s]=et.useState(!1);et.useLayoutEffect(()=>{ra(ut,ui(),async()=>{await GO("voice2text")==="on"&&s(!0)})},[]);const o=ou(),a=uo(),c=dm(o),l=o.width-1,u=r.map(p=>Cot(p,l,c.height)),h=c.bottom-c.top-(n?0:2);let d=0;u.forEach(p=>{d+=p}),++d;const m=c.bottom-a.ycursor+a.scroll;return et.useEffect(()=>{setTimeout(()=>{uo.setState(p=>{const g=c.bottom-a.ycursor+a.scroll;let y=p.scroll;return g<5&&y++,g>c.bottom-10&&y--,y=Math.round(Vr(y,0,d-h)),{scroll:y}})},16)},[h,c.bottom,d,a.scroll,a.ycursor]),ke.jsxs(ke.Fragment,{children:[ke.jsx(J9,{}),ke.jsxs(Hhe.Provider,{value:{sendmessage(p,g){const[y,v]=got(p);if(y==="self"){const x=`#${v} ${g.join(" ")}`;R0(ut,t,x)}else ut.emit(t,`${y}:${v}`,g)}},children:[ke.jsx(Rot,{}),!n&&ke.jsx(yot,{quickterminal:e,voice2text:i,tapeycursor:m,logrowtotalheight:d})]})]})}function nO({quickterminal:t,top:e,left:n,width:r,height:i,children:s}){const o=pT(t),a=vE(r,i,0,HN,o),c=et.useMemo(()=>({...zv(r,i,HN,o),...a.getState()}),[o,r,i,a]);return ke.jsxs(xE,{store:a,children:[ke.jsxs(WM.Provider,{value:c,children:[ke.jsx(J9,{}),s]}),ke.jsx("group",{position:[n*En.DRAW_CHAR_WIDTH(),e*En.DRAW_CHAR_HEIGHT(),0],children:ke.jsx(TE,{width:r,height:i})})]})}function Aot({quickterminal:t,top:e,width:n,height:r}){const[i,s]=js(iu(o=>[o.layout,o.editor.open]));if(s)switch(i){case Yp.SPLIT_X:{const o=Gst(n);return ke.jsxs(et.Fragment,{children:[ke.jsx(nO,{quickterminal:t,top:e,left:0,width:o,height:r,children:ke.jsx(zJ,{})}),ke.jsx(nO,{quickterminal:t,top:e,left:o,width:n-o,height:r,children:ke.jsx(HJ,{})})]},"layout")}default:return ke.jsx(nO,{quickterminal:t,top:e,left:0,width:n,height:r,children:ke.jsx(zJ,{})},"layout")}return ke.jsx(nO,{quickterminal:t,top:e,left:0,width:n,height:r,children:ke.jsx(HJ,{})},"layout")}function Mot(){const t=Kv(),[e,n,r,i]=js(iu(l=>[l.layout,l.quickterminal,l.terminal.open,l.editor.open]));let s=0,o=t.rows;switch(e){case Yp.TOP:o=Math.floor(t.rows*.5);break;case Yp.BOTTOM:o=Math.ceil(t.rows*.5),s=t.rows-o;break;default:case Yp.FULL:break}if(t.cols<10||t.rows<10)return null;const a=ui(),c=n||r||i;return ke.jsxs(ke.Fragment,{children:[c&&ke.jsx(z9,{width:t.cols,height:t.rows,top:s,left:0,right:t.cols-1,bottom:s+o-1,alpha:n?.666:.333}),c?ke.jsx(bb,{blockhotkeys:!0,children:ke.jsx(Aot,{quickterminal:n,top:s,width:t.cols,height:o})}):ke.jsx($S,{hotkey:"Shift+?",althotkey:"/",children:()=>HSe(ut,a)})]})}const kot=`
// CRT Emulation
// by Mattias

vec3 sample_(sampler2D tex, vec2 tc) {
	vec3 s = pow(texture2D(tex, tc).rgb, vec3(2.0));
	return s;
}

vec3 blur(sampler2D tex, vec2 tc, float offs) {
	vec4 xoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) * texelSize.x * 0.01;
	vec4 yoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) * texelSize.y * 0.001;
	
	vec3 color = vec3(0.0, 0.0, 0.0);
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.x)) * 0.00366;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.x)) * 0.01465;
	color += sample_(tex, tc + vec2(    0.0, yoffs.x)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.x)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.x)) * 0.00366;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.y)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.y)) * 0.05861;
	color += sample_(tex, tc + vec2(    0.0, yoffs.y)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.y)) * 0.05861;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.y)) * 0.01465;
	
	color += sample_(tex, tc + vec2(xoffs.x, 0.0)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.y, 0.0)) * 0.09524;
	color += sample_(tex, tc + vec2(    0.0, 0.0)) * 0.15018;
	color += sample_(tex, tc + vec2(xoffs.z, 0.0)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.w, 0.0)) * 0.02564;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.z)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.z)) * 0.05861;
	color += sample_(tex, tc + vec2(    0.0, yoffs.z)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.z)) * 0.05861;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.z)) * 0.01465;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.w)) * 0.00366;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.w)) * 0.01465;
	color += sample_(tex, tc + vec2(    0.0, yoffs.w)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.w)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.w)) * 0.00366;

	return color;
}

float rand(vec2 co) {
  float a = 12.9898;
  float b = 78.233;
  float c = 43758.5453;
  float dt = dot(co.xy, vec2(a, b));
  float sn = mod(dt, 3.14);
  return fract(sin(sn) * c);
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
  vec3 col;  
  col.r = 1.0 * blur(inputBuffer, vec2(uv.x + 0.0009, uv.y + 0.0009), 1.2).x + 0.005;
  col.g = 1.0 * blur(inputBuffer, vec2(uv.x + 0.000, uv.y - 0.0015), 1.2).y + 0.005;
  col.b = 1.0 * blur(inputBuffer, vec2(uv.x - 0.0015, uv.y + 0.000), 1.2).z + 0.005;  

  col.r += 0.2 * blur(inputBuffer, vec2(uv.x + 0.0009, uv.y + 0.0009), 2.25).x - 0.005;
  col.g += 0.2 * blur(inputBuffer, vec2(uv.x + 0.000, uv.y - 0.0015), 1.75).y - 0.005;
  col.b += 0.2 * blur(inputBuffer, vec2(uv.x - 0.0015, uv.y + 0.000), 1.25).z - 0.005;
  
  float ghs = 0.05;
	float gphase = 0.371 * sin(time * 0.1);
	col.r += ghs * (1.0 - 0.299) * blur(inputBuffer, gphase * vec2(0.01, -0.027) + vec2(uv.x + 0.001, uv.y + 0.001), 7.0).x;
  col.g += ghs * (1.0 - 0.587) * blur(inputBuffer, gphase * vec2(-0.022, -0.02) + vec2(uv.x + 0.000, uv.y - 0.002), 5.0).y;
  col.b += ghs * (1.0 - 0.114) * blur(inputBuffer, gphase * vec2(-0.02, -0.0) + vec2(uv.x - 0.002, uv.y + 0.000), 3.0).z;

  col = clamp(col * 0.4 + 0.6 * col * 1.0, 0.0, 1.0);
	col = mix(col, col * col * col * col * col * col, 0.5) * 3.8;

	float scans = clamp(0.35 + 0.15 * sin(3.5 * (time * 0.125) + uv.y * resolution.y * 1.5), 0.0, 1.0);
	float s = pow(scans, 0.999);
	col = col * vec3(s);

  col *= 1.0 + 0.0015 * sin(500.0 * time);
  col *= 1.0 - 0.15 * vec3(clamp((mod(uv.x * texelSize.x, 2.0) - 1.0) * 2.0, 0.0, 1.0));
	
  col *= vec3(1.0) - 0.25 * vec3(
   rand(uv + 0.0001 * time), 
   rand(uv + 0.0001 * time + 0.3), 
   rand(uv + 0.0001 * time + 0.5));
	col = pow(col, vec3(0.45));

  outputColor = vec4(col.rgb, 1.0);
}
`;class Oot extends Tg{constructor(){super("ScanlinesEffect",kot,{blendFunction:bi.NORMAL,attributes:Wh.CONVOLUTION,defines:new Map([]),uniforms:new Map([])})}update(){}}const Iot=S2(Oot),qJ=t=>(t.getAttributes()&Wh.CONVOLUTION)===Wh.CONVOLUTION,Not=et.memo(et.forwardRef(({children:t,width:e,height:n},r)=>{const{gl:i,scene:s,camera:o}=Hh(),[a]=et.useMemo(()=>{const u=new phe(i,{depthBuffer:!0,stencilBuffer:!1,multisampling:0,frameBufferType:ab});return u.addPass(new ghe(s,o)),[u]},[o,i,s]);Jd((u,h)=>{const d=i.autoClear;i.autoClear=!0,a.setSize(e,n),a.render(h),i.autoClear=d},2);const c=et.useRef(null);et.useLayoutEffect(()=>{const u=[],h=c.current.__r3f;if(h&&a){const d=h.children;for(let m=0;m<d.length;m++){const p=d[m].object;if(p instanceof Tg){const g=[p];if(!qJ(p)){let v=null;for(;(v=d[m+1]?.object)instanceof Tg&&!qJ(v);)g.push(v),m++}const y=new _he(o,...g);u.push(y)}else p instanceof rd&&u.push(p)}for(const m of u)a?.addPass(m)}return()=>{for(const d of u)a?.removePass(d)}},[a,t,o]);const l=et.useMemo(()=>({composer:a,normalPass:null,downSamplingPass:null,resolutionScale:void 0,camera:o,scene:s}),[a,o,s]);return et.useImperativeHandle(r,()=>a,[a]),ke.jsx(L9.Provider,{value:l,children:ke.jsx("group",{ref:c,children:t})})}));function Pot({context:t}){return ke.jsx("group",{position:[0,0,999],children:ke.jsx(TE,{width:t.width,height:t.height})})}function Dot(){const{toast:t}=js(),e=Kv(),n=vE(e.cols,1,0,en.GREEN,en.ONCLEAR),r={...zv(e.cols,1,en.GREEN,en.ONCLEAR,0,0,e.cols-1,1),...n.getState()};if(e.cols<10||e.rows<10)return null;const i=e.cols-1;return ke.jsx(xE,{store:n,children:t&&ke.jsxs(ke.Fragment,{children:[ke.jsx($9,{margin:1,color:en.YELLOW,y:0,leftedge:0,rightedge:i,line:t,context:r}),ke.jsx("group",{position:[0,0,998],children:ke.jsx(z9,{alpha:.4,width:e.cols,height:10,top:0,left:0,right:i,bottom:0})}),ke.jsx(Pot,{context:r})]})})}function Lot({url:t,drawwidth:e,drawheight:n}){const r=u8(K0e,t);et.useEffect(()=>{r.flipY=!0,gle(r)},[r]);const{width:i=1,height:s=1}=r?.image??{},o=Math.min(e/i,n/s),a=i*o,c=s*o;return ke.jsxs("mesh",{children:[ke.jsx("planeGeometry",{args:[a,c]}),ke.jsx("meshBasicMaterial",{map:r})]})}function Uot(){const t=Kv(),{viewimage:e,setviewimage:n}=Ba();if(t.cols<10||t.rows<10)return null;const r=t.cols-1,i=t.rows-1,s=(t.cols-4)*En.DRAW_CHAR_WIDTH(),o=(t.rows-2)*En.DRAW_CHAR_HEIGHT(),a=t.cols*En.DRAW_CHAR_WIDTH()*.5,c=t.rows*En.DRAW_CHAR_HEIGHT()*.5;return e&&ke.jsxs(bb,{children:[ke.jsx(ja,{CANCEL_BUTTON:()=>n("")}),ke.jsxs("group",{position:[0,0,998],children:[ke.jsx(z9,{alpha:.4,width:t.cols,height:t.rows,top:0,left:0,right:r,bottom:i}),ke.jsx("group",{position:[a,c,1],"scale-x":-1,"rotation-z":Math.PI,children:ke.jsx(et.Suspense,{fallback:null,children:ke.jsx(Lot,{url:e,drawwidth:s,drawheight:o})})})]})]})}var AC={},MC={},kC={},VJ;function Bot(){if(VJ)return kC;VJ=1,Object.defineProperty(kC,"__esModule",{value:!0}),kC.Slice=void 0;let t=class{constructor(n,r,i,s){this.uint8=n,this.view=r,this.start=i,this.end=s}subarray(){return this.uint8.subarray(this.start,this.end)}};return kC.Slice=t,kC}var GJ;function Fot(){if(GJ)return MC;GJ=1,Object.defineProperty(MC,"__esModule",{value:!0}),MC.Writer=void 0;const t=Bot(),e=new Uint8Array([]),n=new DataView(e.buffer),r=typeof Lo=="function",i=r?Lo.prototype.utf8Write:null,s=r?Lo.from:null,o=typeof TextEncoder<"u"?new TextEncoder:null;let a=class{constructor(l=64*1024){this.allocSize=l,this.view=n,this.x0=0,this.x=0,this.uint8=new Uint8Array(l),this.size=l,this.view=new DataView(this.uint8.buffer)}grow(l){const u=this.x0,h=this.x,d=this.uint8,m=new Uint8Array(l),p=new DataView(m.buffer),g=d.subarray(u,h);m.set(g,0),this.x=h-u,this.x0=0,this.uint8=m,this.size=l,this.view=p}ensureCapacity(l){const u=this.size,h=u-this.x;if(h<l){const d=u-this.x0,m=l-h,p=d+m;this.grow(p<=this.allocSize?this.allocSize:p*2)}}move(l){this.ensureCapacity(l),this.x+=l}reset(){this.x0=this.x}newBuffer(l){const u=this.uint8=new Uint8Array(l);this.size=l,this.view=new DataView(u.buffer),this.x=this.x0=0}flush(){const l=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,l}flushSlice(){const l=new t.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,l}u8(l){this.ensureCapacity(1),this.uint8[this.x++]=l}u16(l){this.ensureCapacity(2),this.view.setUint16(this.x,l),this.x+=2}u32(l){this.ensureCapacity(4),this.view.setUint32(this.x,l),this.x+=4}i32(l){this.ensureCapacity(4),this.view.setInt32(this.x,l),this.x+=4}u64(l){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(l)),this.x+=8}f64(l){this.ensureCapacity(8),this.view.setFloat64(this.x,l),this.x+=8}u8u16(l,u){this.ensureCapacity(3);let h=this.x;this.uint8[h++]=l,this.uint8[h++]=u>>>8,this.uint8[h++]=u&255,this.x=h}u8u32(l,u){this.ensureCapacity(5);let h=this.x;this.uint8[h++]=l,this.view.setUint32(h,u),this.x=h+4}u8u64(l,u){this.ensureCapacity(9);let h=this.x;this.uint8[h++]=l,this.view.setBigUint64(h,BigInt(u)),this.x=h+8}u8f32(l,u){this.ensureCapacity(5);let h=this.x;this.uint8[h++]=l,this.view.setFloat32(h,u),this.x=h+4}u8f64(l,u){this.ensureCapacity(9);let h=this.x;this.uint8[h++]=l,this.view.setFloat64(h,u),this.x=h+8}buf(l,u){this.ensureCapacity(u);const h=this.x;this.uint8.set(l,h),this.x=h+u}utf8(l){const u=l.length*4;if(u<168)return this.utf8Native(l);if(i){const h=i.call(this.uint8,l,this.x,u);return this.x+=h,h}else if(s){const h=this.uint8,d=h.byteOffset+this.x,p=s(h.buffer).subarray(d,d+u).write(l,0,u,"utf8");return this.x+=p,p}else if(u>1024&&o){const h=o.encodeInto(l,this.uint8.subarray(this.x,this.x+u)).written;return this.x+=h,h}return this.utf8Native(l)}utf8Native(l){const u=l.length,h=this.uint8;let d=this.x,m=0;for(;m<u;){let g=l.charCodeAt(m++);if((g&4294967168)===0){h[d++]=g;continue}else if((g&4294965248)===0)h[d++]=g>>6&31|192;else{if(g>=55296&&g<=56319&&m<u){const y=l.charCodeAt(m);(y&64512)===56320&&(m++,g=((g&1023)<<10)+(y&1023)+65536)}(g&4294901760)===0?(h[d++]=g>>12&15|224,h[d++]=g>>6&63|128):(h[d++]=g>>18&7|240,h[d++]=g>>12&63|128,h[d++]=g>>6&63|128)}h[d++]=g&63|128}const p=d-this.x;return this.x=d,p}ascii(l){const u=l.length;this.ensureCapacity(u);const h=this.uint8;let d=this.x,m=0;for(;m<u;)h[d++]=l.charCodeAt(m++);this.x=d}};return MC.Writer=a,MC}var $J;function jot(){if($J)return AC;$J=1,Object.defineProperty(AC,"__esModule",{value:!0}),AC.MsgPackEncoderFast=void 0;const t=Fot();let e=class{constructor(r=new t.Writer){this.writer=r}encode(r){return this.writer.reset(),this.writeAny(r),this.writer.flush()}encodeAny(r){this.writeAny(r)}writeAny(r){switch(r){case null:return this.writer.u8(192);case!1:return this.writer.u8(194);case!0:return this.writer.u8(195)}if(r instanceof Array)return this.writeArr(r);switch(typeof r){case"number":return this.writeNumber(r);case"string":return this.writeStr(r);case"object":return this.writeObj(r)}}encodeFloat64(r){this.writeFloat(r)}writeNull(){return this.writer.u8(192)}writeFloat(r){this.writer.u8f64(203,r)}u32(r){const i=this.writer;this.writer.ensureCapacity(5);const s=i.uint8;r<=127?s[i.x++]=r:r<=65535?(s[i.x++]=205,i.view.setUint16(i.x,r),i.x+=2):r<=4294967295?(s[i.x++]=206,i.view.setUint32(i.x,r),i.x+=4):this.writeFloat(r)}n32(r){const i=this.writer;this.writer.ensureCapacity(5);const s=i.uint8;r>=-32?s[i.x++]=256+r:r>=-32768?(s[i.x++]=209,i.view.setInt16(i.x,r),i.x+=2):r>=-2147483648?(s[i.x++]=210,i.view.setInt32(i.x,r),i.x+=4):this.writeFloat(r)}encodeNumber(r){this.writeNumber(r)}writeNumber(r){if(r>>>0===r)return this.u32(r);if(r>>0===r)return this.n32(r);this.writeFloat(r)}writeInteger(r){if(r>=0){if(r<=4294967295)return this.u32(r);if(r>-2147483648)return this.n32(r)}this.writeFloat(r)}writeUInteger(r){if(r<=4294967295)return this.u32(r);this.writeFloat(r)}encodeNull(){this.writer.u8(192)}encodeTrue(){this.writer.u8(195)}encodeFalse(){this.writer.u8(194)}encodeBoolean(r){this.writeBoolean(r)}writeBoolean(r){r?this.writer.u8(195):this.writer.u8(194)}encodeStringHeader(r){this.writeStrHdr(r)}writeStrHdr(r){r<=31?this.writer.u8(160|r):r<=255?this.writer.u16(55552+r):r<=65535?this.writer.u8u16(218,r):this.writer.u8u32(219,r)}encodeString(r){this.writeStr(r)}writeStr(r){const i=this.writer,o=r.length*4;i.ensureCapacity(5+o);const a=i.uint8;let c=i.x;o<=31?i.x++:o<=255?(a[i.x++]=217,c=i.x,i.x++):o<=65535?(a[i.x++]=218,c=i.x,i.x+=2):(a[i.x++]=219,c=i.x,i.x+=4);const l=this.writer.utf8(r);o<=31?a[c]=160|l:o<=255?a[c]=l:o<=65535?i.view.setUint16(c,l):i.view.setUint32(c,l)}encodeAsciiString(r){this.writeAsciiStr(r)}writeAsciiStr(r){this.writeStrHdr(r.length),this.writer.ascii(r)}encodeArrayHeader(r){this.writeArrHdr(r)}encodeArray(r){this.writeArr(r)}writeArrHdr(r){r<=15?this.writer.u8(144|r):r<=65535?this.writer.u8u16(220,r):r<=4294967295&&this.writer.u8u32(221,r)}writeArr(r){const i=r.length;i<=15?this.writer.u8(144|i):i<=65535?this.writer.u8u16(220,i):i<=4294967295&&this.writer.u8u32(221,i);for(let s=0;s<i;s++)this.writeAny(r[s])}encodeObjectHeader(r){this.writeObjHdr(r)}encodeObject(r){this.writeObj(r)}writeObjHdr(r){r<=15?this.writer.u8(128|r):r<=65535?this.writer.u8u16(222,r):r<=4294967295&&this.writer.u8u32(223,r)}writeObj(r){const i=Object.keys(r),s=i.length;this.writeObjHdr(s);for(let o=0;o<s;o++){const a=i[o];this.writeStr(a),this.writeAny(r[a])}}encodeExtHeader(r,i){switch(i){case 1:this.writer.u16(54272|r);break;case 2:this.writer.u16(54528|r);break;case 4:this.writer.u16(54784|r);break;case 8:this.writer.u16(55040|r);break;case 16:this.writer.u16(55296|r);break;default:i<=255?(this.writer.u16(50944|i),this.writer.u8(r)):i<=65535?(this.writer.u8u16(200,i),this.writer.u8(r)):i<=4294967295&&(this.writer.u8u32(201,i),this.writer.u8(r))}}encodeExt(r){const{tag:i,val:s}=r,o=s.length;this.encodeExtHeader(i,o),this.writer.buf(s,o)}encodeBinaryHeader(r){this.writeBinHdr(r)}encodeBinary(r){this.writeBin(r)}writeBinHdr(r){r<=255?this.writer.u16(50176|r):r<=65535?this.writer.u8u16(197,r):r<=4294967295&&this.writer.u8u32(198,r)}writeBin(r){const i=r.length;this.writeBinHdr(i),this.writer.buf(r,i)}};return AC.MsgPackEncoderFast=e,AC}jot();var Rn;(function(t){t[t.add=0]="add",t[t.remove=1]="remove",t[t.replace=2]="replace",t[t.copy=3]="copy",t[t.move=4]="move",t[t.test=5]="test",t[t.str_ins=6]="str_ins",t[t.str_del=7]="str_del",t[t.flip=8]="flip",t[t.inc=9]="inc",t[t.split=10]="split",t[t.merge=11]="merge",t[t.extend=12]="extend",t[t.contains=30]="contains",t[t.defined=31]="defined",t[t.ends=32]="ends",t[t.in=33]="in",t[t.less=34]="less",t[t.matches=35]="matches",t[t.more=36]="more",t[t.starts=37]="starts",t[t.undefined=38]="undefined",t[t.test_type=39]="test_type",t[t.test_string=40]="test_string",t[t.test_string_len=41]="test_string_len",t[t.type=42]="type",t[t.and=43]="and",t[t.not=44]="not",t[t.or=45]="or"})(Rn||(Rn={}));class tp{path;from;constructor(e){this.path=e}}var xU={};const CE=ZQ(AYe);var TU={},WJ;function zot(){return WJ||(WJ=1,Object.defineProperty(TU,"__esModule",{value:!0})),TU}var wU={},KJ;function Yhe(){return KJ||(KJ=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.isInteger=t.isRoot=t.toPath=void 0,t.unescapeComponent=s,t.escapeComponent=o,t.parseJsonPointer=a,t.formatJsonPointer=c,t.isChild=u,t.isPathEqual=h,t.parent=m,t.isValidIndex=p;const e=/~1/g,n=/~0/g,r=/~/g,i=/\//g;function s(y){return y.indexOf("~")===-1?y:y.replace(e,"/").replace(n,"~")}function o(y){return y.indexOf("/")===-1&&y.indexOf("~")===-1?y:y.replace(r,"~0").replace(i,"~1")}function a(y){return y?y.slice(1).split("/").map(s):[]}function c(y){return(0,t.isRoot)(y)?"":"/"+y.map(v=>o(String(v))).join("/")}const l=y=>typeof y=="string"?a(y):y;t.toPath=l;function u(y,v){if(y.length>=v.length)return!1;for(let x=0;x<y.length;x++)if(y[x]!==v[x])return!1;return!0}function h(y,v){if(y.length!==v.length)return!1;for(let x=0;x<y.length;x++)if(y[x]!==v[x])return!1;return!0}const d=y=>!y.length;t.isRoot=d;function m(y){if(y.length<1)throw new Error("NO_PARENT");return y.slice(0,y.length-1)}function p(y){if(typeof y=="number")return!0;const v=Number.parseInt(y,10);return String(v)===y&&v>=0}const g=y=>{const v=y.length;let x=0,E;for(;x<v;){if(E=y.charCodeAt(x),E>=48&&E<=57){x++;continue}return!1}return!0};t.isInteger=g})(wU)),wU}var RU={},XJ;function Hot(){return XJ||(XJ=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.validatePath=t.validateJsonPointer=void 0;const e=i=>{if(typeof i=="string"){if(i){if(i[0]!=="/")throw new Error("POINTER_INVALID");if(i.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,t.validatePath)(i)};t.validateJsonPointer=e;const{isArray:n}=Array,r=i=>{if(!n(i))throw new Error("Invalid path.");if(i.length>256)throw new Error("Path too long.");for(const s of i)switch(typeof s){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};t.validatePath=r})(RU)),RU}var OC={},IC={},YJ;function Q9(){if(YJ)return IC;YJ=1,Object.defineProperty(IC,"__esModule",{value:!0}),IC.hasOwnProperty=void 0;const t=Object.prototype.hasOwnProperty;function e(n,r){return t.call(n,r)}return IC.hasOwnProperty=e,IC}var ZJ;function qot(){if(ZJ)return OC;ZJ=1,Object.defineProperty(OC,"__esModule",{value:!0}),OC.get=void 0;const t=Q9(),e=(n,r)=>{const i=r.length;let s;if(!i)return n;for(let o=0;o<i;o++)if(s=r[o],n instanceof Array){if(typeof s!="number"){if(s==="-")return;const a=~~s;if(""+a!==s)return;s=a}n=n[s]}else if(typeof n=="object"){if(!n||!(0,t.hasOwnProperty)(n,s))return;n=n[s]}else return;return n};return OC.get=e,OC}var sg={},JJ;function Vot(){if(JJ)return sg;JJ=1,Object.defineProperty(sg,"__esModule",{value:!0}),sg.isObjectReference=sg.isArrayEnd=sg.isArrayReference=sg.find=void 0;const t=Q9(),{isArray:e}=Array,n=(o,a)=>{const c=a.length;if(!c)return{val:o};let l,u;for(let d=0;d<c;d++)if(l=o,u=a[d],e(l)){const m=l.length;if(u==="-")u=m;else if(typeof u=="string"){const p=~~u;if(""+p!==u)throw new Error("INVALID_INDEX");if(u=p,u<0)throw new Error("INVALID_INDEX")}o=l[u]}else if(typeof l=="object"&&l)o=(0,t.hasOwnProperty)(l,u)?l[u]:void 0;else throw new Error("NOT_FOUND");return{val:o,obj:l,key:u}};sg.find=n;const r=o=>e(o.obj)&&typeof o.key=="number";sg.isArrayReference=r;const i=o=>o.obj.length===o.key;sg.isArrayEnd=i;const s=o=>typeof o.obj=="object"&&typeof o.key=="string";return sg.isObjectReference=s,sg}var CU={},NC={},QJ;function Got(){if(QJ)return NC;QJ=1,Object.defineProperty(NC,"__esModule",{value:!0}),NC.findByPointer=void 0;const t=Q9(),e=Yhe(),{isArray:n}=Array,r=(i,s)=>{if(!i)return{val:s};let o,a,c=0,l=1;for(;c>-1;)if(c=i.indexOf("/",l),a=c>-1?i.substring(l,c):i.substring(l),l=c+1,o=s,n(o)){const u=o.length;if(a==="-")a=u;else{const h=~~a;if(""+h!==a)throw new Error("INVALID_INDEX");if(a=h,a<0)throw"INVALID_INDEX"}s=o[a]}else if(typeof o=="object"&&o)a=(0,e.unescapeComponent)(a),s=(0,t.hasOwnProperty)(o,a)?o[a]:void 0;else throw"NOT_FOUND";return{val:s,obj:o,key:a}};return NC.findByPointer=r,NC}var eQ;function $ot(){return eQ||(eQ=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),CE.__exportStar(Got(),t)})(CU)),CU}var tQ;function Wot(){return tQ||(tQ=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=CE;e.__exportStar(zot(),t),e.__exportStar(Yhe(),t),e.__exportStar(Hot(),t),e.__exportStar(qot(),t),e.__exportStar(Vot(),t),e.__exportStar($ot(),t)})(xU)),xU}var er=Wot(),AU={},nQ;function Kot(){return nQ||(nQ=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0;const{isArray:e}=Array,n=Object.keys,r=i=>{if(!i)return i;if(e(i)){const s=[],o=i.length;for(let a=0;a<o;a++)s.push((0,t.clone)(i[a]));return s}else if(typeof i=="object"){const s=n(i),o=s.length,a={};for(let c=0;c<o;c++){const l=s[c];a[l]=(0,t.clone)(i[l])}return a}return i};t.clone=r})(AU)),AU}var ej=Kot();class tj extends tp{value;constructor(e,n){super(e),this.value=n}op(){return"add"}code(){return Rn.add}apply(e){const{val:n,key:r,obj:i}=er.find(e,this.path),s=ej.clone(this.value);if(!i)e=s;else if(typeof r=="string")i[r]=s;else{const o=i.length;if(r<o)i.splice(r,0,s);else{if(r>o)throw new Error("INVALID_INDEX");i.push(s)}}return{doc:e,old:n}}toJson(e){return{op:"add",path:er.formatJsonPointer(this.path),value:this.value}}toCompact(e,n){return[n?"add":Rn.add,this.path,this.value]}}class Zhe extends tp{oldValue;constructor(e,n){super(e),this.oldValue=n}op(){return"remove"}code(){return Rn.remove}apply(e){const n=er.find(e,this.path);if(n.val===void 0)throw new Error("NOT_FOUND");return er.isObjectReference(n)?delete n.obj[n.key]:er.isArrayReference(n)?n.val!==void 0&&n.obj.splice(n.key,1):e=null,{doc:e,old:n.val}}toJson(e){const n={op:"remove",path:er.formatJsonPointer(this.path)};return this.oldValue!==void 0&&(n.oldValue=this.oldValue),n}toCompact(e,n){const r=n?"remove":Rn.remove;return this.oldValue===void 0?[r,this.path]:[r,this.path,this.oldValue]}}class Xot extends tp{value;oldValue;constructor(e,n,r){super(e),this.value=n,this.oldValue=r}op(){return"replace"}code(){return Rn.replace}apply(e){const n=er.find(e,this.path);if(n.val===void 0)throw new Error("NOT_FOUND");const r=ej.clone(this.value);return er.isObjectReference(n)||er.isArrayReference(n)?n.obj[n.key]=r:e=r,{doc:e,old:n.val}}toJson(e){const n={op:"replace",path:er.formatJsonPointer(this.path),value:this.value};return this.oldValue!==void 0&&(n.oldValue=this.oldValue),n}toCompact(e,n){const r=n?"replace":Rn.replace;return this.oldValue===void 0?[r,this.path,this.value]:[r,this.path,this.value,this.oldValue]}}class Yot extends tp{from;constructor(e,n){super(e),this.from=n}op(){return"move"}code(){return Rn.move}apply(e){const n=new Zhe(er.toPath(this.from),void 0).apply(e);return new tj(this.path,n.old).apply(n.doc)}toJson(e){return{op:"move",path:er.formatJsonPointer(this.path),from:er.formatJsonPointer(this.from)}}toCompact(e,n){return[n?"move":Rn.move,this.path,this.from]}}class Zot extends tp{from;constructor(e,n){super(e),this.from=n}op(){return"copy"}code(){return Rn.copy}apply(e){const{val:n}=er.find(e,this.from);if(n===void 0)throw new Error("NOT_FOUND");return new tj(this.path,ej.clone(n)).apply(e)}toJson(e){return{op:"copy",path:er.formatJsonPointer(this.path),from:er.formatJsonPointer(this.from)}}toCompact(e,n){return[n?"copy":Rn.copy,this.path,this.from]}}class eh extends tp{apply(e){if(!this.test(e))throw new Error("TEST");return{doc:e}}}var MU={},kU={},rQ;function Jot(){return rQ||(rQ=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.deepEqual=void 0;const e=Array.isArray,n=Object.prototype,r=(i,s)=>{if(i===s)return!0;let o=0,a=0;if(e(i)){if(!e(s)||(o=i.length,o!==s.length))return!1;for(a=o;a--!==0;)if(!(0,t.deepEqual)(i[a],s[a]))return!1;return!0}if(i&&s&&typeof i=="object"&&typeof s=="object"){e:{if(i.__proto__===n)break e;if(i instanceof Uint8Array){if(!(s instanceof Uint8Array))return!1;const l=i.length;if(l!==s.length)return!1;for(let u=0;u<l;u++)if(i[u]!==s[u])return!1;return!0}}const c=Object.keys(i);if(o=c.length,o!==Object.keys(s).length||e(s))return!1;for(a=o;a--!==0;){const l=c[a];if(!(0,t.deepEqual)(i[l],s[l]))return!1}return!0}return!1};t.deepEqual=r})(kU)),kU}var iQ;function Qot(){return iQ||(iQ=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),CE.__exportStar(Jot(),t)})(MU)),MU}var Jhe=Qot();class eat extends eh{value;not;constructor(e,n,r){super(e),this.value=n,this.not=r}op(){return"test"}code(){return Rn.test}test(e){const{val:n}=er.find(e,this.path);if(n===void 0)return!!this.not;const r=Jhe.deepEqual(n,this.value);return this.not?!r:r}toJson(e){const n={op:"test",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.not&&(n.not=this.not),n}toCompact(e,n){const r=e?this.path.slice(e.path.length):this.path,i=n?"test":Rn.test;return this.not?[i,r,this.value,1]:[i,r,this.value]}}class tat extends tp{op(){return"flip"}code(){return Rn.flip}apply(e){const n=er.find(e,this.path);return n.obj?n.obj[n.key]=!n.val:e=!n.val,{doc:e,old:n.val}}toJson(e){return{op:"flip",path:er.formatJsonPointer(this.path)}}toCompact(e,n){return[n?"flip":Rn.flip,this.path]}}class nat extends tp{inc;constructor(e,n){super(e),this.inc=n}op(){return"inc"}code(){return Rn.inc}apply(e){const n=er.find(e,this.path),r=this.inc+Number(n.val);return n.obj?n.obj[n.key]=r:e=r,{doc:e,old:n.val}}toJson(e){return{op:"inc",path:er.formatJsonPointer(this.path),inc:this.inc}}toCompact(e,n){return[n?"inc":Rn.inc,this.path,this.inc]}}class rat extends tp{pos;str;constructor(e,n,r){super(e),this.pos=n,this.str=r}op(){return"str_ins"}code(){return Rn.str_ins}apply(e){const{val:n,key:r,obj:i}=er.find(e,this.path);if(typeof n!="string"){if(n!==void 0)throw new Error("NOT_A_STRING");if(this.pos!==0)throw new Error("POS")}const s=typeof n=="string"?n:"",o=Math.min(this.pos,s.length),a=s.slice(0,o),c=s.slice(o),l=a+this.str+c;return i?i[r]=l:e=l,{doc:e,old:n}}toJson(e){return{op:"str_ins",path:er.formatJsonPointer(this.path),pos:this.pos,str:this.str}}toCompact(e,n){return[n?"str_ins":Rn.str_ins,this.path,this.pos,this.str]}}class sQ extends tp{pos;str;len;constructor(e,n,r,i){super(e),this.pos=n,this.str=r,this.len=i}op(){return"str_del"}code(){return Rn.str_del}deleteLength(){return typeof this.str=="string"?this.str.length:this.len}apply(e){const{val:n,key:r,obj:i}=er.find(e,this.path);if(typeof n!="string")throw new Error("NOT_A_STRING");const s=n.length,o=Math.min(this.pos,n.length),a=Math.min(o,s),c=this.str!==void 0?this.str.length:this.len,l=Math.min(o+c,s),u=n.slice(0,a),h=n.substr(l),d=u+h;return i?i[r]=d:e=d,{doc:e,old:n}}toJson(e){return typeof this.str=="string"?{op:"str_del",path:er.formatJsonPointer(this.path),pos:this.pos,str:this.str}:{op:"str_del",path:er.formatJsonPointer(this.path),pos:this.pos,len:this.len}}toCompact(e,n){const r=n?"str_del":Rn.str_del;return typeof this.str=="string"?[r,this.path,this.pos,this.str]:[r,this.path,this.pos,0,this.len]}}const{isArray:iat}=Array,MB=t=>!!t&&typeof t=="object"&&typeof t.text=="string",kB=t=>!!t&&typeof t=="object"&&iat(t.children),sat=(t,e)=>{const n=new RegExp(t,e?"i":void 0);return r=>n.test(r)};class oat extends tp{pos;props;constructor(e,n,r){super(e),this.pos=n,this.props=r}op(){return"split"}code(){return Rn.split}apply(e){const n=er.find(e,this.path);if(n.val===void 0)throw new Error("NOT_FOUND");const r=this.split(n.val);return er.isObjectReference(n)?n.obj[n.key]=r:er.isArrayReference(n)?(n.obj[n.key]=r[0],n.obj.splice(n.key+1,0,r[1])):e=r,{doc:e,old:n.val}}split(e){if(typeof e=="string"){const{pos:n,props:r}=this,i=e.slice(0,n),s=e.slice(n);return r?[{...r,text:i},{...r,text:s}]:[i,s]}else if(MB(e)){const{pos:n,props:r}=this,i=e.text.slice(0,n),s=e.text.slice(n);return[{...e,...r,text:i},{...e,...r,text:s}]}else if(kB(e)){const{pos:n,props:r}=this,i=e.children.slice(0,n),s=e.children.slice(n);return[{...e,...r,children:i},{...e,...r,children:s}]}else if(typeof e=="number"){const{pos:n}=this;return[n,e-n]}else return[e,e]}toJson(e){const n={op:"split",path:er.formatJsonPointer(this.path),pos:this.pos};return this.props&&(n.props=this.props),n}toCompact(e,n){const r=n?"split":Rn.split;return this.props?[r,this.path,this.pos,this.props]:[r,this.path,this.pos]}}class aat extends tp{pos;props;constructor(e,n,r){super(e),this.pos=n,this.props=r}op(){return"merge"}code(){return Rn.merge}apply(e){const n=er.find(e,this.path);if(!er.isArrayReference(n))throw new Error("INVALID_TARGET");if(n.key<=0)throw new Error("INVALID_KEY");const r=n.obj[n.key-1],i=n.obj[n.key],s=this.merge(r,i);return n.obj[n.key-1]=s,n.obj.splice(n.key,1),{doc:e,old:[r,i]}}merge(e,n){return typeof e=="string"&&typeof n=="string"||typeof e=="number"&&typeof n=="number"?e+n:MB(e)&&MB(n)?{...e,...n,text:e.text+n.text}:kB(e)&&kB(n)?{...e,...n,children:[...e.children,...n.children]}:[e,n]}toJson(e){const n={op:"merge",path:er.formatJsonPointer(this.path),pos:this.pos};return this.props&&(n.props=this.props),n}toCompact(e,n){const r=n?"merge":Rn.merge;return this.props?[r,this.path,this.pos,this.props]:[r,this.path,this.pos]}}const{isArray:cat}=Array;class lat extends tp{props;deleteNull;constructor(e,n,r){super(e),this.props=n,this.deleteNull=r}op(){return"extend"}code(){return Rn.extend}apply(e){const n=er.find(e,this.path);return er.isArrayReference(n)?n.val!==void 0&&(n.obj[n.key]=this.extend(n.val)):er.isObjectReference(n)?n.obj[n.key]=this.extend(n.val):e=this.extend(e),{doc:e}}extend(e){if(cat(e)||typeof e!="object"||!e)return e;for(const[n,r]of Object.entries(this.props)){if(n==="__proto__")throw new Error("NO_PROTO");if(r===null&&this.deleteNull){delete e[n];continue}e[n]=r}return e}toJson(e){const n={op:"extend",path:er.formatJsonPointer(this.path),props:this.props};return this.deleteNull&&(n.deleteNull=this.deleteNull),n}toCompact(e,n){const r=n?"extend":Rn.extend;return this.deleteNull?[r,this.path,this.props,1]:[r,this.path,this.props]}}class uat extends eh{op(){return"defined"}code(){return Rn.defined}test(e){const{val:n}=er.find(e,this.path);return n!==void 0}toJson(e){return{op:"defined",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path)}}toCompact(e,n){return[n?"defined":Rn.defined,e?this.path.slice(e.path.length):this.path]}}class fat extends eh{op(){return"undefined"}code(){return Rn.undefined}test(e){try{const{val:n}=er.find(e,this.path);return n===void 0}catch(n){if(n.message==="NOT_FOUND")return!0;throw n}}toJson(e){return{op:"undefined",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path)}}toCompact(e,n){return[n?"undefined":Rn.undefined,e?this.path.slice(e.path.length):this.path]}}const{isArray:hat}=Array;class dat extends eh{type;constructor(e,n){super(e),this.type=n}op(){return"test_type"}code(){return Rn.test_type}test(e){const{val:n}=er.find(e,this.path);return n===null?this.type.indexOf("null")>-1:hat(n)?this.type.indexOf("array")>-1:this.type.indexOf(typeof n)>-1||typeof n=="number"&&n===Math.round(n)&&this.type.indexOf("integer")>-1}toJson(e){return{op:"test_type",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),type:this.type}}toCompact(e,n){return[n?"test_type":Rn.test_type,e?this.path.slice(e.path.length):this.path,this.type]}}class pat extends eh{pos;str;not;constructor(e,n,r,i){super(e),this.pos=n,this.str=r,this.not=i}op(){return"test_string"}code(){return Rn.test_string}test(e){const{val:n}=er.find(e,this.path);if(typeof n!="string")return!1;const r=n.length,i=Math.min(this.pos,r),s=Math.min(this.pos+this.str.length,r),o=n.substring(i,s)===this.str;return this.not?!o:o}toJson(e){const n={op:"test_string",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),pos:this.pos,str:this.str};return this.not&&(n.not=this.not),n}toCompact(e,n){const r=n?"test_string":Rn.test_string,i=e?this.path.slice(e.path.length):this.path;return this.not?[r,i,this.pos,this.str,1]:[r,i,this.pos,this.str]}}class mat extends eh{len;not;constructor(e,n,r){super(e),this.len=n,this.not=r}op(){return"test_string_len"}code(){return Rn.test_string_len}test(e){const{val:n}=er.find(e,this.path);if(typeof n!="string")return!1;const i=n.length>=this.len;return this.not?!i:i}toJson(e){const n={op:"test_string_len",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),len:this.len};return this.not&&(n.not=this.not),n}toCompact(e,n){const r=n?"test_string_len":Rn.test_string_len,i=e?this.path.slice(e.path.length):this.path;return this.not?[r,i,this.len,1]:[r,i,this.len]}}class gat extends eh{value;ignore_case;constructor(e,n,r){super(e),this.value=n,this.ignore_case=r}op(){return"contains"}code(){return Rn.contains}test(e){const{val:n}=er.find(e,this.path);if(typeof n!="string")return!1;const r=this.ignore_case?n.toLowerCase():n,i=this.ignore_case?this.value.toLowerCase():this.value;return r.indexOf(i)>-1}toJson(e){const n={op:"contains",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(n.ignore_case=this.ignore_case),n}toCompact(e,n){const r=n?"contains":Rn.contains;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class _at extends eh{value;ignore_case;constructor(e,n,r){super(e),this.value=n,this.ignore_case=r}op(){return"ends"}code(){return Rn.ends}test(e){const{val:n}=er.find(e,this.path);if(typeof n!="string")return!1;const r=this.ignore_case?n.toLowerCase():n,i=this.ignore_case?this.value.toLowerCase():this.value;return r.endsWith(i)}toJson(e){const n={op:"ends",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(n.ignore_case=this.ignore_case),n}toCompact(e,n){const r=n?"ends":Rn.ends;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class vat extends eh{value;ignore_case;constructor(e,n,r){super(e),this.value=n,this.ignore_case=r}op(){return"starts"}code(){return Rn.starts}test(e){const{val:n}=er.find(e,this.path);if(typeof n!="string")return!1;const r=this.ignore_case?n.toLowerCase():n,i=this.ignore_case?this.value.toLowerCase():this.value;return r.startsWith(i)}toJson(e){const n={op:"starts",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(n.ignore_case=this.ignore_case),n}toCompact(e,n){const r=n?"starts":Rn.starts;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class yat extends eh{value;constructor(e,n){super(e),this.value=n}op(){return"in"}code(){return Rn.in}test(e){const{val:n}=er.find(e,this.path);for(const r of this.value)if(Jhe.deepEqual(n,r))return!0;return!1}toJson(e){return{op:"in",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,n){return[n?"in":Rn.in,e?this.path.slice(e.path.length):this.path,this.value]}}class bat extends eh{value;constructor(e,n){super(e),this.value=n}op(){return"less"}code(){return Rn.less}test(e){const{val:n}=er.find(e,this.path);return typeof n!="number"?!1:n<this.value}toJson(e){return{op:"less",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,n){return[n?"less":Rn.less,e?this.path.slice(e.path.length):this.path,this.value]}}class Eat extends eh{value;constructor(e,n){super(e),this.value=n}op(){return"more"}code(){return Rn.more}test(e){const{val:n}=er.find(e,this.path);return typeof n!="number"?!1:n>this.value}toJson(e){return{op:"more",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,n){return[n?"more":Rn.more,e?this.path.slice(e.path.length):this.path,this.value]}}class nj extends eh{ops;constructor(e,n){super(e),this.ops=n}}class Sat extends nj{ops;constructor(e,n){super(e,n),this.ops=n}op(){return"and"}code(){return Rn.and}test(e){for(const n of this.ops)if(!n.test(e))return!1;return!0}toJson(e){return{op:"and",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,n){return[n?"and":Rn.and,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,n))]}}class xat extends nj{ops;constructor(e,n){super(e,n),this.ops=n}op(){return"or"}code(){return Rn.or}test(e){for(const n of this.ops)if(n.test(e))return!0;return!1}toJson(e){return{op:"or",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,n){return[n?"or":Rn.or,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,n))]}}class Tat extends nj{ops;constructor(e,n){super(e,n),this.ops=n}op(){return"not"}code(){return Rn.not}test(e){for(const n of this.ops)if(n.test(e))return!1;return!0}toJson(e){return{op:"not",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,n){return[n?"not":Rn.not,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,n))]}}class wat extends eh{value;ignore_case;matcher;constructor(e,n,r,i){super(e),this.value=n,this.ignore_case=r,this.matcher=i(n,r)}op(){return"matches"}code(){return Rn.matches}test(e){const{val:n}=er.find(e,this.path);return typeof n!="string"?!1:this.matcher(n)}toJson(e){const n={op:"matches",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(n.ignore_case=this.ignore_case),n}toCompact(e,n){const r=n?"matches":Rn.matches;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}const{isArray:Rat}=Array;class Cat extends eh{value;constructor(e,n){super(e),this.value=n}op(){return"type"}code(){return Rn.type}test(e){const{val:n}=er.find(e,this.path);return n===null?this.value==="null":Rat(n)?this.value==="array":typeof n===this.value||typeof n=="number"&&n===Math.round(n)&&this.value==="integer"}toJson(e){return{op:"type",path:er.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,n){return[n?"type":Rn.type,e?this.path.slice(e.path.length):this.path,this.value]}}var PC={},DC={},oQ;function Aat(){if(oQ)return DC;oQ=1,Object.defineProperty(DC,"__esModule",{value:!0}),DC.JsonPackExtension=void 0;let t=class{constructor(n,r){this.tag=n,this.val=r}};return DC.JsonPackExtension=t,DC}var LC={},UC={},rO={},Zb={},aQ;function Mat(){if(aQ)return Zb;aQ=1,Object.defineProperty(Zb,"__esModule",{value:!0}),Zb.decodeAsciiMax15=Zb.decodeAscii=void 0;const t=String.fromCharCode,e=(r,i,s)=>{const o=[];for(let a=0;a<s;a++){const c=r[i++];if(c&128)return;o.push(c)}return t.apply(String,o)};Zb.decodeAscii=e;const n=(r,i,s)=>{if(s<4)if(s<2){if(s===0)return"";{const o=r[i++];if((o&128)>1){i-=1;return}return t(o)}}else{const o=r[i++],a=r[i++];if((o&128)>0||(a&128)>0){i-=2;return}if(s<3)return t(o,a);const c=r[i++];if((c&128)>0){i-=3;return}return t(o,a,c)}else{const o=r[i++],a=r[i++],c=r[i++],l=r[i++];if((o&128)>0||(a&128)>0||(c&128)>0||(l&128)>0){i-=4;return}if(s<6){if(s===4)return t(o,a,c,l);{const u=r[i++];if((u&128)>0){i-=5;return}return t(o,a,c,l,u)}}else if(s<8){const u=r[i++],h=r[i++];if((u&128)>0||(h&128)>0){i-=6;return}if(s<7)return t(o,a,c,l,u,h);const d=r[i++];if((d&128)>0){i-=7;return}return t(o,a,c,l,u,h,d)}else{const u=r[i++],h=r[i++],d=r[i++],m=r[i++];if((u&128)>0||(h&128)>0||(d&128)>0||(m&128)>0){i-=8;return}if(s<10){if(s===8)return t(o,a,c,l,u,h,d,m);{const p=r[i++];if((p&128)>0){i-=9;return}return t(o,a,c,l,u,h,d,m,p)}}else if(s<12){const p=r[i++],g=r[i++];if((p&128)>0||(g&128)>0){i-=10;return}if(s<11)return t(o,a,c,l,u,h,d,m,p,g);const y=r[i++];if((y&128)>0){i-=11;return}return t(o,a,c,l,u,h,d,m,p,g,y)}else{const p=r[i++],g=r[i++],y=r[i++],v=r[i++];if((p&128)>0||(g&128)>0||(y&128)>0||(v&128)>0){i-=12;return}if(s<14){if(s===12)return t(o,a,c,l,u,h,d,m,p,g,y,v);{const x=r[i++];if((x&128)>0){i-=13;return}return t(o,a,c,l,u,h,d,m,p,g,y,v,x)}}else{const x=r[i++],E=r[i++];if((x&128)>0||(E&128)>0){i-=14;return}if(s<15)return t(o,a,c,l,u,h,d,m,p,g,y,v,x,E);const C=r[i++];if((C&128)>0){i-=15;return}return t(o,a,c,l,u,h,d,m,p,g,y,v,x,E,C)}}}}};return Zb.decodeAsciiMax15=n,Zb}var iO={},cQ;function kat(){if(cQ)return iO;cQ=1,Object.defineProperty(iO,"__esModule",{value:!0});const t=String.fromCharCode;return iO.default=(e,n,r)=>{let i=n;const s=i+r,o=[];for(;i<s;){let a=e[i++];if((a&128)!==0){const c=e[i++]&63;if((a&224)===192)a=(a&31)<<6|c;else{const l=e[i++]&63;if((a&240)===224)a=(a&31)<<12|c<<6|l;else if((a&248)===240){const u=e[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;if(h>65535){h-=65536;const d=h>>>10&1023|55296;a=56320|h&1023,o.push(d)}else a=h}}}o.push(a)}return t.apply(String,o)},iO}var lQ;function Oat(){if(lQ)return rO;lQ=1,Object.defineProperty(rO,"__esModule",{value:!0});const t=CE,e=Mat(),n=t.__importDefault(kat()),r=typeof Lo<"u",i=r?Lo.prototype.utf8Slice:null,s=r?Lo.from:null,o=(u,h,d)=>(0,e.decodeAsciiMax15)(u,h,d)??(0,n.default)(u,h,d),a=(u,h,d)=>(0,e.decodeAscii)(u,h,d)??(0,n.default)(u,h,d),c=i?(u,h,d)=>i.call(u,h,h+d):s?(u,h,d)=>s(u).subarray(h,h+d).toString("utf8"):n.default,l=(u,h,d)=>d<16?o(u,h,d):d<32?a(u,h,d):c(u,h,d);return rO.default=l,rO}var uQ;function Iat(){if(uQ)return UC;uQ=1,Object.defineProperty(UC,"__esModule",{value:!0}),UC.decodeUtf8=void 0;const e=CE.__importDefault(Oat());return UC.decodeUtf8=e.default,UC}var fQ;function Nat(){if(fQ)return LC;fQ=1,Object.defineProperty(LC,"__esModule",{value:!0}),LC.Reader=void 0;const t=Iat();let e=class{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(r){this.x=0,this.uint8=r,this.view=new DataView(r.buffer,r.byteOffset,r.length)}peek(){return this.view.getUint8(this.x)}peak(){return this.peek()}skip(r){this.x+=r}buf(r){const i=this.x+r,s=this.uint8.subarray(this.x,i);return this.x=i,s}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let r=this.x;const i=(this.uint8[r++]<<8)+this.uint8[r++];return this.x=r,i}i16(){const r=this.view.getInt16(this.x);return this.x+=2,r}u32(){const r=this.view.getUint32(this.x);return this.x+=4,r}i32(){const r=this.view.getInt32(this.x);return this.x+=4,r}u64(){const r=this.view.getBigUint64(this.x);return this.x+=8,r}i64(){const r=this.view.getBigInt64(this.x);return this.x+=8,r}f32(){const r=this.x;return this.x+=4,this.view.getFloat32(r)}f64(){const r=this.x;return this.x+=8,this.view.getFloat64(r)}utf8(r){const i=this.x;return this.x+=r,(0,t.decodeUtf8)(this.uint8,i,r)}ascii(r){const i=this.uint8;let s="";const o=this.x+r;for(let a=this.x;a<o;a++)s+=String.fromCharCode(i[a]);return this.x=o,s}};return LC.Reader=e,LC}var sO={},BC={},oO={},hQ;function Pat(){if(hQ)return oO;hQ=1,Object.defineProperty(oO,"__esModule",{value:!0});const t=String.fromCharCode;return oO.default=(e,n,r)=>{let i=n;const s=i+r;let o="";for(;i<s;){const a=e[i++];if((a&128)===0){o+=t(a);continue}const c=e[i++]&63;if((a&224)===192){o+=t((a&31)<<6|c);continue}const l=e[i++]&63;if((a&240)===224){o+=t((a&31)<<12|c<<6|l);continue}if((a&248)===240){const u=e[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;if(h>65535){h-=65536;const d=h>>>10&1023|55296;h=56320|h&1023,o+=t(d,h)}else o+=t(h)}else o+=t(a)}return o},oO}var dQ;function Dat(){if(dQ)return BC;dQ=1,Object.defineProperty(BC,"__esModule",{value:!0}),BC.CachedUtf8Decoder=void 0;const e=CE.__importDefault(Pat());let n=1+Math.round(Math.random()*((-1>>>0)-1));function r(o,a){return n^=n<<13,n^=n>>>17,n^=n<<5,(n>>>0)%(a-o+1)+o}class i{constructor(a,c){this.bytes=a,this.value=c}}let s=class{constructor(){this.caches=[];for(let a=0;a<31;a++)this.caches.push([])}get(a,c,l){const u=this.caches[l-1],h=u.length;e:for(let d=0;d<h;d++){const m=u[d],p=m.bytes;for(let g=0;g<l;g++)if(p[g]!==a[c+g])continue e;return m.value}return null}store(a,c){const l=this.caches[a.length-1],u=new i(a,c);l.length>=16?l[r(0,15)]=u:l.push(u)}decode(a,c,l){if(!l)return"";const u=this.get(a,c,l);if(u!==null)return u;const h=(0,e.default)(a,c,l),d=Uint8Array.prototype.slice.call(a,c,c+l);return this.store(d,h),h}};return BC.CachedUtf8Decoder=s,BC}var pQ;function Lat(){if(pQ)return sO;pQ=1,Object.defineProperty(sO,"__esModule",{value:!0});const t=Dat();return sO.default=new t.CachedUtf8Decoder,sO}var mQ;function Uat(){if(mQ)return PC;mQ=1,Object.defineProperty(PC,"__esModule",{value:!0}),PC.MsgPackDecoderFast=void 0;const t=CE,e=Aat(),n=Nat(),r=t.__importDefault(Lat());let i=class{constructor(o=new n.Reader,a=r.default){this.reader=o,this.keyDecoder=a}decode(o){return this.reader.reset(o),this.readAny()}read(o){return this.reader.reset(o),this.readAny()}val(){return this.readAny()}readAny(){const o=this.reader,a=o.u8();if(a>=224)return a-256;if(a<=191)return a<144?a<=127?a:this.obj(a&15):a<160?this.arr(a&15):o.utf8(a&31);if(a<=208)return a<=200?a<=196?a<=194?a===194?!1:a===192?null:void 0:a===196?o.buf(o.u8()):!0:a<=198?a===198?o.buf(o.u32()):o.buf(o.u16()):a===200?this.ext(o.u16()):this.ext(o.u8()):a<=204?a<=202?a===202?o.f32():this.ext(o.u32()):a===204?o.u8():o.f64():a<=206?a===206?o.u32():o.u16():a===208?o.i8():o.u32()*4294967296+o.u32();if(a<=216)return a<=212?a<=210?a===210?o.i32():o.i16():a===212?this.ext(1):o.i32()*4294967296+o.u32():a<=214?a===214?this.ext(4):this.ext(2):a===216?this.ext(16):this.ext(8);switch(a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32());case 220:return this.arr(o.u16());case 221:return this.arr(o.u32());case 222:return this.obj(o.u16());case 223:return this.obj(o.u32())}}str(){const o=this.reader,a=o.u8();if(a>>5===5)return o.utf8(a&31);switch(a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32())}}obj(o){const a={};for(let c=0;c<o;c++){const l=this.key();if(l==="__proto__")throw 6;a[l]=this.readAny()}return a}key(){const o=this.reader,a=o.view.getUint8(o.x);if(a>=160&&a<=191){const c=a&31,l=this.keyDecoder.decode(o.uint8,o.x+1,c);return o.x+=1+c,l}else if(a===217){const c=o.view.getUint8(o.x+1);if(c<32){const l=this.keyDecoder.decode(o.uint8,o.x+2,c);return o.x+=2+c,l}}switch(o.x++,a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32());default:return""}}arr(o){const a=[];for(let c=0;c<o;c++)a.push(this.readAny());return a}ext(o){const a=this.reader,c=a.u8(),l=a.x+o,u=a.uint8.subarray(a.x,l);return a.x=l,new e.JsonPackExtension(c,u)}back(o){this.reader.x-=o}};return PC.MsgPackDecoderFast=i,PC}var Bat=Uat();class Fat extends Bat.MsgPackDecoderFast{options;constructor(e){super(),this.options=e}decode(e){return this.reader.reset(e),this.decodePatch()}decodePatch(){const e=this.decodeArrayHeader(),n=[];for(let r=0;r<e;r++)n.push(this.decodeOp(void 0));return n}decodeOp(e){const n=this.decodeArrayHeader();switch(this.reader.u8()){case Rn.add:{const i=this.decodeArray(),s=this.val();return new tj(i,s)}case Rn.and:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new Sat(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case Rn.contains:{const i=this.decodePath(e),s=this.decodeString(),o=n>3;return new gat(i,s,o)}case Rn.copy:{const i=this.decodeArray(),s=this.decodeArray();return new Zot(i,s)}case Rn.defined:{const i=this.decodePath(e);return new uat(i)}case Rn.ends:{const i=this.decodePath(e),s=this.decodeString(),o=n>3;return new _at(i,s,o)}case Rn.extend:{const i=this.decodeArray(),s=this.decodeObject(),o=n>3;return new lat(i,s,o)}case Rn.flip:{const i=this.decodeArray();return new tat(i)}case Rn.in:{const i=this.decodePath(e),s=this.decodeArray();return new yat(i,s)}case Rn.inc:{const i=this.decodePath(e),s=this.val();return new nat(i,s)}case Rn.less:{const i=this.decodePath(e),s=this.val();return new bat(i,s)}case Rn.matches:{const i=this.decodePath(e),s=this.decodeString(),o=n>3;return new wat(i,s,o,this.options.createMatcher||sat)}case Rn.merge:{const i=n>3,s=this.decodeArray(),o=this.val(),a=i?this.decodeObject():null;return new aat(s,o,a)}case Rn.more:{const i=this.decodePath(e),s=this.val();return new Eat(i,s)}case Rn.move:{const i=this.decodeArray(),s=this.decodeArray();return new Yot(i,s)}case Rn.not:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new Tat(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case Rn.or:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new xat(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case Rn.remove:{const i=this.decodeArray(),o=n>2?this.val():void 0;return new Zhe(i,o)}case Rn.replace:{const i=this.decodeArray(),s=this.val(),a=n>3?this.val():void 0;return new Xot(i,s,a)}case Rn.split:{const i=this.decodeArray(),s=this.val(),a=n>3?this.decodeObject():null;return new oat(i,s,a)}case Rn.starts:{const i=n>3,s=this.decodePath(e),o=this.decodeString();return new vat(s,o,i)}case Rn.str_del:{const i=n<5,s=this.decodeArray(),o=this.val();if(i){const a=this.decodeString();return new sQ(s,o,a,void 0)}else{this.reader.u8();const a=this.val();return new sQ(s,o,void 0,a)}}case Rn.str_ins:{const i=this.decodeArray(),s=this.val(),o=this.decodeString();return new rat(i,s,o)}case Rn.test:{const i=n>3,s=this.decodePath(e),o=this.val();return new eat(s,o,i)}case Rn.test_string:{const i=n>4,s=this.decodePath(e),o=this.val(),a=this.decodeString();return new pat(s,o,a,i)}case Rn.test_string_len:{const i=n>3,s=this.decodePath(e),o=this.val();return new mat(s,o,i)}case Rn.test_type:{const i=this.decodePath(e),s=this.decodeArray();return new dat(i,s)}case Rn.type:{const i=this.decodePath(e),s=this.decodeString();return new Cat(i,s)}case Rn.undefined:{const i=this.decodePath(e);return new fat(i)}}throw new Error("OP_UNKNOWN")}decodePath(e){const n=this.decodeArray();return e?[...e.path,...n]:n}decodeObject(){const e=this.reader,n=e.u8();return n<=191?this.obj(n&15):n===222?this.obj(e.u16()):this.obj(e.u32())}decodeArray(){const e=this.reader,n=e.u8();return n<159?this.arr(n&15):n===220?this.arr(e.u16()):this.arr(e.u32())}decodeArrayHeader(){const e=this.reader,n=e.u8();return n<159?n&15:n===220?e.u16():e.u32()}decodeString(){const e=this.reader,n=e.u8();return n<=191?e.utf8(n&31):n===217?e.utf8(e.u8()):n===218?e.utf8(e.u16()):e.utf8(e.u32())}}function jat(t){const e=[],n=t.length;for(let r=0;r<n;r++)e.push(t[r].toJson());return e}var Qhe=(t=>(t[t.id=0]="id",t[t.x=1]="x",t[t.y=2]="y",t[t.char=3]="char",t[t.color=4]="color",t[t.bg=5]="bg",t[t.stat=6]="stat",t[t.pid=7]="pid",t))(Qhe||{});function zat(t){return iF(t,Qhe)}var ede=(t=>(t[t.id=0]="id",t[t.type=1]="type",t[t.tag=2]="tag",t[t.width=3]="width",t[t.height=4]="height",t[t.char=5]="char",t[t.color=6]="color",t[t.bg=7]="bg",t[t.stats=8]="stats",t[t.sprites=9]="sprites",t[t.alphas=10]="alphas",t[t.mime=11]="mime",t[t.media=12]="media",t[t.focusx=13]="focusx",t[t.focusy=14]="focusy",t[t.focusid=15]="focusid",t[t.viewscale=16]="viewscale",t[t.graphics=17]="graphics",t[t.facing=18]="facing",t))(ede||{});function Hat(t){return iF(t,ede,{sprites:e=>e.map(zat)})}var tde=(t=>(t[t.id=0]="id",t[t.board=1]="board",t[t.over=2]="over",t[t.under=3]="under",t[t.layers=4]="layers",t[t.tickers=5]="tickers",t[t.scrollname=6]="scrollname",t[t.scroll=7]="scroll",t[t.sidebar=8]="sidebar",t))(tde||{});function gQ(t){return iF(t,tde,{layers:e=>e.map(Hat)})}const qat=new Fat({}),_Q=lb("gadgetclient",[],t=>{if(!_Q.session(t)||t.player!==ui())return;const{desync:e}=Si.getState();switch(t.target){case"paint":{const n=gQ(t.data);Si.setState({desync:!1,gadget:n,slim:t.data});break}case"patch":e||Si.setState(n=>{let r;try{const i=qat.decode(t.data),s=jat(i),o=u3(na(n.slim),s,!0,!0),a=gQ(o.newDocument);return{...n,gadget:a,slim:o.newDocument}}catch(i){r=i}return ge(r)?(_Q.reply(t,"desync"),{...n,desync:!0}):n});break}}),rj=Object.prototype.toString.call(typeof Sa<"u"?Sa:0)==="[object process]";var yy,xr;(function(t){t[t.CRITICAL=0]="CRITICAL",t[t.ERROR=1]="ERROR",t[t.WARNING=2]="WARNING",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG",t[t.TRACE=7]="TRACE"})(xr||(xr={}));function ij(t){if(typeof t=="number"){if(Object.prototype.hasOwnProperty.call(xr,t))return t;var e=Object.keys(xr).map(function(r){return parseInt(r,10)}).filter(function(r){return!isNaN(r)&&r<t});return e.length?Math.max.apply(Math,e):xr.WARNING}var n=t.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(xr,n))throw new Error("Unknown log level string: ".concat(t));return xr[n]}var Vat=rj?console.log.bind(console):console.debug.bind(console),nde=(yy={},yy[xr.CRITICAL]=console.error.bind(console),yy[xr.ERROR]=console.error.bind(console),yy[xr.WARNING]=console.warn.bind(console),yy[xr.INFO]=console.info.bind(console),yy[xr.DEBUG]=Vat.bind(console),yy[xr.TRACE]=console.trace.bind(console),yy);function Sb(t){return function(e,n){Object.defineProperty(e,n,{get:function(){},set:function(r){Object.defineProperty(this,n,{value:r,writable:!0,enumerable:t})},enumerable:t})}}function OB(t){return jo(this,void 0,Promise,function(){return r2(this,function(e){switch(e.label){case 0:return typeof t!="function"?[3,2]:[4,t()];case 1:return[2,e.sent()];case 2:return[2,t]}})})}function Gat(t){return typeof t=="function"?t():t}function rde(t){var e,n,r;return r2(this,function(i){switch(i.label){case 0:e=0,n=1,i.label=1;case 1:return e<t?[4,e]:[3,3];case 2:return i.sent(),r=EE([n,e+n],2),e=r[0],n=r[1],[3,1];case 3:return[4,t];case 4:return i.sent(),[3,3];case 5:return[2]}})}function aO(t,e){return Object.assign.apply(Object,cM([{}],EE(t.map(e)),!1))}function IB(t,e){Object.entries(t).forEach(function(n){var r=EE(n,2),i=r[0],s=r[1];return e(s,i)})}function ide(t){return t==null}function pM(t,e){return ide(t)?null:e(t)}function sde(t,e){return ide(t)?void 0:e(t)}function $at(t){return jo(this,void 0,Promise,function(){return r2(this,function(e){switch(e.label){case 0:return[4,new Promise(function(n){return setTimeout(n,t)})];case 1:return e.sent(),[2]}})})}function NB(){var t,e,n=new Promise(function(r,i){t=r,e=i});return{promise:n,resolve:t,reject:e}}function Wat(t,e,n){if(typeof t=="number"&&(t=t.toString()),e=e-t.length,e<=0)return t;n===void 0&&(n=" ");var r="";do(e&1)===1&&(r+=n),e>>=1,e&&(n+=n);while(e);return r+t}function O1(t,e,n){var r=t.split(e);return r.length<=n?r:cM(cM([],EE(r.slice(0,n-1)),!1),[r.slice(n-1).join(e)],!1)}var Kat={},OU,IU,qN=typeof Sa>"u"?[]:(IU=(OU=Kat.LOGGING)===null||OU===void 0?void 0:OU.split(";").map(function(t){var e=t.split("=",2),n=e[0],r=e[1];return r?[n==="default"?void 0:n.split(":"),ij(r)]:null}).filter(function(t){return!!t}).sort(function(t,e){var n,r,i=t[0],s=e[0];return((n=s?.length)!==null&&n!==void 0?n:0)-((r=i?.length)!==null&&r!==void 0?r:0)}))!==null&&IU!==void 0?IU:[],NU=qN.findIndex(function(t){var e=t[0];return!e}),ode=void 0;NU!==-1&&(ode=qN[NU][1],qN.splice(NU));function Xat(t,e){return e.length<=t.length&&e.every(function(n,r){return n===t[r]})}function ade(t){for(var e=t.split(":"),n=0,r=qN;n<r.length;n++){var i=r[n],s=i[0],o=i[1];if(Xat(e,s))return o}return ode}var cde=(function(){function t(e){var n=e.name,r=e.minLevel,i=e.emoji,s=i===void 0?!1:i,o=e.colors,a=e.timestamps,c=a===void 0?rj:a,l,u;this._name=n,this._minLevel=(u=(l=sde(r,function(h){return ij(h)}))!==null&&l!==void 0?l:ade(n))!==null&&u!==void 0?u:xr.WARNING,this._emoji=s,this._colors=o,this._timestamps=c}return t.prototype.crit=function(e){this.log(xr.CRITICAL,e)},t.prototype.error=function(e){this.log(xr.ERROR,e)},t.prototype.warn=function(e){this.log(xr.WARNING,e)},t.prototype.info=function(e){this.log(xr.INFO,e)},t.prototype.debug=function(e){this.log(xr.DEBUG,e)},t.prototype.trace=function(e){this.log(xr.TRACE,e)},t})(),Yat=(function(t){yP(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.log=function(n,r){if(!(n>this._minLevel)){var i=nde[n],s="[".concat(this._name,"] ").concat(r);this._timestamps&&(s="[".concat(new Date().toISOString(),"] ").concat(r)),i(s)}},e})(cde),Zat=(function(){function t(e){var n=e.name,r=e.minLevel,i=e.custom,s;this._minLevel=(s=sde(r,function(o){return ij(o)}))!==null&&s!==void 0?s:ade(n),this._override=typeof i=="function"?{log:i}:i}return t.prototype.log=function(e,n){this._shouldLog(e)&&this._override.log(e,n)},t.prototype.crit=function(e){this._override.crit?this._shouldLog(xr.CRITICAL)&&this._override.crit(e):this.log(xr.CRITICAL,e)},t.prototype.error=function(e){this._override.error?this._shouldLog(xr.ERROR)&&this._override.error(e):this.log(xr.ERROR,e)},t.prototype.warn=function(e){this._override.warn?this._shouldLog(xr.WARNING)&&this._override.warn(e):this.log(xr.WARNING,e)},t.prototype.info=function(e){this._override.info?this._shouldLog(xr.INFO)&&this._override.info(e):this.log(xr.INFO,e)},t.prototype.debug=function(e){this._override.debug?this._shouldLog(xr.DEBUG)&&this._override.debug(e):this.log(xr.DEBUG,e)},t.prototype.trace=function(e){this._override.trace?this._shouldLog(xr.TRACE)&&this._override.trace(e):this.log(xr.TRACE,e)},t.prototype._shouldLog=function(e){return this._minLevel===void 0||this._minLevel>=e},t})(),by,Ey,Sy,Jat=(by={},by[xr.CRITICAL]="",by[xr.ERROR]="",by[xr.WARNING]=" ",by[xr.INFO]=" ",by[xr.DEBUG]="",by[xr.TRACE]="",by),Qat={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},ect={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function zP(t,e,n){return function(r){return"\x1B[".concat(t,"m").concat(n?n(r):r,"\x1B[").concat(e,"m")}}function w0(t){return zP(Qat[t],39)}function FC(t,e){return zP(ect[t],49,e)}var tct=(Ey={},Ey[xr.CRITICAL]=w0("red"),Ey[xr.ERROR]=w0("redBright"),Ey[xr.WARNING]=w0("yellow"),Ey[xr.INFO]=w0("blue"),Ey[xr.DEBUG]=w0("magenta"),Ey[xr.TRACE]=zP(0,0),Ey),vQ=(Sy={},Sy[xr.CRITICAL]=FC("bgRed",w0("white")),Sy[xr.ERROR]=FC("bgRedBright",w0("white")),Sy[xr.WARNING]=FC("bgYellow",w0("black")),Sy[xr.INFO]=FC("bgBlue",w0("white")),Sy[xr.DEBUG]=FC("bgMagenta",w0("black")),Sy[xr.TRACE]=zP(7,27),Sy),nct=(function(t){yP(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.log=function(n,r){var i,s,o;if(!(n>this._minLevel)){var a=nde[n],c="";if(this._timestamps&&(c+="[".concat(new Date().toISOString(),"] ")),this._emoji){var l=Jat[n];c+="".concat(l," ")}var u=(o=(i=this._colors)!==null&&i!==void 0?i:(s=Sa.stdout)===null||s===void 0?void 0:s.isTTY)!==null&&o!==void 0?o:!0;u?c+="".concat(vQ[n](this._name)," ").concat(vQ[n](xr[n])," ").concat(tct[n](r)):c+="[".concat(this._name,":").concat(xr[n].toLowerCase(),"] ").concat(r),a(c)}},e})(cde);function HP(t){return t.custom?new Zat(t):rj?new nct(t):new Yat(t)}let lde=class extends Error{constructor(...e){var n;super(...e),Object.setPrototypeOf(this,new.target.prototype),(n=Error.captureStackTrace)===null||n===void 0||n.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}};class VN extends lde{}class ude extends lde{}class rct{constructor({logger:e,bucketSize:n,timeFrame:r,doRequest:i,getPartitionKey:s}){this._partitionedQueue=new Map,this._usedFromBucket=new Map,this._counterTimers=new Set,this._paused=!1,this._destroyed=!1,this._logger=HP({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=n,this._timeFrame=r,this._callback=i,this._partitionKeyCallback=s}async request(e,n){return await new Promise((r,i)=>{var s,o;if(this._destroyed){i(new VN("Rate limiter was destroyed"));return}const a={req:e,resolve:r,reject:i,limitReachedBehavior:(s=n?.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"},c=this._partitionKeyCallback(e),l=(o=this._usedFromBucket.get(c))!==null&&o!==void 0?o:0;if(l>=this._bucketSize||this._paused)switch(a.limitReachedBehavior){case"enqueue":{const u=this._getPartitionedQueue(c);u.push(a),l+u.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${u.length}`):this._logger.info(`Enqueueing request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused; queue size is ${u.length}`);break}case"null":{a.resolve(null),this._paused?this._logger.info(`Returning null for request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused`):this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, dropping request and returning null`);break}case"throw":{a.reject(new ude(`Request dropped because ${this._paused?"the rate limiter is paused":`the rate limit for ${c?`partition ${c}`:"default partition"} was reached`}`));break}default:throw new Error("this should never happen")}else this._runRequest(a,c)})}clear(){this._partitionedQueue.clear()}pause(){this._paused=!0}resume(){this._paused=!1;for(const e of this._partitionedQueue.keys())this._runNextRequest(e)}destroy(){this._paused=!1,this._destroyed=!0,this._counterTimers.forEach(e=>{clearTimeout(e)});for(const e of this._partitionedQueue.values())for(const n of e)n.reject(new VN("Rate limiter was destroyed"));this._partitionedQueue.clear()}_getPartitionedQueue(e){if(this._partitionedQueue.has(e))return this._partitionedQueue.get(e);const n=[];return this._partitionedQueue.set(e,n),n}async _runRequest(e,n){var r;const i=this._getPartitionedQueue(n);this._logger.debug(`doing a request for ${n?`partition ${n}`:"default partition"}, new queue length is ${i.length}`),this._usedFromBucket.set(n,((r=this._usedFromBucket.get(n))!==null&&r!==void 0?r:0)+1);const{req:s,resolve:o,reject:a}=e;try{o(await this._callback(s))}catch(c){a(c)}finally{const c=setTimeout(()=>{this._counterTimers.delete(c);const l=this._usedFromBucket.get(n)-1;this._usedFromBucket.set(n,l),i.length&&l<this._bucketSize&&this._runNextRequest(n)},this._timeFrame);this._counterTimers.add(c)}}_runNextRequest(e){if(this._paused)return;const r=this._getPartitionedQueue(e).shift();r&&this._runRequest(r,e)}}class PB{constructor({logger:e,bucketSize:n,timeFrame:r,doRequest:i}){this._queue=[],this._usedFromBucket=0,this._counterTimers=new Set,this._paused=!1,this._destroyed=!1,this._logger=HP({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=n,this._timeFrame=r,this._callback=i}async request(e,n){return await new Promise((r,i)=>{var s;if(this._destroyed){i(new VN("Rate limiter was destroyed"));return}const o={req:e,resolve:r,reject:i,limitReachedBehavior:(s=n?.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"};if(this._usedFromBucket>=this._bucketSize||this._paused)switch(o.limitReachedBehavior){case"enqueue":{this._queue.push(o),this._usedFromBucket+this._queue.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${this._queue.length}`):this._logger.info(`Enqueueing request because the rate limiter is paused; queue size is ${this._queue.length}`);break}case"null":{o.resolve(null),this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`),this._paused?this._logger.info("Returning null for request because the rate limiter is paused"):this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`);break}case"throw":{o.reject(new ude(`Request dropped because ${this._paused?"the rate limiter is paused":"the rate limit was reached"}`));break}default:throw new Error("this should never happen")}else this._runRequest(o)})}clear(){this._queue=[]}pause(){this._paused=!0}resume(){this._paused=!1,this._runNextRequest()}destroy(){this._paused=!1,this._destroyed=!0,this._counterTimers.forEach(e=>{clearTimeout(e)});for(const e of this._queue)e.reject(new VN("Rate limiter was destroyed"));this._queue=[]}async _runRequest(e){this._logger.debug(`doing a request, new queue length is ${this._queue.length}`),this._usedFromBucket+=1;const{req:n,resolve:r,reject:i}=e;try{r(await this._callback(n))}catch(s){i(s)}finally{const s=setTimeout(()=>{this._counterTimers.delete(s),this._usedFromBucket-=1,this._queue.length&&this._usedFromBucket<this._bucketSize&&this._runNextRequest()},this._timeFrame);this._counterTimers.add(s)}}_runNextRequest(){if(this._paused)return;const e=this._queue.shift();e&&this._runRequest(e)}}class ict extends PB{constructor(e,n){super({...n,async doRequest(r,i){return await e.request(r,i)}})}}class sct{constructor(e,n,r,i=!1){this.owner=e,this.event=n,this.listener=r,this._internal=i}unbind(){this.owner.removeListener(this)}}class C2{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(e,n){return this._addListener(!1,e,n)}addListener(e,n){return this._addListener(!1,e,n)}removeListener(e,n){this._removeListener(!1,e,n)}registerEvent(){const e=n=>this.addListener(e,n);return e}emit(e,...n){if(this._eventListeners.has(e))for(const r of this._eventListeners.get(e))r(...n);if(this._internalEventListeners.has(e))for(const r of this._internalEventListeners.get(e))r(...n)}registerInternalEvent(){const e=n=>this.addInternalListener(e,n);return e}addInternalListener(e,n){return this._addListener(!0,e,n)}removeInternalListener(e,n){this._removeListener(!0,e,n)}_addListener(e,n,r){const i=e?this._eventListeners:this._internalEventListeners;return i.has(n)?i.get(n).push(r):i.set(n,[r]),new sct(this,n,r,e)}_removeListener(e,n,r){const i=e?this._eventListeners:this._internalEventListeners;if(!n)i.clear();else if(typeof n=="object"){const s=n;this._removeListener(s._internal,s.event,s.listener)}else{const s=n;if(i.has(s))if(r){const o=i.get(s);let a=0;for(;(a=o.indexOf(r))!==-1;)o.splice(a,1)}else i.delete(s)}}}const oct=6e4;function act(t){return pM(t.expiresIn,e=>t.obtainmentTimestamp+e*1e3-oct)}function nI(t){var e;return(e=pM(act(t),n=>Date.now()>n))!==null&&e!==void 0?e:!1}var QC={exports:{}},cct=QC.exports,yQ;function lct(){return yQ||(yQ=1,(function(t,e){var n=typeof self<"u"?self:cct,r=(function(){function s(){this.fetch=!1,this.DOMException=n.DOMException}return s.prototype=n,new s})();(function(s){(function(o){var a={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function c(N){return N&&DataView.prototype.isPrototypeOf(N)}if(a.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(N){return N&&l.indexOf(Object.prototype.toString.call(N))>-1};function h(N){if(typeof N!="string"&&(N=String(N)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(N))throw new TypeError("Invalid character in header field name");return N.toLowerCase()}function d(N){return typeof N!="string"&&(N=String(N)),N}function m(N){var X={next:function(){var G=N.shift();return{done:G===void 0,value:G}}};return a.iterable&&(X[Symbol.iterator]=function(){return X}),X}function p(N){this.map={},N instanceof p?N.forEach(function(X,G){this.append(G,X)},this):Array.isArray(N)?N.forEach(function(X){this.append(X[0],X[1])},this):N&&Object.getOwnPropertyNames(N).forEach(function(X){this.append(X,N[X])},this)}p.prototype.append=function(N,X){N=h(N),X=d(X);var G=this.map[N];this.map[N]=G?G+", "+X:X},p.prototype.delete=function(N){delete this.map[h(N)]},p.prototype.get=function(N){return N=h(N),this.has(N)?this.map[N]:null},p.prototype.has=function(N){return this.map.hasOwnProperty(h(N))},p.prototype.set=function(N,X){this.map[h(N)]=d(X)},p.prototype.forEach=function(N,X){for(var G in this.map)this.map.hasOwnProperty(G)&&N.call(X,this.map[G],G,this)},p.prototype.keys=function(){var N=[];return this.forEach(function(X,G){N.push(G)}),m(N)},p.prototype.values=function(){var N=[];return this.forEach(function(X){N.push(X)}),m(N)},p.prototype.entries=function(){var N=[];return this.forEach(function(X,G){N.push([G,X])}),m(N)},a.iterable&&(p.prototype[Symbol.iterator]=p.prototype.entries);function g(N){if(N.bodyUsed)return Promise.reject(new TypeError("Already read"));N.bodyUsed=!0}function y(N){return new Promise(function(X,G){N.onload=function(){X(N.result)},N.onerror=function(){G(N.error)}})}function v(N){var X=new FileReader,G=y(X);return X.readAsArrayBuffer(N),G}function x(N){var X=new FileReader,G=y(X);return X.readAsText(N),G}function E(N){for(var X=new Uint8Array(N),G=new Array(X.length),j=0;j<X.length;j++)G[j]=String.fromCharCode(X[j]);return G.join("")}function C(N){if(N.slice)return N.slice(0);var X=new Uint8Array(N.byteLength);return X.set(new Uint8Array(N)),X.buffer}function A(){return this.bodyUsed=!1,this._initBody=function(N){this._bodyInit=N,N?typeof N=="string"?this._bodyText=N:a.blob&&Blob.prototype.isPrototypeOf(N)?this._bodyBlob=N:a.formData&&FormData.prototype.isPrototypeOf(N)?this._bodyFormData=N:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(N)?this._bodyText=N.toString():a.arrayBuffer&&a.blob&&c(N)?(this._bodyArrayBuffer=C(N.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(N)||u(N))?this._bodyArrayBuffer=C(N):this._bodyText=N=Object.prototype.toString.call(N):this._bodyText="",this.headers.get("content-type")||(typeof N=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(N)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var N=g(this);if(N)return N;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var N=g(this);if(N)return N;if(this._bodyBlob)return x(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(E(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(z)}),this.json=function(){return this.text().then(JSON.parse)},this}var k=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function M(N){var X=N.toUpperCase();return k.indexOf(X)>-1?X:N}function I(N,X){X=X||{};var G=X.body;if(N instanceof I){if(N.bodyUsed)throw new TypeError("Already read");this.url=N.url,this.credentials=N.credentials,X.headers||(this.headers=new p(N.headers)),this.method=N.method,this.mode=N.mode,this.signal=N.signal,!G&&N._bodyInit!=null&&(G=N._bodyInit,N.bodyUsed=!0)}else this.url=String(N);if(this.credentials=X.credentials||this.credentials||"same-origin",(X.headers||!this.headers)&&(this.headers=new p(X.headers)),this.method=M(X.method||this.method||"GET"),this.mode=X.mode||this.mode||null,this.signal=X.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&G)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(G)}I.prototype.clone=function(){return new I(this,{body:this._bodyInit})};function z(N){var X=new FormData;return N.trim().split("&").forEach(function(G){if(G){var j=G.split("="),q=j.shift().replace(/\+/g," "),te=j.join("=").replace(/\+/g," ");X.append(decodeURIComponent(q),decodeURIComponent(te))}}),X}function H(N){var X=new p,G=N.replace(/\r?\n[\t ]+/g," ");return G.split(/\r?\n/).forEach(function(j){var q=j.split(":"),te=q.shift().trim();if(te){var W=q.join(":").trim();X.append(te,W)}}),X}A.call(I.prototype);function K(N,X){X||(X={}),this.type="default",this.status=X.status===void 0?200:X.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in X?X.statusText:"OK",this.headers=new p(X.headers),this.url=X.url||"",this._initBody(N)}A.call(K.prototype),K.prototype.clone=function(){return new K(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},K.error=function(){var N=new K(null,{status:0,statusText:""});return N.type="error",N};var P=[301,302,303,307,308];K.redirect=function(N,X){if(P.indexOf(X)===-1)throw new RangeError("Invalid status code");return new K(null,{status:X,headers:{location:N}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(X,G){this.message=X,this.name=G;var j=Error(X);this.stack=j.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function F(N,X){return new Promise(function(G,j){var q=new I(N,X);if(q.signal&&q.signal.aborted)return j(new o.DOMException("Aborted","AbortError"));var te=new XMLHttpRequest;function W(){te.abort()}te.onload=function(){var $={status:te.status,statusText:te.statusText,headers:H(te.getAllResponseHeaders()||"")};$.url="responseURL"in te?te.responseURL:$.headers.get("X-Request-URL");var J="response"in te?te.response:te.responseText;G(new K(J,$))},te.onerror=function(){j(new TypeError("Network request failed"))},te.ontimeout=function(){j(new TypeError("Network request failed"))},te.onabort=function(){j(new o.DOMException("Aborted","AbortError"))},te.open(q.method,q.url,!0),q.credentials==="include"?te.withCredentials=!0:q.credentials==="omit"&&(te.withCredentials=!1),"responseType"in te&&a.blob&&(te.responseType="blob"),q.headers.forEach(function($,J){te.setRequestHeader(J,$)}),q.signal&&(q.signal.addEventListener("abort",W),te.onreadystatechange=function(){te.readyState===4&&q.signal.removeEventListener("abort",W)}),te.send(typeof q._bodyInit>"u"?null:q._bodyInit)})}return F.polyfill=!0,s.fetch||(s.fetch=F,s.Headers=p,s.Request=I,s.Response=K),o.Headers=p,o.Request=I,o.Response=K,o.fetch=F,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,t.exports=e})(QC,QC.exports)),QC.exports}var fde=lct();const uct=su(fde);var PU,bQ;function sj(){if(bQ)return PU;bQ=1;var t=Object.prototype.hasOwnProperty,e=Array.isArray,n=(function(){for(var m=[],p=0;p<256;++p)m.push("%"+((p<16?"0":"")+p.toString(16)).toUpperCase());return m})(),r=function(p){for(;p.length>1;){var g=p.pop(),y=g.obj[g.prop];if(e(y)){for(var v=[],x=0;x<y.length;++x)typeof y[x]<"u"&&v.push(y[x]);g.obj[g.prop]=v}}},i=function(p,g){for(var y=g&&g.plainObjects?Object.create(null):{},v=0;v<p.length;++v)typeof p[v]<"u"&&(y[v]=p[v]);return y},s=function m(p,g,y){if(!g)return p;if(typeof g!="object"){if(e(p))p.push(g);else if(p&&typeof p=="object")(y&&(y.plainObjects||y.allowPrototypes)||!t.call(Object.prototype,g))&&(p[g]=!0);else return[p,g];return p}if(!p||typeof p!="object")return[p].concat(g);var v=p;return e(p)&&!e(g)&&(v=i(p,y)),e(p)&&e(g)?(g.forEach(function(x,E){if(t.call(p,E)){var C=p[E];C&&typeof C=="object"&&x&&typeof x=="object"?p[E]=m(C,x,y):p.push(x)}else p[E]=x}),p):Object.keys(g).reduce(function(x,E){var C=g[E];return t.call(x,E)?x[E]=m(x[E],C,y):x[E]=C,x},v)},o=function(p,g){return Object.keys(g).reduce(function(y,v){return y[v]=g[v],y},p)},a=function(m,p,g){var y=m.replace(/\+/g," ");if(g==="iso-8859-1")return y.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(y)}catch{return y}},c=function(p,g,y){if(p.length===0)return p;var v=p;if(typeof p=="symbol"?v=Symbol.prototype.toString.call(p):typeof p!="string"&&(v=String(p)),y==="iso-8859-1")return escape(v).replace(/%u[0-9a-f]{4}/gi,function(A){return"%26%23"+parseInt(A.slice(2),16)+"%3B"});for(var x="",E=0;E<v.length;++E){var C=v.charCodeAt(E);if(C===45||C===46||C===95||C===126||C>=48&&C<=57||C>=65&&C<=90||C>=97&&C<=122){x+=v.charAt(E);continue}if(C<128){x=x+n[C];continue}if(C<2048){x=x+(n[192|C>>6]+n[128|C&63]);continue}if(C<55296||C>=57344){x=x+(n[224|C>>12]+n[128|C>>6&63]+n[128|C&63]);continue}E+=1,C=65536+((C&1023)<<10|v.charCodeAt(E)&1023),x+=n[240|C>>18]+n[128|C>>12&63]+n[128|C>>6&63]+n[128|C&63]}return x},l=function(p){for(var g=[{obj:{o:p},prop:"o"}],y=[],v=0;v<g.length;++v)for(var x=g[v],E=x.obj[x.prop],C=Object.keys(E),A=0;A<C.length;++A){var k=C[A],M=E[k];typeof M=="object"&&M!==null&&y.indexOf(M)===-1&&(g.push({obj:E,prop:k}),y.push(M))}return r(g),p},u=function(p){return Object.prototype.toString.call(p)==="[object RegExp]"},h=function(p){return!p||typeof p!="object"?!1:!!(p.constructor&&p.constructor.isBuffer&&p.constructor.isBuffer(p))},d=function(p,g){return[].concat(p,g)};return PU={arrayToObject:i,assign:o,combine:d,compact:l,decode:a,encode:c,isBuffer:h,isRegExp:u,merge:s},PU}var DU,SQ;function hde(){if(SQ)return DU;SQ=1;var t=String.prototype.replace,e=/%20/g,n=sj(),r={RFC1738:"RFC1738",RFC3986:"RFC3986"};return DU=n.assign({default:r.RFC3986,formatters:{RFC1738:function(i){return t.call(i,e,"+")},RFC3986:function(i){return String(i)}}},r),DU}var LU,xQ;function fct(){if(xQ)return LU;xQ=1;var t=sj(),e=hde(),n=Object.prototype.hasOwnProperty,r={brackets:function(p){return p+"[]"},comma:"comma",indices:function(p,g){return p+"["+g+"]"},repeat:function(p){return p}},i=Array.isArray,s=Array.prototype.push,o=function(m,p){s.apply(m,i(p)?p:[p])},a=Date.prototype.toISOString,c=e.default,l={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:t.encode,encodeValuesOnly:!1,format:c,formatter:e.formatters[c],indices:!1,serializeDate:function(p){return a.call(p)},skipNulls:!1,strictNullHandling:!1},u=function(p){return typeof p=="string"||typeof p=="number"||typeof p=="boolean"||typeof p=="symbol"||typeof p=="bigint"},h=function m(p,g,y,v,x,E,C,A,k,M,I,z,H){var K=p;if(typeof C=="function"?K=C(g,K):K instanceof Date?K=M(K):y==="comma"&&i(K)&&(K=K.join(",")),K===null){if(v)return E&&!z?E(g,l.encoder,H,"key"):g;K=""}if(u(K)||t.isBuffer(K)){if(E){var P=z?g:E(g,l.encoder,H,"key");return[I(P)+"="+I(E(K,l.encoder,H,"value"))]}return[I(g)+"="+I(String(K))]}var F=[];if(typeof K>"u")return F;var N;if(i(C))N=C;else{var X=Object.keys(K);N=A?X.sort(A):X}for(var G=0;G<N.length;++G){var j=N[G];x&&K[j]===null||(i(K)?o(F,m(K[j],typeof y=="function"?y(g,j):g,y,v,x,E,C,A,k,M,I,z,H)):o(F,m(K[j],g+(k?"."+j:"["+j+"]"),y,v,x,E,C,A,k,M,I,z,H)))}return F},d=function(p){if(!p)return l;if(p.encoder!==null&&p.encoder!==void 0&&typeof p.encoder!="function")throw new TypeError("Encoder has to be a function.");var g=p.charset||l.charset;if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var y=e.default;if(typeof p.format<"u"){if(!n.call(e.formatters,p.format))throw new TypeError("Unknown format option provided.");y=p.format}var v=e.formatters[y],x=l.filter;return(typeof p.filter=="function"||i(p.filter))&&(x=p.filter),{addQueryPrefix:typeof p.addQueryPrefix=="boolean"?p.addQueryPrefix:l.addQueryPrefix,allowDots:typeof p.allowDots>"u"?l.allowDots:!!p.allowDots,charset:g,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:l.charsetSentinel,delimiter:typeof p.delimiter>"u"?l.delimiter:p.delimiter,encode:typeof p.encode=="boolean"?p.encode:l.encode,encoder:typeof p.encoder=="function"?p.encoder:l.encoder,encodeValuesOnly:typeof p.encodeValuesOnly=="boolean"?p.encodeValuesOnly:l.encodeValuesOnly,filter:x,formatter:v,serializeDate:typeof p.serializeDate=="function"?p.serializeDate:l.serializeDate,skipNulls:typeof p.skipNulls=="boolean"?p.skipNulls:l.skipNulls,sort:typeof p.sort=="function"?p.sort:null,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:l.strictNullHandling}};return LU=function(m,p){var g=m,y=d(p),v,x;typeof y.filter=="function"?(x=y.filter,g=x("",g)):i(y.filter)&&(x=y.filter,v=x);var E=[];if(typeof g!="object"||g===null)return"";var C;p&&p.arrayFormat in r?C=p.arrayFormat:p&&"indices"in p?C=p.indices?"indices":"repeat":C="indices";var A=r[C];v||(v=Object.keys(g)),y.sort&&v.sort(y.sort);for(var k=0;k<v.length;++k){var M=v[k];y.skipNulls&&g[M]===null||o(E,h(g[M],M,A,y.strictNullHandling,y.skipNulls,y.encode?y.encoder:null,y.filter,y.sort,y.allowDots,y.serializeDate,y.formatter,y.encodeValuesOnly,y.charset))}var I=E.join(y.delimiter),z=y.addQueryPrefix===!0?"?":"";return y.charsetSentinel&&(y.charset==="iso-8859-1"?z+="utf8=%26%2310003%3B&":z+="utf8=%E2%9C%93&"),I.length>0?z+I:""},LU}var hct=fct();const dde=su(hct);var UU,TQ;function dct(){if(TQ)return UU;TQ=1;var t=sj(),e=Object.prototype.hasOwnProperty,n=Array.isArray,r={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:t.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},i=function(m){return m.replace(/&#(\d+);/g,function(p,g){return String.fromCharCode(parseInt(g,10))})},s=function(m,p){return m&&typeof m=="string"&&p.comma&&m.indexOf(",")>-1?m.split(","):m},o=function(p,g){if(n(p)){for(var y=[],v=0;v<p.length;v+=1)y.push(g(p[v]));return y}return g(p)},a="utf8=%26%2310003%3B",c="utf8=%E2%9C%93",l=function(p,g){var y={},v=g.ignoreQueryPrefix?p.replace(/^\?/,""):p,x=g.parameterLimit===1/0?void 0:g.parameterLimit,E=v.split(g.delimiter,x),C=-1,A,k=g.charset;if(g.charsetSentinel)for(A=0;A<E.length;++A)E[A].indexOf("utf8=")===0&&(E[A]===c?k="utf-8":E[A]===a&&(k="iso-8859-1"),C=A,A=E.length);for(A=0;A<E.length;++A)if(A!==C){var M=E[A],I=M.indexOf("]="),z=I===-1?M.indexOf("="):I+1,H,K;z===-1?(H=g.decoder(M,r.decoder,k,"key"),K=g.strictNullHandling?null:""):(H=g.decoder(M.slice(0,z),r.decoder,k,"key"),K=o(s(M.slice(z+1),g),function(P){return g.decoder(P,r.decoder,k,"value")})),K&&g.interpretNumericEntities&&k==="iso-8859-1"&&(K=i(K)),M.indexOf("[]=")>-1&&(K=n(K)?[K]:K),e.call(y,H)?y[H]=t.combine(y[H],K):y[H]=K}return y},u=function(m,p,g,y){for(var v=y?p:s(p,g),x=m.length-1;x>=0;--x){var E,C=m[x];if(C==="[]"&&g.parseArrays)E=[].concat(v);else{E=g.plainObjects?Object.create(null):{};var A=C.charAt(0)==="["&&C.charAt(C.length-1)==="]"?C.slice(1,-1):C,k=parseInt(A,10);!g.parseArrays&&A===""?E={0:v}:!isNaN(k)&&C!==A&&String(k)===A&&k>=0&&g.parseArrays&&k<=g.arrayLimit?(E=[],E[k]=v):E[A]=v}v=E}return v},h=function(p,g,y,v){if(p){var x=y.allowDots?p.replace(/\.([^.[]+)/g,"[$1]"):p,E=/(\[[^[\]]*])/,C=/(\[[^[\]]*])/g,A=y.depth>0&&E.exec(x),k=A?x.slice(0,A.index):x,M=[];if(k){if(!y.plainObjects&&e.call(Object.prototype,k)&&!y.allowPrototypes)return;M.push(k)}for(var I=0;y.depth>0&&(A=C.exec(x))!==null&&I<y.depth;){if(I+=1,!y.plainObjects&&e.call(Object.prototype,A[1].slice(1,-1))&&!y.allowPrototypes)return;M.push(A[1])}return A&&M.push("["+x.slice(A.index)+"]"),u(M,g,y,v)}},d=function(p){if(!p)return r;if(p.decoder!==null&&p.decoder!==void 0&&typeof p.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var g=typeof p.charset>"u"?r.charset:p.charset;return{allowDots:typeof p.allowDots>"u"?r.allowDots:!!p.allowDots,allowPrototypes:typeof p.allowPrototypes=="boolean"?p.allowPrototypes:r.allowPrototypes,arrayLimit:typeof p.arrayLimit=="number"?p.arrayLimit:r.arrayLimit,charset:g,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:r.charsetSentinel,comma:typeof p.comma=="boolean"?p.comma:r.comma,decoder:typeof p.decoder=="function"?p.decoder:r.decoder,delimiter:typeof p.delimiter=="string"||t.isRegExp(p.delimiter)?p.delimiter:r.delimiter,depth:typeof p.depth=="number"||p.depth===!1?+p.depth:r.depth,ignoreQueryPrefix:p.ignoreQueryPrefix===!0,interpretNumericEntities:typeof p.interpretNumericEntities=="boolean"?p.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof p.parameterLimit=="number"?p.parameterLimit:r.parameterLimit,parseArrays:p.parseArrays!==!1,plainObjects:typeof p.plainObjects=="boolean"?p.plainObjects:r.plainObjects,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:r.strictNullHandling}};return UU=function(m,p){var g=d(p);if(m===""||m===null||typeof m>"u")return g.plainObjects?Object.create(null):{};for(var y=typeof m=="string"?l(m,g):m,v=g.plainObjects?Object.create(null):{},x=Object.keys(y),E=0;E<x.length;++E){var C=x[E],A=h(C,y[C],g,typeof m=="string");v=t.merge(v,A,g)}return t.compact(v)},UU}dct();hde();const SS=Symbol("twurpleRawData");class pct{constructor(e){this[SS]=e}}class AE extends Error{constructor(e,n){var r;super(e,n),Object.setPrototypeOf(this,new.target.prototype),(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}function A2(t,e,n){return r=>{const i=n?function(){return`[${e}#${this[n]} - please check https://twurple.js.org/reference/${t}/classes/${e}.html for available properties]`}:function(){return`[${e} - please check https://twurple.js.org/reference/${t}/classes/${e}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}class wQ extends AE{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}function Z_(t){return typeof t=="string"?t:typeof t=="number"?t.toString(10):t.id}class pde extends AE{constructor(e,n,r,i,s,o){super(`Encountered HTTP status code ${e}: ${n}

URL: ${r}
Method: ${i}
Body:
${!o&&s.length>150?`${s.slice(0,147)}...`:s}`),this._statusCode=e,this._url=r,this._method=i,this._body=s}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function mct(t,e){var n;if(!t.ok){const r=t.headers.get("Content-Type")==="application/json",i=r?JSON.stringify(await t.json(),null,2):await t.text(),s=dde(e.query,{arrayFormat:"repeat",addQueryPrefix:!0}),o=`${e.url}${s}`;throw new pde(t.status,t.statusText,o,(n=e.method)!==null&&n!==void 0?n:"GET",i,r)}}async function gct(t){if(t.status===204)return;const e=await t.text();if(e)return JSON.parse(e)}function _ct(t,e,n){switch(e){case"helix":return`https://api.twitch.tv/helix/${t.replace(/^\//,"")}`;case"auth":return`https://id.twitch.tv/oauth2/${t.replace(/^\//,"")}`;case"custom":return t;default:return t}}async function vct(t,e,n,r,i={},s){var o,a;const c=(o=t.type)!==null&&o!==void 0?o:"helix",l=_ct(t.url,c),u=dde(t.query,{arrayFormat:"repeat",addQueryPrefix:!0}),h=new fde.Headers({Accept:"application/json"});let d;t.jsonBody&&(d=JSON.stringify(t.jsonBody),h.append("Content-Type","application/json")),e&&c!=="auth"&&h.append("Client-ID",e),n&&h.append("Authorization",`${c==="helix"?"Bearer":"OAuth"} ${n}`);const m={...i,method:(a=t.method)!==null&&a!==void 0?a:"GET",headers:h,body:d};return await uct(`${l}${u}`,m)}async function qP(t,e,n,r,i={}){const s=await vct(t,e,n,r,i);return await mct(s,t),await gct(s)}class WS extends AE{constructor(e){super("Invalid token supplied",e)}}class rI extends AE{}function yct(t,e,n,r){return{grant_type:"authorization_code",client_id:t,client_secret:e,code:n,redirect_uri:r}}function bct(t,e){return{grant_type:"client_credentials",client_id:t,client_secret:e}}function Ect(t,e,n){return{grant_type:"refresh_token",client_id:t,client_secret:e,refresh_token:n}}let DB=class extends pct{constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[SS].client_id}get userId(){var e;return(e=this[SS].user_id)!==null&&e!==void 0?e:null}get userName(){var e;return(e=this[SS].login)!==null&&e!==void 0?e:null}get scopes(){return this[SS].scopes}get expiryDate(){return pM(this[SS].expires_in,e=>new Date(this._obtainmentDate.getTime()+e*1e3))}};DB=_o([A2("auth","TokenInfo","clientId")],DB);function oj(t){var e,n;return{accessToken:t.access_token,refreshToken:t.refresh_token||null,scope:(e=t.scope)!==null&&e!==void 0?e:[],expiresIn:(n=t.expires_in)!==null&&n!==void 0?n:null,obtainmentTimestamp:Date.now()}}async function Sct(t,e,n,r){return oj(await qP({type:"auth",url:"token",method:"POST",query:yct(t,e,n,r)}))}async function xct(t,e){return oj(await qP({type:"auth",url:"token",method:"POST",query:bct(t,e)}))}async function RQ(t,e,n){return oj(await qP({type:"auth",url:"token",method:"POST",query:Ect(t,e,n)}))}async function mM(t,e){try{const n=await qP({type:"auth",url:"validate"},e,t);return new DB(n)}catch(n){throw n instanceof pde&&n.statusCode===401?new WS({cause:n}):n}}const Tct=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);function wct(t,e){if(e?.length){const n=new Set(t.flatMap(r=>{var i;return[r,...(i=Tct.get(r))!==null&&i!==void 0?i:[]]}));if(e.every(r=>!n.has(r))){const r=e.join(", ");throw new Error(`This token does not have any of the requested scopes (${r}) and can not be upgraded.
If you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:

	https://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}}function iI(t,e){for(const n of e)wct(t,n)}async function Rct(t,e,n,r,i){if(i?.length||!n){const s=await mM(e,t);if(!s.userId)throw new Error("Trying to use an app access token as a user access token");const o=r??s.scopes;return i&&iI(o,i.filter(a=>!!a)),[o,s.userId]}return[r,n]}class CQ{constructor(e){this._newTokenScopeSets=[],this._newTokenPromise=null,this._queuedScopeSets=[],this._queueExecutor=null,this._queuePromise=null,this._executor=e}async fetch(...e){var n;const r=e.filter(a=>!!a);if(this._newTokenPromise){if(!r.length)return await this._newTokenPromise;if(this._queueExecutor?this._queuedScopeSets.push(...r):this._queuedScopeSets=[...r],!this._queuePromise){const{promise:a,resolve:c,reject:l}=NB();this._queuePromise=a,this._queueExecutor=async()=>{var u;if(this._queuePromise){this._newTokenScopeSets=this._queuedScopeSets,this._queuedScopeSets=[],this._newTokenPromise=this._queuePromise,this._queuePromise=null,this._queueExecutor=null;try{c(await this._executor(this._newTokenScopeSets))}catch(h){l(h)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(u=this._queueExecutor)===null||u===void 0||u.call(this)}}}}return await this._queuePromise}this._newTokenScopeSets=[...r];const{promise:i,resolve:s,reject:o}=NB();this._newTokenPromise=i;try{s(await this._executor(this._newTokenScopeSets))}catch(a){o(a)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(n=this._queueExecutor)===null||n===void 0||n.call(this)}return await i}}class AQ extends AE{constructor(e){super(`The user context for the user ${e} has been disabled.
This happened because the access token became invalid (e.g. by expiry) and refreshing it failed (e.g. because the account's password was changed).

Use .addUser(), .addUserForToken() or .addUserForCode() for the same user context to re-enable the user with a new, valid token.`),this.userId=e}}class Cct extends AE{constructor(e){super(`User ${e} was removed while trying to fetch a token.

Make sure you're not executing any actions when you want to remove a user.`),this.userId=e}}class Act extends AE{constructor(e){super(`Unknown intent: ${e}`),this.intent=e}}let sb=class extends C2{constructor(e){var n;super(),this._userAccessTokens=new Map,this._userTokenFetchers=new Map,this._intentToUserId=new Map,this._userIdToIntents=new Map,this._cachedRefreshFailures=new Set,this.onRefresh=this.registerEvent(),this.onRefreshFailure=this.registerEvent(),this._clientId=e.clientId,this._clientSecret=e.clientSecret,this._redirectUri=e.redirectUri,this._appImpliedScopes=(n=e.appImpliedScopes)!==null&&n!==void 0?n:[],this._appTokenFetcher=new CQ(async r=>await this._fetchAppToken(r))}addUser(e,n,r){const i=Z_(e);if(!n.refreshToken)throw new Error(`Trying to add user ${i} without refresh token`);this._cachedRefreshFailures.delete(i),this._userAccessTokens.set(i,{...n,userId:i}),this._userTokenFetchers.has(i)||this._userTokenFetchers.set(i,new CQ(async s=>await this._fetchUserToken(i,s))),r&&this.addIntentsToUser(e,r)}async addUserForToken(e,n){let r=null;if(e.accessToken&&!nI(e))try{const a=await mM(e.accessToken);r=[e,a]}catch(a){if(!(a instanceof WS))throw a}if(!r){if(!e.refreshToken)throw new WS;const a=await RQ(this._clientId,this._clientSecret,e.refreshToken),c=await mM(a.accessToken);this.emit(this.onRefresh,c.userId,a),r=[a,c]}const[i,s]=r;if(!s.userId)throw new rI("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");const o=i.scope?i:{...i,scope:s.scopes};return this.addUser(s.userId,o,n),s.userId}async addUserForCode(e,n){if(!this._redirectUri)throw new Error("This method requires you to pass a `redirectUri` as a configuration property");const r=await Sct(this._clientId,this._clientSecret,e,this._redirectUri);return await this.addUserForToken(r,n)}hasUser(e){return this._userTokenFetchers.has(Z_(e))}removeUser(e){const n=Z_(e);if(this._userIdToIntents.has(n)){const r=this._userIdToIntents.get(n);for(const i of r)this._intentToUserId.delete(i);this._userIdToIntents.delete(n)}this._userAccessTokens.delete(n),this._userTokenFetchers.delete(n),this._cachedRefreshFailures.delete(n)}addIntentsToUser(e,n){const r=Z_(e);if(!this._userAccessTokens.has(r))throw new Error("Trying to add intents to a user that was not added to this provider");for(const i of n)this._intentToUserId.has(i)&&this._userIdToIntents.get(this._intentToUserId.get(i)).delete(i),this._intentToUserId.set(i,r),this._userIdToIntents.has(r)?this._userIdToIntents.get(r).add(i):this._userIdToIntents.set(r,new Set([i]))}getIntentsForUser(e){const n=Z_(e);return this._userIdToIntents.has(n)?Array.from(this._userIdToIntents.get(n)):[]}removeIntents(e){var n;for(const r of e)if(this._intentToUserId.has(r)){const i=this._intentToUserId.get(r);(n=this._userIdToIntents.get(i))===null||n===void 0||n.delete(r),this._intentToUserId.delete(r)}}async refreshAccessTokenForUser(e){const n=Z_(e);if(this._cachedRefreshFailures.has(n))throw new AQ(n);const r=this._userAccessTokens.get(n);if(!r)throw new Error("Trying to refresh token for user that was not added to the provider");const i=await this._refreshUserTokenWithCallback(n,r.refreshToken);return this._checkIntermediateUserRemoval(n),this._userAccessTokens.set(n,{...i,userId:n}),this.emit(this.onRefresh,n,i),{...i,userId:n}}async refreshAccessTokenForIntent(e){if(!this._intentToUserId.has(e))throw new Act(e);const n=this._intentToUserId.get(e);return await this.refreshAccessTokenForUser(n)}get clientId(){return this._clientId}getCurrentScopesForUser(e){var n;const r=this._userAccessTokens.get(Z_(e));if(!r)throw new Error("Trying to get scopes for user that was not added to the provider");return(n=r.scope)!==null&&n!==void 0?n:[]}async getAccessTokenForUser(e,...n){const r=Z_(e),i=this._userTokenFetchers.get(r);if(!i)return null;if(this._cachedRefreshFailures.has(r))throw new AQ(r);return iI(this.getCurrentScopesForUser(r),n.filter(Boolean)),await i.fetch(...n)}async getAccessTokenForIntent(e,...n){if(!this._intentToUserId.has(e))return null;const r=this._intentToUserId.get(e),i=await this.getAccessTokenForUser(r,...n);if(!i)throw new wQ(`Found intent ${e} corresponding to user ID ${r} but no token was found`);return{...i,userId:r}}async getAnyAccessToken(e){if(e){const n=Z_(e);if(this._userAccessTokens.has(n)){const r=await this.getAccessTokenForUser(n);if(!r)throw new wQ(`Token for user ID ${n} exists but nothing was returned by getAccessTokenForUser`);return{...r,userId:n}}}return await this.getAppAccessToken()}async getAppAccessToken(e=!1){return e&&(this._appAccessToken=void 0),await this._appTokenFetcher.fetch(...this._appImpliedScopes.map(n=>[n]))}_checkIntermediateUserRemoval(e){if(!this._userTokenFetchers.has(e))throw this._cachedRefreshFailures.delete(e),new Cct(e)}async _fetchUserToken(e,n){const r=this._userAccessTokens.get(e);if(!r)throw new Error("Trying to get token for user that was not added to the provider");if(r.accessToken&&!nI(r))try{if(r.scope)return iI(r.scope,n),r;const[s=[]]=await Rct(this._clientId,r.accessToken,e,r.scope,n),o={...r,scope:s};return this._checkIntermediateUserRemoval(e),this._userAccessTokens.set(e,o),o}catch(s){if(!(s instanceof WS))throw s}this._checkIntermediateUserRemoval(e);const i=await this.refreshAccessTokenForUser(e);return iI(i.scope,n),i}async _refreshUserTokenWithCallback(e,n){try{return await RQ(this.clientId,this._clientSecret,n)}catch(r){throw this._cachedRefreshFailures.add(e),this.emit(this.onRefreshFailure,e,r),r}}async _fetchAppToken(e){if(e.length>0)for(const n of e)if(this._appImpliedScopes.length){if(n.every(r=>!this._appImpliedScopes.includes(r)))throw new Error(`One of the scopes ${n.join(", ")} requested but only the scope ${this._appImpliedScopes.join(", ")} is implied`)}else throw new Error(`One of the scopes ${n.join(", ")} requested but the client credentials flow does not support scopes`);return!this._appAccessToken||nI(this._appAccessToken)?await this._refreshAppToken():this._appAccessToken}async _refreshAppToken(){return this._appAccessToken=await xct(this._clientId,this._clientSecret)}};_o([Sb(!1)],sb.prototype,"_clientSecret",void 0);_o([Sb(!1)],sb.prototype,"_userAccessTokens",void 0);_o([Sb(!1)],sb.prototype,"_userTokenFetchers",void 0);_o([Sb(!1)],sb.prototype,"_appAccessToken",void 0);_o([Sb(!1)],sb.prototype,"_appTokenFetcher",void 0);sb=_o([A2("auth","RefreshingAuthProvider","clientId")],sb);class Mct extends C2{constructor({lineBased:e,logger:n,additionalOptions:r}={}){super(),this._currentLine="",this._connecting=!1,this._connected=!1,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._lineBased=e??!1,this._logger=n,this._additionalOptions=r}get isConnecting(){return this._connecting}get isConnected(){return this._connected}sendLine(e){this._connected&&(e=e.replace(/[\0\r\n]/g,""),this.sendRaw(`${e}\r
`))}assumeExternalDisconnect(){var e;(e=this._logger)===null||e===void 0||e.trace("AbstractConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.clearSocket(),this.emit(this.onDisconnect,!1)}receiveRaw(e){var n,r;if(!this._lineBased){this.emit(this.onReceive,e);return}const i=e.split(`\r
`);if(this._currentLine+=(n=i.shift())!==null&&n!==void 0?n:"",i.length){this.emit(this.onReceive,this._currentLine),this._currentLine=(r=i.pop())!==null&&r!==void 0?r:"";for(const s of i)this.emit(this.onReceive,s)}}}class kct{constructor(){throw new Error("DirectConnection is not implemented in a browser environment")}}class Oct extends C2{constructor(e,n,r={}){var i;super(),this._type=e,this._target=n,this._config=r,this._retryLimit=1/0,this._initialRetryLimit=3,this._connecting=!1,this._connectionRetryCount=0,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._retryLimit=(i=r.retryLimit)!==null&&i!==void 0?i:1/0,this._logger=r.logger}get isConnected(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnected)!==null&&n!==void 0?n:!1}get isConnecting(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnecting)!==null&&n!==void 0?n:this._connecting}get hasSocket(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.hasSocket)!==null&&n!==void 0?n:!1}sendLine(e){var n;(n=this._currentConnection)===null||n===void 0||n.sendLine(e)}connect(){if(this._currentConnection||this._connecting)throw new Error("Connection already present");this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(!0)}disconnect(){var e;if((e=this._logger)===null||e===void 0||e.trace(`PersistentConnection disconnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._connecting=!1,this._currentConnection){const n=this._currentConnection;this._currentConnection=void 0,n.disconnect()}}assumeExternalDisconnect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("PersistentConnection assumeExternalDisconnect"),(n=this._currentConnection)===null||n===void 0||n.assumeExternalDisconnect()}reconnect(){this._reconnect(!0)}acknowledgeSuccessfulReconnect(){this._previousConnection&&(this._previousConnection.disconnect(),this._previousConnection=void 0)}_startTryingToConnect(e=!1){this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(e)}_tryConnect(e=!1){var n,r;(n=this._logger)===null||n===void 0||n.trace(`PersistentConnection tryConnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`);const i=e?this._initialRetryLimit:this._retryLimit;(r=this._retryTimerGenerator)!==null&&r!==void 0||(this._retryTimerGenerator=rde(120));const s=this._currentConnection=new this._type(Gat(this._target),this._config);s.onReceive(o=>this.emit(this.onReceive,o)),s.onConnect(()=>{this.emit(this.onConnect),this._connecting=!1,this._retryTimerGenerator=void 0}),s.onDisconnect((o,a)=>{var c,l,u;if(this.emit(this.onDisconnect,o,a),o)this.emit(this.onEnd,!0),this._connecting=!1,this._retryTimerGenerator=void 0,s.disconnect(),this._currentConnection===s&&(this._currentConnection=void 0),this._previousConnection===s&&(this._previousConnection=void 0);else if(this._connecting){if((c=this._logger)===null||c===void 0||c.debug(`Connection error caught: ${(l=a?.message)!==null&&l!==void 0?l:"unknown error"}`),this._connectionRetryCount>=i)return;this._connectionRetryCount++;const h=this._retryTimerGenerator.next().value;h!==0&&((u=this._logger)===null||u===void 0||u.info(`Retrying in ${h} seconds`)),setTimeout(()=>{var d;this._connecting&&((d=this._logger)===null||d===void 0||d.info(e?"Retrying connection":"Trying to reconnect"),this._tryConnect())},h*1e3)}else this._reconnect()}),s.connect()}_reconnect(e=!1){e&&this._config.overlapManualReconnect?(this._previousConnection=this._currentConnection,this._currentConnection=void 0):this.disconnect(),this._startTryingToConnect(e)}}var xS=null;typeof WebSocket<"u"?xS=WebSocket:typeof MozWebSocket<"u"?xS=MozWebSocket:typeof mv<"u"?xS=mv.WebSocket||mv.MozWebSocket:typeof window<"u"?xS=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(xS=self.WebSocket||self.MozWebSocket);class Ict extends Mct{constructor(e,n){if(super(n),this._socket=null,this._closingOnDemand=!1,e.hostName&&e.port)this._url=`ws${e.secure?"s":""}://${e.hostName}:${e.port}`;else if(e.url)this._url=e.url;else throw new Error("WebSocketConnection requires either hostName & port or url to be set")}get hasSocket(){return!!this._socket}sendRaw(e){var n;(n=this._socket)===null||n===void 0||n.send(e)}connect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection connect"),this._connecting=!0,this._socket=new xS(this._url,(n=this._additionalOptions)===null||n===void 0?void 0:n.wsOptions),this._socket.onopen=()=>{var r;(r=this._logger)===null||r===void 0||r.trace("WebSocketConnection onOpen"),this._connected=!0,this._connecting=!1,this._closingOnDemand=!1,this.emit(this.onConnect)},this._socket.onmessage=({data:r})=>{this.receiveRaw(r.toString())},this._socket.onerror=r=>{var i;(i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onError message:${r.message}`)},this._socket.onclose=r=>{var i;const s=this._connected,o=this._connecting;if((i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onClose wasConnected:${s.toString()} wasConnecting:${o.toString()} closingOnDemand:${this._closingOnDemand.toString()} wasClean:${r.wasClean.toString()}`),this._connected=!1,this._connecting=!1,this._closingOnDemand)this._closingOnDemand=!1,this.emit(this.onDisconnect,!0),this.emit(this.onEnd,!0);else{const a=new Error(`[${r.code}] ${r.reason}`);this.emit(this.onDisconnect,!1,a),this.emit(this.onEnd,!1,a)}this.clearSocket()}}disconnect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection disconnect"),this._closingOnDemand=!0,(n=this._socket)===null||n===void 0||n.close()}clearSocket(){this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onerror=null,this._socket.onclose=null,this._socket=null)}}function pA(t){var e,n,r;if(Array.isArray(t)){for(n=Array(e=t.length);e--;)n[e]=(r=t[e])&&typeof r=="object"?pA(r):r;return n}if(Object.prototype.toString.call(t)==="[object Object]"){n={};for(e in t)e==="__proto__"?Object.defineProperty(n,e,{value:pA(t[e]),configurable:!0,enumerable:!0,writable:!0}):n[e]=(r=t[e])&&typeof r=="object"?pA(r):r;return n}return t}const Nct={name:"away-notify"};class GN extends Error{constructor(e,n,r){super(`command "${e}" expected ${n} or more parameters, got ${r}`),this._command=e,this._expectedParams=n,this._actualParams=r,Object.setPrototypeOf(this,GN.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,GN)}get command(){return this._command}get expectedParams(){return this._expectedParams}get actualParams(){return this._actualParams}}class $N extends Error{constructor(e,n,r,i){var s;super(`required parameter "${n}" did not validate against ${(s=r.type)!==null&&s!==void 0?s:"regex"} validation: "${i}"`),this._command=e,this._paramName=n,this._paramSpec=r,this._givenValue=i,Object.setPrototypeOf(this,$N.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,$N)}get command(){return this._command}get paramName(){return this._paramName}get paramSpec(){return this._paramSpec}get givenValue(){return this._givenValue}}const KS={channelTypes:"#&",supportedUserModes:"iwso",supportedChannelModes:{prefix:"ov",list:"b",alwaysWithParam:"ovk",paramWhenSet:"l",noParam:"imnpst"},prefixes:[{modeChar:"v",prefix:"+"},{modeChar:"o",prefix:"@"}]};var BU={exports:{}},MQ;function Pct(){return MQ||(MQ=1,(function(t){t.exports=e=>{if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},t.exports.default=t.exports})(BU)),BU.exports}var Dct=Pct();const Lct=su(Dct);function LB(t,e="#&"){return new RegExp(`^[${Lct(e)}][^ \b\0
\r,]+$`).test(t)}const kQ={0:"\0",n:`
`,r:"\r","":""};function OQ(t){if(!t.startsWith("")||(t=t.substring(1),t.endsWith("")&&(t=t.slice(0,-1)),!t))return!1;t=t.replace(/\x10(.)/,(r,i)=>i in kQ?kQ[i]:"");let[e,n=""]=O1(t," ",2);return e=e?e.toUpperCase():"",{command:e,params:n}}const Uct={"\\":"\\",";":":","\n":"n","\r":"r"," ":"s"};function Bct(t){return t.replace(/[\\;\n\r ]/g,e=>`\\${Uct[e]}`)}function Fct(t){let e=`${t.nick}`;return t.user&&(e+=`!${t.user}`),t.host&&(e+=`@${t.host}`),e}function jct(t,e,n,r,i=KS,s=!1){const o=new t(t.COMMAND,void 0,{serverProperties:i}),a={};if(o._paramSpec&&IB(o._paramSpec,(c,l)=>{if(!(s&&c.noServer)&&!(!s&&c.noClient)){if(l in e){const u=e[l];if(u!==void 0){if(t.checkParam(u,c,i))a[l]={value:u,trailing:!!c.trailing};else if(!c.optional)throw new Error(`required parameter "${l}" did not suit requirements: "${u}"`)}}if(!(l in a)&&!c.optional)throw new Error(`required parameter "${l}" not found in command "${t.COMMAND}"`)}}),o._parsedParams=a,o._paramSpec)for(const c of Object.keys(o._paramSpec))Object.defineProperty(o,c,{get(){var l,u;return(u=(l=this._parsedParams)===null||l===void 0?void 0:l[c])===null||u===void 0?void 0:u.value}});return o._initPrefixAndTags(n,r),o}class sn{static checkParam(e,n,r=KS){return!(n.type==="channel"&&!LB(e,r.channelTypes)||n.type==="channelList"&&!e.split(",").every(s=>LB(s,r.channelTypes))||n.match&&!n.match.test(e))}constructor(e,{params:n,tags:r,prefix:i,rawLine:s}={},{serverProperties:o=KS,isServer:a=!1,shouldParseParams:c=!0}={},l){this._params=[],this._serverProperties=KS,this._paramSpec=l,this._command=e,this._params=n,this._tags=r??new Map,this._prefix=i,this._serverProperties=o,this._raw=s,c&&this.parseParams(a)}getMinParamCount(e=!1){return this._paramSpec?Object.values(this._paramSpec).filter(n=>n.noServer&&e||n.noClient&&!e?!1:!n.optional).length:0}get paramCount(){var e,n;return(n=(e=this._params)===null||e===void 0?void 0:e.length)!==null&&n!==void 0?n:0}prefixToString(){return this._prefix?Fct(this._prefix):""}tagsToString(){return[...this._tags.entries()].map(([e,n])=>n?`${e}=${Bct(n)}`:e).join(";")}toString(e=!1,n=!1){const i=[n?this._buildCommandFromRawParams():this._buildCommandFromNamedParams()];if(e){const o=this.prefixToString();o&&i.unshift(`:${o}`)}const s=this.tagsToString();return s&&i.unshift(`@${s}`),i.join(" ")}_initPrefixAndTags(e,n){this._prefix=e,n&&(this._tags=n)}parseParams(e=!1){if(this._params){let n=this.getMinParamCount(e);if(n>this._params.length)throw new GN(this._command,n,this._params.length);const r=this._paramSpec;if(!r)return;let i=0;const s={};for(const[o,a]of Object.entries(r)){if(a.noServer&&e||a.noClient&&!e)continue;if(this._params.length-i<=n){if(a.optional)continue;if(this._params.length-i!==n)throw new Error("not enough parameters left for required parameters parsing (this is a library bug)")}let c=this._params[i];if(!c){if(a.optional)break;throw new Error("unexpected parameter underflow")}if(a.rest){const l=[];for(;this._params[i]&&!this._params[i].trailing;)l.push(this._params[i].value),++i;if(!l.length){if(a.optional)continue;throw new Error(`no parameters left for required rest parameter "${o}"`)}c={value:l.join(" "),trailing:!1}}if(sn.checkParam(c.value,a))s[o]={...c},a.optional||--n,a.rest||++i;else if(!a.optional)throw new $N(this._command,o,a,c.value);if(a.trailing)break}if(this._parsedParams=s,this._paramSpec)for(const o of Object.keys(this._paramSpec))Object.defineProperty(this,o,{get(){var a,c;return(c=(a=this._parsedParams)===null||a===void 0?void 0:a[o])===null||c===void 0?void 0:c.value}})}}get rawParamValues(){var e,n;return(n=(e=this._params)===null||e===void 0?void 0:e.map(r=>r.value))!==null&&n!==void 0?n:[]}get prefix(){return this._prefix}get command(){return this._command}get tags(){return this._tags}get rawLine(){return this._raw}isResponseTo(e){return!1}endsResponseTo(e){return!1}_acceptsInReplyCollection(e){return e.isResponseTo(this)}_buildCommandFromNamedParams(){const e=this._paramSpec?Object.keys(this._paramSpec):[];return[this._command,...e.map(n=>{var r;const i=(r=this._parsedParams)===null||r===void 0?void 0:r[n];if(i)return(i.trailing?":":"")+i.value}).filter(n=>n!==void 0)].join(" ")}_buildCommandFromRawParams(){var e,n;return[this._command,...(n=(e=this._params)===null||e===void 0?void 0:e.map(r=>`${r.trailing?":":""}${r.value}`))!==null&&n!==void 0?n:[]].join(" ")}}sn.COMMAND="";sn.SUPPORTS_CAPTURE=!1;class mde extends sn{constructor(e,n,r){super(e,n,r,{reference:{},type:{optional:!0},additionalParams:{optional:!0}})}}mde.COMMAND="BATCH";const zct={name:"batch",messageTypes:[mde],usesTags:!0},Hct={name:"cap-notify"};class gde extends sn{constructor(e,n,r){super(e,n,r,{newUser:{},newHost:{}})}}gde.COMMAND="CHGHOST";const qct={name:"chghost",messageTypes:[gde]},Vct={name:"invite-notify"};class _de extends sn{}_de.COMMAND="ACK";const Gct={name:"labeled-response",messageTypes:[_de],usesTags:!0},$ct={name:"message-tags",usesTags:!0},Wct={name:"multi-prefix"},Kct=Object.freeze(Object.defineProperty({__proto__:null,AwayNotify:Nct,Batch:zct,CapNotify:Hct,ChgHost:qct,InviteNotify:Vct,LabeledResponse:Gct,MessageTags:$ct,MultiPrefix:Wct},Symbol.toStringTag,{value:"Module"}));class Xct{constructor(e,n,...r){this._client=e,this._originalMessage=n,this._messages=[],this._endEventHandlers=new Map,this._types=new Set(r)}untilEvent(e){this._cleanEndEventHandler(e);const n=this._client.on(e,()=>this.end());this._endEventHandlers.set(e,n)}async promise(){return this._promise||(this._promise=new Promise(e=>{this._promiseResolve=e})),await this._promise}collect(e){return this._originalMessage._acceptsInReplyCollection(e)?(this._messages.push(e),e.endsResponseTo(this._originalMessage)&&this.end(),!0):!1}end(){this._client.stopCollect(this),this._cleanEndEventHandlers(),this._promiseResolve&&this._promiseResolve(this._messages)}_cleanEndEventHandlers(){this._endEventHandlers.forEach(e=>{this._client.removeListener(e)}),this._endEventHandlers.clear()}_cleanEndEventHandler(e){this._endEventHandlers.has(e)&&(this._client.removeListener(this._endEventHandlers.get(e)),this._endEventHandlers.delete(e))}}class aj extends sn{constructor(e,n,r){super(e,n,r,{password:{}})}}aj.COMMAND="PASS";class mA extends sn{constructor(e,n,r){super(e,n,r,{nick:{}})}}mA.COMMAND="NICK";class cj extends sn{constructor(e,n,r){super(e,n,r,{user:{},mode:{},unused:{},realName:{trailing:!0}})}}cj.COMMAND="USER";class vde extends sn{constructor(e,n,r){super(e,n,r,{name:{},password:{}})}}vde.COMMAND="OPER";class lj extends sn{constructor(e,n,r){super(e,n,r,{text:{trailing:!0,optional:!0}})}}lj.COMMAND="QUIT";class yde extends sn{constructor(e,n,r){super(e,n,r,{server:{},reason:{trailing:!0}})}}yde.COMMAND="SQUIT";class gM extends sn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},key:{optional:!0}})}}gM.COMMAND="JOIN";class _M extends sn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},reason:{trailing:!0,optional:!0}})}}_M.COMMAND="PART";class WN extends Error{constructor(e){super(`Unknown channel mode character ${e}`),this._char=e,Object.setPrototypeOf(this,WN.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,WN)}get char(){return this._char}}class bde extends sn{constructor(e,n,r){super(e,n,r,{target:{},modes:{rest:!0,optional:!0}})}get isChannel(){return LB(this.target,this._serverProperties.channelTypes)}separate(){const e=[],n=this.modes;if(!n)throw new Error("can't separate a channel mode request, just set actions");const r=n.split(" "),i=r.shift();let s="add";for(const o of i){let a=s;switch(o){case"+":{s="add";break}case"-":{s="remove";break}default:{let c=!1,l=!0;if(this.isChannel){if(this._serverProperties.supportedChannelModes.alwaysWithParam.includes(o)||this._serverProperties.supportedChannelModes.prefix.includes(o))c=!0;else if(this._serverProperties.supportedChannelModes.paramWhenSet.includes(o))s==="add"&&(c=!0);else if(this._serverProperties.supportedChannelModes.list.includes(o))r.length?c=!0:a="getList";else if(!this._serverProperties.supportedChannelModes.noParam.includes(o))throw new WN(o)}else l=this._serverProperties.supportedUserModes.includes(o);if(c&&!r.length)continue;e.push({prefix:this._prefix,action:a,letter:o,param:c?r.shift():void 0,known:l})}}}return e}}bde.COMMAND="MODE";class Ede extends sn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},newTopic:{optional:!0,trailing:!0}})}}Ede.COMMAND="TOPIC";class M2 extends sn{constructor(e,n,r){super(e,n,r,{channel:{type:"channelList",optional:!0}})}}M2.COMMAND="NAMES";M2.SUPPORTS_CAPTURE=!0;class Sde extends sn{constructor(e,n,r){super(e,n,r,{channel:{optional:!0},server:{optional:!0}})}}Sde.COMMAND="LIST";class xde extends sn{constructor(e,n,r){super(e,n,r,{target:{},channel:{type:"channel"}})}}xde.COMMAND="INVITE";class Tde extends sn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},target:{},reason:{trailing:!0,optional:!0}})}}Tde.COMMAND="KICK";class wde extends sn{constructor(e,n,r){super(e,n,r,{server:{optional:!0}})}}wde.COMMAND="TIME";class vM extends sn{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}}vM.COMMAND="PRIVMSG";class VP extends sn{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}}VP.COMMAND="NOTICE";class GP extends sn{constructor(e,n,r){super(e,n,r,{mask:{},flags:{optional:!0},extendedMask:{optional:!0,trailing:!0}})}}GP.COMMAND="WHO";class Rde extends sn{constructor(e,n,r){super(e,n,r,{server:{optional:!0},nickMask:{}})}}Rde.COMMAND="WHOIS";class Cde extends sn{constructor(e,n,r){super(e,n,r,{nick:{},count:{optional:!0},server:{optional:!0}})}}Cde.COMMAND="WHOWAS";class Ade extends sn{constructor(e,n,r){super(e,n,r,{target:{},reason:{trailing:!0,optional:!0}})}}Ade.COMMAND="KILL";class KN extends sn{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}KN.COMMAND="PING";class XN extends sn{constructor(e,n,r){super(e,n,r,{server:{noClient:!0},text:{trailing:!0}})}}XN.COMMAND="PONG";class Mde extends sn{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}Mde.COMMAND="ERROR";class kde extends sn{constructor(e,n,r){super(e,n,r,{text:{trailing:!0,optional:!0}})}}kde.COMMAND="AWAY";class Ode extends sn{}Ode.COMMAND="REHASH";class Ide extends sn{}Ide.COMMAND="RESTART";class Nde extends sn{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}Nde.COMMAND="WALLOPS";class Pde extends sn{constructor(e,n,r){super(e,n,r,{nicks:{rest:!0}})}}Pde.COMMAND="USERHOST";class Dde extends sn{constructor(e,n,r){super(e,n,r,{nicks:{rest:!0}})}}Dde.COMMAND="ISON";class Gp extends sn{constructor(e,n,r){super(e,n,r,{target:{match:/^(?:[a-z_\-\[\]\\^{}|`][a-z0-9_\-\[\]\\^{}|`]+|\*)$/i,optional:!0,noClient:!0},subCommand:{match:/^(?:LS|LIST|REQ|ACK|NAK|END|NEW|DEL)$/i},version:{match:/^\d+$/,optional:!0},continued:{match:/^\*$/,optional:!0},capabilities:{trailing:!0,optional:!0}})}isResponseTo(e){if(!(e instanceof Gp))return!1;switch(this.subCommand){case"ACK":case"NAK":return e.subCommand==="REQ"&&e.capabilities===this.capabilities.trim();case"LS":case"LIST":return e.subCommand===this.subCommand;default:return!1}}endsResponseTo(e){if(!(e instanceof Gp))return!1;switch(this.subCommand){case"LS":case"LIST":return!this.continued;default:return!0}}}Gp.COMMAND="CAP";Gp.SUPPORTS_CAPTURE=!0;class Lde extends sn{constructor(e,n,r){super(e,n,r,{target:{}})}}Lde.COMMAND="TAGMSG";const Ude=Object.freeze(Object.defineProperty({__proto__:null,Away:kde,CapabilityNegotiation:Gp,ChannelInvite:xde,ChannelJoin:gM,ChannelKick:Tde,ChannelList:Sde,ChannelPart:_M,ClientQuit:lj,ErrorMessage:Mde,IsOnQuery:Dde,Kill:Ade,Mode:bde,Names:M2,NickChange:mA,Notice:VP,OperLogin:vde,Password:aj,Ping:KN,Pong:XN,PrivateMessage:vM,Rehash:Ode,Restart:Ide,ServerQuit:yde,TagMessage:Lde,Time:wde,Topic:Ede,UserHostQuery:Pde,UserRegistration:cj,Wallops:Nde,WhoIsQuery:Rde,WhoQuery:GP,WhoWasQuery:Cde},Symbol.toStringTag,{value:"Module"}));class uj extends sn{constructor(e,n,r){super(e,n,r,{me:{},welcomeText:{trailing:!0}})}}uj.COMMAND="001";class Bde extends sn{constructor(e,n,r){super(e,n,r,{me:{},yourHost:{trailing:!0}})}}Bde.COMMAND="002";class Fde extends sn{constructor(e,n,r){super(e,n,r,{me:{},createdText:{trailing:!0}})}}Fde.COMMAND="003";class fj extends sn{constructor(e,n,r){super(e,n,r,{me:{},serverName:{},version:{},userModes:{},channelModes:{},channelModesWithParam:{optional:!0}})}}fj.COMMAND="004";class hj extends sn{constructor(e,n,r){super(e,n,r,{me:{},supports:{rest:!0},suffix:{trailing:!0}})}}hj.COMMAND="005";class jde extends sn{constructor(e,n,r){super(e,n,r,{me:{},modes:{}})}}jde.COMMAND="221";class zde extends sn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},text:{trailing:!0}})}}zde.COMMAND="301";class Hde extends sn{constructor(e,n,r){super(e,n,r,{me:{},hosts:{trailing:!0}})}}Hde.COMMAND="302";class qde extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}qde.COMMAND="305";class Vde extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Vde.COMMAND="306";class Gde extends sn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},username:{},host:{},_unused:{},realname:{trailing:!0}})}}Gde.COMMAND="311";class $de extends sn{constructor(e,n,r){super(e,n,r,{me:{},query:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof GP}endsResponseTo(){return!0}}$de.COMMAND="315";class Wde extends sn{constructor(e,n,r){super(e,n,r,{me:{},nickMask:{},suffix:{trailing:!0}})}}Wde.COMMAND="318";class Kde extends sn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channels:{trailing:!0}})}}Kde.COMMAND="319";class Xde extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},memberCount:{},topic:{trailing:!0}})}}Xde.COMMAND="322";class Yde extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Yde.COMMAND="323";class Zde extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},modes:{rest:!0}})}}Zde.COMMAND="324";class Jde extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Jde.COMMAND="331";class Qde extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},topic:{trailing:!0}})}}Qde.COMMAND="332";class epe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},who:{},ts:{}})}}epe.COMMAND="333";class tpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"}})}}tpe.COMMAND="341";class npe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}npe.COMMAND="348";class rpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}rpe.COMMAND="349";class ipe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{},user:{},host:{},server:{},nick:{},flags:{},hopsAndRealName:{trailing:!0}})}get isAway(){return this.flags.includes("G")}get isOper(){return this.flags.includes("*")}get isBot(){return this.flags.includes("B")}isResponseTo(e){return e instanceof GP}}ipe.COMMAND="352";class spe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channelType:{},channel:{type:"channel"},names:{trailing:!0}})}isResponseTo(e){return e instanceof M2}}spe.COMMAND="353";class ope extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof M2}endsResponseTo(){return!0}}ope.COMMAND="366";class ape extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}ape.COMMAND="367";class cpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}cpe.COMMAND="368";class lpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},line:{trailing:!0}})}}lpe.COMMAND="372";class upe extends sn{constructor(e,n,r){super(e,n,r,{me:{},line:{trailing:!0}})}}upe.COMMAND="375";class dj extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}dj.COMMAND="376";class fpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}fpe.COMMAND="381";class hpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},server:{optional:!0},timestamp:{trailing:!0}})}}hpe.COMMAND="391";class dpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}}dpe.COMMAND="401";class ppe extends sn{constructor(e,n,r){super(e,n,r,{me:{},server:{},suffix:{trailing:!0}})}}ppe.COMMAND="402";class mpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}mpe.COMMAND="403";class gpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}gpe.COMMAND="404";class _pe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}_pe.COMMAND="405";class vpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},subCommand:{},suffix:{trailing:!0}})}}vpe.COMMAND="410";class ype extends sn{constructor(e,n,r){super(e,n,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command===this.originalCommand}endsResponseTo(){return!0}}ype.COMMAND="421";class pj extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}pj.COMMAND="422";class bpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}bpe.COMMAND="431";class Epe extends sn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Epe.COMMAND="432";class Spe extends sn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Spe.COMMAND="433";class xpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}xpe.COMMAND="436";class Tpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Tpe.COMMAND="441";class wpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}wpe.COMMAND="442";class Rpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Rpe.COMMAND="443";class Cpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Cpe.COMMAND="451";class Ape extends sn{constructor(e,n,r){super(e,n,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}}Ape.COMMAND="461";class mj extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}mj.COMMAND="462";class Mpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Mpe.COMMAND="471";class kpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},char:{},suffix:{trailing:!0}})}}kpe.COMMAND="472";class Ope extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Ope.COMMAND="473";class Ipe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Ipe.COMMAND="474";class Npe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Npe.COMMAND="475";class Ppe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}Ppe.COMMAND="479";class Dpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Dpe.COMMAND="481";class Lpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}Lpe.COMMAND="482";class Upe extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Upe.COMMAND="491";class Bpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},modeChar:{optional:!0,match:/^\w$/},suffix:{trailing:!0}})}}Bpe.COMMAND="501";class Fpe extends sn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Fpe.COMMAND="502";const jpe=Object.freeze(Object.defineProperty({__proto__:null,Error401NoSuchNick:dpe,Error402NoSuchServer:ppe,Error403NoSuchChannel:mpe,Error404CanNotSendToChan:gpe,Error405TooManyChannels:_pe,Error410InvalidCapCmd:vpe,Error421UnknownCommand:ype,Error422NoMotd:pj,Error431NoNickNameGiven:bpe,Error432ErroneusNickname:Epe,Error433NickNameInUse:Spe,Error436NickCollision:xpe,Error441UserNotInChannel:Tpe,Error442NotOnChannel:wpe,Error443UserOnChannel:Rpe,Error451NotRegistered:Cpe,Error461NeedMoreParams:Ape,Error462AlreadyRegistered:mj,Error471ChannelIsFull:Mpe,Error472UnknownMode:kpe,Error473InviteOnlyChan:Ope,Error474BannedFromChan:Ipe,Error475BadChannelKey:Npe,Error479BadChanName:Ppe,Error481NoPrivileges:Dpe,Error482ChanOpPrivsNeeded:Lpe,Error491NoOperHost:Upe,Error501UmodeUnknownFlag:Bpe,Error502UsersDontMatch:Fpe,Reply001Welcome:uj,Reply002YourHost:Bde,Reply003Created:Fde,Reply004ServerInfo:fj,Reply005Isupport:hj,Reply221UmodeIs:jde,Reply301Away:zde,Reply302UserHost:Hde,Reply305UnAway:qde,Reply306NowAway:Vde,Reply311WhoisUser:Gde,Reply315EndOfWho:$de,Reply318EndOfWhois:Wde,Reply319WhoisChannels:Kde,Reply322List:Xde,Reply323ListEnd:Yde,Reply324ChannelModeIs:Zde,Reply331NoTopic:Jde,Reply332Topic:Qde,Reply333TopicWhoTime:epe,Reply341Inviting:tpe,Reply348ExceptList:npe,Reply349EndOfExceptList:rpe,Reply352WhoReply:ipe,Reply353NamesReply:spe,Reply366EndOfNames:ope,Reply367BanList:ape,Reply368EndOfBanList:cpe,Reply372Motd:lpe,Reply375MotdStart:upe,Reply376EndOfMotd:dj,Reply381YoureOper:fpe,Reply391Time:hpe},Symbol.toStringTag,{value:"Module"})),Yct=new Map([...Object.values(Ude),...Object.values(jpe)].map(t=>[t.COMMAND,t]));function Zct(t){const[e,n]=O1(t,"!",2);if(n){const[r,i]=O1(n,"@",2);return i?{nick:e,user:r,host:i}:{nick:e,host:r}}return{nick:e}}const IQ={":":";",n:`
`,r:"\r",s:" "};function Jct(t){const e=new Map,n=t.split(";");for(const r of n){const[i,s]=O1(r,"=",2);i!==""&&e.set(i,s?s.replace(/\\(.?)/g,(o,a)=>Object.prototype.hasOwnProperty.call(IQ,a)?IQ[a]:a):"")}return e}function Qct(t,e=KS,n=Yct,r=!1,i=[],s=!0){const o=t.split(" ");let a,c;const l=[];let u,h;for(;o.length;){if([a]=o,a.startsWith("@")&&!u&&!c&&!h)u=Jct(a.slice(1));else if(a.startsWith(":"))if(!h&&!c)a.length>1&&(h=Zct(a.slice(1)));else{l.push({value:o.join(" ").slice(1),trailing:!0});break}else c?l.push({value:a,trailing:!1}):c=a.toUpperCase();o.shift()}if(u||(u=new Map),!c)throw new Error(`line without command received: ${t}`);s&&(s=!i.includes(c));let d=sn;return n.has(c)&&(d=n.get(c)),new d(c,{params:l,tags:u,prefix:h,rawLine:t},{serverProperties:e,isServer:r,shouldParseParams:s})}class zpe extends C2{constructor(e){super(),this._registered=!1,this._supportsCapabilities=!0,this._events=new Map,this._registeredMessageTypes=new Map,this.onConnect=this.registerEvent(),this.onRegister=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPrivmsg=this.registerEvent(),this.onAction=this.registerEvent(),this.onNotice=this.registerEvent(),this.onNickChange=this.registerEvent(),this.onCtcp=this.registerEvent(),this.onCtcpReply=this.registerEvent(),this.onPasswordError=this.registerEvent(),this.onAnyMessage=this.registerEvent(),this._serverProperties=pA(KS),this._supportedFeatures={},this._collectors=[],this._clientCapabilities=new Map,this._serverCapabilities=new Map,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._hasRegisteredBefore=!1,this._channelsFromLastRegister=new Set,this._initialConnectionSetupDone=!1;const{connection:n,credentials:r,channels:i,channelTypes:s,webSocket:o,logger:a={}}=e;this._options=e;const{pingOnInactivity:c=60,pingTimeout:l=10}=n;this._pingOnInactivity=c,this._pingTimeout=l,this._currentNick=r.nick,this._logger=HP({name:"ircv3",emoji:!0,...a}),this.registerCoreMessageTypes();const{hostName:u,secure:h,reconnect:d=!0}=n,m={hostName:u,port:this.port,secure:h},p={lineBased:!0,logger:this._logger,additionalOptions:e.connectionOptions},g=o?Ict:kct;d?this._connection=new Oct(g,m,p):this._connection=new g(p,this._logger,e.connectionOptions);for(const y of Object.values(Kct))this.addCapability(y);this.addInternalListener(this.onRegister,async()=>{const y=this._hasRegisteredBefore,v=this._channelsFromLastRegister;this._hasRegisteredBefore=!0,this._channelsFromLastRegister=new Set;const x=y&&this._options.rejoinChannelsOnReconnect?v:await OB(i);if(x)for(const E of x)this.join(E)}),this.onTypedMessage(Gp,async({subCommand:y,capabilities:v})=>{const x=v.split(" ");switch(y.toUpperCase()){case"NEW":{this._logger.debug(`Server registered new capabilities: ${x.join(", ")}`);const E=aO(x,A=>{if(!A)return{};const[k,M]=O1(A,"=",2);return{[k]:{name:k,param:M||!0}}});for(const[A,k]of Object.entries(E))this._serverCapabilities.set(A,k);const C=Object.keys(E);await this._negotiateCapabilities(Array.from(this._clientCapabilities.entries()).filter(([A])=>C.includes(A)).map(([,A])=>A));break}case"DEL":{this._logger.debug(`Server removed capabilities: ${x.join(", ")}`);for(const E of x)this._serverCapabilities.delete(E),this._negotiatedCapabilities.delete(E)}}}),this.onTypedMessage(KN,({text:y})=>{this.sendMessage(XN,{text:y})}),this.onTypedMessage(uj,({me:y})=>this._handleReceivedClientNick(y)),this.onTypedMessage(fj,({userModes:y})=>{y&&(this._serverProperties.supportedUserModes=y)}),this.onTypedMessage(hj,({supports:y})=>{const v=aO(y.split(" "),x=>{const[E,C]=O1(x,"=",2);return{[E]:C||!0}});this._supportedFeatures={...this._supportedFeatures,...v}}),this.onTypedMessage(dj,({me:y})=>{this._registered||(this._handleReceivedClientNick(y),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(pj,({me:y})=>{this._registered||(this._handleReceivedClientNick(y),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(mj,({me:y})=>{this._registered||(this._logger.warn("We thought we're not registered yet, but we actually are"),this._handleReceivedClientNick(y),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(vM,y=>{var v;const{target:x,text:E}=y,C=OQ(E),A=(v=y.prefix)===null||v===void 0?void 0:v.nick;C?C.command==="ACTION"?this.emit(this.onAction,x,A,C.params,y):this.emit(this.onCtcp,x,A,C.command,C.params,y):this.emit(this.onPrivmsg,x,A,E,y)}),this.onTypedMessage(mA,y=>{var v;const{nick:x}=y,E=(v=y.prefix)===null||v===void 0?void 0:v.nick;E===this._currentNick&&(this._currentNick=x),this.emit(this.onNickChange,E,x,y)}),this.onTypedMessage(VP,y=>{var v;const{target:x,text:E}=y,C=OQ(E),A=(v=y.prefix)===null||v===void 0?void 0:v.nick;C&&this.emit(this.onCtcpReply,x,A,C.command,C.params,y),this.emit(this.onNotice,x,A,E,y)}),this._options.manuallyAcknowledgeJoins||this.onTypedMessage(gM,({channel:y,prefix:v})=>{v?.nick===this._currentNick&&this.acknowledgeJoin(y)}),this.onTypedMessage(_M,y=>{var v;((v=y.prefix)===null||v===void 0?void 0:v.nick)===this._currentNick&&(this._currentChannels.delete(y.channel),this._channelsFromLastRegister.delete(y.channel))}),this.addInternalListener(this.onRegister,()=>this._startPingCheckTimer()),this._desiredNick=r.nick,this._userName=r.userName,this._realName=r.realName,s&&(this._serverProperties.channelTypes=s)}receiveLine(e){var n;this._logger.debug(`Received message: ${e}`);let r;try{r=Qct(e,this._serverProperties,this._registeredMessageTypes,!0,this._options.nonConformingCommands)}catch(i){this._logger.error(`Error parsing message: ${i.message}`),this._logger.trace((n=i.stack)!==null&&n!==void 0?n:"No stack available");return}this._logger.trace(`Parsed message: ${JSON.stringify(r)}`),this._startPingCheckTimer(),this.emit(this.onAnyMessage,r),this._handleEvents(r)}get serverProperties(){return pA(this._serverProperties)}get port(){const{webSocket:e,connection:{port:n,secure:r}}=this._options;return n||(e?r?443:80:r?6697:6667)}pingCheck(){const e=Date.now(),n=e.toString(),r=this.onTypedMessage(XN,i=>{const{text:s}=i;s===n&&(this._logger.debug(`Current ping: ${Date.now()-e}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeMessageListener(r))});this._pingTimeoutTimer=setTimeout(()=>{this.removeMessageListener(r),this._options.connection.reconnect===!1?this._logger.error(`Disconnecting because the last ping took over ${this._pingTimeout} seconds`):this._logger.warn(`Reconnecting because the last ping took over ${this._pingTimeout} seconds`),this._connection.assumeExternalDisconnect()},this._pingTimeout*1e3),this.sendMessage(KN,{text:n})}reconnect(e){this.quit(e),this.connect()}registerMessageType(e){e.COMMAND!==""&&(this._logger.trace(`Registering message type ${e.COMMAND}`),this._registeredMessageTypes.set(e.COMMAND.toUpperCase(),e))}knowsCommand(e){return this._registeredMessageTypes.has(e.toUpperCase())}getCommandClass(e){return this._registeredMessageTypes.get(e.toUpperCase())}acknowledgeJoin(e){this._currentChannels.add(e),this._channelsFromLastRegister.add(e)}connect(){this._supportsCapabilities=!1,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._currentNick=this._desiredNick,this._setupConnection(),this._logger.info(`Connecting to ${this._options.connection.hostName}:${this.port}`),this._connection.connect()}addCapability(e){if(this._clientCapabilities.set(e.name,e),e.messageTypes)for(const n of Object.values(e.messageTypes))this.registerMessageType(n)}async registerCapability(e){return this.addCapability(e),this._serverCapabilities.has(e.name)?await this._negotiateCapabilities([e]):[]}send(e){this.sendRaw(e.toString())}sendRaw(e){this._connection.isConnected&&(this._logger.debug(`Sending message: ${e}`),this._connection.sendLine(e))}onNamedMessage(e,n,r){this._events.has(e)||this._events.set(e,new Map);const i=this._events.get(e);if(!r)do r=`${e}:${Wat(Math.random()*1e4,4,"0")}`;while(i.has(r));return i.set(r,n),r}onTypedMessage(e,n,r){return this.onNamedMessage(e.COMMAND,n,r)}removeMessageListener(e){const[n]=e.split(":");this._events.has(n)&&this._events.get(n).delete(e)}createMessage(e,n,r){const i=r?new Map(Object.entries(r)):void 0;return jct(e,n,void 0,i,this.serverProperties)}sendMessage(e,n,r){this.send(this.createMessage(e,n,r))}async sendMessageAndCaptureReply(e,n){if(!e.SUPPORTS_CAPTURE)throw new Error(`The command "${e.COMMAND}" does not support reply capture`);const r=this.createMessage(e,n),i=this.collect(r).promise();return this.send(r),await i}get isConnected(){return this._connection.isConnected}get isConnecting(){return this._connection.isConnecting}get isRegistered(){return this._registered}get currentNick(){return this._currentNick}get currentChannels(){return Array.from(this._currentChannels)}collect(e,...n){const r=new Xct(this,e,...n);return this._collectors.push(r),r}stopCollect(e){this._collectors.splice(this._collectors.findIndex(n=>n===e),1)}join(e,n){this.sendMessage(gM,{channel:e,key:n})}part(e){this.sendMessage(_M,{channel:e})}quit(e){this.sendMessage(lj,{text:e}),this.quitAbruptly()}quitAbruptly(){this._registered=!1,this._connection.disconnect()}say(e,n,r={}){this.sendMessage(vM,{target:e,text:n},r)}sendCtcp(e,n,r){this.say(e,`${n.toUpperCase()} ${r}`)}action(e,n){this.sendCtcp(e,"ACTION",n)}changeNick(e){this._currentNick!==e&&(this._desiredNick=e,this.isRegistered&&this.sendMessage(mA,{nick:e}))}registerCoreMessageTypes(){IB(Ude,e=>{this.registerMessageType(e)}),IB(jpe,e=>{this.registerMessageType(e)})}async _negotiateCapabilityBatch(e){return await Promise.all(e.filter(n=>n.length).map(async n=>await this._negotiateCapabilities(n)))}async _negotiateCapabilities(e){const n=aO(e,o=>({[o.name]:o})),i=(await this.sendMessageAndCaptureReply(Gp,{subCommand:"REQ",capabilities:e.map(o=>o.name).join(" ")})).shift();if(!i)throw new Error("capability negotiation failed unexpectedly without any reply");if(!(i instanceof Gp))throw new Error(`capability negotiation failed unexpectedly with "${i.command}" command`);const s=i.capabilities.split(" ").filter(o=>o);if(i.subCommand==="ACK"){this._logger.debug(`Successfully negotiated capabilities: ${s.join(", ")}`);const o=s.map(a=>n[a]);for(const a of o){const c=this._clientCapabilities.get(a.name);c.param=a.param,this._negotiatedCapabilities.set(c.name,c)}return o}return this._logger.warn(`Failed to negotiate capabilities: ${s.join(", ")}`),new Error("capabilities failed to negotiate")}_setupConnection(){this._initialConnectionSetupDone||(this._connection.onConnect(async()=>{var e,n;this._logger.info(`Connection to server ${this._options.connection.hostName}:${this.port} established`),this.emit(this.onConnect),this._logger.debug("Determining connection password");try{const[r]=await Promise.all([OB(this._options.credentials.password),this.sendMessageAndCaptureReply(Gp,{subCommand:"LS",version:"302"}).then(async i=>{if(!i.length||!(i[0]instanceof Gp))return this._logger.debug("Server does not support capabilities"),[];this._supportsCapabilities=!0;const s=i.map(a=>aO(a.capabilities.split(" "),c=>{if(!c)return{};const[l,u]=O1(c,"=",2);return{[l]:{name:l,param:u||!0}}}));this._serverCapabilities=new Map(Object.entries(Object.assign({},...s))),this._logger.debug(`Capabilities supported by server: ${Array.from(this._serverCapabilities.keys()).join(", ")}`);const o=s.map(a=>{const c=Object.keys(a);return Array.from(this._clientCapabilities.entries()).filter(([l])=>c.includes(l)).map(([,l])=>l)});return await this._negotiateCapabilityBatch(o)}).then(()=>{this.sendMessage(Gp,{subCommand:"END"})})]);r&&this.sendMessage(aj,{password:r}),this.sendMessage(mA,{nick:this._desiredNick}),this.sendMessage(cj,{user:(e=this._userName)!==null&&e!==void 0?e:this._desiredNick,mode:"8",unused:"*",realName:(n=this._realName)!==null&&n!==void 0?n:this._desiredNick})}catch(r){this.emit(this.onPasswordError,r),this.quit()}}),this._initialConnectionSetupDone=!0,this._connection.onReceive(e=>{this.receiveLine(e)}),this._connection.onDisconnect((e,n)=>{var r;if(this._registered=!1,this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),e)this._logger.info("Disconnected");else{const i=(r=this._options.connection.reconnect)!==null&&r!==void 0?r:!0,s=n?`Disconnected unexpectedly: ${n.message}`:"Disconnected unexpectedly";i?this._logger.warn(`${s}; trying to reconnect`):this._logger.error(s)}this.emit(this.onDisconnect,e,n)}),this._connection.onEnd(e=>{e||this._logger.warn("No further retries will be made")}))}_handleReceivedClientNick(e){this._currentNick!==e&&(this._currentNick!==""&&this._logger.warn(`Mismatching nicks: passed ${this._currentNick}, but you're actually ${e}`),this._currentNick=e)}_handleEvents(e){this._collectors.some(r=>r.collect(e));const n=this._events.get(e.constructor.COMMAND);if(n)for(const r of n.values())r(e)}_startPingCheckTimer(){this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._connection.isConnected?this._pingCheckTimer=setTimeout(()=>this.pingCheck(),this._pingOnInactivity*1e3):this._pingCheckTimer=void 0}}_o([Sb(!1)],zpe.prototype,"_options",void 0);class gj extends sn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},user:{trailing:!0,optional:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get channelId(){return this._tags.get("room-id")}get targetUserId(){var e;return(e=this._tags.get("target-user-id"))!==null&&e!==void 0?e:null}}gj.COMMAND="CLEARCHAT";class Hpe extends sn{}Hpe.COMMAND="RECONNECT";class _j extends sn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"}})}}_j.COMMAND="ROOMSTATE";function elt(t){switch(typeof t){case"undefined":return"";case"object":{if(t===null)return"";if("cacheKey"in t)return t.cacheKey;const e=JSON.stringify(t);if(e!=="{}")return e}default:return t.toString()}}function qpe(t,e,n){return[t,...e.map(elt)].join("/")+(n?"/":"")}const J_=Symbol("cache");function tlt(t){var e,n;return n=class extends t{constructor(){super(...arguments),this[e]=new Map}getFromCache(r){if(this._cleanCache(),this[J_].has(r)){const i=this[J_].get(r);if(i)return i.value}}setCache(r,i,s){this[J_].set(r,{value:i,expires:Date.now()+s*1e3})}removeFromCache(r,i){const s=this._getInternalCacheKey(r,i);i?this[J_].forEach((o,a)=>{a.startsWith(s)&&this[J_].delete(a)}):this[J_].delete(s)}_cleanCache(){const r=Date.now();this[J_].forEach((i,s)=>{i.expires<r&&this[J_].delete(s)})}_getInternalCacheKey(r,i){if(typeof r=="string"){let s=r;return s.endsWith("/")||(s+="/"),s}else{const s=r.shift();return qpe(s,r,i)}}},e=J_,n}function Vpe(t=1/0){return function(e,n,r){if(r.get){const i=r.get;r.get=function(){const s=qpe(n,[]),o=this.getFromCache(s);if(o)return o;const a=i.call(this);return this.setCache(s,a,t),a}}return r}}var sI;let ob=sI=class{constructor(e,n){this._userName=e.toLowerCase(),this._userData=n?new Map(n):new Map}static _parseBadgesLike(e){return e?new Map(e.split(",").map(n=>{const r=n.indexOf("/");return r===-1?[n,""]:[n.slice(0,r),n.slice(r+1)]})):new Map}get userName(){return this._userName}get displayName(){var e;return(e=this._userData.get("display-name"))!==null&&e!==void 0?e:this._userName}get color(){return this._userData.get("color")}get badges(){const e=this._userData.get("badges");return sI._parseBadgesLike(e)}get badgeInfo(){const e=this._userData.get("badge-info");return sI._parseBadgesLike(e)}get userId(){return this._userData.get("user-id")}get userType(){return this._userData.get("user-type")}get isBroadcaster(){return this.badges.has("broadcaster")}get isSubscriber(){return this.badges.has("subscriber")||this.isFounder}get isFounder(){return this.badges.has("founder")}get isMod(){return this.badges.has("moderator")}get isVip(){const e=this._userData.get("vip");return e!=null&&e!=="0"}get isArtist(){return this.badges.has("artist-badge")}};_o([Sb(!1)],ob.prototype,"_userData",void 0);_o([Vpe()],ob.prototype,"badges",null);_o([Vpe()],ob.prototype,"badgeInfo",null);ob=sI=_o([tlt,A2("chat","ChatUser","userId")],ob);function vj(t){return t?new Map(t.split("/").map(e=>{const[n,r]=e.split(":",2);return r?[n,r.split(",")]:null}).filter(e=>e!==null)):new Map}class yj extends sn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},text:{trailing:!0,optional:!0}})}get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new ob(this._tags.get("login"),this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get emoteOffsets(){return vj(this._tags.get("emotes"))}}yj.COMMAND="USERNOTICE";class Gpe extends sn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"}})}}Gpe.COMMAND="USERSTATE";class bj extends sn{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}get userInfo(){return new ob(this._prefix.nick,this._tags)}get emoteOffsets(){return vj(this._tags.get("emotes"))}}bj.COMMAND="WHISPER";const nlt={name:"twitch.tv/commands",messageTypes:[gj,Hpe,_j,yj,Gpe,bj]},rlt={name:"twitch.tv/membership"};class Ej extends sn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},text:{trailing:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userName(){return this._tags.get("login")}get channelId(){return this._tags.get("room-id")}get targetMessageId(){return this._tags.get("target-msg-id")}}Ej.COMMAND="CLEARMSG";class $pe extends sn{}$pe.COMMAND="GLOBALUSERSTATE";const ilt={name:"twitch.tv/tags",messageTypes:[$pe,Ej]},slt=["ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN"];let YN=class extends vM{get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new ob(this._prefix.nick,this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get isCheer(){return this._tags.has("bits")}get isRedemption(){return!!this._tags.get("custom-reward-id")}get rewardId(){return this._tags.get("custom-reward-id")||null}get isFirst(){return this._tags.get("first-msg")==="1"}get isReturningChatter(){return this._tags.get("returning-chatter")==="1"}get isHighlight(){return this._tags.get("msg-id")==="highlighted-message"}get isReply(){return this._tags.has("reply-parent-msg-id")}get parentMessageId(){var e;return(e=this._tags.get("reply-parent-msg-id"))!==null&&e!==void 0?e:null}get parentMessageText(){var e;return(e=this._tags.get("reply-parent-msg-body"))!==null&&e!==void 0?e:null}get parentMessageUserId(){var e;return(e=this._tags.get("reply-parent-user-id"))!==null&&e!==void 0?e:null}get parentMessageUserName(){var e;return(e=this._tags.get("reply-parent-user-login"))!==null&&e!==void 0?e:null}get parentMessageUserDisplayName(){var e;return(e=this._tags.get("reply-parent-display-name"))!==null&&e!==void 0?e:null}get threadMessageId(){var e;return(e=this._tags.get("reply-thread-parent-msg-id"))!==null&&e!==void 0?e:null}get threadMessageUserId(){var e;return(e=this._tags.get("reply-thread-parent-user-id"))!==null&&e!==void 0?e:null}get bits(){var e;return Number((e=this._tags.get("bits"))!==null&&e!==void 0?e:0)}get emoteOffsets(){return vj(this._tags.get("emotes"))}get isHypeChat(){return this._tags.has("pinned-chat-paid-amount")}get hypeChatAmount(){return pM(this._tags.get("pinned-chat-paid-amount"),Number)}get hypeChatDecimalPlaces(){return pM(this._tags.get("pinned-chat-paid-exponent"),Number)}get hypeChatLocalizedAmount(){const e=this.hypeChatAmount;return e?e/10**this.hypeChatDecimalPlaces:null}get hypeChatCurrency(){var e;return(e=this._tags.get("pinned-chat-paid-currency"))!==null&&e!==void 0?e:null}get hypeChatLevel(){const e=this._tags.get("pinned-chat-paid-level");return e?slt.indexOf(e)+1:null}get hypeChatIsSystemMessage(){const e=this._tags.get("pinned-chat-paid-is-system-message");return e?!!Number(e):null}};YN=_o([A2("chat","ChatMessage","id")],YN);function olt(t){return t instanceof YN?t.tags.get("id"):t}function NQ(t,e){if(t.length<=e)return[t];t=t.trim();const n=[];let r=0,i=e;for(;r<t.length;){let s=t.lastIndexOf(" ",i);(s===-1||s<=r||t.length-r+1<=e)&&(s=r+e);const o=t.slice(r,s).trim();o.length&&n.push(o),r=s+(t[s]===" "?1:0),i=r+e}return n}const alt=/^[a-z0-9][a-z0-9_]{0,24}$/;function ml(t){const e=t.replace(/^#/,"").toLowerCase();if(!alt.test(e))throw new Error(`"${e}" is not a valid user or channel name. It must be at most 25 characters long, can only include letters, numbers and underscores, and can not start with an underscore.`);return e}function cO(t){return`#${ml(t)}`}var UB;let ZN=UB=class extends C2{constructor(e={}){var n,r,i,s,o,a,c;if(e.authProvider&&!e.authProvider.getAccessTokenForIntent)throw new rI("You can not connect to chat using an AuthProvider that does not support intents.\nTo get an anonymous, read-only connection, please don't pass an `AuthProvider` at all.\nTo get a read-write connection, please provide an auth provider that provides user access tokens via intents, such as `RefreshingAuthProvider`.");super(),this._authVerified=!1,this._authRetryCount=0,this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onTimeout=this.registerEvent(),this.onBan=this.registerEvent(),this.onBitsBadgeUpgrade=this.registerEvent(),this.onChatClear=this.registerEvent(),this.onEmoteOnly=this.registerEvent(),this.onFollowersOnly=this.registerEvent(),this.onJoin=this.registerEvent(),this.onJoinFailure=this.registerEvent(),this.onPart=this.registerEvent(),this.onMessageRemove=this.registerEvent(),this.onUniqueChat=this.registerEvent(),this.onRaid=this.registerEvent(),this.onRaidCancel=this.registerEvent(),this.onRitual=this.registerEvent(),this.onSlow=this.registerEvent(),this.onSubsOnly=this.registerEvent(),this.onSub=this.registerEvent(),this.onResub=this.registerEvent(),this.onSubGift=this.registerEvent(),this.onCommunitySub=this.registerEvent(),this.onSubExtend=this.registerEvent(),this.onRewardGift=this.registerEvent(),this.onPrimePaidUpgrade=this.registerEvent(),this.onGiftPaidUpgrade=this.registerEvent(),this.onPrimeCommunityGift=this.registerEvent(),this.onStandardPayForward=this.registerEvent(),this.onCommunityPayForward=this.registerEvent(),this.onAnnouncement=this.registerEvent(),this.onWhisper=this.registerEvent(),this.onNoPermission=this.registerEvent(),this.onMessageRatelimit=this.registerEvent(),this.onAuthenticationSuccess=this.registerEvent(),this.onAuthenticationFailure=this.registerEvent(),this.onTokenFetchFailure=this.registerEvent(),this.onMessageFailed=this.registerEvent(),this.onMessage=this.registerEvent(),this.onAction=this.registerEvent(),this._onJoinResult=this.registerInternalEvent(),this._ircClient=new zpe({connection:{hostName:(n=e.hostName)!==null&&n!==void 0?n:!((r=e.webSocket)!==null&&r!==void 0)||r?"irc-ws.chat.twitch.tv":"irc.chat.twitch.tv",secure:(i=e.ssl)!==null&&i!==void 0?i:!0},credentials:{nick:"",password:async()=>await this._getAuthToken()},webSocket:(s=e.webSocket)!==null&&s!==void 0?s:!0,connectionOptions:e.connectionOptions,logger:{name:"twurple:chat:irc",...e.logger},nonConformingCommands:["004"],manuallyAcknowledgeJoins:!0,rejoinChannelsOnReconnect:e.rejoinChannelsOnReconnect}),this._ircClient.onDisconnect((l,u)=>{var h,d,m,p;(h=this._messageRateLimiter)===null||h===void 0||h.clear(),(d=this._messageRateLimiter)===null||d===void 0||d.pause(),(m=this._joinRateLimiter)===null||m===void 0||m.clear(),(p=this._joinRateLimiter)===null||p===void 0||p.pause(),this.emit(this.onDisconnect,l,u)}),this._ircClient.registerMessageType(YN),this._chatLogger=HP({name:"twurple:chat:twitch",...e.logger}),this._authProvider=e.authProvider,this._useLegacyScopes=!!e.legacyScopes,this._readOnly=!!e.readOnly,this._authIntents=[...(o=e.authIntents)!==null&&o!==void 0?o:[],"chat"],this._isAlwaysMod=(a=e.isAlwaysMod)!==null&&a!==void 0?a:!1,this._botLevel=(c=e.botLevel)!==null&&c!==void 0?c:"none",this._ircClient.addCapability(ilt),this._ircClient.addCapability(nlt),e.requestMembershipEvents&&this._ircClient.addCapability(rlt),this._ircClient.onConnect(()=>{this.emit(this.onConnect)}),this._ircClient.onRegister(async()=>{var l,u;(l=this._messageRateLimiter)===null||l===void 0||l.resume(),(u=this._joinRateLimiter)===null||u===void 0||u.resume(),this._authVerified=!0,this._authRetryTimer=void 0,this._authRetryCount=0,this.emit(this.onAuthenticationSuccess);const h=await OB(e.channels);h&&await Promise.all(h.map(async d=>{var m;try{await this.join(d)}catch(p){this._chatLogger.warn(`Failed to join configured channel ${d}; original message: ${(m=p?.message)!==null&&m!==void 0?m:p}`)}}))}),this._ircClient.onPasswordError(l=>{this._chatLogger.error(`Error fetching a token for connecting to the server: ${l.message}`),this.emit(this.onTokenFetchFailure,l)}),this._ircClient.onPrivmsg((l,u,h,d)=>{u!=="jtv"&&this.emit(this.onMessage,ml(l),u,h,d)}),this._ircClient.onAction((l,u,h,d)=>{this.emit(this.onAction,ml(l),u,h,d)}),this.addInternalListener(this._onJoinResult,(l,u,h)=>{h?this.emit(this.onJoinFailure,ml(l),h):this._ircClient.acknowledgeJoin(l)}),this._ircClient.onTypedMessage(gj,l=>{const{channel:u,user:h,tags:d}=l,m=ml(u);if(h){const p=d.get("ban-duration");p===void 0?this.emit(this.onBan,m,h,l):this.emit(this.onTimeout,m,h,Number(p),l)}else this.emit(this.onChatClear,m,l)}),this._ircClient.onTypedMessage(Ej,l=>{const{channel:u,targetMessageId:h}=l;this.emit(this.onMessageRemove,ml(u),h,l)}),this._ircClient.onTypedMessage(gM,({prefix:l,channel:u})=>{this.emit(this.onJoin,ml(u),l.nick)}),this._ircClient.onTypedMessage(_M,({prefix:l,channel:u})=>{this.emit(this.onPart,ml(u),l.nick)}),this._ircClient.onTypedMessage(_j,({channel:l,tags:u})=>{let h=!1;if(u.has("subs-only")&&u.has("slow")&&(this.emit(this._onJoinResult,l,u),h=!0),!h){const d=ml(l);if(u.has("slow")){const m=Number(u.get("slow"));m?this.emit(this.onSlow,d,!0,m):this.emit(this.onSlow,d,!1)}if(u.has("followers-only")){const m=Number(u.get("followers-only"));m===-1?this.emit(this.onFollowersOnly,d,!1):this.emit(this.onFollowersOnly,d,!0,m)}}}),this._ircClient.onTypedMessage(yj,l=>{const{channel:u,text:h,tags:d}=l,m=d.get("msg-id"),p=ml(u);switch(m){case"sub":case"resub":{const g=m==="sub"?this.onSub:this.onResub,y=d.get("msg-param-sub-plan"),v=d.get("msg-param-streak-months"),x={userId:d.get("user-id"),displayName:d.get("display-name"),plan:y,planName:d.get("msg-param-sub-plan-name"),isPrime:y==="Prime",months:Number(d.get("msg-param-cumulative-months")),streak:v?Number(v):void 0,message:h};if(d.get("msg-param-was-gifted")==="true"){const C=d.get("msg-param-anon-gift")==="true",A=Number(d.get("msg-param-gift-months")),k=Number(d.get("msg-param-gift-month-being-redeemed"));C?x.originalGiftInfo={anonymous:!0,duration:A,redeemedMonth:k}:x.originalGiftInfo={anonymous:!1,duration:A,redeemedMonth:k,userId:d.get("msg-param-gifter-id"),userName:d.get("msg-param-gifter-login"),userDisplayName:d.get("msg-param-gifter-name")}}this.emit(g,p,d.get("login"),x,l);break}case"subgift":{const g=d.get("msg-param-sub-plan"),y=d.get("login"),v=y==="ananonymousgifter",x={userId:d.get("msg-param-recipient-id"),displayName:d.get("msg-param-recipient-display-name"),gifter:v?void 0:y,gifterUserId:v?void 0:d.get("user-id"),gifterDisplayName:v?void 0:d.get("display-name"),gifterGiftCount:v?void 0:Number(d.get("msg-param-sender-count")),giftDuration:Number(d.get("msg-param-gift-months")),plan:g,planName:d.get("msg-param-sub-plan-name"),isPrime:g==="Prime",months:Number(d.get("msg-param-months"))};this.emit(this.onSubGift,p,d.get("msg-param-recipient-user-name"),x,l);break}case"submysterygift":{const g=d.get("login"),y=g==="ananonymousgifter",v={gifter:y?void 0:g,gifterUserId:y?void 0:d.get("user-id"),gifterDisplayName:y?void 0:d.get("display-name"),gifterGiftCount:y?void 0:Number(d.get("msg-param-sender-count")),count:Number(d.get("msg-param-mass-gift-count")),plan:d.get("msg-param-sub-plan")};this.emit(this.onCommunitySub,p,d.get("login"),v,l);break}case"primepaidupgrade":{const g={userId:d.get("user-id"),displayName:d.get("display-name"),plan:d.get("msg-param-sub-plan")};this.emit(this.onPrimePaidUpgrade,p,d.get("login"),g,l);break}case"giftpaidupgrade":{const g={userId:d.get("user-id"),displayName:d.get("display-name"),gifter:d.get("msg-param-sender-login"),gifterDisplayName:d.get("msg-param-sender-name")};this.emit(this.onGiftPaidUpgrade,p,d.get("login"),g,l);break}case"standardpayforward":{const g=d.get("msg-param-prior-gifter-anonymous")==="true",y={userId:d.get("user-id"),displayName:d.get("display-name"),originalGifterUserId:g?void 0:d.get("msg-param-prior-gifter-id"),originalGifterDisplayName:g?void 0:d.get("msg-param-prior-gifter-display-name"),recipientUserId:d.get("msg-param-recipient-id"),recipientDisplayName:d.get("msg-param-recipient-display-name")};this.emit(this.onStandardPayForward,p,d.get("login"),y,l);break}case"communitypayforward":{const g=d.get("msg-param-prior-gifter-anonymous")==="true",y={userId:d.get("user-id"),displayName:d.get("display-name"),originalGifterUserId:g?void 0:d.get("msg-param-prior-gifter-id"),originalGifterDisplayName:g?void 0:d.get("msg-param-prior-gifter-display-name")};this.emit(this.onCommunityPayForward,p,d.get("login"),y,l);break}case"primecommunitygiftreceived":{const g={name:d.get("msg-param-gift-name"),gifter:d.get("login"),gifterDisplayName:d.get("display-name")};this.emit(this.onPrimeCommunityGift,p,d.get("msg-param-recipient"),g,l);break}case"raid":{const g={displayName:d.get("msg-param-displayName"),viewerCount:Number(d.get("msg-param-viewerCount"))};this.emit(this.onRaid,p,d.get("login"),g,l);break}case"unraid":{this.emit(this.onRaidCancel,p,l);break}case"ritual":{const g={ritualName:d.get("msg-param-ritual-name"),message:h};this.emit(this.onRitual,p,d.get("login"),g,l);break}case"bitsbadgetier":{const g={displayName:d.get("display-name"),threshold:Number(d.get("msg-param-threshold"))};this.emit(this.onBitsBadgeUpgrade,p,d.get("login"),g,l);break}case"extendsub":{const g={userId:d.get("user-id"),displayName:d.get("display-name"),plan:d.get("msg-param-sub-plan"),months:Number(d.get("msg-param-cumulative-months")),endMonth:Number(d.get("msg-param-sub-benefit-end-month"))};this.emit(this.onSubExtend,p,d.get("login"),g,l);break}case"rewardgift":{const g={domain:d.get("msg-param-domain"),gifterId:d.get("user-id"),gifterDisplayName:d.get("display-name"),count:Number(d.get("msg-param-selected-count")),gifterGiftCount:Number(d.get("msg-param-total-reward-count")),triggerType:d.get("msg-param-trigger-type")};this.emit(this.onRewardGift,p,d.get("login"),g,l);break}case"announcement":{const g={color:d.get("msg-param-color")};this.emit(this.onAnnouncement,p,d.get("login"),g,l);break}default:this._chatLogger.warn(`Unrecognized usernotice ID: ${m}`)}}),this._ircClient.onTypedMessage(bj,l=>{this.emit(this.onWhisper,l.prefix.nick,l.text,l)}),this._ircClient.onTypedMessage(VP,async({target:l,text:u,tags:h})=>{const d=h.get("msg-id");switch(d){case"emote_only_on":{this.emit(this.onEmoteOnly,ml(l),!0);break}case"emote_only_off":{this.emit(this.onEmoteOnly,ml(l),!1);break}case"msg_channel_suspended":case"msg_banned":{this.emit(this._onJoinResult,l,void 0,d);break}case"r9k_on":{this.emit(this.onUniqueChat,ml(l),!0);break}case"r9k_off":{this.emit(this.onUniqueChat,ml(l),!1);break}case"subs_on":{this.emit(this.onSubsOnly,ml(l),!0);break}case"subs_off":{this.emit(this.onSubsOnly,ml(l),!1);break}case"cmds_available":break;case"followers_on":case"followers_on_zero":case"followers_off":case"slow_on":case"slow_off":break;case"timeout_success":break;case"unrecognized_cmd":break;case"no_permission":{this.emit(this.onNoPermission,ml(l),u);break}case"msg_ratelimit":{this.emit(this.onMessageRatelimit,ml(l),u);break}case"msg_duplicate":case"msg_emoteonly":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_subsonly":case"msg_slowmode":case"msg_r9k":case"msg_verified_email":case"msg_timedout":case"msg_rejected_mandatory":case"msg_channel_blocked":{this.emit(this.onMessageFailed,ml(l),d);break}case void 0:{if(u==="Login authentication failed"||u==="Improperly formatted AUTH"||u==="Invalid NICK"){this._authVerified=!1,this._authRetryTimer||(this._authRetryTimer=rde(120),this._authRetryCount=0);const m=this._authRetryTimer.next().value,p=++this._authRetryCount;this.emit(this.onAuthenticationFailure,u,p),m!==0&&this._chatLogger.info(`Retrying authentication in ${m} seconds`),await $at(m*1e3),this._ircClient.reconnect()}break}default:d.startsWith("usage_")||this._chatLogger.warn(`Unrecognized notice ID: '${d}'`)}})}connect(){this._authProvider||this._ircClient.changeNick(UB._generateJustinfanNick()),this._initializeRateLimiters(),this._ircClient.connect()}get irc(){return this._ircClient}get isConnected(){return this._ircClient.isConnected}get isConnecting(){return this._ircClient.isConnecting}get currentChannels(){return this._ircClient.currentChannels}async say(e,n,r={},i){const s={};r.replyTo&&(s["reply-parent-msg-id"]=olt(r.replyTo));const o=NQ(n,500);await Promise.all(o.map(async a=>await this._messageRateLimiter.request({type:"say",channel:cO(e),text:a,tags:s},i)))}async action(e,n,r){const i=NQ(n,490);await Promise.all(i.map(async s=>await this._messageRateLimiter.request({type:"action",channel:cO(e),text:s},r)))}async join(e){await this._joinRateLimiter.request(cO(e))}part(e){this._ircClient.part(cO(e))}quit(){var e,n,r,i;(n=(e=this._messageRateLimiter)===null||e===void 0?void 0:e.destroy)===null||n===void 0||n.call(e),(i=(r=this._joinRateLimiter)===null||r===void 0?void 0:r.destroy)===null||i===void 0||i.call(r),this._messageRateLimiter=void 0,this._joinRateLimiter=void 0,this._ircClient.quitAbruptly()}reconnect(){this.quit(),this.connect()}async _getAuthToken(){var e,n;if(!this._authProvider){this._chatLogger.debug("No authProvider given; connecting anonymously");return}if(this._authToken&&!nI(this._authToken)&&this._authVerified)return this._chatLogger.debug("AccessToken assumed to be correct from last connection"),`oauth:${this._authToken.accessToken}`;const r=this._getNecessaryScopes();let i,s=!1;for(const o of this._authIntents){try{if(this._authToken=await this._authProvider.getAccessTokenForIntent(o,r),!this._authToken)continue;s=!0;const a=await mM(this._authToken.accessToken);if(!a.userName)throw new rI("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}catch(a){a instanceof WS?i=a:this._chatLogger.error(`Retrieving an access token failed: ${a.message}`)}this._chatLogger.warn("No valid token available; trying to refresh");try{if(this._authToken=await((n=(e=this._authProvider).refreshAccessTokenForIntent)===null||n===void 0?void 0:n.call(e,o)),this._authToken){const a=await mM(this._authToken.accessToken);if(!a.userName)throw new rI("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}}catch(a){a instanceof WS?i=a:this._chatLogger.error(`Refreshing the access token failed: ${a.message}`)}}throw this._authVerified=!1,i??new Error(s?"Could not retrieve a valid token":`None of the queried intents (${this._authIntents.join(", ")}) are known by the auth provider${this._authProvider instanceof sb?".\nPlease add one of these to the user you want to connect with using the `addIntentToUser` method or the additional parameter to `addUser` or `addUserForToken`.":""}`)}_getNecessaryScopes(){return this._useLegacyScopes?["chat_login"]:this._readOnly?["chat:read"]:["chat:read","chat:edit"]}static _generateJustinfanNick(){return`justinfan${Math.floor(Math.random()*1e5).toString().padStart(5,"0")}`}_initializeRateLimiters(){const e=async({type:r,text:i,channel:s,tags:o})=>{r==="say"?this._ircClient.say(s,i,o):this._ircClient.action(s,i)},n=async r=>{const{promise:i,resolve:s,reject:o}=NB();let a;const c=this.addInternalListener(this._onJoinResult,(l,u,h)=>{l===r&&(clearTimeout(a),h?o(h):s(),this.removeListener(c))});a=setTimeout(()=>{this.removeListener(c),this.emit(this._onJoinResult,r,void 0,"twurple_timeout"),o(new Error(`Did not receive a reply to join ${r} in time; assuming that the join failed`))},1e4),this._ircClient.join(r),await i};if(this._isAlwaysMod)this._messageRateLimiter=new PB({bucketSize:this._botLevel==="verified"?7500:100,timeFrame:32e3,doRequest:e});else{let r=20;this._botLevel==="verified"?r=7500:this._botLevel==="known"&&(r=50),this._messageRateLimiter=new ict(new rct({bucketSize:1,timeFrame:1200,logger:{minLevel:xr.ERROR},doRequest:e,getPartitionKey:({channel:i})=>i}),{bucketSize:r,timeFrame:32e3})}this._joinRateLimiter=new PB({bucketSize:this._botLevel==="verified"?2e3:20,timeFrame:11e3,doRequest:n}),this._messageRateLimiter.pause(),this._joinRateLimiter.pause()}};_o([Sb(!1)],ZN.prototype,"_authProvider",void 0);ZN=UB=_o([A2("chat","ChatClient")],ZN);var FU={exports:{}},PQ;function clt(){return PQ||(PQ=1,(function(t,e){(function(n,r){t.exports=r()})(self,(()=>(()=>{var n={2505:(o,a,c)=>{o.exports=c(8015)},5592:(o,a,c)=>{var l=c(9516),u=c(7522),h=c(3948),d=c(9106),m=c(9615),p=c(2012),g=c(4202),y=c(4896),v=c(5845),x=c(8563),E=c(5656);o.exports=function(C){return new Promise((function(A,k){var M,I=C.data,z=C.headers,H=C.responseType;function K(){C.cancelToken&&C.cancelToken.unsubscribe(M),C.signal&&C.signal.removeEventListener("abort",M)}l.isFormData(I)&&l.isStandardBrowserEnv()&&delete z["Content-Type"];var P=new XMLHttpRequest;if(C.auth){var F=C.auth.username||"",N=C.auth.password?unescape(encodeURIComponent(C.auth.password)):"";z.Authorization="Basic "+btoa(F+":"+N)}var X=m(C.baseURL,C.url);function G(){if(P){var te="getAllResponseHeaders"in P?p(P.getAllResponseHeaders()):null,W={data:H&&H!=="text"&&H!=="json"?P.response:P.responseText,status:P.status,statusText:P.statusText,headers:te,config:C,request:P};u((function($){A($),K()}),(function($){k($),K()}),W),P=null}}if(P.open(C.method.toUpperCase(),d(X,C.params,C.paramsSerializer),!0),P.timeout=C.timeout,"onloadend"in P?P.onloadend=G:P.onreadystatechange=function(){P&&P.readyState===4&&(P.status!==0||P.responseURL&&P.responseURL.indexOf("file:")===0)&&setTimeout(G)},P.onabort=function(){P&&(k(new v("Request aborted",v.ECONNABORTED,C,P)),P=null)},P.onerror=function(){k(new v("Network Error",v.ERR_NETWORK,C,P,P)),P=null},P.ontimeout=function(){var te=C.timeout?"timeout of "+C.timeout+"ms exceeded":"timeout exceeded",W=C.transitional||y;C.timeoutErrorMessage&&(te=C.timeoutErrorMessage),k(new v(te,W.clarifyTimeoutError?v.ETIMEDOUT:v.ECONNABORTED,C,P)),P=null},l.isStandardBrowserEnv()){var j=(C.withCredentials||g(X))&&C.xsrfCookieName?h.read(C.xsrfCookieName):void 0;j&&(z[C.xsrfHeaderName]=j)}"setRequestHeader"in P&&l.forEach(z,(function(te,W){I===void 0&&W.toLowerCase()==="content-type"?delete z[W]:P.setRequestHeader(W,te)})),l.isUndefined(C.withCredentials)||(P.withCredentials=!!C.withCredentials),H&&H!=="json"&&(P.responseType=C.responseType),typeof C.onDownloadProgress=="function"&&P.addEventListener("progress",C.onDownloadProgress),typeof C.onUploadProgress=="function"&&P.upload&&P.upload.addEventListener("progress",C.onUploadProgress),(C.cancelToken||C.signal)&&(M=function(te){P&&(k(!te||te&&te.type?new x:te),P.abort(),P=null)},C.cancelToken&&C.cancelToken.subscribe(M),C.signal&&(C.signal.aborted?M():C.signal.addEventListener("abort",M))),I||(I=null);var q=E(X);q&&["http","https","file"].indexOf(q)===-1?k(new v("Unsupported protocol "+q+":",v.ERR_BAD_REQUEST,C)):P.send(I)}))}},8015:(o,a,c)=>{var l=c(9516),u=c(9012),h=c(5155),d=c(5343),m=(function p(g){var y=new h(g),v=u(h.prototype.request,y);return l.extend(v,h.prototype,y),l.extend(v,y),v.create=function(x){return p(d(g,x))},v})(c(7412));m.Axios=h,m.CanceledError=c(8563),m.CancelToken=c(3191),m.isCancel=c(3864),m.VERSION=c(9641).version,m.toFormData=c(6440),m.AxiosError=c(5845),m.Cancel=m.CanceledError,m.all=function(p){return Promise.all(p)},m.spread=c(7980),m.isAxiosError=c(5019),o.exports=m,o.exports.default=m},3191:(o,a,c)=>{var l=c(8563);function u(h){if(typeof h!="function")throw new TypeError("executor must be a function.");var d;this.promise=new Promise((function(p){d=p}));var m=this;this.promise.then((function(p){if(m._listeners){var g,y=m._listeners.length;for(g=0;g<y;g++)m._listeners[g](p);m._listeners=null}})),this.promise.then=function(p){var g,y=new Promise((function(v){m.subscribe(v),g=v})).then(p);return y.cancel=function(){m.unsubscribe(g)},y},h((function(p){m.reason||(m.reason=new l(p),d(m.reason))}))}u.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},u.prototype.subscribe=function(h){this.reason?h(this.reason):this._listeners?this._listeners.push(h):this._listeners=[h]},u.prototype.unsubscribe=function(h){if(this._listeners){var d=this._listeners.indexOf(h);d!==-1&&this._listeners.splice(d,1)}},u.source=function(){var h;return{token:new u((function(d){h=d})),cancel:h}},o.exports=u},8563:(o,a,c)=>{var l=c(5845);function u(h){l.call(this,h??"canceled",l.ERR_CANCELED),this.name="CanceledError"}c(9516).inherits(u,l,{__CANCEL__:!0}),o.exports=u},3864:o=>{o.exports=function(a){return!(!a||!a.__CANCEL__)}},5155:(o,a,c)=>{var l=c(9516),u=c(9106),h=c(3471),d=c(4490),m=c(5343),p=c(9615),g=c(4841),y=g.validators;function v(x){this.defaults=x,this.interceptors={request:new h,response:new h}}v.prototype.request=function(x,E){typeof x=="string"?(E=E||{}).url=x:E=x||{},(E=m(this.defaults,E)).method?E.method=E.method.toLowerCase():this.defaults.method?E.method=this.defaults.method.toLowerCase():E.method="get";var C=E.transitional;C!==void 0&&g.assertOptions(C,{silentJSONParsing:y.transitional(y.boolean),forcedJSONParsing:y.transitional(y.boolean),clarifyTimeoutError:y.transitional(y.boolean)},!1);var A=[],k=!0;this.interceptors.request.forEach((function(F){typeof F.runWhen=="function"&&F.runWhen(E)===!1||(k=k&&F.synchronous,A.unshift(F.fulfilled,F.rejected))}));var M,I=[];if(this.interceptors.response.forEach((function(F){I.push(F.fulfilled,F.rejected)})),!k){var z=[d,void 0];for(Array.prototype.unshift.apply(z,A),z=z.concat(I),M=Promise.resolve(E);z.length;)M=M.then(z.shift(),z.shift());return M}for(var H=E;A.length;){var K=A.shift(),P=A.shift();try{H=K(H)}catch(F){P(F);break}}try{M=d(H)}catch(F){return Promise.reject(F)}for(;I.length;)M=M.then(I.shift(),I.shift());return M},v.prototype.getUri=function(x){x=m(this.defaults,x);var E=p(x.baseURL,x.url);return u(E,x.params,x.paramsSerializer)},l.forEach(["delete","get","head","options"],(function(x){v.prototype[x]=function(E,C){return this.request(m(C||{},{method:x,url:E,data:(C||{}).data}))}})),l.forEach(["post","put","patch"],(function(x){function E(C){return function(A,k,M){return this.request(m(M||{},{method:x,headers:C?{"Content-Type":"multipart/form-data"}:{},url:A,data:k}))}}v.prototype[x]=E(),v.prototype[x+"Form"]=E(!0)})),o.exports=v},5845:(o,a,c)=>{var l=c(9516);function u(m,p,g,y,v){Error.call(this),this.message=m,this.name="AxiosError",p&&(this.code=p),g&&(this.config=g),y&&(this.request=y),v&&(this.response=v)}l.inherits(u,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var h=u.prototype,d={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(m){d[m]={value:m}})),Object.defineProperties(u,d),Object.defineProperty(h,"isAxiosError",{value:!0}),u.from=function(m,p,g,y,v,x){var E=Object.create(h);return l.toFlatObject(m,E,(function(C){return C!==Error.prototype})),u.call(E,m.message,p,g,y,v),E.name=m.name,x&&Object.assign(E,x),E},o.exports=u},3471:(o,a,c)=>{var l=c(9516);function u(){this.handlers=[]}u.prototype.use=function(h,d,m){return this.handlers.push({fulfilled:h,rejected:d,synchronous:!!m&&m.synchronous,runWhen:m?m.runWhen:null}),this.handlers.length-1},u.prototype.eject=function(h){this.handlers[h]&&(this.handlers[h]=null)},u.prototype.forEach=function(h){l.forEach(this.handlers,(function(d){d!==null&&h(d)}))},o.exports=u},9615:(o,a,c)=>{var l=c(9137),u=c(4680);o.exports=function(h,d){return h&&!l(d)?u(h,d):d}},4490:(o,a,c)=>{var l=c(9516),u=c(2881),h=c(3864),d=c(7412),m=c(8563);function p(g){if(g.cancelToken&&g.cancelToken.throwIfRequested(),g.signal&&g.signal.aborted)throw new m}o.exports=function(g){return p(g),g.headers=g.headers||{},g.data=u.call(g,g.data,g.headers,g.transformRequest),g.headers=l.merge(g.headers.common||{},g.headers[g.method]||{},g.headers),l.forEach(["delete","get","head","post","put","patch","common"],(function(y){delete g.headers[y]})),(g.adapter||d.adapter)(g).then((function(y){return p(g),y.data=u.call(g,y.data,y.headers,g.transformResponse),y}),(function(y){return h(y)||(p(g),y&&y.response&&(y.response.data=u.call(g,y.response.data,y.response.headers,g.transformResponse))),Promise.reject(y)}))}},5343:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){h=h||{};var d={};function m(E,C){return l.isPlainObject(E)&&l.isPlainObject(C)?l.merge(E,C):l.isPlainObject(C)?l.merge({},C):l.isArray(C)?C.slice():C}function p(E){return l.isUndefined(h[E])?l.isUndefined(u[E])?void 0:m(void 0,u[E]):m(u[E],h[E])}function g(E){if(!l.isUndefined(h[E]))return m(void 0,h[E])}function y(E){return l.isUndefined(h[E])?l.isUndefined(u[E])?void 0:m(void 0,u[E]):m(void 0,h[E])}function v(E){return E in h?m(u[E],h[E]):E in u?m(void 0,u[E]):void 0}var x={url:g,method:g,data:g,baseURL:y,transformRequest:y,transformResponse:y,paramsSerializer:y,timeout:y,timeoutMessage:y,withCredentials:y,adapter:y,responseType:y,xsrfCookieName:y,xsrfHeaderName:y,onUploadProgress:y,onDownloadProgress:y,decompress:y,maxContentLength:y,maxBodyLength:y,beforeRedirect:y,transport:y,httpAgent:y,httpsAgent:y,cancelToken:y,socketPath:y,responseEncoding:y,validateStatus:v};return l.forEach(Object.keys(u).concat(Object.keys(h)),(function(E){var C=x[E]||p,A=C(E);l.isUndefined(A)&&C!==v||(d[E]=A)})),d}},7522:(o,a,c)=>{var l=c(5845);o.exports=function(u,h,d){var m=d.config.validateStatus;d.status&&m&&!m(d.status)?h(new l("Request failed with status code "+d.status,[l.ERR_BAD_REQUEST,l.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d)):u(d)}},2881:(o,a,c)=>{var l=c(9516),u=c(7412);o.exports=function(h,d,m){var p=this||u;return l.forEach(m,(function(g){h=g.call(p,h,d)})),h}},7412:(o,a,c)=>{var l=c(9516),u=c(7018),h=c(5845),d=c(4896),m=c(6440),p={"Content-Type":"application/x-www-form-urlencoded"};function g(x,E){!l.isUndefined(x)&&l.isUndefined(x["Content-Type"])&&(x["Content-Type"]=E)}var y,v={transitional:d,adapter:((typeof XMLHttpRequest<"u"||typeof Sa<"u"&&Object.prototype.toString.call(Sa)==="[object process]")&&(y=c(5592)),y),transformRequest:[function(x,E){if(u(E,"Accept"),u(E,"Content-Type"),l.isFormData(x)||l.isArrayBuffer(x)||l.isBuffer(x)||l.isStream(x)||l.isFile(x)||l.isBlob(x))return x;if(l.isArrayBufferView(x))return x.buffer;if(l.isURLSearchParams(x))return g(E,"application/x-www-form-urlencoded;charset=utf-8"),x.toString();var C,A=l.isObject(x),k=E&&E["Content-Type"];if((C=l.isFileList(x))||A&&k==="multipart/form-data"){var M=this.env&&this.env.FormData;return m(C?{"files[]":x}:x,M&&new M)}return A||k==="application/json"?(g(E,"application/json"),(function(I,z,H){if(l.isString(I))try{return(z||JSON.parse)(I),l.trim(I)}catch(K){if(K.name!=="SyntaxError")throw K}return(H||JSON.stringify)(I)})(x)):x}],transformResponse:[function(x){var E=this.transitional||v.transitional,C=E&&E.silentJSONParsing,A=E&&E.forcedJSONParsing,k=!C&&this.responseType==="json";if(k||A&&l.isString(x)&&x.length)try{return JSON.parse(x)}catch(M){if(k)throw M.name==="SyntaxError"?h.from(M,h.ERR_BAD_RESPONSE,this,null,this.response):M}return x}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:c(1534)},validateStatus:function(x){return x>=200&&x<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};l.forEach(["delete","get","head"],(function(x){v.headers[x]={}})),l.forEach(["post","put","patch"],(function(x){v.headers[x]=l.merge(p)})),o.exports=v},4896:o=>{o.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},9641:o=>{o.exports={version:"0.27.2"}},9012:o=>{o.exports=function(a,c){return function(){for(var l=new Array(arguments.length),u=0;u<l.length;u++)l[u]=arguments[u];return a.apply(c,l)}}},9106:(o,a,c)=>{var l=c(9516);function u(h){return encodeURIComponent(h).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}o.exports=function(h,d,m){if(!d)return h;var p;if(m)p=m(d);else if(l.isURLSearchParams(d))p=d.toString();else{var g=[];l.forEach(d,(function(v,x){v!=null&&(l.isArray(v)?x+="[]":v=[v],l.forEach(v,(function(E){l.isDate(E)?E=E.toISOString():l.isObject(E)&&(E=JSON.stringify(E)),g.push(u(x)+"="+u(E))})))})),p=g.join("&")}if(p){var y=h.indexOf("#");y!==-1&&(h=h.slice(0,y)),h+=(h.indexOf("?")===-1?"?":"&")+p}return h}},4680:o=>{o.exports=function(a,c){return c?a.replace(/\/+$/,"")+"/"+c.replace(/^\/+/,""):a}},3948:(o,a,c)=>{var l=c(9516);o.exports=l.isStandardBrowserEnv()?{write:function(u,h,d,m,p,g){var y=[];y.push(u+"="+encodeURIComponent(h)),l.isNumber(d)&&y.push("expires="+new Date(d).toGMTString()),l.isString(m)&&y.push("path="+m),l.isString(p)&&y.push("domain="+p),g===!0&&y.push("secure"),document.cookie=y.join("; ")},read:function(u){var h=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return h?decodeURIComponent(h[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},9137:o=>{o.exports=function(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}},5019:(o,a,c)=>{var l=c(9516);o.exports=function(u){return l.isObject(u)&&u.isAxiosError===!0}},4202:(o,a,c)=>{var l=c(9516);o.exports=l.isStandardBrowserEnv()?(function(){var u,h=/(msie|trident)/i.test(navigator.userAgent),d=document.createElement("a");function m(p){var g=p;return h&&(d.setAttribute("href",g),g=d.href),d.setAttribute("href",g),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return u=m(window.location.href),function(p){var g=l.isString(p)?m(p):p;return g.protocol===u.protocol&&g.host===u.host}})():function(){return!0}},7018:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){l.forEach(u,(function(d,m){m!==h&&m.toUpperCase()===h.toUpperCase()&&(u[h]=d,delete u[m])}))}},1534:o=>{o.exports=null},2012:(o,a,c)=>{var l=c(9516),u=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];o.exports=function(h){var d,m,p,g={};return h&&l.forEach(h.split(`
`),(function(y){if(p=y.indexOf(":"),d=l.trim(y.substr(0,p)).toLowerCase(),m=l.trim(y.substr(p+1)),d){if(g[d]&&u.indexOf(d)>=0)return;g[d]=d==="set-cookie"?(g[d]?g[d]:[]).concat([m]):g[d]?g[d]+", "+m:m}})),g}},5656:o=>{o.exports=function(a){var c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return c&&c[1]||""}},7980:o=>{o.exports=function(a){return function(c){return a.apply(null,c)}}},6440:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){h=h||new FormData;var d=[];function m(p){return p===null?"":l.isDate(p)?p.toISOString():l.isArrayBuffer(p)||l.isTypedArray(p)?typeof Blob=="function"?new Blob([p]):Lo.from(p):p}return(function p(g,y){if(l.isPlainObject(g)||l.isArray(g)){if(d.indexOf(g)!==-1)throw Error("Circular reference detected in "+y);d.push(g),l.forEach(g,(function(v,x){if(!l.isUndefined(v)){var E,C=y?y+"."+x:x;if(v&&!y&&typeof v=="object"){if(l.endsWith(x,"{}"))v=JSON.stringify(v);else if(l.endsWith(x,"[]")&&(E=l.toArray(v)))return void E.forEach((function(A){!l.isUndefined(A)&&h.append(C,m(A))}))}p(v,C)}})),d.pop()}else h.append(y,m(g))})(u),h}},4841:(o,a,c)=>{var l=c(9641).version,u=c(5845),h={};["object","boolean","number","function","string","symbol"].forEach((function(m,p){h[m]=function(g){return typeof g===m||"a"+(p<1?"n ":" ")+m}}));var d={};h.transitional=function(m,p,g){function y(v,x){return"[Axios v"+l+"] Transitional option '"+v+"'"+x+(g?". "+g:"")}return function(v,x,E){if(m===!1)throw new u(y(x," has been removed"+(p?" in "+p:"")),u.ERR_DEPRECATED);return p&&!d[x]&&(d[x]=!0,console.warn(y(x," has been deprecated since v"+p+" and will be removed in the near future"))),!m||m(v,x,E)}},o.exports={assertOptions:function(m,p,g){if(typeof m!="object")throw new u("options must be an object",u.ERR_BAD_OPTION_VALUE);for(var y=Object.keys(m),v=y.length;v-- >0;){var x=y[v],E=p[x];if(E){var C=m[x],A=C===void 0||E(C,x,m);if(A!==!0)throw new u("option "+x+" must be "+A,u.ERR_BAD_OPTION_VALUE)}else if(g!==!0)throw new u("Unknown option "+x,u.ERR_BAD_OPTION)}},validators:h}},9516:(o,a,c)=>{var l,u=c(9012),h=Object.prototype.toString,d=(l=Object.create(null),function(P){var F=h.call(P);return l[F]||(l[F]=F.slice(8,-1).toLowerCase())});function m(P){return P=P.toLowerCase(),function(F){return d(F)===P}}function p(P){return Array.isArray(P)}function g(P){return P===void 0}var y=m("ArrayBuffer");function v(P){return P!==null&&typeof P=="object"}function x(P){if(d(P)!=="object")return!1;var F=Object.getPrototypeOf(P);return F===null||F===Object.prototype}var E=m("Date"),C=m("File"),A=m("Blob"),k=m("FileList");function M(P){return h.call(P)==="[object Function]"}var I=m("URLSearchParams");function z(P,F){if(P!=null)if(typeof P!="object"&&(P=[P]),p(P))for(var N=0,X=P.length;N<X;N++)F.call(null,P[N],N,P);else for(var G in P)Object.prototype.hasOwnProperty.call(P,G)&&F.call(null,P[G],G,P)}var H,K=(H=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(P){return H&&P instanceof H});o.exports={isArray:p,isArrayBuffer:y,isBuffer:function(P){return P!==null&&!g(P)&&P.constructor!==null&&!g(P.constructor)&&typeof P.constructor.isBuffer=="function"&&P.constructor.isBuffer(P)},isFormData:function(P){var F="[object FormData]";return P&&(typeof FormData=="function"&&P instanceof FormData||h.call(P)===F||M(P.toString)&&P.toString()===F)},isArrayBufferView:function(P){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(P):P&&P.buffer&&y(P.buffer)},isString:function(P){return typeof P=="string"},isNumber:function(P){return typeof P=="number"},isObject:v,isPlainObject:x,isUndefined:g,isDate:E,isFile:C,isBlob:A,isFunction:M,isStream:function(P){return v(P)&&M(P.pipe)},isURLSearchParams:I,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:z,merge:function P(){var F={};function N(j,q){x(F[q])&&x(j)?F[q]=P(F[q],j):x(j)?F[q]=P({},j):p(j)?F[q]=j.slice():F[q]=j}for(var X=0,G=arguments.length;X<G;X++)z(arguments[X],N);return F},extend:function(P,F,N){return z(F,(function(X,G){P[G]=N&&typeof X=="function"?u(X,N):X})),P},trim:function(P){return P.trim?P.trim():P.replace(/^\s+|\s+$/g,"")},stripBOM:function(P){return P.charCodeAt(0)===65279&&(P=P.slice(1)),P},inherits:function(P,F,N,X){P.prototype=Object.create(F.prototype,X),P.prototype.constructor=P,N&&Object.assign(P.prototype,N)},toFlatObject:function(P,F,N){var X,G,j,q={};F=F||{};do{for(G=(X=Object.getOwnPropertyNames(P)).length;G-- >0;)q[j=X[G]]||(F[j]=P[j],q[j]=!0);P=Object.getPrototypeOf(P)}while(P&&(!N||N(P,F))&&P!==Object.prototype);return F},kindOf:d,kindOfTest:m,endsWith:function(P,F,N){P=String(P),(N===void 0||N>P.length)&&(N=P.length),N-=F.length;var X=P.indexOf(F,N);return X!==-1&&X===N},toArray:function(P){if(!P)return null;var F=P.length;if(g(F))return null;for(var N=new Array(F);F-- >0;)N[F]=P[F];return N},isTypedArray:K,isFileList:k}},6880:function(o){o.exports=(function(a){var c={};function l(u){if(c[u])return c[u].exports;var h=c[u]={i:u,l:!1,exports:{}};return a[u].call(h.exports,h,h.exports,l),h.l=!0,h.exports}return l.m=a,l.c=c,l.d=function(u,h,d){l.o(u,h)||Object.defineProperty(u,h,{enumerable:!0,get:d})},l.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},l.t=function(u,h){if(1&h&&(u=l(u)),8&h||4&h&&typeof u=="object"&&u&&u.__esModule)return u;var d=Object.create(null);if(l.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:u}),2&h&&typeof u!="string")for(var m in u)l.d(d,m,(function(p){return u[p]}).bind(null,m));return d},l.n=function(u){var h=u&&u.__esModule?function(){return u.default}:function(){return u};return l.d(h,"a",h),h},l.o=function(u,h){return Object.prototype.hasOwnProperty.call(u,h)},l.p="",l(l.s=90)})({17:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=l(18),h=(function(){function d(){}return d.getFirstMatch=function(m,p){var g=p.match(m);return g&&g.length>0&&g[1]||""},d.getSecondMatch=function(m,p){var g=p.match(m);return g&&g.length>1&&g[2]||""},d.matchAndReturnConst=function(m,p,g){if(m.test(p))return g},d.getWindowsVersionName=function(m){switch(m){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},d.getMacOSVersionName=function(m){var p=m.split(".").splice(0,2).map((function(g){return parseInt(g,10)||0}));if(p.push(0),p[0]===10)switch(p[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},d.getAndroidVersionName=function(m){var p=m.split(".").splice(0,2).map((function(g){return parseInt(g,10)||0}));if(p.push(0),!(p[0]===1&&p[1]<5))return p[0]===1&&p[1]<6?"Cupcake":p[0]===1&&p[1]>=6?"Donut":p[0]===2&&p[1]<2?"Eclair":p[0]===2&&p[1]===2?"Froyo":p[0]===2&&p[1]>2?"Gingerbread":p[0]===3?"Honeycomb":p[0]===4&&p[1]<1?"Ice Cream Sandwich":p[0]===4&&p[1]<4?"Jelly Bean":p[0]===4&&p[1]>=4?"KitKat":p[0]===5?"Lollipop":p[0]===6?"Marshmallow":p[0]===7?"Nougat":p[0]===8?"Oreo":p[0]===9?"Pie":void 0},d.getVersionPrecision=function(m){return m.split(".").length},d.compareVersions=function(m,p,g){g===void 0&&(g=!1);var y=d.getVersionPrecision(m),v=d.getVersionPrecision(p),x=Math.max(y,v),E=0,C=d.map([m,p],(function(A){var k=x-d.getVersionPrecision(A),M=A+new Array(k+1).join(".0");return d.map(M.split("."),(function(I){return new Array(20-I.length).join("0")+I})).reverse()}));for(g&&(E=x-Math.min(y,v)),x-=1;x>=E;){if(C[0][x]>C[1][x])return 1;if(C[0][x]===C[1][x]){if(x===E)return 0;x-=1}else if(C[0][x]<C[1][x])return-1}},d.map=function(m,p){var g,y=[];if(Array.prototype.map)return Array.prototype.map.call(m,p);for(g=0;g<m.length;g+=1)y.push(p(m[g]));return y},d.find=function(m,p){var g,y;if(Array.prototype.find)return Array.prototype.find.call(m,p);for(g=0,y=m.length;g<y;g+=1){var v=m[g];if(p(v,g))return v}},d.assign=function(m){for(var p,g,y=m,v=arguments.length,x=new Array(v>1?v-1:0),E=1;E<v;E++)x[E-1]=arguments[E];if(Object.assign)return Object.assign.apply(Object,[m].concat(x));var C=function(){var A=x[p];typeof A=="object"&&A!==null&&Object.keys(A).forEach((function(k){y[k]=A[k]}))};for(p=0,g=x.length;p<g;p+=1)C();return m},d.getBrowserAlias=function(m){return u.BROWSER_ALIASES_MAP[m]},d.getBrowserTypeByAlias=function(m){return u.BROWSER_MAP[m]||""},d})();c.default=h,a.exports=c.default},18:function(a,c,l){c.__esModule=!0,c.ENGINE_MAP=c.OS_MAP=c.PLATFORMS_MAP=c.BROWSER_MAP=c.BROWSER_ALIASES_MAP=void 0,c.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},c.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},c.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},c.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},c.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(91))&&u.__esModule?u:{default:u},d=l(18);function m(g,y){for(var v=0;v<y.length;v++){var x=y[v];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(g,x.key,x)}}var p=(function(){function g(){}var y,v,x;return g.getParser=function(E,C){if(C===void 0&&(C=!1),typeof E!="string")throw new Error("UserAgent should be a string");return new h.default(E,C)},g.parse=function(E){return new h.default(E).getResult()},y=g,x=[{key:"BROWSER_MAP",get:function(){return d.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return d.ENGINE_MAP}},{key:"OS_MAP",get:function(){return d.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return d.PLATFORMS_MAP}}],(v=null)&&m(y.prototype,v),x&&m(y,x),g})();c.default=p,a.exports=c.default},91:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=g(l(92)),h=g(l(93)),d=g(l(94)),m=g(l(95)),p=g(l(17));function g(v){return v&&v.__esModule?v:{default:v}}var y=(function(){function v(E,C){if(C===void 0&&(C=!1),E==null||E==="")throw new Error("UserAgent parameter can't be empty");this._ua=E,this.parsedResult={},C!==!0&&this.parse()}var x=v.prototype;return x.getUA=function(){return this._ua},x.test=function(E){return E.test(this._ua)},x.parseBrowser=function(){var E=this;this.parsedResult.browser={};var C=p.default.find(u.default,(function(A){if(typeof A.test=="function")return A.test(E);if(A.test instanceof Array)return A.test.some((function(k){return E.test(k)}));throw new Error("Browser's test function is not valid")}));return C&&(this.parsedResult.browser=C.describe(this.getUA())),this.parsedResult.browser},x.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},x.getBrowserName=function(E){return E?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},x.getBrowserVersion=function(){return this.getBrowser().version},x.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},x.parseOS=function(){var E=this;this.parsedResult.os={};var C=p.default.find(h.default,(function(A){if(typeof A.test=="function")return A.test(E);if(A.test instanceof Array)return A.test.some((function(k){return E.test(k)}));throw new Error("Browser's test function is not valid")}));return C&&(this.parsedResult.os=C.describe(this.getUA())),this.parsedResult.os},x.getOSName=function(E){var C=this.getOS().name;return E?String(C).toLowerCase()||"":C||""},x.getOSVersion=function(){return this.getOS().version},x.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},x.getPlatformType=function(E){E===void 0&&(E=!1);var C=this.getPlatform().type;return E?String(C).toLowerCase()||"":C||""},x.parsePlatform=function(){var E=this;this.parsedResult.platform={};var C=p.default.find(d.default,(function(A){if(typeof A.test=="function")return A.test(E);if(A.test instanceof Array)return A.test.some((function(k){return E.test(k)}));throw new Error("Browser's test function is not valid")}));return C&&(this.parsedResult.platform=C.describe(this.getUA())),this.parsedResult.platform},x.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},x.getEngineName=function(E){return E?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},x.parseEngine=function(){var E=this;this.parsedResult.engine={};var C=p.default.find(m.default,(function(A){if(typeof A.test=="function")return A.test(E);if(A.test instanceof Array)return A.test.some((function(k){return E.test(k)}));throw new Error("Browser's test function is not valid")}));return C&&(this.parsedResult.engine=C.describe(this.getUA())),this.parsedResult.engine},x.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},x.getResult=function(){return p.default.assign({},this.parsedResult)},x.satisfies=function(E){var C=this,A={},k=0,M={},I=0;if(Object.keys(E).forEach((function(G){var j=E[G];typeof j=="string"?(M[G]=j,I+=1):typeof j=="object"&&(A[G]=j,k+=1)})),k>0){var z=Object.keys(A),H=p.default.find(z,(function(G){return C.isOS(G)}));if(H){var K=this.satisfies(A[H]);if(K!==void 0)return K}var P=p.default.find(z,(function(G){return C.isPlatform(G)}));if(P){var F=this.satisfies(A[P]);if(F!==void 0)return F}}if(I>0){var N=Object.keys(M),X=p.default.find(N,(function(G){return C.isBrowser(G,!0)}));if(X!==void 0)return this.compareVersion(M[X])}},x.isBrowser=function(E,C){C===void 0&&(C=!1);var A=this.getBrowserName().toLowerCase(),k=E.toLowerCase(),M=p.default.getBrowserTypeByAlias(k);return C&&M&&(k=M.toLowerCase()),k===A},x.compareVersion=function(E){var C=[0],A=E,k=!1,M=this.getBrowserVersion();if(typeof M=="string")return E[0]===">"||E[0]==="<"?(A=E.substr(1),E[1]==="="?(k=!0,A=E.substr(2)):C=[],E[0]===">"?C.push(1):C.push(-1)):E[0]==="="?A=E.substr(1):E[0]==="~"&&(k=!0,A=E.substr(1)),C.indexOf(p.default.compareVersions(M,A,k))>-1},x.isOS=function(E){return this.getOSName(!0)===String(E).toLowerCase()},x.isPlatform=function(E){return this.getPlatformType(!0)===String(E).toLowerCase()},x.isEngine=function(E){return this.getEngineName(!0)===String(E).toLowerCase()},x.is=function(E,C){return C===void 0&&(C=!1),this.isBrowser(E,C)||this.isOS(E)||this.isPlatform(E)},x.some=function(E){var C=this;return E===void 0&&(E=[]),E.some((function(A){return C.is(A)}))},v})();c.default=y,a.exports=c.default},92:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=/version\/(\d+(\.?_?\d+)+)/i,m=[{test:[/googlebot/i],describe:function(p){var g={name:"Googlebot"},y=h.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/opera/i],describe:function(p){var g={name:"Opera"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/opr\/|opios/i],describe:function(p){var g={name:"Opera"},y=h.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/SamsungBrowser/i],describe:function(p){var g={name:"Samsung Internet for Android"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/Whale/i],describe:function(p){var g={name:"NAVER Whale Browser"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/MZBrowser/i],describe:function(p){var g={name:"MZ Browser"},y=h.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/focus/i],describe:function(p){var g={name:"Focus"},y=h.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/swing/i],describe:function(p){var g={name:"Swing"},y=h.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/coast/i],describe:function(p){var g={name:"Opera Coast"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(p){var g={name:"Opera Touch"},y=h.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/yabrowser/i],describe:function(p){var g={name:"Yandex Browser"},y=h.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/ucbrowser/i],describe:function(p){var g={name:"UC Browser"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/Maxthon|mxios/i],describe:function(p){var g={name:"Maxthon"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/epiphany/i],describe:function(p){var g={name:"Epiphany"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/puffin/i],describe:function(p){var g={name:"Puffin"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/sleipnir/i],describe:function(p){var g={name:"Sleipnir"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/k-meleon/i],describe:function(p){var g={name:"K-Meleon"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/micromessenger/i],describe:function(p){var g={name:"WeChat"},y=h.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/qqbrowser/i],describe:function(p){var g={name:/qqbrowserlite/i.test(p)?"QQ Browser Lite":"QQ Browser"},y=h.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/msie|trident/i],describe:function(p){var g={name:"Internet Explorer"},y=h.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/\sedg\//i],describe:function(p){var g={name:"Microsoft Edge"},y=h.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/edg([ea]|ios)/i],describe:function(p){var g={name:"Microsoft Edge"},y=h.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/vivaldi/i],describe:function(p){var g={name:"Vivaldi"},y=h.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/seamonkey/i],describe:function(p){var g={name:"SeaMonkey"},y=h.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/sailfish/i],describe:function(p){var g={name:"Sailfish"},y=h.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,p);return y&&(g.version=y),g}},{test:[/silk/i],describe:function(p){var g={name:"Amazon Silk"},y=h.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/phantom/i],describe:function(p){var g={name:"PhantomJS"},y=h.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/slimerjs/i],describe:function(p){var g={name:"SlimerJS"},y=h.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var g={name:"BlackBerry"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var g={name:"WebOS Browser"},y=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/bada/i],describe:function(p){var g={name:"Bada"},y=h.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/tizen/i],describe:function(p){var g={name:"Tizen"},y=h.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/qupzilla/i],describe:function(p){var g={name:"QupZilla"},y=h.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/firefox|iceweasel|fxios/i],describe:function(p){var g={name:"Firefox"},y=h.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/electron/i],describe:function(p){var g={name:"Electron"},y=h.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/MiuiBrowser/i],describe:function(p){var g={name:"Miui"},y=h.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/chromium/i],describe:function(p){var g={name:"Chromium"},y=h.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/chrome|crios|crmo/i],describe:function(p){var g={name:"Chrome"},y=h.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/GSA/i],describe:function(p){var g={name:"Google Search"},y=h.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:function(p){var g=!p.test(/like android/i),y=p.test(/android/i);return g&&y},describe:function(p){var g={name:"Android Browser"},y=h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/playstation 4/i],describe:function(p){var g={name:"PlayStation 4"},y=h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/safari|applewebkit/i],describe:function(p){var g={name:"Safari"},y=h.default.getFirstMatch(d,p);return y&&(g.version=y),g}},{test:[/.*/i],describe:function(p){var g=p.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:h.default.getFirstMatch(g,p),version:h.default.getSecondMatch(g,p)}}}];c.default=m,a.exports=c.default},93:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=l(18),m=[{test:[/Roku\/DVP/],describe:function(p){var g=h.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,p);return{name:d.OS_MAP.Roku,version:g}}},{test:[/windows phone/i],describe:function(p){var g=h.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,p);return{name:d.OS_MAP.WindowsPhone,version:g}}},{test:[/windows /i],describe:function(p){var g=h.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,p),y=h.default.getWindowsVersionName(g);return{name:d.OS_MAP.Windows,version:g,versionName:y}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(p){var g={name:d.OS_MAP.iOS},y=h.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,p);return y&&(g.version=y),g}},{test:[/macintosh/i],describe:function(p){var g=h.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,p).replace(/[_\s]/g,"."),y=h.default.getMacOSVersionName(g),v={name:d.OS_MAP.MacOS,version:g};return y&&(v.versionName=y),v}},{test:[/(ipod|iphone|ipad)/i],describe:function(p){var g=h.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,p).replace(/[_\s]/g,".");return{name:d.OS_MAP.iOS,version:g}}},{test:function(p){var g=!p.test(/like android/i),y=p.test(/android/i);return g&&y},describe:function(p){var g=h.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,p),y=h.default.getAndroidVersionName(g),v={name:d.OS_MAP.Android,version:g};return y&&(v.versionName=y),v}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var g=h.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,p),y={name:d.OS_MAP.WebOS};return g&&g.length&&(y.version=g),y}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var g=h.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,p)||h.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,p)||h.default.getFirstMatch(/\bbb(\d+)/i,p);return{name:d.OS_MAP.BlackBerry,version:g}}},{test:[/bada/i],describe:function(p){var g=h.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,p);return{name:d.OS_MAP.Bada,version:g}}},{test:[/tizen/i],describe:function(p){var g=h.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,p);return{name:d.OS_MAP.Tizen,version:g}}},{test:[/linux/i],describe:function(){return{name:d.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:d.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(p){var g=h.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,p);return{name:d.OS_MAP.PlayStation4,version:g}}}];c.default=m,a.exports=c.default},94:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=l(18),m=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(p){var g=h.default.getFirstMatch(/(can-l01)/i,p)&&"Nova",y={type:d.PLATFORMS_MAP.mobile,vendor:"Huawei"};return g&&(y.model=g),y}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet}}},{test:function(p){var g=p.test(/ipod|iphone/i),y=p.test(/like (ipod|iphone)/i);return g&&!y},describe:function(p){var g=h.default.getFirstMatch(/(ipod|iphone)/i,p);return{type:d.PLATFORMS_MAP.mobile,vendor:"Apple",model:g}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:d.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:d.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName(!0)==="blackberry"},describe:function(){return{type:d.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(p){return p.getBrowserName(!0)==="bada"},describe:function(){return{type:d.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName()==="windows phone"},describe:function(){return{type:d.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(p){var g=Number(String(p.getOSVersion()).split(".")[0]);return p.getOSName(!0)==="android"&&g>=3},describe:function(){return{type:d.PLATFORMS_MAP.tablet}}},{test:function(p){return p.getOSName(!0)==="android"},describe:function(){return{type:d.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getOSName(!0)==="macos"},describe:function(){return{type:d.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(p){return p.getOSName(!0)==="windows"},describe:function(){return{type:d.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="linux"},describe:function(){return{type:d.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="playstation 4"},describe:function(){return{type:d.PLATFORMS_MAP.tv}}},{test:function(p){return p.getOSName(!0)==="roku"},describe:function(){return{type:d.PLATFORMS_MAP.tv}}}];c.default=m,a.exports=c.default},95:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=l(18),m=[{test:function(p){return p.getBrowserName(!0)==="microsoft edge"},describe:function(p){if(/\sedg\//i.test(p))return{name:d.ENGINE_MAP.Blink};var g=h.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,p);return{name:d.ENGINE_MAP.EdgeHTML,version:g}}},{test:[/trident/i],describe:function(p){var g={name:d.ENGINE_MAP.Trident},y=h.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:function(p){return p.test(/presto/i)},describe:function(p){var g={name:d.ENGINE_MAP.Presto},y=h.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:function(p){var g=p.test(/gecko/i),y=p.test(/like gecko/i);return g&&!y},describe:function(p){var g={name:d.ENGINE_MAP.Gecko},y=h.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:d.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(p){var g={name:d.ENGINE_MAP.WebKit},y=h.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,p);return y&&(g.version=y),g}}];c.default=m,a.exports=c.default}})},228:o=>{var a=Object.prototype.hasOwnProperty,c="~";function l(){}function u(p,g,y){this.fn=p,this.context=g,this.once=y||!1}function h(p,g,y,v,x){if(typeof y!="function")throw new TypeError("The listener must be a function");var E=new u(y,v||p,x),C=c?c+g:g;return p._events[C]?p._events[C].fn?p._events[C]=[p._events[C],E]:p._events[C].push(E):(p._events[C]=E,p._eventsCount++),p}function d(p,g){--p._eventsCount==0?p._events=new l:delete p._events[g]}function m(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(c=!1)),m.prototype.eventNames=function(){var p,g,y=[];if(this._eventsCount===0)return y;for(g in p=this._events)a.call(p,g)&&y.push(c?g.slice(1):g);return Object.getOwnPropertySymbols?y.concat(Object.getOwnPropertySymbols(p)):y},m.prototype.listeners=function(p){var g=c?c+p:p,y=this._events[g];if(!y)return[];if(y.fn)return[y.fn];for(var v=0,x=y.length,E=new Array(x);v<x;v++)E[v]=y[v].fn;return E},m.prototype.listenerCount=function(p){var g=c?c+p:p,y=this._events[g];return y?y.fn?1:y.length:0},m.prototype.emit=function(p,g,y,v,x,E){var C=c?c+p:p;if(!this._events[C])return!1;var A,k,M=this._events[C],I=arguments.length;if(M.fn){switch(M.once&&this.removeListener(p,M.fn,void 0,!0),I){case 1:return M.fn.call(M.context),!0;case 2:return M.fn.call(M.context,g),!0;case 3:return M.fn.call(M.context,g,y),!0;case 4:return M.fn.call(M.context,g,y,v),!0;case 5:return M.fn.call(M.context,g,y,v,x),!0;case 6:return M.fn.call(M.context,g,y,v,x,E),!0}for(k=1,A=new Array(I-1);k<I;k++)A[k-1]=arguments[k];M.fn.apply(M.context,A)}else{var z,H=M.length;for(k=0;k<H;k++)switch(M[k].once&&this.removeListener(p,M[k].fn,void 0,!0),I){case 1:M[k].fn.call(M[k].context);break;case 2:M[k].fn.call(M[k].context,g);break;case 3:M[k].fn.call(M[k].context,g,y);break;case 4:M[k].fn.call(M[k].context,g,y,v);break;default:if(!A)for(z=1,A=new Array(I-1);z<I;z++)A[z-1]=arguments[z];M[k].fn.apply(M[k].context,A)}}return!0},m.prototype.on=function(p,g,y){return h(this,p,g,y,!1)},m.prototype.once=function(p,g,y){return h(this,p,g,y,!0)},m.prototype.removeListener=function(p,g,y,v){var x=c?c+p:p;if(!this._events[x])return this;if(!g)return d(this,x),this;var E=this._events[x];if(E.fn)E.fn!==g||v&&!E.once||y&&E.context!==y||d(this,x);else{for(var C=0,A=[],k=E.length;C<k;C++)(E[C].fn!==g||v&&!E[C].once||y&&E[C].context!==y)&&A.push(E[C]);A.length?this._events[x]=A.length===1?A[0]:A:d(this,x)}return this},m.prototype.removeAllListeners=function(p){var g;return p?(g=c?c+p:p,this._events[g]&&d(this,g)):(this._events=new l,this._eventsCount=0),this},m.prototype.off=m.prototype.removeListener,m.prototype.addListener=m.prototype.on,m.prefixed=c,m.EventEmitter=m,o.exports=m},8954:function(o){var a;a=()=>(()=>{var c={228:h=>{var d=Object.prototype.hasOwnProperty,m="~";function p(){}function g(E,C,A){this.fn=E,this.context=C,this.once=A||!1}function y(E,C,A,k,M){if(typeof A!="function")throw new TypeError("The listener must be a function");var I=new g(A,k||E,M),z=m?m+C:C;return E._events[z]?E._events[z].fn?E._events[z]=[E._events[z],I]:E._events[z].push(I):(E._events[z]=I,E._eventsCount++),E}function v(E,C){--E._eventsCount==0?E._events=new p:delete E._events[C]}function x(){this._events=new p,this._eventsCount=0}Object.create&&(p.prototype=Object.create(null),new p().__proto__||(m=!1)),x.prototype.eventNames=function(){var E,C,A=[];if(this._eventsCount===0)return A;for(C in E=this._events)d.call(E,C)&&A.push(m?C.slice(1):C);return Object.getOwnPropertySymbols?A.concat(Object.getOwnPropertySymbols(E)):A},x.prototype.listeners=function(E){var C=m?m+E:E,A=this._events[C];if(!A)return[];if(A.fn)return[A.fn];for(var k=0,M=A.length,I=new Array(M);k<M;k++)I[k]=A[k].fn;return I},x.prototype.listenerCount=function(E){var C=m?m+E:E,A=this._events[C];return A?A.fn?1:A.length:0},x.prototype.emit=function(E,C,A,k,M,I){var z=m?m+E:E;if(!this._events[z])return!1;var H,K,P=this._events[z],F=arguments.length;if(P.fn){switch(P.once&&this.removeListener(E,P.fn,void 0,!0),F){case 1:return P.fn.call(P.context),!0;case 2:return P.fn.call(P.context,C),!0;case 3:return P.fn.call(P.context,C,A),!0;case 4:return P.fn.call(P.context,C,A,k),!0;case 5:return P.fn.call(P.context,C,A,k,M),!0;case 6:return P.fn.call(P.context,C,A,k,M,I),!0}for(K=1,H=new Array(F-1);K<F;K++)H[K-1]=arguments[K];P.fn.apply(P.context,H)}else{var N,X=P.length;for(K=0;K<X;K++)switch(P[K].once&&this.removeListener(E,P[K].fn,void 0,!0),F){case 1:P[K].fn.call(P[K].context);break;case 2:P[K].fn.call(P[K].context,C);break;case 3:P[K].fn.call(P[K].context,C,A);break;case 4:P[K].fn.call(P[K].context,C,A,k);break;default:if(!H)for(N=1,H=new Array(F-1);N<F;N++)H[N-1]=arguments[N];P[K].fn.apply(P[K].context,H)}}return!0},x.prototype.on=function(E,C,A){return y(this,E,C,A,!1)},x.prototype.once=function(E,C,A){return y(this,E,C,A,!0)},x.prototype.removeListener=function(E,C,A,k){var M=m?m+E:E;if(!this._events[M])return this;if(!C)return v(this,M),this;var I=this._events[M];if(I.fn)I.fn!==C||k&&!I.once||A&&I.context!==A||v(this,M);else{for(var z=0,H=[],K=I.length;z<K;z++)(I[z].fn!==C||k&&!I[z].once||A&&I[z].context!==A)&&H.push(I[z]);H.length?this._events[M]=H.length===1?H[0]:H:v(this,M)}return this},x.prototype.removeAllListeners=function(E){var C;return E?(C=m?m+E:E,this._events[C]&&v(this,C)):(this._events=new p,this._eventsCount=0),this},x.prototype.off=x.prototype.removeListener,x.prototype.addListener=x.prototype.on,x.prefixed=m,x.EventEmitter=x,h.exports=x},543:function(h,d,m){var p;h=m.nmd(h),(function(){var g,y="Expected a function",v="__lodash_hash_undefined__",x="__lodash_placeholder__",E=32,C=128,A=1/0,k=9007199254740991,M=NaN,I=4294967295,z=[["ary",C],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",E],["partialRight",64],["rearg",256]],H="[object Arguments]",K="[object Array]",P="[object Boolean]",F="[object Date]",N="[object Error]",X="[object Function]",G="[object GeneratorFunction]",j="[object Map]",q="[object Number]",te="[object Object]",W="[object Promise]",$="[object RegExp]",J="[object Set]",ne="[object String]",ie="[object Symbol]",ae="[object WeakMap]",xe="[object ArrayBuffer]",Ne="[object DataView]",Re="[object Float32Array]",Se="[object Float64Array]",ze="[object Int8Array]",Be="[object Int16Array]",Je="[object Int32Array]",at="[object Uint8Array]",re="[object Uint8ClampedArray]",Le="[object Uint16Array]",He="[object Uint32Array]",Ue=/\b__p \+= '';/g,De=/\b(__p \+=) '' \+/g,fe=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ve=/&(?:amp|lt|gt|quot|#39);/g,Ae=/[&<>"']/g,pe=RegExp(ve.source),Ge=RegExp(Ae.source),Qe=/<%-([\s\S]+?)%>/g,Ze=/<%([\s\S]+?)%>/g,tt=/<%=([\s\S]+?)%>/g,Ft=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,bt=/^\w*$/,Mt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ie=/[\\^$.*+?()[\]{}|]/g,ce=RegExp(Ie.source),Q=/^\s+/,le=/\s/,we=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Me=/\{\n\/\* \[wrapped with (.+)\] \*/,Te=/,? & /,ye=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ye=/[()=,{}\[\]\/\s]/,Pe=/\\(\\)?/g,We=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ve=/\w*$/,Xe=/^[-+]0x[0-9a-f]+$/i,lt=/^0b[01]+$/i,qe=/^\[object .+?Constructor\]$/,rt=/^0o[0-7]+$/i,it=/^(?:0|[1-9]\d*)$/,nt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ct=/($^)/,Qt=/['\n\r\u2028\u2029\\]/g,tn="\\ud800-\\udfff",Ot="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",qt="\\u2700-\\u27bf",vt="a-z\\xdf-\\xf6\\xf8-\\xff",Kt="A-Z\\xc0-\\xd6\\xd8-\\xde",_n="\\ufe0e\\ufe0f",Wt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",dn="["+tn+"]",Mn="["+Wt+"]",Ln="["+Ot+"]",is="\\d+",ni="["+qt+"]",fi="["+vt+"]",Ps="[^"+tn+Wt+is+qt+vt+Kt+"]",Ds="\\ud83c[\\udffb-\\udfff]",zi="[^"+tn+"]",ds="(?:\\ud83c[\\udde6-\\uddff]){2}",ps="[\\ud800-\\udbff][\\udc00-\\udfff]",je="["+Kt+"]",gt="\\u200d",Pt="(?:"+fi+"|"+Ps+")",Dt="(?:"+je+"|"+Ps+")",St="(?:['](?:d|ll|m|re|s|t|ve))?",nn="(?:['](?:D|LL|M|RE|S|T|VE))?",xn="(?:"+Ln+"|"+Ds+")?",ln="["+_n+"]?",Un=ln+xn+"(?:"+gt+"(?:"+[zi,ds,ps].join("|")+")"+ln+xn+")*",ur="(?:"+[ni,ds,ps].join("|")+")"+Un,cr="(?:"+[zi+Ln+"?",Ln,ds,ps,dn].join("|")+")",Fn=RegExp("[']","g"),dr=RegExp(Ln,"g"),Dr=RegExp(Ds+"(?="+Ds+")|"+cr+Un,"g"),ws=RegExp([je+"?"+fi+"+"+St+"(?="+[Mn,je,"$"].join("|")+")",Dt+"+"+nn+"(?="+[Mn,je+Pt,"$"].join("|")+")",je+"?"+Pt+"+"+St,je+"+"+nn,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",is,ur].join("|"),"g"),Ar=RegExp("["+gt+tn+Ot+_n+"]"),Ur=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,rr=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],pr=-1,un={};un[Re]=un[Se]=un[ze]=un[Be]=un[Je]=un[at]=un[re]=un[Le]=un[He]=!0,un[H]=un[K]=un[xe]=un[P]=un[Ne]=un[F]=un[N]=un[X]=un[j]=un[q]=un[te]=un[$]=un[J]=un[ne]=un[ae]=!1;var Er={};Er[H]=Er[K]=Er[xe]=Er[Ne]=Er[P]=Er[F]=Er[Re]=Er[Se]=Er[ze]=Er[Be]=Er[Je]=Er[j]=Er[q]=Er[te]=Er[$]=Er[J]=Er[ne]=Er[ie]=Er[at]=Er[re]=Er[Le]=Er[He]=!0,Er[N]=Er[X]=Er[ae]=!1;var Co={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},io=parseFloat,aa=parseInt,ki=typeof m.g=="object"&&m.g&&m.g.Object===Object&&m.g,kn=typeof self=="object"&&self&&self.Object===Object&&self,Gr=ki||kn||Function("return this")(),$n=d&&!d.nodeType&&d,Zi=$n&&h&&!h.nodeType&&h,za=Zi&&Zi.exports===$n,ms=za&&ki.process,Rs=(function(){try{return Zi&&Zi.require&&Zi.require("util").types||ms&&ms.binding&&ms.binding("util")}catch{}})(),th=Rs&&Rs.isArrayBuffer,mm=Rs&&Rs.isDate,np=Rs&&Rs.isMap,rp=Rs&&Rs.isRegExp,od=Rs&&Rs.isSet,Ha=Rs&&Rs.isTypedArray;function Mc(Ke,dt,pt){switch(pt.length){case 0:return Ke.call(dt);case 1:return Ke.call(dt,pt[0]);case 2:return Ke.call(dt,pt[0],pt[1]);case 3:return Ke.call(dt,pt[0],pt[1],pt[2])}return Ke.apply(dt,pt)}function lc(Ke,dt,pt,zt){for(var on=-1,Cn=Ke==null?0:Ke.length;++on<Cn;){var $r=Ke[on];dt(zt,$r,pt($r),Ke)}return zt}function kc(Ke,dt){for(var pt=-1,zt=Ke==null?0:Ke.length;++pt<zt&&dt(Ke[pt],pt,Ke)!==!1;);return Ke}function gm(Ke,dt){for(var pt=Ke==null?0:Ke.length;pt--&&dt(Ke[pt],pt,Ke)!==!1;);return Ke}function Xc(Ke,dt){for(var pt=-1,zt=Ke==null?0:Ke.length;++pt<zt;)if(!dt(Ke[pt],pt,Ke))return!1;return!0}function Yc(Ke,dt){for(var pt=-1,zt=Ke==null?0:Ke.length,on=0,Cn=[];++pt<zt;){var $r=Ke[pt];dt($r,pt,Ke)&&(Cn[on++]=$r)}return Cn}function nh(Ke,dt){return!(Ke==null||!Ke.length)&&pf(Ke,dt,0)>-1}function gs(Ke,dt,pt){for(var zt=-1,on=Ke==null?0:Ke.length;++zt<on;)if(pt(dt,Ke[zt]))return!0;return!1}function xi(Ke,dt){for(var pt=-1,zt=Ke==null?0:Ke.length,on=Array(zt);++pt<zt;)on[pt]=dt(Ke[pt],pt,Ke);return on}function au(Ke,dt){for(var pt=-1,zt=dt.length,on=Ke.length;++pt<zt;)Ke[on+pt]=dt[pt];return Ke}function kg(Ke,dt,pt,zt){var on=-1,Cn=Ke==null?0:Ke.length;for(zt&&Cn&&(pt=Ke[++on]);++on<Cn;)pt=dt(pt,Ke[on],on,Ke);return pt}function s_(Ke,dt,pt,zt){var on=Ke==null?0:Ke.length;for(zt&&on&&(pt=Ke[--on]);on--;)pt=dt(pt,Ke[on],on,Ke);return pt}function Zc(Ke,dt){for(var pt=-1,zt=Ke==null?0:Ke.length;++pt<zt;)if(dt(Ke[pt],pt,Ke))return!0;return!1}var vo=ip("length");function cu(Ke,dt,pt){var zt;return pt(Ke,(function(on,Cn,$r){if(dt(on,Cn,$r))return zt=Cn,!1})),zt}function lu(Ke,dt,pt,zt){for(var on=Ke.length,Cn=pt+(zt?1:-1);zt?Cn--:++Cn<on;)if(dt(Ke[Cn],Cn,Ke))return Cn;return-1}function pf(Ke,dt,pt){return dt==dt?(function(zt,on,Cn){for(var $r=Cn-1,qo=zt.length;++$r<qo;)if(zt[$r]===on)return $r;return-1})(Ke,dt,pt):lu(Ke,_m,pt)}function Oc(Ke,dt,pt,zt){for(var on=pt-1,Cn=Ke.length;++on<Cn;)if(zt(Ke[on],dt))return on;return-1}function _m(Ke){return Ke!=Ke}function ad(Ke,dt){var pt=Ke==null?0:Ke.length;return pt?mf(Ke,dt)/pt:M}function ip(Ke){return function(dt){return dt==null?g:dt[Ke]}}function vm(Ke){return function(dt){return Ke==null?g:Ke[dt]}}function Du(Ke,dt,pt,zt,on){return on(Ke,(function(Cn,$r,qo){pt=zt?(zt=!1,Cn):dt(pt,Cn,$r,qo)})),pt}function mf(Ke,dt){for(var pt,zt=-1,on=Ke.length;++zt<on;){var Cn=dt(Ke[zt]);Cn!==g&&(pt=pt===g?Cn:pt+Cn)}return pt}function sp(Ke,dt){for(var pt=-1,zt=Array(Ke);++pt<Ke;)zt[pt]=dt(pt);return zt}function wa(Ke){return Ke&&Ke.slice(0,bm(Ke)+1).replace(Q,"")}function qa(Ke){return function(dt){return Ke(dt)}}function rh(Ke,dt){return xi(dt,(function(pt){return Ke[pt]}))}function op(Ke,dt){return Ke.has(dt)}function Ho(Ke,dt){for(var pt=-1,zt=Ke.length;++pt<zt&&pf(dt,Ke[pt],0)>-1;);return pt}function o_(Ke,dt){for(var pt=Ke.length;pt--&&pf(dt,Ke[pt],0)>-1;);return pt}var Xv=vm({:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"}),Yv=vm({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function cd(Ke){return"\\"+Co[Ke]}function gf(Ke){return Ar.test(Ke)}function _f(Ke){var dt=-1,pt=Array(Ke.size);return Ke.forEach((function(zt,on){pt[++dt]=[on,zt]})),pt}function uu(Ke,dt){return function(pt){return Ke(dt(pt))}}function Cl(Ke,dt){for(var pt=-1,zt=Ke.length,on=0,Cn=[];++pt<zt;){var $r=Ke[pt];$r!==dt&&$r!==x||(Ke[pt]=x,Cn[on++]=pt)}return Cn}function ym(Ke){var dt=-1,pt=Array(Ke.size);return Ke.forEach((function(zt){pt[++dt]=zt})),pt}function Oi(Ke){return gf(Ke)?(function(dt){for(var pt=Dr.lastIndex=0;Dr.test(dt);)++pt;return pt})(Ke):vo(Ke)}function Cs(Ke){return gf(Ke)?(function(dt){return dt.match(Dr)||[]})(Ke):(function(dt){return dt.split("")})(Ke)}function bm(Ke){for(var dt=Ke.length;dt--&&le.test(Ke.charAt(dt)););return dt}var Em=vm({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),vf=(function Ke(dt){var pt,zt=(dt=dt==null?Gr:vf.defaults(Gr.Object(),dt,vf.pick(Gr,rr))).Array,on=dt.Date,Cn=dt.Error,$r=dt.Function,qo=dt.Math,Kn=dt.Object,yo=dt.RegExp,fu=dt.String,Ii=dt.TypeError,hu=zt.prototype,Lu=$r.prototype,jn=Kn.prototype,Ic=dt["__core-js_shared__"],qs=Lu.toString,Yn=jn.hasOwnProperty,vr=0,Sm=(pt=/[^.]+$/.exec(Ic&&Ic.keys&&Ic.keys.IE_PROTO||""))?"Symbol(src)_1."+pt:"",du=jn.toString,a_=qs.call(Kn),Ra=Gr._,Og=yo("^"+qs.call(Yn).replace(Ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ao=za?dt.Buffer:g,Va=dt.Symbol,yf=dt.Uint8Array,Ig=Ao?Ao.allocUnsafe:g,Uu=uu(Kn.getPrototypeOf,Kn),bf=Kn.create,xm=jn.propertyIsEnumerable,ih=hu.splice,Ef=Va?Va.isConcatSpreadable:g,Jc=Va?Va.iterator:g,hi=Va?Va.toStringTag:g,Al=(function(){try{var f=Bc(Kn,"defineProperty");return f({},"",{}),f}catch{}})(),Zv=dt.clearTimeout!==Gr.clearTimeout&&dt.clearTimeout,Jv=on&&on.now!==Gr.Date.now&&on.now,Tm=dt.setTimeout!==Gr.setTimeout&&dt.setTimeout,uc=qo.ceil,sh=qo.floor,Bu=Kn.getOwnPropertySymbols,ld=Ao?Ao.isBuffer:g,Ga=dt.isFinite,Ng=hu.join,c_=uu(Kn.keys,Kn),Hr=qo.max,Ti=qo.min,wm=on.now,Rm=dt.parseInt,Cm=qo.random,Tn=hu.reverse,ss=Bc(dt,"DataView"),Fu=Bc(dt,"Map"),fc=Bc(dt,"Promise"),Qc=Bc(dt,"Set"),ju=Bc(dt,"WeakMap"),zu=Bc(Kn,"create"),Sf=ju&&new ju,Hi={},l_=yu(ss),os=yu(Fu),u_=yu(fc),ca=yu(Qc),ud=yu(ju),Vo=Va?Va.prototype:g,hc=Vo?Vo.valueOf:g,gr=Vo?Vo.toString:g;function he(f){if(Pi(f)&&!ar(f)&&!(f instanceof vn)){if(f instanceof Ji)return f;if(Yn.call(f,"__wrapped__"))return qm(f)}return new Ji(f)}var dc=(function(){function f(){}return function(_){if(!_r(_))return{};if(bf)return bf(_);f.prototype=_;var R=new f;return f.prototype=g,R}})();function Ml(){}function Ji(f,_){this.__wrapped__=f,this.__actions__=[],this.__chain__=!!_,this.__index__=0,this.__values__=g}function vn(f){this.__wrapped__=f,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=I,this.__views__=[]}function Mo(f){var _=-1,R=f==null?0:f.length;for(this.clear();++_<R;){var U=f[_];this.set(U[0],U[1])}}function Go(f){var _=-1,R=f==null?0:f.length;for(this.clear();++_<R;){var U=f[_];this.set(U[0],U[1])}}function Ni(f){var _=-1,R=f==null?0:f.length;for(this.clear();++_<R;){var U=f[_];this.set(U[0],U[1])}}function Xt(f){var _=-1,R=f==null?0:f.length;for(this.__data__=new Ni;++_<R;)this.add(f[_])}function ai(f){var _=this.__data__=new Go(f);this.size=_.size}function Pg(f,_){var R=ar(f),U=!R&&tr(f),ee=!R&&!U&&Fs(f),ue=!R&&!U&&!ee&&si(f),de=R||U||ee||ue,be=de?sp(f.length,fu):[],Ce=be.length;for(var Oe in f)!_&&!Yn.call(f,Oe)||de&&(Oe=="length"||ee&&(Oe=="offset"||Oe=="parent")||ue&&(Oe=="buffer"||Oe=="byteLength"||Oe=="byteOffset")||vu(Oe,Ce))||be.push(Oe);return be}function oh(f){var _=f.length;return _?f[Ol(0,_-1)]:g}function ap(f,_){return zm(Wa(f),$a(_,0,f.length))}function Am(f){return zm(Wa(f))}function xf(f,_,R){(R!==g&&!ys(f[_],R)||R===g&&!(_ in f))&&Wo(f,_,R)}function el(f,_,R){var U=f[_];Yn.call(f,_)&&ys(U,R)&&(R!==g||_ in f)||Wo(f,_,R)}function $o(f,_){for(var R=f.length;R--;)if(ys(f[R][0],_))return R;return-1}function cp(f,_,R,U){return so(f,(function(ee,ue,de){_(U,ee,R(ee),de)})),U}function la(f,_){return f&&As(_,Mr(_),f)}function Wo(f,_,R){_=="__proto__"&&Al?Al(f,_,{configurable:!0,enumerable:!0,value:R,writable:!0}):f[_]=R}function ah(f,_){for(var R=-1,U=_.length,ee=zt(U),ue=f==null;++R<U;)ee[R]=ue?g:Td(f,_[R]);return ee}function $a(f,_,R){return f==f&&(R!==g&&(f=f<=R?f:R),_!==g&&(f=f>=_?f:_)),f}function Ls(f,_,R,U,ee,ue){var de,be=1&_,Ce=2&_,Oe=4&_;if(R&&(de=ee?R(f,U,ee,ue):R(f)),de!==g)return de;if(!_r(f))return f;var Fe=ar(f);if(Fe){if(de=(function(st){var xt=st.length,mt=new st.constructor(xt);return xt&&typeof st[0]=="string"&&Yn.call(st,"index")&&(mt.index=st.index,mt.input=st.input),mt})(f),!be)return Wa(f,de)}else{var ot=fa(f),_t=ot==X||ot==G;if(Fs(f))return Bg(f,be);if(ot==te||ot==H||_t&&!ee){if(de=Ce||_t?{}:dh(f),!be)return Ce?(function(st,xt){return As(st,Bm(st),xt)})(f,(function(st,xt){return st&&As(xt,co(xt),st)})(de,f)):(function(st,xt){return As(st,Fc(st),xt)})(f,la(de,f))}else{if(!Er[ot])return ee?f:{};de=(function(st,xt,mt){var Et,kt=st.constructor;switch(xt){case xe:return yr(st);case P:case F:return new kt(+st);case Ne:return(function(Bt,It){var Nt=It?yr(Bt.buffer):Bt.buffer;return new Bt.constructor(Nt,Bt.byteOffset,Bt.byteLength)})(st,mt);case Re:case Se:case ze:case Be:case Je:case at:case re:case Le:case He:return _p(st,mt);case j:return new kt;case q:case ne:return new kt(st);case $:return(function(Bt){var It=new Bt.constructor(Bt.source,Ve.exec(Bt));return It.lastIndex=Bt.lastIndex,It})(st);case J:return new kt;case ie:return Et=st,hc?Kn(hc.call(Et)):{}}})(f,ot,be)}}ue||(ue=new ai);var Tt=ue.get(f);if(Tt)return Tt;ue.set(f,de),bu(f)?f.forEach((function(st){de.add(Ls(st,_,R,st,f,ue))})):Js(f)&&f.forEach((function(st,xt){de.set(xt,Ls(st,_,R,xt,f,ue))}));var ht=Fe?g:(Oe?Ce?Um:_c:Ce?co:Mr)(f);return kc(ht||f,(function(st,xt){ht&&(st=f[xt=st]),el(de,xt,Ls(st,_,R,xt,f,ue))})),de}function tl(f,_,R){var U=R.length;if(f==null)return!U;for(f=Kn(f);U--;){var ee=R[U],ue=_[ee],de=f[ee];if(de===g&&!(ee in f)||!ue(de))return!1}return!0}function lp(f,_,R){if(typeof f!="function")throw new Ii(y);return Ed((function(){f.apply(g,R)}),_)}function kl(f,_,R,U){var ee=-1,ue=nh,de=!0,be=f.length,Ce=[],Oe=_.length;if(!be)return Ce;R&&(_=xi(_,qa(R))),U?(ue=gs,de=!1):_.length>=200&&(ue=op,de=!1,_=new Xt(_));e:for(;++ee<be;){var Fe=f[ee],ot=R==null?Fe:R(Fe);if(Fe=U||Fe!==0?Fe:0,de&&ot==ot){for(var _t=Oe;_t--;)if(_[_t]===ot)continue e;Ce.push(Fe)}else ue(_,ot,U)||Ce.push(Fe)}return Ce}he.templateSettings={escape:Qe,evaluate:Ze,interpolate:tt,variable:"",imports:{_:he}},he.prototype=Ml.prototype,he.prototype.constructor=he,Ji.prototype=dc(Ml.prototype),Ji.prototype.constructor=Ji,vn.prototype=dc(Ml.prototype),vn.prototype.constructor=vn,Mo.prototype.clear=function(){this.__data__=zu?zu(null):{},this.size=0},Mo.prototype.delete=function(f){var _=this.has(f)&&delete this.__data__[f];return this.size-=_?1:0,_},Mo.prototype.get=function(f){var _=this.__data__;if(zu){var R=_[f];return R===v?g:R}return Yn.call(_,f)?_[f]:g},Mo.prototype.has=function(f){var _=this.__data__;return zu?_[f]!==g:Yn.call(_,f)},Mo.prototype.set=function(f,_){var R=this.__data__;return this.size+=this.has(f)?0:1,R[f]=zu&&_===g?v:_,this},Go.prototype.clear=function(){this.__data__=[],this.size=0},Go.prototype.delete=function(f){var _=this.__data__,R=$o(_,f);return!(R<0||(R==_.length-1?_.pop():ih.call(_,R,1),--this.size,0))},Go.prototype.get=function(f){var _=this.__data__,R=$o(_,f);return R<0?g:_[R][1]},Go.prototype.has=function(f){return $o(this.__data__,f)>-1},Go.prototype.set=function(f,_){var R=this.__data__,U=$o(R,f);return U<0?(++this.size,R.push([f,_])):R[U][1]=_,this},Ni.prototype.clear=function(){this.size=0,this.__data__={hash:new Mo,map:new(Fu||Go),string:new Mo}},Ni.prototype.delete=function(f){var _=sr(this,f).delete(f);return this.size-=_?1:0,_},Ni.prototype.get=function(f){return sr(this,f).get(f)},Ni.prototype.has=function(f){return sr(this,f).has(f)},Ni.prototype.set=function(f,_){var R=sr(this,f),U=R.size;return R.set(f,_),this.size+=R.size==U?0:1,this},Xt.prototype.add=Xt.prototype.push=function(f){return this.__data__.set(f,v),this},Xt.prototype.has=function(f){return this.__data__.has(f)},ai.prototype.clear=function(){this.__data__=new Go,this.size=0},ai.prototype.delete=function(f){var _=this.__data__,R=_.delete(f);return this.size=_.size,R},ai.prototype.get=function(f){return this.__data__.get(f)},ai.prototype.has=function(f){return this.__data__.has(f)},ai.prototype.set=function(f,_){var R=this.__data__;if(R instanceof Go){var U=R.__data__;if(!Fu||U.length<199)return U.push([f,_]),this.size=++R.size,this;R=this.__data__=new Ni(U)}return R.set(f,_),this.size=R.size,this};var so=_d(_s),Mm=_d(fd,!0);function f_(f,_){var R=!0;return so(f,(function(U,ee,ue){return R=!!_(U,ee,ue)})),R}function Tf(f,_,R){for(var U=-1,ee=f.length;++U<ee;){var ue=f[U],de=_(ue);if(de!=null&&(be===g?de==de&&!Qi(de):R(de,be)))var be=de,Ce=ue}return Ce}function km(f,_){var R=[];return so(f,(function(U,ee,ue){_(U,ee,ue)&&R.push(U)})),R}function Qr(f,_,R,U,ee){var ue=-1,de=f.length;for(R||(R=g_),ee||(ee=[]);++ue<de;){var be=f[ue];_>0&&R(be)?_>1?Qr(be,_-1,R,U,ee):au(ee,be):U||(ee[ee.length]=be)}return ee}var ch=p_(),Dg=p_(!0);function _s(f,_){return f&&ch(f,_,Mr)}function fd(f,_){return f&&Dg(f,_,Mr)}function Hu(f,_){return Yc(_,(function(R){return Zs(f[R])}))}function pc(f,_){for(var R=0,U=(_=Ma(_,f)).length;f!=null&&R<U;)f=f[Ka(_[R++])];return R&&R==U?f:g}function wf(f,_,R){var U=_(f);return ar(f)?U:au(U,R(f))}function wi(f){return f==null?f===g?"[object Undefined]":"[object Null]":hi&&hi in Kn(f)?(function(_){var R=Yn.call(_,hi),U=_[hi];try{_[hi]=g;var ee=!0}catch{}var ue=du.call(_);return ee&&(R?_[hi]=U:delete _[hi]),ue})(f):(function(_){return du.call(_)})(f)}function hd(f,_){return f>_}function h_(f,_){return f!=null&&Yn.call(f,_)}function xb(f,_){return f!=null&&_ in Kn(f)}function dd(f,_,R){for(var U=R?gs:nh,ee=f[0].length,ue=f.length,de=ue,be=zt(ue),Ce=1/0,Oe=[];de--;){var Fe=f[de];de&&_&&(Fe=xi(Fe,qa(_))),Ce=Ti(Fe.length,Ce),be[de]=!R&&(_||ee>=120&&Fe.length>=120)?new Xt(de&&Fe):g}Fe=f[0];var ot=-1,_t=be[0];e:for(;++ot<ee&&Oe.length<Ce;){var Tt=Fe[ot],ht=_?_(Tt):Tt;if(Tt=R||Tt!==0?Tt:0,!(_t?op(_t,ht):U(Oe,ht,R))){for(de=ue;--de;){var st=be[de];if(!(st?op(st,ht):U(f[de],ht,R)))continue e}_t&&_t.push(ht),Oe.push(Tt)}}return Oe}function mc(f,_,R){var U=(f=Hg(f,_=Ma(_,f)))==null?f:f[Ka(Xa(_))];return U==null?g:Mc(U,f,R)}function Pn(f){return Pi(f)&&wi(f)==H}function ei(f,_,R,U,ee){return f===_||(f==null||_==null||!Pi(f)&&!Pi(_)?f!=f&&_!=_:(function(ue,de,be,Ce,Oe,Fe){var ot=ar(ue),_t=ar(de),Tt=ot?K:fa(ue),ht=_t?K:fa(de),st=(Tt=Tt==H?te:Tt)==te,xt=(ht=ht==H?te:ht)==te,mt=Tt==ht;if(mt&&Fs(ue)){if(!Fs(de))return!1;ot=!0,st=!1}if(mt&&!st)return Fe||(Fe=new ai),ot||si(ue)?vd(ue,de,be,Ce,Oe,Fe):(function(Nt,Zt,hn,In,On,bn,ir){switch(hn){case Ne:if(Nt.byteLength!=Zt.byteLength||Nt.byteOffset!=Zt.byteOffset)return!1;Nt=Nt.buffer,Zt=Zt.buffer;case xe:return!(Nt.byteLength!=Zt.byteLength||!bn(new yf(Nt),new yf(Zt)));case P:case F:case q:return ys(+Nt,+Zt);case N:return Nt.name==Zt.name&&Nt.message==Zt.message;case $:case ne:return Nt==Zt+"";case j:var mr=_f;case J:var ti=1&In;if(mr||(mr=ym),Nt.size!=Zt.size&&!ti)return!1;var Fr=ir.get(Nt);if(Fr)return Fr==Zt;In|=2,ir.set(Nt,Zt);var Kr=vd(mr(Nt),mr(Zt),In,On,bn,ir);return ir.delete(Nt),Kr;case ie:if(hc)return hc.call(Nt)==hc.call(Zt)}return!1})(ue,de,Tt,be,Ce,Oe,Fe);if(!(1&be)){var Et=st&&Yn.call(ue,"__wrapped__"),kt=xt&&Yn.call(de,"__wrapped__");if(Et||kt){var Bt=Et?ue.value():ue,It=kt?de.value():de;return Fe||(Fe=new ai),Oe(Bt,It,be,Ce,Fe)}}return!!mt&&(Fe||(Fe=new ai),(function(Nt,Zt,hn,In,On,bn){var ir=1&hn,mr=_c(Nt),ti=mr.length;if(ti!=_c(Zt).length&&!ir)return!1;for(var Fr=ti;Fr--;){var Kr=mr[Fr];if(!(ir?Kr in Zt:Yn.call(Zt,Kr)))return!1}var pi=bn.get(Nt),li=bn.get(Zt);if(pi&&li)return pi==Zt&&li==Nt;var ji=!0;bn.set(Nt,Zt),bn.set(Zt,Nt);for(var Li=ir;++Fr<ti;){var Vi=Nt[Kr=mr[Fr]],mi=Zt[Kr];if(In)var es=ir?In(mi,Vi,Kr,Zt,Nt,bn):In(Vi,mi,Kr,Nt,Zt,bn);if(!(es===g?Vi===mi||On(Vi,mi,hn,In,bn):es)){ji=!1;break}Li||(Li=Kr=="constructor")}if(ji&&!Li){var $s=Nt.constructor,Gi=Zt.constructor;$s==Gi||!("constructor"in Nt)||!("constructor"in Zt)||typeof $s=="function"&&$s instanceof $s&&typeof Gi=="function"&&Gi instanceof Gi||(ji=!1)}return bn.delete(Nt),bn.delete(Zt),ji})(ue,de,be,Ce,Oe,Fe))})(f,_,R,U,ei,ee))}function qu(f,_,R,U){var ee=R.length,ue=ee,de=!U;if(f==null)return!ue;for(f=Kn(f);ee--;){var be=R[ee];if(de&&be[2]?be[1]!==f[be[0]]:!(be[0]in f))return!1}for(;++ee<ue;){var Ce=(be=R[ee])[0],Oe=f[Ce],Fe=be[1];if(de&&be[2]){if(Oe===g&&!(Ce in f))return!1}else{var ot=new ai;if(U)var _t=U(Oe,Fe,Ce,f,_,ot);if(!(_t===g?ei(Fe,Oe,3,U,ot):_t))return!1}}return!0}function ko(f){return!(!_r(f)||(_=f,Sm&&Sm in _))&&(Zs(f)?Og:qe).test(yu(f));var _}function Om(f){return typeof f=="function"?f:f==null?xo:typeof f=="object"?ar(f)?hp(f[0],f[1]):Lg(f):e0(f)}function up(f){if(!Sp(f))return c_(f);var _=[];for(var R in Kn(f))Yn.call(f,R)&&R!="constructor"&&_.push(R);return _}function d_(f,_){return f<_}function fp(f,_){var R=-1,U=ii(f)?zt(f.length):[];return so(f,(function(ee,ue,de){U[++R]=_(ee,ue,de)})),U}function Lg(f){var _=yd(f);return _.length==1&&_[0][2]?Fm(_[0][0],_[0][1]):function(R){return R===f||qu(R,f,_)}}function hp(f,_){return Ko(f)&&Ys(_)?Fm(Ka(f),_):function(R){var U=Td(R,f);return U===g&&U===_?Zo(R,f):ei(_,U,3)}}function Ca(f,_,R,U,ee){f!==_&&ch(_,(function(ue,de){if(ee||(ee=new ai),_r(ue))(function(Ce,Oe,Fe,ot,_t,Tt,ht){var st=jm(Ce,Fe),xt=jm(Oe,Fe),mt=ht.get(xt);if(mt)xf(Ce,Fe,mt);else{var Et=Tt?Tt(st,xt,Fe+"",Ce,Oe,ht):g,kt=Et===g;if(kt){var Bt=ar(xt),It=!Bt&&Fs(xt),Nt=!Bt&&!It&&si(xt);Et=xt,Bt||It||Nt?ar(st)?Et=st:as(st)?Et=Wa(st):It?(kt=!1,Et=Bg(xt,!0)):Nt?(kt=!1,Et=_p(xt,!0)):Et=[]:di(xt)||tr(xt)?(Et=st,tr(st)?Et=Wr(st):_r(st)&&!Zs(st)||(Et=dh(xt))):kt=!1}kt&&(ht.set(xt,Et),_t(Et,xt,ot,Tt,ht),ht.delete(xt)),xf(Ce,Fe,Et)}})(f,_,de,R,Ca,U,ee);else{var be=U?U(jm(f,de),ue,de+"",f,_,ee):g;be===g&&(be=ue),xf(f,de,be)}}),co)}function dp(f,_){var R=f.length;if(R)return vu(_+=_<0?R:0,R)?f[_]:g}function pp(f,_,R){_=_.length?xi(_,(function(ue){return ar(ue)?function(de){return pc(de,ue.length===1?ue[0]:ue)}:ue})):[xo];var U=-1;_=xi(_,qa(Zn()));var ee=fp(f,(function(ue,de,be){var Ce=xi(_,(function(Oe){return Oe(ue)}));return{criteria:Ce,index:++U,value:ue}}));return(function(ue){var de=ue.length;for(ue.sort((function(be,Ce){return(function(Oe,Fe,ot){for(var _t=-1,Tt=Oe.criteria,ht=Fe.criteria,st=Tt.length,xt=ot.length;++_t<st;){var mt=Fg(Tt[_t],ht[_t]);if(mt)return _t>=xt?mt:mt*(ot[_t]=="desc"?-1:1)}return Oe.index-Fe.index})(be,Ce,R)}));de--;)ue[de]=ue[de].value;return ue})(ee)}function Vu(f,_,R){for(var U=-1,ee=_.length,ue={};++U<ee;){var de=_[U],be=pc(f,de);R(be,de)&&nl(ue,Ma(de,f),be)}return ue}function mp(f,_,R,U){var ee=U?Oc:pf,ue=-1,de=_.length,be=f;for(f===_&&(_=Wa(_)),R&&(be=xi(f,qa(R)));++ue<de;)for(var Ce=0,Oe=_[ue],Fe=R?R(Oe):Oe;(Ce=ee(be,Fe,Ce,U))>-1;)be!==f&&ih.call(be,Ce,1),ih.call(f,Ce,1);return f}function gp(f,_){for(var R=f?_.length:0,U=R-1;R--;){var ee=_[R];if(R==U||ee!==ue){var ue=ee;vu(ee)?ih.call(f,ee,1):Nc(f,ee)}}return f}function Ol(f,_){return f+sh(Cm()*(_-f+1))}function Gu(f,_){var R="";if(!f||_<1||_>k)return R;do _%2&&(R+=f),(_=sh(_/2))&&(f+=f);while(_);return R}function fr(f,_){return Dl(__(f,_,xo),f+"")}function Br(f){return oh(Su(f))}function Aa(f,_){var R=Su(f);return zm(R,$a(_,0,R.length))}function nl(f,_,R,U){if(!_r(f))return f;for(var ee=-1,ue=(_=Ma(_,f)).length,de=ue-1,be=f;be!=null&&++ee<ue;){var Ce=Ka(_[ee]),Oe=R;if(Ce==="__proto__"||Ce==="constructor"||Ce==="prototype")return f;if(ee!=de){var Fe=be[Ce];(Oe=U?U(Fe,Ce,be):g)===g&&(Oe=_r(Fe)?Fe:vu(_[ee+1])?[]:{})}el(be,Ce,Oe),be=be[Ce]}return f}var ri=Sf?function(f,_){return Sf.set(f,_),f}:xo,Im=Al?function(f,_){return Al(f,"toString",{configurable:!0,enumerable:!1,value:If(_),writable:!0})}:xo;function wr(f){return zm(Su(f))}function rl(f,_,R){var U=-1,ee=f.length;_<0&&(_=-_>ee?0:ee+_),(R=R>ee?ee:R)<0&&(R+=ee),ee=_>R?0:R-_>>>0,_>>>=0;for(var ue=zt(ee);++U<ee;)ue[U]=f[U+_];return ue}function Us(f,_){var R;return so(f,(function(U,ee,ue){return!(R=_(U,ee,ue))})),!!R}function pd(f,_,R){var U=0,ee=f==null?U:f.length;if(typeof _=="number"&&_==_&&ee<=2147483647){for(;U<ee;){var ue=U+ee>>>1,de=f[ue];de!==null&&!Qi(de)&&(R?de<=_:de<_)?U=ue+1:ee=ue}return ee}return md(f,_,xo,R)}function md(f,_,R,U){var ee=0,ue=f==null?0:f.length;if(ue===0)return 0;for(var de=(_=R(_))!=_,be=_===null,Ce=Qi(_),Oe=_===g;ee<ue;){var Fe=sh((ee+ue)/2),ot=R(f[Fe]),_t=ot!==g,Tt=ot===null,ht=ot==ot,st=Qi(ot);if(de)var xt=U||ht;else xt=Oe?ht&&(U||_t):be?ht&&_t&&(U||!Tt):Ce?ht&&_t&&!Tt&&(U||!st):!Tt&&!st&&(U?ot<=_:ot<_);xt?ee=Fe+1:ue=Fe}return Ti(ue,4294967294)}function ua(f,_){for(var R=-1,U=f.length,ee=0,ue=[];++R<U;){var de=f[R],be=_?_(de):de;if(!R||!ys(be,Ce)){var Ce=be;ue[ee++]=de===0?0:de}}return ue}function pu(f){return typeof f=="number"?f:Qi(f)?M:+f}function oo(f){if(typeof f=="string")return f;if(ar(f))return xi(f,oo)+"";if(Qi(f))return gr?gr.call(f):"";var _=f+"";return _=="0"&&1/f==-1/0?"-0":_}function Bs(f,_,R){var U=-1,ee=nh,ue=f.length,de=!0,be=[],Ce=be;if(R)de=!1,ee=gs;else if(ue>=200){var Oe=_?null:jg(f);if(Oe)return ym(Oe);de=!1,ee=op,Ce=new Xt}else Ce=_?[]:be;e:for(;++U<ue;){var Fe=f[U],ot=_?_(Fe):Fe;if(Fe=R||Fe!==0?Fe:0,de&&ot==ot){for(var _t=Ce.length;_t--;)if(Ce[_t]===ot)continue e;_&&Ce.push(ot),be.push(Fe)}else ee(Ce,ot,R)||(Ce!==be&&Ce.push(ot),be.push(Fe))}return be}function Nc(f,_){return(f=Hg(f,_=Ma(_,f)))==null||delete f[Ka(Xa(_))]}function Ug(f,_,R,U){return nl(f,_,R(pc(f,_)),U)}function Il(f,_,R,U){for(var ee=f.length,ue=U?ee:-1;(U?ue--:++ue<ee)&&_(f[ue],ue,f););return R?rl(f,U?0:ue,U?ue+1:ee):rl(f,U?ue+1:0,U?ee:ue)}function Oo(f,_){var R=f;return R instanceof vn&&(R=R.value()),kg(_,(function(U,ee){return ee.func.apply(ee.thisArg,au([U],ee.args))}),R)}function $u(f,_,R){var U=f.length;if(U<2)return U?Bs(f[0]):[];for(var ee=-1,ue=zt(U);++ee<U;)for(var de=f[ee],be=-1;++be<U;)be!=ee&&(ue[ee]=kl(ue[ee]||de,f[be],_,R));return Bs(Qr(ue,1),_,R)}function Pc(f,_,R){for(var U=-1,ee=f.length,ue=_.length,de={};++U<ee;){var be=U<ue?_[U]:g;R(de,f[U],be)}return de}function Rf(f){return as(f)?f:[]}function Nl(f){return typeof f=="function"?f:xo}function Ma(f,_){return ar(f)?f:Ko(f,_)?[f]:Ll(Di(f))}var mu=fr;function gu(f,_,R){var U=f.length;return R=R===g?U:R,!_&&R>=U?f:rl(f,_,R)}var Dc=Zv||function(f){return Gr.clearTimeout(f)};function Bg(f,_){if(_)return f.slice();var R=f.length,U=Ig?Ig(R):new f.constructor(R);return f.copy(U),U}function yr(f){var _=new f.constructor(f.byteLength);return new yf(_).set(new yf(f)),_}function _p(f,_){var R=_?yr(f.buffer):f.buffer;return new f.constructor(R,f.byteOffset,f.length)}function Fg(f,_){if(f!==_){var R=f!==g,U=f===null,ee=f==f,ue=Qi(f),de=_!==g,be=_===null,Ce=_==_,Oe=Qi(_);if(!be&&!Oe&&!ue&&f>_||ue&&de&&Ce&&!be&&!Oe||U&&de&&Ce||!R&&Ce||!ee)return 1;if(!U&&!ue&&!Oe&&f<_||Oe&&R&&ee&&!U&&!ue||be&&R&&ee||!de&&ee||!Ce)return-1}return 0}function Nm(f,_,R,U){for(var ee=-1,ue=f.length,de=R.length,be=-1,Ce=_.length,Oe=Hr(ue-de,0),Fe=zt(Ce+Oe),ot=!U;++be<Ce;)Fe[be]=_[be];for(;++ee<de;)(ot||ee<ue)&&(Fe[R[ee]]=f[ee]);for(;Oe--;)Fe[be++]=f[ee++];return Fe}function gd(f,_,R,U){for(var ee=-1,ue=f.length,de=-1,be=R.length,Ce=-1,Oe=_.length,Fe=Hr(ue-be,0),ot=zt(Fe+Oe),_t=!U;++ee<Fe;)ot[ee]=f[ee];for(var Tt=ee;++Ce<Oe;)ot[Tt+Ce]=_[Ce];for(;++de<be;)(_t||ee<ue)&&(ot[Tt+R[de]]=f[ee++]);return ot}function Wa(f,_){var R=-1,U=f.length;for(_||(_=zt(U));++R<U;)_[R]=f[R];return _}function As(f,_,R,U){var ee=!R;R||(R={});for(var ue=-1,de=_.length;++ue<de;){var be=_[ue],Ce=U?U(R[be],f[be],be,R,f):g;Ce===g&&(Ce=f[be]),ee?Wo(R,be,Ce):el(R,be,Ce)}return R}function Lc(f,_){return function(R,U){var ee=ar(R)?lc:cp,ue=_?_():{};return ee(R,f,Zn(U,2),ue)}}function il(f){return fr((function(_,R){var U=-1,ee=R.length,ue=ee>1?R[ee-1]:g,de=ee>2?R[2]:g;for(ue=f.length>3&&typeof ue=="function"?(ee--,ue):g,de&&Vs(R[0],R[1],de)&&(ue=ee<3?g:ue,ee=1),_=Kn(_);++U<ee;){var be=R[U];be&&f(_,be,U,ue)}return _}))}function _d(f,_){return function(R,U){if(R==null)return R;if(!ii(R))return f(R,U);for(var ee=R.length,ue=_?ee:-1,de=Kn(R);(_?ue--:++ue<ee)&&U(de[ue],ue,de)!==!1;);return R}}function p_(f){return function(_,R,U){for(var ee=-1,ue=Kn(_),de=U(_),be=de.length;be--;){var Ce=de[f?be:++ee];if(R(ue[Ce],Ce,ue)===!1)break}return _}}function m_(f){return function(_){var R=gf(_=Di(_))?Cs(_):g,U=R?R[0]:_.charAt(0),ee=R?gu(R,1).join(""):_.slice(1);return U[f]()+ee}}function lh(f){return function(_){return kg(Gs(_h(_).replace(Fn,"")),f,"")}}function _u(f){return function(){var _=arguments;switch(_.length){case 0:return new f;case 1:return new f(_[0]);case 2:return new f(_[0],_[1]);case 3:return new f(_[0],_[1],_[2]);case 4:return new f(_[0],_[1],_[2],_[3]);case 5:return new f(_[0],_[1],_[2],_[3],_[4]);case 6:return new f(_[0],_[1],_[2],_[3],_[4],_[5]);case 7:return new f(_[0],_[1],_[2],_[3],_[4],_[5],_[6])}var R=dc(f.prototype),U=f.apply(R,_);return _r(U)?U:R}}function ka(f){return function(_,R,U){var ee=Kn(_);if(!ii(_)){var ue=Zn(R,3);_=Mr(_),R=function(be){return ue(ee[be],be,ee)}}var de=f(_,R,U);return de>-1?ee[ue?_[de]:de]:g}}function Pm(f){return Oa((function(_){var R=_.length,U=R,ee=Ji.prototype.thru;for(f&&_.reverse();U--;){var ue=_[U];if(typeof ue!="function")throw new Ii(y);if(ee&&!de&&Af(ue)=="wrapper")var de=new Ji([],!0)}for(U=de?U:R;++U<R;){var be=Af(ue=_[U]),Ce=be=="wrapper"?bp(ue):g;de=Ce&&Ep(Ce[0])&&Ce[1]==424&&!Ce[4].length&&Ce[9]==1?de[Af(Ce[0])].apply(de,Ce[3]):ue.length==1&&Ep(ue)?de[be]():de.thru(ue)}return function(){var Oe=arguments,Fe=Oe[0];if(de&&Oe.length==1&&ar(Fe))return de.plant(Fe).value();for(var ot=0,_t=R?_[ot].apply(this,Oe):Fe;++ot<R;)_t=_[ot].call(this,_t);return _t}}))}function Cf(f,_,R,U,ee,ue,de,be,Ce,Oe){var Fe=_&C,ot=1&_,_t=2&_,Tt=24&_,ht=512&_,st=_t?g:_u(f);return function xt(){for(var mt=arguments.length,Et=zt(mt),kt=mt;kt--;)Et[kt]=arguments[kt];if(Tt)var Bt=Uc(xt),It=(function(In,On){for(var bn=In.length,ir=0;bn--;)In[bn]===On&&++ir;return ir})(Et,Bt);if(U&&(Et=Nm(Et,U,ee,Tt)),ue&&(Et=gd(Et,ue,de,Tt)),mt-=It,Tt&&mt<Oe){var Nt=Cl(Et,Bt);return Pl(f,_,Cf,xt.placeholder,R,Et,Nt,be,Ce,Oe-mt)}var Zt=ot?R:this,hn=_t?Zt[f]:f;return mt=Et.length,be?Et=(function(In,On){for(var bn=In.length,ir=Ti(On.length,bn),mr=Wa(In);ir--;){var ti=On[ir];In[ir]=vu(ti,bn)?mr[ti]:g}return In})(Et,be):ht&&mt>1&&Et.reverse(),Fe&&Ce<mt&&(Et.length=Ce),this&&this!==Gr&&this instanceof xt&&(hn=st||_u(hn)),hn.apply(Zt,Et)}}function vp(f,_){return function(R,U){return(function(ee,ue,de,be){return _s(ee,(function(Ce,Oe,Fe){ue(be,de(Ce),Oe,Fe)})),be})(R,f,_(U),{})}}function Dm(f,_){return function(R,U){var ee;if(R===g&&U===g)return _;if(R!==g&&(ee=R),U!==g){if(ee===g)return U;typeof R=="string"||typeof U=="string"?(R=oo(R),U=oo(U)):(R=pu(R),U=pu(U)),ee=f(R,U)}return ee}}function yp(f){return Oa((function(_){return _=xi(_,qa(Zn())),fr((function(R){var U=this;return f(_,(function(ee){return Mc(ee,U,R)}))}))}))}function uh(f,_){var R=(_=_===g?" ":oo(_)).length;if(R<2)return R?Gu(_,f):_;var U=Gu(_,uc(f/Oi(_)));return gf(_)?gu(Cs(U),0,f).join(""):U.slice(0,f)}function sl(f){return function(_,R,U){return U&&typeof U!="number"&&Vs(_,R,U)&&(R=U=g),_=Xn(_),R===g?(R=_,_=0):R=Xn(R),(function(ee,ue,de,be){for(var Ce=-1,Oe=Hr(uc((ue-ee)/(de||1)),0),Fe=zt(Oe);Oe--;)Fe[be?Oe:++Ce]=ee,ee+=de;return Fe})(_,R,U=U===g?_<R?1:-1:Xn(U),f)}}function Io(f){return function(_,R){return typeof _=="string"&&typeof R=="string"||(_=eo(_),R=eo(R)),f(_,R)}}function Pl(f,_,R,U,ee,ue,de,be,Ce,Oe){var Fe=8&_;_|=Fe?E:64,4&(_&=~(Fe?64:E))||(_&=-4);var ot=[f,_,ee,Fe?ue:g,Fe?de:g,Fe?g:ue,Fe?g:de,be,Ce,Oe],_t=R.apply(g,ot);return Ep(f)&&bd(_t,ot),_t.placeholder=U,qg(_t,f,_)}function gc(f){var _=qo[f];return function(R,U){if(R=eo(R),(U=U==null?0:Ti(Wn(U),292))&&Ga(R)){var ee=(Di(R)+"e").split("e");return+((ee=(Di(_(ee[0]+"e"+(+ee[1]+U)))+"e").split("e"))[0]+"e"+(+ee[1]-U))}return _(R)}}var jg=Qc&&1/ym(new Qc([,-0]))[1]==A?function(f){return new Qc(f)}:ci;function Lm(f){return function(_){var R=fa(_);return R==j?_f(_):R==J?(function(U){var ee=-1,ue=Array(U.size);return U.forEach((function(de){ue[++ee]=[de,de]})),ue})(_):(function(U,ee){return xi(ee,(function(ue){return[ue,U[ue]]}))})(_,f(_))}}function vs(f,_,R,U,ee,ue,de,be){var Ce=2&_;if(!Ce&&typeof f!="function")throw new Ii(y);var Oe=U?U.length:0;if(Oe||(_&=-97,U=ee=g),de=de===g?de:Hr(Wn(de),0),be=be===g?be:Wn(be),Oe-=ee?ee.length:0,64&_){var Fe=U,ot=ee;U=ee=g}var _t=Ce?g:bp(f),Tt=[f,_,R,U,ee,Fe,ot,ue,de,be];if(_t&&(function(st,xt){var mt=st[1],Et=xt[1],kt=mt|Et,Bt=kt<131,It=Et==C&&mt==8||Et==C&&mt==256&&st[7].length<=xt[8]||Et==384&&xt[7].length<=xt[8]&&mt==8;if(!Bt&&!It)return st;1&Et&&(st[2]=xt[2],kt|=1&mt?0:4);var Nt=xt[3];if(Nt){var Zt=st[3];st[3]=Zt?Nm(Zt,Nt,xt[4]):Nt,st[4]=Zt?Cl(st[3],x):xt[4]}(Nt=xt[5])&&(Zt=st[5],st[5]=Zt?gd(Zt,Nt,xt[6]):Nt,st[6]=Zt?Cl(st[5],x):xt[6]),(Nt=xt[7])&&(st[7]=Nt),Et&C&&(st[8]=st[8]==null?xt[8]:Ti(st[8],xt[8])),st[9]==null&&(st[9]=xt[9]),st[0]=xt[0],st[1]=kt})(Tt,_t),f=Tt[0],_=Tt[1],R=Tt[2],U=Tt[3],ee=Tt[4],!(be=Tt[9]=Tt[9]===g?Ce?0:f.length:Hr(Tt[9]-Oe,0))&&24&_&&(_&=-25),_&&_!=1)ht=_==8||_==16?(function(st,xt,mt){var Et=_u(st);return function kt(){for(var Bt=arguments.length,It=zt(Bt),Nt=Bt,Zt=Uc(kt);Nt--;)It[Nt]=arguments[Nt];var hn=Bt<3&&It[0]!==Zt&&It[Bt-1]!==Zt?[]:Cl(It,Zt);return(Bt-=hn.length)<mt?Pl(st,xt,Cf,kt.placeholder,g,It,hn,g,g,mt-Bt):Mc(this&&this!==Gr&&this instanceof kt?Et:st,this,It)}})(f,_,be):_!=E&&_!=33||ee.length?Cf.apply(g,Tt):(function(st,xt,mt,Et){var kt=1&xt,Bt=_u(st);return function It(){for(var Nt=-1,Zt=arguments.length,hn=-1,In=Et.length,On=zt(In+Zt),bn=this&&this!==Gr&&this instanceof It?Bt:st;++hn<In;)On[hn]=Et[hn];for(;Zt--;)On[hn++]=arguments[++Nt];return Mc(bn,kt?mt:this,On)}})(f,_,R,U);else var ht=(function(st,xt,mt){var Et=1&xt,kt=_u(st);return function Bt(){return(this&&this!==Gr&&this instanceof Bt?kt:st).apply(Et?mt:this,arguments)}})(f,_,R);return qg((_t?ri:bd)(ht,Tt),f,_)}function bo(f,_,R,U){return f===g||ys(f,jn[R])&&!Yn.call(U,R)?_:f}function fh(f,_,R,U,ee,ue){return _r(f)&&_r(_)&&(ue.set(_,f),Ca(f,_,g,fh,ue),ue.delete(_)),f}function hh(f){return di(f)?g:f}function vd(f,_,R,U,ee,ue){var de=1&R,be=f.length,Ce=_.length;if(be!=Ce&&!(de&&Ce>be))return!1;var Oe=ue.get(f),Fe=ue.get(_);if(Oe&&Fe)return Oe==_&&Fe==f;var ot=-1,_t=!0,Tt=2&R?new Xt:g;for(ue.set(f,_),ue.set(_,f);++ot<be;){var ht=f[ot],st=_[ot];if(U)var xt=de?U(st,ht,ot,_,f,ue):U(ht,st,ot,f,_,ue);if(xt!==g){if(xt)continue;_t=!1;break}if(Tt){if(!Zc(_,(function(mt,Et){if(!op(Tt,Et)&&(ht===mt||ee(ht,mt,R,U,ue)))return Tt.push(Et)}))){_t=!1;break}}else if(ht!==st&&!ee(ht,st,R,U,ue)){_t=!1;break}}return ue.delete(f),ue.delete(_),_t}function Oa(f){return Dl(__(f,g,Gg),f+"")}function _c(f){return wf(f,Mr,Fc)}function Um(f){return wf(f,co,Bm)}var bp=Sf?function(f){return Sf.get(f)}:ci;function Af(f){for(var _=f.name+"",R=Hi[_],U=Yn.call(Hi,_)?R.length:0;U--;){var ee=R[U],ue=ee.func;if(ue==null||ue==f)return ee.name}return _}function Uc(f){return(Yn.call(he,"placeholder")?he:f).placeholder}function Zn(){var f=he.iteratee||Qo;return f=f===Qo?Om:f,arguments.length?f(arguments[0],arguments[1]):f}function sr(f,_){var R,U,ee=f.__data__;return((U=typeof(R=_))=="string"||U=="number"||U=="symbol"||U=="boolean"?R!=="__proto__":R===null)?ee[typeof _=="string"?"string":"hash"]:ee.map}function yd(f){for(var _=Mr(f),R=_.length;R--;){var U=_[R],ee=f[U];_[R]=[U,ee,Ys(ee)]}return _}function Bc(f,_){var R=(function(U,ee){return U==null?g:U[ee]})(f,_);return ko(R)?R:g}var Fc=Bu?function(f){return f==null?[]:(f=Kn(f),Yc(Bu(f),(function(_){return xm.call(f,_)})))}:Eh,Bm=Bu?function(f){for(var _=[];f;)au(_,Fc(f)),f=Uu(f);return _}:Eh,fa=wi;function ha(f,_,R){for(var U=-1,ee=(_=Ma(_,f)).length,ue=!1;++U<ee;){var de=Ka(_[U]);if(!(ue=f!=null&&R(f,de)))break;f=f[de]}return ue||++U!=ee?ue:!!(ee=f==null?0:f.length)&&bs(ee)&&vu(de,ee)&&(ar(f)||tr(f))}function dh(f){return typeof f.constructor!="function"||Sp(f)?{}:dc(Uu(f))}function g_(f){return ar(f)||tr(f)||!!(Ef&&f&&f[Ef])}function vu(f,_){var R=typeof f;return!!(_=_??k)&&(R=="number"||R!="symbol"&&it.test(f))&&f>-1&&f%1==0&&f<_}function Vs(f,_,R){if(!_r(R))return!1;var U=typeof _;return!!(U=="number"?ii(R)&&vu(_,R.length):U=="string"&&_ in R)&&ys(R[_],f)}function Ko(f,_){if(ar(f))return!1;var R=typeof f;return!(R!="number"&&R!="symbol"&&R!="boolean"&&f!=null&&!Qi(f))||bt.test(f)||!Ft.test(f)||_!=null&&f in Kn(_)}function Ep(f){var _=Af(f),R=he[_];if(typeof R!="function"||!(_ in vn.prototype))return!1;if(f===R)return!0;var U=bp(R);return!!U&&f===U[0]}(ss&&fa(new ss(new ArrayBuffer(1)))!=Ne||Fu&&fa(new Fu)!=j||fc&&fa(fc.resolve())!=W||Qc&&fa(new Qc)!=J||ju&&fa(new ju)!=ae)&&(fa=function(f){var _=wi(f),R=_==te?f.constructor:g,U=R?yu(R):"";if(U)switch(U){case l_:return Ne;case os:return j;case u_:return W;case ca:return J;case ud:return ae}return _});var zg=Ic?Zs:L;function Sp(f){var _=f&&f.constructor;return f===(typeof _=="function"&&_.prototype||jn)}function Ys(f){return f==f&&!_r(f)}function Fm(f,_){return function(R){return R!=null&&R[f]===_&&(_!==g||f in Kn(R))}}function __(f,_,R){return _=Hr(_===g?f.length-1:_,0),function(){for(var U=arguments,ee=-1,ue=Hr(U.length-_,0),de=zt(ue);++ee<ue;)de[ee]=U[_+ee];ee=-1;for(var be=zt(_+1);++ee<_;)be[ee]=U[ee];return be[_]=R(de),Mc(f,this,be)}}function Hg(f,_){return _.length<2?f:pc(f,rl(_,0,-1))}function jm(f,_){if((_!=="constructor"||typeof f[_]!="function")&&_!="__proto__")return f[_]}var bd=v_(ri),Ed=Tm||function(f,_){return Gr.setTimeout(f,_)},Dl=v_(Im);function qg(f,_,R){var U=_+"";return Dl(f,(function(ee,ue){var de=ue.length;if(!de)return ee;var be=de-1;return ue[be]=(de>1?"& ":"")+ue[be],ue=ue.join(de>2?", ":" "),ee.replace(we,`{
/* [wrapped with `+ue+`] */
`)})(U,(function(ee,ue){return kc(z,(function(de){var be="_."+de[0];ue&de[1]&&!nh(ee,be)&&ee.push(be)})),ee.sort()})((function(ee){var ue=ee.match(Me);return ue?ue[1].split(Te):[]})(U),R)))}function v_(f){var _=0,R=0;return function(){var U=wm(),ee=16-(U-R);if(R=U,ee>0){if(++_>=800)return arguments[0]}else _=0;return f.apply(g,arguments)}}function zm(f,_){var R=-1,U=f.length,ee=U-1;for(_=_===g?U:_;++R<_;){var ue=Ol(R,ee),de=f[ue];f[ue]=f[R],f[R]=de}return f.length=_,f}var xp,Hm,Ll=(xp=Eo((function(f){var _=[];return f.charCodeAt(0)===46&&_.push(""),f.replace(Mt,(function(R,U,ee,ue){_.push(ee?ue.replace(Pe,"$1"):U||R)})),_}),(function(f){return Hm.size===500&&Hm.clear(),f})),Hm=xp.cache,xp);function Ka(f){if(typeof f=="string"||Qi(f))return f;var _=f+"";return _=="0"&&1/f==-1/0?"-0":_}function yu(f){if(f!=null){try{return qs.call(f)}catch{}try{return f+""}catch{}}return""}function qm(f){if(f instanceof vn)return f.clone();var _=new Ji(f.__wrapped__,f.__chain__);return _.__actions__=Wa(f.__actions__),_.__index__=f.__index__,_.__values__=f.__values__,_}var y_=fr((function(f,_){return as(f)?kl(f,Qr(_,1,as,!0)):[]})),Vm=fr((function(f,_){var R=Xa(_);return as(R)&&(R=g),as(f)?kl(f,Qr(_,1,as,!0),Zn(R,2)):[]})),Vg=fr((function(f,_){var R=Xa(_);return as(R)&&(R=g),as(f)?kl(f,Qr(_,1,as,!0),g,R):[]}));function b_(f,_,R){var U=f==null?0:f.length;if(!U)return-1;var ee=R==null?0:Wn(R);return ee<0&&(ee=Hr(U+ee,0)),lu(f,Zn(_,3),ee)}function E_(f,_,R){var U=f==null?0:f.length;if(!U)return-1;var ee=U-1;return R!==g&&(ee=Wn(R),ee=R<0?Hr(U+ee,0):Ti(ee,U-1)),lu(f,Zn(_,3),ee,!0)}function Gg(f){return f!=null&&f.length?Qr(f,1):[]}function Qv(f){return f&&f.length?f[0]:g}var Gm=fr((function(f){var _=xi(f,Rf);return _.length&&_[0]===f[0]?dd(_):[]})),ey=fr((function(f){var _=Xa(f),R=xi(f,Rf);return _===Xa(R)?_=g:R.pop(),R.length&&R[0]===f[0]?dd(R,Zn(_,2)):[]})),Ul=fr((function(f){var _=Xa(f),R=xi(f,Rf);return(_=typeof _=="function"?_:g)&&R.pop(),R.length&&R[0]===f[0]?dd(R,g,_):[]}));function Xa(f){var _=f==null?0:f.length;return _?f[_-1]:g}var $m=fr(S_);function S_(f,_){return f&&f.length&&_&&_.length?mp(f,_):f}var x_=Oa((function(f,_){var R=f==null?0:f.length,U=ah(f,_);return gp(f,xi(_,(function(ee){return vu(ee,R)?+ee:ee})).sort(Fg)),U}));function T_(f){return f==null?f:Tn.call(f)}var Tb=fr((function(f){return Bs(Qr(f,1,as,!0))})),wb=fr((function(f){var _=Xa(f);return as(_)&&(_=g),Bs(Qr(f,1,as,!0),Zn(_,2))})),w_=fr((function(f){var _=Xa(f);return _=typeof _=="function"?_:g,Bs(Qr(f,1,as,!0),g,_)}));function $g(f){if(!f||!f.length)return[];var _=0;return f=Yc(f,(function(R){if(as(R))return _=Hr(R.length,_),!0})),sp(_,(function(R){return xi(f,ip(R))}))}function R_(f,_){if(!f||!f.length)return[];var R=$g(f);return _==null?R:xi(R,(function(U){return Mc(_,g,U)}))}var Rb=fr((function(f,_){return as(f)?kl(f,_):[]})),Cb=fr((function(f){return $u(Yc(f,as))})),C_=fr((function(f){var _=Xa(f);return as(_)&&(_=g),$u(Yc(f,as),Zn(_,2))})),Ab=fr((function(f){var _=Xa(f);return _=typeof _=="function"?_:g,$u(Yc(f,as),g,_)})),Mb=fr($g),ol=fr((function(f){var _=f.length,R=_>1?f[_-1]:g;return R=typeof R=="function"?(f.pop(),R):g,R_(f,R)}));function Tp(f){var _=he(f);return _.__chain__=!0,_}function wp(f,_){return _(f)}var ty=Oa((function(f){var _=f.length,R=_?f[0]:0,U=this.__wrapped__,ee=function(ue){return ah(ue,f)};return!(_>1||this.__actions__.length)&&U instanceof vn&&vu(R)?((U=U.slice(R,+R+(_?1:0))).__actions__.push({func:wp,args:[ee],thisArg:g}),new Ji(U,this.__chain__).thru((function(ue){return _&&!ue.length&&ue.push(g),ue}))):this.thru(ee)})),ny=Lc((function(f,_,R){Yn.call(f,R)?++f[R]:Wo(f,R,1)})),ry=ka(b_),iy=ka(E_);function Wm(f,_){return(ar(f)?kc:so)(f,Zn(_,3))}function Rp(f,_){return(ar(f)?gm:Mm)(f,Zn(_,3))}var jc=Lc((function(f,_,R){Yn.call(f,R)?f[R].push(_):Wo(f,R,[_])})),Bl=fr((function(f,_,R){var U=-1,ee=typeof _=="function",ue=ii(f)?zt(f.length):[];return so(f,(function(de){ue[++U]=ee?Mc(_,de,R):mc(de,_,R)})),ue})),qi=Lc((function(f,_,R){Wo(f,R,_)}));function Km(f,_){return(ar(f)?xi:fp)(f,Zn(_,3))}var sy=Lc((function(f,_,R){f[R?0:1].push(_)}),(function(){return[[],[]]})),Xo=fr((function(f,_){if(f==null)return[];var R=_.length;return R>1&&Vs(f,_[0],_[1])?_=[]:R>2&&Vs(_[0],_[1],_[2])&&(_=[_[0]]),pp(f,Qr(_,1),[])})),Sd=Jv||function(){return Gr.Date.now()};function Wg(f,_,R){return _=R?g:_,_=f&&_==null?f.length:_,vs(f,C,g,g,g,g,_)}function Kg(f,_){var R;if(typeof _!="function")throw new Ii(y);return f=Wn(f),function(){return--f>0&&(R=_.apply(this,arguments)),f<=1&&(_=g),R}}var Xg=fr((function(f,_,R){var U=1;if(R.length){var ee=Cl(R,Uc(Xg));U|=E}return vs(f,U,_,R,ee)})),Yg=fr((function(f,_,R){var U=3;if(R.length){var ee=Cl(R,Uc(Yg));U|=E}return vs(_,U,f,R,ee)}));function Zg(f,_,R){var U,ee,ue,de,be,Ce,Oe=0,Fe=!1,ot=!1,_t=!0;if(typeof f!="function")throw new Ii(y);function Tt(Et){var kt=U,Bt=ee;return U=ee=g,Oe=Et,de=f.apply(Bt,kt)}function ht(Et){var kt=Et-Ce;return Ce===g||kt>=_||kt<0||ot&&Et-Oe>=ue}function st(){var Et=Sd();if(ht(Et))return xt(Et);be=Ed(st,(function(kt){var Bt=_-(kt-Ce);return ot?Ti(Bt,ue-(kt-Oe)):Bt})(Et))}function xt(Et){return be=g,_t&&U?Tt(Et):(U=ee=g,de)}function mt(){var Et=Sd(),kt=ht(Et);if(U=arguments,ee=this,Ce=Et,kt){if(be===g)return(function(Bt){return Oe=Bt,be=Ed(st,_),Fe?Tt(Bt):de})(Ce);if(ot)return Dc(be),be=Ed(st,_),Tt(Ce)}return be===g&&(be=Ed(st,_)),de}return _=eo(_)||0,_r(R)&&(Fe=!!R.leading,ue=(ot="maxWait"in R)?Hr(eo(R.maxWait)||0,_):ue,_t="trailing"in R?!!R.trailing:_t),mt.cancel=function(){be!==g&&Dc(be),Oe=0,U=Ce=ee=be=g},mt.flush=function(){return be===g?de:xt(Sd())},mt}var Cp=fr((function(f,_){return lp(f,1,_)})),Mf=fr((function(f,_,R){return lp(f,eo(_)||0,R)}));function Eo(f,_){if(typeof f!="function"||_!=null&&typeof _!="function")throw new Ii(y);var R=function(){var U=arguments,ee=_?_.apply(this,U):U[0],ue=R.cache;if(ue.has(ee))return ue.get(ee);var de=f.apply(this,U);return R.cache=ue.set(ee,de)||ue,de};return R.cache=new(Eo.Cache||Ni),R}function Yo(f){if(typeof f!="function")throw new Ii(y);return function(){var _=arguments;switch(_.length){case 0:return!f.call(this);case 1:return!f.call(this,_[0]);case 2:return!f.call(this,_[0],_[1]);case 3:return!f.call(this,_[0],_[1],_[2])}return!f.apply(this,_)}}Eo.Cache=Ni;var Jg=mu((function(f,_){var R=(_=_.length==1&&ar(_[0])?xi(_[0],qa(Zn())):xi(Qr(_,1),qa(Zn()))).length;return fr((function(U){for(var ee=-1,ue=Ti(U.length,R);++ee<ue;)U[ee]=_[ee].call(this,U[ee]);return Mc(f,this,U)}))})),ph=fr((function(f,_){var R=Cl(_,Uc(ph));return vs(f,E,g,_,R)})),Xm=fr((function(f,_){var R=Cl(_,Uc(Xm));return vs(f,64,g,_,R)})),da=Oa((function(f,_){return vs(f,256,g,g,g,_)}));function ys(f,_){return f===_||f!=f&&_!=_}var kb=Io(hd),mh=Io((function(f,_){return f>=_})),tr=Pn((function(){return arguments})())?Pn:function(f){return Pi(f)&&Yn.call(f,"callee")&&!xm.call(f,"callee")},ar=zt.isArray,vc=th?qa(th):function(f){return Pi(f)&&wi(f)==xe};function ii(f){return f!=null&&bs(f.length)&&!Zs(f)}function as(f){return Pi(f)&&ii(f)}var Fs=ld||L,xd=mm?qa(mm):function(f){return Pi(f)&&wi(f)==F};function Ya(f){if(!Pi(f))return!1;var _=wi(f);return _==N||_=="[object DOMException]"||typeof f.message=="string"&&typeof f.name=="string"&&!di(f)}function Zs(f){if(!_r(f))return!1;var _=wi(f);return _==X||_==G||_=="[object AsyncFunction]"||_=="[object Proxy]"}function Ia(f){return typeof f=="number"&&f==Wn(f)}function bs(f){return typeof f=="number"&&f>-1&&f%1==0&&f<=k}function _r(f){var _=typeof f;return f!=null&&(_=="object"||_=="function")}function Pi(f){return f!=null&&typeof f=="object"}var Js=np?qa(np):function(f){return Pi(f)&&fa(f)==j};function Fl(f){return typeof f=="number"||Pi(f)&&wi(f)==q}function di(f){if(!Pi(f)||wi(f)!=te)return!1;var _=Uu(f);if(_===null)return!0;var R=Yn.call(_,"constructor")&&_.constructor;return typeof R=="function"&&R instanceof R&&qs.call(R)==a_}var Qs=rp?qa(rp):function(f){return Pi(f)&&wi(f)==$},bu=od?qa(od):function(f){return Pi(f)&&fa(f)==J};function cs(f){return typeof f=="string"||!ar(f)&&Pi(f)&&wi(f)==ne}function Qi(f){return typeof f=="symbol"||Pi(f)&&wi(f)==ie}var si=Ha?qa(Ha):function(f){return Pi(f)&&bs(f.length)&&!!un[wi(f)]},ao=Io(d_),zc=Io((function(f,_){return f<=_}));function yc(f){if(!f)return[];if(ii(f))return cs(f)?Cs(f):Wa(f);if(Jc&&f[Jc])return(function(R){for(var U,ee=[];!(U=R.next()).done;)ee.push(U.value);return ee})(f[Jc]());var _=fa(f);return(_==j?_f:_==J?ym:Su)(f)}function Xn(f){return f?(f=eo(f))===A||f===-1/0?17976931348623157e292*(f<0?-1:1):f==f?f:0:f===0?f:0}function Wn(f){var _=Xn(f),R=_%1;return _==_?R?_-R:_:0}function An(f){return f?$a(Wn(f),0,I):0}function eo(f){if(typeof f=="number")return f;if(Qi(f))return M;if(_r(f)){var _=typeof f.valueOf=="function"?f.valueOf():f;f=_r(_)?_+"":_}if(typeof f!="string")return f===0?f:+f;f=wa(f);var R=lt.test(f);return R||rt.test(f)?aa(f.slice(2),R?2:8):Xe.test(f)?M:+f}function Wr(f){return As(f,co(f))}function Di(f){return f==null?"":oo(f)}var al=il((function(f,_){if(Sp(_)||ii(_))As(_,Mr(_),f);else for(var R in _)Yn.call(_,R)&&el(f,R,_[R])})),cl=il((function(f,_){As(_,co(_),f)})),ll=il((function(f,_,R,U){As(_,co(_),f,U)})),gh=il((function(f,_,R,U){As(_,Mr(_),f,U)})),Ap=Oa(ah),A_=fr((function(f,_){f=Kn(f);var R=-1,U=_.length,ee=U>2?_[2]:g;for(ee&&Vs(_[0],_[1],ee)&&(U=1);++R<U;)for(var ue=_[R],de=co(ue),be=-1,Ce=de.length;++be<Ce;){var Oe=de[be],Fe=f[Oe];(Fe===g||ys(Fe,jn[Oe])&&!Yn.call(f,Oe))&&(f[Oe]=ue[Oe])}return f})),Mp=fr((function(f){return f.push(g,fh),Mc(Wu,g,f)}));function Td(f,_,R){var U=f==null?g:pc(f,_);return U===g?R:U}function Zo(f,_){return f!=null&&ha(f,_,xb)}var pa=vp((function(f,_,R){_!=null&&typeof _.toString!="function"&&(_=du.call(_)),f[_]=R}),If(xo)),Eu=vp((function(f,_,R){_!=null&&typeof _.toString!="function"&&(_=du.call(_)),Yn.call(f,_)?f[_].push(R):f[_]=[R]}),Zn),ls=fr(mc);function Mr(f){return ii(f)?Pg(f):up(f)}function co(f){return ii(f)?Pg(f,!0):(function(_){if(!_r(_))return(function(ue){var de=[];if(ue!=null)for(var be in Kn(ue))de.push(be);return de})(_);var R=Sp(_),U=[];for(var ee in _)(ee!="constructor"||!R&&Yn.call(_,ee))&&U.push(ee);return U})(f)}var kp=il((function(f,_,R){Ca(f,_,R)})),Wu=il((function(f,_,R,U){Ca(f,_,R,U)})),Ms=Oa((function(f,_){var R={};if(f==null)return R;var U=!1;_=xi(_,(function(ue){return ue=Ma(ue,f),U||(U=ue.length>1),ue})),As(f,Um(f),R),U&&(R=Ls(R,7,hh));for(var ee=_.length;ee--;)Nc(R,_[ee]);return R})),ma=Oa((function(f,_){return f==null?{}:(function(R,U){return Vu(R,U,(function(ee,ue){return Zo(R,ue)}))})(f,_)}));function wd(f,_){if(f==null)return{};var R=xi(Um(f),(function(U){return[U]}));return _=Zn(_),Vu(f,R,(function(U,ee){return _(U,ee[0])}))}var kf=Lm(Mr),jl=Lm(co);function Su(f){return f==null?[]:rh(f,Mr(f))}var Of=lh((function(f,_,R){return _=_.toLowerCase(),f+(R?Qg(_):_)}));function Qg(f){return kr(Di(f).toLowerCase())}function _h(f){return(f=Di(f))&&f.replace(nt,Xv).replace(dr,"")}var Op=lh((function(f,_,R){return f+(R?"-":"")+_.toLowerCase()})),ul=lh((function(f,_,R){return f+(R?" ":"")+_.toLowerCase()})),fl=m_("toLowerCase"),So=lh((function(f,_,R){return f+(R?"_":"")+_.toLowerCase()})),vh=lh((function(f,_,R){return f+(R?" ":"")+kr(_)})),qr=lh((function(f,_,R){return f+(R?" ":"")+_.toUpperCase()})),kr=m_("toUpperCase");function Gs(f,_,R){return f=Di(f),(_=R?g:_)===g?(function(U){return Ur.test(U)})(f)?(function(U){return U.match(ws)||[]})(f):(function(U){return U.match(ye)||[]})(f):f.match(_)||[]}var zl=fr((function(f,_){try{return Mc(f,g,_)}catch(R){return Ya(R)?R:new Cn(R)}})),yh=Oa((function(f,_){return kc(_,(function(R){R=Ka(R),Wo(f,R,Xg(f[R],f))})),f}));function If(f){return function(){return f}}var Ym=Pm(),Jo=Pm(!0);function xo(f){return f}function Qo(f){return Om(typeof f=="function"?f:Ls(f,1))}var Za=fr((function(f,_){return function(R){return mc(R,f,_)}})),ea=fr((function(f,_){return function(R){return mc(f,R,_)}}));function xu(f,_,R){var U=Mr(_),ee=Hu(_,U);R!=null||_r(_)&&(ee.length||!U.length)||(R=_,_=f,f=this,ee=Hu(_,Mr(_)));var ue=!(_r(R)&&"chain"in R&&!R.chain),de=Zs(f);return kc(ee,(function(be){var Ce=_[be];f[be]=Ce,de&&(f.prototype[be]=function(){var Oe=this.__chain__;if(ue||Oe){var Fe=f(this.__wrapped__);return(Fe.__actions__=Wa(this.__actions__)).push({func:Ce,args:arguments,thisArg:f}),Fe.__chain__=Oe,Fe}return Ce.apply(f,au([this.value()],arguments))})})),f}function ci(){}var bh=yp(xi),M_=yp(Xc),Rd=yp(Zc);function e0(f){return Ko(f)?ip(Ka(f)):(function(_){return function(R){return pc(R,_)}})(f)}var ga=sl(),Ku=sl(!0);function Eh(){return[]}function L(){return!1}var w,O=Dm((function(f,_){return f+_}),0),B=gc("ceil"),V=Dm((function(f,_){return f/_}),1),Y=gc("floor"),se=Dm((function(f,_){return f*_}),1),me=gc("round"),S=Dm((function(f,_){return f-_}),0);return he.after=function(f,_){if(typeof _!="function")throw new Ii(y);return f=Wn(f),function(){if(--f<1)return _.apply(this,arguments)}},he.ary=Wg,he.assign=al,he.assignIn=cl,he.assignInWith=ll,he.assignWith=gh,he.at=Ap,he.before=Kg,he.bind=Xg,he.bindAll=yh,he.bindKey=Yg,he.castArray=function(){if(!arguments.length)return[];var f=arguments[0];return ar(f)?f:[f]},he.chain=Tp,he.chunk=function(f,_,R){_=(R?Vs(f,_,R):_===g)?1:Hr(Wn(_),0);var U=f==null?0:f.length;if(!U||_<1)return[];for(var ee=0,ue=0,de=zt(uc(U/_));ee<U;)de[ue++]=rl(f,ee,ee+=_);return de},he.compact=function(f){for(var _=-1,R=f==null?0:f.length,U=0,ee=[];++_<R;){var ue=f[_];ue&&(ee[U++]=ue)}return ee},he.concat=function(){var f=arguments.length;if(!f)return[];for(var _=zt(f-1),R=arguments[0],U=f;U--;)_[U-1]=arguments[U];return au(ar(R)?Wa(R):[R],Qr(_,1))},he.cond=function(f){var _=f==null?0:f.length,R=Zn();return f=_?xi(f,(function(U){if(typeof U[1]!="function")throw new Ii(y);return[R(U[0]),U[1]]})):[],fr((function(U){for(var ee=-1;++ee<_;){var ue=f[ee];if(Mc(ue[0],this,U))return Mc(ue[1],this,U)}}))},he.conforms=function(f){return(function(_){var R=Mr(_);return function(U){return tl(U,_,R)}})(Ls(f,1))},he.constant=If,he.countBy=ny,he.create=function(f,_){var R=dc(f);return _==null?R:la(R,_)},he.curry=function f(_,R,U){var ee=vs(_,8,g,g,g,g,g,R=U?g:R);return ee.placeholder=f.placeholder,ee},he.curryRight=function f(_,R,U){var ee=vs(_,16,g,g,g,g,g,R=U?g:R);return ee.placeholder=f.placeholder,ee},he.debounce=Zg,he.defaults=A_,he.defaultsDeep=Mp,he.defer=Cp,he.delay=Mf,he.difference=y_,he.differenceBy=Vm,he.differenceWith=Vg,he.drop=function(f,_,R){var U=f==null?0:f.length;return U?rl(f,(_=R||_===g?1:Wn(_))<0?0:_,U):[]},he.dropRight=function(f,_,R){var U=f==null?0:f.length;return U?rl(f,0,(_=U-(_=R||_===g?1:Wn(_)))<0?0:_):[]},he.dropRightWhile=function(f,_){return f&&f.length?Il(f,Zn(_,3),!0,!0):[]},he.dropWhile=function(f,_){return f&&f.length?Il(f,Zn(_,3),!0):[]},he.fill=function(f,_,R,U){var ee=f==null?0:f.length;return ee?(R&&typeof R!="number"&&Vs(f,_,R)&&(R=0,U=ee),(function(ue,de,be,Ce){var Oe=ue.length;for((be=Wn(be))<0&&(be=-be>Oe?0:Oe+be),(Ce=Ce===g||Ce>Oe?Oe:Wn(Ce))<0&&(Ce+=Oe),Ce=be>Ce?0:An(Ce);be<Ce;)ue[be++]=de;return ue})(f,_,R,U)):[]},he.filter=function(f,_){return(ar(f)?Yc:km)(f,Zn(_,3))},he.flatMap=function(f,_){return Qr(Km(f,_),1)},he.flatMapDeep=function(f,_){return Qr(Km(f,_),A)},he.flatMapDepth=function(f,_,R){return R=R===g?1:Wn(R),Qr(Km(f,_),R)},he.flatten=Gg,he.flattenDeep=function(f){return f!=null&&f.length?Qr(f,A):[]},he.flattenDepth=function(f,_){return f!=null&&f.length?Qr(f,_=_===g?1:Wn(_)):[]},he.flip=function(f){return vs(f,512)},he.flow=Ym,he.flowRight=Jo,he.fromPairs=function(f){for(var _=-1,R=f==null?0:f.length,U={};++_<R;){var ee=f[_];U[ee[0]]=ee[1]}return U},he.functions=function(f){return f==null?[]:Hu(f,Mr(f))},he.functionsIn=function(f){return f==null?[]:Hu(f,co(f))},he.groupBy=jc,he.initial=function(f){return f!=null&&f.length?rl(f,0,-1):[]},he.intersection=Gm,he.intersectionBy=ey,he.intersectionWith=Ul,he.invert=pa,he.invertBy=Eu,he.invokeMap=Bl,he.iteratee=Qo,he.keyBy=qi,he.keys=Mr,he.keysIn=co,he.map=Km,he.mapKeys=function(f,_){var R={};return _=Zn(_,3),_s(f,(function(U,ee,ue){Wo(R,_(U,ee,ue),U)})),R},he.mapValues=function(f,_){var R={};return _=Zn(_,3),_s(f,(function(U,ee,ue){Wo(R,ee,_(U,ee,ue))})),R},he.matches=function(f){return Lg(Ls(f,1))},he.matchesProperty=function(f,_){return hp(f,Ls(_,1))},he.memoize=Eo,he.merge=kp,he.mergeWith=Wu,he.method=Za,he.methodOf=ea,he.mixin=xu,he.negate=Yo,he.nthArg=function(f){return f=Wn(f),fr((function(_){return dp(_,f)}))},he.omit=Ms,he.omitBy=function(f,_){return wd(f,Yo(Zn(_)))},he.once=function(f){return Kg(2,f)},he.orderBy=function(f,_,R,U){return f==null?[]:(ar(_)||(_=_==null?[]:[_]),ar(R=U?g:R)||(R=R==null?[]:[R]),pp(f,_,R))},he.over=bh,he.overArgs=Jg,he.overEvery=M_,he.overSome=Rd,he.partial=ph,he.partialRight=Xm,he.partition=sy,he.pick=ma,he.pickBy=wd,he.property=e0,he.propertyOf=function(f){return function(_){return f==null?g:pc(f,_)}},he.pull=$m,he.pullAll=S_,he.pullAllBy=function(f,_,R){return f&&f.length&&_&&_.length?mp(f,_,Zn(R,2)):f},he.pullAllWith=function(f,_,R){return f&&f.length&&_&&_.length?mp(f,_,g,R):f},he.pullAt=x_,he.range=ga,he.rangeRight=Ku,he.rearg=da,he.reject=function(f,_){return(ar(f)?Yc:km)(f,Yo(Zn(_,3)))},he.remove=function(f,_){var R=[];if(!f||!f.length)return R;var U=-1,ee=[],ue=f.length;for(_=Zn(_,3);++U<ue;){var de=f[U];_(de,U,f)&&(R.push(de),ee.push(U))}return gp(f,ee),R},he.rest=function(f,_){if(typeof f!="function")throw new Ii(y);return fr(f,_=_===g?_:Wn(_))},he.reverse=T_,he.sampleSize=function(f,_,R){return _=(R?Vs(f,_,R):_===g)?1:Wn(_),(ar(f)?ap:Aa)(f,_)},he.set=function(f,_,R){return f==null?f:nl(f,_,R)},he.setWith=function(f,_,R,U){return U=typeof U=="function"?U:g,f==null?f:nl(f,_,R,U)},he.shuffle=function(f){return(ar(f)?Am:wr)(f)},he.slice=function(f,_,R){var U=f==null?0:f.length;return U?(R&&typeof R!="number"&&Vs(f,_,R)?(_=0,R=U):(_=_==null?0:Wn(_),R=R===g?U:Wn(R)),rl(f,_,R)):[]},he.sortBy=Xo,he.sortedUniq=function(f){return f&&f.length?ua(f):[]},he.sortedUniqBy=function(f,_){return f&&f.length?ua(f,Zn(_,2)):[]},he.split=function(f,_,R){return R&&typeof R!="number"&&Vs(f,_,R)&&(_=R=g),(R=R===g?I:R>>>0)?(f=Di(f))&&(typeof _=="string"||_!=null&&!Qs(_))&&!(_=oo(_))&&gf(f)?gu(Cs(f),0,R):f.split(_,R):[]},he.spread=function(f,_){if(typeof f!="function")throw new Ii(y);return _=_==null?0:Hr(Wn(_),0),fr((function(R){var U=R[_],ee=gu(R,0,_);return U&&au(ee,U),Mc(f,this,ee)}))},he.tail=function(f){var _=f==null?0:f.length;return _?rl(f,1,_):[]},he.take=function(f,_,R){return f&&f.length?rl(f,0,(_=R||_===g?1:Wn(_))<0?0:_):[]},he.takeRight=function(f,_,R){var U=f==null?0:f.length;return U?rl(f,(_=U-(_=R||_===g?1:Wn(_)))<0?0:_,U):[]},he.takeRightWhile=function(f,_){return f&&f.length?Il(f,Zn(_,3),!1,!0):[]},he.takeWhile=function(f,_){return f&&f.length?Il(f,Zn(_,3)):[]},he.tap=function(f,_){return _(f),f},he.throttle=function(f,_,R){var U=!0,ee=!0;if(typeof f!="function")throw new Ii(y);return _r(R)&&(U="leading"in R?!!R.leading:U,ee="trailing"in R?!!R.trailing:ee),Zg(f,_,{leading:U,maxWait:_,trailing:ee})},he.thru=wp,he.toArray=yc,he.toPairs=kf,he.toPairsIn=jl,he.toPath=function(f){return ar(f)?xi(f,Ka):Qi(f)?[f]:Wa(Ll(Di(f)))},he.toPlainObject=Wr,he.transform=function(f,_,R){var U=ar(f),ee=U||Fs(f)||si(f);if(_=Zn(_,4),R==null){var ue=f&&f.constructor;R=ee?U?new ue:[]:_r(f)&&Zs(ue)?dc(Uu(f)):{}}return(ee?kc:_s)(f,(function(de,be,Ce){return _(R,de,be,Ce)})),R},he.unary=function(f){return Wg(f,1)},he.union=Tb,he.unionBy=wb,he.unionWith=w_,he.uniq=function(f){return f&&f.length?Bs(f):[]},he.uniqBy=function(f,_){return f&&f.length?Bs(f,Zn(_,2)):[]},he.uniqWith=function(f,_){return _=typeof _=="function"?_:g,f&&f.length?Bs(f,g,_):[]},he.unset=function(f,_){return f==null||Nc(f,_)},he.unzip=$g,he.unzipWith=R_,he.update=function(f,_,R){return f==null?f:Ug(f,_,Nl(R))},he.updateWith=function(f,_,R,U){return U=typeof U=="function"?U:g,f==null?f:Ug(f,_,Nl(R),U)},he.values=Su,he.valuesIn=function(f){return f==null?[]:rh(f,co(f))},he.without=Rb,he.words=Gs,he.wrap=function(f,_){return ph(Nl(_),f)},he.xor=Cb,he.xorBy=C_,he.xorWith=Ab,he.zip=Mb,he.zipObject=function(f,_){return Pc(f||[],_||[],el)},he.zipObjectDeep=function(f,_){return Pc(f||[],_||[],nl)},he.zipWith=ol,he.entries=kf,he.entriesIn=jl,he.extend=cl,he.extendWith=ll,xu(he,he),he.add=O,he.attempt=zl,he.camelCase=Of,he.capitalize=Qg,he.ceil=B,he.clamp=function(f,_,R){return R===g&&(R=_,_=g),R!==g&&(R=(R=eo(R))==R?R:0),_!==g&&(_=(_=eo(_))==_?_:0),$a(eo(f),_,R)},he.clone=function(f){return Ls(f,4)},he.cloneDeep=function(f){return Ls(f,5)},he.cloneDeepWith=function(f,_){return Ls(f,5,_=typeof _=="function"?_:g)},he.cloneWith=function(f,_){return Ls(f,4,_=typeof _=="function"?_:g)},he.conformsTo=function(f,_){return _==null||tl(f,_,Mr(_))},he.deburr=_h,he.defaultTo=function(f,_){return f==null||f!=f?_:f},he.divide=V,he.endsWith=function(f,_,R){f=Di(f),_=oo(_);var U=f.length,ee=R=R===g?U:$a(Wn(R),0,U);return(R-=_.length)>=0&&f.slice(R,ee)==_},he.eq=ys,he.escape=function(f){return(f=Di(f))&&Ge.test(f)?f.replace(Ae,Yv):f},he.escapeRegExp=function(f){return(f=Di(f))&&ce.test(f)?f.replace(Ie,"\\$&"):f},he.every=function(f,_,R){var U=ar(f)?Xc:f_;return R&&Vs(f,_,R)&&(_=g),U(f,Zn(_,3))},he.find=ry,he.findIndex=b_,he.findKey=function(f,_){return cu(f,Zn(_,3),_s)},he.findLast=iy,he.findLastIndex=E_,he.findLastKey=function(f,_){return cu(f,Zn(_,3),fd)},he.floor=Y,he.forEach=Wm,he.forEachRight=Rp,he.forIn=function(f,_){return f==null?f:ch(f,Zn(_,3),co)},he.forInRight=function(f,_){return f==null?f:Dg(f,Zn(_,3),co)},he.forOwn=function(f,_){return f&&_s(f,Zn(_,3))},he.forOwnRight=function(f,_){return f&&fd(f,Zn(_,3))},he.get=Td,he.gt=kb,he.gte=mh,he.has=function(f,_){return f!=null&&ha(f,_,h_)},he.hasIn=Zo,he.head=Qv,he.identity=xo,he.includes=function(f,_,R,U){f=ii(f)?f:Su(f),R=R&&!U?Wn(R):0;var ee=f.length;return R<0&&(R=Hr(ee+R,0)),cs(f)?R<=ee&&f.indexOf(_,R)>-1:!!ee&&pf(f,_,R)>-1},he.indexOf=function(f,_,R){var U=f==null?0:f.length;if(!U)return-1;var ee=R==null?0:Wn(R);return ee<0&&(ee=Hr(U+ee,0)),pf(f,_,ee)},he.inRange=function(f,_,R){return _=Xn(_),R===g?(R=_,_=0):R=Xn(R),(function(U,ee,ue){return U>=Ti(ee,ue)&&U<Hr(ee,ue)})(f=eo(f),_,R)},he.invoke=ls,he.isArguments=tr,he.isArray=ar,he.isArrayBuffer=vc,he.isArrayLike=ii,he.isArrayLikeObject=as,he.isBoolean=function(f){return f===!0||f===!1||Pi(f)&&wi(f)==P},he.isBuffer=Fs,he.isDate=xd,he.isElement=function(f){return Pi(f)&&f.nodeType===1&&!di(f)},he.isEmpty=function(f){if(f==null)return!0;if(ii(f)&&(ar(f)||typeof f=="string"||typeof f.splice=="function"||Fs(f)||si(f)||tr(f)))return!f.length;var _=fa(f);if(_==j||_==J)return!f.size;if(Sp(f))return!up(f).length;for(var R in f)if(Yn.call(f,R))return!1;return!0},he.isEqual=function(f,_){return ei(f,_)},he.isEqualWith=function(f,_,R){var U=(R=typeof R=="function"?R:g)?R(f,_):g;return U===g?ei(f,_,g,R):!!U},he.isError=Ya,he.isFinite=function(f){return typeof f=="number"&&Ga(f)},he.isFunction=Zs,he.isInteger=Ia,he.isLength=bs,he.isMap=Js,he.isMatch=function(f,_){return f===_||qu(f,_,yd(_))},he.isMatchWith=function(f,_,R){return R=typeof R=="function"?R:g,qu(f,_,yd(_),R)},he.isNaN=function(f){return Fl(f)&&f!=+f},he.isNative=function(f){if(zg(f))throw new Cn("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return ko(f)},he.isNil=function(f){return f==null},he.isNull=function(f){return f===null},he.isNumber=Fl,he.isObject=_r,he.isObjectLike=Pi,he.isPlainObject=di,he.isRegExp=Qs,he.isSafeInteger=function(f){return Ia(f)&&f>=-9007199254740991&&f<=k},he.isSet=bu,he.isString=cs,he.isSymbol=Qi,he.isTypedArray=si,he.isUndefined=function(f){return f===g},he.isWeakMap=function(f){return Pi(f)&&fa(f)==ae},he.isWeakSet=function(f){return Pi(f)&&wi(f)=="[object WeakSet]"},he.join=function(f,_){return f==null?"":Ng.call(f,_)},he.kebabCase=Op,he.last=Xa,he.lastIndexOf=function(f,_,R){var U=f==null?0:f.length;if(!U)return-1;var ee=U;return R!==g&&(ee=(ee=Wn(R))<0?Hr(U+ee,0):Ti(ee,U-1)),_==_?(function(ue,de,be){for(var Ce=be+1;Ce--;)if(ue[Ce]===de)return Ce;return Ce})(f,_,ee):lu(f,_m,ee,!0)},he.lowerCase=ul,he.lowerFirst=fl,he.lt=ao,he.lte=zc,he.max=function(f){return f&&f.length?Tf(f,xo,hd):g},he.maxBy=function(f,_){return f&&f.length?Tf(f,Zn(_,2),hd):g},he.mean=function(f){return ad(f,xo)},he.meanBy=function(f,_){return ad(f,Zn(_,2))},he.min=function(f){return f&&f.length?Tf(f,xo,d_):g},he.minBy=function(f,_){return f&&f.length?Tf(f,Zn(_,2),d_):g},he.stubArray=Eh,he.stubFalse=L,he.stubObject=function(){return{}},he.stubString=function(){return""},he.stubTrue=function(){return!0},he.multiply=se,he.nth=function(f,_){return f&&f.length?dp(f,Wn(_)):g},he.noConflict=function(){return Gr._===this&&(Gr._=Ra),this},he.noop=ci,he.now=Sd,he.pad=function(f,_,R){f=Di(f);var U=(_=Wn(_))?Oi(f):0;if(!_||U>=_)return f;var ee=(_-U)/2;return uh(sh(ee),R)+f+uh(uc(ee),R)},he.padEnd=function(f,_,R){f=Di(f);var U=(_=Wn(_))?Oi(f):0;return _&&U<_?f+uh(_-U,R):f},he.padStart=function(f,_,R){f=Di(f);var U=(_=Wn(_))?Oi(f):0;return _&&U<_?uh(_-U,R)+f:f},he.parseInt=function(f,_,R){return R||_==null?_=0:_&&(_=+_),Rm(Di(f).replace(Q,""),_||0)},he.random=function(f,_,R){if(R&&typeof R!="boolean"&&Vs(f,_,R)&&(_=R=g),R===g&&(typeof _=="boolean"?(R=_,_=g):typeof f=="boolean"&&(R=f,f=g)),f===g&&_===g?(f=0,_=1):(f=Xn(f),_===g?(_=f,f=0):_=Xn(_)),f>_){var U=f;f=_,_=U}if(R||f%1||_%1){var ee=Cm();return Ti(f+ee*(_-f+io("1e-"+((ee+"").length-1))),_)}return Ol(f,_)},he.reduce=function(f,_,R){var U=ar(f)?kg:Du,ee=arguments.length<3;return U(f,Zn(_,4),R,ee,so)},he.reduceRight=function(f,_,R){var U=ar(f)?s_:Du,ee=arguments.length<3;return U(f,Zn(_,4),R,ee,Mm)},he.repeat=function(f,_,R){return _=(R?Vs(f,_,R):_===g)?1:Wn(_),Gu(Di(f),_)},he.replace=function(){var f=arguments,_=Di(f[0]);return f.length<3?_:_.replace(f[1],f[2])},he.result=function(f,_,R){var U=-1,ee=(_=Ma(_,f)).length;for(ee||(ee=1,f=g);++U<ee;){var ue=f==null?g:f[Ka(_[U])];ue===g&&(U=ee,ue=R),f=Zs(ue)?ue.call(f):ue}return f},he.round=me,he.runInContext=Ke,he.sample=function(f){return(ar(f)?oh:Br)(f)},he.size=function(f){if(f==null)return 0;if(ii(f))return cs(f)?Oi(f):f.length;var _=fa(f);return _==j||_==J?f.size:up(f).length},he.snakeCase=So,he.some=function(f,_,R){var U=ar(f)?Zc:Us;return R&&Vs(f,_,R)&&(_=g),U(f,Zn(_,3))},he.sortedIndex=function(f,_){return pd(f,_)},he.sortedIndexBy=function(f,_,R){return md(f,_,Zn(R,2))},he.sortedIndexOf=function(f,_){var R=f==null?0:f.length;if(R){var U=pd(f,_);if(U<R&&ys(f[U],_))return U}return-1},he.sortedLastIndex=function(f,_){return pd(f,_,!0)},he.sortedLastIndexBy=function(f,_,R){return md(f,_,Zn(R,2),!0)},he.sortedLastIndexOf=function(f,_){if(f!=null&&f.length){var R=pd(f,_,!0)-1;if(ys(f[R],_))return R}return-1},he.startCase=vh,he.startsWith=function(f,_,R){return f=Di(f),R=R==null?0:$a(Wn(R),0,f.length),_=oo(_),f.slice(R,R+_.length)==_},he.subtract=S,he.sum=function(f){return f&&f.length?mf(f,xo):0},he.sumBy=function(f,_){return f&&f.length?mf(f,Zn(_,2)):0},he.template=function(f,_,R){var U=he.templateSettings;R&&Vs(f,_,R)&&(_=g),f=Di(f),_=ll({},_,U,bo);var ee,ue,de=ll({},_.imports,U.imports,bo),be=Mr(de),Ce=rh(de,be),Oe=0,Fe=_.interpolate||ct,ot="__p += '",_t=yo((_.escape||ct).source+"|"+Fe.source+"|"+(Fe===tt?We:ct).source+"|"+(_.evaluate||ct).source+"|$","g"),Tt="//# sourceURL="+(Yn.call(_,"sourceURL")?(_.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++pr+"]")+`
`;f.replace(_t,(function(xt,mt,Et,kt,Bt,It){return Et||(Et=kt),ot+=f.slice(Oe,It).replace(Qt,cd),mt&&(ee=!0,ot+=`' +
__e(`+mt+`) +
'`),Bt&&(ue=!0,ot+=`';
`+Bt+`;
__p += '`),Et&&(ot+=`' +
((__t = (`+Et+`)) == null ? '' : __t) +
'`),Oe=It+xt.length,xt})),ot+=`';
`;var ht=Yn.call(_,"variable")&&_.variable;if(ht){if(Ye.test(ht))throw new Cn("Invalid `variable` option passed into `_.template`")}else ot=`with (obj) {
`+ot+`
}
`;ot=(ue?ot.replace(Ue,""):ot).replace(De,"$1").replace(fe,"$1;"),ot="function("+(ht||"obj")+`) {
`+(ht?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ee?", __e = _.escape":"")+(ue?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ot+`return __p
}`;var st=zl((function(){return $r(be,Tt+"return "+ot).apply(g,Ce)}));if(st.source=ot,Ya(st))throw st;return st},he.times=function(f,_){if((f=Wn(f))<1||f>k)return[];var R=I,U=Ti(f,I);_=Zn(_),f-=I;for(var ee=sp(U,_);++R<f;)_(R);return ee},he.toFinite=Xn,he.toInteger=Wn,he.toLength=An,he.toLower=function(f){return Di(f).toLowerCase()},he.toNumber=eo,he.toSafeInteger=function(f){return f?$a(Wn(f),-9007199254740991,k):f===0?f:0},he.toString=Di,he.toUpper=function(f){return Di(f).toUpperCase()},he.trim=function(f,_,R){if((f=Di(f))&&(R||_===g))return wa(f);if(!f||!(_=oo(_)))return f;var U=Cs(f),ee=Cs(_);return gu(U,Ho(U,ee),o_(U,ee)+1).join("")},he.trimEnd=function(f,_,R){if((f=Di(f))&&(R||_===g))return f.slice(0,bm(f)+1);if(!f||!(_=oo(_)))return f;var U=Cs(f);return gu(U,0,o_(U,Cs(_))+1).join("")},he.trimStart=function(f,_,R){if((f=Di(f))&&(R||_===g))return f.replace(Q,"");if(!f||!(_=oo(_)))return f;var U=Cs(f);return gu(U,Ho(U,Cs(_))).join("")},he.truncate=function(f,_){var R=30,U="...";if(_r(_)){var ee="separator"in _?_.separator:ee;R="length"in _?Wn(_.length):R,U="omission"in _?oo(_.omission):U}var ue=(f=Di(f)).length;if(gf(f)){var de=Cs(f);ue=de.length}if(R>=ue)return f;var be=R-Oi(U);if(be<1)return U;var Ce=de?gu(de,0,be).join(""):f.slice(0,be);if(ee===g)return Ce+U;if(de&&(be+=Ce.length-be),Qs(ee)){if(f.slice(be).search(ee)){var Oe,Fe=Ce;for(ee.global||(ee=yo(ee.source,Di(Ve.exec(ee))+"g")),ee.lastIndex=0;Oe=ee.exec(Fe);)var ot=Oe.index;Ce=Ce.slice(0,ot===g?be:ot)}}else if(f.indexOf(oo(ee),be)!=be){var _t=Ce.lastIndexOf(ee);_t>-1&&(Ce=Ce.slice(0,_t))}return Ce+U},he.unescape=function(f){return(f=Di(f))&&pe.test(f)?f.replace(ve,Em):f},he.uniqueId=function(f){var _=++vr;return Di(f)+_},he.upperCase=qr,he.upperFirst=kr,he.each=Wm,he.eachRight=Rp,he.first=Qv,xu(he,(w={},_s(he,(function(f,_){Yn.call(he.prototype,_)||(w[_]=f)})),w),{chain:!1}),he.VERSION="4.17.21",kc(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(f){he[f].placeholder=he})),kc(["drop","take"],(function(f,_){vn.prototype[f]=function(R){R=R===g?1:Hr(Wn(R),0);var U=this.__filtered__&&!_?new vn(this):this.clone();return U.__filtered__?U.__takeCount__=Ti(R,U.__takeCount__):U.__views__.push({size:Ti(R,I),type:f+(U.__dir__<0?"Right":"")}),U},vn.prototype[f+"Right"]=function(R){return this.reverse()[f](R).reverse()}})),kc(["filter","map","takeWhile"],(function(f,_){var R=_+1,U=R==1||R==3;vn.prototype[f]=function(ee){var ue=this.clone();return ue.__iteratees__.push({iteratee:Zn(ee,3),type:R}),ue.__filtered__=ue.__filtered__||U,ue}})),kc(["head","last"],(function(f,_){var R="take"+(_?"Right":"");vn.prototype[f]=function(){return this[R](1).value()[0]}})),kc(["initial","tail"],(function(f,_){var R="drop"+(_?"":"Right");vn.prototype[f]=function(){return this.__filtered__?new vn(this):this[R](1)}})),vn.prototype.compact=function(){return this.filter(xo)},vn.prototype.find=function(f){return this.filter(f).head()},vn.prototype.findLast=function(f){return this.reverse().find(f)},vn.prototype.invokeMap=fr((function(f,_){return typeof f=="function"?new vn(this):this.map((function(R){return mc(R,f,_)}))})),vn.prototype.reject=function(f){return this.filter(Yo(Zn(f)))},vn.prototype.slice=function(f,_){f=Wn(f);var R=this;return R.__filtered__&&(f>0||_<0)?new vn(R):(f<0?R=R.takeRight(-f):f&&(R=R.drop(f)),_!==g&&(R=(_=Wn(_))<0?R.dropRight(-_):R.take(_-f)),R)},vn.prototype.takeRightWhile=function(f){return this.reverse().takeWhile(f).reverse()},vn.prototype.toArray=function(){return this.take(I)},_s(vn.prototype,(function(f,_){var R=/^(?:filter|find|map|reject)|While$/.test(_),U=/^(?:head|last)$/.test(_),ee=he[U?"take"+(_=="last"?"Right":""):_],ue=U||/^find/.test(_);ee&&(he.prototype[_]=function(){var de=this.__wrapped__,be=U?[1]:arguments,Ce=de instanceof vn,Oe=be[0],Fe=Ce||ar(de),ot=function(mt){var Et=ee.apply(he,au([mt],be));return U&&_t?Et[0]:Et};Fe&&R&&typeof Oe=="function"&&Oe.length!=1&&(Ce=Fe=!1);var _t=this.__chain__,Tt=!!this.__actions__.length,ht=ue&&!_t,st=Ce&&!Tt;if(!ue&&Fe){de=st?de:new vn(this);var xt=f.apply(de,be);return xt.__actions__.push({func:wp,args:[ot],thisArg:g}),new Ji(xt,_t)}return ht&&st?f.apply(this,be):(xt=this.thru(ot),ht?U?xt.value()[0]:xt.value():xt)})})),kc(["pop","push","shift","sort","splice","unshift"],(function(f){var _=hu[f],R=/^(?:push|sort|unshift)$/.test(f)?"tap":"thru",U=/^(?:pop|shift)$/.test(f);he.prototype[f]=function(){var ee=arguments;if(U&&!this.__chain__){var ue=this.value();return _.apply(ar(ue)?ue:[],ee)}return this[R]((function(de){return _.apply(ar(de)?de:[],ee)}))}})),_s(vn.prototype,(function(f,_){var R=he[_];if(R){var U=R.name+"";Yn.call(Hi,U)||(Hi[U]=[]),Hi[U].push({name:_,func:R})}})),Hi[Cf(g,2).name]=[{name:"wrapper",func:g}],vn.prototype.clone=function(){var f=new vn(this.__wrapped__);return f.__actions__=Wa(this.__actions__),f.__dir__=this.__dir__,f.__filtered__=this.__filtered__,f.__iteratees__=Wa(this.__iteratees__),f.__takeCount__=this.__takeCount__,f.__views__=Wa(this.__views__),f},vn.prototype.reverse=function(){if(this.__filtered__){var f=new vn(this);f.__dir__=-1,f.__filtered__=!0}else(f=this.clone()).__dir__*=-1;return f},vn.prototype.value=function(){var f=this.__wrapped__.value(),_=this.__dir__,R=ar(f),U=_<0,ee=R?f.length:0,ue=(function(It,Nt,Zt){for(var hn=-1,In=Zt.length;++hn<In;){var On=Zt[hn],bn=On.size;switch(On.type){case"drop":It+=bn;break;case"dropRight":Nt-=bn;break;case"take":Nt=Ti(Nt,It+bn);break;case"takeRight":It=Hr(It,Nt-bn)}}return{start:It,end:Nt}})(0,ee,this.__views__),de=ue.start,be=ue.end,Ce=be-de,Oe=U?be:de-1,Fe=this.__iteratees__,ot=Fe.length,_t=0,Tt=Ti(Ce,this.__takeCount__);if(!R||!U&&ee==Ce&&Tt==Ce)return Oo(f,this.__actions__);var ht=[];e:for(;Ce--&&_t<Tt;){for(var st=-1,xt=f[Oe+=_];++st<ot;){var mt=Fe[st],Et=mt.iteratee,kt=mt.type,Bt=Et(xt);if(kt==2)xt=Bt;else if(!Bt){if(kt==1)continue e;break e}}ht[_t++]=xt}return ht},he.prototype.at=ty,he.prototype.chain=function(){return Tp(this)},he.prototype.commit=function(){return new Ji(this.value(),this.__chain__)},he.prototype.next=function(){this.__values__===g&&(this.__values__=yc(this.value()));var f=this.__index__>=this.__values__.length;return{done:f,value:f?g:this.__values__[this.__index__++]}},he.prototype.plant=function(f){for(var _,R=this;R instanceof Ml;){var U=qm(R);U.__index__=0,U.__values__=g,_?ee.__wrapped__=U:_=U;var ee=U;R=R.__wrapped__}return ee.__wrapped__=f,_},he.prototype.reverse=function(){var f=this.__wrapped__;if(f instanceof vn){var _=f;return this.__actions__.length&&(_=new vn(this)),(_=_.reverse()).__actions__.push({func:wp,args:[T_],thisArg:g}),new Ji(_,this.__chain__)}return this.thru(T_)},he.prototype.toJSON=he.prototype.valueOf=he.prototype.value=function(){return Oo(this.__wrapped__,this.__actions__)},he.prototype.first=he.prototype.head,Jc&&(he.prototype[Jc]=function(){return this}),he})();Gr._=vf,(p=(function(){return vf}).call(d,m,d,h))===g||(h.exports=p)}).call(this)},815:function(h,d){var m,p,g=this&&this.__extends||(m=function(G,j){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,te){q.__proto__=te}||function(q,te){for(var W in te)Object.prototype.hasOwnProperty.call(te,W)&&(q[W]=te[W])},m(G,j)},function(G,j){if(typeof j!="function"&&j!==null)throw new TypeError("Class extends value "+String(j)+" is not a constructor or null");function q(){this.constructor=G}m(G,j),G.prototype=j===null?Object.create(j):(q.prototype=j.prototype,new q)});function y(G){return 60*G*60}function v(G,j){var q={};return Object.assign(q,G),j&&Object.assign(q,j),q}Object.defineProperty(d,"__esModule",{value:!0}),d.DeviceConfigPropertyHolder=d.DeviceConfigManager=d.DeviceConfigEnv=void 0,(function(G){G.BETA="beta",G.PROD="prod",G.CUSTOM="custom"})(p||(d.DeviceConfigEnv=p={}));var x=(function(G){function j(q){return G.call(this,q)||this}return g(j,G),j})(Error),E="data",C=y(2),A="base64",k=(function(){function G(j,q){var te,W,$,J,ne,ie,ae,xe;if(!q.fileKey)throw new Error("options.fileKey cannot be empty");var Ne=(te=q.clock)!==null&&te!==void 0?te:new F,Re=Ne.getMillis();switch(this.context=j,this.fileKey=q.fileKey,this.env=q.standardEnv,q.standardEnv){case p.BETA:this.fetchServer="beta.ivs-device-config-beta.live-video.net";break;case p.PROD:this.fetchServer="prod.ivs-device-config.live-video.net";break;case p.CUSTOM:if(!q.customServer)throw new Error("Custom env requires options.customServer");this.fetchServer=q.customServer;break;default:throw new Error("Invalid value for standardEnv: ".concat(q.standardEnv))}this.trace=(W=q.trace)!==null&&W!==void 0?W:new H(q.enableConsoleLog),this.fetch=($=q.fetch)!==null&&$!==void 0?$:new z(j),this.storage=new P("amazon_ivs_device_config_v1_"+q.fileKey,j.localStorage),this.state=new X(this.storage,"state"),this.refresh={refreshIntervalSeconds:(J=q.refresh.refreshIntervalSeconds)!==null&&J!==void 0?J:900,retryCount:(ne=q.refresh.retryCount)!==null&&ne!==void 0?ne:3,retryIntervalSeconds:(ie=q.refresh.retryIntervalSeconds)!==null&&ie!==void 0?ie:10,maxCacheAgeSeconds:(ae=q.refresh.maxCacheAgeSeconds)!==null&&ae!==void 0?ae:259200,stopRefreshAfterSeconds:(xe=q.refresh.stopRefreshAfterSeconds)!==null&&xe!==void 0?xe:C,canRefreshNow:q.refresh.canRefreshNow},this.emitMetrics=q.emitMetrics,this.analyticsProperties=q.analyticsProperties,this.enableConsoleLog=q.enableConsoleLog,this.clock=Ne,this.isInitialRefreshDone=!1;var Se=0,ze=this.state.getState();ze&&ze.fetchServer===this.fetchServer&&ze.lastFetchWhenMs&&(Se=ze.lastFetchWhenMs);var Be,Je=Ne.getMillis(),at=(Je-Se)/1e3;if(at<=this.refresh.maxCacheAgeSeconds){var re=this.storage.getJson(E);re&&re.fetchServer===this.fetchServer&&this.setData(re.json)}this.lastUseMs=Je,at>=this.refresh.refreshIntervalSeconds||Se==0?Be=0:(Be=Math.round(this.refresh.refreshIntervalSeconds-at),this.isInitialRefreshDone=!0),Be<5&&(Be=5),this.trace.onTrace("Will start refresh in "+Be+" seconds"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*Be);var Le=Ne.getMillis();this.initialLoadTime=Le-Re}return G.getInstance=function(j,q){try{if(!(j.fetch&&j.setTimeout&&j.clearTimeout&&j.localStorage))return void console.log("Context needs to provide fetch, setTimeout, clearTimeout, localStorage")}catch(te){return void console.error("Error checking for context properties "+te)}if(this.gInstance){if(this.gInstance.fileKey!=q.fileKey)throw new Error("Existing instance has file key ".concat(this.gInstance.fileKey,", now asking for ").concat(q.fileKey));return this.gInstance}return this.gInstance=new G(j,q),this.gInstance},G.prototype.getConfigurationHolder=function(j){var q,te=this.clock.getMillis();this.lastUseMs=te;var W=(q=j.analytics)!==null&&q!==void 0?q:new K(this.enableConsoleLog),$=0,J=this.state.getState();return J&&J.fetchServer===this.fetchServer&&J.lastFetchWhenMs&&($=J.lastFetchWhenMs),(te-$)/1e3<=this.refresh.maxCacheAgeSeconds?new M(W,this.analyticsProperties,this.properties,$,this.clock):new M(W,void 0,void 0,0,this.clock)},G.prototype.getFetchUrl=function(){var j="https://".concat(this.fetchServer,"/").concat(this.fileKey,".json"),q=new URL(j);return q.searchParams.set("version","1.0"),q},G.clearInstance=function(){var j;(j=this.gInstance)===null||j===void 0||j.clearInstanceImpl(),this.gInstance=void 0},G.prototype.clearInstanceImpl=function(){this.context.clearTimeout(this.fetchTask),this.fetchTask=void 0,this.context.clearTimeout(this.retryTask),this.retryTask=void 0},G.prototype.startRefresh=function(){var j=this;this.trace.onTrace("Starting refresh request"),this.fetchTask=void 0,this.retryTask&&(this.context.clearTimeout(this.retryTask),this.retryTask=void 0),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds);var q=this.clock.getMillis();if((q-this.lastUseMs)/1e3>this.refresh.stopRefreshAfterSeconds)this.trace.onTrace("Will not refresh due to refresh timeout");else if(!this.isInitialRefreshDone||this.refresh.canRefreshNow()){this.isInitialRefreshDone=!0;var te={};this.fetchData().then((function(W){j.processResponse(W,te,q),j.emitMetricsImpl(te)})).catch((function(W){j.exceptionMetrics(te,W),j.emitMetricsImpl(te),j.trace.onTrace("Fetch error: "+W),j.refresh.retryCount>0&&j.scheduleRetry(1)}))}else this.trace.onTrace("Will not refresh due to callback having returned false")},G.prototype.fetchData=function(){var j=this.getFetchUrl(),q=new Headers,te=this.state.getState();return te.fetchServer===this.fetchServer&&(te.lastFetchWhenFullMs&&this.clock.getMillis()-te.lastFetchWhenFullMs>1e3*y(24)?this.trace.onTrace("Forcing full refresh"):this.properties&&te.lastFetchEtagHeader&&q.set("If-None-Match",te.lastFetchEtagHeader)),this.fetch.fetchUrl(j,q)},G.prototype.processResponse=function(j,q,te){var W={fetchServer:this.fetchServer,lastFetchWhenMs:this.clock.getMillis()},$=j.headers.get("etag");if($&&(W.lastFetchEtagHeader=$),j.status<300&&j.json)if(this.setData(j.json)){this.trace.onTrace("Successfully parsed fetched data"),this.storage.setJson(E,{fetchServer:this.fetchServer,json:j.json});var J=this.clock.getMillis();W.lastFetchWhenFullMs=J,this.state.setState(W),q.success_new_data_count=1,q.fetch_duration_average=Math.max(0,J-te)}else q.fail_invalid_data_count=1;else{if(j.status!==304){var ne="Unexpected http fetch status: "+j.status;throw this.trace.onTrace(ne),new x(ne)}this.trace.onTrace("Server said no change in data"),J=this.clock.getMillis(),W.lastFetchWhenMs=J,this.state.setState(W),q.success_no_change_count=1,q.fetch_duration_average=Math.max(0,J-te)}},G.prototype.scheduleRetry=function(j){var q=this;this.retryTask&&this.context.clearTimeout(this.retryTask);var te=j*this.refresh.retryIntervalSeconds;this.retryTask=this.context.setTimeout((function(){q.retryTask=void 0,q.fetchRetry(j)}),1e3*te)},G.prototype.fetchRetry=function(j){var q=this;this.trace.onTrace("Starting retry request ".concat(j,"..."));var te={},W=this.clock.getMillis();this.fetchData().then((function($){q.processResponse($,te,W),q.emitMetricsImpl(te)})).catch((function($){q.exceptionMetrics(te,$),q.emitMetricsImpl(te),q.trace.onTrace("Fetch error: "+$),q.refresh.retryCount>j&&q.scheduleRetry(j+1)}))},G.prototype.setData=function(j){if(!j)return!1;if(j.version!=="1.0")return this.trace.onTrace("Data version is not 1.0, not applying"),!1;var q=j.properties;if(!q||!Array.isArray(q))return this.trace.onTrace("Data properties is not an array, not applying"),!1;for(var te=new Map,W=0,$=q;W<$.length;W++){var J=$[W];if(J.name&&J.type&&this.isValidValueType(J.type)){if(J.value_string&&typeof J.value_string!="string"){this.trace.onTrace("Invalid type of value.value_string "+typeof J.value_string);continue}if(J.value_number&&typeof J.value_number!="number"){this.trace.onTrace("Invalid type of value.value_number "+typeof J.value_number);continue}if(J.value_boolean&&typeof J.value_boolean!="boolean"){this.trace.onTrace("Invalid type of value.value_boolean "+typeof J.value_boolean);continue}if(J.value_json&&typeof J.value_json!="string"){this.trace.onTrace("Invalid type of value.value_json "+typeof J.value_json);continue}if(J.value_analytics&&typeof J.value_analytics!="string"){this.trace.onTrace("Invalid type of item.value_analytics "+typeof J.value_analytics);continue}var ne=new N(J.name,this.parseValueType(J.type),J.value_string,J.value_number,J.value_boolean,J.value_json,J.value_analytics,J.encoding);te.set(ne.name,ne)}}return te.size!=0&&(this.properties=te,!0)},G.prototype.isValidValueType=function(j){return j==="string"||j==="number"||j==="boolean"||j=="json"},G.prototype.parseValueType=function(j){switch(j){case"string":return I.STRING;case"number":return I.NUMBER;case"boolean":return I.BOOLEAN;case"json":return I.JSON;default:throw new Error("Unsupported value type ".concat(j))}},G.prototype.emitMetricsImpl=function(j){var q,te,W,$,J,ne,ie={initial_load_time:this.initialLoadTime,fetch_attempt_count:1,fetch_duration_average:(q=j.fetch_duration_average)!==null&&q!==void 0?q:0,success_no_change_count:(te=j.success_no_change_count)!==null&&te!==void 0?te:0,success_new_data_count:(W=j.success_new_data_count)!==null&&W!==void 0?W:0,fail_exception_count:($=j.fail_exception_count)!==null&&$!==void 0?$:0,fail_http_error_count:(J=j.fail_http_error_count)!==null&&J!==void 0?J:0,fail_invalid_data_count:(ne=j.fail_invalid_data_count)!==null&&ne!==void 0?ne:0};this.emitMetrics(v(ie,this.analyticsProperties))},G.prototype.exceptionMetrics=function(j,q){var te;q instanceof x||!((te=q?.message)===null||te===void 0)&&te.startsWith("http error")?j.fail_http_error_count=1:j.fail_exception_count=1},G})();d.DeviceConfigManager=k;var M=(function(){function G(j,q,te,W,$){this.analytics=j,this.analyticsProperties=q,this.properties=te,this.dataFetchedWhenMs=W,this.clock=$}return G.prototype.getSize=function(){return this.properties?this.properties.size:-1},G.prototype.getStringValue=function(j){var q,te;if(this.properties){var W=this.properties.get(j);if(W){if(W.type===I.STRING){var $=(q=W.valueString)!==null&&q!==void 0?q:"";return this.analytics.onValue(v({key_name:W.name,value:(te=W.valueAnalytics)!==null&&te!==void 0?te:$,fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),$}this.analytics.onError(v({key_name:W.name,message:"Type is not string"},this.analyticsProperties))}}else this.analytics.onTrace(v({key_name:j,message:"Configuration is not available"},this.analyticsProperties))},G.prototype.getNumberValue=function(j){var q,te;if(this.properties){var W=this.properties.get(j);if(W){if(W.type===I.NUMBER){var $=(q=W.valueNumber)!==null&&q!==void 0?q:0;return this.analytics.onValue(v({key_name:W.name,value:(te=W.valueAnalytics)!==null&&te!==void 0?te:$.toString(),fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),$}this.analytics.onError(v({key_name:W.name,message:"Type is not number"},this.analyticsProperties))}}else this.analytics.onTrace(v({key_name:j,message:"Configuration is not available"},this.analyticsProperties))},G.prototype.getBooleanValue=function(j){var q,te;if(this.properties){var W=this.properties.get(j);if(W){if(W.type===I.BOOLEAN){var $=(q=W.valueBoolean)!==null&&q!==void 0&&q;return this.analytics.onValue(v({key_name:W.name,value:(te=W.valueAnalytics)!==null&&te!==void 0?te:$.toString(),fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),$}this.analytics.onError(v({key_name:W.name,message:"Type is not number"},this.analyticsProperties))}}else this.analytics.onTrace(v({key_name:j,message:"Configuration is not available"},this.analyticsProperties))},G.prototype.getJsonValue=function(j){var q,te;if(this.properties){var W=this.properties.get(j);if(W){if(W.type===I.JSON){var $=W.valueJson;if(!$)return this.analytics.onValue(v({key_name:W.name,value:(q=W.valueAnalytics)!==null&&q!==void 0?q:"",fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),null;try{var J=JSON.parse($);return this.analytics.onValue(v({key_name:W.name,value:(te=W.valueAnalytics)!==null&&te!==void 0?te:J,fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),J}catch{return void this.analytics.onError(v({key_name:W.name,message:"JSON parse error"},this.analyticsProperties))}}this.analytics.onError(v({key_name:W.name,message:"Type is not JSON"},this.analyticsProperties))}}else this.analytics.onTrace(v({key_name:j,message:"Configuration is not available"},this.analyticsProperties))},G.prototype.getFetchedSecondsAgo=function(){if(this.dataFetchedWhenMs)return(this.clock.getMillis()-this.dataFetchedWhenMs)/1e3},G})();d.DeviceConfigPropertyHolder=M;var I,z=(function(){function G(j){this.context=j}return G.prototype.fetchUrl=function(j,q){var te=this,W={headers:q,cache:"no-store"},$=null;if(typeof AbortController<"u"){var J=new AbortController;$=this.context.setTimeout((function(){return J.abort()}),15e3),W.signal=J.signal}return new Promise((function(ne,ie){te.context.fetch(j,W).then((function(ae){if(ae.status>=400)ie(new x("http error ".concat(ae.status,", ").concat(ae.statusText)));else{var xe={status:ae.status,headers:ae.headers};ae.json().then((function(Ne){xe.json=Ne,ne(xe)})).catch((function(){ne(xe)}))}})).catch((function(ae){ie(ae)})).finally((function(){$&&te.context.clearTimeout($)}))}))},G})(),H=(function(){function G(j){this.enableConsoleLog=j}return G.prototype.onTrace=function(j){this.enableConsoleLog&&console.log("DeviceConfig trace: "+j)},G})(),K=(function(){function G(j){this.enableConsoleLog=j}return G.prototype.onValue=function(j){this.enableConsoleLog&&console.log("DeviceConfig analytics value:  ".concat(j))},G.prototype.onError=function(j){this.enableConsoleLog&&console.error("DeviceConfig analytics error: ".concat(j))},G.prototype.onTrace=function(j){this.enableConsoleLog&&console.log("DeviceConfig analytics trace: ".concat(j))},G})(),P=(function(){function G(j,q){this.prefix=j,this.storage=q}return G.prototype.getJson=function(j){var q=this.prefix+"_"+j;try{var te=this.storage.getItem(q);if(te)return JSON.parse(te)}catch(W){console.error("Error getting local storage key ".concat(q)+W)}return null},G.prototype.setJson=function(j,q){var te=this.prefix+"_"+j;try{this.storage.setItem(te,JSON.stringify(q))}catch(W){console.error("Error setting local storage key ".concat(te,": ")+W)}},G})(),F=(function(){function G(){}return G.prototype.getMillis=function(){return Date.now()},G})();(function(G){G[G.STRING=0]="STRING",G[G.NUMBER=1]="NUMBER",G[G.BOOLEAN=2]="BOOLEAN",G[G.JSON=3]="JSON"})(I||(I={}));var N=function(G,j,q,te,W,$,J,ne){switch(this.name=G,this.type=j,this.valueString=q,this.valueNumber=te,this.valueBoolean=W,this.valueJson=$,this.valueAnalytics=J,this.type){case I.STRING:ne===A&&q&&(this.valueString=atob(q));break;case I.JSON:ne===A&&$&&(this.valueJson=atob($))}},X=(function(){function G(j,q){var te;this.storage=j,this.key=q,this.state=(te=j.getJson(q))!==null&&te!==void 0?te:{}}return G.prototype.getState=function(){return this.state},G.prototype.setState=function(j){Object.assign(this.state,j),this.storage.setJson(this.key,this.state)},G})()},456:function(h,d,m){var p=this&&this.__createBinding||(Object.create?function(y,v,x,E){E===void 0&&(E=x);var C=Object.getOwnPropertyDescriptor(v,x);C&&!("get"in C?!v.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return v[x]}}),Object.defineProperty(y,E,C)}:function(y,v,x,E){E===void 0&&(E=x),y[E]=v[x]}),g=this&&this.__exportStar||function(y,v){for(var x in y)x==="default"||Object.prototype.hasOwnProperty.call(v,x)||p(v,y,x)};Object.defineProperty(d,"__esModule",{value:!0}),g(m(903),d)},903:function(h,d,m){var p=this&&this.__spreadArray||function(v,x,E){if(E||arguments.length===2)for(var C,A=0,k=x.length;A<k;A++)!C&&A in x||(C||(C=Array.prototype.slice.call(x,0,A)),C[A]=x[A]);return v.concat(C||Array.prototype.slice.call(x))};Object.defineProperty(d,"__esModule",{value:!0}),d.TypedEmitter=void 0;var g=m(228),y=(function(){function v(x){var E=x.propagateErrors;this.emitter=new g.EventEmitter,this.propagateErrors=E!=null&&E}return v.prototype.on=function(x,E){E.call=this.wrapCall(x,E),this.emitter.on(x,E)},v.prototype.off=function(x,E){this.emitter.off(x,E)},v.prototype.emit=function(x){for(var E,C=[],A=1;A<arguments.length;A++)C[A-1]=arguments[A];(E=this.emitter).emit.apply(E,p([x],C,!1))},v.prototype.removeAllListeners=function(){this.emitter.removeAllListeners()},v.prototype.wrapCall=function(x,E){var C=this;return function(A){for(var k=[],M=1;M<arguments.length;M++)k[M-1]=arguments[M];if(C.propagateErrors)E.apply(A,k);else try{E.apply(A,k)}catch(H){var I="Error in callback for ".concat(x),z=E.name;return z&&(I+=" for function ".concat(z)),void console.error(I,H)}}},v})();d.TypedEmitter=y},987:function(h,d,m){var p,g=this&&this.__extends||(p=function(k,M){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,z){I.__proto__=z}||function(I,z){for(var H in z)Object.prototype.hasOwnProperty.call(z,H)&&(I[H]=z[H])},p(k,M)},function(k,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function I(){this.constructor=k}p(k,M),k.prototype=M===null?Object.create(M):(I.prototype=M.prototype,new I)}),y=this&&this.__createBinding||(Object.create?function(k,M,I,z){z===void 0&&(z=I);var H=Object.getOwnPropertyDescriptor(M,I);H&&!("get"in H?!M.__esModule:H.writable||H.configurable)||(H={enumerable:!0,get:function(){return M[I]}}),Object.defineProperty(k,z,H)}:function(k,M,I,z){z===void 0&&(z=I),k[z]=M[I]}),v=this&&this.__setModuleDefault||(Object.create?function(k,M){Object.defineProperty(k,"default",{enumerable:!0,value:M})}:function(k,M){k.default=M}),x=this&&this.__importStar||function(k){if(k&&k.__esModule)return k;var M={};if(k!=null)for(var I in k)I!=="default"&&Object.prototype.hasOwnProperty.call(k,I)&&y(M,k,I);return v(M,k),M};Object.defineProperty(d,"__esModule",{value:!0}),d.createFsm=d.FsmWildcardState=d.RejectedTransitionError=d.InvalidStateTransitionError=void 0;var E=x(m(293)),C=(function(k){function M(I,z){var H=k.call(this,"Invalid transition from '".concat(z,"' via event '").concat(I,"'"))||this;return H.name="InvalidStateTransitionError",H}return g(M,k),M})(Error);d.InvalidStateTransitionError=C;var A=(function(k){function M(I,z,H){var K=k.call(this,"Transition from '".concat(z,"' via event '").concat(I,"' was rejected for: ").concat(H))||this;return K.name="RejectedTransitionError",K}return g(M,k),M})(Error);d.RejectedTransitionError=A,d.FsmWildcardState="*",d.createFsm=function(k){var M,I=k.transitions,z=k.callbacks,H=k.initialState,K=function(P){var F,N=(F=I[P])===null||F===void 0?void 0:F.from;return!!N&&(typeof N=="string"?N===d.FsmWildcardState:N.includes(H))};return{canTransition:K,transition:function(P,F){var N,X,G,j,q,te;if(!K(P))return E.err(new C(String(H),String(P)));var W=I[P];return W.shouldTransition===void 0||W.shouldTransition(H)?((X=(N=z?.[H])===null||N===void 0?void 0:N.onExiting)===null||X===void 0||X.call(N),(G=z?.onStateExiting)===null||G===void 0||G.call(z,H),M=H,H=W.to,(q=(j=z?.[H])===null||j===void 0?void 0:j.onChanged)===null||q===void 0||q.call(j,M,F),(te=z?.onStateChanged)===null||te===void 0||te.call(z,M,H,F),E.ok(H)):E.err(new A(String(H),String(P),"shouldTransition returned false"))},previousState:function(){return M},currentState:function(){return H}}}},156:function(h,d,m){var p=this&&this.__createBinding||(Object.create?function(y,v,x,E){E===void 0&&(E=x);var C=Object.getOwnPropertyDescriptor(v,x);C&&!("get"in C?!v.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return v[x]}}),Object.defineProperty(y,E,C)}:function(y,v,x,E){E===void 0&&(E=x),y[E]=v[x]}),g=this&&this.__exportStar||function(y,v){for(var x in y)x==="default"||Object.prototype.hasOwnProperty.call(v,x)||p(v,y,x)};Object.defineProperty(d,"__esModule",{value:!0}),d.VERSION=void 0,d.VERSION="0.5.0",g(m(815),d),g(m(456),d),g(m(987),d),g(m(293),d),g(m(925),d)},925:function(h,d,m){var p=this&&this.__createBinding||(Object.create?function(y,v,x,E){E===void 0&&(E=x);var C=Object.getOwnPropertyDescriptor(v,x);C&&!("get"in C?!v.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return v[x]}}),Object.defineProperty(y,E,C)}:function(y,v,x,E){E===void 0&&(E=x),y[E]=v[x]}),g=this&&this.__exportStar||function(y,v){for(var x in y)x==="default"||Object.prototype.hasOwnProperty.call(v,x)||p(v,y,x)};Object.defineProperty(d,"__esModule",{value:!0}),g(m(166),d),g(m(612),d),g(m(56),d),g(m(139),d),g(m(877),d)},166:function(h,d,m){var p=this&&this.__assign||function(){return p=Object.assign||function(k){for(var M,I=1,z=arguments.length;I<z;I++)for(var H in M=arguments[I])Object.prototype.hasOwnProperty.call(M,H)&&(k[H]=M[H]);return k},p.apply(this,arguments)},g=this&&this.__spreadArray||function(k,M,I){if(I||arguments.length===2)for(var z,H=0,K=M.length;H<K;H++)!z&&H in M||(z||(z=Array.prototype.slice.call(M,0,H)),z[H]=M[H]);return k.concat(z||Array.prototype.slice.call(M))};Object.defineProperty(d,"__esModule",{value:!0}),d.getLogConfig=d.setLogConfig=d.setLogConfigByLevel=d.extractLogConfig=void 0;var y=m(612),v=m(56),x=m(139),E=m(478),C={enabled:!1,levels:{debug:!0,log:!0,info:!0,warn:!0,error:!0},targets:[(0,v.createConsoleLogTarget)()],categories:{}},A=Object.keys(C);d.extractLogConfig=function(k){var M={};if(Object.keys(k).some((function(P){return A.includes(P)}))){for(var I=0,z=A;I<z.length;I++){var H=z[I];if(k[H]!==void 0){var K=k[H];M[H]=K}}return M}},d.setLogConfigByLevel=function(k){var M=k.enabled||C.enabled,I=k.targets||C.targets,z={debug:!1,log:!1,info:!1,warn:!1,error:!1},H=function(K,P){for(var F=0,N=K;F<N.length;F++){var X=N[F];z[X]=P}};switch(k.level){case"debug":H(["debug","log","info","warn","error"],M);break;case"log":H(["log","info","warn","error"],M);break;case"info":H(["info","warn","error"],!0);break;case"warn":H(["warn","error"],!0);break;case"error":H(["error"],!0)}(0,d.setLogConfig)({enabled:M,levels:z,targets:I})},d.setLogConfig=function(k){var M=(0,E.mergeConfigs)(C,k);M&&(C=M,y.defaultLogEmitter.emit(x.LogEventType.CONFIG_UPDATED,C))},d.getLogConfig=function(){return{enabled:C.enabled,levels:p({},C.levels),targets:g([],C.targets,!0),categories:p({},C.categories)}}},612:(h,d,m)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.defaultLogEmitter=void 0;var p=m(456);d.defaultLogEmitter=new p.TypedEmitter({})},56:function(h,d,m){var p=this&&this.__spreadArray||function(y,v,x){if(x||arguments.length===2)for(var E,C=0,A=v.length;C<A;C++)!E&&C in v||(E||(E=Array.prototype.slice.call(v,0,C)),E[C]=v[C]);return y.concat(E||Array.prototype.slice.call(v))};Object.defineProperty(d,"__esModule",{value:!0}),d.createEventLogTarget=d.createConsoleLogTarget=void 0;var g=m(139);d.createConsoleLogTarget=function(){return{handleMessage:function(y){for(var v=[],x=1;x<arguments.length;x++)v[x-1]=arguments[x];console[y].apply(console,v)}}},d.createEventLogTarget=function(y){return{handleMessage:function(v){for(var x=[],E=1;E<arguments.length;E++)x[E-1]=arguments[E];y.emit.apply(y,p([g.LogEventType.MESSAGE_LOGGED,v],x,!1))}}}},139:(h,d)=>{var m;Object.defineProperty(d,"__esModule",{value:!0}),d.LogEventType=void 0,(function(p){p.CONFIG_UPDATED="logConfigUpdated",p.MESSAGE_LOGGED="messageLogged"})(m||(d.LogEventType=m={}))},877:function(h,d,m){var p=this&&this.__assign||function(){return p=Object.assign||function(A){for(var k,M=1,I=arguments.length;M<I;M++)for(var z in k=arguments[M])Object.prototype.hasOwnProperty.call(k,z)&&(A[z]=k[z]);return A},p.apply(this,arguments)},g=this&&this.__spreadArray||function(A,k,M){if(M||arguments.length===2)for(var I,z=0,H=k.length;z<H;z++)!I&&z in k||(I||(I=Array.prototype.slice.call(k,0,z)),I[z]=k[z]);return A.concat(I||Array.prototype.slice.call(k))};Object.defineProperty(d,"__esModule",{value:!0}),d.createLogger=void 0;var y=m(478),v=m(166),x=m(612),E=m(139),C=function(A,k){return(0,y.mergeConfigs)(A,k)||A};d.createLogger=function(A){var k=A.name,M=A.category,I=A.parent,z=(0,v.extractLogConfig)(A)||{},H=C((0,v.getLogConfig)(),z);x.defaultLogEmitter.on(E.LogEventType.CONFIG_UPDATED,(function(X){H=C(X,z||{})}));var K=function(X){for(var G=[],j=1;j<arguments.length;j++)G[j-1]=arguments[j];if(I&&!I.canLog(X)||!F(X))return!1;for(var q=P(),te=new Date().toTimeString().split(" ")[0],W=g(["".concat(te," - (").concat(q,")")],G,!0),$=0,J=H.targets;$<J.length;$++){var ne=J[$];ne.handleMessage.apply(ne,g([X],W,!1))}return!0},P=function(){return I?"".concat(I.getName()," | ").concat(k):k},F=function(X){return!(!H.enabled||!H.levels[X]||H.targets.length===0||M!==void 0&&!H.categories[M])},N={debug:function(){for(var X=[],G=0;G<arguments.length;G++)X[G]=arguments[G];return K.apply(void 0,g(["debug"],X,!1))},log:function(){for(var X=[],G=0;G<arguments.length;G++)X[G]=arguments[G];return K.apply(void 0,g(["log"],X,!1))},info:function(){for(var X=[],G=0;G<arguments.length;G++)X[G]=arguments[G];return K.apply(void 0,g(["info"],X,!1))},warn:function(){for(var X=[],G=0;G<arguments.length;G++)X[G]=arguments[G];return K.apply(void 0,g(["warn"],X,!1))},error:function(){for(var X=[],G=0;G<arguments.length;G++)X[G]=arguments[G];return K.apply(void 0,g(["error"],X,!1))},getName:P,canLog:F,getChildLogger:function(X){return(0,d.createLogger)(p(p({},X),{parent:N}))},setConfig:function(X){H=C(H,z=X)}};return N}},478:function(h,d,m){var p=this&&this.__spreadArray||function(v,x,E){if(E||arguments.length===2)for(var C,A=0,k=x.length;A<k;A++)!C&&A in x||(C||(C=Array.prototype.slice.call(x,0,A)),C[A]=x[A]);return v.concat(C||Array.prototype.slice.call(x))};Object.defineProperty(d,"__esModule",{value:!0}),d.mergeConfigs=void 0;var g=m(543),y=function(v,x){if((0,g.isArray)(v))return x};d.mergeConfigs=function(v){for(var x=[],E=1;E<arguments.length;E++)x[E-1]=arguments[E];var C=x.map((function(A){return A==null||typeof A!="object"})).filter(Boolean).length>0;if(typeof v=="object"&&!C)return g.mergeWith.apply(void 0,p(p([{},v],x,!1),[y],!1))}},293:(h,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.getErr=d.getOk_or=d.getOk=d.isNotOk=d.isOk=d.err=d.ok=void 0,d.ok=function(m){return{ok:!0,value:m}},d.err=function(m){return{ok:!1,error:m}},d.isOk=function(m){return m.ok===!0},d.isNotOk=function(m){return!(0,d.isOk)(m)},d.getOk=function(m){return m.ok===!0?m.value:void 0},d.getOk_or=function(m,p){return m.ok===!0?m.value:p},d.getErr=function(m){return m.ok===!0?void 0:m.error}}},l={};function u(h){var d=l[h];if(d!==void 0)return d.exports;var m=l[h]={id:h,loaded:!1,exports:{}};return c[h].call(m.exports,m,m.exports,u),m.loaded=!0,m.exports}return u.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),u.nmd=h=>(h.paths=[],h.children||(h.children=[]),h),u(156)})(),o.exports=a()},1549:(o,a,c)=>{var l=c(2032),u=c(3862),h=c(6721),d=c(2749),m=c(5749);function p(g){var y=-1,v=g==null?0:g.length;for(this.clear();++y<v;){var x=g[y];this.set(x[0],x[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=d,p.prototype.set=m,o.exports=p},79:(o,a,c)=>{var l=c(3702),u=c(80),h=c(4739),d=c(8655),m=c(1175);function p(g){var y=-1,v=g==null?0:g.length;for(this.clear();++y<v;){var x=g[y];this.set(x[0],x[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=d,p.prototype.set=m,o.exports=p},8223:(o,a,c)=>{var l=c(6110)(c(9325),"Map");o.exports=l},3661:(o,a,c)=>{var l=c(3040),u=c(7670),h=c(289),d=c(4509),m=c(2949);function p(g){var y=-1,v=g==null?0:g.length;for(this.clear();++y<v;){var x=g[y];this.set(x[0],x[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=d,p.prototype.set=m,o.exports=p},7217:(o,a,c)=>{var l=c(79),u=c(1420),h=c(938),d=c(3605),m=c(9817),p=c(945);function g(y){var v=this.__data__=new l(y);this.size=v.size}g.prototype.clear=u,g.prototype.delete=h,g.prototype.get=d,g.prototype.has=m,g.prototype.set=p,o.exports=g},1873:(o,a,c)=>{var l=c(9325).Symbol;o.exports=l},7828:(o,a,c)=>{var l=c(9325).Uint8Array;o.exports=l},1033:o=>{o.exports=function(a,c,l){switch(l.length){case 0:return a.call(c);case 1:return a.call(c,l[0]);case 2:return a.call(c,l[0],l[1]);case 3:return a.call(c,l[0],l[1],l[2])}return a.apply(c,l)}},695:(o,a,c)=>{var l=c(8096),u=c(2428),h=c(6449),d=c(3656),m=c(361),p=c(7167),g=Object.prototype.hasOwnProperty;o.exports=function(y,v){var x=h(y),E=!x&&u(y),C=!x&&!E&&d(y),A=!x&&!E&&!C&&p(y),k=x||E||C||A,M=k?l(y.length,String):[],I=M.length;for(var z in y)!v&&!g.call(y,z)||k&&(z=="length"||C&&(z=="offset"||z=="parent")||A&&(z=="buffer"||z=="byteLength"||z=="byteOffset")||m(z,I))||M.push(z);return M}},7805:(o,a,c)=>{var l=c(3360),u=c(5288);o.exports=function(h,d,m){(m!==void 0&&!u(h[d],m)||m===void 0&&!(d in h))&&l(h,d,m)}},6547:(o,a,c)=>{var l=c(3360),u=c(5288),h=Object.prototype.hasOwnProperty;o.exports=function(d,m,p){var g=d[m];h.call(d,m)&&u(g,p)&&(p!==void 0||m in d)||l(d,m,p)}},6025:(o,a,c)=>{var l=c(5288);o.exports=function(u,h){for(var d=u.length;d--;)if(l(u[d][0],h))return d;return-1}},3360:(o,a,c)=>{var l=c(3243);o.exports=function(u,h,d){h=="__proto__"&&l?l(u,h,{configurable:!0,enumerable:!0,value:d,writable:!0}):u[h]=d}},9344:(o,a,c)=>{var l=c(3805),u=Object.create,h=(function(){function d(){}return function(m){if(!l(m))return{};if(u)return u(m);d.prototype=m;var p=new d;return d.prototype=void 0,p}})();o.exports=h},6649:(o,a,c)=>{var l=c(3221)();o.exports=l},2552:(o,a,c)=>{var l=c(1873),u=c(659),h=c(9350),d=l?l.toStringTag:void 0;o.exports=function(m){return m==null?m===void 0?"[object Undefined]":"[object Null]":d&&d in Object(m)?u(m):h(m)}},7534:(o,a,c)=>{var l=c(2552),u=c(346);o.exports=function(h){return u(h)&&l(h)=="[object Arguments]"}},5083:(o,a,c)=>{var l=c(1882),u=c(7296),h=c(3805),d=c(7473),m=/^\[object .+?Constructor\]$/,p=Function.prototype,g=Object.prototype,y=p.toString,v=g.hasOwnProperty,x=RegExp("^"+y.call(v).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");o.exports=function(E){return!(!h(E)||u(E))&&(l(E)?x:m).test(d(E))}},4901:(o,a,c)=>{var l=c(2552),u=c(294),h=c(346),d={};d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d["[object Arguments]"]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object Boolean]"]=d["[object DataView]"]=d["[object Date]"]=d["[object Error]"]=d["[object Function]"]=d["[object Map]"]=d["[object Number]"]=d["[object Object]"]=d["[object RegExp]"]=d["[object Set]"]=d["[object String]"]=d["[object WeakMap]"]=!1,o.exports=function(m){return h(m)&&u(m.length)&&!!d[l(m)]}},2903:(o,a,c)=>{var l=c(3805),u=c(5527),h=c(181),d=Object.prototype.hasOwnProperty;o.exports=function(m){if(!l(m))return h(m);var p=u(m),g=[];for(var y in m)(y!="constructor"||!p&&d.call(m,y))&&g.push(y);return g}},5250:(o,a,c)=>{var l=c(7217),u=c(7805),h=c(6649),d=c(2824),m=c(3805),p=c(7241),g=c(4974);o.exports=function y(v,x,E,C,A){v!==x&&h(x,(function(k,M){if(A||(A=new l),m(k))d(v,x,M,E,y,C,A);else{var I=C?C(g(v,M),k,M+"",v,x,A):void 0;I===void 0&&(I=k),u(v,M,I)}}),p)}},2824:(o,a,c)=>{var l=c(7805),u=c(3290),h=c(1961),d=c(3007),m=c(5529),p=c(2428),g=c(6449),y=c(3693),v=c(3656),x=c(1882),E=c(3805),C=c(1331),A=c(7167),k=c(4974),M=c(9884);o.exports=function(I,z,H,K,P,F,N){var X=k(I,H),G=k(z,H),j=N.get(G);if(j)l(I,H,j);else{var q=F?F(X,G,H+"",I,z,N):void 0,te=q===void 0;if(te){var W=g(G),$=!W&&v(G),J=!W&&!$&&A(G);q=G,W||$||J?g(X)?q=X:y(X)?q=d(X):$?(te=!1,q=u(G,!0)):J?(te=!1,q=h(G,!0)):q=[]:C(G)||p(G)?(q=X,p(X)?q=M(X):E(X)&&!x(X)||(q=m(G))):te=!1}te&&(N.set(G,q),P(q,G,K,F,N),N.delete(G)),l(I,H,q)}}},9302:(o,a,c)=>{var l=c(3488),u=c(6757),h=c(2865);o.exports=function(d,m){return h(u(d,m,l),d+"")}},9570:(o,a,c)=>{var l=c(7334),u=c(3243),h=c(3488),d=u?function(m,p){return u(m,"toString",{configurable:!0,enumerable:!1,value:l(p),writable:!0})}:h;o.exports=d},8096:o=>{o.exports=function(a,c){for(var l=-1,u=Array(a);++l<a;)u[l]=c(l);return u}},7301:o=>{o.exports=function(a){return function(c){return a(c)}}},9653:(o,a,c)=>{var l=c(7828);o.exports=function(u){var h=new u.constructor(u.byteLength);return new l(h).set(new l(u)),h}},3290:(o,a,c)=>{o=c.nmd(o);var l=c(9325),u=a&&!a.nodeType&&a,h=u&&o&&!o.nodeType&&o,d=h&&h.exports===u?l.Buffer:void 0,m=d?d.allocUnsafe:void 0;o.exports=function(p,g){if(g)return p.slice();var y=p.length,v=m?m(y):new p.constructor(y);return p.copy(v),v}},1961:(o,a,c)=>{var l=c(9653);o.exports=function(u,h){var d=h?l(u.buffer):u.buffer;return new u.constructor(d,u.byteOffset,u.length)}},3007:o=>{o.exports=function(a,c){var l=-1,u=a.length;for(c||(c=Array(u));++l<u;)c[l]=a[l];return c}},1791:(o,a,c)=>{var l=c(6547),u=c(3360);o.exports=function(h,d,m,p){var g=!m;m||(m={});for(var y=-1,v=d.length;++y<v;){var x=d[y],E=p?p(m[x],h[x],x,m,h):void 0;E===void 0&&(E=h[x]),g?u(m,x,E):l(m,x,E)}return m}},5481:(o,a,c)=>{var l=c(9325)["__core-js_shared__"];o.exports=l},999:(o,a,c)=>{var l=c(9302),u=c(6800);o.exports=function(h){return l((function(d,m){var p=-1,g=m.length,y=g>1?m[g-1]:void 0,v=g>2?m[2]:void 0;for(y=h.length>3&&typeof y=="function"?(g--,y):void 0,v&&u(m[0],m[1],v)&&(y=g<3?void 0:y,g=1),d=Object(d);++p<g;){var x=m[p];x&&h(d,x,p,y)}return d}))}},3221:o=>{o.exports=function(a){return function(c,l,u){for(var h=-1,d=Object(c),m=u(c),p=m.length;p--;){var g=m[a?p:++h];if(l(d[g],g,d)===!1)break}return c}}},3243:(o,a,c)=>{var l=c(6110),u=(function(){try{var h=l(Object,"defineProperty");return h({},"",{}),h}catch{}})();o.exports=u},4840:(o,a,c)=>{var l=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g;o.exports=l},2651:(o,a,c)=>{var l=c(4218);o.exports=function(u,h){var d=u.__data__;return l(h)?d[typeof h=="string"?"string":"hash"]:d.map}},6110:(o,a,c)=>{var l=c(5083),u=c(392);o.exports=function(h,d){var m=u(h,d);return l(m)?m:void 0}},8879:(o,a,c)=>{var l=c(4335)(Object.getPrototypeOf,Object);o.exports=l},659:(o,a,c)=>{var l=c(1873),u=Object.prototype,h=u.hasOwnProperty,d=u.toString,m=l?l.toStringTag:void 0;o.exports=function(p){var g=h.call(p,m),y=p[m];try{p[m]=void 0;var v=!0}catch{}var x=d.call(p);return v&&(g?p[m]=y:delete p[m]),x}},392:o=>{o.exports=function(a,c){return a?.[c]}},2032:(o,a,c)=>{var l=c(1042);o.exports=function(){this.__data__=l?l(null):{},this.size=0}},3862:o=>{o.exports=function(a){var c=this.has(a)&&delete this.__data__[a];return this.size-=c?1:0,c}},6721:(o,a,c)=>{var l=c(1042),u=Object.prototype.hasOwnProperty;o.exports=function(h){var d=this.__data__;if(l){var m=d[h];return m==="__lodash_hash_undefined__"?void 0:m}return u.call(d,h)?d[h]:void 0}},2749:(o,a,c)=>{var l=c(1042),u=Object.prototype.hasOwnProperty;o.exports=function(h){var d=this.__data__;return l?d[h]!==void 0:u.call(d,h)}},5749:(o,a,c)=>{var l=c(1042);o.exports=function(u,h){var d=this.__data__;return this.size+=this.has(u)?0:1,d[u]=l&&h===void 0?"__lodash_hash_undefined__":h,this}},5529:(o,a,c)=>{var l=c(9344),u=c(8879),h=c(5527);o.exports=function(d){return typeof d.constructor!="function"||h(d)?{}:l(u(d))}},361:o=>{var a=/^(?:0|[1-9]\d*)$/;o.exports=function(c,l){var u=typeof c;return!!(l=l??9007199254740991)&&(u=="number"||u!="symbol"&&a.test(c))&&c>-1&&c%1==0&&c<l}},6800:(o,a,c)=>{var l=c(5288),u=c(4894),h=c(361),d=c(3805);o.exports=function(m,p,g){if(!d(g))return!1;var y=typeof p;return!!(y=="number"?u(g)&&h(p,g.length):y=="string"&&p in g)&&l(g[p],m)}},4218:o=>{o.exports=function(a){var c=typeof a;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?a!=="__proto__":a===null}},7296:(o,a,c)=>{var l,u=c(5481),h=(l=/[^.]+$/.exec(u&&u.keys&&u.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"";o.exports=function(d){return!!h&&h in d}},5527:o=>{var a=Object.prototype;o.exports=function(c){var l=c&&c.constructor;return c===(typeof l=="function"&&l.prototype||a)}},3702:o=>{o.exports=function(){this.__data__=[],this.size=0}},80:(o,a,c)=>{var l=c(6025),u=Array.prototype.splice;o.exports=function(h){var d=this.__data__,m=l(d,h);return!(m<0)&&(m==d.length-1?d.pop():u.call(d,m,1),--this.size,!0)}},4739:(o,a,c)=>{var l=c(6025);o.exports=function(u){var h=this.__data__,d=l(h,u);return d<0?void 0:h[d][1]}},8655:(o,a,c)=>{var l=c(6025);o.exports=function(u){return l(this.__data__,u)>-1}},1175:(o,a,c)=>{var l=c(6025);o.exports=function(u,h){var d=this.__data__,m=l(d,u);return m<0?(++this.size,d.push([u,h])):d[m][1]=h,this}},3040:(o,a,c)=>{var l=c(1549),u=c(79),h=c(8223);o.exports=function(){this.size=0,this.__data__={hash:new l,map:new(h||u),string:new l}}},7670:(o,a,c)=>{var l=c(2651);o.exports=function(u){var h=l(this,u).delete(u);return this.size-=h?1:0,h}},289:(o,a,c)=>{var l=c(2651);o.exports=function(u){return l(this,u).get(u)}},4509:(o,a,c)=>{var l=c(2651);o.exports=function(u){return l(this,u).has(u)}},2949:(o,a,c)=>{var l=c(2651);o.exports=function(u,h){var d=l(this,u),m=d.size;return d.set(u,h),this.size+=d.size==m?0:1,this}},1042:(o,a,c)=>{var l=c(6110)(Object,"create");o.exports=l},181:o=>{o.exports=function(a){var c=[];if(a!=null)for(var l in Object(a))c.push(l);return c}},6009:(o,a,c)=>{o=c.nmd(o);var l=c(4840),u=a&&!a.nodeType&&a,h=u&&o&&!o.nodeType&&o,d=h&&h.exports===u&&l.process,m=(function(){try{var p=h&&h.require&&h.require("util").types;return p||d&&d.binding&&d.binding("util")}catch{}})();o.exports=m},9350:o=>{var a=Object.prototype.toString;o.exports=function(c){return a.call(c)}},4335:o=>{o.exports=function(a,c){return function(l){return a(c(l))}}},6757:(o,a,c)=>{var l=c(1033),u=Math.max;o.exports=function(h,d,m){return d=u(d===void 0?h.length-1:d,0),function(){for(var p=arguments,g=-1,y=u(p.length-d,0),v=Array(y);++g<y;)v[g]=p[d+g];g=-1;for(var x=Array(d+1);++g<d;)x[g]=p[g];return x[d]=m(v),l(h,this,x)}}},9325:(o,a,c)=>{var l=c(4840),u=typeof self=="object"&&self&&self.Object===Object&&self,h=l||u||Function("return this")();o.exports=h},4974:o=>{o.exports=function(a,c){if((c!=="constructor"||typeof a[c]!="function")&&c!="__proto__")return a[c]}},2865:(o,a,c)=>{var l=c(9570),u=c(1811)(l);o.exports=u},1811:o=>{var a=Date.now;o.exports=function(c){var l=0,u=0;return function(){var h=a(),d=16-(h-u);if(u=h,d>0){if(++l>=800)return arguments[0]}else l=0;return c.apply(void 0,arguments)}}},1420:(o,a,c)=>{var l=c(79);o.exports=function(){this.__data__=new l,this.size=0}},938:o=>{o.exports=function(a){var c=this.__data__,l=c.delete(a);return this.size=c.size,l}},3605:o=>{o.exports=function(a){return this.__data__.get(a)}},9817:o=>{o.exports=function(a){return this.__data__.has(a)}},945:(o,a,c)=>{var l=c(79),u=c(8223),h=c(3661);o.exports=function(d,m){var p=this.__data__;if(p instanceof l){var g=p.__data__;if(!u||g.length<199)return g.push([d,m]),this.size=++p.size,this;p=this.__data__=new h(g)}return p.set(d,m),this.size=p.size,this}},7473:o=>{var a=Function.prototype.toString;o.exports=function(c){if(c!=null){try{return a.call(c)}catch{}try{return c+""}catch{}}return""}},7334:o=>{o.exports=function(a){return function(){return a}}},5288:o=>{o.exports=function(a,c){return a===c||a!=a&&c!=c}},3488:o=>{o.exports=function(a){return a}},2428:(o,a,c)=>{var l=c(7534),u=c(346),h=Object.prototype,d=h.hasOwnProperty,m=h.propertyIsEnumerable,p=l((function(){return arguments})())?l:function(g){return u(g)&&d.call(g,"callee")&&!m.call(g,"callee")};o.exports=p},6449:o=>{var a=Array.isArray;o.exports=a},4894:(o,a,c)=>{var l=c(1882),u=c(294);o.exports=function(h){return h!=null&&u(h.length)&&!l(h)}},3693:(o,a,c)=>{var l=c(4894),u=c(346);o.exports=function(h){return u(h)&&l(h)}},3656:(o,a,c)=>{o=c.nmd(o);var l=c(9325),u=c(9935),h=a&&!a.nodeType&&a,d=h&&o&&!o.nodeType&&o,m=d&&d.exports===h?l.Buffer:void 0,p=(m?m.isBuffer:void 0)||u;o.exports=p},1882:(o,a,c)=>{var l=c(2552),u=c(3805);o.exports=function(h){if(!u(h))return!1;var d=l(h);return d=="[object Function]"||d=="[object GeneratorFunction]"||d=="[object AsyncFunction]"||d=="[object Proxy]"}},294:o=>{o.exports=function(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=9007199254740991}},3805:o=>{o.exports=function(a){var c=typeof a;return a!=null&&(c=="object"||c=="function")}},346:o=>{o.exports=function(a){return a!=null&&typeof a=="object"}},1331:(o,a,c)=>{var l=c(2552),u=c(8879),h=c(346),d=Function.prototype,m=Object.prototype,p=d.toString,g=m.hasOwnProperty,y=p.call(Object);o.exports=function(v){if(!h(v)||l(v)!="[object Object]")return!1;var x=u(v);if(x===null)return!0;var E=g.call(x,"constructor")&&x.constructor;return typeof E=="function"&&E instanceof E&&p.call(E)==y}},7167:(o,a,c)=>{var l=c(4901),u=c(7301),h=c(6009),d=h&&h.isTypedArray,m=d?u(d):l;o.exports=m},7241:(o,a,c)=>{var l=c(695),u=c(2903),h=c(4894);o.exports=function(d){return h(d)?l(d,!0):u(d)}},2543:function(o,a,c){var l;o=c.nmd(o),(function(){var u,h="Expected a function",d="__lodash_hash_undefined__",m="__lodash_placeholder__",p=16,g=32,y=64,v=128,x=256,E=1/0,C=9007199254740991,A=NaN,k=4294967295,M=[["ary",v],["bind",1],["bindKey",2],["curry",8],["curryRight",p],["flip",512],["partial",g],["partialRight",y],["rearg",x]],I="[object Arguments]",z="[object Array]",H="[object Boolean]",K="[object Date]",P="[object Error]",F="[object Function]",N="[object GeneratorFunction]",X="[object Map]",G="[object Number]",j="[object Object]",q="[object Promise]",te="[object RegExp]",W="[object Set]",$="[object String]",J="[object Symbol]",ne="[object WeakMap]",ie="[object ArrayBuffer]",ae="[object DataView]",xe="[object Float32Array]",Ne="[object Float64Array]",Re="[object Int8Array]",Se="[object Int16Array]",ze="[object Int32Array]",Be="[object Uint8Array]",Je="[object Uint8ClampedArray]",at="[object Uint16Array]",re="[object Uint32Array]",Le=/\b__p \+= '';/g,He=/\b(__p \+=) '' \+/g,Ue=/(__e\(.*?\)|\b__t\)) \+\n'';/g,De=/&(?:amp|lt|gt|quot|#39);/g,fe=/[&<>"']/g,ve=RegExp(De.source),Ae=RegExp(fe.source),pe=/<%-([\s\S]+?)%>/g,Ge=/<%([\s\S]+?)%>/g,Qe=/<%=([\s\S]+?)%>/g,Ze=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tt=/^\w*$/,Ft=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bt=/[\\^$.*+?()[\]{}|]/g,Mt=RegExp(bt.source),Ie=/^\s+/,ce=/\s/,Q=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,le=/\{\n\/\* \[wrapped with (.+)\] \*/,we=/,? & /,Me=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Te=/[()=,{}\[\]\/\s]/,ye=/\\(\\)?/g,Ye=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Pe=/\w*$/,We=/^[-+]0x[0-9a-f]+$/i,Ve=/^0b[01]+$/i,Xe=/^\[object .+?Constructor\]$/,lt=/^0o[0-7]+$/i,qe=/^(?:0|[1-9]\d*)$/,rt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,it=/($^)/,nt=/['\n\r\u2028\u2029\\]/g,ct="\\ud800-\\udfff",Qt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",tn="\\u2700-\\u27bf",Ot="a-z\\xdf-\\xf6\\xf8-\\xff",qt="A-Z\\xc0-\\xd6\\xd8-\\xde",vt="\\ufe0e\\ufe0f",Kt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",_n="[']",Wt="["+ct+"]",dn="["+Kt+"]",Mn="["+Qt+"]",Ln="\\d+",is="["+tn+"]",ni="["+Ot+"]",fi="[^"+ct+Kt+Ln+tn+Ot+qt+"]",Ps="\\ud83c[\\udffb-\\udfff]",Ds="[^"+ct+"]",zi="(?:\\ud83c[\\udde6-\\uddff]){2}",ds="[\\ud800-\\udbff][\\udc00-\\udfff]",ps="["+qt+"]",je="\\u200d",gt="(?:"+ni+"|"+fi+")",Pt="(?:"+ps+"|"+fi+")",Dt="(?:['](?:d|ll|m|re|s|t|ve))?",St="(?:['](?:D|LL|M|RE|S|T|VE))?",nn="(?:"+Mn+"|"+Ps+")?",xn="["+vt+"]?",ln=xn+nn+("(?:"+je+"(?:"+[Ds,zi,ds].join("|")+")"+xn+nn+")*"),Un="(?:"+[is,zi,ds].join("|")+")"+ln,ur="(?:"+[Ds+Mn+"?",Mn,zi,ds,Wt].join("|")+")",cr=RegExp(_n,"g"),Fn=RegExp(Mn,"g"),dr=RegExp(Ps+"(?="+Ps+")|"+ur+ln,"g"),Dr=RegExp([ps+"?"+ni+"+"+Dt+"(?="+[dn,ps,"$"].join("|")+")",Pt+"+"+St+"(?="+[dn,ps+gt,"$"].join("|")+")",ps+"?"+gt+"+"+Dt,ps+"+"+St,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ln,Un].join("|"),"g"),ws=RegExp("["+je+ct+Qt+vt+"]"),Ar=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ur=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],rr=-1,pr={};pr[xe]=pr[Ne]=pr[Re]=pr[Se]=pr[ze]=pr[Be]=pr[Je]=pr[at]=pr[re]=!0,pr[I]=pr[z]=pr[ie]=pr[H]=pr[ae]=pr[K]=pr[P]=pr[F]=pr[X]=pr[G]=pr[j]=pr[te]=pr[W]=pr[$]=pr[ne]=!1;var un={};un[I]=un[z]=un[ie]=un[ae]=un[H]=un[K]=un[xe]=un[Ne]=un[Re]=un[Se]=un[ze]=un[X]=un[G]=un[j]=un[te]=un[W]=un[$]=un[J]=un[Be]=un[Je]=un[at]=un[re]=!0,un[P]=un[F]=un[ne]=!1;var Er={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Co=parseFloat,io=parseInt,aa=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g,ki=typeof self=="object"&&self&&self.Object===Object&&self,kn=aa||ki||Function("return this")(),Gr=a&&!a.nodeType&&a,$n=Gr&&o&&!o.nodeType&&o,Zi=$n&&$n.exports===Gr,za=Zi&&aa.process,ms=(function(){try{var Ke=$n&&$n.require&&$n.require("util").types;return Ke||za&&za.binding&&za.binding("util")}catch{}})(),Rs=ms&&ms.isArrayBuffer,th=ms&&ms.isDate,mm=ms&&ms.isMap,np=ms&&ms.isRegExp,rp=ms&&ms.isSet,od=ms&&ms.isTypedArray;function Ha(Ke,dt,pt){switch(pt.length){case 0:return Ke.call(dt);case 1:return Ke.call(dt,pt[0]);case 2:return Ke.call(dt,pt[0],pt[1]);case 3:return Ke.call(dt,pt[0],pt[1],pt[2])}return Ke.apply(dt,pt)}function Mc(Ke,dt,pt,zt){for(var on=-1,Cn=Ke==null?0:Ke.length;++on<Cn;){var $r=Ke[on];dt(zt,$r,pt($r),Ke)}return zt}function lc(Ke,dt){for(var pt=-1,zt=Ke==null?0:Ke.length;++pt<zt&&dt(Ke[pt],pt,Ke)!==!1;);return Ke}function kc(Ke,dt){for(var pt=Ke==null?0:Ke.length;pt--&&dt(Ke[pt],pt,Ke)!==!1;);return Ke}function gm(Ke,dt){for(var pt=-1,zt=Ke==null?0:Ke.length;++pt<zt;)if(!dt(Ke[pt],pt,Ke))return!1;return!0}function Xc(Ke,dt){for(var pt=-1,zt=Ke==null?0:Ke.length,on=0,Cn=[];++pt<zt;){var $r=Ke[pt];dt($r,pt,Ke)&&(Cn[on++]=$r)}return Cn}function Yc(Ke,dt){return!!(Ke!=null&&Ke.length)&&lu(Ke,dt,0)>-1}function nh(Ke,dt,pt){for(var zt=-1,on=Ke==null?0:Ke.length;++zt<on;)if(pt(dt,Ke[zt]))return!0;return!1}function gs(Ke,dt){for(var pt=-1,zt=Ke==null?0:Ke.length,on=Array(zt);++pt<zt;)on[pt]=dt(Ke[pt],pt,Ke);return on}function xi(Ke,dt){for(var pt=-1,zt=dt.length,on=Ke.length;++pt<zt;)Ke[on+pt]=dt[pt];return Ke}function au(Ke,dt,pt,zt){var on=-1,Cn=Ke==null?0:Ke.length;for(zt&&Cn&&(pt=Ke[++on]);++on<Cn;)pt=dt(pt,Ke[on],on,Ke);return pt}function kg(Ke,dt,pt,zt){var on=Ke==null?0:Ke.length;for(zt&&on&&(pt=Ke[--on]);on--;)pt=dt(pt,Ke[on],on,Ke);return pt}function s_(Ke,dt){for(var pt=-1,zt=Ke==null?0:Ke.length;++pt<zt;)if(dt(Ke[pt],pt,Ke))return!0;return!1}var Zc=ad("length");function vo(Ke,dt,pt){var zt;return pt(Ke,(function(on,Cn,$r){if(dt(on,Cn,$r))return zt=Cn,!1})),zt}function cu(Ke,dt,pt,zt){for(var on=Ke.length,Cn=pt+(zt?1:-1);zt?Cn--:++Cn<on;)if(dt(Ke[Cn],Cn,Ke))return Cn;return-1}function lu(Ke,dt,pt){return dt==dt?(function(zt,on,Cn){for(var $r=Cn-1,qo=zt.length;++$r<qo;)if(zt[$r]===on)return $r;return-1})(Ke,dt,pt):cu(Ke,Oc,pt)}function pf(Ke,dt,pt,zt){for(var on=pt-1,Cn=Ke.length;++on<Cn;)if(zt(Ke[on],dt))return on;return-1}function Oc(Ke){return Ke!=Ke}function _m(Ke,dt){var pt=Ke==null?0:Ke.length;return pt?Du(Ke,dt)/pt:A}function ad(Ke){return function(dt){return dt==null?u:dt[Ke]}}function ip(Ke){return function(dt){return Ke==null?u:Ke[dt]}}function vm(Ke,dt,pt,zt,on){return on(Ke,(function(Cn,$r,qo){pt=zt?(zt=!1,Cn):dt(pt,Cn,$r,qo)})),pt}function Du(Ke,dt){for(var pt,zt=-1,on=Ke.length;++zt<on;){var Cn=dt(Ke[zt]);Cn!==u&&(pt=pt===u?Cn:pt+Cn)}return pt}function mf(Ke,dt){for(var pt=-1,zt=Array(Ke);++pt<Ke;)zt[pt]=dt(pt);return zt}function sp(Ke){return Ke&&Ke.slice(0,bm(Ke)+1).replace(Ie,"")}function wa(Ke){return function(dt){return Ke(dt)}}function qa(Ke,dt){return gs(dt,(function(pt){return Ke[pt]}))}function rh(Ke,dt){return Ke.has(dt)}function op(Ke,dt){for(var pt=-1,zt=Ke.length;++pt<zt&&lu(dt,Ke[pt],0)>-1;);return pt}function Ho(Ke,dt){for(var pt=Ke.length;pt--&&lu(dt,Ke[pt],0)>-1;);return pt}var o_=ip({:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"}),Xv=ip({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Yv(Ke){return"\\"+Er[Ke]}function cd(Ke){return ws.test(Ke)}function gf(Ke){var dt=-1,pt=Array(Ke.size);return Ke.forEach((function(zt,on){pt[++dt]=[on,zt]})),pt}function _f(Ke,dt){return function(pt){return Ke(dt(pt))}}function uu(Ke,dt){for(var pt=-1,zt=Ke.length,on=0,Cn=[];++pt<zt;){var $r=Ke[pt];$r!==dt&&$r!==m||(Ke[pt]=m,Cn[on++]=pt)}return Cn}function Cl(Ke){var dt=-1,pt=Array(Ke.size);return Ke.forEach((function(zt){pt[++dt]=zt})),pt}function ym(Ke){var dt=-1,pt=Array(Ke.size);return Ke.forEach((function(zt){pt[++dt]=[zt,zt]})),pt}function Oi(Ke){return cd(Ke)?(function(dt){for(var pt=dr.lastIndex=0;dr.test(dt);)++pt;return pt})(Ke):Zc(Ke)}function Cs(Ke){return cd(Ke)?(function(dt){return dt.match(dr)||[]})(Ke):(function(dt){return dt.split("")})(Ke)}function bm(Ke){for(var dt=Ke.length;dt--&&ce.test(Ke.charAt(dt)););return dt}var Em=ip({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),vf=(function Ke(dt){var pt,zt=(dt=dt==null?kn:vf.defaults(kn.Object(),dt,vf.pick(kn,Ur))).Array,on=dt.Date,Cn=dt.Error,$r=dt.Function,qo=dt.Math,Kn=dt.Object,yo=dt.RegExp,fu=dt.String,Ii=dt.TypeError,hu=zt.prototype,Lu=$r.prototype,jn=Kn.prototype,Ic=dt["__core-js_shared__"],qs=Lu.toString,Yn=jn.hasOwnProperty,vr=0,Sm=(pt=/[^.]+$/.exec(Ic&&Ic.keys&&Ic.keys.IE_PROTO||""))?"Symbol(src)_1."+pt:"",du=jn.toString,a_=qs.call(Kn),Ra=kn._,Og=yo("^"+qs.call(Yn).replace(bt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ao=Zi?dt.Buffer:u,Va=dt.Symbol,yf=dt.Uint8Array,Ig=Ao?Ao.allocUnsafe:u,Uu=_f(Kn.getPrototypeOf,Kn),bf=Kn.create,xm=jn.propertyIsEnumerable,ih=hu.splice,Ef=Va?Va.isConcatSpreadable:u,Jc=Va?Va.iterator:u,hi=Va?Va.toStringTag:u,Al=(function(){try{var S=Fc(Kn,"defineProperty");return S({},"",{}),S}catch{}})(),Zv=dt.clearTimeout!==kn.clearTimeout&&dt.clearTimeout,Jv=on&&on.now!==kn.Date.now&&on.now,Tm=dt.setTimeout!==kn.setTimeout&&dt.setTimeout,uc=qo.ceil,sh=qo.floor,Bu=Kn.getOwnPropertySymbols,ld=Ao?Ao.isBuffer:u,Ga=dt.isFinite,Ng=hu.join,c_=_f(Kn.keys,Kn),Hr=qo.max,Ti=qo.min,wm=on.now,Rm=dt.parseInt,Cm=qo.random,Tn=hu.reverse,ss=Fc(dt,"DataView"),Fu=Fc(dt,"Map"),fc=Fc(dt,"Promise"),Qc=Fc(dt,"Set"),ju=Fc(dt,"WeakMap"),zu=Fc(Kn,"create"),Sf=ju&&new ju,Hi={},l_=Ka(ss),os=Ka(Fu),u_=Ka(fc),ca=Ka(Qc),ud=Ka(ju),Vo=Va?Va.prototype:u,hc=Vo?Vo.valueOf:u,gr=Vo?Vo.toString:u;function he(S){if(_r(S)&&!tr(S)&&!(S instanceof vn)){if(S instanceof Ji)return S;if(Yn.call(S,"__wrapped__"))return yu(S)}return new Ji(S)}var dc=(function(){function S(){}return function(f){if(!bs(f))return{};if(bf)return bf(f);S.prototype=f;var _=new S;return S.prototype=u,_}})();function Ml(){}function Ji(S,f){this.__wrapped__=S,this.__actions__=[],this.__chain__=!!f,this.__index__=0,this.__values__=u}function vn(S){this.__wrapped__=S,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=k,this.__views__=[]}function Mo(S){var f=-1,_=S==null?0:S.length;for(this.clear();++f<_;){var R=S[f];this.set(R[0],R[1])}}function Go(S){var f=-1,_=S==null?0:S.length;for(this.clear();++f<_;){var R=S[f];this.set(R[0],R[1])}}function Ni(S){var f=-1,_=S==null?0:S.length;for(this.clear();++f<_;){var R=S[f];this.set(R[0],R[1])}}function Xt(S){var f=-1,_=S==null?0:S.length;for(this.__data__=new Ni;++f<_;)this.add(S[f])}function ai(S){var f=this.__data__=new Go(S);this.size=f.size}function Pg(S,f){var _=tr(S),R=!_&&mh(S),U=!_&&!R&&as(S),ee=!_&&!R&&!U&&Qi(S),ue=_||R||U||ee,de=ue?mf(S.length,fu):[],be=de.length;for(var Ce in S)!f&&!Yn.call(S,Ce)||ue&&(Ce=="length"||U&&(Ce=="offset"||Ce=="parent")||ee&&(Ce=="buffer"||Ce=="byteLength"||Ce=="byteOffset")||Vs(Ce,be))||de.push(Ce);return de}function oh(S){var f=S.length;return f?S[Gu(0,f-1)]:u}function ap(S,f){return xp(As(S),$a(f,0,S.length))}function Am(S){return xp(As(S))}function xf(S,f,_){(_!==u&&!da(S[f],_)||_===u&&!(f in S))&&Wo(S,f,_)}function el(S,f,_){var R=S[f];Yn.call(S,f)&&da(R,_)&&(_!==u||f in S)||Wo(S,f,_)}function $o(S,f){for(var _=S.length;_--;)if(da(S[_][0],f))return _;return-1}function cp(S,f,_,R){return so(S,(function(U,ee,ue){f(R,U,_(U),ue)})),R}function la(S,f){return S&&Lc(f,ls(f),S)}function Wo(S,f,_){f=="__proto__"&&Al?Al(S,f,{configurable:!0,enumerable:!0,value:_,writable:!0}):S[f]=_}function ah(S,f){for(var _=-1,R=f.length,U=zt(R),ee=S==null;++_<R;)U[_]=ee?u:Mp(S,f[_]);return U}function $a(S,f,_){return S==S&&(_!==u&&(S=S<=_?S:_),f!==u&&(S=S>=f?S:f)),S}function Ls(S,f,_,R,U,ee){var ue,de=1&f,be=2&f,Ce=4&f;if(_&&(ue=U?_(S,R,U,ee):_(S)),ue!==u)return ue;if(!bs(S))return S;var Oe=tr(S);if(Oe){if(ue=(function(ht){var st=ht.length,xt=new ht.constructor(st);return st&&typeof ht[0]=="string"&&Yn.call(ht,"index")&&(xt.index=ht.index,xt.input=ht.input),xt})(S),!de)return As(S,ue)}else{var Fe=ha(S),ot=Fe==F||Fe==N;if(as(S))return yr(S,de);if(Fe==j||Fe==I||ot&&!U){if(ue=be||ot?{}:g_(S),!de)return be?(function(ht,st){return Lc(ht,fa(ht),st)})(S,(function(ht,st){return ht&&Lc(st,Mr(st),ht)})(ue,S)):(function(ht,st){return Lc(ht,Bm(ht),st)})(S,la(ue,S))}else{if(!un[Fe])return U?S:{};ue=(function(ht,st,xt){var mt=ht.constructor;switch(st){case ie:return _p(ht);case H:case K:return new mt(+ht);case ae:return(function(kt,Bt){var It=Bt?_p(kt.buffer):kt.buffer;return new kt.constructor(It,kt.byteOffset,kt.byteLength)})(ht,xt);case xe:case Ne:case Re:case Se:case ze:case Be:case Je:case at:case re:return Fg(ht,xt);case X:return new mt;case G:case $:return new mt(ht);case te:return(function(kt){var Bt=new kt.constructor(kt.source,Pe.exec(kt));return Bt.lastIndex=kt.lastIndex,Bt})(ht);case W:return new mt;case J:return Et=ht,hc?Kn(hc.call(Et)):{}}var Et})(S,Fe,de)}}ee||(ee=new ai);var _t=ee.get(S);if(_t)return _t;ee.set(S,ue),Qs(S)?S.forEach((function(ht){ue.add(Ls(ht,f,_,ht,S,ee))})):Pi(S)&&S.forEach((function(ht,st){ue.set(st,Ls(ht,f,_,st,S,ee))}));var Tt=Oe?u:(Ce?be?bp:Um:be?Mr:ls)(S);return lc(Tt||S,(function(ht,st){Tt&&(ht=S[st=ht]),el(ue,st,Ls(ht,f,_,st,S,ee))})),ue}function tl(S,f,_){var R=_.length;if(S==null)return!R;for(S=Kn(S);R--;){var U=_[R],ee=f[U],ue=S[U];if(ue===u&&!(U in S)||!ee(ue))return!1}return!0}function lp(S,f,_){if(typeof S!="function")throw new Ii(h);return Dl((function(){S.apply(u,_)}),f)}function kl(S,f,_,R){var U=-1,ee=Yc,ue=!0,de=S.length,be=[],Ce=f.length;if(!de)return be;_&&(f=gs(f,wa(_))),R?(ee=nh,ue=!1):f.length>=200&&(ee=rh,ue=!1,f=new Xt(f));e:for(;++U<de;){var Oe=S[U],Fe=_==null?Oe:_(Oe);if(Oe=R||Oe!==0?Oe:0,ue&&Fe==Fe){for(var ot=Ce;ot--;)if(f[ot]===Fe)continue e;be.push(Oe)}else ee(f,Fe,R)||be.push(Oe)}return be}he.templateSettings={escape:pe,evaluate:Ge,interpolate:Qe,variable:"",imports:{_:he}},he.prototype=Ml.prototype,he.prototype.constructor=he,Ji.prototype=dc(Ml.prototype),Ji.prototype.constructor=Ji,vn.prototype=dc(Ml.prototype),vn.prototype.constructor=vn,Mo.prototype.clear=function(){this.__data__=zu?zu(null):{},this.size=0},Mo.prototype.delete=function(S){var f=this.has(S)&&delete this.__data__[S];return this.size-=f?1:0,f},Mo.prototype.get=function(S){var f=this.__data__;if(zu){var _=f[S];return _===d?u:_}return Yn.call(f,S)?f[S]:u},Mo.prototype.has=function(S){var f=this.__data__;return zu?f[S]!==u:Yn.call(f,S)},Mo.prototype.set=function(S,f){var _=this.__data__;return this.size+=this.has(S)?0:1,_[S]=zu&&f===u?d:f,this},Go.prototype.clear=function(){this.__data__=[],this.size=0},Go.prototype.delete=function(S){var f=this.__data__,_=$o(f,S);return!(_<0)&&(_==f.length-1?f.pop():ih.call(f,_,1),--this.size,!0)},Go.prototype.get=function(S){var f=this.__data__,_=$o(f,S);return _<0?u:f[_][1]},Go.prototype.has=function(S){return $o(this.__data__,S)>-1},Go.prototype.set=function(S,f){var _=this.__data__,R=$o(_,S);return R<0?(++this.size,_.push([S,f])):_[R][1]=f,this},Ni.prototype.clear=function(){this.size=0,this.__data__={hash:new Mo,map:new(Fu||Go),string:new Mo}},Ni.prototype.delete=function(S){var f=yd(this,S).delete(S);return this.size-=f?1:0,f},Ni.prototype.get=function(S){return yd(this,S).get(S)},Ni.prototype.has=function(S){return yd(this,S).has(S)},Ni.prototype.set=function(S,f){var _=yd(this,S),R=_.size;return _.set(S,f),this.size+=_.size==R?0:1,this},Xt.prototype.add=Xt.prototype.push=function(S){return this.__data__.set(S,d),this},Xt.prototype.has=function(S){return this.__data__.has(S)},ai.prototype.clear=function(){this.__data__=new Go,this.size=0},ai.prototype.delete=function(S){var f=this.__data__,_=f.delete(S);return this.size=f.size,_},ai.prototype.get=function(S){return this.__data__.get(S)},ai.prototype.has=function(S){return this.__data__.has(S)},ai.prototype.set=function(S,f){var _=this.__data__;if(_ instanceof Go){var R=_.__data__;if(!Fu||R.length<199)return R.push([S,f]),this.size=++_.size,this;_=this.__data__=new Ni(R)}return _.set(S,f),this.size=_.size,this};var so=p_(_s),Mm=p_(fd,!0);function f_(S,f){var _=!0;return so(S,(function(R,U,ee){return _=!!f(R,U,ee)})),_}function Tf(S,f,_){for(var R=-1,U=S.length;++R<U;){var ee=S[R],ue=f(ee);if(ue!=null&&(de===u?ue==ue&&!cs(ue):_(ue,de)))var de=ue,be=ee}return be}function km(S,f){var _=[];return so(S,(function(R,U,ee){f(R,U,ee)&&_.push(R)})),_}function Qr(S,f,_,R,U){var ee=-1,ue=S.length;for(_||(_=vu),U||(U=[]);++ee<ue;){var de=S[ee];f>0&&_(de)?f>1?Qr(de,f-1,_,R,U):xi(U,de):R||(U[U.length]=de)}return U}var ch=m_(),Dg=m_(!0);function _s(S,f){return S&&ch(S,f,ls)}function fd(S,f){return S&&Dg(S,f,ls)}function Hu(S,f){return Xc(f,(function(_){return Ya(S[_])}))}function pc(S,f){for(var _=0,R=(f=mu(f,S)).length;S!=null&&_<R;)S=S[Ll(f[_++])];return _&&_==R?S:u}function wf(S,f,_){var R=f(S);return tr(S)?R:xi(R,_(S))}function wi(S){return S==null?S===u?"[object Undefined]":"[object Null]":hi&&hi in Kn(S)?(function(f){var _=Yn.call(f,hi),R=f[hi];try{f[hi]=u;var U=!0}catch{}var ee=du.call(f);return U&&(_?f[hi]=R:delete f[hi]),ee})(S):(function(f){return du.call(f)})(S)}function hd(S,f){return S>f}function h_(S,f){return S!=null&&Yn.call(S,f)}function xb(S,f){return S!=null&&f in Kn(S)}function dd(S,f,_){for(var R=_?nh:Yc,U=S[0].length,ee=S.length,ue=ee,de=zt(ee),be=1/0,Ce=[];ue--;){var Oe=S[ue];ue&&f&&(Oe=gs(Oe,wa(f))),be=Ti(Oe.length,be),de[ue]=!_&&(f||U>=120&&Oe.length>=120)?new Xt(ue&&Oe):u}Oe=S[0];var Fe=-1,ot=de[0];e:for(;++Fe<U&&Ce.length<be;){var _t=Oe[Fe],Tt=f?f(_t):_t;if(_t=_||_t!==0?_t:0,!(ot?rh(ot,Tt):R(Ce,Tt,_))){for(ue=ee;--ue;){var ht=de[ue];if(!(ht?rh(ht,Tt):R(S[ue],Tt,_)))continue e}ot&&ot.push(Tt),Ce.push(_t)}}return Ce}function mc(S,f,_){var R=(S=jm(S,f=mu(f,S)))==null?S:S[Ll(Ul(f))];return R==null?u:Ha(R,S,_)}function Pn(S){return _r(S)&&wi(S)==I}function ei(S,f,_,R,U){return S===f||(S==null||f==null||!_r(S)&&!_r(f)?S!=S&&f!=f:(function(ee,ue,de,be,Ce,Oe){var Fe=tr(ee),ot=tr(ue),_t=Fe?z:ha(ee),Tt=ot?z:ha(ue),ht=(_t=_t==I?j:_t)==j,st=(Tt=Tt==I?j:Tt)==j,xt=_t==Tt;if(xt&&as(ee)){if(!as(ue))return!1;Fe=!0,ht=!1}if(xt&&!ht)return Oe||(Oe=new ai),Fe||Qi(ee)?Oa(ee,ue,de,be,Ce,Oe):(function(It,Nt,Zt,hn,In,On,bn){switch(Zt){case ae:if(It.byteLength!=Nt.byteLength||It.byteOffset!=Nt.byteOffset)return!1;It=It.buffer,Nt=Nt.buffer;case ie:return!(It.byteLength!=Nt.byteLength||!On(new yf(It),new yf(Nt)));case H:case K:case G:return da(+It,+Nt);case P:return It.name==Nt.name&&It.message==Nt.message;case te:case $:return It==Nt+"";case X:var ir=gf;case W:var mr=1&hn;if(ir||(ir=Cl),It.size!=Nt.size&&!mr)return!1;var ti=bn.get(It);if(ti)return ti==Nt;hn|=2,bn.set(It,Nt);var Fr=Oa(ir(It),ir(Nt),hn,In,On,bn);return bn.delete(It),Fr;case J:if(hc)return hc.call(It)==hc.call(Nt)}return!1})(ee,ue,_t,de,be,Ce,Oe);if(!(1&de)){var mt=ht&&Yn.call(ee,"__wrapped__"),Et=st&&Yn.call(ue,"__wrapped__");if(mt||Et){var kt=mt?ee.value():ee,Bt=Et?ue.value():ue;return Oe||(Oe=new ai),Ce(kt,Bt,de,be,Oe)}}return xt?(Oe||(Oe=new ai),(function(It,Nt,Zt,hn,In,On){var bn=1&Zt,ir=Um(It),mr=ir.length,ti=Um(Nt),Fr=ti.length;if(mr!=Fr&&!bn)return!1;for(var Kr=mr;Kr--;){var pi=ir[Kr];if(!(bn?pi in Nt:Yn.call(Nt,pi)))return!1}var li=On.get(It),ji=On.get(Nt);if(li&&ji)return li==Nt&&ji==It;var Li=!0;On.set(It,Nt),On.set(Nt,It);for(var Vi=bn;++Kr<mr;){var mi=It[pi=ir[Kr]],es=Nt[pi];if(hn)var $s=bn?hn(es,mi,pi,Nt,It,On):hn(mi,es,pi,It,Nt,On);if(!($s===u?mi===es||In(mi,es,Zt,hn,On):$s)){Li=!1;break}Vi||(Vi=pi=="constructor")}if(Li&&!Vi){var Gi=It.constructor,No=Nt.constructor;Gi==No||!("constructor"in It)||!("constructor"in Nt)||typeof Gi=="function"&&Gi instanceof Gi&&typeof No=="function"&&No instanceof No||(Li=!1)}return On.delete(It),On.delete(Nt),Li})(ee,ue,de,be,Ce,Oe)):!1})(S,f,_,R,ei,U))}function qu(S,f,_,R){var U=_.length,ee=U,ue=!R;if(S==null)return!ee;for(S=Kn(S);U--;){var de=_[U];if(ue&&de[2]?de[1]!==S[de[0]]:!(de[0]in S))return!1}for(;++U<ee;){var be=(de=_[U])[0],Ce=S[be],Oe=de[1];if(ue&&de[2]){if(Ce===u&&!(be in S))return!1}else{var Fe=new ai;if(R)var ot=R(Ce,Oe,be,S,f,Fe);if(!(ot===u?ei(Oe,Ce,3,R,Fe):ot))return!1}}return!0}function ko(S){return!(!bs(S)||(f=S,Sm&&Sm in f))&&(Ya(S)?Og:Xe).test(Ka(S));var f}function Om(S){return typeof S=="function"?S:S==null?Jo:typeof S=="object"?tr(S)?Ca(S[0],S[1]):hp(S):Rd(S)}function up(S){if(!Ys(S))return c_(S);var f=[];for(var _ in Kn(S))Yn.call(S,_)&&_!="constructor"&&f.push(_);return f}function d_(S){if(!bs(S))return(function(U){var ee=[];if(U!=null)for(var ue in Kn(U))ee.push(ue);return ee})(S);var f=Ys(S),_=[];for(var R in S)(R!="constructor"||!f&&Yn.call(S,R))&&_.push(R);return _}function fp(S,f){return S<f}function Lg(S,f){var _=-1,R=vc(S)?zt(S.length):[];return so(S,(function(U,ee,ue){R[++_]=f(U,ee,ue)})),R}function hp(S){var f=Bc(S);return f.length==1&&f[0][2]?__(f[0][0],f[0][1]):function(_){return _===S||qu(_,S,f)}}function Ca(S,f){return Ep(S)&&Fm(f)?__(Ll(S),f):function(_){var R=Mp(_,S);return R===u&&R===f?Td(_,S):ei(f,R,3)}}function dp(S,f,_,R,U){S!==f&&ch(f,(function(ee,ue){if(U||(U=new ai),bs(ee))(function(be,Ce,Oe,Fe,ot,_t,Tt){var ht=bd(be,Oe),st=bd(Ce,Oe),xt=Tt.get(st);if(xt)return void xf(be,Oe,xt);var mt=_t?_t(ht,st,Oe+"",be,Ce,Tt):u,Et=mt===u;if(Et){var kt=tr(st),Bt=!kt&&as(st),It=!kt&&!Bt&&Qi(st);mt=st,kt||Bt||It?tr(ht)?mt=ht:ii(ht)?mt=As(ht):Bt?(Et=!1,mt=yr(st,!0)):It?(Et=!1,mt=Fg(st,!0)):mt=[]:Fl(st)||mh(st)?(mt=ht,mh(ht)?mt=eo(ht):bs(ht)&&!Ya(ht)||(mt=g_(st))):Et=!1}Et&&(Tt.set(st,mt),ot(mt,st,Fe,_t,Tt),Tt.delete(st)),xf(be,Oe,mt)})(S,f,ue,_,dp,R,U);else{var de=R?R(bd(S,ue),ee,ue+"",S,f,U):u;de===u&&(de=ee),xf(S,ue,de)}}),Mr)}function pp(S,f){var _=S.length;if(_)return Vs(f+=f<0?_:0,_)?S[f]:u}function Vu(S,f,_){f=f.length?gs(f,(function(ee){return tr(ee)?function(ue){return pc(ue,ee.length===1?ee[0]:ee)}:ee})):[Jo];var R=-1;f=gs(f,wa(sr()));var U=Lg(S,(function(ee,ue,de){var be=gs(f,(function(Ce){return Ce(ee)}));return{criteria:be,index:++R,value:ee}}));return(function(ee,ue){var de=ee.length;for(ee.sort(ue);de--;)ee[de]=ee[de].value;return ee})(U,(function(ee,ue){return(function(de,be,Ce){for(var Oe=-1,Fe=de.criteria,ot=be.criteria,_t=Fe.length,Tt=Ce.length;++Oe<_t;){var ht=Nm(Fe[Oe],ot[Oe]);if(ht)return Oe>=Tt?ht:ht*(Ce[Oe]=="desc"?-1:1)}return de.index-be.index})(ee,ue,_)}))}function mp(S,f,_){for(var R=-1,U=f.length,ee={};++R<U;){var ue=f[R],de=pc(S,ue);_(de,ue)&&ri(ee,mu(ue,S),de)}return ee}function gp(S,f,_,R){var U=R?pf:lu,ee=-1,ue=f.length,de=S;for(S===f&&(f=As(f)),_&&(de=gs(S,wa(_)));++ee<ue;)for(var be=0,Ce=f[ee],Oe=_?_(Ce):Ce;(be=U(de,Oe,be,R))>-1;)de!==S&&ih.call(de,be,1),ih.call(S,be,1);return S}function Ol(S,f){for(var _=S?f.length:0,R=_-1;_--;){var U=f[_];if(_==R||U!==ee){var ee=U;Vs(U)?ih.call(S,U,1):Ug(S,U)}}return S}function Gu(S,f){return S+sh(Cm()*(f-S+1))}function fr(S,f){var _="";if(!S||f<1||f>C)return _;do f%2&&(_+=S),(f=sh(f/2))&&(S+=S);while(f);return _}function Br(S,f){return qg(Hg(S,f,Jo),S+"")}function Aa(S){return oh(jl(S))}function nl(S,f){var _=jl(S);return xp(_,$a(f,0,_.length))}function ri(S,f,_,R){if(!bs(S))return S;for(var U=-1,ee=(f=mu(f,S)).length,ue=ee-1,de=S;de!=null&&++U<ee;){var be=Ll(f[U]),Ce=_;if(be==="__proto__"||be==="constructor"||be==="prototype")return S;if(U!=ue){var Oe=de[be];(Ce=R?R(Oe,be,de):u)===u&&(Ce=bs(Oe)?Oe:Vs(f[U+1])?[]:{})}el(de,be,Ce),de=de[be]}return S}var Im=Sf?function(S,f){return Sf.set(S,f),S}:Jo,wr=Al?function(S,f){return Al(S,"toString",{configurable:!0,enumerable:!1,value:yh(f),writable:!0})}:Jo;function rl(S){return xp(jl(S))}function Us(S,f,_){var R=-1,U=S.length;f<0&&(f=-f>U?0:U+f),(_=_>U?U:_)<0&&(_+=U),U=f>_?0:_-f>>>0,f>>>=0;for(var ee=zt(U);++R<U;)ee[R]=S[R+f];return ee}function pd(S,f){var _;return so(S,(function(R,U,ee){return!(_=f(R,U,ee))})),!!_}function md(S,f,_){var R=0,U=S==null?R:S.length;if(typeof f=="number"&&f==f&&U<=2147483647){for(;R<U;){var ee=R+U>>>1,ue=S[ee];ue!==null&&!cs(ue)&&(_?ue<=f:ue<f)?R=ee+1:U=ee}return U}return ua(S,f,Jo,_)}function ua(S,f,_,R){var U=0,ee=S==null?0:S.length;if(ee===0)return 0;for(var ue=(f=_(f))!=f,de=f===null,be=cs(f),Ce=f===u;U<ee;){var Oe=sh((U+ee)/2),Fe=_(S[Oe]),ot=Fe!==u,_t=Fe===null,Tt=Fe==Fe,ht=cs(Fe);if(ue)var st=R||Tt;else st=Ce?Tt&&(R||ot):de?Tt&&ot&&(R||!_t):be?Tt&&ot&&!_t&&(R||!ht):!_t&&!ht&&(R?Fe<=f:Fe<f);st?U=Oe+1:ee=Oe}return Ti(ee,4294967294)}function pu(S,f){for(var _=-1,R=S.length,U=0,ee=[];++_<R;){var ue=S[_],de=f?f(ue):ue;if(!_||!da(de,be)){var be=de;ee[U++]=ue===0?0:ue}}return ee}function oo(S){return typeof S=="number"?S:cs(S)?A:+S}function Bs(S){if(typeof S=="string")return S;if(tr(S))return gs(S,Bs)+"";if(cs(S))return gr?gr.call(S):"";var f=S+"";return f=="0"&&1/S==-1/0?"-0":f}function Nc(S,f,_){var R=-1,U=Yc,ee=S.length,ue=!0,de=[],be=de;if(_)ue=!1,U=nh;else if(ee>=200){var Ce=f?null:Lm(S);if(Ce)return Cl(Ce);ue=!1,U=rh,be=new Xt}else be=f?[]:de;e:for(;++R<ee;){var Oe=S[R],Fe=f?f(Oe):Oe;if(Oe=_||Oe!==0?Oe:0,ue&&Fe==Fe){for(var ot=be.length;ot--;)if(be[ot]===Fe)continue e;f&&be.push(Fe),de.push(Oe)}else U(be,Fe,_)||(be!==de&&be.push(Fe),de.push(Oe))}return de}function Ug(S,f){return(S=jm(S,f=mu(f,S)))==null||delete S[Ll(Ul(f))]}function Il(S,f,_,R){return ri(S,f,_(pc(S,f)),R)}function Oo(S,f,_,R){for(var U=S.length,ee=R?U:-1;(R?ee--:++ee<U)&&f(S[ee],ee,S););return _?Us(S,R?0:ee,R?ee+1:U):Us(S,R?ee+1:0,R?U:ee)}function $u(S,f){var _=S;return _ instanceof vn&&(_=_.value()),au(f,(function(R,U){return U.func.apply(U.thisArg,xi([R],U.args))}),_)}function Pc(S,f,_){var R=S.length;if(R<2)return R?Nc(S[0]):[];for(var U=-1,ee=zt(R);++U<R;)for(var ue=S[U],de=-1;++de<R;)de!=U&&(ee[U]=kl(ee[U]||ue,S[de],f,_));return Nc(Qr(ee,1),f,_)}function Rf(S,f,_){for(var R=-1,U=S.length,ee=f.length,ue={};++R<U;){var de=R<ee?f[R]:u;_(ue,S[R],de)}return ue}function Nl(S){return ii(S)?S:[]}function Ma(S){return typeof S=="function"?S:Jo}function mu(S,f){return tr(S)?S:Ep(S,f)?[S]:Hm(Wr(S))}var gu=Br;function Dc(S,f,_){var R=S.length;return _=_===u?R:_,!f&&_>=R?S:Us(S,f,_)}var Bg=Zv||function(S){return kn.clearTimeout(S)};function yr(S,f){if(f)return S.slice();var _=S.length,R=Ig?Ig(_):new S.constructor(_);return S.copy(R),R}function _p(S){var f=new S.constructor(S.byteLength);return new yf(f).set(new yf(S)),f}function Fg(S,f){var _=f?_p(S.buffer):S.buffer;return new S.constructor(_,S.byteOffset,S.length)}function Nm(S,f){if(S!==f){var _=S!==u,R=S===null,U=S==S,ee=cs(S),ue=f!==u,de=f===null,be=f==f,Ce=cs(f);if(!de&&!Ce&&!ee&&S>f||ee&&ue&&be&&!de&&!Ce||R&&ue&&be||!_&&be||!U)return 1;if(!R&&!ee&&!Ce&&S<f||Ce&&_&&U&&!R&&!ee||de&&_&&U||!ue&&U||!be)return-1}return 0}function gd(S,f,_,R){for(var U=-1,ee=S.length,ue=_.length,de=-1,be=f.length,Ce=Hr(ee-ue,0),Oe=zt(be+Ce),Fe=!R;++de<be;)Oe[de]=f[de];for(;++U<ue;)(Fe||U<ee)&&(Oe[_[U]]=S[U]);for(;Ce--;)Oe[de++]=S[U++];return Oe}function Wa(S,f,_,R){for(var U=-1,ee=S.length,ue=-1,de=_.length,be=-1,Ce=f.length,Oe=Hr(ee-de,0),Fe=zt(Oe+Ce),ot=!R;++U<Oe;)Fe[U]=S[U];for(var _t=U;++be<Ce;)Fe[_t+be]=f[be];for(;++ue<de;)(ot||U<ee)&&(Fe[_t+_[ue]]=S[U++]);return Fe}function As(S,f){var _=-1,R=S.length;for(f||(f=zt(R));++_<R;)f[_]=S[_];return f}function Lc(S,f,_,R){var U=!_;_||(_={});for(var ee=-1,ue=f.length;++ee<ue;){var de=f[ee],be=R?R(_[de],S[de],de,_,S):u;be===u&&(be=S[de]),U?Wo(_,de,be):el(_,de,be)}return _}function il(S,f){return function(_,R){var U=tr(_)?Mc:cp,ee=f?f():{};return U(_,S,sr(R,2),ee)}}function _d(S){return Br((function(f,_){var R=-1,U=_.length,ee=U>1?_[U-1]:u,ue=U>2?_[2]:u;for(ee=S.length>3&&typeof ee=="function"?(U--,ee):u,ue&&Ko(_[0],_[1],ue)&&(ee=U<3?u:ee,U=1),f=Kn(f);++R<U;){var de=_[R];de&&S(f,de,R,ee)}return f}))}function p_(S,f){return function(_,R){if(_==null)return _;if(!vc(_))return S(_,R);for(var U=_.length,ee=f?U:-1,ue=Kn(_);(f?ee--:++ee<U)&&R(ue[ee],ee,ue)!==!1;);return _}}function m_(S){return function(f,_,R){for(var U=-1,ee=Kn(f),ue=R(f),de=ue.length;de--;){var be=ue[S?de:++U];if(_(ee[be],be,ee)===!1)break}return f}}function lh(S){return function(f){var _=cd(f=Wr(f))?Cs(f):u,R=_?_[0]:f.charAt(0),U=_?Dc(_,1).join(""):f.slice(1);return R[S]()+U}}function _u(S){return function(f){return au(kr(Qg(f).replace(cr,"")),S,"")}}function ka(S){return function(){var f=arguments;switch(f.length){case 0:return new S;case 1:return new S(f[0]);case 2:return new S(f[0],f[1]);case 3:return new S(f[0],f[1],f[2]);case 4:return new S(f[0],f[1],f[2],f[3]);case 5:return new S(f[0],f[1],f[2],f[3],f[4]);case 6:return new S(f[0],f[1],f[2],f[3],f[4],f[5]);case 7:return new S(f[0],f[1],f[2],f[3],f[4],f[5],f[6])}var _=dc(S.prototype),R=S.apply(_,f);return bs(R)?R:_}}function Pm(S){return function(f,_,R){var U=Kn(f);if(!vc(f)){var ee=sr(_,3);f=ls(f),_=function(de){return ee(U[de],de,U)}}var ue=S(f,_,R);return ue>-1?U[ee?f[ue]:ue]:u}}function Cf(S){return _c((function(f){var _=f.length,R=_,U=Ji.prototype.thru;for(S&&f.reverse();R--;){var ee=f[R];if(typeof ee!="function")throw new Ii(h);if(U&&!ue&&Uc(ee)=="wrapper")var ue=new Ji([],!0)}for(R=ue?R:_;++R<_;){var de=Uc(ee=f[R]),be=de=="wrapper"?Af(ee):u;ue=be&&zg(be[0])&&be[1]==424&&!be[4].length&&be[9]==1?ue[Uc(be[0])].apply(ue,be[3]):ee.length==1&&zg(ee)?ue[de]():ue.thru(ee)}return function(){var Ce=arguments,Oe=Ce[0];if(ue&&Ce.length==1&&tr(Oe))return ue.plant(Oe).value();for(var Fe=0,ot=_?f[Fe].apply(this,Ce):Oe;++Fe<_;)ot=f[Fe].call(this,ot);return ot}}))}function vp(S,f,_,R,U,ee,ue,de,be,Ce){var Oe=f&v,Fe=1&f,ot=2&f,_t=24&f,Tt=512&f,ht=ot?u:ka(S);return function st(){for(var xt=arguments.length,mt=zt(xt),Et=xt;Et--;)mt[Et]=arguments[Et];if(_t)var kt=Zn(st),Bt=(function(hn,In){for(var On=hn.length,bn=0;On--;)hn[On]===In&&++bn;return bn})(mt,kt);if(R&&(mt=gd(mt,R,U,_t)),ee&&(mt=Wa(mt,ee,ue,_t)),xt-=Bt,_t&&xt<Ce){var It=uu(mt,kt);return gc(S,f,vp,st.placeholder,_,mt,It,de,be,Ce-xt)}var Nt=Fe?_:this,Zt=ot?Nt[S]:S;return xt=mt.length,de?mt=(function(hn,In){for(var On=hn.length,bn=Ti(In.length,On),ir=As(hn);bn--;){var mr=In[bn];hn[bn]=Vs(mr,On)?ir[mr]:u}return hn})(mt,de):Tt&&xt>1&&mt.reverse(),Oe&&be<xt&&(mt.length=be),this&&this!==kn&&this instanceof st&&(Zt=ht||ka(Zt)),Zt.apply(Nt,mt)}}function Dm(S,f){return function(_,R){return(function(U,ee,ue,de){return _s(U,(function(be,Ce,Oe){ee(de,ue(be),Ce,Oe)})),de})(_,S,f(R),{})}}function yp(S,f){return function(_,R){var U;if(_===u&&R===u)return f;if(_!==u&&(U=_),R!==u){if(U===u)return R;typeof _=="string"||typeof R=="string"?(_=Bs(_),R=Bs(R)):(_=oo(_),R=oo(R)),U=S(_,R)}return U}}function uh(S){return _c((function(f){return f=gs(f,wa(sr())),Br((function(_){var R=this;return S(f,(function(U){return Ha(U,R,_)}))}))}))}function sl(S,f){var _=(f=f===u?" ":Bs(f)).length;if(_<2)return _?fr(f,S):f;var R=fr(f,uc(S/Oi(f)));return cd(f)?Dc(Cs(R),0,S).join(""):R.slice(0,S)}function Io(S){return function(f,_,R){return R&&typeof R!="number"&&Ko(f,_,R)&&(_=R=u),f=yc(f),_===u?(_=f,f=0):_=yc(_),(function(U,ee,ue,de){for(var be=-1,Ce=Hr(uc((ee-U)/(ue||1)),0),Oe=zt(Ce);Ce--;)Oe[de?Ce:++be]=U,U+=ue;return Oe})(f,_,R=R===u?f<_?1:-1:yc(R),S)}}function Pl(S){return function(f,_){return typeof f=="string"&&typeof _=="string"||(f=An(f),_=An(_)),S(f,_)}}function gc(S,f,_,R,U,ee,ue,de,be,Ce){var Oe=8&f;f|=Oe?g:y,4&(f&=~(Oe?y:g))||(f&=-4);var Fe=[S,f,U,Oe?ee:u,Oe?ue:u,Oe?u:ee,Oe?u:ue,de,be,Ce],ot=_.apply(u,Fe);return zg(S)&&Ed(ot,Fe),ot.placeholder=R,v_(ot,S,f)}function jg(S){var f=qo[S];return function(_,R){if(_=An(_),(R=R==null?0:Ti(Xn(R),292))&&Ga(_)){var U=(Wr(_)+"e").split("e");return+((U=(Wr(f(U[0]+"e"+(+U[1]+R)))+"e").split("e"))[0]+"e"+(+U[1]-R))}return f(_)}}var Lm=Qc&&1/Cl(new Qc([,-0]))[1]==E?function(S){return new Qc(S)}:xu;function vs(S){return function(f){var _=ha(f);return _==X?gf(f):_==W?ym(f):(function(R,U){return gs(U,(function(ee){return[ee,R[ee]]}))})(f,S(f))}}function bo(S,f,_,R,U,ee,ue,de){var be=2&f;if(!be&&typeof S!="function")throw new Ii(h);var Ce=R?R.length:0;if(Ce||(f&=-97,R=U=u),ue=ue===u?ue:Hr(Xn(ue),0),de=de===u?de:Xn(de),Ce-=U?U.length:0,f&y){var Oe=R,Fe=U;R=U=u}var ot=be?u:Af(S),_t=[S,f,_,R,U,Oe,Fe,ee,ue,de];if(ot&&(function(ht,st){var xt=ht[1],mt=st[1],Et=xt|mt,kt=Et<131,Bt=mt==v&&xt==8||mt==v&&xt==x&&ht[7].length<=st[8]||mt==384&&st[7].length<=st[8]&&xt==8;if(!kt&&!Bt)return ht;1&mt&&(ht[2]=st[2],Et|=1&xt?0:4);var It=st[3];if(It){var Nt=ht[3];ht[3]=Nt?gd(Nt,It,st[4]):It,ht[4]=Nt?uu(ht[3],m):st[4]}(It=st[5])&&(Nt=ht[5],ht[5]=Nt?Wa(Nt,It,st[6]):It,ht[6]=Nt?uu(ht[5],m):st[6]),(It=st[7])&&(ht[7]=It),mt&v&&(ht[8]=ht[8]==null?st[8]:Ti(ht[8],st[8])),ht[9]==null&&(ht[9]=st[9]),ht[0]=st[0],ht[1]=Et})(_t,ot),S=_t[0],f=_t[1],_=_t[2],R=_t[3],U=_t[4],!(de=_t[9]=_t[9]===u?be?0:S.length:Hr(_t[9]-Ce,0))&&24&f&&(f&=-25),f&&f!=1)Tt=f==8||f==p?(function(ht,st,xt){var mt=ka(ht);return function Et(){for(var kt=arguments.length,Bt=zt(kt),It=kt,Nt=Zn(Et);It--;)Bt[It]=arguments[It];var Zt=kt<3&&Bt[0]!==Nt&&Bt[kt-1]!==Nt?[]:uu(Bt,Nt);return(kt-=Zt.length)<xt?gc(ht,st,vp,Et.placeholder,u,Bt,Zt,u,u,xt-kt):Ha(this&&this!==kn&&this instanceof Et?mt:ht,this,Bt)}})(S,f,de):f!=g&&f!=33||U.length?vp.apply(u,_t):(function(ht,st,xt,mt){var Et=1&st,kt=ka(ht);return function Bt(){for(var It=-1,Nt=arguments.length,Zt=-1,hn=mt.length,In=zt(hn+Nt),On=this&&this!==kn&&this instanceof Bt?kt:ht;++Zt<hn;)In[Zt]=mt[Zt];for(;Nt--;)In[Zt++]=arguments[++It];return Ha(On,Et?xt:this,In)}})(S,f,_,R);else var Tt=(function(ht,st,xt){var mt=1&st,Et=ka(ht);return function kt(){return(this&&this!==kn&&this instanceof kt?Et:ht).apply(mt?xt:this,arguments)}})(S,f,_);return v_((ot?Im:Ed)(Tt,_t),S,f)}function fh(S,f,_,R){return S===u||da(S,jn[_])&&!Yn.call(R,_)?f:S}function hh(S,f,_,R,U,ee){return bs(S)&&bs(f)&&(ee.set(f,S),dp(S,f,u,hh,ee),ee.delete(f)),S}function vd(S){return Fl(S)?u:S}function Oa(S,f,_,R,U,ee){var ue=1&_,de=S.length,be=f.length;if(de!=be&&!(ue&&be>de))return!1;var Ce=ee.get(S),Oe=ee.get(f);if(Ce&&Oe)return Ce==f&&Oe==S;var Fe=-1,ot=!0,_t=2&_?new Xt:u;for(ee.set(S,f),ee.set(f,S);++Fe<de;){var Tt=S[Fe],ht=f[Fe];if(R)var st=ue?R(ht,Tt,Fe,f,S,ee):R(Tt,ht,Fe,S,f,ee);if(st!==u){if(st)continue;ot=!1;break}if(_t){if(!s_(f,(function(xt,mt){if(!rh(_t,mt)&&(Tt===xt||U(Tt,xt,_,R,ee)))return _t.push(mt)}))){ot=!1;break}}else if(Tt!==ht&&!U(Tt,ht,_,R,ee)){ot=!1;break}}return ee.delete(S),ee.delete(f),ot}function _c(S){return qg(Hg(S,u,E_),S+"")}function Um(S){return wf(S,ls,Bm)}function bp(S){return wf(S,Mr,fa)}var Af=Sf?function(S){return Sf.get(S)}:xu;function Uc(S){for(var f=S.name+"",_=Hi[f],R=Yn.call(Hi,f)?_.length:0;R--;){var U=_[R],ee=U.func;if(ee==null||ee==S)return U.name}return f}function Zn(S){return(Yn.call(he,"placeholder")?he:S).placeholder}function sr(){var S=he.iteratee||xo;return S=S===xo?Om:S,arguments.length?S(arguments[0],arguments[1]):S}function yd(S,f){var _,R,U=S.__data__;return((R=typeof(_=f))=="string"||R=="number"||R=="symbol"||R=="boolean"?_!=="__proto__":_===null)?U[typeof f=="string"?"string":"hash"]:U.map}function Bc(S){for(var f=ls(S),_=f.length;_--;){var R=f[_],U=S[R];f[_]=[R,U,Fm(U)]}return f}function Fc(S,f){var _=(function(R,U){return R==null?u:R[U]})(S,f);return ko(_)?_:u}var Bm=Bu?function(S){return S==null?[]:(S=Kn(S),Xc(Bu(S),(function(f){return xm.call(S,f)})))}:Ku,fa=Bu?function(S){for(var f=[];S;)xi(f,Bm(S)),S=Uu(S);return f}:Ku,ha=wi;function dh(S,f,_){for(var R=-1,U=(f=mu(f,S)).length,ee=!1;++R<U;){var ue=Ll(f[R]);if(!(ee=S!=null&&_(S,ue)))break;S=S[ue]}return ee||++R!=U?ee:!!(U=S==null?0:S.length)&&Ia(U)&&Vs(ue,U)&&(tr(S)||mh(S))}function g_(S){return typeof S.constructor!="function"||Ys(S)?{}:dc(Uu(S))}function vu(S){return tr(S)||mh(S)||!!(Ef&&S&&S[Ef])}function Vs(S,f){var _=typeof S;return!!(f=f??C)&&(_=="number"||_!="symbol"&&qe.test(S))&&S>-1&&S%1==0&&S<f}function Ko(S,f,_){if(!bs(_))return!1;var R=typeof f;return!!(R=="number"?vc(_)&&Vs(f,_.length):R=="string"&&f in _)&&da(_[f],S)}function Ep(S,f){if(tr(S))return!1;var _=typeof S;return!(_!="number"&&_!="symbol"&&_!="boolean"&&S!=null&&!cs(S))||tt.test(S)||!Ze.test(S)||f!=null&&S in Kn(f)}function zg(S){var f=Uc(S),_=he[f];if(typeof _!="function"||!(f in vn.prototype))return!1;if(S===_)return!0;var R=Af(_);return!!R&&S===R[0]}(ss&&ha(new ss(new ArrayBuffer(1)))!=ae||Fu&&ha(new Fu)!=X||fc&&ha(fc.resolve())!=q||Qc&&ha(new Qc)!=W||ju&&ha(new ju)!=ne)&&(ha=function(S){var f=wi(S),_=f==j?S.constructor:u,R=_?Ka(_):"";if(R)switch(R){case l_:return ae;case os:return X;case u_:return q;case ca:return W;case ud:return ne}return f});var Sp=Ic?Ya:Eh;function Ys(S){var f=S&&S.constructor;return S===(typeof f=="function"&&f.prototype||jn)}function Fm(S){return S==S&&!bs(S)}function __(S,f){return function(_){return _!=null&&_[S]===f&&(f!==u||S in Kn(_))}}function Hg(S,f,_){return f=Hr(f===u?S.length-1:f,0),function(){for(var R=arguments,U=-1,ee=Hr(R.length-f,0),ue=zt(ee);++U<ee;)ue[U]=R[f+U];U=-1;for(var de=zt(f+1);++U<f;)de[U]=R[U];return de[f]=_(ue),Ha(S,this,de)}}function jm(S,f){return f.length<2?S:pc(S,Us(f,0,-1))}function bd(S,f){if((f!=="constructor"||typeof S[f]!="function")&&f!="__proto__")return S[f]}var Ed=zm(Im),Dl=Tm||function(S,f){return kn.setTimeout(S,f)},qg=zm(wr);function v_(S,f,_){var R=f+"";return qg(S,(function(U,ee){var ue=ee.length;if(!ue)return U;var de=ue-1;return ee[de]=(ue>1?"& ":"")+ee[de],ee=ee.join(ue>2?", ":" "),U.replace(Q,`{
/* [wrapped with `+ee+`] */
`)})(R,(function(U,ee){return lc(M,(function(ue){var de="_."+ue[0];ee&ue[1]&&!Yc(U,de)&&U.push(de)})),U.sort()})((function(U){var ee=U.match(le);return ee?ee[1].split(we):[]})(R),_)))}function zm(S){var f=0,_=0;return function(){var R=wm(),U=16-(R-_);if(_=R,U>0){if(++f>=800)return arguments[0]}else f=0;return S.apply(u,arguments)}}function xp(S,f){var _=-1,R=S.length,U=R-1;for(f=f===u?R:f;++_<f;){var ee=Gu(_,U),ue=S[ee];S[ee]=S[_],S[_]=ue}return S.length=f,S}var Hm=(function(S){var f=Mf(S,(function(R){return _.size===500&&_.clear(),R})),_=f.cache;return f})((function(S){var f=[];return S.charCodeAt(0)===46&&f.push(""),S.replace(Ft,(function(_,R,U,ee){f.push(U?ee.replace(ye,"$1"):R||_)})),f}));function Ll(S){if(typeof S=="string"||cs(S))return S;var f=S+"";return f=="0"&&1/S==-1/0?"-0":f}function Ka(S){if(S!=null){try{return qs.call(S)}catch{}try{return S+""}catch{}}return""}function yu(S){if(S instanceof vn)return S.clone();var f=new Ji(S.__wrapped__,S.__chain__);return f.__actions__=As(S.__actions__),f.__index__=S.__index__,f.__values__=S.__values__,f}var qm=Br((function(S,f){return ii(S)?kl(S,Qr(f,1,ii,!0)):[]})),y_=Br((function(S,f){var _=Ul(f);return ii(_)&&(_=u),ii(S)?kl(S,Qr(f,1,ii,!0),sr(_,2)):[]})),Vm=Br((function(S,f){var _=Ul(f);return ii(_)&&(_=u),ii(S)?kl(S,Qr(f,1,ii,!0),u,_):[]}));function Vg(S,f,_){var R=S==null?0:S.length;if(!R)return-1;var U=_==null?0:Xn(_);return U<0&&(U=Hr(R+U,0)),cu(S,sr(f,3),U)}function b_(S,f,_){var R=S==null?0:S.length;if(!R)return-1;var U=R-1;return _!==u&&(U=Xn(_),U=_<0?Hr(R+U,0):Ti(U,R-1)),cu(S,sr(f,3),U,!0)}function E_(S){return S!=null&&S.length?Qr(S,1):[]}function Gg(S){return S&&S.length?S[0]:u}var Qv=Br((function(S){var f=gs(S,Nl);return f.length&&f[0]===S[0]?dd(f):[]})),Gm=Br((function(S){var f=Ul(S),_=gs(S,Nl);return f===Ul(_)?f=u:_.pop(),_.length&&_[0]===S[0]?dd(_,sr(f,2)):[]})),ey=Br((function(S){var f=Ul(S),_=gs(S,Nl);return(f=typeof f=="function"?f:u)&&_.pop(),_.length&&_[0]===S[0]?dd(_,u,f):[]}));function Ul(S){var f=S==null?0:S.length;return f?S[f-1]:u}var Xa=Br($m);function $m(S,f){return S&&S.length&&f&&f.length?gp(S,f):S}var S_=_c((function(S,f){var _=S==null?0:S.length,R=ah(S,f);return Ol(S,gs(f,(function(U){return Vs(U,_)?+U:U})).sort(Nm)),R}));function x_(S){return S==null?S:Tn.call(S)}var T_=Br((function(S){return Nc(Qr(S,1,ii,!0))})),Tb=Br((function(S){var f=Ul(S);return ii(f)&&(f=u),Nc(Qr(S,1,ii,!0),sr(f,2))})),wb=Br((function(S){var f=Ul(S);return f=typeof f=="function"?f:u,Nc(Qr(S,1,ii,!0),u,f)}));function w_(S){if(!S||!S.length)return[];var f=0;return S=Xc(S,(function(_){if(ii(_))return f=Hr(_.length,f),!0})),mf(f,(function(_){return gs(S,ad(_))}))}function $g(S,f){if(!S||!S.length)return[];var _=w_(S);return f==null?_:gs(_,(function(R){return Ha(f,u,R)}))}var R_=Br((function(S,f){return ii(S)?kl(S,f):[]})),Rb=Br((function(S){return Pc(Xc(S,ii))})),Cb=Br((function(S){var f=Ul(S);return ii(f)&&(f=u),Pc(Xc(S,ii),sr(f,2))})),C_=Br((function(S){var f=Ul(S);return f=typeof f=="function"?f:u,Pc(Xc(S,ii),u,f)})),Ab=Br(w_),Mb=Br((function(S){var f=S.length,_=f>1?S[f-1]:u;return _=typeof _=="function"?(S.pop(),_):u,$g(S,_)}));function ol(S){var f=he(S);return f.__chain__=!0,f}function Tp(S,f){return f(S)}var wp=_c((function(S){var f=S.length,_=f?S[0]:0,R=this.__wrapped__,U=function(ee){return ah(ee,S)};return!(f>1||this.__actions__.length)&&R instanceof vn&&Vs(_)?((R=R.slice(_,+_+(f?1:0))).__actions__.push({func:Tp,args:[U],thisArg:u}),new Ji(R,this.__chain__).thru((function(ee){return f&&!ee.length&&ee.push(u),ee}))):this.thru(U)})),ty=il((function(S,f,_){Yn.call(S,_)?++S[_]:Wo(S,_,1)})),ny=Pm(Vg),ry=Pm(b_);function iy(S,f){return(tr(S)?lc:so)(S,sr(f,3))}function Wm(S,f){return(tr(S)?kc:Mm)(S,sr(f,3))}var Rp=il((function(S,f,_){Yn.call(S,_)?S[_].push(f):Wo(S,_,[f])})),jc=Br((function(S,f,_){var R=-1,U=typeof f=="function",ee=vc(S)?zt(S.length):[];return so(S,(function(ue){ee[++R]=U?Ha(f,ue,_):mc(ue,f,_)})),ee})),Bl=il((function(S,f,_){Wo(S,_,f)}));function qi(S,f){return(tr(S)?gs:Lg)(S,sr(f,3))}var Km=il((function(S,f,_){S[_?0:1].push(f)}),(function(){return[[],[]]})),sy=Br((function(S,f){if(S==null)return[];var _=f.length;return _>1&&Ko(S,f[0],f[1])?f=[]:_>2&&Ko(f[0],f[1],f[2])&&(f=[f[0]]),Vu(S,Qr(f,1),[])})),Xo=Jv||function(){return kn.Date.now()};function Sd(S,f,_){return f=_?u:f,f=S&&f==null?S.length:f,bo(S,v,u,u,u,u,f)}function Wg(S,f){var _;if(typeof f!="function")throw new Ii(h);return S=Xn(S),function(){return--S>0&&(_=f.apply(this,arguments)),S<=1&&(f=u),_}}var Kg=Br((function(S,f,_){var R=1;if(_.length){var U=uu(_,Zn(Kg));R|=g}return bo(S,R,f,_,U)})),Xg=Br((function(S,f,_){var R=3;if(_.length){var U=uu(_,Zn(Xg));R|=g}return bo(f,R,S,_,U)}));function Yg(S,f,_){var R,U,ee,ue,de,be,Ce=0,Oe=!1,Fe=!1,ot=!0;if(typeof S!="function")throw new Ii(h);function _t(mt){var Et=R,kt=U;return R=U=u,Ce=mt,ue=S.apply(kt,Et)}function Tt(mt){var Et=mt-be;return be===u||Et>=f||Et<0||Fe&&mt-Ce>=ee}function ht(){var mt=Xo();if(Tt(mt))return st(mt);de=Dl(ht,(function(Et){var kt=f-(Et-be);return Fe?Ti(kt,ee-(Et-Ce)):kt})(mt))}function st(mt){return de=u,ot&&R?_t(mt):(R=U=u,ue)}function xt(){var mt=Xo(),Et=Tt(mt);if(R=arguments,U=this,be=mt,Et){if(de===u)return(function(kt){return Ce=kt,de=Dl(ht,f),Oe?_t(kt):ue})(be);if(Fe)return Bg(de),de=Dl(ht,f),_t(be)}return de===u&&(de=Dl(ht,f)),ue}return f=An(f)||0,bs(_)&&(Oe=!!_.leading,ee=(Fe="maxWait"in _)?Hr(An(_.maxWait)||0,f):ee,ot="trailing"in _?!!_.trailing:ot),xt.cancel=function(){de!==u&&Bg(de),Ce=0,R=be=U=de=u},xt.flush=function(){return de===u?ue:st(Xo())},xt}var Zg=Br((function(S,f){return lp(S,1,f)})),Cp=Br((function(S,f,_){return lp(S,An(f)||0,_)}));function Mf(S,f){if(typeof S!="function"||f!=null&&typeof f!="function")throw new Ii(h);var _=function(){var R=arguments,U=f?f.apply(this,R):R[0],ee=_.cache;if(ee.has(U))return ee.get(U);var ue=S.apply(this,R);return _.cache=ee.set(U,ue)||ee,ue};return _.cache=new(Mf.Cache||Ni),_}function Eo(S){if(typeof S!="function")throw new Ii(h);return function(){var f=arguments;switch(f.length){case 0:return!S.call(this);case 1:return!S.call(this,f[0]);case 2:return!S.call(this,f[0],f[1]);case 3:return!S.call(this,f[0],f[1],f[2])}return!S.apply(this,f)}}Mf.Cache=Ni;var Yo=gu((function(S,f){var _=(f=f.length==1&&tr(f[0])?gs(f[0],wa(sr())):gs(Qr(f,1),wa(sr()))).length;return Br((function(R){for(var U=-1,ee=Ti(R.length,_);++U<ee;)R[U]=f[U].call(this,R[U]);return Ha(S,this,R)}))})),Jg=Br((function(S,f){var _=uu(f,Zn(Jg));return bo(S,g,u,f,_)})),ph=Br((function(S,f){var _=uu(f,Zn(ph));return bo(S,y,u,f,_)})),Xm=_c((function(S,f){return bo(S,x,u,u,u,f)}));function da(S,f){return S===f||S!=S&&f!=f}var ys=Pl(hd),kb=Pl((function(S,f){return S>=f})),mh=Pn((function(){return arguments})())?Pn:function(S){return _r(S)&&Yn.call(S,"callee")&&!xm.call(S,"callee")},tr=zt.isArray,ar=Rs?wa(Rs):function(S){return _r(S)&&wi(S)==ie};function vc(S){return S!=null&&Ia(S.length)&&!Ya(S)}function ii(S){return _r(S)&&vc(S)}var as=ld||Eh,Fs=th?wa(th):function(S){return _r(S)&&wi(S)==K};function xd(S){if(!_r(S))return!1;var f=wi(S);return f==P||f=="[object DOMException]"||typeof S.message=="string"&&typeof S.name=="string"&&!Fl(S)}function Ya(S){if(!bs(S))return!1;var f=wi(S);return f==F||f==N||f=="[object AsyncFunction]"||f=="[object Proxy]"}function Zs(S){return typeof S=="number"&&S==Xn(S)}function Ia(S){return typeof S=="number"&&S>-1&&S%1==0&&S<=C}function bs(S){var f=typeof S;return S!=null&&(f=="object"||f=="function")}function _r(S){return S!=null&&typeof S=="object"}var Pi=mm?wa(mm):function(S){return _r(S)&&ha(S)==X};function Js(S){return typeof S=="number"||_r(S)&&wi(S)==G}function Fl(S){if(!_r(S)||wi(S)!=j)return!1;var f=Uu(S);if(f===null)return!0;var _=Yn.call(f,"constructor")&&f.constructor;return typeof _=="function"&&_ instanceof _&&qs.call(_)==a_}var di=np?wa(np):function(S){return _r(S)&&wi(S)==te},Qs=rp?wa(rp):function(S){return _r(S)&&ha(S)==W};function bu(S){return typeof S=="string"||!tr(S)&&_r(S)&&wi(S)==$}function cs(S){return typeof S=="symbol"||_r(S)&&wi(S)==J}var Qi=od?wa(od):function(S){return _r(S)&&Ia(S.length)&&!!pr[wi(S)]},si=Pl(fp),ao=Pl((function(S,f){return S<=f}));function zc(S){if(!S)return[];if(vc(S))return bu(S)?Cs(S):As(S);if(Jc&&S[Jc])return(function(_){for(var R,U=[];!(R=_.next()).done;)U.push(R.value);return U})(S[Jc]());var f=ha(S);return(f==X?gf:f==W?Cl:jl)(S)}function yc(S){return S?(S=An(S))===E||S===-1/0?17976931348623157e292*(S<0?-1:1):S==S?S:0:S===0?S:0}function Xn(S){var f=yc(S),_=f%1;return f==f?_?f-_:f:0}function Wn(S){return S?$a(Xn(S),0,k):0}function An(S){if(typeof S=="number")return S;if(cs(S))return A;if(bs(S)){var f=typeof S.valueOf=="function"?S.valueOf():S;S=bs(f)?f+"":f}if(typeof S!="string")return S===0?S:+S;S=sp(S);var _=Ve.test(S);return _||lt.test(S)?io(S.slice(2),_?2:8):We.test(S)?A:+S}function eo(S){return Lc(S,Mr(S))}function Wr(S){return S==null?"":Bs(S)}var Di=_d((function(S,f){if(Ys(f)||vc(f))Lc(f,ls(f),S);else for(var _ in f)Yn.call(f,_)&&el(S,_,f[_])})),al=_d((function(S,f){Lc(f,Mr(f),S)})),cl=_d((function(S,f,_,R){Lc(f,Mr(f),S,R)})),ll=_d((function(S,f,_,R){Lc(f,ls(f),S,R)})),gh=_c(ah),Ap=Br((function(S,f){S=Kn(S);var _=-1,R=f.length,U=R>2?f[2]:u;for(U&&Ko(f[0],f[1],U)&&(R=1);++_<R;)for(var ee=f[_],ue=Mr(ee),de=-1,be=ue.length;++de<be;){var Ce=ue[de],Oe=S[Ce];(Oe===u||da(Oe,jn[Ce])&&!Yn.call(S,Ce))&&(S[Ce]=ee[Ce])}return S})),A_=Br((function(S){return S.push(u,hh),Ha(kp,u,S)}));function Mp(S,f,_){var R=S==null?u:pc(S,f);return R===u?_:R}function Td(S,f){return S!=null&&dh(S,f,xb)}var Zo=Dm((function(S,f,_){f!=null&&typeof f.toString!="function"&&(f=du.call(f)),S[f]=_}),yh(Jo)),pa=Dm((function(S,f,_){f!=null&&typeof f.toString!="function"&&(f=du.call(f)),Yn.call(S,f)?S[f].push(_):S[f]=[_]}),sr),Eu=Br(mc);function ls(S){return vc(S)?Pg(S):up(S)}function Mr(S){return vc(S)?Pg(S,!0):d_(S)}var co=_d((function(S,f,_){dp(S,f,_)})),kp=_d((function(S,f,_,R){dp(S,f,_,R)})),Wu=_c((function(S,f){var _={};if(S==null)return _;var R=!1;f=gs(f,(function(ee){return ee=mu(ee,S),R||(R=ee.length>1),ee})),Lc(S,bp(S),_),R&&(_=Ls(_,7,vd));for(var U=f.length;U--;)Ug(_,f[U]);return _})),Ms=_c((function(S,f){return S==null?{}:(function(_,R){return mp(_,R,(function(U,ee){return Td(_,ee)}))})(S,f)}));function ma(S,f){if(S==null)return{};var _=gs(bp(S),(function(R){return[R]}));return f=sr(f),mp(S,_,(function(R,U){return f(R,U[0])}))}var wd=vs(ls),kf=vs(Mr);function jl(S){return S==null?[]:qa(S,ls(S))}var Su=_u((function(S,f,_){return f=f.toLowerCase(),S+(_?Of(f):f)}));function Of(S){return qr(Wr(S).toLowerCase())}function Qg(S){return(S=Wr(S))&&S.replace(rt,o_).replace(Fn,"")}var _h=_u((function(S,f,_){return S+(_?"-":"")+f.toLowerCase()})),Op=_u((function(S,f,_){return S+(_?" ":"")+f.toLowerCase()})),ul=lh("toLowerCase"),fl=_u((function(S,f,_){return S+(_?"_":"")+f.toLowerCase()})),So=_u((function(S,f,_){return S+(_?" ":"")+qr(f)})),vh=_u((function(S,f,_){return S+(_?" ":"")+f.toUpperCase()})),qr=lh("toUpperCase");function kr(S,f,_){return S=Wr(S),(f=_?u:f)===u?(function(R){return Ar.test(R)})(S)?(function(R){return R.match(Dr)||[]})(S):(function(R){return R.match(Me)||[]})(S):S.match(f)||[]}var Gs=Br((function(S,f){try{return Ha(S,u,f)}catch(_){return xd(_)?_:new Cn(_)}})),zl=_c((function(S,f){return lc(f,(function(_){_=Ll(_),Wo(S,_,Kg(S[_],S))})),S}));function yh(S){return function(){return S}}var If=Cf(),Ym=Cf(!0);function Jo(S){return S}function xo(S){return Om(typeof S=="function"?S:Ls(S,1))}var Qo=Br((function(S,f){return function(_){return mc(_,S,f)}})),Za=Br((function(S,f){return function(_){return mc(S,_,f)}}));function ea(S,f,_){var R=ls(f),U=Hu(f,R);_!=null||bs(f)&&(U.length||!R.length)||(_=f,f=S,S=this,U=Hu(f,ls(f)));var ee=!(bs(_)&&"chain"in _&&!_.chain),ue=Ya(S);return lc(U,(function(de){var be=f[de];S[de]=be,ue&&(S.prototype[de]=function(){var Ce=this.__chain__;if(ee||Ce){var Oe=S(this.__wrapped__);return(Oe.__actions__=As(this.__actions__)).push({func:be,args:arguments,thisArg:S}),Oe.__chain__=Ce,Oe}return be.apply(S,xi([this.value()],arguments))})})),S}function xu(){}var ci=uh(gs),bh=uh(gm),M_=uh(s_);function Rd(S){return Ep(S)?ad(Ll(S)):(function(f){return function(_){return pc(_,f)}})(S)}var e0=Io(),ga=Io(!0);function Ku(){return[]}function Eh(){return!1}var L=yp((function(S,f){return S+f}),0),w=jg("ceil"),O=yp((function(S,f){return S/f}),1),B=jg("floor"),V,Y=yp((function(S,f){return S*f}),1),se=jg("round"),me=yp((function(S,f){return S-f}),0);return he.after=function(S,f){if(typeof f!="function")throw new Ii(h);return S=Xn(S),function(){if(--S<1)return f.apply(this,arguments)}},he.ary=Sd,he.assign=Di,he.assignIn=al,he.assignInWith=cl,he.assignWith=ll,he.at=gh,he.before=Wg,he.bind=Kg,he.bindAll=zl,he.bindKey=Xg,he.castArray=function(){if(!arguments.length)return[];var S=arguments[0];return tr(S)?S:[S]},he.chain=ol,he.chunk=function(S,f,_){f=(_?Ko(S,f,_):f===u)?1:Hr(Xn(f),0);var R=S==null?0:S.length;if(!R||f<1)return[];for(var U=0,ee=0,ue=zt(uc(R/f));U<R;)ue[ee++]=Us(S,U,U+=f);return ue},he.compact=function(S){for(var f=-1,_=S==null?0:S.length,R=0,U=[];++f<_;){var ee=S[f];ee&&(U[R++]=ee)}return U},he.concat=function(){var S=arguments.length;if(!S)return[];for(var f=zt(S-1),_=arguments[0],R=S;R--;)f[R-1]=arguments[R];return xi(tr(_)?As(_):[_],Qr(f,1))},he.cond=function(S){var f=S==null?0:S.length,_=sr();return S=f?gs(S,(function(R){if(typeof R[1]!="function")throw new Ii(h);return[_(R[0]),R[1]]})):[],Br((function(R){for(var U=-1;++U<f;){var ee=S[U];if(Ha(ee[0],this,R))return Ha(ee[1],this,R)}}))},he.conforms=function(S){return(function(f){var _=ls(f);return function(R){return tl(R,f,_)}})(Ls(S,1))},he.constant=yh,he.countBy=ty,he.create=function(S,f){var _=dc(S);return f==null?_:la(_,f)},he.curry=function S(f,_,R){var U=bo(f,8,u,u,u,u,u,_=R?u:_);return U.placeholder=S.placeholder,U},he.curryRight=function S(f,_,R){var U=bo(f,p,u,u,u,u,u,_=R?u:_);return U.placeholder=S.placeholder,U},he.debounce=Yg,he.defaults=Ap,he.defaultsDeep=A_,he.defer=Zg,he.delay=Cp,he.difference=qm,he.differenceBy=y_,he.differenceWith=Vm,he.drop=function(S,f,_){var R=S==null?0:S.length;return R?Us(S,(f=_||f===u?1:Xn(f))<0?0:f,R):[]},he.dropRight=function(S,f,_){var R=S==null?0:S.length;return R?Us(S,0,(f=R-(f=_||f===u?1:Xn(f)))<0?0:f):[]},he.dropRightWhile=function(S,f){return S&&S.length?Oo(S,sr(f,3),!0,!0):[]},he.dropWhile=function(S,f){return S&&S.length?Oo(S,sr(f,3),!0):[]},he.fill=function(S,f,_,R){var U=S==null?0:S.length;return U?(_&&typeof _!="number"&&Ko(S,f,_)&&(_=0,R=U),(function(ee,ue,de,be){var Ce=ee.length;for((de=Xn(de))<0&&(de=-de>Ce?0:Ce+de),(be=be===u||be>Ce?Ce:Xn(be))<0&&(be+=Ce),be=de>be?0:Wn(be);de<be;)ee[de++]=ue;return ee})(S,f,_,R)):[]},he.filter=function(S,f){return(tr(S)?Xc:km)(S,sr(f,3))},he.flatMap=function(S,f){return Qr(qi(S,f),1)},he.flatMapDeep=function(S,f){return Qr(qi(S,f),E)},he.flatMapDepth=function(S,f,_){return _=_===u?1:Xn(_),Qr(qi(S,f),_)},he.flatten=E_,he.flattenDeep=function(S){return S!=null&&S.length?Qr(S,E):[]},he.flattenDepth=function(S,f){return S!=null&&S.length?Qr(S,f=f===u?1:Xn(f)):[]},he.flip=function(S){return bo(S,512)},he.flow=If,he.flowRight=Ym,he.fromPairs=function(S){for(var f=-1,_=S==null?0:S.length,R={};++f<_;){var U=S[f];R[U[0]]=U[1]}return R},he.functions=function(S){return S==null?[]:Hu(S,ls(S))},he.functionsIn=function(S){return S==null?[]:Hu(S,Mr(S))},he.groupBy=Rp,he.initial=function(S){return S!=null&&S.length?Us(S,0,-1):[]},he.intersection=Qv,he.intersectionBy=Gm,he.intersectionWith=ey,he.invert=Zo,he.invertBy=pa,he.invokeMap=jc,he.iteratee=xo,he.keyBy=Bl,he.keys=ls,he.keysIn=Mr,he.map=qi,he.mapKeys=function(S,f){var _={};return f=sr(f,3),_s(S,(function(R,U,ee){Wo(_,f(R,U,ee),R)})),_},he.mapValues=function(S,f){var _={};return f=sr(f,3),_s(S,(function(R,U,ee){Wo(_,U,f(R,U,ee))})),_},he.matches=function(S){return hp(Ls(S,1))},he.matchesProperty=function(S,f){return Ca(S,Ls(f,1))},he.memoize=Mf,he.merge=co,he.mergeWith=kp,he.method=Qo,he.methodOf=Za,he.mixin=ea,he.negate=Eo,he.nthArg=function(S){return S=Xn(S),Br((function(f){return pp(f,S)}))},he.omit=Wu,he.omitBy=function(S,f){return ma(S,Eo(sr(f)))},he.once=function(S){return Wg(2,S)},he.orderBy=function(S,f,_,R){return S==null?[]:(tr(f)||(f=f==null?[]:[f]),tr(_=R?u:_)||(_=_==null?[]:[_]),Vu(S,f,_))},he.over=ci,he.overArgs=Yo,he.overEvery=bh,he.overSome=M_,he.partial=Jg,he.partialRight=ph,he.partition=Km,he.pick=Ms,he.pickBy=ma,he.property=Rd,he.propertyOf=function(S){return function(f){return S==null?u:pc(S,f)}},he.pull=Xa,he.pullAll=$m,he.pullAllBy=function(S,f,_){return S&&S.length&&f&&f.length?gp(S,f,sr(_,2)):S},he.pullAllWith=function(S,f,_){return S&&S.length&&f&&f.length?gp(S,f,u,_):S},he.pullAt=S_,he.range=e0,he.rangeRight=ga,he.rearg=Xm,he.reject=function(S,f){return(tr(S)?Xc:km)(S,Eo(sr(f,3)))},he.remove=function(S,f){var _=[];if(!S||!S.length)return _;var R=-1,U=[],ee=S.length;for(f=sr(f,3);++R<ee;){var ue=S[R];f(ue,R,S)&&(_.push(ue),U.push(R))}return Ol(S,U),_},he.rest=function(S,f){if(typeof S!="function")throw new Ii(h);return Br(S,f=f===u?f:Xn(f))},he.reverse=x_,he.sampleSize=function(S,f,_){return f=(_?Ko(S,f,_):f===u)?1:Xn(f),(tr(S)?ap:nl)(S,f)},he.set=function(S,f,_){return S==null?S:ri(S,f,_)},he.setWith=function(S,f,_,R){return R=typeof R=="function"?R:u,S==null?S:ri(S,f,_,R)},he.shuffle=function(S){return(tr(S)?Am:rl)(S)},he.slice=function(S,f,_){var R=S==null?0:S.length;return R?(_&&typeof _!="number"&&Ko(S,f,_)?(f=0,_=R):(f=f==null?0:Xn(f),_=_===u?R:Xn(_)),Us(S,f,_)):[]},he.sortBy=sy,he.sortedUniq=function(S){return S&&S.length?pu(S):[]},he.sortedUniqBy=function(S,f){return S&&S.length?pu(S,sr(f,2)):[]},he.split=function(S,f,_){return _&&typeof _!="number"&&Ko(S,f,_)&&(f=_=u),(_=_===u?k:_>>>0)?(S=Wr(S))&&(typeof f=="string"||f!=null&&!di(f))&&!(f=Bs(f))&&cd(S)?Dc(Cs(S),0,_):S.split(f,_):[]},he.spread=function(S,f){if(typeof S!="function")throw new Ii(h);return f=f==null?0:Hr(Xn(f),0),Br((function(_){var R=_[f],U=Dc(_,0,f);return R&&xi(U,R),Ha(S,this,U)}))},he.tail=function(S){var f=S==null?0:S.length;return f?Us(S,1,f):[]},he.take=function(S,f,_){return S&&S.length?Us(S,0,(f=_||f===u?1:Xn(f))<0?0:f):[]},he.takeRight=function(S,f,_){var R=S==null?0:S.length;return R?Us(S,(f=R-(f=_||f===u?1:Xn(f)))<0?0:f,R):[]},he.takeRightWhile=function(S,f){return S&&S.length?Oo(S,sr(f,3),!1,!0):[]},he.takeWhile=function(S,f){return S&&S.length?Oo(S,sr(f,3)):[]},he.tap=function(S,f){return f(S),S},he.throttle=function(S,f,_){var R=!0,U=!0;if(typeof S!="function")throw new Ii(h);return bs(_)&&(R="leading"in _?!!_.leading:R,U="trailing"in _?!!_.trailing:U),Yg(S,f,{leading:R,maxWait:f,trailing:U})},he.thru=Tp,he.toArray=zc,he.toPairs=wd,he.toPairsIn=kf,he.toPath=function(S){return tr(S)?gs(S,Ll):cs(S)?[S]:As(Hm(Wr(S)))},he.toPlainObject=eo,he.transform=function(S,f,_){var R=tr(S),U=R||as(S)||Qi(S);if(f=sr(f,4),_==null){var ee=S&&S.constructor;_=U?R?new ee:[]:bs(S)&&Ya(ee)?dc(Uu(S)):{}}return(U?lc:_s)(S,(function(ue,de,be){return f(_,ue,de,be)})),_},he.unary=function(S){return Sd(S,1)},he.union=T_,he.unionBy=Tb,he.unionWith=wb,he.uniq=function(S){return S&&S.length?Nc(S):[]},he.uniqBy=function(S,f){return S&&S.length?Nc(S,sr(f,2)):[]},he.uniqWith=function(S,f){return f=typeof f=="function"?f:u,S&&S.length?Nc(S,u,f):[]},he.unset=function(S,f){return S==null||Ug(S,f)},he.unzip=w_,he.unzipWith=$g,he.update=function(S,f,_){return S==null?S:Il(S,f,Ma(_))},he.updateWith=function(S,f,_,R){return R=typeof R=="function"?R:u,S==null?S:Il(S,f,Ma(_),R)},he.values=jl,he.valuesIn=function(S){return S==null?[]:qa(S,Mr(S))},he.without=R_,he.words=kr,he.wrap=function(S,f){return Jg(Ma(f),S)},he.xor=Rb,he.xorBy=Cb,he.xorWith=C_,he.zip=Ab,he.zipObject=function(S,f){return Rf(S||[],f||[],el)},he.zipObjectDeep=function(S,f){return Rf(S||[],f||[],ri)},he.zipWith=Mb,he.entries=wd,he.entriesIn=kf,he.extend=al,he.extendWith=cl,ea(he,he),he.add=L,he.attempt=Gs,he.camelCase=Su,he.capitalize=Of,he.ceil=w,he.clamp=function(S,f,_){return _===u&&(_=f,f=u),_!==u&&(_=(_=An(_))==_?_:0),f!==u&&(f=(f=An(f))==f?f:0),$a(An(S),f,_)},he.clone=function(S){return Ls(S,4)},he.cloneDeep=function(S){return Ls(S,5)},he.cloneDeepWith=function(S,f){return Ls(S,5,f=typeof f=="function"?f:u)},he.cloneWith=function(S,f){return Ls(S,4,f=typeof f=="function"?f:u)},he.conformsTo=function(S,f){return f==null||tl(S,f,ls(f))},he.deburr=Qg,he.defaultTo=function(S,f){return S==null||S!=S?f:S},he.divide=O,he.endsWith=function(S,f,_){S=Wr(S),f=Bs(f);var R=S.length,U=_=_===u?R:$a(Xn(_),0,R);return(_-=f.length)>=0&&S.slice(_,U)==f},he.eq=da,he.escape=function(S){return(S=Wr(S))&&Ae.test(S)?S.replace(fe,Xv):S},he.escapeRegExp=function(S){return(S=Wr(S))&&Mt.test(S)?S.replace(bt,"\\$&"):S},he.every=function(S,f,_){var R=tr(S)?gm:f_;return _&&Ko(S,f,_)&&(f=u),R(S,sr(f,3))},he.find=ny,he.findIndex=Vg,he.findKey=function(S,f){return vo(S,sr(f,3),_s)},he.findLast=ry,he.findLastIndex=b_,he.findLastKey=function(S,f){return vo(S,sr(f,3),fd)},he.floor=B,he.forEach=iy,he.forEachRight=Wm,he.forIn=function(S,f){return S==null?S:ch(S,sr(f,3),Mr)},he.forInRight=function(S,f){return S==null?S:Dg(S,sr(f,3),Mr)},he.forOwn=function(S,f){return S&&_s(S,sr(f,3))},he.forOwnRight=function(S,f){return S&&fd(S,sr(f,3))},he.get=Mp,he.gt=ys,he.gte=kb,he.has=function(S,f){return S!=null&&dh(S,f,h_)},he.hasIn=Td,he.head=Gg,he.identity=Jo,he.includes=function(S,f,_,R){S=vc(S)?S:jl(S),_=_&&!R?Xn(_):0;var U=S.length;return _<0&&(_=Hr(U+_,0)),bu(S)?_<=U&&S.indexOf(f,_)>-1:!!U&&lu(S,f,_)>-1},he.indexOf=function(S,f,_){var R=S==null?0:S.length;if(!R)return-1;var U=_==null?0:Xn(_);return U<0&&(U=Hr(R+U,0)),lu(S,f,U)},he.inRange=function(S,f,_){return f=yc(f),_===u?(_=f,f=0):_=yc(_),(function(R,U,ee){return R>=Ti(U,ee)&&R<Hr(U,ee)})(S=An(S),f,_)},he.invoke=Eu,he.isArguments=mh,he.isArray=tr,he.isArrayBuffer=ar,he.isArrayLike=vc,he.isArrayLikeObject=ii,he.isBoolean=function(S){return S===!0||S===!1||_r(S)&&wi(S)==H},he.isBuffer=as,he.isDate=Fs,he.isElement=function(S){return _r(S)&&S.nodeType===1&&!Fl(S)},he.isEmpty=function(S){if(S==null)return!0;if(vc(S)&&(tr(S)||typeof S=="string"||typeof S.splice=="function"||as(S)||Qi(S)||mh(S)))return!S.length;var f=ha(S);if(f==X||f==W)return!S.size;if(Ys(S))return!up(S).length;for(var _ in S)if(Yn.call(S,_))return!1;return!0},he.isEqual=function(S,f){return ei(S,f)},he.isEqualWith=function(S,f,_){var R=(_=typeof _=="function"?_:u)?_(S,f):u;return R===u?ei(S,f,u,_):!!R},he.isError=xd,he.isFinite=function(S){return typeof S=="number"&&Ga(S)},he.isFunction=Ya,he.isInteger=Zs,he.isLength=Ia,he.isMap=Pi,he.isMatch=function(S,f){return S===f||qu(S,f,Bc(f))},he.isMatchWith=function(S,f,_){return _=typeof _=="function"?_:u,qu(S,f,Bc(f),_)},he.isNaN=function(S){return Js(S)&&S!=+S},he.isNative=function(S){if(Sp(S))throw new Cn("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return ko(S)},he.isNil=function(S){return S==null},he.isNull=function(S){return S===null},he.isNumber=Js,he.isObject=bs,he.isObjectLike=_r,he.isPlainObject=Fl,he.isRegExp=di,he.isSafeInteger=function(S){return Zs(S)&&S>=-9007199254740991&&S<=C},he.isSet=Qs,he.isString=bu,he.isSymbol=cs,he.isTypedArray=Qi,he.isUndefined=function(S){return S===u},he.isWeakMap=function(S){return _r(S)&&ha(S)==ne},he.isWeakSet=function(S){return _r(S)&&wi(S)=="[object WeakSet]"},he.join=function(S,f){return S==null?"":Ng.call(S,f)},he.kebabCase=_h,he.last=Ul,he.lastIndexOf=function(S,f,_){var R=S==null?0:S.length;if(!R)return-1;var U=R;return _!==u&&(U=(U=Xn(_))<0?Hr(R+U,0):Ti(U,R-1)),f==f?(function(ee,ue,de){for(var be=de+1;be--;)if(ee[be]===ue)return be;return be})(S,f,U):cu(S,Oc,U,!0)},he.lowerCase=Op,he.lowerFirst=ul,he.lt=si,he.lte=ao,he.max=function(S){return S&&S.length?Tf(S,Jo,hd):u},he.maxBy=function(S,f){return S&&S.length?Tf(S,sr(f,2),hd):u},he.mean=function(S){return _m(S,Jo)},he.meanBy=function(S,f){return _m(S,sr(f,2))},he.min=function(S){return S&&S.length?Tf(S,Jo,fp):u},he.minBy=function(S,f){return S&&S.length?Tf(S,sr(f,2),fp):u},he.stubArray=Ku,he.stubFalse=Eh,he.stubObject=function(){return{}},he.stubString=function(){return""},he.stubTrue=function(){return!0},he.multiply=Y,he.nth=function(S,f){return S&&S.length?pp(S,Xn(f)):u},he.noConflict=function(){return kn._===this&&(kn._=Ra),this},he.noop=xu,he.now=Xo,he.pad=function(S,f,_){S=Wr(S);var R=(f=Xn(f))?Oi(S):0;if(!f||R>=f)return S;var U=(f-R)/2;return sl(sh(U),_)+S+sl(uc(U),_)},he.padEnd=function(S,f,_){S=Wr(S);var R=(f=Xn(f))?Oi(S):0;return f&&R<f?S+sl(f-R,_):S},he.padStart=function(S,f,_){S=Wr(S);var R=(f=Xn(f))?Oi(S):0;return f&&R<f?sl(f-R,_)+S:S},he.parseInt=function(S,f,_){return _||f==null?f=0:f&&(f=+f),Rm(Wr(S).replace(Ie,""),f||0)},he.random=function(S,f,_){if(_&&typeof _!="boolean"&&Ko(S,f,_)&&(f=_=u),_===u&&(typeof f=="boolean"?(_=f,f=u):typeof S=="boolean"&&(_=S,S=u)),S===u&&f===u?(S=0,f=1):(S=yc(S),f===u?(f=S,S=0):f=yc(f)),S>f){var R=S;S=f,f=R}if(_||S%1||f%1){var U=Cm();return Ti(S+U*(f-S+Co("1e-"+((U+"").length-1))),f)}return Gu(S,f)},he.reduce=function(S,f,_){var R=tr(S)?au:vm,U=arguments.length<3;return R(S,sr(f,4),_,U,so)},he.reduceRight=function(S,f,_){var R=tr(S)?kg:vm,U=arguments.length<3;return R(S,sr(f,4),_,U,Mm)},he.repeat=function(S,f,_){return f=(_?Ko(S,f,_):f===u)?1:Xn(f),fr(Wr(S),f)},he.replace=function(){var S=arguments,f=Wr(S[0]);return S.length<3?f:f.replace(S[1],S[2])},he.result=function(S,f,_){var R=-1,U=(f=mu(f,S)).length;for(U||(U=1,S=u);++R<U;){var ee=S==null?u:S[Ll(f[R])];ee===u&&(R=U,ee=_),S=Ya(ee)?ee.call(S):ee}return S},he.round=se,he.runInContext=Ke,he.sample=function(S){return(tr(S)?oh:Aa)(S)},he.size=function(S){if(S==null)return 0;if(vc(S))return bu(S)?Oi(S):S.length;var f=ha(S);return f==X||f==W?S.size:up(S).length},he.snakeCase=fl,he.some=function(S,f,_){var R=tr(S)?s_:pd;return _&&Ko(S,f,_)&&(f=u),R(S,sr(f,3))},he.sortedIndex=function(S,f){return md(S,f)},he.sortedIndexBy=function(S,f,_){return ua(S,f,sr(_,2))},he.sortedIndexOf=function(S,f){var _=S==null?0:S.length;if(_){var R=md(S,f);if(R<_&&da(S[R],f))return R}return-1},he.sortedLastIndex=function(S,f){return md(S,f,!0)},he.sortedLastIndexBy=function(S,f,_){return ua(S,f,sr(_,2),!0)},he.sortedLastIndexOf=function(S,f){if(S!=null&&S.length){var _=md(S,f,!0)-1;if(da(S[_],f))return _}return-1},he.startCase=So,he.startsWith=function(S,f,_){return S=Wr(S),_=_==null?0:$a(Xn(_),0,S.length),f=Bs(f),S.slice(_,_+f.length)==f},he.subtract=me,he.sum=function(S){return S&&S.length?Du(S,Jo):0},he.sumBy=function(S,f){return S&&S.length?Du(S,sr(f,2)):0},he.template=function(S,f,_){var R=he.templateSettings;_&&Ko(S,f,_)&&(f=u),S=Wr(S),f=cl({},f,R,fh);var U,ee,ue=cl({},f.imports,R.imports,fh),de=ls(ue),be=qa(ue,de),Ce=0,Oe=f.interpolate||it,Fe="__p += '",ot=yo((f.escape||it).source+"|"+Oe.source+"|"+(Oe===Qe?Ye:it).source+"|"+(f.evaluate||it).source+"|$","g"),_t="//# sourceURL="+(Yn.call(f,"sourceURL")?(f.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++rr+"]")+`
`;S.replace(ot,(function(st,xt,mt,Et,kt,Bt){return mt||(mt=Et),Fe+=S.slice(Ce,Bt).replace(nt,Yv),xt&&(U=!0,Fe+=`' +
__e(`+xt+`) +
'`),kt&&(ee=!0,Fe+=`';
`+kt+`;
__p += '`),mt&&(Fe+=`' +
((__t = (`+mt+`)) == null ? '' : __t) +
'`),Ce=Bt+st.length,st})),Fe+=`';
`;var Tt=Yn.call(f,"variable")&&f.variable;if(Tt){if(Te.test(Tt))throw new Cn("Invalid `variable` option passed into `_.template`")}else Fe=`with (obj) {
`+Fe+`
}
`;Fe=(ee?Fe.replace(Le,""):Fe).replace(He,"$1").replace(Ue,"$1;"),Fe="function("+(Tt||"obj")+`) {
`+(Tt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(U?", __e = _.escape":"")+(ee?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Fe+`return __p
}`;var ht=Gs((function(){return $r(de,_t+"return "+Fe).apply(u,be)}));if(ht.source=Fe,xd(ht))throw ht;return ht},he.times=function(S,f){if((S=Xn(S))<1||S>C)return[];var _=k,R=Ti(S,k);f=sr(f),S-=k;for(var U=mf(R,f);++_<S;)f(_);return U},he.toFinite=yc,he.toInteger=Xn,he.toLength=Wn,he.toLower=function(S){return Wr(S).toLowerCase()},he.toNumber=An,he.toSafeInteger=function(S){return S?$a(Xn(S),-9007199254740991,C):S===0?S:0},he.toString=Wr,he.toUpper=function(S){return Wr(S).toUpperCase()},he.trim=function(S,f,_){if((S=Wr(S))&&(_||f===u))return sp(S);if(!S||!(f=Bs(f)))return S;var R=Cs(S),U=Cs(f);return Dc(R,op(R,U),Ho(R,U)+1).join("")},he.trimEnd=function(S,f,_){if((S=Wr(S))&&(_||f===u))return S.slice(0,bm(S)+1);if(!S||!(f=Bs(f)))return S;var R=Cs(S);return Dc(R,0,Ho(R,Cs(f))+1).join("")},he.trimStart=function(S,f,_){if((S=Wr(S))&&(_||f===u))return S.replace(Ie,"");if(!S||!(f=Bs(f)))return S;var R=Cs(S);return Dc(R,op(R,Cs(f))).join("")},he.truncate=function(S,f){var _=30,R="...";if(bs(f)){var U="separator"in f?f.separator:U;_="length"in f?Xn(f.length):_,R="omission"in f?Bs(f.omission):R}var ee=(S=Wr(S)).length;if(cd(S)){var ue=Cs(S);ee=ue.length}if(_>=ee)return S;var de=_-Oi(R);if(de<1)return R;var be=ue?Dc(ue,0,de).join(""):S.slice(0,de);if(U===u)return be+R;if(ue&&(de+=be.length-de),di(U)){if(S.slice(de).search(U)){var Ce,Oe=be;for(U.global||(U=yo(U.source,Wr(Pe.exec(U))+"g")),U.lastIndex=0;Ce=U.exec(Oe);)var Fe=Ce.index;be=be.slice(0,Fe===u?de:Fe)}}else if(S.indexOf(Bs(U),de)!=de){var ot=be.lastIndexOf(U);ot>-1&&(be=be.slice(0,ot))}return be+R},he.unescape=function(S){return(S=Wr(S))&&ve.test(S)?S.replace(De,Em):S},he.uniqueId=function(S){var f=++vr;return Wr(S)+f},he.upperCase=vh,he.upperFirst=qr,he.each=iy,he.eachRight=Wm,he.first=Gg,ea(he,(V={},_s(he,(function(S,f){Yn.call(he.prototype,f)||(V[f]=S)})),V),{chain:!1}),he.VERSION="4.17.21",lc(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(S){he[S].placeholder=he})),lc(["drop","take"],(function(S,f){vn.prototype[S]=function(_){_=_===u?1:Hr(Xn(_),0);var R=this.__filtered__&&!f?new vn(this):this.clone();return R.__filtered__?R.__takeCount__=Ti(_,R.__takeCount__):R.__views__.push({size:Ti(_,k),type:S+(R.__dir__<0?"Right":"")}),R},vn.prototype[S+"Right"]=function(_){return this.reverse()[S](_).reverse()}})),lc(["filter","map","takeWhile"],(function(S,f){var _=f+1,R=_==1||_==3;vn.prototype[S]=function(U){var ee=this.clone();return ee.__iteratees__.push({iteratee:sr(U,3),type:_}),ee.__filtered__=ee.__filtered__||R,ee}})),lc(["head","last"],(function(S,f){var _="take"+(f?"Right":"");vn.prototype[S]=function(){return this[_](1).value()[0]}})),lc(["initial","tail"],(function(S,f){var _="drop"+(f?"":"Right");vn.prototype[S]=function(){return this.__filtered__?new vn(this):this[_](1)}})),vn.prototype.compact=function(){return this.filter(Jo)},vn.prototype.find=function(S){return this.filter(S).head()},vn.prototype.findLast=function(S){return this.reverse().find(S)},vn.prototype.invokeMap=Br((function(S,f){return typeof S=="function"?new vn(this):this.map((function(_){return mc(_,S,f)}))})),vn.prototype.reject=function(S){return this.filter(Eo(sr(S)))},vn.prototype.slice=function(S,f){S=Xn(S);var _=this;return _.__filtered__&&(S>0||f<0)?new vn(_):(S<0?_=_.takeRight(-S):S&&(_=_.drop(S)),f!==u&&(_=(f=Xn(f))<0?_.dropRight(-f):_.take(f-S)),_)},vn.prototype.takeRightWhile=function(S){return this.reverse().takeWhile(S).reverse()},vn.prototype.toArray=function(){return this.take(k)},_s(vn.prototype,(function(S,f){var _=/^(?:filter|find|map|reject)|While$/.test(f),R=/^(?:head|last)$/.test(f),U=he[R?"take"+(f=="last"?"Right":""):f],ee=R||/^find/.test(f);U&&(he.prototype[f]=function(){var ue=this.__wrapped__,de=R?[1]:arguments,be=ue instanceof vn,Ce=de[0],Oe=be||tr(ue),Fe=function(xt){var mt=U.apply(he,xi([xt],de));return R&&ot?mt[0]:mt};Oe&&_&&typeof Ce=="function"&&Ce.length!=1&&(be=Oe=!1);var ot=this.__chain__,_t=!!this.__actions__.length,Tt=ee&&!ot,ht=be&&!_t;if(!ee&&Oe){ue=ht?ue:new vn(this);var st=S.apply(ue,de);return st.__actions__.push({func:Tp,args:[Fe],thisArg:u}),new Ji(st,ot)}return Tt&&ht?S.apply(this,de):(st=this.thru(Fe),Tt?R?st.value()[0]:st.value():st)})})),lc(["pop","push","shift","sort","splice","unshift"],(function(S){var f=hu[S],_=/^(?:push|sort|unshift)$/.test(S)?"tap":"thru",R=/^(?:pop|shift)$/.test(S);he.prototype[S]=function(){var U=arguments;if(R&&!this.__chain__){var ee=this.value();return f.apply(tr(ee)?ee:[],U)}return this[_]((function(ue){return f.apply(tr(ue)?ue:[],U)}))}})),_s(vn.prototype,(function(S,f){var _=he[f];if(_){var R=_.name+"";Yn.call(Hi,R)||(Hi[R]=[]),Hi[R].push({name:f,func:_})}})),Hi[vp(u,2).name]=[{name:"wrapper",func:u}],vn.prototype.clone=function(){var S=new vn(this.__wrapped__);return S.__actions__=As(this.__actions__),S.__dir__=this.__dir__,S.__filtered__=this.__filtered__,S.__iteratees__=As(this.__iteratees__),S.__takeCount__=this.__takeCount__,S.__views__=As(this.__views__),S},vn.prototype.reverse=function(){if(this.__filtered__){var S=new vn(this);S.__dir__=-1,S.__filtered__=!0}else(S=this.clone()).__dir__*=-1;return S},vn.prototype.value=function(){var S=this.__wrapped__.value(),f=this.__dir__,_=tr(S),R=f<0,U=_?S.length:0,ee=(function(Bt,It,Nt){for(var Zt=-1,hn=Nt.length;++Zt<hn;){var In=Nt[Zt],On=In.size;switch(In.type){case"drop":Bt+=On;break;case"dropRight":It-=On;break;case"take":It=Ti(It,Bt+On);break;case"takeRight":Bt=Hr(Bt,It-On)}}return{start:Bt,end:It}})(0,U,this.__views__),ue=ee.start,de=ee.end,be=de-ue,Ce=R?de:ue-1,Oe=this.__iteratees__,Fe=Oe.length,ot=0,_t=Ti(be,this.__takeCount__);if(!_||!R&&U==be&&_t==be)return $u(S,this.__actions__);var Tt=[];e:for(;be--&&ot<_t;){for(var ht=-1,st=S[Ce+=f];++ht<Fe;){var xt=Oe[ht],mt=xt.iteratee,Et=xt.type,kt=mt(st);if(Et==2)st=kt;else if(!kt){if(Et==1)continue e;break e}}Tt[ot++]=st}return Tt},he.prototype.at=wp,he.prototype.chain=function(){return ol(this)},he.prototype.commit=function(){return new Ji(this.value(),this.__chain__)},he.prototype.next=function(){this.__values__===u&&(this.__values__=zc(this.value()));var S=this.__index__>=this.__values__.length;return{done:S,value:S?u:this.__values__[this.__index__++]}},he.prototype.plant=function(S){for(var f,_=this;_ instanceof Ml;){var R=yu(_);R.__index__=0,R.__values__=u,f?U.__wrapped__=R:f=R;var U=R;_=_.__wrapped__}return U.__wrapped__=S,f},he.prototype.reverse=function(){var S=this.__wrapped__;if(S instanceof vn){var f=S;return this.__actions__.length&&(f=new vn(this)),(f=f.reverse()).__actions__.push({func:Tp,args:[x_],thisArg:u}),new Ji(f,this.__chain__)}return this.thru(x_)},he.prototype.toJSON=he.prototype.valueOf=he.prototype.value=function(){return $u(this.__wrapped__,this.__actions__)},he.prototype.first=he.prototype.head,Jc&&(he.prototype[Jc]=function(){return this}),he})();kn._=vf,(l=(function(){return vf}).call(a,c,a,o))===u||(o.exports=l)}).call(this)},5364:(o,a,c)=>{var l=c(5250),u=c(999)((function(h,d,m){l(h,d,m)}));o.exports=u},9935:o=>{o.exports=function(){return!1}},9884:(o,a,c)=>{var l=c(1791),u=c(7241);o.exports=function(h){return l(h,u(h))}},5602:o=>{var a=o.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(c){return c.encoding?"rtpmap:%d %s/%s/%s":c.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(c){return c.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(c){return c.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(c){return"extmap:%d"+(c.direction?"/%s":"%v")+(c["encrypt-uri"]?" %s":"%v")+" %s"+(c.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(c){return c.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(c){var l="candidate:%s %d %s %d %s %d typ %s";return l+=c.raddr!=null?" raddr %s rport %d":"%v%v",l+=c.tcptype!=null?" tcptype %s":"%v",c.generation!=null&&(l+=" generation %d"),l+=c["network-id"]!=null?" network-id %d":"%v",l+=c["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(c){var l="ssrc:%d";return c.attribute!=null&&(l+=" %s",c.value!=null&&(l+=":%s")),l}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(c){return c.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(c){return c.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(c){return"imageattr:%s %s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(c){return"simulcast:%s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(c){return"ts-refclk:%s"+(c.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(c){var l="mediaclk:";return l+=c.id!=null?"id=%s %s":"%v%s",l+=c.mediaClockValue!=null?"=%s":"",l+=c.rateNumerator!=null?" rate=%s":"",l+=c.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(a).forEach((function(c){a[c].forEach((function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format="%s")}))}))},7363:(o,a,c)=>{var l=c(5020),u=c(3804);a.M9=u,a.qg=l.parse,a.Sl=l.parseParams,l.parseFmtpConfig,l.parsePayloads,l.parseRemoteCandidates,l.parseImageAttributes,l.parseSimulcastStreamList},5020:(o,a,c)=>{var l=function(p){return String(Number(p))===p?Number(p):p},u=function(p,g,y){var v=p.name&&p.names;p.push&&!g[p.push]?g[p.push]=[]:v&&!g[p.name]&&(g[p.name]={});var x=p.push?{}:v?g[p.name]:g;(function(E,C,A,k){if(k&&!A)C[k]=l(E[1]);else for(var M=0;M<A.length;M+=1)E[M+1]!=null&&(C[A[M]]=l(E[M+1]))})(y.match(p.reg),x,p.names,p.name),p.push&&g[p.push].push(x)},h=c(5602),d=RegExp.prototype.test.bind(/^([a-z])=(.*)/);a.parse=function(p){var g={},y=[],v=g;return p.split(/(\r\n|\r|\n)/).filter(d).forEach((function(x){var E=x[0],C=x.slice(2);E==="m"&&(y.push({rtp:[],fmtp:[]}),v=y[y.length-1]);for(var A=0;A<(h[E]||[]).length;A+=1){var k=h[E][A];if(k.reg.test(C))return u(k,v,C)}})),g.media=y,g};var m=function(p,g){var y=g.split(/=(.+)/,2);return y.length===2?p[y[0]]=l(y[1]):y.length===1&&g.length>1&&(p[y[0]]=void 0),p};a.parseParams=function(p){return p.split(/;\s?/).reduce(m,{})},a.parseFmtpConfig=a.parseParams,a.parsePayloads=function(p){return p.toString().split(" ").map(Number)},a.parseRemoteCandidates=function(p){for(var g=[],y=p.split(" ").map(l),v=0;v<y.length;v+=3)g.push({component:y[v],ip:y[v+1],port:y[v+2]});return g},a.parseImageAttributes=function(p){return p.split(" ").map((function(g){return g.substring(1,g.length-1).split(",").reduce(m,{})}))},a.parseSimulcastStreamList=function(p){return p.split(";").map((function(g){return g.split(",").map((function(y){var v,x=!1;return y[0]!=="~"?v=l(y):(v=l(y.substring(1,y.length)),x=!0),{scid:v,paused:x}}))}))}},3804:(o,a,c)=>{var l=c(5602),u=/%[sdv%]/g,h=function(g){var y=1,v=arguments,x=v.length;return g.replace(u,(function(E){if(y>=x)return E;var C=v[y];switch(y+=1,E){case"%%":return"%";case"%s":return String(C);case"%d":return Number(C);case"%v":return""}}))},d=function(g,y,v){var x=[g+"="+(y.format instanceof Function?y.format(y.push?v:v[y.name]):y.format)];if(y.names)for(var E=0;E<y.names.length;E+=1){var C=y.names[E];y.name?x.push(v[y.name][C]):x.push(v[y.names[E]])}else x.push(v[y.name]);return h.apply(null,x)},m=["v","o","s","i","u","e","p","c","b","t","r","z","a"],p=["i","c","b","a"];o.exports=function(g,y){y=y||{},g.version==null&&(g.version=0),g.name==null&&(g.name=" "),g.media.forEach((function(C){C.payloads==null&&(C.payloads="")}));var v=y.outerOrder||m,x=y.innerOrder||p,E=[];return v.forEach((function(C){l[C].forEach((function(A){A.name in g&&g[A.name]!=null?E.push(d(C,A,g)):A.push in g&&g[A.push]!=null&&g[A.push].forEach((function(k){E.push(d(C,A,k))}))}))})),g.media.forEach((function(C){E.push(d("m",l.m[0],C)),x.forEach((function(A){l[A].forEach((function(k){k.name in C&&C[k.name]!=null?E.push(d(A,k,C)):k.push in C&&C[k.push]!=null&&C[k.push].forEach((function(M){E.push(d(A,k,M))}))}))}))})),E.join(`\r
`)+`\r
`}},7963:o=>{const a={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};a.localCName=a.generateIdentifier(),a.splitLines=function(c){return c.trim().split(`
`).map((l=>l.trim()))},a.splitSections=function(c){return c.split(`
m=`).map(((l,u)=>(u>0?"m="+l:l).trim()+`\r
`))},a.getDescription=function(c){const l=a.splitSections(c);return l&&l[0]},a.getMediaSections=function(c){const l=a.splitSections(c);return l.shift(),l},a.matchPrefix=function(c,l){return a.splitLines(c).filter((u=>u.indexOf(l)===0))},a.parseCandidate=function(c){let l;l=c.indexOf("a=candidate:")===0?c.substring(12).split(" "):c.substring(10).split(" ");const u={foundation:l[0],component:{1:"rtp",2:"rtcp"}[l[1]]||l[1],protocol:l[2].toLowerCase(),priority:parseInt(l[3],10),ip:l[4],address:l[4],port:parseInt(l[5],10),type:l[7]};for(let h=8;h<l.length;h+=2)switch(l[h]){case"raddr":u.relatedAddress=l[h+1];break;case"rport":u.relatedPort=parseInt(l[h+1],10);break;case"tcptype":u.tcpType=l[h+1];break;case"ufrag":u.ufrag=l[h+1],u.usernameFragment=l[h+1];break;default:u[l[h]]===void 0&&(u[l[h]]=l[h+1])}return u},a.writeCandidate=function(c){const l=[];l.push(c.foundation);const u=c.component;u==="rtp"?l.push(1):u==="rtcp"?l.push(2):l.push(u),l.push(c.protocol.toUpperCase()),l.push(c.priority),l.push(c.address||c.ip),l.push(c.port);const h=c.type;return l.push("typ"),l.push(h),h!=="host"&&c.relatedAddress&&c.relatedPort&&(l.push("raddr"),l.push(c.relatedAddress),l.push("rport"),l.push(c.relatedPort)),c.tcpType&&c.protocol.toLowerCase()==="tcp"&&(l.push("tcptype"),l.push(c.tcpType)),(c.usernameFragment||c.ufrag)&&(l.push("ufrag"),l.push(c.usernameFragment||c.ufrag)),"candidate:"+l.join(" ")},a.parseIceOptions=function(c){return c.substring(14).split(" ")},a.parseRtpMap=function(c){let l=c.substring(9).split(" ");const u={payloadType:parseInt(l.shift(),10)};return l=l[0].split("/"),u.name=l[0],u.clockRate=parseInt(l[1],10),u.channels=l.length===3?parseInt(l[2],10):1,u.numChannels=u.channels,u},a.writeRtpMap=function(c){let l=c.payloadType;c.preferredPayloadType!==void 0&&(l=c.preferredPayloadType);const u=c.channels||c.numChannels||1;return"a=rtpmap:"+l+" "+c.name+"/"+c.clockRate+(u!==1?"/"+u:"")+`\r
`},a.parseExtmap=function(c){const l=c.substring(9).split(" ");return{id:parseInt(l[0],10),direction:l[0].indexOf("/")>0?l[0].split("/")[1]:"sendrecv",uri:l[1],attributes:l.slice(2).join(" ")}},a.writeExtmap=function(c){return"a=extmap:"+(c.id||c.preferredId)+(c.direction&&c.direction!=="sendrecv"?"/"+c.direction:"")+" "+c.uri+(c.attributes?" "+c.attributes:"")+`\r
`},a.parseFmtp=function(c){const l={};let u;const h=c.substring(c.indexOf(" ")+1).split(";");for(let d=0;d<h.length;d++)u=h[d].trim().split("="),l[u[0].trim()]=u[1];return l},a.writeFmtp=function(c){let l="",u=c.payloadType;if(c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.parameters&&Object.keys(c.parameters).length){const h=[];Object.keys(c.parameters).forEach((d=>{c.parameters[d]!==void 0?h.push(d+"="+c.parameters[d]):h.push(d)})),l+="a=fmtp:"+u+" "+h.join(";")+`\r
`}return l},a.parseRtcpFb=function(c){const l=c.substring(c.indexOf(" ")+1).split(" ");return{type:l.shift(),parameter:l.join(" ")}},a.writeRtcpFb=function(c){let l="",u=c.payloadType;return c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.rtcpFeedback&&c.rtcpFeedback.length&&c.rtcpFeedback.forEach((h=>{l+="a=rtcp-fb:"+u+" "+h.type+(h.parameter&&h.parameter.length?" "+h.parameter:"")+`\r
`})),l},a.parseSsrcMedia=function(c){const l=c.indexOf(" "),u={ssrc:parseInt(c.substring(7,l),10)},h=c.indexOf(":",l);return h>-1?(u.attribute=c.substring(l+1,h),u.value=c.substring(h+1)):u.attribute=c.substring(l+1),u},a.parseSsrcGroup=function(c){const l=c.substring(13).split(" ");return{semantics:l.shift(),ssrcs:l.map((u=>parseInt(u,10)))}},a.getMid=function(c){const l=a.matchPrefix(c,"a=mid:")[0];if(l)return l.substring(6)},a.parseFingerprint=function(c){const l=c.substring(14).split(" ");return{algorithm:l[0].toLowerCase(),value:l[1].toUpperCase()}},a.getDtlsParameters=function(c,l){return{role:"auto",fingerprints:a.matchPrefix(c+l,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(c,l){let u="a=setup:"+l+`\r
`;return c.fingerprints.forEach((h=>{u+="a=fingerprint:"+h.algorithm+" "+h.value+`\r
`})),u},a.parseCryptoLine=function(c){const l=c.substring(9).split(" ");return{tag:parseInt(l[0],10),cryptoSuite:l[1],keyParams:l[2],sessionParams:l.slice(3)}},a.writeCryptoLine=function(c){return"a=crypto:"+c.tag+" "+c.cryptoSuite+" "+(typeof c.keyParams=="object"?a.writeCryptoKeyParams(c.keyParams):c.keyParams)+(c.sessionParams?" "+c.sessionParams.join(" "):"")+`\r
`},a.parseCryptoKeyParams=function(c){if(c.indexOf("inline:")!==0)return null;const l=c.substring(7).split("|");return{keyMethod:"inline",keySalt:l[0],lifeTime:l[1],mkiValue:l[2]?l[2].split(":")[0]:void 0,mkiLength:l[2]?l[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(c){return c.keyMethod+":"+c.keySalt+(c.lifeTime?"|"+c.lifeTime:"")+(c.mkiValue&&c.mkiLength?"|"+c.mkiValue+":"+c.mkiLength:"")},a.getCryptoParameters=function(c,l){return a.matchPrefix(c+l,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(c,l){const u=a.matchPrefix(c+l,"a=ice-ufrag:")[0],h=a.matchPrefix(c+l,"a=ice-pwd:")[0];return u&&h?{usernameFragment:u.substring(12),password:h.substring(10)}:null},a.writeIceParameters=function(c){let l="a=ice-ufrag:"+c.usernameFragment+`\r
a=ice-pwd:`+c.password+`\r
`;return c.iceLite&&(l+=`a=ice-lite\r
`),l},a.parseRtpParameters=function(c){const l={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=a.splitLines(c)[0].split(" ");l.profile=u[2];for(let d=3;d<u.length;d++){const m=u[d],p=a.matchPrefix(c,"a=rtpmap:"+m+" ")[0];if(p){const g=a.parseRtpMap(p),y=a.matchPrefix(c,"a=fmtp:"+m+" ");switch(g.parameters=y.length?a.parseFmtp(y[0]):{},g.rtcpFeedback=a.matchPrefix(c,"a=rtcp-fb:"+m+" ").map(a.parseRtcpFb),l.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":l.fecMechanisms.push(g.name.toUpperCase())}}}a.matchPrefix(c,"a=extmap:").forEach((d=>{l.headerExtensions.push(a.parseExtmap(d))}));const h=a.matchPrefix(c,"a=rtcp-fb:* ").map(a.parseRtcpFb);return l.codecs.forEach((d=>{h.forEach((m=>{d.rtcpFeedback.find((p=>p.type===m.type&&p.parameter===m.parameter))||d.rtcpFeedback.push(m)}))})),l},a.writeRtpDescription=function(c,l){let u="";u+="m="+c+" ",u+=l.codecs.length>0?"9":"0",u+=" "+(l.profile||"UDP/TLS/RTP/SAVPF")+" ",u+=l.codecs.map((d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType)).join(" ")+`\r
`,u+=`c=IN IP4 0.0.0.0\r
`,u+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,l.codecs.forEach((d=>{u+=a.writeRtpMap(d),u+=a.writeFmtp(d),u+=a.writeRtcpFb(d)}));let h=0;return l.codecs.forEach((d=>{d.maxptime>h&&(h=d.maxptime)})),h>0&&(u+="a=maxptime:"+h+`\r
`),l.headerExtensions&&l.headerExtensions.forEach((d=>{u+=a.writeExtmap(d)})),u},a.parseRtpEncodingParameters=function(c){const l=[],u=a.parseRtpParameters(c),h=u.fecMechanisms.indexOf("RED")!==-1,d=u.fecMechanisms.indexOf("ULPFEC")!==-1,m=a.matchPrefix(c,"a=ssrc:").map((x=>a.parseSsrcMedia(x))).filter((x=>x.attribute==="cname")),p=m.length>0&&m[0].ssrc;let g;const y=a.matchPrefix(c,"a=ssrc-group:FID").map((x=>x.substring(17).split(" ").map((E=>parseInt(E,10)))));y.length>0&&y[0].length>1&&y[0][0]===p&&(g=y[0][1]),u.codecs.forEach((x=>{if(x.name.toUpperCase()==="RTX"&&x.parameters.apt){let E={ssrc:p,codecPayloadType:parseInt(x.parameters.apt,10)};p&&g&&(E.rtx={ssrc:g}),l.push(E),h&&(E=JSON.parse(JSON.stringify(E)),E.fec={ssrc:p,mechanism:d?"red+ulpfec":"red"},l.push(E))}})),l.length===0&&p&&l.push({ssrc:p});let v=a.matchPrefix(c,"b=");return v.length&&(v=v[0].indexOf("b=TIAS:")===0?parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?1e3*parseInt(v[0].substring(5),10)*.95-16e3:void 0,l.forEach((x=>{x.maxBitrate=v}))),l},a.parseRtcpParameters=function(c){const l={},u=a.matchPrefix(c,"a=ssrc:").map((m=>a.parseSsrcMedia(m))).filter((m=>m.attribute==="cname"))[0];u&&(l.cname=u.value,l.ssrc=u.ssrc);const h=a.matchPrefix(c,"a=rtcp-rsize");l.reducedSize=h.length>0,l.compound=h.length===0;const d=a.matchPrefix(c,"a=rtcp-mux");return l.mux=d.length>0,l},a.writeRtcpParameters=function(c){let l="";return c.reducedSize&&(l+=`a=rtcp-rsize\r
`),c.mux&&(l+=`a=rtcp-mux\r
`),c.ssrc!==void 0&&c.cname&&(l+="a=ssrc:"+c.ssrc+" cname:"+c.cname+`\r
`),l},a.parseMsid=function(c){let l;const u=a.matchPrefix(c,"a=msid:");if(u.length===1)return l=u[0].substring(7).split(" "),{stream:l[0],track:l[1]};const h=a.matchPrefix(c,"a=ssrc:").map((d=>a.parseSsrcMedia(d))).filter((d=>d.attribute==="msid"));return h.length>0?(l=h[0].value.split(" "),{stream:l[0],track:l[1]}):void 0},a.parseSctpDescription=function(c){const l=a.parseMLine(c),u=a.matchPrefix(c,"a=max-message-size:");let h;u.length>0&&(h=parseInt(u[0].substring(19),10)),isNaN(h)&&(h=65536);const d=a.matchPrefix(c,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:l.fmt,maxMessageSize:h};const m=a.matchPrefix(c,"a=sctpmap:");if(m.length>0){const p=m[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:h}}},a.writeSctpDescription=function(c,l){let u=[];return u=c.protocol!=="DTLS/SCTP"?["m="+c.kind+" 9 "+c.protocol+" "+l.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+l.port+`\r
`]:["m="+c.kind+" 9 "+c.protocol+" "+l.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+l.port+" "+l.protocol+` 65535\r
`],l.maxMessageSize!==void 0&&u.push("a=max-message-size:"+l.maxMessageSize+`\r
`),u.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,22)},a.writeSessionBoilerplate=function(c,l,u){let h;const d=l!==void 0?l:2;return h=c||a.generateSessionId(),`v=0\r
o=`+(u||"thisisadapterortc")+" "+h+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},a.getDirection=function(c,l){const u=a.splitLines(c);for(let h=0;h<u.length;h++)switch(u[h]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[h].substring(2)}return l?a.getDirection(l):"sendrecv"},a.getKind=function(c){return a.splitLines(c)[0].split(" ")[0].substring(2)},a.isRejected=function(c){return c.split(" ",2)[1]==="0"},a.parseMLine=function(c){const l=a.splitLines(c)[0].substring(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},a.parseOLine=function(c){const l=a.matchPrefix(c,"o=")[0].substring(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},a.isValidSDP=function(c){if(typeof c!="string"||c.length===0)return!1;const l=a.splitLines(c);for(let u=0;u<l.length;u++)if(l[u].length<2||l[u].charAt(1)!=="=")return!1;return!0},o.exports=a},5512:o=>{o.exports=function(a,c,l,u){var h=self||window;try{try{var d;try{d=new h.Blob([a])}catch{(d=new(h.BlobBuilder||h.WebKitBlobBuilder||h.MozBlobBuilder||h.MSBlobBuilder)).append(a),d=d.getBlob()}var m=h.URL||h.webkitURL,p=m.createObjectURL(d),g=new h[c](p,l);return m.revokeObjectURL(p),g}catch{return new h[c]("data:application/javascript,".concat(encodeURIComponent(a)),l)}}catch{if(!u)throw Error("Inline worker is not supported");return new h[c](u,l)}}},8630:(o,a,c)=>{var l;(function(u){(function(){var h=typeof globalThis=="object"?globalThis:typeof c.g=="object"?c.g:typeof self=="object"?self:typeof this=="object"?this:(function(){try{return Function("return this;")()}catch{}})()||(function(){try{return(0,eval)("(function() { return this; })()")}catch{}})(),d=m(u);function m(p,g){return function(y,v){Object.defineProperty(p,y,{configurable:!0,writable:!0,value:v}),g&&g(y,v)}}h.Reflect!==void 0&&(d=m(h.Reflect,d)),(function(p,g){var y=Object.prototype.hasOwnProperty,v=typeof Symbol=="function",x=v&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",E=v&&Symbol.iterator!==void 0?Symbol.iterator:"@@iterator",C=typeof Object.create=="function",A={__proto__:[]}instanceof Array,k=!C&&!A,M={create:C?function(){return lt(Object.create(null))}:A?function(){return lt({__proto__:null})}:function(){return lt({})},has:k?function(qe,rt){return y.call(qe,rt)}:function(qe,rt){return rt in qe},get:k?function(qe,rt){return y.call(qe,rt)?qe[rt]:void 0}:function(qe,rt){return qe[rt]}},I=Object.getPrototypeOf(Function),z=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:We(),H=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ve(),K=typeof WeakMap=="function"?WeakMap:Xe(),P=v?Symbol.for("@reflect-metadata:registry"):void 0,F=Te(),N=ye(F);function X(qe,rt,it,nt){if(Le(it)){if(!Qe(qe))throw new TypeError;if(!tt(rt))throw new TypeError;return ae(qe,rt)}if(!Qe(qe))throw new TypeError;if(!De(rt))throw new TypeError;if(!De(nt)&&!Le(nt)&&!He(nt))throw new TypeError;return He(nt)&&(nt=void 0),xe(qe,rt,it=Ge(it),nt)}function G(qe,rt){function it(nt,ct){if(!De(nt))throw new TypeError;if(!Le(ct)&&!Ft(ct))throw new TypeError;Be(qe,rt,nt,ct)}return it}function j(qe,rt,it,nt){if(!De(it))throw new TypeError;return Le(nt)||(nt=Ge(nt)),Be(qe,rt,it,nt)}function q(qe,rt,it){if(!De(rt))throw new TypeError;return Le(it)||(it=Ge(it)),Ne(qe,rt,it)}function te(qe,rt,it){if(!De(rt))throw new TypeError;return Le(it)||(it=Ge(it)),Re(qe,rt,it)}function W(qe,rt,it){if(!De(rt))throw new TypeError;return Le(it)||(it=Ge(it)),Se(qe,rt,it)}function $(qe,rt,it){if(!De(rt))throw new TypeError;return Le(it)||(it=Ge(it)),ze(qe,rt,it)}function J(qe,rt){if(!De(qe))throw new TypeError;return Le(rt)||(rt=Ge(rt)),Je(qe,rt)}function ne(qe,rt){if(!De(qe))throw new TypeError;return Le(rt)||(rt=Ge(rt)),at(qe,rt)}function ie(qe,rt,it){if(!De(rt))throw new TypeError;if(Le(it)||(it=Ge(it)),!De(rt))throw new TypeError;Le(it)||(it=Ge(it));var nt=Pe(rt,it,!1);return!Le(nt)&&nt.OrdinaryDeleteMetadata(qe,rt,it)}function ae(qe,rt){for(var it=qe.length-1;it>=0;--it){var nt=(0,qe[it])(rt);if(!Le(nt)&&!He(nt)){if(!tt(nt))throw new TypeError;rt=nt}}return rt}function xe(qe,rt,it,nt){for(var ct=qe.length-1;ct>=0;--ct){var Qt=(0,qe[ct])(rt,it,nt);if(!Le(Qt)&&!He(Qt)){if(!De(Qt))throw new TypeError;nt=Qt}}return nt}function Ne(qe,rt,it){if(Re(qe,rt,it))return!0;var nt=we(rt);return!He(nt)&&Ne(qe,nt,it)}function Re(qe,rt,it){var nt=Pe(rt,it,!1);return!Le(nt)&&Ae(nt.OrdinaryHasOwnMetadata(qe,rt,it))}function Se(qe,rt,it){if(Re(qe,rt,it))return ze(qe,rt,it);var nt=we(rt);return He(nt)?void 0:Se(qe,nt,it)}function ze(qe,rt,it){var nt=Pe(rt,it,!1);if(!Le(nt))return nt.OrdinaryGetOwnMetadata(qe,rt,it)}function Be(qe,rt,it,nt){Pe(it,nt,!0).OrdinaryDefineOwnMetadata(qe,rt,it,nt)}function Je(qe,rt){var it=at(qe,rt),nt=we(qe);if(nt===null)return it;var ct=Je(nt,rt);if(ct.length<=0)return it;if(it.length<=0)return ct;for(var Qt=new H,tn=[],Ot=0,qt=it;Ot<qt.length;Ot++){var vt=qt[Ot];Qt.has(vt)||(Qt.add(vt),tn.push(vt))}for(var Kt=0,_n=ct;Kt<_n.length;Kt++)vt=_n[Kt],Qt.has(vt)||(Qt.add(vt),tn.push(vt));return tn}function at(qe,rt){var it=Pe(qe,rt,!1);return it?it.OrdinaryOwnMetadataKeys(qe,rt):[]}function re(qe){if(qe===null)return 1;switch(typeof qe){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return qe===null?1:6;default:return 6}}function Le(qe){return qe===void 0}function He(qe){return qe===null}function Ue(qe){return typeof qe=="symbol"}function De(qe){return typeof qe=="object"?qe!==null:typeof qe=="function"}function fe(qe,rt){switch(re(qe)){case 0:case 1:case 2:case 3:case 4:case 5:return qe}var it="string",nt=Mt(qe,x);if(nt!==void 0){var ct=nt.call(qe,it);if(De(ct))throw new TypeError;return ct}return ve(qe)}function ve(qe,rt){var it,nt;{var ct=qe.toString;if(Ze(ct)&&!De(nt=ct.call(qe))||Ze(it=qe.valueOf)&&!De(nt=it.call(qe)))return nt}throw new TypeError}function Ae(qe){return!!qe}function pe(qe){return""+qe}function Ge(qe){var rt=fe(qe);return Ue(rt)?rt:pe(rt)}function Qe(qe){return Array.isArray?Array.isArray(qe):qe instanceof Object?qe instanceof Array:Object.prototype.toString.call(qe)==="[object Array]"}function Ze(qe){return typeof qe=="function"}function tt(qe){return typeof qe=="function"}function Ft(qe){switch(re(qe)){case 3:case 4:return!0;default:return!1}}function bt(qe,rt){return qe===rt||qe!=qe&&rt!=rt}function Mt(qe,rt){var it=qe[rt];if(it!=null){if(!Ze(it))throw new TypeError;return it}}function Ie(qe){var rt=Mt(qe,E);if(!Ze(rt))throw new TypeError;var it=rt.call(qe);if(!De(it))throw new TypeError;return it}function ce(qe){return qe.value}function Q(qe){var rt=qe.next();return!rt.done&&rt}function le(qe){var rt=qe.return;rt&&rt.call(qe)}function we(qe){var rt=Object.getPrototypeOf(qe);if(typeof qe!="function"||qe===I||rt!==I)return rt;var it=qe.prototype,nt=it&&Object.getPrototypeOf(it);if(nt==null||nt===Object.prototype)return rt;var ct=nt.constructor;return typeof ct!="function"||ct===qe?rt:ct}function Me(){var qe,rt,it,nt;Le(P)||g.Reflect===void 0||P in g.Reflect||typeof g.Reflect.defineMetadata!="function"||(qe=Ye(g.Reflect));var ct=new K,Qt={registerProvider:tn,getProvider:qt,setProvider:Kt};return Qt;function tn(_n){if(!Object.isExtensible(Qt))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case qe===_n:break;case Le(rt):rt=_n;break;case rt===_n:break;case Le(it):it=_n;break;case it===_n:break;default:nt===void 0&&(nt=new H),nt.add(_n)}}function Ot(_n,Wt){if(!Le(rt)){if(rt.isProviderFor(_n,Wt))return rt;if(!Le(it)){if(it.isProviderFor(_n,Wt))return rt;if(!Le(nt))for(var dn=Ie(nt);;){var Mn=Q(dn);if(!Mn)return;var Ln=ce(Mn);if(Ln.isProviderFor(_n,Wt))return le(dn),Ln}}}if(!Le(qe)&&qe.isProviderFor(_n,Wt))return qe}function qt(_n,Wt){var dn,Mn=ct.get(_n);return Le(Mn)||(dn=Mn.get(Wt)),Le(dn)&&(Le(dn=Ot(_n,Wt))||(Le(Mn)&&(Mn=new z,ct.set(_n,Mn)),Mn.set(Wt,dn))),dn}function vt(_n){if(Le(_n))throw new TypeError;return rt===_n||it===_n||!Le(nt)&&nt.has(_n)}function Kt(_n,Wt,dn){if(!vt(dn))throw new Error("Metadata provider not registered.");var Mn=qt(_n,Wt);if(Mn!==dn){if(!Le(Mn))return!1;var Ln=ct.get(_n);Le(Ln)&&(Ln=new z,ct.set(_n,Ln)),Ln.set(Wt,dn)}return!0}}function Te(){var qe;return!Le(P)&&De(g.Reflect)&&Object.isExtensible(g.Reflect)&&(qe=g.Reflect[P]),Le(qe)&&(qe=Me()),!Le(P)&&De(g.Reflect)&&Object.isExtensible(g.Reflect)&&Object.defineProperty(g.Reflect,P,{enumerable:!1,configurable:!1,writable:!1,value:qe}),qe}function ye(qe){var rt=new K,it={isProviderFor:function(vt,Kt){var _n=rt.get(vt);return!Le(_n)&&_n.has(Kt)},OrdinaryDefineOwnMetadata:tn,OrdinaryHasOwnMetadata:ct,OrdinaryGetOwnMetadata:Qt,OrdinaryOwnMetadataKeys:Ot,OrdinaryDeleteMetadata:qt};return F.registerProvider(it),it;function nt(vt,Kt,_n){var Wt=rt.get(vt),dn=!1;if(Le(Wt)){if(!_n)return;Wt=new z,rt.set(vt,Wt),dn=!0}var Mn=Wt.get(Kt);if(Le(Mn)){if(!_n)return;if(Mn=new z,Wt.set(Kt,Mn),!qe.setProvider(vt,Kt,it))throw Wt.delete(Kt),dn&&rt.delete(vt),new Error("Wrong provider for target.")}return Mn}function ct(vt,Kt,_n){var Wt=nt(Kt,_n,!1);return!Le(Wt)&&Ae(Wt.has(vt))}function Qt(vt,Kt,_n){var Wt=nt(Kt,_n,!1);if(!Le(Wt))return Wt.get(vt)}function tn(vt,Kt,_n,Wt){nt(_n,Wt,!0).set(vt,Kt)}function Ot(vt,Kt){var _n=[],Wt=nt(vt,Kt,!1);if(Le(Wt))return _n;for(var dn=Ie(Wt.keys()),Mn=0;;){var Ln=Q(dn);if(!Ln)return _n.length=Mn,_n;var is=ce(Ln);try{_n[Mn]=is}catch(ni){try{le(dn)}finally{throw ni}}Mn++}}function qt(vt,Kt,_n){var Wt=nt(Kt,_n,!1);if(Le(Wt)||!Wt.delete(vt))return!1;if(Wt.size===0){var dn=rt.get(Kt);Le(dn)||(dn.delete(_n),dn.size===0&&rt.delete(dn))}return!0}}function Ye(qe){var rt=qe.defineMetadata,it=qe.hasOwnMetadata,nt=qe.getOwnMetadata,ct=qe.getOwnMetadataKeys,Qt=qe.deleteMetadata,tn=new K;return{isProviderFor:function(Ot,qt){var vt=tn.get(Ot);return!(Le(vt)||!vt.has(qt))||!!ct(Ot,qt).length&&(Le(vt)&&(vt=new H,tn.set(Ot,vt)),vt.add(qt),!0)},OrdinaryDefineOwnMetadata:rt,OrdinaryHasOwnMetadata:it,OrdinaryGetOwnMetadata:nt,OrdinaryOwnMetadataKeys:ct,OrdinaryDeleteMetadata:Qt}}function Pe(qe,rt,it){var nt=F.getProvider(qe,rt);if(!Le(nt))return nt;if(it){if(F.setProvider(qe,rt,N))return N;throw new Error("Illegal state.")}}function We(){var qe={},rt=[],it=(function(){function tn(Ot,qt,vt){this._index=0,this._keys=Ot,this._values=qt,this._selector=vt}return tn.prototype["@@iterator"]=function(){return this},tn.prototype[E]=function(){return this},tn.prototype.next=function(){var Ot=this._index;if(Ot>=0&&Ot<this._keys.length){var qt=this._selector(this._keys[Ot],this._values[Ot]);return Ot+1>=this._keys.length?(this._index=-1,this._keys=rt,this._values=rt):this._index++,{value:qt,done:!1}}return{value:void 0,done:!0}},tn.prototype.throw=function(Ot){throw this._index>=0&&(this._index=-1,this._keys=rt,this._values=rt),Ot},tn.prototype.return=function(Ot){return this._index>=0&&(this._index=-1,this._keys=rt,this._values=rt),{value:Ot,done:!0}},tn})();return(function(){function tn(){this._keys=[],this._values=[],this._cacheKey=qe,this._cacheIndex=-2}return Object.defineProperty(tn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),tn.prototype.has=function(Ot){return this._find(Ot,!1)>=0},tn.prototype.get=function(Ot){var qt=this._find(Ot,!1);return qt>=0?this._values[qt]:void 0},tn.prototype.set=function(Ot,qt){var vt=this._find(Ot,!0);return this._values[vt]=qt,this},tn.prototype.delete=function(Ot){var qt=this._find(Ot,!1);if(qt>=0){for(var vt=this._keys.length,Kt=qt+1;Kt<vt;Kt++)this._keys[Kt-1]=this._keys[Kt],this._values[Kt-1]=this._values[Kt];return this._keys.length--,this._values.length--,bt(Ot,this._cacheKey)&&(this._cacheKey=qe,this._cacheIndex=-2),!0}return!1},tn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=qe,this._cacheIndex=-2},tn.prototype.keys=function(){return new it(this._keys,this._values,nt)},tn.prototype.values=function(){return new it(this._keys,this._values,ct)},tn.prototype.entries=function(){return new it(this._keys,this._values,Qt)},tn.prototype["@@iterator"]=function(){return this.entries()},tn.prototype[E]=function(){return this.entries()},tn.prototype._find=function(Ot,qt){if(!bt(this._cacheKey,Ot)){this._cacheIndex=-1;for(var vt=0;vt<this._keys.length;vt++)if(bt(this._keys[vt],Ot)){this._cacheIndex=vt;break}}return this._cacheIndex<0&&qt&&(this._cacheIndex=this._keys.length,this._keys.push(Ot),this._values.push(void 0)),this._cacheIndex},tn})();function nt(tn,Ot){return tn}function ct(tn,Ot){return Ot}function Qt(tn,Ot){return[tn,Ot]}}function Ve(){return(function(){function qe(){this._map=new z}return Object.defineProperty(qe.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),qe.prototype.has=function(rt){return this._map.has(rt)},qe.prototype.add=function(rt){return this._map.set(rt,rt),this},qe.prototype.delete=function(rt){return this._map.delete(rt)},qe.prototype.clear=function(){this._map.clear()},qe.prototype.keys=function(){return this._map.keys()},qe.prototype.values=function(){return this._map.keys()},qe.prototype.entries=function(){return this._map.entries()},qe.prototype["@@iterator"]=function(){return this.keys()},qe.prototype[E]=function(){return this.keys()},qe})()}function Xe(){var qe=16,rt=M.create(),it=nt();return(function(){function qt(){this._key=nt()}return qt.prototype.has=function(vt){var Kt=ct(vt,!1);return Kt!==void 0&&M.has(Kt,this._key)},qt.prototype.get=function(vt){var Kt=ct(vt,!1);return Kt!==void 0?M.get(Kt,this._key):void 0},qt.prototype.set=function(vt,Kt){return ct(vt,!0)[this._key]=Kt,this},qt.prototype.delete=function(vt){var Kt=ct(vt,!1);return Kt!==void 0&&delete Kt[this._key]},qt.prototype.clear=function(){this._key=nt()},qt})();function nt(){var qt;do qt="@@WeakMap@@"+Ot();while(M.has(rt,qt));return rt[qt]=!0,qt}function ct(qt,vt){if(!y.call(qt,it)){if(!vt)return;Object.defineProperty(qt,it,{value:M.create()})}return qt[it]}function Qt(qt,vt){for(var Kt=0;Kt<vt;++Kt)qt[Kt]=255*Math.random()|0;return qt}function tn(qt){if(typeof Uint8Array=="function"){var vt=new Uint8Array(qt);return typeof crypto<"u"?crypto.getRandomValues(vt):typeof msCrypto<"u"?msCrypto.getRandomValues(vt):Qt(vt,qt),vt}return Qt(new Array(qt),qt)}function Ot(){var qt=tn(qe);qt[6]=79&qt[6]|64,qt[8]=191&qt[8]|128;for(var vt="",Kt=0;Kt<qe;++Kt){var _n=qt[Kt];Kt!==4&&Kt!==6&&Kt!==8||(vt+="-"),_n<16&&(vt+="0"),vt+=_n.toString(16).toLowerCase()}return vt}}function lt(qe){return qe.__=void 0,delete qe.__,qe}p("decorate",X),p("metadata",G),p("defineMetadata",j),p("hasMetadata",q),p("hasOwnMetadata",te),p("getMetadata",W),p("getOwnMetadata",$),p("getMetadataKeys",J),p("getOwnMetadataKeys",ne),p("deleteMetadata",ie)})(d,h),h.Reflect===void 0&&(h.Reflect=u)})()})(l||(l={}))}},r={};function i(o){var a=r[o];if(a!==void 0)return a.exports;var c=r[o]={id:o,loaded:!1,exports:{}};return n[o].call(c.exports,c,c.exports,i),c.loaded=!0,c.exports}i.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return i.d(a,{a}),a},i.d=(o,a)=>{for(var c in a)i.o(a,c)&&!i.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:a[c]})},i.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),i.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.nmd=o=>(o.paths=[],o.children||(o.children=[]),o);var s={};return(()=>{i.r(s),i.d(s,{BASIC_FULL_HD_LANDSCAPE:()=>pr,BASIC_FULL_HD_PORTRAIT:()=>un,BASIC_LANDSCAPE:()=>Ur,BASIC_PORTRAIT:()=>rr,BroadcastClientError:()=>ye,BroadcastClientEvents:()=>Kn,ConnectionState:()=>jn,Errors:()=>u,InitialLayerPreference:()=>Gu,JitterBufferMinDelay:()=>Aa,LOG_LEVEL:()=>Q,LocalStageStream:()=>kf,LocalStageStreamEvents:()=>Mr,LogLevels:()=>Q,RemoteStageStream:()=>ul,RemoteStageStreamEvents:()=>Eu,SIMULCAST_DUPLICATE_LAYERS_CONFIGURED:()=>Bm,SIMULCAST_LAYER_CONFIGURATION_CONFLICT:()=>Ko,SIMULCAST_LAYER_INPUT_FRAMERATE_INSUFFICIENT:()=>Sp,SIMULCAST_LAYER_INPUT_RESOLUTION_INSUFFICIENT:()=>zg,SIMULCAST_LAYER_INVALID_TYPE:()=>Bc,SIMULCAST_LAYER_ORIENTATION_MISMATCH:()=>Ep,SIMULCAST_MAX_LAYERS_EXCEEDED:()=>Fc,SIMULCAST_MAX_LAYER_BITRATE_EXCEEDED:()=>fa,SIMULCAST_MAX_LAYER_DIMENSIONS_EXCEEDED:()=>vu,SIMULCAST_MAX_LAYER_FRAMERATE_EXCEEDED:()=>dh,SIMULCAST_MIN_LAYER_BITRATE_EXCEEDED:()=>ha,SIMULCAST_MIN_LAYER_DIMENSIONS_EXCEEDED:()=>Vs,SIMULCAST_MIN_LAYER_FRAMERATE_EXCEEDED:()=>g_,SIMULCAST_UNSUPPORTED:()=>yd,STAGE_MAX_AUDIO_BITRATE_KBPS:()=>Dc,STAGE_MAX_AUDIO_BITRATE_KBPS_DEFAULT:()=>Bg,STAGE_MAX_BITRATE:()=>Oo,STAGE_MAX_FRAMERATE:()=>Pc,STAGE_MAX_RESOLUTION:()=>Nl,STAGE_MIN_AUDIO_BITRATE_KBPS:()=>gu,STAGE_MIN_BITRATE:()=>Il,STAGE_MIN_FRAMERATE:()=>$u,STAGE_MIN_RESOLUTION:()=>Rf,STANDARD_LANDSCAPE:()=>Er,STANDARD_PORTRAIT:()=>Co,SimulcastLayerPresets:()=>oo,Stage:()=>ga,StageConnectionState:()=>qi,StageErrorCategory:()=>Wn,StageErrorCode:()=>An,StageEvents:()=>ci,StageLeftReason:()=>Ku,StageParticipantPublishState:()=>Ms,StageParticipantSubscribeState:()=>ma,StageStream:()=>kp,StageStreamLayerSelectedReason:()=>ls,StreamType:()=>vr,SubscribeType:()=>ao,__version:()=>Cm,create:()=>Rm,default:()=>Eh,isSupported:()=>ce});var o={};i.r(o),i.d(o,{fixNegotiationNeeded:()=>te,shimAddTrackRemoveTrack:()=>j,shimAddTrackRemoveTrackWithNative:()=>G,shimGetDisplayMedia:()=>H,shimGetSendersWithDtmf:()=>F,shimGetStats:()=>N,shimGetUserMedia:()=>z,shimMediaStream:()=>K,shimOnTrack:()=>P,shimPeerConnection:()=>q,shimSenderReceiverGetStats:()=>X});var a={};i.r(a),i.d(a,{shimAddTransceiver:()=>Re,shimCreateAnswer:()=>Be,shimCreateOffer:()=>ze,shimGetDisplayMedia:()=>$,shimGetParameters:()=>Se,shimGetUserMedia:()=>W,shimOnTrack:()=>J,shimPeerConnection:()=>ne,shimRTCDataChannel:()=>Ne,shimReceiverGetStats:()=>ae,shimRemoveStream:()=>xe,shimSenderGetStats:()=>ie});var c={};i.r(c),i.d(c,{shimAudioContext:()=>ve,shimCallbacksAPI:()=>re,shimConstraints:()=>He,shimCreateOfferLegacy:()=>fe,shimGetUserMedia:()=>Le,shimLocalStreamsAPI:()=>Je,shimRTCIceServerUrls:()=>Ue,shimRemoteStreamsAPI:()=>at,shimTrackEventTransceiver:()=>De});var l={};i.r(l),i.d(l,{removeExtmapAllowMixed:()=>bt,shimAddIceCandidateNullOrEmpty:()=>Mt,shimConnectionState:()=>Ft,shimMaxMessageSize:()=>Ze,shimParameterlessSetLocalDescription:()=>Ie,shimRTCIceCandidate:()=>Ge,shimRTCIceCandidateRelayProtocol:()=>Qe,shimSendThrowTypeError:()=>tt});var u={};i.r(u),i.d(u,{ADD_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>qe,ADD_DEVICE_COMPOSITION_MISSING_ERROR:()=>lt,ADD_DEVICE_CONSTRAINTS_ERROR:()=>nt,ADD_DEVICE_DEVICE_ERROR:()=>Ve,ADD_DEVICE_NAME_EXISTS_ERROR:()=>Xe,ADD_DEVICE_NAME_MISSING_ERROR:()=>rt,ADD_DEVICE_UNSUPPORTED:()=>it,BROADCAST_CONFIGURATION_ERROR:()=>Mn,BROADCAST_ERROR:()=>Ye,CAMERA_ERROR:()=>Pe,CLIENT_INVALID_ERROR:()=>Ds,EXCHANGE_POSITION_DEVICE_NOT_FOUND_ERROR:()=>vt,FAILED_TO_ADD_IMAGE_ERROR:()=>Kt,INGEST_ENDPOINT_TYPE_ERROR:()=>is,INGEST_ENDPOINT_URL_ERROR:()=>ni,INPUT_ERROR:()=>We,INVALID_STREAM_KEY:()=>dn,LOGGER_TYPE_ERROR:()=>Ps,LOG_LEVEL_TYPE_ERROR:()=>fi,NETWORK_RECONNECT_CONFIGURATION_ERROR:()=>zi,NETWORK_RECONNECT_CONFIGURATION_INVALID_TIMEOUT_ERROR:()=>ds,PEER_CONNECTION_ERROR:()=>Wt,PEER_SETUP_ERROR:()=>_n,REMOVE_DEVICE_NOT_FOUND_ERROR:()=>ct,REMOVE_IMAGE_NOT_FOUND_ERROR:()=>Qt,STAGE_TOKEN_TYPE_ERROR:()=>je,STAGE_WHIP_OVERRIDE_ERROR:()=>gt,STREAM_CONFIGURATION_ERROR:()=>Ln,STREAM_KEY_INVALID_CHAR_ERROR:()=>ps,UPDATE_VIDEO_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Ot,UPDATE_VIDEO_DEVICE_COMPOSITION_MISSING_ERROR:()=>tn,UPDATE_VIDEO_DEVICE_COMPOSITION_NAME_NOT_FOUND_ERROR:()=>qt});var h={};i.r(h),i.d(h,{BASIC_FULL_HD_LANDSCAPE:()=>pr,BASIC_FULL_HD_PORTRAIT:()=>un,BASIC_LANDSCAPE:()=>Ur,BASIC_PORTRAIT:()=>rr,BroadcastClientError:()=>ye,BroadcastClientEvents:()=>Kn,ConnectionState:()=>jn,Errors:()=>u,LOG_LEVEL:()=>Q,LogLevels:()=>Q,STANDARD_LANDSCAPE:()=>Er,STANDARD_PORTRAIT:()=>Co,__version:()=>Cm,create:()=>Rm,isSupported:()=>ce});let d=!0,m=!0;function p(L,w,O){const B=L.match(w);return B&&B.length>=O&&parseInt(B[O],10)}function g(L,w,O){if(!L.RTCPeerConnection)return;const B=L.RTCPeerConnection.prototype,V=B.addEventListener;B.addEventListener=function(se,me){if(se!==w)return V.apply(this,arguments);const S=f=>{const _=O(f);_&&(me.handleEvent?me.handleEvent(_):me(_))};return this._eventMap=this._eventMap||{},this._eventMap[w]||(this._eventMap[w]=new Map),this._eventMap[w].set(me,S),V.apply(this,[se,S])};const Y=B.removeEventListener;B.removeEventListener=function(se,me){if(se!==w||!this._eventMap||!this._eventMap[w])return Y.apply(this,arguments);if(!this._eventMap[w].has(me))return Y.apply(this,arguments);const S=this._eventMap[w].get(me);return this._eventMap[w].delete(me),this._eventMap[w].size===0&&delete this._eventMap[w],Object.keys(this._eventMap).length===0&&delete this._eventMap,Y.apply(this,[se,S])},Object.defineProperty(B,"on"+w,{get(){return this["_on"+w]},set(se){this["_on"+w]&&(this.removeEventListener(w,this["_on"+w]),delete this["_on"+w]),se&&this.addEventListener(w,this["_on"+w]=se)},enumerable:!0,configurable:!0})}function y(L){return typeof L!="boolean"?new Error("Argument type: "+typeof L+". Please use a boolean."):(d=L,L?"adapter.js logging disabled":"adapter.js logging enabled")}function v(L){return typeof L!="boolean"?new Error("Argument type: "+typeof L+". Please use a boolean."):(m=!L,"adapter.js deprecation warnings "+(L?"disabled":"enabled"))}function x(){if(typeof window=="object"){if(d)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function E(L,w){m&&console.warn(L+" is deprecated, please use "+w+" instead.")}function C(L){return Object.prototype.toString.call(L)==="[object Object]"}function A(L){return C(L)?Object.keys(L).reduce((function(w,O){const B=C(L[O]),V=B?A(L[O]):L[O],Y=B&&!Object.keys(V).length;return V===void 0||Y?w:Object.assign(w,{[O]:V})}),{}):L}function k(L,w,O){w&&!O.has(w.id)&&(O.set(w.id,w),Object.keys(w).forEach((B=>{B.endsWith("Id")?k(L,L.get(w[B]),O):B.endsWith("Ids")&&w[B].forEach((V=>{k(L,L.get(V),O)}))})))}function M(L,w,O){const B=O?"outbound-rtp":"inbound-rtp",V=new Map;if(w===null)return V;const Y=[];return L.forEach((se=>{se.type==="track"&&se.trackIdentifier===w.id&&Y.push(se)})),Y.forEach((se=>{L.forEach((me=>{me.type===B&&me.trackId===se.id&&k(L,me,V)}))})),V}const I=x;function z(L,w){const O=L&&L.navigator;if(!O.mediaDevices)return;const B=function(se){if(typeof se!="object"||se.mandatory||se.optional)return se;const me={};return Object.keys(se).forEach((S=>{if(S==="require"||S==="advanced"||S==="mediaSource")return;const f=typeof se[S]=="object"?se[S]:{ideal:se[S]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const _=function(R,U){return R?R+U.charAt(0).toUpperCase()+U.slice(1):U==="deviceId"?"sourceId":U};if(f.ideal!==void 0){me.optional=me.optional||[];let R={};typeof f.ideal=="number"?(R[_("min",S)]=f.ideal,me.optional.push(R),R={},R[_("max",S)]=f.ideal,me.optional.push(R)):(R[_("",S)]=f.ideal,me.optional.push(R))}f.exact!==void 0&&typeof f.exact!="number"?(me.mandatory=me.mandatory||{},me.mandatory[_("",S)]=f.exact):["min","max"].forEach((R=>{f[R]!==void 0&&(me.mandatory=me.mandatory||{},me.mandatory[_(R,S)]=f[R])}))})),se.advanced&&(me.optional=(me.optional||[]).concat(se.advanced)),me},V=function(se,me){if(w.version>=61)return me(se);if((se=JSON.parse(JSON.stringify(se)))&&typeof se.audio=="object"){const S=function(f,_,R){_ in f&&!(R in f)&&(f[R]=f[_],delete f[_])};S((se=JSON.parse(JSON.stringify(se))).audio,"autoGainControl","googAutoGainControl"),S(se.audio,"noiseSuppression","googNoiseSuppression"),se.audio=B(se.audio)}if(se&&typeof se.video=="object"){let S=se.video.facingMode;S=S&&(typeof S=="object"?S:{ideal:S});const f=w.version<66;if(S&&(S.exact==="user"||S.exact==="environment"||S.ideal==="user"||S.ideal==="environment")&&(!O.mediaDevices.getSupportedConstraints||!O.mediaDevices.getSupportedConstraints().facingMode||f)){let _;if(delete se.video.facingMode,S.exact==="environment"||S.ideal==="environment"?_=["back","rear"]:S.exact!=="user"&&S.ideal!=="user"||(_=["front"]),_)return O.mediaDevices.enumerateDevices().then((R=>{let U=(R=R.filter((ee=>ee.kind==="videoinput"))).find((ee=>_.some((ue=>ee.label.toLowerCase().includes(ue)))));return!U&&R.length&&_.includes("back")&&(U=R[R.length-1]),U&&(se.video.deviceId=S.exact?{exact:U.deviceId}:{ideal:U.deviceId}),se.video=B(se.video),I("chrome: "+JSON.stringify(se)),me(se)}))}se.video=B(se.video)}return I("chrome: "+JSON.stringify(se)),me(se)},Y=function(se){return w.version>=64?se:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[se.name]||se.name,message:se.message,constraint:se.constraint||se.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(O.getUserMedia=(function(se,me,S){V(se,(f=>{O.webkitGetUserMedia(f,me,(_=>{S&&S(Y(_))}))}))}).bind(O),O.mediaDevices.getUserMedia){const se=O.mediaDevices.getUserMedia.bind(O.mediaDevices);O.mediaDevices.getUserMedia=function(me){return V(me,(S=>se(S).then((f=>{if(S.audio&&!f.getAudioTracks().length||S.video&&!f.getVideoTracks().length)throw f.getTracks().forEach((_=>{_.stop()})),new DOMException("","NotFoundError");return f}),(f=>Promise.reject(Y(f))))))}}}function H(L,w){L.navigator.mediaDevices&&"getDisplayMedia"in L.navigator.mediaDevices||L.navigator.mediaDevices&&(typeof w=="function"?L.navigator.mediaDevices.getDisplayMedia=function(O){return w(O).then((B=>{const V=O.video&&O.video.width,Y=O.video&&O.video.height,se=O.video&&O.video.frameRate;return O.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:B,maxFrameRate:se||3}},V&&(O.video.mandatory.maxWidth=V),Y&&(O.video.mandatory.maxHeight=Y),L.navigator.mediaDevices.getUserMedia(O)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function K(L){L.MediaStream=L.MediaStream||L.webkitMediaStream}function P(L){if(typeof L=="object"&&L.RTCPeerConnection&&!("ontrack"in L.RTCPeerConnection.prototype)){Object.defineProperty(L.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(O){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=O)},enumerable:!0,configurable:!0});const w=L.RTCPeerConnection.prototype.setRemoteDescription;L.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=O=>{O.stream.addEventListener("addtrack",(B=>{let V;V=L.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((se=>se.track&&se.track.id===B.track.id)):{track:B.track};const Y=new Event("track");Y.track=B.track,Y.receiver=V,Y.transceiver={receiver:V},Y.streams=[O.stream],this.dispatchEvent(Y)})),O.stream.getTracks().forEach((B=>{let V;V=L.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((se=>se.track&&se.track.id===B.id)):{track:B};const Y=new Event("track");Y.track=B,Y.receiver=V,Y.transceiver={receiver:V},Y.streams=[O.stream],this.dispatchEvent(Y)}))},this.addEventListener("addstream",this._ontrackpoly)),w.apply(this,arguments)}}else g(L,"track",(w=>(w.transceiver||Object.defineProperty(w,"transceiver",{value:{receiver:w.receiver}}),w)))}function F(L){if(typeof L=="object"&&L.RTCPeerConnection&&!("getSenders"in L.RTCPeerConnection.prototype)&&"createDTMFSender"in L.RTCPeerConnection.prototype){const w=function(V,Y){return{track:Y,get dtmf(){return this._dtmf===void 0&&(Y.kind==="audio"?this._dtmf=V.createDTMFSender(Y):this._dtmf=null),this._dtmf},_pc:V}};if(!L.RTCPeerConnection.prototype.getSenders){L.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const V=L.RTCPeerConnection.prototype.addTrack;L.RTCPeerConnection.prototype.addTrack=function(se,me){let S=V.apply(this,arguments);return S||(S=w(this,se),this._senders.push(S)),S};const Y=L.RTCPeerConnection.prototype.removeTrack;L.RTCPeerConnection.prototype.removeTrack=function(se){Y.apply(this,arguments);const me=this._senders.indexOf(se);me!==-1&&this._senders.splice(me,1)}}const O=L.RTCPeerConnection.prototype.addStream;L.RTCPeerConnection.prototype.addStream=function(V){this._senders=this._senders||[],O.apply(this,[V]),V.getTracks().forEach((Y=>{this._senders.push(w(this,Y))}))};const B=L.RTCPeerConnection.prototype.removeStream;L.RTCPeerConnection.prototype.removeStream=function(V){this._senders=this._senders||[],B.apply(this,[V]),V.getTracks().forEach((Y=>{const se=this._senders.find((me=>me.track===Y));se&&this._senders.splice(this._senders.indexOf(se),1)}))}}else if(typeof L=="object"&&L.RTCPeerConnection&&"getSenders"in L.RTCPeerConnection.prototype&&"createDTMFSender"in L.RTCPeerConnection.prototype&&L.RTCRtpSender&&!("dtmf"in L.RTCRtpSender.prototype)){const w=L.RTCPeerConnection.prototype.getSenders;L.RTCPeerConnection.prototype.getSenders=function(){const O=w.apply(this,[]);return O.forEach((B=>B._pc=this)),O},Object.defineProperty(L.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function N(L){if(!L.RTCPeerConnection)return;const w=L.RTCPeerConnection.prototype.getStats;L.RTCPeerConnection.prototype.getStats=function(){const[O,B,V]=arguments;if(arguments.length>0&&typeof O=="function")return w.apply(this,arguments);if(w.length===0&&(arguments.length===0||typeof O!="function"))return w.apply(this,[]);const Y=function(me){const S={};return me.result().forEach((f=>{const _={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach((R=>{_[R]=f.stat(R)})),S[_.id]=_})),S},se=function(me){return new Map(Object.keys(me).map((S=>[S,me[S]])))};if(arguments.length>=2){const me=function(S){B(se(Y(S)))};return w.apply(this,[me,O])}return new Promise(((me,S)=>{w.apply(this,[function(f){me(se(Y(f)))},S])})).then(B,V)}}function X(L){if(!(typeof L=="object"&&L.RTCPeerConnection&&L.RTCRtpSender&&L.RTCRtpReceiver))return;if(!("getStats"in L.RTCRtpSender.prototype)){const O=L.RTCPeerConnection.prototype.getSenders;O&&(L.RTCPeerConnection.prototype.getSenders=function(){const V=O.apply(this,[]);return V.forEach((Y=>Y._pc=this)),V});const B=L.RTCPeerConnection.prototype.addTrack;B&&(L.RTCPeerConnection.prototype.addTrack=function(){const V=B.apply(this,arguments);return V._pc=this,V}),L.RTCRtpSender.prototype.getStats=function(){const V=this;return this._pc.getStats().then((Y=>M(Y,V.track,!0)))}}if(!("getStats"in L.RTCRtpReceiver.prototype)){const O=L.RTCPeerConnection.prototype.getReceivers;O&&(L.RTCPeerConnection.prototype.getReceivers=function(){const B=O.apply(this,[]);return B.forEach((V=>V._pc=this)),B}),g(L,"track",(B=>(B.receiver._pc=B.srcElement,B))),L.RTCRtpReceiver.prototype.getStats=function(){const B=this;return this._pc.getStats().then((V=>M(V,B.track,!1)))}}if(!("getStats"in L.RTCRtpSender.prototype)||!("getStats"in L.RTCRtpReceiver.prototype))return;const w=L.RTCPeerConnection.prototype.getStats;L.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof L.MediaStreamTrack){const O=arguments[0];let B,V,Y;return this.getSenders().forEach((se=>{se.track===O&&(B?Y=!0:B=se)})),this.getReceivers().forEach((se=>(se.track===O&&(V?Y=!0:V=se),se.track===O))),Y||B&&V?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):B?B.getStats():V?V.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return w.apply(this,arguments)}}function G(L){L.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((Y=>this._shimmedLocalStreams[Y][0]))};const w=L.RTCPeerConnection.prototype.addTrack;L.RTCPeerConnection.prototype.addTrack=function(Y,se){if(!se)return w.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const me=w.apply(this,arguments);return this._shimmedLocalStreams[se.id]?this._shimmedLocalStreams[se.id].indexOf(me)===-1&&this._shimmedLocalStreams[se.id].push(me):this._shimmedLocalStreams[se.id]=[se,me],me};const O=L.RTCPeerConnection.prototype.addStream;L.RTCPeerConnection.prototype.addStream=function(Y){this._shimmedLocalStreams=this._shimmedLocalStreams||{},Y.getTracks().forEach((S=>{if(this.getSenders().find((f=>f.track===S)))throw new DOMException("Track already exists.","InvalidAccessError")}));const se=this.getSenders();O.apply(this,arguments);const me=this.getSenders().filter((S=>se.indexOf(S)===-1));this._shimmedLocalStreams[Y.id]=[Y].concat(me)};const B=L.RTCPeerConnection.prototype.removeStream;L.RTCPeerConnection.prototype.removeStream=function(Y){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[Y.id],B.apply(this,arguments)};const V=L.RTCPeerConnection.prototype.removeTrack;L.RTCPeerConnection.prototype.removeTrack=function(Y){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Y&&Object.keys(this._shimmedLocalStreams).forEach((se=>{const me=this._shimmedLocalStreams[se].indexOf(Y);me!==-1&&this._shimmedLocalStreams[se].splice(me,1),this._shimmedLocalStreams[se].length===1&&delete this._shimmedLocalStreams[se]})),V.apply(this,arguments)}}function j(L,w){if(!L.RTCPeerConnection)return;if(L.RTCPeerConnection.prototype.addTrack&&w.version>=65)return G(L);const O=L.RTCPeerConnection.prototype.getLocalStreams;L.RTCPeerConnection.prototype.getLocalStreams=function(){const S=O.apply(this);return this._reverseStreams=this._reverseStreams||{},S.map((f=>this._reverseStreams[f.id]))};const B=L.RTCPeerConnection.prototype.addStream;L.RTCPeerConnection.prototype.addStream=function(S){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},S.getTracks().forEach((f=>{if(this.getSenders().find((_=>_.track===f)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[S.id]){const f=new L.MediaStream(S.getTracks());this._streams[S.id]=f,this._reverseStreams[f.id]=S,S=f}B.apply(this,[S])};const V=L.RTCPeerConnection.prototype.removeStream;function Y(S,f){let _=f.sdp;return Object.keys(S._reverseStreams||[]).forEach((R=>{const U=S._reverseStreams[R],ee=S._streams[U.id];_=_.replace(new RegExp(ee.id,"g"),U.id)})),new RTCSessionDescription({type:f.type,sdp:_})}L.RTCPeerConnection.prototype.removeStream=function(S){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},V.apply(this,[this._streams[S.id]||S]),delete this._reverseStreams[this._streams[S.id]?this._streams[S.id].id:S.id],delete this._streams[S.id]},L.RTCPeerConnection.prototype.addTrack=function(S,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find((U=>U===S)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((U=>U.track===S)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const R=this._streams[f.id];if(R)R.addTrack(S),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const U=new L.MediaStream([S]);this._streams[f.id]=U,this._reverseStreams[U.id]=f,this.addStream(U)}return this.getSenders().find((U=>U.track===S))},["createOffer","createAnswer"].forEach((function(S){const f=L.RTCPeerConnection.prototype[S],_={[S](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[U=>{const ee=Y(this,U);R[0].apply(null,[ee])},U=>{R[1]&&R[1].apply(null,U)},arguments[2]]):f.apply(this,arguments).then((U=>Y(this,U)))}};L.RTCPeerConnection.prototype[S]=_[S]}));const se=L.RTCPeerConnection.prototype.setLocalDescription;L.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(S,f){let _=f.sdp;return Object.keys(S._reverseStreams||[]).forEach((R=>{const U=S._reverseStreams[R],ee=S._streams[U.id];_=_.replace(new RegExp(U.id,"g"),ee.id)})),new RTCSessionDescription({type:f.type,sdp:_})})(this,arguments[0]),se.apply(this,arguments)):se.apply(this,arguments)};const me=Object.getOwnPropertyDescriptor(L.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(L.RTCPeerConnection.prototype,"localDescription",{get(){const S=me.get.apply(this);return S.type===""?S:Y(this,S)}}),L.RTCPeerConnection.prototype.removeTrack=function(S){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!S._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(S._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach((_=>{this._streams[_].getTracks().find((R=>S.track===R))&&(f=this._streams[_])})),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(S.track),this.dispatchEvent(new Event("negotiationneeded")))}}function q(L,w){!L.RTCPeerConnection&&L.webkitRTCPeerConnection&&(L.RTCPeerConnection=L.webkitRTCPeerConnection),L.RTCPeerConnection&&w.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(O){const B=L.RTCPeerConnection.prototype[O],V={[O](){return arguments[0]=new(O==="addIceCandidate"?L.RTCIceCandidate:L.RTCSessionDescription)(arguments[0]),B.apply(this,arguments)}};L.RTCPeerConnection.prototype[O]=V[O]}))}function te(L,w){g(L,"negotiationneeded",(O=>{const B=O.target;if(!(w.version<72||B.getConfiguration&&B.getConfiguration().sdpSemantics==="plan-b")||B.signalingState==="stable")return O}))}function W(L,w){const O=L&&L.navigator,B=L&&L.MediaStreamTrack;if(O.getUserMedia=function(V,Y,se){E("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),O.mediaDevices.getUserMedia(V).then(Y,se)},!(w.version>55&&"autoGainControl"in O.mediaDevices.getSupportedConstraints())){const V=function(se,me,S){me in se&&!(S in se)&&(se[S]=se[me],delete se[me])},Y=O.mediaDevices.getUserMedia.bind(O.mediaDevices);if(O.mediaDevices.getUserMedia=function(se){return typeof se=="object"&&typeof se.audio=="object"&&(se=JSON.parse(JSON.stringify(se)),V(se.audio,"autoGainControl","mozAutoGainControl"),V(se.audio,"noiseSuppression","mozNoiseSuppression")),Y(se)},B&&B.prototype.getSettings){const se=B.prototype.getSettings;B.prototype.getSettings=function(){const me=se.apply(this,arguments);return V(me,"mozAutoGainControl","autoGainControl"),V(me,"mozNoiseSuppression","noiseSuppression"),me}}if(B&&B.prototype.applyConstraints){const se=B.prototype.applyConstraints;B.prototype.applyConstraints=function(me){return this.kind==="audio"&&typeof me=="object"&&(me=JSON.parse(JSON.stringify(me)),V(me,"autoGainControl","mozAutoGainControl"),V(me,"noiseSuppression","mozNoiseSuppression")),se.apply(this,[me])}}}}function $(L,w){L.navigator.mediaDevices&&"getDisplayMedia"in L.navigator.mediaDevices||L.navigator.mediaDevices&&(L.navigator.mediaDevices.getDisplayMedia=function(O){if(!O||!O.video){const B=new DOMException("getDisplayMedia without video constraints is undefined");return B.name="NotFoundError",B.code=8,Promise.reject(B)}return O.video===!0?O.video={mediaSource:w}:O.video.mediaSource=w,L.navigator.mediaDevices.getUserMedia(O)})}function J(L){typeof L=="object"&&L.RTCTrackEvent&&"receiver"in L.RTCTrackEvent.prototype&&!("transceiver"in L.RTCTrackEvent.prototype)&&Object.defineProperty(L.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ne(L,w){if(typeof L!="object"||!L.RTCPeerConnection&&!L.mozRTCPeerConnection)return;!L.RTCPeerConnection&&L.mozRTCPeerConnection&&(L.RTCPeerConnection=L.mozRTCPeerConnection),w.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(V){const Y=L.RTCPeerConnection.prototype[V],se={[V](){return arguments[0]=new(V==="addIceCandidate"?L.RTCIceCandidate:L.RTCSessionDescription)(arguments[0]),Y.apply(this,arguments)}};L.RTCPeerConnection.prototype[V]=se[V]}));const O={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},B=L.RTCPeerConnection.prototype.getStats;L.RTCPeerConnection.prototype.getStats=function(){const[V,Y,se]=arguments;return B.apply(this,[V||null]).then((me=>{if(w.version<53&&!Y)try{me.forEach((S=>{S.type=O[S.type]||S.type}))}catch(S){if(S.name!=="TypeError")throw S;me.forEach(((f,_)=>{me.set(_,Object.assign({},f,{type:O[f.type]||f.type}))}))}return me})).then(Y,se)}}function ie(L){if(typeof L!="object"||!L.RTCPeerConnection||!L.RTCRtpSender||L.RTCRtpSender&&"getStats"in L.RTCRtpSender.prototype)return;const w=L.RTCPeerConnection.prototype.getSenders;w&&(L.RTCPeerConnection.prototype.getSenders=function(){const B=w.apply(this,[]);return B.forEach((V=>V._pc=this)),B});const O=L.RTCPeerConnection.prototype.addTrack;O&&(L.RTCPeerConnection.prototype.addTrack=function(){const B=O.apply(this,arguments);return B._pc=this,B}),L.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ae(L){if(typeof L!="object"||!L.RTCPeerConnection||!L.RTCRtpSender||L.RTCRtpSender&&"getStats"in L.RTCRtpReceiver.prototype)return;const w=L.RTCPeerConnection.prototype.getReceivers;w&&(L.RTCPeerConnection.prototype.getReceivers=function(){const O=w.apply(this,[]);return O.forEach((B=>B._pc=this)),O}),g(L,"track",(O=>(O.receiver._pc=O.srcElement,O))),L.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function xe(L){L.RTCPeerConnection&&!("removeStream"in L.RTCPeerConnection.prototype)&&(L.RTCPeerConnection.prototype.removeStream=function(w){E("removeStream","removeTrack"),this.getSenders().forEach((O=>{O.track&&w.getTracks().includes(O.track)&&this.removeTrack(O)}))})}function Ne(L){L.DataChannel&&!L.RTCDataChannel&&(L.RTCDataChannel=L.DataChannel)}function Re(L){if(typeof L!="object"||!L.RTCPeerConnection)return;const w=L.RTCPeerConnection.prototype.addTransceiver;w&&(L.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let O=arguments[1]&&arguments[1].sendEncodings;O===void 0&&(O=[]),O=[...O];const B=O.length>0;B&&O.forEach((Y=>{if("rid"in Y&&!/^[a-z0-9]{0,16}$/i.test(Y.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in Y&&!(parseFloat(Y.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in Y&&!(parseFloat(Y.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const V=w.apply(this,arguments);if(B){const{sender:Y}=V,se=Y.getParameters();(!("encodings"in se)||se.encodings.length===1&&Object.keys(se.encodings[0]).length===0)&&(se.encodings=O,Y.sendEncodings=O,this.setParametersPromises.push(Y.setParameters(se).then((()=>{delete Y.sendEncodings})).catch((()=>{delete Y.sendEncodings}))))}return V})}function Se(L){if(typeof L!="object"||!L.RTCRtpSender)return;const w=L.RTCRtpSender.prototype.getParameters;w&&(L.RTCRtpSender.prototype.getParameters=function(){const O=w.apply(this,arguments);return"encodings"in O||(O.encodings=[].concat(this.sendEncodings||[{}])),O})}function ze(L){if(typeof L!="object"||!L.RTCPeerConnection)return;const w=L.RTCPeerConnection.prototype.createOffer;L.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>w.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):w.apply(this,arguments)}}function Be(L){if(typeof L!="object"||!L.RTCPeerConnection)return;const w=L.RTCPeerConnection.prototype.createAnswer;L.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>w.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):w.apply(this,arguments)}}function Je(L){if(typeof L=="object"&&L.RTCPeerConnection){if("getLocalStreams"in L.RTCPeerConnection.prototype||(L.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in L.RTCPeerConnection.prototype)){const w=L.RTCPeerConnection.prototype.addTrack;L.RTCPeerConnection.prototype.addStream=function(O){this._localStreams||(this._localStreams=[]),this._localStreams.includes(O)||this._localStreams.push(O),O.getAudioTracks().forEach((B=>w.call(this,B,O))),O.getVideoTracks().forEach((B=>w.call(this,B,O)))},L.RTCPeerConnection.prototype.addTrack=function(O,...B){return B&&B.forEach((V=>{this._localStreams?this._localStreams.includes(V)||this._localStreams.push(V):this._localStreams=[V]})),w.apply(this,arguments)}}"removeStream"in L.RTCPeerConnection.prototype||(L.RTCPeerConnection.prototype.removeStream=function(w){this._localStreams||(this._localStreams=[]);const O=this._localStreams.indexOf(w);if(O===-1)return;this._localStreams.splice(O,1);const B=w.getTracks();this.getSenders().forEach((V=>{B.includes(V.track)&&this.removeTrack(V)}))})}}function at(L){if(typeof L=="object"&&L.RTCPeerConnection&&("getRemoteStreams"in L.RTCPeerConnection.prototype||(L.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in L.RTCPeerConnection.prototype))){Object.defineProperty(L.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(O){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=O),this.addEventListener("track",this._onaddstreampoly=B=>{B.streams.forEach((V=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(V))return;this._remoteStreams.push(V);const Y=new Event("addstream");Y.stream=V,this.dispatchEvent(Y)}))})}});const w=L.RTCPeerConnection.prototype.setRemoteDescription;L.RTCPeerConnection.prototype.setRemoteDescription=function(){const O=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(B){B.streams.forEach((V=>{if(O._remoteStreams||(O._remoteStreams=[]),O._remoteStreams.indexOf(V)>=0)return;O._remoteStreams.push(V);const Y=new Event("addstream");Y.stream=V,O.dispatchEvent(Y)}))}),w.apply(O,arguments)}}}function re(L){if(typeof L!="object"||!L.RTCPeerConnection)return;const w=L.RTCPeerConnection.prototype,O=w.createOffer,B=w.createAnswer,V=w.setLocalDescription,Y=w.setRemoteDescription,se=w.addIceCandidate;w.createOffer=function(S,f){const _=arguments.length>=2?arguments[2]:arguments[0],R=O.apply(this,[_]);return f?(R.then(S,f),Promise.resolve()):R},w.createAnswer=function(S,f){const _=arguments.length>=2?arguments[2]:arguments[0],R=B.apply(this,[_]);return f?(R.then(S,f),Promise.resolve()):R};let me=function(S,f,_){const R=V.apply(this,[S]);return _?(R.then(f,_),Promise.resolve()):R};w.setLocalDescription=me,me=function(S,f,_){const R=Y.apply(this,[S]);return _?(R.then(f,_),Promise.resolve()):R},w.setRemoteDescription=me,me=function(S,f,_){const R=se.apply(this,[S]);return _?(R.then(f,_),Promise.resolve()):R},w.addIceCandidate=me}function Le(L){const w=L&&L.navigator;if(w.mediaDevices&&w.mediaDevices.getUserMedia){const O=w.mediaDevices,B=O.getUserMedia.bind(O);w.mediaDevices.getUserMedia=V=>B(He(V))}!w.getUserMedia&&w.mediaDevices&&w.mediaDevices.getUserMedia&&(w.getUserMedia=(function(O,B,V){w.mediaDevices.getUserMedia(O).then(B,V)}).bind(w))}function He(L){return L&&L.video!==void 0?Object.assign({},L,{video:A(L.video)}):L}function Ue(L){if(!L.RTCPeerConnection)return;const w=L.RTCPeerConnection;L.RTCPeerConnection=function(O,B){if(O&&O.iceServers){const V=[];for(let Y=0;Y<O.iceServers.length;Y++){let se=O.iceServers[Y];se.urls===void 0&&se.url?(E("RTCIceServer.url","RTCIceServer.urls"),se=JSON.parse(JSON.stringify(se)),se.urls=se.url,delete se.url,V.push(se)):V.push(O.iceServers[Y])}O.iceServers=V}return new w(O,B)},L.RTCPeerConnection.prototype=w.prototype,"generateCertificate"in w&&Object.defineProperty(L.RTCPeerConnection,"generateCertificate",{get:()=>w.generateCertificate})}function De(L){typeof L=="object"&&L.RTCTrackEvent&&"receiver"in L.RTCTrackEvent.prototype&&!("transceiver"in L.RTCTrackEvent.prototype)&&Object.defineProperty(L.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fe(L){const w=L.RTCPeerConnection.prototype.createOffer;L.RTCPeerConnection.prototype.createOffer=function(O){if(O){O.offerToReceiveAudio!==void 0&&(O.offerToReceiveAudio=!!O.offerToReceiveAudio);const B=this.getTransceivers().find((Y=>Y.receiver.track.kind==="audio"));O.offerToReceiveAudio===!1&&B?B.direction==="sendrecv"?B.setDirection?B.setDirection("sendonly"):B.direction="sendonly":B.direction==="recvonly"&&(B.setDirection?B.setDirection("inactive"):B.direction="inactive"):O.offerToReceiveAudio!==!0||B||this.addTransceiver("audio",{direction:"recvonly"}),O.offerToReceiveVideo!==void 0&&(O.offerToReceiveVideo=!!O.offerToReceiveVideo);const V=this.getTransceivers().find((Y=>Y.receiver.track.kind==="video"));O.offerToReceiveVideo===!1&&V?V.direction==="sendrecv"?V.setDirection?V.setDirection("sendonly"):V.direction="sendonly":V.direction==="recvonly"&&(V.setDirection?V.setDirection("inactive"):V.direction="inactive"):O.offerToReceiveVideo!==!0||V||this.addTransceiver("video",{direction:"recvonly"})}return w.apply(this,arguments)}}function ve(L){typeof L!="object"||L.AudioContext||(L.AudioContext=L.webkitAudioContext)}var Ae=i(7963),pe=i.n(Ae);function Ge(L){if(!L.RTCIceCandidate||L.RTCIceCandidate&&"foundation"in L.RTCIceCandidate.prototype)return;const w=L.RTCIceCandidate;L.RTCIceCandidate=function(O){if(typeof O=="object"&&O.candidate&&O.candidate.indexOf("a=")===0&&((O=JSON.parse(JSON.stringify(O))).candidate=O.candidate.substring(2)),O.candidate&&O.candidate.length){const B=new w(O),V=pe().parseCandidate(O.candidate);for(const Y in V)Y in B||Object.defineProperty(B,Y,{value:V[Y]});return B.toJSON=function(){return{candidate:B.candidate,sdpMid:B.sdpMid,sdpMLineIndex:B.sdpMLineIndex,usernameFragment:B.usernameFragment}},B}return new w(O)},L.RTCIceCandidate.prototype=w.prototype,g(L,"icecandidate",(O=>(O.candidate&&Object.defineProperty(O,"candidate",{value:new L.RTCIceCandidate(O.candidate),writable:"false"}),O)))}function Qe(L){!L.RTCIceCandidate||L.RTCIceCandidate&&"relayProtocol"in L.RTCIceCandidate.prototype||g(L,"icecandidate",(w=>{if(w.candidate){const O=pe().parseCandidate(w.candidate.candidate);O.type==="relay"&&(w.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[O.priority>>24])}return w}))}function Ze(L,w){if(!L.RTCPeerConnection)return;"sctp"in L.RTCPeerConnection.prototype||Object.defineProperty(L.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const O=L.RTCPeerConnection.prototype.setRemoteDescription;L.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,w.browser==="chrome"&&w.version>=76){const{sdpSemantics:B}=this.getConfiguration();B==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if((function(B){if(!B||!B.sdp)return!1;const V=pe().splitSections(B.sdp);return V.shift(),V.some((Y=>{const se=pe().parseMLine(Y);return se&&se.kind==="application"&&se.protocol.indexOf("SCTP")!==-1}))})(arguments[0])){const B=(function(S){const f=S.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;const _=parseInt(f[1],10);return _!=_?-1:_})(arguments[0]),V=(function(S){let f=65536;return w.browser==="firefox"&&(f=w.version<57?S===-1?16384:2147483637:w.version<60?w.version===57?65535:65536:2147483637),f})(B),Y=(function(S,f){let _=65536;w.browser==="firefox"&&w.version===57&&(_=65535);const R=pe().matchPrefix(S.sdp,"a=max-message-size:");return R.length>0?_=parseInt(R[0].substring(19),10):w.browser==="firefox"&&f!==-1&&(_=2147483637),_})(arguments[0],B);let se;se=V===0&&Y===0?Number.POSITIVE_INFINITY:V===0||Y===0?Math.max(V,Y):Math.min(V,Y);const me={};Object.defineProperty(me,"maxMessageSize",{get:()=>se}),this._sctp=me}return O.apply(this,arguments)}}function tt(L){if(!L.RTCPeerConnection||!("createDataChannel"in L.RTCPeerConnection.prototype))return;function w(B,V){const Y=B.send;B.send=function(){const se=arguments[0],me=se.length||se.size||se.byteLength;if(B.readyState==="open"&&V.sctp&&me>V.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+V.sctp.maxMessageSize+" bytes)");return Y.apply(B,arguments)}}const O=L.RTCPeerConnection.prototype.createDataChannel;L.RTCPeerConnection.prototype.createDataChannel=function(){const B=O.apply(this,arguments);return w(B,this),B},g(L,"datachannel",(B=>(w(B.channel,B.target),B)))}function Ft(L){if(!L.RTCPeerConnection||"connectionState"in L.RTCPeerConnection.prototype)return;const w=L.RTCPeerConnection.prototype;Object.defineProperty(w,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(w,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(O){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),O&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=O)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((O=>{const B=w[O];w[O]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=V=>{const Y=V.target;if(Y._lastConnectionState!==Y.connectionState){Y._lastConnectionState=Y.connectionState;const se=new Event("connectionstatechange",V);Y.dispatchEvent(se)}return V},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),B.apply(this,arguments)}}))}function bt(L,w){if(!L.RTCPeerConnection||w.browser==="chrome"&&w.version>=71||w.browser==="safari"&&w.version>=605)return;const O=L.RTCPeerConnection.prototype.setRemoteDescription;L.RTCPeerConnection.prototype.setRemoteDescription=function(B){if(B&&B.sdp&&B.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const V=B.sdp.split(`
`).filter((Y=>Y.trim()!=="a=extmap-allow-mixed")).join(`
`);L.RTCSessionDescription&&B instanceof L.RTCSessionDescription?arguments[0]=new L.RTCSessionDescription({type:B.type,sdp:V}):B.sdp=V}return O.apply(this,arguments)}}function Mt(L,w){if(!L.RTCPeerConnection||!L.RTCPeerConnection.prototype)return;const O=L.RTCPeerConnection.prototype.addIceCandidate;O&&O.length!==0&&(L.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(w.browser==="chrome"&&w.version<78||w.browser==="firefox"&&w.version<68||w.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():O.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Ie(L,w){if(!L.RTCPeerConnection||!L.RTCPeerConnection.prototype)return;const O=L.RTCPeerConnection.prototype.setLocalDescription;O&&O.length!==0&&(L.RTCPeerConnection.prototype.setLocalDescription=function(){let B=arguments[0]||{};if(typeof B!="object"||B.type&&B.sdp)return O.apply(this,arguments);if(B={type:B.type,sdp:B.sdp},!B.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":B.type="offer";break;default:B.type="answer"}return B.sdp||B.type!=="offer"&&B.type!=="answer"?O.apply(this,[B]):(B.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((V=>O.apply(this,[V])))})}(function({window:L}={},w={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const O=x,B=(function(Y){const se={browser:null,version:null};if(Y===void 0||!Y.navigator||!Y.navigator.userAgent)return se.browser="Not a browser.",se;const{navigator:me}=Y;if(me.mozGetUserMedia)se.browser="firefox",se.version=p(me.userAgent,/Firefox\/(\d+)\./,1);else if(me.webkitGetUserMedia||Y.isSecureContext===!1&&Y.webkitRTCPeerConnection)se.browser="chrome",se.version=p(me.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!Y.RTCPeerConnection||!me.userAgent.match(/AppleWebKit\/(\d+)\./))return se.browser="Not a supported browser.",se;se.browser="safari",se.version=p(me.userAgent,/AppleWebKit\/(\d+)\./,1),se.supportsUnifiedPlan=Y.RTCRtpTransceiver&&"currentDirection"in Y.RTCRtpTransceiver.prototype}return se})(L),V={browserDetails:B,commonShim:l,extractVersion:p,disableLog:y,disableWarnings:v,sdp:Ae};switch(B.browser){case"chrome":if(!o||!q||!w.shimChrome)return O("Chrome shim is not included in this adapter release."),V;if(B.version===null)return O("Chrome shim can not determine version, not shimming."),V;O("adapter.js shimming chrome."),V.browserShim=o,Mt(L,B),Ie(L),z(L,B),K(L),q(L,B),P(L),j(L,B),F(L),N(L),X(L),te(L,B),Ge(L),Qe(L),Ft(L),Ze(L,B),tt(L),bt(L,B);break;case"firefox":if(!a||!ne||!w.shimFirefox)return O("Firefox shim is not included in this adapter release."),V;O("adapter.js shimming firefox."),V.browserShim=a,Mt(L,B),Ie(L),W(L,B),ne(L,B),J(L),xe(L),ie(L),ae(L),Ne(L),Re(L),Se(L),ze(L),Be(L),Ge(L),Ft(L),Ze(L,B),tt(L);break;case"safari":if(!c||!w.shimSafari)return O("Safari shim is not included in this adapter release."),V;O("adapter.js shimming safari."),V.browserShim=c,Mt(L,B),Ie(L),Ue(L),fe(L),re(L),Je(L),at(L),De(L),Le(L),ve(L),Ge(L),Qe(L),Ze(L,B),tt(L),bt(L,B);break;default:O("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),i(8630);const ce=()=>typeof RTCPeerConnection=="function";var Q,le;(function(L){L[L.TRACE=0]="TRACE",L[L.DEBUG=1]="DEBUG",L[L.INFO=2]="INFO",L[L.WARN=3]="WARN",L[L.ERROR=4]="ERROR",L[L.SILENT=5]="SILENT"})(Q||(Q={})),(function(L){L.TIME="Time",L.WEBRTC="WebRTC",L.EMITTER="Emitter",L.MEDIA="Media",L.SUBSCRIPTION="StageSubscription",L.PUBLICATION="StagePublication",L.CONNECTION="StageConnection",L.SOCKET="StageSocket",L.BROADCAST_STAGE_CLIENT="BroadcastStageClient",L.STAGE="Stage",L.REMOTE_PARTICIPANT="RemoteParticipant",L.LOCAL_PARTICIPANT="LocalParticipant",L.CONFIGURATION="Configuration",L.REMOTE_PLAYBACK="RemotePlaybackController",L.REMOTE_STAGE_STREAM="RemoteStageStream"})(le||(le={}));const we=12e4,Me=3e5,Te="no-rid";class ye extends Error{constructor({name:w,message:O,code:B,details:V,cause:Y,params:se}){super(O),Error.captureStackTrace&&Error.captureStackTrace(this,ye),this.name=w||"BroadcastClientError",this.message=O,this.code=B,this.details=V,this.cause=Y,this.params=se}}const Ye={name:"BroadcastError",code:1e3,message:"Unable to broadcast"},Pe={name:"CameraError",code:2e3,message:"Camera could not be captured"},We={name:"InputError",code:3e3,message:"Input could not be attached"},Ve={name:"AddDeviceError",code:4e3,message:"Device is missing"},Xe={name:"AddDeviceNameExistsError",code:4001,message:"Name is already registered"},lt={name:"AddDeviceCompositionMissingError",code:4002,message:"VideoComposition is missing"},qe={name:"AddDeviceCompositionIndexMissingError",code:4003,message:`VideoComposition's "index" property is missing`},rt={name:"AddDeviceNameMissingError",code:4004,message:"Name property is missing"},it={name:"AddDeviceUnsupported",code:4005,message:"Unsupported device"},nt={name:"AddDeviceConstraintsError",code:4006,message:"Constraints error"},ct={name:"RemoveDeviceNotFoundError",code:5e3,message:"Device not found"},Qt={name:"RemoveImageNotFoundError",code:6e3,message:"Image not found"},tn={name:"UpdateVideoDeviceCompositionMissingError",code:7e3,message:"VideoComposition is missing"},Ot={name:"UpdateVideoDeviceCompositionIndexMissingError",code:7001,message:`VideoComposition's "index" property is missing`},qt={name:"UpdateVideoDeviceCompositionNameMissingError",code:7002,message:"Video device with that name is not found"},vt={name:"ExchangePositionDeviceNotFoundError",code:8e3,message:"Device with that name is not found"},Kt={name:"FailedToAddImageError",code:9e3,message:"Failed to add image"},_n={name:"PeerSetupError",code:1e4,message:"Unexpected return value from setup request"},Wt={name:"PeerConnectionError",code:10001,message:"Peer connection has failed."},dn={name:"InvalidStreamKey",code:10003,message:"Invalid Stream Key."},Mn={name:"BroadcastConfigurationError",code:11e3,message:"Error when configuring broadcast client"},Ln={name:"StreamConfigurationError",code:12e3,message:"Error when configuring stream"},is={name:"IngestEndpointTypeError",code:13e3,message:"Ingest endpoint must be a string"},ni={name:"IngestEndpointUrlError",code:13001,message:"Ingest endpoint must be a valid https or rtmps URL"},fi={name:"LogLevelTypeError",code:14e3,message:"Log Level must be a valid integer between [0..5]"},Ps={name:"LoggerTypeError",code:15e3,message:"Logger must be an object"},Ds={name:"ClientInvalidError",code:16e3,message:"Client is no longer valid, possibly due to delete() invocation."},zi={name:"NetworkReconnectConfigurationError",code:17e3,message:"Error when configuring network reconnect"},ds={name:"NetworkReconnectConfigurationInvalidTimeoutError",code:17001,message:"Network reconnect timeout value must be a number between [10000, 300000]"},ps={name:"StreamKeyInvalidCharError",code:18e3,message:"Streamkey must contain only [A-Za-z0-9_-] characters"},je={name:"StageTokenTypeError",code:19e3,message:"Stage token must be a string"},gt={name:"StageWhipUrlOverrideError",code:19001,message:"Stage WHIP override URL must be a string starting with http"};var Pt,Dt,St,nn,xn,ln,Un,ur,cr,Fn=function(L,w,O,B){if(typeof w=="function"?L!==w||!B:!w.has(L))throw new TypeError("Cannot read private member from an object whose class did not declare it");return O==="m"?B:O==="a"?B.call(L):B?B.value:w.get(L)},dr=function(L,w,O,B,V){if(typeof w=="function"?L!==w||!0:!w.has(L))throw new TypeError("Cannot write private member to an object whose class did not declare it");return w.set(L,O),O};const Dr=1920,ws=1080,Ar=Q.ERROR,Ur={maxResolution:{width:852,height:480},maxFramerate:30,maxBitrate:1500},rr={maxResolution:{width:480,height:852},maxFramerate:30,maxBitrate:1500},pr={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:3500},un={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:3500},Er={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:8500},Co={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:8500},io={reconnect:!1,timeout:we};function aa(L){var w,O;if(typeof L!="string"&&L!==void 0)throw new ye(is);if(L){if(L.startsWith("https"))return L;{const B=/(?<protocol>(rtmps|https):\/\/)?(?<id>.+)\.(?<environment>(?=\S*['-])([a-zA-Z'-]+))\.live-video\.net.*/.exec(L);if(((w=B?.groups)===null||w===void 0?void 0:w.protocol)==="rtmps"&&console.warn("rtmps server url detected; please pass in the ingest endpoint (no rtmps:// protocol) instead"),(O=B?.groups)===null||O===void 0?void 0:O.id)return`https://${B.groups.id}.webrtc.live-video.net:4443`;throw new ye(ni)}}return""}class ki{constructor(w,O,B=Ur,V,Y=io){this.LOG_LEVEL=Q,this.BASIC_LANDSCAPE=Ur,this.BASIC_PORTRAIT=rr,this.BASIC_FULL_HD_LANDSCAPE=pr,this.BASIC_FULL_HD_PORTRAIT=un,this.STANDARD_LANDSCAPE=Er,this.STANDARD_PORTRAIT=Co,Pt.set(this,void 0),Dt.set(this,void 0),St.set(this,Ur),nn.set(this,void 0),xn.set(this,io),ln.set(this,(se=>{if(!se)throw new ye(Object.assign(Object.assign({},Ln),{details:"missing stream configuration"}));if(!(se.maxBitrate<=8500&&se.maxBitrate>=200))throw new ye(Object.assign(Object.assign({},Ln),{details:"maxBitrate must be between 200 and 8500"}));if(!(se.maxFramerate<=60&&se.maxFramerate>=10))throw new ye(Object.assign(Object.assign({},Ln),{details:"maxFramerate must be between 10 and 60"}));const me=se.maxResolution.width,S=se.maxResolution.height;if(me>Dr||S>Dr||me<160||S<160||me===Dr&&S>ws||S===Dr&&me>ws)throw new ye(Object.assign(Object.assign({},Ln),{details:"maxResolution values must be between 1080x1920 or 1920x1080"}))})),Un.set(this,(se=>{if(!se)return;const me=Number(se),S=Number.isInteger(me),f=me>=Q.TRACE,_=me<=Q.SILENT;if(!S||!f||!_)throw new ye(fi)})),ur.set(this,(se=>{if(se&&typeof se!="object")throw new ye(Ps)})),cr.set(this,(se=>{if(!se)return;if(typeof se!="object"||typeof se.reconnect!="boolean")throw new ye(zi);const{timeout:me}=se;if(me!==void 0&&(Number.isNaN(me)||typeof me!="number"||me<1e4||me>Me))throw new ye(ds)})),Fn(this,ur,"f").call(this,V),Fn(this,Un,"f").call(this,O),Fn(this,ln,"f").call(this,B),dr(this,Pt,w),dr(this,Dt,O),dr(this,St,B),dr(this,nn,V),dr(this,xn,Y)}get ingestEndpoint(){return Fn(this,Pt,"f")}set ingestEndpoint(w){dr(this,Pt,aa(w))}get streamConfig(){return Fn(this,St,"f")}set streamConfig(w){Fn(this,ln,"f").call(this,w),dr(this,St,w)}get logLevel(){return Fn(this,Dt,"f")}set logLevel(w){Fn(this,Un,"f").call(this,w),dr(this,Dt,w)}get logger(){return Fn(this,nn,"f")}set logger(w){Fn(this,ur,"f").call(this,w),dr(this,nn,w)}get networkReconnectConfig(){return Fn(this,xn,"f")}set networkReconnectConfig(w){Fn(this,cr,"f").call(this,w),dr(this,xn,w)}}Pt=new WeakMap,Dt=new WeakMap,St=new WeakMap,nn=new WeakMap,xn=new WeakMap,ln=new WeakMap,Un=new WeakMap,ur=new WeakMap,cr=new WeakMap;var kn,Gr=i(228);(function(L){L.PUBLISHED_VIDEO_STATS="ivs_broadcast_webrtc_published_video_stats",L.PUBLISHED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_published_video_stats_window",L.PUBLISHED_AUDIO_STATS="ivs_broadcast_webrtc_published_audio_stats",L.PUBLISHED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_published_audio_stats_window",L.SUBSCRIBED_VIDEO_STATS="ivs_broadcast_webrtc_subscribed_video_stats",L.SUBSCRIBED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_video_stats_window",L.SUBSCRIBED_AUDIO_STATS="ivs_broadcast_webrtc_subscribed_audio_stats",L.SUBSCRIBED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_audio_stats_window",L.PUBLISH="ivs_broadcast_multihost_publish",L.UNPUBLISH="ivs_broadcast_multihost_unpublish",L.SUBSCRIBE="ivs_broadcast_multihost_subscribe",L.UNSUBSCRIBE="ivs_broadcast_multihost_unsubscribe",L.PUBLISH_STARTED="ivs_broadcast_multihost_publish_started",L.PUBLISH_FAILED="ivs_broadcast_multihost_publish_failed",L.PUBLISH_ENDED="ivs_broadcast_multihost_publish_ended",L.STATE_UPDATED="ivs_broadcast_multihost_event_state_updated",L.SUBSCRIBE_STARTED="ivs_broadcast_multihost_subscribe_started",L.SUBSCRIBE_FAILED="ivs_broadcast_multihost_subscribe_failed",L.SUBSCRIBE_ENDED="ivs_broadcast_multihost_subscribe_ended",L.FIRST_FRAME="ivs_broadcast_multihost_first_frame",L.JOIN="ivs_broadcast_multihost_join",L.JOIN_ATTEMPT="ivs_broadcast_multihost_event_connect_attempt",L.JOIN_ATTEMPT_FAILED="ivs_broadcast_multihost_event_connect_failed",L.JOIN_ENDED="ivs_broadcast_multihost_join_ended",L.LEAVE="ivs_broadcast_multihost_leave",L.REASSIGNMENT_REQUEST="ivs_broadcast_multihost_reassignment_request",L.SERVER_REQUEST="ivs_broadcast_multihost_server_request",L.TRACE="ivs_broadcast_stage_trace",L.ERROR="ivs_broadcast_error",L.MINUTE="ivs_broadcast_multihost_minute",L.CONNECTION_STATE="ivs_broadcast_webrtc_connection_state",L.ICE_GATHERING_STATE="ivs_broadcast_webrtc_gathering_state",L.EDP_CONNECTED="ivs_broadcast_multihost_event_connected",L.EDP_DISCONNECTED="ivs_broadcast_multihost_event_disconnected",L.EDP_PONG="ivs_broadcast_multihost_edp_rtt",L.SIMULCAST_LAYER_INFO="ivs_broadcast_simulcast_layer_info",L.MULTIHOST_CONFIGURATION="ivs_broadcast_multihost_configuration",L.MULTIHOST_SUBSCRIBE_CONFIGURATION="ivs_broadcast_multihost_subscribe_configuration",L.PLAYBACK_LAYER_REQUEST="ivs_broadcast_multihost_playback_layer_request",L.PLAYBACK_LAYER_STATE="ivs_broadcast_multihost_playback_layer_state",L.SELECTED_PAIR_CHANGE="ivs_broadcast_webrtc_selected_pair_change",L.ANALYTICS_HEALTH_REPORT="ivs_broadcast_analytics_health_report"})(kn||(kn={}));class $n{constructor(w,O,B,V){let Y="unknown";if(O.stageARN&&O.stageARN.startsWith("arn:aws:ivs:")){const se=O.stageARN.split(":");se.length===6&&(Y=se[4])}this.event=w,this.properties={client_time:new Date().toISOString(),customer_id:Y,device_software:window.navigator.userAgent,multihost_id:O.stageARN,participant_id:O.participantID,participant_user_id:O.userID,platform:"web",sdk_version:"1.27.0",stage_arn:O.stageARN,trace_id:B.value},O.attrGsRole&&(this.properties.token_attribute_0=O.attrGsRole),O.attrGsSessionId&&(this.properties.token_attribute_1=O.attrGsSessionId),this.critical=V}}class Zi extends $n{constructor(w){super(kn.ERROR,w.token,w.traceId,!0),Object.assign(this.properties,{code:w.code,tag:w.tag,description:w.message,remote_participant_id:w.remoteParticipantId,request_uuid:w.requestUUID,is_nominal:w.nominal,is_fatal:w.fatal,details:w.details,location:w.location,event_count:w.count})}}function za(L){const w=window.IVS_CLIENT_OVERRIDES;return typeof w=="object"?w[L]:L==="logLevel"?window.STAGES_LOG_LEVEL:L==="appLabel"?window.IVS_APP_LABEL:L==="whipUrl"?window.IVS_DATA_PLANE_ENDPOINT:void 0}function ms(L){const w=za(L);if(typeof w=="string")return w}function Rs(L){const w=za(L);if(typeof w=="boolean")return w}function th(L){const w=za(L);if(typeof w=="number")return w;if(typeof w=="string"){const O=parseFloat(w);if(!isNaN(O))return O}}function mm(){const L=za("logLevel");if(typeof L=="number"&&Object.values(Q).includes(L))return L}function np(){return Rs("disableXdp")}function rp(){return Rs("preferMainProfile")}function od(){return Rs("enableInitialLayerOnSdp")}function Ha(){return Rs("disableAudioRtcpRsize")}var Mc=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};function lc(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(L=>{const w=16*Math.random()|0;return(L==="x"?w:3&w|8).toString(16)}))}function kc(L,w=O=>{}){Mc(this,void 0,void 0,(function*(){try{yield L()}catch(O){w(O)}}))}var gm=i(6880),Xc=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};function Yc(L,w,O={},B=""){return Xc(this,void 0,void 0,(function*(){const V=new XMLHttpRequest;return V.open(L,w,!0),O&&Object.keys(O).forEach((Y=>{O.hasOwnProperty(Y)&&V.setRequestHeader(Y,O[Y])})),new Promise(((Y,se)=>{V.onreadystatechange=()=>{V.readyState===4&&(V.status>=200&&V.status<300?Y(V.responseText):se(new Error(`Ingest ${L} ${w} responded ${V.status}
${V.responseText}`)))},V.send(B)}))}))}function nh(L){const w=Date.now();for(const B of L)B.properties.batch_time_millis=w;var O;return{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:`data=${O=JSON.stringify(L),btoa(encodeURIComponent(O).replace(/%([0-9A-F]{2})/g,((B,V)=>String.fromCharCode(+`0x${V}`))))}`}}class gs{send(w,O=!1){return Xc(this,void 0,void 0,(function*(){const{currentEndpoint:B}=Oc,{headers:V,body:Y}=nh(w),se="eventSenderResult",me=w.length;if(O){const S=navigator.sendBeacon(B,Y);Oc.trackEvent({type:se,success:S,count:me})}else kc((()=>Xc(this,void 0,void 0,(function*(){yield Yc("POST",B,V,Y),Oc.trackEvent({type:se,success:!0,count:me})}))),(()=>{Oc.trackEvent({type:se,success:!1,count:me})}))}))}}class xi{constructor({globalProperties:w,totalEvents:O,totalEventsLost:B,windowedEvents:V,windowedEventsLost:Y,currentEndpoint:se}){this.transformProperties=(S,f,_,R,U)=>({total_events:S,total_events_lost:f,windowed_events:_,windowed_events_lost:R,current_endpoint:U});const me=this.transformProperties(O,B,V,Y,se);this.data={event:kn.ANALYTICS_HEALTH_REPORT,properties:Object.assign(Object.assign({},w),me)}}}var au=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};const kg={totalEvents:0,totalEventsSent:0,totalEventsLost:0,windowedEvents:0,windowedEventsSent:0,windowedEventsLost:0};class s_{constructor(w){this.globalSession=w,this.eventSenderMetrics=Object.assign({},kg),this.emptyWindows=0,this.scheduleHealthReport=()=>{this.reportTimer=window.setTimeout(this.onHealthReportInterval,6e4)},this.onHealthReportInterval=()=>{const O=Object.assign({},this.eventSenderMetrics);if(this.eventSenderMetrics.windowedEvents===0?this.emptyWindows++:this.emptyWindows=0,this.emptyWindows>3)return window.clearTimeout(this.reportTimer),void(this.reportTimer=void 0);this.postHealthReport(O),this.eventSenderMetrics.windowedEvents=0,this.eventSenderMetrics.windowedEventsSent=0,this.eventSenderMetrics.windowedEventsLost=0,this.scheduleHealthReport()}}trackEventSendResult(w){const{count:O,success:B}=w;this.eventSenderMetrics.totalEvents+=O,this.eventSenderMetrics.windowedEvents+=O,B?(this.eventSenderMetrics.totalEventsSent+=O,this.eventSenderMetrics.windowedEventsSent+=O):(this.eventSenderMetrics.totalEventsLost+=O,this.eventSenderMetrics.windowedEventsLost+=O),this.isHealthReportScheduled()||this.scheduleHealthReport()}isHealthReportScheduled(){return typeof this.reportTimer=="number"}postHealthReport(w){const O=this.globalSession.parseGlobalProperties(),B=this.globalSession.currentEndpoint,V=new xi(Object.assign(Object.assign({globalProperties:O},w),{currentEndpoint:B})),{headers:Y,body:se}=nh([V.data]);kc((()=>au(this,void 0,void 0,(function*(){yield Yc("POST",B,Y,se)}))))}}class Zc{constructor(){this.emitter=new Gr}hasListenersFor(w){return this.emitter.listenerCount(w)>0}on(w,O,B){O.call=(function(V,Y){return function(se,...me){try{Y.apply(se,me)}catch(S){let f=`Error in callback for ${V}`;const _=Y.name;return _&&(f+=` for function ${_}`),void console.error(`${f}
`,S)}}})(w,O),this.emitter.on(w,O,B)}off(w,O,B){this.emitter.off(w,O,B)}emit(w,...O){this.emitter.emit(w,...O)}removeAllListeners(){this.emitter.removeAllListeners()}}var vo;(function(L){L[L.EXCELLENT=4]="EXCELLENT",L[L.GOOD=3]="GOOD",L[L.NORMAL=2]="NORMAL",L[L.POOR=1]="POOR",L[L.DOWN=0]="DOWN"})(vo||(vo={}));var cu;(function(L){L.NETWORK_QUALITY_CHANGE="networkQualityChange"})(cu||(cu={}));class lu extends Zc{constructor(){super(),this.lastNetworkStatus={},this.networkAssessment={networkQuality:vo.NORMAL,reason:"no-data"},this.checkNetworkStatus=()=>{var w,O;const B=(w=navigator?.connection)!==null&&w!==void 0?w:{},V={downlink:B.downlink,effectiveType:B.effectiveType,rtt:B.rtt,isOnline:(O=navigator.onLine)===null||O===void 0||O};if(!this.isChangedNetworkStatus(this.lastNetworkStatus,V))return;this.lastNetworkStatus=V;const Y=this.networkAssessment,se=(function(me){const{rtt:S,downlink:f,isOnline:_}=me;if(!_)return{networkQuality:vo.DOWN,reason:"offline"};if(typeof S!="number"||typeof f!="number")return{networkQuality:vo.NORMAL,reason:"no-data"};let R=0;S>800?R+=2:S>300&&(R+=1),f<2.5?R+=2:f<5&&(R+=1);const U="score";switch(R){case 4:return{networkQuality:vo.POOR,reason:U};case 0:return{networkQuality:vo.EXCELLENT,reason:U};default:return{networkQuality:R<=2?vo.GOOD:vo.NORMAL,reason:U}}})(V);Y.networkQuality!==se.networkQuality&&this.emit(cu.NETWORK_QUALITY_CHANGE,Y.networkQuality,se.networkQuality),this.networkAssessment=se},this.getNetworkQuality=()=>this.networkAssessment.networkQuality,this.setupWindowListeners(),this.checkNetworkStatus()}setupWindowListeners(){window.addEventListener("online",(()=>{this.checkNetworkStatus()})),window.addEventListener("offline",(()=>{this.checkNetworkStatus()})),window.navigator.connection&&window.navigator.connection.addEventListener("change",(()=>{this.checkNetworkStatus()}))}isChangedNetworkStatus(w,O){const{downlink:B,effectiveType:V,rtt:Y,isOnline:se}=O;return w.effectiveType!==V||w.downlink!==B||w.rtt!==Y||w.isOnline!==se}}class pf{constructor(){this.globalSessionId=lc(),this.currentGlobalEndpoint="https://broadcast.stats.live-video.net/",this.healthReporter=new s_(this),this.networkMonitor=new lu}getGlobalSessionId(){return this.globalSessionId}set currentEndpoint(w){this.currentGlobalEndpoint=w}get currentEndpoint(){var w;return!((w=window.IVS_CLIENT_OVERRIDES)===null||w===void 0)&&w.analyticsPostUrl?window.IVS_CLIENT_OVERRIDES.analyticsPostUrl:this.currentGlobalEndpoint}trackEvent(w){w.type==="eventSenderResult"&&this.healthReporter.trackEventSendResult(w)}getNetworkQuality(){return this.networkMonitor.getNetworkQuality()}parseGlobalProperties(){const w=gm.getParser(navigator.userAgent),O=(function(B){const V=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/.exec(B)||/^(\d+)\.(\d+)[+|-]?(.*)?$/.exec(B)||/^(\d+)$/.exec(B)||[];return{major:parseInt(V[1],10)||0,minor:parseInt(V[2],10)||0,patch:parseInt(V[3],10)||0}})(String(w.getBrowserVersion()));return{browser:navigator.appVersion,browser_family:w.getBrowserName().toLowerCase(),browser_version:`${O.major}.${O.minor}`,customer_id:"ivs",host:window.location.hostname,os_name:w.getOSName(),os_version:String(w.getOSVersion()),platform:"web",global_session_id:this.getGlobalSessionId(),sdk_version:"1.27.0",user_agent:navigator.userAgent,is_backgrounded:document?.visibilityState==="hidden"}}}window.IVS_CLIENT_GLOBAL_STATE||(window.IVS_CLIENT_GLOBAL_STATE={}),window.IVS_CLIENT_GLOBAL_STATE.session||(window.IVS_CLIENT_GLOBAL_STATE.session=new pf);const Oc=window.IVS_CLIENT_GLOBAL_STATE.session;function _m(L){if(!L)throw new Error("eventSender is not defined")}class ad{constructor(){this.sharedProperties={},this.eventSender={},this.queuedEvents=[],this.genSessionId();const w=(function(){const O=ms("appLabel");if(O!==void 0)return O.substring(0,64)})();this.eventSender=new gs,this.initSharedProperties({appLabel:w}),this.errorReports=new Map}start(){this.flushInterval||(this.flushInterval=window.setInterval((()=>{this.queueAggregateErrors({force:!1}),this.flushEvents()}),1e3))}stop(w){let O=!1;clearInterval(this.flushInterval),this.flushInterval=void 0,this.queueAggregateErrors({force:!0}),w&&(this.queuedEvents=this.queuedEvents.filter((B=>B.critical)),O=!0),this.flushEvents(O),this.genSessionId()}trackEvent(w,O=!1){let B=this.sharedProperties;O&&(B={global_session_id:this.sharedProperties.global_session_id,session_id:this.sharedProperties.session_id,browser:this.sharedProperties.browser,browser_family:this.sharedProperties.browser_family,browser_version:this.sharedProperties.browser_version,os_name:this.sharedProperties.os_name,os_version:this.sharedProperties.os_version,is_backgrounded:this.sharedProperties.is_backgrounded}),document?.visibilityState==="hidden"&&(B.is_backgrounded=!0),"data"in w?(w.data.properties=Object.assign({},B,w.data.properties),this.queuedEvents.push(w.data)):(w.properties=Object.assign({},B,w.properties),this.queuedEvents.push(w))}trackEventNoSharedProps(w){this.trackEvent(w,!0)}trackErrorAndThrow(w){throw this.trackError(w),w}trackError(w){const O=`${w.code}${w.fatal}${w.nominal}${w.tag}${w.traceId.value}`,B=this.errorReports.get(O),V={error:w,queuedAt:Date.now(),count:0};return B?(B.count===0&&(B.error=w),B.count+=1,B.queuedAt+6e4<=Date.now()?(this.trackErrorReportIfNeeded(B),void this.errorReports.set(O,V)):void 0):(this.errorReports.set(O,V),void this.trackEvent(new Zi(w)))}queueAggregateErrors({force:w=!1}){this.errorReports.forEach(((O,B)=>{const V=O.queuedAt+6e4;!w&&V>Date.now()||(this.trackErrorReportIfNeeded(O),this.errorReports.delete(B))}))}trackErrorReportIfNeeded(w){if(w.count===0)return;const O=w.error;O.count=w.count,this.trackEvent(new Zi(O))}batchEvents(w){_m(this.eventSender);const O=w.map((B=>(B.data.properties=Object.assign({},this.sharedProperties,B.data.properties),B.data)));this.eventSender.send(O)}initSharedProperties({appLabel:w}){const O=Oc.parseGlobalProperties();this.sharedProperties=Object.assign(Object.assign({},O),{session_id:this.sessionId}),w&&(this.sharedProperties.app_label=w)}genSessionId(){this.sessionId=lc(),this.sharedProperties.session_id=this.sessionId}flushEvents(w=!1){_m(this.eventSender),this.queuedEvents.length>0&&this.eventSender.send(this.queuedEvents,w),this.queuedEvents=[]}getSessionId(){return this.sessionId}}class ip{constructor(w,O){this.transformProperties=(V,Y)=>({sum:V.sum,median:V.median(),min:V.min,max:V.max,p90:V.percentile(.9),event_count:V.data.length,period:Y});const B=this.transformProperties(w,O);this.data={event:Oi.CONGESTION_TIME,properties:B}}}class vm{constructor(w,O,B){this.transformProperties=(Y,se,me)=>({duration:(Y.getTime()-(se?.getTime()||0))/1e3,ecn_negotiated:!1,ingest_session_id:me});const V=this.transformProperties(w,O,B);this.data={event:Oi.CONNECTION_ESTABLISHED,properties:V}}}class Du{constructor(w,O){this.transformProperties=(V,Y)=>({sum:V.sum,median:V.median(),min:V.min,max:V.max,p90:V.percentile(.9),event_count:V.data.length,period:Y});const B=this.transformProperties(w,O);this.data={event:Oi.CONNECTION_RTT,properties:B}}}class mf{constructor(w){this.transformProperties=B=>{var V;return{is_fatal:(V=B.isFatal)!==null&&V!==void 0&&V,value:B.value,code:B.code,description:B.description}};const O=this.transformProperties(w);this.data={event:Oi.ERROR,properties:O}}}class sp{constructor(w,O){this.transformProperties=(V,Y)=>({type:V,input_device_id:Y.deviceId,position:Y.facingMode||"unknown"});const B=this.transformProperties(w,O);this.data={event:Oi.INPUT_DEVICE_ATTACHED,properties:B}}}class wa{constructor(w,O){this.transformProperties=(V,Y)=>({type:V,input_device_id:Y.deviceId,position:Y.facingMode||"unknown"});const B=this.transformProperties(w,O);this.data={event:Oi.INPUT_DEVICE_DETACHED,properties:B}}}class qa{constructor(w,O){this.transformProperties=(V,Y)=>({sum:V.sum,median:V.median(),min:V.min,max:V.max,p90:V.percentile(.9),event_count:V.data.length,period:Y});const B=this.transformProperties(w,O);this.data={event:Oi.MEASURED_BITRATE,properties:B}}}class rh{constructor(w,O){this.transformProperties=(V,Y)=>({minutes_logged:Math.round((V.timestamp-Y)/6e4)});const B=this.transformProperties(w,O);this.data={event:Oi.MINUTE_BROADCAST,properties:B}}}class op{constructor(w,O){this.transformProperties=(V,Y)=>({sum:V.sum,median:V.median(),min:V.min,max:V.max,p90:V.percentile(.9),event_count:V.data.length,period:Y});const B=this.transformProperties(w,O);this.data={event:Oi.RECOMMENDED_BITRATE,properties:B}}}class Ho{constructor(w){this.transformProperties=B=>({codec:B.mimeType,bitrate:0,sample_rate:B.clockRate,channel_count:B.channels});const O=this.transformProperties(w);this.data={event:Oi.SESSION_AUDIO_ENCODER_CONFIGURED,properties:O}}}class o_{constructor(w){this.transformProperties=B=>({codec:"audio",bitrate:32e3,sample_rate:B.sampleRate,channel_count:B.channelCount});const O=this.transformProperties(w);this.data={event:Oi.SESSION_AUDIO_PROPERTIES,properties:O}}}class Xv{constructor(w,O,B){this.transformProperties=(Y,se,me)=>({codec:me.mimeType,codec_profile:se.profile,codec_level:se.level,rate_mode:"vbr",initial_bitrate:0,keyframe_interval:2,width:Y.width,height:Y.height,bframe_count:0,target_fps:Y.frameRate});const V=this.transformProperties(w,O,B);this.data={event:Oi.SESSION_VIDEO_ENCODER_CONFIGURED,properties:V}}}class Yv{constructor(w){this.transformProperties=B=>({codec:"video",initial_bitrate:32e3,min_bitrate:0,max_bitrate:0,keyframe_interval:2,width:B.width,height:B.height,auto_bitrate_enabled:!0,bframes_enabled:!1,target_fps:B.frameRate});const O=this.transformProperties(w);this.data={event:Oi.SESSION_VIDEO_PROPERTIES,properties:O}}}class cd{constructor(w,O){this.transformProperties=(V,Y)=>({sum:V.sum,median:V.median(),min:V.min,max:V.max,p90:V.percentile(.9),event_count:V.data.length,period:Y});const B=this.transformProperties(w,O);this.data={event:Oi.SOURCE_AUDIO_LATENCY,properties:B}}}class gf{constructor(w,O){this.transformProperties=(V,Y)=>({sum:V.sum,median:V.median(),min:V.min,max:V.max,p90:V.percentile(.9),event_count:V.data.length,period:Y});const B=this.transformProperties(w,O);this.data={event:Oi.SOURCE_VIDEO_LATENCY,properties:B}}}class _f{constructor(w,O){this.transformProperties=({protocol:V,hostname:Y,port:se},me)=>({protocol:V,endpoint_host:Y,endpoint_port:se,reason:me});const B=this.transformProperties(w,O);this.data={event:Oi.START_BROADCAST,properties:B}}}class uu{constructor(w){this.transformProperties=({protocol:B,hostname:V,port:Y})=>({protocol:B,endpoint_host:V,endpoint_port:Y});const O=this.transformProperties(w);this.data={event:Oi.STOP_BROADCAST,properties:O}}}class Cl{constructor(w){this.transformProperties=B=>({bytes_sent:B.bytesSent,header_bytes_sent:B.headerBytesSent,nack_count:B.nackCount,packets_sent:B.packetsSent,retransmitted_bytes_sent:B.retransmittedBytesSent,retransmitted_packets_sent:B.retransmittedPacketsSent});const O=this.transformProperties(w);this.data={event:Oi.WEBRTC_AUDIO_STATS,properties:O}}}class ym{constructor(w){this.transformProperties=B=>({bytes_sent:B.bytesSent,fir_count:B.firCount,frames_encoded:B.framesEncoded,frames_sent:B.framesSent,header_bytes_sent:B.headerBytesSent,huge_frames_sent:B.hugeFramesSent,key_frames_encoded:B.keyFramesEncoded,nack_count:B.nackCount,packets_sent:B.packetsSent,pli_count:B.pliCount,quality_limitation_reason:B.qualityLimitationReason,quality_limitation_resolution_changes:B.qualityLimitationResolutionChanges,retransmitted_bytes_sent:B.retransmittedBytesSent,retransmitted_packets_sent:B.retransmittedPacketsSent,total_encode_time:B.totalEncodeTime,total_encoded_bytes_target:B.totalEncodedBytesTarget,total_packet_send_delay:B.totalPacketSendDelay});const O=this.transformProperties(w);this.data={event:Oi.WEBRTC_VIDEO_STATS,properties:O}}}var Oi,Cs;(function(L){L.START_BROADCAST="ivs_broadcast_start_broadcast",L.STOP_BROADCAST="ivs_broadcast_stop_broadcast",L.MINUTE_BROADCAST="ivs_broadcast_minute_broadcast",L.WEBRTC_AUDIO_STATS="ivs_broadcast_webrtc_audio_stats",L.WEBRTC_VIDEO_STATS="ivs_broadcast_webrtc_video_stats",L.WEBRTC_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_audio_stats_window",L.WEBRTC_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_video_stats_window",L.CONNECTION_ESTABLISHED="ivs_broadcast_connection_established",L.SESSION_VIDEO_PROPERTIES="ivs_broadcast_session_video_properties",L.SESSION_AUDIO_PROPERTIES="ivs_broadcast_session_audio_properties",L.SESSION_VIDEO_ENCODER_CONFIGURED="ivs_broadcast_session_video_encoder_configured",L.SESSION_AUDIO_ENCODER_CONFIGURED="ivs_broadcast_session_audio_encoder_configured",L.SOURCE_AUDIO_LATENCY="ivs_broadcast_source_audio_latency",L.SOURCE_VIDEO_LATENCY="ivs_broadcast_source_video_latency",L.INPUT_DEVICE_ATTACHED="ivs_broadcast_input_device_attached",L.INPUT_DEVICE_DETACHED="ivs_broadcast_input_device_detached",L.CONGESTION_TIME="ivs_broadcast_congestion_time",L.BUFFER_DURATION="ivs_broadcast_buffer_duration",L.MEASURED_BITRATE="ivs_broadcast_measured_bitrate",L.RECOMMENDED_BITRATE="ivs_broadcast_recommended_bitrate",L.CONNECTION_RTT="ivs_broadcast_connection_rtt",L.ERROR="ivs_broadcast_error"})(Oi||(Oi={})),(function(L){L.USER_INITIATED="user-initiated",L.NETWORK_DISCONNECT="network-disconnect"})(Cs||(Cs={}));const bm={[Q.INFO]:"#528bff",[Q.WARN]:"#ffb31a",[Q.DEBUG]:"#00f593",[Q.ERROR]:"#ff4f4d",[Q.TRACE]:"",[Q.SILENT]:"",[le.TIME]:"#53535f",[le.WEBRTC]:"#0e9bd8",[le.SUBSCRIPTION]:"#ffc400",[le.CONNECTION]:"#ff5edb",[le.SOCKET]:"#8585ff",[le.EMITTER]:"#adadb8",[le.LOCAL_PARTICIPANT]:"#1DD21D",[le.STAGE]:"#EC9806",[le.REMOTE_PARTICIPANT]:"#0680EC",details:"#808080"},Em=({label:L})=>`background: ${bm[L]||"#333333"}; color: white; padding: 3px; margin-left: 3px;`,vf=Object.entries(Q),Ke=(L,w,O)=>{const B=Em({label:L}),[V]=vf.find((([,ue])=>ue===Number(L)))||[],Y=`%c${V}`,se=Em({label:w}),me=`%c${w}`,S=Em({label:le.TIME}),f=`%c[${new Date().toISOString()}]`,_=Em({label:"details"}),R=`%c[${O}]`,U=[f,Y,me],ee=[S,B,se];return O&&(U.push(R),ee.push(_)),[U.join(""),...ee]},dt={debug(L){console.groupCollapsed(...Ke(Q.DEBUG,L.scope,L.label)),console.debug(L.msg,Object.assign(Object.assign({},L),{level:"debug"})),console.groupEnd()},info(L){console.groupCollapsed(...Ke(Q.INFO,L.scope,L.label)),console.info(L.msg,Object.assign(Object.assign({},L),{level:"info"})),console.groupEnd()},warn(L){console.groupCollapsed(...Ke(Q.WARN,L.scope,L.label)),console.warn(L.msg,Object.assign(Object.assign({},L),{level:"warn"})),console.groupEnd()},error(L){console.groupCollapsed(...Ke(Q.ERROR,L.scope,L.label)),console.error(L),console.groupEnd()}};var pt=function(L,w){var O={};for(var B in L)Object.prototype.hasOwnProperty.call(L,B)&&w.indexOf(B)<0&&(O[B]=L[B]);if(L!=null&&typeof Object.getOwnPropertySymbols=="function"){var V=0;for(B=Object.getOwnPropertySymbols(L);V<B.length;V++)w.indexOf(B[V])<0&&Object.prototype.propertyIsEnumerable.call(L,B[V])&&(O[B[V]]=L[B[V]])}return O};Object.entries(Q);class zt{constructor(w=Ar,O=dt){this.logLevel=w,this.loggerInstance=O}debug(w){var O,B;this.logLevel>Q.DEBUG||(B=(O=this.loggerInstance).debug)===null||B===void 0||B.call(O,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{level:"debug"}))))}info(w){var O,B;this.logLevel>Q.INFO||(B=(O=this.loggerInstance).info)===null||B===void 0||B.call(O,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{level:"info"}))))}warn(w){var O,B;this.logLevel>Q.WARN||(B=(O=this.loggerInstance).warn)===null||B===void 0||B.call(O,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{level:"warn"}))))}error(w){var O,B,{err:V}=w,Y=pt(w,["err"]);this.logLevel>Q.ERROR||(B=(O=this.loggerInstance).error)===null||B===void 0||B.call(O,Object.assign({err:V},Y))}}class on{constructor(w,O){this.logger=w,this.scope=O}debug(w){var O,B;(B=(O=this.logger).debug)===null||B===void 0||B.call(O,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{scope:this.scope}))))}info(w){var O,B;(B=(O=this.logger).info)===null||B===void 0||B.call(O,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{scope:this.scope}))))}warn(w){var O,B;(B=(O=this.logger).warn)===null||B===void 0||B.call(O,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{scope:this.scope}))))}error(w){var O,B,{err:V}=w,Y=pt(w,["err"]);(B=(O=this.logger).error)===null||B===void 0||B.call(O,Object.assign(Object.assign({err:V},Y),{scope:this.scope}))}unwrap(){return this.logger}}class Cn{constructor(){this.min=0,this.max=0,this.sum=0,this.data=[]}push(w){(this.min===0||w<this.min)&&(this.min=w),w>=this.max&&(this.max=w),this.data.push(w),this.sum+=w}median(){this.data.sort();const w=this.data.length>>1;return this.data.length%2==0?this.data[w-1]+this.data[w]>>1:this.data[w]}percentile(w){if(this.data.length===0)return 0;if(w<=0)return this.data[0];if(w>=1)return this.data[this.data.length-1];const O=(this.data.length-1)*w,B=Math.floor(O),V=B+1,Y=O%1;return V>=this.data.length?this.data[B]:this.data[B]*(1-Y)+this.data[V]*Y}}var $r=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};class qo{constructor(w,O,B,V){this.peerClient=w,this.broadcastCanvasManager=O,this.analyticsTracker=V,this.logger=new on(B,le.EMITTER),this.previousBytesSent=0,this.startTimestamp=0,this.initializeSamples()}start(){this.logger.info({msg:"start emitter"}),this.collectSamplesTimerId=window.setInterval((()=>{this.collectSamples()}),1e3),this.trackSamplesTimerId=window.setInterval((()=>{this.trackSamples()}),3e4),this.trackPeerConnectionStatsTimerId=window.setInterval((()=>{this.trackPeerConnectionStats()}),6e4),this.trackSamples()}stop(){clearInterval(this.collectSamplesTimerId),clearInterval(this.trackSamplesTimerId),clearInterval(this.trackPeerConnectionStatsTimerId),this.collectSamplesTimerId=void 0,this.trackSamplesTimerId=void 0,this.trackPeerConnectionStatsTimerId=void 0}trackPeerConnectionStats(){return $r(this,void 0,void 0,(function*(){(yield this.peerClient.getReports()).forEach((w=>{if(w.type==="outbound-rtp")switch(w.kind){case"audio":this.analyticsTracker.trackEvent(new Cl(w));break;case"video":{const O=new ym(w),B=new rh(w,this.startTimestamp);this.analyticsTracker.batchEvents([O,B]);break}default:this.logger.warn({msg:"unknown report kind: ",reportKind:w.kind})}}))}))}collectSamples(){return $r(this,void 0,void 0,(function*(){let w=0;this.audioLatencySamples.push(this.broadcastCanvasManager.getAudioLatency()),this.videoLatencySamples.push(this.broadcastCanvasManager.getVideoLatency()),(yield this.peerClient.getReports()).forEach((B=>{switch(B.type){case"candidate-pair":B.nominated&&(this.rttSamples.push(B.currentRoundTripTime),this.recommendedBitrateSamples.push(B.availableOutgoingBitrate));break;case"outbound-rtp":w+=B.bytesSent||0,this.startTimestamp===0&&B.kind==="video"&&(this.startTimestamp=B.timestamp)}}));const O=8*Math.round(w-this.previousBytesSent);this.previousBytesSent=w,this.measuredBitrateSamples.push(O)}))}trackSamples(){const O=new cd(this.audioLatencySamples,30),B=new gf(this.videoLatencySamples,30),V=new ip(this.congestionTimeSamples,30),Y=new qa(this.measuredBitrateSamples,30),se=new op(this.recommendedBitrateSamples,30),me=new Du(this.rttSamples,30);this.analyticsTracker.batchEvents([O,B,V,Y,se,me]),this.initializeSamples()}initializeSamples(){this.audioLatencySamples=new Cn,this.videoLatencySamples=new Cn,this.congestionTimeSamples=new Cn,this.measuredBitrateSamples=new Cn,this.recommendedBitrateSamples=new Cn,this.rttSamples=new Cn}}const Kn={CONNECTION_STATE_CHANGE:"connectionStateChange",ERROR:"clientError",ACTIVE_STATE_CHANGE:"activeStateChange"},yo="connectionStateChange",fu="sdpNegotiated",Ii="clientError",hu="seiMessageReceived",Lu="transformError";var jn;(function(L){L.CLOSED="closed",L.COMPLETED="completed",L.CONNECTED="connected",L.CONNECTING="connecting",L.DISCONNECTED="disconnected",L.FAILED="failed",L.IDLE="idle",L.NEW="new",L.NONE="none"})(jn||(jn={}));const Ic=L=>{const w=Y=>{var se;return!((se=Y.deviceId)===null||se===void 0)&&se.startsWith("web-contents-media-stream")?"tab":void 0},O=Y=>{var se;return!((se=Y.deviceId)===null||se===void 0)&&se.startsWith("window")&&Y.displaySurface==="window"?"window":void 0},B=Y=>{var se;return!((se=Y.deviceId)===null||se===void 0)&&se.startsWith("screen")&&Y.displaySurface==="monitor"?"screen":void 0};return(w(V=L)||O(V)||B(V)?void 0:"camera")||B(L)||O(L)||w(L)||"unknown";var V};function qs(L,w){return L.find((O=>O.kind===w))}function Yn(L){return L?.readyState==="live"}var vr;(function(L){L.VIDEO="video",L.AUDIO="audio"})(vr||(vr={}));class Sm{constructor(){this.mediaTracks=new Map([[vr.VIDEO,void 0],[vr.AUDIO,void 0]])}setTrack(w,O){this.mediaTracks.set(w,O)}getTrack(w){return this.mediaTracks.get(w)}}class du{constructor(){this.levelAsymmetryAllowed=!1,this.packetisationMode=!1,this.profile="",this.level=0}extractVideoSdpFmtpLine(w){return w?(w.split("\r").join(";").split(`
`).join(";").split(" ").join(";").split(";").map((O=>O.trim())).filter(Boolean).forEach((O=>{const B=O.split("=");if(B.length===2)switch(B[0]){case"level-asymmetry-allowed":B[1]==="1"?this.levelAsymmetryAllowed=!0:this.levelAsymmetryAllowed=!1;break;case"packetization-mode":B[1]==="1"?this.packetisationMode=!0:this.packetisationMode=!1;break;case"profile-level-id":this.profile=this.getProfileFromId(B[1]),this.level=this.getLevelFromId(B[1])}})),{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}):{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}}getProfileFromId(w){const O=w.substr(0,2),B=w.substr(2,2);switch(O.substr(0,2)){case"42":return"baseline";case"4d":return"main";case"58":return"extended";case"64":return"high";case"6e":return B==="00"?"high 10":"high 10 intra";case"7a":return B==="00"?"high 42":"high 42 intra";case"f4":return B==="00"?"high 44":"high 44 intra";default:return"unknown"}}getLevelFromId(w){return parseInt(w.substr(4,2),16)}}function a_(L){return btoa(JSON.stringify(L))}var Ra,Og=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};(function(L){L.IDLE="idle",L.EXECUTING="executing",L.RECONNECTING="reconnecting"})(Ra||(Ra={}));class Ao{constructor(w,O=12e4,B,V){this.state=Ra.IDLE,this.failureCallback=()=>{},this.peerClient=w,this.timeout=O,this.logger=B,this.emitter=V}onFailure(w){this.failureCallback=w}setStartConfig(w,O){this.ingestEndpoint=w,this.streamKey=O}execute(){const{id:w}=this;this.state===Ra.IDLE&&(this.state=Ra.EXECUTING,this.emitter.emit(Kn.CONNECTION_STATE_CHANGE,jn.CONNECTING),this.logger.info({msg:"Starting execution of reconnect strategy.",id:w}),this.startTimeoutTimer(this.timeout),this.executeStrategy())}startTimeoutTimer(w){this.timeoutTimerId=window.setTimeout((()=>{this.state!==Ra.IDLE&&(this.logger.info({msg:"Reconnect strategy timed out."}),this.stop(),this.emitter.emit(Kn.CONNECTION_STATE_CHANGE,jn.FAILED),this.failureCallback())}),w)}stop(){this.state=Ra.IDLE,clearTimeout(this.timeoutTimerId),this.stopStrategy()}reconnect(){return Og(this,void 0,void 0,(function*(){if(this.ingestEndpoint&&this.streamKey){const w=this.peerClient.getConnectionState();try{this.logger.info({msg:"Attempting reconnect."}),w===jn.CONNECTED?this.logger.info({msg:"Already connected! Stopping reconnect strategy."}):(yield this.peerClient.start(this.ingestEndpoint,this.streamKey),this.logger.info({msg:"Reconnect succeeded!"})),this.stop()}catch(O){throw this.logger.error({err:O}),O}}}))}isActive(){return this.state!==Ra.IDLE}}class Va extends Ao{constructor(){super(...arguments),this.id="ExponentialBackoffStrategy"}executeStrategy(){let w=5e3;const O=()=>Og(this,void 0,void 0,(function*(){if(this.state===Ra.EXECUTING)try{this.state=Ra.RECONNECTING,yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed. Trying again in: ",nextRetry:w}),this.state=Ra.EXECUTING,this.currentTimeoutId=window.setTimeout(O,w),w*=2}}));this.currentTimeoutId=window.setTimeout(O,0)}stopStrategy(){clearTimeout(this.currentTimeoutId)}}class yf extends Ao{constructor(){super(...arguments),this.id="NetworkApiStrategy",this.onConnectionChange=()=>Og(this,void 0,void 0,(function*(){if(navigator.onLine&&this.state===Ra.EXECUTING){this.state=Ra.RECONNECTING;try{yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed."}),this.state=Ra.EXECUTING}}}))}executeStrategy(){navigator.connection.addEventListener("change",this.onConnectionChange),this.onConnectionChange()}stopStrategy(){navigator.connection.removeEventListener("change",this.onConnectionChange)}}class Ig{static create(w,O=io,B,V){const{reconnect:Y,timeout:se}=O;if(Y){const me=gm.getParser(navigator.userAgent).getBrowserName().toLowerCase();return["edge","chrome"].includes(me)&&navigator.connection?new yf(w,se,B,V):new Va(w,se,B,V)}}}var Uu,bf=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))},xm=function(L,w,O,B){if(typeof w=="function"?L!==w||!B:!w.has(L))throw new TypeError("Cannot read private member from an object whose class did not declare it");return O==="m"?B:O==="a"?B.call(L):B?B.value:w.get(L)};const ih=L=>!!L;function Ef(L){if(!L)throw new Error("PeerConnection is not defined")}const Jc={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",enableDtlsSrtp:{exact:!0},enableRtpDataChannels:{exact:!1},optional:[{googHighStartBitrate:{exact:0}},{googPayloadPadding:{exact:!0}},{googScreencastMinBitrate:{exact:100}},{googCpuOveruseDetection:{exact:!0}},{googCpuOveruseEncodeUsage:{exact:!0}},{googCpuUnderuseThreshold:{exact:55}},{googCpuOveruseThreshold:{exact:85}},{enableDscp:{exact:!0}}]};class hi{constructor(w,O,B,V,Y){this.config=w,this.emitter=O,this.mediaStreamManager=B,this.analyticsTracker=Y,this.establishConnection=(se,me)=>bf(this,void 0,void 0,(function*(){var S,f,_;Ef(this.peerConnection);try{const R=yield this.peerConnection.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1});yield this.handleLocalDescription(R),yield this.sendSetupRequest(se,me,R)}catch(R){if(R instanceof Error){(S=(_=R).code)!==null&&S!==void 0||(_.code=_n.code);const U=new ye(Object.assign(Object.assign({},_n),{name:R.name,message:R.message,code:R?.code,cause:R}));throw!((f=this.reconnectStrategy)===null||f===void 0)&&f.isActive()||this.handleError(R.code,R.message),this.stop(),U}}})),this.getSessionId=()=>this.ingestSessionId,this.getConnectionState=()=>{var se;if(!this.peerConnection)return jn.NONE;const me=(se=this.reconnectStrategy)===null||se===void 0?void 0:se.isActive(),S=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;switch(S){case"new":return jn.NEW;case"closed":return jn.CLOSED;case"disconnected":return me?jn.CONNECTING:jn.DISCONNECTED;case"failed":return me?jn.CONNECTING:jn.FAILED;case"idle":return jn.IDLE;case"checking":case"connecting":return jn.CONNECTING;case"completed":case"connected":return jn.CONNECTED;default:return this.logger.warn({msg:"Unhandled connection state:",rawState:S}),jn.IDLE}},this.onConnectionStateChange=()=>{var se;const me=this.getConnectionState();switch(me){case jn.CONNECTED:{this.emitter.emit(Kn.CONNECTION_STATE_CHANGE,me);const S=new Date;this.analyticsTracker.trackEvent(new vm(S,this.connectionStartDate,this.ingestSessionId));const f=this.mediaStreamManager.getTrack(vr.AUDIO),_=this.mediaStreamManager.getTrack(vr.VIDEO);if(_){const R=_.getSettings();this.analyticsTracker.trackEvent(new Yv(R))}if(f){const R=f.getSettings();this.analyticsTracker.trackEvent(new o_(R))}(((se=this.peerConnection)===null||se===void 0?void 0:se.getSenders())||[]).forEach((R=>{var U;(((U=R.getParameters())===null||U===void 0?void 0:U.codecs)||[]).forEach((ee=>{var ue;switch((ue=R.track)===null||ue===void 0?void 0:ue.kind){case"video":{if(!_)break;const de=new du().extractVideoSdpFmtpLine(ee.sdpFmtpLine),be=_.getSettings();this.analyticsTracker.trackEvent(new Xv(be,de,ee));break}case"audio":if(!f)break;this.analyticsTracker.trackEvent(new Ho(ee))}}))}));break}case jn.CONNECTING:this.emitter.emit(Kn.CONNECTION_STATE_CHANGE,me),this.connectionStartDate=new Date,this.disconnectionStartDate=void 0;break;case jn.FAILED:this.reconnectStrategy?this.reconnectStrategy.execute():(this.emitter.emit(Kn.CONNECTION_STATE_CHANGE,me),this.handleTerminalConnectionFailure());break;case jn.DISCONNECTED:this.emitter.emit(Kn.CONNECTION_STATE_CHANGE,me),this.disconnectionStartDate=new Date;break;default:this.emitter.emit(Kn.CONNECTION_STATE_CHANGE,me)}},this.handleLocalDescription=se=>bf(this,void 0,void 0,(function*(){var me;return(me=this.peerConnection)===null||me===void 0?void 0:me.setLocalDescription(se)})),Uu.set(this,(se=>{if(typeof se!="string")throw new ye(is);try{new URL(se)}catch{throw new ye(ni)}})),this.logger=new on(V,le.WEBRTC),this.createReconnectStrategy(w)}start(w,O){var B;return bf(this,void 0,void 0,(function*(){xm(this,Uu,"f").call(this,w);const V=[this.mediaStreamManager.getTrack(vr.VIDEO),this.mediaStreamManager.getTrack(vr.AUDIO)].filter(ih);if(this.createPeerConnection(),this.addTracks({tracks:V}),this.reconnectStrategy&&this.reconnectStrategy.setStartConfig(w,O),yield this.establishConnection(w,O),!((B=this.reconnectStrategy)===null||B===void 0)&&B.isActive()){const Y=new URL(w);this.analyticsTracker.trackEvent(new _f({protocol:"webrtc",hostname:Y.hostname,port:Y.port},Cs.NETWORK_DISCONNECT))}}))}stop(){var w,O,B,V;this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stopStreamDataChannel&&this.stopStreamDataChannel.readyState==="open"&&this.stopStreamDataChannel.send(" "),[jn.NEW,jn.CONNECTING,jn.CONNECTED].includes(this.getConnectionState())&&this.emitter.emit(Kn.CONNECTION_STATE_CHANGE,jn.CLOSED),(w=this.peerConnection)===null||w===void 0||w.close(),(O=this.peerConnection)===null||O===void 0||O.removeEventListener("connectionstatechange",this.onConnectionStateChange),(B=this.peerConnection)===null||B===void 0||B.removeEventListener("iceconnectionstatechange",this.onConnectionStateChange),this.ingestSessionId=void 0,(V=this.reconnectStrategy)===null||V===void 0||V.stop()}addTracks(w){var O;if(Ef(this.peerConnection),!w)return;const B=this.peerConnection.getSenders().map((Y=>{var se;return(se=Y.track)===null||se===void 0?void 0:se.id})),V=w.tracks.filter((Y=>!B.includes(Y.id)));for(const Y of V)(O=this.peerConnection)===null||O===void 0||O.addTrack(Y)}getReports(){var w;return bf(this,void 0,void 0,(function*(){try{const O=(yield(w=this.peerConnection)===null||w===void 0?void 0:w.getStats())||[],B=[];return O.forEach((V=>{B.push(V)})),B}catch{return[]}}))}sendSetupRequest(w,O,B){var V;return bf(this,void 0,void 0,(function*(){const Y=yield fetch(`${w}/v1/offer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({offer:a_(B),streamKey:O},this.config.streamConfig))});if(!Y.ok)throw(function(me){let S=new ye(Object.assign({},_n));return me?.code===1007&&(S=new ye(Object.assign({},dn))),me?.message&&(S.message=me.message),S})(yield Y.json());const se=yield Y.json();se?.answer&&(yield(V=this.peerConnection)===null||V===void 0?void 0:V.setRemoteDescription((function(me){return JSON.parse(atob(me))})(se.answer)),this.ingestSessionId=se.ingestSessionId)}))}handleTerminalConnectionFailure(){const w=new ye(Wt);this.handleError(w.code,w.message)}handleError(w,O){this.analyticsTracker.trackEvent(new mf({code:w,description:O,isFatal:!0})),this.emitter.emit(Kn.ERROR,{code:w,message:O})}createPeerConnection(){var w;const O=this.getConnectionState(),B=O!==jn.NONE,V=O!==jn.CLOSED,Y=(w=this.reconnectStrategy)===null||w===void 0?void 0:w.isActive();B&&V&&!Y||(this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stateCheckInterval=window.setInterval((()=>{const se=this.getConnectionState();if(this.reconnectStrategy&&se===jn.DISCONNECTED&&this.disconnectionStartDate){const me=Date.now()-this.disconnectionStartDate.getTime();this.logger.info({msg:"Time since disconnected:",timeSinceDisconnect:me}),me>1e4&&(this.disconnectionStartDate=void 0,this.reconnectStrategy.execute())}else se===jn.CLOSED&&(this.handleTerminalConnectionFailure(),clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0)}),1e3),this.peerConnection=new RTCPeerConnection(Jc),this.stopStreamDataChannel=this.peerConnection.createDataChannel("stopStream"),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onConnectionStateChange))}createReconnectStrategy(w){if(this.reconnectStrategy=Ig.create(this,w.networkReconnectConfig,this.logger,this.emitter),this.reconnectStrategy){this.reconnectStrategy.onFailure(this.handleTerminalConnectionFailure.bind(this));const O=this.reconnectStrategy.id;this.logger.info({msg:"Using reconnect strategy:",strategyId:O})}}}Uu=new WeakMap;var Al,Zv,Jv=i(5364);(function(L){L.CONFIG="config",L.UPDATE="update",L.START="start",L.STOP="stop"})(Al||(Al={})),(function(L){L.VIDEO_SEND="video/send",L.VIDEO_RECEIVE="video/receive",L.INSERT_SEI="insertSei"})(Zv||(Zv={}));var Tm=i(5512),uc=i.n(Tm);function sh(){return uc()(`/*! For license information please see scheduler.worker.worker.js.LICENSE.txt */
(()=>{"use strict";var i,t;!function(i){i.CONFIG="config",i.UPDATE="update",i.START="start",i.STOP="stop"}(i||(i={})),function(i){i.VIDEO_SEND="video/send",i.VIDEO_RECEIVE="video/receive",i.INSERT_SEI="insertSei"}(t||(t={}));const s=self;const n=new class Scheduler{constructor(){this.config={frameRate:60,isRunning:!1}}setConfig(i){this.config=Object.assign(Object.assign({},this.config),i),this.config.isRunning&&(this.stop(),this.start())}start(){this.config.isRunning||(this.intervalId=setInterval((()=>{s.postMessage({type:i.UPDATE})}),1e3/this.config.frameRate),this.config.isRunning=!0)}stop(){this.config.isRunning&&(clearInterval(this.intervalId),this.intervalId=void 0,this.config.isRunning=!1)}};s.addEventListener("message",(function(t){var s;if(null===(s=null==t?void 0:t.data)||void 0===s?void 0:s.type)switch(t.data.type){case i.CONFIG:n.setConfig(t.data.payload||{});break;case i.START:n.start();break;case i.STOP:n.stop()}}))})();`,"Worker",void 0,void 0)}var Bu=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};class ld{constructor(w,O,B){this.config=w,this.mediaStreamManager=O,this.analyticsTracker=B,this.handleWorkerEvent=me=>{var S;((S=me.data)===null||S===void 0?void 0:S.type)===Al.UPDATE&&this.drawComposite()},this.mixer={video:[],audio:[]},this.schedulerWorker=new sh,this.running=!1,this.compositeEl=document.createElement("canvas"),this.compositeEl.height=this.config.streamConfig.maxResolution.height,this.compositeEl.width=this.config.streamConfig.maxResolution.width;const V=this.compositeEl.getContext("2d");if(V===null)throw new ye(Object.assign({},Ye));this.compositeContext=V,this.compositeStream=this.compositeEl.captureStream(typeof CanvasCaptureMediaStreamTrack!==void 0?0:30);const Y=qs(this.compositeStream.getTracks(),vr.VIDEO);this.audioContext=new AudioContext,this.unlockAudioContext(),this.audioDestination=this.audioContext.createMediaStreamDestination(),this.setupSilence();const se=qs(this.audioDestination.stream.getTracks(),vr.AUDIO);Y&&this.mediaStreamManager.setTrack(vr.VIDEO,Y),se&&this.mediaStreamManager.setTrack(vr.AUDIO,se),this.schedulerWorker.addEventListener("message",this.handleWorkerEvent),this.schedulerWorker.postMessage({type:Al.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.previewElement=null,this.previewCtx=null,this.nextMix=new Date().getTime()}attachPreview(w){this.previewElement=w;const{width:O,height:B}=this.config.streamConfig.maxResolution;this.previewElement.width=O,this.previewElement.height=B,this.previewCtx=this.previewElement.getContext("2d")}detachPreview(){this.previewElement=null,this.previewCtx=null}setupSilence(){const w=this.audioContext.createConstantSource(),O=this.audioContext.createGain();O.gain.value=.001,w.connect(O),O.connect(this.audioDestination),w.start()}unlockAudioContext(){if(this.audioContext.state!=="suspended")return;const w=document.body,O=["touchstart","touchend","mousedown","keydown"],B=()=>{O.forEach((Y=>{w.removeEventListener(Y,V)}))},V=()=>{this.audioContext.resume().then(B)};O.forEach((Y=>{w.addEventListener(Y,V,!1)}))}getTracks(){return[this.mediaStreamManager.getTrack(vr.VIDEO),this.mediaStreamManager.getTrack(vr.AUDIO)]}getCanvasVideoTrack(){return this.mediaStreamManager.getTrack(vr.VIDEO)}getAudioInputDevice(w){if(typeof w!="string")return;const O=this.mixer.audio.find((B=>{if(B.name===w)return B.source}));return O?.source}getVideoInputDevice(w){if(typeof w=="string")return this.mixer.video.find((O=>O.name===w))}getCanvasDimensions(){return{height:this.compositeEl.height,width:this.compositeEl.width}}addVideoInputDevice(w,O,B){var V;return Bu(this,void 0,void 0,(function*(){if(typeof w!="object")throw new ye(Object.assign({},Ve));if(!O||typeof O!="string")throw new ye(Object.assign({},rt));if(this.mixer.video.some((U=>U.name===O)))throw new ye(Object.assign({},Xe));if(!B)throw new ye(Object.assign({},lt));if(typeof B.index!="number")throw new ye(Object.assign({},qe));const Y=(function(){const U=document.createElement("video");return U.autoplay=!0,U.muted=!0,U.setAttribute("playsinline",""),U.setAttribute("webkit-playsinline",""),U})(),se=w.getVideoTracks(),[me]=se;if(!se.length)throw new ye(Object.assign({},Pe));const S=me.getConstraints(),f=Jv({},S,{frameRate:this.config.streamConfig.maxFramerate});try{yield me.applyConstraints(f)}catch(U){let ee="Unknown constraints error";U instanceof Error&&(ee=U.message),this.analyticsTracker.trackEvent(new mf({description:`${nt.message}: ${ee}`,isFatal:!1,code:nt.code}))}const _=()=>Bu(this,void 0,void 0,(function*(){let U=0;for(;U<5;)try{return void(yield Y.play())}catch(ee){if(!(ee instanceof Error))throw new Error("unknown error trying to add video to broadcast");U++,yield new Promise((ue=>setTimeout(ue,150)))}throw new Error("Error playing video, tries exceeded")})),R=new MediaStream([me]);Y.srcObject=R;try{yield _();const U={name:O,element:Y,position:B,source:R,render:!0},ee=((V=me.getSettings)===null||V===void 0?void 0:V.call(me))||{};this.analyticsTracker.trackEvent(new sp(Ic(ee),ee)),this.mixer.video.push(U)}catch(U){throw new ye(Object.assign(Object.assign({},Pe),{cause:U}))}}))}addImageSource(w,O,B){var V;return Bu(this,void 0,void 0,(function*(){if(!w)throw new ye(Object.assign({},Ve));if(!O||typeof O!="string")throw new ye(Object.assign({},rt));if(w.tagName==="image")throw new ye(Object.assign({},it));if(this.mixer.video.some((se=>se.name===O)))throw new ye(Object.assign({},Xe));if(!B)throw new ye(Object.assign({},lt));if(typeof B.index!="number")throw new ye(Object.assign({},qe));if(w instanceof Image){const se=(V=w.src)===null||V===void 0?void 0:V.slice();try{const me=w.src?new URL(w.src):{};if(me.host&&me.hostname){const S=yield fetch(w.src).then((_=>Bu(this,void 0,void 0,(function*(){return _.blob()})))),f=yield new Promise((_=>{const R=new FileReader;R.onload=()=>{_(R.result)},R.readAsDataURL(S)}));w.src=f}}catch{throw new ye(Object.assign(Object.assign({},Kt),{params:{details:`Image URL: ${se}`}}))}}const Y={name:O,element:w,position:B,render:!0};this.mixer.video.push(Y)}))}addAudioInputDevice(w,O){return Bu(this,void 0,void 0,(function*(){if(typeof w!="object")throw new ye(Object.assign({},Ve));if(!O||typeof O!="string")throw new ye(Object.assign({},rt));if(this.mixer.audio.some((me=>me.name===O)))throw new ye(Object.assign({},Xe));const B=w.getAudioTracks();if(!B.length)throw new ye(Object.assign({},We));const V=this.audioContext.createMediaStreamSource(new MediaStream(B)),Y=this.audioContext.createGain();Y.gain.value=1,V.connect(Y),Y.connect(this.audioDestination);const se={name:O,source:w,audioTrackSource:V,gainNode:Y};this.analyticsTracker.trackEvent(new sp("audio",{deviceId:w.id})),this.mixer.audio.push(se)}))}removeImage(w){const O=this.mixer.video.findIndex((B=>B.name===w));if(O<0)throw new ye(Object.assign({},Qt));this.mixer.video.splice(O,1)}removeVideoInputDevice(w){var O;const B=this.removeDevice(w,this.mixer.video);if(!B)throw new ye(Object.assign({},ct));{const V=qs(B.source.getTracks(),vr.VIDEO);if(!V)throw new ye(Object.assign({},ct));B.element.srcObject=null,V.stop();const Y=((O=V?.getSettings)===null||O===void 0?void 0:O.call(V))||{};this.analyticsTracker.trackEvent(new wa(Ic(Y),Y))}}removeAudioInputDevice(w){const O=this.removeDevice(w,this.mixer.audio);if(O?.audioTrackSource){for(const B of O.source.getTracks())B.stop(),this.analyticsTracker.trackEvent(new wa("audio",{deviceId:B.id}));O.gainNode.disconnect(this.audioDestination)}else if(!O)throw new ye(Object.assign({},ct))}updateVideoDeviceComposition(w,O){if(!w||typeof w!="string")throw new ye(Object.assign({},qt));if(!O)throw new ye(Object.assign({},tn));if(typeof O.index!="number")throw new ye(Object.assign({},Ot));this.mixer.video.forEach(((B,V)=>{B.name===w&&(B.position=O)}))}exchangeVideoDevicePositions(w,O){const B=this.getVideoInputDevice(w),V=this.getVideoInputDevice(O);if(!B)throw new ye(Object.assign(Object.assign({},vt),{params:{details:`device with name: "${w}" not found`}}));if(!V)throw new ye(Object.assign(Object.assign({},vt),{params:{details:`device with name: "${O}" not found`}}));const Y=Object.assign({},B.position),se=Object.assign({},V.position);for(const me of this.mixer.video)me.name===w&&(Ga(se.x)?me.position=Object.assign(Object.assign({},me.position),se):me.position={index:se.index}),me.name===O&&(Ga(Y.x)?me.position=Object.assign(Object.assign({},me.position),Y):me.position={index:Y.index})}start(){this.running||(this.running=!0,this.schedulerWorker.postMessage({type:Al.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.schedulerWorker.postMessage({type:Al.START}))}stop(){this.running&&(this.running=!1,this.schedulerWorker.removeEventListener("message",this.handleWorkerEvent))}isCapturing(){return this.running}getAudioLatency(){return this.audioContext.baseLatency}getVideoLatency(){var w;return((w=this.mediaStreamManager.getTrack(vr.VIDEO))===null||w===void 0?void 0:w.getConstraints().latency)||0}disableVideo(){this.mixer.video.forEach((w=>{w.render=!1}))}enableVideo(){this.mixer.video.forEach((w=>{w.render=!0}))}disableAudio(){this.mixer.audio.forEach((w=>{w.audioTrackSource&&(w.gainNode.gain.value=0)}))}enableAudio(){this.mixer.audio.forEach((w=>{w.audioTrackSource&&(w.gainNode.gain.value=1)}))}getDrawRegion(w,O,B){var V,Y,se,me;let S=(V=w.position.x)!==null&&V!==void 0?V:0,f=(Y=w.position.y)!==null&&Y!==void 0?Y:0;const _=(se=w.position.width)!==null&&se!==void 0?se:O-S,R=(me=w.position.height)!==null&&me!==void 0?me:B-f,U=_/R;let ee=w.element.width,ue=w.element.height;w.element instanceof HTMLVideoElement&&(ee=w.element.videoWidth,ue=w.element.videoHeight);const de=ee/ue;let be=_,Ce=R;return de>U?(be=_,Ce=2*Math.round(_/de/2),f+=(R-Ce)/2):de<U&&(Ce=R,be=2*Math.round(R*de/2),S+=(_-be)/2),{x:S,y:f,width:be,height:Ce}}drawComposite(){if(!this.shouldMix(new Date))return;this.compositeContext.clearRect(0,0,this.compositeEl.width,this.compositeEl.height),this.drawBlackScreen();const w=this.mixer.video.filter((O=>O.render));w.sort(((O,B)=>O.position.index-B.position.index));for(const O of w){const{x:B,y:V,width:Y,height:se}=this.getDrawRegion(O,this.compositeEl.width,this.compositeEl.height);this.compositeContext.drawImage(O.element,B,V,Y,se)}this.previewElement&&this.previewCtx&&this.previewCtx.drawImage(this.compositeEl,0,0,this.previewElement.width,this.previewElement.height),this.requestCanvasCapture()}requestCanvasCapture(){typeof CanvasCaptureMediaStreamTrack!==void 0&&(typeof this.compositeStream.requestFrame=="function"?this.compositeStream.requestFrame():this.mediaStreamManager.getTrack(vr.VIDEO).requestFrame())}drawBlackScreen(){this.compositeContext.fillStyle="#000000",this.compositeContext.fillRect(0,0,this.compositeEl.width,this.compositeEl.height)}removeDevice(w,O){const B=O.findIndex((V=>(Y=>Y.name===w)(V)));if(!(B<0))return O.splice(B,1)[0]}shouldMix(w){if(w.getTime()<this.nextMix)return!1;for(;this.nextMix<=w.getTime();)this.nextMix+=1e3/this.config.streamConfig.maxFramerate;return!0}}function Ga(L){return Number.isSafeInteger(L)}var Ng,c_,Hr=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))},Ti=function(L,w,O,B){if(typeof w=="function"?L!==w||!B:!w.has(L))throw new TypeError("Cannot read private member from an object whose class did not declare it");return O==="m"?B:O==="a"?B.call(L):B?B.value:w.get(L)};class wm{constructor(w){this.config=w,Ng.add(this),this.emitter=new Gr,this.isValid=!0,this.emitter.on(Kn.ERROR,this.stopBroadcast),this.config.ingestEndpoint&&(this.url=new URL(this.config.ingestEndpoint)),this.analyticsTracker=new ad,this.mediaStreamManager=new Sm;const O=new zt(w.logLevel,w.logger);this.peerClient=new hi(this.config,this.emitter,this.mediaStreamManager,O,this.analyticsTracker),this.broadcastCanvasManager=new ld(w,this.mediaStreamManager,this.analyticsTracker),this.peerStatsTracker=new qo(this.peerClient,this.broadcastCanvasManager,O,this.analyticsTracker),this.broadcastCanvasManager.start(),Object.getOwnPropertyNames(wm.prototype).forEach((B=>{this[B]=new Proxy(this[B],{apply:(V,Y,se)=>{if(!Y.isValid)throw new ye(Object.assign({},Ds));return Reflect.apply(V,Y,se)}})})),window.addEventListener("beforeunload",(()=>{this.analyticsTracker.stop(!0)}))}delete(){this.isValid=!1,this.peerClient.stop(),this.broadcastCanvasManager.stop(),this.emitter.removeAllListeners()}startBroadcast(w,O){return Hr(this,void 0,void 0,(function*(){Ti(this,Ng,"m",c_).call(this,w);const B=aa(O||this.config.ingestEndpoint);this.analyticsTracker.start(),this.peerStatsTracker.start(),yield this.peerClient.start(B,w),this.emitter.emit(Kn.ACTIVE_STATE_CHANGE,!0),this.url=new URL(B),this.url&&this.analyticsTracker.trackEvent(new _f({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port},Cs.USER_INITIATED))}))}stopBroadcast(){var w,O,B;this.url&&this.analyticsTracker.trackEvent(new uu({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port})),(w=this.peerStatsTracker)===null||w===void 0||w.stop(),(O=this.peerClient)===null||O===void 0||O.stop(),(B=this.emitter)===null||B===void 0||B.emit(Kn.ACTIVE_STATE_CHANGE,!1)}getCanvasDimensions(){return this.broadcastCanvasManager.getCanvasDimensions()}addVideoInputDevice(w,O,B){return Hr(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addVideoInputDevice(w,O,B)}))}addImageSource(w,O,B){return Hr(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addImageSource(w,O,B)}))}addAudioInputDevice(w,O){return Hr(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addAudioInputDevice(w,O)}))}removeVideoInputDevice(w){this.broadcastCanvasManager.removeVideoInputDevice(w)}removeAudioInputDevice(w){this.broadcastCanvasManager.removeAudioInputDevice(w)}removeImage(w){this.broadcastCanvasManager.removeImage(w)}updateVideoDeviceComposition(w,O){this.broadcastCanvasManager.updateVideoDeviceComposition(w,O)}exchangeVideoDevicePositions(w,O){this.broadcastCanvasManager.exchangeVideoDevicePositions(w,O)}getAudioInputDevice(w){return this.broadcastCanvasManager.getAudioInputDevice(w)}getVideoInputDevice(w){return this.broadcastCanvasManager.getVideoInputDevice(w)}getConnectionState(){return this.peerClient.getConnectionState()}getSessionId(){return this.peerClient.getSessionId()}on(w,O){this.emitter.on(w,O)}off(w,O){this.emitter.off(w,O)}getAudioContext(){return this.broadcastCanvasManager.audioContext}attachPreview(w){this.broadcastCanvasManager.attachPreview(w)}detachPreview(){this.broadcastCanvasManager.detachPreview()}disableVideo(){this.broadcastCanvasManager.disableVideo()}enableVideo(){this.broadcastCanvasManager.enableVideo()}disableAudio(){this.broadcastCanvasManager.disableAudio()}enableAudio(){this.broadcastCanvasManager.enableAudio()}}function Rm(L){return new wm((function(w){const O=new ki;return O.streamConfig=w.streamConfig,O.ingestEndpoint=w.ingestEndpoint,O.logger=w.logger,O.logLevel=w.logLevel,O.networkReconnectConfig=w.networkReconnectConfig,O})(L))}Ng=new WeakSet,c_=function(L){if(typeof L!="string"||!/^[a-zA-Z0-9_-]+$/.test(L))throw new ye(ps)};const Cm="1.27.0";var Tn,ss=i(2543);(function(L){L.PUBLISH="publish",L.SUBSCRIBE="subscribe",L.JOIN="join",L.LEAVE="leave"})(Tn||(Tn={}));const Fu=2,fc="X-Stages-Options",Qc="cap";class ju extends $n{constructor(w){super(kn.LEAVE,w.token,w.traceId,!1),Object.assign(this.properties,{action:Tn.LEAVE,event_endpoint:w.eventEndpoint,whip_endpoint:w.whipEndpoint,reason:w.reason}),this.critical=!0}}function zu(L){const w="0123456789abcdef";let O="";for(let B=0;B<L;B+=1)O+=w.charAt(Math.floor(16*Math.random()));return O}class Sf{constructor(){const w=zu;this.value=`${w(8)}-${w(4)}-${w(4)}-${w(4)}-${w(12)}`}}function Hi(){return new Sf}class l_{constructor(){const w=(Date.now()/1e3|0).toString(16);this.value=`1-${w}-${zu(24)}`}}function os(){return new l_}var u_,ca,ud,Vo=i(2505),hc=i.n(Vo);(function(L){L.MESSAGE="message",L.RESPONSE="response"})(u_||(u_={})),(function(L){L.STAGE_DELETED="STAGE_DELETED",L.PARTICIPANT_DISCONNECTED="PARTICIPANT_DISCONNECTED",L.TOKEN_INVALID="TOKEN_INVALID",L.TOKEN_EXPIRED="TOKEN_EXPIRED",L.TOKEN_INVALID_SIGNATURE="TOKEN_INVALID_SIGNATURE",L.TOKEN_MISSING="TOKEN_MISSING",L.INTERNAL="INTERNAL",L.BAD_REQUEST="BAD_REQUEST"})(ca||(ca={})),(function(L){L[L.BAD_REQUEST=400]="BAD_REQUEST",L[L.UNAUTHORIZED=401]="UNAUTHORIZED",L[L.FORBIDDEN=403]="FORBIDDEN",L[L.NOT_FOUND=404]="NOT_FOUND",L[L.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR"})(ud||(ud={}));class gr extends ye{constructor({token:w,traceId:O,code:B,tag:V,location:Y,message:se,details:me,remoteParticipantId:S,requestUUID:f,fatal:_,nominal:R,action:U,count:ee=1}){super({name:"StageClientError",message:se,code:B}),Error.captureStackTrace&&Error.captureStackTrace(this,gr),this.action=U,this.token=w,this.traceId=O,this.code=B,this.tag=V,this.location=Y,this.message=se,this.details=me,this.remoteParticipantId=S,this.requestUUID=f,this.fatal=_,this.nominal=R,this.count=ee}}const he="signalling_session",dc="webrtc_sink",Ml="webrtc_unsink",Ji="webrtc_source";function vn(L,w){switch(L){case Tn.PUBLISH:return dc;case Tn.SUBSCRIBE:return`webrtc_source:${w}`;default:return"unknown"}}function Mo(L,w){var O,B,V,Y;const se={code:L.code,message:`${L.message}: ${w.name} ${w.message}`,fatal:(O=L.fatal)!==null&&O!==void 0&&O,nominal:(B=L.nominal)!==null&&B!==void 0&&B};return w instanceof gr&&(se.fatal=(V=w.fatal)!==null&&V!==void 0&&V,se.nominal=(Y=w.nominal)!==null&&Y!==void 0&&Y),se}function Go(L,w){if(L===0)return Xt.UNKNOWN_SERVER_ERROR;if(!(L<400))if(L>=400&&L<=403)switch(w){case Ni.TokenExpired:return Xt.EXPIRED_TOKEN;case Ni.NoPermissions:return Xt.TOKEN_PERMISSIONS_DENIED;case Ni.StageAtCapacity:return Xt.STAGE_AT_CAPACITY;case Ni.NoMatchingCodec:return Xt.NO_MATCHING_CODEC;default:return Xt.UNKNOWN_SERVER_ERROR}else{if(L===404)return w===Ni.RemoteStreamNotFound?Xt.REMOTE_STREAM_NOT_FOUND:Xt.UNKNOWN_SERVER_ERROR;if(L===412)return w===Ni.AbortedMHCPError?Xt.MHCP_ABORTED:Xt.UNKNOWN_SERVER_ERROR;if(L===429)return w===Ni.StageAuthThrottled?Xt.STAGE_AUTH_THROTTLED:Xt.WHIP_TOO_MANY_REQUESTS;if(L!==500)return Xt.UNKNOWN_SERVER_ERROR;switch(w){case Ni.InternalMHCPError:return Xt.INTERNAL_MHCP_ERROR;case Ni.UnreachableMHCP:return Xt.UNREACHABLE_MHCP;case Ni.InvalidSessionStatus:return Xt.INVALID_SESSION_STATUS;default:return Xt.INTERNAL_SERVER_ERROR}}}var Ni;(function(L){L[L.Unspecified=2001]="Unspecified",L[L.TokenExpired=2002]="TokenExpired",L[L.NoPermissions=2003]="NoPermissions",L[L.RemoteStreamNotFound=2004]="RemoteStreamNotFound",L[L.StageAtCapacity=2005]="StageAtCapacity",L[L.InternalMHCPError=2006]="InternalMHCPError",L[L.UncategorizedMHCPError=2007]="UncategorizedMHCPError",L[L.UnreachableMHCP=2008]="UnreachableMHCP",L[L.InvalidSessionStatus=2010]="InvalidSessionStatus",L[L.PostWithoutOptions=2011]="PostWithoutOptions",L[L.AbortedMHCPError=2012]="AbortedMHCPError",L[L.StageAuthThrottled=2013]="StageAuthThrottled",L[L.NoMatchingCodec=2014]="NoMatchingCodec"})(Ni||(Ni={}));const Xt={MALFORMED_TOKEN:{code:1e3,message:"Token is malformed",fatal:!0,nominal:!0},EXPIRED_TOKEN:{code:1001,message:"Token expired and is no longer valid",fatal:!0,nominal:!0},STAGE_DELETED:{code:1037,message:"Stage has been deleted",fatal:!0,nominal:!0},PARTICIPANT_DISCONNECTED:{code:1038,message:"Participant has been disconnected",fatal:!0,nominal:!0},JOIN_SERVER_INTERNAL_ERROR:{code:1039,message:"Internal server error during join",fatal:!1,nominal:!1},JOIN_SERVER_BAD_REQUEST:{code:1040,message:"Bad request during join",fatal:!0,nominal:!1},UNPUBLISH_FAILURE:{code:1013,message:"Failed to unpublish",fatal:!1,nominal:!1},UNSUBSCRIBE_FAILURE:{code:1014,message:"Failed to unsubscribe",fatal:!1,nominal:!1},PUBLISH_FAILURE:{code:1015,message:"Failed to publish",fatal:!1,nominal:!1},SUBSCRIBE_FAILURE:{code:1016,message:"Failed to subscribe",fatal:!1,nominal:!1},JOIN_FAILURE:{code:1017,message:"Failed to join",fatal:!0,nominal:!1},JOIN_TIMED_OUT:{code:1019,message:"Join timed out",fatal:!0,nominal:!1},PUBLISH_TIMED_OUT:{code:1020,message:"Publish timed out",fatal:!1,nominal:!1},SUBSCRIBE_TIMED_OUT:{code:1021,message:"Subscribe timed out",fatal:!1,nominal:!1},OPERATION_ABORTED:{code:1023,message:"Request aborted",fatal:!1,nominal:!0},STAGE_AT_CAPACITY:{code:1024,message:"Stage at capacity",fatal:!0,nominal:!0},INTERNAL_SERVER_ERROR:{code:1025,message:"Internal server error",fatal:!0,nominal:!1},TOKEN_PERMISSIONS_DENIED:{code:1026,message:"Token permissions are not valid for the operation",fatal:!0,nominal:!1},REMOTE_STREAM_NOT_FOUND:{code:1027,message:"Contributor group (PUBLISH) or remote stream (SUBSCRIBE) not found",fatal:!0,nominal:!1},INTERNAL_MHCP_ERROR:{code:1028,message:"Authorization failed due to internal MHCP error",fatal:!0,nominal:!1},UNREACHABLE_MHCP:{code:1030,message:"Authorization failed due to MHCP unreachable",fatal:!0,nominal:!1},INVALID_SESSION_STATUS:{code:1031,message:"Stream has already been published (PUBLISH) or subscribed to (SUBSCRIBE)",fatal:!0,nominal:!1},MHCP_ABORTED:{code:1033,message:"Publisher state conflict",fatal:!0,nominal:!1},STAGE_AUTH_THROTTLED:{code:1034,message:"Too many requests",fatal:!1,nominal:!1},NO_MATCHING_CODEC:{code:1035,message:"No matching codec found",fatal:!0,nominal:!1},UNKNOWN_SERVER_ERROR:{code:1099,message:"Service error code unknown or not found",fatal:!0,nominal:!1},XDP_CONNECTION_LOST:{code:1221,message:"Connection lost during SDP exchange",fatal:!1,nominal:!1},XDP_INVALID_ANSWER_MSG:{code:1222,message:"Invalid answer message received by client",fatal:!1,nominal:!1},XDP_TIMEOUT:{code:1223,message:"Failed to receive SDP answer within timeout period",fatal:!1,nominal:!1},XDP_UNEXPECTED_ERROR:{code:1224,message:"Unexpected error encountered",fatal:!1,nominal:!1},WEBSOCKET_MESSAGE_PARSE_FAILURE:{code:1204,message:"Failed to parse websocket message"},WHIP_TOO_MANY_REQUESTS:{code:1207,message:"WHIP endpoint received too many requests",fatal:!1,nominal:!1},WHIP_POST_FAILURE:{code:1502,message:"WHIP post failure",fatal:!1,nominal:!1},WHIP_DELETE_FAILURE:{code:1503,message:"WHIP delete failure",fatal:!1,nominal:!1},WHIP_URL_MISSING:{code:1504,message:"WHIP delete failure",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_FAILED:{code:1510,message:"Set layer request failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_THROTTLED:{code:1511,message:"Too many set layer requests",fatal:!1,nominal:!0},WHEP_GET_LAYER_STATE_FAILED:{code:1512,message:"Get layer state failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_GET_LAYER_STATE_THROTTLED:{code:1513,message:"Too many get layer state requests",fatal:!1,nominal:!0},EVENT_PLANE_WS_CREATE_FAILED:{code:1300,message:"Error creating WebSocket",fatal:!0,nominal:!1},EVENT_PLANE_WS_UNEXPECTED_CLOSE:{code:1302,message:"Unexpectedly not connected to event plane",fatal:!1,nominal:!1},EVENT_PLANE_PONG_TIMEOUT:{code:1304,message:"Pong timed out",fatal:!1,nominal:!1},EVENT_PLANE_WS_CLOSE_BEFORE_OPEN:{code:1305,message:"Connect attempt closed by server",fatal:!1,nominal:!1},PEER_CONNECTION_NETWORK_FAILURE:{code:1400,message:"PeerConnection is lost due to unknown network error",fatal:!1,nominal:!1},CREATE_OFFER_FAILURE:{code:1402,message:"Failed to set local description",fatal:!1,nominal:!1},CREATE_PEER_CONNECTION_FAILURE:{code:1403,message:"Failed to create a peer connection",fatal:!1,nominal:!1},ICE_CANDIDATE_ERROR:{code:1404,message:"ICE candidate error",fatal:!1,nominal:!1},SET_ANSWER_FAILURE:{code:1405,message:"Failed to set remote answer",fatal:!1,nominal:!1},NETWORK_FAILURE:{code:1406,message:"Failed due to network problem",fatal:!1,nominal:!1},SEI_INSERT_NOT_PUBLISHING_VIDEO:{code:1460,message:"SEI failed to insert due to not publishing video",fatal:!1,nominal:!0},SEI_INSERT_INBAND_NOT_ENABLED:{code:1461,message:"SEI failed to insert due to in-band messaging not being enabled",fatal:!1,nominal:!0},REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID:{code:1470,message:"Invalid participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID:{code:1471,message:"Invalid remote participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE:{code:1472,message:"Invalid subscriber peer connection state for reassignment",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS:{code:1473,message:"Request rejected because client is already processing a previous reassignment request",fatal:!1,nominal:!1},UNEXPECTED_ERROR:{code:9999,message:"Encountered unexpected error condition. Expected StageClientError type.",fatal:!1,nominal:!1},TRANSFORM_UNEXPECTED_ERROR:{code:1480,message:"Unexpected error occurred during transform execution",fatal:!1,nominal:!1},TRANSFORM_TOO_MANY_ERRORS:{code:1481,message:"Transformer encountered too many consecutive errors",fatal:!1,nominal:!1},TRANSFORM_NOT_SUPPORTED_BY_PLATFORM:{code:1482,message:"Transforms are not supported by this platform",fatal:!1,nominal:!1},CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR:{code:1490,message:"Unexpected error occurred when handling incompatible codecs",fatal:!1,nominal:!1}};var ai;(function(L){L.UNPUBLISH="unpublish",L.UNSUBSCRIBE="unsubscribe",L.UNLOAD="unload",L.CONNECTION_FAIL="connection fail",L.REASSIGNMENT="reassignment"})(ai||(ai={}));const Pg="stageJoined",oh="stageParticipantJoined",ap="stageParticipantLeft",Am="stageParticipantKicked",xf="stageParticipantUpdated",el="localPublishingChanged",$o="stageRefresh",cp="stateChange",la="error",Wo="reassignmentRequest",ah="incompatibleCodecs",$a="connectionStateChange",Ls="mediaStreamCreated",tl="mediaStreamRemoved",lp="error",kl="stageStreamSeiMessageReceived",so="transformError",Mm="reassignmentStarted",f_="reassignmentSuccess",Tf="reassignmentFailed",km="open",Qr="closed",ch="messageParseError",Dg="refresh",_s="error",fd="stageStateMessage",Hu="sdpAnswer",pc="disconnectMessage",wf="reassignmentMessage",wi="incompatibleCodecs",hd="ssu";function h_(L){return O=(function(B){return B.replace(/-/g,"+").replace(/_/g,"/").padEnd(B.length+(4-B.length%4)%4,"=")})(L),window.atob(O);var O}class xb{constructor(w,O){this.analyticsTracker=O,this.rawToken=w;const B=w.split(".");if(B.length!==3)throw Error(`Token format incorrect. length: ${B.length}`);try{this.header=JSON.parse(h_(B[0]))}catch(se){const me=se instanceof Error?`: ${se.message}`:"";throw Error(`Error parsing Stage Token header${me}`)}try{this.claims=JSON.parse(h_(B[1]))}catch(se){const me=se instanceof Error?`: ${se.message}`:"";throw Error(`Error parsing Stage Token claims${me}`)}this.signature=B[2];const{claims:V}=this;this.stageARN=V.resource,this.participantID=V.jti,this.eventsURL=V.events_url,this.whipURL=ms("whipUrl")||V.whip_url,this.userID=V.user_id,this.expirationTime=V.exp,this.topic=V.topic,this.parseVersionFlags(V.version);const{attributes:Y}=V;Y&&(this.attrGsRole=Y.gs_role,this.attrGsSessionId=Y.gs_session_id)}getPublishEndpoint(){let w="";return this.whipURL&&this.participantID&&(w=`${this.whipURL}/publish/${this.participantID}`),w}getSubscribeEndpoint(w){let O="";return this.whipURL&&(O=`${this.whipURL}/subscribe/${w}`),O}assertTokenIsUnexpired(w,O,B,V){Rs("disableTokenValidation")||(!this.expirationTime||Date.now()/1e3>=this.expirationTime)&&this.analyticsTracker.trackErrorAndThrow(new gr(Object.assign(Object.assign({},Xt.EXPIRED_TOKEN),{action:Tn.JOIN,location:B,tag:O,token:this,traceId:w,remoteParticipantId:V,message:Xt.EXPIRED_TOKEN.message,details:`Token expired at ${this.expirationTime} and is no longer valid`})))}parseVersionFlags(w){if(!w)return;const O=w.split(".");O.length===2&&(this.versionFlags=parseInt(O[1],10))}shouldSendSilentAudio(){return this.versionFlags===void 0||!!(this.versionFlags&Fu)}}function dd(L,w){return new xb(L,w)}class mc{constructor(w,O){this.throttleDuration=0,this.throttled=!1,this.timeout=0,this.unthrottle=()=>{this.trailing&&this.trailingFn&&this.trailingFn(...this.trailingFnArgs),this.clear()},this.throttleDuration=w,this.trailing=!(O&&O.skipTrailing)}invoke(w,...O){return this.throttled?(this.trailingFn=w,this.trailingFnArgs=O,!1):(this.throttled=!0,this.timeout=window.setTimeout(this.unthrottle,this.throttleDuration),w(...O),!0)}clear(){clearTimeout(this.timeout),this.timeout=0,this.throttled=!1,delete this.trailingFn,delete this.trailingFnArgs}}var Pn=i(8954);class ei extends $n{constructor(w,O,B,V,Y,se,me,S){super(kn.SERVER_REQUEST,O,me,!0),Object.assign(this.properties,{action:w,http_method:V,remote_participant_id:se,request_uuid:Y,url:B,transport:S})}}const qu="draft-ietf-wish-whip-04";var ko,Om=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};function up(L,w){return Om(this,void 0,void 0,(function*(){L.validateStatus=B=>B>=200&&B<300||B===403;const O=yield hc()(L);if(O.status===403){if(O.data.code===2003)throw new Vo.AxiosError("Request failed with status code 403","ERR_BAD_REQUEST",L,O.request,O);return L.url===O.request.responseURL?(L.validateStatus=B=>B>=200&&B<300,hc()(L)):(L.url=O.request.responseURL,w<5?up(L,w+1):(L.validateStatus=B=>B>=200&&B<300,hc()(L)))}return O}))}function d_(L){return Om(this,void 0,void 0,(function*(){return up(L,0)}))}function fp(){}function Lg(L){switch(L){case"new":return jn.NEW;case"closed":return jn.CLOSED;case"disconnected":return jn.DISCONNECTED;case"failed":return jn.FAILED;case"idle":return jn.IDLE;case"checking":case"connecting":return jn.CONNECTING;case"completed":case"connected":return jn.CONNECTED;default:throw new Error(`unknown connecion state: ${L}`)}}function hp(L,w,O){let B=document.createElement(w);const V=()=>{B&&(B.removeEventListener("loadeddata",Y),B.removeEventListener("error",V),B.srcObject=null,B.src="",B=null)},Y=()=>{V(),O(w)};return B.addEventListener("loadeddata",Y),B.addEventListener("error",V),B.srcObject=L,V}class Ca extends $n{constructor(w,O,B,V,Y){super(kn.TRACE,w,O,!1),Object.assign(this.properties,{action:V,message:B,remote_participant_id:Y})}}class dp extends $n{constructor(w,O,B,V,Y){super(kn.CONNECTION_STATE,O,B,!1),Object.assign(this.properties,{action:w,remote_participant_id:Y,state:V})}}class pp extends $n{constructor(w,O,B,V,Y){super(kn.ICE_GATHERING_STATE,O,B,!1),Object.assign(this.properties,{action:w,remote_participant_id:Y,state:V})}}(function(L){L.POST="post",L.CONNECTED="connected",L.ICE_GATHERING="icegathering",L.SDP_EXCHANGE="sdpExchange",L.SET_REMOTE_DESC="setRemoteDesc",L.PEER_CONNECTION="peerConnection"})(ko||(ko={}));const Vu="start",mp="stop";class gp{constructor(w,O){this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0,this.action=w,this.traceId=O}markActionStart(){this.markStart(ko.CONNECTED)}markPostStart(){this.markStart(ko.POST)}markPostStop(){this.markStop(ko.POST),this.postDuration=this.measure(ko.POST)}markIceGatheringStart(){this.markStart(ko.ICE_GATHERING)}markIceGatheringStop(){this.markStop(ko.ICE_GATHERING),this.timeToCandidate=this.measure(ko.ICE_GATHERING)}markActionStop(){this.markStop(ko.CONNECTED),this.timeToConnected=this.measure(ko.CONNECTED),this.markStop(ko.PEER_CONNECTION),this.peerConnectionDuration=this.measure(ko.PEER_CONNECTION)}markSetRemoteDescStart(){this.markStart(ko.SET_REMOTE_DESC)}markSetRemoteDescStop(){const w=ko.SET_REMOTE_DESC;this.markStop(w),this.setRemoteDescDuration=this.measure(w),this.markStart(ko.PEER_CONNECTION)}markSdpExchangeStart(){this.markStart(ko.SDP_EXCHANGE)}markSdpExchangeStop(){const w=ko.SDP_EXCHANGE;this.markStop(w),this.sdpExchangeDuration=this.measure(w)}setTransport(w){this.sdpExchangeTransport=w}markStart(w){this.marks[`${this.namespace}.${w}.${Vu}`]=performance.now()}markStop(w){this.marks[`${this.namespace}.${w}.${mp}`]=performance.now()}measure(w){const O=`${this.namespace}.${w}.${Vu}`,B=`${this.namespace}.${w}.${mp}`,V=this.marks[O],Y=this.marks[B];return V===void 0||Y===void 0?0:Y-V}get namespace(){return`ivswb.peerclient.${this.action}.${this.traceId.value}`}getMeasurements(){const{optionsDuration:w,postDuration:O,timeToCandidate:B,timeToConnected:V,sdpExchangeDuration:Y,sdpExchangeTransport:se,setRemoteDescDuration:me,peerConnectionDuration:S}=this;return{optionsDuration:w,postDuration:O,timeToCandidate:B,timeToConnected:V,sdpExchangeDuration:Y,sdpExchangeTransport:se,setRemoteDescDuration:me,peerConnectionDuration:S}}resetMeasurements(w){this.traceId=w,this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0}}var Ol,Gu,fr,Br,Aa;(function(L){L.VIDEO="video",L.AUDIO="audio"})(Ol||(Ol={})),(function(L){L.LOWEST_QUALITY="lowest_quality",L.HIGHEST_QUALITY="highest_quality"})(Gu||(Gu={})),(function(L){L.HI="hi",L.MID="mid",L.LOW="low"})(fr||(fr={})),(function(L){L.PORTRAIT="portrait",L.LANDSCAPE="landscape"})(Br||(Br={})),(function(L){L.DEFAULT="default",L.LOW="low",L.MEDIUM="medium",L.HIGH="high"})(Aa||(Aa={}));var nl=i(7363);class ri{constructor(w){this.sdp=w}static splitLines(w){return w.trim().split(`
`).map((O=>O.trim()))}static splitSections(w){return w.split(`
m=`).map(((O,B)=>(B>0?`m=${O}`:O).trim()+ri.CRLF))}getUniqueRtpHeaderExtensionId(w){const O=[];for(const V of w)if(/^a=extmap:/.test(V.trim())){const Y=+V.split("a=extmap:")[1].split(" ")[0];O.includes(Y)||O.push(Y)}O.sort(((V,Y)=>V-Y));let B=0;for(const V of O){if(V-B>1)return B+1;B=V}return B===14?-1:B+1}withVideoLayersAllocationRtpHeaderExtension(w){const O="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00",B=w?w.getRtpHeaderExtensionId(O):-1,V=B===-1?this.getUniqueRtpHeaderExtensionId(ri.splitLines(this.sdp)):B,Y=ri.splitSections(this.sdp),se=[];for(let S of Y){if(/^m=video/.test(S)&&ri.getRtpHeaderExtensionIdInSection(S,O)===-1){const f=ri.splitLines(S),_=[];if(V===-1||this.hasRtpHeaderExtensionId(V)){se.push(S);continue}for(const R of f)if(_.push(R),/^a=sendrecv/.test(R.trim())){const U=`a=extmap:${V} ${O}`;_.push(U)}S=_.join(ri.CRLF)+ri.CRLF}else if(B!==-1&&/^m=video/.test(S)&&ri.getRtpHeaderExtensionIdInSection(S,O)!==B){const f=ri.splitLines(S),_=[];for(const R of f){if(/^a=extmap:/.test(R.trim())&&R.split("a=extmap:")[1].split(" ")[1]===O){if(!this.hasRtpHeaderExtensionId(B)){const U=`a=extmap:${B} ${O}`;_.push(U)}continue}_.push(R)}S=_.join(ri.CRLF)+ri.CRLF}se.push(S)}const me=se.join("");return new ri(me)}withOpusAudioConfig(w,O){const B=nl.qg(this.sdp);for(const V of B.media)if(V.type==="audio"){const{payload:Y}=V.rtp.find((f=>f.codec==="opus"));if(!Y)continue;let se=V.fmtp.find((f=>f.payload===Y));se||(se={payload:Y,config:""});const me=nl.Sl(se.config);if(me.maxaveragebitrate=w,typeof O=="boolean"){const f=O?1:0;me["sprop-stereo"]=f,me.stereo=f}let S="";for(const f of Object.keys(me))S+=`${f}=${me[f]}; `;se.config=S.trim()}return new ri(nl.M9(B))}withoutAudioRtcpRSize(){var w;const O=nl.qg(this.sdp);for(const B of O.media){if(B.type!=="audio")continue;const V=Ha()!==void 0,Y=(w=Ha())!==null&&w!==void 0&&w;V&&(B.rtcpRsize=Y?void 0:"rtcp-rsize")}return new ri(nl.M9(O))}withFilteredCandidates(w){const O=nl.qg(this.sdp);return O.media.forEach((B=>{const V=B.candidates;if(V){const Y=V.filter((se=>se.transport===w));B.candidates=Y}})),new ri(nl.M9(O))}static getRtpHeaderExtensionIdInSection(w,O){const B=ri.splitLines(w);for(const V of B)if(/^a=extmap:/.test(V.trim())){const Y=V.split("a=extmap:")[1].split(" "),se=+Y[0];if(Y[1]===O)return se}return-1}getRtpHeaderExtensionId(w){const O=ri.splitSections(this.sdp);for(const B of O)if(/^m=video/.test(B)){const V=ri.getRtpHeaderExtensionIdInSection(B,w);if(V!==-1)return V}return-1}hasRtpHeaderExtensionId(w){const O=ri.splitLines(this.sdp);for(const B of O)if(/^a=extmap:/.test(B.trim())&&+B.split("a=extmap:")[1].split(" ")[0]===w)return!0;return!1}hasAudioNacksEnabled(){var w,O,B;return((B=(O=((w=nl.qg(this.sdp).media.filter((V=>V.type==="audio"))[0])!==null&&w!==void 0?w:{}).rtcpFb)===null||O===void 0?void 0:O.filter((V=>V.type==="nack")))!==null&&B!==void 0?B:[]).length>0}}function Im(L){const{config:w}=L;return[{maxBitrate:w.maxBitrateBps}]}ri.CRLF=`\r
`,ri.rfc7587LowestBitrate=6e3,ri.rfc7587HighestBitrate=51e4;function wr(L){return 1e3*L}const rl=(L,...w)=>{const O=w.map((B=>typeof B!="object")).filter(Boolean).length>0;if(typeof L=="object"&&!O)return(0,ss.merge)({},L,...w)},Us=L=>pd(L),pd=L=>(0,ss.cloneDeep)(L),md=L=>{switch(L){case Gu.HIGHEST_QUALITY:return"highest";case Gu.LOWEST_QUALITY:default:return"lowest"}},ua=L=>Object.freeze(L),pu=Object.freeze({DEFAULT_1080:ua({maxBitrateKbps:2500,maxFramerate:30,width:1920,height:1080}),INACTIVE:ua({maxBitrateKbps:0,maxFramerate:0,width:0,height:0})}),oo=Object.freeze({DEFAULT_720:ua({maxBitrateKbps:2500,maxFramerate:30,width:1280,height:720}),DEFAULT_540:ua({maxBitrateKbps:1400,maxFramerate:15,width:960,height:540}),DEFAULT_480:ua({maxBitrateKbps:1100,maxFramerate:15,width:854,height:480}),DEFAULT_360:ua({maxBitrateKbps:600,maxFramerate:15,width:640,height:360}),DEFAULT_270:ua({maxBitrateKbps:350,maxFramerate:15,width:480,height:270}),DEFAULT_180:ua({maxBitrateKbps:150,maxFramerate:15,width:320,height:180}),DEFAULT_160:ua({maxBitrateKbps:120,maxFramerate:15,width:284,height:160})}),Bs=Object.freeze({HI:ua(Object.assign({},oo.DEFAULT_720)),MID:ua(Object.assign(Object.assign({},oo.DEFAULT_360),{maxBitrateKbps:700,maxFramerate:20})),LOW:ua(Object.assign(Object.assign({},oo.DEFAULT_180),{maxBitrateKbps:200,maxFramerate:15}))}),Nc=L=>({rid:L,active:!1,scaleFactor:Ug(L),maxBitrateBps:wr(pu.INACTIVE.maxBitrateKbps),maxFramerate:pu.INACTIVE.maxFramerate,width:pu.INACTIVE.width,height:pu.INACTIVE.height}),Ug=L=>{switch(L){case fr.HI:return 1;case fr.MID:return 2;case fr.LOW:return 4;default:return 1}},Il=50,Oo=2500,$u=10,Pc=30,Rf=160,Nl=1280,Ma=720*Nl,mu=16/9,gu=12,Dc=128,Bg=64,yr={[Aa.DEFAULT]:0,[Aa.LOW]:50,[Aa.MEDIUM]:150,[Aa.HIGH]:250},_p={[Aa.DEFAULT]:0,[Aa.LOW]:100,[Aa.MEDIUM]:200,[Aa.HIGH]:300};function Fg(L){const{outbound:w,remoteInbound:O,networkQuality:B}=L;return{networkQuality:B,nackCount:w.nackCount,packetsSent:w.packetsSent,packetsLost:O?.packetsLost,retransmittedPacketsSent:w.retransmittedPacketsSent,bytesSent:w.bytesSent,headerBytesSent:w.headerBytesSent,retransmittedBytesSent:w.retransmittedBytesSent,totalPacketSendDelay:w.totalPacketSendDelay}}function Nm(L){var w,O,B;const{outbound:V,remoteInbound:Y,networkQuality:se}=L;return{networkQuality:se,nackCount:V.nackCount,packetsSent:V.packetsSent,packetsLost:Y?.packetsLost,retransmittedPacketsSent:V.retransmittedPacketsSent,bytesSent:V.bytesSent,headerBytesSent:V.headerBytesSent,retransmittedBytesSent:V.retransmittedBytesSent,totalPacketSendDelay:V.totalPacketSendDelay,firCount:V.firCount,pliCount:V.pliCount,framesEncoded:V.framesEncoded,keyFramesEncoded:V.keyFramesEncoded,totalEncodeTime:V.totalEncodeTime,totalEncodedBytesTarget:V.totalEncodedBytesTarget,framesSent:V.framesSent,hugeFramesSent:V.hugeFramesSent,active:((w=V.framesPerSecond)!==null&&w!==void 0?w:0)!==0,qualityLimitationReason:V.qualityLimitationReason,qualityLimitationResolutionChanges:V.qualityLimitationResolutionChanges,qualityLimitationCpuDuration:(O=V.qualityLimitationDurations)===null||O===void 0?void 0:O.cpu,qualityLimitationBandwidthDuration:(B=V.qualityLimitationDurations)===null||B===void 0?void 0:B.bandwidth,frameWidth:V.frameWidth,frameHeight:V.frameHeight,framesPerSecond:V.framesPerSecond,rid:V.rid,ssrc:V.ssrc}}function gd(L,w){const O=new Map,B=new Map;for(const V of w.values())if(V.kind===L&&V.type==="outbound-rtp"&&V.ssrc){const Y=V.rid||Te;B.set(V.ssrc,Y);let se=O.get(Y);se||(se={},O.set(Y,se)),se.outbound=V}for(const V of w.values())if(V.kind===L&&V.type==="remote-inbound-rtp"&&V.ssrc){const Y=B.get(V.ssrc)||Te,se=O.get(Y);se&&(se.remoteInbound=V)}return O}function Wa(L,w){const O=new Map;for(const B of w.values())if(B.kind===L&&B.type==="inbound-rtp"){const V=B.rid||Te;O.set(V,{inbound:B})}return O}function As(L,w){return L!==vo.DOWN&&w!=null?w:L}const Lc=(L,w)=>{const O=[],B=Oc.getNetworkQuality(),V=gd("audio",L);for(const Y of V.values())if(Y.outbound){const se=Y.outbound.rid||Te,me=As(B,w.get(se)),S=Fg({outbound:Y.outbound,remoteInbound:Y.remoteInbound,networkQuality:me});O.push(S)}if(O.length)return O},il=(L,w)=>{const O=[],B=Oc.getNetworkQuality(),V=gd("video",L);for(const Y of V.values())if(Y.outbound){const se=Y.outbound.rid||Te,me=Nm({outbound:Y.outbound,remoteInbound:Y.remoteInbound});if(me.active){const S=As(B,w.get(se));me.networkQuality=S}O.push(me)}if(O.length)return O},_d=(L,w)=>{const O=[],B=Oc.getNetworkQuality(),V=Wa("audio",L);for(const se of V.values())if(se.inbound){const me=se.inbound.id;if(!me)continue;const S=As(B,w.get(me)),f={networkQuality:(Y={inbound:se.inbound,networkQuality:S}).networkQuality,nackCount:Y.inbound.nackCount,packetsReceived:Y.inbound.packetsReceived,packetsLost:Y.inbound.packetsLost,packetsDiscarded:Y.inbound.packetsDiscarded,bytesReceived:Y.inbound.bytesReceived,headerBytesReceived:Y.inbound.headerBytesReceived,jitterBufferDelay:Y.inbound.jitterBufferDelay,jitterBufferEmittedCount:Y.inbound.jitterBufferEmittedCount,jitter:Y.inbound.jitter,totalSamplesReceived:Y.inbound.totalSamplesReceived,concealedSamples:Y.inbound.concealedSamples,silentConcealedSamples:Y.inbound.silentConcealedSamples,concealmentEvents:Y.inbound.concealmentEvents,insertedSamplesForDeceleration:Y.inbound.insertedSamplesForDeceleration,removedSamplesForAcceleration:Y.inbound.removedSamplesForAcceleration,audioLevel:Y.inbound.audioLevel};O.push(f)}var Y;if(O.length)return O},p_=(L,w)=>{const O=[],B=Oc.getNetworkQuality(),V=Wa("video",L);for(const se of V.values())if(se.inbound){const me=se.inbound.id;if(!me)continue;const S={networkQuality:(Y={inbound:se.inbound,networkQuality:As(B,w.get(me))}).networkQuality,nackCount:Y.inbound.nackCount,packetsReceived:Y.inbound.packetsReceived,packetsLost:Y.inbound.packetsLost,packetsDiscarded:Y.inbound.packetsDiscarded,bytesReceived:Y.inbound.bytesReceived,headerBytesReceived:Y.inbound.headerBytesReceived,jitterBufferDelay:Y.inbound.jitterBufferDelay,jitterBufferEmittedCount:Y.inbound.jitterBufferEmittedCount,jitter:Y.inbound.jitter,pliCount:Y.inbound.pliCount,firCount:Y.inbound.firCount,framesReceived:Y.inbound.framesReceived,framesDecoded:Y.inbound.framesDecoded,keyFramesDecoded:Y.inbound.keyFramesDecoded,framesDropped:Y.inbound.framesDropped,totalDecodeTime:Y.inbound.totalDecodeTime,totalInterFrameDelay:Y.inbound.totalInterFrameDelay,totalSquaredInterFrameDelay:Y.inbound.totalSquaredInterFrameDelay,pauseCount:Y.inbound.pauseCount,totalPausesDuration:Y.inbound.totalPausesDuration,freezeCount:Y.inbound.freezeCount,totalFreezesDuration:Y.inbound.totalFreezesDuration,frameWidth:Y.inbound.frameWidth,frameHeight:Y.inbound.frameHeight,framesPerSecond:Y.inbound.framesPerSecond,ssrc:Y.inbound.ssrc};O.push(S)}var Y;if(O.length)return O};var m_=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};const lh="H264",_u=L=>{const w=L?.split("/");if(w?.length===2)return w[1]},ka=(L,w)=>{const O=_u(L);if(L===void 0||O===void 0)return;const B={mimeSubtype:O};if(w){const V=(Y=>{const se=Y.split(";"),me=new Map;for(const S of se){const[f,_]=S.split("=");me.set(f,_)}return me})(w);switch(O){case lh:{const Y=V.get("profile-level-id");Y&&((se,me)=>{if(me.length<6)return;const S=me.substring(0,4),f=parseInt(me.substring(4,6),16);se.profile=S,se.level=f})(B,Y);break}case"H265":((Y,se)=>{const me=se.get("profile-id")||"0",S=se.get("tier-flag")||"0",f=parseInt(se.get("level-id")||"0",10),_=[S,me].join("_");Y.profile=_,Y.level=f})(B,V)}}return B},Pm=(L,w)=>L.sort(((O,B)=>{if(_u(O.mimeType)===lh){const V=ka(O.mimeType,O.sdpFmtpLine);if(V?.profile===w)return-1}return 0})),Cf=(L,w)=>{var O;const B=ka(L.mimeType,L.sdpFmtpLine);return B?.mimeSubtype.toLowerCase()===w.mime.toLowerCase()&&((O=B?.profile)===null||O===void 0?void 0:O.toLowerCase().indexOf(w.config.toLowerCase()))===0},vp=(L,w)=>w.filter((O=>!O.mimeType.endsWith("rtx"))).filter((O=>O.mimeType.indexOf("packetization-mode=0")===-1)).find((O=>L.reduce(((B,V)=>B&&Cf(O,V)===!1),!0)));class Dm extends $n{constructor(w,O,B,V,Y,se,me,S,f){var _,R;super(kn.PUBLISHED_VIDEO_STATS,w,O,!1),Object.assign(this.properties,Object.assign({action:Tn.PUBLISH,node:(_=B?.node)!==null&&_!==void 0?_:"",cluster:(R=B?.cluster)!==null&&R!==void 0?R:""},((U,ee,ue,de,be,Ce)=>{var Oe,Fe,ot,_t,Tt,ht,st,xt,mt,Et,kt,Bt,It,Nt,Zt,hn,In,On,bn,ir,mr,ti,Fr,Kr,pi,li,ji,Li,Vi,mi,es,$s,Gi;const No=(Fe=(Oe=U?.qualityLimitationDurations)===null||Oe===void 0?void 0:Oe.cpu)!==null&&Fe!==void 0?Fe:0,hl=(_t=(ot=U?.qualityLimitationDurations)===null||ot===void 0?void 0:ot.bandwidth)!==null&&_t!==void 0?_t:0,bc=Math.max((Tt=U?.bytesSent)!==null&&Tt!==void 0?Tt:0,0),dl=8*bc/(Ce??1),Hl=Math.max((ht=ee?.packetsLost)!==null&&ht!==void 0?ht:0,0),b=Math.max((st=U?.packetsSent)!==null&&st!==void 0?st:0,0),T=Hl/Math.max(b,1),D=ka(de?.mimeType,de?.sdpFmtpLine);return{active:!!U?.framesPerSecond&&U.framesPerSecond!==0,bytes_sent:bc,codec_mime_type:D?.mimeSubtype,codec_profile:D?.profile,codec_level:D?.level,configured_bitrate:be?.max_bitrate,connection_bandwidth:(mt=(xt=ue?.candidatePair)===null||xt===void 0?void 0:xt.availableOutgoingBitrate)!==null&&mt!==void 0?mt:0,encode_bitrate:dl,encoder_implementation:(Et=U?.encoderImplementation)!==null&&Et!==void 0?Et:"unknown",fir_count:(kt=U?.firCount)!==null&&kt!==void 0?kt:0,fraction_packets_lost:T,frame_height:Math.max((Bt=U?.frameHeight)!==null&&Bt!==void 0?Bt:0,0),frame_width:Math.max((It=U?.frameWidth)!==null&&It!==void 0?It:0,0),frames_encoded:(Nt=U?.framesEncoded)!==null&&Nt!==void 0?Nt:0,frames_per_second:Math.max((Zt=U?.framesPerSecond)!==null&&Zt!==void 0?Zt:0,0),frames_sent:(hn=U?.framesSent)!==null&&hn!==void 0?hn:0,header_bytes_sent:(In=U?.headerBytesSent)!==null&&In!==void 0?In:0,huge_frames_sent:(On=U?.hugeFramesSent)!==null&&On!==void 0?On:0,key_frames_encoded:(bn=U?.keyFramesEncoded)!==null&&bn!==void 0?bn:0,nack_count:(ir=U?.nackCount)!==null&&ir!==void 0?ir:0,packets_lost:Hl,packets_sent:b,power_efficient_encoder:(mr=U?.powerEfficientEncoder)!==null&&mr!==void 0&&mr,pli_count:(ti=U?.pliCount)!==null&&ti!==void 0?ti:0,quality_limitation_reason:(Fr=U?.qualityLimitationReason)!==null&&Fr!==void 0?Fr:"none",quality_limitation_resolution_changes:(Kr=U?.qualityLimitationResolutionChanges)!==null&&Kr!==void 0?Kr:0,quality_limitation_cpu_duration:No,quality_limitation_bandwidth_duration:hl,retransmitted_bytes_sent:(pi=U?.retransmittedBytesSent)!==null&&pi!==void 0?pi:0,retransmitted_packets_sent:(li=U?.retransmittedPacketsSent)!==null&&li!==void 0?li:0,rid:(ji=U?.rid)!==null&&ji!==void 0?ji:Te,scalability_mode:(Li=U?.scalabilityMode)!==null&&Li!==void 0?Li:"unknown",target_bitrate:Math.max((Vi=U?.targetBitrate)!==null&&Vi!==void 0?Vi:0,0),total_encode_time:(mi=U?.totalEncodeTime)!==null&&mi!==void 0?mi:0,total_encoded_bytes_target:(es=U?.totalEncodedBytesTarget)!==null&&es!==void 0?es:0,total_packet_send_delay:($s=U?.totalPacketSendDelay)!==null&&$s!==void 0?$s:0,protocol:(Gi=ue?.localCandidate)===null||Gi===void 0?void 0:Gi.protocol}})(V,Y,se,me,S,f)))}}class yp extends $n{constructor(w,O,B,V,Y,se,me,S,f,_,R,U){var ee,ue,de,be;super(kn.PUBLISHED_VIDEO_STATS_WINDOW,w,O,!1);const Ce=Math.max(((ee=V?.timestamp)!==null&&ee!==void 0?ee:0)-((ue=Y?.timestamp)!==null&&ue!==void 0?ue:0),0);Object.assign(this.properties,Object.assign({action:Tn.PUBLISH,node:(de=B?.node)!==null&&de!==void 0?de:"",cluster:(be=B?.cluster)!==null&&be!==void 0?be:"",window_size_ms:Ce},((Oe,Fe,ot,_t,Tt,ht,st,xt,mt,Et)=>{var kt,Bt,It,Nt,Zt,hn,In,On,bn,ir,mr,ti,Fr,Kr,pi,li,ji,Li,Vi,mi,es,$s,Gi,No,hl,bc,dl,Hl,b,T,D,Z,oe,_e,$e,ft,Ct,Jt,mn,Nn,Dn,Sr,pl,Ip,Sh,Lt,Rt,Vt,gn,lr,Es,br,Ui,to;const $i=(Bt=(kt=Oe?.qualityLimitationDurations)===null||kt===void 0?void 0:kt.cpu)!==null&&Bt!==void 0?Bt:0,Cd=(Nt=(It=Fe?.qualityLimitationDurations)===null||It===void 0?void 0:It.cpu)!==null&&Nt!==void 0?Nt:0,IE=(hn=(Zt=Oe?.qualityLimitationDurations)===null||Zt===void 0?void 0:Zt.bandwidth)!==null&&hn!==void 0?hn:0,Vme=(On=(In=Fe?.qualityLimitationDurations)===null||In===void 0?void 0:In.bandwidth)!==null&&On!==void 0?On:0,Mj=Math.max(((bn=Oe?.bytesSent)!==null&&bn!==void 0?bn:0)-((ir=Fe?.bytesSent)!==null&&ir!==void 0?ir:0),0),kj=typeof xt!="number"?1:xt/1e3,Gme=8*Mj/kj,Oj=Math.max(((mr=ot?.packetsLost)!==null&&mr!==void 0?mr:0)-((ti=_t?.packetsLost)!==null&&ti!==void 0?ti:0),0),Ij=Math.max(((Fr=Oe?.packetsSent)!==null&&Fr!==void 0?Fr:0)-((Kr=Fe?.packetsSent)!==null&&Kr!==void 0?Kr:0),0),$me=Oj/Math.max(Ij,1),NE=ka(ht?.mimeType,ht?.sdpFmtpLine),Wme=8*(Et||0)/kj;return{active:!!Oe?.framesPerSecond&&Oe?.framesPerSecond!==0,bytes_sent:Mj,codec_mime_type:NE?.mimeSubtype,codec_profile:NE?.profile,codec_level:NE?.level,configured_bitrate:st?.max_bitrate,connection_bandwidth:(li=(pi=Tt?.candidatePair)===null||pi===void 0?void 0:pi.availableOutgoingBitrate)!==null&&li!==void 0?li:0,encode_bitrate:Gme,encoder_implementation:(ji=Oe?.encoderImplementation)!==null&&ji!==void 0?ji:"unknown",fir_count:Math.max(((Li=Oe?.firCount)!==null&&Li!==void 0?Li:0)-((Vi=Fe?.firCount)!==null&&Vi!==void 0?Vi:0),0),fraction_packets_lost:$me,frame_height:Math.max((mi=Oe?.frameHeight)!==null&&mi!==void 0?mi:0,0),frame_width:Math.max((es=Oe?.frameWidth)!==null&&es!==void 0?es:0,0),frames_encoded:Math.max((($s=Oe?.framesEncoded)!==null&&$s!==void 0?$s:0)-((Gi=Fe?.framesEncoded)!==null&&Gi!==void 0?Gi:0),0),frames_per_second:Math.max((No=Oe?.framesPerSecond)!==null&&No!==void 0?No:0,0),frames_sent:Math.max(((hl=Oe?.framesSent)!==null&&hl!==void 0?hl:0)-((bc=Fe?.framesSent)!==null&&bc!==void 0?bc:0),0),header_bytes_sent:Math.max(((dl=Oe?.headerBytesSent)!==null&&dl!==void 0?dl:0)-((Hl=Fe?.headerBytesSent)!==null&&Hl!==void 0?Hl:0),0),huge_frames_sent:Math.max(((b=Oe?.hugeFramesSent)!==null&&b!==void 0?b:0)-((T=Fe?.hugeFramesSent)!==null&&T!==void 0?T:0),0),key_frames_encoded:Math.max(((D=Oe?.keyFramesEncoded)!==null&&D!==void 0?D:0)-((Z=Fe?.keyFramesEncoded)!==null&&Z!==void 0?Z:0),0),nack_count:Math.max(((oe=Oe?.nackCount)!==null&&oe!==void 0?oe:0)-((_e=Fe?.nackCount)!==null&&_e!==void 0?_e:0),0),packets_lost:Oj,packets_sent:Ij,power_efficient_encoder:($e=Oe?.powerEfficientEncoder)!==null&&$e!==void 0&&$e,pli_count:Math.max(((ft=Oe?.pliCount)!==null&&ft!==void 0?ft:0)-((Ct=Fe?.pliCount)!==null&&Ct!==void 0?Ct:0),0),quality_limitation_reason:(Jt=Oe?.qualityLimitationReason)!==null&&Jt!==void 0?Jt:"none",quality_limitation_resolution_changes:Math.max(((mn=Oe?.qualityLimitationResolutionChanges)!==null&&mn!==void 0?mn:0)-((Nn=Fe?.qualityLimitationResolutionChanges)!==null&&Nn!==void 0?Nn:0),0),quality_limitation_cpu_duration:Math.max($i-Cd,0),quality_limitation_bandwidth_duration:Math.max(IE-Vme,0),retransmitted_bytes_sent:Math.max(((Dn=Oe?.retransmittedBytesSent)!==null&&Dn!==void 0?Dn:0)-((Sr=Fe?.retransmittedBytesSent)!==null&&Sr!==void 0?Sr:0),0),rid:(pl=Oe?.rid)!==null&&pl!==void 0?pl:Te,retransmitted_packets_sent:Math.max(((Ip=Oe?.retransmittedPacketsSent)!==null&&Ip!==void 0?Ip:0)-((Sh=Fe?.retransmittedPacketsSent)!==null&&Sh!==void 0?Sh:0),0),scalability_mode:(Lt=Oe?.scalabilityMode)!==null&&Lt!==void 0?Lt:"unknown",target_bitrate:Math.max((Rt=Oe?.targetBitrate)!==null&&Rt!==void 0?Rt:0,0),total_encode_time:Math.max(((Vt=Oe?.totalEncodeTime)!==null&&Vt!==void 0?Vt:0)-((gn=Fe?.totalEncodeTime)!==null&&gn!==void 0?gn:0),0),total_encoded_bytes_target:Math.max(((lr=Oe?.totalEncodedBytesTarget)!==null&&lr!==void 0?lr:0)-((Es=Fe?.totalEncodedBytesTarget)!==null&&Es!==void 0?Es:0),0),total_packet_send_delay:Math.max(((br=Oe?.totalPacketSendDelay)!==null&&br!==void 0?br:0)-((Ui=Fe?.totalPacketSendDelay)!==null&&Ui!==void 0?Ui:0),0),sei_write_count:mt,sei_bytes_sent:Et,sei_bitrate:Wme,protocol:(to=Tt?.localCandidate)===null||to===void 0?void 0:to.protocol}})(V,Y,se,me,S,f,_,Ce,R,U)))}}class uh extends $n{constructor(w,O,B,V,Y,se,me,S,f,_){var R,U;super(kn.PUBLISHED_AUDIO_STATS,w,O,!1),Object.assign(this.properties,Object.assign({action:Tn.PUBLISH,node:(R=B?.node)!==null&&R!==void 0?R:"",cluster:(U=B?.cluster)!==null&&U!==void 0?U:""},((ee,ue,de,be,Ce,Oe,Fe)=>{var ot,_t,Tt,ht,st,xt,mt,Et,kt,Bt,It,Nt,Zt;const hn=Math.max((ot=ee?.bytesSent)!==null&&ot!==void 0?ot:0,0),In=8*hn/(Oe??1),On=Math.max((_t=ue?.packetsLost)!==null&&_t!==void 0?_t:0,0),bn=Math.max((Tt=ee?.packetsSent)!==null&&Tt!==void 0?Tt:0,0),ir=On/Math.max(bn,1),mr=ka(be?.mimeType,be?.sdpFmtpLine);return{audio_nacks_enabled:(ht=Fe?.audioNacks)!==null&&ht!==void 0&&ht,bytes_sent:hn,codec_mime_type:mr?.mimeSubtype,configured_bitrate:(st=Ce?.max_audio_bitrate_bps)!==null&&st!==void 0?st:0,connection_bandwidth:(mt=(xt=de?.candidatePair)===null||xt===void 0?void 0:xt.availableOutgoingBitrate)!==null&&mt!==void 0?mt:0,encode_bitrate:In,fraction_packets_lost:ir,header_bytes_sent:(Et=ee?.headerBytesSent)!==null&&Et!==void 0?Et:0,nack_count:(kt=ee?.nackCount)!==null&&kt!==void 0?kt:0,packets_lost:On,packets_sent:bn,retransmitted_bytes_sent:(Bt=ee?.retransmittedBytesSent)!==null&&Bt!==void 0?Bt:0,retransmitted_packets_sent:(It=ee?.retransmittedPacketsSent)!==null&&It!==void 0?It:0,target_bitrate:(Nt=ee?.targetBitrate)!==null&&Nt!==void 0?Nt:0,protocol:(Zt=de?.localCandidate)===null||Zt===void 0?void 0:Zt.protocol}})(V,Y,se,me,S,f,_)))}}class sl extends $n{constructor(w,O,B,V,Y,se,me,S,f,_,R){var U,ee,ue,de;super(kn.PUBLISHED_AUDIO_STATS_WINDOW,w,O,!1);const be=Math.max(((U=V?.timestamp)!==null&&U!==void 0?U:0)-((ee=Y?.timestamp)!==null&&ee!==void 0?ee:0),0);Object.assign(this.properties,Object.assign({action:Tn.PUBLISH,node:(ue=B?.node)!==null&&ue!==void 0?ue:"",cluster:(de=B?.cluster)!==null&&de!==void 0?de:"",window_size_ms:be},((Ce,Oe,Fe,ot,_t,Tt,ht,st,xt)=>{var mt,Et,kt,Bt,It,Nt,Zt,hn,In,On,bn,ir,mr,ti,Fr,Kr,pi,li,ji,Li,Vi,mi;const es=Math.max(((mt=Ce?.bytesSent)!==null&&mt!==void 0?mt:0)-((Et=Oe?.bytesSent)!==null&&Et!==void 0?Et:0),0),$s=8*es/(typeof st!="number"?1:st/1e3),Gi=Math.max(((kt=Fe?.packetsLost)!==null&&kt!==void 0?kt:0)-((Bt=ot?.packetsLost)!==null&&Bt!==void 0?Bt:0),0),No=Math.max(((It=Ce?.packetsSent)!==null&&It!==void 0?It:0)-((Nt=Oe?.packetsSent)!==null&&Nt!==void 0?Nt:0),0),hl=Gi/Math.max(No,1),bc=ka(Tt?.mimeType,Tt?.sdpFmtpLine);return{audio_nacks_enabled:(Zt=xt?.audioNacks)!==null&&Zt!==void 0&&Zt,bytes_sent:es,codec_mime_type:bc?.mimeSubtype,configured_bitrate:(hn=ht?.max_audio_bitrate_bps)!==null&&hn!==void 0?hn:0,connection_bandwidth:(On=(In=_t?.candidatePair)===null||In===void 0?void 0:In.availableOutgoingBitrate)!==null&&On!==void 0?On:0,encode_bitrate:$s,fraction_packets_lost:hl,header_bytes_sent:Math.max(((bn=Ce?.headerBytesSent)!==null&&bn!==void 0?bn:0)-((ir=Oe?.headerBytesSent)!==null&&ir!==void 0?ir:0),0),nack_count:Math.max(((mr=Ce?.nackCount)!==null&&mr!==void 0?mr:0)-((ti=Oe?.nackCount)!==null&&ti!==void 0?ti:0),0),packets_lost:Gi,packets_sent:Math.max(((Fr=Ce?.packetsSent)!==null&&Fr!==void 0?Fr:0)-((Kr=Oe?.packetsSent)!==null&&Kr!==void 0?Kr:0),0),retransmitted_bytes_sent:Math.max(((pi=Ce?.retransmittedBytesSent)!==null&&pi!==void 0?pi:0)-((li=Oe?.retransmittedBytesSent)!==null&&li!==void 0?li:0),0),retransmitted_packets_sent:Math.max(((ji=Ce?.retransmittedPacketsSent)!==null&&ji!==void 0?ji:0)-((Li=Oe?.retransmittedPacketsSent)!==null&&Li!==void 0?Li:0),0),target_bitrate:Math.max((Vi=Ce?.targetBitrate)!==null&&Vi!==void 0?Vi:0,0),protocol:(mi=_t?.localCandidate)===null||mi===void 0?void 0:mi.protocol}})(V,Y,se,me,S,f,_,be,R)))}}class Io extends $n{constructor(w,O,B,V,Y,se,me,S){var f,_;super(kn.SUBSCRIBED_VIDEO_STATS,w,O,!1),Object.assign(this.properties,Object.assign({action:Tn.SUBSCRIBE,node:(f=V?.node)!==null&&f!==void 0?f:"",cluster:(_=V?.cluster)!==null&&_!==void 0?_:"",remote_participant_id:B},((R,U,ee,ue)=>{var de,be,Ce,Oe,Fe,ot,_t,Tt,ht,st,xt,mt,Et,kt,Bt,It,Nt,Zt,hn,In,On,bn,ir,mr;let ti=0;R?.jitterBufferDelay&&R?.jitterBufferEmittedCount&&R.jitterBufferEmittedCount>0&&(ti=R.jitterBufferDelay/R.jitterBufferEmittedCount);const Fr=ue??1,Kr=Math.max((de=R?.bytesReceived)!==null&&de!==void 0?de:0,0),pi=8*Kr/Fr;let li=0;R?.totalDecodeTime&&R?.framesDecoded&&(li=R.totalDecodeTime/Math.max(R?.framesDecoded,1));const ji=Math.max((be=R?.packetsLost)!==null&&be!==void 0?be:0,0),Li=Math.max((Ce=R?.packetsReceived)!==null&&Ce!==void 0?Ce:0,0),Vi=ji/Math.max(Li+ji,1),mi=ka(ee?.mimeType,ee?.sdpFmtpLine);return{bytes_received:Kr,codec_mime_type:mi?.mimeSubtype,codec_profile:mi?.profile,codec_level:mi?.level,connection_bandwidth:(Fe=(Oe=U?.candidatePair)===null||Oe===void 0?void 0:Oe.availableIncomingBitrate)!==null&&Fe!==void 0?Fe:0,decode_bitrate:pi,decoder_implementation:(ot=R?.decoderImplementation)!==null&&ot!==void 0?ot:"unknown",fir_count:Math.max((_t=R?.firCount)!==null&&_t!==void 0?_t:0,0),fraction_packets_lost:Vi,frame_decode_time_avg:li,frame_height:Math.max((Tt=R?.frameHeight)!==null&&Tt!==void 0?Tt:0,0),frame_width:Math.max((ht=R?.frameWidth)!==null&&ht!==void 0?ht:0,0),frames_decoded:Math.max((st=R?.framesDecoded)!==null&&st!==void 0?st:0,0),frames_dropped:Math.max((xt=R?.framesDropped)!==null&&xt!==void 0?xt:0,0),frames_received:Math.max((mt=R?.framesReceived)!==null&&mt!==void 0?mt:0,0),freeze_count:Math.max((Et=R?.freezeCount)!==null&&Et!==void 0?Et:0,0),frames_rendered:Math.max((kt=R?.framesRendered)!==null&&kt!==void 0?kt:0,0),frames_per_second:Math.max((Bt=R?.framesPerSecond)!==null&&Bt!==void 0?Bt:0,0),header_bytes_received:Math.max((It=R?.headerBytesReceived)!==null&&It!==void 0?It:0,0),jitter_buffer_delay_avg:ti,key_frames_decoded:Math.max((Nt=R?.keyFramesDecoded)!==null&&Nt!==void 0?Nt:0,0),nack_count:Math.max((Zt=R?.nackCount)!==null&&Zt!==void 0?Zt:0,0),packets_discarded:Math.max((hn=R?.packetsDiscarded)!==null&&hn!==void 0?hn:0,0),packets_lost:ji,packets_received:Li,pause_count:Math.max((In=R?.pauseCount)!==null&&In!==void 0?In:0,0),pli_count:Math.max((On=R?.pliCount)!==null&&On!==void 0?On:0,0),power_efficient_decoder:(bn=R?.powerEfficientDecoder)!==null&&bn!==void 0&&bn,total_freezes_duration:Math.max((ir=R?.totalFreezesDuration)!==null&&ir!==void 0?ir:0,0),total_pauses_duration:Math.max((mr=R?.totalPausesDuration)!==null&&mr!==void 0?mr:0,0)}})(Y,se,me,S)))}}class Pl extends $n{constructor(w,O,B,V,Y,se,me,S,f,_,R){var U,ee,ue,de;super(kn.SUBSCRIBED_VIDEO_STATS_WINDOW,w,O,!1);const be=Math.max(((U=Y?.timestamp)!==null&&U!==void 0?U:0)-((ee=se?.timestamp)!==null&&ee!==void 0?ee:0),0);Object.assign(this.properties,Object.assign({action:Tn.SUBSCRIBE,node:(ue=V?.node)!==null&&ue!==void 0?ue:"",cluster:(de=V?.cluster)!==null&&de!==void 0?de:"",window_size_ms:be,remote_participant_id:B},((Ce,Oe,Fe,ot,_t,Tt,ht,st)=>{var xt,mt,Et,kt,Bt,It,Nt,Zt,hn,In,On,bn,ir,mr,ti,Fr,Kr,pi,li,ji,Li,Vi,mi,es,$s,Gi,No,hl,bc,dl,Hl,b,T,D,Z,oe,_e,$e,ft,Ct,Jt,mn,Nn,Dn,Sr;let pl=0,Ip=0;if(Ce?.jitterBufferEmittedCount&&Oe?.jitterBufferEmittedCount&&Ce.jitterBufferEmittedCount>Oe.jitterBufferEmittedCount){Ce?.jitterBufferDelay&&Oe?.jitterBufferDelay&&(pl=(Ce.jitterBufferDelay-Oe.jitterBufferDelay)/(Ce.jitterBufferEmittedCount-Oe.jitterBufferEmittedCount));const Cd=Oe?.jitterBufferMinimumDelay,IE=Ce?.jitterBufferMinimumDelay;Cd&&IE&&(Ip=(IE-Cd)/(Ce.jitterBufferEmittedCount-Oe.jitterBufferEmittedCount))}const Sh=Math.max(((xt=Ce?.bytesReceived)!==null&&xt!==void 0?xt:0)-((mt=Oe?.bytesReceived)!==null&&mt!==void 0?mt:0),0),Lt=typeof _t!="number"?1:_t/1e3,Rt=8*Sh/Lt,Vt=Math.max(((Et=Ce?.totalDecodeTime)!==null&&Et!==void 0?Et:0)-((kt=Oe?.totalDecodeTime)!==null&&kt!==void 0?kt:0),0),gn=Math.max(((Bt=Ce?.framesDecoded)!==null&&Bt!==void 0?Bt:0)-((It=Oe?.framesDecoded)!==null&&It!==void 0?It:0),0),lr=Vt/Math.max(gn,1),Es=Math.max(((Nt=Ce?.packetsLost)!==null&&Nt!==void 0?Nt:0)-((Zt=Oe?.packetsLost)!==null&&Zt!==void 0?Zt:0),0),br=Math.max(((hn=Ce?.packetsReceived)!==null&&hn!==void 0?hn:0)-((In=Oe?.packetsReceived)!==null&&In!==void 0?In:0),0),Ui=Es/Math.max(br+Es,1),to=ka(ot?.mimeType,ot?.sdpFmtpLine),$i=8*(st||0)/Lt;return{bytes_received:Sh,codec_mime_type:to?.mimeSubtype,codec_profile:to?.profile,codec_level:to?.level,connection_bandwidth:(bn=(On=Fe?.candidatePair)===null||On===void 0?void 0:On.availableIncomingBitrate)!==null&&bn!==void 0?bn:0,decode_bitrate:Rt,decoder_implementation:(ir=Ce?.decoderImplementation)!==null&&ir!==void 0?ir:"unknown",fir_count:Math.max(((mr=Ce?.firCount)!==null&&mr!==void 0?mr:0)-((ti=Oe?.firCount)!==null&&ti!==void 0?ti:0),0),fraction_packets_lost:Ui,frame_decode_time_avg:lr,frame_height:Math.max((Fr=Ce?.frameHeight)!==null&&Fr!==void 0?Fr:0,0),frame_width:Math.max((Kr=Ce?.frameWidth)!==null&&Kr!==void 0?Kr:0,0),frames_decoded:Math.max(((pi=Ce?.framesDecoded)!==null&&pi!==void 0?pi:0)-((li=Oe?.framesDecoded)!==null&&li!==void 0?li:0),0),frames_dropped:Math.max(((ji=Ce?.framesDropped)!==null&&ji!==void 0?ji:0)-((Li=Oe?.framesDropped)!==null&&Li!==void 0?Li:0),0),frames_received:Math.max(((Vi=Ce?.framesReceived)!==null&&Vi!==void 0?Vi:0)-((mi=Oe?.framesReceived)!==null&&mi!==void 0?mi:0),0),freeze_count:Math.max(((es=Ce?.freezeCount)!==null&&es!==void 0?es:0)-(($s=Oe?.freezeCount)!==null&&$s!==void 0?$s:0),0),frames_rendered:Math.max((Gi=Ce?.framesRendered)!==null&&Gi!==void 0?Gi:0,0),frames_per_second:Math.max((No=Ce?.framesPerSecond)!==null&&No!==void 0?No:0,0),header_bytes_received:Math.max(((hl=Ce?.headerBytesReceived)!==null&&hl!==void 0?hl:0)-((bc=Oe?.headerBytesReceived)!==null&&bc!==void 0?bc:0),0),configured_jitter_buffer_min_delay_ms:Tt??0,jitter_buffer_min_obtainable_delay:Ip,jitter_buffer_delay_avg:pl,key_frames_decoded:Math.max(((dl=Ce?.keyFramesDecoded)!==null&&dl!==void 0?dl:0)-((Hl=Oe?.keyFramesDecoded)!==null&&Hl!==void 0?Hl:0),0),nack_count:Math.max(((b=Ce?.nackCount)!==null&&b!==void 0?b:0)-((T=Oe?.nackCount)!==null&&T!==void 0?T:0),0),packets_discarded:Math.max(((D=Ce?.packetsDiscarded)!==null&&D!==void 0?D:0)-((Z=Oe?.packetsDiscarded)!==null&&Z!==void 0?Z:0),0),packets_lost:Es,packets_received:br,pause_count:Math.max(((oe=Ce?.pauseCount)!==null&&oe!==void 0?oe:0)-((_e=Oe?.pauseCount)!==null&&_e!==void 0?_e:0),0),pli_count:Math.max((($e=Ce?.pliCount)!==null&&$e!==void 0?$e:0)-((ft=Oe?.pliCount)!==null&&ft!==void 0?ft:0),0),power_efficient_decoder:(Ct=Ce?.powerEfficientDecoder)!==null&&Ct!==void 0&&Ct,total_freezes_duration:Math.max(((Jt=Ce?.totalFreezesDuration)!==null&&Jt!==void 0?Jt:0)-((mn=Oe?.totalFreezesDuration)!==null&&mn!==void 0?mn:0),0),total_pauses_duration:Math.max(((Nn=Ce?.totalPausesDuration)!==null&&Nn!==void 0?Nn:0)-((Dn=Oe?.totalPausesDuration)!==null&&Dn!==void 0?Dn:0),0),sei_read_count:ht,sei_bytes_received:st,sei_bitrate:$i,protocol:(Sr=Fe?.localCandidate)===null||Sr===void 0?void 0:Sr.protocol}})(Y,se,me,S,be,f,_,R)))}}class gc extends $n{constructor(w,O,B,V,Y,se,me,S,f){var _,R;super(kn.SUBSCRIBED_AUDIO_STATS,w,O,!1),Object.assign(this.properties,Object.assign({action:Tn.SUBSCRIBE,node:(_=V?.node)!==null&&_!==void 0?_:"",cluster:(R=V?.cluster)!==null&&R!==void 0?R:"",remote_participant_id:B},((U,ee,ue,de,be)=>{var Ce,Oe,Fe,ot,_t,Tt,ht,st,xt,mt,Et,kt,Bt,It,Nt,Zt,hn,In;let On=0;U?.jitterBufferDelay&&U?.jitterBufferEmittedCount&&U.jitterBufferEmittedCount>0&&(On=U.jitterBufferDelay/U.jitterBufferEmittedCount);const bn=de??1,ir=Math.max((Ce=U?.bytesReceived)!==null&&Ce!==void 0?Ce:0,0),mr=8*ir/bn,ti=Math.max((Oe=U?.packetsLost)!==null&&Oe!==void 0?Oe:0,0),Fr=Math.max((Fe=U?.packetsReceived)!==null&&Fe!==void 0?Fe:0,0),Kr=ti/Math.max(Fr+ti,1),pi=Math.max((ot=U?.concealedSamples)!==null&&ot!==void 0?ot:0,0),li=Math.max((_t=U?.totalSamplesReceived)!==null&&_t!==void 0?_t:0,0),ji=pi/Math.max(li,1),Li=ka(ue?.mimeType,ue?.sdpFmtpLine);return{audio_level:(Tt=U?.audioLevel)!==null&&Tt!==void 0?Tt:0,audio_nacks_enabled:(ht=be?.audioNacks)!==null&&ht!==void 0&&ht,bytes_received:ir,codec_mime_type:Li?.mimeSubtype,connection_bandwidth:(xt=(st=ee?.candidatePair)===null||st===void 0?void 0:st.availableIncomingBitrate)!==null&&xt!==void 0?xt:0,concealed_samples:pi,concealment_events:Math.max((mt=U?.concealmentEvents)!==null&&mt!==void 0?mt:0,0),silent_concealed_samples:Math.max((Et=U?.silentConcealedSamples)!==null&&Et!==void 0?Et:0,0),decode_bitrate:mr,fraction_audio_concealed:ji,fraction_packets_lost:Kr,header_bytes_received:Math.max((kt=U?.headerBytesReceived)!==null&&kt!==void 0?kt:0,0),inserted_samples_for_deceleration:Math.max((Bt=U?.insertedSamplesForDeceleration)!==null&&Bt!==void 0?Bt:0,0),jitter_buffer_delay_avg:On,packets_discarded:Math.max((It=U?.packetsDiscarded)!==null&&It!==void 0?It:0,0),retransmitted_packets_received:Math.max((Nt=U?.retransmittedPacketsReceived)!==null&&Nt!==void 0?Nt:0,0),retransmitted_bytes_received:Math.max((Zt=U?.retransmittedBytesReceived)!==null&&Zt!==void 0?Zt:0,0),packets_lost:ti,packets_received:Fr,nack_count:Math.max((hn=U?.nackCount)!==null&&hn!==void 0?hn:0,0),removed_samples_for_acceleration:Math.max((In=U?.removedSamplesForAcceleration)!==null&&In!==void 0?In:0,0),total_samples_received:li}})(Y,se,me,S,f)))}}class jg extends $n{constructor(w,O,B,V,Y,se,me,S,f,_){var R,U,ee,ue;super(kn.SUBSCRIBED_AUDIO_STATS_WINDOW,w,O,!1);const de=Math.max(((R=Y?.timestamp)!==null&&R!==void 0?R:0)-((U=se?.timestamp)!==null&&U!==void 0?U:0),0);Object.assign(this.properties,Object.assign({action:Tn.SUBSCRIBE,window_size_ms:de,node:(ee=V?.node)!==null&&ee!==void 0?ee:"",cluster:(ue=V?.cluster)!==null&&ue!==void 0?ue:"",remote_participant_id:B},((be,Ce,Oe,Fe,ot,_t,Tt)=>{var ht,st,xt,mt,Et,kt,Bt,It,Nt,Zt,hn,In,On,bn,ir,mr,ti,Fr,Kr,pi,li,ji,Li,Vi,mi,es,$s,Gi,No,hl,bc,dl,Hl;let b=0,T=0;if(be?.jitterBufferEmittedCount&&Ce?.jitterBufferEmittedCount&&be.jitterBufferEmittedCount>Ce.jitterBufferEmittedCount){be?.jitterBufferDelay&&Ce?.jitterBufferDelay&&(b=(be.jitterBufferDelay-Ce.jitterBufferDelay)/(be.jitterBufferEmittedCount-Ce.jitterBufferEmittedCount));const Dn=Ce?.jitterBufferMinimumDelay,Sr=be?.jitterBufferMinimumDelay;Dn&&Sr&&(T=(Sr-Dn)/(be.jitterBufferEmittedCount-Ce.jitterBufferEmittedCount))}const D=typeof ot!="number"?1:ot/1e3,Z=Math.max(((ht=be?.bytesReceived)!==null&&ht!==void 0?ht:0)-((st=Ce?.bytesReceived)!==null&&st!==void 0?st:0),0),oe=8*Z/D,_e=Math.max(((xt=be?.packetsLost)!==null&&xt!==void 0?xt:0)-((mt=Ce?.packetsLost)!==null&&mt!==void 0?mt:0),0),$e=Math.max(((Et=be?.packetsReceived)!==null&&Et!==void 0?Et:0)-((kt=Ce?.packetsReceived)!==null&&kt!==void 0?kt:0),0),ft=_e/Math.max($e+_e,1),Ct=Math.max(((Bt=be?.concealedSamples)!==null&&Bt!==void 0?Bt:0)-((It=Ce?.concealedSamples)!==null&&It!==void 0?It:0),0),Jt=Math.max(((Nt=be?.totalSamplesReceived)!==null&&Nt!==void 0?Nt:0)-((Zt=Ce?.totalSamplesReceived)!==null&&Zt!==void 0?Zt:0),0),mn=Ct/Math.max(Jt,1),Nn=ka(Fe?.mimeType,Fe?.sdpFmtpLine);return{audio_level:(hn=be?.audioLevel)!==null&&hn!==void 0?hn:0,audio_nacks_enabled:(In=_t?.audioNacks)!==null&&In!==void 0&&In,bytes_received:Z,codec_mime_type:Nn?.mimeSubtype,connection_bandwidth:(bn=(On=Oe?.candidatePair)===null||On===void 0?void 0:On.availableIncomingBitrate)!==null&&bn!==void 0?bn:0,decode_bitrate:oe,concealed_samples:Ct,concealment_events:Math.max(((ir=be?.concealmentEvents)!==null&&ir!==void 0?ir:0)-((mr=Ce?.concealmentEvents)!==null&&mr!==void 0?mr:0),0),silent_concealed_samples:Math.max(((ti=be?.silentConcealedSamples)!==null&&ti!==void 0?ti:0)-((Fr=Ce?.silentConcealedSamples)!==null&&Fr!==void 0?Fr:0),0),fraction_audio_concealed:mn,fraction_packets_lost:ft,header_bytes_received:Math.max(((Kr=be?.headerBytesReceived)!==null&&Kr!==void 0?Kr:0)-((pi=Ce?.headerBytesReceived)!==null&&pi!==void 0?pi:0),0),inserted_samples_for_deceleration:Math.max(((li=be?.insertedSamplesForDeceleration)!==null&&li!==void 0?li:0)-((ji=Ce?.insertedSamplesForDeceleration)!==null&&ji!==void 0?ji:0),0),configured_jitter_buffer_min_delay_ms:Tt??0,jitter_buffer_min_obtainable_delay:T,jitter_buffer_delay_avg:b,packets_discarded:Math.max(((Li=be?.packetsDiscarded)!==null&&Li!==void 0?Li:0)-((Vi=Ce?.packetsDiscarded)!==null&&Vi!==void 0?Vi:0),0),packets_lost:_e,packets_received:$e,nack_count:Math.max(((mi=be?.nackCount)!==null&&mi!==void 0?mi:0)-((es=Ce?.nackCount)!==null&&es!==void 0?es:0),0),removed_samples_for_acceleration:Math.max((($s=be?.removedSamplesForAcceleration)!==null&&$s!==void 0?$s:0)-((Gi=Ce?.removedSamplesForAcceleration)!==null&&Gi!==void 0?Gi:0),0),retransmitted_packets_received:Math.max(((No=be?.retransmittedPacketsReceived)!==null&&No!==void 0?No:0)-((hl=Ce?.retransmittedPacketsReceived)!==null&&hl!==void 0?hl:0),0),retransmitted_bytes_received:Math.max(((bc=be?.retransmittedBytesReceived)!==null&&bc!==void 0?bc:0)-((dl=Ce?.retransmittedBytesReceived)!==null&&dl!==void 0?dl:0),0),total_samples_received:Jt,protocol:(Hl=Oe?.localCandidate)===null||Hl===void 0?void 0:Hl.protocol}})(Y,se,me,S,de,f,_)))}}class Lm extends $n{constructor(w,O,B,V,Y=Tn.PUBLISH,se=!1,me=""){super(kn.SIMULCAST_LAYER_INFO,w,O,!1),Object.assign(this.properties,{rid:B,active:V,selected:se,source:Y===Tn.PUBLISH?"publisher":"subscriber",remote_participant_id:me})}}const vs=L=>{console.warn(`[IVS Stages] ${L}`)};var bo,fh,hh;(function(L){L.Mobile="mobile",L.Tablet="tablet",L.Desktop="desktop",L.Tv="tv"})(bo||(bo={})),(function(L){L.IOS="iOS",L.MacOS="macOS",L.Windows="Windows",L.Android="Android"})(fh||(fh={})),(function(L){L.Safari="Safari",L.Firefox="Firefox",L.Chrome="Chrome",L.IE="Internet Explorer",L.Edge="Microsoft Edge"})(hh||(hh={}));const vd=(function(L){const w=Oa(L);return{platform:{isMobile:_c(bo.Mobile,w),isTablet:_c(bo.Tablet,w),isDesktop:_c(bo.Desktop,w),isTv:_c(bo.Tv,w)},os:{name:bp(w),version:Um(w),isIOS:Af(fh.IOS,w),isMacOS:Af(fh.MacOS,w),isWindows:Af(fh.Windows,w),isAndroid:Af(fh.Android,w)},browser:{name:Zn(w),version:Uc(w),isSafari:sr(hh.Safari,w),isFirefox:sr(hh.Firefox,w),isChrome:sr(hh.Chrome,w),isIE:sr(hh.IE,w),isEdge:sr(hh.Edge,w)}}})(window.navigator.userAgent);function Oa(L){try{return gm.getParser(L||window.navigator.userAgent)}catch{}}function _c(L,w){return()=>(w||(w=Oa()),!(!w||w.getPlatformType(!0)!==L.toLowerCase()))}function Um(L){return()=>(L||(L=Oa()),L&&L.getOSVersion()||"")}function bp(L){return()=>(L||(L=Oa()),L&&L.getOSName()||"")}function Af(L,w){return()=>(w||(w=Oa()),!(!w||w.getOSName(!0)!==L.toLowerCase()))}function Uc(L){return()=>(L||(L=Oa()),L&&L.getBrowserVersion()||"")}function Zn(L){return()=>(L||(L=Oa()),L&&L.getBrowserName()||"")}function sr(L,w){return()=>(w||(w=Oa()),!(!w||w.getBrowserName().toLowerCase()!==L.toLowerCase()))}const yd={name:"SimulcastUnsupported",message:`Simulcast is only supported on Chromium browsers at bitrates over ${Bs.MID.maxBitrateKbps}Kbps`,code:100},Bc={name:"SimulcastLayerInvalidType",message:"Layer configuration is invalid: ",code:101},Fc={name:"SimulcastMaxLayersExceeded",message:"No more than 3 simulcast layers may be configured",code:102},Bm={name:"SimulcastDuplicateLayersConfigured",message:"Two duplicate layers are configured. At minimum bitrate, framerate, or dimensions must differ",code:103},fa={name:"SimulcastMaxLayerBitrateExceeded",message:`maxBitrateKbps cannot exceed ${Oo} Kbps`,code:105},ha={name:"SimulcastMinLayerBitrateExceeded",message:`maxBitrateKbps cannot be less than ${Il} Kbps`,code:106},dh={name:"SimulcastMaxLayerFramerateExceeded",message:`maxFramerate cannot exceed ${Pc} fps`,code:107},g_={name:"SimulcastMinLayerFramerateExceeded",message:`maxFramerate cannot be less than ${$u} fps`,code:108},vu={name:"SimulcastMaxLayerDimensionsExceeded",message:`dimensions cannot exceed max resolution of ${Nl}x720`,code:109},Vs={name:"SimulcastMinLayerDimensionsExceeded",message:`width or height cannot be lower than ${Rf}`,code:110},Ko={name:"SimulcastLayerConfigurationConflict",message:"Layer configuration conflict: ",code:111},Ep={name:"SimulcastLayerOrientationMismatch",message:"Layer orientation different from input video track: ",code:112},zg={name:"SimulcastLayerInputResolutionInsufficient",message:"Input video resolution is lower than the configured layer: ",code:113},Sp={name:"SimulcastLayerInputFramerateInsufficient",message:"Input video framerate is lower than the configured layer: ",code:114};class Ys extends Error{constructor({name:w,message:O,code:B,details:V,cause:Y,params:se}){super(O),Error.captureStackTrace&&Error.captureStackTrace(this,Ys),this.name=w,this.message=O,this.code=B,this.details=V,this.cause=Y,this.params=se}}const Fm=L=>({rid:L.rid,active:L.active,scaleResolutionDownBy:L.scaleFactor,maxBitrate:L.maxBitrateBps,maxFramerate:L.maxFramerate}),__=(L,w)=>L.width*L.height>w.width*w.height||L.maxBitrateKbps>w.maxBitrateKbps||L.maxFramerate>w.maxFramerate?1:Hg(L,w)?0:-1,Hg=(L,w)=>{if(typeof L!="object"||typeof w!="object")return!1;const O=Object.keys(L);for(const B of O)if(L[B]!==w[B])return!1;return!0},jm=L=>{const{width:w,height:O}=bd(L);return w*O},bd=L=>{const{height:w,width:O}=L;let B=Nl/mu,V=Nl;return w!==void 0&&(B=w),O!==void 0&&(V=O),w&&!O&&(V=w*mu),!w&&O&&(B=O/mu),{height:B,width:V}},Ed=L=>{const{width:w,height:O}=L;return w/O>=1?Br.LANDSCAPE:Br.PORTRAIT},Dl=(L,w,O)=>{var B;const V=(B=L.getSettings().frameRate)!==null&&B!==void 0?B:Pc;return Object.assign(Object.assign({},O),{active:!0,height:w.height,width:w.width,maxBitrateBps:wr(w.maxBitrateKbps),maxFramerate:Math.min(w.maxFramerate,V),scaleFactor:qg(w,L)})},qg=(L,w)=>{const O=jm(w.getSettings()),B=jm(L);if(B>=O)return 1;const V=1/Math.sqrt(B/O);return Math.max(V,1)},v_=L=>{if(typeof L!="object"){const w=Object.assign({},Bc);throw w.message+=" is not an object",new Ys(w)}},zm=(L,w)=>{if(typeof L!="number"){const O=Object.assign({},Bc);throw O.message+="maxBitrateKbps is not a number",new Ys(O)}if(L<Il)throw new Ys(Object.assign({},ha));if(L>Oo)throw new Ys(Object.assign({},fa));if(w&&L>w){const O=Object.assign({},Ko);throw O.message+=`maxBitrateKbps cannot be greater than stage maxVideoBitrateKbps of ${w}`,new Ys(O)}},xp=(L,w)=>{if(typeof L!="number"){const O=Object.assign({},Bc);throw O.message+="maxFramerate is not a number",new Ys(O)}if(L<$u)throw new Ys(Object.assign({},g_));if(L>Pc)throw new Ys(Object.assign({},dh));if(w&&L>w){const O=Object.assign({},Ko);throw O.message+=`maxFramerate cannot be greater than stage maxFramerate of ${w} `,new Ys(O)}},Hm=(L,w)=>{var O;if(typeof L!="number"||typeof w!="number"){const Y=Object.assign({},Bc);throw Y.message+="width and height must be numbers",new Ys(Y)}if(L<Rf||w<Rf)throw new Ys(Object.assign({},Vs));const B=(O=Rs("enable1080pResolution"))!==null&&O!==void 0&&O,V=B?1920:Nl;if(L>V||w>V)throw new Ys(Object.assign({},vu));if(L*w>(B?2073600:Ma))throw new Ys(Object.assign({},vu))},Ll=(L,w)=>{const O=bd(w.getSettings()),B=Ed(O);B!==Ed(L)&&vs(`${Ep.message}forcing orientation to ${B}`)},Ka=(L,w)=>{var O,B,V,Y,se;let me=(0,ss.cloneDeep)(w);const S=(O=me.simulcast)!==null&&O!==void 0?O:{},f=!vd.browser.isChrome()&&!vd.browser.isEdge(),_=(V=(B=L.getSettings())===null||B===void 0?void 0:B.displaySurface)!==null&&V!==void 0&&V,R=(Y=me.maxVideoBitrateKbps)!==null&&Y!==void 0?Y:Oo,U=!(Array.isArray((se=w.simulcast)===null||se===void 0?void 0:se.layers)||!w.maxVideoBitrateKbps)&&R<Bs.MID.maxBitrateKbps;if(typeof S.enabled=="boolean"&&S.enabled&&(f||_||U)){me.simulcast={enabled:!1};const{name:ee,message:ue}=yd;vs(`${ee}${ue}, disabling the feature`)}return me=((ee,ue)=>{var de,be;const Ce=ue,Oe=(de=ue.simulcast)===null||de===void 0?void 0:de.layers;if(Oe===void 0)return Ce;if(!Array.isArray(Oe)){const Fe=Object.assign({},Bc);throw Fe.message+=" layers is not an array",new Ys(Fe)}if(Oe.length===0)return(be=Ce.simulcast)===null||be===void 0||delete be.layers,Ce;if(Oe.length>3)throw new Ys(Object.assign({},Fc));if((0,ss.uniqWith)(Oe,Hg).length!==Oe.length)throw new Ys(Object.assign({},Bm));for(const Fe of Oe)v_(Fe),zm(Fe.maxBitrateKbps,ue.maxVideoBitrateKbps),xp(Fe.maxFramerate,ue.maxFramerate),Hm(Fe.width,Fe.height),Ll(Fe,ee);return Ce})(L,me),me};function yu(L){return L.track.kind===Ol.AUDIO}function qm(L){return L.track.kind===Ol.VIDEO&&typeof L.config=="object"}function y_(L){if(L!==void 0&&(L<Il||L>Oo))throw new Error(`Stage bitrate must be a number between ${Il} kbps and ${Oo} kbps inclusive`)}function Vm(L){return L!==void 0&&("maxBitrate"in L||"maxVideoBitrateKbps"in L||"maxFramerate"in L||"simulcast"in L||"inBandMessaging"in L||"minBitrate"in L)}function Vg(L,w){if(w===void 0)return w;let O=(0,ss.cloneDeep)(w);return Vm(O)?(O.maxBitrate!==void 0&&(O.maxVideoBitrateKbps=O.maxBitrate,vs("maxBitrate is deprecated in favor of maxVideoBitrateKbps")),O=Ka(L,O),y_(O.maxVideoBitrateKbps),y_(O.minBitrate),(function(B){if(B!==void 0&&(B>Pc||B<$u))throw new Error(`Stage framerate must be between ${$u} fps and ${Pc} fps inclusive`)})(O.maxFramerate),(function(B){if(B!==void 0){if(typeof B!="object")throw new Error("In-band messaging config must be an object");if(typeof B.enabled!="boolean")throw new Error("In-band messaging config enabled property must be a boolean")}})(O.inBandMessaging)):((function(B){if(B!==void 0&&(B<gu||B>Dc))throw new Error(`Stage audio bitrate must be between ${gu} Kbps and ${Dc} Kbps inclusive`)})(O.maxAudioBitrateKbps),(function(B){if(B!==void 0&&typeof B!="boolean")throw new Error("Stage stereo prop must be a boolean")})(O.stereo)),O}const b_=(L,w,O)=>{var B;const V={[fr.HI]:Nc(fr.HI),[fr.MID]:Nc(fr.MID),[fr.LOW]:Nc(fr.LOW)},Y=w.simulcast,se=O?.simulcast;let me=Y.layers.sort(__);const S=(B=se?.layers)!==null&&B!==void 0?B:[],f=me.length,_=S.length;return me=me.map((R=>{((ee,ue)=>{const{width:de,height:be}=bd(ue.getSettings()),{width:Ce,height:Oe}=ee;if(Ce*Oe>de*be){const Fe=`forcing layer of ${Ce}x${Oe} to the input dimensions ${de}x${be}`,{name:ot,message:_t}=zg;vs(`${ot}${_t}${Fe}`)}})(R,L),((ee,ue)=>{var de;const be=(de=ue.getSettings().frameRate)!==null&&de!==void 0?de:Pc,Ce=ee.maxFramerate;if(Ce>be){const Oe=`forcing layer of ${Ce}fps to the input framerate of ${be}`,{name:Fe,message:ot}=Sp;vs(`${Fe}${ot}${Oe}`)}})(R,L);let U=((ee,ue)=>{const{maxVideoBitrateKbps:de}=ue,be=ee;return de&&ee.maxBitrateKbps>de&&(be.maxBitrateKbps=de),be})(R,w);return U=((ee,ue)=>{const{maxFramerate:de}=ue,be=ee;return de&&ee.maxFramerate>de&&(be.maxFramerate=de),be})(R,w),U})),(_===0||_===3)&&f===3?(V.hi=Dl(L,me[2],V.hi),V.mid=Dl(L,me[1],V.mid),V.low=Dl(L,me[0],V.low),Pn.ok(V)):_===1&&f===1?(V.hi=Dl(L,me[0],V.hi),Pn.ok(V)):_===2&&f===2?(V.hi=Dl(L,me[1],V.hi),V.low=Dl(L,me[0],V.low),Pn.ok(V)):Pn.err(null)},E_=(L,w,O)=>{const B=w.simulcast,V=w.inBandMessaging,Y=wr(w.minBitrate),se=wr(w.maxVideoBitrateKbps),me=w.maxFramerate;let S=[{maxBitrate:se,maxFramerate:me}];const f=b_(L,w,O??{});return B.enabled&&f.ok&&(S=(_=>{const{hi:R,mid:U,low:ee}=_;return[Fm(ee),Fm(U),Fm(R)]})(f.value)),{track:L,config:{minBitrateBps:Y,maxBitrateBps:se,maxFramerate:me,inBandMessagingEnabled:V.enabled,simulcastEnabled:B.enabled,simulcastLayers:f.ok?f.value:void 0,encodingLayers:S}}},Gg=L=>{const w=L.mediaStreamTrack,O=L.normalizedConfig;let B={};const V=L.validatedExternalConfig;return Vm(V)&&(B=V),(function(Y){return Y.kind===Ol.AUDIO})(w)?((Y,se)=>{const me={maxBitrateBps:wr(se.maxAudioBitrateKbps)},S=se?.stereo;return typeof S=="boolean"&&(me.stereo=S),{track:Y,config:me}})(w,O):E_(w,O,B)},Qv=(L,w)=>{const O={minBitrate:Il,maxBitrate:Oo,maxVideoBitrateKbps:Oo,maxFramerate:Pc,simulcast:{enabled:!1,layers:[Object.assign({},Bs.HI),Object.assign({},Bs.MID),Object.assign({},Bs.LOW)]},maxAudioBitrateKbps:Bg,stereo:!1,inBandMessaging:{enabled:!1}},B=(0,ss.cloneDeep)(w),V=Object.assign(Object.assign({},O),B);return Vm(B)&&(B.simulcast&&(V.simulcast=Object.assign(Object.assign({},O.simulcast),B.simulcast)),B.inBandMessaging&&(V.inBandMessaging=Object.assign(Object.assign({},O.inBandMessaging),B.inBandMessaging))),V},Gm=(L,w)=>{if(typeof L=="number")return L;const O=w?yr:_p;return O[L]!==void 0?O[L]:0};class ey extends $n{constructor(w,O,B,V){super(kn.MULTIHOST_CONFIGURATION,w,O,!1),Object.assign(this.properties,Object.assign(Object.assign({},B),{action:V}))}}class Ul extends $n{constructor(w,O,B,V,Y){super(kn.MULTIHOST_SUBSCRIBE_CONFIGURATION,w,O,!1);const se={trigger:B,remote_participant_id:V,min_delay_when_publishing:Gm(Y.jitterBuffer.minDelayWhenPublishing,!0),min_delay_when_subscribe_only:Gm(Y.jitterBuffer.minDelayWhenSubscribeOnly,!1),in_band_messaging_enabled:Y.inBandMessaging.enabled,simulcast_initial_layer_preference:Y.simulcast.initialLayerPreference,simulcast_layer_poll_interval_ms:Y.simulcast.layerPollingIntervalMs,simulcast_layer_poll_enabled:Y.simulcast.layerPollingEnabled};Object.assign(this.properties,se)}}var Xa=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};class $m{constructor(w,O,B,V,Y){this.analyticsTracker=Y,this.simulcastEnabled=!1,this.simulcastState={low:!1,mid:!1,hi:!1},this.sdp=new ri(""),this.sdpFeatures={audioNacks:!1},this.multihostConfiguration=$m.defaultMultihostConfiguration(),this.prevOutboundVideoStats=new Map,this.prevInboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.sfuResource={node:"",cluster:""},this.connectionStartedTimestamp=Date.now(),this.seiStats={seiReadCnt:0,seiBytesRead:0,seiWriteCnt:0,seiBytesWritten:0},this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.prevVideoSenderTransformerStats={seiWriteCnt:0,seiBytesWritten:0},this.vidNetworkQualityMap=new Map,this.audioNetworkQualityMap=new Map,this.onPeerConnectionStateChange=()=>{switch(this.getConnectionState()){case jn.CONNECTED:this.connectionStartedTimestamp=Date.now(),this.setupIntervals();break;case jn.FAILED:this.flushStats()}},this.action=w,this.token=O,this.traceId=B,this.identifier=V}static defaultMultihostConfiguration(){return{video_codec:"unknown",width:0,height:0,max_bitrate:0,min_bitrate:0,target_fps:0,echo_cancellation:!1,auto_gain:!1,noise_suppression:!1,enable_simulcast:!1,max_audio_bitrate_bps:wr(Dc),hi_video_layer:"",mid_video_layer:"",low_video_layer:""}}set sdpAnswer(w){try{this.sdp=new ri(w),this.sdpFeatures.audioNacks=this.sdp.hasAudioNacksEnabled()}catch{}}start(w,O=!1){this.peerConnection=w,this.simulcastEnabled=O,this.prevOutboundAudioStats=void 0,this.prevOutboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.peerConnection.addEventListener("connectionstatechange",this.onPeerConnectionStateChange)}stop(){var w;clearInterval(this.uploadStatsInterval),this.uploadStatsInterval=void 0,(w=this.peerConnection)===null||w===void 0||w.removeEventListener("connectionstatechange",this.onPeerConnectionStateChange)}updateSfuResource(w){this.sfuResource=w}updateMultihostConfiguration(w,O){var B,V,Y,se,me,S,f,_,R;return Xa(this,void 0,void 0,(function*(){if(this.action!==Tn.PUBLISH||!this.peerConnection)return;const U=$m.defaultMultihostConfiguration();if(O){const ee=this.peerConnection.getSenders().filter((be=>be.track!==null&&be.track.kind==="video"));let ue="unknown";ee.length>0&&(yield ee[0].getStats()).forEach((be=>{if(be.type==="codec"&&(U.video_codec=be.mimeType,be.sdpFmtpLine)){const Ce=be.sdpFmtpLine.match(/profile-level-id=([a-f0-9]+)/);Ce&&Ce.length>0&&(ue=Ce[1])}}));const de=O.track.getSettings();U.width=(B=de.width)!==null&&B!==void 0?B:0,U.height=(V=de.height)!==null&&V!==void 0?V:0,U.target_fps=(Y=de.frameRate)!==null&&Y!==void 0?Y:0,O.config?(U.max_bitrate=O.config.maxBitrateBps,U.min_bitrate=O.config.minBitrateBps,U.enable_simulcast=O.config.simulcastEnabled):(U.max_bitrate=wr(Oo),U.min_bitrate=wr(Il),U.enable_simulcast=!1),O.config.simulcastEnabled&&(U.hi_video_layer=this.mapLayerToMetric(ue,(se=O.config.simulcastLayers)===null||se===void 0?void 0:se.hi),U.mid_video_layer=this.mapLayerToMetric(ue,(me=O.config.simulcastLayers)===null||me===void 0?void 0:me.mid),U.low_video_layer=this.mapLayerToMetric(ue,(S=O.config.simulcastLayers)===null||S===void 0?void 0:S.low))}if(w){const ee=w.track.getSettings();U.auto_gain=(f=ee.autoGainControl)!==null&&f!==void 0&&f,U.echo_cancellation=(_=ee.echoCancellation)!==null&&_!==void 0&&_,U.noise_suppression=(R=ee.noiseSuppression)!==null&&R!==void 0&&R,U.max_audio_bitrate_bps=w.config.maxBitrateBps,U.stereo=w.config.stereo}(0,ss.isEqual)(U,this.multihostConfiguration)||(this.analyticsTracker.trackEventNoSharedProps(new ey(this.token,this.traceId,U,this.action)),this.multihostConfiguration=U)}))}resetTransformers(w,O){this.senderVideoTransformer=O,this.receiveVideoTransformer=w,this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.prevVideoSenderTransformerStats={seiWriteCnt:0,seiBytesWritten:0}}getStats(w){var O;return Xa(this,void 0,void 0,(function*(){const B=yield(O=this.peerConnection)===null||O===void 0?void 0:O.getStats(w),{action:V}=this;if(B)if(w.kind==="audio"){if(V===Tn.PUBLISH)return{action:V,rawReport:B,stats:Lc(B,this.audioNetworkQualityMap)};if(V===Tn.SUBSCRIBE)return{action:V,rawReport:B,stats:_d(B,this.audioNetworkQualityMap)}}else{if(V===Tn.PUBLISH)return{action:V,rawReport:B,stats:il(B,this.vidNetworkQualityMap)};if(V===Tn.SUBSCRIBE)return{action:V,rawReport:B,stats:p_(B,this.vidNetworkQualityMap)}}}))}mapLayerToMetric(w,O){return!O||!O.active?"":`${`${O.height}x${O.width}`}_${`${O.maxFramerate}fps`}_${O.maxBitrateBps/1e3+"kbps"}_${w}`}updateJitterBufferMinDelay(w){this.jitterBufferMinDelayInMs=w}setupIntervals(){this.action===Tn.PUBLISH&&this.simulcastEnabled&&!this.pollSimulcastLayerInterval&&(this.pollSimulcastLayers(),this.pollSimulcastLayerInterval=this.startInterval(this.pollSimulcastLayers,5e3)),this.uploadStatsInterval||(this.uploadStats(),this.uploadStatsInterval=this.startInterval(this.uploadStats,1e4))}startInterval(w,O){return setInterval(w.bind(this),O)}getConnectionState(){var w;if(!this.peerConnection)return jn.NONE;const O=(w=this.peerConnection.connectionState)!==null&&w!==void 0?w:this.peerConnection.iceConnectionState;try{return Lg(O)}catch{return jn.IDLE}}pollSimulcastLayers(){var w;return Xa(this,void 0,void 0,(function*(){if(this.getConnectionState()===jn.CONNECTED){const O=yield(w=this.peerConnection)===null||w===void 0?void 0:w.getStats();if(!O)return;O.forEach((B=>{var V;if(B.type==="outbound-rtp"){const Y=((V=B.framesPerSecond)!==null&&V!==void 0?V:0)!==0;switch(B.rid){case"low":Y!==this.simulcastState.low&&(this.simulcastState.low=Y,this.analyticsTracker.trackEventNoSharedProps(new Lm(this.token,this.traceId,B.rid,Y)));break;case"mid":Y!==this.simulcastState.mid&&(this.simulcastState.mid=Y,this.analyticsTracker.trackEventNoSharedProps(new Lm(this.token,this.traceId,B.rid,Y)));break;case"hi":Y!==this.simulcastState.hi&&(this.simulcastState.hi=Y,this.analyticsTracker.trackEventNoSharedProps(new Lm(this.token,this.traceId,B.rid,Y)))}}}))}}))}flushStats(){var w;return Xa(this,void 0,void 0,(function*(){const O=yield(w=this.peerConnection)===null||w===void 0?void 0:w.getStats();O&&(this.action===Tn.PUBLISH?this.uploadPublisherStats(O):this.action===Tn.SUBSCRIBE&&this.uploadSubscriberStats(O))}))}uploadStats(){var w;return Xa(this,void 0,void 0,(function*(){if(this.getConnectionState()===jn.CONNECTED){const O=yield(w=this.peerConnection)===null||w===void 0?void 0:w.getStats();if(!O)return;this.action===Tn.PUBLISH?this.uploadPublisherStats(O):this.action===Tn.SUBSCRIBE&&this.uploadSubscriberStats(O)}}))}uploadPublisherStats(w){var O,B;const V={audio:{},video:[],candidateStats:{}},Y=new Map,se=(Date.now()-this.connectionStartedTimestamp)/1e3,me=Object.assign({},this.multihostConfiguration),{seiWriteCnt:S,seiBytesWritten:f}=this.updateAndDiffSeiPublishStatsSinceLastUpdate((O=this.senderVideoTransformer)===null||O===void 0?void 0:O.getSenderStats());if(this.seiStats.seiWriteCnt+=S,this.seiStats.seiBytesWritten+=f,w.forEach((_=>{if(_.type==="outbound-rtp"){const R=w.get(_.remoteId),U=this.prevRemoteInboundStats.get(_.remoteId);switch(R&&this.prevRemoteInboundStats.set(R.id,R),_.kind){case"audio":V.audio=this.updateOutboundAudio(_),V.audio.remoteInbound=R,V.audio.prevRemoteInbound=U,V.audio.codec=Y.get(_.codecId);break;case"video":V.video.push(Object.assign({},this.updateOutboundVideo(_),{remoteInbound:R,prevRemoteInbound:U,codec:Y.get(_.codecId)}))}}_.type==="candidate-pair"&&_.nominated&&(V.candidateStats.candidatePair=_,V.candidateStats.localCandidate=w.get(_.localCandidateId),V.candidateStats.remoteCandidate=w.get(_.remoteCandidate)),_.type==="codec"&&Y.set(_.id,_)})),V.video.forEach((_=>{var R,U;const{outbound:ee,prevOutbound:ue}=_;if(!ee)return;const de=(U=(R=_.outbound)===null||R===void 0?void 0:R.rid)!==null&&U!==void 0?U:Te;this.updateNetworkQualityPublish(de,this.vidNetworkQualityMap,ee,ue)})),V.audio.outbound){const _=(B=V.audio.outbound.rid)!==null&&B!==void 0?B:Te;this.updateNetworkQualityPublish(_,this.audioNetworkQualityMap,V.audio.outbound,V.audio.prevOutbound)}this.analyticsTracker.trackEventNoSharedProps(new uh(this.token,this.traceId,this.sfuResource,V.audio.outbound,V.audio.remoteInbound,V.candidateStats,V.audio.codec,me,se,this.sdpFeatures)),V.audio.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new sl(this.token,this.traceId,this.sfuResource,V.audio.outbound,V.audio.prevOutbound,V.audio.remoteInbound,V.audio.prevRemoteInbound,V.candidateStats,V.audio.codec,me,this.sdpFeatures)),V.video.forEach((_=>{this.analyticsTracker.trackEventNoSharedProps(new Dm(this.token,this.traceId,this.sfuResource,_.outbound,_.remoteInbound,V.candidateStats,_.codec,me,se)),_.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new yp(this.token,this.traceId,this.sfuResource,_.outbound,_.prevOutbound,_.remoteInbound,_.prevRemoteInbound,V.candidateStats,_.codec,me,this.seiStats.seiWriteCnt,this.seiStats.seiBytesWritten))}))}updateNetworkQualityPublish(w,O,B,V){var Y,se,me,S;let f=0;const _=Oc.getNetworkQuality(),R=(Y=B.packetsSent)!==null&&Y!==void 0?Y:0,U=(se=B.nackCount)!==null&&se!==void 0?se:0;if(V)if(_===vo.DOWN)O.set(w,vo.DOWN);else{f=(U-((me=V?.nackCount)!==null&&me!==void 0?me:0))/(R-((S=V?.packetsSent)!==null&&S!==void 0?S:0));const ee=this.convertLostRatioToQuality(f);O.set(w,ee)}else O.set(w,_)}updateNetworkQualitySubscribe(w,O,B){var V,Y,se,me;let S=0;const f=Oc.getNetworkQuality(),_=(V=O?.packetsReceived)!==null&&V!==void 0?V:0,R=(Y=O?.nackCount)!==null&&Y!==void 0?Y:0;if(!O)return;const U=O.id;if(U)if(B)if(f===vo.DOWN)w.set(U,vo.DOWN);else{S=(R-((se=B?.nackCount)!==null&&se!==void 0?se:0))/(_-((me=B?.packetsReceived)!==null&&me!==void 0?me:0));const ee=this.convertLostRatioToQuality(S);w.set(U,ee)}else w.set(U,f)}uploadSubscriberStats(w){var O,B;const V={audio:{},video:{},candidateStats:{}},Y=new Map,se=(Date.now()-this.connectionStartedTimestamp)/1e3,me=(O=this.jitterBufferMinDelayInMs)!==null&&O!==void 0?O:0,{seiReadCnt:S,seiBytesRead:f}=this.updateAndDiffSeiSubscribeStatsSinceLastUpdate((B=this.receiveVideoTransformer)===null||B===void 0?void 0:B.getReceiverStats());this.seiStats.seiReadCnt+=S,this.seiStats.seiBytesRead+=f,w.forEach((_=>{if(_.type==="inbound-rtp")switch(_.kind){case"audio":V.audio=this.updateInboundAudio(_),V.audio.codec=Y.get(_.codecId),this.updateNetworkQualitySubscribe(this.audioNetworkQualityMap,V.audio.inbound,V.audio.prevInbound);break;case"video":V.video=this.updateInboundVideo(_),V.video.codec=Y.get(_.codecId),this.updateNetworkQualitySubscribe(this.vidNetworkQualityMap,V.video.inbound,V.video.prevInbound)}_.type==="candidate-pair"&&_.nominated&&(V.candidateStats.candidatePair=_,V.candidateStats.localCandidate=w.get(_.localCandidateId),V.candidateStats.remoteCandidate=w.get(_.remoteCandidate)),_.type==="codec"&&Y.set(_.id,_)})),this.analyticsTracker.trackEventNoSharedProps(new gc(this.token,this.traceId,this.identifier,this.sfuResource,V.audio.inbound,V.candidateStats,V.audio.codec,se,this.sdpFeatures)),V.audio.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new jg(this.token,this.traceId,this.identifier,this.sfuResource,V.audio.inbound,V.audio.prevInbound,V.candidateStats,V.audio.codec,this.sdpFeatures,me)),this.analyticsTracker.trackEventNoSharedProps(new Io(this.token,this.traceId,this.identifier,this.sfuResource,V.video.inbound,V.candidateStats,V.video.codec,se)),V.video.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new Pl(this.token,this.traceId,this.identifier,this.sfuResource,V.video.inbound,V.video.prevInbound,V.candidateStats,V.video.codec,me,this.seiStats.seiReadCnt,this.seiStats.seiBytesRead))}updateAndDiffSeiSubscribeStatsSinceLastUpdate(w){const O=this.prevVideoReceiverTransformerStats;if(!w)return{seiReadCnt:O.seiReadCnt,seiBytesRead:O.seiBytesRead};const B=w.seiReadCnt-O.seiReadCnt,V=w.seiBytesRead-O.seiBytesRead;return this.prevVideoReceiverTransformerStats={seiReadCnt:w.seiReadCnt,seiBytesRead:w.seiBytesRead},{seiReadCnt:B,seiBytesRead:V}}updateAndDiffSeiPublishStatsSinceLastUpdate(w){const O=this.prevVideoSenderTransformerStats;if(!w)return{seiWriteCnt:O.seiWriteCnt,seiBytesWritten:O.seiBytesWritten};const B=w.seiWriteCnt-O.seiWriteCnt,V=w.seiBytesWritten-O.seiBytesWritten;return this.prevVideoSenderTransformerStats={seiWriteCnt:w.seiWriteCnt,seiBytesWritten:w.seiBytesWritten},{seiWriteCnt:B,seiBytesWritten:V}}updateOutboundAudio(w){const O=w,B=this.prevOutboundAudioStats,V=w.id===B?.id?B:void 0;return this.prevOutboundAudioStats=w,{outbound:O,prevOutbound:V}}updateInboundAudio(w){const O=w,B=this.prevInboundAudioStats,V=w.id===B?.id?B:void 0;return this.prevInboundAudioStats=w,{inbound:O,prevInbound:V}}updateInboundVideo(w){const O=w,B=this.prevInboundVideoStats.get(Te),V=w.id===B?.id?B:void 0;return this.prevInboundVideoStats.set(Te,w),{inbound:O,prevInbound:V}}updateOutboundVideo(w){const O=w,B=this.getPrevOutboundVideo(w),V=w.id===B?.id?B:void 0;return this.setPrevVideoStat(w),{outbound:O,prevOutbound:V}}getPrevOutboundVideo(w){return this.simulcastEnabled&&w.rid&&this.prevOutboundVideoStats.has(w.rid)?this.prevOutboundVideoStats.get(w.rid):!this.simulcastEnabled&&this.prevOutboundVideoStats.has(Te)?this.prevOutboundVideoStats.get(Te):void 0}setPrevVideoStat(w){this.simulcastEnabled&&w.rid?this.prevOutboundVideoStats.set(w.rid,w):this.simulcastEnabled||this.prevOutboundVideoStats.set(Te,w)}convertLostRatioToQuality(w){return w<=0?vo.EXCELLENT:w<=.01?vo.GOOD:w<=.03?vo.NORMAL:w<=.1?vo.POOR:vo.DOWN}}class S_ extends $n{constructor(w,O,B,V,Y){super(kn.MINUTE,w,O,!1),Object.assign(this.properties,{action:V?Tn.PUBLISH:Tn.SUBSCRIBE,is_publishing:V,minutes_logged:B,subscribed_number:Y})}}class x_ extends $n{constructor(w){super(kn.PUBLISH,w.token,w.traceId,!1),Object.assign(this.properties,{action:Tn.PUBLISH,remote_participant_id:w.token.participantID})}}class T_ extends $n{constructor(w){super(kn.UNPUBLISH,w.token,w.traceId,!0),Object.assign(this.properties,{action:Tn.PUBLISH,remote_participant_id:w.token.participantID})}}class Tb extends $n{constructor(w){var O,B,V,Y;super(kn.SUBSCRIBE,w.token,w.traceId,!1),Object.assign(this.properties,{action:Tn.SUBSCRIBE,remote_participant_id:w.subscribedId,subscribed_id:w.subscribedId,is_edp_connected:w.isEdpConnected,is_reassignment:w.isReassignment,node:(B=(O=w.preAttemptSfuResource)===null||O===void 0?void 0:O.node)!==null&&B!==void 0?B:"",cluster:(Y=(V=w.preAttemptSfuResource)===null||V===void 0?void 0:V.cluster)!==null&&Y!==void 0?Y:""})}}class wb extends $n{constructor(w){super(kn.UNSUBSCRIBE,w.token,w.traceId,!0),Object.assign(this.properties,{action:Tn.SUBSCRIBE,remote_participant_id:w.unsubscribedId,unsubscribed_id:w.unsubscribedId})}}class w_ extends $n{constructor(w){var O,B,V,Y;super(kn.PUBLISH_STARTED,w.token,w.traceId,!1),Object.assign(this.properties,{action:Tn.PUBLISH,options_duration:w.optionsDuration,post_duration:w.postDuration,remote_participant_id:w.token.participantID,time_to_candidate:w.timeToCandidate,total_duration:w.totalDuration,edp_initial_connect_duration:w.edpInitialConnectDuration,edp_initial_connect_retry_times:w.edpInitialConnectRetries,edp_initial_state_duration:w.edpInitialStateDuration,edp_state_update_count:w.edpStateUpdateCount,sdp_exchange_duration:w.sdpExchangeDuration,sdp_exchange_transport:w.sdpExchangeTransport,set_remote_desc_duration:w.setRemoteDescDuration,peer_connection_duration:w.peerConnectionDuration,node:(B=(O=w.sfuResource)===null||O===void 0?void 0:O.node)!==null&&B!==void 0?B:"",cluster:(Y=(V=w.sfuResource)===null||V===void 0?void 0:V.cluster)!==null&&Y!==void 0?Y:"",publish_retry_times:w.publishRetries,total_duration_with_retries:w.totalDurationWithRetries,protocol:w.protocol})}}class $g extends $n{constructor(w){super(kn.PUBLISH_FAILED,w.token,w.traceId,!1),Object.assign(this.properties,{action:Tn.PUBLISH,code:w.code,message:w.message,fatal:w.fatal,nominal:w.nominal,protocol:w.protocol})}}class R_ extends $n{constructor(w){super(kn.PUBLISH_ENDED,w.token,w.traceId,!0),Object.assign(this.properties,{action:Tn.PUBLISH,remote_participant_id:w.token.participantID,unpublish_successful:w.isUnpublishSuccessful,reason:w.reason,protocol:w.protocol})}}class Rb extends $n{constructor(w){var O,B,V,Y;super(kn.SUBSCRIBE_STARTED,w.token,w.traceId,!1),Object.assign(this.properties,{action:Tn.SUBSCRIBE,options_duration:w.optionsDuration,post_duration:w.postDuration,remote_participant_id:w.remoteParticipantId,time_to_candidate:w.timeToCandidate,total_duration:w.totalDuration,edp_initial_connect_duration:w.edpInitialConnectDuration,edp_initial_connect_retry_times:w.edpInitialConnectRetries,edp_initial_state_duration:w.edpInitialStateDuration,edp_initial_state_publishing_count:w.edpInitialStatePublishingCount,edp_state_update_count:w.edpStateUpdateCount,sdp_exchange_duration:w.sdpExchangeDuration,sdp_exchange_transport:w.sdpExchangeTransport,set_remote_desc_duration:w.setRemoteDescDuration,peer_connection_duration:w.peerConnectionDuration,node:(B=(O=w.sfuResource)===null||O===void 0?void 0:O.node)!==null&&B!==void 0?B:"",cluster:(Y=(V=w.sfuResource)===null||V===void 0?void 0:V.cluster)!==null&&Y!==void 0?Y:"",total_duration_with_retries:w.totalDurationWithRetries,subscribe_retry_times:w.subscribeRetryTimes,is_reassignment:w.isReassignment,protocol:w.protocol})}}class Cb extends $n{constructor(w){super(kn.SUBSCRIBE_FAILED,w.token,w.traceId,!1),Object.assign(this.properties,{action:Tn.SUBSCRIBE,remote_participant_id:w.remoteParticipantId,code:w.code,message:w.message,fatal:w.fatal,nominal:w.nominal,is_reassignment:w.isReassignment,protocol:w.protocol})}}class C_ extends $n{constructor(w){super(kn.SUBSCRIBE_ENDED,w.token,w.traceId,!0),Object.assign(this.properties,{action:Tn.SUBSCRIBE,remote_participant_id:w.remoteParticipantId,unsubscribe_successful:w.isUnsubscribeSuccessful,reason:w.reason,protocol:w.protocol}),this.critical=!0}}class Ab extends $n{constructor(w){super(kn.STATE_UPDATED,w.token,w.traceId,!1),Object.assign(this.properties,{audio_muted:w.isAudioMuted,is_disconnected:w.isDisconnected,is_publishing:w.isPublishing,other_participant_id:w.otherParticipantId,other_participant_user_id:w.otherParticipantUserId,video_stopped:w.isVideoStopped})}}class Mb extends $n{constructor(w){var O,B,V,Y,se;super(kn.FIRST_FRAME,w.token,w.traceId,!1),Object.assign(this.properties,{action:Tn.SUBSCRIBE,remote_participant_id:w.remoteParticipantId,edp_initial_connect_duration:w.edpInitialConnectDuration,edp_initial_connect_retry_times:w.edpInitialConnectRetries,edp_initial_state_duration:w.edpInitialStateDuration,edp_initial_state_publishing_count:w.edpInitialStatePublishingCount,edp_state_update_count:w.edpStateUpdateCount,sdp_exchange_duration:w.sdpExchangeDuration,sdp_exchange_transport:w.sdpExchangeTransport,set_remote_desc_duration:w.setRemoteDescDuration,peer_connection_duration:w.peerConnectionDuration,node:(B=(O=w.sfuResource)===null||O===void 0?void 0:O.node)!==null&&B!==void 0?B:"",cluster:(Y=(V=w.sfuResource)===null||V===void 0?void 0:V.cluster)!==null&&Y!==void 0?Y:"",video_was_paused:w.videoWasPaused,first_frame_duration:w.firstFrameDuration,total_duration_with_retries:w.totalDurationWithRetries,subscribe_retry_times:w.subscribeRetryTimes,media_type:w.mediaType,configured_jitter_buffer_min_delay_ms:(se=w.currentJitterBufferMinDelayInMs)!==null&&se!==void 0?se:0,protocol:w.protocol})}}class ol extends $n{constructor(w){super(kn.EDP_PONG,w.token,w.traceId,!1),Object.assign(this.properties,{event_endpoint:w.eventEndpoint,protocol:w.protocol,edp_rtt:w.edpRttMs})}}class Tp extends $n{constructor(w){super(kn.JOIN,w.token,w.traceId,!1),Object.assign(this.properties,{action:Tn.JOIN,event_endpoint:w.eventEndpoint,whip_endpoint:w.whipEndpoint})}}class wp extends $n{constructor(w){super(kn.JOIN_ATTEMPT,w.token,w.traceId,!1),Object.assign(this.properties,{action:Tn.JOIN,event_endpoint:w.eventEndpoint,whip_endpoint:w.whipEndpoint})}}class ty extends $n{constructor(w){super(kn.JOIN_ATTEMPT_FAILED,w.token,w.traceId,!1),Object.assign(this.properties,{action:Tn.JOIN,event_endpoint:w.eventEndpoint,whip_endpoint:w.whipEndpoint,code:w.code,message:w.message,fatal:w.fatal,nominal:w.nominal,connect_retry_times:w.retryCnt})}}class ny extends $n{constructor(w){super(kn.EDP_DISCONNECTED,w.token,w.traceId,!1),Object.assign(this.properties,{event_endpoint:w.eventEndpoint,protocol:w.protocol}),this.critical=!0}}class ry extends $n{constructor(w){super(kn.EDP_CONNECTED,w.token,w.traceId,!1),Object.assign(this.properties,{event_endpoint:w.eventEndpoint,protocol:w.protocol,connect_retry_times:w.numRetries}),this.critical=!0}}class iy{constructor(w,O,B){this.token=w,this.analyticsTracker=B,this.protocol="",this.connecting=!1,this.closing=!1,this.windowUnloading=!1,this.maxConnectRetries=6,this.connectionAttempts=0,this.latestSequenceNumber=0,this.nextConnectionAttemptId=0,this.connectTimeoutId=0,this.latestPingTimestamp=0,this.pingIntervalId=0,this.pongTimeoutId=0,this.pingIntervalMs=15e3,this.pongTimeoutMs=3e4,this.attemptConnect=me=>{this.latestSequenceNumber=0,this.traceId=me||os(),this.connectionAttempts++,this.trackJoinAttempt(this.connectionAttempts);const{topic:S,rawToken:f}=this.token;this.connecting=!0,this.closing=!1;try{const _=encodeURIComponent(this.traceId.value),R=`topic=${S}/publishers`,U=`traceid=${_}`,ee="error_over_ws=1",ue=`${this.addr}?${ee}&${R}&${U}`;this.socket=this.createWebSocket(ue,f),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onopen=this.onOpen.bind(this),this.protocol=this.socket.protocol}catch(_){const R=_ instanceof Error?_.message:void 0,U=this.createError(Xt.EVENT_PLANE_WS_CREATE_FAILED,R);this.trackJoinFailed(U,this.getRetryCount()),this.emitter.emit(_s,U)}},this.triggerSocketOpen=me=>{this.clearConnectionAttemptTimeouts();const S=this.getRetryCount();this.connectionAttempts=0,this.connecting=!1,this.trackJoinStarted(S),this.emitter.emit(km,{retryCnt:S,traceId:this.traceId,initialStageState:me}),this.pingIntervalId=window.setInterval(this.ping,this.pingIntervalMs)},this.ping=()=>{var me;if(this.logger.debug({msg:`${this.id}sending PING`}),!this.isSocketOpen()){const S=`${this.id} attempting to ping an unopened socket`;return this.logger.warn({msg:S}),void this.traceJoinOp(S)}this.latestPingTimestamp=performance.now(),this.pongTimeoutId===0&&(this.pongTimeoutId=window.setTimeout(this.pongTimedOut,this.pongTimeoutMs)),(me=this.socket)===null||me===void 0||me.send(JSON.stringify({type:"PING"}))},this.pongTimedOut=()=>{if(!this.isSocketOpen()){const S=`${this.id} attempting pong timeout on an unopened socket`;return this.logger.warn({msg:S}),void this.traceJoinOp(S)}this.logger.debug({msg:`${this.id} Pong timed out!`}),this.clearPingPongTracking();const me=this.createError(Xt.EVENT_PLANE_PONG_TIMEOUT);this.emitter.emit(_s,me)},this.beforeUnload=()=>{this.emitter.emit(Qr,"beforeunload"),this.windowUnloading=!0},this.sendSdpOffer=(me,S,f,_,R,U,ee,ue)=>{var de;const be={type:"aws:ivs:SDP_OFFER",payload:{whipUrl:S,requestId:_,traceId:f,platform:"web",sdk:"1.27.0",whipVersion:qu,content:me,contentType:"application/sdp"}};R&&(be.payload.forceNode=R),U&&(be.payload.assignmentToken=U),ee&&(be.payload.multiCodec=ee);const Ce=od()===void 0,Oe=od()||Ce;ue&&Oe&&(be.payload.initialLayerPref=md(ue)),(de=this.socket)===null||de===void 0||de.send(JSON.stringify(be))},this.checkNonFatalRetriesLimit=me=>{if(me.fatal||this.connectionAttempts<=this.maxConnectRetries)return Pn.ok(!0);this.logger.debug({msg:`${this.id} maximum non-fatal retries of ${this.maxConnectRetries} exceeded`});const S=this.createError(Xt.JOIN_TIMED_OUT);return Pn.err(S)},this.getRetryCount=()=>Math.max(this.connectionAttempts-1,0),this.trackSocketError=me=>{this.connecting&&this.trackJoinFailed(me,this.getRetryCount()),this.analyticsTracker.trackError(me)},this.trackJoinEnded=()=>{this.analyticsTracker.trackEventNoSharedProps(new ny({token:this.token,eventEndpoint:this.token.eventsURL,traceId:this.traceId,protocol:this.protocol}))},this.traceJoinOp=me=>{this.analyticsTracker.trackEventNoSharedProps(new Ca(this.token,this.traceId,me,Tn.JOIN))},this.logger=new on(O,le.SOCKET),this.emitter=new Gr.EventEmitter,this.traceId=os(),this.id=`[${Hi().value}] `;const V=th("socketPingMs");V!==void 0&&(this.pingIntervalMs=V);const Y=th("socketPongMs");Y!==void 0&&(this.pongTimeoutMs=Y);const se=th("socketConnectMaxRetries");se!==void 0&&(this.maxConnectRetries=se),window.addEventListener("beforeunload",this.beforeUnload)}connect(w,O,B=!1){this.close(),this.logger.debug({msg:`${this.id}connecting to ${this.addr}`}),this.addr=w,this.traceId=O,B&&!this.connecting&&(window.clearTimeout(this.connectTimeoutId),this.connectTimeoutId=window.setTimeout(this.connectTimedOut.bind(this),12e3)),this.attemptConnect(O)}send(w){var O;this.logger.debug({msg:`${this.id}sending ${JSON.stringify(w)}`}),this.logger.debug({msg:`${this.id}isReady called`}),this.isSocketOpen()?(O=this.socket)===null||O===void 0||O.send(JSON.stringify(w)):this.logger.warn({msg:"Trying to send data over stage socket that is not ready"})}close(){this.logger.debug({msg:`${this.id}closing`});const w=this.connecting,O=this.isSocketOpen(),B=this.socket&&this.socket.readyState===this.socket.CLOSING,V=this.getRetryCount();if(this.markSocketAsClosed(),this.clearPingPongTracking(),this.clearConnectionAttemptTimeouts(),this.connectionAttempts=0,this.socket){if(this.cleanupWebSocket(),O&&this.isStateMessageReceived())this.trackJoinEnded(),this.emitter.emit(Qr,"intentional-close");else if(w&&!B){const Y=this.createError(Xt.OPERATION_ABORTED);this.trackJoinFailed(Y,V),this.analyticsTracker.trackError(Y),this.emitter.emit(_s,Y)}}}markSocketAsClosed(){this.closing=!0,this.connecting=!1}removeAllListeners(){window.removeEventListener("beforeunload",this.beforeUnload),this.emitter.removeAllListeners()}createWebSocket(w,O){return new WebSocket(w,O)}cleanupWebSocket(){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onopen=null,this.socket=void 0)}createError(w,O){return new gr(Object.assign({action:Tn.JOIN,traceId:this.traceId,token:this.token,location:"StageSocket.connection",tag:he,details:O},w))}on(w,O){this.emitter.on(w,O)}off(w,O){this.emitter.off(w,O)}onMessage(w){this.logger.debug({msg:`${this.id}received message: ${w.data}`});try{const O=JSON.parse(w.data);switch(O.type){case"STAGE_STATE":case"aws:ivs:STAGE_STATE":{const B=O.payload.sequenceNumber;B>this.latestSequenceNumber&&(this.latestSequenceNumber===0&&this.connectTimeoutId>0?(this.triggerSocketOpen(O),window.setTimeout((()=>{this.emitter.emit(fd,O)}))):this.emitter.emit(fd,O),this.latestSequenceNumber=B);break}case"PONG":window.clearTimeout(this.pongTimeoutId),this.pongTimeoutId=0,this.analyticsTracker.trackEventNoSharedProps(new ol({token:this.token,eventEndpoint:this.token.eventsURL,protocol:this.protocol,traceId:this.traceId,edpRttMs:performance.now()-this.latestPingTimestamp}));break;case"REFRESH":this.emitter.emit(Dg);break;case"aws:ivs:SDP_ANSWER":this.emitter.emit(Hu,O.payload);break;case"aws:ivs:DISCONNECT":this.emitter.emit(pc,O.payload);break;case"aws:ivs:REASSIGN":this.emitter.emit(wf,O.payload);break;case"aws:ivs:INCOMPATIBLE_CODECS":this.emitter.emit(wi,O.payload);break;case"aws:ivs:SSU":this.emitter.emit(hd,O.payload);break;case"aws:ivs:JOIN_ERROR":this.handleJoinError(O.payload);break;default:(0,ss.noop)()}}catch(O){this.logger.debug({msg:`onMessage JSON Parse error: ${O}`}),this.emitter.emit(ch,O)}}onError(w){this.logger.debug({msg:`${this.id}error: ${JSON.stringify(w)}`})}onClose(w){if(this.logger.debug({msg:`${this.id} onClose triggered with code (closing = ${this.closing}, connecting = ${this.connecting})`}),this.clearPingPongTracking(),this.closing)return void(this.closing=!1);if(this.windowUnloading)return;const O=`code: ${w?.code}, reason: ${w?.reason}, wasClean: ${w?.wasClean}`;if(this.connecting){const V=this.createError(Xt.EVENT_PLANE_WS_CLOSE_BEFORE_OPEN,O);return void this.handleSocketError(V)}this.logger.debug({msg:`${this.id}unexpected close`}),this.emitter.emit(Qr,"unknown");const B=this.createError(Xt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,O);this.trackJoinEnded(),this.emitter.emit(_s,B)}onOpen(){this.logger.debug({msg:`${this.id} socket opened`}),this.clearConnectionAttemptTimeouts(),this.connectTimeoutId=window.setTimeout(this.triggerSocketOpen,12e3)}clearConnectionAttemptTimeouts(){window.clearTimeout(this.nextConnectionAttemptId),window.clearTimeout(this.connectTimeoutId),this.nextConnectionAttemptId=0,this.connectTimeoutId=0}clearConnectionAttempts(){this.connectionAttempts=0}connectTimedOut(){this.connecting=!1,this.logger.debug({msg:`${this.id} Connect timed out!`});const w=this.createError(Xt.JOIN_TIMED_OUT);this.isSocketConnecting()&&this.trackJoinFailed(w,this.getRetryCount()),this.emitter.emit(_s,w),this.close()}clearPingPongTracking(){window.clearInterval(this.pingIntervalId),window.clearTimeout(this.pongTimeoutId),this.pingIntervalId=0,this.pongTimeoutId=0}handleJoinError(w){const O=(function(V){var Y,se;let me;switch(V.code){case ca.TOKEN_EXPIRED:me=Xt.EXPIRED_TOKEN;break;case ca.TOKEN_INVALID:case ca.TOKEN_INVALID_SIGNATURE:case ca.TOKEN_MISSING:me=Xt.MALFORMED_TOKEN;break;case ca.STAGE_DELETED:me=Xt.STAGE_DELETED;break;case ca.PARTICIPANT_DISCONNECTED:me=Xt.PARTICIPANT_DISCONNECTED;break;case ca.INTERNAL:me=Xt.JOIN_SERVER_INTERNAL_ERROR;break;case ca.BAD_REQUEST:me=Xt.JOIN_SERVER_BAD_REQUEST;break;default:me=Object.assign(Object.assign({},Xt.JOIN_FAILURE),{message:V.message||Xt.JOIN_FAILURE.message})}return Object.assign(Object.assign({},me),{fatal:(Y=V.fatal)!==null&&Y!==void 0?Y:me.fatal,nominal:(se=V.nominal)!==null&&se!==void 0?se:me.nominal})})(w),B=this.createError(O,`JOIN_ERROR: ${w.code}`);this.logger.debug({msg:`${this.id} received JOIN_ERROR: ${JSON.stringify(w)}`}),this.handleSocketError(B)}handleSocketError(w){const O=this.checkNonFatalRetriesLimit(w);let B=w;O.ok||(B=O.error,B.details=`Timeout triggered by ${w.code}`),this.trackSocketError(B),this.markSocketAsClosed(),this.clearPingPongTracking(),this.clearConnectionAttemptTimeouts(),this.cleanupWebSocket(),B.fatal?(this.clearConnectionAttempts(),this.emitter.emit(_s,B)):this.queueExponentialBackoffRetry()}queueExponentialBackoffRetry(){let w=Math.pow(2,this.connectionAttempts-1);w>32&&(w=32),this.logger.debug({msg:`${this.id} reconnecting in ${w} seconds`}),window.clearTimeout(this.nextConnectionAttemptId),this.nextConnectionAttemptId=window.setTimeout(this.attemptConnect,1e3*w)}isSocketConnecting(){return this.socket&&this.socket.readyState===this.socket.CONNECTING}isSocketOpen(){return this.socket&&this.socket.readyState===this.socket.OPEN}isStateMessageReceived(){return this.latestSequenceNumber!==0}trackJoinStarted(w){this.analyticsTracker.trackEventNoSharedProps(new ry({token:this.token,eventEndpoint:this.token.eventsURL,numRetries:w,protocol:this.protocol,traceId:this.traceId}))}trackJoinAttempt(w){const{token:O,traceId:B}=this;this.analyticsTracker.trackEvent(new wp({token:O,eventEndpoint:O?.eventsURL||"",whipEndpoint:O?.whipURL||"",traceId:B}))}trackJoinFailed(w,O){const{token:B,traceId:V,code:Y,message:se,fatal:me,nominal:S}=w;this.analyticsTracker.trackEvent(new ty({token:B,eventEndpoint:B.eventsURL,whipEndpoint:B.whipURL,traceId:V,code:Y,message:se,fatal:me,nominal:S,retryCnt:O}))}}var Wm=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))},Rp,jc,Bl,qi;(function(L){L.SDP_EXCHANGE="xdp",L.JITTER_BUFFER_MIN_DELAY_MS="jit_buf_min_delay_ms"})(Rp||(Rp={})),(function(L){L.USER_INITIATED="user-initiated",L.CLIENT_RECONNECT="reconnect",L.TOKEN_REUSED="token-reused",L.UNKNOWN="unknown",L.PARTICIPANT_DISCONNECTED="participant-disconnected",L.STAGE_DELETED="stage-deleted",L.TOKEN_EXPIRED="token-expired"})(jc||(jc={})),(function(L){L[L.NOT_CONNECTED=0]="NOT_CONNECTED",L[L.CONNECTION_LOST=1]="CONNECTION_LOST",L[L.TIMEDOUT=2]="TIMEDOUT",L[L.ABORTED=3]="ABORTED",L[L.INVALID_MESSAGE=4]="INVALID_MESSAGE",L[L.UNEXPECTED_ERROR=5]="UNEXPECTED_ERROR"})(Bl||(Bl={})),(function(L){L.DISCONNECTED="disconnected",L.CONNECTING="connecting",L.CONNECTED="connected",L.ERRORED="errored"})(qi||(qi={}));class Km extends Zc{constructor(w,O,B){super(),this.token=w,this.nonScopedLogger=O,this.analyticsTracker=B,this.participants=new Map,this.disconnected=[],this.state={value:qi.DISCONNECTED,context:{connectStartTime:0,hasConnected:!1}},this.features={sdpExchange:!1},this.stats=this.resetStats(),this.stageMinutesLogged=0,this.isStagePublishing=!1,this.onConnecting=(V,Y)=>{this.logger.debug({msg:"onConnecting",context:V,event:Y}),V.connectStartTime=performance.now();const se=Y.type==="RECONNECT";se&&this.stageSocket.close();const{eventsURL:me}=this.token;this.emit(cp,qi.CONNECTING),this.state.value=qi.CONNECTING;const S=!se;this.stageSocket.connect(me,this.traceId,S)},this.onConnected=(V,Y)=>{this.logger.debug({msg:"onConnected",context:V,event:Y}),V.hasConnected=!0,this.emit(Pg),this.emit(cp,qi.CONNECTED),this.state.value=qi.CONNECTED},this.onDisconnected=(V,Y)=>{this.logger.debug({msg:"onDisconnected",context:V}),this.state.value=qi.DISCONNECTED,this.stopStageMinuteLoggedInterval(!0),this.stageSocket.close(),V.hasConnected=!1,this.participants=new Map,this.disconnected=[],this.stageSocket.removeAllListeners(),this.resetStats(),this.emit(cp,qi.DISCONNECTED,Y)},this.onErrored=(V,Y)=>{var se;this.logger.error({msg:"Connection failure occurred",err:Y.payload.error}),this.emit(cp,qi.ERRORED),this.emit(la,Y.payload.error),this.state.value=qi.ERRORED;const me=Y.payload.error;if(me instanceof gr&&me.fatal&&(!((se=me.details)===null||se===void 0)&&se.includes("JOIN_ERROR"))&&V.hasConnected){const S=this.mapJoinErrorCodeToDisconnectReason(me);this.processStateUpdate({type:"DISCONNECT",reason:S})}else V.hasConnected?this.processStateUpdate({type:"RECONNECT"}):this.stageSocket.close()},this.processStateUpdate=V=>{const Y=this.state.value,se=this.state.context;switch(Y){case qi.DISCONNECTED:V.type==="CONNECT"&&this.onConnecting(se,V);break;case qi.CONNECTING:V.type==="RECONNECT"?this.onConnecting(se,V):V.type==="DISCONNECT"?this.onDisconnected(se,V.reason):V.type==="CONNECT_SUCCESS"?this.onConnected(se,V):V.type==="ERROR"&&this.onErrored(se,V);break;case qi.CONNECTED:V.type==="RECONNECT"?this.onConnecting(se,V):V.type==="DISCONNECT"?this.onDisconnected(se,V.reason):V.type==="ERROR"&&this.onErrored(se,V);break;case qi.ERRORED:V.type==="RECONNECT"?this.onConnecting(se,V):V.type==="DISCONNECT"&&this.onDisconnected(se,V.reason)}},this.measureConnect=(V,Y)=>{const se=this.stats.edpConnectCount,me=se+1,S=performance.now(),f=S-Y;return Object.assign(this.stats,{edpConnectCount:me,edpConnectDuration:f}),se===0&&Object.assign(this.stats,{edpInitialStartConnectTime:Y,edpInitialFinishConnectTime:S,edpInitialConnectDuration:f,edpInitialConnectRetries:V}),this.stats},this.measureStateUpdate=V=>{const{edpInitialFinishConnectTime:Y}=this.stats,se=this.stats.edpStateUpdateCount,me=se+1;return Object.assign(this.stats,{edpStateUpdateCount:me}),se===0&&Object.assign(this.stats,{edpInitialStateDuration:performance.now()-Y,edpInitialStatePublishingCount:V}),this.stats},this.trackMessageParseError=V=>{this.logger.error({msg:"Message Parse Error occurred",err:V.err});const Y=new gr({token:V.token,traceId:V.traceId,code:Xt.WEBSOCKET_MESSAGE_PARSE_FAILURE.code,tag:V.tag,location:V.location,message:V.message,details:V.err.message});this.analyticsTracker.trackEvent(new Zi(Y))},this.trackStageSocketMessageParseError=(V,Y,se)=>{this.trackMessageParseError({token:V,traceId:Y,tag:he,location:"StageConnection.onMessage",message:Xt.WEBSOCKET_MESSAGE_PARSE_FAILURE.message,err:se})},this.trackStageStateMessageParseError=(V,Y,se,me)=>{this.trackMessageParseError({token:V,traceId:Y,tag:he,location:"StageConnection.onStageStateMessage",message:me,err:se})},this.onDisconnectMessage=V=>{this.analyticsTracker.trackEventNoSharedProps(new Ca(this.token,this.traceId,`DISCONNECT message received: ${V.code}:${V.reason}`,Tn.JOIN));let Y=jc.UNKNOWN;if(V.code==="PARTICIPANT_DISCONNECTED")Y=jc.PARTICIPANT_DISCONNECTED;else if(V.code==="STAGE_DELETED")Y=jc.STAGE_DELETED;else if(V.code==="TOKEN_REUSED"&&(Y=jc.TOKEN_REUSED,Rs("disableTokenReuseMessage")))return void console.warn("Token reuse is detected, but skipping as feature is disabled");console.warn(`Disconnecting client due to: ${V.reason}`),this.processStateUpdate({type:"DISCONNECT",reason:Y})},this.onReassignmentMessage=V=>{this.emit(Wo,V)},this.onIncompatibleCodecsMessage=V=>{this.emit(ah,V)},this.onSsuMessage=V=>{var Y;const se=window.atob((Y=V.A)!==null&&Y!==void 0?Y:"").trim();se&&se.startsWith("http")?Oc.currentEndpoint=se:this.logger.warn({msg:"SSU Url invalid"})},this.onStageStateMessage=(V,Y,se)=>{var me,S;this.logger.debug({msg:"State Stage Message occurred",state:se});const f=se.payload,_=(me=f.participants)!==null&&me!==void 0?me:[],R=(S=f.disconnected)!==null&&S!==void 0?S:[],U=[],ee=[];this.measureStateUpdate(_.length),this.enableFeaturesBasedOnServerFeatures(f.serverFeatures||[]);const ue=(de,be)=>{this.analyticsTracker.trackEventNoSharedProps(new Ab({token:V,otherParticipantId:de.id,otherParticipantUserId:de.userId,isAudioMuted:de.audioMuted,isVideoStopped:de.videoStopped,isPublishing:de.isPublishing,isDisconnected:be,traceId:Y}))};this.participants.forEach((de=>{const be=_.find((Ce=>Ce.id===de.id));if(be){let Ce=!0,Oe=!1;["isPublishing","id","audioMuted","joinedAt","userId","videoStopped"].forEach((Fe=>{Ce=Ce&&be[Fe.toString()]===de[Fe.toString()],Ce||(de[Fe.toString()]=be[Fe.toString()],Oe=!0)})),Object.keys(de.attributes).forEach((Fe=>{Ce=Ce&&be.attributes[Fe]===de.attributes[Fe],Ce||(de.attributes=be.attributes,Oe=!0)})),Oe&&(ue(de,!1),this.emit(xf,be))}else ee.push(de)})),_.forEach((de=>{this.participants.get(de.id)||U.push(de)})),ee.forEach((de=>{this.participants.delete(de.id),ue(de,!0),this.emit(ap,de)})),U.forEach((de=>{this.participants.set(de.id,de),ue(de,!1),this.emit(oh,de)})),R.forEach((de=>{this.disconnected.find((be=>be.id===de.id))||(this.disconnected.push(de),de.status==="KICKED"&&this.emit(Am,de))})),this.disconnected=R},this.nonScopedLogger=O,this.logger=new on(O,le.CONNECTION),this.stageSocket=new iy(w,this.nonScopedLogger,B),this.token=w,this.traceId=os()}resetStats(){return this.stats={isConnected:!1,edpInitialStartConnectTime:0,edpInitialFinishConnectTime:0,edpConnectCount:0,edpInitialConnectDuration:0,edpConnectDuration:0,edpInitialStateDuration:0,edpInitialStatePublishingCount:0,edpStateUpdateCount:0,edpInitialConnectRetries:0},this.stats}connect(w){return Wm(this,void 0,void 0,(function*(){return this.logger.debug({msg:"connect invoked",token:this.token,traceId:w}),this.traceId=w,this.state.value!==qi.DISCONNECTED&&(this.logger.debug({msg:"Disconnecting previous connection"}),this.processStateUpdate({type:"DISCONNECT",reason:jc.CLIENT_RECONNECT})),new Promise(((O,B)=>{this.stageSocket.on(km,(V=>{var Y,se;const{retryCnt:me,initialStageState:S}=V;S&&this.enableFeaturesBasedOnServerFeatures((se=(Y=S.payload)===null||Y===void 0?void 0:Y.serverFeatures)!==null&&se!==void 0?se:[]),this.traceId=V.traceId||os(),this.measureConnect(me,this.state.context.connectStartTime),this.processStateUpdate({type:"CONNECT_SUCCESS"}),this.startStageMinuteLoggedInterval(this.token,this.traceId),O(this.traceId)})),this.stageSocket.on(_s,(V=>{B(V),this.processStateUpdate({type:"ERROR",payload:{error:V}})})),this.stageSocket.on(Dg,(()=>{this.logger.debug({msg:"Refresh event occurred"}),this.emit($o),this.processStateUpdate({type:"RECONNECT"})})),this.stageSocket.on(fd,(V=>this.onStageStateMessage(this.token,this.traceId,V))),this.stageSocket.on(ch,(V=>this.trackStageSocketMessageParseError(this.token,this.traceId,V))),this.stageSocket.on(pc,this.onDisconnectMessage),this.stageSocket.on(wf,this.onReassignmentMessage),this.stageSocket.on(wi,this.onIncompatibleCodecsMessage),this.stageSocket.on(hd,this.onSsuMessage),this.stageSocket.on(Qr,(V=>{this.stopStageMinuteLoggedInterval()})),this.processStateUpdate({type:"CONNECT",payload:{token:this.token,traceId:w}})}))}))}disconnect(){return this.logger.debug({msg:"disconnect invoked"}),this.processStateUpdate({type:"DISCONNECT",reason:jc.USER_INITIATED}),this.traceId}getParticipant(w){return this.participants.get(w)}listConnectedParticipants(){const w=[];return this.participants.forEach((O=>{O.subscribed&&w.push(O)})),w}listAvailableParticipants(){return Array.from(this.participants.values())}emitStageState(w,O){this.stageSocket.send({audioMuted:w,type:"SET_STATE",version:"0",videoStopped:O})}setStagePublishing(w){this.isStagePublishing=w,this.emit(el,this.isStagePublishing)}getIsStagePublishing(){return this.isStagePublishing}startStageMinuteLoggedInterval(w,O){this.uploadStageMinutesBroadcastInterval||(this.analyticsTracker.trackEvent(new S_(w,O,this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++,this.uploadStageMinutesBroadcastInterval=setInterval((()=>{this.analyticsTracker.trackEvent(new S_(w,O??os(),this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++}),6e4))}stopStageMinuteLoggedInterval(w=!1){this.uploadStageMinutesBroadcastInterval&&(clearInterval(this.uploadStageMinutesBroadcastInterval),this.uploadStageMinutesBroadcastInterval=void 0),w&&(this.stageMinutesLogged=0)}enableFeaturesBasedOnServerFeatures(w){const O=(se,me)=>{this.trackStageStateMessageParseError(this.token,this.traceId,me,`Could not parse "${se}" from the Eevee server features list`)},B=w.includes(Rp.SDP_EXCHANGE);this.features.sdpExchange!==B&&(this.logger.debug({msg:`XDP SDP exchange feature toggled: ${B}`}),this.features.sdpExchange=B);const V=w.find((se=>se.indexOf(Rp.JITTER_BUFFER_MIN_DELAY_MS)!==-1)),Y=se=>{this.logger.debug({msg:`jitterBufferMinDelay feature updated to: ${se}`}),this.features.jitterBufferMinDelayInMs=se};if(V!==void 0)try{const se=V.split("=")[1],me=parseInt(se,10);if(isNaN(me))throw new Error("Unable to parse - result is NaN");if(me<0)throw new Error("Unable to apply - result is negative");this.features.jitterBufferMinDelayInMs!==void 0&&this.features.jitterBufferMinDelayInMs===me||Y(me)}catch(se){O(V,se),Y(void 0)}else Y(void 0)}mapJoinErrorCodeToDisconnectReason(w){switch(w.code){case Xt.PARTICIPANT_DISCONNECTED.code:return jc.PARTICIPANT_DISCONNECTED;case Xt.STAGE_DELETED.code:return jc.STAGE_DELETED;case Xt.EXPIRED_TOKEN.code:return jc.TOKEN_EXPIRED;default:return jc.UNKNOWN}}isConnected(){return this.state.value===qi.CONNECTED}supportsSdpExchange(){return this.features.sdpExchange}jitterBufferMinDelayInMs(){return this.features.jitterBufferMinDelayInMs}getConnectionStats(){return Object.assign({},this.stats,{isConnected:this.isConnected()})}exchangeSdp(w,O,B,V,Y,se,me,S,f){return Wm(this,void 0,void 0,(function*(){return this.isConnected()?new Promise(((_,R)=>{const U=window.setTimeout((()=>{ee(),R(Bl.TIMEDOUT)}),12e3),ee=()=>{window.clearTimeout(U),this.stageSocket.off(Hu,ue),this.stageSocket.off(_s,de)},ue=be=>{be.requestId===V&&(ee(),_(be))},de=()=>{ee(),R(Bl.CONNECTION_LOST)};Y?.addEventListener("abort",(()=>{ee(),R(Bl.ABORTED)})),this.stageSocket.on(Hu,ue),this.stageSocket.on(_s,de),this.stageSocket.sendSdpOffer(w,O,B,V,se,me,S,f)})):Promise.reject(Bl.NOT_CONNECTED)}))}}class sy{constructor(w){this.token=w}}const Xo=new RegExp("^(?:[a-z+]+:)?//","i");function Sd(L){return Xo.test(L)}function Wg({sdpExchangeTransport:L,serverHttpResponse:w,serverErrorCode:O}){return`sdpExchangeTransport: ${L}, serverHttpResponse: ${w}, serverErrorCode: ${O}`}var Kg=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};const Xg={[Bl.ABORTED]:Xt.OPERATION_ABORTED,[Bl.NOT_CONNECTED]:Xt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,[Bl.CONNECTION_LOST]:Xt.XDP_CONNECTION_LOST,[Bl.TIMEDOUT]:Xt.XDP_TIMEOUT,[Bl.INVALID_MESSAGE]:Xt.XDP_INVALID_ANSWER_MSG,[Bl.UNEXPECTED_ERROR]:Xt.XDP_UNEXPECTED_ERROR};class Yg extends sy{constructor(w,O,B,V){super(w),this.token=w,this.stageConnection=O,this.contextData=B,this.analyticsTracker=V}exchange(w){return Kg(this,void 0,void 0,(function*(){const O=Hi(),{action:B}=this.contextData,{sdpOffer:V,url:Y,traceId:se,forceNode:me,assignmentToken:S,multiCodec:f,abortController:_,initialLayerPreference:R}=w;let U;this.trackAttempt(Y,O,se);try{U=yield this.stageConnection.exchangeSdp(V,Y,se.value,O.value,_?.signal,me,S,f,R)}catch(ot){if(typeof ot=="number")throw this.createClientSideErrorFromReasonCode(ot,se,O,B)}if(!U)return;const{httpStatusCode:ee,errorCode:ue,location:de,content:be,sessionDeleteLink:Ce,subscriberControlLink:Oe,videoLayersLink:Fe}=U;if(ee>=200&&ee<300)return{sdpAnswer:be,url:Y,location:de,sessionDeleteLink:Ce,mediaControls:Oe,layerControls:Fe};throw this.createServerSideError(se,O,ee,ue,B)}))}trackAttempt(w,O,B){const{remoteParticipantId:V,action:Y}=this.contextData;this.analyticsTracker.trackEventNoSharedProps(new ei(Y,this.token,w,"POST",O.value,V,B,"xdp"))}createServerSideError(w,O,B,V,Y){const se=this.baseErrorProps(w,O);let me=Go(B,V);return me||(me=Xt.UNKNOWN_SERVER_ERROR),new gr(Object.assign(Object.assign(Object.assign({action:Y},se),me),{details:Wg({sdpExchangeTransport:"xdp",serverHttpResponse:B,serverErrorCode:V})}))}baseErrorProps(w,O){const{remoteParticipantId:B,action:V}=this.contextData;return{token:this.token,traceId:w,tag:vn(V,B),location:"EdpSdpExchanger.exchange",requestUUID:O,remoteParticipantId:B}}createClientSideErrorFromReasonCode(w,O,B,V){const Y=this.baseErrorProps(O,B),se=Xg[w];return new gr(se?Object.assign(Object.assign({action:V},Y),se):Object.assign(Object.assign({action:V},Y),Xt.XDP_INVALID_ANSWER_MSG))}getTransport(){return"sdp"}}var Zg=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};class Cp extends sy{constructor(w,O,B){super(w),this.contextData=O,this.analyticsTracker=B}exchange(w){var O,B,V;return Zg(this,void 0,void 0,(function*(){const Y=Hi(),{token:se}=this,{action:me,remoteParticipantId:S}=this.contextData,{sdpOffer:f,url:_,traceId:R,forceNode:U,assignmentToken:ee,multiCodec:ue,abortController:de,initialLayerPreference:be}=w;try{const Oe="POST",Fe="http";this.analyticsTracker.trackEventNoSharedProps(new ei(me,se,_,Oe,Y.value,S,R,Fe));const ot={data:f,headers:{Authorization:`Bearer ${se.rawToken}`,"Content-Type":"application/sdp","X-Stages-Platform":"web","X-Stages-Request-ID":Y.value,"X-Stages-SDK":"1.27.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":R.value,"X-Stages-WHIP-Version":qu,[fc]:(Ce=JSON.stringify({[Qc]:["sau"]}),btoa(Ce).replace(/[^A-Za-z0-9+/]/g,""))},method:Oe,responseType:"text",url:_,signal:de?.signal,params:{}};U&&(ot.params.force_node=U),ee&&(ot.params.assignment_token=ee),ue&&(ot.params.multi_codec=!0);const _t=od()===void 0,Tt=od()||_t;be&&ot.headers&&Tt&&(ot.headers["X-Stages-Initial-Layer-Pref"]=md(be));const{data:ht,headers:st,request:xt}=yield d_(ot),mt=this.parseWhipResource(_,st.location,st.link);return{url:xt.responseURL,sdpAnswer:ht,location:mt?.location,sessionDeleteLink:mt?.sessionDeleteLink,mediaControls:mt?.mediaControls,layerControls:mt?.layerControls}}catch(Oe){if(hc().isCancel(Oe))throw new gr(Object.assign(Object.assign({},Mo(Xt.OPERATION_ABORTED,Oe)),{action:me,token:se,traceId:R,tag:vn(me,S),location:"StagePeerClient.start",requestUUID:Y,remoteParticipantId:S}));const Fe=Number((O=Oe?.response)===null||O===void 0?void 0:O.status)||-1,ot=((V=(B=Oe?.response)===null||B===void 0?void 0:B.data)===null||V===void 0?void 0:V.code)||-1,_t=(function(Tt,ht){var st;return Tt instanceof Vo.AxiosError&&Tt.response&&typeof Tt.response.status=="number"?Tt instanceof Vo.AxiosError&&Tt.code==="ERR_NETWORK"?Xt.NETWORK_FAILURE:Go(Number(Tt.response.status),(st=Tt.response.data)===null||st===void 0?void 0:st.code)||ht:ht})(Oe,Xt.WHIP_POST_FAILURE);throw new gr(Object.assign(Object.assign({},Mo(_t,Oe)),{action:me,token:se,traceId:R,tag:vn(me,S),details:Wg({sdpExchangeTransport:"http",serverHttpResponse:Fe,serverErrorCode:ot}),location:"StagePeerClient.start",requestUUID:Y,remoteParticipantId:S}))}var Ce}))}parseWhipResource(w,O,B){const V=new URL(w);let Y;return Y=(function(se,me,S){if(!S)return se;if(se||(se={}),Sd(S))return se.location=S,se;const f=me.port?`:${me.port}`:"";return se.location=`${me.protocol}//${me.hostname}${f}${S}`,se})(Y,V,O),Y=(function(se,me,S){if(!S)return se;se||(se={});const f=se;return S.split(",").forEach((_=>{const R=/<(.+)>;\s?rel="([a-z:-]+)"/.exec(_);if(R?.length!==3)return;let U;if(Sd(R[1]))U=R[1];else{const ee=me.port?`:${me.port}`:"";U=`${me.protocol}//${me.hostname}${ee}${R[1]}`}switch(R[2]){case"urn:ietf:params:whip:ivs-stages:session-delete":f.sessionDeleteLink=U;break;case"urn:ietf:params:whep:core:playback-controls":f.mediaControls=U;break;case"urn:ietf:params:whep:ext:core:layer":f.layerControls=U;break;default:return}})),f})(Y,V,B),Y}getTransport(){return"http"}}function Mf(L){const{connection:w,token:O,action:B,identifier:V,tracker:Y}=L,se=w&&w.supportsSdpExchange()&&w.isConnected(),me=B===Tn.SUBSCRIBE&&se&&!np()&&!Rs("disableXdpSubscribe"),S=B===Tn.PUBLISH&&se&&!np()&&!Rs("disableXdpPublish");return me||S?new Yg(O,w,{action:B,remoteParticipantId:V},Y):new Cp(O,{action:B,remoteParticipantId:V},Y)}function Eo({stageErrorValue:L,action:w,token:O,traceId:B,tag:V,identifier:Y,details:se}){return new gr(Object.assign(Object.assign({},L),{token:O,traceId:B,location:"peer-client",tag:V,action:w,remoteParticipantId:Y,details:se}))}var Yo;function Jg(L){var w;return!((w=L?.sender)===null||w===void 0)&&w.createEncodedStreams?Yo.INSERTABLE_STREAMS:window.RTCRtpSender&&"transform"in RTCRtpSender.prototype&&window.RTCRtpScriptTransform?Yo.ENCODED_TRANSFORMS:Yo.NONE}function ph(L){var w;return!((w=L?.receiver)===null||w===void 0)&&w.createEncodedStreams?Yo.INSERTABLE_STREAMS:window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&window.RTCRtpScriptTransform?Yo.ENCODED_TRANSFORMS:Yo.NONE}function Xm(){return uc()(`/*! For license information please see transform.worker.worker.js.LICENSE.txt */
(()=>{"use strict";const e=new Uint8Array([158,80,78,165,238,90,79,2,148,159,176,51,163,118,141,162]);var t;!function(e){e.VIDEO_SEND="video/send",e.VIDEO_RECEIVE="video/receive",e.INSERT_SEI="insertSei"}(t||(t={}));function n(t,n){const{transformerId:s,type:r,payloads:a}=n;let o=[];if("sei"===n.type){const{value:n,messages:s}=function(t,n){function s(e,t,n){return n+t.length<=e.byteLength&&t.every(((t,s)=>e.getUint8(n+s)===t))}function r(e,t){const n=function(e,t){return new Uint8Array([0,0,1,6,5,...t,...e])}(e,function(e){const t=[];for(;e>=255;)t.push(255),e-=255;return t.push(e),new Uint8Array(t)}(t.length+e.length)),s=function(e){const t=[...e];let n=3;for(;n<t.length-2;)0!==t[n]||0!==t[n+1]||0!==t[n+2]&&1!==t[n+2]&&2!==t[n+2]&&3!==t[n+2]?n+=1:(t.splice(n+2,0,3),n+=3);return t}(new Uint8Array([...n,...t,128]));return new Uint8Array(s)}function a(e,n){const r=function(e){const t=new DataView(e);for(let e=0;e<t.byteLength-4;e++)if(s(t,[0,0,1],e)){const n=31&t.getUint8(e+3);if(n>=1&&n<=5)return e}return-1}(t.data);if(r>=0){const e=new ArrayBuffer(t.data.byteLength+n.byteLength),s=new Uint8Array(e);return s.set(new Uint8Array(t.data.slice(0,r)),0),s.set(n,r),s.set(new Uint8Array(t.data.slice(r)),r+n.byteLength),e}return e}return function(){const s=[];for(let o=0;o<n.length;o+=1){const i=r(e,new Uint8Array(n[o]));t.data=a(t.data,i),s.push({uuid:e,payload:n[o]})}return{value:t,messages:s}}()}(t,a||[]);t=n,o=s}return{success:!0,frame:t,transformerId:s,type:r,seiResult:o}}const s=function(){let e=[];const t=new Map;return{add:({payload:t,repeatCount:n})=>(e.push({payload:t,repeatCount:n}),!0),poll(n){t.has(n)||t.set(n,[]),t.size>0&&(t.forEach((t=>{t.push(...e)})),e=[]);const s=t.get(n)||[],r=s.filter((e=>e.repeatCount>0)).map((e=>Object.assign(Object.assign({},e),{repeatCount:e.repeatCount-1})));return t.set(n,r),s}}}(),r=e=>(t,r)=>{try{const a=t.getMetadata().synchronizationSource,o=(s?s.poll(a):[]).map((e=>e.payload)),i=n(t,Object.assign(Object.assign({},e),{payloads:o}));r.enqueue(i.frame),self.postMessage(Object.assign({success:i.success,seiResult:i.seiResult},e))}catch(t){self.postMessage(Object.assign({success:!1},e))}},a=e=>(t,n)=>{try{const s=function(e,t){const{type:n,transformerId:s}=t;if("sei"===n){const t=function(e){function t(e,t,n){return n+t.length<e.byteLength&&t.every(((t,s)=>e.getUint8(n+s)===t))}function n(e){const t=[];let n=0;for(;n<e.length;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(t.push(e[n]),t.push(e[n+1]),n+=3):(t.push(e[n]),n+=1);return new Uint8Array(t)}function s(e){let t=2;const n=e.byteLength;for(;t<n;){let s=0;for(;t<n&&255===e[t];)s+=255,t++;s+=e[t],t++;const r=Math.min(t+s,n),a=new Uint8Array(e.slice(t,r));return{uuid:a.slice(0,16),payload:a.slice(16)}}}return{messages:function(e){const r=new DataView(e.data),a=[];let o=0;if(!t(r,[0,0,1],0)&&!t(r,[0,0,0,1],0))return[];for(;o<r.byteLength-5;)if(t(r,[0,0,1],o)){const i=o+3;o=i;const c=31&r.getUint8(o),u=31&r.getUint8(o+1);if(6===c&&5===u){for(;o<r.byteLength&&!t(r,[0,0,1],o);)o++;const c=o,u=s(n(new Uint8Array(e.data.slice(i,c))));u&&a.push(Object.assign({},u))}else o++}else o++;return a}(e),frame:e}}(e),{frame:r,messages:a}=t;return{success:!0,frame:r,type:n,transformerId:s,seiResult:a}}return{success:!0,frame:e,transformerId:s,type:n}}(t,e);n.enqueue(s.frame),self.postMessage(Object.assign({success:s.success,seiResult:s.seiResult},e))}catch(t){self.postMessage(Object.assign({success:!1},e))}};function o(e,t,n,s){const o=new TransformStream({transform:"video/send"===e?r(t):a(t)});n.pipeThrough(o).pipeTo(s)}const i=self;i.addEventListener("message",(function(e){var n,r,a;if(!(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.operation)||!(null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.transformerId))return;const{operation:i,transformerId:c}=e.data;switch(i){case t.VIDEO_SEND:case t.VIDEO_RECEIVE:o(i,{method:i,transformerId:c,type:"sei"},e.data.readable,e.data.writable);break;case t.INSERT_SEI:s.add({payload:e.data.payload,repeatCount:null!==(a=e.data.repeatCount)&&void 0!==a?a:0})}})),i.addEventListener("rtctransform",(function(e){const t=e.transformer;if(!t)return;o(t.options.method,t.options,t.readable,t.writable)}))})();`,"Worker",void 0,void 0)}(function(L){L.NONE="none",L.ENCODED_TRANSFORMS="encodedTransforms",L.INSERTABLE_STREAMS="insertableStreams"})(Yo||(Yo={}));const da=(()=>{const L={};return{getWorker:w=>(L[w]||(L[w]=new Xm),L[w]),destroy:w=>{var O;(O=L[w])===null||O===void 0||O.terminate(),L[w]=void 0}}})();var ys;(function(L){L.NOT_PUBLISHING_VIDEO="NOT_PUBLISHING_VIDEO",L.INBAND_MESSAGING_NOT_ENABLED="INBAND_MESSAGING_NOT_ENABLED",L.INVALID_REPEAT_COUNT="INVALID_REPEAT_COUNT",L.PAYLOAD_SIZE_INVALID="PAYLOAD_SIZE_INVALID",L.PAYLOAD_RATE_EXCEEDED="PAYLOAD_RATE_EXCEEDED",L.INVALID_TRACK_TYPE="INVALID_TRACK_TYPE"})(ys||(ys={}));class kb{constructor(w){this.maxFramerate=w,this.queued=[]}validateMessagePayload(w,O){if(w.byteLength<=0)return Pn.err(ys.PAYLOAD_SIZE_INVALID);if(O<0||O>30)return Pn.err(ys.INVALID_REPEAT_COUNT);if(w.byteLength>1024)return Pn.err(ys.PAYLOAD_SIZE_INVALID);this.queued=this.trimPastPayloads(this.queued,1e3);const{before:B,after:V}=this.getPayloadSums(this.queued);if(B+w.byteLength>10240||V+w.byteLength*Math.max(1,O)>10240)return Pn.err(ys.PAYLOAD_RATE_EXCEEDED);if(this.queued.push({byteLength:w.byteLength,timestamp:Date.now()}),O>0){const Y=1e3/this.maxFramerate;let se=Date.now()+Y;for(let me=0;me<O;me+=1)this.queued.push({byteLength:w.byteLength,timestamp:se}),se+=Y}return Pn.ok(!0)}trimPastPayloads(w,O){const B=Date.now()-O;return w.filter((V=>V.timestamp>B))}getPayloadSums(w){const O=Date.now();return w.reduce(((B,V)=>{const{before:Y,after:se}=B;return V.timestamp<=O?{before:Y+V.byteLength,after:se}:{before:Y,after:se+V.byteLength}}),{before:0,after:0})}}const mh="seiMessageReceived",tr="error";var ar;(function(L){L.CREATED="created",L.INITIALIZED="initialized",L.DESTROYED="destroyed"})(ar||(ar={}));class vc extends Zc{constructor(w){super(),this.sessionId=w,this.state=ar.CREATED,this.transformerId=Hi().value,this.prevResultWasError=!1,this.consecutiveErrorResults=0,this.seiReadCnt=0,this.seiBytesRead=0,this.onMessage=O=>{this.onTransformResult(O.data)}}initializeInsertableStreams(w){var O,B;this.worker=da.getWorker(this.sessionId);const V=w.receiver.createEncodedStreams(),{readable:Y,writable:se}=V;(O=this.worker)===null||O===void 0||O.postMessage({operation:"video/receive",transformerId:this.transformerId,readable:Y,writable:se},[Y,se]),(B=this.worker)===null||B===void 0||B.addEventListener("message",this.onMessage)}initializeEncodedTransforms(w){var O;this.worker=da.getWorker(this.sessionId);const B={method:"video/receive",type:"sei",transformerId:this.transformerId};w.receiver.transform=new RTCRtpScriptTransform(this.worker,B),(O=this.worker)===null||O===void 0||O.addEventListener("message",this.onMessage)}initialize(w,O){if(this.state!==ar.CREATED)return!1;const B=ph(w);if(B===Yo.NONE)return!1;if(O&&B===Yo.INSERTABLE_STREAMS)this.initializeInsertableStreams(w);else{if(O||B!==Yo.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(w)}return this.transceiver=w,this.state=ar.INITIALIZED,!0}onTransceiverAdd(w){return this.initialize(w,!0)}onTrackEvent(w){return w.track.kind==="video"&&this.initialize(w.transceiver,!1)}static isSupported(w){return ph(w)!==Yo.NONE}onTransformResult(w){return w.transformerId===this.transformerId&&(w.success?(this.prevResultWasError=!1,this.consecutiveErrorResults=0,!!w.seiResult&&(w.seiResult.forEach((O=>{const{payload:B,uuid:V}=O;this.updateReadStats(O),this.emit(mh,{uuid:V,payload:B})})),w.seiResult.length>0)):(this.prevResultWasError&&this.consecutiveErrorResults++,this.consecutiveErrorResults>=300&&this.onError(w,Xt.TRANSFORM_TOO_MANY_ERRORS),this.prevResultWasError=!0,this.onError(w,Xt.TRANSFORM_UNEXPECTED_ERROR),!1))}updateReadStats(w){this.seiReadCnt++,this.seiBytesRead+=w.payload.byteLength}getReceiverStats(){const{seiBytesRead:w,seiReadCnt:O}=this;return{seiReadCnt:O,seiBytesRead:w}}onError(w,O){const{type:B}=w;this.emit(tr,{type:B,stageErrorValue:O})}destroy(){var w,O;this.state!==ar.DESTROYED&&(this.removeAllListeners(),(w=this.worker)===null||w===void 0||w.removeEventListener("message",this.onMessage),!((O=this.transceiver)===null||O===void 0)&&O.receiver&&(this.transceiver.receiver.transform=null),this.state=ar.DESTROYED)}getState(){return this.state}}class ii{constructor(w){this.sessionId=w,this.state=ar.CREATED,this.transformerId=Hi().value,this.seiWriteCnt=0,this.seiBytesWritten=0,this.onMessage=O=>{this.onTransformResult(O.data)}}initializeInsertableStreams(w,O){var B,V;this.worker=da.getWorker(this.sessionId);const Y=w.sender.createEncodedStreams(),{readable:se,writable:me}=Y;(B=this.worker)===null||B===void 0||B.postMessage({operation:"video/send",transformerId:this.transformerId,readable:se,writable:me},[se,me]),(V=this.worker)===null||V===void 0||V.addEventListener("message",this.onMessage)}initializeEncodedTransforms(w,O){var B;this.worker=da.getWorker(this.sessionId);const V={method:"video/send",type:"sei",transformerId:this.transformerId,encodingLayers:O};w.sender.transform=new RTCRtpScriptTransform(this.worker,V),(B=this.worker)===null||B===void 0||B.addEventListener("message",this.onMessage)}initialize(w){var O;if(this.state!==ar.CREATED)return!1;const B=Jg(w);if(B===Yo.NONE)return!1;const V=w.sender.getParameters(),Y=((O=V?.encodings)===null||O===void 0?void 0:O.length)||1;if(B===Yo.INSERTABLE_STREAMS)this.initializeInsertableStreams(w,Y);else{if(B!==Yo.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(w,Y)}return this.transceiver=w,this.state=ar.INITIALIZED,!0}static isSupported(w){return Jg(w)!==Yo.NONE}sendSeiMessage(w,O){var B;return this.state===ar.INITIALIZED&&this.transceiver?((B=this.worker)===null||B===void 0||B.postMessage({operation:"insertSei",transformerId:this.transformerId,payload:w,repeatCount:O}),Pn.ok(!0)):Pn.err(ys.NOT_PUBLISHING_VIDEO)}onTransceiverAdd(w){return this.initialize(w)}onTrackEvent(w){return!1}onTransformResult(w){return w.transformerId===this.transformerId&&(w.success&&this.updateSendStats(w),w.success)}updateSendStats(w){w.seiResult&&w.seiResult.forEach((O=>{this.seiWriteCnt++,this.seiBytesWritten+=O.payload.byteLength}))}getSenderStats(){const{seiBytesWritten:w,seiWriteCnt:O}=this;return{seiWriteCnt:O,seiBytesWritten:w}}destroy(){var w;this.state!==ar.DESTROYED&&(!((w=this.transceiver)===null||w===void 0)&&w.receiver&&(this.transceiver.receiver.transform=null),this.state=ar.DESTROYED)}getState(){return this.state}}class as extends $n{constructor(w,O,B,V,Y,se,me,S,f){super(kn.SELECTED_PAIR_CHANGE,O,B,!1),Object.assign(this.properties,{action:w,protocol:V,local_type:Y,local_addr:se,remote_addr:me,local_candidate_priority:S,remote_participant_id:f})}}var Fs=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};let xd=null;class Ya extends Zc{constructor(w,O,B,V,Y,se,me,S,f){var _;if(super(),this.analyticsTracker=se,this.subscribeConfig=f,this.sfuResource={node:"",cluster:""},this.protocol="",this.incompatibleCodecs=new Set,this.connect=({audioOnly:R=!1,traceId:U,iceRestartOptions:ee})=>Fs(this,void 0,void 0,(function*(){const{token:ue,tag:de,identifier:be,action:Ce}=this,Oe=!!ee,Fe=new AbortController;let ot,_t,Tt;this.abortController=Fe,this.traceId=U,this.protocol="",this.perfTracker.resetMeasurements(U);const ht=()=>{ot&&this.off(Ii,ot),_t&&this.off(yo,_t)},st=new Promise(((xt,mt)=>{const Et=(function({action:It,token:Nt,traceId:Zt,tag:hn,identifier:In}){const On=It===Tn.SUBSCRIBE?Xt.SUBSCRIBE_TIMED_OUT:Xt.PUBLISH_TIMED_OUT;return new gr(Object.assign(Object.assign({},On),{action:It,token:Nt,traceId:Zt,tag:hn,location:"connect",remoteParticipantId:In}))})({action:Ce,token:ue,traceId:U,tag:de,identifier:be}),kt=(function({action:It,token:Nt,traceId:Zt,tag:hn}){const In=Xt.OPERATION_ABORTED;return new gr(Object.assign(Object.assign({},In),{token:Nt,traceId:Zt,location:"peer-client.connect",tag:hn,action:It}))})({action:Ce,token:ue,traceId:U,tag:de}),Bt=setTimeout((()=>{this.stop(),this.analyticsTracker.trackError(Et),mt(Et)}),1e4);ot=It=>{clearTimeout(Bt),Oe||this.stop(),mt(It)},_t=It=>{if(It===jn.CONNECTED)clearTimeout(Bt),xt();else if(It===jn.FAILED){const Nt=(function({action:Zt,token:hn,traceId:In,tag:On}){return new gr(Object.assign(Object.assign({},Xt.PEER_CONNECTION_NETWORK_FAILURE),{token:hn,traceId:In,location:"peer-client.connect",tag:On,action:Zt}))})({action:Ce,token:ue,traceId:U,tag:de});clearTimeout(Bt),mt(Nt)}},this.on(Ii,ot),this.on(yo,_t),Tt=()=>{clearTimeout(Bt)},Fe.signal.aborted&&(clearTimeout(Bt),mt(kt)),Fe.signal.addEventListener("abort",(()=>{clearTimeout(Bt),mt(kt)}))}));try{const xt=yield Promise.all([Fs(this,void 0,void 0,(function*(){Oe||(yield this.start(),this.mediaStream=yield this.initializePeerConnection(R));const Et=ee?.assignmentToken,kt=ee?.nodeOverride;return yield this.exchangeSdp({iceRestart:Oe,nodeOverride:kt,assignmentToken:Et,abortController:Fe}),this.mediaStream})),st]);this.statsReporter.traceId=U;const mt=xt[0];if(this.abortController=void 0,!Oe&&Ce===Tn.PUBLISH)try{yield this.verifyOrUpdateTransceiverSync()}catch(Et){this.logger.error({err:Et,msg:"error syncing transceivers"})}return{mediaStream:mt}}catch(xt){throw Tt&&Tt(),xt}finally{ht()}})),this.disconnect=(R=!1)=>Fs(this,void 0,void 0,(function*(){var U;const{token:ee,action:ue}=this;(U=this.abortController)===null||U===void 0||U.abort(),this.stop(),this.protocol="",R?this.cleanup(ue,ee.participantID,ee,R):yield this.cleanup(ue,ee.participantID,ee,R)})),this.resetTransformers=()=>{var R,U;(R=this.videoSenderTransformer)===null||R===void 0||R.destroy(),this.videoSenderTransformer=this.createVideoSenderTransformer(),(U=this.videoReceiverTransformer)===null||U===void 0||U.destroy(),this.videoReceiverTransformer=this.createVideoReceiverTransformer(),this.statsReporter.resetTransformers(this.videoReceiverTransformer,this.videoSenderTransformer)},this.onTrack=R=>{var U,ee;const{token:ue,action:de,traceId:be,identifier:Ce}=this;this.trace(ue,be,`onTrack: ${R.track.kind}`,de,Ce),this.sendInBandMessagingEnabled&&((U=this.videoSenderTransformer)===null||U===void 0||U.onTrackEvent(R)),this.receiveInBandMessagingEnabled&&((ee=this.videoReceiverTransformer)===null||ee===void 0||ee.onTrackEvent(R))},this.onIceGatheringStateChange=()=>{var R,U,ee;const{token:ue,action:de,traceId:be,identifier:Ce}=this;if(((R=this.peerConnection)===null||R===void 0?void 0:R.iceGatheringState)==="gathering"?this.perfTracker.markIceGatheringStart():((U=this.peerConnection)===null||U===void 0?void 0:U.iceGatheringState)==="complete"&&this.perfTracker.markIceGatheringStop(),this.peerConnection){const Oe=this.peerConnection.iceGatheringState,Fe=new pp(de,ue,be,Oe,Ce);this.analyticsTracker.trackEventNoSharedProps(Fe)}this.trace(ue,be,`ICE gathering state change: ${(ee=this.peerConnection)===null||ee===void 0?void 0:ee.iceGatheringState}`,de,Ce)},this.onSelectedCandidatePairChange=()=>{var R,U,ee,ue,de,be,Ce,Oe,Fe,ot,_t,Tt,ht,st;const{token:xt,action:mt,traceId:Et,identifier:kt}=this,Bt=(U=(R=this.peerConnection)===null||R===void 0?void 0:R.getReceivers()[0].transport)===null||U===void 0?void 0:U.iceTransport,It=Bt?.getSelectedCandidatePair();if(It){const{local:Nt,remote:Zt}=It,hn=`Selected candidate pair change (local, remote): ${Nt?.candidate}, ${Zt?.candidate}`;this.logger.debug({msg:hn});const In=new as(mt,xt,Et,(ue=(ee=It.local)===null||ee===void 0?void 0:ee.protocol)!==null&&ue!==void 0?ue:"",(be=(de=It.local)===null||de===void 0?void 0:de.type)!==null&&be!==void 0?be:"",(Oe=(Ce=It.local)===null||Ce===void 0?void 0:Ce.address)!==null&&Oe!==void 0?Oe:"",(ot=(Fe=It.remote)===null||Fe===void 0?void 0:Fe.address)!==null&&ot!==void 0?ot:"",(Tt=(_t=It.local)===null||_t===void 0?void 0:_t.priority)!==null&&Tt!==void 0?Tt:0,kt);this.analyticsTracker.trackEvent(In),this.protocol=(st=(ht=It.local)===null||ht===void 0?void 0:ht.protocol)!==null&&st!==void 0?st:""}},this.onIceCandidate=R=>Fs(this,void 0,void 0,(function*(){var U,ee;const{identifier:ue,action:de,traceId:be}=this,Ce=(U=R.target.localDescription)===null||U===void 0?void 0:U.sdp.includes("relay");this.analyticsTracker.trackEventNoSharedProps(new Ca(this.token,be,`ice candidate: hasRelay = ${Ce}, candidate = ${(ee=R.candidate)===null||ee===void 0?void 0:ee.candidate}`,de,ue))})),this.onMute=()=>Fs(this,void 0,void 0,(function*(){const{token:R,action:U,traceId:ee,identifier:ue}=this;this.trace(R,ee,"Track has muted",U,ue)})),this.onUnMute=()=>Fs(this,void 0,void 0,(function*(){const{token:R,action:U,traceId:ee,identifier:ue}=this;this.trace(R,ee,"Track has unmuted",U,ue)})),this.fetchAndSetRemoteDescription=R=>Fs(this,void 0,void 0,(function*(){var U,ee,ue,de;const be=(ee=(U=this.peerConnection)===null||U===void 0?void 0:U.localDescription)===null||ee===void 0?void 0:ee.sdp;be||this.logger.warn({msg:"Unexpected state: No SDP offer when attempting to fetch remote description"});const{token:Ce,traceId:Oe,action:Fe,identifier:ot,tag:_t}=this,{endpointURL:Tt,nodeOverride:ht,assignmentToken:st,multiCodec:xt,abortController:mt}=R;let Et;this.perfTracker.markPostStart(),this.perfTracker.markSdpExchangeStart();try{const Zt=Mf({connection:this.stageConnection,action:Fe,token:Ce,identifier:this.identifier,tracker:this.analyticsTracker});this.perfTracker.setTransport(Zt.getTransport());const hn=ht||ms("node")||ms("dataPlaneEndpoint");Et=yield Zt.exchange({sdpOffer:be,url:Tt,traceId:Oe,forceNode:hn,assignmentToken:st,multiCodec:xt,abortController:mt,initialLayerPreference:(ue=this.simulcastSubscribeConfig)===null||ue===void 0?void 0:ue.initialLayerPreference})}catch(Zt){let hn=Zt;hn instanceof gr||(hn=new gr(Object.assign(Object.assign({},Xt.UNEXPECTED_ERROR),{action:Fe,token:Ce,traceId:Oe,tag:_t,details:Zt instanceof Error?Zt.message:"",location:"sdp-exchange"}))),hn instanceof gr&&(this.analyticsTracker.trackError(hn),this.emit(Ii,hn))}if(this.perfTracker.markSdpExchangeStop(),!Et)return;const{location:kt,sessionDeleteLink:Bt,mediaControls:It}=Et;let Nt=Et.sdpAnswer;try{Nt=this.mungeSdpAnswer(Nt),Et.sdpAnswer=Nt}catch(Zt){this.logger.error({err:Zt,msg:"Error while attempting to munge SDP, keeping original answer"})}this.statsReporter.sdpAnswer=Nt,this.emit(fu,Et),kt&&(this.whipResource={location:kt,sessionDeleteLink:Bt,mediaControls:It},this.sfuResource=(function(Zt){const hn=Zt.match(/https:\/\/([^/]+)\//);if(hn){const In=hn[1].split(".");if(In[0].includes("video-rtx"))return{node:`${In[0]}.${In[1]}`,cluster:In[1]}}})(kt)||{node:"",cluster:""},this.statsReporter.updateSfuResource(this.sfuResource));try{this.perfTracker.markSetRemoteDescStart(),yield(de=this.peerConnection)===null||de===void 0?void 0:de.setRemoteDescription({sdp:Nt,type:"answer"}),this.perfTracker.markSetRemoteDescStop(),this.perfTracker.markPostStop()}catch(Zt){const hn=new gr(Object.assign(Object.assign({},Xt.SET_ANSWER_FAILURE),{action:Fe,token:Ce,traceId:Oe,tag:vn(Fe,ot),location:"setRemoteDescription",remoteParticipantId:ot,details:Zt instanceof Error?Zt.message:""}));this.analyticsTracker.trackError(hn),this.emit(Ii,hn)}})),this.cleanup=(R,U,ee,ue=!1)=>Fs(this,void 0,void 0,(function*(){var de,be,Ce;const Oe=Hi();if(this.toggleStageConnectionListeners(!1),this.currentJitterBufferMinDelayInMs=void 0,this.stageConnection=void 0,this.closeFailedPeerConnections(),!(!((de=this.whipResource)===null||de===void 0)&&de.location))return this.trace(ee,this.traceId,"whipResource location not known, exiting cleanup",R,U),void this.analyticsTracker.trackError(new gr(Object.assign(Object.assign({},Xt.WHIP_URL_MISSING),{action:R,token:ee,traceId:this.traceId,tag:vn(R,U),location:R===Tn.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:Oe,remoteParticipantId:U})));let Fe=this.whipResource.location;if(this.trace(ee,this.traceId,`use hostnamecachedurl: ${Fe}`,R,U),ue){if(!((Ce=this.whipResource)===null||Ce===void 0)&&Ce.sessionDeleteLink){Fe=this.whipResource.sessionDeleteLink,this.trace(ee,this.traceId,`DELETE via session-delete beacon path: ${Fe}`,R,U);try{navigator.sendBeacon(Fe,JSON.stringify({authorization:ee.rawToken}))}catch(ot){this.analyticsTracker.trackErrorAndThrow(new gr(Object.assign(Object.assign({},Mo(Xt.WHIP_DELETE_FAILURE,ot)),{action:R,token:ee,traceId:this.traceId,tag:vn(R,U),location:Tn.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:Oe,remoteParticipantId:U})))}}}else try{yield hc().delete(Fe,{headers:{Authorization:`Bearer ${ee.rawToken}`,"X-Stages-Platform":"web","X-Stages-Request-ID":Oe.value,"X-Stages-SDK":"1.27.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":this.traceId.value,"X-Stages-WHIP-Version":qu}})}catch(ot){((be=ot.response)===null||be===void 0?void 0:be.status)===404?this.trace(ee,this.traceId,`DELETE returned 404, ignoring, action = ${R}, uuid = ${Oe.value}`,R,U):this.analyticsTracker.trackErrorAndThrow(new gr(Object.assign(Object.assign({},Mo(Xt.WHIP_DELETE_FAILURE,ot)),{action:R,token:ee,traceId:this.traceId,tag:vn(R,U),location:Tn.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:Oe,remoteParticipantId:U})))}})),this.getConnectionState=()=>{if(!this.peerConnection)return jn.NONE;const R=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;try{return Lg(R)}catch{return this.logger.warn({msg:"Unhandled connection state:",rawState:R}),jn.IDLE}},this.onIceCandidateError=R=>{const{token:U,traceId:ee,tag:ue}=this;if(R.errorCode!==701){const de=new gr(Object.assign(Object.assign({},Xt.ICE_CANDIDATE_ERROR),{action:this.action,token:U,traceId:ee,tag:ue,location:"onIceCandidateError",remoteParticipantId:this.identifier}));this.analyticsTracker.trackError(de),this.emit(Ii,de)}},this.onIceConnectionStateChange=()=>{var R,U;const{token:ee,traceId:ue,action:de,identifier:be}=this;this.trace(ee,ue,`ICE connection state change: ${(R=this.peerConnection)===null||R===void 0?void 0:R.iceConnectionState}`,de,be),((U=this.peerConnection)===null||U===void 0?void 0:U.iceConnectionState)==="checking"&&this.peerConnection.getTransceivers().forEach((({receiver:Ce,sender:Oe})=>{[Ce,Oe].forEach((Fe=>{var ot,_t;(_t=(ot=Fe?.transport)===null||ot===void 0?void 0:ot.iceTransport)===null||_t===void 0||_t.addEventListener("selectedcandidatepairchange",this.onSelectedCandidatePairChange)}))})),this.onConnectionStateChange()},this.createVideoSenderTransformer=()=>new ii(this.analyticsTracker.getSessionId()),this.createVideoReceiverTransformer=()=>{const R=new vc(this.analyticsTracker.getSessionId()),{token:U,tag:ee,identifier:ue,action:de,traceId:be}=this;R.on(mh,(Fe=>{this.emit(hu,Fe)}));const Ce=(function(Fe,ot){let _t=0;return function(...Tt){const ht=Date.now();ht-_t>=ot&&(_t=ht,Fe(...Tt))}})((Fe=>{const ot=`Transform error occurred: ${Fe.type}`,_t=Eo({traceId:be,token:U,tag:ee,identifier:ue,action:de,details:ot,stageErrorValue:Xt.TRANSFORM_UNEXPECTED_ERROR});this.logger.warn({err:_t,msg:"Error encountered when transforming receiver",error:Fe})}),1e3),Oe=Fe=>{const ot=`Too many errors occurred: ${Fe.type}`,_t=Eo({traceId:be,token:U,tag:ee,identifier:ue,action:de,details:ot,stageErrorValue:Xt.TRANSFORM_TOO_MANY_ERRORS});this.logger.error({err:_t,msg:"Too many errors encountered when transforming receiver. Shutting down transformer.",error:Fe}),R.destroy(),this.analyticsTracker.trackError(_t),this.emit(Lu,_t)};return R.on(tr,(Fe=>{Fe.stageErrorValue.code!==Xt.TRANSFORM_TOO_MANY_ERRORS.code?Ce(Fe):Oe(Fe)})),R},this.onConnectionStateChange=()=>{if(this.peerConnection){const U=this.peerConnection.connectionState||this.peerConnection.iceConnectionState,{token:ee,traceId:ue,identifier:de,action:be}=this,Ce=new dp(be,ee,ue,U,de);this.analyticsTracker.trackEventNoSharedProps(Ce),this.trace(ee,ue,`connection state change: ${U}`,be,de)}const R=this.getConnectionState();switch(R){case jn.CONNECTED:this.closeFailedPeerConnections(),this.perfTracker.markActionStop(),this.emit(yo,R),this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream);break;case jn.FAILED:this.storeFailedPeerConnection(this.peerConnection),this.destroyPeerConnection({closeConnection:!1}),this.emit(yo,R),this.handleConnectionFailure();break;default:this.emit(yo,R)}},this.onIncompatibleCodecs=R=>Fs(this,void 0,void 0,(function*(){if(R.forEach((ue=>{let de=!1;this.incompatibleCodecs.forEach((be=>{be.config===ue.config&&be.mime===ue.mime&&(de=!0)})),de||this.incompatibleCodecs.add(ue)})),this.peerConnection)try{yield(U=this.peerConnection,ee=[...this.incompatibleCodecs],m_(void 0,void 0,void 0,(function*(){var ue;for(const de of U.getSenders()){const be=de.getParameters();if(be.codecs.length>1){const Ce=be.codecs[0];let Oe=!1;for(const Fe of ee)Cf(Ce,Fe)&&(Oe=!0);if(Oe){const Fe=vp(ee,be.codecs);(ue=be.encodings)===null||ue===void 0||ue.forEach((ot=>{ot.active&&(ot.codec=Fe)})),yield de.setParameters(be)}}}})))}catch(ue){const{token:de,action:be,traceId:Ce,identifier:Oe}=this,Fe=new gr(Object.assign(Object.assign({},Xt.CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR),{action:be,token:de,traceId:Ce,tag:vn(be,Oe),location:"onIncompatibleCodecs",remoteParticipantId:Oe,details:ue instanceof Error?ue.message:""}));this.analyticsTracker.trackError(Fe),this.emit(Ii,Fe)}var U,ee})),this.token=w,this.logger=new on(O,le.WEBRTC),this.action=B,this.tag=V,this.traceId=Y,B===Tn.SUBSCRIBE&&!me)throw new Error("Subscribe action provided without subscriber Id");this.jitterBufferConfig=f?.jitterBuffer,this.simulcastSubscribeConfig=f?.simulcast,this.subscriberId=me,this.stageConnection=S,this.failedPeerConnections=[],this.receiveInBandMessagingEnabled=!!(!((_=this.subscribeConfig)===null||_===void 0)&&_.inBandMessaging.enabled),this.perfTracker=new gp(this.action,this.traceId),this.statsReporter=new $m(B,w,Y,this.identifier,this.analyticsTracker),this.handlePublishingChangedBinding=this.handlePublishingChanged.bind(this),this.toggleStageConnectionListeners(!0)}get videoMediaId(){var w,O;return(O=(w=this.videoTransceiver)===null||w===void 0?void 0:w.mid)!==null&&O!==void 0?O:null}toggleStageConnectionListeners(w){var O,B;w?(O=this.stageConnection)===null||O===void 0||O.on(el,this.handlePublishingChangedBinding):(B=this.stageConnection)===null||B===void 0||B.off(el,this.handlePublishingChangedBinding)}updateSubscribeConfig(w){var O,B;if(this.jitterBufferConfig=w.jitterBuffer,this.simulcastSubscribeConfig=w.simulcast,this.action===Tn.SUBSCRIBE){const V=w.inBandMessaging.enabled;this.receiveInBandMessagingEnabled!==V&&this.logger.warn({msg:"Cannot mutate in-band messaging config value for receiver"})}this.applyJitterBufferMinDelayConditionally((B=(O=this.stageConnection)===null||O===void 0?void 0:O.getIsStagePublishing())!==null&&B!==void 0&&B)}verifyOrUpdateTransceiverSync(){var w,O;return Fs(this,void 0,void 0,(function*(){if(this.publishVideoStream){const B=this.getTransceiverForKind("video");B?this.publishVideoStream.track.id!==((w=B.sender.track)===null||w===void 0?void 0:w.id)&&(this.logger.debug({msg:"found out of sync video transceiver... updating"}),yield this.replaceOrUpdateStream(this.publishVideoStream)):this.logger.warn({msg:"missing transceiver for video"})}if(this.publishAudioStream){const B=this.getTransceiverForKind("audio");B?this.publishAudioStream.track.id!==((O=B.sender.track)===null||O===void 0?void 0:O.id)&&(this.logger.debug({msg:"found out of sync audio transceiver... updating"}),yield this.replaceOrUpdateStream(this.publishAudioStream)):this.logger.warn({msg:"missing transceiver for audio"})}}))}start(){return Fs(this,void 0,void 0,(function*(){const{token:w,action:O,traceId:B,identifier:V}=this;O!==Tn.PUBLISH||w.claims.capabilities.allow_publish||this.analyticsTracker.trackErrorAndThrow(new gr(Object.assign(Object.assign({},Mo(Xt.TOKEN_PERMISSIONS_DENIED,new Error("Cannot publish with subscribe only token"))),{action:O,token:w,traceId:B,tag:vn(O,V),location:"StagePeerClient.start",remoteParticipantId:V})));const Y=(function({action:se,identifier:me,token:S,analyticsTracker:f}){let _="";const R=dd(S,f);switch(se){case Tn.PUBLISH:_=R.getPublishEndpoint();break;case Tn.SUBSCRIBE:me&&(_=R.getSubscribeEndpoint(me))}return _})({action:O,identifier:V,token:w.rawToken,analyticsTracker:this.analyticsTracker});try{this.perfTracker.markActionStart(),this.endpointURL=Y,this.createPeerConnection(),this.trace(w,B,"peer connection created",O,V)}catch(se){const me=new gr(Object.assign(Object.assign({action:O},Mo(Xt.CREATE_PEER_CONNECTION_FAILURE,se)),{token:w,traceId:B,tag:vn(O,V),location:"StagePeerClient.start",remoteParticipantId:V}));O===Tn.PUBLISH&&this.emit(yo,jn.FAILED),this.emit(Ii,me),this.analyticsTracker.trackErrorAndThrow(me)}}))}mungeSdpOffer(w,O,B){if(B.simulcastEnabled&&(w=new ri(w).withVideoLayersAllocationRtpHeaderExtension().sdp),O===Tn.SUBSCRIBE)w=new ri(w).withOpusAudioConfig(wr(Dc),!0).sdp;else if(O===Tn.PUBLISH&&B.audioConfig){const{maxBitrateBps:V,stereo:Y}=B.audioConfig;w=new ri(w).withOpusAudioConfig(V,Y).sdp}return w}mungeSdpAnswer(w){vd.browser.isFirefox()&&this.publishAudioStream&&this.action===Tn.PUBLISH&&(w=new ri(w).withOpusAudioConfig(this.publishAudioStream.config.maxBitrateBps,void 0).sdp);const O=vd.browser.isChrome()||vd.browser.isEdge();this.action===Tn.SUBSCRIBE&&O&&(w=new ri(w).withoutAudioRtcpRSize().sdp);const B=(function(){const V=ms("subscribeForceIceProtocol");if(V==="tcp"||V==="udp")return V})();return this.action===Tn.SUBSCRIBE&&B&&(w=new ri(w).withFilteredCandidates(B).sdp),w}createPeerConnection(){var w;this.logger.debug({msg:"setting up peer connection"}),this.peerConnection&&(this.logger.debug({msg:"peer connection is already established, cleaning up previous connection"}),this.destroyPeerConnection({closeConnection:!1})),this.peerConnection=new RTCPeerConnection({iceTransportPolicy:"all"}),this.statsReporter.start(this.peerConnection,(w=this.publishVideoStream)===null||w===void 0?void 0:w.config.simulcastEnabled),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.peerConnection.addEventListener("icecandidateerror",this.onIceCandidateError),this.peerConnection.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this.peerConnection.addEventListener("icecandidate",this.onIceCandidate),this.peerConnection.addEventListener("track",this.onTrack),this.peerConnection.addEventListener("mute",this.onMute),this.peerConnection.addEventListener("unmute",this.onUnMute)}destroyPeerConnection(w){var O,B,V,Y,se,me,S,f,_;this.statsReporter.stop(),(O=this.peerConnection)===null||O===void 0||O.removeEventListener("connectionstatechange",this.onConnectionStateChange),(B=this.peerConnection)===null||B===void 0||B.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),(V=this.peerConnection)===null||V===void 0||V.removeEventListener("icecandidateerror",this.onIceCandidateError),(Y=this.peerConnection)===null||Y===void 0||Y.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),(se=this.peerConnection)===null||se===void 0||se.removeEventListener("icecandidate",this.onIceCandidate),(me=this.peerConnection)===null||me===void 0||me.removeEventListener("track",this.onTrack),(S=this.peerConnection)===null||S===void 0||S.removeEventListener("mute",this.onMute),(f=this.peerConnection)===null||f===void 0||f.removeEventListener("unmute",this.onUnMute),(w.closeConnection||this.action===Tn.PUBLISH)&&((_=this.peerConnection)===null||_===void 0||_.close()),this.peerConnection=void 0}closeFailedPeerConnections(){for(const w of this.failedPeerConnections)w?.close();this.failedPeerConnections=[]}storeFailedPeerConnection(w){w&&this.action!==Tn.PUBLISH&&this.failedPeerConnections.push(w)}stop(){var w,O;(w=this.videoReceiverTransformer)===null||w===void 0||w.destroy(),(O=this.videoSenderTransformer)===null||O===void 0||O.destroy(),this.destroyPeerConnection({closeConnection:!0})}getTransceiverForKind(w){if(!this.peerConnection)return;const O=this.peerConnection.getTransceivers();return w==="audio"?O.find((B=>B.mid==="0")):w==="video"?O.find((B=>B.mid==="1")):void 0}removeTrack(w){return Fs(this,void 0,void 0,(function*(){if(w==="audio"||w==="video")if(this.peerConnection)try{const O=this.getTransceiverForKind(w);if(!O)return void this.logger.warn({msg:`tried removing track type ${w} but couldn't find transceiver`});yield O.sender.replaceTrack(null),w===Ol.AUDIO?this.publishAudioStream=void 0:this.publishVideoStream=void 0,yield this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream)}catch(O){this.logger.warn({msg:"error replacing track",err:O})}else w===Ol.AUDIO?this.publishAudioStream=void 0:this.publishVideoStream=void 0;else this.logger.warn({msg:"RemoveTrack called with invalid track type",trackType:w})}))}replaceOrUpdateStream(w){return Fs(this,void 0,void 0,(function*(){if(w.track){if(yu(w)?this.publishAudioStream=w:qm(w)&&(this.publishVideoStream=w),this.peerConnection)try{const O=this.getTransceiverForKind(w.track.kind);if(!O)return void this.logger.warn({msg:`tried replacing track type ${w.track.kind} but couldn't find transceiver`,track:w.track});if(qm(w)){const B=O.sender.getParameters(),V=w.config.encodingLayers;B.encodings=B.encodings.map((Y=>{var se;const me=(se=Y.rid)!==null&&se!==void 0?se:"",S=V.find((f=>{var _;return((_=f.rid)!==null&&_!==void 0?_:"")===me}));return S?Object.assign(Object.assign({},Y),S):Y})),yield O.sender.setParameters(B)}else if(yu(w)){const B=O.sender.getParameters(),V=Im(w)[0];B.encodings=B.encodings.map((Y=>Object.assign(Object.assign({},Y),V))),yield O.sender.setParameters(B)}yield O.sender.replaceTrack(w.track),yield this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream)}catch(O){this.logger.warn({msg:"error replacing track",err:O})}}else this.logger.warn({msg:"Unexpected call to replaceOrUpdateStream with no track"})}))}initializePeerConnection(w=!1){var O,B,V,Y,se,me,S,f;return Fs(this,void 0,void 0,(function*(){const{traceId:_,token:R,action:U,identifier:ee}=this;Ef(this.peerConnection),this.resetTransformers();let ue=new MediaStream;if(U===Tn.PUBLISH){this.publishAudioStream||(this.publishAudioStream={track:this.getSilentAudio(),config:{maxBitrateBps:wr(gu),stereo:!1}});const de=this.peerConnection.getTransceivers(),be=[];de.forEach((ht=>{var st;be.concat((st=ht.sender.track)===null||st===void 0?void 0:st.id)})),ue=new MediaStream([this.publishAudioStream.track,(O=this.publishVideoStream)===null||O===void 0?void 0:O.track].filter((ht=>!!ht&&!be.includes(ht.id))));const Ce=ue.getAudioTracks()[0]||"audio",Oe=ue.getVideoTracks()[0]||"video",Fe={direction:"sendonly",streams:[ue],sendEncodings:Im(this.publishAudioStream)},ot={direction:"sendrecv",streams:[ue],sendEncodings:(B=this.publishVideoStream)===null||B===void 0?void 0:B.config.encodingLayers};this.peerConnection.addTransceiver(Ce,Fe),this.trace(R,_,`track added, type: ${Ce.kind||Ce}`,U,ee);const _t=this.peerConnection.addTransceiver(Oe,ot);this.trace(R,_,`track added, type: ${Oe.kind||Oe}`,U,ee);const Tt=!!(!((Y=(V=this.publishVideoStream)===null||V===void 0?void 0:V.config)===null||Y===void 0)&&Y.inBandMessagingEnabled);this.sendInBandMessagingEnabled===void 0?this.sendInBandMessagingEnabled=Tt:this.sendInBandMessagingEnabled!==Tt&&this.logger.warn({msg:"Cannot mutate in-band messaging config value for sender"}),this.sendInBandMessagingEnabled&&!ii.isSupported(_t)?this.handleTransformNotSupported():this.sendInBandMessagingEnabled&&((se=this.videoSenderTransformer)===null||se===void 0||se.onTransceiverAdd(_t))}else U===Tn.SUBSCRIBE&&(R.shouldSendSilentAudio()?this.peerConnection.addTransceiver(this.getSilentAudio(),{direction:"sendrecv"}):this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),this.trace(R,_,"track added, type: audio",U,ee),w||(this.videoTransceiver=this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.trace(R,_,"track added, type: video",U,ee),this.receiveInBandMessagingEnabled&&!vc.isSupported(this.videoTransceiver)?this.handleTransformNotSupported():this.receiveInBandMessagingEnabled&&((me=this.videoReceiverTransformer)===null||me===void 0||me.onTransceiverAdd(this.videoTransceiver))),this.peerConnection.getTransceivers().forEach((de=>{de.receiver?(this.logger.info({msg:"dbg: Subscribe succeeded, adding media track to participant mediaStream"}),ue?.addTrack(de.receiver.track)):this.logger.info({msg:"dbg: Subscribe succeeded, but Transceiver were negotiated without Receiver"})})),this.applyJitterBufferMinDelayConditionally((f=(S=this.stageConnection)===null||S===void 0?void 0:S.getIsStagePublishing())!==null&&f!==void 0&&f));return ue}))}handlePublishingChanged(w){this.logger.debug({msg:`[handlePublishingChanged (${this.subscriberId})] isStagePublishing: ${w}, currentMinDelay: ${this.currentJitterBufferMinDelayInMs}`}),this.action===Tn.SUBSCRIBE&&this.applyJitterBufferMinDelayConditionally(w)}applyJitterBufferMinDelayConditionally(w){const O=this.currentJitterBufferMinDelayInMs,B=this.calcJitterBufferMinDelay(w,this.jitterBufferConfig);if(w){if(O===void 0||O>B){const V=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is publishing and min delay is unset or > configured; attempting to update to ${B}`;this.logger.debug({msg:V}),this.trace(this.token,this.traceId,V,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(B)}}else if(O===void 0||B!==O){const V=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is subscribe-only and min delay is unset or != configured; attempting to update to ${B}`;this.logger.debug({msg:V}),this.trace(this.token,this.traceId,V,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(B)}}calcJitterBufferMinDelay(w,O){var B,V,Y;let se=0;if(!(()=>{const me=RTCRtpReceiver.prototype;return!(!me||typeof me!="object")&&("jitterBufferTarget"in me||"playoutDelayHint"in me)})())return 0;if(w)se=Gm((B=O?.minDelayWhenPublishing)!==null&&B!==void 0?B:Aa.DEFAULT,w);else{se=Gm((V=O?.minDelayWhenSubscribeOnly)!==null&&V!==void 0?V:Aa.DEFAULT,w);const me=(Y=this.stageConnection)===null||Y===void 0?void 0:Y.jitterBufferMinDelayInMs();O?.minDelayWhenSubscribeOnly===Aa.DEFAULT&&me!==void 0&&(se=me,this.logger.debug({msg:`[calcJitterBufferMinDelay] overriding min delay with remote value: ${se}`}))}return se}applyAndTrackJitterBufferMinDelay(w){var O,B;this.currentJitterBufferMinDelayInMs=w,this.statsReporter.updateJitterBufferMinDelay(w),w!==void 0&&((B=(O=this.peerConnection)===null||O===void 0?void 0:O.getTransceivers())===null||B===void 0||B.forEach((V=>{V.receiver&&this.applyJitterBufferMinDelay(V.receiver,w)})))}applyJitterBufferMinDelay(w,O){let B="Unable to set jitter buffer min delay";if("jitterBufferTarget"in w)B=`setting jitterBufferTarget to: ${O} for track: ${w.track.kind}`,this.logger.debug({msg:B}),w.jitterBufferTarget=O;else if("playoutDelayHint"in w){const V=O/1e3;B=`setting playoutDelayHint to: ${O} for track: ${w.track.kind}`,this.logger.debug({msg:B}),w.playoutDelayHint=V}else this.logger.warn({msg:B});this.trace(this.token,this.traceId,B,this.action,this.identifier)}exchangeSdp(w){var O,B,V;return Fs(this,void 0,void 0,(function*(){const{traceId:Y,token:se,action:me,identifier:S,tag:f,endpointURL:_}=this,{iceRestart:R=!1,nodeOverride:U,assignmentToken:ee,abortController:ue}=w;let de;this.logger.debug({msg:`Exchanging SDP: ${Y.value}, iceRestart=${R}, nodeOverride=${U}, assignmentToken=${ee}`}),Ef(this.peerConnection),me===Tn.PUBLISH&&rp()&&(this.logger.debug({msg:"Applying publisher codec preference for main profile."}),((Ce,Oe)=>{var Fe,ot;const _t=(Fe=RTCRtpReceiver.getCapabilities("video"))===null||Fe===void 0?void 0:Fe.codecs;if(!_t)return;let Tt=_t;Tt=Pm(_t,"42e0"),Oe.preferMainProfile&&(Tt=Pm(_t,"4d00")),(ot=Ce.getTransceivers().find((ht=>ht.receiver.track.kind==="video")))===null||ot===void 0||ot.setCodecPreferences(Tt)})(this.peerConnection,{preferMainProfile:rp()}));try{this.trace(se,Y,"Creating offer",me,S),de=yield this.peerConnection.createOffer({iceRestart:R})}catch(Ce){const Oe=new gr(Object.assign(Object.assign({},Mo(Xt.CREATE_OFFER_FAILURE,Ce)),{action:me,token:se,traceId:Y,tag:f,location:"exchangeSdp",remoteParticipantId:S}));this.emit(Ii,Oe),this.analyticsTracker.trackErrorAndThrow(Oe)}de.sdp&&(de.sdp=this.mungeSdpOffer(de.sdp,me,{simulcastEnabled:(B=(O=this.publishVideoStream)===null||O===void 0?void 0:O.config.simulcastEnabled)!==null&&B!==void 0&&B,audioConfig:(V=this.publishAudioStream)===null||V===void 0?void 0:V.config})),this.trace(se,Y,"Setting local description",me,S),yield this.peerConnection.setLocalDescription(de),this.trace(se,Y,"local description set",me,S),_||this.logger.warn({msg:"Unexpected state: No endpointURL specified for fetching of remote description."});const be=me===Tn.PUBLISH&&rp()||me===Tn.SUBSCRIBE&&Rs("multiCodecAnswer");yield this.fetchAndSetRemoteDescription({endpointURL:_,nodeOverride:U,assignmentToken:ee,multiCodec:be,abortController:ue})}))}getReports(){var w;return Fs(this,void 0,void 0,(function*(){try{const O=(yield(w=this.peerConnection)===null||w===void 0?void 0:w.getStats())||[],B=[];return O.forEach((V=>{B.push(V)})),B}catch{return[]}}))}requestRTCStats(w){return Fs(this,void 0,void 0,(function*(){if(this.peerConnection)return this.statsReporter.getStats(w)}))}get identifier(){return this.subscriberId||this.token.participantID}handleTransformNotSupported(){const{token:w,tag:O,identifier:B,action:V,traceId:Y}=this,se=Eo({traceId:Y,token:w,tag:O,identifier:B,action:V,stageErrorValue:Xt.TRANSFORM_NOT_SUPPORTED_BY_PLATFORM});this.logger.error({err:se,msg:"Transforms not supported by this platform"}),this.analyticsTracker.trackError(se),this.emit(Lu,se)}handleConnectionFailure(){return Fs(this,void 0,void 0,(function*(){const{token:w,traceId:O,tag:B}=this;this.analyticsTracker.trackError(new gr(Object.assign(Object.assign({},Xt.PEER_CONNECTION_NETWORK_FAILURE),{action:this.action,token:w,traceId:O,tag:B,location:"onIceCandidateError",remoteParticipantId:this.identifier})))}))}getSilentAudio(){xd||(xd=new AudioContext);const w=xd.createOscillator(),O=xd.createGain();w.connect(O);const B=xd.createMediaStreamDestination();return O.connect(B),O.gain.value=0,w.start(),B.stream.getAudioTracks()[0]}getActionMeasurements(){return this.perfTracker.getMeasurements()}getProtocol(){return this.protocol}initStreamsToPublish(w){this.publishVideoStream=w.find(qm),this.publishAudioStream=w.find(yu)}getSfuResource(){return this.sfuResource}getExpectedJitterBufferMinDelayInMs(){var w,O;return this.calcJitterBufferMinDelay((O=(w=this.stageConnection)===null||w===void 0?void 0:w.getIsStagePublishing())!==null&&O!==void 0&&O,this.jitterBufferConfig)}trace(w,O,B,V,Y){this.analyticsTracker.trackEventNoSharedProps(new Ca(w,O,B,V,Y))}sendSeiMessage(w,O){const B=this.getTransceiverForKind("video");return this.videoSenderTransformer&&this.sendInBandMessagingEnabled?this.action===Tn.PUBLISH&&B?this.videoSenderTransformer.sendSeiMessage(w,O):Pn.err(ys.NOT_PUBLISHING_VIDEO):Pn.err(ys.INBAND_MESSAGING_NOT_ENABLED)}}const Zs=Tn.SUBSCRIBE;class Ia{constructor(w,O,B){this.analyticsTracker=w,this.token=O,this.remoteId=B,this.action=Zs}trackAttempt({stageConnectionStats:w,isReassignment:O=!1,traceIdOverride:B,preAttemptSfuResource:V}){const{action:Y,analyticsTracker:se,token:me,remoteId:S}=this,f=B||os();return se.trackEvent(new Tb({token:this.token,subscribedId:this.remoteId,traceId:f,isEdpConnected:w.isConnected,isReassignment:O,preAttemptSfuResource:V})),{getTraceId:()=>f,trackSubscribeStarted({totalDurationWithRetries:_,retryTimes:R,sfuResource:U,peerClientPerfStats:ee,protocol:ue}){const{optionsDuration:de,postDuration:be,timeToCandidate:Ce,timeToConnected:Oe,sdpExchangeDuration:Fe,sdpExchangeTransport:ot,setRemoteDescDuration:_t,peerConnectionDuration:Tt}=ee,{edpInitialConnectDuration:ht,edpInitialConnectRetries:st,edpInitialStateDuration:xt,edpInitialStatePublishingCount:mt,edpStateUpdateCount:Et}=w;se.trackEvent(new Rb({token:me,traceId:f,remoteParticipantId:S,optionsDuration:de,postDuration:be,timeToCandidate:Ce,totalDuration:Oe,edpInitialConnectDuration:ht,edpInitialConnectRetries:st,edpInitialStateDuration:xt,edpInitialStatePublishingCount:mt,edpStateUpdateCount:Et,sdpExchangeDuration:Fe,sdpExchangeTransport:ot,setRemoteDescDuration:_t,peerConnectionDuration:Tt,sfuResource:U,totalDurationWithRetries:_,subscribeRetryTimes:R,isReassignment:O,protocol:ue}))},trackSubscribeFirstFrame:({peerClientPerfStats:_,totalDurationWithRetries:R,sfuResource:U,retryTimes:ee,currentJitterBufferMinDelayInMs:ue,mediaType:de,firstFrameDuration:be,protocol:Ce})=>{const{sdpExchangeDuration:Oe,sdpExchangeTransport:Fe,setRemoteDescDuration:ot,peerConnectionDuration:_t}=_,{edpInitialConnectDuration:Tt,edpInitialConnectRetries:ht,edpInitialStateDuration:st,edpInitialStatePublishingCount:xt,edpStateUpdateCount:mt}=w;this.analyticsTracker.trackEvent(new Mb({token:this.token,traceId:f,remoteParticipantId:S,edpInitialConnectDuration:Tt,edpInitialConnectRetries:ht,edpInitialStateDuration:st,edpInitialStatePublishingCount:xt,edpStateUpdateCount:mt,sdpExchangeDuration:Oe,sdpExchangeTransport:Fe,setRemoteDescDuration:ot,peerConnectionDuration:_t,videoWasPaused:!1,firstFrameDuration:be,mediaType:de,sfuResource:U,totalDurationWithRetries:R,subscribeRetryTimes:ee,currentJitterBufferMinDelayInMs:ue,protocol:Ce}))},trackSubscribeFailed(_,R,U){const ee=((be,Ce,Oe)=>{if(be instanceof gr)return be;let Fe="";return be instanceof Vo.AxiosError&&(Fe+=`AxiosError - ${be.code}`),new gr(Object.assign(Object.assign(Object.assign({},Xt.SUBSCRIBE_FAILURE),{action:Zs,token:Ce,traceId:Oe,tag:Ji,location:"subscribe",details:`${Fe} ${be?.message}`}),{fatal:!0}))})(_,me,f);se.trackEvent(new Cb({token:me,traceId:f,remoteParticipantId:S,code:ee.code,message:ee.message,fatal:ee.fatal,nominal:ee.nominal,isReassignment:O,protocol:R}));const{isConnected:ue}=w,de=new gr(Object.assign(Object.assign({},Xt.SUBSCRIBE_FAILURE),{action:Y,token:me,traceId:f,tag:vn(Tn.SUBSCRIBE,S),location:"subscribe",remoteParticipantId:S,isEdpConnected:ue,details:U}));return _ instanceof gr&&(de.fatal=_.fatal,de.nominal=_.nominal,de.location=`subscribe > ${_.location}`),se.trackError(de),ee},trackUnsubscribe:()=>{se.trackEvent(new wb({token:me,unsubscribedId:S,traceId:f}))},trackEndSucceeded:(_,R)=>{se.trackEvent(new C_({token:me,traceId:f,remoteParticipantId:S,isUnsubscribeSuccessful:!0,reason:_,protocol:R}))},trackEndFailed:(_,R)=>{const U=new gr(Object.assign(Object.assign({},Xt.UNSUBSCRIBE_FAILURE),{token:me,traceId:f,tag:vn(Tn.SUBSCRIBE,S),location:"unsubscribe",remoteParticipantId:S}));return _!==ai.UNLOAD&&_!==ai.UNSUBSCRIBE||se.trackError(U),se.trackEvent(new C_({token:me,traceId:f,remoteParticipantId:S,isUnsubscribeSuccessful:!0,reason:_,protocol:R})),U}}}}class bs extends $n{constructor(w,O,B,V,Y,se){super(kn.PLAYBACK_LAYER_REQUEST,w,O,!1),Object.assign(this.properties,{media_type:B,remote_participant_id:V,track_id:Y,layer_id:se})}}class _r extends $n{constructor(w,O,B,V,Y,se=1){super(kn.PLAYBACK_LAYER_STATE,w,O,!1),Object.assign(this.properties,{media_type:B,remote_participant_id:V,track_id:Y,request_count:se})}}var Pi,Js,Fl,di;(function(L){L.PAUSE="pause",L.PLAY="play"})(Pi||(Pi={})),(function(L){L.IDLE="idle",L.ACTIVE="active",L.ERRORED="errored",L.DESTROYED="destroyed"})(Js||(Js={})),(function(L){L.SUCCESS="success"})(Fl||(Fl={})),(function(L){L.FAILED="failed",L.DESTROYED="destroyed",L.THROTTLED="throttled"})(di||(di={}));var Qs=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};class bu{constructor(w){this.state=Js.IDLE,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null,this.stopVideo=()=>Qs(this,void 0,void 0,(function*(){return this.state!==Js.ACTIVE?(this.logCommandSkipped("stopVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(Pi.PAUSE)})),this.startVideo=()=>Qs(this,void 0,void 0,(function*(){return this.state!==Js.ACTIVE?(this.logCommandSkipped("startVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(Pi.PLAY)})),this.setLayer=O=>Qs(this,void 0,void 0,(function*(){return this.state!==Js.ACTIVE?(this.logCommandSkipped("setLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest(O)})),this.unsetLayer=()=>Qs(this,void 0,void 0,(function*(){return this.state!==Js.ACTIVE?(this.logCommandSkipped("unsetLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest()})),this.getLayers=()=>Qs(this,void 0,void 0,(function*(){return this.state!==Js.ACTIVE?(this.logCommandSkipped("getLayers"),this.mapSkippedResultFromState(this.state)):this.sendLayerStateRequest()})),this.sendPlaybackRequest=O=>Qs(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,Pn.err)(di.FAILED);if(!this.playbackEndpoint)return this.logger.warn({msg:"Playback endpoint is unset and required for playback control requests"}),(0,Pn.err)(di.FAILED);this.logger.info({msg:`Sending ${O} request to ${this.playbackEndpoint}`});const B=O===Pi.PAUSE?{pause:[this.mid]}:{play:[this.mid]},V=this.createPostWhepRequest(B);return fetch(this.playbackEndpoint,V).then((Y=>{if(Y.status>=300){const se=new Error(`Error sending media controls request: ${Y.status}:${Y.statusText}`);return this.logger.error({err:se}),(0,Pn.err)(di.FAILED)}return this.logger.debug({msg:`Request to ${O} was successful: ${Y.status}`}),(0,Pn.ok)(Fl.SUCCESS)})).catch((Y=>(this.logger.error({err:Y,msg:"Error sending media controls request"}),(0,Pn.err)(di.FAILED))))})),this.sendLayerRequest=O=>Qs(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,Pn.err)(di.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,Pn.err)(di.FAILED);const B=typeof O=="string",V=B?{mediaId:this.mid,encodingId:O}:{},Y=B?`set : ${O}`:"unset layer";this.logger.info({msg:`sendLayerRequest for ${Y} at ${this.layersEndpoint}`});const se=this.createPostWhepRequest(V);return this.trackLayerRequest(O??"auto"),fetch(this.layersEndpoint,se).then((me=>this.state===Js.DESTROYED?(0,Pn.err)(di.DESTROYED):me.status>=300?this.handleLayerRequestError(me.status,me.statusText):(this.logger.debug({msg:`Request to ${Y} was successful: ${me.status}`}),(0,Pn.ok)(Fl.SUCCESS)))).catch((me=>this.handleLayerRequestError(0,me.message)))})),this.sendLayerStateRequest=()=>Qs(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,Pn.err)(di.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,Pn.err)(di.FAILED);this.logger.info({msg:`sendLayerStateRequest for ${this.mid} at ${this.layersEndpoint}`});const O=this.createGetWhepRequest();return this.trackLayerStateRequest(),fetch(this.layersEndpoint,O).then((B=>Qs(this,void 0,void 0,(function*(){var V;if(this.state===Js.DESTROYED)return(0,Pn.err)(di.DESTROYED);if(B.status>=300)return this.handleLayerStateRequestError(B.status,B.statusText);const Y=yield B.json(),se=(V=Y?.layers)!==null&&V!==void 0?V:[],me=JSON.stringify(se,null,2);return this.logger.debug({msg:`sendLayerStateRequest was successful: ${me}`}),(0,Pn.ok)(se)})))).catch((B=>this.handleLayerStateRequestError(0,B.message)))})),this.logger=new on(w.logger,le.REMOTE_PLAYBACK),this.token=w.token,this.traceId=w.traceId,this.analyticsTracker=w.analyticsTracker,this.remoteParticipantId=w.remoteParticipantId}set mediaId(w){if(this.state!==Js.DESTROYED){if(this.mid=w,this.mid===null)return this.logger.info({msg:"media id is unset, controller is transitioning to idle state"}),void(this.state=Js.IDLE);(this.playbackEndpoint||this.layersEndpoint)&&(this.state=Js.ACTIVE)}else this.logCommandSkipped("set mediaId")}set endpoints(w){var O,B;if(this.state!==Js.DESTROYED){if(this.playbackEndpoint=(O=w.playback)!==null&&O!==void 0?O:null,this.layersEndpoint=(B=w.layers)!==null&&B!==void 0?B:null,!this.playbackEndpoint||!this.layersEndpoint){const V={playbackEndpoint:this.playbackEndpoint,layersEndpoint:this.layersEndpoint};return this.logger.info({msg:`no endpoints are set, transitioning to idle state: ${JSON.stringify(V,null)}`}),void(this.state=Js.IDLE)}this.mid&&(this.state=Js.ACTIVE)}else this.logCommandSkipped("set endpoints")}destroy(){this.state=Js.DESTROYED,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null}logCommandSkipped(w="command"){this.logger.info({msg:`skipping ${w}, controller state invalid: ${this.state}`})}mapSkippedResultFromState(w){return w===Js.DESTROYED?(0,Pn.err)(di.DESTROYED):(0,Pn.err)(di.FAILED)}createPostWhepRequest(w){return{method:"POST",headers:this.createRequestHeaders(),body:JSON.stringify(w)}}createGetWhepRequest(){return{method:"GET",headers:this.createRequestHeaders()}}createRequestHeaders(){var w,O;return{Authorization:`Bearer ${this.token.rawToken}`,"Content-Type":"application/json","X-Stages-Platform":"web","X-Stages-Request-ID":Hi().value,"X-Stages-SDK":"1.27.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":(O=(w=this.traceId)===null||w===void 0?void 0:w.value)!==null&&O!==void 0?O:"","X-Stages-WHIP-Version":qu}}trackLayerRequest(w){var O;this.analyticsTracker.trackEventNoSharedProps(new bs(this.token,this.traceId,vr.VIDEO,this.remoteParticipantId,(O=this.mid)!==null&&O!==void 0?O:"unknown",w))}trackLayerStateRequest(w=1){var O;this.analyticsTracker.trackEventNoSharedProps(new _r(this.token,this.traceId,vr.VIDEO,this.remoteParticipantId,(O=this.mid)!==null&&O!==void 0?O:"unknown",w))}handleLayerRequestError(w,O){const B=`sendLayerRequest failed for reason: ${w} ${O}`;let V,Y;return w===429?(V=di.THROTTLED,Y=Xt.WHEP_SET_LAYER_REQUEST_THROTTLED):(V=di.FAILED,Y=Xt.WHEP_SET_LAYER_REQUEST_FAILED),this.trackRequestError(Y,B),(0,Pn.err)(V)}handleLayerStateRequestError(w,O){const B=`sendLayerStateRequest failed for reason: ${w} ${O}`;let V,Y;return w===429?(V=di.THROTTLED,Y=Xt.WHEP_GET_LAYER_STATE_THROTTLED):(V=di.FAILED,Y=Xt.WHEP_GET_LAYER_STATE_FAILED),this.trackRequestError(Y,B),(0,Pn.err)(V)}trackRequestError(w,O){const B=new Error(O);this.logger.error({err:B}),w.message=O;const V=this.createError(w);this.analyticsTracker.trackError(V)}createError(w,O){return new gr(Object.assign({action:Tn.SUBSCRIBE,traceId:this.traceId,token:this.token,location:"RemotePlaybackController",tag:Ji,details:O},w))}}var cs,Qi,si,ao,zc=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))},yc=function(L,w,O,B){if(typeof w=="function"?L!==w||!B:!w.has(L))throw new TypeError("Cannot read private member from an object whose class did not declare it");return O==="m"?B:O==="a"?B.call(L):B?B.value:w.get(L)};(function(L){L.DISCONNECTED="disconnected",L.CONNECTING="connecting",L.CONNECTED="connected",L.ERRORED="errored"})(si||(si={})),(function(L){L.NONE="none",L.AUDIO_ONLY="audio_only",L.AUDIO_VIDEO="audio_video"})(ao||(ao={}));class Xn extends Zc{constructor(w,O,B,V,Y,se,me){super(),this.id=w,this.token=O,this.stageConnection=B,this.nonScopedLogger=V,this.analyticsTracker=Y,this.desiredSubscribeType=se,cs.add(this),this.isSubscriptionActive=!1,this.subscriptionState={connectionState:si.DISCONNECTED,subscribeInProgress:!1},this.previousSignalState={isTargetPublishing:!1},this.failedRetries=0,this.startConnectingTimestamp=-1,this.throttler=new mc(1e3),this.cleanupFirstFrameTracking=fp,this.actualSubscribeType=ao.NONE,this.action=Tn.SUBSCRIBE,this.updateDesiredSubscribeType=f=>{this.desiredSubscribeType=f,this.attemptToActualizeSubscribeType()},this.updateSubscribeConfig=f=>{this.peerClient.updateSubscribeConfig(f)},this.getDesiredSubscribeType=()=>this.desiredSubscribeType,this.attemptToActualizeSubscribeType=()=>{const f=this.actualSubscribeType,_=this.desiredSubscribeType;this.logger.debug({msg:`Attempt to actualize subscribe type to ${_}`}),this.subscriptionState.connectionState===si.CONNECTED&&_!==ao.NONE&&f!==_&&this.applyVideoControlsBySubscribeType(_,f)},this.onParticipantUpdated=f=>{yc(this,cs,"m",Qi).call(this,f)&&(this.logger.debug({msg:"onParticipantUpdated",participant:f}),this.processStateUpdate({isTargetPublishing:f.isPublishing}))},this.onParticipantJoined=f=>{yc(this,cs,"m",Qi).call(this,f)&&(this.logger.debug({msg:"onParticipantJoined",participant:f}),this.processStateUpdate({isTargetPublishing:f.isPublishing}))},this.onParticipantLeft=f=>{yc(this,cs,"m",Qi).call(this,f)&&(this.logger.debug({msg:"onParticipantLeft",participant:f}),this.processStateUpdate({isTargetPublishing:!1}))},this.onPeerClientConnectionStateChange=f=>{const _=this.stageConnection.getParticipant(this.id);this.logger.debug({msg:`onPeerClientConnectionStateChange: ${f}`,state:f,targetParticipant:_}),this.processStateUpdate({peerClientState:f})},this.onPeerClientTransformError=f=>{this.emit(so,f)},this.onSdpNegotiated=f=>{this.remotePlaybackController.endpoints={playback:f.mediaControls,layers:f.layerControls}},this.seiMessageHandler=f=>{this.emit(kl,f)},this.requestRTCStats=f=>zc(this,void 0,void 0,(function*(){return this.peerClient.requestRTCStats(f)})),this.trySubscribe=f=>zc(this,void 0,void 0,(function*(){var _,R;if(this.logger.debug({msg:`Subscribe attempt started: ${f}`}),!this.isSubscriptionActive)return this.logger.warn({msg:"Subscribe attempt invalid: Subscription is inactive"}),!1;this.logger.debug({msg:"Subscribe attempt is valid."}),this.startConnectingTimestamp<0&&(this.startConnectingTimestamp=performance.now()),this.subscriptionState.connectionState!==si.ERRORED&&(this.logger.debug({msg:"Updating state to CONNECTING"}),this.updateState({connectionState:si.CONNECTING}));const U=this.stageConnection.getConnectionStats(),ee=this.peerClient.getExpectedJitterBufferMinDelayInMs(),ue=this.peerClient.getSfuResource();this.attemptTracker=this.subscribeTracker.trackAttempt({stageConnectionStats:U,preAttemptSfuResource:ue});try{this.remotePlaybackController.traceId=this.attemptTracker.getTraceId();const{mediaStream:de}=yield this.subscribe(this.attemptTracker.getTraceId()),be=performance.now()-this.startConnectingTimestamp,Ce=this.peerClient.getSfuResource();this.remotePlaybackController.mediaId=this.peerClient.videoMediaId;const Oe=this.failedRetries;this.attemptToActualizeSubscribeType();const Fe=this.peerClient.getActionMeasurements(),ot=this.peerClient.getProtocol();if(this.attemptTracker.trackSubscribeStarted({sfuResource:Ce,totalDurationWithRetries:be,retryTimes:Oe,peerClientPerfStats:Fe,protocol:ot}),de){this.cleanupFirstFrameTracking();const _t=this.actualSubscribeType,Tt=this.attemptTracker,ht=(st,xt)=>{Tt.trackSubscribeFirstFrame({peerClientPerfStats:Fe,sfuResource:Ce,totalDurationWithRetries:be,retryTimes:Oe,currentJitterBufferMinDelayInMs:ee,mediaType:xt,firstFrameDuration:st,protocol:ot})};this.cleanupFirstFrameTracking=this.measureFirstFrameDuration({mediaStream:de,subscribeType:_t,callback:ht})}return this.throttler.clear(),this.failedRetries=0,this.startConnectingTimestamp=-1,de&&this.emit(Ls,de,this.remotePlaybackController),this.logger.debug({msg:"Subscribe attempt succeeded"}),!0}catch(de){const be=(R=(_=this.peerClient)===null||_===void 0?void 0:_.getProtocol())!==null&&R!==void 0?R:"",Ce=this.attemptTracker.trackSubscribeFailed(de,be);this.logger.error({log:"Subscribe attempt failed",err:de}),this.onTrySubscribeFailure(Ce,f)}return!1}));const S=os();this.peerClient=new Ya(O,this.nonScopedLogger,this.action,vn(this.action,w),S,Y,w,B,me),this.logger=new on(V,le.SUBSCRIPTION),this.subscribeTracker=new Ia(this.analyticsTracker,O,w),this.remotePlaybackController=new bu({token:O,analyticsTracker:Y,traceId:S,logger:this.nonScopedLogger,remoteParticipantId:this.id})}applyVideoControlsBySubscribeType(w,O){try{w===ao.AUDIO_ONLY?this.remotePlaybackController.stopVideo().catch((B=>{this.logger.error({err:B,msg:"Remote playback request to stop video failed"})})):w===ao.AUDIO_VIDEO&&this.remotePlaybackController.startVideo().catch((B=>{this.logger.error({err:B,msg:"Remote playback request to start video failed"})})),this.actualSubscribeType=w,this.logger.debug({msg:`Desired subscribe type actualized from ${O} to ${w}.`})}catch(B){this.logger.error({err:B,msg:`Error updating subscribe type from ${O} to ${w}.`})}}processStateUpdate(w){const O=this.previousSignalState,B=Object.assign({},O,w);if(!this.isSubscriptionActive)return void this.logger.warn({msg:"Unexpected processStateUpdate when subscription is inactive"});B.isTargetPublishing?w.peerClientState===jn.CONNECTED?this.updateState({connectionState:si.CONNECTED,subscribeInProgress:!0}):w.peerClientState===jn.FAILED&&this.subscriptionState.subscribeInProgress&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(ai.CONNECTION_FAIL,this.peerClient.getProtocol()),this.updateState({subscribeInProgress:!1}),this.emit(tl)):(O.isTargetPublishing&&this.subscriptionState.subscribeInProgress&&(this.logger.debug({msg:"Scheduling an unsubscribe on the event loop"}),this.unsubscribe()),this.throttler.clear(),this.updateState({connectionState:si.DISCONNECTED}));const V=!O.isTargetPublishing&&w.isTargetPublishing,Y=this.subscriptionState.connectionState===si.CONNECTED&&w.peerClientState===jn.FAILED;(V||Y)&&this.throttledTrySubscribe("onSignalState change: isTargetPublishing is now true"),Object.assign(this.previousSignalState,w)}onTrySubscribeFailure(w,O){this.logger.debug({msg:"Changing/keeping state FAILED"});const B=w.fatal,V=w.code===Xt.OPERATION_ABORTED.code,Y=this.failedRetries<=4;if(!V&&!B&&Y){const se=1e3*Math.pow(2,this.failedRetries);this.logger.debug({msg:`Retrying in ${se}ms`}),this.failedRetries++,this.nextAttemptTimerId=window.setTimeout((()=>zc(this,void 0,void 0,(function*(){this.throttledTrySubscribe(O)}))),se)}else this.updateState({connectionState:si.ERRORED}),this.emit(lp,w),this.onTerminalFailure()}onTerminalFailure(){this.previousSignalState.isTargetPublishing=!1,this.startConnectingTimestamp=-1,this.failedRetries=0}start(){this.isSubscriptionActive=!0,this.peerClient.on(yo,this.onPeerClientConnectionStateChange),this.peerClient.on(fu,this.onSdpNegotiated),this.peerClient.on(hu,this.seiMessageHandler),this.peerClient.on(Lu,this.onPeerClientTransformError),this.stageConnection.on(xf,this.onParticipantUpdated),this.stageConnection.on(oh,this.onParticipantJoined),this.stageConnection.on(ap,this.onParticipantLeft),this.stageConnection.on(Am,this.onParticipantLeft);let w=!0;if(this.stageConnection.isConnected()){const O=this.stageConnection.getParticipant(this.id);w=!!O?.isPublishing}this.processStateUpdate({isTargetPublishing:w})}throttledTrySubscribe(w){return this.throttler.invoke(this.trySubscribe,w)}updateState(w){w.subscribeInProgress!==void 0&&(this.subscriptionState.subscribeInProgress=w.subscribeInProgress),w.connectionState&&this.subscriptionState.connectionState!==w.connectionState&&(this.subscriptionState.connectionState=w.connectionState,this.emit($a,this.subscriptionState.connectionState))}stop(w=!1){this.peerClient.off(yo,this.onPeerClientConnectionStateChange),this.peerClient.off(Lu,this.onPeerClientTransformError),this.peerClient.off(fu,this.onSdpNegotiated),this.peerClient.off(hu,this.seiMessageHandler),this.unsubscribe(w),this.throttler.clear(),this.stageConnection.off(xf,this.onParticipantUpdated),this.stageConnection.off(oh,this.onParticipantJoined),this.stageConnection.off(ap,this.onParticipantLeft),this.stageConnection.off(Am,this.onParticipantLeft),this.isSubscriptionActive=!1,this.updateState({connectionState:si.DISCONNECTED})}isActive(){return this.isSubscriptionActive}subscribe(w,O){return zc(this,void 0,void 0,(function*(){const{token:B,id:V}=this;B.assertTokenIsUnexpired(w,vn(Tn.SUBSCRIBE,V),"subscribe",V);const{mediaStream:Y}=yield this.peerClient.connect({audioOnly:O,traceId:w});return{peerClient:this.peerClient,mediaStream:Y}}))}unsubscribe(w=!1){return zc(this,void 0,void 0,(function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.remotePlaybackController.destroy(),!this.isSubscriptionActive||!this.attemptTracker||this.subscriptionState.connectionState===si.DISCONNECTED)return;this.cleanupFirstFrameTracking(),this.attemptTracker.trackUnsubscribe();const O=w?ai.UNLOAD:ai.UNSUBSCRIBE,B=this.peerClient.getProtocol();try{w?this.peerClient.disconnect(w):yield this.peerClient.disconnect(w),this.updateState({subscribeInProgress:!1}),this.attemptTracker.trackEndSucceeded(O,B)}catch{this.attemptTracker.trackEndFailed(O,B)}}))}triggerIceRestart(w){var O;return zc(this,void 0,void 0,(function*(){const B=this.stageConnection.getConnectionStats(),V=this.peerClient.getSfuResource(),Y=this.subscribeTracker.trackAttempt({stageConnectionStats:B,isReassignment:!0,traceIdOverride:w.traceId,preAttemptSfuResource:V}),se=performance.now();try{this.emit(Mm),this.logger.debug({msg:`Triggering attempt. Current node: ${this.peerClient.getSfuResource().node}`}),yield this.peerClient.connect({iceRestartOptions:w,traceId:w.traceId}),this.logger.debug({msg:`Successful ICE restart attempt. Current node: ${this.peerClient.getSfuResource().node}`});const me=performance.now()-se,S=this.peerClient.getSfuResource(),f=this.peerClient.getActionMeasurements();(O=this.attemptTracker)===null||O===void 0||O.trackEndSucceeded(ai.REASSIGNMENT,this.peerClient.getProtocol()),this.applyVideoControlsBySubscribeType(this.actualSubscribeType,this.actualSubscribeType),Y.trackSubscribeStarted({totalDurationWithRetries:me,sfuResource:S,retryTimes:0,peerClientPerfStats:f,protocol:this.peerClient.getProtocol()}),this.emit(f_)}catch(me){this.emit(Tf),this.logger.error({msg:"ICE restart attempt failed",err:me});const S=this.peerClient.getSfuResource(),f=Y.trackSubscribeFailed(me,this.peerClient.getProtocol(),`iceRestart=true, startNode=${V.node}, endNode=${S?.node}`);throw f.code===Xt.SUBSCRIBE_TIMED_OUT.code&&this.onTrySubscribeFailure(f,"ice restart timeout"),me}}))}measureFirstFrameDuration({mediaStream:w,subscribeType:O,callback:B}){const V=performance.now(),Y=S=>{const f=performance.now()-V;B(f,S),S==="audio"?me():se()};let se=fp,me=fp;return O!==ao.AUDIO_ONLY&&(se=(function(S,f){return hp(S,"video",f)})(w,Y)),me=(function(S,f){return hp(S,"audio",f)})(w,Y),()=>{se(),me()}}}var Wn,An;cs=new WeakSet,Qi=function(L){return L.id===this.id},(function(L){L.JOIN_ERROR="JOIN_ERROR",L.PUBLISH_ERROR="PUBLISH_ERROR",L.SUBSCRIBE_ERROR="SUBSCRIBE_ERROR"})(Wn||(Wn={})),(function(L){L[L.TOKEN_MALFORMED=1]="TOKEN_MALFORMED",L[L.TOKEN_EXPIRED=2]="TOKEN_EXPIRED",L[L.TIMEOUT=3]="TIMEOUT",L[L.FAILED=4]="FAILED",L[L.CANCELED=5]="CANCELED",L[L.STAGE_AT_CAPACITY=6]="STAGE_AT_CAPACITY",L[L.CODEC_MISMATCH=7]="CODEC_MISMATCH",L[L.TOKEN_NOT_ALLOWED=8]="TOKEN_NOT_ALLOWED",L[L.STAGE_DELETED=9]="STAGE_DELETED",L[L.PARTICIPANT_DISCONNECTED=10]="PARTICIPANT_DISCONNECTED"})(An||(An={}));const eo={[An.TOKEN_MALFORMED]:"Token is malformed",[An.TOKEN_EXPIRED]:"Token expired and is no longer valid",[An.TIMEOUT]:"Operation timed out",[An.FAILED]:"Operation failed",[An.CANCELED]:"Operation canceled",[An.STAGE_AT_CAPACITY]:"Stage at capacity",[An.CODEC_MISMATCH]:"Client codec is not supported",[An.TOKEN_NOT_ALLOWED]:"Token not allowed to perform operation",[An.STAGE_DELETED]:"Stage has been deleted, unable to join",[An.PARTICIPANT_DISCONNECTED]:"Participant has been disconnected, unable to join"},Wr={[Xt.EXPIRED_TOKEN.code]:An.TOKEN_EXPIRED,[Xt.MALFORMED_TOKEN.code]:An.TOKEN_MALFORMED,[Xt.JOIN_SERVER_BAD_REQUEST.code]:An.FAILED,[Xt.TOKEN_PERMISSIONS_DENIED.code]:An.TOKEN_NOT_ALLOWED,[Xt.OPERATION_ABORTED.code]:An.CANCELED,[Xt.JOIN_TIMED_OUT.code]:An.TIMEOUT,[Xt.STAGE_DELETED.code]:An.STAGE_DELETED,[Xt.PARTICIPANT_DISCONNECTED.code]:An.PARTICIPANT_DISCONNECTED,[Xt.EVENT_PLANE_WS_CREATE_FAILED.code]:An.FAILED,[Xt.PUBLISH_TIMED_OUT.code]:An.TIMEOUT,[Xt.PUBLISH_FAILURE.code]:An.FAILED,[Xt.SUBSCRIBE_TIMED_OUT.code]:An.TIMEOUT,[Xt.SUBSCRIBE_FAILURE.code]:An.FAILED,[Xt.STAGE_AT_CAPACITY.code]:An.STAGE_AT_CAPACITY,[Xt.NO_MATCHING_CODEC.code]:An.CODEC_MISMATCH,[Xt.NETWORK_FAILURE.code]:An.FAILED,[Xt.INTERNAL_SERVER_ERROR.code]:An.FAILED,[Xt.REMOTE_STREAM_NOT_FOUND.code]:An.FAILED,[Xt.INTERNAL_MHCP_ERROR.code]:An.FAILED,[Xt.UNREACHABLE_MHCP.code]:An.FAILED,[Xt.INVALID_SESSION_STATUS.code]:An.FAILED,[Xt.MHCP_ABORTED.code]:An.FAILED,[Xt.EVENT_PLANE_PONG_TIMEOUT.code]:An.FAILED,[Xt.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code]:An.FAILED},Di={[Xt.SEI_INSERT_NOT_PUBLISHING_VIDEO.code]:"SEI insert failed due to not publishing video",[Xt.SEI_INSERT_INBAND_NOT_ENABLED.code]:"SEI insert failed due to in-band messaging not being enabled for the stage stream"};class al extends Error{constructor(w,O,B){super(),this.code=w,this.category=O,this.message=B,this.name="StageError",this.errorDetails=[],this.message=`[${O}] ${B}`}addDetails(w){this.errorDetails.push(w)}get details(){return this.errorDetails.length?JSON.stringify(this.errorDetails):""}toString(){return`
${this.message}
details - ${this.details}
        `.trim()}}var cl,ll,gh;function Ap(L,w){let O;if(L instanceof gr){if(w===Wn.JOIN_ERROR&&(L.code===Xt.EVENT_PLANE_PONG_TIMEOUT.code||L.code===Xt.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code))return;const B=Wr[L.code];B&&(O=(function(V,Y,se){var me,S,f;const _=eo[V],R=new al(V,Y,_);return R.addDetails({stageErrorMessage:_,stageErrorCode:V,stageErrorCategory:Y,stageArn:(me=se.token)===null||me===void 0?void 0:me.stageARN,traceId:(S=se.traceId)===null||S===void 0?void 0:S.value,causeCode:se.code,causeDetails:se.details,causeMessage:se.message,causeLocation:se.location,participantId:(f=se.token)===null||f===void 0?void 0:f.participantID,timeUTC:new Date().toISOString()}),R})(B,w,L))}return O}(function(L){L.ERROR="error"})(cl||(cl={}));class A_ extends Zc{constructor(w){super(),this.logger=w,this.handleError=(O,B,V=!0)=>{const Y=(function(me){let S;return me instanceof gr&&(S=Di[me.code]),S})(O),se=Ap(O,B);if(Y&&this.logger.warn({msg:Y}),se)return V&&this.emit(cl.ERROR,se),se}}}(function(L){L.INTERNAL="internal",L.REMOTE="remote",L.API="api"})(ll||(ll={})),(function(L){L.ADDITIVE="additive",L.REPLACE="replace"})(gh||(gh={}));class Mp{constructor(w){this.logger=new on(w.logger,le.CONNECTION),this.subscribeConfig={defaults:w.subscribeDefaults,participants:{}}}handleSubscribeConfigUpdate(w,O,B,V=gh.REPLACE){O=(_=>{const R=pd(_);if(R.jitterBuffer!==void 0){const U=ee=>{if(typeof ee=="number"){if(ee<0)return 0;if(ee>4e3)return 4e3}return ee};R.jitterBuffer.minDelayWhenPublishing!==void 0&&(R.jitterBuffer.minDelayWhenPublishing=U(R.jitterBuffer.minDelayWhenPublishing)),R.jitterBuffer.minDelayWhenSubscribeOnly!==void 0&&(R.jitterBuffer.minDelayWhenSubscribeOnly=U(R.jitterBuffer.minDelayWhenSubscribeOnly))}return R})(O),this.subscribeConfig.participants[w]===void 0&&(this.subscribeConfig.participants[w]={internalOverrides:{},apiOverrides:{},remoteOverrides:{},lastMerged:this.subscribeConfig.defaults});const Y=this.subscribeConfig.participants[w];switch(B){case ll.INTERNAL:Y.internalOverrides=this.handleSubscribeConfigLevelMerging(Y.internalOverrides,O,V);break;case ll.REMOTE:Y.remoteOverrides=this.handleSubscribeConfigLevelMerging(Y.remoteOverrides,O,V);break;case ll.API:Y.apiOverrides=this.handleSubscribeConfigLevelMerging(Y.apiOverrides,O,V);break;default:(function(_){throw new Error(`Unknown case kind: ${_}`)})(B)}const se=rl(this.subscribeConfig.defaults,Y.internalOverrides,Y.remoteOverrides,Y.apiOverrides);if(se===void 0)return this.logger.warn({msg:`Unable to merge subscribe configs for participant: ${w} | ${Y}, ${O}`}),!1;const me=(S=Y.lastMerged,f=se,(typeof S=="object"&&typeof f=="object"&&(0,ss.isEqual)(S,f))===!1);var S,f;return Y.lastMerged=se,this.subscribeConfig.participants[w]=Y,me}handleExternalSubscribeConfigUpdate(w,O,B,V=gh.REPLACE){const Y=(se=>{const me={};return typeof se!="object"?Pn.err(new Error("Invalid input")):(se.jitterBuffer!==void 0&&(me.jitterBuffer={},se.jitterBuffer.minDelay!==void 0&&(me.jitterBuffer.minDelayWhenSubscribeOnly=se.jitterBuffer.minDelay)),se.inBandMessaging!==void 0&&(me.inBandMessaging={enabled:se.inBandMessaging.enabled===!0}),se.simulcast!==void 0&&(me.simulcast={},se.simulcast.initialLayerPreference!==void 0&&(me.simulcast.initialLayerPreference=se.simulcast.initialLayerPreference)),Pn.ok(me))})(O);return Y.ok===!0&&this.handleSubscribeConfigUpdate(w,Y.value,B,V)}handleSubscribeConfigLevelMerging(w,O,B){if(B===gh.REPLACE)return O;{const V=rl(w,O);return V===void 0?(this.logger.warn({msg:`Unable to merge '${w}' and '${O}' with type ${B}`}),w):V}}getSubscribeConfigSnapshot(w){return this.subscribeConfig.participants[w]===void 0?Us(this.subscribeConfig.defaults):Us(this.subscribeConfig.participants[w].lastMerged)}}class Td extends $n{constructor(w){super(kn.REASSIGNMENT_REQUEST,w.token,w.traceId,!1),Object.assign(this.properties,{target_local_participant_id:w.targetLocalParticipantId,target_remote_participant_id:w.targetRemoteParticipantId}),this.critical=!0}}var Zo,pa,Eu,ls,Mr,co=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};class kp extends Zc{constructor(w,O){super(),this.setGetStats=B=>{this._getInternalStats=B},this.getStats=()=>co(this,void 0,void 0,(function*(){return this.requestRTCStats()})),this.requestRTCStats=()=>co(this,void 0,void 0,(function*(){if(!this._getInternalStats)return;const B=yield this._getInternalStats(this.mediaStreamTrack);return B?B.rawReport:void 0})),this._getInternalStats=O,this.id=w.id,this.isMuted=!w.enabled,this.mediaStreamTrack=w,this.streamType=this.mediaStreamTrack.kind==="audio"?vr.AUDIO:vr.VIDEO}cleanup(){this.removeAllListeners(),this._getInternalStats=void 0}}(function(L){L.IDLE="IDLE",L.INITIALIZING="INITIALIZING",L.ACTIVE="ACTIVE",L.CONTROLS_PAUSED="CONTROLS_PAUSED",L.DESTROYED="DESTROYED"})(Zo||(Zo={})),(function(L){L.LAYERS_CHANGED="LAYERS_CHANGED",L.LAYER_SELECTED="LAYER_SELECTED",L.ADAPTION_CHANGED="ADAPTION_CHANGED"})(pa||(pa={})),(function(L){L.LAYERS_CHANGED="LAYERS_CHANGED",L.LAYER_SELECTED="LAYER_SELECTED",L.ADAPTION_CHANGED="ADAPTION_CHANGED"})(Eu||(Eu={})),(function(L){L.UNAVAILABLE="unavailable",L.SELECTED="selected"})(ls||(ls={})),(function(L){L.LOCAL_STREAM_MUTE_CHANGED="localStreamMutedChanged",L.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST="localStreamInsertSeiMsgRequest"})(Mr||(Mr={}));var Wu,Ms,ma,wd=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};class kf extends kp{constructor(w,O){super(w),this.setMuted=B=>{B!==this.isMuted&&(this.mediaStreamTrack.enabled=!B,this.isMuted=B,this.emit(Mr.LOCAL_STREAM_MUTE_CHANGED,this))},this.insertSeiMessage=(B,V)=>wd(this,void 0,void 0,(function*(){let Y;if(this.streamType==="audio")Y=ys.INVALID_TRACK_TYPE;else if(this.mediaConfig.inBandMessaging.enabled){const se=this.validator.validateMessagePayload(B,V?.repeatCount||0);Y=Pn.getErr(se)}else Y=ys.INBAND_MESSAGING_NOT_ENABLED;Y?console.warn(`Unable to insert SEI message due to ${Y}`):this.emit(Mr.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this,B,V)})),this.requestQualityStats=()=>wd(this,void 0,void 0,(function*(){if(!this._getInternalStats)return;const B=yield this._getInternalStats(this.mediaStreamTrack);return B?B.stats:void 0})),this.validatedExternalConfig=Vg(w,O),this.normalizedConfig=Qv(0,this.validatedExternalConfig),this.mediaConfig=(0,ss.cloneDeep)(this.normalizedConfig),this.validator=new kb(Pc)}}class jl{constructor(w,O){this.strategy=w,this.logger=O}setStrategy(w){this.strategy=w}hasStrategy(w){return this.strategy[w]!==void 0}stageStreamsToPublish(){let w=[];try{w=this.strategy.stageStreamsToPublish(),w=w.filter((V=>V instanceof kf))}catch(V){return this.logger.warn({msg:"error executing stageStreamsToPublish treating this as a no-op",err:V}),console.error("Error executing stageStreamsToPublish",V),Pn.err(V)}let O=0,B=0;for(const V of w)V.mediaStreamTrack.kind==="audio"?O++:V.mediaStreamTrack.kind==="video"&&B++;if(O>1||B>1){const V=Error("stageStreamsToPublish strategy function returned more than 1 video or audio stream and as a result will not publish",{cause:"UserStrategy"});return Pn.err(V)}return Pn.ok(w)}shouldPublishParticipant(w){try{return Pn.ok(this.strategy.shouldPublishParticipant(w))}catch(O){return this.logger.warn({msg:"error executing shouldPublishParticipant treating this as a no-op",err:O}),console.error("Error executing shouldPublishParticipant",O),Pn.err(O)}}shouldSubscribeToParticipant(w){try{return Pn.ok(this.strategy.shouldSubscribeToParticipant(w))}catch(O){return this.logger.warn({msg:"error executing shouldSubscribeToParticipant. Treating it as a no-op",err:O}),console.error("Error executing shouldSubscribeToParticipant",O),Pn.err(O)}}subscribeConfiguration(w){var O,B;try{return Pn.ok((B=(O=this.strategy).subscribeConfiguration)===null||B===void 0?void 0:B.call(O,w))}catch(V){return this.logger.warn({msg:"error executing subscribeConfiguration. Treating it as a no-op",err:V}),console.error("Error executing subscribeConfiguration",V),Pn.err(V)}}preferredLayerForStream(w,O){var B,V;try{return Pn.ok((V=(B=this.strategy).preferredLayerForStream)===null||V===void 0?void 0:V.call(B,w,O))}catch(Y){return this.logger.warn({msg:"error executing preferredLayerForStream. Treating it as a no-op",err:Y}),console.error("Error executing preferredLayerForStream",Y),Pn.err(Y)}}}class Su extends Zc{constructor(w,O){super(),this.audioMuted=!0,this.videoStopped=!0,this.publishState=Ms.NOT_PUBLISHED,this.logger=O,this.info=w,this.audioMuted=w.audioMuted,this.videoStopped=w.videoStopped}}(function(L){L.PUBLISH="publish",L.SUBSCRIBE="subscribe"})(Wu||(Wu={})),(function(L){L.NOT_PUBLISHED="not_published",L.ATTEMPTING_PUBLISH="attempting_publish",L.PUBLISHED="published",L.ERRORED="errored"})(Ms||(Ms={})),(function(L){L.NOT_SUBSCRIBED="not_subscribed",L.ATTEMPTING_SUBSCRIBE="attempting_subscribe",L.SUBSCRIBED="subscribed",L.ERRORED="errored"})(ma||(ma={}));function Of(L){return L.map((w=>w.remote))}function Qg(L){return{label:L.encodingId,bitrateBps:1e3*L.bitrate,width:L.width,height:L.height,framesPerSecond:L.framesPerSecond,selected:L.selected}}function _h(L,w){const O=L.width*L.height,B=w.width*w.height;return O>B||L.bitrateBps>w.bitrateBps||L.framesPerSecond>w.framesPerSecond?1:O===B&&L.bitrateBps===w.bitrateBps&&L.framesPerSecond===w.framesPerSecond?0:-1}var Op=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};class ul extends Zc{constructor(w){var O,B,V;super(),this.onAdaptionChanged=Y=>{this.emit(Eu.ADAPTION_CHANGED,Y)},this.onLayersChanged=Y=>{this.emit(Eu.LAYERS_CHANGED,Y)},this.onLayerSelected=(Y,se)=>{this.emit(Eu.LAYER_SELECTED,Y,se)},this.setGetStats=()=>{},this.requestRTCStats=()=>Op(this,void 0,void 0,(function*(){var Y;return(Y=this.internalStream)===null||Y===void 0?void 0:Y.requestRTCStats()})),this.requestQualityStats=()=>Op(this,void 0,void 0,(function*(){if(this.internalStream)try{const Y=yield this.internalStream.getInternalStats();return Y?Y.stats:void 0}catch{return}})),this.getStats=()=>Op(this,void 0,void 0,(function*(){var Y;return(Y=this.internalStream)===null||Y===void 0?void 0:Y.requestRTCStats()})),this.setMuted=Y=>{var se;(se=this.internalStream)===null||se===void 0||se.setMuted(Y)},this.getLayers=()=>{var Y,se;return(se=(Y=this.internalStream)===null||Y===void 0?void 0:Y.layers)!==null&&se!==void 0?se:this.cachedLayers},this.getSelectedLayer=()=>{var Y,se;return(se=(Y=this.internalStream)===null||Y===void 0?void 0:Y.selectedLayer)!==null&&se!==void 0?se:this.cachedSelectedLayer},this.getLowestQualityLayer=()=>{var Y,se;return(se=(Y=this.internalStream)===null||Y===void 0?void 0:Y.lowestQualityLayer)!==null&&se!==void 0?se:this.cachedLowestLowestLayer},this.getHighestQualityLayer=()=>{var Y,se;return(se=(Y=this.internalStream)===null||Y===void 0?void 0:Y.highestQualityLayer)!==null&&se!==void 0?se:this.cachedHighestQualityLayer},this.internalStream=w,this.cachedId=this.internalStream.id,this.cachedParticipantInfo=(0,ss.cloneDeep)(this.internalStream.participantInfo),this.cachedStreamType=this.internalStream.streamType,this.cachedMediaStreamTrack=(V=(B=(O=this.internalStream.mediaStreamTrack).clone)===null||B===void 0?void 0:B.call(O))!==null&&V!==void 0?V:{},this.cachedIsMuted=this.internalStream.isMuted,this.cachedIsAdapting=this.internalStream.isAdapting,this.cachedLayers=this.internalStream.layers,this.updateCachedStreamData(),this.internalStream.on(pa.ADAPTION_CHANGED,this.onAdaptionChanged),this.internalStream.on(pa.LAYERS_CHANGED,this.onLayersChanged),this.internalStream.on(pa.LAYER_SELECTED,this.onLayerSelected)}updateCachedStreamData(){var w,O,B,V,Y;this.cachedLayers=(O=(w=this.internalStream)===null||w===void 0?void 0:w.layers)!==null&&O!==void 0?O:[],this.cachedHighestQualityLayer=(B=this.internalStream)===null||B===void 0?void 0:B.highestQualityLayer,this.cachedLowestLowestLayer=(V=this.internalStream)===null||V===void 0?void 0:V.lowestQualityLayer,this.cachedSelectedLayer=(Y=this.internalStream)===null||Y===void 0?void 0:Y.selectedLayer}get id(){var w,O;return(O=(w=this.internalStream)===null||w===void 0?void 0:w.id)!==null&&O!==void 0?O:this.cachedId}get participantInfo(){var w,O;return(O=(w=this.internalStream)===null||w===void 0?void 0:w.participantInfo)!==null&&O!==void 0?O:this.cachedParticipantInfo}get streamType(){var w,O;return(O=(w=this.internalStream)===null||w===void 0?void 0:w.streamType)!==null&&O!==void 0?O:this.cachedStreamType}get mediaStreamTrack(){var w,O;return(O=(w=this.internalStream)===null||w===void 0?void 0:w.mediaStreamTrack)!==null&&O!==void 0?O:this.cachedMediaStreamTrack}get isMuted(){var w,O;return(O=(w=this.internalStream)===null||w===void 0?void 0:w.isMuted)!==null&&O!==void 0?O:this.cachedIsMuted}set isMuted(w){var O;(O=this.internalStream)===null||O===void 0||O.setMuted(w)}get isAdapting(){var w,O;return(O=(w=this.internalStream)===null||w===void 0?void 0:w.isAdapting)!==null&&O!==void 0?O:this.cachedIsAdapting}cleanup(){var w,O,B;this.updateCachedStreamData(),(w=this.internalStream)===null||w===void 0||w.off(pa.ADAPTION_CHANGED,this.onAdaptionChanged),(O=this.internalStream)===null||O===void 0||O.off(pa.LAYERS_CHANGED,this.onLayersChanged),(B=this.internalStream)===null||B===void 0||B.off(pa.LAYER_SELECTED,this.onLayerSelected),this.internalStream=void 0,this.removeAllListeners()}}var fl,So,vh=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};class qr extends kp{constructor({track:w,info:O,getStats:B,remotePlaybackController:V,analyticsTracker:Y,token:se,subscribeConfig:me}){super(w,B),this.hasRemoteListenersForLayerEvents=()=>{const f=this.remote;return f.hasListenersFor(Eu.ADAPTION_CHANGED)||f.hasListenersFor(Eu.LAYERS_CHANGED)||f.hasListenersFor(Eu.LAYER_SELECTED)},this.setMuted=f=>{this.isMuted=f,this.mediaStreamTrack.enabled=!f},this.setLayer=f=>{const _=(0,ss.cloneDeep)(f);if(this.queueLayerUpdateForValidState(_))return void this.logger.debug({msg:`setLayer:${_} queued, skipping for now`});const R=(function(ee,ue){if(!ee)return(0,Pn.ok)(void 0);const de=typeof ee=="string"?ee:ee.label,be=ue.filter((Ce=>Ce.label===de))[0];return be?(0,Pn.ok)(be):(0,Pn.err)(`Provided layer with id ${de} does not exist`)})(_,this._layers);if(!R.ok){const ee=R.error;return void this.logger.error({err:ee,msg:"Unable to select layer, skipping selection"})}const U=R.value;if(this.isNextUpdateAdaptionOnly(U))return this.logger.warn({msg:"setLayer:dynamic"}),void this.handleDynamicUpdate();this.isFirstLayerUpdate()||!this.isRepeatLayerSelection(U)||this.isAdapting?U&&(this.logger.warn({msg:`setLayer:${JSON.stringify(U)} `}),this.handleManualUpdate(U)):this.logger.debug({msg:"Setting the same layer, same adaption state, skipping selection"})},this.state=Zo.INITIALIZING,this.prevState=Zo.IDLE,this.analyticsTracker=Y,this.token=se,this.id=w.id,this.info=O,this.mediaStreamTrack=w,this.remotePlaybackController=V,this.layerPollingIntervalId=null,this.weakRemoteMap=new WeakMap,this.weakRemoteKey={id:"remote"},this.commandMap=new Map,this.subscribeConfig=me,this._isAdapting=!0,this._layers=[],this._selectedLayer=null;const S=mm();this.logger=new on(new zt(S),le.REMOTE_STAGE_STREAM),this.streamType===vr.AUDIO?this.isMuted=O.audioMuted:this.isMuted=O.videoStopped,this.initializeLayerPolling(),this.pollInternalLayers(!0)}transitionStateTo(w){this.state!==w&&(this.prevState=this.state,this.state=w)}initializeLayerPolling(){Yn(this.mediaStreamTrack)?this.streamType!==vr.AUDIO?(this.logger.debug({msg:"Setting up RemoteStageStream, requesting initial layers"}),this.layerPollingIntervalId!==null&&clearInterval(this.layerPollingIntervalId),this.layerPollingIntervalId=setInterval((()=>{this.pollInternalLayers()}),this.subscribeConfig.simulcast.layerPollingIntervalMs)):this.logger.debug({msg:"Skipping initializing polling for audio streams"}):this.logger.debug({msg:"Skipping initializing polling, media track is not active"})}startLayerPolling(){this.layerPollingIntervalId===null?this.initializeLayerPolling():this.logger.debug({msg:"Skipping start polling request, already started"})}stopLayerPolling(){this.layerPollingIntervalId!==null?(clearInterval(this.layerPollingIntervalId),this.layerPollingIntervalId=null):this.logger.debug({msg:"Skipping stop polling request, already stopped"})}pollInternalLayers(w=!1){if(!Yn(this.mediaStreamTrack))return void this.pauseControls();if(this.streamType===vr.AUDIO)return this.logger.debug({msg:"Skipping layer poll request for audio stream"}),void this.transitionStateTo(Zo.ACTIVE);const O=!this.hasRemoteListenersForLayerEvents(),B=!this.subscribeConfig.simulcast.layerPollingEnabled;!w&&O&&B?this.logger.debug({msg:"Skipping layer request due to no listeners"}):this.remotePlaybackController.getLayers().then((V=>{if(this.isStateValidForLayerUpdates()){if(!V.ok)throw Error(V.error);this.updateInternalLayersFromRemote(V.value),this.transitionStateTo(Zo.ACTIVE),this.flushCommandQueue()}else this.logger.warn({msg:"Stream controls have been paused, skipping getLayers"})})).catch((V=>{this.logger.error({err:V,msg:"Error calling getLayers, returning current layers"})}))}updateInternalLayersFromRemote(w){const O=this._layers,B=w.map(Qg).sort(_h),V=!(0,ss.isEqual)(B,O);this._layers=B;const Y=this._selectedLayer,se=this._layers.filter((S=>S.selected))[0],me=!(0,ss.isEqual)(se,Y);Y&&(Y.selected=!1),this._selectedLayer=se,me&&(this.trackLayerUpdate(Y),this.trackLayerUpdate(se)),this.isCommandQueueEmpty()&&(V&&this.emitLayersChanged(),me&&this.emitLayerSelected(se))}flushCommandQueue(){if(this.isCommandQueueEmpty())return;const w=Array.from(this.commandMap.keys());this.logger.debug({msg:`Flushing active commands from map ${w}`});for(const O of this.commandMap.keys()){const B=this.commandMap.get(O);B?.()}this.commandMap.clear()}queueLayerUpdateForValidState(w){if(!w)return this.commandMap.delete("setLayer"),!1;if(this.state===Zo.INITIALIZING){const O=this.setLayer.bind(this,w);return this.commandMap.set("setLayer",O),!0}return!1}handleDynamicUpdate(){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const w=this._isAdapting;this._isAdapting=!0,this.emitAdaptionChanged(),this.remotePlaybackController.unsetLayer().then((O=>{if(!this.isStateValidForLayerUpdates())return this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"}),void this.resetAdaptionStateOnError(w,`Stream in invalid state: ${this.state}`);O.ok?this.logger.debug({msg:"Layer successfully unset, restarting dynamic adaption"}):this.resetAdaptionStateOnError(w,O.error)})).catch((()=>{}))}resetAdaptionStateOnError(w,O){this._isAdapting=w,this.emitAdaptionChanged(),this.logger.error({err:O,msg:"Error unsetting layer, reverting adaption state"})}handleManualUpdate(w){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping manual updates"});const O=this._isAdapting,B=this._selectedLayer;B&&(B.selected=!1),this._isAdapting=!1,this._selectedLayer=w,w.selected=!0,O!==this._isAdapting&&this.emitAdaptionChanged(),this.updateLocalLayerStateBeforeRemote(w,B),this.trackLayerUpdate(B),this.trackLayerUpdate(w),this.emitLayersChanged(),this.emitLayerSelected(w),this.remotePlaybackController.setLayer(w.label).then((V=>{if(!this.isStateValidForLayerUpdates()){this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const Y=`Stream in invalid state: ${this.state}`;return this.resetAdaptionStateOnError(O,Y),void this.resetLayerOnError(B,w,Y)}if(!V.ok){const Y=V.error;return this.resetAdaptionStateOnError(O,Y),void this.resetLayerOnError(B,w,Y)}this.logger.debug({msg:`Layer successfully selected: ${w.label}`})})).catch((()=>{}))}applyExistingControlState(){var w;this._isAdapting?this.remotePlaybackController.unsetLayer().then((()=>{})).catch((()=>{})):!((w=this._selectedLayer)===null||w===void 0)&&w.label&&this.remotePlaybackController.setLayer(this._selectedLayer.label).then((()=>{})).catch((()=>{}))}resetLayerOnError(w,O,B){O&&(O.selected=!1),w&&(w.selected=!0),this._selectedLayer=w,this.logger.error({err:B,msg:"Error unsetting layer, leaving current selection in place"}),this.updateLocalLayerStateBeforeRemote(w,O),this.emitLayersChanged(),w!==null&&this.emitLayerSelected(w,ls.UNAVAILABLE),this.trackLayerUpdate(O),this.trackLayerUpdate(w)}updateLocalLayerStateBeforeRemote(w,O){this._layers=this._layers.map((B=>B.label===w?.label?w:B.label===O?.label?O:B)).sort(_h)}trackLayerUpdate(w){var O,B;this.analyticsTracker.trackEventNoSharedProps(new Lm(this.token,os(),(O=w?.label)!==null&&O!==void 0?O:"auto",!0,Tn.SUBSCRIBE,(B=w?.selected)!==null&&B!==void 0&&B,this.info.id))}isNextUpdateAdaptionOnly(w){return w===void 0&&this.isFirstLayerUpdate()||w===void 0&&!this.isAdapting}isFirstLayerUpdate(){return this._selectedLayer===null}isRepeatLayerSelection(w){var O;return((O=this._selectedLayer)===null||O===void 0?void 0:O.label)===w?.label}isStateValidForLayerUpdates(){return this.state===Zo.ACTIVE||this.state===Zo.INITIALIZING}isCommandQueueEmpty(){return this.commandMap.size===0}emitLayerSelected(w,O=ls.SELECTED){this.logger.debug({msg:`Emitting layers selected ${JSON.stringify(w,null,2)}`}),this.emit(pa.LAYER_SELECTED,(0,ss.cloneDeep)(w),O)}emitLayersChanged(){this.emit(pa.LAYERS_CHANGED,(0,ss.cloneDeep)(this._layers))}emitAdaptionChanged(){this.emit(pa.ADAPTION_CHANGED,this._isAdapting)}get remote(){const w=this.weakRemoteMap.get(this.weakRemoteKey);if(w)return w;const O=new ul(this);return this.weakRemoteMap.set(this.weakRemoteKey,O),O}get participantInfo(){return(0,ss.cloneDeep)(this.info)}get isAdapting(){return this._isAdapting}get layers(){return(0,ss.cloneDeep)(this._layers)}get selectedLayer(){var w;return(0,ss.cloneDeep)((w=this._selectedLayer)!==null&&w!==void 0?w:void 0)}get highestQualityLayer(){return(0,ss.cloneDeep)(this.layers[this.layers.length-1])}get lowestQualityLayer(){return(0,ss.cloneDeep)(this.layers[0])}getInternalStats(){return vh(this,void 0,void 0,(function*(){if(this._getInternalStats)return this._getInternalStats(this.mediaStreamTrack)}))}pauseControls(){this.transitionStateTo(Zo.CONTROLS_PAUSED),this.stopLayerPolling()}resumeControls(){this.applyExistingControlState(),this.startLayerPolling(),this.transitionStateTo(Zo.ACTIVE)}updateSubscribeConfig(w){const O=this.subscribeConfig;this.subscribeConfig=w,O.simulcast.layerPollingIntervalMs!==w.simulcast.layerPollingIntervalMs&&this.isStateValidForLayerUpdates()&&this.initializeLayerPolling()}cleanup(){this.transitionStateTo(Zo.DESTROYED),super.cleanup(),this.weakRemoteMap.delete(this.weakRemoteKey),this.stopLayerPolling(),this._layers=[],this._selectedLayer=null,this._isAdapting=!0,this.commandMap.clear()}}(function(L){L.STATE_CHANGE="stateChange",L.MEDIA_STREAM_ADDED="mediaStreamAdded",L.MEDIA_STREAM_REMOVED="mediaStreamRemoved",L.MEDIA_STREAM_MUTE_CHANGED="mediaStreamMuteChanged",L.ERROR="error"})(fl||(fl={})),(function(L){L.SUBSCRIPTION_STATE_CHANGE="subscriptionStateChange",L.MEDIA_STREAM_SEI_MESSAGE_RECEIVED="mediaStreamSeiMessageReceived"})(So||(So={}));const kr=Object.assign(Object.assign({},fl),So);var Gs;(function(L){L.PUBLICATION_STATE_CHANGE="publicationStateChange"})(Gs||(Gs={}));const zl=Object.assign(Object.assign({},fl),Gs);var yh=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};class If extends Su{constructor(w,O,B,V,Y,se,me,S=!1){super(w,new on(V,le.REMOTE_PARTICIPANT)),this.subscribeState=ma.NOT_SUBSCRIBED,this.reassigning=!1,this.streams=[],this.left=!1,this.onSubscriptionStateChange=f=>{this.logger.debug({msg:"subscriptionStateChange",state:f}),f===si.DISCONNECTED?this.updateSubscriptionState(ma.NOT_SUBSCRIBED):f===si.CONNECTED?this.updateSubscriptionState(ma.SUBSCRIBED):f===si.CONNECTING?this.updateSubscriptionState(ma.ATTEMPTING_SUBSCRIBE):f===si.ERRORED?(this.emitStreamsRemovedByType(this.getDesiredSubscribeType()),this.cleanupStreams(),this.updateSubscriptionState(ma.ERRORED)):this.logger.warn({msg:"FIXME onSubscriptionStateChange UNHANDLED STATE",state:f})},this.onSubscriptionStreamRemoved=()=>{this.logger.debug({msg:"onSubscriptionStreamRemoved"}),this.emitStreamsRemovedByType(this.getDesiredSubscribeType()),this.cleanupStreams()},this.onSubscriptionStreamCreated=(f,_)=>{this.logger.debug({msg:"onSubscriptionStreamCreated",stream:f}),this.pruneInactiveStreams();let R=f.getTracks().map((U=>{const ee=new qr({track:U,info:this.info,getStats:this.subscription.requestRTCStats,remotePlaybackController:_,analyticsTracker:this.analyticsTracker,token:this.token,subscribeConfig:this.subscribeConfig});return this.streams.push(ee),ee}));this.subscription.getDesiredSubscribeType()===ao.AUDIO_ONLY&&(R=R.filter((U=>U.streamType!==vr.VIDEO))),this.emit(kr.MEDIA_STREAM_ADDED,R)},this.onSubscriptionError=f=>{this.emit(kr.ERROR,f)},this.onSubscriptionSeiMessageReceived=f=>{this.emit(kr.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,f)},this.onSubscriptionTransformError=f=>{this.emit(kr.ERROR,f)},this.onSubscriptionReassignmentStart=()=>{for(const f of this.streams)f.pauseControls()},this.onSubscriptionReassignmentDone=()=>{for(const f of this.streams)f.resumeControls()},this.updateSubscribeStateIfNecessary=(f,_)=>{if(!this.info.capabilities.has(Wu.SUBSCRIBE))return;_!==void 0&&(this.subscribeConfig=_,this.subscription.updateSubscribeConfig(_),this.streams.forEach((ee=>{ee.updateSubscribeConfig(_)})));const R=f!==ao.NONE&&this.publishState===Ms.PUBLISHED,U=this.subscribeState!==ma.NOT_SUBSCRIBED&&this.subscribeState!==ma.ERRORED;if(R&&!U)this.subscription.updateDesiredSubscribeType(f),this.subscribe();else if(!R&&U)this.unsubscribe(),this.subscription.updateDesiredSubscribeType(f);else if(this.subscribeState===ma.SUBSCRIBED&&this.subscription.getDesiredSubscribeType()!==f)try{f===ao.AUDIO_ONLY?this.emit(kr.MEDIA_STREAM_REMOVED,this.filterStreamsByType(this.streams,vr.VIDEO)):f===ao.AUDIO_VIDEO&&this.emit(kr.MEDIA_STREAM_ADDED,this.filterStreamsByType(this.streams,vr.VIDEO)),this.subscription.updateDesiredSubscribeType(f)}catch(ee){this.logger.error({err:ee,msg:"error updating subscribe type"})}},this.updatePublishState=f=>{const _=f&&this.publishState===Ms.PUBLISHED,R=!f&&this.publishState===Ms.NOT_PUBLISHED;return!_&&!R&&(this.info.isPublishing=f,this.publishState=f?Ms.PUBLISHED:Ms.NOT_PUBLISHED,!0)},this.updateStreamState=(f,_)=>{this.audioMuted!==f&&(this.audioMuted=f,this.info.audioMuted=f,this.updateStreamMuteState(vr.AUDIO,f)),this.videoStopped!==_&&(this.videoStopped=_,this.info.videoStopped=_,this.updateStreamMuteState(vr.VIDEO,_))},this.updateStreamMuteState=(f,_)=>{const R=this.filterStreamsByType(this.streams,f),U=R[R.length-1];if(!U){const ee=`state update received for ${this.info.id} for non-existent ${f} stream`;return this.logger.warn({msg:ee}),void this.traceRemoteParticipantMsg(ee)}U.setMuted(_),this.emit(kr.MEDIA_STREAM_MUTE_CHANGED,U)},this.cleanup=()=>{this.removeAllListeners()},this.quickUnsubscribe=()=>this.subscribeState!==ma.NOT_SUBSCRIBED&&this.subscription.stop(!0),this.getDesiredSubscribeType=()=>this.subscription.getDesiredSubscribeType(),this.isReassigning=()=>this.reassigning,this.analyticsTracker=me,this.token=O,this.subscribeConfig=se,this.createSubscription=()=>{const f=new Xn(w.id,O,B,V,me,Y,se);return f.on($a,this.onSubscriptionStateChange),f.on(Ls,this.onSubscriptionStreamCreated),f.on(tl,this.onSubscriptionStreamRemoved),f.on(lp,this.onSubscriptionError),f.on(kl,this.onSubscriptionSeiMessageReceived),f.on(so,this.onSubscriptionTransformError),f.on(Mm,this.onSubscriptionReassignmentStart),f.on(f_,this.onSubscriptionReassignmentDone),f.on(Tf,this.onSubscriptionReassignmentDone),f},this.subscription=this.createSubscription(),S&&(this.publishState=Ms.PUBLISHED)}updateSubscriptionState(w){w!==this.subscribeState&&(this.subscribeState=w,this.emit(kr.SUBSCRIPTION_STATE_CHANGE,this.subscribeState))}pruneInactiveStreams(){const w=[];this.streams=this.streams.filter((Y=>!!Yn(Y.mediaStreamTrack)||(w.push(Y),!1)));const O=w.length;if(O===0)return;const B=this.filterStreamsByType(w,vr.AUDIO).length,V=O-B;this.traceRemoteParticipantMsg(`Pruning inactive streams (${B} audio, ${V} video)`),this.emitStreamsRemoved(w),w.forEach((Y=>{Y.remote.cleanup(),Y.cleanup()}))}filterStreamsByType(w,O){return w.filter((B=>B.streamType===O))}participantLeave(){this.left=!0}subscribe(){this.left?this.logger.warn({msg:"tried to subscribe to a participant that left"}):(this.updateSubscriptionState(ma.ATTEMPTING_SUBSCRIBE),this.logger.debug({msg:"subscribe"}),this.subscription.start())}unsubscribe(){if(this.subscribeState===ma.NOT_SUBSCRIBED)return;this.logger.debug({msg:"unsubscribe"}),this.subscription.stop(),this.subscription.off($a,this.onSubscriptionStateChange),this.subscription.off(Ls,this.onSubscriptionStreamCreated),this.subscription.off(tl,this.onSubscriptionStreamRemoved),this.subscription.off(lp,this.onSubscriptionError),this.subscription.off(so,this.onSubscriptionTransformError);const w=this.getDesiredSubscribeType();this.subscription=this.createSubscription(),this.emitStreamsRemovedByType(w),this.updateSubscriptionState(ma.NOT_SUBSCRIBED),this.cleanupStreams()}emitStreamsRemovedByType(w){switch(w){case ao.AUDIO_VIDEO:this.emitStreamsRemoved(this.streams);break;case ao.AUDIO_ONLY:this.emitStreamsRemoved(this.filterStreamsByType(this.streams,vr.AUDIO));case ao.NONE:}}emitStreamsRemoved(w){this.emit(kr.MEDIA_STREAM_REMOVED,w)}cleanupStreams(){this.streams.length!==0&&(this.logger.debug({msg:"Cleaning up streams due to internal removal"}),this.streams.forEach((w=>{w.remote.cleanup(),w.cleanup()})),this.streams=[])}traceRemoteParticipantMsg(w){this.analyticsTracker.trackEventNoSharedProps(new Ca(this.token,os(),w,Tn.SUBSCRIBE,this.info.id))}triggerIceRestart(w){return yh(this,void 0,void 0,(function*(){this.reassigning=!0;try{yield this.subscription.triggerIceRestart(w)}finally{this.reassigning=!1}}))}}const Ym=Tn.PUBLISH;function Jo(L,w,O){return new gr(Object.assign(Object.assign({},L),{token:w,traceId:O,location:"stage-publication.sendSeiMessage",tag:dc,action:Tn.PUBLISH}))}class xo{constructor(w,O){this.analyticsTracker=w,this.token=O,this.action=Ym,this.traceId=os()}trackPublish(w){const{action:O,traceId:B,analyticsTracker:V,token:Y}=this;return V.trackEvent(new x_({token:Y,traceId:B})),{getTraceId:()=>B,trackPublishStarted({totalDurationWithRetries:se,retryTimes:me,sfuResource:S,peerClientPerfStats:f,protocol:_}){const{optionsDuration:R,postDuration:U,timeToCandidate:ee,timeToConnected:ue,sdpExchangeDuration:de,sdpExchangeTransport:be,setRemoteDescDuration:Ce,peerConnectionDuration:Oe}=f,{edpInitialConnectDuration:Fe,edpInitialConnectRetries:ot,edpInitialStateDuration:_t,edpStateUpdateCount:Tt}=w;V.trackEvent(new w_({token:Y,traceId:B,optionsDuration:R,postDuration:U,timeToCandidate:ee,totalDuration:ue,edpInitialConnectDuration:Fe,edpInitialConnectRetries:ot,edpInitialStateDuration:_t,edpStateUpdateCount:Tt,sdpExchangeDuration:de,sdpExchangeTransport:be,setRemoteDescDuration:Ce,peerConnectionDuration:Oe,publishRetries:me,totalDurationWithRetries:se,sfuResource:S,protocol:_}))},trackPublishFailed(se,me){const S=((_,R,U)=>{if(_ instanceof gr)return _;let ee="";return _ instanceof Vo.AxiosError&&(ee+=`AxiosError - ${_.code}`),new gr(Object.assign(Object.assign(Object.assign({},Xt.PUBLISH_FAILURE),{action:Ym,token:R,traceId:U,tag:dc,location:"publish",details:`${ee} ${_.message}`}),{fatal:!0}))})(se,Y,B);V.trackEvent(new $g({token:Y,traceId:B,code:S.code,message:S.message,fatal:S.fatal,nominal:S.nominal,protocol:me}));const f=new gr(Object.assign(Object.assign({},Xt.PUBLISH_FAILURE),{action:O,token:Y,traceId:B,tag:dc,location:"publish"}));return se instanceof gr&&(f.fatal=se.fatal,f.nominal=se.nominal,f.location=`publish > ${se.location}`),V.trackError(f),S},trackUnpublish:()=>{V.trackEvent(new T_({token:Y,traceId:B}))},trackEndSucceeded:(se,me)=>{V.trackEvent(new R_({token:Y,isUnpublishSuccessful:!0,traceId:B,reason:se,protocol:me}))},trackEndFailed:(se,me)=>{const S=new gr(Object.assign(Object.assign({},Xt.UNPUBLISH_FAILURE),{token:Y,traceId:B,tag:Ml,location:"unpublish"}));return se!==ai.UNLOAD&&se!==ai.UNPUBLISH||this.analyticsTracker.trackError(S),V.trackEvent(new R_({token:Y,isUnpublishSuccessful:!1,traceId:B,reason:se,protocol:me})),S},createSeiNotPublishingVideoError:()=>Jo(Xt.SEI_INSERT_NOT_PUBLISHING_VIDEO,Y,B),createSeiInBandMessagingNotEnabledError:()=>Jo(Xt.SEI_INSERT_INBAND_NOT_ENABLED,Y,B)}}}var Qo,Za,ea=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};(function(L){L.DISCONNECTED="disconnected",L.CONNECTING="connecting",L.CONNECTED="connected",L.ERRORED="errored"})(Qo||(Qo={})),(function(L){L.STATE_CHANGE="stateChange",L.ERROR="error",L.TRANSFORM_ERROR="transformError"})(Za||(Za={}));class xu extends Zc{constructor(w,O,B,V){super(),this.token=w,this.stageConnection=O,this.nonScopedLogger=B,this.analyticsTracker=V,this.streamsToPublish=[],this.publicationState=Qo.DISCONNECTED,this.latestPubAttemptNum=0,this.startConnectingTimestamp=-1,this.action=Tn.PUBLISH,this.start=Y=>{this.publicationState===Qo.DISCONNECTED||this.publicationState===Qo.ERRORED?(this.streamsToPublish=Y,this.latestPubAttemptNum=0,this.processStateUpdate()):this.logger.warn({msg:"publication cannot be started if not in disconnected or error state"})},this.requestRTCStats=Y=>ea(this,void 0,void 0,(function*(){return this.peerClient.requestRTCStats(Y)})),this.stop=(Y=!1)=>ea(this,void 0,void 0,(function*(){this.peerClient.off(yo,this.onPeerClientConnectionStateChange),this.peerClient.off(Lu,this.onPeerClientTransformError),yield this.unpublish(Y),this.updateState(Qo.DISCONNECTED)})),this.processStateUpdate=Y=>{const{publicationState:se}=this;se===Qo.DISCONNECTED||se===Qo.ERRORED?this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(Qo.CONNECTING),this.tryPublish()):se===Qo.CONNECTING?Y===jn.CONNECTED&&this.updateState(Qo.CONNECTED):se===Qo.CONNECTED&&Y===jn.FAILED&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(ai.CONNECTION_FAIL,this.peerClient.getProtocol()),this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(Qo.CONNECTING),this.tryPublish()))},this.updateState=Y=>{this.publicationState=Y,this.emit(Za.STATE_CHANGE,Y)},this.tryPublish=()=>ea(this,void 0,void 0,(function*(){if(this.latestPubAttemptNum++,this.latestPubAttemptNum<=4){const Y=this.stageConnection.getConnectionStats();this.attemptTracker=this.publishTracker.trackPublish(Y);try{this.logger.debug({msg:`attempting to publish, attemptNum: ${this.latestPubAttemptNum}`}),yield this.publish(this.streamsToPublish,this.attemptTracker.getTraceId()),this.logger.debug({msg:"publish succeeded!"});const se=this.peerClient.getSfuResource(),me=this.latestPubAttemptNum-1,S=performance.now()-this.startConnectingTimestamp,f=this.peerClient.getActionMeasurements();this.attemptTracker.trackPublishStarted({sfuResource:se,totalDurationWithRetries:S,retryTimes:me,peerClientPerfStats:f,protocol:this.peerClient.getProtocol()}),this.latestPubAttemptNum=0}catch(se){this.logger.error({msg:"publish failed!",err:se});const me=this.attemptTracker.trackPublishFailed(se,this.peerClient.getProtocol()),S=me.code===Xt.OPERATION_ABORTED.code,f=me.fatal,_=this.latestPubAttemptNum===4;if(S)return;if(f||_)return this.logger.error({msg:`Stopping attempts: isFatal=${f}, isLastAttempt=${_}`,err:se}),this.updateState(Qo.ERRORED),void this.emit(Za.ERROR,me);const R=1e3*Math.pow(2,this.latestPubAttemptNum);this.logger.debug({msg:`attempt failed, retrying in ${R}ms`}),this.nextAttemptTimerId=window.setTimeout((()=>{this.tryPublish()}),R)}}})),this.publish=(Y,se)=>ea(this,void 0,void 0,(function*(){this.peerClient.initStreamsToPublish(Y),yield this.peerClient.connect({audioOnly:!1,traceId:se})})),this.unpublish=(Y=!1)=>ea(this,void 0,void 0,(function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.publicationState===Qo.DISCONNECTED||this.publicationState===Qo.ERRORED||!this.attemptTracker)return;this.attemptTracker.trackUnpublish();const se=Y?ai.UNLOAD:ai.UNPUBLISH,me=this.peerClient.getProtocol();try{Y?this.peerClient.disconnect(Y):yield this.peerClient.disconnect(Y),this.attemptTracker.trackEndSucceeded(se,me)}catch{this.attemptTracker.trackEndFailed(se,me)}})),this.replaceOrUpdateStream=Y=>ea(this,void 0,void 0,(function*(){this.streamsToPublish.find((se=>se.track.kind===Y.track.kind))?this.streamsToPublish=this.streamsToPublish.map((se=>se.track.kind===Y.track.kind?Y:se)):this.streamsToPublish.push(Y),yield this.peerClient.replaceOrUpdateStream(Y)})),this.onPeerClientConnectionStateChange=Y=>{this.logger.debug({msg:`onPeerClientConnectionStateChange: ${Y}`,state:Y}),this.processStateUpdate(Y)},this.onPeerClientTransformError=Y=>{this.emit(Za.TRANSFORM_ERROR,Y)},this.onIncompatibleCodecs=Y=>ea(this,void 0,void 0,(function*(){yield this.peerClient.onIncompatibleCodecs(Y)})),this.sendSeiMessage=(Y,se)=>{if(this.publicationState!==Qo.CONNECTED)return this.attemptTracker&&this.emit(Za.ERROR,this.attemptTracker.createSeiNotPublishingVideoError()),Pn.err(ys.NOT_PUBLISHING_VIDEO);const me=this.peerClient.sendSeiMessage(Y,se),S=Pn.getErr(me);return S&&this.attemptTracker&&(S===ys.INBAND_MESSAGING_NOT_ENABLED?this.emit(Za.ERROR,this.attemptTracker.createSeiInBandMessagingNotEnabledError()):S===ys.NOT_PUBLISHING_VIDEO&&this.emit(Za.ERROR,this.attemptTracker.createSeiNotPublishingVideoError())),me},this.peerClient=new Ya(w,this.nonScopedLogger,this.action,vn(this.action),os(),this.analyticsTracker,void 0,O,void 0),this.logger=new on(B,le.PUBLICATION),this.peerClient.on(yo,this.onPeerClientConnectionStateChange),this.peerClient.on(Lu,this.onPeerClientTransformError),this.publishTracker=new xo(this.analyticsTracker,this.token)}removeTrack(w){return ea(this,void 0,void 0,(function*(){this.streamsToPublish=this.streamsToPublish.filter((O=>O.track.kind!==w)),yield this.peerClient.removeTrack(w)}))}}var ci,bh=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};class M_ extends Su{constructor(w,O,B,V,Y){super(w,new on(B,le.LOCAL_PARTICIPANT)),this.onPublicationStateChange=se=>{switch(this.logger.debug({msg:"publicationStateChange",state:se}),se){case"connected":this.connection.setStagePublishing(!0),this.updatePublishState(Ms.PUBLISHED);break;case"connecting":this.updatePublishState(Ms.ATTEMPTING_PUBLISH);break;case"errored":this.updatePublishState(Ms.ERRORED),this.connection.setStagePublishing(!1);break;default:return void this.logger.warn({msg:"FIXME onPublicationStateChange UNHANDLED STATE",state:se})}},this.onPublicationError=se=>{this.emit(zl.ERROR,se)},this.updatePublishState=se=>{this.info.isPublishing=se===Ms.PUBLISHED,this.publishState=se,this.emit(zl.PUBLICATION_STATE_CHANGE,this.publishState)},this.handleMute=se=>{se.streamType===vr.AUDIO&&(this.audioMuted=se.isMuted,this.info.audioMuted=se.isMuted),se.streamType===vr.VIDEO&&(this.videoStopped=se.isMuted,this.info.videoStopped=se.isMuted),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.emit(zl.MEDIA_STREAM_MUTE_CHANGED,se)},this.handleInsertSeiMsgRequest=(se,me,S)=>{this.sendSeiMessage(me,S?.repeatCount)},this.publish=se=>{this.logger.debug({msg:"publish"}),se.forEach((S=>{S&&(this.setupStreamListeners(S),S.streamType===vr.AUDIO?(this.audioStream=S,this.audioMuted=!S.mediaStreamTrack.enabled,this.info.audioMuted=this.audioMuted):S.streamType===vr.VIDEO&&(this.videoStream=S,this.videoStopped=!S.mediaStreamTrack.enabled,this.info.videoStopped=this.videoStopped),S.setGetStats(this.publication.requestRTCStats))})),this.connection.emitStageState(this.audioMuted,this.videoStopped);const me=se.map((S=>Gg(S)));this.publication.start(me)},this.cleanup=()=>this.removeAllListeners(),this.quickUnpublish=()=>this.publishState!==Ms.NOT_PUBLISHED&&this.publishState!==Ms.ERRORED&&void this.publication.stop(!0),this.onIncompatibleCodecs=se=>bh(this,void 0,void 0,(function*(){yield this.publication.onIncompatibleCodecs(se)})),this.sendSeiMessage=(se,me=0)=>this.publication.sendSeiMessage(se,me),this.sendSeiMessageString=(se,me=0)=>{const S=new TextEncoder().encode(se);return this.publication.sendSeiMessage(S,me)},this.connection=V,this.createPublication=()=>{const se=new xu(O,V,B,Y);return se.on(Za.STATE_CHANGE,this.onPublicationStateChange),se.on(Za.ERROR,this.onPublicationError),se.on(Za.TRANSFORM_ERROR,this.onPublicationError),se},this.publication=this.createPublication()}setupStreamListeners(w){w.on(Mr.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),w.streamType===vr.VIDEO&&w.on(Mr.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this.handleInsertSeiMsgRequest)}removeTrack(w){var O,B,V;w.streamType===vr.AUDIO?((O=this.audioStream)===null||O===void 0||O.off(Mr.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.audioStream=void 0,this.audioMuted=!0,this.info.audioMuted=!0):w.streamType===vr.VIDEO&&((B=this.videoStream)===null||B===void 0||B.off(Mr.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),(V=this.videoStream)===null||V===void 0||V.off(Mr.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this.handleMute),this.videoStream=void 0,this.videoStopped=!0,this.info.videoStopped=!0),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.publication.removeTrack(w.streamType)}replaceOrAddTrack(w){return bh(this,void 0,void 0,(function*(){this.setupStreamListeners(w),w.setGetStats(this.publication.requestRTCStats),w.streamType===vr.AUDIO?(this.audioStream=w,this.audioMuted=!w.mediaStreamTrack.enabled):w.streamType===vr.VIDEO&&(this.videoStream=w,this.videoStopped=!w.mediaStreamTrack.enabled),this.connection.emitStageState(this.audioMuted,this.videoStopped);const O=Gg(w);yield this.publication.replaceOrUpdateStream(O)}))}unpublish(){if(this.publishState===Ms.NOT_PUBLISHED||this.publishState===Ms.ERRORED)return;this.logger.debug({msg:"unpublish"}),this.connection.setStagePublishing(!1),this.publication.stop(),this.publication.off(Za.STATE_CHANGE,this.onPublicationStateChange),this.publication.off(Za.ERROR,this.onPublicationError),this.publication.off(Za.TRANSFORM_ERROR,this.onPublicationError);const w=[this.audioStream,this.videoStream].filter((O=>!!O));w.forEach((O=>{O.cleanup()})),this.audioStream=void 0,this.videoStream=void 0,this.emit(zl.MEDIA_STREAM_REMOVED,w),this.updatePublishState(Ms.NOT_PUBLISHED),this.publication=this.createPublication()}}(function(L){L.STAGE_CONNECTION_STATE_CHANGED="stageConnectionStateChanged",L.STAGE_PARTICIPANT_JOINED="stageParticipantJoined",L.STAGE_PARTICIPANT_LEFT="stageParticipantLeft",L.STAGE_PARTICIPANT_STREAMS_ADDED="stageParticipantStreamsAdded",L.STAGE_PARTICIPANT_STREAMS_REMOVED="stageParticipantStreamsRemoved",L.STAGE_STREAM_MUTE_CHANGED="stageStreamMuteChanged",L.STAGE_STREAM_SEI_MESSAGE_RECEIVED="stageStreamSeiMessageReceived",L.STAGE_STREAM_LAYERS_CHANGED="stageStreamLayersChanged",L.STAGE_STREAM_LAYER_SELECTED="stageStreamLayerSelected",L.STAGE_STREAM_ADAPTION_CHANGED="stageStreamAdaptionChanged",L.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED="stageParticipantSubscribeStateChanged",L.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED="stageParticipantPublishStateChanged",L.ERROR="error",L.STAGE_LEFT="stageLeft"})(ci||(ci={}));var Rd=function(L,w,O,B){return new(O||(O=Promise))((function(V,Y){function se(f){try{S(B.next(f))}catch(_){Y(_)}}function me(f){try{S(B.throw(f))}catch(_){Y(_)}}function S(f){var _;f.done?V(f.value):(_=f.value,_ instanceof O?_:new O((function(R){R(_)}))).then(se,me)}S((B=B.apply(L,[])).next())}))};const e0=L=>!!L;class ga extends Zc{constructor(w,O){super(),this.connectionState=qi.DISCONNECTED,this.participants=new Map,this.connectionStateErrored=!1,this.onConnectionStateChanged=(V,Y)=>{var se,me;if(this.connectionState=V,V===qi.ERRORED&&(this.connectionStateErrored=!0),V===qi.CONNECTED&&this.localParticipant&&this.localParticipant.publishState!==Ms.NOT_PUBLISHED&&this.stageConnection.emitStageState((se=this.localParticipant)===null||se===void 0?void 0:se.audioMuted,(me=this.localParticipant)===null||me===void 0?void 0:me.videoStopped),V===qi.CONNECTED&&this.connectionStateErrored&&(this.connectionStateErrored=!1,this.refreshStrategy()),V===qi.DISCONNECTED){if(Y&&Y!==jc.CLIENT_RECONNECT&&Y!==jc.USER_INITIATED){let S=Ku.UNKNOWN;(function(f){return Object.values(Ku).includes(f)})(Y)?S=Y:this.logger.warn({msg:`DISCONNECTED reason is not a StageLeftReason: ${Y}`}),this.cleanup(S)}}else this.emit(ci.STAGE_CONNECTION_STATE_CHANGED,this.connectionState)},this.setupLocalParticipantOnce=()=>{var V;this.localParticipant?this.analyticsTracker.trackEventNoSharedProps(new Ca(this.token,(V=this.joinTraceId)!==null&&V!==void 0?V:new l_,"reusing local participant from repeat join",Tn.JOIN,"")):this.createLocalParticipant()},this.createLocalParticipant=()=>{const V=(function(Y){var se,me;const S=new Set;return Y.token.claims.capabilities.allow_publish&&S.add(Wu.PUBLISH),Y.token.claims.capabilities.allow_subscribe&&S.add(Wu.SUBSCRIBE),{id:Y.token.participantID,userId:(se=Y.token.userID)!==null&&se!==void 0?se:"",attributes:(me=Y.token.claims.attributes)!==null&&me!==void 0?me:{},capabilities:S,isLocal:!0,userInfo:{},videoStopped:Y.videoStopped,audioMuted:Y.audioMuted,isPublishing:Y.isPublishing}})({token:this.token,videoStopped:!0,audioMuted:!0,isPublishing:!1});this.localParticipant=new M_(V,this.token,this.logger.unwrap(),this.stageConnection,this.analyticsTracker),this.localParticipant.on(zl.PUBLICATION_STATE_CHANGE,(Y=>{this.onPublishStateChanged(this.localParticipant.info,Y)})),this.localParticipant.on(zl.MEDIA_STREAM_REMOVED,this.onLocalStreamsRemoved),this.localParticipant.on(zl.MEDIA_STREAM_MUTE_CHANGED,(Y=>{this.localParticipant?this.onStreamMuteChange(this.localParticipant.info,Y):this.logger.warn({msg:"tried to emit a stream mute change event for undefined local participant"})})),this.localParticipant.on(zl.ERROR,(Y=>{this.errorManager.handleError(Y,Wn.PUBLISH_ERROR)})),this.emit(ci.STAGE_PARTICIPANT_JOINED,V)},this.onRemoteParticipantJoined=V=>{if(V.id!==this.token.participantID){const Y=(function(f){return{id:f.id,userId:f.userId,attributes:f.attributes,capabilities:new Set([Wu.SUBSCRIBE]),isLocal:!1,userInfo:{},videoStopped:f.videoStopped,audioMuted:f.audioMuted,isPublishing:f.isPublishing}})(V);if(this.participants.has(Y.id))return void this.logger.warn({msg:"Remote participant already tracked"});let se=ao.NONE;Y.capabilities.has(Wu.SUBSCRIBE)&&(se=Pn.getOk_or(this.strategyWrapper.shouldSubscribeToParticipant(Y),se),this.updateManagerWithExternalSubscribeConfig(Y,"joined"));const me=this.configManager.getSubscribeConfigSnapshot(Y.id),S=new If(Y,this.token,this.stageConnection,this.logger.unwrap(),se,me,this.analyticsTracker,V.isPublishing);this.participants.set(Y.id,S),this.setupRemoteParticipantListeners(S),this.emit(ci.STAGE_PARTICIPANT_JOINED,S.info),S.updateSubscribeStateIfNecessary(se)}},this.setupRemoteParticipantListeners=V=>{V.on(kr.SUBSCRIPTION_STATE_CHANGE,(Y=>{this.onParticipantSubscribeStateChanged(V.info.id,Y)})),V.on(kr.MEDIA_STREAM_ADDED,(Y=>{const se=this.participants.get(V.info.id);if(se){for(const me of Y)this.setupRemoteParticipantStreamEvents(se.info,me);this.emit(ci.STAGE_PARTICIPANT_STREAMS_ADDED,se.info,Of(Y)),this.updateStreamLayerForParticipantInfo(V.info,V.streams)}else this.logger.warn({msg:"Got stream add for participant no longer being tracked"})})),V.on(kr.MEDIA_STREAM_REMOVED,(Y=>{const se=this.participants.get(V.info.id);se?this.emit(ci.STAGE_PARTICIPANT_STREAMS_REMOVED,se.info,Of(Y)):this.logger.warn({msg:"Got stream remove for participant no longer being tracked"})})),V.on(kr.MEDIA_STREAM_MUTE_CHANGED,(Y=>{this.onStreamMuteChange(V.info,Y.remote)})),V.on(kr.ERROR,(Y=>{this.errorManager.handleError(Y,Wn.SUBSCRIBE_ERROR)})),V.on(kr.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,(Y=>{this.onSeiMessageReceived(V.info,Y)}))},this.onRemoteParticipantLeft=V=>{if(this.connectionState!==qi.CONNECTED)return;const Y=this.participants.get(V);Y?(Y.participantLeave(),Y.unsubscribe(),Y.cleanup(),this.participants.delete(V),this.emitParticipantLeave(Y.info)):this.logger.warn({msg:"Remote participant no longer tracked"})},this.emitParticipantLeave=V=>{this.emit(ci.STAGE_PARTICIPANT_LEFT,V)},this.onRemoteParticipantStateChanged=V=>{const Y=this.participants.get(V.id);if(!Y)return void this.logger.warn({msg:"Remote participant updated but not tracked"});Y.updatePublishState(V.isPublishing)&&this.onPublishStateChanged(Y.info,Y.publishState),Y.updateStreamState(V.audioMuted,V.videoStopped);const se=this.strategyWrapper.shouldSubscribeToParticipant(Y.info);if(Pn.isNotOk(se))return;this.updateManagerWithExternalSubscribeConfig(Y.info,"updated");const me=this.configManager.getSubscribeConfigSnapshot(Y.info.id),S=Pn.getOk_or(se,ao.NONE);Y.updateSubscribeStateIfNecessary(S,me)},this.onPublishStateChanged=(V,Y)=>{this.emit(ci.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED,V,Y)},this.onParticipantSubscribeStateChanged=(V,Y)=>{const se=this.participants.get(V);se?this.emit(ci.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED,se.info,Y):this.logger.warn({msg:"Remote participant subscribe state changed but not tracked"})},this.onLocalStreamsAdded=V=>{this.localParticipant&&this.emit(ci.STAGE_PARTICIPANT_STREAMS_ADDED,this.localParticipant.info,V)},this.onLocalStreamsRemoved=V=>{this.localParticipant&&this.emit(ci.STAGE_PARTICIPANT_STREAMS_REMOVED,this.localParticipant.info,V)},this.onStreamMuteChange=(V,Y)=>{this.emit(ci.STAGE_STREAM_MUTE_CHANGED,V,Y)},this.onSeiMessageReceived=(V,Y)=>{this.emit(ci.STAGE_STREAM_SEI_MESSAGE_RECEIVED,V,Y)},this.leave=()=>{this.cleanup(Ku.USER_INITIATED)},this.onBeforeUnloadCleanup=()=>{var V;this.participants.forEach((Y=>{Y.quickUnsubscribe()})),(V=this.localParticipant)===null||V===void 0||V.quickUnpublish(),this.stageConnection.disconnect(),this.emit(ci.STAGE_CONNECTION_STATE_CHANGED,qi.DISCONNECTED),this.analyticsTracker.stop(!0)},this.cleanup=V=>{if(!this.localParticipant)return;this.analyticsTracker.trackEventNoSharedProps(new ju({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId,reason:V})),this.localParticipant.unpublish(),this.localParticipant.cleanup();const Y=this.localParticipant.info;this.localParticipant=void 0,this.emitParticipantLeave(Y);const se=this.participants.entries();for(const[me,S]of se)S.unsubscribe(),this.participants.delete(me),S.cleanup(),this.emitParticipantLeave(S.info);da.destroy(this.analyticsTracker.getSessionId()),this.stageConnection.disconnect(),this.emit(ci.STAGE_CONNECTION_STATE_CHANGED,qi.DISCONNECTED),this.emit(ci.STAGE_LEFT,V),this.analyticsTracker.stop(!1),window.removeEventListener("beforeunload",this.onBeforeUnloadCleanup)},this.refreshStrategy=()=>{this.participants.forEach((V=>{if(V.info.capabilities.has(Wu.SUBSCRIBE)){const Y=this.strategyWrapper.shouldSubscribeToParticipant(V.info);if(Pn.isNotOk(Y))return;const se=Pn.getOk_or(Y,ao.NONE);this.updateManagerWithExternalSubscribeConfig(V.info,"updated");const me=this.configManager.getSubscribeConfigSnapshot(V.info.id);V.updateSubscribeStateIfNecessary(se,me),this.updateStreamLayerForParticipantInfo(V.info,V.streams)}})),this.updateStreamsToPublishIfNecessary()},this.updateStreamsToPublishIfNecessary=()=>{var V;if(!this.localParticipant||!(!((V=this.localParticipant)===null||V===void 0)&&V.info.capabilities.has(Wu.PUBLISH)))return;const Y=this.localParticipant.publishState!==Ms.NOT_PUBLISHED&&this.localParticipant.publishState!==Ms.ERRORED,se=this.strategyWrapper.shouldPublishParticipant(this.localParticipant.info);if(Pn.isNotOk(se))return;let me=Pn.getOk_or(se,!1);if(!Y&&!me)return;if(Y&&!me)return void this.localParticipant.unpublish();const S=this.strategyWrapper.stageStreamsToPublish();if(Pn.isNotOk(S)){const _=Pn.getErr(S);if(_ instanceof Error&&_.cause==="UserStrategy")throw _;return}const f=Pn.getOk_or(S,[]);me=me&&f.length>0,!Y&&me?(this.localParticipant.publish(f),this.onLocalStreamsAdded(f)):this.syncTracksToPublish(f)},this.syncTracksToPublish=V=>{var Y;if(!this.localParticipant)return;const se=this.localParticipant.audioStream,me=this.localParticipant.videoStream,{updates:S,streamsToAdd:f,streamsToRemove:_}=this.determineStreamUpdates(se,me,V);if(S.length){for(const R of S)R.newStream?(Y=this.localParticipant)===null||Y===void 0||Y.replaceOrAddTrack(R.newStream):R.oldStream&&this.localParticipant.removeTrack(R.oldStream);_.length!==0&&this.onLocalStreamsRemoved(_),f.length!==0&&this.onLocalStreamsAdded(f)}},this.determineStreamUpdates=(V,Y,se=[])=>{const me=[],S=se.slice(0,2);if(S.sort(((R,U)=>R.streamType===vr.AUDIO?-1:1)),S.length===0)V&&me.push({oldStream:V}),Y&&me.push({oldStream:Y});else if(S.length===1){const R=S[0];R.streamType===vr.AUDIO?Y&&me.push({oldStream:Y}):R.streamType===vr.VIDEO&&V&&me.push({oldStream:V})}S.forEach((R=>{var U,ee;R.streamType===vr.AUDIO?V?V.id===R.id&&(0,ss.isEqual)(V.mediaConfig,R.mediaConfig)||(!!(!((U=V.mediaConfig)===null||U===void 0)&&U.stereo)!=!!(!((ee=R.mediaConfig)===null||ee===void 0)&&ee.stereo)&&this.logger.warn({msg:"Ignoring change to audio stream's stereo configuration. Re-publish to change stereo configuraiton."}),me.push({oldStream:V,newStream:R})):me.push({newStream:R}):R.streamType===vr.VIDEO&&(Y?Y.id===R.id&&(0,ss.isEqual)(Y.mediaConfig,R.mediaConfig)||me.push({oldStream:Y,newStream:R}):me.push({newStream:R}))}));const f=me.map((R=>R.newStream)).filter(e0),_=me.map((R=>R.oldStream)).filter(e0);return{updates:me,streamsToAdd:f,streamsToRemove:_}},this.onReassignmentMessage=V=>Rd(this,void 0,void 0,(function*(){if(Rs("disableReassignments"))return void this.logger.debug({msg:"REASSIGN message ignored: disableReassignments is configured"});if(!vd.browser.isChrome())return void this.logger.debug({msg:"REASSIGN message ignored: browser is not chrome"});const Y=os();this.trackReassignmentRequest(V,Y);const se=this.participants.get(V.remoteParticipantId),me=this.token.participantID,S=(function(f,{localParticipantId:_,remoteParticipant:R}){const{participantId:U}=f;if(_!==U)return Pn.err(Object.assign(Object.assign({},Xt.REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID),{details:`Invalid participantId received: ${U}`}));if(!R)return Pn.err(Object.assign(Object.assign({},Xt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID),{details:`Invalid remoteParticipantId received: ${R}`}));if(R.isReassigning())return Pn.err(Xt.REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS);const ee=R.subscription.peerClient.getConnectionState();return[jn.CONNECTED,jn.DISCONNECTED].includes(ee)?Pn.ok(R):Pn.err(Object.assign(Object.assign({},Xt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE),{details:`connectionState: ${ee}`}))})(V,{localParticipantId:me,remoteParticipant:se});if(!S.ok)this.trackReassignmentRequestRejected(S.error,Y);else try{const{token:f,nodeOverride:_}=V;yield S.value.triggerIceRestart({assignmentToken:f,traceId:Y,nodeOverride:_})}catch(f){this.logger.error({msg:"Reassignment failed.",err:f})}})),this.onIncompatibleCodecsMessage=V=>Rd(this,void 0,void 0,(function*(){var Y;yield(Y=this.localParticipant)===null||Y===void 0?void 0:Y.onIncompatibleCodecs(V.codecs)})),this.analyticsTracker=new ad;const B=mm();this.logger=new on(new zt(B),le.STAGE),this.strategyWrapper=new jl(O,this.logger),this.configManager=new Mp({logger:this.logger.unwrap(),subscribeDefaults:{jitterBuffer:{minDelayWhenPublishing:Aa.DEFAULT,minDelayWhenSubscribeOnly:Aa.DEFAULT},inBandMessaging:{enabled:!1},simulcast:{initialLayerPreference:Gu.LOWEST_QUALITY,layerPollingEnabled:!0,layerPollingIntervalMs:3e3}}}),this.errorManager=new A_(this.logger.unwrap());try{this.token=dd(w,this.analyticsTracker)}catch(V){const Y=new gr(Object.assign({action:Tn.JOIN,token:w,traceId:os(),tag:he,location:"Stage.constructor"},Xt.MALFORMED_TOKEN));throw V instanceof Error&&(Y.details=V.message),this.errorManager.handleError(Y,Wn.JOIN_ERROR)||V}this.stageConnection=new Km(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners()}setupListeners(){this.stageConnection.on(cp,((w,O)=>{this.onConnectionStateChanged(w,O)})),this.stageConnection.on(oh,(w=>{this.onRemoteParticipantJoined(w)})),this.stageConnection.on(ap,(w=>{this.onRemoteParticipantLeft(w.id)})),this.stageConnection.on(xf,(w=>{var O;w.id!==((O=this.localParticipant)===null||O===void 0?void 0:O.info.id)&&this.onRemoteParticipantStateChanged(w)})),this.stageConnection.on(Wo,(w=>Rd(this,void 0,void 0,(function*(){yield this.onReassignmentMessage(w)})))),this.stageConnection.on(ah,(w=>Rd(this,void 0,void 0,(function*(){yield this.onIncompatibleCodecsMessage(w)})))),this.stageConnection.on(la,(w=>{w instanceof gr&&this.analyticsTracker.trackError(w),this.errorManager.handleError(w,Wn.JOIN_ERROR)})),this.errorManager.on(cl.ERROR,(w=>{this.emit(ci.ERROR,w)}))}setupRemoteParticipantStreamEvents(w,O){const B=O.remote;O.on(pa.ADAPTION_CHANGED,(V=>{this.emit(ci.STAGE_STREAM_ADAPTION_CHANGED,w,B,V)})),O.on(pa.LAYERS_CHANGED,(V=>{this.emit(ci.STAGE_STREAM_LAYERS_CHANGED,w,B,V),this.updateStreamLayerForParticipantInfo(w,[O])})),O.on(pa.LAYER_SELECTED,((V,Y)=>{this.emit(ci.STAGE_STREAM_LAYER_SELECTED,w,B,V,Y)})),O.layers.length>0&&(this.emit(ci.STAGE_STREAM_LAYERS_CHANGED,w,B,B.getLayers()),this.emit(ci.STAGE_STREAM_LAYER_SELECTED,w,B,B.getSelectedLayer(),ls.SELECTED))}join(){return Rd(this,void 0,void 0,(function*(){this.analyticsTracker.start(),this.joinTraceId=os(),this.analyticsTracker.trackEvent(new Tp({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId}));try{this.token.assertTokenIsUnexpired(os(),he,"join")}catch(w){throw this.errorManager.handleError(w,Wn.JOIN_ERROR)||w}try{this.joinTraceId=yield this.stageConnection.connect(this.joinTraceId),this.connectionState===qi.CONNECTED&&(this.setupLocalParticipantOnce(),this.updateStreamsToPublishIfNecessary()),window.addEventListener("beforeunload",this.onBeforeUnloadCleanup)}catch(w){throw this.logger.error({err:w,msg:"error joining stage"}),this.errorManager.handleError(w,Wn.JOIN_ERROR,!1)||w}}))}replaceStrategy(w){this.strategyWrapper.setStrategy(w),this.refreshStrategy()}updateManagerWithExternalSubscribeConfig(w,O){var B;const V=Pn.getOk(this.strategyWrapper.subscribeConfiguration(w)),Y=Pn.getOk(this.getRemoteSubscribeConfiguration()),se=this.getInternalSubscribeOverrides(),me=w.id;let S=!1;V&&(S=this.configManager.handleExternalSubscribeConfigUpdate(me,V,ll.API));let f=!1;Y&&(f=this.configManager.handleSubscribeConfigUpdate(me,Y,ll.REMOTE));let _=!1;if(se&&(_=this.configManager.handleSubscribeConfigUpdate(me,se,ll.INTERNAL)),S||f||_){const R=this.configManager.getSubscribeConfigSnapshot(me);this.analyticsTracker.trackEventNoSharedProps(new Ul(this.token,(B=this.joinTraceId)!==null&&B!==void 0?B:os(),O==="joined"?"initial":"ad-hoc",me,R))}}getRemoteSubscribeConfiguration(){return Pn.err("todo")}getInternalSubscribeOverrides(){const w=this.strategyWrapper.hasStrategy("preferredLayerForStream"),O=this.hasListenersFor(ci.STAGE_STREAM_LAYERS_CHANGED)||this.hasListenersFor(ci.STAGE_STREAM_ADAPTION_CHANGED)||this.hasListenersFor(ci.STAGE_STREAM_LAYER_SELECTED);return{simulcast:{layerPollingEnabled:w||O}}}updateStreamLayerForParticipantInfo(w,O){O.forEach((B=>{if(B.streamType==="audio")return;const V=this.strategyWrapper.preferredLayerForStream(w,B.remote),Y=Pn.getOk_or(V,void 0);B.setLayer(Y)}))}trackReassignmentRequestRejected(w,O){const{token:B}=this,V=new gr(Object.assign(Object.assign({},w),{token:B,action:Tn.JOIN,traceId:O,tag:Ji,location:"publish"}));this.logger.error({err:V,msg:"Reassignment request rejected."}),this.analyticsTracker.trackError(V)}trackReassignmentRequest(w,O){const{token:B}=this;this.analyticsTracker.trackEvent(new Td({token:B,traceId:O,targetLocalParticipantId:w.participantId,targetRemoteParticipantId:w.remoteParticipantId}))}}var Ku;(function(L){L.UNKNOWN="unknown",L.USER_INITIATED="user-initiated",L.TOKEN_REUSED="token-reused",L.PARTICIPANT_DISCONNECTED="participant-disconnected",L.STAGE_DELETED="stage-deleted"})(Ku||(Ku={}));const Eh=h})(),s})()))})(FU)),FU.exports}var llt=clt();const Jb=su(llt),Wpe="0123456789abcdefABCDEF";Wpe.split("").map(t=>t.codePointAt(0));Array(256).fill(!0).map((t,e)=>{const n=String.fromCodePoint(e),r=Wpe.indexOf(n);return r<0?void 0:r<16?r:r-6});new TextEncoder;new TextDecoder;function fS(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;++r)if(t[r]!==e[r])return t[r]<e[r]?-1:1;return t.length===e.length?0:t.length>e.length?1:-1}var ult=(t,e,n=Math.min(t.byteLength,e.byteLength))=>{for(let r=0;r<n;r++){const i=t[r],s=e[r];if(i!==s)return 8*n-(r*8+Math.clz32(i^s)-24)}return 0},DQ=class{constructor(t,e){this.id=t,this.bucketSize=e.bucketSize||20,this.buckets=new Array(t.length*8+1).fill(void 0).map(()=>[]),this.compare=e.compare||(()=>0),this.getId=e.getId}get length(){return this.buckets.reduce((t,e)=>t+e.length,0)}*[Symbol.iterator](){for(const t of this.buckets)for(const e of t)yield e}add(t,e=this.getBitwiseDistance(this.getId(t))){if(this.has(this.getId(t),e))return!1;if(this.buckets[e].length<this.bucketSize)return this.buckets[e].push(t),!0;const n=this.buckets[e].slice(0);n.push(t);const r=n.sort(this.compare);this.buckets[e]=r.slice(0,this.bucketSize);const i=r.at(-1);return fS(this.getId(t),this.getId(i))!==0}clear(){for(let t=0;t<this.buckets.length;t++)this.buckets[t]=[]}*iterateClosestToId(t){return this.iterateNodes(t)}listClosestToId(t,e=this.buckets.length*this.bucketSize){return this.getNodes(t,void 0,e)}get(t){const e=this.buckets[t].shift();return e&&this.buckets[t].push(e),e}getById(t,e=this.getBitwiseDistance(t)){const n=this.buckets[e].findIndex(i=>fS(this.getId(i),t)===0);if(n===-1)return;const r=this.buckets[e][n];return this.buckets[e].splice(n,1),this.buckets[e].push(r),r}getBitwiseDistance(t){return ult(this.id,t)}getNodes(t,e=this.getBitwiseDistance(t),n=this.buckets.length*this.bucketSize){if(!n)return[];const r=[];for(const i of this.iterateNodes(t,e))if(r.push(i),r.length>=n)return r;return r}*iterateNodes(t,e=this.getBitwiseDistance(t)){const n=Math.max(e,this.buckets.length-1-e);let r=0,i=(r%2===0?1:-1)*Math.ceil(r/2);for(;Math.abs(i)<=n;){const s=e+i;if(0<=s&&s<this.buckets.length){const o=this.buckets[s];if(o){const a=o.map(c=>this.getId(c));for(const c of a){const l=this.getById(c,s);l&&(yield l)}}}r++,i=(r%2===0?1:-1)*Math.ceil(r/2)}}has(t,e=this.getBitwiseDistance(t)){return!!this.buckets[e].find(n=>fS(this.getId(n),t)===0)}peek(t){return this.buckets[t].at(0)}peekById(t,e=this.getBitwiseDistance(t)){return this.buckets[e].find(n=>fS(this.getId(n),t)===0)}update(t,e=this.getBitwiseDistance(this.getId(t))){const n=this.buckets[e].findIndex(r=>fS(this.getId(r),this.getId(t))===0);return n===-1?!1:(this.buckets[e][n]=t,!0)}remove(t,e=this.getBitwiseDistance(t)){const n=this.buckets[e].findIndex(r=>fS(this.getId(r),t)===0);return n===-1?!1:(this.buckets[e].splice(n,1),!0)}};class flt{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return hlt(e).buffer}}function hlt(t){let e=0;for(const i of t)e+=i.byteLength;const n=new Uint8Array(e);let r=0;for(const i of t){const s=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);n.set(s,r),r+=i.byteLength}return n}function Kpe(t){return new dlt(t).unpack()}function Xpe(t){const e=new plt,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class dlt{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,i="",s,o;for(;r<e;)s=n[r],s<160?(o=s,r++):(s^192)<32?(o=(s&31)<<6|n[r+1]&63,r+=2):(s^224)<16?(o=(s&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(s&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),i+=String.fromCodePoint(o);return this.index+=e,i}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const i=this.unpack();n[i]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,i=e&8388607|8388608;return(n===0?1:-1)*i*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,i=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(i-20)+n*2**(i-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class plt{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=i=>{if(i<n){const s=this.pack(e[i]);return s instanceof Promise?s.then(()=>r(i+1)):r(i+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),i=e/2**r-1,s=Math.floor(i*2**52),o=2**32,a=n<<31|r+1023<<20|s/o&1048575,c=s%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const i=s=>{if(s<n.length){const o=n[s];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>i(s+1))}return i(s+1)}};return i(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new flt,this._textEncoder=new TextEncoder}}let Ype=!0,Zpe=!0;function eA(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function ME(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const c=l=>{const u=n(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),i.apply(this,[o,c])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function mlt(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Ype=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function glt(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Zpe=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Jpe(){if(typeof window=="object"){if(Ype)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Sj(t,e){Zpe&&console.warn(t+" is deprecated, please use "+e+" instead.")}function _lt(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(eA(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(eA(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(eA(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=eA(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function LQ(t){return Object.prototype.toString.call(t)==="[object Object]"}function Qpe(t){return LQ(t)?Object.keys(t).reduce(function(e,n){const r=LQ(t[n]),i=r?Qpe(t[n]):t[n],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[n]:i})},{}):t}function BB(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?BB(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{BB(t,t.get(i),n)})}))}function UQ(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===r&&a.trackId===o.id&&BB(t,a,i)})}),i}const BQ=Jpe;function eme(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(d,m){return d?d+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){c.optional=c.optional||[];let d={};typeof u.ideal=="number"?(d[h("min",l)]=u.ideal,c.optional.push(d),d={},d[h("max",l)]=u.ideal,c.optional.push(d)):(d[h("",l)]=u.ideal,c.optional.push(d))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=u.exact):["min","max"].forEach(d=>{u[d]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(d,l)]=u[d])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},i=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,h,d){h in u&&!(d in u)&&(u[d]=u[h],delete u[h])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(d=>{d=d.filter(p=>p.kind==="videoinput");let m=d.find(p=>h.some(g=>p.label.toLowerCase().includes(g)));return!m&&d.length&&h.includes("back")&&(m=d[d.length-1]),m&&(a.video.deviceId=l.exact?{exact:m.deviceId}:{ideal:m.deviceId}),a.video=r(a.video),BQ("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return BQ("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){i(a,u=>{n.webkitGetUserMedia(u,c,h=>{l&&l(s(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function tme(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function nme(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):s={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.id):s={track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ME(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function rme(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=i.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ime(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>UQ(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),ME(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>UQ(s,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let i,s,o;return this.getSenders().forEach(a=>{a.track===r&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(s?o=!0:s=a),a.track===r)),o||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function sme(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function ome(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return sme(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const p=this._streams[h.id];if(p)p.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([u]);this._streams[h.id]=g,this._reverseStreams[g.id]=h,this.addStream(g)}return this.getSenders().find(g=>g.track===u)};function s(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(d=>{const m=l._reverseStreams[d],p=l._streams[m.id];h=h.replace(new RegExp(p.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(d=>{const m=l._reverseStreams[d],p=l._streams[m.id];h=h.replace(new RegExp(m.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],h={[l](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[p=>{const g=s(this,p);d[0].apply(null,[g])},p=>{d[1]&&d[1].apply(null,p)},arguments[2]]):u.apply(this,arguments).then(p=>s(this,p))}};t.RTCPeerConnection.prototype[l]=h[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(g=>u.track===g)&&(d=this._streams[m])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function FB(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function ame(t,e){ME(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const FQ=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:ame,shimAddTrackRemoveTrack:ome,shimAddTrackRemoveTrackWithNative:sme,shimGetSendersWithDtmf:rme,shimGetUserMedia:eme,shimMediaStream:tme,shimOnTrack:nme,shimPeerConnection:FB,shimSenderReceiverGetStats:ime},Symbol.toStringTag,{value:"Module"}));function cme(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){Sj("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function vlt(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function lme(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function jB(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,a)}}function ume(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function fme(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),ME(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function hme(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Sj("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function dme(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function pme(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function mme(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function gme(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function _me(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const jQ=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:pme,shimCreateAnswer:_me,shimCreateOffer:gme,shimGetDisplayMedia:vlt,shimGetParameters:mme,shimGetUserMedia:cme,shimOnTrack:lme,shimPeerConnection:jB,shimRTCDataChannel:dme,shimReceiverGetStats:fme,shimRemoveStream:hme,shimSenderGetStats:ume},Symbol.toStringTag,{value:"Module"}));function vme(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function yme(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function bme(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],d=n.apply(this,[h]);return u?(d.then(l,u),Promise.resolve()):d},e.createAnswer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[h]);return u?(d.then(l,u),Promise.resolve()):d};let a=function(c,l,u){const h=i.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,l,u){const h=s.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,l,u){const h=o.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.addIceCandidate=a}function Eme(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(Sme(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function Sme(t){return t&&t.video!==void 0?Object.assign({},t,{video:Qpe(t.video)}):t}function xme(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(Sj("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(r.iceServers[o])}r.iceServers=s}return new e(r,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Tme(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wme(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Rme(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const zQ=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Rme,shimCallbacksAPI:bme,shimConstraints:Sme,shimCreateOfferLegacy:wme,shimGetUserMedia:Eme,shimLocalStreamsAPI:vme,shimRTCIceServerUrls:xme,shimRemoteStreamsAPI:yme,shimTrackEventTransceiver:Tme},Symbol.toStringTag,{value:"Module"}));var jU={exports:{}},HQ;function ylt(){return HQ||(HQ=1,(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],s=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");r.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(d=>e.parseSsrcMedia(d)).filter(d=>d.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(d=>d.substring(17).split(" ").map(p=>parseInt(p,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),i.codecs.forEach(d=>{if(d.name.toUpperCase()==="RTX"&&d.parameters.apt){let m={ssrc:c,codecPayloadType:parseInt(d.parameters.apt,10)};c&&l&&(m.rtx={ssrc:l}),r.push(m),s&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(m))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-2e3*8:h=void 0,r.forEach(d=>{d.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e})(jU)),jU.exports}var Cme=ylt();const XS=su(Cme),blt=Xme({__proto__:null,default:XS},[Cme]);function oI(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=XS.parseCandidate(r.candidate);for(const o in s)o in i||Object.defineProperty(i,o,{value:s[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,ME(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function zB(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||ME(t,"icecandidate",e=>{if(e.candidate){const n=XS.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function aI(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=XS.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=XS.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=XS.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),l=i(c),u=s(arguments[0],c);let h;l===0&&u===0?h=Number.POSITIVE_INFINITY:l===0||u===0?h=Math.max(l,u):h=Math.min(l,u);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return h}}),this._sctp=d}return o.apply(this,arguments)}}function cI(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},ME(t,"datachannel",r=>(e(r.channel,r.target),r))}function HB(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function qB(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return n.apply(this,arguments)}}function lI(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function uI(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const Elt=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:qB,shimAddIceCandidateNullOrEmpty:lI,shimConnectionState:HB,shimMaxMessageSize:aI,shimParameterlessSetLocalDescription:uI,shimRTCIceCandidate:oI,shimRTCIceCandidateRelayProtocol:zB,shimSendThrowTypeError:cI},Symbol.toStringTag,{value:"Module"}));function Slt({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=Jpe,r=_lt(t),i={browserDetails:r,commonShim:Elt,extractVersion:eA,disableLog:mlt,disableWarnings:glt,sdp:blt};switch(r.browser){case"chrome":if(!FQ||!FB||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=FQ,lI(t,r),uI(t),eme(t,r),tme(t),FB(t,r),nme(t),ome(t,r),rme(t),ime(t),ame(t,r),oI(t),zB(t),HB(t),aI(t,r),cI(t),qB(t,r);break;case"firefox":if(!jQ||!jB||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=jQ,lI(t,r),uI(t),cme(t,r),jB(t,r),lme(t),hme(t),ume(t),fme(t),dme(t),pme(t),mme(t),gme(t),_me(t),oI(t),HB(t),aI(t,r),cI(t);break;case"safari":if(!zQ||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=zQ,lI(t,r),uI(t),xme(t),wme(t),bme(t),vme(t),yme(t),Tme(t),Eme(t),Rme(t),oI(t),zB(t),aI(t,r),cI(t),qB(t,r);break;default:n("Unsupported browser!");break}return i}const qQ=Slt({window:typeof window>"u"?void 0:window});function kE(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class Ame{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,i=Math.ceil(r/this.chunkedMTU);let s=0,o=0;for(;o<r;){const a=Math.min(r,o+this.chunkedMTU),c=e.slice(o,a),l={__peerData:this._dataCount,n:s,data:c,total:i};n.push(l),o=a,s++}return this._dataCount++,n}}}function xlt(t){let e=0;for(const i of t)e+=i.byteLength;const n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.byteLength;return n}const zU=qQ.default||qQ,jC=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return zU.browserDetails.browser}getVersion(){return zU.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=zU.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},Tlt=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),Mme=()=>Math.random().toString(36).slice(2),VQ={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class wlt extends Ame{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(i){i.target&&n(i.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=VQ,this.browser=jC.getBrowser(),this.browserVersion=jC.getVersion(),this.pack=Xpe,this.unpack=Kpe,this.supports=(function(){const n={browser:jC.isBrowserSupported(),webRTC:jC.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(VQ),n.audioVideo=!0;let i;try{i=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!i.ordered;try{i.binaryType="blob",n.binaryBlob=!jC.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{r&&r.close()}return n})(),this.validateId=Tlt,this.randomToken=Mme}}const Ch=new wlt,Rlt="PeerJS: ";class Clt{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[Rlt,...n];for(const i in r)r[i]instanceof Error&&(r[i]="("+r[i].name+") "+r[i].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var or=new Clt,xj={},Alt=Object.prototype.hasOwnProperty,Zf="~";function yM(){}Object.create&&(yM.prototype=Object.create(null),new yM().__proto__||(Zf=!1));function Mlt(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function kme(t,e,n,r,i){if(typeof n!="function")throw new TypeError("The listener must be a function");var s=new Mlt(n,r||t,i),o=Zf?Zf+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],s]:t._events[o].push(s):(t._events[o]=s,t._eventsCount++),t}function fI(t,e){--t._eventsCount===0?t._events=new yM:delete t._events[e]}function uf(){this._events=new yM,this._eventsCount=0}uf.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)Alt.call(n,r)&&e.push(Zf?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};uf.prototype.listeners=function(e){var n=Zf?Zf+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o};uf.prototype.listenerCount=function(e){var n=Zf?Zf+e:e,r=this._events[n];return r?r.fn?1:r.length:0};uf.prototype.emit=function(e,n,r,i,s,o){var a=Zf?Zf+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,i),!0;case 5:return c.fn.call(c.context,n,r,i,s),!0;case 6:return c.fn.call(c.context,n,r,i,s,o),!0}for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var d=c.length,m;for(h=0;h<d;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,i);break;default:if(!u)for(m=1,u=new Array(l-1);m<l;m++)u[m-1]=arguments[m];c[h].fn.apply(c[h].context,u)}}return!0};uf.prototype.on=function(e,n,r){return kme(this,e,n,r,!1)};uf.prototype.once=function(e,n,r){return kme(this,e,n,r,!0)};uf.prototype.removeListener=function(e,n,r,i){var s=Zf?Zf+e:e;if(!this._events[s])return this;if(!n)return fI(this,s),this;var o=this._events[s];if(o.fn)o.fn===n&&(!i||o.once)&&(!r||o.context===r)&&fI(this,s);else{for(var a=0,c=[],l=o.length;a<l;a++)(o[a].fn!==n||i&&!o[a].once||r&&o[a].context!==r)&&c.push(o[a]);c.length?this._events[s]=c.length===1?c[0]:c:fI(this,s)}return this};uf.prototype.removeAllListeners=function(e){var n;return e?(n=Zf?Zf+e:e,this._events[n]&&fI(this,n)):(this._events=new yM,this._eventsCount=0),this};uf.prototype.off=uf.prototype.removeListener;uf.prototype.addListener=uf.prototype.on;uf.prefixed=Zf;uf.EventEmitter=uf;xj=uf;var OE={};kE(OE,"ConnectionType",()=>$y);kE(OE,"PeerErrorType",()=>$c);kE(OE,"BaseConnectionErrorType",()=>VB);kE(OE,"DataConnectionErrorType",()=>Tj);kE(OE,"SerializationType",()=>$P);kE(OE,"SocketEventType",()=>Ly);kE(OE,"ServerMessageType",()=>tf);var $y=(function(t){return t.Data="data",t.Media="media",t})({}),$c=(function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t})({}),VB=(function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t})({}),Tj=(function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t})({}),$P=(function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t})({}),Ly=(function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t})({}),tf=(function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t})({});const Ome="1.5.5";class klt extends xj.EventEmitter{constructor(e,n,r,i,s,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+n+":"+r+i+"peerjs?key="+s}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+Ome),this._disconnected=!1,this._socket.onmessage=i=>{let s;try{s=JSON.parse(i.data),or.log("Server message received:",s)}catch{or.log("Invalid server message",i.data);return}this.emit(Ly.Message,s)},this._socket.onclose=i=>{this._disconnected||(or.log("Socket closed.",i),this._cleanup(),this._disconnected=!0,this.emit(Ly.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),or.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){or.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:tf.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Ly.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class Ime{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===$y.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,i={ordered:!!e.reliable},s=n.createDataChannel(r.label,i);r._initializeDataChannel(s),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){or.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,s=this.connection.provider;or.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(or.log(`Received ICE candidates for ${n}:`,o.candidate),s.socket.send({type:tf.Candidate,payload:{candidate:o.candidate,type:i,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":or.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(VB.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":or.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(VB.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":or.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},or.log("Listening for data channel"),e.ondatachannel=o=>{or.log("Received data channel");const a=o.channel;s.getConnection(n,r)._initializeDataChannel(a)},or.log("Listening for remote stream"),e.ontrack=o=>{or.log("Received remote stream");const a=o.streams[0],c=s.getConnection(n,r);if(c.type===$y.Media){const l=c;this._addStreamToMediaConnection(a,l)}}}cleanup(){or.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const i=this.connection.dataChannel;i&&(r=!!i.readyState&&i.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);or.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),or.log("Set localDescription:",r,`for:${this.connection.peer}`);let i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===$y.Data){const s=this.connection;i={...i,label:s.label,reliable:s.reliable,serialization:s.serialization}}n.socket.send({type:tf.Offer,payload:i,dst:this.connection.peer})}catch(i){i!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError($c.WebRTC,i),or.log("Failed to setLocalDescription, ",i))}}catch(r){n.emitError($c.WebRTC,r),or.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();or.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),or.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:tf.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(i){n.emitError($c.WebRTC,i),or.log("Failed to setLocalDescription, ",i)}}catch(r){n.emitError($c.WebRTC,r),or.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,i=this.connection.provider;or.log("Setting remote description",n);const s=this;try{await r.setRemoteDescription(n),or.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await s._makeAnswer()}catch(o){i.emitError($c.WebRTC,o),or.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){or.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),or.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError($c.WebRTC,n),or.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(or.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return or.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){or.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class Nme extends xj.EventEmitter{emitError(e,n){or.error("Error:",n),this.emit("error",new Olt(`${e}`,n))}}class Olt extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class Pme extends Nme{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}class JN extends Pme{static#e=this.ID_PREFIX="mc_";get type(){return $y.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||JN.ID_PREFIX+Ch.randomToken(),this._negotiator=new Ime(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{or.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{or.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){or.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case tf.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case tf.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:or.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){or.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const i of r)this.handleMessage(i);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class Ilt{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:i,path:s,key:o}=this._options,a=new URL(`${n}://${r}:${i}${s}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",Ome),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){or.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Ch.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Ch.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw or.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}class QN extends Pme{static#e=this.ID_PREFIX="dc_";static#t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return $y.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||QN.ID_PREFIX+Mme(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new Ime(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{or.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{or.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{or.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(Tj.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case tf.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case tf.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:or.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}}class wj extends QN{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>QN.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return or.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class HU extends wj{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new Ame,this.serialization=$P.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=Kpe(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const i=xlt(r.data);this._handleDataMessage({data:i})}}_send(e,n){const r=Xpe(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);or.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class Nlt extends wj{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=$P.None}}class Plt extends wj{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Ch.chunkedMTU){this.emitError(Tj.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=$P.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class Rj extends Nme{static#e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:Nlt,json:Plt,binary:HU,"binary-utf8":HU,default:HU},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Ch.CLOUD_HOST,port:Ch.CLOUD_PORT,path:"/",key:Rj.DEFAULT_KEY,token:Ch.randomToken(),config:Ch.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Ch.CLOUD_HOST?this._options.secure=Ch.isSecure():this._options.host==Ch.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&or.setLogFunction(this._options.logFunction),or.logLevel=this._options.debug||0,this._api=new Ilt(n),this._socket=this._createServerConnection(),!Ch.supports.audioVideo&&!Ch.supports.data){this._delayedAbort($c.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Ch.validateId(r)){this._delayedAbort($c.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(i=>this._initialize(i)).catch(i=>this._abort($c.ServerError,i))}_createServerConnection(){const e=new klt(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Ly.Message,n=>{this._handleMessage(n)}),e.on(Ly.Error,n=>{this._abort($c.SocketError,n)}),e.on(Ly.Disconnected,()=>{this.disconnected||(this.emitError($c.Network,"Lost connection to server."),this.disconnect())}),e.on(Ly.Close,()=>{this.disconnected||this._abort($c.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,i=e.src;switch(n){case tf.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case tf.Error:this._abort($c.ServerError,r.msg);break;case tf.IdTaken:this._abort($c.UnavailableID,`ID "${this.id}" is taken`);break;case tf.InvalidKey:this._abort($c.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case tf.Leave:or.log(`Received leave message from ${i}`),this._cleanupPeer(i),this._connections.delete(i);break;case tf.Expire:this.emitError($c.PeerUnavailable,`Could not connect to peer ${i}`);break;case tf.Offer:{const s=r.connectionId;let o=this.getConnection(i,s);if(o&&(o.close(),or.warn(`Offer received for existing Connection ID:${s}`)),r.type===$y.Media){const c=new JN(i,this,{connectionId:s,_payload:r,metadata:r.metadata});o=c,this._addConnection(i,o),this.emit("call",c)}else if(r.type===$y.Data){const c=new this._serializers[r.serialization](i,this,{connectionId:s,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(i,o),this.emit("connection",c)}else{or.warn(`Received malformed connection type:${r.type}`);return}const a=this._getMessages(s);for(const c of a)o.handleMessage(c);break}default:{if(!r){or.warn(`You received a malformed message from ${i} of type ${n}`);return}const s=r.connectionId,o=this.getConnection(i,s);o&&o.peerConnection?o.handleMessage(e):s?this._storeMessage(s,e):or.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){or.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError($c.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){or.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError($c.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){or.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const i=new JN(e,this,{...r,_stream:n});return this._addConnection(e,i),i}_addConnection(e,n){or.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const i of r)if(i.connectionId===n)return i;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){or.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(or.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;or.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)or.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)or.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort($c.ServerError,n))}}var Dlt=Rj;let jd="",Ri,bM,k0,Mu;const GQ={},Cj=new Map,e3=new Map;function Dme(t){return ge(Mu)?Mu.listClosestToId(Hd(t),1).filter(e=>e.peer!==Ri?.id):[]}function Aj(t){return Pxe(t)}let t3;function Llt(){if(ge(t3)||Ri?.id===jd)return;Hme=128;function t(){const e=ui();ZSe(ut,e),Ei(ut,e,"uplinking....")}t(),t3=setInterval(t,5*1e3)}function Lme(){clearInterval(t3),t3=void 0}function Ume(t,e){if(!ge(Ri)||!ge(Mu))return;const n=Dme(t);for(let r=0;r<n.length;++r){const i=n[r];i.peer!==Ri.id&&i.dataconnection?.open&&i.dataconnection?.send(e)?.catch(o=>console.error(o))}}function Bme(t){if(!ge(Ri)||!ge(Mu))return;const e=Date.now(),n=e3.get(jd)??new Map;for(const[r,i]of n)e-i>1e3*60?n.delete(r):Ume(r,t)}function $Q(t){bM?.forward({...t,session:ut.session()}),t.target.includes("acklogin")&&Lme()}const Ult=5e3;function Fme(t){const e=ui();GQ[t.peer]=setTimeout(()=>{k0?.remove(Hd(t.peer)),Cj.set(t.peer,!0),Ei(ut,e,`failed to connect to ${t.peer}`)},Ult);function n(){if(t.open&&ge(Mu)&&ge(Ri)){Ei(ut,e,`connection ${t.peer} open`),Mu.add({peer:t.peer,id:Hd(t.peer),dataconnection:t});const i={id:va(),topic:jd,ping:Ri.id};t.send(i)?.catch(o=>console.error(o)),Llt()}}t.on("open",n),t.on("close",()=>{ge(Ri)&&ge(Mu)&&(Ei(ut,e,`disconnection from ${t.peer}`),Mu.remove(Hd(t.peer)))});const r=new Set;t.on("data",i=>{const s=i;if(r.has(s.id)||!ge(Ri)||!ge(k0)||!ge(Mu))return;r.add(s.id);const o=Date.now(),a=e3.get(jd)??new Map;if("ping"in s){if(s.topic===jd&&s.ping!==Ri.id){const c={id:va(),topic:jd,pong:Ri.id};t.send(c)?.catch(u=>console.error(u))}}else if("pong"in s)clearTimeout(GQ[s.pong]),Ei(ut,e,`connected to ${t.peer}`);else if("pub"in s)s.topic===jd&&$Q(s.gme),Bme(s);else if("sub"in s){a.set(s.sub,o);const c=Hd(s.sub);k0.has(c)||k0.add({peer:s.sub,id:c,dataconnection:void 0}),s.topic===Ri.id?ge(s.gme)&&$Q(s.gme):Ume(s.topic,s)}e3.set(s.topic,a)}),t.on("error",i=>{Pr(ut,e,"netterminal",`dataconnection ${t.peer} - ${JSON.stringify(i)}`)}),n()}function jme(t){jd=t;const e=ui(),n=Aj(e);Ri=new Dlt(n,{debug:2}),window.addEventListener("unload",()=>{Ri?.disconnect(),Ri=void 0}),Ei(ut,e,`netterminal for ${n}`),Ei(ut,e,`session topic ${jd}`),k0=new DQ(Hd(Ri.id),{getId(r){return r.id}}),Mu=new DQ(Hd(Ri.id),{getId(r){return r.id}}),Ri.on("open",()=>{Ei(ut,ui(),"connected to netterminal"),qme()}),Ri.on("connection",Fme),Ri.on("call",()=>{}),Ri.on("disconnected",()=>{Pr(ut,ui(),"netterminal","lost connection to netterminal"),Flt()}),Ri.on("error",r=>{switch(r.type){case"peer-unavailable":return}Pr(ut,ui(),"netterminal",`${Ri?.id} - ${JSON.stringify(r)}`)})}function WQ(){const t=ui();if(ge(Ri)){Ei(ut,t,"netterminal already active");return}jme(Aj(t)),bM=F9(e=>{if(ge(Ri)&&ge(Mu)&&Art(e)&&Crt(e)===!1){const n={id:va(),topic:jd,pub:Ri.id,gme:e};Bme(n)}})}function Blt(t){if(ge(Ri)){Ei(ut,ui(),"netterminal already active");return}jme(t),bM=F9(e=>{if(ge(Ri)&&ge(Mu)&&She(e)&&Mrt(e)===!1){const n=Dme(jd);for(let r=0;r<n.length;++r){const i=n[r];if(i.dataconnection?.open){const s={id:va(),topic:jd,sub:Ri.id,gme:e};i.dataconnection.send(s,!0)?.catch(a=>console.error(a))}}}})}let zme,Hme=16;function qme(){ra(ut,ui(),async()=>{if(!ge(Ri)||!ge(k0)||!ge(Mu))return;const t=ui(),e=new FormData;e.append("peer",`pid_${Ri.id}`);const n=new Request("https://terminal.zed.cafe",{method:"POST",body:e}),i=await(await fetch(n)).json();if(Rr(i))for(let u=0;u<i.length;++u){const h=i[u].replace("pid_",""),d=Hd(h);Ri.id!=h&&k0.has(d)===!1&&Cj.has(h)===!1&&(Ei(ut,t,`adding ${h}`),k0.add({peer:h,id:d,dataconnection:void 0}))}const s=Hd(Ri.id),o=7,a=k0.listClosestToId(s,o).filter(u=>u.peer!==Ri?.id),c=new Set;for(let u=0;u<a.length;++u){const h=a[u];c.add(h.peer),Mu.has(h.id)||Fme(Ri.connect(h.peer,{reliable:!0}))}const l=Mu.listClosestToId(s,o*2).filter(u=>u.peer!==Ri?.id);for(let u=0;u<l.length;++u){const h=l[u];c.has(h.peer)===!1&&(h.dataconnection?.close(),Mu.remove(h.id))}}),zme=setTimeout(qme,Hme*1e3)}function Flt(){ge(Ri)&&(jd="",e3.clear(),Cj.clear(),clearTimeout(zme),Ri.destroy(),Ri=void 0,k0=void 0,Mu=void 0,bM?.disconnect(),bM=void 0,Lme())}let s0,Qu;async function jlt(t,e,n,r,i,s){let o;switch(hr(i)){case"get":{o=await fetch(r);break}case"post:json":{const l=[];for(let u=0;u<s.length;u+=2)l.push([s[u],s[u+1]]);o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(oSe(l))});break}}if(!o?.ok)return;const a=`fetch:${n}`,[c]=(o.headers.get("content-type")??"").split(";");switch(c){case"text/plain":{const l=await o.text();Ei(ut,t,JSON.stringify(l)),qh(ut,t,e,"text",a,l);break}case"application/json":{const l=await o.json();Ei(ut,t,JSON.stringify(l)),qh(ut,t,e,"json",a,l);break}case"application/octet-stream":{const l=await o.arrayBuffer();qh(ut,t,e,"binary",a,new Uint8Array(l));break}}}function KQ(t){const e=`${location.origin}/join/#${Aj(t)}`;return ge(po())&&po().writeText(e).catch(n=>console.error(n)),e}function zlt(t){const e=/(?:https?|ftp):\/\/[\n\S]+/g;return t.replace(e,"")}function XQ(t){let e=t.text;const n=[...t.emoteOffsets.values()];for(let r=0;r<n.length;++r){const i=n[r].reverse();for(let s=0;s<i.length;++s){const[o,a]=i[s].split("-").map(parseFloat);e=e.substring(0,o)+e.substring(a+1)}}return zlt(e)}const To=lb("bridge",[],t=>{if(!To.session(t))return;const e=ui();switch(t.target){default:if(t.player!==e)return;break}switch(t.target){case"fetch":if(Rr(t.data)){const[n,r,i,s,o]=t.data;ra(ut,t.player,async()=>{await jlt(t.player,n,r,i,s,o)})}break;case"start":WQ(),ESe(ut,t.player,!!t.data);break;case"tab":WQ(),bSe(ut,t.player);break;case"tabopen":ra(To,t.player,async()=>{await Kl(1e3);const n=KQ(t.player);window.open(n,"_blank","noopener,noreferrer")});break;case"join":Sn(t.data)&&Blt(t.data);break;case"showjoincode":ra(To,t.player,async()=>{const n=KQ(t.player),r=await ple(n);t.data?u5(To,t.player,r,"secret join url",!1):u5(To,t.player,r,r)});break;case"chatstart":ge(s0)?Pr(To,t.player,"bridge","chat is already started"):Sn(t.data)&&(Ei(To,t.player,`connecting to ${t.data}`),s0=new ZN({channels:[t.data]}),s0.connect(),s0.onConnect(()=>{Ei(To,t.player,"connected")}),s0.onDisconnect(()=>{Ei(To,t.player,"disconnected")}),s0.onMessage((n,r,i,s)=>{const o=XQ(s);qh(To,t.player,void 0,"text",`chat:message:${t.data}`,`${r}:${o}`)}),s0.onAction((n,r,i,s)=>{const o=XQ(s);qh(To,t.player,void 0,"text",`chat:action:${t.data}`,`${r}:${o}`)}));break;case"chatstop":ge(s0)?(s0.quit(),s0=void 0,Ei(To,t.player,"chat stopped")):Pr(To,t.player,"bridge","chat is already stoped");break;case"streamstart":ra(To,t.player,async()=>{if(ge(Qu))Pr(To,t.player,"bridge","stream is already open");else{const n=window.innerHeight>window.innerWidth;Qu=Jb.create({streamConfig:n?Jb.STANDARD_PORTRAIT:Jb.STANDARD_LANDSCAPE,logLevel:Jb.LOG_LEVEL.DEBUG}),Qu.on(Jb.BroadcastClientEvents.ACTIVE_STATE_CHANGE,function(s){console.info({activestate:s})}),Qu.on(Jb.BroadcastClientEvents.CONNECTION_STATE_CHANGE,function(s){Ei(To,t.player,s)}),Qu.on(Jb.BroadcastClientEvents.ERROR,function(s){Pr(To,t.player,"bridge",s),Qu=void 0});const r=document.querySelector("canvas");if(ge(r))await Qu.addImageSource(r,"video",{index:1});else{Pr(To,t.player,"video","unabled to find canvas element"),Qu=void 0;return}const i=ptt();if(ge(i))await Qu.addAudioInputDevice(i.stream,"audio");else{Pr(To,t.player,"video","unable create media audio node destination"),Qu=void 0;return}Ei(To,t.player,"created client")}Sn(t.data)&&ge(Qu)&&(ug(To,t.player,"broadcasting in"),Ih(To,t.player,"3","..."),await Kl(1e3),Ih(To,t.player,"2","..."),await Kl(1e3),Ih(To,t.player,"1","..."),await Kl(1e3),ug(To,t.player,"GOING LIVE"),await Qu.startBroadcast(t.data,"https://g.webrtc.live-video.net:4443"))});break;case"streamstop":ge(Qu)?(Qu.stopBroadcast(),Qu.delete(),Qu=void 0,Ei(To,t.player,"stream stopped")):Pr(To,t.player,"bridge","stream already stopped");break}});function Hlt(){const{viewport:t}=Hh(),{width:e,height:n}=t.getCurrentViewport();et.useEffect(()=>(Irt(mle()),()=>{Nrt()}),[]);const[r]=et.useState(()=>new Ttt);et.useEffect(()=>{if(!$Ie)return;document.body.appendChild(r.dom),r.showPanel(0),r.dom.style.cssText="position:fixed;bottom:0;left:0;";const v=CEe(()=>r.begin()),x=AEe(()=>r.end());return()=>{document.body.removeChild(r.dom),v(),x()}},[r]);const i=ktt({benchmarksURL:"/benchmarks-min"}),[s,o]=et.useState(!1),[a,c]=et.useState(!1),[l,u]=et.useState(!1);et.useLayoutEffect(()=>{ra(ut,ui(),async()=>{await GO("lowrez")==="on"&&o(!0),await GO("crt")==="on"&&!Yrt&&c(!0),await GO("scanlines")==="on"&&u(!0)})},[]);const h=Math.min(e,n),d=s||h<600;En.DRAW_CHAR_SCALE=d?1:2;const m=e>n,p=wB==="touchOnly"||yrt==="touch",g=!d&&!p&&a===!0&&i&&i.tier>2&&!i.isMobile;et.useEffect(()=>{Fh.setState(v=>({...v,islowrez:d,islandscape:m,showtouchcontrols:p}))},[d,m,p]);const y=et.useRef(null);return ke.jsxs(ke.Fragment,{children:[ke.jsx(btt,{ref:y,makeDefault:!0,near:1,far:2e3,position:[0,0,1e3]}),ke.jsx(bb,{children:ke.jsxs(xit,{children:[ke.jsx(jst,{}),ke.jsx(Mot,{}),ke.jsx(Dot,{}),ke.jsx(Uot,{})]})}),ke.jsx(Not,{width:e,height:n,children:ke.jsx(ke.Fragment,{children:g&&ke.jsxs(ke.Fragment,{children:[l&&ke.jsx(Iot,{}),ke.jsx(drt,{technique:yS.ESKIL,offset:.89,darkness:.911}),ke.jsx(Rrt,{viewheight:n})]})})})]})}document.addEventListener("keydown",()=>{y2()});window.addEventListener("click",()=>{y2()});window.addEventListener("dragover",t=>{t.preventDefault()});window.addEventListener("contextmenu",t=>{y2(),t.preventDefault()});window.addEventListener("paste",t=>{if(!t.clipboardData?.files.length)return;y2(),t.preventDefault(),[...t.clipboardData.files].forEach(n=>qh(ut,ui(),void 0,"file",`file:${n.name}`,n))});window.addEventListener("drop",t=>{y2(),t.preventDefault(),t.dataTransfer?.items?[...t.dataTransfer.items].forEach(n=>{if(n.kind==="file"){const r=n.getAsFile();ge(r)&&qh(ut,ui(),void 0,"file",r.name,r)}}):[...t.dataTransfer?.files??[]].forEach(n=>qh(ut,ui(),void 0,"file",n.name,n))});document.addEventListener("DOMContentLoaded",()=>{let t,e=!1;document.body.style.cursor="none",document.body.addEventListener("mousemove",()=>{e||(document.body.style.cursor="",clearTimeout(t),t=setTimeout(()=>{document.body.style.cursor="none",e=!0,setTimeout(()=>{e=!1},200)},3e3))})});function qlt(){return et.useEffect(()=>window.focus(),[]),Fh(e=>e.active)&&ke.jsx(Hlt,{})}f8({Mesh:Uh,OrthographicCamera:s8,Group:TS,PlaneGeometry:xM,MeshBasicMaterial:n8,BufferAttribute:Pa,BufferGeometry:$0,Points:z0e,BoxGeometry:qx,PerspectiveCamera:jf,InstancedMesh:U0e,InstancedBufferAttribute:M6});const Vlt=t=>({...MEe(t),filter:e=>{const n=e.filter(o=>!!o.object.visible),r=n.findIndex(o=>o.object.userData.blocking),i=r===-1?n:n.slice(0,r+1);let s="default";return i.some(o=>o.object.userData.cursor?(s=o.object.userData.cursor,!0):!1),document.querySelectorAll("html, body").forEach(o=>{o.style.cursor=s}),i}}),GB=EEe(document.getElementById("frame"));function Glt(t,e){const n=hH(t),r=hH(e);GB.configure({size:{top:0,left:0,width:n,height:r}}).catch(console.error)}const YQ=IEe(Glt,256);async function $lt(){await GB.configure({events:Vlt,flat:!0,linear:!0,dpr:1,shadows:!1,gl:{alpha:!1,stencil:!1,antialias:!1,preserveDrawingBuffer:!0}}),window.addEventListener("resize",()=>{YQ(window.innerWidth,window.innerHeight)}),YQ(window.innerWidth,window.innerHeight),GB.render(ke.jsx(qlt,{}))}$lt().catch(console.error)});export default Wlt();

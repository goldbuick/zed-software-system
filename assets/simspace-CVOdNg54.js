var bj=Object.defineProperty;var wj=(gi,Vn,Cn)=>Vn in gi?bj(gi,Vn,{enumerable:!0,configurable:!0,writable:!0,value:Cn}):gi[Vn]=Cn;var Ft=(gi,Vn,Cn)=>wj(gi,typeof Vn!="symbol"?Vn+"":Vn,Cn);(function(){"use strict";const gi=new Set,Vn={emit(t,e,n,r,i){Vn.invoke(xv(t,e,n,r,i))},invoke(t){gi.forEach(e=>e.handle(t))},connect(t){gi.add(t)},disconnect(t){gi.delete(t)}};var Cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ro(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function jx(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Ep={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Cn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Ep);var zx=Ep.exports,xp=ro(zx),vp={};(function(t){var e=Cn&&Cn.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,p;d<h;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,b=l.addAdverb,w=b===void 0?!1:b,k=e(e(e([],e([],Array(m),!0).map(function(T){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),w?[n(t.adverbs)]:[],!0);return h&&(k=k.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),k.join(f)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return t.adjectives.length*f*t.nouns.length*t.verbs.length*(h?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(t.adjectives).length*f+f*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(h?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(t.adjectives).length*f+f*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(h?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(vp);var kp=ro(vp);const Kx="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Wx=t=>crypto.getRandomValues(new Uint8Array(t)),Hx=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},Tp=(t,e=21)=>Hx(t,e,Wx),Gx=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=Kx[n[t]&63];return e};var Ap="abcdefghijklmnopqrstuvwxyz",Rp="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Sp="0123456789",Yx="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",Vx="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const Zx=Sp,Xx=Ap,qx=Rp;var Jx=Zx+Xx+qx,dh={lowercase:Ap,uppercase:Rp,numbers:Sp,nolookalikes:Yx,nolookalikesSafe:Vx,alphanumeric:Jx};function Pe(){return`sid_${Gx(12).replaceAll("-",".")}`}Tp(dh.numbers,4),Tp(`${dh.numbers}${dh.lowercase}`,16);function Kr(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function Qx(){return kp({capitalize:!1,adjectiveCount:1})}function tv(){return kp({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var ev=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),nv=Object.prototype.hasOwnProperty;function ph(t,e){return nv.call(t,e)}function mh(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)ph(t,i)&&r.push(i);return r}function Ln(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function gh(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Es(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Op(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function _h(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(_h(t[e]))return!0}else if(typeof t=="object"){for(var r=mh(t),i=r.length,s=0;s<i;s++)if(_h(t[r[s]]))return!0}}return!1}function Ip(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Np=function(t){ev(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,Ip(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Ip(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),Me=Np,rv=Ln,io={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=jc(n,this.path);r&&(r=Ln(r));var i=xs(n,{op:"remove",path:this.from}).removed;return xs(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=jc(n,this.from);return xs(n,{op:"add",path:this.path,value:Ln(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:ga(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},iv={add:function(t,e,n){return gh(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:io.move,copy:io.copy,test:io.test,_get:io._get};function jc(t,e){if(e=="")return t;var n={op:"_get",path:e};return xs(t,n),n.value}function xs(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):zc(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=jc(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=ga(t,e.value),o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Ln(t));var a=e.path||"",c=a.split("/"),l=t,u=1,f=c.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=zc;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Op(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!gh(h))throw new Me("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);gh(h)&&(h=~~h)}if(u>=f){if(n&&e.op==="add"&&h>l.length)throw new Me("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=iv[e.op].call(e,l,h,t);if(o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=f){var o=io[e.op].call(e,l,h,t);if(o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Me("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function yh(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Ln(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=xs(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function sv(t,e,n){var r=xs(t,e);if(r.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function zc(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new Me("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(io[t.op]){if(typeof t.path!="string")throw new Me("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Me('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Me("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&_h(t.value))throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Me("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new Me("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Cp([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Me("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Cp(t,e,n){try{if(!Array.isArray(t))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)yh(Ln(e),Ln(t),n||!0);else{n=n||zc;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof Me)return i;throw i}}function ga(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!ga(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ga(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var ov=Object.freeze({__proto__:null,JsonPatchError:Me,_areEquals:ga,applyOperation:xs,applyPatch:yh,applyReducer:sv,deepClone:rv,getValueByPointer:jc,validate:Cp,validator:zc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var bh=new WeakMap,av=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),cv=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function lv(t){return bh.get(t)}function uv(t,e){return t.observers.get(e)}function hv(t,e){t.observers.delete(e.callback)}function fv(t,e){e.unobserve()}function dv(t,e){var n=[],r,i=lv(t);if(!i)i=new av(t),bh.set(t,i);else{var s=uv(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Ln(t),e){r.callback=e,r.next=null;var o=function(){wh(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){wh(r),clearTimeout(r.next),hv(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new cv(e,r)),r}function wh(t,e){e===void 0&&(e=!1);var n=bh.get(t.object);Eh(n.value,t.object,t.patches,"",e),t.patches.length&&yh(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function Eh(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=mh(e),o=mh(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(ph(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var f=e[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?Eh(u,f,n,r+"/"+Es(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+Es(l),value:Ln(u)}),n.push({op:"replace",path:r+"/"+Es(l),value:Ln(f)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+Es(l),value:Ln(u)}),n.push({op:"remove",path:r+"/"+Es(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!ph(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+Es(l),value:Ln(e[l])})}}}function Lp(t,e,n){n===void 0&&(n=!1);var r=[];return Eh(t,e,r,"",n),r}var pv=Object.freeze({__proto__:null,compare:Lp,generate:wh,observe:dv,unobserve:fv});Object.assign({},ov,pv,{JsonPatchError:Np,deepClone:Ln,escapePathComponent:Es,unescapePathComponent:Op});var mv=typeof Element<"u",gv=typeof Map=="function",_v=typeof Set=="function",yv=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Kc(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!Kc(t[r],e[r]))return!1;return!0}var s;if(gv&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!Kc(r.value[1],e.get(r.value[0])))return!1;return!0}if(_v&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(yv&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(mv&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!Kc(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var bv=function(e,n){try{return Kc(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},wv=ro(bv);function x(t){return t!=null}const hr=Object.keys;function Zn(t){return Ln(t)}function Ev(t){return typeof t=="boolean"}function At(t){return typeof t=="number"&&isNaN(t)===!1}function wt(t){return typeof t=="string"}function ce(t){return Array.isArray(t)}function xh(t){return t}var Rt=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(Rt||{}),zt=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(zt||{}),fr=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(fr||{}),pt=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.PLAYER=18]="PLAYER",t[t.FIND=19]="FIND",t[t.FLEE=20]="FLEE",t[t.TO=21]="TO",t[t.MID=22]="MID",t[t.OVER=23]="OVER",t[t.UNDER=24]="UNDER",t))(pt||{}),vt=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.HOTKEY=11]="HOTKEY",t[t.COPYIT=12]="COPYIT",t[t.OPENIT=13]="OPENIT",t[t.ZSSEDIT=14]="ZSSEDIT",t[t.CHAREDIT=15]="CHAREDIT",t[t.COLOREDIT=16]="COLOREDIT",t))(vt||{});function It(t){return(t==null?void 0:t.toLowerCase().trim())??""}function xv(t,e,n,r,i){return{session:t,player:e,id:Pe(),sender:n,target:r,data:i}}function Xn(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function so(t,e=[],n=xh,r=""){const i=Pe(),s=It(t),o=e.map(It);let a=r;const c={id(){return i},name(){return t},session(l){return x(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,f){Vn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=Xn(l.target),d=It(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&x(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return Vn.connect(c),c}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const vv=4,Mp=0,Up=1,kv=2;function oo(t){let e=t.length;for(;--e>=0;)t[e]=0}const Tv=0,Fp=1,Av=2,Rv=3,Sv=258,vh=29,_a=256,ya=_a+1+vh,ao=30,kh=19,Bp=2*ya+1,vs=15,Th=16,Ov=7,Ah=256,Pp=16,Dp=17,$p=18,Rh=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Wc=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Iv=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),jp=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nv=512,_i=new Array((ya+2)*2);oo(_i);const ba=new Array(ao*2);oo(ba);const wa=new Array(Nv);oo(wa);const Ea=new Array(Sv-Rv+1);oo(Ea);const Sh=new Array(vh);oo(Sh);const Hc=new Array(ao);oo(Hc);function Oh(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let zp,Kp,Wp;function Ih(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const Hp=t=>t<256?wa[t]:wa[256+(t>>>7)],xa=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},Mn=(t,e,n)=>{t.bi_valid>Th-n?(t.bi_buf|=e<<t.bi_valid&65535,xa(t,t.bi_buf),t.bi_buf=e>>Th-t.bi_valid,t.bi_valid+=n-Th):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Wr=(t,e,n)=>{Mn(t,n[e*2],n[e*2+1])},Gp=(t,e)=>{let n=0;do n|=t&1,t>>>=1,n<<=1;while(--e>0);return n>>>1},Cv=t=>{t.bi_valid===16?(xa(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},Lv=(t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,f,d,h,p,m=0;for(d=0;d<=vs;d++)t.bl_count[d]=0;for(n[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<Bp;l++)u=t.heap[l],d=n[n[u*2+1]*2+1]+1,d>c&&(d=c,m++),n[u*2+1]=d,!(u>r)&&(t.bl_count[d]++,h=0,u>=a&&(h=o[u-a]),p=n[u*2],t.opt_len+=p*(d+h),s&&(t.static_len+=p*(i[u*2+1]+h)));if(m!==0){do{for(d=c-1;t.bl_count[d]===0;)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[c]--,m-=2}while(m>0);for(d=c;d!==0;d--)for(u=t.bl_count[d];u!==0;)f=t.heap[--l],!(f>r)&&(n[f*2+1]!==d&&(t.opt_len+=(d-n[f*2+1])*n[f*2],n[f*2+1]=d),u--)}},Yp=(t,e,n)=>{const r=new Array(vs+1);let i=0,s,o;for(s=1;s<=vs;s++)i=i+n[s-1]<<1,r[s]=i;for(o=0;o<=e;o++){let a=t[o*2+1];a!==0&&(t[o*2]=Gp(r[a]++,a))}},Mv=()=>{let t,e,n,r,i;const s=new Array(vs+1);for(n=0,r=0;r<vh-1;r++)for(Sh[r]=n,t=0;t<1<<Rh[r];t++)Ea[n++]=r;for(Ea[n-1]=r,i=0,r=0;r<16;r++)for(Hc[r]=i,t=0;t<1<<Wc[r];t++)wa[i++]=r;for(i>>=7;r<ao;r++)for(Hc[r]=i<<7,t=0;t<1<<Wc[r]-7;t++)wa[256+i++]=r;for(e=0;e<=vs;e++)s[e]=0;for(t=0;t<=143;)_i[t*2+1]=8,t++,s[8]++;for(;t<=255;)_i[t*2+1]=9,t++,s[9]++;for(;t<=279;)_i[t*2+1]=7,t++,s[7]++;for(;t<=287;)_i[t*2+1]=8,t++,s[8]++;for(Yp(_i,ya+1,s),t=0;t<ao;t++)ba[t*2+1]=5,ba[t*2]=Gp(t,5);zp=new Oh(_i,Rh,_a+1,ya,vs),Kp=new Oh(ba,Wc,0,ao,vs),Wp=new Oh(new Array(0),Iv,0,kh,Ov)},Vp=t=>{let e;for(e=0;e<ya;e++)t.dyn_ltree[e*2]=0;for(e=0;e<ao;e++)t.dyn_dtree[e*2]=0;for(e=0;e<kh;e++)t.bl_tree[e*2]=0;t.dyn_ltree[Ah*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Zp=t=>{t.bi_valid>8?xa(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Xp=(t,e,n,r)=>{const i=e*2,s=n*2;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},Nh=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&Xp(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Xp(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},qp=(t,e,n)=>{let r,i,s=0,o,a;if(t.sym_next!==0)do r=t.pending_buf[t.sym_buf+s++]&255,r+=(t.pending_buf[t.sym_buf+s++]&255)<<8,i=t.pending_buf[t.sym_buf+s++],r===0?Wr(t,i,e):(o=Ea[i],Wr(t,o+_a+1,e),a=Rh[o],a!==0&&(i-=Sh[o],Mn(t,i,a)),r--,o=Hp(r),Wr(t,o,n),a=Wc[o],a!==0&&(r-=Hc[o],Mn(t,r,a)));while(s<t.sym_next);Wr(t,Ah,e)},Ch=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,c=-1,l;for(t.heap_len=0,t.heap_max=Bp,o=0;o<s;o++)n[o*2]!==0?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):n[o*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=r[l*2+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)Nh(t,n,o);l=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Nh(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[l*2]=n[o*2]+n[a*2],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[o*2+1]=n[a*2+1]=l,t.heap[1]=l++,Nh(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Lv(t,e),Yp(n,c,t.bl_count)},Jp=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),e[(n+1)*2+1]=65535,r=0;r<=n;r++)s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)&&(a<l?t.bl_tree[s*2]+=a:s!==0?(s!==i&&t.bl_tree[s*2]++,t.bl_tree[Pp*2]++):a<=10?t.bl_tree[Dp*2]++:t.bl_tree[$p*2]++,a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4))},Qp=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),r=0;r<=n;r++)if(s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)){if(a<l)do Wr(t,s,t.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Wr(t,s,t.bl_tree),a--),Wr(t,Pp,t.bl_tree),Mn(t,a-3,2)):a<=10?(Wr(t,Dp,t.bl_tree),Mn(t,a-3,3)):(Wr(t,$p,t.bl_tree),Mn(t,a-11,7));a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4)}},Uv=t=>{let e;for(Jp(t,t.dyn_ltree,t.l_desc.max_code),Jp(t,t.dyn_dtree,t.d_desc.max_code),Ch(t,t.bl_desc),e=kh-1;e>=3&&t.bl_tree[jp[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},Fv=(t,e,n,r)=>{let i;for(Mn(t,e-257,5),Mn(t,n-1,5),Mn(t,r-4,4),i=0;i<r;i++)Mn(t,t.bl_tree[jp[i]*2+1],3);Qp(t,t.dyn_ltree,e-1),Qp(t,t.dyn_dtree,n-1)},Bv=t=>{let e=4093624447,n;for(n=0;n<=31;n++,e>>>=1)if(e&1&&t.dyn_ltree[n*2]!==0)return Mp;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Up;for(n=32;n<_a;n++)if(t.dyn_ltree[n*2]!==0)return Up;return Mp};let tm=!1;const Pv=t=>{tm||(Mv(),tm=!0),t.l_desc=new Ih(t.dyn_ltree,zp),t.d_desc=new Ih(t.dyn_dtree,Kp),t.bl_desc=new Ih(t.bl_tree,Wp),t.bi_buf=0,t.bi_valid=0,Vp(t)},em=(t,e,n,r)=>{Mn(t,(Tv<<1)+(r?1:0),3),Zp(t),xa(t,n),xa(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n},Dv=t=>{Mn(t,Fp<<1,3),Wr(t,Ah,_i),Cv(t)},$v=(t,e,n,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===kv&&(t.strm.data_type=Bv(t)),Ch(t,t.l_desc),Ch(t,t.d_desc),o=Uv(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?em(t,e,n,r):t.strategy===vv||s===i?(Mn(t,(Fp<<1)+(r?1:0),3),qp(t,_i,ba)):(Mn(t,(Av<<1)+(r?1:0),3),Fv(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),qp(t,t.dyn_ltree,t.dyn_dtree)),Vp(t),r&&Zp(t)},jv=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[n*2]++:(t.matches++,e--,t.dyn_ltree[(Ea[n]+_a+1)*2]++,t.dyn_dtree[Hp(e)*2]++),t.sym_next===t.sym_end);var zv=Pv,Kv=em,Wv=$v,Hv=jv,Gv=Dv,Yv={_tr_init:zv,_tr_stored_block:Kv,_tr_flush_block:Wv,_tr_tally:Hv,_tr_align:Gv},va=(t,e,n,r)=>{let i=t&65535|0,s=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const Vv=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},Zv=new Uint32Array(Vv());var sn=(t,e,n,r)=>{const i=Zv,s=r+n;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[(t^e[o])&255];return t^-1},ks={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ts={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Xv,_tr_stored_block:Lh,_tr_flush_block:qv,_tr_tally:Wi,_tr_align:Jv}=Yv,{Z_NO_FLUSH:Hi,Z_PARTIAL_FLUSH:Qv,Z_FULL_FLUSH:tk,Z_FINISH:dr,Z_BLOCK:nm,Z_OK:dn,Z_STREAM_END:rm,Z_STREAM_ERROR:Hr,Z_DATA_ERROR:ek,Z_BUF_ERROR:Mh,Z_DEFAULT_COMPRESSION:nk,Z_FILTERED:rk,Z_HUFFMAN_ONLY:Gc,Z_RLE:ik,Z_FIXED:sk,Z_DEFAULT_STRATEGY:ok,Z_UNKNOWN:ak,Z_DEFLATED:Yc}=Ts,ck=9,lk=15,uk=8,Uh=256+1+29,hk=30,fk=19,dk=2*Uh+1,pk=15,Zt=3,Gi=258,Gr=Gi+Zt+1,mk=32,co=42,Fh=57,Bh=69,Ph=73,Dh=91,$h=103,As=113,ka=666,Tn=1,lo=2,Rs=3,uo=4,gk=3,Ss=(t,e)=>(t.msg=ks[e],e),im=t=>t*2-(t>4?9:0),Yi=t=>{let e=t.length;for(;--e>=0;)t[e]=0},_k=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do n=t.head[--r],t.head[r]=n>=i?n-i:0;while(--e);e=i,r=e;do n=t.prev[--r],t.prev[r]=n>=i?n-i:0;while(--e)};let Vi=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const qn=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},Jn=(t,e)=>{qv(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,qn(t.strm)},oe=(t,e)=>{t.pending_buf[t.pending++]=e},Ta=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},jh=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=va(t.adler,e,i,n):t.state.wrap===2&&(t.adler=sn(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},sm=(t,e)=>{let n=t.max_chain_length,r=t.strstart,i,s,o=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-Gr?t.strstart-(t.w_size-Gr):0,l=t.window,u=t.w_mask,f=t.prev,d=t.strstart+Gi;let h=l[r+o-1],p=l[r+o];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,!(l[i+o]!==p||l[i+o-1]!==h||l[i]!==l[r]||l[++i]!==l[r+1])){r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<d);if(s=Gi-(d-r),r=d-Gi,s>o){if(t.match_start=e,o=s,s>=a)break;h=l[r+o-1],p=l[r+o]}}while((e=f[e&u])>c&&--n!==0);return o<=t.lookahead?o:t.lookahead},ho=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Gr)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),_k(t),r+=e),t.strm.avail_in===0)break;if(n=jh(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=Zt)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Vi(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Vi(t,t.ins_h,t.window[i+Zt-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<Zt)););}while(t.lookahead<Gr&&t.strm.avail_in!==0)},om=(t,e)=>{let n=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r,i,s,o=0,a=t.strm.avail_in;do{if(r=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,i=t.strstart-t.block_start,r>i+t.strm.avail_in&&(r=i+t.strm.avail_in),r>s&&(r=s),r<n&&(r===0&&e!==dr||e===Hi||r!==i+t.strm.avail_in)))break;o=e===dr&&r===i+t.strm.avail_in?1:0,Lh(t,0,0,o),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,qn(t.strm),i&&(i>r&&(i=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,r-=i),r&&(jh(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(o===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?uo:e!==Hi&&e!==dr&&t.strm.avail_in===0&&t.strstart===t.block_start?lo:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(jh(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,n=s>t.w_size?t.w_size:s,i=t.strstart-t.block_start,(i>=n||(i||e===dr)&&e!==Hi&&t.strm.avail_in===0&&i<=s)&&(r=i>s?s:i,o=e===dr&&t.strm.avail_in===0&&r===i?1:0,Lh(t,t.block_start,r,o),t.block_start+=r,qn(t.strm)),o?Rs:Tn)},zh=(t,e)=>{let n,r;for(;;){if(t.lookahead<Gr){if(ho(t),t.lookahead<Gr&&e===Hi)return Tn;if(t.lookahead===0)break}if(n=0,t.lookahead>=Zt&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-Gr&&(t.match_length=sm(t,n)),t.match_length>=Zt)if(r=Wi(t,t.strstart-t.match_start,t.match_length-Zt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Zt){t.match_length--;do t.strstart++,t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+1]);else r=Wi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Jn(t,!1),t.strm.avail_out===0))return Tn}return t.insert=t.strstart<Zt-1?t.strstart:Zt-1,e===dr?(Jn(t,!0),t.strm.avail_out===0?Rs:uo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:lo},fo=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<Gr){if(ho(t),t.lookahead<Gr&&e===Hi)return Tn;if(t.lookahead===0)break}if(n=0,t.lookahead>=Zt&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Zt-1,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Gr&&(t.match_length=sm(t,n),t.match_length<=5&&(t.strategy===rk||t.match_length===Zt&&t.strstart-t.match_start>4096)&&(t.match_length=Zt-1)),t.prev_length>=Zt&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-Zt,r=Wi(t,t.strstart-1-t.prev_match,t.prev_length-Zt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=Zt-1,t.strstart++,r&&(Jn(t,!1),t.strm.avail_out===0))return Tn}else if(t.match_available){if(r=Wi(t,0,t.window[t.strstart-1]),r&&Jn(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return Tn}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Wi(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Zt-1?t.strstart:Zt-1,e===dr?(Jn(t,!0),t.strm.avail_out===0?Rs:uo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:lo},yk=(t,e)=>{let n,r,i,s;const o=t.window;for(;;){if(t.lookahead<=Gi){if(ho(t),t.lookahead<=Gi&&e===Hi)return Tn;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Zt&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+Gi;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);t.match_length=Gi-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Zt?(n=Wi(t,1,t.match_length-Zt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Wi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Jn(t,!1),t.strm.avail_out===0))return Tn}return t.insert=0,e===dr?(Jn(t,!0),t.strm.avail_out===0?Rs:uo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:lo},bk=(t,e)=>{let n;for(;;){if(t.lookahead===0&&(ho(t),t.lookahead===0)){if(e===Hi)return Tn;break}if(t.match_length=0,n=Wi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Jn(t,!1),t.strm.avail_out===0))return Tn}return t.insert=0,e===dr?(Jn(t,!0),t.strm.avail_out===0?Rs:uo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:lo};function Yr(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const Aa=[new Yr(0,0,0,0,om),new Yr(4,4,8,4,zh),new Yr(4,5,16,8,zh),new Yr(4,6,32,32,zh),new Yr(4,4,16,16,fo),new Yr(8,16,32,32,fo),new Yr(8,16,128,128,fo),new Yr(8,32,128,256,fo),new Yr(32,128,258,1024,fo),new Yr(32,258,258,4096,fo)],wk=t=>{t.window_size=2*t.w_size,Yi(t.head),t.max_lazy_match=Aa[t.level].max_lazy,t.good_match=Aa[t.level].good_length,t.nice_match=Aa[t.level].nice_length,t.max_chain_length=Aa[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Zt-1,t.match_available=0,t.ins_h=0};function Ek(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Yc,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(dk*2),this.dyn_dtree=new Uint16Array((2*hk+1)*2),this.bl_tree=new Uint16Array((2*fk+1)*2),Yi(this.dyn_ltree),Yi(this.dyn_dtree),Yi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(pk+1),this.heap=new Uint16Array(2*Uh+1),Yi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Uh+1),Yi(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ra=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==co&&e.status!==Fh&&e.status!==Bh&&e.status!==Ph&&e.status!==Dh&&e.status!==$h&&e.status!==As&&e.status!==ka?1:0},am=t=>{if(Ra(t))return Ss(t,Hr);t.total_in=t.total_out=0,t.data_type=ak;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Fh:e.wrap?co:As,t.adler=e.wrap===2?0:1,e.last_flush=-2,Xv(e),dn},cm=t=>{const e=am(t);return e===dn&&wk(t.state),e},xk=(t,e)=>Ra(t)||t.state.wrap!==2?Hr:(t.state.gzhead=e,dn),lm=(t,e,n,r,i,s)=>{if(!t)return Hr;let o=1;if(e===nk&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>ck||n!==Yc||r<8||r>15||e<0||e>9||s<0||s>sk||r===8&&o!==1)return Ss(t,Hr);r===8&&(r=9);const a=new Ek;return t.state=a,a.strm=t,a.status=co,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Zt-1)/Zt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=s,a.method=n,cm(t)},vk=(t,e)=>lm(t,e,Yc,lk,uk,ok),kk=(t,e)=>{if(Ra(t)||e>nm||e<0)return t?Ss(t,Hr):Hr;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===ka&&e!==dr)return Ss(t,t.avail_out===0?Mh:Hr);const r=n.last_flush;if(n.last_flush=e,n.pending!==0){if(qn(t),t.avail_out===0)return n.last_flush=-1,dn}else if(t.avail_in===0&&im(e)<=im(r)&&e!==dr)return Ss(t,Mh);if(n.status===ka&&t.avail_in!==0)return Ss(t,Mh);if(n.status===co&&n.wrap===0&&(n.status=As),n.status===co){let i=Yc+(n.w_bits-8<<4)<<8,s=-1;if(n.strategy>=Gc||n.level<2?s=0:n.level<6?s=1:n.level===6?s=2:s=3,i|=s<<6,n.strstart!==0&&(i|=mk),i+=31-i%31,Ta(n,i),n.strstart!==0&&(Ta(n,t.adler>>>16),Ta(n,t.adler&65535)),t.adler=1,n.status=As,qn(t),n.pending!==0)return n.last_flush=-1,dn}if(n.status===Fh){if(t.adler=0,oe(n,31),oe(n,139),oe(n,8),n.gzhead)oe(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),oe(n,n.gzhead.time&255),oe(n,n.gzhead.time>>8&255),oe(n,n.gzhead.time>>16&255),oe(n,n.gzhead.time>>24&255),oe(n,n.level===9?2:n.strategy>=Gc||n.level<2?4:0),oe(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(oe(n,n.gzhead.extra.length&255),oe(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=sn(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=Bh;else if(oe(n,0),oe(n,0),oe(n,0),oe(n,0),oe(n,0),oe(n,n.level===9?2:n.strategy>=Gc||n.level<2?4:0),oe(n,gk),n.status=As,qn(t),n.pending!==0)return n.last_flush=-1,dn}if(n.status===Bh){if(n.gzhead.extra){let i=n.pending,s=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=a,qn(t),n.pending!==0)return n.last_flush=-1,dn;i=0,s-=a}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=Ph}if(n.status===Ph){if(n.gzhead.name){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i)),qn(t),n.pending!==0)return n.last_flush=-1,dn;i=0}n.gzindex<n.gzhead.name.length?s=n.gzhead.name.charCodeAt(n.gzindex++)&255:s=0,oe(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=Dh}if(n.status===Dh){if(n.gzhead.comment){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i)),qn(t),n.pending!==0)return n.last_flush=-1,dn;i=0}n.gzindex<n.gzhead.comment.length?s=n.gzhead.comment.charCodeAt(n.gzindex++)&255:s=0,oe(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i))}n.status=$h}if(n.status===$h){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(qn(t),n.pending!==0))return n.last_flush=-1,dn;oe(n,t.adler&255),oe(n,t.adler>>8&255),t.adler=0}if(n.status=As,qn(t),n.pending!==0)return n.last_flush=-1,dn}if(t.avail_in!==0||n.lookahead!==0||e!==Hi&&n.status!==ka){let i=n.level===0?om(n,e):n.strategy===Gc?bk(n,e):n.strategy===ik?yk(n,e):Aa[n.level].func(n,e);if((i===Rs||i===uo)&&(n.status=ka),i===Tn||i===Rs)return t.avail_out===0&&(n.last_flush=-1),dn;if(i===lo&&(e===Qv?Jv(n):e!==nm&&(Lh(n,0,0,!1),e===tk&&(Yi(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),qn(t),t.avail_out===0))return n.last_flush=-1,dn}return e!==dr?dn:n.wrap<=0?rm:(n.wrap===2?(oe(n,t.adler&255),oe(n,t.adler>>8&255),oe(n,t.adler>>16&255),oe(n,t.adler>>24&255),oe(n,t.total_in&255),oe(n,t.total_in>>8&255),oe(n,t.total_in>>16&255),oe(n,t.total_in>>24&255)):(Ta(n,t.adler>>>16),Ta(n,t.adler&65535)),qn(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?dn:rm)},Tk=t=>{if(Ra(t))return Hr;const e=t.state.status;return t.state=null,e===As?Ss(t,ek):dn},Ak=(t,e)=>{let n=e.length;if(Ra(t))return Hr;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==co||r.lookahead)return Hr;if(i===1&&(t.adler=va(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Yi(r.head),r.strstart=0,r.block_start=0,r.insert=0);let c=new Uint8Array(r.w_size);c.set(e.subarray(n-r.w_size,n),0),e=c,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,ho(r);r.lookahead>=Zt;){let c=r.strstart,l=r.lookahead-(Zt-1);do r.ins_h=Vi(r,r.ins_h,r.window[c+Zt-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++;while(--l);r.strstart=c,r.lookahead=Zt-1,ho(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=Zt-1,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,dn};var Rk=vk,Sk=lm,Ok=cm,Ik=am,Nk=xk,Ck=kk,Lk=Tk,Mk=Ak,Uk="pako deflate (from Nodeca project)",Sa={deflateInit:Rk,deflateInit2:Sk,deflateReset:Ok,deflateResetKeep:Ik,deflateSetHeader:Nk,deflate:Ck,deflateEnd:Lk,deflateSetDictionary:Mk,deflateInfo:Uk};const Fk=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Bk=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Fk(n,r)&&(t[r]=n[r])}}return t},Pk=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let o=t[r];n.set(o,i),i+=o.length}return n},Vc={assign:Bk,flattenChunks:Pk};let um=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{um=!1}const Oa=new Uint8Array(256);for(let t=0;t<256;t++)Oa[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Oa[254]=Oa[254]=1;var Dk=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|n&63):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|n&63):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|n&63);return e};const $k=(t,e)=>{if(e<65534&&t.subarray&&um)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var jk=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const s=new Array(n*2);for(i=0,r=0;r<n;){let o=t[r++];if(o<128){s[i++]=o;continue}let a=Oa[o];if(a>4){s[i++]=65533,r+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&r<n;)o=o<<6|t[r++]&63,a--;if(a>1){s[i++]=65533;continue}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023)}return $k(s,i)},zk=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+Oa[t[n]]>e?n:e},Ia={string2buf:Dk,buf2string:jk,utf8border:zk};function Kk(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var hm=Kk;const fm=Object.prototype.toString,{Z_NO_FLUSH:Wk,Z_SYNC_FLUSH:Hk,Z_FULL_FLUSH:Gk,Z_FINISH:Yk,Z_OK:Zc,Z_STREAM_END:Vk,Z_DEFAULT_COMPRESSION:Zk,Z_DEFAULT_STRATEGY:Xk,Z_DEFLATED:qk}=Ts;function Na(t){this.options=Vc.assign({level:Zk,method:qk,chunkSize:16384,windowBits:15,memLevel:8,strategy:Xk},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new hm,this.strm.avail_out=0;let n=Sa.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Zc)throw new Error(ks[n]);if(e.header&&Sa.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(typeof e.dictionary=="string"?r=Ia.string2buf(e.dictionary):fm.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,n=Sa.deflateSetDictionary(this.strm,r),n!==Zc)throw new Error(ks[n]);this._dict_set=!0}}Na.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?Yk:Wk,typeof t=="string"?n.input=Ia.string2buf(t):fm.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===Hk||s===Gk)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(i=Sa.deflate(n,s),i===Vk)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Sa.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Zc;if(n.avail_out===0){this.onData(n.output);continue}if(s>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0},Na.prototype.onData=function(t){this.chunks.push(t)},Na.prototype.onEnd=function(t){t===Zc&&(this.result=Vc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Kh(t,e){const n=new Na(e);if(n.push(t,!0),n.err)throw n.msg||ks[n.err];return n.result}function Jk(t,e){return e=e||{},e.raw=!0,Kh(t,e)}function Qk(t,e){return e=e||{},e.gzip=!0,Kh(t,e)}var tT=Na,eT=Kh,nT=Jk,rT=Qk,iT=Ts,sT={Deflate:tT,deflate:eT,deflateRaw:nT,gzip:rT,constants:iT};const Xc=16209,oT=16191;var aT=function(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,b,w,k,T,A,C,R,S,F,N,P;const H=e.state;r=e.next_in,N=e.input,i=r+(e.avail_in-5),s=e.next_out,P=e.output,o=s-(n-e.avail_out),a=s+(e.avail_out-257),c=H.dmax,l=H.wsize,u=H.whave,f=H.wnext,d=H.window,h=H.hold,p=H.bits,m=H.lencode,b=H.distcode,w=(1<<H.lenbits)-1,k=(1<<H.distbits)-1;t:do{p<15&&(h+=N[r++]<<p,p+=8,h+=N[r++]<<p,p+=8),T=m[h&w];e:for(;;){if(A=T>>>24,h>>>=A,p-=A,A=T>>>16&255,A===0)P[s++]=T&65535;else if(A&16){C=T&65535,A&=15,A&&(p<A&&(h+=N[r++]<<p,p+=8),C+=h&(1<<A)-1,h>>>=A,p-=A),p<15&&(h+=N[r++]<<p,p+=8,h+=N[r++]<<p,p+=8),T=b[h&k];n:for(;;){if(A=T>>>24,h>>>=A,p-=A,A=T>>>16&255,A&16){if(R=T&65535,A&=15,p<A&&(h+=N[r++]<<p,p+=8,p<A&&(h+=N[r++]<<p,p+=8)),R+=h&(1<<A)-1,R>c){e.msg="invalid distance too far back",H.mode=Xc;break t}if(h>>>=A,p-=A,A=s-o,R>A){if(A=R-A,A>u&&H.sane){e.msg="invalid distance too far back",H.mode=Xc;break t}if(S=0,F=d,f===0){if(S+=l-A,A<C){C-=A;do P[s++]=d[S++];while(--A);S=s-R,F=P}}else if(f<A){if(S+=l+f-A,A-=f,A<C){C-=A;do P[s++]=d[S++];while(--A);if(S=0,f<C){A=f,C-=A;do P[s++]=d[S++];while(--A);S=s-R,F=P}}}else if(S+=f-A,A<C){C-=A;do P[s++]=d[S++];while(--A);S=s-R,F=P}for(;C>2;)P[s++]=F[S++],P[s++]=F[S++],P[s++]=F[S++],C-=3;C&&(P[s++]=F[S++],C>1&&(P[s++]=F[S++]))}else{S=s-R;do P[s++]=P[S++],P[s++]=P[S++],P[s++]=P[S++],C-=3;while(C>2);C&&(P[s++]=P[S++],C>1&&(P[s++]=P[S++]))}}else if(A&64){e.msg="invalid distance code",H.mode=Xc;break t}else{T=b[(T&65535)+(h&(1<<A)-1)];continue n}break}}else if(A&64)if(A&32){H.mode=oT;break t}else{e.msg="invalid literal/length code",H.mode=Xc;break t}else{T=m[(T&65535)+(h&(1<<A)-1)];continue e}break}}while(r<i&&s<a);C=p>>3,r-=C,p-=C<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?5+(i-r):5-(r-i),e.avail_out=s<a?257+(a-s):257-(s-a),H.hold=h,H.bits=p};const po=15,dm=852,pm=592,mm=0,Wh=1,gm=2,cT=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lT=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),uT=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),hT=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ca=(t,e,n,r,i,s,o,a)=>{const c=a.bits;let l=0,u=0,f=0,d=0,h=0,p=0,m=0,b=0,w=0,k=0,T,A,C,R,S,F=null,N;const P=new Uint16Array(po+1),H=new Uint16Array(po+1);let M=null,I,E,D;for(l=0;l<=po;l++)P[l]=0;for(u=0;u<r;u++)P[e[n+u]]++;for(h=c,d=po;d>=1&&P[d]===0;d--);if(h>d&&(h=d),d===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(f=1;f<d&&P[f]===0;f++);for(h<f&&(h=f),b=1,l=1;l<=po;l++)if(b<<=1,b-=P[l],b<0)return-1;if(b>0&&(t===mm||d!==1))return-1;for(H[1]=0,l=1;l<po;l++)H[l+1]=H[l]+P[l];for(u=0;u<r;u++)e[n+u]!==0&&(o[H[e[n+u]]++]=u);if(t===mm?(F=M=o,N=20):t===Wh?(F=cT,M=lT,N=257):(F=uT,M=hT,N=0),k=0,u=0,l=f,S=s,p=h,m=0,C=-1,w=1<<h,R=w-1,t===Wh&&w>dm||t===gm&&w>pm)return 1;for(;;){I=l-m,o[u]+1<N?(E=0,D=o[u]):o[u]>=N?(E=M[o[u]-N],D=F[o[u]-N]):(E=96,D=0),T=1<<l-m,A=1<<p,f=A;do A-=T,i[S+(k>>m)+A]=I<<24|E<<16|D|0;while(A!==0);for(T=1<<l-1;k&T;)T>>=1;if(T!==0?(k&=T-1,k+=T):k=0,u++,--P[l]===0){if(l===d)break;l=e[n+o[u]]}if(l>h&&(k&R)!==C){for(m===0&&(m=h),S+=f,p=l-m,b=1<<p;p+m<d&&(b-=P[p+m],!(b<=0));)p++,b<<=1;if(w+=1<<p,t===Wh&&w>dm||t===gm&&w>pm)return 1;C=k&R,i[C]=h<<24|p<<16|S-s|0}}return k!==0&&(i[S+k]=l-m<<24|64<<16|0),a.bits=h,0};const fT=0,_m=1,ym=2,{Z_FINISH:bm,Z_BLOCK:dT,Z_TREES:qc,Z_OK:Os,Z_STREAM_END:pT,Z_NEED_DICT:mT,Z_STREAM_ERROR:pr,Z_DATA_ERROR:wm,Z_MEM_ERROR:Em,Z_BUF_ERROR:gT,Z_DEFLATED:xm}=Ts,Jc=16180,vm=16181,km=16182,Tm=16183,Am=16184,Rm=16185,Sm=16186,Om=16187,Im=16188,Nm=16189,Qc=16190,yi=16191,Hh=16192,Cm=16193,Gh=16194,Lm=16195,Mm=16196,Um=16197,Fm=16198,tl=16199,el=16200,Bm=16201,Pm=16202,Dm=16203,$m=16204,jm=16205,Yh=16206,zm=16207,Km=16208,ke=16209,Wm=16210,Hm=16211,_T=852,yT=592,bT=15,Gm=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function wT(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Is=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Jc||e.mode>Hm?1:0},Ym=t=>{if(Is(t))return pr;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=Jc,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(_T),e.distcode=e.distdyn=new Int32Array(yT),e.sane=1,e.back=-1,Os},Vm=t=>{if(Is(t))return pr;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Ym(t)},Zm=(t,e)=>{let n;if(Is(t))return pr;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?pr:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Vm(t))},Xm=(t,e)=>{if(!t)return pr;const n=new wT;t.state=n,n.strm=t,n.window=null,n.mode=Jc;const r=Zm(t,e);return r!==Os&&(t.state=null),r},ET=t=>Xm(t,bT);let qm=!0,Vh,Zh;const xT=t=>{if(qm){Vh=new Int32Array(512),Zh=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Ca(_m,t.lens,0,288,Vh,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Ca(ym,t.lens,0,32,Zh,0,t.work,{bits:5}),qm=!1}t.lencode=Vh,t.lenbits=9,t.distcode=Zh,t.distbits=5},Jm=(t,e,n,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),r-=i,r?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},vT=(t,e)=>{let n,r,i,s,o,a,c,l,u,f,d,h,p,m,b=0,w,k,T,A,C,R,S,F;const N=new Uint8Array(4);let P,H;const M=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Is(t)||!t.output||!t.input&&t.avail_in!==0)return pr;n=t.state,n.mode===yi&&(n.mode=Hh),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,f=a,d=c,F=Os;t:for(;;)switch(n.mode){case Jc:if(n.wrap===0){n.mode=Hh;break}for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&2&&l===35615){n.wbits===0&&(n.wbits=15),n.check=0,N[0]=l&255,N[1]=l>>>8&255,n.check=sn(n.check,N,2,0),l=0,u=0,n.mode=vm;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=ke;break}if((l&15)!==xm){t.msg="unknown compression method",n.mode=ke;break}if(l>>>=4,u-=4,S=(l&15)+8,n.wbits===0&&(n.wbits=S),S>15||S>n.wbits){t.msg="invalid window size",n.mode=ke;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=l&512?Nm:yi,l=0,u=0;break;case vm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.flags=l,(n.flags&255)!==xm){t.msg="unknown compression method",n.mode=ke;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=ke;break}n.head&&(n.head.text=l>>8&1),n.flags&512&&n.wrap&4&&(N[0]=l&255,N[1]=l>>>8&255,n.check=sn(n.check,N,2,0)),l=0,u=0,n.mode=km;case km:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.time=l),n.flags&512&&n.wrap&4&&(N[0]=l&255,N[1]=l>>>8&255,N[2]=l>>>16&255,N[3]=l>>>24&255,n.check=sn(n.check,N,4,0)),l=0,u=0,n.mode=Tm;case Tm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.xflags=l&255,n.head.os=l>>8),n.flags&512&&n.wrap&4&&(N[0]=l&255,N[1]=l>>>8&255,n.check=sn(n.check,N,2,0)),l=0,u=0,n.mode=Am;case Am:if(n.flags&1024){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),n.flags&512&&n.wrap&4&&(N[0]=l&255,N[1]=l>>>8&255,n.check=sn(n.check,N,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=Rm;case Rm:if(n.flags&1024&&(h=n.length,h>a&&(h=a),h&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+h),S)),n.flags&512&&n.wrap&4&&(n.check=sn(n.check,r,h,s)),a-=h,s+=h,n.length-=h),n.length))break t;n.length=0,n.mode=Sm;case Sm:if(n.flags&2048){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=sn(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=Om;case Om:if(n.flags&4096){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=sn(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.comment=null);n.mode=Im;case Im:if(n.flags&512){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.check&65535)){t.msg="header crc mismatch",n.mode=ke;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=yi;break;case Nm:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}t.adler=n.check=Gm(l),l=0,u=0,n.mode=Qc;case Qc:if(n.havedict===0)return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,mT;t.adler=n.check=1,n.mode=yi;case yi:if(e===dT||e===qc)break t;case Hh:if(n.last){l>>>=u&7,u-=u&7,n.mode=Yh;break}for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}switch(n.last=l&1,l>>>=1,u-=1,l&3){case 0:n.mode=Cm;break;case 1:if(xT(n),n.mode=tl,e===qc){l>>>=2,u-=2;break t}break;case 2:n.mode=Mm;break;case 3:t.msg="invalid block type",n.mode=ke}l>>>=2,u-=2;break;case Cm:for(l>>>=u&7,u-=u&7;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=ke;break}if(n.length=l&65535,l=0,u=0,n.mode=Gh,e===qc)break t;case Gh:n.mode=Lm;case Lm:if(h=n.length,h){if(h>a&&(h=a),h>c&&(h=c),h===0)break t;i.set(r.subarray(s,s+h),o),a-=h,s+=h,c-=h,o+=h,n.length-=h;break}n.mode=yi;break;case Mm:for(;u<14;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.nlen=(l&31)+257,l>>>=5,u-=5,n.ndist=(l&31)+1,l>>>=5,u-=5,n.ncode=(l&15)+4,l>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=ke;break}n.have=0,n.mode=Um;case Um:for(;n.have<n.ncode;){for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.lens[M[n.have++]]=l&7,l>>>=3,u-=3}for(;n.have<19;)n.lens[M[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,P={bits:n.lenbits},F=Ca(fT,n.lens,0,19,n.lencode,0,n.work,P),n.lenbits=P.bits,F){t.msg="invalid code lengths set",n.mode=ke;break}n.have=0,n.mode=Fm;case Fm:for(;n.have<n.nlen+n.ndist;){for(;b=n.lencode[l&(1<<n.lenbits)-1],w=b>>>24,k=b>>>16&255,T=b&65535,!(w<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(T<16)l>>>=w,u-=w,n.lens[n.have++]=T;else{if(T===16){for(H=w+2;u<H;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(l>>>=w,u-=w,n.have===0){t.msg="invalid bit length repeat",n.mode=ke;break}S=n.lens[n.have-1],h=3+(l&3),l>>>=2,u-=2}else if(T===17){for(H=w+3;u<H;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=w,u-=w,S=0,h=3+(l&7),l>>>=3,u-=3}else{for(H=w+7;u<H;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=w,u-=w,S=0,h=11+(l&127),l>>>=7,u-=7}if(n.have+h>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=ke;break}for(;h--;)n.lens[n.have++]=S}}if(n.mode===ke)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=ke;break}if(n.lenbits=9,P={bits:n.lenbits},F=Ca(_m,n.lens,0,n.nlen,n.lencode,0,n.work,P),n.lenbits=P.bits,F){t.msg="invalid literal/lengths set",n.mode=ke;break}if(n.distbits=6,n.distcode=n.distdyn,P={bits:n.distbits},F=Ca(ym,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,P),n.distbits=P.bits,F){t.msg="invalid distances set",n.mode=ke;break}if(n.mode=tl,e===qc)break t;case tl:n.mode=el;case el:if(a>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,aT(t,d),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,n.mode===yi&&(n.back=-1);break}for(n.back=0;b=n.lencode[l&(1<<n.lenbits)-1],w=b>>>24,k=b>>>16&255,T=b&65535,!(w<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(k&&!(k&240)){for(A=w,C=k,R=T;b=n.lencode[R+((l&(1<<A+C)-1)>>A)],w=b>>>24,k=b>>>16&255,T=b&65535,!(A+w<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=A,u-=A,n.back+=A}if(l>>>=w,u-=w,n.back+=w,n.length=T,k===0){n.mode=jm;break}if(k&32){n.back=-1,n.mode=yi;break}if(k&64){t.msg="invalid literal/length code",n.mode=ke;break}n.extra=k&15,n.mode=Bm;case Bm:if(n.extra){for(H=n.extra;u<H;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=Pm;case Pm:for(;b=n.distcode[l&(1<<n.distbits)-1],w=b>>>24,k=b>>>16&255,T=b&65535,!(w<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(!(k&240)){for(A=w,C=k,R=T;b=n.distcode[R+((l&(1<<A+C)-1)>>A)],w=b>>>24,k=b>>>16&255,T=b&65535,!(A+w<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=A,u-=A,n.back+=A}if(l>>>=w,u-=w,n.back+=w,k&64){t.msg="invalid distance code",n.mode=ke;break}n.offset=T,n.extra=k&15,n.mode=Dm;case Dm:if(n.extra){for(H=n.extra;u<H;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=ke;break}n.mode=$m;case $m:if(c===0)break t;if(h=d-c,n.offset>h){if(h=n.offset-h,h>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=ke;break}h>n.wnext?(h-=n.wnext,p=n.wsize-h):p=n.wnext-h,h>n.length&&(h=n.length),m=n.window}else m=i,p=o-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do i[o++]=m[p++];while(--h);n.length===0&&(n.mode=el);break;case jm:if(c===0)break t;i[o++]=n.length,c--,n.mode=el;break;case Yh:if(n.wrap){for(;u<32;){if(a===0)break t;a--,l|=r[s++]<<u,u+=8}if(d-=c,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?sn(n.check,i,d,o-d):va(n.check,i,d,o-d)),d=c,n.wrap&4&&(n.flags?l:Gm(l))!==n.check){t.msg="incorrect data check",n.mode=ke;break}l=0,u=0}n.mode=zm;case zm:if(n.wrap&&n.flags){for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=ke;break}l=0,u=0}n.mode=Km;case Km:F=pT;break t;case ke:F=wm;break t;case Wm:return Em;case Hm:default:return pr}return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,(n.wsize||d!==t.avail_out&&n.mode<ke&&(n.mode<Yh||e!==bm))&&Jm(t,t.output,t.next_out,d-t.avail_out),f-=t.avail_in,d-=t.avail_out,t.total_in+=f,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?sn(n.check,i,d,t.next_out-d):va(n.check,i,d,t.next_out-d)),t.data_type=n.bits+(n.last?64:0)+(n.mode===yi?128:0)+(n.mode===tl||n.mode===Gh?256:0),(f===0&&d===0||e===bm)&&F===Os&&(F=gT),F},kT=t=>{if(Is(t))return pr;let e=t.state;return e.window&&(e.window=null),t.state=null,Os},TT=(t,e)=>{if(Is(t))return pr;const n=t.state;return n.wrap&2?(n.head=e,e.done=!1,Os):pr},AT=(t,e)=>{const n=e.length;let r,i,s;return Is(t)||(r=t.state,r.wrap!==0&&r.mode!==Qc)?pr:r.mode===Qc&&(i=1,i=va(i,e,n,0),i!==r.check)?wm:(s=Jm(t,e,n,n),s?(r.mode=Wm,Em):(r.havedict=1,Os))};var RT=Vm,ST=Zm,OT=Ym,IT=ET,NT=Xm,CT=vT,LT=kT,MT=TT,UT=AT,FT="pako inflate (from Nodeca project)",bi={inflateReset:RT,inflateReset2:ST,inflateResetKeep:OT,inflateInit:IT,inflateInit2:NT,inflate:CT,inflateEnd:LT,inflateGetHeader:MT,inflateSetDictionary:UT,inflateInfo:FT};function BT(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var PT=BT;const Qm=Object.prototype.toString,{Z_NO_FLUSH:DT,Z_FINISH:$T,Z_OK:La,Z_STREAM_END:Xh,Z_NEED_DICT:qh,Z_STREAM_ERROR:jT,Z_DATA_ERROR:tg,Z_MEM_ERROR:zT}=Ts;function Ma(t){this.options=Vc.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new hm,this.strm.avail_out=0;let n=bi.inflateInit2(this.strm,e.windowBits);if(n!==La)throw new Error(ks[n]);if(this.header=new PT,bi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Ia.string2buf(e.dictionary):Qm.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=bi.inflateSetDictionary(this.strm,e.dictionary),n!==La)))throw new Error(ks[n])}Ma.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?$T:DT,Qm.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=bi.inflate(n,o),s===qh&&i&&(s=bi.inflateSetDictionary(n,i),s===La?s=bi.inflate(n,o):s===tg&&(s=qh));n.avail_in>0&&s===Xh&&n.state.wrap>0&&t[n.next_in]!==0;)bi.inflateReset(n),s=bi.inflate(n,o);switch(s){case jT:case tg:case qh:case zT:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||s===Xh))if(this.options.to==="string"){let c=Ia.utf8border(n.output,n.next_out),l=n.next_out-c,u=Ia.buf2string(n.output,c);n.next_out=l,n.avail_out=r-l,l&&n.output.set(n.output.subarray(c,c+l),0),this.onData(u)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(s===La&&a===0)){if(s===Xh)return s=bi.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Ma.prototype.onData=function(t){this.chunks.push(t)},Ma.prototype.onEnd=function(t){t===La&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Vc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Jh(t,e){const n=new Ma(e);if(n.push(t),n.err)throw n.msg||ks[n.err];return n.result}function KT(t,e){return e=e||{},e.raw=!0,Jh(t,e)}var WT=Ma,HT=Jh,GT=KT,YT=Jh,VT=Ts,ZT={Inflate:WT,inflate:HT,inflateRaw:GT,ungzip:YT,constants:VT};const{Deflate:XT,deflate:qT,deflateRaw:JT,gzip:QT}=sT,{Inflate:tA,inflate:eA,inflateRaw:nA,ungzip:rA}=ZT;var iA=XT,sA=qT,oA=JT,aA=QT,cA=tA,lA=eA,uA=nA,hA=rA,fA=Ts,dA={Deflate:iA,deflate:sA,deflateRaw:oA,gzip:aA,Inflate:cA,inflate:lA,inflateRaw:uA,ungzip:hA,constants:fA};function eg(t){let e=t.r.toString(16),n=t.g.toString(16),r=t.b.toString(16);return e.length<2&&(e="0"+e),n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),e+n+r}const pA=t=>new Promise((e,n)=>{try{const r=dA.inflate(t),i=mA(r);e(i)}catch(r){n(r)}}),mA=t=>{const e=new DataView(t.buffer),n={version:e.getUint32(0,!0),layers:[]},r=e.getUint32(4,!0);let i=8;for(let s=0;s<r;s++){const o={width:0,height:0,raster:[]};o.width=e.getUint32(i,!0),i+=4,o.height=e.getUint32(i,!0),i+=4,o.raster=Array(o.height*o.width);for(let a=0;a<o.width;a++)for(let c=0;c<o.height;c++){const l={asciiCode:e.getUint32(i,!0),transparent:!1,color:{r:0,g:0,b:0,hex:""},bg:{r:0,g:0,b:0,hex:""}};i+=4,l.color.r=e.getUint8(i++),l.color.g=e.getUint8(i++),l.color.b=e.getUint8(i++),l.color.hex=eg(l.color),l.bg.r=e.getUint8(i++),l.bg.g=e.getUint8(i++),l.bg.b=e.getUint8(i++),l.bg.hex=eg(l.bg),l.transparent=l.bg.r===255&&l.bg.g===0&&l.bg.b===255,o.raster[a+o.width*c]=l}n.layers.push(o)}return n};function gA(t){return typeof t=="object"&&wt(t.session)&&wt(t.player)&&wt(t.id)&&wt(t.sender)&&wt(t.target)}function he(t,e,n,...r){return t.emit(e,"error",[`$red${n}$blue>>`,...r]),!1}function _A(t,e,...n){return t.emit(e,"info",n),!0}function fe(t,e,...n){return t.emit(e,"log",n),!0}function yA(t,e,n){t.emit(e,"toast",n)}function bA(t,e,n){t.emit(e,"bridge:streamstart",n)}function wA(t,e){t.emit(e,"bridge:streamstop",void 0)}function EA(t,e,n){t.emit(e,"bridge:chatstart",n)}function xA(t,e){t.emit(e,"bridge:chatstop")}function vA(t,e,n,r,i,s,o){t.emit(e,"bridge:fetch",[n,r,i,s,o])}function kA(t,e){t.emit(e,"bridge:talkstart",e)}function TA(t,e){t.emit(e,"bridge:talkstop",e)}function AA(t,e){t.emit(e,"bridge:mediastart",e)}function RA(t,e){t.emit(e,"bridge:mediastop",e)}function SA(t,e,n){t.emit(e,"bridge:start",n)}function OA(t,e,n){t.emit(e,"bridge:tab",n)}function IA(t,e,n){t.emit(e,"gadgetclient:paint",n)}function NA(t,e,n){t.emit(e,"gadgetclient:patch",n)}function CA(t,e){t.emit(e,"gadgetserver:clearscroll")}function LA(t){t.emit("","ready")}function ng(t,e){t.emit(e,"register:loginfail")}function Qh(t,e){t.emit(e,"register:loginready",!0)}function MA(t,e,n,r){t.emit(e,"register:savemem",[n,r])}function UA(t,e,n){t.emit(e,"register:forkmem",[n])}function tf(t,e,n){t.emit(e,"register:copy",n)}function FA(t,e,n,r){t.emit(e,"register:copyjsonfile",[n,r])}function rg(t,e,n,r){t.emit(e,"register:downloadjsonfile",[n,r])}function BA(t,e){t.emit(e,"register:dev",void 0)}function PA(t,e){t.emit(e,"register:share",void 0)}function DA(t,e){t.emit(e,"register:nuke",void 0)}function $A(t,e,n,r){t.emit(e,"synth:tts",[n,r])}function jA(t,e,n){t.emit(e,"synth:tta",[n])}function zA(t,e,n,r,i){t.emit(e,"synth:play",[n,r,i])}function KA(t,e,n){t.emit(e,"synth:focus",n)}function WA(t,e,n){t.emit(e,"synth:bpm",n)}function HA(t,e,n){t.emit(e,"synth:playvolume",n)}function GA(t,e,n){t.emit(e,"synth:bgplayvolume",n)}function YA(t,e,n){t.emit(e,"synth:ttsvolume",n)}function ef(t,e,n,r,i){t.emit(e,"synth:voice",[n,r,i])}function ig(t,e,n,r,i,s){t.emit(e,"synth:voicefx",[n,r,i,s])}function VA(t,e,n,r){t.emit(e,"register:config",[n,r])}function ZA(t,e){t.emit(e,"register:configshow")}function XA(t,e){t.emit(e,"register:inspector")}function sg(t,e,n,r,i,s){t.emit(e,"register:editor:open",[n,r,i,s])}function qA(t,e){t.emit(e,"vm:local")}function og(t,e){t.emit(e,"vm:logout")}function nl(t,e){const[n,r]=e;return`${t}:${[n,r].filter(x).join(":")}`}function JA(t,e,n){t.emit(e,"vm:cli",n)}function QA(t,e){t.emit(e,"vm:restart")}function ag(t,e){t.emit(e,"vm:flush")}function tR(t,e){t.emit(e,"vm:fork")}function eR(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function nR(t,e){return{filename:t,json:e}}function rR(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function iR(t,e){const n={filename:t,cursor:0,content:void 0};return pA(e).then(r=>{n.content=r}).catch(()=>{}),n}function Ua(t,e,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=eR(i,s);break;case"json":o=nR(i,s);break;case"binary":o=rR(i,s);break;case"rexpaint":o=iR(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[n,r,i,o])},1)}function sR(t){const e=new Set;function n(s){gA(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Vn.invoke(s))}const r=so("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){Vn.disconnect(r)}return{forward:n,disconnect:i}}function oR(t){switch(t.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const e=Xn(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const nf=66.666,rl=Math.round(1e3/nf),aR=3;function cg(t){return new Promise(e=>setTimeout(e,t))}const rf=so("clock");let sf=0,il=0,of=0,lg=performance.now();function ug(){const t=performance.now(),e=t-lg;of+=e,of>=nf&&(of%=nf,rf.emit("","tick",il),rf.emit("","tock",il),++sf,++il,sf>=rl&&(sf%=rl,rf.emit("","second",il))),lg=t,setTimeout(ug,2)}ug();function cR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var hg={exports:{}},De=hg.exports={},Vr,Zr;function af(){throw new Error("setTimeout has not been defined")}function cf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Vr=setTimeout:Vr=af}catch{Vr=af}try{typeof clearTimeout=="function"?Zr=clearTimeout:Zr=cf}catch{Zr=cf}})();function fg(t){if(Vr===setTimeout)return setTimeout(t,0);if((Vr===af||!Vr)&&setTimeout)return Vr=setTimeout,setTimeout(t,0);try{return Vr(t,0)}catch{try{return Vr.call(null,t,0)}catch{return Vr.call(this,t,0)}}}function lR(t){if(Zr===clearTimeout)return clearTimeout(t);if((Zr===cf||!Zr)&&clearTimeout)return Zr=clearTimeout,clearTimeout(t);try{return Zr(t)}catch{try{return Zr.call(null,t)}catch{return Zr.call(this,t)}}}var wi=[],mo=!1,Ns,sl=-1;function uR(){!mo||!Ns||(mo=!1,Ns.length?wi=Ns.concat(wi):sl=-1,wi.length&&dg())}function dg(){if(!mo){var t=fg(uR);mo=!0;for(var e=wi.length;e;){for(Ns=wi,wi=[];++sl<e;)Ns&&Ns[sl].run();sl=-1,e=wi.length}Ns=null,mo=!1,lR(t)}}De.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi.push(new pg(t,e)),wi.length===1&&!mo&&fg(dg)};function pg(t,e){this.fun=t,this.array=e}pg.prototype.run=function(){this.fun.apply(null,this.array)},De.title="browser",De.browser=!0,De.env={},De.argv=[],De.version="",De.versions={};function Ei(){}De.on=Ei,De.addListener=Ei,De.once=Ei,De.off=Ei,De.removeListener=Ei,De.removeAllListeners=Ei,De.emit=Ei,De.prependListener=Ei,De.prependOnceListener=Ei,De.listeners=function(t){return[]},De.binding=function(t){throw new Error("process.binding is not supported")},De.cwd=function(){return"/"},De.chdir=function(t){throw new Error("process.chdir is not supported")},De.umask=function(){return 0};var hR=hg.exports;const Ir=cR(hR);var Wt={},lf=Symbol.for("react.transitional.element"),fR=Symbol.for("react.portal"),dR=Symbol.for("react.fragment"),pR=Symbol.for("react.strict_mode"),mR=Symbol.for("react.profiler"),gR=Symbol.for("react.consumer"),_R=Symbol.for("react.context"),yR=Symbol.for("react.forward_ref"),bR=Symbol.for("react.suspense"),wR=Symbol.for("react.memo"),mg=Symbol.for("react.lazy"),gg=Symbol.iterator;function ER(t){return t===null||typeof t!="object"?null:(t=gg&&t[gg]||t["@@iterator"],typeof t=="function"?t:null)}var _g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},yg=Object.assign,bg={};function go(t,e,n){this.props=t,this.context=e,this.refs=bg,this.updater=n||_g}go.prototype.isReactComponent={},go.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},go.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function wg(){}wg.prototype=go.prototype;function uf(t,e,n){this.props=t,this.context=e,this.refs=bg,this.updater=n||_g}var hf=uf.prototype=new wg;hf.constructor=uf,yg(hf,go.prototype),hf.isPureReactComponent=!0;var Eg=Array.isArray,Te={H:null,A:null,T:null,S:null,V:null},xg=Object.prototype.hasOwnProperty;function ff(t,e,n,r,i,s){return n=s.ref,{$$typeof:lf,type:t,key:e,ref:n!==void 0?n:null,props:s}}function xR(t,e){return ff(t.type,e,void 0,void 0,void 0,t.props)}function df(t){return typeof t=="object"&&t!==null&&t.$$typeof===lf}function vR(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var vg=/\/+/g;function pf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?vR(""+t.key):e.toString(36)}function kg(){}function kR(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(kg,kg):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function _o(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case lf:case fR:o=!0;break;case mg:return o=t._init,_o(o(t._payload),e,n,r,i)}}if(o)return i=i(t),o=r===""?"."+pf(t,0):r,Eg(i)?(n="",o!=null&&(n=o.replace(vg,"$&/")+"/"),_o(i,e,n,"",function(l){return l})):i!=null&&(df(i)&&(i=xR(i,n+(i.key==null||t&&t.key===i.key?"":(""+i.key).replace(vg,"$&/")+"/")+o)),e.push(i)),1;o=0;var a=r===""?".":r+":";if(Eg(t))for(var c=0;c<t.length;c++)r=t[c],s=a+pf(r,c),o+=_o(r,e,n,s,i);else if(c=ER(t),typeof c=="function")for(t=c.call(t),c=0;!(r=t.next()).done;)r=r.value,s=a+pf(r,c++),o+=_o(r,e,n,s,i);else if(s==="object"){if(typeof t.then=="function")return _o(kR(t),e,n,r,i);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return o}function ol(t,e,n){if(t==null)return t;var r=[],i=0;return _o(t,r,"","",function(s){return e.call(n,s,i++)}),r}function TR(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Tg=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof Ir=="object"&&typeof Ir.emit=="function"){Ir.emit("uncaughtException",t);return}console.error(t)};function AR(){}Wt.Children={map:ol,forEach:function(t,e,n){ol(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ol(t,function(){e++}),e},toArray:function(t){return ol(t,function(e){return e})||[]},only:function(t){if(!df(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},Wt.Component=go,Wt.Fragment=dR,Wt.Profiler=mR,Wt.PureComponent=uf,Wt.StrictMode=pR,Wt.Suspense=bR,Wt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Te,Wt.__COMPILER_RUNTIME={__proto__:null,c:function(t){return Te.H.useMemoCache(t)}},Wt.cache=function(t){return function(){return t.apply(null,arguments)}},Wt.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var r=yg({},t.props),i=t.key,s=void 0;if(e!=null)for(o in e.ref!==void 0&&(s=void 0),e.key!==void 0&&(i=""+e.key),e)!xg.call(e,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&e.ref===void 0||(r[o]=e[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return ff(t.type,i,void 0,void 0,s,r)},Wt.createContext=function(t){return t={$$typeof:_R,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:gR,_context:t},t},Wt.createElement=function(t,e,n){var r,i={},s=null;if(e!=null)for(r in e.key!==void 0&&(s=""+e.key),e)xg.call(e,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return ff(t,s,void 0,void 0,null,i)},Wt.createRef=function(){return{current:null}},Wt.forwardRef=function(t){return{$$typeof:yR,render:t}},Wt.isValidElement=df,Wt.lazy=function(t){return{$$typeof:mg,_payload:{_status:-1,_result:t},_init:TR}},Wt.memo=function(t,e){return{$$typeof:wR,type:t,compare:e===void 0?null:e}},Wt.startTransition=function(t){var e=Te.T,n={};Te.T=n;try{var r=t(),i=Te.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(AR,Tg)}catch(s){Tg(s)}finally{Te.T=e}},Wt.unstable_useCacheRefresh=function(){return Te.H.useCacheRefresh()},Wt.use=function(t){return Te.H.use(t)},Wt.useActionState=function(t,e,n){return Te.H.useActionState(t,e,n)},Wt.useCallback=function(t,e){return Te.H.useCallback(t,e)},Wt.useContext=function(t){return Te.H.useContext(t)},Wt.useDebugValue=function(){},Wt.useDeferredValue=function(t,e){return Te.H.useDeferredValue(t,e)},Wt.useEffect=function(t,e,n){var r=Te.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(t,e)},Wt.useId=function(){return Te.H.useId()},Wt.useImperativeHandle=function(t,e,n){return Te.H.useImperativeHandle(t,e,n)},Wt.useInsertionEffect=function(t,e){return Te.H.useInsertionEffect(t,e)},Wt.useLayoutEffect=function(t,e){return Te.H.useLayoutEffect(t,e)},Wt.useMemo=function(t,e){return Te.H.useMemo(t,e)},Wt.useOptimistic=function(t,e){return Te.H.useOptimistic(t,e)},Wt.useReducer=function(t,e,n){return Te.H.useReducer(t,e,n)},Wt.useRef=function(t){return Te.H.useRef(t)},Wt.useState=function(t){return Te.H.useState(t)},Wt.useSyncExternalStore=function(t,e,n){return Te.H.useSyncExternalStore(t,e,n)},Wt.useTransition=function(){return Te.H.useTransition()},Wt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Ag="0123456789abcdef",Rg=[],al=[];for(let t=0;t<256;t++)Rg[t]=Ag[t>>4&15]+Ag[t&15],t<16&&(t<10?al[48+t]=t:al[87+t]=t);const Sg=t=>{const e=t.length;let n="",r=0;for(;r<e;)n+=Rg[t[r++]];return n},cl=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=al[t.charCodeAt(s++)]<<4|al[t.charCodeAt(s++)];return r};for(var Og="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",RR=typeof Uint8Array>"u"?[]:new Uint8Array(256),ll=0;ll<Og.length;ll++)RR[Og.charCodeAt(ll)]=ll;new TextDecoder,new TextEncoder;const Ig=typeof window<"u"?window:self,Ng=Ig.crypto||Ig.msCrypto||{};Ng.subtle||Ng.webkitSubtle;const yo=globalThis||void 0||self,Nr=()=>new Map,mf=t=>{const e=Nr();return t.forEach((n,r)=>{e.set(r,n)}),e},Zi=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},SR=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},OR=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},bo=()=>new Set,gf=t=>t[t.length-1],IR=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Cs=Array.from,NR=Array.isArray;class CR{constructor(){this._observers=Nr()}on(e,n){return Zi(this._observers,e,bo).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Cs((this._observers.get(e)||Nr()).values()).forEach(r=>r(...n))}destroy(){this._observers=Nr()}}const Xi=Math.floor,ul=Math.abs,Cg=(t,e)=>t<e?t:e,Ls=(t,e)=>t>e?t:e,Lg=t=>t!==0?t<0:1/t<0,Mg=1,Ug=2,_f=4,yf=8,Fa=32,xi=64,Qn=128,hl=31,bf=63,Ms=127,LR=2147483647,Fg=Number.MAX_SAFE_INTEGER,MR=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Xi(t)===t),UR=t=>t.toLowerCase(),FR=/^\s*/g,BR=t=>t.replace(FR,""),PR=/([A-Z])/g,Bg=(t,e)=>BR(t.replace(PR,n=>`${e}${UR(n)}`)),DR=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},Ba=typeof TextEncoder<"u"?new TextEncoder:null,$R=Ba?t=>Ba.encode(t):DR;let Pa=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Pa&&Pa.decode(new Uint8Array).length===1&&(Pa=null);class Da{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const fl=()=>new Da,jR=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Xr=t=>{const e=new Uint8Array(jR(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},zR=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Ls(n,e)*2),t.cpos=0)},on=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},wf=on,ne=(t,e)=>{for(;e>Ms;)on(t,Qn|Ms&e),e=Xi(e/128);on(t,Ms&e)},Ef=(t,e)=>{const n=Lg(e);for(n&&(e=-e),on(t,(e>bf?Qn:0)|(n?xi:0)|bf&e),e=Xi(e/64);e>0;)on(t,(e>Ms?Qn:0)|Ms&e),e=Xi(e/128)},xf=new Uint8Array(3e4),KR=xf.length/3,WR=(t,e)=>{if(e.length<KR){const n=Ba.encodeInto(e,xf).written||0;ne(t,n);for(let r=0;r<n;r++)on(t,xf[r])}else tr(t,$R(e))},HR=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;ne(t,r);for(let i=0;i<r;i++)on(t,n.codePointAt(i))},wo=Ba&&Ba.encodeInto?WR:HR,dl=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Cg(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Ls(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},tr=(t,e)=>{ne(t,e.byteLength),dl(t,e)},vf=(t,e)=>{zR(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},GR=(t,e)=>vf(t,4).setFloat32(0,e,!1),YR=(t,e)=>vf(t,8).setFloat64(0,e,!1),VR=(t,e)=>vf(t,8).setBigInt64(0,e,!1),Pg=new DataView(new ArrayBuffer(4)),ZR=t=>(Pg.setFloat32(0,t),Pg.getFloat32(0)===t),$a=(t,e)=>{switch(typeof e){case"string":on(t,119),wo(t,e);break;case"number":MR(e)&&ul(e)<=LR?(on(t,125),Ef(t,e)):ZR(e)?(on(t,124),GR(t,e)):(on(t,123),YR(t,e));break;case"bigint":on(t,122),VR(t,e);break;case"object":if(e===null)on(t,126);else if(NR(e)){on(t,117),ne(t,e.length);for(let n=0;n<e.length;n++)$a(t,e[n])}else if(e instanceof Uint8Array)on(t,116),tr(t,e);else{on(t,118);const n=Object.keys(e);ne(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];wo(t,i),$a(t,e[i])}}break;case"boolean":on(t,e?120:121);break;default:on(t,127)}};class Dg extends Da{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ne(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const $g=t=>{t.count>0&&(Ef(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ne(t.encoder,t.count-2))};class pl{constructor(){this.encoder=new Da,this.s=0,this.count=0}write(e){this.s===e?this.count++:($g(this),this.count=1,this.s=e)}toUint8Array(){return $g(this),Xr(this.encoder)}}const jg=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Ef(t.encoder,e),t.count>1&&ne(t.encoder,t.count-2)}};class kf{constructor(){this.encoder=new Da,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(jg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return jg(this),Xr(this.encoder)}}class XR{constructor(){this.sarr=[],this.s="",this.lensE=new pl}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Da;return this.sarr.push(this.s),this.s="",wo(e,this.sarr.join("")),dl(e,this.lensE.toUint8Array()),Xr(e)}}const qi=t=>new Error(t),qr=()=>{throw qi("Method unimplemented")},Jr=()=>{throw qi("Unexpected case")},zg=qi("Unexpected end of array"),Kg=qi("Integer out of Range");class ml{constructor(e){this.arr=e,this.pos=0}}const Eo=t=>new ml(t),qR=t=>t.pos!==t.arr.length,JR=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},er=t=>JR(t,Ht(t)),xo=t=>t.arr[t.pos++],Ht=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&Ms)*n,n*=128,i<Qn)return e;if(e>Fg)throw Kg}throw zg},Tf=t=>{let e=t.arr[t.pos++],n=e&bf,r=64;const i=(e&xi)>0?-1:1;if(!(e&Qn))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&Ms)*r,r*=128,e<Qn)return i*n;if(n>Fg)throw Kg}throw zg},vo=Pa?t=>Pa.decode(er(t)):t=>{let e=Ht(t);if(e===0)return"";{let n=String.fromCodePoint(xo(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(xo(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},Af=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},QR=[t=>{},t=>null,Tf,t=>Af(t,4).getFloat32(0,!1),t=>Af(t,8).getFloat64(0,!1),t=>Af(t,8).getBigInt64(0,!1),t=>!1,t=>!0,vo,t=>{const e=Ht(t),n={};for(let r=0;r<e;r++){const i=vo(t);n[i]=ja(t)}return n},t=>{const e=Ht(t),n=[];for(let r=0;r<e;r++)n.push(ja(t));return n},er],ja=t=>QR[127-xo(t)](t);class Wg extends ml{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),qR(this)?this.count=Ht(this)+1:this.count=-1),this.count--,this.s}}class gl extends ml{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Tf(this);const e=Lg(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ht(this)+2)}return this.count--,this.s}}class Rf extends ml{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Tf(this),n=e&1;this.diff=Xi(e/2),this.count=1,n&&(this.count=Ht(this)+2)}return this.s+=this.diff,this.count--,this.s}}class tS{constructor(e){this.decoder=new gl(e),this.str=vo(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const eS=crypto.getRandomValues.bind(crypto),Hg=()=>eS(new Uint32Array(1))[0],nS="10000000-1000-4000-8000"+-1e11,rS=()=>nS.replace(/[018]/g,t=>(t^Hg()&15>>t/4).toString(16)),Gg=t=>new Promise(t);Promise.all.bind(Promise);var Yg={},_l={};_l.byteLength=oS,_l.toByteArray=cS,_l.fromByteArray=hS;for(var Qr=[],mr=[],iS=typeof Uint8Array<"u"?Uint8Array:Array,Sf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ko=0,sS=Sf.length;ko<sS;++ko)Qr[ko]=Sf[ko],mr[Sf.charCodeAt(ko)]=ko;mr[45]=62,mr[95]=63;function Vg(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function oS(t){var e=Vg(t),n=e[0],r=e[1];return(n+r)*3/4-r}function aS(t,e,n){return(e+n)*3/4-n}function cS(t){var e,n=Vg(t),r=n[0],i=n[1],s=new iS(aS(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=mr[t.charCodeAt(c)]<<18|mr[t.charCodeAt(c+1)]<<12|mr[t.charCodeAt(c+2)]<<6|mr[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=mr[t.charCodeAt(c)]<<2|mr[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=mr[t.charCodeAt(c)]<<10|mr[t.charCodeAt(c+1)]<<4|mr[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function lS(t){return Qr[t>>18&63]+Qr[t>>12&63]+Qr[t>>6&63]+Qr[t&63]}function uS(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(lS(r));return i.join("")}function hS(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(uS(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(Qr[e>>2]+Qr[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(Qr[e>>10]+Qr[e>>4&63]+Qr[e<<2&63]+"=")),i.join("")}var Of={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Of.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=t[e+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+t[e+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},Of.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,p=r?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?e+=d/c:e+=d*Math.pow(2,1-f),e*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*c-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;t[n+h]=a&255,h+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+h]=o&255,h+=p,o/=256,l-=8);t[n+h-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=_l,n=Of,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=C,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const O=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(O,g),O.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(O){if(O>i)throw new RangeError('The value "'+O+'" is invalid for option "size"');const g=new s(O);return Object.setPrototypeOf(g,u.prototype),g}function u(O,g,_){if(typeof O=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(O)}return f(O,g,_)}u.poolSize=8192;function f(O,g,_){if(typeof O=="string")return m(O,g);if(o.isView(O))return w(O);if(O==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O);if(dt(O,o)||O&&dt(O.buffer,o)||typeof a<"u"&&(dt(O,a)||O&&dt(O.buffer,a)))return k(O,g,_);if(typeof O=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const L=O.valueOf&&O.valueOf();if(L!=null&&L!==O)return u.from(L,g,_);const $=T(O);if($)return $;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof O[Symbol.toPrimitive]=="function")return u.from(O[Symbol.toPrimitive]("string"),g,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O)}u.from=function(O,g,_){return f(O,g,_)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(O){if(typeof O!="number")throw new TypeError('"size" argument must be of type number');if(O<0)throw new RangeError('The value "'+O+'" is invalid for option "size"')}function h(O,g,_){return d(O),O<=0?l(O):g!==void 0?typeof _=="string"?l(O).fill(g,_):l(O).fill(g):l(O)}u.alloc=function(O,g,_){return h(O,g,_)};function p(O){return d(O),l(O<0?0:A(O)|0)}u.allocUnsafe=function(O){return p(O)},u.allocUnsafeSlow=function(O){return p(O)};function m(O,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const _=R(O,g)|0;let L=l(_);const $=L.write(O,g);return $!==_&&(L=L.slice(0,$)),L}function b(O){const g=O.length<0?0:A(O.length)|0,_=l(g);for(let L=0;L<g;L+=1)_[L]=O[L]&255;return _}function w(O){if(dt(O,s)){const g=new s(O);return k(g.buffer,g.byteOffset,g.byteLength)}return b(O)}function k(O,g,_){if(g<0||O.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(O.byteLength<g+(_||0))throw new RangeError('"length" is outside of buffer bounds');let L;return g===void 0&&_===void 0?L=new s(O):_===void 0?L=new s(O,g):L=new s(O,g,_),Object.setPrototypeOf(L,u.prototype),L}function T(O){if(u.isBuffer(O)){const g=A(O.length)|0,_=l(g);return _.length===0||O.copy(_,0,0,g),_}if(O.length!==void 0)return typeof O.length!="number"||Tt(O.length)?l(0):b(O);if(O.type==="Buffer"&&Array.isArray(O.data))return b(O.data)}function A(O){if(O>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return O|0}function C(O){return+O!=O&&(O=0),u.alloc(+O)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,_){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),dt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(g)||!u.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===_)return 0;let L=g.length,$=_.length;for(let Q=0,it=Math.min(L,$);Q<it;++Q)if(g[Q]!==_[Q]){L=g[Q],$=_[Q];break}return L<$?-1:$<L?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,_){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let L;if(_===void 0)for(_=0,L=0;L<g.length;++L)_+=g[L].length;const $=u.allocUnsafe(_);let Q=0;for(L=0;L<g.length;++L){let it=g[L];if(dt(it,s))Q+it.length>$.length?(u.isBuffer(it)||(it=u.from(it)),it.copy($,Q)):s.prototype.set.call($,it,Q);else if(u.isBuffer(it))it.copy($,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=it.length}return $};function R(O,g){if(u.isBuffer(O))return O.length;if(o.isView(O)||dt(O,o))return O.byteLength;if(typeof O!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof O);const _=O.length,L=arguments.length>2&&arguments[2]===!0;if(!L&&_===0)return 0;let $=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return ct(O).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _*2;case"hex":return _>>>1;case"base64":return mt(O).length;default:if($)return L?-1:ct(O).length;g=(""+g).toLowerCase(),$=!0}}u.byteLength=R;function S(O,g,_){let L=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0,g>>>=0,_<=g))return"";for(O||(O="utf8");;)switch(O){case"hex":return W(this,g,_);case"utf8":case"utf-8":return j(this,g,_);case"ascii":return ft(this,g,_);case"latin1":case"binary":return V(this,g,_);case"base64":return q(this,g,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,g,_);default:if(L)throw new TypeError("Unknown encoding: "+O);O=(O+"").toLowerCase(),L=!0}}u.prototype._isBuffer=!0;function F(O,g,_){const L=O[g];O[g]=O[_],O[_]=L}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<g;_+=2)F(this,_,_+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<g;_+=4)F(this,_,_+3),F(this,_+1,_+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<g;_+=8)F(this,_,_+7),F(this,_+1,_+6),F(this,_+2,_+5),F(this,_+3,_+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?j(this,0,g):S.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const _=t.INSPECT_MAX_BYTES;return g=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,_,L,$,Q){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(_===void 0&&(_=0),L===void 0&&(L=g?g.length:0),$===void 0&&($=0),Q===void 0&&(Q=this.length),_<0||L>g.length||$<0||Q>this.length)throw new RangeError("out of range index");if($>=Q&&_>=L)return 0;if($>=Q)return-1;if(_>=L)return 1;if(_>>>=0,L>>>=0,$>>>=0,Q>>>=0,this===g)return 0;let it=Q-$,Kt=L-_;const Se=Math.min(it,Kt),Ee=this.slice($,Q),Oe=g.slice(_,L);for(let le=0;le<Se;++le)if(Ee[le]!==Oe[le]){it=Ee[le],Kt=Oe[le];break}return it<Kt?-1:Kt<it?1:0};function N(O,g,_,L,$){if(O.length===0)return-1;if(typeof _=="string"?(L=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,Tt(_)&&(_=$?0:O.length-1),_<0&&(_=O.length+_),_>=O.length){if($)return-1;_=O.length-1}else if(_<0)if($)_=0;else return-1;if(typeof g=="string"&&(g=u.from(g,L)),u.isBuffer(g))return g.length===0?-1:P(O,g,_,L,$);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?$?s.prototype.indexOf.call(O,g,_):s.prototype.lastIndexOf.call(O,g,_):P(O,[g],_,L,$);throw new TypeError("val must be string, number or Buffer")}function P(O,g,_,L,$){let Q=1,it=O.length,Kt=g.length;if(L!==void 0&&(L=String(L).toLowerCase(),L==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(O.length<2||g.length<2)return-1;Q=2,it/=2,Kt/=2,_/=2}function Se(Oe,le){return Q===1?Oe[le]:Oe.readUInt16BE(le*Q)}let Ee;if($){let Oe=-1;for(Ee=_;Ee<it;Ee++)if(Se(O,Ee)===Se(g,Oe===-1?0:Ee-Oe)){if(Oe===-1&&(Oe=Ee),Ee-Oe+1===Kt)return Oe*Q}else Oe!==-1&&(Ee-=Ee-Oe),Oe=-1}else for(_+Kt>it&&(_=it-Kt),Ee=_;Ee>=0;Ee--){let Oe=!0;for(let le=0;le<Kt;le++)if(Se(O,Ee+le)!==Se(g,le)){Oe=!1;break}if(Oe)return Ee}return-1}u.prototype.includes=function(g,_,L){return this.indexOf(g,_,L)!==-1},u.prototype.indexOf=function(g,_,L){return N(this,g,_,L,!0)},u.prototype.lastIndexOf=function(g,_,L){return N(this,g,_,L,!1)};function H(O,g,_,L){_=Number(_)||0;const $=O.length-_;L?(L=Number(L),L>$&&(L=$)):L=$;const Q=g.length;L>Q/2&&(L=Q/2);let it;for(it=0;it<L;++it){const Kt=parseInt(g.substr(it*2,2),16);if(Tt(Kt))return it;O[_+it]=Kt}return it}function M(O,g,_,L){return Et(ct(g,O.length-_),O,_,L)}function I(O,g,_,L){return Et(ht(g),O,_,L)}function E(O,g,_,L){return Et(mt(g),O,_,L)}function D(O,g,_,L){return Et(J(g,O.length-_),O,_,L)}u.prototype.write=function(g,_,L,$){if(_===void 0)$="utf8",L=this.length,_=0;else if(L===void 0&&typeof _=="string")$=_,L=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(L)?(L=L>>>0,$===void 0&&($="utf8")):($=L,L=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Q=this.length-_;if((L===void 0||L>Q)&&(L=Q),g.length>0&&(L<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");$||($="utf8");let it=!1;for(;;)switch($){case"hex":return H(this,g,_,L);case"utf8":case"utf-8":return M(this,g,_,L);case"ascii":case"latin1":case"binary":return I(this,g,_,L);case"base64":return E(this,g,_,L);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,g,_,L);default:if(it)throw new TypeError("Unknown encoding: "+$);$=(""+$).toLowerCase(),it=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function q(O,g,_){return g===0&&_===O.length?e.fromByteArray(O):e.fromByteArray(O.slice(g,_))}function j(O,g,_){_=Math.min(O.length,_);const L=[];let $=g;for(;$<_;){const Q=O[$];let it=null,Kt=Q>239?4:Q>223?3:Q>191?2:1;if($+Kt<=_){let Se,Ee,Oe,le;switch(Kt){case 1:Q<128&&(it=Q);break;case 2:Se=O[$+1],(Se&192)===128&&(le=(Q&31)<<6|Se&63,le>127&&(it=le));break;case 3:Se=O[$+1],Ee=O[$+2],(Se&192)===128&&(Ee&192)===128&&(le=(Q&15)<<12|(Se&63)<<6|Ee&63,le>2047&&(le<55296||le>57343)&&(it=le));break;case 4:Se=O[$+1],Ee=O[$+2],Oe=O[$+3],(Se&192)===128&&(Ee&192)===128&&(Oe&192)===128&&(le=(Q&15)<<18|(Se&63)<<12|(Ee&63)<<6|Oe&63,le>65535&&le<1114112&&(it=le))}}it===null?(it=65533,Kt=1):it>65535&&(it-=65536,L.push(it>>>10&1023|55296),it=56320|it&1023),L.push(it),$+=Kt}return tt(L)}const ot=4096;function tt(O){const g=O.length;if(g<=ot)return String.fromCharCode.apply(String,O);let _="",L=0;for(;L<g;)_+=String.fromCharCode.apply(String,O.slice(L,L+=ot));return _}function ft(O,g,_){let L="";_=Math.min(O.length,_);for(let $=g;$<_;++$)L+=String.fromCharCode(O[$]&127);return L}function V(O,g,_){let L="";_=Math.min(O.length,_);for(let $=g;$<_;++$)L+=String.fromCharCode(O[$]);return L}function W(O,g,_){const L=O.length;(!g||g<0)&&(g=0),(!_||_<0||_>L)&&(_=L);let $="";for(let Q=g;Q<_;++Q)$+=ue[O[Q]];return $}function bt(O,g,_){const L=O.slice(g,_);let $="";for(let Q=0;Q<L.length-1;Q+=2)$+=String.fromCharCode(L[Q]+L[Q+1]*256);return $}u.prototype.slice=function(g,_){const L=this.length;g=~~g,_=_===void 0?L:~~_,g<0?(g+=L,g<0&&(g=0)):g>L&&(g=L),_<0?(_+=L,_<0&&(_=0)):_>L&&(_=L),_<g&&(_=g);const $=this.subarray(g,_);return Object.setPrototypeOf($,u.prototype),$};function at(O,g,_){if(O%1!==0||O<0)throw new RangeError("offset is not uint");if(O+g>_)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,_,L){g=g>>>0,_=_>>>0,L||at(g,_,this.length);let $=this[g],Q=1,it=0;for(;++it<_&&(Q*=256);)$+=this[g+it]*Q;return $},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,_,L){g=g>>>0,_=_>>>0,L||at(g,_,this.length);let $=this[g+--_],Q=1;for(;_>0&&(Q*=256);)$+=this[g+--_]*Q;return $},u.prototype.readUint8=u.prototype.readUInt8=function(g,_){return g=g>>>0,_||at(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,_){return g=g>>>0,_||at(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,_){return g=g>>>0,_||at(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,_){return g=g>>>0,_||at(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,_){return g=g>>>0,_||at(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=$t(function(g){g=g>>>0,nt(g,"offset");const _=this[g],L=this[g+7];(_===void 0||L===void 0)&&B(g,this.length-8);const $=_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,Q=this[++g]+this[++g]*2**8+this[++g]*2**16+L*2**24;return BigInt($)+(BigInt(Q)<<BigInt(32))}),u.prototype.readBigUInt64BE=$t(function(g){g=g>>>0,nt(g,"offset");const _=this[g],L=this[g+7];(_===void 0||L===void 0)&&B(g,this.length-8);const $=_*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],Q=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+L;return(BigInt($)<<BigInt(32))+BigInt(Q)}),u.prototype.readIntLE=function(g,_,L){g=g>>>0,_=_>>>0,L||at(g,_,this.length);let $=this[g],Q=1,it=0;for(;++it<_&&(Q*=256);)$+=this[g+it]*Q;return Q*=128,$>=Q&&($-=Math.pow(2,8*_)),$},u.prototype.readIntBE=function(g,_,L){g=g>>>0,_=_>>>0,L||at(g,_,this.length);let $=_,Q=1,it=this[g+--$];for(;$>0&&(Q*=256);)it+=this[g+--$]*Q;return Q*=128,it>=Q&&(it-=Math.pow(2,8*_)),it},u.prototype.readInt8=function(g,_){return g=g>>>0,_||at(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,_){g=g>>>0,_||at(g,2,this.length);const L=this[g]|this[g+1]<<8;return L&32768?L|4294901760:L},u.prototype.readInt16BE=function(g,_){g=g>>>0,_||at(g,2,this.length);const L=this[g+1]|this[g]<<8;return L&32768?L|4294901760:L},u.prototype.readInt32LE=function(g,_){return g=g>>>0,_||at(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,_){return g=g>>>0,_||at(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=$t(function(g){g=g>>>0,nt(g,"offset");const _=this[g],L=this[g+7];(_===void 0||L===void 0)&&B(g,this.length-8);const $=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(L<<24);return(BigInt($)<<BigInt(32))+BigInt(_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=$t(function(g){g=g>>>0,nt(g,"offset");const _=this[g],L=this[g+7];(_===void 0||L===void 0)&&B(g,this.length-8);const $=(_<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt($)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+L)}),u.prototype.readFloatLE=function(g,_){return g=g>>>0,_||at(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,_){return g=g>>>0,_||at(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,_){return g=g>>>0,_||at(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,_){return g=g>>>0,_||at(g,8,this.length),n.read(this,g,!1,52,8)};function lt(O,g,_,L,$,Q){if(!u.isBuffer(O))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>$||g<Q)throw new RangeError('"value" argument is out of bounds');if(_+L>O.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,_,L,$){if(g=+g,_=_>>>0,L=L>>>0,!$){const Kt=Math.pow(2,8*L)-1;lt(this,g,_,L,Kt,0)}let Q=1,it=0;for(this[_]=g&255;++it<L&&(Q*=256);)this[_+it]=g/Q&255;return _+L},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,_,L,$){if(g=+g,_=_>>>0,L=L>>>0,!$){const Kt=Math.pow(2,8*L)-1;lt(this,g,_,L,Kt,0)}let Q=L-1,it=1;for(this[_+Q]=g&255;--Q>=0&&(it*=256);)this[_+Q]=g/it&255;return _+L},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,_,L){return g=+g,_=_>>>0,L||lt(this,g,_,1,255,0),this[_]=g&255,_+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,_,L){return g=+g,_=_>>>0,L||lt(this,g,_,2,65535,0),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,_,L){return g=+g,_=_>>>0,L||lt(this,g,_,2,65535,0),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,_,L){return g=+g,_=_>>>0,L||lt(this,g,_,4,4294967295,0),this[_+3]=g>>>24,this[_+2]=g>>>16,this[_+1]=g>>>8,this[_]=g&255,_+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,_,L){return g=+g,_=_>>>0,L||lt(this,g,_,4,4294967295,0),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4};function Dt(O,g,_,L,$){st(g,L,$,O,_,7);let Q=Number(g&BigInt(4294967295));O[_++]=Q,Q=Q>>8,O[_++]=Q,Q=Q>>8,O[_++]=Q,Q=Q>>8,O[_++]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[_++]=it,it=it>>8,O[_++]=it,it=it>>8,O[_++]=it,it=it>>8,O[_++]=it,_}function Yt(O,g,_,L,$){st(g,L,$,O,_,7);let Q=Number(g&BigInt(4294967295));O[_+7]=Q,Q=Q>>8,O[_+6]=Q,Q=Q>>8,O[_+5]=Q,Q=Q>>8,O[_+4]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[_+3]=it,it=it>>8,O[_+2]=it,it=it>>8,O[_+1]=it,it=it>>8,O[_]=it,_+8}u.prototype.writeBigUInt64LE=$t(function(g,_=0){return Dt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=$t(function(g,_=0){return Yt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,_,L,$){if(g=+g,_=_>>>0,!$){const Se=Math.pow(2,8*L-1);lt(this,g,_,L,Se-1,-Se)}let Q=0,it=1,Kt=0;for(this[_]=g&255;++Q<L&&(it*=256);)g<0&&Kt===0&&this[_+Q-1]!==0&&(Kt=1),this[_+Q]=(g/it>>0)-Kt&255;return _+L},u.prototype.writeIntBE=function(g,_,L,$){if(g=+g,_=_>>>0,!$){const Se=Math.pow(2,8*L-1);lt(this,g,_,L,Se-1,-Se)}let Q=L-1,it=1,Kt=0;for(this[_+Q]=g&255;--Q>=0&&(it*=256);)g<0&&Kt===0&&this[_+Q+1]!==0&&(Kt=1),this[_+Q]=(g/it>>0)-Kt&255;return _+L},u.prototype.writeInt8=function(g,_,L){return g=+g,_=_>>>0,L||lt(this,g,_,1,127,-128),g<0&&(g=255+g+1),this[_]=g&255,_+1},u.prototype.writeInt16LE=function(g,_,L){return g=+g,_=_>>>0,L||lt(this,g,_,2,32767,-32768),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeInt16BE=function(g,_,L){return g=+g,_=_>>>0,L||lt(this,g,_,2,32767,-32768),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeInt32LE=function(g,_,L){return g=+g,_=_>>>0,L||lt(this,g,_,4,2147483647,-2147483648),this[_]=g&255,this[_+1]=g>>>8,this[_+2]=g>>>16,this[_+3]=g>>>24,_+4},u.prototype.writeInt32BE=function(g,_,L){return g=+g,_=_>>>0,L||lt(this,g,_,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4},u.prototype.writeBigInt64LE=$t(function(g,_=0){return Dt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=$t(function(g,_=0){return Yt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Mt(O,g,_,L,$,Q){if(_+L>O.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function Ct(O,g,_,L,$){return g=+g,_=_>>>0,$||Mt(O,g,_,4),n.write(O,g,_,L,23,4),_+4}u.prototype.writeFloatLE=function(g,_,L){return Ct(this,g,_,!0,L)},u.prototype.writeFloatBE=function(g,_,L){return Ct(this,g,_,!1,L)};function Pt(O,g,_,L,$){return g=+g,_=_>>>0,$||Mt(O,g,_,8),n.write(O,g,_,L,52,8),_+8}u.prototype.writeDoubleLE=function(g,_,L){return Pt(this,g,_,!0,L)},u.prototype.writeDoubleBE=function(g,_,L){return Pt(this,g,_,!1,L)},u.prototype.copy=function(g,_,L,$){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(L||(L=0),!$&&$!==0&&($=this.length),_>=g.length&&(_=g.length),_||(_=0),$>0&&$<L&&($=L),$===L||g.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(L<0||L>=this.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("sourceEnd out of bounds");$>this.length&&($=this.length),g.length-_<$-L&&($=g.length-_+L);const Q=$-L;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(_,L,$):s.prototype.set.call(g,this.subarray(L,$),_),Q},u.prototype.fill=function(g,_,L,$){if(typeof g=="string"){if(typeof _=="string"?($=_,_=0,L=this.length):typeof L=="string"&&($=L,L=this.length),$!==void 0&&typeof $!="string")throw new TypeError("encoding must be a string");if(typeof $=="string"&&!u.isEncoding($))throw new TypeError("Unknown encoding: "+$);if(g.length===1){const it=g.charCodeAt(0);($==="utf8"&&it<128||$==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(_<0||this.length<_||this.length<L)throw new RangeError("Out of range index");if(L<=_)return this;_=_>>>0,L=L===void 0?this.length:L>>>0,g||(g=0);let Q;if(typeof g=="number")for(Q=_;Q<L;++Q)this[Q]=g;else{const it=u.isBuffer(g)?g:u.from(g,$),Kt=it.length;if(Kt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(Q=0;Q<L-_;++Q)this[Q+_]=it[Q%Kt]}return this};const Ut={};function se(O,g,_){Ut[O]=class extends _{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${O}]`,this.stack,delete this.name}get code(){return O}set code($){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:$,writable:!0})}toString(){return`${this.name} [${O}]: ${this.message}`}}}se("ERR_BUFFER_OUT_OF_BOUNDS",function(O){return O?`${O} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),se("ERR_INVALID_ARG_TYPE",function(O,g){return`The "${O}" argument must be of type number. Received type ${typeof g}`},TypeError),se("ERR_OUT_OF_RANGE",function(O,g,_){let L=`The value of "${O}" is out of range.`,$=_;return Number.isInteger(_)&&Math.abs(_)>2**32?$=Be(String(_)):typeof _=="bigint"&&($=String(_),(_>BigInt(2)**BigInt(32)||_<-(BigInt(2)**BigInt(32)))&&($=Be($)),$+="n"),L+=` It must be ${g}. Received ${$}`,L},RangeError);function Be(O){let g="",_=O.length;const L=O[0]==="-"?1:0;for(;_>=L+4;_-=3)g=`_${O.slice(_-3,_)}${g}`;return`${O.slice(0,_)}${g}`}function v(O,g,_){nt(g,"offset"),(O[g]===void 0||O[g+_]===void 0)&&B(g,O.length-(_+1))}function st(O,g,_,L,$,Q){if(O>_||O<g){const it=typeof g=="bigint"?"n":"";let Kt;throw g===0||g===BigInt(0)?Kt=`>= 0${it} and < 2${it} ** ${(Q+1)*8}${it}`:Kt=`>= -(2${it} ** ${(Q+1)*8-1}${it}) and < 2 ** ${(Q+1)*8-1}${it}`,new Ut.ERR_OUT_OF_RANGE("value",Kt,O)}v(L,$,Q)}function nt(O,g){if(typeof O!="number")throw new Ut.ERR_INVALID_ARG_TYPE(g,"number",O)}function B(O,g,_){throw Math.floor(O)!==O?(nt(O,_),new Ut.ERR_OUT_OF_RANGE("offset","an integer",O)):g<0?new Ut.ERR_BUFFER_OUT_OF_BOUNDS:new Ut.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,O)}const U=/[^+/0-9A-Za-z-_]/g;function Y(O){if(O=O.split("=")[0],O=O.trim().replace(U,""),O.length<2)return"";for(;O.length%4!==0;)O=O+"=";return O}function ct(O,g){g=g||1/0;let _;const L=O.length;let $=null;const Q=[];for(let it=0;it<L;++it){if(_=O.charCodeAt(it),_>55295&&_<57344){if(!$){if(_>56319){(g-=3)>-1&&Q.push(239,191,189);continue}else if(it+1===L){(g-=3)>-1&&Q.push(239,191,189);continue}$=_;continue}if(_<56320){(g-=3)>-1&&Q.push(239,191,189),$=_;continue}_=($-55296<<10|_-56320)+65536}else $&&(g-=3)>-1&&Q.push(239,191,189);if($=null,_<128){if((g-=1)<0)break;Q.push(_)}else if(_<2048){if((g-=2)<0)break;Q.push(_>>6|192,_&63|128)}else if(_<65536){if((g-=3)<0)break;Q.push(_>>12|224,_>>6&63|128,_&63|128)}else if(_<1114112){if((g-=4)<0)break;Q.push(_>>18|240,_>>12&63|128,_>>6&63|128,_&63|128)}else throw new Error("Invalid code point")}return Q}function ht(O){const g=[];for(let _=0;_<O.length;++_)g.push(O.charCodeAt(_)&255);return g}function J(O,g){let _,L,$;const Q=[];for(let it=0;it<O.length&&!((g-=2)<0);++it)_=O.charCodeAt(it),L=_>>8,$=_%256,Q.push($),Q.push(L);return Q}function mt(O){return e.toByteArray(Y(O))}function Et(O,g,_,L){let $;for($=0;$<L&&!($+_>=g.length||$>=O.length);++$)g[$+_]=O[$];return $}function dt(O,g){return O instanceof g||O!=null&&O.constructor!=null&&O.constructor.name!=null&&O.constructor.name===g.name}function Tt(O){return O!==O}const ue=function(){const O="0123456789abcdef",g=new Array(256);for(let _=0;_<16;++_){const L=_*16;for(let $=0;$<16;++$)g[L+$]=O[_]+O[$]}return g}();function $t(O){return typeof BigInt>"u"?Yn:O}function Yn(){throw new Error("BigInt not supported")}})(Yg);const pn=Yg.Buffer,Zg=t=>t===void 0?null:t;class fS{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Xg=new fS,dS=!0;try{typeof localStorage<"u"&&localStorage&&(Xg=localStorage,dS=!1)}catch{}const pS=Xg,mS=Object.assign,gS=Object.keys,_S=(t,e)=>{for(const n in t)e(t[n],n)},qg=t=>gS(t).length,yS=t=>{for(const e in t)return!1;return!0},bS=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},wS=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),ES=(t,e)=>t===e||qg(t)===qg(e)&&bS(t,(n,r)=>(n!==void 0||wS(e,r))&&e[r]===n),xS=Object.freeze,Jg=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Jg(t[e])}return xS(t)},If=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&If(t,e,n+1)}},vS=t=>t,kS=(t,e)=>e.includes(t);var Qg={};const za=typeof Ir<"u"&&Ir.release&&/node|io\.js/.test(Ir.release.name)&&Object.prototype.toString.call(typeof Ir<"u"?Ir:0)==="[object process]";let ti;const TS=()=>{if(ti===void 0)if(za){ti=Nr();const t=Ir.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&ti.set(e,""),e=r):e!==null&&(ti.set(e,r),e=null)}e!==null&&ti.set(e,"")}else typeof location=="object"?(ti=Nr(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");ti.set(`--${Bg(e,"-")}`,n),ti.set(`-${Bg(e,"-")}`,n)}})):ti=Nr();return ti},Nf=t=>TS().has(t),yl=t=>Zg(za?Qg[t.toUpperCase().replaceAll("-","_")]:pS.getItem(t)),t_=t=>Nf("--"+t)||yl(t)!==null;t_("production");const AS=za&&kS(Qg.FORCE_COLOR,["true","1","2"])||!Nf("--no-colors")&&!t_("no-color")&&(!za||Ir.stdout.isTTY)&&(!za||Nf("--color")||yl("COLORTERM")!==null||(yl("TERM")||"").includes("color")),RS=t=>new Uint8Array(t),SS=t=>{const e=RS(t.byteLength);return e.set(t),e};class OS{constructor(e,n){this.left=e,this.right=n}}const vi=(t,e)=>new OS(t,e);typeof DOMParser<"u"&&new DOMParser;const IS=t=>SR(t,(e,n)=>`${n}:${e};`).join(""),ki=Symbol,e_=ki(),n_=ki(),NS=ki(),CS=ki(),LS=ki(),r_=ki(),MS=ki(),Cf=ki(),US=ki(),FS=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},BS={[e_]:vi("font-weight","bold"),[n_]:vi("font-weight","normal"),[NS]:vi("color","blue"),[LS]:vi("color","green"),[CS]:vi("color","grey"),[r_]:vi("color","red"),[MS]:vi("color","purple"),[Cf]:vi("color","orange"),[US]:vi("color","black")},i_=AS?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Nr();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=BS[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=IS(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:FS,PS=(...t)=>{console.log(...i_(t)),s_.forEach(e=>e.print(t))},DS=(...t)=>{console.warn(...i_(t)),t.unshift(Cf),s_.forEach(e=>e.print(t))},s_=bo(),o_=t=>({[Symbol.iterator](){return this},next:t}),$S=(t,e)=>o_(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Lf=(t,e)=>o_(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Mf{constructor(e,n){this.clock=e,this.len=n}}class Ka{constructor(){this.clients=new Map}}const a_=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];v_(t,s,a.clock,a.len,n)}}),jS=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Xi((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},c_=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&jS(n,e.clock)!==null},Uf=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=Ls(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},zS=t=>{const e=new Ka;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)IR(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return Uf(e),e},bl=(t,e,n,r)=>{Zi(t.clients,e,()=>[]).push(new Mf(n,r))},KS=()=>new Ka,WS=t=>{const e=KS();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Mf(a,c))}}i.length>0&&e.clients.set(r,i)}),e},To=(t,e)=>{ne(t.restEncoder,e.clients.size),Cs(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),ne(t.restEncoder,n);const i=r.length;ne(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},Ff=t=>{const e=new Ka,n=Ht(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Ht(t.restDecoder),s=Ht(t.restDecoder);if(s>0){const o=Zi(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Mf(t.readDsClock(),t.readDsLen()))}}return e},l_=(t,e,n)=>{const r=new Ka,i=Ht(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Ht(t.restDecoder),a=Ht(t.restDecoder),c=n.clients.get(o)||[],l=an(n,o);for(let u=0;u<a;u++){const f=t.readDsClock(),d=f+t.readDsLen();if(f<l){l<d&&bl(r,o,l,d-l);let h=ei(c,f),p=c[h];for(!p.deleted&&p.id.clock<f&&(c.splice(h+1,0,Ll(e,p,f-p.id.clock)),h++);h<c.length&&(p=c[h++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(h,0,Ll(e,p,d-p.id.clock)),p.delete(e))}else bl(r,o,f,d-f)}}if(r.clients.size>0){const s=new Us;return ne(s.restEncoder,0),To(s,r),s.toUint8Array()}return null},u_=Hg;class Ao extends CR{constructor({guid:e=rS(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=u_(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new w_,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Gg(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Gg(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&de(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Cs(this.subdocs).map(e=>e.guid))}transact(e,n=null){return de(this,e,n)}get(e,n=mn){const r=Zi(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==mn&&i!==n)if(i===mn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Io)}getText(e=""){return this.get(e,Ti)}getMap(e=""){return this.get(e,No)}getXmlElement(e=""){return this.get(e,Lo)}getXmlFragment(e=""){return this.get(e,Fs)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Cs(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new Ao({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,de(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class h_{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ht(this.restDecoder)}readDsLen(){return Ht(this.restDecoder)}}class f_ extends h_{readLeftID(){return Xt(Ht(this.restDecoder),Ht(this.restDecoder))}readRightID(){return Xt(Ht(this.restDecoder),Ht(this.restDecoder))}readClient(){return Ht(this.restDecoder)}readInfo(){return xo(this.restDecoder)}readString(){return vo(this.restDecoder)}readParentInfo(){return Ht(this.restDecoder)===1}readTypeRef(){return Ht(this.restDecoder)}readLen(){return Ht(this.restDecoder)}readAny(){return ja(this.restDecoder)}readBuf(){return SS(er(this.restDecoder))}readJSON(){return JSON.parse(vo(this.restDecoder))}readKey(){return vo(this.restDecoder)}}class HS{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ht(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ht(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Ro extends HS{constructor(e){super(e),this.keys=[],Ht(e),this.keyClockDecoder=new Rf(er(e)),this.clientDecoder=new gl(er(e)),this.leftClockDecoder=new Rf(er(e)),this.rightClockDecoder=new Rf(er(e)),this.infoDecoder=new Wg(er(e),xo),this.stringDecoder=new tS(er(e)),this.parentInfoDecoder=new Wg(er(e),xo),this.typeRefDecoder=new gl(er(e)),this.lenDecoder=new gl(er(e))}readLeftID(){return new So(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new So(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ja(this.restDecoder)}readBuf(){return er(this.restDecoder)}readJSON(){return ja(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class GS{constructor(){this.restEncoder=fl()}toUint8Array(){return Xr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ne(this.restEncoder,e)}writeDsLen(e){ne(this.restEncoder,e)}}class Wa extends GS{writeLeftID(e){ne(this.restEncoder,e.client),ne(this.restEncoder,e.clock)}writeRightID(e){ne(this.restEncoder,e.client),ne(this.restEncoder,e.clock)}writeClient(e){ne(this.restEncoder,e)}writeInfo(e){wf(this.restEncoder,e)}writeString(e){wo(this.restEncoder,e)}writeParentInfo(e){ne(this.restEncoder,e?1:0)}writeTypeRef(e){ne(this.restEncoder,e)}writeLen(e){ne(this.restEncoder,e)}writeAny(e){$a(this.restEncoder,e)}writeBuf(e){tr(this.restEncoder,e)}writeJSON(e){wo(this.restEncoder,JSON.stringify(e))}writeKey(e){wo(this.restEncoder,e)}}class YS{constructor(){this.restEncoder=fl(),this.dsCurrVal=0}toUint8Array(){return Xr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,ne(this.restEncoder,n)}writeDsLen(e){e===0&&Jr(),ne(this.restEncoder,e-1),this.dsCurrVal+=e}}class Us extends YS{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new kf,this.clientEncoder=new pl,this.leftClockEncoder=new kf,this.rightClockEncoder=new kf,this.infoEncoder=new Dg(wf),this.stringEncoder=new XR,this.parentInfoEncoder=new Dg(wf),this.typeRefEncoder=new pl,this.lenEncoder=new pl}toUint8Array(){const e=fl();return ne(e,0),tr(e,this.keyClockEncoder.toUint8Array()),tr(e,this.clientEncoder.toUint8Array()),tr(e,this.leftClockEncoder.toUint8Array()),tr(e,this.rightClockEncoder.toUint8Array()),tr(e,Xr(this.infoEncoder)),tr(e,this.stringEncoder.toUint8Array()),tr(e,Xr(this.parentInfoEncoder)),tr(e,this.typeRefEncoder.toUint8Array()),tr(e,this.lenEncoder.toUint8Array()),dl(e,Xr(this.restEncoder)),Xr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){$a(this.restEncoder,e)}writeBuf(e){tr(this.restEncoder,e)}writeJSON(e){$a(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const VS=(t,e,n,r)=>{r=Ls(r,e[0].id.clock);const i=ei(e,r);ne(t.restEncoder,e.length-i),t.writeClient(n),ne(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},Bf=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{an(e,s)>i&&r.set(s,i)}),Df(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),ne(t.restEncoder,r.size),Cs(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{VS(t,e.clients.get(i),i,s)})},ZS=(t,e)=>{const n=Nr(),r=Ht(t.restDecoder);for(let i=0;i<r;i++){const s=Ht(t.restDecoder),o=new Array(s),a=t.readClient();let c=Ht(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(hl&u){case 0:{const f=t.readLen();o[l]=new gr(Xt(a,c),f),c+=f;break}case 10:{const f=Ht(t.restDecoder);o[l]=new _r(Xt(a,c),f),c+=f;break}default:{const f=(u&(xi|Qn))===0,d=new Xe(Xt(a,c),null,(u&Qn)===Qn?t.readLeftID():null,null,(u&xi)===xi?t.readRightID():null,f?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,f&&(u&Fa)===Fa?t.readString():null,V_(t,u));o[l]=d,c+=d.length}}}}return n},XS=(t,e,n)=>{const r=[];let i=Cs(n.keys()).sort((h,p)=>h-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new w_,c=new Map,l=(h,p)=>{const m=c.get(h);(m==null||m>p)&&c.set(h,p)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const p=h.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[h]),i=i.filter(b=>b!==p)}r.length=0};for(;;){if(u.constructor!==_r){const p=Zi(f,u.id.client,()=>an(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const b=n.get(m)||{refs:[],i:0};if(b.refs.length===b.i)l(m,an(e,m)),d();else{u=b.refs[b.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new Us;return Bf(h,a,new Map),ne(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},qS=(t,e)=>Bf(t,e.doc.store,e.beforeState),JS=(t,e,n,r=new Ro(t))=>de(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=ZS(r,o),l=XS(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<an(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const p=u.missing.get(d);(p==null||p>h)&&u.missing.set(d,h)}u.update=xl([u.update,l.update])}}else a.pendingStructs=l;const f=l_(r,i,a);if(a.pendingDs){const d=new Ro(Eo(a.pendingDs));Ht(d.restDecoder);const h=l_(d,i,a);f&&h?a.pendingDs=xl([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,d_(i.doc,d)}},n,!1),d_=(t,e,n,r=Ro)=>{const i=Eo(e);JS(i,t,n,new r(i))},p_=(t,e,n)=>d_(t,e,n,f_),QS=(t,e,n=new Map)=>{Bf(t,e.store,n),To(t,WS(e.store))},tO=(t,e=new Uint8Array([0]),n=new Us)=>{const r=m_(e);QS(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(fO(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Wa)return uO(i.map((s,o)=>o===0?s:pO(s)));if(n.constructor===Us)return xl(i)}return i[0]},eO=(t,e)=>tO(t,e,new Wa),nO=t=>{const e=new Map,n=Ht(t.restDecoder);for(let r=0;r<n;r++){const i=Ht(t.restDecoder),s=Ht(t.restDecoder);e.set(i,s)}return e},m_=t=>nO(new h_(Eo(t)));class rO{constructor(){this.l=[]}}const g_=()=>new rO,__=(t,e)=>t.l.push(e),y_=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},b_=(t,e,n)=>If(t.l,[e,n]);class So{constructor(e,n){this.client=e,this.clock=n}}const wl=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Xt=(t,e)=>new So(t,e),iO=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Jr()},Oo=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!c_(e.ds,t.id),Pf=(t,e)=>{const n=Zi(t.meta,Pf,bo),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<an(r,s)&&Ji(t,Xt(s,i))}),a_(t,e.ds,i=>{}),n.add(e))};class w_{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Df=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},an=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},E_=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Jr()}n.push(e)},ei=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=Xi(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=Xi((n+r)/2)}throw Jr()},$f=(t,e)=>{const n=t.clients.get(e.client);return n[ei(n,e.clock)]},jf=(t,e,n)=>{const r=ei(e,n),i=e[r];return i.id.clock<n&&i instanceof Xe?(e.splice(r+1,0,Ll(t,i,n-i.id.clock)),r+1):r},Ji=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[jf(t,n,e.clock)]},x_=(t,e,n)=>{const r=e.clients.get(n.client),i=ei(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==gr&&r.splice(i+1,0,Ll(t,s,n.clock-s.id.clock+1)),s},sO=(t,e,n)=>{const r=t.clients.get(e.id.client);r[ei(r,e.id.clock)]=n},v_=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=jf(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&jf(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class oO{constructor(e,n,r){this.doc=e,this.deleteSet=new Ka,this.beforeState=Df(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const k_=(t,e)=>e.deleteSet.clients.size===0&&!OR(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(Uf(e.deleteSet),qS(t,e),To(t,e.deleteSet),!0),T_=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Zi(t.changed,e,bo).add(n)},El=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Xe&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},aO=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=ei(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Xe&&f.deleted&&!f.keep&&n(f)&&f.gc(e,!1)}}}},cO=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Cg(i.length-1,1+ei(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+El(i,c)}})},A_=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Uf(s),n.afterState=Df(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),b_(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),If(a,[]),n._needFormattingCleanup&&SO(n)}finally{r.gc&&aO(s,i,r.gcFilter),cO(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),p=Ls(ei(h,d),1);for(let m=h.length-1;m>=p;)m-=1+El(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),p=ei(h,d);p+1<h.length&&El(h,p+1)>1||p>0&&El(h,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(PS(Cf,e_,"[yjs] ",n_,r_,"Changed the client-id because another client seems to be using it."),r.clientID=u_()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Wa;k_(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Us;k_(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):A_(t,e+1)}}},de=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new oO(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&A_(i,0)}}return o};function*lO(t){const e=Ht(t.restDecoder);for(let n=0;n<e;n++){const r=Ht(t.restDecoder),i=t.readClient();let s=Ht(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Ht(t.restDecoder);yield new _r(Xt(i,s),c),s+=c}else if(hl&a){const c=(a&(xi|Qn))===0,l=new Xe(Xt(i,s),null,(a&Qn)===Qn?t.readLeftID():null,null,(a&xi)===xi?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&Fa)===Fa?t.readString():null,V_(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new gr(Xt(i,s),c),s+=c}}}}class zf{constructor(e,n){this.gen=lO(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===_r);return this.curr}}class Kf{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const uO=t=>xl(t,f_,Wa),hO=(t,e)=>{if(t.constructor===gr){const{client:n,clock:r}=t.id;return new gr(Xt(n,r+e),t.length-e)}else if(t.constructor===_r){const{client:n,clock:r}=t.id;return new _r(Xt(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new Xe(Xt(r,i+e),null,Xt(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},xl=(t,e=Ro,n=Us)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(Eo(u)));let i=r.map(u=>new zf(u,!0)),s=null;const o=new n,a=new Kf(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const p=d.curr.id.clock-h.curr.id.clock;return p===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===_r?1:-1:p}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Qi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===_r)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Qi(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new _r(Xt(f,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===_r?s.struct.length-=p:d=hO(d,p)),s.struct.mergeWith(d)||(Qi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==_r;d=u.next())Qi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Qi(a,s.struct,s.offset),s=null),Wf(a);const c=r.map(u=>Ff(u)),l=zS(c);return To(o,l),o.toUint8Array()},fO=(t,e,n=Ro,r=Us)=>{const i=m_(e),s=new r,o=new Kf(s),a=new n(Eo(t)),c=new zf(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===_r){c.next();continue}if(u.id.clock+u.length>d)for(Qi(o,u,Ls(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Qi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}Wf(o);const l=Ff(a);return To(s,l),s.toUint8Array()},R_=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Xr(t.encoder.restEncoder)}),t.encoder.restEncoder=fl(),t.written=0)},Qi=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&R_(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ne(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Wf=t=>{R_(t);const e=t.encoder.restEncoder;ne(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];ne(e,r.written),dl(e,r.restEncoder)}},dO=(t,e,n,r)=>{const i=new n(Eo(t)),s=new zf(i,!1),o=new r,a=new Kf(o);for(let l=s.curr;l!==null;l=s.next())Qi(a,e(l),0);Wf(a);const c=Ff(i);return To(o,c),o.toUint8Array()},pO=t=>dO(t,vS,Ro,Wa),S_="You must not compute changes after the event-handler fired.";class vl{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=mO(this.currentTarget,this.target))}deletes(e){return c_(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw qi(S_);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=gf(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=gf(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=gf(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw qi(S_);const n=this.target,r=bo(),i=bo(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const mO=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},bn=()=>{DS("Invalid access: Add Yjs type to a document before reading data.")},O_=80;let Hf=0;class gO{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Hf++}}const _O=t=>{t.timestamp=Hf++},I_=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Hf++},yO=(t,e,n)=>{if(t.length>=O_){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return I_(r,e,n),r}else{const r=new gO(e,n);return t.push(r),r}},kl=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>ul(e-s.index)<ul(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,_O(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&ul(n.index-i)<r.parent.length/O_?(I_(n,r,i),n):yO(t._searchMarker,r,i)},Ha=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=Ls(e,i.index+n))}},Tl=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Zi(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;b_(r._eH,n,e)};class mn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=g_(),this._dEH=g_(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw qr()}clone(){throw qr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){__(this._eH,e)}observeDeep(e){__(this._dEH,e)}unobserve(e){y_(this._eH,e)}unobserveDeep(e){y_(this._dEH,e)}toJSON(){}}const N_=(t,e,n)=>{t.doc??bn(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},C_=t=>{t.doc??bn();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},Ga=(t,e)=>{let n=0,r=t._start;for(t.doc??bn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},L_=(t,e)=>{const n=[];return Ga(t,(r,i)=>{n.push(e(r,i,t))}),n},bO=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},M_=(t,e)=>{t.doc??bn();const n=kl(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Al=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Xe(Xt(o,an(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ps(l)),i.integrate(t,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Xe(Xt(o,an(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ya(new Uint8Array(f))),i.integrate(t,0);break;case Ao:i=new Xe(Xt(o,an(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Za(f)),i.integrate(t,0);break;default:if(f instanceof mn)i=new Xe(Xt(o,an(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ai(f)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},U_=()=>qi("Length exceeded!"),F_=(t,e,n,r)=>{if(n>e._length)throw U_();if(n===0)return e._searchMarker&&Ha(e._searchMarker,n,r.length),Al(t,e,null,r);const i=n,s=kl(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ji(t,Xt(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Ha(e._searchMarker,i,r.length),Al(t,e,o,r)},wO=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Al(t,e,i,n)},B_=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=kl(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ji(t,Xt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ji(t,Xt(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw U_();e._searchMarker&&Ha(e._searchMarker,i,-s+r)},Rl=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Gf=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new Ps([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Ps([r]);break;case Uint8Array:a=new Ya(r);break;case Ao:a=new Za(r);break;default:if(r instanceof mn)a=new Ai(r);else throw new Error("Unexpected content type")}new Xe(Xt(o,an(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Yf=(t,e)=>{t.doc??bn();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},P_=t=>{const e={};return t.doc??bn(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},D_=(t,e)=>{t.doc??bn();const n=t._map.get(e);return n!==void 0&&!n.deleted},EO=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Oo(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Sl=t=>(t.doc??bn(),$S(t._map.entries(),e=>!e[1].deleted));class xO extends vl{}class Io extends mn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Io;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Io}clone(){const e=new Io;return e.insert(0,this.toArray().map(n=>n instanceof mn?n.clone():n)),e}get length(){return this.doc??bn(),this._length}_callObserver(e,n){super._callObserver(e,n),Tl(this,e,new xO(this,e))}insert(e,n){this.doc!==null?de(this.doc,r=>{F_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?de(this.doc,n=>{wO(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?de(this.doc,r=>{B_(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return M_(this,e)}toArray(){return C_(this)}slice(e=0,n=this.length){return N_(this,e,n)}toJSON(){return this.map(e=>e instanceof mn?e.toJSON():e)}map(e){return L_(this,e)}forEach(e){Ga(this,e)}[Symbol.iterator](){return bO(this)}_write(e){e.writeTypeRef(YO)}}const vO=t=>new Io;class kO extends vl{constructor(e,n,r){super(e,n),this.keysChanged=r}}class No extends mn{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new No}clone(){const e=new No;return this.forEach((n,r)=>{e.set(r,n instanceof mn?n.clone():n)}),e}_callObserver(e,n){Tl(this,e,new kO(this,e,n))}toJSON(){this.doc??bn();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof mn?i.toJSON():i}}),e}get size(){return[...Sl(this)].length}keys(){return Lf(Sl(this),e=>e[0])}values(){return Lf(Sl(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Lf(Sl(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??bn(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?de(this.doc,n=>{Rl(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?de(this.doc,r=>{Gf(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Yf(this,e)}has(e){return D_(this,e)}clear(){this.doc!==null?de(this.doc,e=>{this.forEach(function(n,r,i){Rl(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(VO)}}const TO=t=>new No,ts=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&ES(t,e);class Vf{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Jr(),this.right.content.constructor){case Ze:this.right.deleted||Co(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const $_=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Ze:e.right.deleted||Co(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Ji(t,Xt(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Ol=(t,e,n,r)=>{const i=new Map,s=r?kl(e,n):null;if(s){const o=new Vf(s.p.left,s.p,s.index,i);return $_(t,o,n-s.index)}else{const o=new Vf(null,e._start,0,i);return $_(t,o,n)}},j_=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ze&&ts(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Xe(Xt(s,an(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Ze(a,o));u.integrate(t,0),n.right=u,n.forward()})},Co=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},z_=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Ze&&ts(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},K_=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!ts(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Xe(Xt(s,an(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new Ze(a,c)),n.right.integrate(t,0),n.forward()}}return o},Zf=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=t.doc,o=s.clientID;z_(n,i);const a=K_(t,e,n,i),c=r.constructor===String?new ni(r):r instanceof mn?new Ai(r):new Bs(r);let{left:l,right:u,index:f}=n;e._searchMarker&&Ha(e._searchMarker,n.index,c.getLength()),u=new Xe(Xt(o,an(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=f,n.forward(),j_(t,e,n,a)},W_=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;z_(n,i);const a=K_(t,e,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Ze));){if(!n.right.deleted)switch(n.right.content.constructor){case Ze:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(ts(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Ji(t,Xt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Xe(Xt(o,an(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new ni(c)),n.right.integrate(t,0),n.forward()}j_(t,e,n,a)},H_=(t,e,n,r,i)=>{let s=e;const o=Nr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Ze){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Ze:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(e.delete(t),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&Co(i,l);break}}}e=e.right}return a},AO=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Ze){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},RO=t=>{let e=0;return de(t.doc,n=>{let r=t._start,i=t._start,s=Nr();const o=mf(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ze:Co(o,i.content);break;default:e+=H_(n,r,i,s,o),s=mf(o),r=i;break}i=i.right}}),e},SO=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&v_(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Ze&&o.constructor!==gr&&e.add(o.parent)})}de(n,r=>{a_(t,t.deleteSet,i=>{if(i instanceof gr||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Ze?e.add(s):AO(r,i)});for(const i of e)RO(i)})},G_=(t,e,n)=>{const r=n,i=mf(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Ai:case Bs:case ni:n<e.right.length&&Ji(t,Xt(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&H_(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Ha(o._searchMarker,e.index,-r+n),e};class OO extends vl{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];de(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),l="";break;case"retain":u>0&&(h={retain:u},yS(c)||(h.attributes=mS({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case Ai:case Bs:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case ni:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Ze:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;ts(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),ts(p,s.get(h)??null)?delete c[h]:c[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;ts(m,p)||(a==="retain"&&d(),c[h]=m)}else if(!o.deleted){s.set(h,p);const m=c[h];m!==void 0&&(ts(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[h]:c[h]=p))}o.deleted||(a==="insert"&&d(),Co(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Ti extends mn{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??bn(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Ti}clone(){const e=new Ti;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new OO(this,e,n);Tl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??bn();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===ni&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?de(this.doc,r=>{const i=new Vf(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Zf(r,this,i,a,o.attributes||{})}else o.retain!==void 0?W_(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&G_(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??bn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(Oo(c,e)||n!==void 0&&Oo(c,n))switch(c.content.constructor){case ni:{const f=s.get("ychange");e!==void 0&&!Oo(c,e)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Oo(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case Ai:case Bs:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,p)=>{d[p]=h})}i.push(f);break}case Ze:Oo(c,e)&&(l(),Co(s,c.content));break}c=c.right}l()};return e||n?de(o,f=>{e&&Pf(f,e),n&&Pf(f,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?de(i,s=>{const o=Ol(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Zf(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?de(i,s=>{const o=Ol(s,this,e,!r);Zf(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?de(r,i=>{G_(i,Ol(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?de(i,s=>{const o=Ol(s,this,e,!1);o.right!==null&&W_(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?de(this.doc,n=>{Rl(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?de(this.doc,r=>{Gf(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Yf(this,e)}getAttributes(){return P_(this)}_write(e){e.writeTypeRef(ZO)}}const IO=t=>new Ti;class Xf{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??bn()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===Lo||n.constructor===Fs)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Fs extends mn{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Fs}clone(){const e=new Fs;return e.insert(0,this.toArray().map(n=>n instanceof mn?n.clone():n)),e}get length(){return this.doc??bn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Xf(this,e)}querySelector(e){e=e.toUpperCase();const r=new Xf(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Cs(new Xf(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Tl(this,e,new LO(this,n,e))}toString(){return L_(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Ga(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?de(this.doc,r=>{F_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)de(this.doc,r=>{const i=e&&e instanceof mn?e._item:e;Al(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw qi("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?de(this.doc,r=>{B_(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return C_(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return M_(this,e)}slice(e=0,n=this.length){return N_(this,e,n)}forEach(e){Ga(this,e)}_write(e){e.writeTypeRef(qO)}}const NO=t=>new Fs;class Lo extends Fs{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Lo(this.nodeName)}clone(){const e=new Lo(this.nodeName),n=this.getAttributes();return _S(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof mn?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?de(this.doc,n=>{Rl(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?de(this.doc,r=>{Gf(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Yf(this,e)}hasAttribute(e){return D_(this,e)}getAttributes(e){return e?EO(this,e):P_(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Ga(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(XO),e.writeKey(this.nodeName)}}const CO=t=>new Lo(t.readKey());class LO extends vl{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Il extends No{constructor(e){super(),this.hookName=e}_copy(){return new Il(this.hookName)}clone(){const e=new Il(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(JO),e.writeKey(this.hookName)}}const MO=t=>new Il(t.readKey());class Nl extends Ti{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Nl}clone(){const e=new Nl;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(QO)}}const UO=t=>new Nl;class qf{constructor(e,n){this.id=e,this.length=n}get deleted(){throw qr()}mergeWith(e){return!1}write(e,n,r){throw qr()}integrate(e,n){throw qr()}}const FO=0;class gr extends qf{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),E_(e.doc.store,this)}write(e,n){e.writeInfo(FO),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Ya{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ya(this.content)}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const BO=t=>new Ya(t.readBuf());class Va{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Va(this.len)}splice(e){const n=new Va(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){bl(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const PO=t=>new Va(t.readLen()),Y_=(t,e)=>new Ao({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Za{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Za(Y_(this.doc.guid,this.opts))}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const DO=t=>new Za(Y_(t.readString(),t.readAny()));class Bs{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Bs(this.embed)}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const $O=t=>new Bs(t.readJSON());class Ze{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ze(this.key,this.value)}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const jO=t=>new Ze(t.readKey(),t.readJSON());class Cl{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Cl(this.arr)}splice(e){const n=new Cl(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const zO=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Cl(n)},KO=yl("node_env")==="development";class Ps{constructor(e){this.arr=e,KO&&Jg(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ps(this.arr)}splice(e){const n=new Ps(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const WO=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Ps(n)};class ni{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ni(this.str)}splice(e){const n=new ni(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const HO=t=>new ni(t.readString()),GO=[vO,TO,IO,CO,NO,MO,UO],YO=0,VO=1,ZO=2,XO=3,qO=4,JO=5,QO=6;class Ai{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ai(this.type._copy())}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const tI=t=>new Ai(GO[t.readTypeRef()](t)),Ll=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new Xe(Xt(r,i+n),e,Xt(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Xt(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class Xe extends qf{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Ug:0}set marker(e){(this.info&yf)>0!==e&&(this.info^=yf)}get marker(){return(this.info&yf)>0}get keep(){return(this.info&Mg)>0}set keep(e){this.keep!==e&&(this.info^=Mg)}get countable(){return(this.info&Ug)>0}get deleted(){return(this.info&_f)>0}set deleted(e){this.deleted!==e&&(this.info^=_f)}markDeleted(){this.info|=_f}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=an(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=an(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===So&&this.id.client!==this.parent.client&&this.parent.clock>=an(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=x_(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ji(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===gr||this.right&&this.right.constructor===gr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Xe?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Xe&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===So){const r=$f(n,this.parent);r.constructor===gr?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=x_(e,e.doc.store,Xt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),wl(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(wl(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has($f(e.doc.store,i.origin)))s.has($f(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),E_(e.doc.store,this),this.content.integrate(e,this),T_(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new gr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Xt(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&wl(e.origin,this.lastId)&&this.right===e&&wl(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),bl(e.deleteSet,this.id.client,this.id.clock,this.length),T_(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Jr();this.content.gc(e),n?sO(e,this,new gr(this.id,this.length)):this.content=new Va(this.length)}write(e,n){const r=n>0?Xt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&hl|(r===null?0:Qn)|(i===null?0:xi)|(s===null?0:Fa);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=iO(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===So?(e.writeParentInfo(!1),e.writeLeftID(a)):Jr();s!==null&&e.writeString(s)}this.content.write(e,n)}}const V_=(t,e)=>eI[e&hl](t),eI=[()=>{Jr()},PO,zO,BO,HO,$O,jO,tI,WO,DO,()=>{Jr()}],nI=10;class _r extends qf{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Jr()}write(e,n){e.writeInfo(nI),ne(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const Z_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof yo<"u"?yo:{},X_="__ $YJS$ __";Z_[X_]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Z_[X_]=!0;let q_=!1;const nr=new Ao;function J_(t,e,n){const r=nr.getMap();if(!r.has(t))switch(e){case 0:case 1:r.set(t,n);break}}function rI(t,e){J_(t,0,e)}function Jf(t,e){const n=new Ti(e);J_(t,1,n)}function iI(t,e){nr.getMap().set(t,e)}function sI(t,e){const n=nr.getMap(),r=new Ti(e);n.set(t,r)}function Q_(t,e){const n=nr.getMap();function r(i){const s=n.get(t);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&e(s)}return n.has(t)&&e(n.get(t)),n.observeDeep(r),()=>{n.observeDeep(r)}}function oI(t,e){return Q_(t,n=>{At(n)&&e(n)})}function ty(t,e){return Q_(t,n=>{n instanceof Ti&&e(n.toJSON())})}const Ds=so("modem",["second"],t=>{if(Ds.session(t))switch(t.target){case"second":!q_&&t.data%2===0&&Ds.emit(t.player,"modem:join");break;case"join":t.sender!==Ds.id()&&Ds.reply(t,"joinack",Sg(eO(nr)));break;case"joinack":t.sender!==Ds.id()&&(q_=!0,p_(nr,cl(t.data),nr));break;case"sync":{t.sender!==Ds.id()&&x(t.data)&&p_(nr,cl(t.data),nr);break}}});function ey(t,e){e!==nr&&Ds.emit("","modem:sync",Sg(t))}nr.on("update",ey),nr.on("destroy",()=>{nr.off("update",ey)});function aI(t,e){return t%e}function cI(t,e){return Math.floor(t/e)}function lI(t,e){return{x:aI(t,e),y:cI(t,e)}}function Mo(t,e){return t.x+t.y*e}function Uo(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function ny(t,e,n,r){const i=[],s=Math.min(t,n),o=Math.max(t,n),a=Math.min(e,r),c=Math.max(e,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function ry(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const iy="176",uI="",Cr="srgb",sy="srgb-linear",oy="linear",Qf="srgb";function Lr(t,e,n){return Math.max(e,Math.min(n,t))}function hI(t,e){return(t%e+e)%e}function td(t,e,n){return(1-n)*t+n*e}class Xa{constructor(e=0,n=0){Xa.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Lr(this.x,e.x,n.x),this.y=Lr(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Lr(this.x,e,n),this.y=Lr(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Lr(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Lr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class qa{constructor(e,n,r,i,s,o,a,c,l){qa.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],p=r[8],m=i[0],b=i[3],w=i[6],k=i[1],T=i[4],A=i[7],C=i[2],R=i[5],S=i[8];return s[0]=o*m+a*k+c*C,s[3]=o*b+a*T+c*R,s[6]=o*w+a*A+c*S,s[1]=l*m+u*k+f*C,s[4]=l*b+u*T+f*R,s[7]=l*w+u*A+f*S,s[2]=d*m+h*k+p*C,s[5]=d*b+h*T+p*R,s[8]=d*w+h*A+p*S,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,p=n*f+r*d+i*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=f*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=d*m,e[4]=(u*n-i*c)*m,e[5]=(i*s-a*n)*m,e[6]=h*m,e[7]=(r*c-l*n)*m,e[8]=(o*n-r*s)*m,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(ed.makeScale(e,n)),this}rotate(e){return this.premultiply(ed.makeRotation(-e)),this}translate(e,n){return this.premultiply(ed.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const ed=new qa,ay=new qa().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),cy=new qa().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function fI(){const t={enabled:!0,workingColorSpace:sy,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===Qf&&(i.r=Fo(i.r),i.g=Fo(i.g),i.b=Fo(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Qf&&(i.r=Bo(i.r),i.g=Bo(i.g),i.b=Bo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===uI?oy:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[sy]:{primaries:e,whitePoint:r,transfer:oy,toXYZ:ay,fromXYZ:cy,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Cr},outputColorSpaceConfig:{drawingBufferColorSpace:Cr}},[Cr]:{primaries:e,whitePoint:r,transfer:Qf,toXYZ:ay,fromXYZ:cy,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Cr}}}),t}const Mr=fI();function Fo(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Bo(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const ly={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},es={h:0,s:0,l:0},Ml={h:0,s:0,l:0};function nd(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class rd{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Cr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Mr.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=Mr.workingColorSpace){return this.r=e,this.g=n,this.b=r,Mr.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=Mr.workingColorSpace){if(e=hI(e,1),n=Lr(n,0,1),r=Lr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=nd(o,s,e+1/3),this.g=nd(o,s,e),this.b=nd(o,s,e-1/3)}return Mr.toWorkingColorSpace(this,i),this}setStyle(e,n=Cr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Cr){const r=ly[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Fo(e.r),this.g=Fo(e.g),this.b=Fo(e.b),this}copyLinearToSRGB(e){return this.r=Bo(e.r),this.g=Bo(e.g),this.b=Bo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Cr){return Mr.fromWorkingColorSpace(wn.copy(this),e),Math.round(Lr(wn.r*255,0,255))*65536+Math.round(Lr(wn.g*255,0,255))*256+Math.round(Lr(wn.b*255,0,255))}getHexString(e=Cr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Mr.workingColorSpace){Mr.fromWorkingColorSpace(wn.copy(this),n);const r=wn.r,i=wn.g,s=wn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=Mr.workingColorSpace){return Mr.fromWorkingColorSpace(wn.copy(this),n),e.r=wn.r,e.g=wn.g,e.b=wn.b,e}getStyle(e=Cr){Mr.fromWorkingColorSpace(wn.copy(this),e);const n=wn.r,r=wn.g,i=wn.b;return e!==Cr?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(es),this.setHSL(es.h+e,es.s+n,es.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(es),e.getHSL(Ml);const r=td(es.h,Ml.h,n),i=td(es.s,Ml.s,n),s=td(es.l,Ml.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const wn=new rd;rd.NAMES=ly,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:iy}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=iy),new Xa,new Xa;function qe(t,e,n){return Math.max(e,Math.min(n,t))}function uy(t){return t/180*Math.PI}function id(t){return t*180/Math.PI}const dI=xp("089fad0j9awfem09wavefc09uwaef");function pI(){return dI()}function mI(t){return xp(t)()}function yr(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(pI()*i)}function hy(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(mI(t)*s)}function fy(t,e,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function gI(t){return t[yr(0,t.length-1)]}function _I(t,e){return e[hy(t,0,e.length-1)]}function Ae(...t){return gI(t.flat())}function dy(t,...e){return _I(t,e.flat())}function yI(t){return[...new Set(t)].filter(x)}function Po(t){return x(t)&&x(t.x)&&x(t.y)}function ze(t,e){switch(e){case pt.NORTH:--t.y;break;case pt.SOUTH:++t.y;break;case pt.WEST:--t.x;break;case pt.EAST:++t.x;break}return t}function bI(t,e){return t<0?pt.WEST:t>0?pt.EAST:e<0?pt.NORTH:e>0?pt.SOUTH:pt.IDLE}function Ri(t,e){return bI(e.x-t.x,e.y-t.y)}const sd={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Si(t){return ce(t)&&py(t[0])}function py(t){return x(pt[t])&&wt(t)}function wI(t){const e=pt[t];return x(e)?e:pt.IDLE}function od(t){if(wt(t))return sd[It(t)]}function EI(t){if(Si(t))return t;if(py(t))return[t];const e=od(t);if(x(e))return[e]}function my(t){const e=y.words[t],n=EI(e);return Si(n)?[n,t+1]:[void 0,t]}function gy(t){var i,s;const e=[];let[n,r]=my(t);for(;Si(n);){switch(e.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=rt(y.words,r,[z.NUMBER,z.NUMBER]);e.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=rt(y.words,r,[z.DIR]);e.push(c.destpt.x,c.destpt.y),r=l;break}case"TO":{const[c,l,u]=rt(y.words,r,[z.DIR,z.DIR]),f=((i=y.element)==null?void 0:i.x)??0,d=((s=y.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,e.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[e,r]}const[o,a]=my(r);n=o,r=a}return e.length?[e,r]:[void 0,t]}function xI(t){return x(t)&&t<Rt.ONBLACK?t:void 0}function vI(t){return x(t)&&t>Rt.WHITE&&t<Rt.ONCLEAR?t-Rt.ONBLACK:void 0}const Ja={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function ri(t){return ce(t)&&yy(t[0])}function _y(t){return ri(t)&&t[0].startsWith("ON")}function yy(t){return x(Rt[t])&&wt(t)}function ad(t){if(wt(t))return Ja[It(t)]}function kI(t){return t.map(e=>Rt[e]).find(e=>x(e)&&e<Rt.ONBLACK)}function TI(t){return t.map(e=>Rt[e]).find(e=>x(e)&&e>=Rt.ONBLACK)}function AI(t){if(ri(t))return t;if(yy(t))return[t];const e=ad(t);if(x(e))return[e]}function by(t){const e=y.words[t],n=AI(e);return ri(n)?[n,t+1]:[void 0,t]}function cd(t){const e=[];let n=t;const[r,i]=by(t);if(ri(r)&&(e.push(...r),n=i),ri(e)&&!_y(e)){const[s,o]=by(i);_y(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function wy(t){const e={};return t.every(n=>{const r=Rt[n];x(r)&&(r<Rt.ONBLACK?e.color=r:e.bg=r-Rt.ONBLACK)}),e}function Do(t){return ce(t)&&typeof t[0]=="string"}function RI(t){const e=y.words[t];return wt(e)?[e,t+1]:[void 0,t]}function Ey(t){const e=y.words[t];if(Do(e))return[e,t+1];const[n,r]=cd(t),[i,s]=RI(r);return wt(i)?[[i,n],s]:[void 0,t]}function ld(t){if(!Do(t))return;const[e]=t;return e}function xy(t){if(!Do(t))return;const[,e]=t,n=x(e)?kI(e):void 0;return x(n)?n:void 0}function vy(t){if(!Do(t))return;const[,e]=t,n=x(e)?TI(e):void 0;return x(n)?n:void 0}var ud;try{ud=new TextDecoder}catch{}var gt,br,K=0,pe={},qt,ns,wr=0,ii=0,cn,Oi,Un=[],Vt,ky={useRecords:!1,mapsAsObjects:!0};class Ty{}const Ay=new Ty;Ay.name="MessagePack 0xC1";var rs=!1,Ry=2,Sy;try{new Function("")}catch{Ry=1/0}class Qa{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(gt)return jy(()=>(md(),this?this.unpack(e,n):Qa.prototype.unpack.call(ky,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof pn<"u"?pn.from(e):new Uint8Array(e)),typeof n=="object"?(br=n.end||e.length,K=n.start||0):(K=0,br=n>-1?n:e.length),ii=0,ns=null,cn=null,gt=e;try{Vt=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw gt=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof Qa){if(pe=this,this.structures)return qt=this.structures,Ul(n);(!qt||qt.length>0)&&(qt=[])}else pe=ky,(!qt||qt.length>0)&&(qt=[]);return Ul(n)}unpackMultiple(e,n){let r,i=0;try{rs=!0;let s=e.length,o=this?this.unpack(e,s):Fl.unpack(e,s);if(n){if(n(o,i,K)===!1)return;for(;K<s;)if(i=K,n(Ul(),i,K)===!1)return}else{for(r=[o];K<s;)i=K,r.push(Ul());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{rs=!1,md()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function Ul(t){try{if(!pe.trusted&&!rs){let n=qt.sharedLength||0;n<qt.length&&(qt.length=n)}let e;if(pe.randomAccessStructure&&gt[K]<64&&gt[K]>=32&&Sy?(e=Sy(gt,K,br,pe),gt=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),K=br):e=$e(),cn&&(K=cn.postBundlePosition,cn=null),rs&&(qt.restoreStructures=null),K==br)qt&&qt.restoreStructures&&Oy(),qt=null,gt=null,Oi&&(Oi=null);else{if(K>br)throw new Error("Unexpected end of MessagePack data");if(!rs){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw qt&&qt.restoreStructures&&Oy(),md(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||K>br)&&(e.incomplete=!0),e}}function Oy(){for(let t in qt.restoreStructures)qt[t]=qt.restoreStructures[t];qt.restoreStructures=null}function $e(){let t=gt[K++];if(t<160)if(t<128){if(t<64)return t;{let e=qt[t&63]||pe.getStructures&&Ny()[t&63];return e?(e.read||(e.read=hd(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,pe.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=By();r==="__proto__"&&(r="__proto_"),e[r]=$e()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set($e(),$e());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=$e();return pe.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(ii>=K)return ns.slice(K-wr,(K+=e)-wr);if(ii==0&&br<140){let n=e<16?dd(e):My(e);if(n!=null)return n}return fd(e)}else{let e;switch(t){case 192:return null;case 193:return cn?(e=$e(),e>0?cn[1].slice(cn.position1,cn.position1+=e):cn[0].slice(cn.position0,cn.position0-=e)):Ay;case 194:return!1;case 195:return!0;case 196:if(e=gt[K++],e===void 0)throw new Error("Unexpected end of buffer");return pd(e);case 197:return e=Vt.getUint16(K),K+=2,pd(e);case 198:return e=Vt.getUint32(K),K+=4,pd(e);case 199:return $s(gt[K++]);case 200:return e=Vt.getUint16(K),K+=2,$s(e);case 201:return e=Vt.getUint32(K),K+=4,$s(e);case 202:if(e=Vt.getFloat32(K),pe.useFloat32>2){let n=gd[(gt[K]&127)<<1|gt[K+1]>>7];return K+=4,(n*e+(e>0?.5:-.5)>>0)/n}return K+=4,e;case 203:return e=Vt.getFloat64(K),K+=8,e;case 204:return gt[K++];case 205:return e=Vt.getUint16(K),K+=2,e;case 206:return e=Vt.getUint32(K),K+=4,e;case 207:return pe.int64AsType==="number"?(e=Vt.getUint32(K)*4294967296,e+=Vt.getUint32(K+4)):pe.int64AsType==="string"?e=Vt.getBigUint64(K).toString():pe.int64AsType==="auto"?(e=Vt.getBigUint64(K),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Vt.getBigUint64(K),K+=8,e;case 208:return Vt.getInt8(K++);case 209:return e=Vt.getInt16(K),K+=2,e;case 210:return e=Vt.getInt32(K),K+=4,e;case 211:return pe.int64AsType==="number"?(e=Vt.getInt32(K)*4294967296,e+=Vt.getUint32(K+4)):pe.int64AsType==="string"?e=Vt.getBigInt64(K).toString():pe.int64AsType==="auto"?(e=Vt.getBigInt64(K),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Vt.getBigInt64(K),K+=8,e;case 212:if(e=gt[K++],e==114)return Dy(gt[K++]&63);{let n=Un[e];if(n)return n.read?(K++,n.read($e())):n.noBuffer?(K++,n()):n(gt.subarray(K,++K));throw new Error("Unknown extension "+e)}case 213:return e=gt[K],e==114?(K++,Dy(gt[K++]&63,gt[K++])):$s(2);case 214:return $s(4);case 215:return $s(8);case 216:return $s(16);case 217:return e=gt[K++],ii>=K?ns.slice(K-wr,(K+=e)-wr):OI(e);case 218:return e=Vt.getUint16(K),K+=2,ii>=K?ns.slice(K-wr,(K+=e)-wr):II(e);case 219:return e=Vt.getUint32(K),K+=4,ii>=K?ns.slice(K-wr,(K+=e)-wr):NI(e);case 220:return e=Vt.getUint16(K),K+=2,Cy(e);case 221:return e=Vt.getUint32(K),K+=4,Cy(e);case 222:return e=Vt.getUint16(K),K+=2,Ly(e);case 223:return e=Vt.getUint32(K),K+=4,Ly(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const SI=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function hd(t,e){function n(){if(n.count++>Ry){let i=t.read=new Function("r","return function(){return "+(pe.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":SI.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")($e);return t.highByte===0&&(t.read=Iy(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=$e()}return pe.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?Iy(e,n):n}const Iy=(t,e)=>function(){let n=gt[K++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=qt[r]||Ny()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=hd(i,t)),i.read()};function Ny(){let t=jy(()=>(gt=null,pe.getStructures()));return qt=pe._mergeStructures(t,qt)}var fd=tc,OI=tc,II=tc,NI=tc;function tc(t){let e;if(t<16&&(e=dd(t)))return e;if(t>64&&ud)return ud.decode(gt.subarray(K,K+=t));const n=K+t,r=[];for(e="";K<n;){const i=gt[K++];if(!(i&128))r.push(i);else if((i&224)===192){const s=gt[K++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=gt[K++]&63,o=gt[K++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=gt[K++]&63,o=gt[K++]&63,a=gt[K++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=ln.apply(String,r),r.length=0)}return r.length>0&&(e+=ln.apply(String,r)),e}function Cy(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=$e();return pe.freezeData?Object.freeze(e):e}function Ly(t){if(pe.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=By();r==="__proto__"&&(r="__proto_"),e[r]=$e()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set($e(),$e());return e}}var ln=String.fromCharCode;function My(t){let e=K,n=new Array(t);for(let r=0;r<t;r++){const i=gt[K++];if((i&128)>0){K=e;return}n[r]=i}return ln.apply(String,n)}function dd(t){if(t<4)if(t<2){if(t===0)return"";{let e=gt[K++];if((e&128)>1){K-=1;return}return ln(e)}}else{let e=gt[K++],n=gt[K++];if((e&128)>0||(n&128)>0){K-=2;return}if(t<3)return ln(e,n);let r=gt[K++];if((r&128)>0){K-=3;return}return ln(e,n,r)}else{let e=gt[K++],n=gt[K++],r=gt[K++],i=gt[K++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){K-=4;return}if(t<6){if(t===4)return ln(e,n,r,i);{let s=gt[K++];if((s&128)>0){K-=5;return}return ln(e,n,r,i,s)}}else if(t<8){let s=gt[K++],o=gt[K++];if((s&128)>0||(o&128)>0){K-=6;return}if(t<7)return ln(e,n,r,i,s,o);let a=gt[K++];if((a&128)>0){K-=7;return}return ln(e,n,r,i,s,o,a)}else{let s=gt[K++],o=gt[K++],a=gt[K++],c=gt[K++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){K-=8;return}if(t<10){if(t===8)return ln(e,n,r,i,s,o,a,c);{let l=gt[K++];if((l&128)>0){K-=9;return}return ln(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=gt[K++],u=gt[K++];if((l&128)>0||(u&128)>0){K-=10;return}if(t<11)return ln(e,n,r,i,s,o,a,c,l,u);let f=gt[K++];if((f&128)>0){K-=11;return}return ln(e,n,r,i,s,o,a,c,l,u,f)}else{let l=gt[K++],u=gt[K++],f=gt[K++],d=gt[K++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){K-=12;return}if(t<14){if(t===12)return ln(e,n,r,i,s,o,a,c,l,u,f,d);{let h=gt[K++];if((h&128)>0){K-=13;return}return ln(e,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=gt[K++],p=gt[K++];if((h&128)>0||(p&128)>0){K-=14;return}if(t<15)return ln(e,n,r,i,s,o,a,c,l,u,f,d,h,p);let m=gt[K++];if((m&128)>0){K-=15;return}return ln(e,n,r,i,s,o,a,c,l,u,f,d,h,p,m)}}}}}function Uy(){let t=gt[K++],e;if(t<192)e=t-160;else switch(t){case 217:e=gt[K++];break;case 218:e=Vt.getUint16(K),K+=2;break;case 219:e=Vt.getUint32(K),K+=4;break;default:throw new Error("Expected string")}return tc(e)}function pd(t){return pe.copyBuffers?Uint8Array.prototype.slice.call(gt,K,K+=t):gt.subarray(K,K+=t)}function $s(t){let e=gt[K++];if(Un[e]){let n;return Un[e](gt.subarray(K,n=K+=t),r=>{K=r;try{return $e()}finally{K=n}})}else throw new Error("Unknown extension type "+e)}var Fy=new Array(4096);function By(){let t=gt[K++];if(t>=160&&t<192){if(t=t-160,ii>=K)return ns.slice(K-wr,(K+=t)-wr);if(!(ii==0&&br<180))return fd(t)}else return K--,Py($e());let e=(t<<5^(t>1?Vt.getUint16(K):t>0?gt[K]:0))&4095,n=Fy[e],r=K,i=K+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Vt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=gt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return K=r,n.string;i-=3,r=K}for(n=[],Fy[e]=n,n.bytes=t;r<i;)s=Vt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=gt[r++],n.push(s);let a=t<16?dd(t):My(t);return a!=null?n.string=a:n.string=fd(t)}function Py(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const Dy=(t,e)=>{let n=$e().map(Py),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=qt[t];return i&&(i.isShared||rs)&&((qt.restoreStructures||(qt.restoreStructures=[]))[t]=i),qt[t]=n,n.read=hd(n,r),n.read()};Un[0]=()=>{},Un[0].noBuffer=!0,Un[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let CI={Error,TypeError,ReferenceError};Un[101]=()=>{let t=$e();return(CI[t[0]]||Error)(t[1],{cause:t[2]})},Un[105]=t=>{if(pe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Vt.getUint32(K-4);Oi||(Oi=new Map);let n=gt[K],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Oi.set(e,i);let s=$e();return i.used?Object.assign(r,s):(i.target=s,s)},Un[112]=t=>{if(pe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Vt.getUint32(K-4),n=Oi.get(e);return n.used=!0,n.target},Un[115]=()=>new Set($e());const $y=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let LI=typeof globalThis=="object"?globalThis:window;Un[116]=t=>{let e=t[0],n=$y[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new LI[n](Uint8Array.prototype.slice.call(t,1).buffer)},Un[120]=()=>{let t=$e();return new RegExp(t[0],t[1])};const MI=[];Un[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=K;return K+=e-t.length,cn=MI,cn=[Uy(),Uy()],cn.position0=0,cn.position1=0,cn.postBundlePosition=K,K=n,$e()},Un[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function jy(t){let e=br,n=K,r=wr,i=ii,s=ns,o=Oi,a=cn,c=new Uint8Array(gt.slice(0,br)),l=qt,u=qt.slice(0,qt.length),f=pe,d=rs,h=t();return br=e,K=n,wr=r,ii=i,ns=s,Oi=o,cn=a,gt=c,rs=d,qt=l,qt.splice(0,qt.length,...u),pe=f,Vt=new DataView(gt.buffer,gt.byteOffset,gt.byteLength),h}function md(){gt=null,Oi=null,qt=null}const gd=new Array(147);for(let t=0;t<256;t++)gd[t]=+("1e"+Math.floor(45.15-t*.30103));var Fl=new Qa({useRecords:!1});const UI=Fl.unpack;Fl.unpackMultiple,Fl.unpack;let FI=new Float32Array(1);new Uint8Array(FI.buffer,0,4);let Bl;try{Bl=new TextEncoder}catch{}let _d,zy;const Pl=typeof pn<"u",Dl=Pl?function(t){return pn.allocUnsafeSlow(t)}:Uint8Array,Ky=Pl?pn:Uint8Array,Wy=Pl?4294967296:2144337920;let X,ec,me,G=0,An,Ie=null,BI;const PI=21760,DI=/[\u0080-\uFFFF]/,$o=Symbol("record-id");class $I extends Qa{constructor(e){super(e),this.offset=0;let n,r,i,s,o=Ky.prototype.utf8Write?function(I,E){return X.utf8Write(I,E,X.byteLength-E)}:Bl&&Bl.encodeInto?function(I,E){return Bl.encodeInto(I,X.subarray(E)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let f=e.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,p=u+f+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],b=0,w=0;this.pack=this.encode=function(I,E){if(X||(X=new Dl(8192),me=X.dataView||(X.dataView=new DataView(X.buffer,0,8192)),G=0),An=X.length-10,An-G<2048?(X=new Dl(X.length),me=X.dataView||(X.dataView=new DataView(X.buffer,0,X.length)),An=X.length-10,G=0):G=G+7&2147483640,n=G,E&YI&&(G+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof I!="string"?(Ie=[],Ie.size=1/0):Ie=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let q=i.sharedLength||0;if(q>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let j=0;j<q;j++){let ot=i[j];if(!ot)continue;let tt,ft=i.transitions;for(let V=0,W=ot.length;V<W;V++){let bt=ot[V];tt=ft[bt],tt||(tt=ft[bt]=Object.create(null)),ft=tt}ft[$o]=j+64}this.lastNamedStructuresLength=q}c||(i.nextId=q+64)}r&&(r=!1);let D;try{a.randomAccessStructure&&I&&I.constructor&&I.constructor===Object?M(I):A(I);let q=Ie;if(Ie&&Yy(n,A,0),s&&s.idsToInsert){let j=s.idsToInsert.sort((V,W)=>V.offset>W.offset?1:-1),ot=j.length,tt=-1;for(;q&&ot>0;){let V=j[--ot].offset+n;V<q.stringsPosition+n&&tt===-1&&(tt=0),V>q.position+n?tt>=0&&(tt+=6):(tt>=0&&(me.setUint32(q.position+n,me.getUint32(q.position+n)+tt),tt=-1),q=q.previous,ot++)}tt>=0&&q&&me.setUint32(q.position+n,me.getUint32(q.position+n)+tt),G+=j.length*6,G>An&&N(G),a.offset=G;let ft=zI(X.subarray(n,G),j);return s=null,ft}return a.offset=G,E&HI?(X.start=n,X.end=G,X):X.subarray(n,G)}catch(q){throw D=q,q}finally{if(i&&(k(),r&&a.saveStructures)){let q=i.sharedLength||0,j=X.subarray(n,G),ot=KI(i,a);if(!D)return a.saveStructures(ot,ot.isCompatible)===!1?a.pack(I,E):(a.lastNamedStructuresLength=q,X.length>1073741824&&(X=null),j)}X.length>1073741824&&(X=null),E&GI&&(G=n)}};const k=()=>{w<10&&w++;let I=i.sharedLength||0;if(i.length>I&&!c&&(i.length=I),b>1e4)i.transitions=null,w=0,b=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let E=0,D=m.length;E<D;E++)m[E][$o]=0;m=[]}},T=I=>{var E=I.length;E<16?X[G++]=144|E:E<65536?(X[G++]=220,X[G++]=E>>8,X[G++]=E&255):(X[G++]=221,me.setUint32(G,E),G+=4);for(let D=0;D<E;D++)A(I[D])},A=I=>{G>An&&(X=N(G));var E=typeof I,D;if(E==="string"){let q=I.length;if(Ie&&q>=4&&q<4096){if((Ie.size+=q)>PI){let ft,V=(Ie[0]?Ie[0].length*3+Ie[1].length:0)+10;G+V>An&&(X=N(G+V));let W;Ie.position?(W=Ie,X[G]=200,G+=3,X[G++]=98,ft=G-n,G+=4,Yy(n,A,0),me.setUint16(ft+n-3,G-n-ft)):(X[G++]=214,X[G++]=98,ft=G-n,G+=4),Ie=["",""],Ie.previous=W,Ie.size=0,Ie.position=ft}let tt=DI.test(I);Ie[tt?0:1]+=I,X[G++]=193,A(tt?-q:q);return}let j;q<32?j=1:q<256?j=2:q<65536?j=3:j=5;let ot=q*3;if(G+ot>An&&(X=N(G+ot)),q<64||!o){let tt,ft,V,W=G+j;for(tt=0;tt<q;tt++)ft=I.charCodeAt(tt),ft<128?X[W++]=ft:ft<2048?(X[W++]=ft>>6|192,X[W++]=ft&63|128):(ft&64512)===55296&&((V=I.charCodeAt(tt+1))&64512)===56320?(ft=65536+((ft&1023)<<10)+(V&1023),tt++,X[W++]=ft>>18|240,X[W++]=ft>>12&63|128,X[W++]=ft>>6&63|128,X[W++]=ft&63|128):(X[W++]=ft>>12|224,X[W++]=ft>>6&63|128,X[W++]=ft&63|128);D=W-G-j}else D=o(I,G+j);D<32?X[G++]=160|D:D<256?(j<2&&X.copyWithin(G+2,G+1,G+1+D),X[G++]=217,X[G++]=D):D<65536?(j<3&&X.copyWithin(G+3,G+2,G+2+D),X[G++]=218,X[G++]=D>>8,X[G++]=D&255):(j<5&&X.copyWithin(G+5,G+3,G+3+D),X[G++]=219,me.setUint32(G,D),G+=4),G+=D}else if(E==="number")if(I>>>0===I)I<32||I<128&&this.useRecords===!1||I<64&&!this.randomAccessStructure?X[G++]=I:I<256?(X[G++]=204,X[G++]=I):I<65536?(X[G++]=205,X[G++]=I>>8,X[G++]=I&255):(X[G++]=206,me.setUint32(G,I),G+=4);else if(I>>0===I)I>=-32?X[G++]=256+I:I>=-128?(X[G++]=208,X[G++]=I+256):I>=-32768?(X[G++]=209,me.setInt16(G,I),G+=2):(X[G++]=210,me.setInt32(G,I),G+=4);else{let q;if((q=this.useFloat32)>0&&I<4294967296&&I>=-2147483648){X[G++]=202,me.setFloat32(G,I);let j;if(q<4||(j=I*gd[(X[G]&127)<<1|X[G+1]>>7])>>0===j){G+=4;return}else G--}X[G++]=203,me.setFloat64(G,I),G+=8}else if(E==="object"||E==="function")if(!I)X[G++]=192;else{if(s){let j=s.get(I);if(j){if(!j.id){let ot=s.idsToInsert||(s.idsToInsert=[]);j.id=ot.push(j)}X[G++]=214,X[G++]=112,me.setUint32(G,j.id),G+=4;return}else s.set(I,{offset:G-n})}let q=I.constructor;if(q===Object)F(I);else if(q===Array)T(I);else if(q===Map)if(this.mapAsEmptyObject)X[G++]=128;else{D=I.size,D<16?X[G++]=128|D:D<65536?(X[G++]=222,X[G++]=D>>8,X[G++]=D&255):(X[G++]=223,me.setUint32(G,D),G+=4);for(let[j,ot]of I)A(j),A(ot)}else{for(let j=0,ot=_d.length;j<ot;j++){let tt=zy[j];if(I instanceof tt){let ft=_d[j];if(ft.write){ft.type&&(X[G++]=212,X[G++]=ft.type,X[G++]=0);let lt=ft.write.call(this,I);lt===I?Array.isArray(I)?T(I):F(I):A(lt);return}let V=X,W=me,bt=G;X=null;let at;try{at=ft.pack.call(this,I,lt=>(X=V,V=null,G+=lt,G>An&&N(G),{target:X,targetView:me,position:G-lt}),A)}finally{V&&(X=V,me=W,G=bt,An=X.length-10)}at&&(at.length+G>An&&N(at.length+G),G=jI(at,X,G,ft.type));return}}if(Array.isArray(I))T(I);else{if(I.toJSON){const j=I.toJSON();if(j!==I)return A(j)}if(E==="function")return A(this.writeFunction&&this.writeFunction(I));F(I)}}}else if(E==="boolean")X[G++]=I?195:194;else if(E==="bigint"){if(I<BigInt(1)<<BigInt(63)&&I>=-(BigInt(1)<<BigInt(63)))X[G++]=211,me.setBigInt64(G,I);else if(I<BigInt(1)<<BigInt(64)&&I>0)X[G++]=207,me.setBigUint64(G,I);else if(this.largeBigIntToFloat)X[G++]=203,me.setFloat64(G,Number(I));else{if(this.largeBigIntToString)return A(I.toString());if(this.useBigIntExtension&&I<BigInt(2)**BigInt(1023)&&I>-(BigInt(2)**BigInt(1023))){X[G++]=199,G++,X[G++]=66;let q=[],j;do{let ot=I&BigInt(255);j=(ot&BigInt(128))===(I<BigInt(0)?BigInt(128):BigInt(0)),q.push(ot),I>>=BigInt(8)}while(!((I===BigInt(0)||I===BigInt(-1))&&j));X[G-2]=q.length;for(let ot=q.length;ot>0;)X[G++]=Number(q[--ot]);return}else throw new RangeError(I+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}G+=8}else if(E==="undefined")this.encodeUndefinedAsNil?X[G++]=192:(X[G++]=212,X[G++]=0,X[G++]=0);else throw new Error("Unknown type: "+E)},C=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?I=>{let E;if(this.skipValues){E=[];for(let j in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(j))&&!this.skipValues.includes(I[j])&&E.push(j)}else E=Object.keys(I);let D=E.length;D<16?X[G++]=128|D:D<65536?(X[G++]=222,X[G++]=D>>8,X[G++]=D&255):(X[G++]=223,me.setUint32(G,D),G+=4);let q;if(this.coercibleKeyAsNumber)for(let j=0;j<D;j++){q=E[j];let ot=Number(q);A(isNaN(ot)?q:ot),A(I[q])}else for(let j=0;j<D;j++)A(q=E[j]),A(I[q])}:I=>{X[G++]=222;let E=G-n;G+=2;let D=0;for(let q in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(q))&&(A(q),A(I[q]),D++);if(D>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');X[E+++n]=D>>8,X[E+n]=D&255},R=this.useRecords===!1?C:e.progressiveRecords&&!d?I=>{let E,D=i.transitions||(i.transitions=Object.create(null)),q=G++-n,j;for(let ot in I)if(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(ot)){if(E=D[ot],E)D=E;else{let tt=Object.keys(I),ft=D;D=i.transitions;let V=0;for(let W=0,bt=tt.length;W<bt;W++){let at=tt[W];E=D[at],E||(E=D[at]=Object.create(null),V++),D=E}q+n+1==G?(G--,P(D,tt,V)):H(D,tt,q,V),j=!0,D=ft[ot]}A(I[ot])}if(!j){let ot=D[$o];ot?X[q+n]=ot:H(D,Object.keys(I),q,0)}}:I=>{let E,D=i.transitions||(i.transitions=Object.create(null)),q=0;for(let ot in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(ot))&&(E=D[ot],E||(E=D[ot]=Object.create(null),q++),D=E);let j=D[$o];j?j>=96&&d?(X[G++]=((j-=96)&31)+96,X[G++]=j>>5):X[G++]=j:P(D,D.__keys__||Object.keys(I),q);for(let ot in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(ot))&&A(I[ot])},S=typeof this.useRecords=="function"&&this.useRecords,F=S?I=>{S(I)?R(I):C(I)}:R,N=I=>{let E;if(I>16777216){if(I-n>Wy)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(Wy,Math.round(Math.max((I-n)*(I>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(I-n<<2,X.length-1)>>12)+1<<12;let D=new Dl(E);return me=D.dataView||(D.dataView=new DataView(D.buffer,0,E)),I=Math.min(I,X.length),X.copy?X.copy(D,0,n,I):D.set(X.slice(n,I)),G-=n,n=0,An=D.length-10,X=D},P=(I,E,D)=>{let q=i.nextId;q||(q=64),q<h&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(q=i.nextOwnId,q<p||(q=h),i.nextOwnId=q+1):(q>=p&&(q=h),i.nextId=q+1);let j=E.highByte=q>=96&&d?q-96>>5:-1;I[$o]=q,I.__keys__=E,i[q-64]=E,q<h?(E.isShared=!0,i.sharedLength=q-63,r=!0,j>=0?(X[G++]=(q&31)+96,X[G++]=j):X[G++]=q):(j>=0?(X[G++]=213,X[G++]=114,X[G++]=(q&31)+96,X[G++]=j):(X[G++]=212,X[G++]=114,X[G++]=q),D&&(b+=w*D),m.length>=f&&(m.shift()[$o]=0),m.push(I),A(E))},H=(I,E,D,q)=>{let j=X,ot=G,tt=An,ft=n;X=ec,G=0,n=0,X||(ec=X=new Dl(8192)),An=X.length-10,P(I,E,q),ec=X;let V=G;if(X=j,G=ot,An=tt,n=ft,V>1){let W=G+V-1;W>An&&N(W);let bt=D+n;X.copyWithin(bt+V,bt+1,G),X.set(ec.slice(0,V),bt),G=W}else X[D+n]=ec[0]},M=I=>{let E=BI(I,X,n,G,i,N,(D,q,j)=>{if(j)return r=!0;G=q;let ot=X;return A(D),k(),ot!==X?{position:G,targetView:me,target:X}:G},this);if(E===0)return F(I);G=E}}useBuffer(e){X=e,X.dataView||(X.dataView=new DataView(X.buffer,X.byteOffset,X.byteLength)),G=0}set position(e){G=e}get position(){return G}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}zy=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Ty],_d=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?Hy(t,16,e):Gy(Pl?pn.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==Ky&&this.moreTypes?Hy(t,$y.indexOf(n.name),e):Gy(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function Hy(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function Gy(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function jI(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function zI(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function Yy(t,e,n){if(Ie.length>0){me.setUint32(Ie.position+t,G+n-Ie.position-t),Ie.stringsPosition=G-t;let r=Ie;Ie=null,e(r[0]),e(r[1])}}function KI(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let Vy=new $I({useRecords:!1});const WI=Vy.pack;Vy.pack;const HI=512,GI=1024,YI=2048,et=so("SOFTWARE");function Re(){return null}function jo(t,e,n={}){if(!x(t))return;const r=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=n[o];x(c)&&(a=c(a));const l=e[o];x(l)&&(o=l),a!==null&&r.push(o,a)}return r}function nc(t,e,n={}){if(x(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];x(a)&&(s=a);const c=n[s];x(c)&&(o=c(o)),r[s]=o}return r}catch(r){he(et,"","binary",r.message)}}function VI(t){try{const e=Zn(t);return WI(e)}catch(e){he(et,"","binary",e.message)}}function ZI(t){try{return UI(t)}catch(e){he(et,"","binary",e.message)}}function Zy(){return{id:Pe()}}var $l=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.destructible=16]="destructible",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.stopped=27]="stopped",t[t.removed=28]="removed",t[t.party=29]="party",t[t.group=30]="group",t))($l||{});function jl(t){return x(t==null?void 0:t.id)?jo(t,$l,{category:Re,kinddata:Re,stopped:Re,removed:Re,bucket:Re}):jo(t,$l,{id:Re,x:Re,y:Re,lx:Re,ly:Re,code:Re,category:Re,kinddata:Re,stopped:Re,removed:Re,bucket:Re})}function zl(t){return nc(t,$l)}function En(t){var e;return(((e=t==null?void 0:t.id)==null?void 0:e.length)??0)>0}function rc(t,e){if(!x(t)||!ri(e))return;const{color:n,bg:r}=wy(e);x(n)&&(t.color=n),x(r)&&(t.bg=r)}function is(t){var e;return It((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"")}const St=60,Jt=25,yd=St*Jt;var _t=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(_t||{});function XI(){return new Array(St*Jt).map(()=>{})}function bd(t=xh){const e={terrain:XI(),objects:{},id:""};return t(e)}var wd=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t[t.camera=12]="camera",t[t.graphics=13]="graphics",t))(wd||{});function qI(t){return jo(t,wd,{terrain:e=>e.map(jl),objects:e=>Object.values(e).filter(n=>!n.removed).map(jl),id:Re,named:Re,lookup:Re,codepage:Re,distmaps:Re,overboard:Re,underboard:Re})}function JI(t){return nc(t,wd,{terrain:e=>e.map(zl),objects:e=>{const n={};for(let r=0;r<e.length;++r){const i=zl(e[r]);x(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Kl(t){return Uo(t.x,t.y,0,St-1,Jt-1,0)}function Ur(t,e){return!x(t)||!x(e==null?void 0:e.x)||!x(e==null?void 0:e.y)||e.x<0||e.x>=St||e.y<0||e.y>=Jt?-1:e.x+e.y*St}function ge(t,e){const n=Ur(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=Rn(t,t.lookup[n]??"");return x(r)?r:t.terrain[n]}function QI(t,e){const n=Rn(t,e);if(x(n))return n;const r=parseFloat(e),i=lI(isNaN(r)?-1:r,St);return zo(t,i.x,i.y)}function zo(t,e,n){return(e>=0&&e<St)??(n>=0&&n<Jt)?t==null?void 0:t.terrain[e+n*St]:void 0}function un(t,e){if(!x(t)||!x(e)||!x(e.x)||!x(e.y)||e.x<0||e.x>=St||e.y<0||e.y>=Jt)return;const n=Zn(e),r=e.x+e.y*St;return t.terrain[r]=n,delete t.distmaps,t.terrain[r]}function Ed(t,e){if(!x(t)||!x(e))return;const n=Zn(e);return n.id=n.id??Pe(),t.objects[n.id]=n,t.objects[n.id]}function tN(t,e,n){return un(t,{...e,kind:n})}function xd(t,e,n,r){return Ed(t,{...e,kind:n,id:r})}function Rn(t,e){if(t)return t.objects[e]}function eN(t,e){const n=Ur(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=Rn(t,t.lookup[n]??"");if(x(r))return r}function Xy(t,e){return x(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function nN(t,e,n){if(!x(t)||!x(e))return;const r=t.objects[n];if(x(r))return r;if(Po(e))return Qy(e,sc(t,"player"))}function Ko(t,e){const n=t??zt.ISWALK,r=e??zt.ISWALK;switch(n){case zt.ISWALK:return r!==zt.ISWALK;case zt.ISSWIM:return r!==zt.ISSWIM;case zt.ISSOLID:return!0;case zt.ISBULLET:return r!==zt.ISWALK&&r!==zt.ISSWIM}}function ic(t,e,n){const r=t==null?void 0:t.objects[n];if(x(r))return r;const i=sc(t,"player");return x(e)?(e.x<0&&(e.x=yr(0,St-1)),e.y<0&&(e.y=yr(0,Jt-1)),Qy(e,i)):Ae(...i)}function sc(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(x)}function rN(t){const e=[];for(let n=0;n<Jt;++n)for(let r=0;r<St;++r){const i={x:r,y:n},s=ge(t,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&e.push(i)}return e}function qy(t,e){const n=ld(e),r=xy(e),i=vy(e);return sc(t,n??"").filter(s=>{var o,a,c;return!(x(n)&&It((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||x(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??Rt.WHITE)!==r||x(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Rt.BLACK)!==i)}).filter(x)}function Jy(t,e){return x(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(x(i))return i;const s=sc(t,It(n));if(s.length)return s}else if(Po(n)&&n.x>=0&&n.x<St&&n.y>=0&&n.y<Jt){const i=n.x+n.y*St,s=(r=t.lookup)==null?void 0:r[i];return x(s)?t.objects[s]:t.terrain[i]}}).flat().filter(x):[]}function Qy(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function tb(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}const vd=14,oc=3,Wl=8,Hl=14,Gl=16,iN=16,sN=16;var Yl=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(Yl||{});function Vl(t,e){return new Array(t).fill(e)}function oN(t,e,n,r,i=0){const s=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:Vl(s,0),color:Vl(s,0),bg:Vl(s,i)}}function aN(t,e,n,r=1,i=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:i,bg:Rt.ONCLEAR}}function cN(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function lN(t,e,n,r,i=0){const s=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:Vl(s,i)}}function uN(t,e,n,r){return{id:`media:${t}:${e}`,type:4,mime:n,media:r}}function hN(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:1.5,graphics:"flat",facing:0}}function eb(t,e){return`${t}:${e}`}const fN=1,dN=16,pN=256;var Sn=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Sn||{});function kd(t){const e=Math.floor(t.length/oc);if(e*oc!==t.length)return;const n=tb(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function mN(t,e){return t&1<<e?255:0}function nb(t){const e=Math.floor(t.length/vd);if(e*vd!==t.length)return;const n=Math.ceil(e/Gl),r=Wl*Gl,i=tb(r,Hl*n);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*Hl+a,u=t[c];for(let f=0;f<Wl;++f){const d=s*Wl+f;i.bits[d+l*r]=mN(u,7-f)}++a,a===Hl&&(a=0,++s,s===Gl&&(s=0,++o))}return i}const gN=cl("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),rb=cl("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var ib=typeof yo=="object"&&yo&&yo.Object===Object&&yo,_N=typeof self=="object"&&self&&self.Object===Object&&self,si=ib||_N||Function("return this")(),Er=si.Symbol,sb=Object.prototype,yN=sb.hasOwnProperty,bN=sb.toString,ac=Er?Er.toStringTag:void 0;function wN(t){var e=yN.call(t,ac),n=t[ac];try{t[ac]=void 0;var r=!0}catch{}var i=bN.call(t);return r&&(e?t[ac]=n:delete t[ac]),i}var EN=Object.prototype,xN=EN.toString;function vN(t){return xN.call(t)}var kN="[object Null]",TN="[object Undefined]",ob=Er?Er.toStringTag:void 0;function ss(t){return t==null?t===void 0?TN:kN:ob&&ob in Object(t)?wN(t):vN(t)}function Fr(t){return t!=null&&typeof t=="object"}var AN="[object Symbol]";function Zl(t){return typeof t=="symbol"||Fr(t)&&ss(t)==AN}function Xl(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var ee=Array.isArray,RN=1/0,ab=Er?Er.prototype:void 0,cb=ab?ab.toString:void 0;function lb(t){if(typeof t=="string")return t;if(ee(t))return Xl(t,lb)+"";if(Zl(t))return cb?cb.call(t):"";var e=t+"";return e=="0"&&1/t==-RN?"-0":e}var SN=/\s/;function ON(t){for(var e=t.length;e--&&SN.test(t.charAt(e)););return e}var IN=/^\s+/;function NN(t){return t&&t.slice(0,ON(t)+1).replace(IN,"")}function xr(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var ub=NaN,CN=/^[-+]0x[0-9a-f]+$/i,LN=/^0b[01]+$/i,MN=/^0o[0-7]+$/i,UN=parseInt;function FN(t){if(typeof t=="number")return t;if(Zl(t))return ub;if(xr(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=xr(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=NN(t);var n=LN.test(t);return n||MN.test(t)?UN(t.slice(2),n?2:8):CN.test(t)?ub:+t}var hb=1/0,BN=17976931348623157e292;function PN(t){if(!t)return t===0?t:0;if(t=FN(t),t===hb||t===-hb){var e=t<0?-1:1;return e*BN}return t===t?t:0}function ql(t){var e=PN(t),n=e%1;return e===e?n?e-n:e:0}function Wo(t){return t}var DN="[object AsyncFunction]",$N="[object Function]",jN="[object GeneratorFunction]",zN="[object Proxy]";function Ii(t){if(!xr(t))return!1;var e=ss(t);return e==$N||e==jN||e==DN||e==zN}var Td=si["__core-js_shared__"],fb=function(){var t=/[^.]+$/.exec(Td&&Td.keys&&Td.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function KN(t){return!!fb&&fb in t}var WN=Function.prototype,HN=WN.toString;function js(t){if(t!=null){try{return HN.call(t)}catch{}try{return t+""}catch{}}return""}var GN=/[\\^$.*+?()[\]{}|]/g,YN=/^\[object .+?Constructor\]$/,VN=Function.prototype,ZN=Object.prototype,XN=VN.toString,qN=ZN.hasOwnProperty,JN=RegExp("^"+XN.call(qN).replace(GN,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function QN(t){if(!xr(t)||KN(t))return!1;var e=Ii(t)?JN:YN;return e.test(js(t))}function tC(t,e){return t==null?void 0:t[e]}function zs(t,e){var n=tC(t,e);return QN(n)?n:void 0}var Ad=zs(si,"WeakMap"),db=Object.create,eC=function(){function t(){}return function(e){if(!xr(e))return{};if(db)return db(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function nC(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Je(){}function rC(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var iC=800,sC=16,oC=Date.now;function aC(t){var e=0,n=0;return function(){var r=oC(),i=sC-(r-n);if(n=r,i>0){if(++e>=iC)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function cC(t){return function(){return t}}var Jl=function(){try{var t=zs(Object,"defineProperty");return t({},"",{}),t}catch{}}(),lC=Jl?function(t,e){return Jl(t,"toString",{configurable:!0,enumerable:!1,value:cC(e),writable:!0})}:Wo,uC=aC(lC);function pb(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function mb(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function hC(t){return t!==t}function fC(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function Rd(t,e,n){return e===e?fC(t,e,n):mb(t,hC,n)}function gb(t,e){var n=t==null?0:t.length;return!!n&&Rd(t,e,0)>-1}var dC=9007199254740991,pC=/^(?:0|[1-9]\d*)$/;function Ql(t,e){var n=typeof t;return e=e??dC,!!e&&(n=="number"||n!="symbol"&&pC.test(t))&&t>-1&&t%1==0&&t<e}function Sd(t,e,n){e=="__proto__"&&Jl?Jl(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function cc(t,e){return t===e||t!==t&&e!==e}var mC=Object.prototype,gC=mC.hasOwnProperty;function tu(t,e,n){var r=t[e];(!(gC.call(t,e)&&cc(r,n))||n===void 0&&!(e in t))&&Sd(t,e,n)}function Od(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?Sd(n,a,c):tu(n,a,c)}return n}var _b=Math.max;function _C(t,e,n){return e=_b(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=_b(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),nC(t,this,a)}}function Id(t,e){return uC(_C(t,e,Wo),t+"")}var yC=9007199254740991;function Nd(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=yC}function oi(t){return t!=null&&Nd(t.length)&&!Ii(t)}function yb(t,e,n){if(!xr(n))return!1;var r=typeof e;return(r=="number"?oi(n)&&Ql(e,n.length):r=="string"&&e in n)?cc(n[e],t):!1}function bC(t){return Id(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&yb(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var wC=Object.prototype;function lc(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||wC;return t===n}function EC(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var xC="[object Arguments]";function bb(t){return Fr(t)&&ss(t)==xC}var wb=Object.prototype,vC=wb.hasOwnProperty,kC=wb.propertyIsEnumerable,eu=bb(function(){return arguments}())?bb:function(t){return Fr(t)&&vC.call(t,"callee")&&!kC.call(t,"callee")};function TC(){return!1}var Eb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,xb=Eb&&typeof module=="object"&&module&&!module.nodeType&&module,AC=xb&&xb.exports===Eb,vb=AC?si.Buffer:void 0,RC=vb?vb.isBuffer:void 0,uc=RC||TC,SC="[object Arguments]",OC="[object Array]",IC="[object Boolean]",NC="[object Date]",CC="[object Error]",LC="[object Function]",MC="[object Map]",UC="[object Number]",FC="[object Object]",BC="[object RegExp]",PC="[object Set]",DC="[object String]",$C="[object WeakMap]",jC="[object ArrayBuffer]",zC="[object DataView]",KC="[object Float32Array]",WC="[object Float64Array]",HC="[object Int8Array]",GC="[object Int16Array]",YC="[object Int32Array]",VC="[object Uint8Array]",ZC="[object Uint8ClampedArray]",XC="[object Uint16Array]",qC="[object Uint32Array]",xe={};xe[KC]=xe[WC]=xe[HC]=xe[GC]=xe[YC]=xe[VC]=xe[ZC]=xe[XC]=xe[qC]=!0,xe[SC]=xe[OC]=xe[jC]=xe[IC]=xe[zC]=xe[NC]=xe[CC]=xe[LC]=xe[MC]=xe[UC]=xe[FC]=xe[BC]=xe[PC]=xe[DC]=xe[$C]=!1;function JC(t){return Fr(t)&&Nd(t.length)&&!!xe[ss(t)]}function nu(t){return function(e){return t(e)}}var kb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,hc=kb&&typeof module=="object"&&module&&!module.nodeType&&module,QC=hc&&hc.exports===kb,Cd=QC&&ib.process,os=function(){try{var t=hc&&hc.require&&hc.require("util").types;return t||Cd&&Cd.binding&&Cd.binding("util")}catch{}}(),Tb=os&&os.isTypedArray,Ld=Tb?nu(Tb):JC,t6=Object.prototype,e6=t6.hasOwnProperty;function Ab(t,e){var n=ee(t),r=!n&&eu(t),i=!n&&!r&&uc(t),s=!n&&!r&&!i&&Ld(t),o=n||r||i||s,a=o?EC(t.length,String):[],c=a.length;for(var l in t)(e||e6.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Ql(l,c)))&&a.push(l);return a}function Rb(t,e){return function(n){return t(e(n))}}var n6=Rb(Object.keys,Object),r6=Object.prototype,i6=r6.hasOwnProperty;function Sb(t){if(!lc(t))return n6(t);var e=[];for(var n in Object(t))i6.call(t,n)&&n!="constructor"&&e.push(n);return e}function vr(t){return oi(t)?Ab(t):Sb(t)}var s6=Object.prototype,o6=s6.hasOwnProperty,Fn=bC(function(t,e){if(lc(e)||oi(e)){Od(e,vr(e),t);return}for(var n in e)o6.call(e,n)&&tu(t,n,e[n])});function a6(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var c6=Object.prototype,l6=c6.hasOwnProperty;function u6(t){if(!xr(t))return a6(t);var e=lc(t),n=[];for(var r in t)r=="constructor"&&(e||!l6.call(t,r))||n.push(r);return n}function Ob(t){return oi(t)?Ab(t,!0):u6(t)}var h6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,f6=/^\w*$/;function Md(t,e){if(ee(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Zl(t)?!0:f6.test(t)||!h6.test(t)||e!=null&&t in Object(e)}var fc=zs(Object,"create");function d6(){this.__data__=fc?fc(null):{},this.size=0}function p6(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var m6="__lodash_hash_undefined__",g6=Object.prototype,_6=g6.hasOwnProperty;function y6(t){var e=this.__data__;if(fc){var n=e[t];return n===m6?void 0:n}return _6.call(e,t)?e[t]:void 0}var b6=Object.prototype,w6=b6.hasOwnProperty;function E6(t){var e=this.__data__;return fc?e[t]!==void 0:w6.call(e,t)}var x6="__lodash_hash_undefined__";function v6(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=fc&&e===void 0?x6:e,this}function Ks(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ks.prototype.clear=d6,Ks.prototype.delete=p6,Ks.prototype.get=y6,Ks.prototype.has=E6,Ks.prototype.set=v6;function k6(){this.__data__=[],this.size=0}function ru(t,e){for(var n=t.length;n--;)if(cc(t[n][0],e))return n;return-1}var T6=Array.prototype,A6=T6.splice;function R6(t){var e=this.__data__,n=ru(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():A6.call(e,n,1),--this.size,!0}function S6(t){var e=this.__data__,n=ru(e,t);return n<0?void 0:e[n][1]}function O6(t){return ru(this.__data__,t)>-1}function I6(t,e){var n=this.__data__,r=ru(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Ni(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ni.prototype.clear=k6,Ni.prototype.delete=R6,Ni.prototype.get=S6,Ni.prototype.has=O6,Ni.prototype.set=I6;var dc=zs(si,"Map");function N6(){this.size=0,this.__data__={hash:new Ks,map:new(dc||Ni),string:new Ks}}function C6(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function iu(t,e){var n=t.__data__;return C6(e)?n[typeof e=="string"?"string":"hash"]:n.map}function L6(t){var e=iu(this,t).delete(t);return this.size-=e?1:0,e}function M6(t){return iu(this,t).get(t)}function U6(t){return iu(this,t).has(t)}function F6(t,e){var n=iu(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Ci(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ci.prototype.clear=N6,Ci.prototype.delete=L6,Ci.prototype.get=M6,Ci.prototype.has=U6,Ci.prototype.set=F6;var B6="Expected a function";function Ud(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(B6);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Ud.Cache||Ci),n}Ud.Cache=Ci;var P6=500;function D6(t){var e=Ud(t,function(r){return n.size===P6&&n.clear(),r}),n=e.cache;return e}var $6=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,j6=/\\(\\)?/g,z6=D6(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace($6,function(n,r,i,s){e.push(i?s.replace(j6,"$1"):r||n)}),e});function Ib(t){return t==null?"":lb(t)}function su(t,e){return ee(t)?t:Md(t,e)?[t]:z6(Ib(t))}var K6=1/0;function pc(t){if(typeof t=="string"||Zl(t))return t;var e=t+"";return e=="0"&&1/t==-K6?"-0":e}function Fd(t,e){e=su(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[pc(e[n++])];return n&&n==r?t:void 0}function W6(t,e,n){var r=t==null?void 0:Fd(t,e);return r===void 0?n:r}function Bd(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Nb=Er?Er.isConcatSpreadable:void 0;function H6(t){return ee(t)||eu(t)||!!(Nb&&t&&t[Nb])}function Pd(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=H6),i||(i=[]);++s<o;){var a=t[s];n(a)?Bd(i,a):r||(i[i.length]=a)}return i}function rr(t){var e=t==null?0:t.length;return e?Pd(t):[]}var Cb=Rb(Object.getPrototypeOf,Object);function Dd(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function G6(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:Dd(t,e,n)}var Y6="\\ud800-\\udfff",V6="\\u0300-\\u036f",Z6="\\ufe20-\\ufe2f",X6="\\u20d0-\\u20ff",q6=V6+Z6+X6,J6="\\ufe0e\\ufe0f",Q6="\\u200d",tL=RegExp("["+Q6+Y6+q6+J6+"]");function Lb(t){return tL.test(t)}function eL(t){return t.split("")}var Mb="\\ud800-\\udfff",nL="\\u0300-\\u036f",rL="\\ufe20-\\ufe2f",iL="\\u20d0-\\u20ff",sL=nL+rL+iL,oL="\\ufe0e\\ufe0f",aL="["+Mb+"]",$d="["+sL+"]",jd="\\ud83c[\\udffb-\\udfff]",cL="(?:"+$d+"|"+jd+")",Ub="[^"+Mb+"]",Fb="(?:\\ud83c[\\udde6-\\uddff]){2}",Bb="[\\ud800-\\udbff][\\udc00-\\udfff]",lL="\\u200d",Pb=cL+"?",Db="["+oL+"]?",uL="(?:"+lL+"(?:"+[Ub,Fb,Bb].join("|")+")"+Db+Pb+")*",hL=Db+Pb+uL,fL="(?:"+[Ub+$d+"?",$d,Fb,Bb,aL].join("|")+")",dL=RegExp(jd+"(?="+jd+")|"+fL+hL,"g");function pL(t){return t.match(dL)||[]}function mL(t){return Lb(t)?pL(t):eL(t)}function gL(t){return function(e){e=Ib(e);var n=Lb(e)?mL(e):void 0,r=n?n[0]:e.charAt(0),i=n?G6(n,1).join(""):e.slice(1);return r[t]()+i}}var $b=gL("toUpperCase");function _L(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function yL(){this.__data__=new Ni,this.size=0}function bL(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function wL(t){return this.__data__.get(t)}function EL(t){return this.__data__.has(t)}var xL=200;function vL(t,e){var n=this.__data__;if(n instanceof Ni){var r=n.__data__;if(!dc||r.length<xL-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ci(r)}return n.set(t,e),this.size=n.size,this}function ai(t){var e=this.__data__=new Ni(t);this.size=e.size}ai.prototype.clear=yL,ai.prototype.delete=bL,ai.prototype.get=wL,ai.prototype.has=EL,ai.prototype.set=vL;function kL(t,e){return t&&Od(e,vr(e),t)}var jb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zb=jb&&typeof module=="object"&&module&&!module.nodeType&&module,TL=zb&&zb.exports===jb,Kb=TL?si.Buffer:void 0,Wb=Kb?Kb.allocUnsafe:void 0;function AL(t,e){var n=t.length,r=Wb?Wb(n):new t.constructor(n);return t.copy(r),r}function zd(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Hb(){return[]}var RL=Object.prototype,SL=RL.propertyIsEnumerable,Gb=Object.getOwnPropertySymbols,Kd=Gb?function(t){return t==null?[]:(t=Object(t),zd(Gb(t),function(e){return SL.call(t,e)}))}:Hb;function OL(t,e){return Od(t,Kd(t),e)}var IL=Object.getOwnPropertySymbols,NL=IL?function(t){for(var e=[];t;)Bd(e,Kd(t)),t=Cb(t);return e}:Hb;function Yb(t,e,n){var r=e(t);return ee(t)?r:Bd(r,n(t))}function Wd(t){return Yb(t,vr,Kd)}function CL(t){return Yb(t,Ob,NL)}var Hd=zs(si,"DataView"),Gd=zs(si,"Promise"),Ho=zs(si,"Set"),Vb="[object Map]",LL="[object Object]",Zb="[object Promise]",Xb="[object Set]",qb="[object WeakMap]",Jb="[object DataView]",ML=js(Hd),UL=js(dc),FL=js(Gd),BL=js(Ho),PL=js(Ad),kr=ss;(Hd&&kr(new Hd(new ArrayBuffer(1)))!=Jb||dc&&kr(new dc)!=Vb||Gd&&kr(Gd.resolve())!=Zb||Ho&&kr(new Ho)!=Xb||Ad&&kr(new Ad)!=qb)&&(kr=function(t){var e=ss(t),n=e==LL?t.constructor:void 0,r=n?js(n):"";if(r)switch(r){case ML:return Jb;case UL:return Vb;case FL:return Zb;case BL:return Xb;case PL:return qb}return e});var DL=Object.prototype,$L=DL.hasOwnProperty;function jL(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&$L.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var ou=si.Uint8Array;function zL(t){var e=new t.constructor(t.byteLength);return new ou(e).set(new ou(t)),e}function KL(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var WL=/\w*$/;function HL(t){var e=new t.constructor(t.source,WL.exec(t));return e.lastIndex=t.lastIndex,e}var Qb=Er?Er.prototype:void 0,t1=Qb?Qb.valueOf:void 0;function GL(t){return t1?Object(t1.call(t)):{}}function YL(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var VL="[object Boolean]",ZL="[object Date]",XL="[object Map]",qL="[object Number]",JL="[object RegExp]",QL="[object Set]",t2="[object String]",e2="[object Symbol]",n2="[object ArrayBuffer]",r2="[object DataView]",i2="[object Float32Array]",s2="[object Float64Array]",o2="[object Int8Array]",a2="[object Int16Array]",c2="[object Int32Array]",l2="[object Uint8Array]",u2="[object Uint8ClampedArray]",h2="[object Uint16Array]",f2="[object Uint32Array]";function d2(t,e,n){var r=t.constructor;switch(e){case n2:return zL(t);case VL:case ZL:return new r(+t);case r2:return KL(t);case i2:case s2:case o2:case a2:case c2:case l2:case u2:case h2:case f2:return YL(t);case XL:return new r;case qL:case t2:return new r(t);case JL:return HL(t);case QL:return new r;case e2:return GL(t)}}function p2(t){return typeof t.constructor=="function"&&!lc(t)?eC(Cb(t)):{}}var m2="[object Map]";function g2(t){return Fr(t)&&kr(t)==m2}var e1=os&&os.isMap,_2=e1?nu(e1):g2,y2="[object Set]";function b2(t){return Fr(t)&&kr(t)==y2}var n1=os&&os.isSet,w2=n1?nu(n1):b2,r1="[object Arguments]",E2="[object Array]",x2="[object Boolean]",v2="[object Date]",k2="[object Error]",i1="[object Function]",T2="[object GeneratorFunction]",A2="[object Map]",R2="[object Number]",s1="[object Object]",S2="[object RegExp]",O2="[object Set]",I2="[object String]",N2="[object Symbol]",C2="[object WeakMap]",L2="[object ArrayBuffer]",M2="[object DataView]",U2="[object Float32Array]",F2="[object Float64Array]",B2="[object Int8Array]",P2="[object Int16Array]",D2="[object Int32Array]",$2="[object Uint8Array]",j2="[object Uint8ClampedArray]",z2="[object Uint16Array]",K2="[object Uint32Array]",_e={};_e[r1]=_e[E2]=_e[L2]=_e[M2]=_e[x2]=_e[v2]=_e[U2]=_e[F2]=_e[B2]=_e[P2]=_e[D2]=_e[A2]=_e[R2]=_e[s1]=_e[S2]=_e[O2]=_e[I2]=_e[N2]=_e[$2]=_e[j2]=_e[z2]=_e[K2]=!0,_e[k2]=_e[i1]=_e[C2]=!1;function au(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!xr(t))return t;var a=ee(t);if(a)return o=jL(t),rC(t,o);var c=kr(t),l=c==i1||c==T2;if(uc(t))return AL(t);if(c==s1||c==r1||l&&!i)return o=l?{}:p2(t),OL(t,kL(o,t));if(!_e[c])return i?t:{};o=d2(t,c),s||(s=new ai);var u=s.get(t);if(u)return u;s.set(t,o),w2(t)?t.forEach(function(h){o.add(au(h,e,n,h,t,s))}):_2(t)&&t.forEach(function(h,p){o.set(p,au(h,e,n,p,t,s))});var f=Wd,d=a?void 0:f(t);return pb(d||t,function(h,p){d&&(p=h,h=t[p]),tu(o,p,au(h,e,n,p,t,s))}),o}var W2=4;function gn(t){return au(t,W2)}function mc(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var H2="__lodash_hash_undefined__";function G2(t){return this.__data__.set(t,H2),this}function Y2(t){return this.__data__.has(t)}function Go(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ci;++e<n;)this.add(t[e])}Go.prototype.add=Go.prototype.push=G2,Go.prototype.has=Y2;function o1(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Yd(t,e){return t.has(e)}var V2=1,Z2=2;function a1(t,e,n,r,i,s){var o=n&V2,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var f=-1,d=!0,h=n&Z2?new Go:void 0;for(s.set(t,e),s.set(e,t);++f<a;){var p=t[f],m=e[f];if(r)var b=o?r(m,p,f,e,t,s):r(p,m,f,t,e,s);if(b!==void 0){if(b)continue;d=!1;break}if(h){if(!o1(e,function(w,k){if(!Yd(h,k)&&(p===w||i(p,w,n,r,s)))return h.push(k)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function X2(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function Vd(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var q2=1,J2=2,Q2="[object Boolean]",tM="[object Date]",eM="[object Error]",nM="[object Map]",rM="[object Number]",iM="[object RegExp]",sM="[object Set]",oM="[object String]",aM="[object Symbol]",cM="[object ArrayBuffer]",lM="[object DataView]",c1=Er?Er.prototype:void 0,Zd=c1?c1.valueOf:void 0;function uM(t,e,n,r,i,s,o){switch(n){case lM:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case cM:return!(t.byteLength!=e.byteLength||!s(new ou(t),new ou(e)));case Q2:case tM:case rM:return cc(+t,+e);case eM:return t.name==e.name&&t.message==e.message;case iM:case oM:return t==e+"";case nM:var a=X2;case sM:var c=r&q2;if(a||(a=Vd),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=J2,o.set(t,e);var u=a1(a(t),a(e),r,i,s,o);return o.delete(t),u;case aM:if(Zd)return Zd.call(t)==Zd.call(e)}return!1}var hM=1,fM=Object.prototype,dM=fM.hasOwnProperty;function pM(t,e,n,r,i,s){var o=n&hM,a=Wd(t),c=a.length,l=Wd(e),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in e:dM.call(e,d)))return!1}var h=s.get(t),p=s.get(e);if(h&&p)return h==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var b=o;++f<c;){d=a[f];var w=t[d],k=e[d];if(r)var T=o?r(k,w,d,e,t,s):r(w,k,d,t,e,s);if(!(T===void 0?w===k||i(w,k,n,r,s):T)){m=!1;break}b||(b=d=="constructor")}if(m&&!b){var A=t.constructor,C=e.constructor;A!=C&&"constructor"in t&&"constructor"in e&&!(typeof A=="function"&&A instanceof A&&typeof C=="function"&&C instanceof C)&&(m=!1)}return s.delete(t),s.delete(e),m}var mM=1,l1="[object Arguments]",u1="[object Array]",cu="[object Object]",gM=Object.prototype,h1=gM.hasOwnProperty;function _M(t,e,n,r,i,s){var o=ee(t),a=ee(e),c=o?u1:kr(t),l=a?u1:kr(e);c=c==l1?cu:c,l=l==l1?cu:l;var u=c==cu,f=l==cu,d=c==l;if(d&&uc(t)){if(!uc(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ai),o||Ld(t)?a1(t,e,n,r,i,s):uM(t,e,c,n,r,i,s);if(!(n&mM)){var h=u&&h1.call(t,"__wrapped__"),p=f&&h1.call(e,"__wrapped__");if(h||p){var m=h?t.value():t,b=p?e.value():e;return s||(s=new ai),i(m,b,n,r,s)}}return d?(s||(s=new ai),pM(t,e,n,r,i,s)):!1}function Xd(t,e,n,r,i){return t===e?!0:t==null||e==null||!Fr(t)&&!Fr(e)?t!==t&&e!==e:_M(t,e,n,r,Xd,i)}var yM=1,bM=2;function wM(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new ai,f;if(!(f===void 0?Xd(l,c,yM|bM,r,u):f))return!1}}return!0}function f1(t){return t===t&&!xr(t)}function EM(t){for(var e=vr(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,f1(i)]}return e}function d1(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function xM(t){var e=EM(t);return e.length==1&&e[0][2]?d1(e[0][0],e[0][1]):function(n){return n===t||wM(n,t,e)}}function vM(t,e){return t!=null&&e in Object(t)}function p1(t,e,n){e=su(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=pc(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&Nd(i)&&Ql(o,i)&&(ee(t)||eu(t)))}function kM(t,e){return t!=null&&p1(t,e,vM)}var TM=1,AM=2;function RM(t,e){return Md(t)&&f1(e)?d1(pc(t),e):function(n){var r=W6(n,t);return r===void 0&&r===e?kM(n,t):Xd(e,r,TM|AM)}}function SM(t){return function(e){return e==null?void 0:e[t]}}function OM(t){return function(e){return Fd(e,t)}}function IM(t){return Md(t)?SM(pc(t)):OM(t)}function ci(t){return typeof t=="function"?t:t==null?Wo:typeof t=="object"?ee(t)?RM(t[0],t[1]):xM(t):IM(t)}function NM(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function CM(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var LM=CM();function MM(t,e){return t&&LM(t,e,vr)}function UM(t,e){return function(n,r){if(n==null)return n;if(!oi(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var Ws=UM(MM);function FM(t,e,n,r){return Ws(t,function(i,s,o){e(r,i,n(i),o)}),r}function BM(t,e){return function(n,r){var i=ee(n)?NM:FM,s=e?e():{};return i(n,t,ci(r),s)}}var m1=Object.prototype,PM=m1.hasOwnProperty,qd=Id(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&yb(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=Ob(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||cc(u,m1[l])&&!PM.call(t,l))&&(t[l]=s[l])}return t});function g1(t){return Fr(t)&&oi(t)}var DM=200;function $M(t,e,n,r){var i=-1,s=gb,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=DM&&(s=Yd,o=!1,e=new Go(e));t:for(;++i<a;){var u=t[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(e[d]===f)continue t;c.push(u)}else s(e,f,r)||c.push(u)}return c}var lu=Id(function(t,e){return g1(t)?$M(t,Pd(e,1,g1,!0)):[]});function Yo(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function _n(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ql(e),Dd(t,e<0?0:e,r)):[]}function gc(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ql(e),e=r-e,Dd(t,0,e<0?0:e)):[]}function jM(t){return typeof t=="function"?t:Wo}function Nt(t,e){var n=ee(t)?pb:Ws;return n(t,jM(e))}function zM(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function KM(t,e){var n=!0;return Ws(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function Br(t,e,n){var r=ee(t)?zM:KM;return r(t,ci(e))}function _1(t,e){var n=[];return Ws(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function Tr(t,e){var n=ee(t)?zd:_1;return n(t,ci(e))}function WM(t){return function(e,n,r){var i=Object(e);if(!oi(e)){var s=ci(n);e=vr(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var HM=Math.max;function GM(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:ql(n);return i<0&&(i=HM(r+i,0)),mb(t,ci(e),i)}var Vo=WM(GM);function Pr(t){return t&&t.length?t[0]:void 0}function YM(t,e){var n=-1,r=oi(t)?Array(t.length):[];return Ws(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function xt(t,e){var n=ee(t)?Xl:YM;return n(t,ci(e))}function Ar(t,e){return Pd(xt(t,e))}var VM=Object.prototype,ZM=VM.hasOwnProperty,y1=BM(function(t,e,n){ZM.call(t,n)?t[n].push(e):Sd(t,n,[e])}),XM=Object.prototype,qM=XM.hasOwnProperty;function JM(t,e){return t!=null&&qM.call(t,e)}function Ot(t,e){return t!=null&&p1(t,e,JM)}var QM="[object String]";function Bn(t){return typeof t=="string"||!ee(t)&&Fr(t)&&ss(t)==QM}function t8(t,e){return Xl(e,function(n){return t[n]})}function Ke(t){return t==null?[]:t8(t,vr(t))}var e8=Math.max;function On(t,e,n,r){t=oi(t)?t:Ke(t),n=n&&!r?ql(n):0;var i=t.length;return n<0&&(n=e8(i+n,0)),Bn(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Rd(t,e,n)>-1}function b1(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return Rd(t,e,i)}var n8="[object Map]",r8="[object Set]",i8=Object.prototype,s8=i8.hasOwnProperty;function ye(t){if(t==null)return!0;if(oi(t)&&(ee(t)||typeof t=="string"||typeof t.splice=="function"||uc(t)||Ld(t)||eu(t)))return!t.length;var e=kr(t);if(e==n8||e==r8)return!t.size;if(lc(t))return!Sb(t).length;for(var n in t)if(s8.call(t,n))return!1;return!0}var o8="[object RegExp]";function a8(t){return Fr(t)&&ss(t)==o8}var w1=os&&os.isRegExp,Li=w1?nu(w1):a8;function Mi(t){return t===void 0}var c8="Expected a function";function l8(t){if(typeof t!="function")throw new TypeError(c8);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function u8(t,e,n,r){if(!xr(t))return t;e=su(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=pc(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=xr(u)?u:Ql(e[i+1])?[]:{})}tu(a,c,l),a=a[c]}return t}function h8(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Fd(t,o);n(a,o)&&u8(s,su(o,t),a)}return s}function Dr(t,e){if(t==null)return{};var n=Xl(CL(t),function(r){return[r]});return e=ci(e),h8(t,n,function(r,i){return e(r,i[0])})}function f8(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function Pn(t,e,n){var r=ee(t)?_L:f8,i=arguments.length<3;return r(t,ci(e),n,i,Ws)}function uu(t,e){var n=ee(t)?zd:_1;return n(t,l8(ci(e)))}function d8(t,e){var n;return Ws(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function Jd(t,e,n){var r=ee(t)?o1:d8;return r(t,ci(e))}var p8=1/0,m8=Ho&&1/Vd(new Ho([,-0]))[1]==p8?function(t){return new Ho(t)}:Je,g8=200;function _8(t,e,n){var r=-1,i=gb,s=t.length,o=!0,a=[],c=a;if(s>=g8){var l=m8(t);if(l)return Vd(l);o=!1,i=Yd,c=new Go}else c=a;t:for(;++r<s;){var u=t[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function hu(t){return t&&t.length?_8(t):[]}function Qd(t){console&&console.error&&console.error(`Error: ${t}`)}function E1(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function x1(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function v1(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function y8(t){return b8(t)?t.LABEL:t.name}function b8(t){return Bn(t.LABEL)&&t.LABEL!==""}class li{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Nt(this.definition,n=>{n.accept(e)})}}class Dn extends li{constructor(e){super([]),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Zo extends li{constructor(e){super(e.definition),this.orgText="",Fn(this,Dr(e,n=>n!==void 0))}}class $n extends li{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Fn(this,Dr(e,n=>n!==void 0))}}class jn extends li{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class ui extends li{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class hi extends li{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class Qe extends li{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class $r extends li{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class jr extends li{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Fn(this,Dr(e,n=>n!==void 0))}}class Ne{constructor(e){this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}accept(e){e.visit(this)}}function w8(t){return xt(t,fu)}function fu(t){function e(n){return xt(n,fu)}if(t instanceof Dn){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Bn(t.label)&&(n.label=t.label),n}else{if(t instanceof $n)return{type:"Alternative",definition:e(t.definition)};if(t instanceof jn)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof ui)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof hi)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:fu(new Ne({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof $r)return{type:"RepetitionWithSeparator",idx:t.idx,separator:fu(new Ne({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Qe)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof jr)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Ne){const n={type:"Terminal",name:t.terminalType.name,label:y8(t.terminalType),idx:t.idx};Bn(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=Li(r)?r.source:r),n}else{if(t instanceof Zo)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class Hs{visit(e){const n=e;switch(n.constructor){case Dn:return this.visitNonTerminal(n);case $n:return this.visitAlternative(n);case jn:return this.visitOption(n);case ui:return this.visitRepetitionMandatory(n);case hi:return this.visitRepetitionMandatoryWithSeparator(n);case $r:return this.visitRepetitionWithSeparator(n);case Qe:return this.visitRepetition(n);case jr:return this.visitAlternation(n);case Ne:return this.visitTerminal(n);case Zo:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function E8(t){return t instanceof $n||t instanceof jn||t instanceof Qe||t instanceof ui||t instanceof hi||t instanceof $r||t instanceof Ne||t instanceof Zo}function du(t,e=[]){return t instanceof jn||t instanceof Qe||t instanceof $r?!0:t instanceof jr?Jd(t.definition,r=>du(r,e)):t instanceof Dn&&On(e,t)?!1:t instanceof li?(t instanceof Dn&&e.push(t),Br(t.definition,r=>du(r,e))):!1}function x8(t){return t instanceof jr}function fi(t){if(t instanceof Dn)return"SUBRULE";if(t instanceof jn)return"OPTION";if(t instanceof jr)return"OR";if(t instanceof ui)return"AT_LEAST_ONE";if(t instanceof hi)return"AT_LEAST_ONE_SEP";if(t instanceof $r)return"MANY_SEP";if(t instanceof Qe)return"MANY";if(t instanceof Ne)return"CONSUME";throw Error("non exhaustive match")}class pu{walk(e,n=[]){Nt(e.definition,(r,i)=>{const s=_n(e.definition,i+1);if(r instanceof Dn)this.walkProdRef(r,s,n);else if(r instanceof Ne)this.walkTerminal(r,s,n);else if(r instanceof $n)this.walkFlat(r,s,n);else if(r instanceof jn)this.walkOption(r,s,n);else if(r instanceof ui)this.walkAtLeastOne(r,s,n);else if(r instanceof hi)this.walkAtLeastOneSep(r,s,n);else if(r instanceof $r)this.walkManySep(r,s,n);else if(r instanceof Qe)this.walkMany(r,s,n);else if(r instanceof jr)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new jn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=k1(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new jn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=k1(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);Nt(e.definition,s=>{const o=new $n({definition:[s]});this.walk(o,i)})}}function k1(t,e,n){return[new jn({definition:[new Ne({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function _c(t){if(t instanceof Dn)return _c(t.referencedRule);if(t instanceof Ne)return T8(t);if(E8(t))return v8(t);if(x8(t))return k8(t);throw Error("non exhaustive match")}function v8(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=du(s),e=e.concat(_c(s)),r=r+1,i=n.length>r;return hu(e)}function k8(t){const e=xt(t.definition,n=>_c(n));return hu(rr(e))}function T8(t){return[t.terminalType]}const T1="_~IN~_";class A8 extends pu{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=S8(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new $n({definition:s}),a=_c(o);this.follows[i]=a}}function R8(t){const e={};return Nt(t,n=>{const r=new A8(n).startWalking();Fn(e,r)}),e}function S8(t,e){return t.name+e+T1}function Lt(t){return t.charCodeAt(0)}function t0(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function yc(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function Xo(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function O8(){throw Error("Internal Error - Should never get here!")}function A1(t){return t.type==="Character"}const mu=[];for(let t=Lt("0");t<=Lt("9");t++)mu.push(t);const gu=[Lt("_")].concat(mu);for(let t=Lt("a");t<=Lt("z");t++)gu.push(t);for(let t=Lt("A");t<=Lt("Z");t++)gu.push(t);const R1=[Lt(" "),Lt("\f"),Lt(`
`),Lt("\r"),Lt("	"),Lt("\v"),Lt("	"),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt("\u2028"),Lt("\u2029"),Lt(""),Lt(""),Lt(""),Lt("\uFEFF")],I8=/[0-9a-fA-F]/,_u=/[0-9]/,N8=/[1-9]/;class C8{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":yc(r,"global");break;case"i":yc(r,"ignoreCase");break;case"m":yc(r,"multiLine");break;case"u":yc(r,"unicode");break;case"y":yc(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Xo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return O8()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;Xo(n);break}if(!(e===!0&&n===void 0)&&Xo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),Xo(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Lt(`
`),Lt("\r"),Lt("\u2028"),Lt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=mu;break;case"D":e=mu,n=!0;break;case"s":e=R1;break;case"S":e=R1,n=!0;break;case"w":e=gu;break;case"W":e=gu,n=!0;break}if(Xo(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Lt("\f");break;case"n":e=Lt(`
`);break;case"r":e=Lt("\r");break;case"t":e=Lt("	");break;case"v":e=Lt("\v");break}if(Xo(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Lt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Lt(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Lt(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,A1(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,A1(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else t0(r.value,e),e.push(Lt("-")),t0(i.value,e)}else t0(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Lt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(N8.test(e)===!1)throw Error("Expecting a positive integer");for(;_u.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(_u.test(e)===!1)throw Error("Expecting an integer");for(;_u.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Lt(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return _u.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(I8.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class e0{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let yu={};const L8=new C8;function bu(t){const e=t.toString();if(yu.hasOwnProperty(e))return yu[e];{const n=L8.pattern(e);return yu[e]=n,n}}function M8(){yu={}}const S1="Complement Sets are not supported for first char optimization",wu=`Unable to use "first char" lexer optimizations:
`;function U8(t,e=!1){try{const n=bu(t);return n0(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===S1)e&&E1(`${wu}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Qd(`${wu}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function n0(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)n0(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Eu(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(S1);Nt(o.value,c=>{if(typeof c=="number")Eu(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Eu(u,e,n);else{for(let u=l.from;u<=l.to&&u<wc;u++)Eu(u,e,n);if(l.to>=wc){const u=l.from>=wc?l.from:wc,f=l.to,d=as(u),h=as(f);for(let p=d;p<=h;p++)e[p]=p}}}});break;case"Group":n0(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&r0(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ke(e)}function Eu(t,e,n){const r=as(t);e[r]=r,n===!0&&F8(t,e)}function F8(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=as(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=as(i.charCodeAt(0));e[s]=s}}}function O1(t,e){return Vo(t.value,n=>{if(typeof n=="number")return On(e,n);{const r=n;return Vo(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function r0(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?ee(t.value)?Br(t.value,r0):r0(t.value):!1}class B8 extends e0{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){On(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?O1(e,this.targetCharCodes)===void 0&&(this.found=!0):O1(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function i0(t,e){if(e instanceof RegExp){const n=bu(e),r=new B8(t);return r.visit(n),r.found}else return Vo(e,n=>On(t,n.charCodeAt(0)))!==void 0}const Gs="PATTERN",bc="defaultMode",xu="modes";let I1=typeof new RegExp("(?:)").sticky=="boolean";function P8(t,e){e=qd(e,{useSticky:I1,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(k,T)=>T()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{a3()});let r;n("Reject Lexer.NA",()=>{r=uu(t,k=>k[Gs]===tn.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=xt(r,k=>{const T=k[Gs];if(Li(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!On(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:e.useSticky?C1(T):N1(T)}else{if(Ii(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),C=new RegExp(A);return e.useSticky?C1(C):N1(C)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=xt(r,k=>k.tokenTypeIdx),a=xt(r,k=>{const T=k.GROUP;if(T!==tn.SKIPPED){if(Bn(T))return T;if(Mi(T))return!1;throw Error("non exhaustive match")}}),c=xt(r,k=>{const T=k.LONGER_ALT;if(T)return ee(T)?xt(T,C=>b1(r,C)):[b1(r,T)]}),l=xt(r,k=>k.PUSH_MODE),u=xt(r,k=>Ot(k,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const k=U1(e.lineTerminatorCharacters);f=xt(r,T=>!1),e.positionTracking!=="onlyOffset"&&(f=xt(r,T=>Ot(T,"LINE_BREAKS")?!!T.LINE_BREAKS:M1(T,k)===!1&&i0(k,T.PATTERN)))});let d,h,p,m;n("Misc Mapping #2",()=>{d=xt(r,L1),h=xt(s,i3),p=Pn(r,(k,T)=>{const A=T.GROUP;return Bn(A)&&A!==tn.SKIPPED&&(k[A]=[]),k},{}),m=xt(s,(k,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:f[T],isCustom:d[T],short:h[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let b=!0,w=[];return e.safeMode||n("First Char Optimization",()=>{w=Pn(r,(k,T,A)=>{if(typeof T.PATTERN=="string"){const C=T.PATTERN.charCodeAt(0),R=as(C);s0(k,R,m[A])}else if(ee(T.START_CHARS_HINT)){let C;Nt(T.START_CHARS_HINT,R=>{const S=typeof R=="string"?R.charCodeAt(0):R,F=as(S);C!==F&&(C=F,s0(k,F,m[A]))})}else if(Li(T.PATTERN))if(T.PATTERN.unicode)b=!1,e.ensureOptimizations&&Qd(`${wu}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const C=U8(T.PATTERN,e.ensureOptimizations);ye(C)&&(b=!1),Nt(C,R=>{s0(k,R,m[A])})}else e.ensureOptimizations&&Qd(`${wu}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return k},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:w,hasCustom:i,canBeOptimized:b}}function D8(t,e){let n=[];const r=j8(t);n=n.concat(r.errors);const i=z8(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat($8(s)),n=n.concat(X8(s)),n=n.concat(q8(s,e)),n=n.concat(J8(s)),n}function $8(t){let e=[];const n=Tr(t,r=>Li(r[Gs]));return e=e.concat(W8(n)),e=e.concat(Y8(n)),e=e.concat(V8(n)),e=e.concat(Z8(n)),e=e.concat(H8(n)),e}function j8(t){const e=Tr(t,i=>!Ot(i,Gs)),n=xt(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Ue.MISSING_PATTERN,tokenTypes:[i]})),r=lu(t,e);return{errors:n,valid:r}}function z8(t){const e=Tr(t,i=>{const s=i[Gs];return!Li(s)&&!Ii(s)&&!Ot(s,"exec")&&!Bn(s)}),n=xt(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ue.INVALID_PATTERN,tokenTypes:[i]})),r=lu(t,e);return{errors:n,valid:r}}const K8=/[^\\][$]/;function W8(t){class e extends e0{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Tr(t,i=>{const s=i.PATTERN;try{const o=bu(s),a=new e;return a.visit(o),a.found}catch{return K8.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ue.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function H8(t){const e=Tr(t,r=>r.PATTERN.test(""));return xt(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Ue.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const G8=/[^\\[][\^]|^\^/;function Y8(t){class e extends e0{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Tr(t,i=>{const s=i.PATTERN;try{const o=bu(s),a=new e;return a.visit(o),a.found}catch{return G8.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ue.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function V8(t){const e=Tr(t,r=>{const i=r[Gs];return i instanceof RegExp&&(i.multiline||i.global)});return xt(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ue.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function Z8(t){const e=[];let n=xt(t,s=>Pn(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!On(e,a)&&a.PATTERN!==tn.NA&&(e.push(a),o.push(a)),o),[]));n=mc(n);const r=Tr(n,s=>s.length>1);return xt(r,s=>{const o=xt(s,c=>c.name);return{message:`The same RegExp pattern ->${Pr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Ue.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function X8(t){const e=Tr(t,r=>{if(!Ot(r,"GROUP"))return!1;const i=r.GROUP;return i!==tn.SKIPPED&&i!==tn.NA&&!Bn(i)});return xt(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ue.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function q8(t,e){const n=Tr(t,i=>i.PUSH_MODE!==void 0&&!On(e,i.PUSH_MODE));return xt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Ue.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function J8(t){const e=[],n=Pn(t,(r,i,s)=>{const o=i.PATTERN;return o===tn.NA||(Bn(o)?r.push({str:o,idx:s,tokenType:i}):Li(o)&&t3(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Nt(t,(r,i)=>{Nt(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&Q8(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Ue.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function Q8(t,e){if(Li(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Ii(e))return e(t,0,[],{});if(Ot(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function t3(t){return Vo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function N1(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function C1(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function e3(t,e,n){const r=[];return Ot(t,bc)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+bc+`> property in its definition
`,type:Ue.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ot(t,xu)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+xu+`> property in its definition
`,type:Ue.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ot(t,xu)&&Ot(t,bc)&&!Ot(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${bc}: <${t.defaultMode}>which does not exist
`,type:Ue.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ot(t,xu)&&Nt(t.modes,(i,s)=>{Nt(i,(o,a)=>{if(Mi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Ue.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ot(o,"LONGER_ALT")){const c=ee(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Nt(c,l=>{!Mi(l)&&!On(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Ue.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function n3(t,e,n){const r=[];let i=!1;const s=mc(rr(Ke(t.modes))),o=uu(s,c=>c[Gs]===tn.NA),a=U1(n);return e&&Nt(o,c=>{const l=M1(c,a);if(l!==!1){const f={message:o3(c,l),type:l.issue,tokenType:c};r.push(f)}else Ot(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):i0(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ue.NO_LINE_BREAKS_FLAGS}),r}function r3(t){const e={},n=vr(t);return Nt(n,r=>{const i=t[r];if(ee(i))e[r]=[];else throw Error("non exhaustive match")}),e}function L1(t){const e=t.PATTERN;if(Li(e))return!1;if(Ii(e))return!0;if(Ot(e,"exec"))return!0;if(Bn(e))return!1;throw Error("non exhaustive match")}function i3(t){return Bn(t)&&t.length===1?t.charCodeAt(0):!1}const s3={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function M1(t,e){if(Ot(t,"LINE_BREAKS"))return!1;if(Li(t.PATTERN)){try{i0(e,t.PATTERN)}catch(n){return{issue:Ue.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Bn(t.PATTERN))return!1;if(L1(t))return{issue:Ue.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function o3(t,e){if(e.issue===Ue.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Ue.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function U1(t){return xt(t,n=>Bn(n)?n.charCodeAt(0):n)}function s0(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const wc=256;let vu=[];function as(t){return t<wc?t:vu[t]}function a3(){if(ye(vu)){vu=new Array(65536);for(let t=0;t<65536;t++)vu[t]=t>255?255+~~(t/255):t}}function Ec(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function ku(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let F1=1;const B1={};function xc(t){const e=c3(t);l3(e),h3(e),u3(e),Nt(e,n=>{n.isParent=n.categoryMatches.length>0})}function c3(t){let e=gn(t),n=t,r=!0;for(;r;){n=mc(rr(xt(n,s=>s.CATEGORIES)));const i=lu(n,e);e=e.concat(i),ye(i)?r=!1:n=i}return e}function l3(t){Nt(t,e=>{D1(e)||(B1[F1]=e,e.tokenTypeIdx=F1++),$1(e)&&!ee(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),$1(e)||(e.CATEGORIES=[]),f3(e)||(e.categoryMatches=[]),d3(e)||(e.categoryMatchesMap={})})}function u3(t){Nt(t,e=>{e.categoryMatches=[],Nt(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(B1[r].tokenTypeIdx)})})}function h3(t){Nt(t,e=>{P1([],e)})}function P1(t,e){Nt(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),Nt(e.CATEGORIES,n=>{const r=t.concat(e);On(r,n)||P1(r,n)})}function D1(t){return Ot(t,"tokenTypeIdx")}function $1(t){return Ot(t,"CATEGORIES")}function f3(t){return Ot(t,"categoryMatches")}function d3(t){return Ot(t,"categoryMatchesMap")}function p3(t){return Ot(t,"tokenTypeIdx")}const m3={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var Ue;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Ue||(Ue={}));const vc={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:m3,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(vc);let tn=class{constructor(e,n=vc){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=x1(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Fn({},vc,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===vc.lineTerminatorsPattern)this.config.lineTerminatorsPattern=s3;else if(this.config.lineTerminatorCharacters===vc.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),ee(e)?i={modes:{defaultMode:gn(e)},defaultMode:bc}:(s=!1,i=gn(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(e3(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(n3(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Nt(i.modes,(a,c)=>{i.modes[c]=uu(a,l=>Mi(l))});const o=vr(i.modes);if(Nt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(D8(a,o))}),ye(this.lexerDefinitionErrors)){xc(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=P8(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Fn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ye(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=xt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Nt(this.lexerDefinitionWarning,a=>{E1(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(I1?(this.chopInput=Wo,this.match=this.matchWithTest):(this.updateLastIndex=Je,this.match=this.matchWithExec),s&&(this.handleModes=Je),this.trackStartLines===!1&&(this.computeNewColumn=Wo),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Je),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Pn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!ye(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{M8()}),this.TRACE_INIT("toFastProperties",()=>{v1(this)})})}tokenize(e,n=this.defaultMode){if(!ye(this.lexerDefinitionErrors)){const i=xt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,b,w;const k=e,T=k.length;let A=0,C=0;const R=this.hasCustom?0:Math.floor(e.length/10),S=new Array(R),F=[];let N=this.trackStartLines?1:void 0,P=this.trackStartLines?1:void 0;const H=r3(this.emptyGroups),M=this.trackStartLines,I=this.config.lineTerminatorsPattern;let E=0,D=[],q=[];const j=[],ot=[];Object.freeze(ot);let tt;function ft(){return D}function V(Dt){const Yt=as(Dt),Mt=q[Yt];return Mt===void 0?ot:Mt}const W=Dt=>{if(j.length===1&&Dt.tokenType.PUSH_MODE===void 0){const Yt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Dt);F.push({offset:Dt.startOffset,line:Dt.startLine,column:Dt.startColumn,length:Dt.image.length,message:Yt})}else{j.pop();const Yt=Yo(j);D=this.patternIdxToConfig[Yt],q=this.charCodeToPatternIdxToConfig[Yt],E=D.length;const Mt=this.canModeBeOptimized[Yt]&&this.config.safeMode===!1;q&&Mt?tt=V:tt=ft}};function bt(Dt){j.push(Dt),q=this.charCodeToPatternIdxToConfig[Dt],D=this.patternIdxToConfig[Dt],E=D.length,E=D.length;const Yt=this.canModeBeOptimized[Dt]&&this.config.safeMode===!1;q&&Yt?tt=V:tt=ft}bt.call(this,n);let at;const lt=this.config.recoveryEnabled;for(;A<T;){c=null;const Dt=k.charCodeAt(A),Yt=tt(Dt),Mt=Yt.length;for(r=0;r<Mt;r++){at=Yt[r];const Ct=at.pattern;l=null;const Pt=at.short;if(Pt!==!1?Dt===Pt&&(c=Ct):at.isCustom===!0?(w=Ct.exec(k,A,S,H),w!==null?(c=w[0],w.payload!==void 0&&(l=w.payload)):c=null):(this.updateLastIndex(Ct,A),c=this.match(Ct,e,A)),c!==null){if(a=at.longerAlt,a!==void 0){const Ut=a.length;for(s=0;s<Ut;s++){const se=D[a[s]],Be=se.pattern;if(u=null,se.isCustom===!0?(w=Be.exec(k,A,S,H),w!==null?(o=w[0],w.payload!==void 0&&(u=w.payload)):o=null):(this.updateLastIndex(Be,A),o=this.match(Be,e,A)),o&&o.length>c.length){c=o,l=u,at=se;break}}}break}}if(c!==null){if(f=c.length,d=at.group,d!==void 0&&(h=at.tokenTypeIdx,p=this.createTokenInstance(c,A,h,at.tokenType,N,P,f),this.handlePayload(p,l),d===!1?C=this.addToken(S,C,p):H[d].push(p)),e=this.chopInput(e,f),A=A+f,P=this.computeNewColumn(P,f),M===!0&&at.canLineTerminator===!0){let Ct=0,Pt,Ut;I.lastIndex=0;do Pt=I.test(c),Pt===!0&&(Ut=I.lastIndex-1,Ct++);while(Pt===!0);Ct!==0&&(N=N+Ct,P=f-Ut,this.updateTokenEndLineColumnLocation(p,d,Ut,Ct,N,P,f))}this.handleModes(at,W,bt,p)}else{const Ct=A,Pt=N,Ut=P;let se=lt===!1;for(;se===!1&&A<T;)for(e=this.chopInput(e,1),A++,i=0;i<E;i++){const Be=D[i],v=Be.pattern,st=Be.short;if(st!==!1?k.charCodeAt(A)===st&&(se=!0):Be.isCustom===!0?se=v.exec(k,A,S,H)!==null:(this.updateLastIndex(v,A),se=v.exec(e)!==null),se===!0)break}if(m=A-Ct,P=this.computeNewColumn(P,m),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(k,Ct,m,Pt,Ut),F.push({offset:Ct,line:Pt,column:Ut,length:m,message:b}),lt===!1)break}}return this.hasCustom||(S.length=C),{tokens:S,groups:H,errors:F}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};tn.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",tn.NA=/NOT_APPLICABLE/;function kc(t){return j1(t)?t.LABEL:t.name}function j1(t){return Bn(t.LABEL)&&t.LABEL!==""}const g3="parent",z1="categories",K1="label",W1="group",H1="push_mode",G1="pop_mode",Y1="longer_alt",V1="line_breaks",Z1="start_chars_hint";function ir(t){return _3(t)}function _3(t){const e=t.pattern,n={};if(n.name=t.name,Mi(e)||(n.PATTERN=e),Ot(t,g3))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ot(t,z1)&&(n.CATEGORIES=t[z1]),xc([n]),Ot(t,K1)&&(n.LABEL=t[K1]),Ot(t,W1)&&(n.GROUP=t[W1]),Ot(t,G1)&&(n.POP_MODE=t[G1]),Ot(t,H1)&&(n.PUSH_MODE=t[H1]),Ot(t,Y1)&&(n.LONGER_ALT=t[Y1]),Ot(t,V1)&&(n.LINE_BREAKS=t[V1]),Ot(t,Z1)&&(n.START_CHARS_HINT=t[Z1]),n}const Ys=ir({name:"EOF",pattern:tn.NA});xc([Ys]);function Tu(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function y3(t,e){return Ec(t,e)}const X1={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${j1(t)?`--> ${kc(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Pr(e).image+"'";if(r)return s+r+a;{const c=Pn(t,(d,h)=>d.concat(h),[]),l=xt(c,d=>`[${xt(d,h=>kc(h)).join(", ")}]`),f=`one of these possible Token sequences:
${xt(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Pr(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${xt(t,l=>`[${xt(l,u=>kc(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(X1);const b3={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Vs={buildDuplicateFoundError(t,e){function n(u){return u instanceof Ne?u.terminalType.name:u instanceof Dn?u.nonTerminalName:""}const r=t.name,i=Pr(e),s=i.idx,o=fi(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=xt(t.prefixPath,i=>kc(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=xt(t.prefixPath,i=>kc(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=fi(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=xt(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Zo?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function w3(t,e){const n=new E3(t,e);return n.resolveRefs(),n.errors}class E3 extends Hs{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Nt(Ke(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:In.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class x3 extends pu{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=gn(this.path.ruleStack).reverse(),this.occurrenceStack=gn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){ye(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class v3 extends x3{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new $n({definition:i});this.possibleTokTypes=_c(s),this.found=!0}}}class Au extends pu{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class k3 extends Au{walkMany(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class q1 extends Au{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class T3 extends Au{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class J1 extends Au{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function o0(t,e,n=[]){n=gn(n);let r=[],i=0;function s(a){return a.concat(_n(t,i+1))}function o(a){const c=o0(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof $n)return o(a.definition);if(a instanceof Dn)return o(a.definition);if(a instanceof jn)r=o(a.definition);else if(a instanceof ui){const c=a.definition.concat([new Qe({definition:a.definition})]);return o(c)}else if(a instanceof hi){const c=[new $n({definition:a.definition}),new Qe({definition:[new Ne({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof $r){const c=a.definition.concat([new Qe({definition:[new Ne({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Qe){const c=a.definition.concat([new Qe({definition:a.definition})]);r=o(c)}else{if(a instanceof jr)return Nt(a.definition,c=>{ye(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ne)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:_n(t,i)}),r}function Q1(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!ye(f);){const d=f.pop();if(d===o){a&&Yo(f).idx<=l&&f.pop();continue}const h=d.def,p=d.idx,m=d.ruleStack,b=d.occurrenceStack;if(ye(h))continue;const w=h[0];if(w===i){const k={idx:p,def:_n(h),ruleStack:gc(m),occurrenceStack:gc(b)};f.push(k)}else if(w instanceof Ne)if(p<c-1){const k=p+1,T=e[k];if(n(T,w.terminalType)){const A={idx:k,def:_n(h),ruleStack:m,occurrenceStack:b};f.push(A)}}else if(p===c-1)u.push({nextTokenType:w.terminalType,nextTokenOccurrence:w.idx,ruleStack:m,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(w instanceof Dn){const k=gn(m);k.push(w.nonTerminalName);const T=gn(b);T.push(w.idx);const A={idx:p,def:w.definition.concat(s,_n(h)),ruleStack:k,occurrenceStack:T};f.push(A)}else if(w instanceof jn){const k={idx:p,def:_n(h),ruleStack:m,occurrenceStack:b};f.push(k),f.push(o);const T={idx:p,def:w.definition.concat(_n(h)),ruleStack:m,occurrenceStack:b};f.push(T)}else if(w instanceof ui){const k=new Qe({definition:w.definition,idx:w.idx}),T=w.definition.concat([k],_n(h)),A={idx:p,def:T,ruleStack:m,occurrenceStack:b};f.push(A)}else if(w instanceof hi){const k=new Ne({terminalType:w.separator}),T=new Qe({definition:[k].concat(w.definition),idx:w.idx}),A=w.definition.concat([T],_n(h)),C={idx:p,def:A,ruleStack:m,occurrenceStack:b};f.push(C)}else if(w instanceof $r){const k={idx:p,def:_n(h),ruleStack:m,occurrenceStack:b};f.push(k),f.push(o);const T=new Ne({terminalType:w.separator}),A=new Qe({definition:[T].concat(w.definition),idx:w.idx}),C=w.definition.concat([A],_n(h)),R={idx:p,def:C,ruleStack:m,occurrenceStack:b};f.push(R)}else if(w instanceof Qe){const k={idx:p,def:_n(h),ruleStack:m,occurrenceStack:b};f.push(k),f.push(o);const T=new Qe({definition:w.definition,idx:w.idx}),A=w.definition.concat([T],_n(h)),C={idx:p,def:A,ruleStack:m,occurrenceStack:b};f.push(C)}else if(w instanceof jr)for(let k=w.definition.length-1;k>=0;k--){const T=w.definition[k],A={idx:p,def:T.definition.concat(_n(h)),ruleStack:m,occurrenceStack:b};f.push(A),f.push(o)}else if(w instanceof $n)f.push({idx:p,def:w.definition.concat(_n(h)),ruleStack:m,occurrenceStack:b});else if(w instanceof Zo)f.push(A3(w,p,m,b));else throw Error("non exhaustive match")}return u}function A3(t,e,n,r){const i=gn(n);i.push(t.name);const s=gn(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var Fe;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(Fe||(Fe={}));function tw(t){if(t instanceof jn||t==="Option")return Fe.OPTION;if(t instanceof Qe||t==="Repetition")return Fe.REPETITION;if(t instanceof ui||t==="RepetitionMandatory")return Fe.REPETITION_MANDATORY;if(t instanceof hi||t==="RepetitionMandatoryWithSeparator")return Fe.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof $r||t==="RepetitionWithSeparator")return Fe.REPETITION_WITH_SEPARATOR;if(t instanceof jr||t==="Alternation")return Fe.ALTERNATION;throw Error("non exhaustive match")}function R3(t,e,n,r,i,s){const o=c0(t,e,n),a=iw(o)?ku:Ec;return s(o,r,a,i)}function S3(t,e,n,r,i,s){const o=l0(t,e,i,n),a=iw(o)?ku:Ec;return s(o[0],a,r)}function O3(t,e,n,r){const i=t.length,s=Br(t,o=>Br(o,a=>a.length===1));if(e)return function(o){const a=xt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],p=h.length;for(let m=0;m<p;m++){const b=this.LA(m+1);if(n(b,h[m])===!1)continue t}return c}}};if(s&&!r){const o=xt(t,c=>rr(c)),a=Pn(o,(c,l,u)=>(Nt(l,f=>{Ot(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Nt(f.categoryMatches,d=>{Ot(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function I3(t,e,n){const r=Br(t,s=>s.length===1),i=t.length;if(r&&!n){const s=rr(t);if(s.length===1&&ye(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Pn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Nt(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue t}return!0}return!1}}class N3 extends pu{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,Fe.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,Fe.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,Fe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,Fe.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,Fe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class ew extends Hs{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,Fe.OPTION)}visitRepetition(e){this.checkIsTarget(e,Fe.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,Fe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,Fe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,Fe.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,Fe.ALTERNATION)}}function nw(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function a0(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function C3(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function rw(t,e){const n=xt(t,o=>o0([o],1)),r=nw(n.length),i=xt(n,o=>{const a={};return Nt(o,c=>{const l=a0(c.partialPath);Nt(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=nw(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=a0(f);if(C3(i,h,c)||ye(d)||f.length===e){const m=r[c];if(u0(m,f)===!1){m.push(f);for(let b=0;b<h.length;b++){const w=h[b];i[c][w]=!0}}}else{const m=o0(d,o+1,f);s[c]=s[c].concat(m),Nt(m,b=>{const w=a0(b.partialPath);Nt(w,k=>{i[c][k]=!0})})}}}}return r}function c0(t,e,n,r){const i=new ew(t,Fe.ALTERNATION,r);return e.accept(i),rw(i.result,n)}function l0(t,e,n,r){const i=new ew(t,n);e.accept(i);const s=i.result,a=new N3(e,t,n).startWalking(),c=new $n({definition:s}),l=new $n({definition:a});return rw([c,l],r)}function u0(t,e){t:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function L3(t,e){return t.length<e.length&&Br(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function iw(t){return Br(t,e=>Br(e,n=>Br(n,r=>ye(r.categoryMatches))))}function M3(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return xt(e,n=>Object.assign({type:In.CUSTOM_LOOKAHEAD_VALIDATION},n))}function U3(t,e,n,r){const i=Ar(t,c=>F3(c,n)),s=V3(t,e,n),o=Ar(t,c=>W3(c,n)),a=Ar(t,c=>D3(c,t,r,n));return i.concat(s,o,a)}function F3(t,e){const n=new P3;t.accept(n);const r=n.allProductions,i=y1(r,B3),s=Dr(i,a=>a.length>1);return xt(Ke(s),a=>{const c=Pr(a),l=e.buildDuplicateFoundError(t,a),u=fi(c),f={message:l,type:In.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=sw(c);return d&&(f.parameter=d),f})}function B3(t){return`${fi(t)}_#_${t.idx}_#_${sw(t)}`}function sw(t){return t instanceof Ne?t.terminalType.name:t instanceof Dn?t.nonTerminalName:""}class P3 extends Hs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function D3(t,e,n,r){const i=[];if(Pn(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:In.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function $3(t,e,n){const r=[];let i;return On(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:In.INVALID_RULE_OVERRIDE,ruleName:t})),r}function ow(t,e,n,r=[]){const i=[],s=Ru(e.definition);if(ye(s))return[];{const o=t.name;On(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:In.LEFT_RECURSION,ruleName:o});const c=lu(s,r.concat([t])),l=Ar(c,u=>{const f=gn(r);return f.push(u),ow(t,u,n,f)});return i.concat(l)}}function Ru(t){let e=[];if(ye(t))return e;const n=Pr(t);if(n instanceof Dn)e.push(n.referencedRule);else if(n instanceof $n||n instanceof jn||n instanceof ui||n instanceof hi||n instanceof $r||n instanceof Qe)e=e.concat(Ru(n.definition));else if(n instanceof jr)e=rr(xt(n.definition,s=>Ru(s.definition)));else if(!(n instanceof Ne))throw Error("non exhaustive match");const r=du(n),i=t.length>1;if(r&&i){const s=_n(t);return e.concat(Ru(s))}else return e}class h0 extends Hs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function j3(t,e){const n=new h0;t.accept(n);const r=n.alternations;return Ar(r,s=>{const o=gc(s.definition);return Ar(o,(a,c)=>{const l=Q1([a],[],Ec,1);return ye(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:In.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function z3(t,e,n){const r=new h0;t.accept(r);let i=r.alternations;return i=uu(i,o=>o.ignoreAmbiguities===!0),Ar(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=c0(a,t,c,o),u=G3(l,o,t,n),f=Y3(l,o,t,n);return u.concat(f)})}class K3 extends Hs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function W3(t,e){const n=new h0;t.accept(n);const r=n.alternations;return Ar(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:In.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function H3(t,e,n){const r=[];return Nt(t,i=>{const s=new K3;i.accept(s);const o=s.allProductions;Nt(o,a=>{const c=tw(a),l=a.maxLookahead||e,u=a.idx,d=l0(u,i,c,l)[0];if(ye(rr(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:In.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function G3(t,e,n,r){const i=[],s=Pn(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Nt(c,u=>{const f=[l];Nt(t,(d,h)=>{l!==h&&u0(d,u)&&e.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!u0(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return xt(s,a=>{const c=xt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:In.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function Y3(t,e,n,r){const i=Pn(t,(o,a,c)=>{const l=xt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return mc(Ar(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Tr(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&L3(d.path,l));return xt(u,d=>{const h=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:h,prefixPath:d.path}),type:In.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:h}})}))}function V3(t,e,n){const r=[],i=xt(e,s=>s.name);return Nt(t,s=>{const o=s.name;if(On(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:In.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function Z3(t){const e=qd(t,{errMsgProvider:b3}),n={};return Nt(t.rules,r=>{n[r.name]=r}),w3(n,e.errMsgProvider)}function X3(t){return t=qd(t,{errMsgProvider:Vs}),U3(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const aw="MismatchedTokenException",cw="NoViableAltException",lw="EarlyExitException",uw="NotAllInputParsedException",hw=[aw,cw,lw,uw];Object.freeze(hw);function Su(t){return On(hw,t.name)}class Ou extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class fw extends Ou{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=aw}}class q3 extends Ou{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=cw}}class J3 extends Ou{constructor(e,n){super(e,n),this.name=uw}}class Q3 extends Ou{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=lw}}const f0={},dw="InRuleRecoveryException";class tU extends Error{constructor(e){super(e),this.name=dw}}class eU{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ot(e,"recoveryEnabled")?e.recoveryEnabled:Ui.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=nU)}getTokenToInsert(e){const n=Tu(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new fw(h,l,this.LA(0));p.resyncedTokens=gc(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new tU("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||ye(n))return!1;const r=this.LA(1);return Vo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return On(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Vo(e,s=>y3(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return f0;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return xt(e,(r,i)=>i===0?f0:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=xt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return rr(e)}getFollowSetFromFollowKey(e){if(e===f0)return[Ys];const n=e.ruleName+e.idxInCallingRule+T1+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,Ys)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return gc(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=gn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return xt(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function nU(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=Ys,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const rU=4,cs=8,pw=1<<cs,mw=2<<cs,d0=3<<cs,p0=4<<cs,m0=5<<cs,Iu=6<<cs;function g0(t,e,n){return n|e|t}class iU{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:Ui.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(ye(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return Ar(e,n=>ow(n,n,Vs))}validateEmptyOrAlternatives(e){return Ar(e,n=>j3(n,Vs))}validateAmbiguousAlternationAlternatives(e,n){return Ar(e,r=>z3(r,n,Vs))}validateSomeNonEmptyLookaheadPath(e,n){return H3(e,n,Vs)}buildLookaheadForAlternation(e){return R3(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,O3)}buildLookaheadForOptional(e){return S3(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,tw(e.prodType),I3)}}class sU{initLooksAhead(e){this.dynamicTokensEnabled=Ot(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Ui.dynamicTokensEnabled,this.maxLookahead=Ot(e,"maxLookahead")?e.maxLookahead:Ui.maxLookahead,this.lookaheadStrategy=Ot(e,"lookaheadStrategy")?e.lookaheadStrategy:new iU({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Nt(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=aU(n);Nt(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${fi(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=g0(this.fullRuleNameToShort[n.name],pw,l.idx);this.setLaFuncCache(d,f)})}),Nt(i,l=>{this.computeLookaheadFunc(n,l.idx,d0,"Repetition",l.maxLookahead,fi(l))}),Nt(s,l=>{this.computeLookaheadFunc(n,l.idx,mw,"Option",l.maxLookahead,fi(l))}),Nt(o,l=>{this.computeLookaheadFunc(n,l.idx,p0,"RepetitionMandatory",l.maxLookahead,fi(l))}),Nt(a,l=>{this.computeLookaheadFunc(n,l.idx,Iu,"RepetitionMandatoryWithSeparator",l.maxLookahead,fi(l))}),Nt(c,l=>{this.computeLookaheadFunc(n,l.idx,m0,"RepetitionWithSeparator",l.maxLookahead,fi(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=g0(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return g0(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class oU extends Hs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Nu=new oU;function aU(t){Nu.reset(),t.accept(Nu);const e=Nu.dslMethods;return Nu.reset(),e}function gw(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function _w(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function cU(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function lU(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const uU="name";function yw(t,e){Object.defineProperty(t,uU,{enumerable:!1,configurable:!0,writable:!1,value:e})}function hU(t,e){const n=vr(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function fU(t,e){const n=function(){};yw(n,t+"BaseSemantics");const r={visit:function(i,s){if(ee(i)&&(i=i[0]),!Mi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=pU(this,e);if(!ye(i)){const s=xt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function dU(t,e,n){const r=function(){};yw(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Nt(e,s=>{i[s]=hU}),r.prototype=i,r.prototype.constructor=r,r}var _0;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(_0||(_0={}));function pU(t,e){return mU(t,e)}function mU(t,e){const n=Tr(e,i=>Ii(t[i])===!1),r=xt(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:_0.MISSING_METHOD,methodName:i}));return mc(r)}class gU{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Ot(e,"nodeLocationTracking")?e.nodeLocationTracking:Ui.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Je,this.cstFinallyStateUpdate=Je,this.cstPostTerminal=Je,this.cstPostNonTerminal=Je,this.cstPostRule=Je;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=_w,this.setNodeLocationFromNode=_w,this.cstPostRule=Je,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=gw,this.setNodeLocationFromNode=gw,this.cstPostRule=Je,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=Je,this.setInitialNodeLocation=Je;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];cU(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];lU(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Mi(this.baseCstVisitorConstructor)){const e=fU(this.className,vr(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Mi(this.baseCstVisitorWithDefaultsConstructor)){const e=dU(this.className,vr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class _U{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Mu}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?Mu:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class yU{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=Uu){if(On(this.definedRulesNames,e)){const o={message:Vs.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:In.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=Uu){const i=$3(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Su(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return w8(Ke(this.gastProductionsCache))}}class bU{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ku,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ot(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(ee(e)){if(ye(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(ee(e))this.tokensMap=Pn(e,(s,o)=>(s[o.name]=o,s),{});else if(Ot(e,"modes")&&Br(rr(Ke(e.modes)),p3)){const s=rr(Ke(e.modes)),o=hu(s);this.tokensMap=Pn(o,(a,c)=>(a[c.name]=c,a),{})}else if(xr(e))this.tokensMap=gn(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Ys;const r=Ot(e,"modes")?rr(Ke(e.modes)):Ke(e),i=Br(r,s=>ye(s.categoryMatches));this.tokenMatcher=i?ku:Ec,xc(Ke(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ot(r,"resyncEnabled")?r.resyncEnabled:Uu.resyncEnabled,s=Ot(r,"recoveryValueFunc")?r.recoveryValueFunc:Uu.recoveryValueFunc,o=this.ruleShortNameIdx<<rU+cs;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Su(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(mw,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(p0,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,Fe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,p0,e,T3)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Iu,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,J1],a,Iu,e,J1)}else throw this.raiseEarlyExitException(e,Fe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(d0,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,d0,e,k3,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(m0,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,q1],a,m0,e,q1)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,Iu,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(pw,n),i=ee(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new J3(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Su(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new fw(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===dw?r:s}}else throw r}saveRecogState(){const e=this.errors,n=gn(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Ys)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class wU{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Ot(e,"errorMessageProvider")?e.errorMessageProvider:Ui.errorMessageProvider}SAVE_ERROR(e){if(Su(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:gn(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return gn(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=l0(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new Q3(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=c0(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new q3(c,this.LA(1),a))}}class EU{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Mi(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Q1([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=Pr(e.ruleStack),i=this.getGAstProductions()[n];return new v3(i,e).startWalking()}}const Cu={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Cu);const bw=!0,ww=Math.pow(2,cs)-1,Ew=ir({name:"RECORDING_PHASE_TOKEN",pattern:tn.NA});xc([Ew]);const xw=Tu(Ew,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(xw);const xU={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class vU{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return Mu}topLevelRuleRecord(e,n){try{const r=new Zo({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Tc.call(this,jn,e,n)}atLeastOneInternalRecord(e,n){Tc.call(this,ui,n,e)}atLeastOneSepFirstInternalRecord(e,n){Tc.call(this,hi,n,e,bw)}manyInternalRecord(e,n){Tc.call(this,Qe,n,e)}manySepFirstInternalRecord(e,n){Tc.call(this,$r,n,e,bw)}orInternalRecord(e,n){return kU.call(this,e,n)}subruleInternalRecord(e,n,r){if(Lu(n),!e||Ot(e,"ruleName")===!1){const a=new Error(`<SUBRULE${vw(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Yo(this.recordingProdStack),s=e.ruleName,o=new Dn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?xU:Cu}consumeInternalRecord(e,n,r){if(Lu(n),!D1(e)){const o=new Error(`<CONSUME${vw(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Yo(this.recordingProdStack),s=new Ne({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),xw}}function Tc(t,e,n,r=!1){Lu(n);const i=Yo(this.recordingProdStack),s=Ii(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),Ot(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Cu}function kU(t,e){Lu(e);const n=Yo(this.recordingProdStack),r=ee(t)===!1,i=r===!1?t:t.DEF,s=new jr({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});Ot(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=Jd(i,a=>Ii(a.GATE));return s.hasPredicates=o,n.definition.push(s),Nt(i,a=>{const c=new $n({definition:[]});s.definition.push(c),Ot(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ot(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Cu}function vw(t){return t===0?"":`${t}`}function Lu(t){if(t<0||t>ww){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${ww+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class TU{initPerformanceTracer(e){if(Ot(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ui.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=x1(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function AU(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const Mu=Tu(Ys,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Mu);const Ui=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:X1,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Uu=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var In;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(In||(In={}));let y0=class Px{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{v1(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Nt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=Z3({rules:Ke(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ye(r)&&this.skipValidations===!1){const i=X3({rules:Ke(this.gastProductionsCache),tokenTypes:Ke(this.tokensMap),errMsgProvider:Vs,grammarName:n}),s=M3({lookaheadStrategy:this.lookaheadStrategy,rules:Ke(this.gastProductionsCache),tokenTypes:Ke(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ye(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=R8(Ke(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ke(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ke(this.gastProductionsCache))})),!Px.DEFER_DEFINITION_ERRORS_HANDLING&&!ye(this.definitionErrors))throw e=xt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Ot(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ot(n,"skipValidations")?n.skipValidations:Ui.skipValidations}};y0.DEFER_DEFINITION_ERRORS_HANDLING=!1,AU(y0,[eU,sU,gU,_U,bU,yU,wU,EU,vU,TU]);class RU extends y0{constructor(e,n=Ui){const r=gn(n);r.outputCst=!0,super(e,r)}}function SU(t){const e=new OU,n=Ke(t);return xt(n,r=>e.visitRule(r))}class OU extends Hs{visitRule(e){const n=this.visitEach(e.definition),r=y1(n,s=>s.propertyName),i=xt(r,(s,o)=>{const a=!Jd(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=xt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:Fu(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:Fu(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:Fu(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:Fu(e)}]}visitEachAndOverrideWith(e,n){return xt(this.visitEach(e),r=>Fn({},r,n))}visitEach(e){return rr(xt(e,n=>this.visit(n)))}}function Fu(t){return t instanceof Dn?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function IU(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(rr(xt(t,r=>NU(r)))),e.includeVisitorInterface&&(n=n.concat(UU(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function NU(t){const e=CU(t),n=LU(t);return[e,n]}function CU(t){const e=Tw(t.name),n=b0(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function LU(t){return`export type ${b0(t.name)} = {
  ${xt(t.properties,n=>MU(n)).join(`
  `)}
};`}function MU(t){const e=BU(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function UU(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${xt(e,n=>FU(n)).join(`
  `)}
}`}function FU(t){const e=b0(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function BU(t){if(ee(t)){const e=hu(xt(t,r=>kw(r)));return"("+Pn(e,(r,i)=>r+" | "+i)+")"}else return kw(t)}function kw(t){return t.kind==="token"?"IToken":Tw(t.name)}function Tw(t){return $b(t)+"CstNode"}function b0(t){return $b(t)+"CstChildren"}const PU={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function DU(t,e){const n=Object.assign(Object.assign({},PU),e),r=SU(t);return IU(r,n)}const di=!!JSON.parse("false"),$U=!!JSON.parse("false");JSON.parse("false");const jU=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Fi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Wl*Fi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Hl*Fi.DRAW_CHAR_SCALE}},Bu=fy(32,126).map(t=>String.fromCharCode(t));function Gt(t){return ir({...t,name:`token_${t.name}`})}function ls(t,e=!1){return Gt(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:yn,group:tn.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:yn})}const Ac=Gt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),zU=Gt({name:"whitespace",pattern:/ +/,group:tn.SKIPPED}),KU=Gt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:tn.SKIPPED}),w0=Gt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),qo=Gt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Aw=!1;function WU(t,e,n){if(!Aw)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Ac)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const Rw=Gt({name:"text",pattern:WU,line_breaks:!1,start_chars_hint:Bu.filter(t=>"@#/?':!".includes(t)===!1)}),Sw=Gt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Ow=Gt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Iw=Gt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Nw=Gt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),yn=Gt({name:"stringliteral",pattern:/[^-0-9"!;@#/?()\s]+[^-"!;@#/?()\s]*/,start_chars_hint:Bu}),Cw=Gt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Lw=Gt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Mw=Gt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:yn}),Uw=Gt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:yn}),Fw=Gt({name:"islessthan",pattern:/<|below/,longer_alt:yn}),Bw=Gt({name:"isgreaterthan",pattern:/>|above/,longer_alt:yn}),Pw=Gt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:yn}),Dw=Gt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:yn}),E0=Gt({name:"or",pattern:/or/i,longer_alt:yn}),x0=Gt({name:"not",pattern:/not/i,longer_alt:yn}),v0=Gt({name:"and",pattern:/and/i,longer_alt:yn}),k0=Gt({name:"plus",pattern:/\+/}),T0=Gt({name:"minus",pattern:/-/}),$w=Gt({name:"power",pattern:/\*\*/}),jw=Gt({name:"multiply",pattern:/\*/}),A0=Gt({name:"divide",pattern:/\//}),zw=Gt({name:"moddivide",pattern:/%/}),Kw=Gt({name:"floordivide",pattern:/%%/}),Ww=Gt({name:"query",pattern:/\?/}),Hw=Gt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),Gw=Gt({name:"rparen",pattern:/\)/,pop_mode:!0}),Yw=Gt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Bu,longer_alt:yn}),Vw=Gt({name:"command_toast",pattern:/toast .*/,start_chars_hint:Bu,longer_alt:yn}),R0=Gt({name:"if",pattern:/if|try|take|give/,longer_alt:yn}),Pu=ls("do"),S0=ls("done"),O0=ls("else"),Zw=ls("while"),Xw=ls("repeat"),qw=ls("waitfor"),Jw=Gt({name:"foreach",pattern:/foreach|for/,longer_alt:yn}),Qw=ls("break"),tE=ls("continue");function eE(t){return[...t,Lw,Mw,Uw,Pw,Fw,Dw,Bw,E0,x0,v0,k0,T0,$w,jw,A0,Kw,zw,Ww,Hw,Gw,Cw,yn]}const nE=eE([Rw,w0,Yw,Vw,qo,Sw,Ow,Iw,Nw,Ac,zU,Qw,tE,S0,Pu,O0,Jw,R0,Xw,qw,Zw]),HU=new tn({defaultMode:"use_newlines",modes:{use_newlines:nE,ignore_newlines:eE([KU])}},{skipValidations:!di,ensureOptimizations:di,positionTracking:"full"});function rE(t){Aw=!0;const e=HU.tokenize(t||` 
`),[n]=(ce(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(Tu(Ac,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function GU(t,e,n=!0){if(n){const[r,...i]=e;switch(It(r??"")){default:return{type:vt.OBJECT,values:e};case"loader":return{type:vt.LOADER,values:i};case"board":return{type:vt.BOARD,values:i};case"object":return{type:vt.OBJECT,values:i};case"terrain":return{type:vt.TERRAIN,values:i};case"charset":return{type:vt.CHARSET,values:i};case"palette":return{type:vt.PALETTE,values:i}}}else{const[r,i,...s]=e,o=It(i??""),a=[r,t,...s];switch(o){default:return{type:vt.CONST,values:e};case"rn":case"range":return{type:vt.RANGE,values:a};case"sl":case"select":return{type:vt.SELECT,values:a};case"nm":case"number":return{type:vt.NUMBER,values:a};case"tx":case"text":return{type:vt.TEXT,values:a};case"hk":case"hotkey":return{type:vt.HOTKEY,values:a};case"copyit":return{type:vt.COPYIT,values:a};case"openit":return{type:vt.OPENIT,values:a};case"zssedit":return{type:vt.ZSSEDIT,values:a};case"charedit":return{type:vt.CHAREDIT,values:a};case"coloredit":return{type:vt.COLOREDIT,values:a}}}}function sr(t){switch(t){case vt.LOADER:return"loader";case vt.BOARD:return"board";case vt.OBJECT:return"object";case vt.TERRAIN:return"terrain";case vt.CHARSET:return"charset";case vt.PALETTE:return"palette";case vt.CONST:return"const";case vt.RANGE:return"range";case vt.SELECT:return"select";case vt.NUMBER:return"number";case vt.TEXT:return"text";case vt.HOTKEY:return"hotkey";case vt.COPYIT:return"copyit";case vt.OPENIT:return"openit";case vt.ZSSEDIT:return"zssedit";case vt.CHAREDIT:return"charedit";case vt.COLOREDIT:return"coloredit"}}var I0=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(I0||{});function iE(t){return jo(t,I0,{bits:e=>Array.from(e)})}function sE(t){return nc(t,I0,{bits:e=>new Uint8Array(e)})}function YU(t,e){return{id:Pe(),code:t,...e}}var N0=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(N0||{});function VU(t){return jo(t,N0,{board:qI,object:jl,terrain:jl,charset:iE,palette:iE,stats:Re})}function ZU(t){return nc(t,N0,{board:JI,object:zl,terrain:zl,charset:sE,palette:sE})}function Rc(t){const e={...Zs(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function XU(t){return x(t)?(t.stats=void 0,Zs(t)):{}}function oE(t){const e=rE(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===w0){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=GU(wt(c)?c:"",l,r),f=It(u.values.join(" "));switch(r=!1,u.type){case vt.LOADER:n.type=_t.LOADER,n.name=f;break;case vt.BOARD:n.type=_t.BOARD,n.name=f;break;case vt.OBJECT:n.type=_t.OBJECT,n.name=f||"object";break;case vt.TERRAIN:n.type=_t.TERRAIN,n.name=f;break;case vt.CHARSET:n.type=_t.CHARSET,n.name=f;break;case vt.PALETTE:n.type=_t.PALETTE,n.name=f;break;case vt.CONST:{const[d,h]=u.values;if(wt(d)){const p=It(d);if(wt(h)){const m=parseFloat(h);n[p]=At(m)?m:h}else At(h)?n[p]=h:n[p]=1}break}case vt.RANGE:case vt.SELECT:case vt.NUMBER:case vt.TEXT:case vt.HOTKEY:case vt.ZSSEDIT:case vt.CHAREDIT:case vt.COLOREDIT:{const[d,...h]=u.values;if(wt(d)){const p=It(d);n[p]=[sr(u.type),...h]}break}}}}return n}function Zs(t){var e;return x(t)?(x((e=t.stats)==null?void 0:e.type)||(t.stats=oE(t.code),x(t.stats.type)||(t.stats.type=_t.OBJECT)),t.stats):{}}function aE(t){switch(t){default:case _t.ERROR:return"error";case _t.LOADER:return sr(vt.LOADER);case _t.BOARD:return sr(vt.BOARD);case _t.OBJECT:return sr(vt.OBJECT);case _t.TERRAIN:return sr(vt.TERRAIN);case _t.CHARSET:return sr(vt.CHARSET);case _t.PALETTE:return sr(vt.PALETTE)}}function Bi(t){return Zs(t).type??_t.ERROR}function us(t){return aE(Bi(t))}function We(t){return Zs(t).name??""}function C0(t,e){return Zs(t)[e]}const Du=new rd;function L0(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(!ce(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"group":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[i]=t[i];break;case"ispushable":e.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=zt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=zt.ISSWIM;break;case"issolid":e.collision=zt.ISSOLID;break;case"isbullet":e.collision=zt.ISBULLET;break;case"isdestructible":e.destructible=1;break}}}function Ce(t){var e;if(x(t))switch(Bi(t)){default:return;case _t.ERROR:return t.code??"";case _t.LOADER:return t.code??"";case _t.BOARD:{x(t.board)||(t.board=bd()),t.board.id=t.id;const n=Rc(t);return t.board.isdark=n.isdark??t.board.isdark?1:0,t.board.startx=n.startx??t.board.startx,t.board.starty=n.starty??t.board.starty,t.board.over=n.over??t.board.over,t.board.under=n.under??t.board.under,t.board.camera=n.camera??t.board.camera,t.board.graphics=n.graphics??t.board.graphics,t.board.facing=n.facing??t.board.facing,t.board.exitnorth=n.exitnorth??t.board.exitnorth,t.board.exitsouth=n.exitsouth??t.board.exitsouth,t.board.exitwest=n.exitwest??t.board.exitwest,t.board.exiteast=n.exiteast??t.board.exiteast,t.board.timelimit=n.timelimit??t.board.timelimit,t.board.restartonzap=n.restartonzap??t.board.restartonzap,t.board.maxplayershots=n.maxplayershots??t.board.maxplayershots,t.board}case _t.OBJECT:return x(t.object)||(t.object=Zy()),t.object.id=t.id,t.object.name=We(t),t.object.category=fr.ISOBJECT,L0(Rc(t),t.object),t.object;case _t.TERRAIN:return x(t.terrain)||(t.terrain=Zy()),t.terrain.id=t.id,t.terrain.name=We(t),t.terrain.category=fr.ISTERRAIN,L0(Rc(t),t.terrain),t.terrain;case _t.PALETTE:{if(x(t.palette)||(t.palette=kd(rb)),x((e=t.palette)==null?void 0:e.bits)){const n=Rc(t),r=hr(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&wt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Du.set(o);const c=a*oc,l=Du.r*63,u=Du.g*63,f=Du.b*63;t.palette.bits[c+0]=qe(l,0,63),t.palette.bits[c+1]=qe(u,0,63),t.palette.bits[c+2]=qe(f,0,63)}}}}return t.palette}case _t.CHARSET:return x(t.charset)||(t.charset=nb(gN)),t.charset}}function cE(t){return{id:Pe(),name:Qx(),timestamp:0,activelist:[],pages:t,flags:{}}}var M0=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t[t.token=6]="token",t))(M0||{});function qU(t){return jo(t,M0,{pages:e=>e.map(VU),flags:e=>{const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(e[i]).length===0&&delete e[i]}return e}})}function JU(t){return nc(t,M0,{pages:e=>e.map(ZU)})}function lE(t){x(t)&&(t.token=`${tv()}${yr(1111,9999)}`)}function Pi(t,e){if(!x(t))return;const n=It(e);return t.pages.find(i=>i.id===e||n===We(i))}function en(t,e,n){if(!x(t))return;const r=It(n);return t.pages.find(s=>Bi(s)===e&&(s.id===n||r===We(s)))}function U0(t,e,n){let r=en(t,e,n);if(!x(r)){const i=aE(e);r=YU(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),hE(t,r)}return r}function Xs(t,e){return x(t)?t.pages.filter(n=>Bi(n)===e):[]}function zn(t,e,n){if(!x(t))return[];const r=It(n);return t.pages.filter(s=>Bi(s)===e).filter(s=>{const o=Zs(s),a=It(We(s));return s.id===n||r===a||x(o[n])})}function F0(t){return x(t)?Zn(t.pages).sort((n,r)=>{const i=Bi(n),s=Bi(r);return i===s?We(n).localeCompare(We(r)):s-i}):[]}function uE(t,e){if(x(e)){const n=en(t,_t.TERRAIN,e.kind??"");if(x(n))return n;const r=en(t,_t.OBJECT,e.kind??"");if(x(r))return r}}function hE(t,e){if(!x(t)||!x(e))return!1;const n=Pi(t,e.id);return x(n)?!1:(t.pages.push(e),lE(t),!0)}function fE(t,e){const n=Pi(t,e);if(x(t)&&x(n)){const r=It(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==We(i)),lE(t),n}}function Di(t,e){if(x(e)&&x(e.kind))return x(e.kinddata)||(e.kinddata=x(e.id)?qs(t,e.kind):Sc(t,e.kind)),e.kinddata}function He(t,e,n){const r=Di(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])??C0(Pi(t,(r==null?void 0:r.id)??""),n)}let QU=0;function hs(t,e){const n=He(t,e,"group");if(wt(n))return n;const r=He(t,e==null?void 0:e.kinddata,"group");return wt(r)?r:`group${QU++}`}function $u(t,e,n,r,i){const s=Di(t,e);return{char:(e==null?void 0:e.char)??(s==null?void 0:s.char)??n,color:(e==null?void 0:e.color)??(s==null?void 0:s.color)??r,bg:(e==null?void 0:e.bg)??(s==null?void 0:s.bg)??i,light:(e==null?void 0:e.light)??(s==null?void 0:s.light)??0}}function qs(t,e){const n=e??"",r=en(t,_t.OBJECT,n);if(x(r)){const i=Ce(r);return{...Zn(i),name:n,code:r.code}}}function Sc(t,e){const n=e??"",r=en(t,_t.TERRAIN,n);if(x(r)){const i=Ce(r);return{...Zn(i),name:n,code:r.code}}}function fs(t,e){const n=Pi(t,e);return Ce(n)}function tF(t,e){return!!(t!=null&&t.flags[e])}function $i(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function dE(t,e){t&&delete t.flags[e]}function pE(t,e,n){const r=$i(t,e);return r==null?void 0:r[n]}function eF(t,e,n,r){const i=$i(t,e);return i&&(i[n]=r),r}function Js(t,e){const n=pE(t,e,"board");return fs(t,wt(n)?n:"")}function nF(t,e){return(t==null?void 0:t.activelist.includes(e))??!1}function ju(t,e,n){if(!x(t))return;eF(t,e,"board",n);const r=fs(t,n);x(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function Jo(t,e,n,r){if(!x(t))return;const i=Js(t,e);if(!x(i))return;const s=Rn(i,e);if(!En(s)||!(s!=null&&s.id))return;const o=fs(t,n);if(!x(o)||(Ge(t,o),$0(t,o,zt.ISWALK,r)))return;delete i.objects[s.id];const a=Ur(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Ur(o,s);o.lookup&&(o.lookup[c]=s.id),ju(t,e,o.id)}function rF(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=pE(t,r,"board");return wt(i)?i:""});return yI(n)}function B0(t){const e=rF(t),n=new Set,r=[];for(let i=0;i<e.length;++i){const s=fs(t,e[i]);if(x(s)&&!n.has(s.id)){if(wt(s.over))if(wt(s.overboard)){const o=fs(t,s.overboard);x(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=zn(t,_t.BOARD,s.over);if(o.length){const a=Ae(o),c=Ce(a);x(c)&&(s.overboard=c.id)}}else wt(s.overboard)&&delete s.overboard;if(r.push(s),wt(s.under))if(wt(s.underboard)){const o=fs(t,s.underboard);x(o)||delete s.underboard}else{const o=zn(t,_t.BOARD,s.under);if(o.length){const a=Ae(o),c=Ce(a);x(c)&&(s.underboard=c.id)}}else wt(s.underboard)&&delete s.underboard}}return r}function iF(t,e,n,r,i){if(!x(e))return;x(e.distmaps)||(e.distmaps={});const s=`${n}.${r.x}.${r.y}.${i.x}.${i.y}`;let o=e.distmaps[s];if(!x(o)){o=new Array(yd).fill(-2);const a=[{...i}];let c=0;for(;a.length;){const l=a.shift();if(x(l)&&Kl(l)){const u=Mo(l,St);if(o[u]===-2){const f=zo(e,l.x,l.y);Ko(n,He(t,f,"collision")??zt.ISWALK)||(o[u]=c,a.push({x:l.x,y:l.y-1},{x:l.x,y:l.y+1},{x:l.x-1,y:l.y},{x:l.x+1,y:l.y})),++c}}}e.distmaps[s]=o}return o}function mE(t,e){return Kl(t)?e[Mo(t,St)]:-1}function gE(t,e,n,r,i,s){if(!x(t)||!x(e))return;const o=iF(t,e,n,r,i);if(!x(o))return;const a=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let c;if(s){let l=s?0:1e4;for(let u=0;u<a.length;++u){const f=mE(a[u],o);f>=0&&f>l&&(l=f,c=a[u])}}else{let l=1e5;for(let u=0;u<a.length;++u){const f=mE(a[u],o);f>=0&&f<l&&(l=f,c=a[u])}}return c}function Ge(t,e){var a;if(!x(t)||!x(e)||x(e.lookup)&&x(e.named))return;const n=new Array(St*Jt).fill(void 0),r={},i=Object.values(e.objects);for(let c=0;c<i.length;++c){const l=i[c];if(x(l.x)&&x(l.y)&&x(l.id)&&!x(l.removed)){l.category=fr.ISOBJECT,n[l.x+l.y*St]=l.id;const u=It(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<e.terrain.length;++c){const l=e.terrain[c];if(x(l)){l.x=s,l.y=o,l.category=fr.ISTERRAIN;const u=is(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=St&&(s=0,++o)}e.lookup=n,e.named=r}function zu(t,e){x(e)&&(delete e.named,delete e.lookup,Ge(t,e))}function _E(t,e,n,r){var s;if(!x(t)||!x(e)||!x(e.named)||!x(n))return;const i=It(n.name??((s=n.kinddata)==null?void 0:s.name)??"");e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function sF(t,e,n){if(!(!x(t)||!x(e)||!x(e.lookup)||!x(n==null?void 0:n.id))&&!x(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*St]=n.id}}function oF(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.x)&&x(n.y)){const i=is(n),s=Ur(e,n);x((r=e.named)==null?void 0:r[i])&&e.named[i].delete(s)}}function P0(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.id)){if(x(e.lookup)&&x(n.x)&&x(n.y)){const s=n.x+n.y*St;e.lookup[s]===n.id&&(e.lookup[s]=void 0)}const i=is(n);x((r=e.named)==null?void 0:r[i])&&x(n.id)&&e.named[i].delete(n.id)}}function D0(t,e,n,r,i,s){const o=pt.MID;if(!x(t)||!x(e)||!x(n))return{dir:i,startpt:s,destpt:s,layer:o};const a={x:n.x??0,y:n.y??0},c={x:n.lx??a.x,y:n.ly??a.y},l=Ri(c,a),u=St-1,f=Jt-1;for(let d=0;d<i.length;++d){const h=wI(i[d]);switch(h){case pt.IDLE:break;case pt.NORTH:case pt.SOUTH:case pt.WEST:case pt.EAST:ze(a,h);break;case pt.BY:{const[p,m]=i.slice(d+1);At(p)&&At(m)&&(a.x=qe(a.x+p,0,u),a.y=qe(a.y+m,0,f)),d+=2;break}case pt.TO:case pt.AT:{const[p,m]=i.slice(d+1);At(p)&&At(m)&&(a.x=qe(p,0,u),a.y=qe(m,0,f)),d+=2;break}case pt.FLOW:ze(a,l);break;case pt.SEEK:{const p=nN(e,n,r);Po(p)&&ze(a,Ri(s,p));break}case pt.RNDNS:ze(a,Ae(pt.NORTH,pt.SOUTH));break;case pt.RNDNE:ze(a,Ae(pt.NORTH,pt.EAST));break;case pt.RND:ze(a,Ae(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));break;case pt.CW:case pt.CCW:case pt.OPP:case pt.RNDP:{const p=D0(t,e,n,r,i.slice(d+1),s);switch(a.x=s.x,a.y=s.y,h){case pt.CW:switch(Ri(s,p.destpt)){case pt.NORTH:ze(a,pt.EAST);break;case pt.SOUTH:ze(a,pt.WEST);break;case pt.EAST:ze(a,pt.SOUTH);break;case pt.WEST:ze(a,pt.NORTH);break}break;case pt.CCW:switch(Ri(s,p.destpt)){case pt.NORTH:ze(a,pt.WEST);break;case pt.SOUTH:ze(a,pt.EAST);break;case pt.EAST:ze(a,pt.NORTH);break;case pt.WEST:ze(a,pt.SOUTH);break}break;case pt.OPP:switch(Ri(s,p.destpt)){case pt.NORTH:ze(a,pt.SOUTH);break;case pt.SOUTH:ze(a,pt.NORTH);break;case pt.EAST:ze(a,pt.WEST);break;case pt.WEST:ze(a,pt.EAST);break}break;case pt.RNDP:switch(Ri(s,p.destpt)){case pt.NORTH:case pt.SOUTH:a.x+=Ae(-1,1);break;case pt.WEST:case pt.EAST:a.y+=Ae(-1,1);break}break}break}case pt.FLEE:case pt.AWAY:{const[p,m]=i.slice(d+1);if(At(p)&&At(m)){const b={x:qe(p,0,u),y:qe(m,0,f)},w=He(t,n,"collision"),k=gE(t,e,w,a,b,!0);x(k)&&(a.x=k.x,a.y=k.y)}d+=2;break}case pt.FIND:case pt.TOWARD:{const[p,m]=i.slice(d+1);if(At(p)&&At(m)){const b={x:qe(p,0,u),y:qe(m,0,f)};if(yr(1,100)<5)ze(a,Ae(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));else{const w=He(t,n,"collision"),k=gE(t,e,w,a,b,!1);if(x(k))if(k.x!==p&&k.y!==m&&eN(e,k))switch(Ri(s,k)){case pt.EAST:case pt.WEST:a.y+=Ae(-1,1);break;case pt.NORTH:case pt.SOUTH:a.x+=Ae(-1,1);break}else a.x=k.x,a.y=k.y}}d+=2;break}case pt.PLAYER:{const p=ic(e,s,r);Po(p)&&(a.x=p.x,a.y=p.y);break}case pt.OVER:case pt.UNDER:{const p=D0(t,e,n,r,i.slice(d+1),s);return p.layer=h,p}}}return{dir:i,startpt:s,destpt:a,layer:o}}function aF(t,e,n,r){if(x(t)&&x(e)&&x(n)){const[i,s]=n,o=qs(t,i);if(x(o)&&x(o.name)){const a=xd(e,r,i);return rc(a,s),a}}}function ds(t,e,n,r,i){if(x(t)&&x(e)&&x(n)){const[s,o]=n,a=Sc(t,s);if(x(a)){const l=tN(e,r,s);if(x(l)){rc(l,o);const u=Mo(r,St);return Di(t,l),_E(t,e,l,u),l}}const c=qs(t,s);if(x(c)&&x(c.name)){const l=xd(e,r,s,i);if(x(l))return rc(l,o),sF(t,e,l),Di(t,l),_E(t,e,l),l}}}function or(t,e,n,r){return!x(n)||is(n)==="player"?!1:(n.id?(n.removed=r,P0(t,e,n)):(un(e,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),oF(t,e,n)),!0)}function $0(t,e,n,r){if(!x(t)||!x(e)||!x(e.lookup)||r.x<0||r.x>=St||r.y<0||r.y>=Jt)return!0;const i=r.x+r.y*St,s=Rn(e,e.lookup[i]??"404");if(x(s))return!0;const o=e.terrain[i];return x(o)?Ko(n,He(t,o,"collision")??zt.ISWALK):!1}function cF(t,e,n,r){const i=Rn(e,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=He(t,i,"collision");return $0(t,e,a,r)}function j0(t,e,n,r){var d;const i=Rn(e,(n==null?void 0:n.id)??"");if(!x(t)||!x(e)||!x(i)||!x(i.x)||!x(i.y)||!x(e.lookup)||!x(n)||r.x<0||r.x>=St||r.y<0||r.y>=Jt)return{name:"edge",kind:"edge",collision:zt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Ur(e,i),o=Ur(e,r),a=He(t,i,"collision")??zt.ISWALK,c=Kr(i==null?void 0:i.id),l=Rn(e,e.lookup[o]??""),u=Kr((l==null?void 0:l.id)??"");if(x(l)&&(!c||!u)&&hs(t,n)!==hs(t,l)){if(!!He(t,l,"pushable")){const p={x:r.x-(n.x??0),y:r.y-(n.y??0)};j0(t,e,l,p)}return{...l}}const f=e.terrain[o];if(x(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??zt.ISWALK;if(Ko(a,h))return{...f,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,x(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function lF(t,e,n){const r=[];if(!x(t)||!x(e))return r;const i=Object.values(e.objects);for(let s=0;s<i.length;++s){const o=i[s];x(o.id)&&x(o.removed)&&n-o.removed>rl*5&&(r.push(o.id),Xy(e,o.id))}return r}function uF(t,e,n){const r=[];if(!x(t)||!x(e))return r;e.lookup=void 0,Ge(t,e);const i=Object.values(e.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!x(a.id))continue;a.lx=a.x,a.ly=a.y;const c=Di(t,a),l=`${(c==null?void 0:c.code)??""}
${a.code??""}`;l&&r.push({id:a.id,type:_t.OBJECT,code:l,object:a,terrain:void 0})}const s=lF(t,e,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:_t.ERROR,code:"",object:void 0,terrain:void 0});return r}function hF(t,e,n){const r=[],i=[];if(!x(t)||!x(e))return{objectelements:r,terrainelements:i};function s(a){const c=He(t,a,n);return x(c)||hs(t,a)===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c)&&r.push(c)}for(let a=0;a<yd;++a){const c=e.terrain[a];x(c)&&s(c)&&i.push(c)}return{objectelements:r,terrainelements:i}}var yE={exports:{}},z0={exports:{}},bE;function fF(){return bE||(bE=1,function(t,e){(function(n,r){t.exports=r()})(Cn,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(m){if(m)for(var b=0;b<u.length;b++)m[u[b]]!==void 0&&this["set"+r(u[b])](m[u[b]])}f.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof f)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new f(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",b=this.getLineNumber()||"",w=this.getColumnNumber()||"",k=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+b+":"+w+")":"[eval]:"+b+":"+w:k?k+" ("+m+":"+b+":"+w+")":m+":"+b+":"+w}},f.fromString=function(b){var w=b.indexOf("("),k=b.lastIndexOf(")"),T=b.substring(0,w),A=b.substring(w+1,k).split(","),C=b.substring(k+1);if(C.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(C,""),S=R[1],F=R[2],N=R[3];return new f({functionName:T,args:A||void 0,fileName:S,lineNumber:F||void 0,columnNumber:N||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(m){return function(b){this[m]=!!b}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(m){return function(b){if(!n(b))throw new TypeError(m+" must be a Number");this[m]=Number(b)}}(o[h]);for(var p=0;p<a.length;p++)f.prototype["get"+r(a[p])]=i(a[p]),f.prototype["set"+r(a[p])]=function(m){return function(b){this[m]=String(b)}}(a[p]);return f})}(z0)),z0.exports}(function(t,e){(function(n,r){t.exports=r(fF())})(Cn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),p=d&&f||void 0,m=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:p,fileName:m,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",p=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;h.match(/\(([^)]*)\)/)&&(m=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(yE);var dF=yE.exports,pF=ro(dF);function ji(t){const e={},n={tick(){},everytick(){},listcommands(){return hr(e)},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}function be(t){return`${t??""}`}function Oc(t,e){const n=parseFloat(be(t));return isNaN(n)?e:n}function wE(t,e,n){var i;const[r]=rt(e,0,[z.MAYBE_NAME]);zA(et,t,((i=y.board)==null?void 0:i.id)??"",r??"",n)}function Kn(t,e,n,r){const[i,s]=rt(r,0,[z.NUMBER_OR_STRING,z.MAYBE_NUMBER_OR_STRING]);ig(et,t,e,n,i,s)}const mF=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function EE(t,e,n){const[r,i]=rt(n,0,[z.NUMBER_OR_STRING]);if(At(r))ef(et,t,e,"volume",r);else if(mF.includes(It(r))){const[s,o]=rt(n,i,[z.NUMBER_OR_STRING,z.MAYBE_NUMBER_OR_STRING]);ig(et,t,e,r,s,o)}else{const[s]=rt(n,i,[z.MAYBE_NUMBER_OR_STRING]);if(At(s)){const o=n.length-i,a=new Array(o).fill(z.NUMBER),c=rt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;ef(et,t,e,r,l)}else{const[o]=rt(n,i,[z.MAYBE_NUMBER_OR_STRING]);ef(et,t,e,r,o)}}}const K0=ji().command("talk",(t,e)=>{const[n]=rt(e,0,[z.ANY]);switch(It(n)){default:kA(et,y.elementfocus);break;case"stop":TA(et,y.elementfocus);break}return 0}).command("media",(t,e)=>{const[n]=rt(e,0,[z.ANY]);switch(It(n)){default:AA(et,y.elementfocus);break;case"stop":RA(et,y.elementfocus);break}return 0}).command("tts",(t,e)=>{const[n,r]=rt(e,0,[z.STRING]),i=e.slice(r).map(be).join("");return $A(et,y.elementfocus,n,i),0}).command("tta",(t,e)=>{const n=e.map(be).join("");return jA(et,y.elementfocus,n),0}).command("bpm",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return WA(et,y.elementfocus,n),0}).command("vol",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return HA(et,y.elementfocus,n),0}).command("bgvol",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return GA(et,y.elementfocus,n),0}).command("ttsvol",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return YA(et,y.elementfocus,n),0}).command("play",(t,e)=>(wE(y.elementfocus,e,!1),0)).command("bgplay",(t,e)=>(wE(y.elementfocus,e,!0),0)).command("synth",(t,e)=>{for(let n=0;n<8;++n)EE(y.elementfocus,n,e);return 0}).command("echo",(t,e)=>{for(let n=0;n<3;++n)Kn(y.elementfocus,n,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let n=0;n<3;++n)Kn(y.elementfocus,n,"fc",e);return 0}).command("phaser",(t,e)=>{for(let n=0;n<3;++n)Kn(y.elementfocus,n,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let n=0;n<3;++n)Kn(y.elementfocus,n,"reverb",e);return 0}).command("distort",(t,e)=>{for(let n=0;n<3;++n)Kn(y.elementfocus,n,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let n=0;n<3;++n)Kn(y.elementfocus,n,"vibrato",e);return 0}).command("autowah",(t,e)=>{for(let n=0;n<3;++n)Kn(y.elementfocus,n,"autowah",e);return 0});for(let t=0;t<8;++t)K0.command(`synth${t+1}`,(e,n)=>(EE(y.elementfocus,t,n),0));for(let t=0;t<3;++t){const e=t+1;K0.command(`echo${e}`,(n,r)=>(Kn(y.elementfocus,t,"echo",r),0)).command(`fcrush${e}`,(n,r)=>(Kn(y.elementfocus,t,"fcrush",r),0)).command(`phaser${e}`,(n,r)=>(Kn(y.elementfocus,t,"phaser",r),0)).command(`reverb${e}`,(n,r)=>(Kn(y.elementfocus,t,"reverb",r),0)).command(`distort${e}`,(n,r)=>(Kn(y.elementfocus,t,"distort",r),0)).command(`vibrato${e}`,(n,r)=>(Kn(y.elementfocus,t,"vibrato",r),0)).command(`autowah${e}`,(n,r)=>(Kn(y.elementfocus,t,"autowah",r),0))}const gF=fy(32,126).map(t=>String.fromCharCode(t)),_F=ir({name:"Whitespace",pattern:/ +/}),yF=ir({name:"WhitespaceSkipped",pattern:/ +/,group:tn.SKIPPED}),W0=ir({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),xE=ir({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:gF}),H0=ir({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),G0=ir({name:"EscapedDollar",pattern:"$$"}),Y0=ir({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),V0=ir({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),vE=ir({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function bF(t,e=""){return ir({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const kE=Object.keys(Ja).map(t=>bF(`\\$(${t})`,t)),wF=[_F,W0,...kE,H0,xE,V0,G0,vE,Y0],EF=new tn(wF,{skipValidations:!di,ensureOptimizations:di}),xF=new tn([yF,W0,...kE,H0,xE,V0,G0,vE,Y0],{skipValidations:!di,ensureOptimizations:di});function Z0(t,e=!1){return e?xF.tokenize(t):EF.tokenize(t)}function X0(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function TE(t){t.active={...t.reset}}function AE(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case G0:s("$");break;case V0:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case H0:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case W0:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=Ja[l],f=xI(Rt[u]),d=vI(Rt[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):x(f)?e.active.color=f:x(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(x(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){TE(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;kF(u,u+l.length,e.active.color,e.active.bg,e),vF(u,l,e)}}}function RE(t,e,n){const r=Z0(t);r.tokens&&(AE(r.tokens,e),n&&TE(e),e.changed())}function SE(t,e,n){const r=Z0(t);if(!r.tokens)return;const i=X0(e,n,Rt.WHITE,Rt.BLACK);return i.measureonly=!0,AE(r.tokens,i),i.x>0&&++i.y,i}function vF(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function kF(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function OE(t,e,n){if(!Po(y.element))return 0;const[r,i]=rt(e,0,[z.DIR,z.MAYBE_KIND]),s=i??["bullet"],o=aF(y.book,y.board,s,{x:y.element.x,y:y.element.y});if(x(o)){x(n)&&(o.arg=n),o.party=y.elementid,o.collision=zt.ISBULLET,o.destructible=1,o.stepx=r.destpt.x-y.element.x,o.stepy=r.destpt.y-y.element.y,o.bg=Rt.ONCLEAR;const a=Di(y.book,o),c=o.code??(a==null?void 0:a.code)??"";vx(y.book,y.board,o,c,1)}return t.yield(),0}function Ku(t,e,n,r){var u,f;if(!Po(y.element)||!x(y.book)||!x(y.board)||!x(y.element))return 0;Ge(y.book,y.board);const[i,s]=rt(e,0,[z.DIR,z.KIND]),o=ge(y.board,i.destpt);if((o==null?void 0:o.category)===fr.ISOBJECT&&(o!=null&&o.pushable)){const d={x:((u=y.element)==null?void 0:u.x)??0,y:((f=y.element)==null?void 0:f.y)??0},h=ze(i.destpt,Ri(d,i.destpt));j0(y.book,y.board,o,h)}const[a]=s,c=Sc(y.book,a);x(c)&&ds(y.book,y.board,s,i.destpt,n);const l=qs(y.book,a);if(x(l)){const d=qs(y.book,a)??Sc(y.book,a),h=He(y.book,d,"collision")??zt.ISWALK;if(!$0(y.book,y.board,h,i.destpt)){const m=ds(y.book,y.board,s,i.destpt,n);x(m)&&x(r)&&(m.arg=r)}}return 0}const TF=ji().command("board",(t,e)=>{if(!x(y.book)||!x(y.board))return 0;const[n,r]=rt(e,0,[z.NAME]),[i,s]=rt(e,r,[z.MAYBE_NUMBER,z.MAYBE_NUMBER]),o=zn(y.book,_t.BOARD,n);if(o.length){const a=Ae(...o);x(a)&&Jo(y.book,y.elementfocus,a.id,{x:i??Math.round(St*.5),y:s??Math.round(Jt*.5)})}return 0}).command("edge",(t,e)=>{var s,o;if(!x(y.book)||!x(y.board)||!x(y.element))return 0;const[n,r]=rt(e,0,[z.DIR,z.NAME]),i=zn(y.book,_t.BOARD,r);if(i.length){const a={x:((s=y.element)==null?void 0:s.x)??0,y:((o=y.element)==null?void 0:o.y)??0},c=Ri(a,n.destpt),l=Ae(...i);switch(c){case pt.NORTH:y.board.exitnorth=l.id;break;case pt.SOUTH:y.board.exitsouth=l.id;break;case pt.WEST:y.board.exitwest=l.id;break;case pt.EAST:y.board.exiteast=l.id;break}}return 0}).command("shove",(t,e)=>{if(!x(y.book)||!x(y.board))return 0;Ge(y.book,y.board);const[n,r]=rt(e,0,[z.DIR,z.DIR]),i=ge(y.board,n.destpt);return En(i)&&la(y.book,y.board,i,r.destpt),0}).command("duplicate",(t,e)=>{if(!x(y.book)||!x(y.board))return 0;Ge(y.book,y.board);const[n,r]=rt(e,0,[z.DIR,z.DIR]),i=ge(y.board,n.destpt);return En(i),0}).command("write",(t,e)=>{var l;if(!x(y.book)||!x(y.board))return 0;Ge(y.book,y.board);const[n,r,i]=rt(e,0,[z.DIR,z.COLOR,z.STRING]),{color:s,bg:o}=wy(r),a=((l=SE(i,256,1))==null?void 0:l.measuredwidth)??1,c=X0(256,1,s??Rt.WHITE,o??Rt.BLACK);RE(i,c,!1);for(let u=0;u<a;++u)un(y.board,{x:n.destpt.x+u,y:n.destpt.y,name:"text",char:c.char[u],color:c.color[u],bg:c.bg[u]});return 0}).command("change",(t,e)=>{if(!x(y.book)||!x(y.board))return 0;Ge(y.book,y.board);const[n,r]=rt(e,0,[z.KIND,z.KIND]);(ld(n)??"")==="empty"&&rN(y.board).forEach(c=>{ds(y.book,y.board,r,c)});const s=ld(r),o=xy(r),a=vy(r);return qy(y.board,n).forEach(c=>{if(is(c)===s)x(o)&&(c.color=o),x(a)&&(c.bg=a);else if(or(y.book,y.board,c,y.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};ds(y.book,y.board,r,l)}}),0}).command("put",(t,e)=>Ku(t,e)).command("putwith",(t,e)=>{const[n,r]=rt(e,0,[z.ANY]);return Ku(t,e.slice(r),void 0,n)}).command("oneof",(t,e)=>{const[n,r]=rt(e,0,[z.ANY]);return x(y.board)&&Rn(y.board,n)?0:Ku(t,e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=rt(e,0,[z.ANY,z.ANY]);return x(y.board)&&Rn(y.board,r)?0:Ku(t,e.slice(i),r,n)}).command("shoot",OE).command("shootwith",(t,e)=>{const[n,r]=rt(e,0,[z.ANY]);return OE(t,e.slice(r),n)}),ps="$dkpurple",AF="$196",RF="$205",hn="$yellow$205$205$205$196";function Le(t,e,n){_A(t,e,n)}function SF(t,e,n){const r=AF.repeat(n);Le(t,e,`${ps}${r}`)}function q0(t,e,n){const r=RF.repeat(n);Le(t,e,`${ps}${r}`)}function J0(t,e,n){Le(t,e,`${ps} ${" ".repeat(n.length)} `),SF(t,e,n.length+2),Le(t,e,`${ps} $white${n} `),q0(t,e,n.length+2)}function Qs(t,e,n){Le(t,e,`${ps} ${" ".repeat(n.length)} `),Le(t,e,`${ps} $gray${n} `),q0(t,e,n.length+2)}function Ic(t,e,n,r){Le(t,e,`${ps} $white${n} $blue${r}`)}function Wn(t,e,n){Le(t,e,`${ps}$blue${n}`)}function OF(t,e,n,r){Le(t,e,`!${n};${r}`)}function IE(t){const[e,n]=t.split(":"),r=x(n);return[r?e:"self",r?n:t]}var IF=`desc;$DKGRAYname and type of codepage
`,NF=Object.freeze({__proto__:null,default:IF}),CF="desc;changes object into specified element",LF=Object.freeze({__proto__:null,default:CF}),MF="desc;like #play but for sound effects",UF=Object.freeze({__proto__:null,default:MF}),FF="",BF=Object.freeze({__proto__:null,default:FF}),PF="",DF=Object.freeze({__proto__:null,default:PF}),$F="",jF=Object.freeze({__proto__:null,default:$F}),zF="",KF=Object.freeze({__proto__:null,default:zF}),WF="",HF=Object.freeze({__proto__:null,default:WF}),GF="",YF=Object.freeze({__proto__:null,default:GF}),VF="",ZF=Object.freeze({__proto__:null,default:VF}),XF="",qF=Object.freeze({__proto__:null,default:XF}),JF="",QF=Object.freeze({__proto__:null,default:JF}),tB="",eB=Object.freeze({__proto__:null,default:tB}),nB="",rB=Object.freeze({__proto__:null,default:nB}),iB="",sB=Object.freeze({__proto__:null,default:iB}),oB="",aB=Object.freeze({__proto__:null,default:oB}),cB="",lB=Object.freeze({__proto__:null,default:cB}),uB="",hB=Object.freeze({__proto__:null,default:uB}),fB=`desc;$DKGRAYstarts a section of an if-do-done block
`,dB=Object.freeze({__proto__:null,default:fB}),pB=`desc;$DKGRAYcompletes an if-do-done block
`,mB=Object.freeze({__proto__:null,default:pB}),gB="",_B=Object.freeze({__proto__:null,default:gB}),yB="",bB=Object.freeze({__proto__:null,default:yB}),wB="",EB=Object.freeze({__proto__:null,default:wB}),xB=`desc;$DKGRAYelse logic in an if-do-done block
`,vB=Object.freeze({__proto__:null,default:xB}),kB=`desc;$DKGRAYconditional else logic in an if-do-done block
`,TB=Object.freeze({__proto__:null,default:kB}),AB="",RB=Object.freeze({__proto__:null,default:AB}),SB="",OB=Object.freeze({__proto__:null,default:SB}),IB="",NB=Object.freeze({__proto__:null,default:IB}),CB="",LB=Object.freeze({__proto__:null,default:CB}),MB="",UB=Object.freeze({__proto__:null,default:MB}),FB="",BB=Object.freeze({__proto__:null,default:FB}),PB="",DB=Object.freeze({__proto__:null,default:PB}),$B="",jB=Object.freeze({__proto__:null,default:$B}),zB=`desc;$DKGRAYhalt until the next cycle
`,KB=Object.freeze({__proto__:null,default:zB}),WB=`desc;$DKGRAYevals condition for true or false
`,HB=Object.freeze({__proto__:null,default:WB}),GB="",YB=Object.freeze({__proto__:null,default:GB}),VB="",ZB=Object.freeze({__proto__:null,default:VB}),XB="",qB=Object.freeze({__proto__:null,default:XB}),JB="",QB=Object.freeze({__proto__:null,default:JB}),tP="",eP=Object.freeze({__proto__:null,default:tP}),nP="",rP=Object.freeze({__proto__:null,default:nP}),iP="",sP=Object.freeze({__proto__:null,default:iP}),oP="",aP=Object.freeze({__proto__:null,default:oP}),cP="",lP=Object.freeze({__proto__:null,default:cP}),uP="",hP=Object.freeze({__proto__:null,default:uP}),fP="",dP=Object.freeze({__proto__:null,default:fP}),pP="",mP=Object.freeze({__proto__:null,default:pP}),gP="",_P=Object.freeze({__proto__:null,default:gP}),yP="",bP=Object.freeze({__proto__:null,default:yP}),wP="",EP=Object.freeze({__proto__:null,default:wP}),xP="",vP=Object.freeze({__proto__:null,default:xP}),kP="",TP=Object.freeze({__proto__:null,default:kP}),AP="",RP=Object.freeze({__proto__:null,default:AP}),SP="",OP=Object.freeze({__proto__:null,default:SP}),IP="",NP=Object.freeze({__proto__:null,default:IP}),CP="",LP=Object.freeze({__proto__:null,default:CP}),MP=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,UP=Object.freeze({__proto__:null,default:MP}),FP="",BP=Object.freeze({__proto__:null,default:FP}),PP="",DP=Object.freeze({__proto__:null,default:PP}),$P="",jP=Object.freeze({__proto__:null,default:$P}),zP="",KP=Object.freeze({__proto__:null,default:zP}),WP="",HP=Object.freeze({__proto__:null,default:WP}),GP="",YP=Object.freeze({__proto__:null,default:GP}),VP="",ZP=Object.freeze({__proto__:null,default:VP}),XP="",qP=Object.freeze({__proto__:null,default:XP}),JP="",QP=Object.freeze({__proto__:null,default:JP}),tD="",eD=Object.freeze({__proto__:null,default:tD}),nD="",rD=Object.freeze({__proto__:null,default:nD}),iD="",sD=Object.freeze({__proto__:null,default:iD}),oD="",aD=Object.freeze({__proto__:null,default:oD}),cD="",lD=Object.freeze({__proto__:null,default:cD}),uD="",hD=Object.freeze({__proto__:null,default:uD}),fD="",dD=Object.freeze({__proto__:null,default:fD}),pD="",mD=Object.freeze({__proto__:null,default:pD}),gD="",_D=Object.freeze({__proto__:null,default:gD}),yD="",bD=Object.freeze({__proto__:null,default:yD}),wD=`desc;$DKGRAYdesignates an inactive label or comment
`,ED=Object.freeze({__proto__:null,default:wD}),xD=`desc;$DKGRAYadds hyperlink text

`,vD=Object.freeze({__proto__:null,default:xD}),kD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,TD=Object.freeze({__proto__:null,default:kD}),AD=`desc;$DKGRAYread number input into given stat/flag
`,RD=Object.freeze({__proto__:null,default:AD}),SD=`desc;$DKGRAYa slider input from 1 to 9 

`,OD=Object.freeze({__proto__:null,default:SD}),ID=`desc;$DKGRAYlist with label value pairs to pick from
`,ND=Object.freeze({__proto__:null,default:ID}),CD=`desc;$DKGRAYread text input into given stat/flag
`,LD=Object.freeze({__proto__:null,default:CD}),MD=`desc;$DKGRAYdesignates a starting point for running code
`,UD=Object.freeze({__proto__:null,default:MD}),FD=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,BD=Object.freeze({__proto__:null,default:FD}),PD=`desc;$DKGRAYwill move the object in the given direction
`,DD=Object.freeze({__proto__:null,default:PD}),$D=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,jD=Object.freeze({__proto__:null,default:$D}),zD=`desc;$DKGRAYcustom 8x14 charset
`,KD=Object.freeze({__proto__:null,default:zD}),WD=`desc;$DKGRAYsets stat to given value

`,HD=Object.freeze({__proto__:null,default:WD}),GD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,YD=Object.freeze({__proto__:null,default:GD}),VD=`desc;$DKGRAYread external content and/or handle events
`,ZD=Object.freeze({__proto__:null,default:VD}),XD=`desc;$DKGRAYread number input into given stat/flag
`,qD=Object.freeze({__proto__:null,default:XD}),JD=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,QD=Object.freeze({__proto__:null,default:JD}),t$=`desc;$DKGRAYcustom palette colors
`,e$=Object.freeze({__proto__:null,default:t$}),n$=`desc;$DKGRAYa slider input from 1 to 9 

`,r$=Object.freeze({__proto__:null,default:n$}),i$=`desc;$DKGRAYlist with label value pairs to pick from
`,s$=Object.freeze({__proto__:null,default:i$}),o$=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,a$=Object.freeze({__proto__:null,default:o$}),c$=`desc;$DKGRAYread text input into given stat/flag
`,l$=Object.freeze({__proto__:null,default:c$}),u$=`desc;$DKGRAYadds text
`,h$=Object.freeze({__proto__:null,default:u$}),f$=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,d$=Object.freeze({__proto__:null,default:f$}),p$=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,m$=Object.freeze({__proto__:null,default:p$}),g$=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,_$=Object.freeze({__proto__:null,default:g$}),y$=`header;player settings
#set user "name goes here"
`,b$=Object.freeze({__proto__:null,default:y$}),w$=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,E$=Object.freeze({__proto__:null,default:w$});const NE=Object.assign({"./editor/codepagename.txt":NF,"./editor/command/become.txt":LF,"./editor/command/bgplay.txt":UF,"./editor/command/bgvol.txt":BF,"./editor/command/bind.txt":DF,"./editor/command/board.txt":jF,"./editor/command/bpm.txt":KF,"./editor/command/break.txt":HF,"./editor/command/change.txt":YF,"./editor/command/char.txt":ZF,"./editor/command/charset.txt":qF,"./editor/command/clear.txt":QF,"./editor/command/color.txt":eB,"./editor/command/continue.txt":rB,"./editor/command/copy.txt":sB,"./editor/command/cycle.txt":aB,"./editor/command/die.txt":lB,"./editor/command/distort.txt":hB,"./editor/command/do.txt":dB,"./editor/command/done.txt":mB,"./editor/command/duplicate.txt":_B,"./editor/command/echo.txt":bB,"./editor/command/edge.txt":EB,"./editor/command/else.txt":vB,"./editor/command/elseif.txt":TB,"./editor/command/end.txt":RB,"./editor/command/endgame.txt":OB,"./editor/command/endwith.txt":NB,"./editor/command/fcrush.txt":LB,"./editor/command/fetch.txt":UB,"./editor/command/fetchwith.txt":BB,"./editor/command/foreach.txt":DB,"./editor/command/go.txt":jB,"./editor/command/idle.txt":KB,"./editor/command/if.txt":HB,"./editor/command/lock.txt":YB,"./editor/command/oneof.txt":ZB,"./editor/command/oneofwith.txt":qB,"./editor/command/palette.txt":QB,"./editor/command/phaser.txt":eP,"./editor/command/pivot.txt":rP,"./editor/command/play.txt":sP,"./editor/command/put.txt":aP,"./editor/command/putwith.txt":lP,"./editor/command/readbin.txt":hP,"./editor/command/readjson.txt":dP,"./editor/command/readline.txt":mP,"./editor/command/readrexpaint.txt":_P,"./editor/command/remix.txt":bP,"./editor/command/repeat.txt":EP,"./editor/command/restore.txt":vP,"./editor/command/reverb.txt":TP,"./editor/command/revert.txt":RP,"./editor/command/run.txt":OP,"./editor/command/runwith.txt":NP,"./editor/command/set.txt":LP,"./editor/command/shoot.txt":UP,"./editor/command/shootwith.txt":BP,"./editor/command/shove.txt":DP,"./editor/command/snapshot.txt":jP,"./editor/command/synth.txt":KP,"./editor/command/toast.txt":HP,"./editor/command/tts.txt":YP,"./editor/command/ttsvol.txt":ZP,"./editor/command/twitchbroadcast.txt":qP,"./editor/command/twitchchat.txt":QP,"./editor/command/unlock.txt":eD,"./editor/command/vibrato.txt":rD,"./editor/command/vol.txt":sD,"./editor/command/waitfor.txt":aD,"./editor/command/walk.txt":lD,"./editor/command/weave.txt":hD,"./editor/command/while.txt":dD,"./editor/command/with.txt":mD,"./editor/command/write.txt":_D,"./editor/command/zap.txt":bD,"./editor/comment.txt":ED,"./editor/hyperlink.txt":vD,"./editor/hyperlink/hotkey.txt":TD,"./editor/hyperlink/number.txt":RD,"./editor/hyperlink/range.txt":OD,"./editor/hyperlink/select.txt":ND,"./editor/hyperlink/text.txt":LD,"./editor/label.txt":UD,"./editor/shortgo.txt":BD,"./editor/shorttry.txt":DD,"./editor/stat/board.txt":jD,"./editor/stat/charset.txt":KD,"./editor/stat/const.txt":HD,"./editor/stat/hotkey.txt":YD,"./editor/stat/loader.txt":ZD,"./editor/stat/number.txt":qD,"./editor/stat/object.txt":QD,"./editor/stat/palette.txt":e$,"./editor/stat/range.txt":r$,"./editor/stat/select.txt":s$,"./editor/stat/terrain.txt":a$,"./editor/stat/text.txt":l$,"./editor/text.txt":h$,"./help/controls.txt":d$,"./help/developer.txt":m$,"./help/menu.txt":_$,"./help/player.txt":b$,"./help/text.txt":E$}),CE={};hr(NE).forEach(t=>{const e=t.replace(".txt","").replace("./","").replaceAll("/",":");CE[e]=NE[t].default});function x$(t){const e=It(t.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=CE[e];if(x(n))return n;const{target:r,path:i}=Xn(e);switch(r){case"editor":{const s=Xn(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function v$(t,e){const n=(t??"").split(`
`);for(let r=0;r<n.length;++r)e(n[r].split(";"))}function k$(t,e){const[n,...r]=e,i=r[0]??"",s=r[1]??"";switch(It(n.trim())){case"header":J0(et,t,i);break;case"section":Qs(et,t,i);break;case"option":Ic(et,t,i,s);break;default:n.trimStart().startsWith("!")?OF(et,t,n.trimStart().slice(1),i):Le(et,t,n);break}}function Qo(){ag(et,cr())}function Nc(t){v$(x$(`help:${t}`),e=>k$(y.elementfocus,e))}const T$=ji().command("send",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.ANY]);switch(It(n)){case"helpmenu":Nc("menu");break;case"helpcontrols":Nc("controls");break;case"helptext":Nc("text");break;case"helpdeveloper":Nc("developer");break;case"helpplayer":Nc("player");break;default:{const[i,s]=IE(n);mp(i==="self"&&y.elementisplayer?`${y.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(be),s=i.join(" ");switch(It(r)){case sr(vt.LOADER):n=bs(jt.CONTENT,s,_t.LOADER);break;default:n=bs(jt.CONTENT,[r,...i].join(" "),_t.OBJECT);break;case sr(vt.BOARD):n=bs(jt.CONTENT,s,_t.BOARD);break;case sr(vt.OBJECT):n=bs(jt.CONTENT,s,_t.OBJECT);break;case sr(vt.TERRAIN):n=bs(jt.CONTENT,s,_t.TERRAIN);break;case sr(vt.CHARSET):n=bs(jt.CONTENT,s,_t.CHARSET);break;case sr(vt.PALETTE):n=bs(jt.CONTENT,s,_t.PALETTE);break}return x(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(be).join(" ");if(x(y.element)&&y.elementisplayer){const{user:r}=Sr(y.elementid),i=wt(r)?r:"player";y.element.tickertext=`${i}: ${n}`,y.element.tickertime=y.timestamp;const s=$u(y.book,y.element,1,Rt.WHITE,Rt.BLACK);fe(et,y.elementid,`$${Rt[s.color]}$ON${Rt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),Ua(et,y.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=be(n),s=r.map(be).join(" "),{user:o}=Sr(y.elementid),a=wt(o)?o:"player",c=$u(y.book,y.element,1,Rt.WHITE,Rt.BLACK);return fe(et,y.elementid,`!${s};$${Rt[c.color]}$ON${Rt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`),0}).command("config",(t,e)=>{const[n,r]=rt(e,0,[z.MAYBE_NAME,z.MAYBE_STRING]);return wt(n)&&wt(r)?VA(et,y.elementfocus,n,r):ZA(et,y.elementfocus),0}).command("bookcreate",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]),r=yx(n);return x(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zr(n);return x(r)?(fe(et,y.elementfocus,`opened [book] ${r.name}`),sh(jt.MAIN,r.id),t.command("pages")):he(et,y.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=we(jt.MAIN),i=zr(n);return x(i)&&(r===i&&sh(jt.MAIN,""),v4(n),fe(et,y.elementfocus,`trashed [book] ${i.name}`),Qo(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zn(y.book,_t.BOARD,n);if(r.length){const i=Ae(...r);x(i)&&Jo(y.book,y.elementfocus,i.id,{x:yr(0,St-1),y:yr(0,Jt-1)})}return 0}).command("pageopen",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.MAYBE_NAME]),i=vn(jt.MAIN);if(!x(i))return 0;const s=Pi(i,n);if(x(s)){const o=We(s),a=us(s);fe(et,y.elementfocus,`opened [${a}] ${o}`);const c=[s.id,r];Jf(nl(i.id,c),s.code);const l=us(s);sg(et,y.elementfocus,i.id,c,l,`${o} - ${i.name}`)}else he(et,"pageopen",`page ${n} not found`,y.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=vn(jt.MAIN),i=fE(r,n);if(x(n)){const s=We(i),o=us(i);fe(et,y.elementfocus,`trashed [${o}] ${s}`),Qo(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(be).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{Qs(et,y.elementfocus,"books");const t=we(jt.MAIN);Ic(et,y.elementfocus,"main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=we(jt.CONTENT);Ic(et,y.elementfocus,"content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),q0(et,y.elementfocus,7);const n=aa();return n.length?n.forEach(r=>{Le(et,y.elementfocus,`!bookopen ${r.id};${r.name}`)}):Wn(et,y.elementfocus,"no books found"),Le(et,y.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=vn(jt.MAIN);return x(t)&&(Qs(et,y.elementfocus,"pages"),Ic(et,y.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?F0(t).forEach(n=>{const r=We(n),i=us(n);Le(et,y.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(Le(et,y.elementfocus,""),Wn(et,y.elementfocus,"$white no pages found"),Wn(et,y.elementfocus,"$white use @ to create a page"),Wn(et,y.elementfocus,"$white @board name of board"),Wn(et,y.elementfocus,"$white @object name of object"),Wn(et,y.elementfocus,"$white @terrain name of terrain"),Wn(et,y.elementfocus,"$white You can omit the type and it will default to object"),Wn(et,y.elementfocus,"$white @object name of object"),Wn(et,y.elementfocus,"$white @name of object"))),0}).command("boards",()=>{Qs(et,y.elementfocus,"boards");const t=vn(jt.MAIN);if(x(t)){Ic(et,y.elementfocus,"main",`${t.name} $GREEN${t.id}`);const e=F0(t);e.filter(n=>Bi(n)===_t.BOARD).forEach(n=>{const r=We(n),i=us(n);Le(et,y.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),e.length===0&&(Le(et,y.elementfocus,""),Wn(et,y.elementfocus,"$white no boards found"),Wn(et,y.elementfocus,"$white use @ to create a board"),Wn(et,y.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{Qs(et,y.elementfocus,"$REDTRASH"),Wn(et,y.elementfocus,"books");const t=aa();t.length&&(t.forEach(n=>{Le(et,y.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Le(et,y.elementfocus,""));const e=we(jt.MAIN);return x(e)&&(Wn(et,y.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=We(n);Le(et,y.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Le(et,y.elementfocus,"")),0}).command("dev",()=>(Qo(),BA(et,y.elementfocus),0)).command("share",()=>(Qo(),PA(et,y.elementfocus),0)).command("save",()=>(Qo(),0)).command("fork",()=>(tR(et,y.elementfocus),0)).command("nuke",()=>(DA(et,y.elementfocus),0)).command("restart",()=>(QA(et,y.elementfocus),Qo(),0)).command("export",()=>{J0(et,y.elementfocus,"E X P O R T"),Qs(et,y.elementfocus,"books");const t=aa();return t.length&&t.forEach(e=>Le(et,y.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zr(n);return x(r)&&(J0(et,y.elementfocus,"E X P O R T"),Qs(et,y.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=F0(r);Le(et,y.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=We(s),a=us(s);Le(et,y.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zr(n);return x(r)&&rg(et,y.elementfocus,Zn(r),`${r.name}.book.json`),0}).command("pageexport",(t,e)=>{const[n]=rt(e,0,[z.NAME]),{target:r,path:i}=Xn(n),s=zr(r),o=Pi(s,i);return x(o)&&rg(et,y.elementfocus,Zn(o),`${We(o)}.${us(o)}.json`),0}).command("gadget",()=>(XA(et,y.elementfocus),0)).command("joincode",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return SA(et,y.elementfocus,!!n),0}).command("jointab",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return OA(et,y.elementfocus,!!n),0}),A$=ji().command("toast",(t,e)=>{const n=e.map(be).join("");return yA(et,y.elementfocus,n),0}).command("palette",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=wx(),i=en(y.book,_t.PALETTE,n);return x(i)?(r.palette=i.id,fe(et,y.elementfocus,`loaded palette ${n}`)):he(et,y.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=wx(),i=en(y.book,_t.CHARSET,n);return x(i)?(r.charset=i.id,fe(et,y.elementfocus,`loaded charset ${n}`)):he(et,y.elementfocus,"not-found",`unabled to find charset ${n}`),0}),Q0={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Cc(t){return ce(t)&&LE(t[0])}function LE(t){return x(fr[t])&&wt(t)}function ME(t){if(wt(t))return Q0[It(t)]}function UE(t){if(Cc(t))return t;if(LE(t))return[t];const e=ME(t);if(x(e))return[e]}function R$(t){const e=y.words[t],n=UE(e);if(Cc(n))return[n,t+1];const[r,i]=Gn(t),s=UE(r);return Cc(s)?[s,i]:[void 0,t]}const tp={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};zt.ISSOLID,zt.ISWALK,zt.ISSWIM,zt.ISBULLET,zt.ISWALK,zt.ISSWIM;function Wu(t){return ce(t)&&ep(t[0])}function ep(t){return x(zt[t])&&wt(t)}function S$(t){if(wt(t))return tp[It(t)]}function O$(t){const e=y.words[t];if(Wu(e))return[e,t+1];if(ep(e))return[[e],t+1];const[n,r]=Gn(t);return Wu(n)?[n,r]:ep(n)?[[n],r]:[void 0,t]}const I$=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),FE=new Set(["char","color","bg","group","party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),N$=["NORTH","SOUTH","WEST","EAST"];function C$(t){const e=Sr(t);if(At(e.inputcurrent)||(e.inputcurrent=0),ce(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=Sn.NONE,i=0]=n??[Sn.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&fN?1:0,e.inputctrl=i&dN?1:0,e.inputshift=i&pN?1:0,r){case Sn.MOVE_UP:case Sn.MOVE_DOWN:case Sn.MOVE_LEFT:case Sn.MOVE_RIGHT:e.inputmove=[N$[r-Sn.MOVE_UP]];break;case Sn.OK_BUTTON:e.inputok=1;break;case Sn.CANCEL_BUTTON:e.inputcancel=1;break;case Sn.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Sn.NONE&&o!==r}),e}function L$(t){const e=Q0[t];if(x(e))return e;const n=tp[t];if(x(n))return n;const r=Ja[t];if(x(r))return r;const i=sd[t];if(x(i))return i}const M$=ji({get(t,e){var o,a,c,l,u,f,d,h,p,m,b,w,k,T,A,C,R,S,F,N,P;const n=L$(e);if(x(n))return[!0,n];if(y.elementisplayer&&I$.has(e)){const H=C$(y.elementid)[e];return[x(H),H]}const r=ic(y.board,{x:((o=y.element)==null?void 0:o.x)??-1,y:((a=y.element)==null?void 0:a.y)??-1},y.elementfocus),i=(r==null?void 0:r.id)??y.elementfocus??cr();switch(e){case"isdark":return[!0,(c=y.board)!=null&&c.isdark?1:0];case"startx":return[!0,((l=y.board)==null?void 0:l.startx)??0];case"starty":return[!0,((u=y.board)==null?void 0:u.starty)??0];case"over":return[!0,((f=y.board)==null?void 0:f.over)??""];case"under":return[!0,((d=y.board)==null?void 0:d.under)??""];case"camera":return[!0,((h=y.board)==null?void 0:h.camera)??""];case"graphics":return[!0,((p=y.board)==null?void 0:p.graphics)??""];case"facing":break;case"exitnorth":return[!0,((m=y.board)==null?void 0:m.exitnorth)??""];case"exitsouth":return[!0,((b=y.board)==null?void 0:b.exitsouth)??""];case"exitwest":return[!0,((w=y.board)==null?void 0:w.exitwest)??""];case"exiteast":return[!0,((k=y.board)==null?void 0:k.exiteast)??""];case"timelimit":return[!0,((T=y.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((A=y.board)==null?void 0:A.restartonzap)??0];case"maxplayershots":return[!0,((C=y.board)==null?void 0:C.maxplayershots)??0];case"boardid":return[!0,((R=y.board)==null?void 0:R.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((S=y.element)==null?void 0:S.id)??""];case"thisx":return[!0,((F=y.element)==null?void 0:F.x)??-1];case"thisy":return[!0,((N=y.element)==null?void 0:N.y)??-1];default:{const H=(P=y.element)==null?void 0:P[e];if(FE.has(e))return[!0,H];break}}const s=Sr(i)[e];return[x(s),s]},set(t,e,n){var o,a;const r=ic(y.board,{x:((o=y.element)==null?void 0:o.x)??-1,y:((a=y.element)==null?void 0:a.y)??-1},y.elementfocus),i=(r==null?void 0:r.id)??y.elementfocus;switch(e){case"isdark":if(x(y.board))return y.board.isdark=n?1:0,[!0,y.board.isdark];break;case"startx":if(x(y.board))return y.board.startx=Oc(n,0),[!0,y.board.startx];break;case"starty":if(x(y.board))return y.board.starty=Oc(n,0),[!0,y.board.starty];break;case"over":if(x(y.board))return y.board.over=At(n)?n:be(n),[!0,y.board.over];break;case"under":if(x(y.board))return y.board.under=At(n)?n:be(n),[!0,y.board.under];break;case"camera":if(x(y.board))return[!0,y.board.camera=be(n)];break;case"graphics":if(x(y.board))return[!0,y.board.graphics=be(n)];break;case"facing":break;case"exitnorth":if(x(y.board))return y.board.exitnorth=be(n),[!0,y.board.exitnorth];break;case"exitsouth":if(x(y.board))return y.board.exitsouth=be(n),[!0,y.board.exitsouth];break;case"exitwest":if(x(y.board))return y.board.exitwest=be(n),[!0,y.board.exitwest];break;case"exiteast":if(x(y.board))return y.board.exiteast=be(n),[!0,y.board.exiteast];break;case"timelimit":if(x(y.board))return y.board.timelimit=Oc(n,0),[!0,y.board.timelimit];break;case"restartonzap":if(x(y.board))return y.board.restartonzap=n?1:0,[!0,y.board.restartonzap];break;case"maxplayershots":if(x(y.board))return y.board.maxplayershots=Oc(n,0),[!0,y.board.maxplayershots];break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(FE.has(e))return x(y.element)&&(y.element[e]=n),[!0,n];break}}const s=Sr(i);return x(s)?(s[e]=n,[!0,n]):[!1,n]},everytick(){var t,e,n,r,i;if(!((t=y.element)!=null&&t.removed)&&(x((e=y.element)==null?void 0:e.stepx)||x((n=y.element)==null?void 0:n.stepy))){const s={x:((r=y.element)==null?void 0:r.x)??0,y:((i=y.element)==null?void 0:i.y)??0};la(y.book,y.board,y.element,{x:s.x+(y.element.stepx??0),y:s.y+(y.element.stepy??0)})===!1&&(y.element.stepx=0,y.element.stepy=0,He(y.book,y.element,"destructible")&&or(y.book,y.board,y.element,y.timestamp))}}}).command("clear",(t,e)=>{for(let n=0;n<e.length;++n)t.set(be(e[n]),0);return 0}).command("set",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.ANY]);return t.set(n,r??1),0}).command("become",(t,e)=>{var r,i;const[n]=rt(e,0,[z.KIND]);if(Ge(y.book,y.board),P0(y.book,y.board,y.element),or(y.book,y.board,y.element,y.timestamp)){const s={x:((r=y.element)==null?void 0:r.x)??0,y:((i=y.element)==null?void 0:i.y)??0};ds(y.book,y.board,n,s)}return t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=rt(e,0,[z.ANY]);if(Si(n)){const[r,i]=rt(e,0,[z.DIR,z.NUMBER]),s=ge(y.board,r.destpt);x(s)&&(s.char=i)}else x(y.element)&&At(n)&&(y.element.char=n);return 0}).command("color",(t,e)=>{const[n]=rt(e,0,[z.ANY]);if(Si(n)){const[r,i]=rt(e,0,[z.DIR,z.COLOR]),s=ge(y.board,r.destpt);x(s)&&rc(y.element,i)}else{const[r]=rt(e,0,[z.COLOR]);x(y.element)&&x(r)&&rc(y.element,r)}return 0}).command("go",(t,e)=>{if(x(y.element)){const[n]=rt(e,0,[z.DIR]);if(la(y.book,y.board,y.element,n.destpt),t.yield(),y.element.x===n.destpt.x&&y.element.y===n.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!x(y.element))return 0;const[n]=rt(e,0,[z.DIR]),r=y.element.x??0,i=y.element.y??0;return y.element.stepx=n.destpt.x-r,y.element.stepy=n.destpt.y-i,0}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=rt(e,0,[z.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(be(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(be(e[0])),0)).command("cycle",(t,e)=>{if(x(y.element)){const[n]=rt(e,0,[z.NUMBER]);y.element.cycle=qe(Math.round(n),1,255)}return 0}).command("die",t=>(or(y.book,y.board,y.element,y.timestamp),t.endofprogram(),0)).command("endgame",()=>(og(et,y.elementfocus),0)).command("run",(t,e)=>{const[n]=rt(e,0,[z.NAME]);return oh(n),0}).command("runwith",(t,e)=>{const[n,r]=rt(e,0,[z.ANY,z.NAME]);return t.set("arg",n),oh(r),0}),Hu={};function U$(t){var e;return(e=Hu[t])==null?void 0:e.arg}function F$(t){var e;return(e=Hu[t])==null?void 0:e.format}function ms(t){var e;return(e=Hu[t])==null?void 0:e.content}function B$(t,e,n,r,i){const s=we(jt.MAIN);if(!x(s))return;const o=Xs(s,_t.LOADER).filter(a=>{const c=Zs(a),l=c.format,u=wt(l)?new RegExp(l).test(e):!1,f=c.event,d=wt(f)?new RegExp(f).test(n):!1;return wt(l)&&wt(f)?u&&d:wt(l)?u:wt(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${Pe()}_loader`;Hu[c]={arg:t,format:e,content:r,player:i},S4(c,o[a].code)}}function BE(t,e){if(!x(t))return;const n=It(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const P$=(t,e)=>{const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[z.NAME]),s=It(r);switch(s){case"seek":{const[o]=rt(e,i,[z.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(e,i,[z.NAME]);t.set(o,BE(n,s));break}case"text":{const[o,a]=rt(e,i,[z.NAME,z.NAME]),c=BE(n,o);if(At(c)&&wt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);t.set(a,f),n.cursor+=c}break}case"palette":{const[o]=rt(e,i,[z.NAME]),a=U0(y.book,_t.PALETTE,o),c=Ce(a);if(x(c)){const l=sN*oc,u=kd(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=rt(e,i,[z.NAME]),a=U0(y.book,_t.CHARSET,o),c=Ce(a);if(x(c)){const l=Gl*iN*vd,u=nb(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},ta=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",Gu=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!Gu(t[n],e[n]))return!1;return!0}if(ta(t)&&ta(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Gu(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},Yu=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(ta(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},D$=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",PE=t=>t>="0"&&t<="9"||t==="-",$$=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var Z;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(Z||(Z={}));const DE={"(":Z.TOK_LPAREN,")":Z.TOK_RPAREN,"*":Z.TOK_STAR,",":Z.TOK_COMMA,".":Z.TOK_DOT,":":Z.TOK_COLON,"@":Z.TOK_CURRENT,$:Z.TOK_ROOT,"]":Z.TOK_RBRACKET,"{":Z.TOK_LBRACE,"}":Z.TOK_RBRACE},j$={"!":!0,"<":!0,"=":!0,">":!0},z$={"	":!0,"\n":!0,"\r":!0," ":!0};class K${constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(D$(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:Z.TOK_UNQUOTEDIDENTIFIER,value:i});else if(DE[e[this._current]]!==void 0)n.push({start:this._current,type:DE[e[this._current]],value:e[this._current]}),this._current+=1;else if(PE(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:Z.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:Z.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);n.push({start:r,type:Z.TOK_LITERAL,value:o})}else if(j$[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if(z$[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:Z.TOK_AND,value:"&&"})):n.push({start:r,type:Z.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:Z.TOK_OR,value:"||"})):n.push({start:r,type:Z.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&$$(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;PE(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:Z.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:Z.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:Z.TOK_FLATTEN,value:"[]"}):{start:n,type:Z.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:Z.TOK_NE,value:"!="}):{start:n,type:Z.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:Z.TOK_LTE,value:"<="}):{start:n,type:Z.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:Z.TOK_GTE,value:">="}):{start:n,type:Z.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:Z.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n='[{"',r=["true","false","null"],i="-0123456789";if(e==="")return!1;if(n.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const W$=new K$,xn={[Z.TOK_EOF]:0,[Z.TOK_UNQUOTEDIDENTIFIER]:0,[Z.TOK_QUOTEDIDENTIFIER]:0,[Z.TOK_RBRACKET]:0,[Z.TOK_RPAREN]:0,[Z.TOK_COMMA]:0,[Z.TOK_RBRACE]:0,[Z.TOK_NUMBER]:0,[Z.TOK_CURRENT]:0,[Z.TOK_EXPREF]:0,[Z.TOK_ROOT]:0,[Z.TOK_PIPE]:1,[Z.TOK_OR]:2,[Z.TOK_AND]:3,[Z.TOK_EQ]:5,[Z.TOK_GT]:5,[Z.TOK_LT]:5,[Z.TOK_GTE]:5,[Z.TOK_LTE]:5,[Z.TOK_NE]:5,[Z.TOK_FLATTEN]:9,[Z.TOK_STAR]:20,[Z.TOK_FILTER]:21,[Z.TOK_DOT]:40,[Z.TOK_NOT]:45,[Z.TOK_LBRACE]:50,[Z.TOK_LBRACKET]:55,[Z.TOK_LPAREN]:60};class H${constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==Z.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...W$.tokenize(e),{type:Z.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<xn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case Z.TOK_LITERAL:return{type:"Literal",value:e.value};case Z.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case Z.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===Z.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case Z.TOK_NOT:return r=this.expression(xn.Not),{type:"NotExpression",children:[r]};case Z.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===Z.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(xn.Star),{type:"ValueProjection",children:[n,r]};case Z.TOK_FILTER:return this.led(e.type,{type:"Identity"});case Z.TOK_LBRACE:return this.parseMultiselectHash();case Z.TOK_FLATTEN:return n={type:Z.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(xn.Flatten),{type:"Projection",children:[n,r]};case Z.TOK_LBRACKET:return this.lookahead(0)===Z.TOK_NUMBER||this.lookahead(0)===Z.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===Z.TOK_STAR&&this.lookahead(1)===Z.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(xn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case Z.TOK_CURRENT:return{type:Z.TOK_CURRENT};case Z.TOK_ROOT:return{type:Z.TOK_ROOT};case Z.TOK_EXPREF:return i=this.expression(xn.Expref),{type:"ExpressionReference",children:[i]};case Z.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==Z.TOK_RPAREN;)this.lookahead(0)===Z.TOK_CURRENT?(i={type:Z.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(Z.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case Z.TOK_DOT:const i=xn.Dot;return this.lookahead(0)!==Z.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case Z.TOK_PIPE:return r=this.expression(xn.Pipe),{type:Z.TOK_PIPE,children:[n,r]};case Z.TOK_OR:return r=this.expression(xn.Or),{type:"OrExpression",children:[n,r]};case Z.TOK_AND:return r=this.expression(xn.And),{type:"AndExpression",children:[n,r]};case Z.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==Z.TOK_RPAREN;)this.lookahead(0)===Z.TOK_CURRENT?(a={type:Z.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===Z.TOK_COMMA&&this.match(Z.TOK_COMMA),o.push(a);return this.match(Z.TOK_RPAREN),{name:s,type:"Function",children:o};case Z.TOK_FILTER:const l=this.expression(0);return this.match(Z.TOK_RBRACKET),r=this.lookahead(0)===Z.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(xn.Filter),{type:"FilterProjection",children:[n,r,l]};case Z.TOK_FLATTEN:const u={type:Z.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(xn.Flatten);return{type:"Projection",children:[u,f]};case Z.TOK_EQ:case Z.TOK_NE:case Z.TOK_GT:case Z.TOK_GTE:case Z.TOK_LT:case Z.TOK_LTE:return this.parseComparator(n,e);case Z.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===Z.TOK_NUMBER||d.type===Z.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(Z.TOK_STAR),this.match(Z.TOK_RBRACKET),r=this.parseProjectionRHS(xn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===Z.TOK_COLON||this.lookahead(1)===Z.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(Z.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(xn.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==Z.TOK_RBRACKET&&n<3;){if(r===Z.TOK_COLON)n+=1,this.advance();else if(r===Z.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(Z.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression(xn[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([Z.TOK_UNQUOTEDIDENTIFIER,Z.TOK_QUOTEDIDENTIFIER,Z.TOK_STAR].includes(n))return this.expression(e);if(n===Z.TOK_LBRACKET)return this.match(Z.TOK_LBRACKET),this.parseMultiselectList();if(n===Z.TOK_LBRACE)return this.match(Z.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(xn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===Z.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===Z.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===Z.TOK_DOT)return this.match(Z.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==Z.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===Z.TOK_COMMA&&(this.match(Z.TOK_COMMA),this.lookahead(0)===Z.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(Z.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[Z.TOK_UNQUOTEDIDENTIFIER,Z.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(Z.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===Z.TOK_COMMA)this.match(Z.TOK_COMMA);else if(this.lookahead(0)===Z.TOK_RBRACE){this.match(Z.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const G$=new H$;var ut;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class Y${constructor(e){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>ta(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(m=>{var b;return(b=!m.optional)!==null&&b!==void 0?b:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,p;for(let m=0;m<r.length;m+=1){p=!1,d=r[m].types,h=this.getTypeName(n[m]);let b;for(b=0;b<d.length;b+=1)if(h!==void 0&&this.typeMatches(h,d[b],n[m])){p=!0;break}if(!p&&h!==void 0){const w=d.map(k=>this.TYPE_NAME_TABLE[k]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${m+1} to be type (${w}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(e,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return e===ut.TYPE_ARRAY;if(e===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return e.jmespathType===Z.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class V${constructor(){this._rootValue=null,this.runtime=new Y$(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,o,a,c,l,u,f,d,h;switch(e.type){case"Field":return n===null?null:ta(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),d=1;d<e.children.length;d+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=e.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...e.children],b=this.computeSliceParams(n.length,m),[w,k,T]=b;if(s=[],T>0)for(d=w;d<k;d+=T)s.push(n[d]);else for(d=w;d>k;d+=T)s.push(n[d]);return s;case"Projection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(e.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(e.children[0],n),!ta(h))return null;f=[];const A=Object.values(h);for(d=0;d<A.length;d+=1)i=this.visit(e.children[1],A[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;const C=[],R=[];for(d=0;d<h.length;d+=1)r=this.visit(e.children[2],h[d]),Yu(r)||C.push(h[d]);for(let M=0;M<C.length;M+=1)i=this.visit(e.children[1],C[M]),i!==null&&R.push(i);return R;case"Comparator":switch(o=this.visit(e.children[0],n),a=this.visit(e.children[1],n),e.name){case Z.TOK_EQ:s=Gu(o,a);break;case Z.TOK_NE:s=!Gu(o,a);break;case Z.TOK_GT:s=o>a;break;case Z.TOK_GTE:s=o>=a;break;case Z.TOK_LT:s=o<a;break;case Z.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case Z.TOK_FLATTEN:const S=this.visit(e.children[0],n);if(!Array.isArray(S))return null;let F=[];for(d=0;d<S.length;d+=1)i=S[d],Array.isArray(i)?F=[...F,...i]:F.push(i);return F;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<e.children.length;d+=1)f.push(this.visit(e.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let N;for(d=0;d<e.children.length;d+=1)N=e.children[d],f[N.name]=this.visit(N.value,n);return f;case"OrExpression":return r=this.visit(e.children[0],n),Yu(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return o=this.visit(e.children[0],n),Yu(o)?o:this.visit(e.children[1],n);case"NotExpression":return o=this.visit(e.children[0],n),Yu(o);case"Literal":return e.value;case Z.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case Z.TOK_CURRENT:return n;case Z.TOK_ROOT:return this._rootValue;case"Function":const P=[];for(let M=0;M<e.children.length;M+=1)P.push(this.visit(e.children[M],n));return this.runtime.callFunction(e.name,P);case"ExpressionReference":const H=e.children[0];return H.jmespathType=Z.TOK_EXPREF,H;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const Z$=new V$;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function X$(t,e){const n=G$.parse(e);return Z$.search(n,t)}const q$=(t,e)=>{const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[z.NAME,z.NAME]),s=X$(n.json,r);return t.set(i,s),0};function J$(t,e){return Math.sqrt(Math.pow(t.r-e.r,2)+Math.pow(t.g-e.g,2)+Math.pow(t.b-e.b,2))}const Vu=kd(rb);function $E(t){let e;if(!x(Vu))return e;let n=1e9;for(let r=0;r<=Rt.BLACK;++r){const i=r*oc,s=Vu.bits[i],o=Vu.bits[i+1],a=Vu.bits[i+2],c=J$(t,{r:s,g:o,b:a,hex:""});c<n&&(e=r,n=c)}return e}const Q$=(t,e)=>{var a,c,l,u;const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[z.NAME]),s=It(r),o=((a=n.content)==null?void 0:a.layers)??[];switch(s){case"seek":{const[f]=rt(e,i,[z.NUMBER]);n.cursor=qe(f,0,o.length-1);break}case"layer":{const f=n.cursor+1;n.cursor=qe(f,0,o.length-1);break}case"char":{const[f,d,h]=rt(e,i,[z.NUMBER,z.NUMBER,z.NAME]),p=(c=n.content)==null?void 0:c.layers[n.cursor];x(p)&&Uo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,p.raster[f+d*p.width].asciiCode);break}case"color":{const[f,d,h]=rt(e,i,[z.NUMBER,z.NUMBER,z.NAME]),p=(l=n.content)==null?void 0:l.layers[n.cursor];x(p)&&Uo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,$E(p.raster[f+d*p.width].color));break}case"bg":{const[f,d,h]=rt(e,i,[z.NUMBER,z.NUMBER,z.NAME]),p=(u=n.content)==null?void 0:u.layers[n.cursor];x(p)&&Uo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,$E(p.raster[f+d*p.width].bg));break}}return 0},t5=(t,e)=>{const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[z.NAME]);switch(It(r)){case"seek":{const[o]=rt(e,i,[z.NUMBER]);n.cursor=qe(o,0,n.lines.length-1);break}case"line":n.cursor=qe(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[f,d]=rt(e,u,[z.NAME]);t.set(f,c[l]??0),++l,u=d}break}}return 0},e5=ji({get(t,e){var r,i,s;const n=F$(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"lines":return[!0,o.lines.length]}break}case"json":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename]}break}case"binary":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"bytes":return[!0,o.bytes.length]}break}case"rexpaint":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename];case"layers":return[!0,((r=o.content)==null?void 0:r.layers.length)??0];case"width":return[!0,((i=o.content)==null?void 0:i.layers[o.cursor].width)??0];case"height":return[!0,((s=o.content)==null?void 0:s.layers[o.cursor].height)??0];case"cursor":return[!0,o.cursor]}break}}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.ANY]);return mp(n,r),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(be).join(" ");return fe(et,y.elementfocus,"$175",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=be(n),s=r.map(be).join(" ");return fe(et,y.elementfocus,"$175",`!${s};${i}`),0}).command("readline",t5).command("readjson",q$).command("readbin",P$).command("readrexpaint",Q$).command("with",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zn(y.book,_t.BOARD,n);if(r.length){const i=Ae(...r);x(i)&&(y.board=Ce(i),y.element={x:-1,y:-1})}return 0});function jE(t,e,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=rt(i,a,[z.ANY]);ce(c)&&!Si(c)&&!Cc(c)&&!Wu(c)&&!ri(c)?o.push(...c):o.push(c),a=l}switch(It(r)){case"get":case"post:json":vA(et,y.elementfocus,t,e,n,r,o);break}return 0}const n5=ji().command("fetch",(t,e)=>{const[n,r,i="get",s]=rt(e,0,[z.NAME,z.NAME,z.MAYBE_STRING]);return jE(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",o]=rt(e,0,[z.ANY,z.NAME,z.NAME,z.MAYBE_STRING]);return jE(n,r,i,s,e,o),0}).command("chat",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return n?EA(et,y.elementfocus,n):xA(et,y.elementfocus),0}).command("broadcast",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return n?bA(et,y.elementfocus,n):wA(et,y.elementfocus),0}),r5=ji({set(t,e,n){return D4(t,e,n),[!1,void 0]},everytick(){const t=ur(y.elementid),[e]=t;if(t.length===1&&wt(e)){if(x(y.element))if(e.trim().length===0){const n=fn(y.elementid);n.sidebar=[]}else y.element.tickertext=e,y.element.tickertime=y.timestamp}else if(t.length>1)if(y.elementisplayer){const n=fn(y.elementid);n.sidebar=t}else{const n=fn(y.elementfocus);n.scroll=t}}}).command("send",(t,e)=>{var a,c;const[n,r]=rt(e,0,[z.NAME,z.ANY]),[i,s]=IE(n);switch(It(i)){case"all":for(const l of Object.keys(((a=y.board)==null?void 0:a.objects)??{}))t.send(y.elementfocus,l,s,r);break;case"self":t.message({session:et.session(),player:y.elementfocus,id:Pe(),sender:t.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((c=y.board)==null?void 0:c.objects)??{}))l!==t.id()&&t.send(y.elementfocus,l,s,r);break;default:{const l=Jy(y.board,[i]);for(let u=0;u<l.length;++u){const f=l[u];x(f.id)&&t.send(y.elementfocus,f.id,s,r)}break}}return 0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(be).join("");return re(y.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=be(n);return Bt(y.elementid,t.id(),i,r,t.get,t.set),0});function zE(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ge(e,{x:s,y:i});En(o)&&or(t,e,o,t.timestamp),un(e,{x:s,y:i})}}function i5(t,e,n){for(let r=e.y;r<=n.y;++r)for(let i=e.x;i<=n.x;++i)un(t,{x:i,y:r})}function KE(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ge(e,{x:s,y:i});En(o)&&or(t,e,o,t.timestamp),un(e,{x:s,y:i})}}function Zu(t,e){x(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.code=e.code,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.stepx=e.stepx,t.stepy=e.stepy,t.pushable=e.pushable,t.collision=e.collision,t.destructible=e.destructible,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function np(t,e,n,r,i){if(!x(y.book))return;const s=y.book,o=en(s,_t.BOARD,t),a=Ce(o);if(!x(a))return;const c=en(s,_t.BOARD,e),l=Ce(c);if(!x(l))return;Ge(s,a),Ge(s,l);let u=!1;if(x(a)&&x(l)){switch(i){case"all":zE(s,l,n,r);break;case"object":KE(s,l,n,r);break;case"terrain":i5(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,p=!1;switch(i){case"all":h=!0,p=!0;break;case"object":h=!0;break;case"terrain":p=!0;break}const m={x:d,y:f};let b,w=ge(a,m);if(En(w)?(b=zo(a,d,f),Kr(w==null?void 0:w.id)&&(w=void 0)):(b=w,w=void 0),x(b)&&(p||u&&hs(s,b)===i)){u&&zE(s,l,m,m);const k=ds(s,l,[b.kind??""],m);Zu(k,b)}if(x(w)&&(h||u&&hs(s,w)===i)){u&&KE(s,l,m,m);const k=ds(s,l,[w.kind??""],m);Zu(k,w)}}zu(s,l)}}function s5(t,e,n,r,i){if(!x(y.book))return;const s=y.book,o=en(s,_t.BOARD,t),a=Ce(o);if(!x(a))return;const c=bd(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Ge(s,a),Ge(s,c);const f=-Math.tan(e*.5),d=Math.sin(e),h=Math.round(12.5*f),p=Math.round(12.5*d),m=new Array(Jt).fill(0);ry(h,0,-h,Jt-1).forEach(A=>{A.x<0?m[A.y]=Math.min(m[A.y],A.x):m[A.y]=Math.max(m[A.y],A.x)});const w=new Array(St).fill(0);ry(0,p,St-1,-p).forEach(A=>{A.y<0?w[A.x]=Math.min(w[A.x],A.y):w[A.x]=Math.max(w[A.x],A.y)});const T=[m,w,m];for(let A=0;A<T.length;++A){const C=T[A];if(A!==1){for(let R=0;R<Jt;++R){const S=C[R],F=R*St;for(let N=0;N<St;N++){const P=(N+S+St)%St;u&&(c.terrain[P+F]=a.terrain[N+F])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const F=R[S],{x:N,y:P}=a.objects[F];if(x(N)&&x(P)){const H=C[P];a.objects[F].x=(N+H+St)%St,a.objects[F].lx=a.objects[F].x}}}}if(A===1){for(let R=0;R<St;++R){const S=C[R];for(let F=0;F<Jt;++F){const N=(F+S+Jt)%Jt;u&&(c.terrain[R+N*St]=a.terrain[R+F*St])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const F=R[S],{x:N,y:P}=a.objects[F];if(x(N)&&x(P)){const H=C[N];a.objects[F].y=(P+H+Jt)%Jt,a.objects[F].ly=a.objects[F].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Ge(s,c),Ge(s,a)}}function o5(t,e){let n=0,r=0,i=0;for(;i<t.length;i++)n+=t[i];for(i=0,e*=n;e&&i<t.length;){if(r+=t[i],e<=r)return i;i++}return 0}var a5=o5;const c5=a5,Qt=function(){};Qt.prototype.FMX=0,Qt.prototype.FMY=0,Qt.prototype.FMXxFMY=0,Qt.prototype.T=0,Qt.prototype.N=0,Qt.prototype.initiliazedField=!1,Qt.prototype.generationComplete=!1,Qt.prototype.wave=null,Qt.prototype.compatible=null,Qt.prototype.weightLogWeights=null,Qt.prototype.sumOfWeights=0,Qt.prototype.sumOfWeightLogWeights=0,Qt.prototype.startingEntropy=0,Qt.prototype.sumsOfOnes=null,Qt.prototype.sumsOfWeights=null,Qt.prototype.sumsOfWeightLogWeights=null,Qt.prototype.entropies=null,Qt.prototype.propagator=null,Qt.prototype.observed=null,Qt.prototype.distribution=null,Qt.prototype.stack=null,Qt.prototype.stackSize=0,Qt.prototype.DX=[-1,0,1,0],Qt.prototype.DY=[0,1,0,-1],Qt.prototype.opposite=[2,3,0,1],Qt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let t=0;t<this.FMXxFMY;t++){this.wave[t]=new Array(this.T),this.compatible[t]=new Array(this.T);for(let e=0;e<this.T;e++)this.compatible[t][e]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let t=0;t<this.T;t++)this.weightLogWeights[t]=this.weights[t]*Math.log(this.weights[t]),this.sumOfWeights+=this.weights[t],this.sumOfWeightLogWeights+=this.weightLogWeights[t];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},Qt.prototype.observe=function(t){let e=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=e){const c=1e-6*t();a+c<e&&(e=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=c5(this.distribution,t()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},Qt.prototype.propagate=function(){for(;this.stackSize>0;){const t=this.stack[this.stackSize-1];this.stackSize--;const e=t[0],n=e%this.FMX,r=e/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][t[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],p=f[h];p[i]--,p[i]==0&&this.ban(l,h)}}}},Qt.prototype.singleIteration=function(t){const e=this.observe(t);return e!==null?(this.generationComplete=e,!!e):(this.propagate(),null)},Qt.prototype.iterate=function(t,e){this.wave||this.initialize(),this.initiliazedField||this.clear(),t=t||0,e=e||Math.random;for(let n=0;n<t||t===0;n++){const r=this.singleIteration(e);if(r!==null)return!!r}return!0},Qt.prototype.generate=function(t){for(t=t||Math.random,this.wave||this.initialize(),this.clear();;){const e=this.singleIteration(t);if(e!==null)return!!e}},Qt.prototype.isGenerationComplete=function(){return this.generationComplete},Qt.prototype.ban=function(t,e){const n=this.compatible[t][e];for(let i=0;i<4;i++)n[i]=0;this.wave[t][e]=!1,this.stack[this.stackSize]=[t,e],this.stackSize++,this.sumsOfOnes[t]-=1,this.sumsOfWeights[t]-=this.weights[e],this.sumsOfWeightLogWeights[t]-=this.weightLogWeights[e];const r=this.sumsOfWeights[t];this.entropies[t]=Math.log(r)-this.sumsOfWeightLogWeights[t]/r},Qt.prototype.clear=function(){for(let t=0;t<this.FMXxFMY;t++){for(let e=0;e<this.T;e++){this.wave[t][e]=!0;for(let n=0;n<4;n++)this.compatible[t][e][n]=this.propagator[this.opposite[n]][e].length}this.sumsOfOnes[t]=this.weights.length,this.sumsOfWeights[t]=this.sumOfWeights,this.sumsOfWeightLogWeights[t]=this.sumOfWeightLogWeights,this.entropies[t]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var WE=Qt;const HE=WE,zi=function(e,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let N=0;N<f;N++)d[N]=new Array(r);this.colors=[];const h={};for(let N=0;N<r;N++)for(let P=0;P<n;P++){const H=(N*n+P)*4,M=[e[H],e[H+1],e[H+2],e[H+3]],I=M.join("-");h.hasOwnProperty(I)||(h[I]=this.colors.length,this.colors.push(M)),d[P][N]=h[I]}const p=this.colors.length,m=Math.pow(p,i*i),b=function(P){let H=new Array(i*i);for(let M=0;M<i;M++)for(let I=0;I<i;I++)H[I+M*i]=P(I,M);return H},w=function(P,H){return b(function(M,I){return d[(P+M)%n][(H+I)%r]})},k=function(P){return b(function(H,M){return P[i-1-M+H*i]})},T=function(P){return b(function(H,M){return P[i-1-H+M*i]})},A=function(P){let H=0,M=1;for(let I=0;I<P.length;I++)H+=P[P.length-1-I]*M,M*=p;return H},C=function(P){let H=P,M=m;const I=new Array(i*i);for(let E=0;E<I.length;E++){M/=p;let D=0;for(;H>=M;)H-=M,D++;I[E]=D}return I},R={},S=[];for(let N=0;N<(a?r:r-i+1);N++)for(let P=0;P<(a?n:n-i+1);P++){const H=new Array(8);H[0]=w(P,N),H[1]=T(H[0]),H[2]=k(H[0]),H[3]=T(H[2]),H[4]=k(H[2]),H[5]=T(H[4]),H[6]=k(H[4]),H[7]=T(H[6]);for(let M=0;M<l;M++){const I=A(H[M]);R[I]?R[I]++:(S.push(I),R[I]=1)}}this.T=S.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let N=0;N<this.T;N++){const P=parseInt(S[N],10);this.patterns[N]=C(P),this.weights[N]=R[P]}const F=function(P,H,M,I){const E=M<0?0:M,D=M<0?M+i:i,q=I<0?0:I,j=I<0?I+i:i;for(let ot=q;ot<j;ot++)for(let tt=E;tt<D;tt++)if(P[tt+i*ot]!=H[tt-M+i*(ot-I)])return!1;return!0};this.propagator=new Array(4);for(let N=0;N<4;N++){this.propagator[N]=new Array(this.T);for(let P=0;P<this.T;P++){const H=[];for(let M=0;M<this.T;M++)F(this.patterns[P],this.patterns[M],this.DX[N],this.DY[N])&&H.push(M);this.propagator[N][P]=H}}};zi.prototype=Object.create(HE.prototype),zi.prototype.constructor=zi,zi.prototype.onBoundary=function(t,e){return!this.periodic&&(t+this.N>this.FMX||e+this.N>this.FMY||t<0||e<0)},zi.prototype.clear=function(){if(HE.prototype.clear.call(this),this.ground!==0){for(let t=0;t<this.FMX;t++){for(let e=0;e<this.T;e++)e!==this.ground&&this.ban(t+(this.FMY-1)*this.FMX,e);for(let e=0;e<this.FMY-1;e++)this.ban(t+e*this.FMX,this.ground)}this.propagate()}},zi.prototype.graphics=function(t){return t=t||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t),t},zi.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMY;e++){const n=e<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(e*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(e-n)*this.FMX]][i+n*this.N]];t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3]}}},zi.prototype.graphicsIncomplete=function(t){for(let e=0;e<this.FMXxFMY;e++){const n=e%this.FMX,r=e/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const p=d+h*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const b=this.colors[this.patterns[m][f+u*this.N]];s+=b[0],o+=b[1],a+=b[2],c+=b[3]}}const l=e*4;t[l]=s/i,t[l+1]=o/i,t[l+2]=a/i,t[l+3]=c/i}};var l5=zi;const u5=WE,gs=function(e,n,r,i,s){const o=e.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!e.unique;let c=null;n&&e.subsets&&e.subsets[n]&&(c=e.subsets[n]);const l=function(A){const C=new Array(o*o);for(let R=0;R<o;R++)for(let S=0;S<o;S++)C[S+R*o]=A(S,R);return C},u=function(A){return l(function(C,R){return A[o-1-R+C*o]})},f=function(A){return l(function(C,R){return A[o-1-C+R*o]})};this.tiles=[];const d=[],h=[],p={};let m,b,w;for(let T=0;T<e.tiles.length;T++){const A=e.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":w=4,m=function(R){return(R+1)%4},b=function(R){return R%2===0?R+1:R-1};break;case"T":w=4,m=function(R){return(R+1)%4},b=function(R){return R%2===0?R:4-R};break;case"I":w=2,m=function(R){return 1-R},b=function(R){return R};break;case"\\":w=2,m=function(R){return 1-R},b=function(R){return 1-R};break;case"F":w=8,m=function(R){return R<4?(R+1)%4:4+(R-1)%4},b=function(R){return R<4?R+4:R-4};break;default:w=1,m=function(R){return R},b=function(R){return R};break}this.T=h.length,p[A.name]=this.T;for(let R=0;R<w;R++)h.push([this.T+R,this.T+m(R),this.T+m(m(R)),this.T+m(m(m(R))),this.T+b(R),this.T+b(m(R)),this.T+b(m(m(R))),this.T+b(m(m(m(R))))]);let C;if(a)for(let R=0;R<w;R++)C=A.bitmap[R],this.tiles.push(l(function(S,F){return[C[(o*F+S)*4],C[(o*F+S)*4+1],C[(o*F+S)*4+2],C[(o*F+S)*4+3]]}));else{C=A.bitmap,this.tiles.push(l(function(R,S){return[C[(o*S+R)*4],C[(o*S+R)*4+1],C[(o*S+R)*4+2],C[(o*S+R)*4+3]]}));for(let R=1;R<w;R++)this.tiles.push(R<4?u(this.tiles[this.T+R-1]):f(this.tiles[this.T+R-4]))}for(let R=0;R<w;R++)d.push(A.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const k=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),k[T]=new Array(this.T);for(let A=0;A<this.T;A++){k[T][A]=new Array(this.T);for(let C=0;C<this.T;C++)k[T][A][C]=!1}}for(let T=0;T<e.neighbors.length;T++){const A=e.neighbors[T],C=A.left.split(" ").filter(function(H){return H.length}),R=A.right.split(" ").filter(function(H){return H.length});if(c!==null&&(c.indexOf(C[0])===-1||c.indexOf(R[0])===-1))continue;const S=h[p[C[0]]][C.length==1?0:parseInt(C[1],10)],F=h[S][1],N=h[p[R[0]]][R.length==1?0:parseInt(R[1],10)],P=h[N][1];k[0][N][S]=!0,k[0][h[N][6]][h[S][6]]=!0,k[0][h[S][4]][h[N][4]]=!0,k[0][h[S][2]][h[N][2]]=!0,k[1][P][F]=!0,k[1][h[F][6]][h[P][6]]=!0,k[1][h[P][4]][h[F][4]]=!0,k[1][h[F][2]][h[P][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)k[2][T][A]=k[0][A][T],k[3][T][A]=k[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const C=[],R=k[T][A];for(let S=0;S<this.T;S++)R[S]&&C.push(S);this.propagator[T][A]=C}};gs.prototype=Object.create(u5.prototype),gs.prototype.constructor=gs,gs.prototype.onBoundary=function(t,e){return!this.periodic&&(t<0||e<0||t>=this.FMX||e>=this.FMY)},gs.prototype.graphics=function(t,e){return t=t||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t,e),t},gs.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMX;e++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[e+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(e*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];t[o]=a[0],t[o+1]=a[1],t[o+2]=a[2],t[o+3]=a[3]}}},gs.prototype.graphicsIncomplete=function(t,e){(!e||e.length!==4)&&(e=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(e&&s===this.T)t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];else{let f=0,d=0,h=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const b=this.tiles[m][l+c*this.tilesize],w=this.weights[m]*a;f+=b[0]*w,d+=b[1]*w,h+=b[2]*w,p+=b[3]*w}t[u]=f,t[u+1]=d,t[u+2]=h,t[u+3]=p}}}};var h5=gs,f5={OverlappingModel:l5,SimpleTiledModel:h5},d5=ro(f5);const GE=5;function YE(t,e,n,r,i,s,o){if(!x(y.book))return!1;const a=y.book,c=en(a,_t.BOARD,t),l=en(a,_t.BOARD,e),u=Ce(c),f=Ce(l);if(!x(u)||!x(f))return!1;Ge(a,u),Ge(a,f);let d=0;const h=new Map,p=new Map;let m=0;const b=32,w=new Uint8Array(yd*4);for(let S=0;S<Jt;++S)for(let F=0;F<St;++F){const N=ge(f,{x:F,y:S}),P=(N==null?void 0:N.char)??0,H=(N==null?void 0:N.color)??b,M=(N==null?void 0:N.bg)??b;w[m++]=P,w[m++]=H,w[m++]=M;const I=Di(a,N),E=It((I==null?void 0:I.name)??"empty"),D=h.get(E);At(D)?w[m++]=D:(h.set(E,d),p.set(d,E),w[m++]=d++)}const k=s.x-i.x+1,T=s.y-i.y+1,A=new d5.OverlappingModel(w,St,Jt,n,k,T,!1,!1,r,0);let C=0;for(;C<GE&&!A.generate();++C);if(C===GE)return!1;m=0;const R=A.graphics();for(let S=i.y;S<=s.y;++S)for(let F=i.x;F<=s.x;++F){const N={x:F,y:S},P=R[m++],H=R[m++],M=R[m++];switch(d=R[m++],o){case"all":{const ot=ge(u,{x:F,y:S});En(ot)&&or(a,u,ot,a.timestamp),un(u,{x:F,y:S});break}case"object":{const ot=ge(u,{x:F,y:S});En(ot)&&or(a,u,ot,a.timestamp);break}case"terrain":un(u,{x:F,y:S});break}let I=p.get(d)??"";const E=qs(a,I),D=Sc(a,I),q=E??D;switch(o){case"all":break;case"object":x(D)&&(I="");break;case"terrain":x(E)&&(I="");break;default:if(hs(a,q)!==o&&(I=""),I){const ot=ge(u,{x:F,y:S});En(ot)&&or(a,u,ot,a.timestamp),un(u,{x:F,y:S})}break}const j=I?ds(a,u,[I],N):void 0;if(!(!x(j)||!x(q))&&(Zu(j,q),P>0&&(j.char=P),H<b&&(j.color=H),M<b&&(j.bg=M),En(j))){const ot=Ae(sc(f,I));x(ot)&&(un(u,{...zo(f,ot.x??0,ot.y??0),x:F,y:S}),Zu(j,ot))}}return!0}function VE(t){return`zss_snapshot_${t}`}function p5(t,e,n,r){const i=en(y.book,_t.BOARD,t),s=Ce(i);if(!x(s))return;const o=VE(s.id);fE(y.book,o);const a=bs(jt.CONTENT,o,_t.BOARD),c=Ce(a);if(x(c))return np(t,c.id,e,n,r),c}function m5(t,e,n,r){const i=en(y.book,_t.BOARD,t),s=Ce(i);if(!x(s))return;const o=VE(s.id),a=en(y.book,_t.BOARD,o),c=Ce(a);if(x(c))return np(c.id,t,e,n,r),c}function g5(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return _5(t,e,i)}if(!x(y.book))return;const s=y.book,o=en(s,_t.BOARD,t),a=Ce(o);if(!x(a))return;const c=bd();Ge(s,a);for(let l=n.y;l<=r.y;++l)for(let u=n.x;u<=r.x;++u){let f=!1,d=!1;switch(i){case"all":f=!0,d=!0;break;case"object":f=!0;break;case"terrain":d=!0;break}const h=(u+e.x+St)%St,p=(l+e.y+Jt)%Jt;if(f){const m=ge(a,{x:u,y:l});En(m)&&x(m==null?void 0:m.x)&&x(m==null?void 0:m.y)&&(m.x=h,m.lx=h,m.y=p,m.ly=p)}d&&(c.terrain[h+p*St]=a.terrain[u+l*St])}(i==="all"||i==="terrain")&&(a.terrain=[...c.terrain]),zu(s,a)}function _5(t,e,n){if(!x(y.book))return;const r=y.book,i=en(r,_t.BOARD,t),s=Ce(i);if(!x(s))return;Ge(r,s);const{objectelements:o,terrainelements:a}=hF(r,s,n);let c=!1;const l={};for(let f=0;f<a.length;++f){const d=a[f],h=He(r,d,"collision"),p={x:d.x??-1,y:d.y??-1},m=ge(s,p);En(m)&&x(m)&&(l[m.id??""]=!0);const b={x:p.x+e.x,y:p.y+e.y};if(Kl(b)){const w=ge(s,b),k=hs(r,w),T=He(r,w,"collision");En(w)&&n!==k?Ko(h,T)?c=!0:He(r,w,"pushable")?c=la(r,s,w,b)!==!0:c=!1:T===zt.ISSOLID&&n!==k&&(c=!0)}else c=!0}if(c)return;for(let f=0;f<o.length;++f){const d=o[f],h=He(r,d,"collision"),p={x:d.x??0,y:d.y??0},m={x:p.x+e.x,y:p.y+e.y};if(Kl(m)){const b=ge(s,m),w=hs(r,b),k=He(r,b,"collision");En(b)&&x(b)&&n!==w&&!l[b.id??""]?He(r,b,"pushable")?c=la(r,s,b,m)!==!0:c=!0:Ko(h,k)&&n!==w&&(c=!0)}else c=!0}if(c)return;(e.x>0||e.y>0)&&a.reverse();for(let f=0;f<a.length;++f){const d=a[f],h={x:d.x??-1,y:d.y??-1},p={x:h.x+e.x,y:h.y+e.y},m=zo(s,p.x,p.y);if(x(d)&&x(m)){un(s,{...d,x:p.x,y:p.y}),un(s,{...m,x:h.x,y:h.y});const b=ge(s,h);En(b)&&x(b)&&(b.x=(b.x??0)+e.x,b.y=(b.y??0)+e.y,b.lx=(b.lx??0)+e.x,b.ly=(b.ly??0)+e.y)}}zu(r,s);for(let f=0;f<o.length;++f){const d=o[f],h={x:d.x??-1,y:d.y??-1},p={x:h.x+e.x,y:h.y+e.y};if(!la(r,s,d,p))break}zu(r,s)}function ea(t,e){let n="all";const r={x:0,y:0},i={x:St-1,y:Jt-1};for(let s=e;s<t.length;){const[o,a]=rt(t,s,[z.MAYBE_NUMBER_OR_STRING]);if(wt(o))n=It(o),s=a;else if(At(o)){const[c,l,u,f]=rt(t,a,[z.NUMBER,z.NUMBER,z.NUMBER]);r.x=Math.min(o,l),r.y=Math.min(c,u),i.x=Math.max(o,l),i.y=Math.max(c,u),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const y5=ji().command("snapshot",(t,e)=>{if(!x(y.book)||!x(y.board))return 0;const n=ea(e,0);return p5(y.board.id,n.pt1,n.pt2,n.targetset),0}).command("revert",(t,e)=>{if(!x(y.book)||!x(y.board))return 0;const n=ea(e,0);return m5(y.board.id,n.pt1,n.pt2,n.targetset),0}).command("copy",(t,e)=>{if(!x(y.book)||!x(y.board))return 0;const[n,r]=rt(e,0,[z.NAME]),i=zn(y.book,_t.BOARD,n),s=Ae(...i);if(x(s)){const o=ea(e,r);np(s.id,y.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(t,e)=>{if(!x(y.book)||!x(y.board))return 0;const[n,r,i,s]=rt(e,0,[z.NAME,z.NUMBER,z.NUMBER]),o=zn(y.book,_t.BOARD,n),a=Ae(...o);if(x(a)){const c=ea(e,s);YE(y.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(t,e)=>{var o,a;if(!x(y.book)||!x(y.board))return 0;const[n,r]=rt(e,0,[z.DIR]),i={x:n.destpt.x-(((o=y.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=y.element)==null?void 0:a.y)??0)},s=ea(e,r);return g5(y.board.id,i,s.pt1,s.pt2,s.targetset),0}).command("pivot",(t,e)=>{if(!x(y.book)||!x(y.board))return 0;const[n,r]=rt(e,0,[z.NUMBER]),i=ea(e,r);return s5(y.board.id,uy(n),i.pt1,i.pt2,i.targetset),0});var _s=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(_s||{});const b5={audio:K0,board:TF,cli:T$,display:A$,element:M$,runtime:r5,loader:e5,network:n5,transform:y5},rp=["audio","board","display","network","transform","element"],w5={0:[],1:["cli",...rp],2:["loader",...rp],3:["runtime",...rp]},E5={0:new Map,1:new Map,2:new Map,3:new Map};function na(t){return(w5[t]??[]).map(n=>b5[n]).filter(x)}function ip(t){const e=[],n=na(t);for(let r=0;r<n.length;++r)e.push(...n[r].listcommands());return e}function x5(t,e){const n=E5[t];if(!n.has(e)){let r;const i=na(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!x(r));++s);n.set(e,r)}return n.get(e)}function v5(t,e,n){const r=na(t);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(e,n);if(o)return[o,a]}}return[!1,void 0]}function k5(t,e,n,r){const i=na(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,n,r);if(a)return[a,r]}}return[!1,void 0]}function T5(t,e){const n=na(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function ZE(t,e){const n=na(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var XE={},qE={},JE={};const QE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");JE.encode=function(t){if(0<=t&&t<QE.length)return QE[t];throw new TypeError("Must be between 0 and 63: "+t)};const A5=JE,tx=5,ex=1<<tx,R5=ex-1,S5=ex;function O5(t){return t<0?(-t<<1)+1:(t<<1)+0}qE.encode=function(e){let n="",r,i=O5(e);do r=i&R5,i>>>=tx,i>0&&(r|=S5),n+=A5.encode(r);while(i>0);return n};var Lc={};(function(t){function e(R,S,F){if(S in R)return R[S];if(arguments.length===3)return F;throw new Error('"'+S+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(R){const S=R.match(n);return S?{scheme:S[1],auth:S[2],host:S[3],port:S[4],path:S[5]}:null}t.urlParse=i;function s(R){let S="";return R.scheme&&(S+=R.scheme+":"),S+="//",R.auth&&(S+=R.auth+"@"),R.host&&(S+=R.host),R.port&&(S+=":"+R.port),R.path&&(S+=R.path),S}t.urlGenerate=s;const o=32;function a(R){const S=[];return function(F){for(let P=0;P<S.length;P++)if(S[P].input===F){const H=S[0];return S[0]=S[P],S[P]=H,S[0].result}const N=R(F);return S.unshift({input:F,result:N}),S.length>o&&S.pop(),N}}const c=a(function(S){let F=S;const N=i(S);if(N){if(!N.path)return S;F=N.path}const P=t.isAbsolute(F),H=[];let M=0,I=0;for(;;)if(M=I,I=F.indexOf("/",M),I===-1){H.push(F.slice(M));break}else for(H.push(F.slice(M,I));I<F.length&&F[I]==="/";)I++;let E=0;for(I=H.length-1;I>=0;I--){const D=H[I];D==="."?H.splice(I,1):D===".."?E++:E>0&&(D===""?(H.splice(I+1,E),E=0):(H.splice(I,2),E--))}return F=H.join("/"),F===""&&(F=P?"/":"."),N?(N.path=F,s(N)):F});t.normalize=c;function l(R,S){R===""&&(R="."),S===""&&(S=".");const F=i(S),N=i(R);if(N&&(R=N.path||"/"),F&&!F.scheme)return N&&(F.scheme=N.scheme),s(F);if(F||S.match(r))return S;if(N&&!N.host&&!N.path)return N.host=S,s(N);const P=S.charAt(0)==="/"?S:c(R.replace(/\/+$/,"")+"/"+S);return N?(N.path=P,s(N)):P}t.join=l,t.isAbsolute=function(R){return R.charAt(0)==="/"||n.test(R)};function u(R,S){R===""&&(R="."),R=R.replace(/\/$/,"");let F=0;for(;S.indexOf(R+"/")!==0;){const N=R.lastIndexOf("/");if(N<0||(R=R.slice(0,N),R.match(/^([^\/]+:\/)?\/*$/)))return S;++F}return Array(F+1).join("../")+S.substr(R.length+1)}t.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(R){return R}function h(R){return m(R)?"$"+R:R}t.toSetString=f?d:h;function p(R){return m(R)?R.slice(1):R}t.fromSetString=f?d:p;function m(R){if(!R)return!1;const S=R.length;if(S<9||R.charCodeAt(S-1)!==95||R.charCodeAt(S-2)!==95||R.charCodeAt(S-3)!==111||R.charCodeAt(S-4)!==116||R.charCodeAt(S-5)!==111||R.charCodeAt(S-6)!==114||R.charCodeAt(S-7)!==112||R.charCodeAt(S-8)!==95||R.charCodeAt(S-9)!==95)return!1;for(let F=S-10;F>=0;F--)if(R.charCodeAt(F)!==36)return!1;return!0}function b(R,S,F){let N=k(R.source,S.source);return N!==0||(N=R.originalLine-S.originalLine,N!==0)||(N=R.originalColumn-S.originalColumn,N!==0||F)||(N=R.generatedColumn-S.generatedColumn,N!==0)||(N=R.generatedLine-S.generatedLine,N!==0)?N:k(R.name,S.name)}t.compareByOriginalPositions=b;function w(R,S,F){let N=R.generatedLine-S.generatedLine;return N!==0||(N=R.generatedColumn-S.generatedColumn,N!==0||F)||(N=k(R.source,S.source),N!==0)||(N=R.originalLine-S.originalLine,N!==0)||(N=R.originalColumn-S.originalColumn,N!==0)?N:k(R.name,S.name)}t.compareByGeneratedPositionsDeflated=w;function k(R,S){return R===S?0:R===null?1:S===null?-1:R>S?1:-1}function T(R,S){let F=R.generatedLine-S.generatedLine;return F!==0||(F=R.generatedColumn-S.generatedColumn,F!==0)||(F=k(R.source,S.source),F!==0)||(F=R.originalLine-S.originalLine,F!==0)||(F=R.originalColumn-S.originalColumn,F!==0)?F:k(R.name,S.name)}t.compareByGeneratedPositionsInflated=T;function A(R){return JSON.parse(R.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=A;function C(R,S,F){if(S=S||"",R&&(R[R.length-1]!=="/"&&S[0]!=="/"&&(R+="/"),S=R+S),F){const N=i(F);if(!N)throw new Error("sourceMapURL could not be parsed");if(N.path){const P=N.path.lastIndexOf("/");P>=0&&(N.path=N.path.substring(0,P+1))}S=l(s(N),S)}return c(S)}t.computeSourceURL=C})(Lc);var sp={};let I5=class Dx{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new Dx;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};sp.ArraySet=I5;var nx={};const rx=Lc;function N5(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||rx.compareByGeneratedPositionsInflated(t,e)<=0}let C5=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){N5(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(rx.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};nx.MappingList=C5;const Mc=qE,Ye=Lc,Xu=sp.ArraySet,L5=nx.MappingList;let ix=class $x{constructor(e){e||(e={}),this._file=Ye.getArg(e,"file",null),this._sourceRoot=Ye.getArg(e,"sourceRoot",null),this._skipValidation=Ye.getArg(e,"skipValidation",!1),this._sources=new Xu,this._names=new Xu,this._mappings=new L5,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new $x({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Ye.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=Ye.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=Ye.getArg(e,"generated"),r=Ye.getArg(e,"original",null);let i=Ye.getArg(e,"source",null),s=Ye.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=Ye.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Ye.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Ye.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=Ye.relative(s,i));const o=this._mappings.toArray().length>0?new Xu:this._sources,a=new Xu;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=Ye.join(r,c.source)),s!=null&&(c.source=Ye.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=Ye.join(r,c)),s!=null&&(c=Ye.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,p=d.length;h<p;h++){if(l=d[h],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!Ye.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Mc.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Mc.encode(f-o),o=f,c+=Mc.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Mc.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Mc.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Ye.relative(n,r));const i=Ye.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};ix.prototype._version=3,XE.SourceMapGenerator=ix;var sx={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(sx);var Uc={exports:{}},M5={},U5=Object.freeze({__proto__:null,default:M5}),ox=jx(U5);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;Uc.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Uc.exports.initialize=e=>t=e}else{const t=ox,e=ox;Uc.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Uc.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var ax=Uc.exports;const F5=ax;function B5(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Fc=null;var P5=function(){if(Fc)return Fc;const e=[];return Fc=F5().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new B5;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),e[e.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw Fc=null,n}),Fc};const kt=Lc,op=sx,qu=sp.ArraySet,D5=ax,$5=P5,ap=Symbol("smcInternal");class je{constructor(e,n){return e==ap?Promise.resolve(this):z5(e,n)}static initialize(e){D5.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return K5(e,n)}static async with(e,n,r){const i=await new je(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}je.prototype._version=3,je.GENERATED_ORDER=1,je.ORIGINAL_ORDER=2,je.GREATEST_LOWER_BOUND=1,je.LEAST_UPPER_BOUND=2;class Bc extends je{constructor(e,n){return super(ap).then(r=>{let i=e;typeof e=="string"&&(i=kt.parseSourceMapInput(e));const s=kt.getArg(i,"version");let o=kt.getArg(i,"sources");const a=kt.getArg(i,"names",[]);let c=kt.getArg(i,"sourceRoot",null);const l=kt.getArg(i,"sourcesContent",null),u=kt.getArg(i,"mappings"),f=kt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=kt.normalize(c)),o=o.map(String).map(kt.normalize).map(function(d){return c&&kt.isAbsolute(c)&&kt.isAbsolute(d)?kt.relative(c,d):d}),r._names=qu.fromArray(a.map(String),!0),r._sources=qu.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return kt.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,$5().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=kt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new Bc(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||je.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=kt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case je.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case je.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=kt.getArg(e,"source");const r=kt.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:kt.getArg(e,"line"),generatedColumn:kt.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=kt.getArg(e,"bias",je.GREATEST_LOWER_BOUND);r==null&&(r=je.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=kt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=kt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=kt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:kt.getArg(i,"originalLine",null),column:kt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=kt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=kt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=kt.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:kt.getArg(e,"line"),originalColumn:kt.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=kt.getArg(e,"bias",je.GREATEST_LOWER_BOUND);i==null&&(i=je.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:kt.getArg(s,"generatedLine",null),column:kt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Bc.prototype.consumer=je;class j5 extends je{constructor(e,n){return super(ap).then(r=>{let i=e;typeof e=="string"&&(i=kt.parseSourceMapInput(e));const s=kt.getArg(i,"version"),o=kt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new qu,r._names=new qu,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=kt.getArg(c,"offset"),u=kt.getArg(l,"line"),f=kt.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new je(kt.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(kt.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(kt.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:kt.getArg(e,"line"),generatedColumn:kt.getArg(e,"column")},r=op.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(kt.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=kt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,n,r){const i=n||null,s=r||je.GENERATED_ORDER;let o;switch(s){case je.GENERATED_ORDER:o=this._generatedMappings;break;case je.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=kt.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return op.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=kt.getArg(e,"line"),r={source:kt.getArg(e,"source"),originalLine:n,originalColumn:kt.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",kt.compareByOriginalPositions,op.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:kt.getArg(o,"generatedLine",null),column:kt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:kt.getArg(o,"generatedLine",null),column:kt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function z5(t,e){let n=t;typeof t=="string"&&(n=kt.parseSourceMapInput(t));const r=n.sections!=null?new j5(n,e):new Bc(n,e);return Promise.resolve(r)}function K5(t,e){return Bc.fromSourceMap(t,e)}var cx={};const W5=XE.SourceMapGenerator,Ju=Lc,H5=/(\r?\n)/,G5=10,ra="$$$isSourceNode$$$";let Y5=class wp{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[ra]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new wp,s=e.split(H5);let o=0;const a=function(){const h=m(),p=m()||"";return h+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const p=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,p),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const p=n.sourceContentFor(h);p!=null&&(r!=null&&(h=Ju.join(r,h)),i.setSourceContent(h,p))}),i;function d(h,p){if(h===null||h.source===void 0)i.add(p);else{const m=r?Ju.join(r,h.source):h.source;i.add(new wp(h.originalLine,h.originalColumn,m,p,h.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[ra]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[ra]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[ra]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[ra]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[Ju.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][ra]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(Ju.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new W5(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===G5?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};cx.SourceNode=Y5;var V5=cx.SourceNode;let lx=0;const ux=di,Z5=["Command","lines"];class X5 extends RU{constructor(){super(nE,{traceInitPerf:di,skipValidations:!di,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Ft(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Ft(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Ac)}])}));Ft(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Ft(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Ft(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Ft(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Ow)}));Ft(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(w0)}));Ft(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Rw)}])}));Ft(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Sw)}));Ft(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Iw),this.SUBRULE(this.words),this.CONSUME(Nw)}));Ft(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(qo),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Ft(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Ft(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Ft(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Ft(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(A0),this.SUBRULE(this.words)}));Ft(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(Ww),this.SUBRULE(this.words)}));Ft(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(R0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Ft(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Pu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Ac)),this.CONSUME4(qo),this.CONSUME4(S0)}}])}));Ft(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Pu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(qo),this.CONSUME(S0)}}])}));Ft(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Pu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Ft(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(qo),this.CONSUME(O0),this.CONSUME(R0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ft(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(qo),this.CONSUME(O0),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ft(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(Zw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ft(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(Xw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ft(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(qw),this.SUBRULE(this.words)}));Ft(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(Jw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ft(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(Qw)}));Ft(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(tE)}));Ft(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(Yw)}));Ft(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Vw)}));Ft(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(E0),this.SUBRULE2(this.and_test)})}));Ft(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(v0),this.SUBRULE2(this.not_test)})}));Ft(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(x0),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Ft(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Ft(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Mw)},{ALT:()=>this.CONSUME(Uw)},{ALT:()=>this.CONSUME(Fw)},{ALT:()=>this.CONSUME(Bw)},{ALT:()=>this.CONSUME(Pw)},{ALT:()=>this.CONSUME(Dw)}])}));Ft(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(E0),this.SUBRULE2(this.and_test_value)})}));Ft(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(v0),this.SUBRULE2(this.not_test_value)})}));Ft(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(x0),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Ft(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Ft(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(k0)},{ALT:()=>this.CONSUME(T0)}]),this.SUBRULE(this.term)}));Ft(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Ft(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(jw)},{ALT:()=>this.CONSUME(A0)},{ALT:()=>this.CONSUME(zw)},{ALT:()=>this.CONSUME(Kw)}]),this.SUBRULE(this.factor)}));Ft(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(k0)},{ALT:()=>this.CONSUME(T0)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Ft(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME($w),this.SUBRULE(this.factor)})}));Ft(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Ft(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Cw)},{ALT:()=>this.CONSUME(yn)},{ALT:()=>this.CONSUME(Lw)},{ALT:()=>{this.CONSUME(Hw),this.SUBRULE(this.words),this.CONSUME(Gw)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=Z5.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(lx++).toString().padStart(3),c=s?"font-weight: bold;":"";if(ux&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),ux&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),lx--},i)}}const ia=new X5;if($U){const t=ia.getGAstProductions(),e=DU(t);console.info(e)}const q5=ia.getBaseCstVisitorConstructor();var yt=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(yt||{}),to=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(to||{}),pi=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(pi||{}),Qu=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(Qu||{});function Rr(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class J5 extends q5{constructor(){super();Ft(this,"unique",0);di&&this.validateVisitor()}visit(n){if(ce(n)&&(n=n[0]),!!x(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():x(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:Rr(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:Rr(n.token_stat,"@").slice(1)}))}stmt_text(n,r){return this.createlinenode(r,this.createcodenode(r,{type:6,value:Rr(n.token_text,"")}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:Rr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:Rr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n,r){return n.words?this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n,r){const[i]=this.createlogicnode(r,Rr(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=Pe(),s=Pe();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=Pe(),s=Pe();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,Rr(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){return this.createcodenode(r,{type:17,lines:this.go(n.command_fork)})}command_while(n,r){const i=Pe(),s=Pe();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=Pe(),s=Pe(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=Pe(),s=Pe(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=Pe();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=Rr(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}))}command_toast(n,r){const s=Rr(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,"toast"),this.createstringnode(r,s)].flat()}))}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}token(n,r){if(n.token_stringliteraldouble){const i=Rr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Rr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Rr(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return n.token_lparen?this.createcodenode(r,{type:31,words:this.go(n.words)}):[]}}const Q5=new J5,Hn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},th="zss.js";function te(t,e){return new V5(t.startLine??1,t.startColumn??1,th,e)}function cp(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function lp(t){return`'${cp(t)}'`}function eh(t){if(t.startsWith('"'))return eh(t.replaceAll(/(^"|"$)/g,""));const e=Z0(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===Y0?`', api.get('${cp(r.image.substring(1))}'), '`:cp(r.image)).join("")}'].join('')`}function sa(t){return t.filter(e=>e!==void 0).map(ie)}function hx(t){return te(t,"")}function t4(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function nn(t,e,n){return te(t,[`api.${e}(`,...t4(n,", "),")"])}function e4(t){if(t.type===yt.COMPARE&&t.compare.type===yt.COMPARE_ITEM)switch(t.compare.method){case to.IS_EQ:return nn(t,"isEq",[ie(t.lhs),ie(t.rhs)]);case to.IS_NOT_EQ:return nn(t,"isNotEq",[ie(t.lhs),ie(t.rhs)]);case to.IS_LESS_THAN:return nn(t,"isLessThan",[ie(t.lhs),ie(t.rhs)]);case to.IS_GREATER_THAN:return nn(t,"isGreaterThan",[ie(t.lhs),ie(t.rhs)]);case to.IS_LESS_THAN_OR_EQ:return nn(t,"isLessThanOrEq",[ie(t.lhs),ie(t.rhs)]);case to.IS_GREATER_THAN_OR_EQ:return nn(t,"isGreaterThanOrEq",[ie(t.lhs),ie(t.rhs)])}return te(t,"")}function eo(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",ie(n),")"])}function fx(t,e,n){return t.prepend(`api.${e}(`),t.add([ie(n),")"])}function n4(t,e){if(t.type===yt.OPERATOR_ITEM)switch(t.operator){case pi.PLUS:return eo(e,"opPlus",t.rhs);case pi.MINUS:return eo(e,"opMinus",t.rhs);case pi.POWER:return eo(e,"opPower",t.rhs);case pi.MULTIPLY:return eo(e,"opMultiply",t.rhs);case pi.DIVIDE:return eo(e,"opDivide",t.rhs);case pi.MOD_DIVIDE:return eo(e,"opModDivide",t.rhs);case pi.FLOOR_DIVIDE:return eo(e,"opFloorDivide",t.rhs);case pi.UNI_PLUS:return fx(e,"opUniPlus",t.rhs);case pi.UNI_MINUS:return fx(e,"opUniMinus",t.rhs)}return te(t,"")}function r4(t){if(t.type===yt.OPERATOR){const e=t.lhs?ie(t.lhs):te(t,"");return t.items.forEach(n=>n4(n,e)),e}return te(t,"")}function nh(t,e){return te(t,[nn(t,"jump",[`${e}`]),"; continue;"])}function Ki(t){return Hn.linelookup[t??""]??-1}function up(t,e){Hn.linelookup[t]=e}function oa(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===e&&(i.done=n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===e&&(i.skip=n);break;case yt.LINE:oa(i.stmts,e,n);break}}}function dx(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===e&&up(i.done,n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===e&&up(i.skip,n);break;case yt.LINE:dx(i.stmts,e,n);break}}}function ie(t){var e;switch(t.type){case yt.PROGRAM:return te(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(ie).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${th}`]);case yt.API:return te(t,["  ",nn(t,t.method,sa(t.words)),`;
`]);case yt.LINE:return te(t,[`case ${t.lineindex}:
`,...t.stmts.map(ie).flat(),`  break;
`]);case yt.MARK:return te(t,`  // ${t.comment}
`);case yt.GOTO:{const n=Ki(t.id);return te(t,["  ",nh(t,n),`
`])}case yt.COUNT:return te(t,`${t.index}`);case yt.LITERAL:switch(t.literal){case Qu.NUMBER:return te(t,`${t.value}`);case Qu.STRING:return te(t,lp(t.value));case Qu.TEMPLATE:return te(t,eh(t.value))}return hx(t);case yt.TEXT:return te(t,["  ",nn(t,"text",[eh(t.value)]),`;
`]);case yt.STAT:if(Hn.isfirststat){Hn.isfirststat=!1;const n=t.value.trim().split(" ").map(lp);return te(t,["  ",nn(t,"stat",n),`;
`])}return te(t,`  // skipped ${t.value}
`);case yt.LABEL:{const n=It(t.name),r=t.active?"label":"comment";Hn.labels[n]||(Hn.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return Hn.labels[n].push(i),te(t,`  // ${i} '${n}' ${r}
`)}case yt.HYPERLINK:return te(t,["  ",nn(t,"hyperlink",[eh(t.text),...sa(t.link)]),`;
`]);case yt.MOVE:{const n=nn(t,"command",[lp("go"),sa(t.words)].flat());return t.wait?te(t,["  if (",n,`) { continue; };
`]):te(t,["  ",n,`;
`])}case yt.COMMAND:return te(t,["  if (",nn(t,"command",sa(t.words)),`) { continue; };
`]);case yt.IF:{const n=((e=t.block)==null?void 0:e.type)===yt.IF_BLOCK?t.block:void 0;if(x(n)){oa([t.check],yt.IF_CHECK,n.skip);const r=te(t,ie(t.check));return n.lines.forEach(i=>r.add(ie(i))),dx(n.altlines,yt.ELSE_IF,Ki(n.done)),n.altlines.forEach(i=>r.add(ie(i))),r}return te(t,ie(t.check))}case yt.IF_CHECK:{const n=Ki(t.skip);return n===-1?te(t,["  ",nn(t,t.method,sa(t.words)),`;
`]):te(t,["  if (!",nn(t,t.method,sa(t.words)),") { ",nh(t,n),` }
`])}case yt.ELSE_IF:case yt.ELSE:{const n=te(t,"");return t.lines.forEach(r=>n.add(ie(r))),n}case yt.WHILE:{const n=Ki(t.loop),r=Ki(t.done),i=te(t,"");return oa(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case yt.REPEAT:{const n=Ki(t.loop),r=Ki(t.done),i=te(t,"");return oa(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case yt.WAITFOR:{const n=te(t,"");return oa(t.lines,yt.IF_CHECK,t.loop),t.lines.forEach(r=>{n.add(ie(r))}),n}case yt.FOREACH:{const n=Ki(t.loop),r=Ki(t.done),i=te(t,"");return oa(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case yt.BREAK:return te(t,["  ",nh(t,t.goto),`
`]);case yt.CONTINUE:return te(t,["  ",nh(t,t.goto),`
`]);case yt.OR:return nn(t,"or",t.items.map(ie));case yt.AND:return nn(t,"and",t.items.map(ie));case yt.NOT:return nn(t,"not",t.items.map(ie));case yt.COMPARE:return e4(t);case yt.OPERATOR:return r4(t);case yt.EXPR:return nn(t,"expr",t.words.map(ie));default:return console.error("<unsupported node>",t.type,t),hx(t)}}function mi(t){if(x(t))switch(t.type===yt.LINE&&++Hn.lineindex,t.lineindex=Hn.lineindex,t.type){case yt.PROGRAM:t.lines.forEach(mi);break;case yt.LINE:t.stmts.forEach(mi);break;case yt.MARK:up(t.id,t.lineindex);break;case yt.IF:mi(t.check),mi(t.block);break;case yt.IF_BLOCK:t.lines.forEach(mi),t.altlines.forEach(mi);break;case yt.ELSE_IF:t.lines.forEach(mi);break;case yt.ELSE:case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.WAITFOR:t.lines.forEach(mi);break;case yt.MOVE:case yt.COMMAND:case yt.IF_CHECK:t.words.forEach(mi);break}}function i4(t){Hn.labels={},Hn.internal=1,Hn.lineindex=0,Hn.isfirststat=!0,mi(t)}function s4(t){return i4(t),{...ie(t).toStringWithSourceMap({file:`${th}.map`}),...Hn}}function px(t){return ce(t)?t.length>0?1:0:t??0}function o4(t){return`${t}_chip`}function mx(t=""){return`vm:${t??""}`}function a4(t,e,n){var l,u;const r=o4(t),i=Sr(r);let s;const o=Zn(Object.entries(n.labels??{}));(!ce(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){y.words=d;const h=x5(e,f);return x(h)?h(c,d):f!=="send"?a("send",[f,...d]):0}const c={halt(){E4(r)},id(){return t},set(f,d){const[h,p]=k5(e,c,f,d);if(h)return p},get(f){const[d,h]=v5(e,c,f);if(d)return h},tick(f){const d=At(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return ZE(e,c),!1;i.lc=0,i.ys=0,y.get=c.get,T5(e,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){he(et,y.elementfocus,"crash",p.message),i.es=1}return ZE(e,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return At(i.lc)?++i.lc>Fi.HALT_AT_COUNT:!0},hm(){if(ce(i.mg)&&ce(i.lb)){const[f]=i.mg;if(x(f))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f)return p.find(m=>At(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,p){et.emit(f,`${mx(d)}:${h}`,p)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(ce(i.lb))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f){const m=p.findIndex(b=>b>0);m>=0&&(p[m]*=-1)}}},restore(f){if(ce(i.lb))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f)for(let m=0;m<p.length;m++)p[d]=Math.abs(p[d])}},getcase(){i.ec=At(i.ec)?i.ec:1;const f=c.hm();if(f&&ce(i.mg)){const[,d,h,p]=i.mg;c.set("sender",h),x(d)&&c.set("arg",d),p&&(c.set("player",p),y.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=At(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=pF.parse(f),[h]=d.filter(p=>p.fileName===th);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(It(be(d)),h)},if(...f){const[d,h]=rt(f,0,[z.ANY]),p=px(d);return p&&h<f.length&&c.command(...f.slice(h)),p?1:0},try(...f){const[,d]=rt(f,0,[z.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,p]=rt(f,0,[z.NAME,z.ANY]),m=At(h),b=m?p:1,w=c.get(d),k=m?h:1;if(!At(w))return b<f.length&&c.command(...f.slice(b)),1;const T=w-k;return T<0?(b<f.length&&c.command(...f.slice(b)),1):(c.set(d,T),0)},give(...f){const[d,h,p]=rt(f,0,[z.NAME,z.ANY]),m=At(h),b=m?p:1,w=c.get(d),k=m?h:1,T=w===void 0?1:0;return T&&b<f.length&&c.command(...f.slice(b)),c.set(d,Oc(w,0)+k),T},repeatstart(f,...d){const[h,p]=rt(d,0,[z.NUMBER]),m=`repeatcount${f}`,b=`repeatwords${f}`;i[m]=h,i[b]=p<d.length?d.slice(p):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!At(i[d]))return 0;const p=i[d];i[d]=p-1;const m=p>0,b=i[h];return m&&ce(b)&&c.command(...b),m?1:0},foreachstart(f,...d){const[h,p,m,b]=rt(d,0,[z.NAME,z.NUMBER,z.NUMBER,z.MAYBE_NUMBER]);let w=Math.min(p,m),k=Math.max(p,m);const T=(b??0)||1;if(T<0){const A=w;w=k,k=A}return c.set(h,w-T),0},foreach(f,...d){const[h,p,m,b,w]=rt(d,0,[z.NAME,z.NUMBER,z.NUMBER,z.MAYBE_NUMBER]);let k=Math.min(p,m),T=Math.max(p,m);const A=(b??0)||1;if(A<0){const S=k;k=T,T=S}let C=c.get(h);!At(C)||C<k||C>T?C=k:C+=A;const R=C<=T?1:0;return R&&(c.set(h,C),w<d.length&&c.command(...d.slice(w))),R},waitfor(...f){const[d]=rt(f,0,[z.ANY]),h=px(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[z.ANY]);if(d=p,d)break;h=m}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[z.ANY]);if(d=p,!d)break;h=m}return d},not(...f){const[d]=rt(f,0,[z.ANY]);return d?0:1},expr(...f){const[d]=rt(f,0,[z.ANY]);return d},isEq(f,d){const[h]=rt([f],0,[z.ANY]),[p]=rt([d],0,[z.ANY]);return typeof h=="object"||typeof p=="object"?wv(h,p)?1:0:h===p?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h<p?1:0},isGreaterThan(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h>p?1:0},isLessThanOrEq(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h<=p?1:0},isGreaterThanOrEq(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h>=p?1:0},opPlus(f,d){const[h]=rt([f],0,[z.ANY]),[p]=rt([d],0,[z.ANY]);return h+p},opMinus(f,d){const[h]=rt([f],0,[z.ANY]),[p]=rt([d],0,[z.ANY]);return h-p},opPower(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return Math.pow(h,p)},opMultiply(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h*p},opDivide(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h/p},opModDivide(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h%p},opFloorDivide(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return Math.floor(h/p)},opUniPlus(f){const[d]=rt([f],0,[z.NUMBER]);return+d},opUniMinus(f){const[d]=rt([f],0,[z.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function hp(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];ce(r)?r.forEach(i=>{e.push(hp(i))}):e.push(hp(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function c4(t){const e=rE(`${t}
`);if(e.errors.length>0)return e;ia.input=e.tokens;const n=ia.program();if(ia.errors.length>0)return{tokens:e.tokens,errors:ia.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=Q5.go(n);return r?(hp(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const fp=Object.getPrototypeOf(function*(){}).constructor;function l4(t,e){const n=`compile-${t}`;console.time(n);const r=c4(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=s4(r.ast);if(i.code){jU&&console.info(i.code);try{return{...r,...i,source:i.code,code:new fp("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new fp("api"," ")}}}return{...r,...i,source:"",code:new fp("api"," ")}}function u4(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=l4(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return x(s)?s.isended():!0},halt(i){const s=e[i];return x(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];x(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=e[i];if(!x(e[i])){const f=n(a,c);if(l=e[i]=a4(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((w,k)=>[w,k]);p.slice(h-5,h).forEach(([w,k])=>{he(et,cr(),"build",`$grey${k+1} $grey${w}`)});const[m,b]=p[h]??[];if(wt(m)&&x(b)){const w=(d.column??1)-1,k=w+d.length,T=w<m.length?m:`${m}*`,A=T.substring(0,w),C=T.substring(w,k),R=T.substring(k);he(et,cr(),"build",`$red${b+1} $grey${A}$red${C}$grey${R}`)}return d.message.split(`
`).forEach(w=>{he(et,cr(),"build",w)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Xn(i.target),a=e[s];if(x(a)){const c={...i,target:o};a.message(c)}}};return r}const Ve=new Xa,Nn={},rh={};function gx(t,e,n,r,i=0){const s=`tiles:${t}:${e}`;return x(Nn[s])||(Nn[s]=oN(t,e,n,r,i)),Nn[s]}function h4(t,e,n,r){const i=`sprites:${t}:${e}:${n}`,s=`sprite:${t}:${e}:${r}`;return x(rh[s])||(rh[s]=aN(t,e,n)),rh[s].id=i,rh[s]}function f4(t,e){const n=`sprites:${t}:${e}`;return x(Nn[n])||(Nn[n]=cN(t,e)),Nn[n]}function d4(t,e,n,r,i=0){const s=`dither:${t}:${e}`;return x(Nn[s])||(Nn[s]=lN(t,e,n,r,i)),Nn[s]}function ih(t,e,n,r){const i=`media:${t}:${e}`;x(Nn[i])||(Nn[i]=uN(t,e,n,r));const s=Nn[i];return s.mime=n,s.media=r,s}function p4(t,e){const n=`control:${t}:${e}`;return x(Nn[n])||(Nn[n]=hN(t,e)),Nn[n]}const ys=.4;function _x(t,e){const n=[];Ve.x=t-ys,Ve.y=e-ys,n.push(Ve.angle()),Ve.x=t+ys,Ve.y=e-ys,n.push(Ve.angle()),Ve.x=t-ys,Ve.y=e+ys,n.push(Ve.angle()),Ve.x=t+ys,Ve.y=e+ys,n.push(Ve.angle());const r=Math.round(id(Math.min(...n))),i=Math.round(id(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function dp(t,e,n,r,i,s,o){var F;if(!x(r)||!x(r.terrain)||!x(r.objects))return[];const a=[];let c=e;const l=St,u=Jt,f=o?Rt.BLACK:Rt.ONCLEAR,d=gx(t,c++,l,u,f);a.push(d);const h=c++,p=f4(t,h);p.sprites=[],a.push(p);const m=r.isdark?1:0,b=d4(t,c++,l,u,m);a.push(b),b.alphas.fill(m);const w=gx(t,c++,l,u,Rt.ONCLEAR);a.push(w),w.char.fill(0);const k={...X0(St,Jt,i,Rt.ONCLEAR),...w},T=p4(t,c++);if(s){if(a.push(T),wt(r.camera))switch(It(r.camera)){default:case"mid":T.viewscale=Yl.MID;break;case"near":T.viewscale=Yl.NEAR;break;case"far":T.viewscale=Yl.FAR;break}if(wt(r.graphics)){const P=It(r.graphics);switch(P){case"mode7":case"firstperson":T.graphics=P;break;default:case"flat":T.graphics="flat";break}}const{facing:N}=Sr(t);At(N)&&(T.facing=uy(N%360))}for(let N=0;N<r.terrain.length;++N){const P=r.terrain[N],H=$u(n,P,0,Rt.WHITE,o?Rt.BLACK:Rt.ONCLEAR);d.char[N]=H.char,d.color[N]=H.color,d.bg[N]=H.bg}const A=Object.values(r.objects??{});for(let N=0;N<A.length;++N){const P=A[N];if(x(P.removed))continue;const H=P.id??"",M=$u(n,P,1,Rt.WHITE,Rt.BLACK),I=h4(t,h,H,N);if(I.x=P.x??0,I.y=P.y??0,I.char=M.char,I.color=M.color,I.bg=M.bg,p.sprites.push(I),m){if(M.light>0){const E=[],D=qe(Math.round(M.light),1,St),q=D*.5,j=Ur(r,I),ot=1/q;if(b.alphas[j]=0,D>1)for(let tt=1;tt<=D;++tt)for(let ft=I.y-tt;ft<=I.y+tt;++ft)for(let V=I.x-tt;V<=I.x+tt;++V){if(V===I.x&&ft===I.y)continue;Ve.x=V-I.x,Ve.y=ft-I.y;const W=Ve.length();if(W>D)continue;const bt=Ur(r,{x:V,y:ft});if(bt===-1)continue;const at=Math.round(id(Ve.angle()));let lt=0;for(let Pt=0;Pt<E.length;++Pt){const Ut=E[Pt];at>=Ut[0]&&at<=Ut[1]&&(lt=Math.max(lt,Ut[2]))}b.alphas[bt]=Math.min(b.alphas[bt],lt+(W<q?0:(W-q)*ot)),b.alphas[bt]=qe(b.alphas[bt],0,1);const Dt=Rn(r,((F=r.lookup)==null?void 0:F[bt])??"");if(x(Dt)){const Pt=[..._x(Ve.x,Ve.y),.25];E.push(Pt)}const Yt=r.terrain[bt],Mt=Di(n,Yt),Ct=(Yt==null?void 0:Yt.collision)??(Mt==null?void 0:Mt.collision);if(Ko(zt.ISBULLET,Ct)){const Pt=[..._x(Ve.x,Ve.y),1];let Ut=0;for(Ut=0;Ut<E.length;++Ut){const se=E[Ut];if(se[1]>se[0]&&Pt[1]>=se[0]&&Pt[0]<=se[1]&&Pt[2]>=1&&se[2]>=1){E[Ut]=[Math.min(Pt[0],se[0]),Math.max(Pt[1],se[1]),1];break}}Ut===E.length&&E.push(Pt)}}}else if(Kr(H)){const E=Ur(r,I);b.alphas[E]=0}}if(wt(P.tickertext)&&At(P.tickertime)&&P.tickertext.length){const E=St,D=SE(P.tickertext,E,Jt-1),q=(D==null?void 0:D.measuredwidth)??1,j=P.x??0,ot=P.y??0,tt=ot<Jt*.5;k.x=j-Math.floor(q*.5),k.y=ot+(tt?1:-1),k.x+q>St&&(k.x=St-q),k.x<0&&(k.x=0),RE(P.tickertext,k,!0)}H===t&&(T.focusx=I.x,T.focusy=I.y,T.focusid=H)}a.push(ih(t,c++,"text/mood",m?"dark":"bright"));const C=we(jt.MAIN),R=$i(C,jt.MAIN);if(wt(R.palette)){const N=en(C,_t.PALETTE,R.palette),P=Ce(N);x(P==null?void 0:P.bits)&&a.push(ih(t,c++,"image/palette",Array.from(P.bits)))}if(wt(R.charset)){const N=en(C,_t.CHARSET,R.charset),P=Ce(N);x(P==null?void 0:P.bits)&&a.push(ih(t,c++,"image/charset",Array.from(P.bits)))}const S=Object.keys(r.objects).filter(Kr);return a.push(ih(t,c++,"text/players",S.join(","))),a}const ar=u4();var jt=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(jt||{});const ve={halt:!1,session:Pe(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function m4(){return ve.session}function cr(){return ve.operator}function g4(t){ve.operator=t}function _4(t){ve.halt=t}function y4(){return ve.halt}function aa(){return[...ve.books.values()]}function b4(){const[t]=ve.books.values();return t}function zr(t){const e=It(t);return ve.books.get(t)??aa().find(n=>n.name===e)}function sh(t,e){x(zr(e))&&(ve.software[t]=e)}function we(t){return zr(ve.software[t])}function yx(t){const e=cE([]);return wt(t)&&(e.name=t),pp(e),fe(et,ve.operator,`created [book] ${e.name}`),e}function w4(t){let e=zr(t);return x(e)||(e=cE([]),e.name=t),pp(e),fe(et,ve.operator,`created [book] ${e.name}`),e}function vn(t,e){let n=x(e)?w4(e):we(t);return x(n)||(x(n)||(n=b4()),x(n)||(n=yx(e)),x(n)&&fe(et,ve.operator,`opened [book] ${n.name} for ${t}`)),sh(t,n.id),n}function bs(t,e,n){return U0(vn(t),n,e)}function Sr(t){const e=vn("main");return $i(e,t)}function bx(t){const e=vn("main");return tF(e,t)}function wx(){const t=vn("main");return $i(t,"main")}function E4(t){const e=vn("main");return dE(e,t)}function x4(t,e){ve.books.clear(),t.forEach(r=>{ve.books.set(r.id,r),r.name==="main"&&(ve.software.main=r.id)});const n=zr(e);if(x(n)&&sh("main",n.id),!ve.software.main){const r=ve.books.values().next();r.value&&(ve.software.main=r.value.id)}}function pp(t){return ve.books.set(t.id,t),t.id}function v4(t){const e=zr(t);e&&ve.books.delete(e.id)}function Ex(t){if(!wt(t)||!t)return he(et,t,"login",`failed for playerid ==>${t}<==`);const e=we("main");if(!x(e))return he(et,t,"login:main","login failed to find book 'main'");const n=Js(e,t);if(x(n))return!0;const r=zn(e,_t.BOARD,"title");if(r.length===0)return he(et,t,"login:title","login failed to find board with 'title' stat");const i=qs(e,"player");if(!x(i))return he(et,t,"login:player","login failed to find object type 'player'");const s=dy(t,r),o=Ce(s);if(x(o)){const a=C0(s,"startx"),c=C0(s,"starty"),l=At(a)?a:Math.round(St*.5),u=At(c)?c:Math.round(Jt*.5),f=i.name??"player",d=xd(o,{x:l,y:u},f,t);if(x(d==null?void 0:d.id))return d.player=t,ju(e,t,o.id),!0}return!1}function k4(t){const e=we("main"),n=Js(e,t);if(!x(e))return;const r=[t];for(let i=0;i<e.activelist.length;++i){const s=e.activelist[i];s.startsWith(t)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];ju(e,s,""),P0(e,n,Rn(n,s)),Xy(n,s),ar.halt(s),dE(e,s)}}function lr(t){const e=we("main");return Js(e,t)}function T4(t){const e=we("main"),n=nF(e,t),r=Js(e,t),i=Rn(r,t);return n&&x(i)}function A4(t){const e=we("main"),n=B0(e);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Kr(c)&&x(t[c])===!1&&(t[c]=0,ju(e,c,i.id))}}}function xx(t){ar.message(t)}function ca(t,e,n,r){const i=is(e);wt(n.id)&&et.emit(t,"vm:touched",[n.id,i,r])}function R4(t,e,n,r){const i=n.id??"";if(r.x<0){const s=zn(t,_t.BOARD,(e==null?void 0:e.exitwest)??"");if(s.length){const o=Ae(s);Jo(t,i,o.id,{x:St-1,y:r.y})}}else if(r.x>=St){const s=zn(t,_t.BOARD,(e==null?void 0:e.exiteast)??"");if(s.length){const o=Ae(s);Jo(t,i,o.id,{x:0,y:r.y})}}else if(r.y<0){const s=zn(t,_t.BOARD,(e==null?void 0:e.exitnorth)??"");if(s.length){const o=Ae(s);Jo(t,i,o.id,{x:r.x,y:Jt-1})}}else if(r.y>=Jt){const s=zn(t,_t.BOARD,(e==null?void 0:e.exitsouth)??"");if(s.length){const o=Ae(s);Jo(t,i,o.id,{x:r.x,y:0})}}}function la(t,e,n,r){if(!x(n==null?void 0:n.id))return!1;const i=j0(t,e,n,r);if(x(i)){const s=Kr(i.id);return n.kind==="player"&&i.kind==="edge"?R4(t,e,n,r):ca("",i,n,"thud"),n.kind==="player"?ca(n.id,n,i,s?"bump":"touch"):n.collision===zt.ISBULLET?He(t,i,"collision")===zt.ISBULLET?ca("",n,i,"thud"):Kr(n.party)?ca(n.id,n,i,s?"partyshot":"shot"):ca("",n,i,s?"shot":"partyshot"):ca("",n,i,"bump"),He(t,i,"destructible")?(x(i==null?void 0:i.id)?or(y.book,y.board,i,y.timestamp):un(e,{x:r.x,y:r.y}),!0):!1}return!0}function vx(t,e,n,r,i=aR){var f;if(!x(t)||!x(e)||!x(n))return;const s={...y};y.book=t,y.board=e,y.element=n,y.elementid=n.id??"",y.elementisplayer=Kr(y.elementid);const o=y.element.player??ve.operator;y.elementfocus=y.elementisplayer?y.elementid:o;const a=Di(t,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=It(n.name??((f=n.kinddata)==null?void 0:f.name)??"");if(ar.tick(l,_s.RUNTIME,At(c)?c:i,u,r),At(n==null?void 0:n.tickertime)&&y.timestamp-n.tickertime>rl*5&&(n.tickertime=0,n.tickertext=""),y.elementisplayer){const d=Sr(y.elementid);At(d.inputcurrent)&&(d.inputcurrent=0)}hr(s).forEach(d=>{y[d]=s[d]})}function S4(t,e){ve.loaders.set(t,e)}function O4(t){ar.halt(t)}function I4(){const t=ar.ids();for(let n=0;n<t.length;++n)ar.halt(t[n]);const e=we("main");x(e)&&(e.flags={})}function N4(){const t=we("main");if(!x(t))return;const e=t.timestamp+1,n=Fi.HALT_AT_COUNT;Fi.HALT_AT_COUNT=n*2,ve.loaders.forEach((i,s)=>{const o={...y};y.timestamp=t.timestamp,y.book=t,y.board=void 0,y.element=void 0,y.elementid=s,y.elementisplayer=!1,y.elementfocus=cr();const a=U$(s);x(a)&&ar.arg(s,a),ar.tick(s,_s.LOADER,1,"loader",i),ar.isended(s)&&(ar.halt(s),ve.loaders.delete(s)),hr(o).forEach(c=>{y[c]=o[c]})}),Fi.HALT_AT_COUNT=n,t.timestamp=e,y.timestamp=e;const r=B0(t);for(let i=0;i<r.length;++i){const s=r[i],o=uF(t,s,e);for(let a=0;a<o.length;++a){const{id:c,type:l,code:u,object:f}=o[a];l===_t.ERROR?ar.halt(c):vx(t,s,f,u)}}}function mp(t,e){const n=we("main");if(!x(n))return;function r(a,c){for(let l=0;l<a.length;++l){const u=a[l];if(x(u.id)){const f=`${mx(u.id)}:${c}`;et.emit("",f,e)}}}const{target:i,path:s}=Xn(t),o=B0(n);for(let a=0;a<o.length;++a){const c=o[a];switch(It(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(Jy(c,[i]),s);break}}}}function C4(t){const e=Sr(t).playbuffer;wt(e)&&e&&kx(t,e)}function kx(t,e=""){var s;const n=vn("main");if(!x(n))return;const r=`${t}_cli`;y.timestamp=n.timestamp,y.book=n,y.board=Js(n,t),y.element=Rn(y.board,t),y.elementid=((s=y.element)==null?void 0:s.id)??"",y.elementisplayer=!0,y.elementfocus=y.elementid||t;const i=Fi.HALT_AT_COUNT;Fi.HALT_AT_COUNT=i*8,ar.once(r,_s.CLI,"cli",e),Sr(t).playbuffer=e,Fi.HALT_AT_COUNT=i}function oh(t){var a;const e=vn("main"),n=Pi(e,t);if(!x(e)||!x(n)||!x(y.element))return;const r={...y},i=`${t}_run`,s=It(y.element.name??((a=y.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";ar.once(i,_s.RUNTIME,s,o),hr(r).forEach(c=>{y[c]=r[c]})}function L4(t,e){const n=we("main"),r=Js(n,t),i=[],s=[],o=[];if(!x(n)||!x(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=fs(n,r.overboard??""),l=fs(n,r.underboard??"");return s.push(...dp(t,0,n,l,e,!1,!0)),o.push(...dp(t,s.length,n,r,e,!0,a!=="flat")),i.push(...dp(t,s.length+o.length,n,c,e,!1,!1)),{over:i,under:s,layers:o}}function ua(t,e=0){const n=[];let r=t;for(;r<y.words.length;){const[i,s]=Gn(r);if(ce(i)&&!Si(i)&&!Cc(i)&&!Wu(i)&&!ri(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),e>0&&n.length>=e)return[n,r]}return[n,r]}function Gn(t){var r,i,s,o,a,c,l,u,f;const e=y.words[t],n=t+1;if(ME(e)){const[d,h]=R$(t);if(x(d))return[d,h]}if(S$(e)){const[d,h]=O$(t);if(x(d))return[d,h]}if(ad(e)){const[d,h]=cd(t);if(x(d))return[d,h]}if(wt(e)&&It(e)==="rnd"){const[d,h]=Gn(n),[p,m]=Gn(h);return At(d)&&At(p)?[yr(d,p),m]:At(d)?[yr(0,d),h]:[yr(0,1),n]}if(od(e)){const[d,h]=gy(t);if(x(d))return[d,h]}if(!x(e))return[void 0,t];if(At(e)||ce(e))return[e,n];if(wt(e)){const d=It(e),h=(r=y.get)==null?void 0:r.call(y,e);if(x(h))return[h,n];switch(d){case"aligned":case"alligned":{const p=ic(y.board,{x:((i=y.element)==null?void 0:i.x)??-1,y:((s=y.element)==null?void 0:s.y)??-1},y.elementfocus);return!x(y.element)||!x(p)?[0,n]:[y.element.x===p.x||y.element.y===p.y?1:0,n]}case"contact":{const p=ic(y.board,{x:((o=y.element)==null?void 0:o.x)??-1,y:((a=y.element)==null?void 0:a.y)??-1},y.elementfocus);if(!x(y.element)||!x(p))return[0,n];const m=(p.x??0)-(((c=y.element)==null?void 0:c.x)??0),b=(p.y??0)-(((l=y.element)==null?void 0:l.y)??0);return[m===0&&Math.abs(b)<2||b===0&&Math.abs(m)<2?1:0,n]}case"blocked":{const[p,m]=rt(y.words,n,[z.DIR]);return[cF(y.book,y.board,y.element,p.destpt)?1:0,m]}case"any":{const[p,m]=rt(y.words,n,[z.KIND]);return[qy(y.board,p).length?1:0,m]}case"rnd":return[yr(0,1),n];case"abs":{const[p,m]=rt(y.words,n,[z.NUMBER]);return[Math.abs(p),m]}case"intceil":{const[p,m]=rt(y.words,n,[z.NUMBER]);return[Math.ceil(p),m]}case"intfloor":{const[p,m]=rt(y.words,n,[z.NUMBER]);return[Math.floor(p),m]}case"intround":{const[p,m]=rt(y.words,n,[z.NUMBER]);return[Math.round(p),m]}case"clamp":{const[p,m,b,w]=rt(y.words,n,[z.NUMBER,z.NUMBER,z.NUMBER]);return[qe(p,m,b),w]}case"min":{const[p,m]=ua(n);return[Math.min(...p),m]}case"max":{const[p,m]=ua(n);return[Math.max(...p),m]}case"pick":{const[p,m]=ua(n);return[Ae(p),m]}case"pickwith":{const[p,m]=rt(y.words,n,[z.NUMBER_OR_STRING]),[b,w]=ua(m);return[dy(`${p}`,b),w]}case"random":{const[p,m]=ua(n,2),[b,w]=p;return[yr(b,w??0),m]}case"randomwith":{const[p,m]=rt(y.words,n,[z.NUMBER_OR_STRING]),[b,w]=ua(m,2),[k,T]=b;return[hy(`${p}`,k,T??0),w]}case"run":{const[p,m]=rt(y.words,n,[z.NAME]);return oh(p),[(u=y.get)==null?void 0:u.call(y,"arg"),m]}case"runwith":{const[p,m,b]=rt(y.words,n,[z.ANY,z.NAME]);return x(y.element)&&(y.element.arg=p),oh(m),[(f=y.get)==null?void 0:f.call(y,"arg"),b]}}}return[e,n]}const y={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var z=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.MAYBE_KIND=7]="MAYBE_KIND",t[t.MAYBE_NAME=8]="MAYBE_NAME",t[t.MAYBE_NUMBER=9]="MAYBE_NUMBER",t[t.MAYBE_STRING=10]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",t[t.ANY=12]="ANY",t))(z||{});function kn(t,e,n){throw console.info(n,y.element,y.elementid,y.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function Tx(t){var n,r;const e={x:((n=y.element)==null?void 0:n.x)??0,y:((r=y.element)==null?void 0:r.y)??0};return D0(y.book,y.board,y.element,y.elementfocus,t,e)}function rt(t,e,n){const r=y.words;y.words=t;const i=[];let s=e;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=Ey(s);Do(a)?(s=c,i.push(a)):kn("kind",a,t);break}case 0:{if(ad(t[0])===void 0){const[a,c]=Gn(s);ri(a)?(s=c,i.push(a)):kn("color",a,t)}else{const[a,c]=cd(s);ri(a)?(s=c,i.push(a)):kn("color",a,t)}break}case 2:{if(od(t[0])===void 0){const[a,c]=Gn(s);Si(a)?(s=c,i.push(Tx(a))):kn("direction",a,t)}else{const[a,c]=gy(s);Si(a)?(s=c,i.push(Tx(a))):kn("direction",a,t)}break}case 3:{const a=y.words[s];wt(a)||kn("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=Gn(s);if(wt(a)){const l=parseFloat(a);At(l)?i.push(l):kn("number",a,t)}else At(a)?i.push(a):kn("number",a,t);s=c;break}case 5:{const[a,c]=Gn(s);wt(a)||kn("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=Gn(s);let l=a;if(wt(l)){const u=parseFloat(l);At(u)&&(l=u)}else At(l)||kn("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=Ey(s);a!==void 0&&!Do(a)&&kn("optional kind",a,t),s=c,i.push(a);break}case 8:{const a=y.words[s];a!==void 0&&!wt(a)&&kn("optional string",a,t),++s,i.push(a);break}case 9:{const[a,c]=Gn(s);if(wt(a)){const l=parseFloat(a);At(l)?i.push(l):kn("optional number",a,t)}else At(a)||a===void 0?i.push(a):kn("optional number",a,t);s=c;break}case 10:{const[a,c]=Gn(s);a!==void 0&&!wt(a)&&kn("optional string",a,t),s=c,i.push(a);break}case 11:{const[a,c]=Gn(s);let l=a;if(wt(l)){const u=parseFloat(l);At(u)&&(l=u)}else l!==void 0&&!At(l)&&kn("number or string",l,t);s=c,i.push(l);break}case 12:{const[a,c]=Gn(s);s=c,i.push(a);break}}return y.words=r,[...i,s]}const ah={},ha={};function gp(){return{id:Pe(),layers:[],scroll:[],sidebar:[]}}const M4=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),U4=new Set(["tx","text"]),F4={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Ax={};let Rx=t=>{let e=Ax[t];return x(e)||(Ax[t]=e=gp()),e};function B4(t){Rx=t}function fn(t){return Rx(t)}function _p(t){return x(ah[t])||(ah[t]=[]),ah[t]}function P4(t){const e=fn(t);e.scroll=[]}function D4(t,e,n){Object.values(ha).forEach(r=>{if(r[e]!==void 0){const i=eb(t.id(),e);At(n)&&iI(i,n),wt(n)&&sI(i,n)}})}function ur(t){const e=_p(t);return ah[t]=[],e}function re(t,e){_p(t).push(e)}function Bt(t,e,n,r,i=()=>0,s=xh){const o=[e,n,...r],a=It(`${o[3]}`),c={...y};function l(u,f){x(f)&&f!==i(u)&&(y.board=c.board,y.element=c.element,y.elementfocus=c.elementfocus,s(u,f))}if(M4.has(a)){const u=`${o[2]}`;ha[e]=ha[e]??{};const f=i(u)??F4[a];if(ha[e][u]===void 0){const d=eb(e,u);At(f)&&rI(d,f),wt(f)&&Jf(d,f),U4.has(a)?ha[e][u]=ty(d,h=>{l(u,h)}):ha[e][u]=oI(d,h=>{l(u,h)})}}_p(t).push(o)}B4(t=>{if(Kr(t)){const e=we(jt.MAIN),n=$i(e,jt.GADGETSTORE);let r=n[t];return x(r)||(n[t]=r=gp()),r}return gp()});let Sx=0;function $4(){switch(Sx++){case 0:return Rt.BLUE;case 1:return Rt.BLACK;case 2:return Rt.GREEN;case 3:return Rt.BLACK;case 4:return Rt.CYAN;case 5:return Rt.BLACK;case 6:return Rt.RED;case 7:return Rt.BLACK;case 8:return Rt.PURPLE;case 9:return Rt.BLACK;case 10:return Rt.YELLOW;case 11:return Rt.BLACK;case 12:return Rt.WHITE;default:return Sx=0,Rt.BLACK}}const ch=so("gadgetserver",["tock","second"],t=>{if(!ch.session(t))return;const e=we(jt.MAIN),n=(e==null?void 0:e.activelist)??[],r=$i(e,jt.GADGETSYNC);switch(t.target){case"tock":{const i=$4();for(let s=0;s<n.length;++s){const o=n[s],{over:a,under:c,layers:l}=L4(o,i),u=fn(o);u.over=a,u.under=c,u.layers=l;const f=r[o]??{},d=Lp(f,u);d.length&&(r[o]=Zn(u),NA(ch,o,d))}break}case"second":for(let i=0;i<n.length;++i){const s=n[i],o=lr(s);x(o)&&KA(ch,s,o.id)}break;case"desync":IA(ch,t.player,fn(t.player));break;case"clearscroll":P4(t.player);break;case"clearplayer":{const i=we(jt.MAIN),s=$i(i,jt.GADGETSTORE);delete s[t.player];const o=$i(i,jt.GADGETSYNC);delete o[t.player];break}}});function lh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ox={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof lh=="function"&&lh;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(p){var m=r[l][1][p];return o(m||p)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof lh=="function"&&lh,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,p,m,b=[],w=0,k=c.length,T=k,A=s.getTypeOf(c)!=="string";w<c.length;)T=k-w,f=A?(l=c[w++],u=w<k?c[w++]:0,w<k?c[w++]:0):(l=c.charCodeAt(w++),u=w<k?c.charCodeAt(w++):0,w<k?c.charCodeAt(w++):0),d=l>>2,h=(3&l)<<4|u>>4,p=1<T?(15&u)<<2|f>>6:64,m=2<T?63&f:64,b.push(a.charAt(d)+a.charAt(h)+a.charAt(p)+a.charAt(m));return b.join("")},i.decode=function(c){var l,u,f,d,h,p,m=0,b=0,w="data:";if(c.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var k,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(k=o.uint8array?new Uint8Array(0|T):new Array(0|T);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(m++)))>>2,f=(3&h)<<6|(p=a.indexOf(c.charAt(m++))),k[b++]=l,h!==64&&(k[b++]=u),p!==64&&(k[b++]=f);return k}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,p){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,p){var m,b="";for(m=0;m<p;m++)b+=String.fromCharCode(255&h),h>>>=8;return b}function o(h,p,m,b,w,k){var T,A,C=h.file,R=h.compression,S=k!==l.utf8encode,F=a.transformTo("string",k(C.name)),N=a.transformTo("string",l.utf8encode(C.name)),P=C.comment,H=a.transformTo("string",k(P)),M=a.transformTo("string",l.utf8encode(P)),I=N.length!==C.name.length,E=M.length!==P.length,D="",q="",j="",ot=C.dir,tt=C.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ft.crc32=h.crc32,ft.compressedSize=h.compressedSize,ft.uncompressedSize=h.uncompressedSize);var V=0;p&&(V|=8),S||!I&&!E||(V|=2048);var W=0,bt=0;ot&&(W|=16),w==="UNIX"?(bt=798,W|=function(lt,Dt){var Yt=lt;return lt||(Yt=Dt?16893:33204),(65535&Yt)<<16}(C.unixPermissions,ot)):(bt=20,W|=function(lt){return 63&(lt||0)}(C.dosPermissions)),T=tt.getUTCHours(),T<<=6,T|=tt.getUTCMinutes(),T<<=5,T|=tt.getUTCSeconds()/2,A=tt.getUTCFullYear()-1980,A<<=4,A|=tt.getUTCMonth()+1,A<<=5,A|=tt.getUTCDate(),I&&(q=s(1,1)+s(u(F),4)+N,D+="up"+s(q.length,2)+q),E&&(j=s(1,1)+s(u(H),4)+M,D+="uc"+s(j.length,2)+j);var at="";return at+=`
\0`,at+=s(V,2),at+=R.magic,at+=s(T,2),at+=s(A,2),at+=s(ft.crc32,4),at+=s(ft.compressedSize,4),at+=s(ft.uncompressedSize,4),at+=s(F.length,2),at+=s(D.length,2),{fileRecord:f.LOCAL_FILE_HEADER+at+F+D,dirRecord:f.CENTRAL_FILE_HEADER+s(bt,2)+at+s(H.length,2)+"\0\0\0\0"+s(W,4)+s(b,4)+F+D+H}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,p,m,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-b-1))/m:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=o(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=o(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(b){return f.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,b=function(w,k,T,A,C){var R=a.transformTo("string",C(A));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(k,4)+s(T,4)+s(R.length,2)+R}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var p=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var p=function(k,T){var A=k||T,C=s[A];if(!C)throw new Error(A+" is not a valid compression method !");return C}(h.options.compression,c.compression),m=h.options.compressionOptions||c.compressionOptions||{},b=h.dir,w=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:d,dir:b,date:w,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(b){p(b)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var p=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(m){var b=new c(h);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],w=m.files;if(h.checkCRC32)for(var k=0;k<w.length;k++)b.push(f(w[k]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),w=b.files,k=0;k<w.length;k++){var T=w[k],A=T.fileNameStr,C=s.resolve(T.fileNameStr);p.file(C,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:h.createFolders}),T.dir||(p.file(C).unsafeOriginalName=A)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof pn<"u",newBufferFrom:function(s,o){if(pn.from&&pn.from!==Uint8Array.from)return pn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new pn(s,o)},allocBuffer:function(s){if(pn.alloc)return pn.alloc(s);var o=new pn(s);return o.fill(0),o},isBuffer:function(s){return pn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(C,R,S){var F,N=a.getTypeOf(R),P=a.extend(S||{},u);P.date=P.date||new Date,P.compression!==null&&(P.compression=P.compression.toUpperCase()),typeof P.unixPermissions=="string"&&(P.unixPermissions=parseInt(P.unixPermissions,8)),P.unixPermissions&&16384&P.unixPermissions&&(P.dir=!0),P.dosPermissions&&16&P.dosPermissions&&(P.dir=!0),P.dir&&(C=w(C)),P.createFolders&&(F=b(C))&&k.call(this,F,!0);var H=N==="string"&&P.binary===!1&&P.base64===!1;S&&S.binary!==void 0||(P.binary=!H),(R instanceof f&&R.uncompressedSize===0||P.dir||!R||R.length===0)&&(P.base64=!1,P.binary=!0,R="",P.compression="STORE",N="string");var M=null;M=R instanceof f||R instanceof c?R:p.isNode&&p.isStream(R)?new m(C,R):a.prepareContent(C,R,P.binary,P.optimizedBinaryString,P.base64);var I=new d(C,M,P);this.files[C]=I}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),b=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var R=C.lastIndexOf("/");return 0<R?C.substring(0,R):""},w=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},k=function(C,R){return R=R!==void 0?R:u.createFolders,C=w(C),this.files[C]||s.call(this,C,null,{dir:!0,createFolders:R}),this.files[C]};function T(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var R,S,F;for(R in this.files)F=this.files[R],(S=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&C(S,F)},filter:function(C){var R=[];return this.forEach(function(S,F){C(S,F)&&R.push(F)}),R},file:function(C,R,S){if(arguments.length!==1)return C=this.root+C,s.call(this,C,R,S),this;if(T(C)){var F=C;return this.filter(function(P,H){return!H.dir&&F.test(P)})}var N=this.files[this.root+C];return N&&!N.dir?N:null},folder:function(C){if(!C)return this;if(T(C))return this.filter(function(N,P){return P.dir&&C.test(N)});var R=this.root+C,S=k.call(this,R),F=this.clone();return F.root=S.name,F},remove:function(C){C=this.root+C;var R=this.files[C];if(R||(C.slice(-1)!=="/"&&(C+="/"),R=this.files[C]),R&&!R.dir)delete this.files[C];else for(var S=this.filter(function(N,P){return P.name.slice(0,C.length)===C}),F=0;F<S.length;F++)delete this.files[S[F].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var R,S={};try{if((S=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");a.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var F=S.comment||this.comment||"";R=h.generateWorker(this,S,F)}catch(N){(R=new c("error")).error(N)}return new l(R,S.type||"string",S.mimeType)},generateAsync:function(C,R){return this.generateInternalStream(C).accumulate(R)},generateNodeStream:function(C,R){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(R)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(b,w){var k=[],T=p._internalType,A=p._outputType,C=p._mimeType;p.on("data",function(R,S){k.push(R),m&&m(S)}).on("error",function(R){k=[],w(R)}).on("end",function(){try{var R=function(S,F,N){switch(S){case"blob":return s.newBlob(s.transformTo("arraybuffer",F),N);case"base64":return c.encode(F);default:return s.transformTo(S,F)}}(A,function(S,F){var N,P=0,H=null,M=0;for(N=0;N<F.length;N++)M+=F[N].length;switch(S){case"string":return F.join("");case"array":return Array.prototype.concat.apply([],F);case"uint8array":for(H=new Uint8Array(M),N=0;N<F.length;N++)H.set(F[N],P),P+=F[N].length;return H;case"nodebuffer":return pn.concat(F);default:throw new Error("concat : unsupported type '"+S+"'")}}(T,k),C);b(R)}catch(S){w(S)}k=[]}).resume()})}function h(p,m,b){var w=m;switch(m){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=m,this._mimeType=b,s.checkSupport(w),this._worker=p.pipe(new o(w)),p.lock()}catch(k){this._worker=new a("error"),this._worker.error(k)}}h.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var b=this;return p==="data"?this._worker.on(p,function(w){m.call(b,w.data,w.meta)}):this._worker.on(p,function(){s.delay(m,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof pn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(p){var m,b,w,k,T,A=p.length,C=0;for(k=0;k<A;k++)(64512&(b=p.charCodeAt(k)))==55296&&k+1<A&&(64512&(w=p.charCodeAt(k+1)))==56320&&(b=65536+(b-55296<<10)+(w-56320),k++),C+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),k=T=0;T<C;k++)(64512&(b=p.charCodeAt(k)))==55296&&k+1<A&&(64512&(w=p.charCodeAt(k+1)))==56320&&(b=65536+(b-55296<<10)+(w-56320),k++),b<128?m[T++]=b:(b<2048?m[T++]=192|b>>>6:(b<65536?m[T++]=224|b>>>12:(m[T++]=240|b>>>18,m[T++]=128|b>>>12&63),m[T++]=128|b>>>6&63),m[T++]=128|63&b);return m}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,b,w,k,T=p.length,A=new Array(2*T);for(m=b=0;m<T;)if((w=p[m++])<128)A[b++]=w;else if(4<(k=l[w]))A[b++]=65533,m+=k-1;else{for(w&=k===2?31:k===3?15:7;1<k&&m<T;)w=w<<6|63&p[m++],k--;1<k?A[b++]=65533:w<65536?A[b++]=w:(w-=65536,A[b++]=55296|w>>10&1023,A[b++]=56320|1023&w)}return A.length!==b&&(A.subarray?A=A.subarray(0,b):A.length=b),s.applyFromCharCode(A)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var p=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(k,T){var A;for((T=T||k.length)>k.length&&(T=k.length),A=T-1;0<=A&&(192&k[A])==128;)A--;return A<0||A===0?T:A+l[k[A]]>T?A:T}(p),w=p;b!==p.length&&(o.uint8array?(w=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(w=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:i.utf8decode(w),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,b){for(var w=0;w<m.length;++w)b[w]=255&m.charCodeAt(w);return b}n("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(m),w.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(m,b,w){var k=[],T=0,A=m.length;if(A<=w)return String.fromCharCode.apply(null,m);for(;T<A;)b==="array"||b==="nodebuffer"?k.push(String.fromCharCode.apply(null,m.slice(T,Math.min(T+w,A)))):k.push(String.fromCharCode.apply(null,m.subarray(T,Math.min(T+w,A)))),T+=w;return k.join("")},stringifyByChar:function(m){for(var b="",w=0;w<m.length;w++)b+=String.fromCharCode(m[w]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var b=65536,w=i.getTypeOf(m),k=!0;if(w==="uint8array"?k=f.applyCanBeUsed.uint8array:w==="nodebuffer"&&(k=f.applyCanBeUsed.nodebuffer),k)for(;1<b;)try{return f.stringifyByChunk(m,w,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(m)}function h(m,b){for(var w=0;w<m.length;w++)b[w]=m[w];return b}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var w=i.getTypeOf(b);return p[w][m](b)},i.resolve=function(m){for(var b=m.split("/"),w=[],k=0;k<b.length;k++){var T=b[k];T==="."||T===""&&k!==0&&k!==b.length-1||(T===".."?w.pop():w.push(T))}return w.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,w,k="";for(w=0;w<(m||"").length;w++)k+="\\x"+((b=m.charCodeAt(w))<16?"0":"")+b.toString(16).toUpperCase();return k},i.delay=function(m,b,w){setImmediate(function(){m.apply(w||null,b||[])})},i.inherits=function(m,b){function w(){}w.prototype=b.prototype,m.prototype=new w},i.extend=function(){var m,b,w={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&w[b]===void 0&&(w[b]=arguments[m][b]);return w},i.prepareContent=function(m,b,w,k,T){return c.Promise.resolve(b).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(C,R){var S=new FileReader;S.onload=function(F){C(F.target.result)},S.onerror=function(F){R(F.target.error)},S.readAsArrayBuffer(A)}):A}).then(function(A){var C=i.getTypeOf(A);return C?(C==="arraybuffer"?A=i.transformTo("uint8array",A):C==="string"&&(T?A=o.decode(A):w&&k!==!0&&(A=function(R){return u(R,s.uint8array?new Uint8Array(R.length):new Array(R.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var p=this.reader.readString(4)===d;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,p=this.zip64EndOfCentralSize-44;0<p;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=d-h;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,p){this.options=h,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var w in u)if(Object.prototype.hasOwnProperty.call(u,w)&&u[w].magic===b)return u[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,b,w=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<w;)p=h.readInt(2),m=h.readInt(2),b=h.readData(m),this.extraFields[p]={id:p,length:m,value:b};h.setIndex(w)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var w=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,b="string";try{if(!p)throw new Error("No output type specified.");var w=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var k=!this._dataBinary;k&&!w&&(m=m.pipe(new c.Utf8EncodeWorker)),!k&&w&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(T){(m=new u("error")).error(T)}return new o(m,b,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var h=[];function p(){var m,b;a=!0;for(var w=h.length;w;){for(b=h,h=[],m=-1;++m<w;)b[m]();w=h.length}a=!1}r.exports=function(m){h.push(m)!==1||a||o()}}).call(this,typeof Cn<"u"?Cn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,w!==o&&m(this,w)}function d(w,k,T){this.promise=w,typeof k=="function"&&(this.onFulfilled=k,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function h(w,k,T){s(function(){var A;try{A=k(T)}catch(C){return a.reject(w,C)}A===w?a.reject(w,new TypeError("Cannot resolve promise with itself")):a.resolve(w,A)})}function p(w){var k=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof k=="function")return function(){k.apply(w,arguments)}}function m(w,k){var T=!1;function A(S){T||(T=!0,a.reject(w,S))}function C(S){T||(T=!0,a.resolve(w,S))}var R=b(function(){k(C,A)});R.status==="error"&&A(R.value)}function b(w,k){var T={};try{T.value=w(k),T.status="success"}catch(A){T.status="error",T.value=A}return T}(r.exports=f).prototype.finally=function(w){if(typeof w!="function")return this;var k=this.constructor;return this.then(function(T){return k.resolve(w()).then(function(){return T})},function(T){return k.resolve(w()).then(function(){throw T})})},f.prototype.catch=function(w){return this.then(null,w)},f.prototype.then=function(w,k){if(typeof w!="function"&&this.state===l||typeof k!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==u?h(T,this.state===l?w:k,this.outcome):this.queue.push(new d(T,w,k)),T},d.prototype.callFulfilled=function(w){a.resolve(this.promise,w)},d.prototype.otherCallFulfilled=function(w){h(this.promise,this.onFulfilled,w)},d.prototype.callRejected=function(w){a.reject(this.promise,w)},d.prototype.otherCallRejected=function(w){h(this.promise,this.onRejected,w)},a.resolve=function(w,k){var T=b(p,k);if(T.status==="error")return a.reject(w,T.value);var A=T.value;if(A)m(w,A);else{w.state=l,w.outcome=k;for(var C=-1,R=w.queue.length;++C<R;)w.queue[C].callFulfilled(k)}return w},a.reject=function(w,k){w.state=c,w.outcome=k;for(var T=-1,A=w.queue.length;++T<A;)w.queue[T].callRejected(k);return w},f.resolve=function(w){return w instanceof this?w:a.resolve(new this(o),w)},f.reject=function(w){var k=new this(o);return a.reject(k,w)},f.all=function(w){var k=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=w.length,A=!1;if(!T)return this.resolve([]);for(var C=new Array(T),R=0,S=-1,F=new this(o);++S<T;)N(w[S],S);return F;function N(P,H){k.resolve(P).then(function(M){C[H]=M,++R!==T||A||(A=!0,a.resolve(F,C))},function(M){A||(A=!0,a.reject(F,M))})}},f.race=function(w){var k=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=w.length,A=!1;if(!T)return this.resolve([]);for(var C=-1,R=new this(o);++C<T;)S=w[C],k.resolve(S).then(function(F){A||(A=!0,a.resolve(R,F))},function(F){A||(A=!0,a.reject(R,F))});var S;return R}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,p=8;function m(w){if(!(this instanceof m))return new m(w);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},w||{});var k=this.options;k.raw&&0<k.windowBits?k.windowBits=-k.windowBits:k.gzip&&0<k.windowBits&&k.windowBits<16&&(k.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,k.level,k.method,k.windowBits,k.memLevel,k.strategy);if(T!==f)throw new Error(c[T]);if(k.header&&s.deflateSetHeader(this.strm,k.header),k.dictionary){var A;if(A=typeof k.dictionary=="string"?a.string2buf(k.dictionary):u.call(k.dictionary)==="[object ArrayBuffer]"?new Uint8Array(k.dictionary):k.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==f)throw new Error(c[T]);this._dict_set=!0}}function b(w,k){var T=new m(k);if(T.push(w,!0),T.err)throw T.msg||c[T.err];return T.result}m.prototype.push=function(w,k){var T,A,C=this.strm,R=this.options.chunkSize;if(this.ended)return!1;A=k===~~k?k:k===!0?4:0,typeof w=="string"?C.input=a.string2buf(w):u.call(w)==="[object ArrayBuffer]"?C.input=new Uint8Array(w):C.input=w,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(R),C.next_out=0,C.avail_out=R),(T=s.deflate(C,A))!==1&&T!==f)return this.onEnd(T),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===f):A!==2||(this.onEnd(f),!(C.avail_out=0))},m.prototype.onData=function(w){this.chunks.push(w)},m.prototype.onEnd=function(w){w===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(w,k){return(k=k||{}).raw=!0,b(w,k)},i.gzip=function(w,k){return(k=k||{}).gzip=!0,b(w,k)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,b.windowBits);if(w!==c.Z_OK)throw new Error(l[w]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function p(m,b){var w=new h(b);if(w.push(m,!0),w.err)throw w.msg||l[w.err];return w.result}h.prototype.push=function(m,b){var w,k,T,A,C,R,S=this.strm,F=this.options.chunkSize,N=this.options.dictionary,P=!1;if(this.ended)return!1;k=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?S.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?S.input=new Uint8Array(m):S.input=m,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new o.Buf8(F),S.next_out=0,S.avail_out=F),(w=s.inflate(S,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&N&&(R=typeof N=="string"?a.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,w=s.inflateSetDictionary(this.strm,R)),w===c.Z_BUF_ERROR&&P===!0&&(w=c.Z_OK,P=!1),w!==c.Z_STREAM_END&&w!==c.Z_OK)return this.onEnd(w),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&w!==c.Z_STREAM_END&&(S.avail_in!==0||k!==c.Z_FINISH&&k!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(S.output,S.next_out),A=S.next_out-T,C=a.buf2string(S.output,T),S.next_out=A,S.avail_out=F-A,A&&o.arraySet(S.output,S.output,T,A,0),this.onData(C)):this.onData(o.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(P=!0)}while((0<S.avail_in||S.avail_out===0)&&w!==c.Z_STREAM_END);return w===c.Z_STREAM_END&&(k=c.Z_FINISH),k===c.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===c.Z_OK):k!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(S.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=h,i.inflate=p,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,p(m,b)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,p;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(p=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],p.set(h,d),d+=h.length;return p}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",p=0;p<d;p++)h+=String.fromCharCode(f[p]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,p,m,b,w=f.length,k=0;for(m=0;m<w;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),k+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(k),m=b=0;b<k;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?d[b++]=h:(h<2048?d[b++]=192|h>>>6:(h<65536?d[b++]=224|h>>>12:(d[b++]=240|h>>>18,d[b++]=128|h>>>12&63),d[b++]=128|h>>>6&63),d[b++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,p=d.length;h<p;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,p,m,b,w=d||f.length,k=new Array(2*w);for(h=p=0;h<w;)if((m=f[h++])<128)k[p++]=m;else if(4<(b=c[m]))k[p++]=65533,h+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&h<w;)m=m<<6|63&f[h++],b--;1<b?k[p++]=65533:m<65536?k[p++]=m:(m-=65536,k[p++]=55296|m>>10&1023,k[p++]=56320|1023&m)}return u(k,p)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,p=-2,m=-1,b=4,w=2,k=8,T=9,A=286,C=30,R=19,S=2*A+1,F=15,N=3,P=258,H=P+N+1,M=42,I=113,E=1,D=2,q=3,j=4;function ot(v,st){return v.msg=u[st],st}function tt(v){return(v<<1)-(4<v?9:0)}function ft(v){for(var st=v.length;0<=--st;)v[st]=0}function V(v){var st=v.state,nt=st.pending;nt>v.avail_out&&(nt=v.avail_out),nt!==0&&(o.arraySet(v.output,st.pending_buf,st.pending_out,nt,v.next_out),v.next_out+=nt,st.pending_out+=nt,v.total_out+=nt,v.avail_out-=nt,st.pending-=nt,st.pending===0&&(st.pending_out=0))}function W(v,st){a._tr_flush_block(v,0<=v.block_start?v.block_start:-1,v.strstart-v.block_start,st),v.block_start=v.strstart,V(v.strm)}function bt(v,st){v.pending_buf[v.pending++]=st}function at(v,st){v.pending_buf[v.pending++]=st>>>8&255,v.pending_buf[v.pending++]=255&st}function lt(v,st){var nt,B,U=v.max_chain_length,Y=v.strstart,ct=v.prev_length,ht=v.nice_match,J=v.strstart>v.w_size-H?v.strstart-(v.w_size-H):0,mt=v.window,Et=v.w_mask,dt=v.prev,Tt=v.strstart+P,ue=mt[Y+ct-1],$t=mt[Y+ct];v.prev_length>=v.good_match&&(U>>=2),ht>v.lookahead&&(ht=v.lookahead);do if(mt[(nt=st)+ct]===$t&&mt[nt+ct-1]===ue&&mt[nt]===mt[Y]&&mt[++nt]===mt[Y+1]){Y+=2,nt++;do;while(mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&Y<Tt);if(B=P-(Tt-Y),Y=Tt-P,ct<B){if(v.match_start=st,ht<=(ct=B))break;ue=mt[Y+ct-1],$t=mt[Y+ct]}}while((st=dt[st&Et])>J&&--U!=0);return ct<=v.lookahead?ct:v.lookahead}function Dt(v){var st,nt,B,U,Y,ct,ht,J,mt,Et,dt=v.w_size;do{if(U=v.window_size-v.lookahead-v.strstart,v.strstart>=dt+(dt-H)){for(o.arraySet(v.window,v.window,dt,dt,0),v.match_start-=dt,v.strstart-=dt,v.block_start-=dt,st=nt=v.hash_size;B=v.head[--st],v.head[st]=dt<=B?B-dt:0,--nt;);for(st=nt=dt;B=v.prev[--st],v.prev[st]=dt<=B?B-dt:0,--nt;);U+=dt}if(v.strm.avail_in===0)break;if(ct=v.strm,ht=v.window,J=v.strstart+v.lookahead,mt=U,Et=void 0,Et=ct.avail_in,mt<Et&&(Et=mt),nt=Et===0?0:(ct.avail_in-=Et,o.arraySet(ht,ct.input,ct.next_in,Et,J),ct.state.wrap===1?ct.adler=c(ct.adler,ht,Et,J):ct.state.wrap===2&&(ct.adler=l(ct.adler,ht,Et,J)),ct.next_in+=Et,ct.total_in+=Et,Et),v.lookahead+=nt,v.lookahead+v.insert>=N)for(Y=v.strstart-v.insert,v.ins_h=v.window[Y],v.ins_h=(v.ins_h<<v.hash_shift^v.window[Y+1])&v.hash_mask;v.insert&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[Y+N-1])&v.hash_mask,v.prev[Y&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=Y,Y++,v.insert--,!(v.lookahead+v.insert<N)););}while(v.lookahead<H&&v.strm.avail_in!==0)}function Yt(v,st){for(var nt,B;;){if(v.lookahead<H){if(Dt(v),v.lookahead<H&&st===f)return E;if(v.lookahead===0)break}if(nt=0,v.lookahead>=N&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,nt=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),nt!==0&&v.strstart-nt<=v.w_size-H&&(v.match_length=lt(v,nt)),v.match_length>=N)if(B=a._tr_tally(v,v.strstart-v.match_start,v.match_length-N),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=N){for(v.match_length--;v.strstart++,v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,nt=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart,--v.match_length!=0;);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+1])&v.hash_mask;else B=a._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(B&&(W(v,!1),v.strm.avail_out===0))return E}return v.insert=v.strstart<N-1?v.strstart:N-1,st===d?(W(v,!0),v.strm.avail_out===0?q:j):v.last_lit&&(W(v,!1),v.strm.avail_out===0)?E:D}function Mt(v,st){for(var nt,B,U;;){if(v.lookahead<H){if(Dt(v),v.lookahead<H&&st===f)return E;if(v.lookahead===0)break}if(nt=0,v.lookahead>=N&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,nt=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=N-1,nt!==0&&v.prev_length<v.max_lazy_match&&v.strstart-nt<=v.w_size-H&&(v.match_length=lt(v,nt),v.match_length<=5&&(v.strategy===1||v.match_length===N&&4096<v.strstart-v.match_start)&&(v.match_length=N-1)),v.prev_length>=N&&v.match_length<=v.prev_length){for(U=v.strstart+v.lookahead-N,B=a._tr_tally(v,v.strstart-1-v.prev_match,v.prev_length-N),v.lookahead-=v.prev_length-1,v.prev_length-=2;++v.strstart<=U&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,nt=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),--v.prev_length!=0;);if(v.match_available=0,v.match_length=N-1,v.strstart++,B&&(W(v,!1),v.strm.avail_out===0))return E}else if(v.match_available){if((B=a._tr_tally(v,0,v.window[v.strstart-1]))&&W(v,!1),v.strstart++,v.lookahead--,v.strm.avail_out===0)return E}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(B=a._tr_tally(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<N-1?v.strstart:N-1,st===d?(W(v,!0),v.strm.avail_out===0?q:j):v.last_lit&&(W(v,!1),v.strm.avail_out===0)?E:D}function Ct(v,st,nt,B,U){this.good_length=v,this.max_lazy=st,this.nice_length=nt,this.max_chain=B,this.func=U}function Pt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*S),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*R+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(F+1),this.heap=new o.Buf16(2*A+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ut(v){var st;return v&&v.state?(v.total_in=v.total_out=0,v.data_type=w,(st=v.state).pending=0,st.pending_out=0,st.wrap<0&&(st.wrap=-st.wrap),st.status=st.wrap?M:I,v.adler=st.wrap===2?0:1,st.last_flush=f,a._tr_init(st),h):ot(v,p)}function se(v){var st=Ut(v);return st===h&&function(nt){nt.window_size=2*nt.w_size,ft(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=N-1,nt.match_available=0,nt.ins_h=0}(v.state),st}function Be(v,st,nt,B,U,Y){if(!v)return p;var ct=1;if(st===m&&(st=6),B<0?(ct=0,B=-B):15<B&&(ct=2,B-=16),U<1||T<U||nt!==k||B<8||15<B||st<0||9<st||Y<0||b<Y)return ot(v,p);B===8&&(B=9);var ht=new Pt;return(v.state=ht).strm=v,ht.wrap=ct,ht.gzhead=null,ht.w_bits=B,ht.w_size=1<<ht.w_bits,ht.w_mask=ht.w_size-1,ht.hash_bits=U+7,ht.hash_size=1<<ht.hash_bits,ht.hash_mask=ht.hash_size-1,ht.hash_shift=~~((ht.hash_bits+N-1)/N),ht.window=new o.Buf8(2*ht.w_size),ht.head=new o.Buf16(ht.hash_size),ht.prev=new o.Buf16(ht.w_size),ht.lit_bufsize=1<<U+6,ht.pending_buf_size=4*ht.lit_bufsize,ht.pending_buf=new o.Buf8(ht.pending_buf_size),ht.d_buf=1*ht.lit_bufsize,ht.l_buf=3*ht.lit_bufsize,ht.level=st,ht.strategy=Y,ht.method=nt,se(v)}s=[new Ct(0,0,0,0,function(v,st){var nt=65535;for(nt>v.pending_buf_size-5&&(nt=v.pending_buf_size-5);;){if(v.lookahead<=1){if(Dt(v),v.lookahead===0&&st===f)return E;if(v.lookahead===0)break}v.strstart+=v.lookahead,v.lookahead=0;var B=v.block_start+nt;if((v.strstart===0||v.strstart>=B)&&(v.lookahead=v.strstart-B,v.strstart=B,W(v,!1),v.strm.avail_out===0)||v.strstart-v.block_start>=v.w_size-H&&(W(v,!1),v.strm.avail_out===0))return E}return v.insert=0,st===d?(W(v,!0),v.strm.avail_out===0?q:j):(v.strstart>v.block_start&&(W(v,!1),v.strm.avail_out),E)}),new Ct(4,4,8,4,Yt),new Ct(4,5,16,8,Yt),new Ct(4,6,32,32,Yt),new Ct(4,4,16,16,Mt),new Ct(8,16,32,32,Mt),new Ct(8,16,128,128,Mt),new Ct(8,32,128,256,Mt),new Ct(32,128,258,1024,Mt),new Ct(32,258,258,4096,Mt)],i.deflateInit=function(v,st){return Be(v,st,k,15,8,0)},i.deflateInit2=Be,i.deflateReset=se,i.deflateResetKeep=Ut,i.deflateSetHeader=function(v,st){return v&&v.state?v.state.wrap!==2?p:(v.state.gzhead=st,h):p},i.deflate=function(v,st){var nt,B,U,Y;if(!v||!v.state||5<st||st<0)return v?ot(v,p):p;if(B=v.state,!v.output||!v.input&&v.avail_in!==0||B.status===666&&st!==d)return ot(v,v.avail_out===0?-5:p);if(B.strm=v,nt=B.last_flush,B.last_flush=st,B.status===M)if(B.wrap===2)v.adler=0,bt(B,31),bt(B,139),bt(B,8),B.gzhead?(bt(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),bt(B,255&B.gzhead.time),bt(B,B.gzhead.time>>8&255),bt(B,B.gzhead.time>>16&255),bt(B,B.gzhead.time>>24&255),bt(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),bt(B,255&B.gzhead.os),B.gzhead.extra&&B.gzhead.extra.length&&(bt(B,255&B.gzhead.extra.length),bt(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(v.adler=l(v.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=69):(bt(B,0),bt(B,0),bt(B,0),bt(B,0),bt(B,0),bt(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),bt(B,3),B.status=I);else{var ct=k+(B.w_bits-8<<4)<<8;ct|=(2<=B.strategy||B.level<2?0:B.level<6?1:B.level===6?2:3)<<6,B.strstart!==0&&(ct|=32),ct+=31-ct%31,B.status=I,at(B,ct),B.strstart!==0&&(at(B,v.adler>>>16),at(B,65535&v.adler)),v.adler=1}if(B.status===69)if(B.gzhead.extra){for(U=B.pending;B.gzindex<(65535&B.gzhead.extra.length)&&(B.pending!==B.pending_buf_size||(B.gzhead.hcrc&&B.pending>U&&(v.adler=l(v.adler,B.pending_buf,B.pending-U,U)),V(v),U=B.pending,B.pending!==B.pending_buf_size));)bt(B,255&B.gzhead.extra[B.gzindex]),B.gzindex++;B.gzhead.hcrc&&B.pending>U&&(v.adler=l(v.adler,B.pending_buf,B.pending-U,U)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=73)}else B.status=73;if(B.status===73)if(B.gzhead.name){U=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>U&&(v.adler=l(v.adler,B.pending_buf,B.pending-U,U)),V(v),U=B.pending,B.pending===B.pending_buf_size)){Y=1;break}Y=B.gzindex<B.gzhead.name.length?255&B.gzhead.name.charCodeAt(B.gzindex++):0,bt(B,Y)}while(Y!==0);B.gzhead.hcrc&&B.pending>U&&(v.adler=l(v.adler,B.pending_buf,B.pending-U,U)),Y===0&&(B.gzindex=0,B.status=91)}else B.status=91;if(B.status===91)if(B.gzhead.comment){U=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>U&&(v.adler=l(v.adler,B.pending_buf,B.pending-U,U)),V(v),U=B.pending,B.pending===B.pending_buf_size)){Y=1;break}Y=B.gzindex<B.gzhead.comment.length?255&B.gzhead.comment.charCodeAt(B.gzindex++):0,bt(B,Y)}while(Y!==0);B.gzhead.hcrc&&B.pending>U&&(v.adler=l(v.adler,B.pending_buf,B.pending-U,U)),Y===0&&(B.status=103)}else B.status=103;if(B.status===103&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&V(v),B.pending+2<=B.pending_buf_size&&(bt(B,255&v.adler),bt(B,v.adler>>8&255),v.adler=0,B.status=I)):B.status=I),B.pending!==0){if(V(v),v.avail_out===0)return B.last_flush=-1,h}else if(v.avail_in===0&&tt(st)<=tt(nt)&&st!==d)return ot(v,-5);if(B.status===666&&v.avail_in!==0)return ot(v,-5);if(v.avail_in!==0||B.lookahead!==0||st!==f&&B.status!==666){var ht=B.strategy===2?function(J,mt){for(var Et;;){if(J.lookahead===0&&(Dt(J),J.lookahead===0)){if(mt===f)return E;break}if(J.match_length=0,Et=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++,Et&&(W(J,!1),J.strm.avail_out===0))return E}return J.insert=0,mt===d?(W(J,!0),J.strm.avail_out===0?q:j):J.last_lit&&(W(J,!1),J.strm.avail_out===0)?E:D}(B,st):B.strategy===3?function(J,mt){for(var Et,dt,Tt,ue,$t=J.window;;){if(J.lookahead<=P){if(Dt(J),J.lookahead<=P&&mt===f)return E;if(J.lookahead===0)break}if(J.match_length=0,J.lookahead>=N&&0<J.strstart&&(dt=$t[Tt=J.strstart-1])===$t[++Tt]&&dt===$t[++Tt]&&dt===$t[++Tt]){ue=J.strstart+P;do;while(dt===$t[++Tt]&&dt===$t[++Tt]&&dt===$t[++Tt]&&dt===$t[++Tt]&&dt===$t[++Tt]&&dt===$t[++Tt]&&dt===$t[++Tt]&&dt===$t[++Tt]&&Tt<ue);J.match_length=P-(ue-Tt),J.match_length>J.lookahead&&(J.match_length=J.lookahead)}if(J.match_length>=N?(Et=a._tr_tally(J,1,J.match_length-N),J.lookahead-=J.match_length,J.strstart+=J.match_length,J.match_length=0):(Et=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++),Et&&(W(J,!1),J.strm.avail_out===0))return E}return J.insert=0,mt===d?(W(J,!0),J.strm.avail_out===0?q:j):J.last_lit&&(W(J,!1),J.strm.avail_out===0)?E:D}(B,st):s[B.level].func(B,st);if(ht!==q&&ht!==j||(B.status=666),ht===E||ht===q)return v.avail_out===0&&(B.last_flush=-1),h;if(ht===D&&(st===1?a._tr_align(B):st!==5&&(a._tr_stored_block(B,0,0,!1),st===3&&(ft(B.head),B.lookahead===0&&(B.strstart=0,B.block_start=0,B.insert=0))),V(v),v.avail_out===0))return B.last_flush=-1,h}return st!==d?h:B.wrap<=0?1:(B.wrap===2?(bt(B,255&v.adler),bt(B,v.adler>>8&255),bt(B,v.adler>>16&255),bt(B,v.adler>>24&255),bt(B,255&v.total_in),bt(B,v.total_in>>8&255),bt(B,v.total_in>>16&255),bt(B,v.total_in>>24&255)):(at(B,v.adler>>>16),at(B,65535&v.adler)),V(v),0<B.wrap&&(B.wrap=-B.wrap),B.pending!==0?h:1)},i.deflateEnd=function(v){var st;return v&&v.state?(st=v.state.status)!==M&&st!==69&&st!==73&&st!==91&&st!==103&&st!==I&&st!==666?ot(v,p):(v.state=null,st===I?ot(v,-3):h):p},i.deflateSetDictionary=function(v,st){var nt,B,U,Y,ct,ht,J,mt,Et=st.length;if(!v||!v.state||(Y=(nt=v.state).wrap)===2||Y===1&&nt.status!==M||nt.lookahead)return p;for(Y===1&&(v.adler=c(v.adler,st,Et,0)),nt.wrap=0,Et>=nt.w_size&&(Y===0&&(ft(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),mt=new o.Buf8(nt.w_size),o.arraySet(mt,st,Et-nt.w_size,nt.w_size,0),st=mt,Et=nt.w_size),ct=v.avail_in,ht=v.next_in,J=v.input,v.avail_in=Et,v.next_in=0,v.input=st,Dt(nt);nt.lookahead>=N;){for(B=nt.strstart,U=nt.lookahead-(N-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[B+N-1])&nt.hash_mask,nt.prev[B&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=B,B++,--U;);nt.strstart=B,nt.lookahead=N-1,Dt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=N-1,nt.match_available=0,v.next_in=ht,v.input=J,v.avail_in=ct,nt.wrap=Y,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,p,m,b,w,k,T,A,C,R,S,F,N,P,H,M,I,E,D;a=s.state,c=s.next_in,E=s.input,l=c+(s.avail_in-5),u=s.next_out,D=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,p=a.wsize,m=a.whave,b=a.wnext,w=a.window,k=a.hold,T=a.bits,A=a.lencode,C=a.distcode,R=(1<<a.lenbits)-1,S=(1<<a.distbits)-1;t:do{T<15&&(k+=E[c++]<<T,T+=8,k+=E[c++]<<T,T+=8),F=A[k&R];e:for(;;){if(k>>>=N=F>>>24,T-=N,(N=F>>>16&255)===0)D[u++]=65535&F;else{if(!(16&N)){if(!(64&N)){F=A[(65535&F)+(k&(1<<N)-1)];continue e}if(32&N){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}P=65535&F,(N&=15)&&(T<N&&(k+=E[c++]<<T,T+=8),P+=k&(1<<N)-1,k>>>=N,T-=N),T<15&&(k+=E[c++]<<T,T+=8,k+=E[c++]<<T,T+=8),F=C[k&S];n:for(;;){if(k>>>=N=F>>>24,T-=N,!(16&(N=F>>>16&255))){if(!(64&N)){F=C[(65535&F)+(k&(1<<N)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(H=65535&F,T<(N&=15)&&(k+=E[c++]<<T,(T+=8)<N&&(k+=E[c++]<<T,T+=8)),h<(H+=k&(1<<N)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(k>>>=N,T-=N,(N=u-f)<H){if(m<(N=H-N)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(I=w,(M=0)===b){if(M+=p-N,N<P){for(P-=N;D[u++]=w[M++],--N;);M=u-H,I=D}}else if(b<N){if(M+=p+b-N,(N-=b)<P){for(P-=N;D[u++]=w[M++],--N;);if(M=0,b<P){for(P-=N=b;D[u++]=w[M++],--N;);M=u-H,I=D}}}else if(M+=b-N,N<P){for(P-=N;D[u++]=w[M++],--N;);M=u-H,I=D}for(;2<P;)D[u++]=I[M++],D[u++]=I[M++],D[u++]=I[M++],P-=3;P&&(D[u++]=I[M++],1<P&&(D[u++]=I[M++]))}else{for(M=u-H;D[u++]=D[M++],D[u++]=D[M++],D[u++]=D[M++],2<(P-=3););P&&(D[u++]=D[M++],1<P&&(D[u++]=D[M++]))}break}}break}}while(c<l&&u<d);c-=P=T>>3,k&=(1<<(T-=P<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=k,a.bits=T}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,p=1,m=852,b=592;function w(M){return(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24)}function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(M){var I;return M&&M.state?(I=M.state,M.total_in=M.total_out=I.total=0,M.msg="",I.wrap&&(M.adler=1&I.wrap),I.mode=p,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new s.Buf32(m),I.distcode=I.distdyn=new s.Buf32(b),I.sane=1,I.back=-1,d):h}function A(M){var I;return M&&M.state?((I=M.state).wsize=0,I.whave=0,I.wnext=0,T(M)):h}function C(M,I){var E,D;return M&&M.state?(D=M.state,I<0?(E=0,I=-I):(E=1+(I>>4),I<48&&(I&=15)),I&&(I<8||15<I)?h:(D.window!==null&&D.wbits!==I&&(D.window=null),D.wrap=E,D.wbits=I,A(M))):h}function R(M,I){var E,D;return M?(D=new k,(M.state=D).window=null,(E=C(M,I))!==d&&(M.state=null),E):h}var S,F,N=!0;function P(M){if(N){var I;for(S=new s.Buf32(512),F=new s.Buf32(32),I=0;I<144;)M.lens[I++]=8;for(;I<256;)M.lens[I++]=9;for(;I<280;)M.lens[I++]=7;for(;I<288;)M.lens[I++]=8;for(l(u,M.lens,0,288,S,0,M.work,{bits:9}),I=0;I<32;)M.lens[I++]=5;l(f,M.lens,0,32,F,0,M.work,{bits:5}),N=!1}M.lencode=S,M.lenbits=9,M.distcode=F,M.distbits=5}function H(M,I,E,D){var q,j=M.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new s.Buf8(j.wsize)),D>=j.wsize?(s.arraySet(j.window,I,E-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(D<(q=j.wsize-j.wnext)&&(q=D),s.arraySet(j.window,I,E-D,q,j.wnext),(D-=q)?(s.arraySet(j.window,I,E-D,D,0),j.wnext=D,j.whave=j.wsize):(j.wnext+=q,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=q))),0}i.inflateReset=A,i.inflateReset2=C,i.inflateResetKeep=T,i.inflateInit=function(M){return R(M,15)},i.inflateInit2=R,i.inflate=function(M,I){var E,D,q,j,ot,tt,ft,V,W,bt,at,lt,Dt,Yt,Mt,Ct,Pt,Ut,se,Be,v,st,nt,B,U=0,Y=new s.Buf8(4),ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!M||!M.state||!M.output||!M.input&&M.avail_in!==0)return h;(E=M.state).mode===12&&(E.mode=13),ot=M.next_out,q=M.output,ft=M.avail_out,j=M.next_in,D=M.input,tt=M.avail_in,V=E.hold,W=E.bits,bt=tt,at=ft,st=d;t:for(;;)switch(E.mode){case p:if(E.wrap===0){E.mode=13;break}for(;W<16;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}if(2&E.wrap&&V===35615){Y[E.check=0]=255&V,Y[1]=V>>>8&255,E.check=a(E.check,Y,2,0),W=V=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&V)<<8)+(V>>8))%31){M.msg="incorrect header check",E.mode=30;break}if((15&V)!=8){M.msg="unknown compression method",E.mode=30;break}if(W-=4,v=8+(15&(V>>>=4)),E.wbits===0)E.wbits=v;else if(v>E.wbits){M.msg="invalid window size",E.mode=30;break}E.dmax=1<<v,M.adler=E.check=1,E.mode=512&V?10:12,W=V=0;break;case 2:for(;W<16;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}if(E.flags=V,(255&E.flags)!=8){M.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){M.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=V>>8&1),512&E.flags&&(Y[0]=255&V,Y[1]=V>>>8&255,E.check=a(E.check,Y,2,0)),W=V=0,E.mode=3;case 3:for(;W<32;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}E.head&&(E.head.time=V),512&E.flags&&(Y[0]=255&V,Y[1]=V>>>8&255,Y[2]=V>>>16&255,Y[3]=V>>>24&255,E.check=a(E.check,Y,4,0)),W=V=0,E.mode=4;case 4:for(;W<16;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}E.head&&(E.head.xflags=255&V,E.head.os=V>>8),512&E.flags&&(Y[0]=255&V,Y[1]=V>>>8&255,E.check=a(E.check,Y,2,0)),W=V=0,E.mode=5;case 5:if(1024&E.flags){for(;W<16;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}E.length=V,E.head&&(E.head.extra_len=V),512&E.flags&&(Y[0]=255&V,Y[1]=V>>>8&255,E.check=a(E.check,Y,2,0)),W=V=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(tt<(lt=E.length)&&(lt=tt),lt&&(E.head&&(v=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,D,j,lt,v)),512&E.flags&&(E.check=a(E.check,D,lt,j)),tt-=lt,j+=lt,E.length-=lt),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(tt===0)break t;for(lt=0;v=D[j+lt++],E.head&&v&&E.length<65536&&(E.head.name+=String.fromCharCode(v)),v&&lt<tt;);if(512&E.flags&&(E.check=a(E.check,D,lt,j)),tt-=lt,j+=lt,v)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(tt===0)break t;for(lt=0;v=D[j+lt++],E.head&&v&&E.length<65536&&(E.head.comment+=String.fromCharCode(v)),v&&lt<tt;);if(512&E.flags&&(E.check=a(E.check,D,lt,j)),tt-=lt,j+=lt,v)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;W<16;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}if(V!==(65535&E.check)){M.msg="header crc mismatch",E.mode=30;break}W=V=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),M.adler=E.check=0,E.mode=12;break;case 10:for(;W<32;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}M.adler=E.check=w(V),W=V=0,E.mode=11;case 11:if(E.havedict===0)return M.next_out=ot,M.avail_out=ft,M.next_in=j,M.avail_in=tt,E.hold=V,E.bits=W,2;M.adler=E.check=1,E.mode=12;case 12:if(I===5||I===6)break t;case 13:if(E.last){V>>>=7&W,W-=7&W,E.mode=27;break}for(;W<3;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}switch(E.last=1&V,W-=1,3&(V>>>=1)){case 0:E.mode=14;break;case 1:if(P(E),E.mode=20,I!==6)break;V>>>=2,W-=2;break t;case 2:E.mode=17;break;case 3:M.msg="invalid block type",E.mode=30}V>>>=2,W-=2;break;case 14:for(V>>>=7&W,W-=7&W;W<32;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}if((65535&V)!=(V>>>16^65535)){M.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&V,W=V=0,E.mode=15,I===6)break t;case 15:E.mode=16;case 16:if(lt=E.length){if(tt<lt&&(lt=tt),ft<lt&&(lt=ft),lt===0)break t;s.arraySet(q,D,j,lt,ot),tt-=lt,j+=lt,ft-=lt,ot+=lt,E.length-=lt;break}E.mode=12;break;case 17:for(;W<14;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}if(E.nlen=257+(31&V),V>>>=5,W-=5,E.ndist=1+(31&V),V>>>=5,W-=5,E.ncode=4+(15&V),V>>>=4,W-=4,286<E.nlen||30<E.ndist){M.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;W<3;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}E.lens[ct[E.have++]]=7&V,V>>>=3,W-=3}for(;E.have<19;)E.lens[ct[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,nt={bits:E.lenbits},st=l(0,E.lens,0,19,E.lencode,0,E.work,nt),E.lenbits=nt.bits,st){M.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;Ct=(U=E.lencode[V&(1<<E.lenbits)-1])>>>16&255,Pt=65535&U,!((Mt=U>>>24)<=W);){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}if(Pt<16)V>>>=Mt,W-=Mt,E.lens[E.have++]=Pt;else{if(Pt===16){for(B=Mt+2;W<B;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}if(V>>>=Mt,W-=Mt,E.have===0){M.msg="invalid bit length repeat",E.mode=30;break}v=E.lens[E.have-1],lt=3+(3&V),V>>>=2,W-=2}else if(Pt===17){for(B=Mt+3;W<B;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}W-=Mt,v=0,lt=3+(7&(V>>>=Mt)),V>>>=3,W-=3}else{for(B=Mt+7;W<B;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}W-=Mt,v=0,lt=11+(127&(V>>>=Mt)),V>>>=7,W-=7}if(E.have+lt>E.nlen+E.ndist){M.msg="invalid bit length repeat",E.mode=30;break}for(;lt--;)E.lens[E.have++]=v}}if(E.mode===30)break;if(E.lens[256]===0){M.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,nt={bits:E.lenbits},st=l(u,E.lens,0,E.nlen,E.lencode,0,E.work,nt),E.lenbits=nt.bits,st){M.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,nt={bits:E.distbits},st=l(f,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,nt),E.distbits=nt.bits,st){M.msg="invalid distances set",E.mode=30;break}if(E.mode=20,I===6)break t;case 20:E.mode=21;case 21:if(6<=tt&&258<=ft){M.next_out=ot,M.avail_out=ft,M.next_in=j,M.avail_in=tt,E.hold=V,E.bits=W,c(M,at),ot=M.next_out,q=M.output,ft=M.avail_out,j=M.next_in,D=M.input,tt=M.avail_in,V=E.hold,W=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;Ct=(U=E.lencode[V&(1<<E.lenbits)-1])>>>16&255,Pt=65535&U,!((Mt=U>>>24)<=W);){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}if(Ct&&!(240&Ct)){for(Ut=Mt,se=Ct,Be=Pt;Ct=(U=E.lencode[Be+((V&(1<<Ut+se)-1)>>Ut)])>>>16&255,Pt=65535&U,!(Ut+(Mt=U>>>24)<=W);){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}V>>>=Ut,W-=Ut,E.back+=Ut}if(V>>>=Mt,W-=Mt,E.back+=Mt,E.length=Pt,Ct===0){E.mode=26;break}if(32&Ct){E.back=-1,E.mode=12;break}if(64&Ct){M.msg="invalid literal/length code",E.mode=30;break}E.extra=15&Ct,E.mode=22;case 22:if(E.extra){for(B=E.extra;W<B;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}E.length+=V&(1<<E.extra)-1,V>>>=E.extra,W-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;Ct=(U=E.distcode[V&(1<<E.distbits)-1])>>>16&255,Pt=65535&U,!((Mt=U>>>24)<=W);){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}if(!(240&Ct)){for(Ut=Mt,se=Ct,Be=Pt;Ct=(U=E.distcode[Be+((V&(1<<Ut+se)-1)>>Ut)])>>>16&255,Pt=65535&U,!(Ut+(Mt=U>>>24)<=W);){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}V>>>=Ut,W-=Ut,E.back+=Ut}if(V>>>=Mt,W-=Mt,E.back+=Mt,64&Ct){M.msg="invalid distance code",E.mode=30;break}E.offset=Pt,E.extra=15&Ct,E.mode=24;case 24:if(E.extra){for(B=E.extra;W<B;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}E.offset+=V&(1<<E.extra)-1,V>>>=E.extra,W-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){M.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(ft===0)break t;if(lt=at-ft,E.offset>lt){if((lt=E.offset-lt)>E.whave&&E.sane){M.msg="invalid distance too far back",E.mode=30;break}Dt=lt>E.wnext?(lt-=E.wnext,E.wsize-lt):E.wnext-lt,lt>E.length&&(lt=E.length),Yt=E.window}else Yt=q,Dt=ot-E.offset,lt=E.length;for(ft<lt&&(lt=ft),ft-=lt,E.length-=lt;q[ot++]=Yt[Dt++],--lt;);E.length===0&&(E.mode=21);break;case 26:if(ft===0)break t;q[ot++]=E.length,ft--,E.mode=21;break;case 27:if(E.wrap){for(;W<32;){if(tt===0)break t;tt--,V|=D[j++]<<W,W+=8}if(at-=ft,M.total_out+=at,E.total+=at,at&&(M.adler=E.check=E.flags?a(E.check,q,at,ot-at):o(E.check,q,at,ot-at)),at=ft,(E.flags?V:w(V))!==E.check){M.msg="incorrect data check",E.mode=30;break}W=V=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;W<32;){if(tt===0)break t;tt--,V+=D[j++]<<W,W+=8}if(V!==(4294967295&E.total)){M.msg="incorrect length check",E.mode=30;break}W=V=0}E.mode=29;case 29:st=1;break t;case 30:st=-3;break t;case 31:return-4;case 32:default:return h}return M.next_out=ot,M.avail_out=ft,M.next_in=j,M.avail_in=tt,E.hold=V,E.bits=W,(E.wsize||at!==M.avail_out&&E.mode<30&&(E.mode<27||I!==4))&&H(M,M.output,M.next_out,at-M.avail_out)?(E.mode=31,-4):(bt-=M.avail_in,at-=M.avail_out,M.total_in+=bt,M.total_out+=at,E.total+=at,E.wrap&&at&&(M.adler=E.check=E.flags?a(E.check,q,at,M.next_out-at):o(E.check,q,at,M.next_out-at)),M.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(bt==0&&at===0||I===4)&&st===d&&(st=-5),st)},i.inflateEnd=function(M){if(!M||!M.state)return h;var I=M.state;return I.window&&(I.window=null),M.state=null,d},i.inflateGetHeader=function(M,I){var E;return M&&M.state&&2&(E=M.state).wrap?((E.head=I).done=!1,d):h},i.inflateSetDictionary=function(M,I){var E,D=I.length;return M&&M.state?(E=M.state).wrap!==0&&E.mode!==11?h:E.mode===11&&o(1,I,D,0)!==E.check?-3:H(M,I,D,D)?(E.mode=31,-4):(E.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,p,m,b,w){var k,T,A,C,R,S,F,N,P,H=w.bits,M=0,I=0,E=0,D=0,q=0,j=0,ot=0,tt=0,ft=0,V=0,W=null,bt=0,at=new s.Buf16(16),lt=new s.Buf16(16),Dt=null,Yt=0;for(M=0;M<=15;M++)at[M]=0;for(I=0;I<h;I++)at[f[d+I]]++;for(q=H,D=15;1<=D&&at[D]===0;D--);if(D<q&&(q=D),D===0)return p[m++]=20971520,p[m++]=20971520,w.bits=1,0;for(E=1;E<D&&at[E]===0;E++);for(q<E&&(q=E),M=tt=1;M<=15;M++)if(tt<<=1,(tt-=at[M])<0)return-1;if(0<tt&&(u===0||D!==1))return-1;for(lt[1]=0,M=1;M<15;M++)lt[M+1]=lt[M]+at[M];for(I=0;I<h;I++)f[d+I]!==0&&(b[lt[f[d+I]]++]=I);if(S=u===0?(W=Dt=b,19):u===1?(W=o,bt-=257,Dt=a,Yt-=257,256):(W=c,Dt=l,-1),M=E,R=m,ot=I=V=0,A=-1,C=(ft=1<<(j=q))-1,u===1&&852<ft||u===2&&592<ft)return 1;for(;;){for(F=M-ot,P=b[I]<S?(N=0,b[I]):b[I]>S?(N=Dt[Yt+b[I]],W[bt+b[I]]):(N=96,0),k=1<<M-ot,E=T=1<<j;p[R+(V>>ot)+(T-=k)]=F<<24|N<<16|P|0,T!==0;);for(k=1<<M-1;V&k;)k>>=1;if(k!==0?(V&=k-1,V+=k):V=0,I++,--at[M]==0){if(M===D)break;M=f[d+b[I]]}if(q<M&&(V&C)!==A){for(ot===0&&(ot=q),R+=E,tt=1<<(j=M-ot);j+ot<D&&!((tt-=at[j+ot])<=0);)j++,tt<<=1;if(ft+=1<<j,u===1&&852<ft||u===2&&592<ft)return 1;p[A=V&C]=q<<24|j<<16|R-m|0}}return V!==0&&(p[R+V]=M-ot<<24|64<<16|0),w.bits=q,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(U){for(var Y=U.length;0<=--Y;)U[Y]=0}var l=0,u=29,f=256,d=f+1+u,h=30,p=19,m=2*d+1,b=15,w=16,k=7,T=256,A=16,C=17,R=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],F=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=new Array(2*(d+2));c(H);var M=new Array(2*h);c(M);var I=new Array(512);c(I);var E=new Array(256);c(E);var D=new Array(u);c(D);var q,j,ot,tt=new Array(h);function ft(U,Y,ct,ht,J){this.static_tree=U,this.extra_bits=Y,this.extra_base=ct,this.elems=ht,this.max_length=J,this.has_stree=U&&U.length}function V(U,Y){this.dyn_tree=U,this.max_code=0,this.stat_desc=Y}function W(U){return U<256?I[U]:I[256+(U>>>7)]}function bt(U,Y){U.pending_buf[U.pending++]=255&Y,U.pending_buf[U.pending++]=Y>>>8&255}function at(U,Y,ct){U.bi_valid>w-ct?(U.bi_buf|=Y<<U.bi_valid&65535,bt(U,U.bi_buf),U.bi_buf=Y>>w-U.bi_valid,U.bi_valid+=ct-w):(U.bi_buf|=Y<<U.bi_valid&65535,U.bi_valid+=ct)}function lt(U,Y,ct){at(U,ct[2*Y],ct[2*Y+1])}function Dt(U,Y){for(var ct=0;ct|=1&U,U>>>=1,ct<<=1,0<--Y;);return ct>>>1}function Yt(U,Y,ct){var ht,J,mt=new Array(b+1),Et=0;for(ht=1;ht<=b;ht++)mt[ht]=Et=Et+ct[ht-1]<<1;for(J=0;J<=Y;J++){var dt=U[2*J+1];dt!==0&&(U[2*J]=Dt(mt[dt]++,dt))}}function Mt(U){var Y;for(Y=0;Y<d;Y++)U.dyn_ltree[2*Y]=0;for(Y=0;Y<h;Y++)U.dyn_dtree[2*Y]=0;for(Y=0;Y<p;Y++)U.bl_tree[2*Y]=0;U.dyn_ltree[2*T]=1,U.opt_len=U.static_len=0,U.last_lit=U.matches=0}function Ct(U){8<U.bi_valid?bt(U,U.bi_buf):0<U.bi_valid&&(U.pending_buf[U.pending++]=U.bi_buf),U.bi_buf=0,U.bi_valid=0}function Pt(U,Y,ct,ht){var J=2*Y,mt=2*ct;return U[J]<U[mt]||U[J]===U[mt]&&ht[Y]<=ht[ct]}function Ut(U,Y,ct){for(var ht=U.heap[ct],J=ct<<1;J<=U.heap_len&&(J<U.heap_len&&Pt(Y,U.heap[J+1],U.heap[J],U.depth)&&J++,!Pt(Y,ht,U.heap[J],U.depth));)U.heap[ct]=U.heap[J],ct=J,J<<=1;U.heap[ct]=ht}function se(U,Y,ct){var ht,J,mt,Et,dt=0;if(U.last_lit!==0)for(;ht=U.pending_buf[U.d_buf+2*dt]<<8|U.pending_buf[U.d_buf+2*dt+1],J=U.pending_buf[U.l_buf+dt],dt++,ht===0?lt(U,J,Y):(lt(U,(mt=E[J])+f+1,Y),(Et=S[mt])!==0&&at(U,J-=D[mt],Et),lt(U,mt=W(--ht),ct),(Et=F[mt])!==0&&at(U,ht-=tt[mt],Et)),dt<U.last_lit;);lt(U,T,Y)}function Be(U,Y){var ct,ht,J,mt=Y.dyn_tree,Et=Y.stat_desc.static_tree,dt=Y.stat_desc.has_stree,Tt=Y.stat_desc.elems,ue=-1;for(U.heap_len=0,U.heap_max=m,ct=0;ct<Tt;ct++)mt[2*ct]!==0?(U.heap[++U.heap_len]=ue=ct,U.depth[ct]=0):mt[2*ct+1]=0;for(;U.heap_len<2;)mt[2*(J=U.heap[++U.heap_len]=ue<2?++ue:0)]=1,U.depth[J]=0,U.opt_len--,dt&&(U.static_len-=Et[2*J+1]);for(Y.max_code=ue,ct=U.heap_len>>1;1<=ct;ct--)Ut(U,mt,ct);for(J=Tt;ct=U.heap[1],U.heap[1]=U.heap[U.heap_len--],Ut(U,mt,1),ht=U.heap[1],U.heap[--U.heap_max]=ct,U.heap[--U.heap_max]=ht,mt[2*J]=mt[2*ct]+mt[2*ht],U.depth[J]=(U.depth[ct]>=U.depth[ht]?U.depth[ct]:U.depth[ht])+1,mt[2*ct+1]=mt[2*ht+1]=J,U.heap[1]=J++,Ut(U,mt,1),2<=U.heap_len;);U.heap[--U.heap_max]=U.heap[1],function($t,Yn){var O,g,_,L,$,Q,it=Yn.dyn_tree,Kt=Yn.max_code,Se=Yn.stat_desc.static_tree,Ee=Yn.stat_desc.has_stree,Oe=Yn.stat_desc.extra_bits,le=Yn.stat_desc.extra_base,$c=Yn.stat_desc.max_length,fh=0;for(L=0;L<=b;L++)$t.bl_count[L]=0;for(it[2*$t.heap[$t.heap_max]+1]=0,O=$t.heap_max+1;O<m;O++)$c<(L=it[2*it[2*(g=$t.heap[O])+1]+1]+1)&&(L=$c,fh++),it[2*g+1]=L,Kt<g||($t.bl_count[L]++,$=0,le<=g&&($=Oe[g-le]),Q=it[2*g],$t.opt_len+=Q*(L+$),Ee&&($t.static_len+=Q*(Se[2*g+1]+$)));if(fh!==0){do{for(L=$c-1;$t.bl_count[L]===0;)L--;$t.bl_count[L]--,$t.bl_count[L+1]+=2,$t.bl_count[$c]--,fh-=2}while(0<fh);for(L=$c;L!==0;L--)for(g=$t.bl_count[L];g!==0;)Kt<(_=$t.heap[--O])||(it[2*_+1]!==L&&($t.opt_len+=(L-it[2*_+1])*it[2*_],it[2*_+1]=L),g--)}}(U,Y),Yt(mt,ue,U.bl_count)}function v(U,Y,ct){var ht,J,mt=-1,Et=Y[1],dt=0,Tt=7,ue=4;for(Et===0&&(Tt=138,ue=3),Y[2*(ct+1)+1]=65535,ht=0;ht<=ct;ht++)J=Et,Et=Y[2*(ht+1)+1],++dt<Tt&&J===Et||(dt<ue?U.bl_tree[2*J]+=dt:J!==0?(J!==mt&&U.bl_tree[2*J]++,U.bl_tree[2*A]++):dt<=10?U.bl_tree[2*C]++:U.bl_tree[2*R]++,mt=J,ue=(dt=0)===Et?(Tt=138,3):J===Et?(Tt=6,3):(Tt=7,4))}function st(U,Y,ct){var ht,J,mt=-1,Et=Y[1],dt=0,Tt=7,ue=4;for(Et===0&&(Tt=138,ue=3),ht=0;ht<=ct;ht++)if(J=Et,Et=Y[2*(ht+1)+1],!(++dt<Tt&&J===Et)){if(dt<ue)for(;lt(U,J,U.bl_tree),--dt!=0;);else J!==0?(J!==mt&&(lt(U,J,U.bl_tree),dt--),lt(U,A,U.bl_tree),at(U,dt-3,2)):dt<=10?(lt(U,C,U.bl_tree),at(U,dt-3,3)):(lt(U,R,U.bl_tree),at(U,dt-11,7));mt=J,ue=(dt=0)===Et?(Tt=138,3):J===Et?(Tt=6,3):(Tt=7,4)}}c(tt);var nt=!1;function B(U,Y,ct,ht){at(U,(l<<1)+(ht?1:0),3),function(J,mt,Et,dt){Ct(J),bt(J,Et),bt(J,~Et),s.arraySet(J.pending_buf,J.window,mt,Et,J.pending),J.pending+=Et}(U,Y,ct)}i._tr_init=function(U){nt||(function(){var Y,ct,ht,J,mt,Et=new Array(b+1);for(J=ht=0;J<u-1;J++)for(D[J]=ht,Y=0;Y<1<<S[J];Y++)E[ht++]=J;for(E[ht-1]=J,J=mt=0;J<16;J++)for(tt[J]=mt,Y=0;Y<1<<F[J];Y++)I[mt++]=J;for(mt>>=7;J<h;J++)for(tt[J]=mt<<7,Y=0;Y<1<<F[J]-7;Y++)I[256+mt++]=J;for(ct=0;ct<=b;ct++)Et[ct]=0;for(Y=0;Y<=143;)H[2*Y+1]=8,Y++,Et[8]++;for(;Y<=255;)H[2*Y+1]=9,Y++,Et[9]++;for(;Y<=279;)H[2*Y+1]=7,Y++,Et[7]++;for(;Y<=287;)H[2*Y+1]=8,Y++,Et[8]++;for(Yt(H,d+1,Et),Y=0;Y<h;Y++)M[2*Y+1]=5,M[2*Y]=Dt(Y,5);q=new ft(H,S,f+1,d,b),j=new ft(M,F,0,h,b),ot=new ft(new Array(0),N,0,p,k)}(),nt=!0),U.l_desc=new V(U.dyn_ltree,q),U.d_desc=new V(U.dyn_dtree,j),U.bl_desc=new V(U.bl_tree,ot),U.bi_buf=0,U.bi_valid=0,Mt(U)},i._tr_stored_block=B,i._tr_flush_block=function(U,Y,ct,ht){var J,mt,Et=0;0<U.level?(U.strm.data_type===2&&(U.strm.data_type=function(dt){var Tt,ue=4093624447;for(Tt=0;Tt<=31;Tt++,ue>>>=1)if(1&ue&&dt.dyn_ltree[2*Tt]!==0)return o;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return a;for(Tt=32;Tt<f;Tt++)if(dt.dyn_ltree[2*Tt]!==0)return a;return o}(U)),Be(U,U.l_desc),Be(U,U.d_desc),Et=function(dt){var Tt;for(v(dt,dt.dyn_ltree,dt.l_desc.max_code),v(dt,dt.dyn_dtree,dt.d_desc.max_code),Be(dt,dt.bl_desc),Tt=p-1;3<=Tt&&dt.bl_tree[2*P[Tt]+1]===0;Tt--);return dt.opt_len+=3*(Tt+1)+5+5+4,Tt}(U),J=U.opt_len+3+7>>>3,(mt=U.static_len+3+7>>>3)<=J&&(J=mt)):J=mt=ct+5,ct+4<=J&&Y!==-1?B(U,Y,ct,ht):U.strategy===4||mt===J?(at(U,2+(ht?1:0),3),se(U,H,M)):(at(U,4+(ht?1:0),3),function(dt,Tt,ue,$t){var Yn;for(at(dt,Tt-257,5),at(dt,ue-1,5),at(dt,$t-4,4),Yn=0;Yn<$t;Yn++)at(dt,dt.bl_tree[2*P[Yn]+1],3);st(dt,dt.dyn_ltree,Tt-1),st(dt,dt.dyn_dtree,ue-1)}(U,U.l_desc.max_code+1,U.d_desc.max_code+1,Et+1),se(U,U.dyn_ltree,U.dyn_dtree)),Mt(U),ht&&Ct(U)},i._tr_tally=function(U,Y,ct){return U.pending_buf[U.d_buf+2*U.last_lit]=Y>>>8&255,U.pending_buf[U.d_buf+2*U.last_lit+1]=255&Y,U.pending_buf[U.l_buf+U.last_lit]=255&ct,U.last_lit++,Y===0?U.dyn_ltree[2*ct]++:(U.matches++,Y--,U.dyn_ltree[2*(E[ct]+f+1)]++,U.dyn_dtree[2*W(Y)]++),U.last_lit===U.lit_bufsize-1},i._tr_align=function(U){at(U,2,3),lt(U,T,H),function(Y){Y.bi_valid===16?(bt(Y,Y.bi_buf),Y.bi_buf=0,Y.bi_valid=0):8<=Y.bi_valid&&(Y.pending_buf[Y.pending++]=255&Y.bi_buf,Y.bi_buf>>=8,Y.bi_valid-=8)}(U)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},p=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(A){Ir.nextTick(function(){k(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,C=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=C,A}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(f+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){k(A.data)},function(A){u.port2.postMessage(A)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(A){var C=m.createElement("script");C.onreadystatechange=function(){k(A),C.onreadystatechange=null,l.removeChild(C),C=null},l.appendChild(C)}):function(A){setTimeout(k,0,A)},b.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var C=new Array(arguments.length-1),R=0;R<C.length;R++)C[R]=arguments[R+1];var S={callback:A,args:C};return h[d]=S,c(d),d++},b.clearImmediate=w}function w(A){delete h[A]}function k(A){if(p)setTimeout(k,0,A);else{var C=h[A];if(C){p=!0;try{(function(R){var S=R.callback,F=R.args;switch(F.length){case 0:S();break;case 1:S(F[0]);break;case 2:S(F[0],F[1]);break;case 3:S(F[0],F[1],F[2]);break;default:S.apply(a,F)}})(C)}finally{w(A),p=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(f)===0&&k(+A.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Cn<"u"?Cn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ox);var j4=Ox.exports,yp=ro(j4);const Ix={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Ix);var Or=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},fa,Pc,no;class z4{constructor(...e){fa.set(this,new Map),Pc.set(this,new Map),no.set(this,new Map);for(const n of e)this.define(n)}define(e,n=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Or(this,no,"f").has(r)||Or(this,no,"f").set(r,new Set);const s=Or(this,no,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Or(this,Pc,"f").set(r,a),o=!1,c)continue;const l=Or(this,fa,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Or(this,fa,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const n=e.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<e.length;return!(r.length<n.length-1)&&i?null:Or(this,fa,"f").get(r)??null}getExtension(e){var n;return typeof e!="string"?null:(e=(n=e==null?void 0:e.split)==null?void 0:n.call(e,";")[0],(e&&Or(this,Pc,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:Or(this,no,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of Or(this,no,"f").values())Object.freeze(e);return this}_getTestState(){return{types:Or(this,fa,"f"),extensions:Or(this,Pc,"f")}}}fa=new WeakMap,Pc=new WeakMap,no=new WeakMap;var K4=new z4(Ix)._freeze();function Nx(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:if(t.endsWith(".xp"))return"application/rexpaint";break}return K4.getType(t)??"application/octet-stream"}async function W4(t,e,n){try{fe(et,t,"parsezipfile",e.name);const r=await e.arrayBuffer();(await new yp().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=Nx(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{he(et,t,"crash",c.message)})})}catch(r){he(et,t,"crash",r.message)}}async function Cx(t,e,n){try{fe(et,e,"parsebinaryfile",t.name);const r=await t.arrayBuffer();n(new Uint8Array(r))}catch(r){he(et,e,"crash",r.message)}}function Lx(t,e){function n(r){if(x(e))switch(r){case"text/plain":e.text().then(i=>Ua(et,t,void 0,"text",`file:${e.name}`,i)).catch(i=>he(et,t,"crash",i.message));break;case"application/json":e.text().then(i=>Ua(et,t,void 0,"json",`file:${e.name}`,i)).catch(i=>he(et,t,"crash",i.message));break;case"application/zip":W4(t,e,i=>Lx(t,i)).catch(i=>he(et,t,"crash",i.message));break;case"application/rexpaint":Cx(e,t,i=>Ua(et,t,void 0,"rexpaint",`file:${e.name}`,i)).catch(i=>he(et,t,"crash",i.message));break;case"application/octet-stream":Cx(e,t,i=>Ua(et,t,void 0,"binary",`file:${e.name}`,i)).catch(i=>he(et,t,"crash",i.message));break;default:e.arrayBuffer().then(i=>{const s=Nx(e.name,new Uint8Array(i));if(s)n(s);else return he(et,t,"parsewebfile",`unsupported file ${e.name}`)}).catch(i=>he(et,t,"crash",i.message));return}}n((e==null?void 0:e.type)??"")}function da(t,e,n){function r(i){he(t,e,"crash",i.message)}n().catch(r)}function H4(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return e+n}function G4(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const Y4=new Date("1980/09/02");async function Mx(t){return console.info("saved",t),new Promise((e,n)=>{const r=new yp;for(let i=0;i<t.length;++i){const s=t[i],o=qU(s);if(o){const a=VI(o);x(a)&&r.file(s.id,a,{date:Y4})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{e(G4(i))}).catch(n)})}async function V4(t){return new Promise((e,n)=>{const r=new yp;r.loadAsync(H4(t),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=JU(ZI(c));x(l)&&i.push(l)}e(i)}).catch(n)})}function Ux(t,e){return`${t.x},${t.y},${e.x},${e.y}`}let rn;function Z4(){return!!rn}function X4(t,e,n){const r=Math.min(e.x,n.x),i=Math.min(e.y,n.y),s=Math.max(e.x,n.x),o=Math.max(e.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},p=ge(t,{x:d,y:f});(p==null?void 0:p.category)===fr.ISOBJECT?(l.push(Zn(zo(t,d,f))),is(p)!=="player"&&u.push({...Zn(p),...h,id:"blank"})):l.push({...Zn(p),...h})}return{board:t.id,width:a,height:c,terrain:l,objects:u}}function q4(t,e,n,r){const i=lr(t);if(x(i))switch(rn=X4(i,e,n),r){case"copyobjects":rn.terrain=[];break;case"copyterrain":rn.objects=[];break}}function J4(t,e,n){const r=Ux(e,n);re(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),re(t,hn),Bt(t,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Bt(t,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Bt(t,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=fn(t);i.scroll=ur(t)}function Q4(t,e,n,r){const i=lr(t);if(!x(i)||!x(rn))return;const s=Math.min(e.x,n.x),o=Math.min(e.y,n.y),a=Math.max(e.x,n.x),c=Math.max(e.y,n.y),l=a-s+1,u=c-o+1,f=Math.min(rn.width,l),d=Math.min(rn.height,u);switch(r){case"pasteall":{for(let h=0;h<d;++h)for(let p=0;p<f;++p){const m=Mo({x:p,y:h},rn.width);un(i,{...rn.terrain[m],x:s+p,y:o+h})}for(let h=0;h<rn.objects.length;++h){const p=rn.objects[h];x(p.x)&&x(p.y)&&Uo(p.x,p.y,0,l-1,u-1,0)&&Ed(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let h=0;h<rn.objects.length;++h){const p=rn.objects[h];x(p.x)&&x(p.y)&&Uo(p.x,p.y,0,l-1,u-1,0)&&Ed(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let h=0;h<d;++h)for(let p=0;p<f;++p){const m=Mo({x:p,y:h},rn.width);un(i,{...rn.terrain[m],x:s+p,y:o+h})}break;case"pasteterraintiled":for(let h=o;h<=c;++h)for(let p=s;p<=a;++p){const m=(p-s)%rn.width,b=(h-o)%rn.height,w=Mo({x:m,y:b},rn.width);un(i,{...rn.terrain[w],x:p,y:h})}break}}function tj(t,e,n){const r=Ux(e,n);re(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),re(t,hn),Bt(t,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Bt(t,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Bt(t,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Bt(t,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=fn(t);i.scroll=ur(t)}function uh(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function ej(t,e,n,r){const i=lr(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){At(u)&&(s=u,ny(e.x,e.y,n.x,n.y).forEach(f=>{const d=ge(i,f);x(d)&&(d[l]=u)}))}re(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),re(t,hn),Bt(t,`batch:${uh(e,n)}`,"char",[r,"charedit"],o,a);const c=fn(t);c.scroll=ur(t)}function nj(t,e,n,r){const i=lr(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){if(At(u)){s=u;for(let f=e.y;f<=n.y;++f)for(let d=e.x;d<=n.x;++d){const h=ge(i,{x:d,y:f});x(h)&&(h[l]=u)}}}re(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),re(t,hn),Bt(t,`batch:${uh(e,n)}`,"color",[r,"coloredit"],o,a);const c=fn(t);c.scroll=ur(t)}function rj(t,e,n,r){const i=lr(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){At(u)&&(s=u,ny(e.x,e.y,n.x,n.y).forEach(f=>{const d=ge(i,f);x(d)&&(d[l]=u)}))}re(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),re(t,hn),Bt(t,`batch:${uh(e,n)}`,"color",[r,"coloredit"],o,a);const c=fn(t);c.scroll=ur(t)}const Dc={stat:"",patternsize:2,mirror:1};function ij(t,e,n){const r=vn(jt.MAIN);if(!x(r))return;const i=lr(t);if(!x(i))return;const s=uh(e,n);re(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),re(t,hn),Bt(t,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),Z4()&&Bt(t,"batch","paste elements",[`paste:${s}`,"hk","2"," 2 ","next"]),Bt(t,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(h){const{target:p}=Xn(h);return Dc[p]}function a(h,p){if(At(p)||wt(p)){const{target:m}=Xn(h);Dc[m]=p}}Bt(t,"batch","remix",[`stat:${s}`,"text"],o,a),Bt(t,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),Bt(t,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),Bt(t,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),re(t,hn),Bt(t,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),Bt(t,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),Bt(t,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),re(t,hn),Bt(t,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),re(t,hn),re(t,"codepages:");const c=Math.min(e.x,n.x),l=Math.min(e.y,n.y),u=Math.max(e.x,n.x),f=Math.max(e.y,n.y),d=new Set;for(let h=l;h<=f;++h)for(let p=c;p<=u;++p){const m=ge(i,{x:p,y:h}),b=uE(r,m);x(b)&&!d.has(b.id)&&(d.add(b.id),Bt(t,"batch",`edit @${We(b)}`,[`pageopen:${b.id}`]))}}function bp(t,e){return`inspect:${e!=null&&e.id?e.id:Ur(t,e)}`}function sj(t,e,n){const r=vn(jt.MAIN);if(!x(r))return;const i=lr(t);if(!x(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){x(e)&&(e[d]=h)}const a=e.category===fr.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=bp(i,e);re(t,`${a}: ${c} ${l}`),re(t,hn),Bt(t,u,"color",[n,"coloredit"],s,o);const f=fn(t);f.scroll=ur(t)}function oj(t,e,n){const r=vn(jt.MAIN);if(!x(r))return;const i=lr(t);if(!x(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){x(e)&&(e[d]=h)}const a=e.category===fr.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=bp(i,e);re(t,`${a}: ${c} ${l}`),re(t,hn),Bt(t,u,"char",[n,"charedit"],s,o);const f=fn(t);f.scroll=ur(t)}function aj(t,e,n,r,i,s){var f,d,h;function o(p){var b;const m=(r==null?void 0:r[p])??((b=r==null?void 0:r.kinddata)==null?void 0:b[p]);if(!x(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return zt.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){x(r)&&(r[p]=m)}s?re(t,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):re(t,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),re(t,hn);const c=bp(e,r);s?(Bt(t,c,"cycle",["cycle","number","1","255"],o,a),Bt(t,c,"collision",["collision","select","iswalking",`${zt.ISWALK}`,"isswimming",`${zt.ISSWIM}`],o,a)):Bt(t,c,"collision",["collision","select","iswalkable",`${zt.ISWALK}`,"isswimable",`${zt.ISSWIM}`,"issolid",`${zt.ISSOLID}`],o,a),s&&Bt(t,c,"pushable",["pushable","select","no","0","yes","1"],o,a),Bt(t,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const l=Rc(n),u=hr(l);for(let p=0;p<u.length;++p){const m=u[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(ce(l[m])){const[b,w,...k]=l[m];wt(w)&&Bt(t,c,w||m,[m,b,...k],o,a)}break}}Bt(t,c,"copy coords",["copycoords","hk","5"," 5 "]),re(t,hn),Bt(t,c,`char: ${r.char??((f=r.kinddata)==null?void 0:f.char)??1}`,["char","hk","a"," A ","next"],o,a),Bt(t,c,`color: ${r.color??((d=r.kinddata)==null?void 0:d.color)??15}`,["color","hk","c"," C ","next"],o,a),Bt(t,c,`bg: ${r.bg??((h=r.kinddata)==null?void 0:h.bg)??0}`,["bg","hk","b"," B ","next"],o,a),re(t,hn),Bt(t,c,"make empty",["empty","hk","0"],o,a),re(t,hn),Bt(t,"batch",`edit @${We(n)}`,[`pageopen:${n.id}`])}function cj(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function lj(t,e,n,r){const i=vn(jt.MAIN);if(!x(i))return;const s=lr(t);if(x(s))switch(r){case"emptyall":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=ge(s,{x:a,y:o});(c==null?void 0:c.category)===fr.ISOBJECT&&or(i,s,c,i.timestamp),un(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=ge(s,{x:a,y:o});(c==null?void 0:c.category)===fr.ISOBJECT&&or(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a)un(s,{x:a,y:o});break}}}function uj(t,e,n){const r=cj(e,n);re(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),re(t,hn),Bt(t,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),Bt(t,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),Bt(t,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=fn(t);i.scroll=ur(t)}function hj(t,e,n){const r=vn(jt.MAIN);if(!x(r))return;const i=lr(t);if(!x(i))return;if(Ge(r,i),e.x===n.x&&e.y===n.y){const o=ge(i,e),a=uE(r,o);x(o)&&x(a)&&aj(t,i,a,o,e,En(o)),o!=null&&o.kind||(re(t,`empty: ${e.x}, ${e.y}`),re(t,hn),Bt(t,"empty","copy coords",[`copycoords:${e.x},${e.y}`,"hk","5"," 5 "]))}else ij(t,e,n);const s=fn(t);s.scroll=ur(t)}function fj(t,e){const n=we(jt.MAIN);if(!x(n))return;const r=lr(e);if(!x(r))return;const i=Xn(t),s=QI(r,i.target);if(x(s))switch(i.path){case"copycoords":tf(et,cr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":sj(e,s,i.path);break;case"char":oj(e,s,i.path);break;case"empty":or(n,r,s,n.timestamp);break;case"code":da(et,e,async()=>{const o=is(s),a="object";fe(et,e,`opened [${a}] ${o}`);const c=[r.id,s.id];Jf(nl(n.id,c),s.code??""),CA(et,e),await cg(800),sg(et,e,n.id,c,a,`${o} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}function dj(t,e){const n=lr(e);if(!x(n))return;const r=Xn(t),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":J4(e,c,l);break;case"copyall":case"copyobjects":case"copyterrain":q4(e,c,l,r.target);break;case"paste":tj(e,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":Q4(e,c,l,r.target);break;case"empty":uj(e,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":lj(e,c,l,r.target);break;case"chars":ej(e,c,l,"char");break;case"colors":nj(e,c,l,"color");break;case"bgs":rj(e,c,l,"bg");break;case"copycoords":tf(et,e,[i,s,o,a].join(" "));break;case"remixrun":{const u=zn(y.book,_t.BOARD,Dc.stat),f=Ae(...u);x(f)&&YE(n.id,f.id,Dc.patternsize,Dc.mirror,c,l,"all");break}case"pageopen":da(et,e,async()=>{await cg(800),JA(et,e,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const pj=16,ws={},hh={},mj=60;let Fx=0;const pa={},ma={};async function Bx(t){const e=aa(),n=we(jt.MAIN);if(e.length&&x(n)){const r=await Mx(e),i=`${t?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;MA(ae,cr(),i,r)}}async function gj(){const t=aa(),e=we(jt.MAIN);if(t.length&&x(e)){const n=await Mx(t);UA(ae,cr(),n)}}const ae=so("vm",["tick","second"],t=>{var n;if(!ae.session(t))return;const e=cr();switch(t.target){case"operator":g4(t.player),fe(ae,t.player,`operator set to ${t.player}`),ae.replynext(t,"ackoperator",!0);break;case"zsswords":{const r=we(jt.MAIN);ae.replynext(t,"ackzsswords",{cli:ip(_s.CLI),loader:ip(_s.LOADER),runtime:ip(_s.RUNTIME),flags:[...hr(Sr(t.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...Xs(r,_t.OBJECT).map(i=>We(i)),...hr(Q0)],altkinds:[...Xs(r,_t.TERRAIN),...Xs(r,_t.BOARD),...Xs(r,_t.PALETTE),...Xs(r,_t.CHARSET),...Xs(r,_t.LOADER)].map(i=>We(i)),colors:[...hr(Ja)],dirs:[...hr(sd).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...hr(tp)]});break}case"books":t.player===e&&da(ae,t.player,async()=>{if(ce(t.data)){const[r,i]=t.data,s=await V4(r),o=s.map(a=>a.name);x4(s,i),fe(ae,t.player,`loading ${o.join(", ")}`),Qh(ae,t.player)}});break;case"search":T4(t.player)||Qh(ae,t.player);break;case"logout":k4(t.player),delete ws[t.player],fe(ae,e,`player ${t.player} logout`),Qh(ae,t.player);break;case"login":Ex(t.player)?(ws[t.player]=0,fe(ae,cr(),`login from ${t.player}`),ae.replynext(t,"acklogin",!0)):ng(ae,t.player);break;case"local":Ex(t.player)?(ws[t.player]=0,fe(ae,cr(),`login from ${t.player}`)):ng(ae,t.player);break;case"doot":ws[t.player]=0,hh[t.player]=hh[t.player]??0,hh[t.player]%32===0&&fe(ae,t.player,`$whiteactive $blue${t.player}`),++hh[t.player];break;case"input":{if(t.player.includes("local")&&!bx(t.player)&&qA(ae,t.player),!t.player.includes("local")||bx(t.player)){const r=Sr(t.player),[i=Sn.NONE,s=0]=t.data??[Sn.NONE,0];ce(r.inputqueue)||(r.inputqueue=[]),i!==Sn.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(ce(t.data)){const[r,i]=t.data,s=nl(r,i);x(ma[s])||(ma[s]=ty(s,o=>{const[a,c]=i,l=zr(r),u=Pi(l,a);if(x(u))if(Bi(u)===_t.BOARD&&x(c)){const f=Ce(u),d=Rn(f,c);x(d)&&(d.code=o,L0(oE(o),d))}else u.code=o,XU(u)})),pa[s]=pa[s]??new Set,pa[s].add(t.player)}break;case"coderelease":if(ce(t.data)){const[r,i]=t.data,[,s]=i,o=nl(r,i);x(pa[o])&&(pa[o].delete(t.player),pa[o].size===0&&((n=ma[o])==null||n.call(ma),ma[o]=void 0,wt(s)&&O4(s)))}break;case"halt":t.player===e&&Ev(t.data)&&_4(t.data);break;case"tick":y4()||N4();break;case"synthsend":wt(t.data)&&mp(t.data,void 0);break;case"second":{A4(ws);const r=Object.keys(ws);for(let i=0;i<r.length;++i)++ws[r[i]];for(let i=0;i<r.length;++i){const s=r[i];ws[s]>=pj&&og(ae,s)}++Fx>=mj&&(Fx=0,da(ae,t.player,async()=>{await Bx(!0)}));break}case"copyjsonfile":if(t.player===e){const r=we(jt.MAIN);if(x(r)&&ce(t.data)){const[i]=t.data,s=Pi(r,i);x(s)&&FA(ae,e,s,`${We(s)}.${us(s)}.json`)}}break;case"refscroll":{re(t.player,"stat refs"),re(t.player,hn),Bt(t.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Bt(t.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]);const r=fn(t.player);r.scroll=ur(t.player);break}case"fork":t.player===e&&da(ae,t.player,async()=>{await gj()});break;case"flush":t.player===e&&da(ae,t.player,async()=>{await Bx()});break;case"cli":kx(t.player,t.data);break;case"clirepeatlast":C4(t.player);break;case"restart":t.player===e&&(I4(),ag(ae,t.player));break;case"inspect":if(ce(t.data)){const[r,i]=t.data;hj(t.player,r,i)}break;case"loader":if(ce(t.data)){const[r,i,s,o]=t.data;if(i==="file")Lx(t.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){fe(ae,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=we(jt.MAIN);x(c)&&x(a.data)&&wt(a.exported)&&(pp(a.data),fe(ae,t.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){fe(ae,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=we(jt.MAIN);x(c)&&x(a.data)&&wt(a.exported)&&(hE(c,a.data),fe(ae,t.player,`loaded ${a.exported}`))}else B$(r,i,s,o,t.player)}break;default:{const{target:r,path:i}=Xn(t.target);switch(It(r)){case"refscroll":switch(i){case"charscroll":{Bt(t.player,"refscroll","char",["char","charedit"]);const s=fn(t.player);s.scroll=ur(t.player);break}case"colorscroll":{Bt(t.player,"refscroll","color",["color","coloredit"]);const s=fn(t.player);s.scroll=ur(t.player);break}}break;case"batch":dj(i,t.player);break;case"empty":{const s=Xn(i);switch(s.target){case"copycoords":tf(ae,cr(),s.path.split(",").join(" "));break}break}case"inspect":fj(i,t.player);break;case"touched":if(ce(t.data)){const[s,o,a]=t.data;xx({...t,target:`${s}:${a}`,data:void 0,sender:o})}break;default:xx(t);break}break}}},m4());function _j(){LA(ae)}const{forward:yj}=sR(t=>{oR(t)&&postMessage(t)});onmessage=function(e){yj(e.data)},setTimeout(_j,100)})();

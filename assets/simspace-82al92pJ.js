var n3=Object.defineProperty;var r3=(Jr,Bn,Tn)=>Bn in Jr?n3(Jr,Bn,{enumerable:!0,configurable:!0,writable:!0,value:Tn}):Jr[Bn]=Tn;var Ct=(Jr,Bn,Tn)=>r3(Jr,typeof Bn!="symbol"?Bn+"":Bn,Tn);(function(){"use strict";const Jr=new Set,Bn={emit(e,t,n,r,i){Bn.invoke(Z1(e,t,n,r,i))},invoke(e){Jr.forEach(t=>t.handle(e))},connect(e){Jr.add(e)},disconnect(e){Jr.delete(e)}};var Tn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ks(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function y1(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var gd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Tn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(gd);var _1=gd.exports,yd=ks(_1),_d={};(function(e){var t=Tn&&Tn.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,f=u.length,p;d<f;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,f=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,E=l.addAdverb,w=E===void 0?!1:E,T=t(t(t([],t([],Array(m),!0).map(function(A){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),w?[n(e.adverbs)]:[],!0);return f&&(T=T.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),T.join(h)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(f?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(e.adjectives).length*h+h*m.length+r(e.nouns).length+m.length+r(e.verbs).length+(f?r(e.adverbs).length+m.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(e.adjectives).length*h+h*m.length+i(e.nouns).length+m.length+i(e.verbs).length+(f?i(e.adverbs).length+m.length:0)}e.minLength=c,e.default=s})(_d);var bd=ks(_d);const b1="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let E1=e=>crypto.getRandomValues(new Uint8Array(e)),w1=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},Ed=(e,t=21)=>w1(e,t,E1),x1=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=b1[n[e]&63];return t};var wd="abcdefghijklmnopqrstuvwxyz",xd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",kd="0123456789",k1="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",T1="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const A1=kd,v1=wd,S1=xd;var R1=A1+v1+S1,zl={lowercase:wd,uppercase:xd,numbers:kd,nolookalikes:k1,nolookalikesSafe:T1,alphanumeric:R1};function Ce(){return`sid_${x1(12).replaceAll("-",".")}`}Ed(zl.numbers,4),Ed(`${zl.numbers}${zl.lowercase}`,16);function vr(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function I1(){return bd({capitalize:!1,adjectiveCount:1})}function N1(){return bd({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var O1=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),C1=Object.prototype.hasOwnProperty;function Wl(e,t){return C1.call(e,t)}function Kl(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)Wl(e,i)&&r.push(i);return r}function An(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Gl(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Gi(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Td(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Hl(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Hl(e[t]))return!0}else if(typeof e=="object"){for(var r=Kl(e),i=r.length,s=0;s<i;s++)if(Hl(e[r[s]]))return!0}}return!1}function Ad(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var vd=function(e){O1(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,Ad(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Ad(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),Re=vd,L1=An,Ts={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Na(n,this.path);r&&(r=An(r));var i=Hi(n,{op:"remove",path:this.from}).removed;return Hi(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Na(n,this.from);return Hi(n,{op:"add",path:this.path,value:An(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Ao(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},M1={add:function(e,t,n){return Gl(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Ts.move,copy:Ts.copy,test:Ts.test,_get:Ts._get};function Na(e,t){if(t=="")return e;var n={op:"_get",path:t};return Hi(e,n),n.value}function Hi(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Oa(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Na(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Ao(e,t.value),o.test===!1)throw new Re("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Re("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=An(e));var a=t.path||"",c=a.split("/"),l=e,u=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=Oa;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=Td(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=t.path),d!==void 0&&p(t,0,e,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!Gl(f))throw new Re("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Gl(f)&&(f=~~f)}if(u>=h){if(n&&t.op==="add"&&f>l.length)throw new Re("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=M1[t.op].call(t,l,f,e);if(o.test===!1)throw new Re("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=h){var o=Ts[t.op].call(t,l,f,e);if(o.test===!1)throw new Re("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new Re("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Yl(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Re("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=An(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Hi(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function U1(e,t,n){var r=Hi(e,t);if(r.test===!1)throw new Re("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Oa(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Re("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Ts[e.op]){if(typeof e.path!="string")throw new Re("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Re('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Re("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Re("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Hl(e.value))throw new Re("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Re("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Re("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Sd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Re("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Re("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function Sd(e,t,n){try{if(!Array.isArray(e))throw new Re("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Yl(An(t),An(e),n||!0);else{n=n||Oa;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Re)return i;throw i}}function Ao(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!Ao(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Ao(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var F1=Object.freeze({__proto__:null,JsonPatchError:Re,_areEquals:Ao,applyOperation:Hi,applyPatch:Yl,applyReducer:U1,deepClone:L1,getValueByPointer:Na,validate:Sd,validator:Oa});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Vl=new WeakMap,P1=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),B1=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function D1(e){return Vl.get(e)}function $1(e,t){return e.observers.get(t)}function j1(e,t){e.observers.delete(t.callback)}function z1(e,t){t.unobserve()}function W1(e,t){var n=[],r,i=D1(e);if(!i)i=new P1(e),Vl.set(e,i);else{var s=$1(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=An(e),t){r.callback=t,r.next=null;var o=function(){Xl(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){Xl(r),clearTimeout(r.next),j1(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new B1(t,r)),r}function Xl(e,t){t===void 0&&(t=!1);var n=Vl.get(e.object);ql(n.value,e.object,e.patches,"",t),e.patches.length&&Yl(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function ql(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Kl(t),o=Kl(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(Wl(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var h=t[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?ql(u,h,n,r+"/"+Gi(l),i):u!==h&&(i&&n.push({op:"test",path:r+"/"+Gi(l),value:An(u)}),n.push({op:"replace",path:r+"/"+Gi(l),value:An(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Gi(l),value:An(u)}),n.push({op:"remove",path:r+"/"+Gi(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!Wl(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+Gi(l),value:An(t[l])})}}}function Rd(e,t,n){n===void 0&&(n=!1);var r=[];return ql(e,t,r,"",n),r}var K1=Object.freeze({__proto__:null,compare:Rd,generate:Xl,observe:W1,unobserve:z1});Object.assign({},F1,K1,{JsonPatchError:vd,deepClone:An,escapePathComponent:Gi,unescapePathComponent:Td});var G1=typeof Element<"u",H1=typeof Map=="function",Y1=typeof Set=="function",V1=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ca(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ca(e[r],t[r]))return!1;return!0}var s;if(H1&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ca(r.value[1],t.get(r.value[0])))return!1;return!0}if(Y1&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(V1&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(G1&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ca(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var X1=function(t,n){try{return Ca(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},q1=ks(X1);function k(e){return e!=null}const Xn=Object.keys;function qe(e){return An(e)}function J1(e){return typeof e=="boolean"}function St(e){return typeof e=="number"&&isNaN(e)===!1}function kt(e){return typeof e=="string"}function ae(e){return Array.isArray(e)}function Jl(e){return e}var jt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(jt||{}),Ht=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Ht||{}),Dn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Dn||{}),mt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.PLAYER=18]="PLAYER",e[e.FIND=19]="FIND",e[e.FLEE=20]="FLEE",e[e.TO=21]="TO",e))(mt||{}),wt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.COPYIT=13]="COPYIT",e[e.OPENIT=14]="OPENIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(wt||{});function Lt(e){return(e==null?void 0:e.toLowerCase().trim())??""}function Z1(e,t,n,r,i){return{session:e,player:t,id:Ce(),sender:n,target:r,data:i}}function fr(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function As(e,t=[],n=Jl,r=""){const i=Ce(),s=Lt(e),o=t.map(Lt);let a=r;const c={id(){return i},name(){return e},session(l){return k(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,h){Bn.emit(a,l,i,u,h)},reply(l,u,h){c.emit(l.player,`${l.sender}:${u}`,h)},replynext(l,u,h){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,h),64)},handle(l){const{target:u,path:h}=fr(l.target),d=Lt(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&k(l.session)&&(a=l.session),o.findIndex(f=>f==="all"||f===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:h})}};return Bn.connect(c),c}function Q1(e){return typeof e=="object"&&kt(e.session)&&kt(e.player)&&kt(e.id)&&kt(e.sender)&&kt(e.target)}function ye(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function Zr(e,t,...n){return e.emit(t,"info",n),!0}function Id(e,t,...n){return e.emit(t,"debug",n),!0}function tE(e,t,n){e.emit(t,"toast",n)}function eE(e,t,n){e.emit(t,"bridge:streamstart",n)}function nE(e,t){e.emit(t,"bridge:streamstop",void 0)}function rE(e,t,n){e.emit(t,"bridge:chatstart",n)}function iE(e,t){e.emit(t,"bridge:chatstop")}function sE(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function oE(e,t){e.emit(t,"bridge:talkstart",t)}function aE(e,t){e.emit(t,"bridge:talkstop",t)}function cE(e,t){e.emit(t,"bridge:mediastart",t)}function lE(e,t){e.emit(t,"bridge:mediastop",t)}function uE(e,t,n){e.emit(t,"bridge:start",n)}function hE(e,t,n){e.emit(t,"bridge:tab",n)}function fE(e,t,n){e.emit(t,"gadgetclient:paint",n)}function dE(e,t,n){e.emit(t,"gadgetclient:patch",n)}function pE(e,t){e.emit(t,"gadgetserver:clearscroll")}function mE(e){e.emit("","ready")}function gE(e,t){e.emit(t,"register:loginfail")}function Zl(e,t){e.emit(t,"register:loginready",!0)}function yE(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function _E(e,t,n){e.emit(t,"register:forkmem",[n])}function Ql(e,t,n){e.emit(t,"register:copy",n)}function bE(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function Nd(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function EE(e,t){e.emit(t,"register:dev",void 0)}function wE(e,t){e.emit(t,"register:share",void 0)}function xE(e,t){e.emit(t,"register:nuke",void 0)}function kE(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function TE(e,t,n){e.emit(t,"synth:tta",[n])}function AE(e,t,n,r,i){e.emit(t,"synth:play",[n,r,i])}function vE(e,t,n){e.emit(t,"synth:focus",n)}function SE(e,t,n){e.emit(t,"synth:bpm",n)}function RE(e,t,n){e.emit(t,"synth:playvolume",n)}function IE(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function NE(e,t,n){e.emit(t,"synth:ttsvolume",n)}function tu(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function Od(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function OE(e,t){e.emit(t,"register:inspector")}function Cd(e,t,n,r,i,s,o){e.emit(t,"register:editor:open",[n,r,i,s,o])}function CE(e,t){e.emit(t,"register:editor:close")}function Ld(e,t){e.emit(t,"vm:logout")}function La(e,t){const[n,r]=t;return`${e}:${[n,r].filter(k).join(":")}`}function LE(e,t,n){e.emit(t,"vm:cli",n)}function ME(e,t){e.emit(t,"vm:restart")}function Md(e,t){e.emit(t,"vm:flush")}function UE(e,t){e.emit(t,"vm:fork")}function FE(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function PE(e,t){return{filename:e,json:t}}function BE(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function eu(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=FE(i,s);break;case"json":o=PE(i,s);break;case"binary":o=BE(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function DE(e){const t=new Set;function n(s){Q1(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Bn.invoke(s))}const r=As("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Bn.disconnect(r)}return{forward:n,disconnect:i}}function $E(e){switch(e.target){case"info":case"debug":case"error":case"tick":case"tock":case"ready":case"second":return!0;default:{const t=fr(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const nu=66.666,Ma=Math.round(1e3/nu),jE=3;function Ud(e){return new Promise(t=>setTimeout(t,e))}const ru=As("clock");let iu=0,Ua=0,su=0,Fd=performance.now();function Pd(){const e=performance.now(),t=e-Fd;su+=t,su>=nu&&(su%=nu,ru.emit("","tick",Ua),ru.emit("","tock",Ua),++iu,++Ua,iu>=Ma&&(iu%=Ma,ru.emit("","second",Ua))),Fd=e,setTimeout(Pd,2)}Pd();var Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vo=Symbol.for("react.element"),zE=Symbol.for("react.portal"),WE=Symbol.for("react.fragment"),KE=Symbol.for("react.strict_mode"),GE=Symbol.for("react.profiler"),HE=Symbol.for("react.provider"),YE=Symbol.for("react.context"),VE=Symbol.for("react.forward_ref"),XE=Symbol.for("react.suspense"),qE=Symbol.for("react.memo"),JE=Symbol.for("react.lazy"),Bd=Symbol.iterator;function ZE(e){return e===null||typeof e!="object"?null:(e=Bd&&e[Bd]||e["@@iterator"],typeof e=="function"?e:null)}var Dd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$d=Object.assign,jd={};function vs(e,t,n){this.props=e,this.context=t,this.refs=jd,this.updater=n||Dd}vs.prototype.isReactComponent={},vs.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},vs.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function zd(){}zd.prototype=vs.prototype;function ou(e,t,n){this.props=e,this.context=t,this.refs=jd,this.updater=n||Dd}var au=ou.prototype=new zd;au.constructor=ou,$d(au,vs.prototype),au.isPureReactComponent=!0;var Wd=Array.isArray,Kd=Object.prototype.hasOwnProperty,cu={current:null},Gd={key:!0,ref:!0,__self:!0,__source:!0};function Hd(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)Kd.call(t,r)&&!Gd.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:vo,type:e,key:s,ref:o,props:i,_owner:cu.current}}function QE(e,t){return{$$typeof:vo,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function lu(e){return typeof e=="object"&&e!==null&&e.$$typeof===vo}function tw(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Yd=/\/+/g;function uu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?tw(""+e.key):t.toString(36)}function Fa(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case vo:case zE:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+uu(o,0):r,Wd(i)?(n="",e!=null&&(n=e.replace(Yd,"$&/")+"/"),Fa(i,t,n,"",function(l){return l})):i!=null&&(lu(i)&&(i=QE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Yd,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",Wd(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+uu(s,a);o+=Fa(s,t,n,c,i)}else if(c=ZE(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+uu(s,a++),o+=Fa(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Pa(e,t,n){if(e==null)return e;var r=[],i=0;return Fa(e,r,"","",function(s){return t.call(n,s,i++)}),r}function ew(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var pn={current:null},Ba={transition:null},nw={ReactCurrentDispatcher:pn,ReactCurrentBatchConfig:Ba,ReactCurrentOwner:cu};function Vd(){throw Error("act(...) is not supported in production builds of React.")}Yt.Children={map:Pa,forEach:function(e,t,n){Pa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Pa(e,function(){t++}),t},toArray:function(e){return Pa(e,function(t){return t})||[]},only:function(e){if(!lu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Yt.Component=vs,Yt.Fragment=WE,Yt.Profiler=GE,Yt.PureComponent=ou,Yt.StrictMode=KE,Yt.Suspense=XE,Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nw,Yt.act=Vd,Yt.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=$d({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=cu.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)Kd.call(t,c)&&!Gd.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:vo,type:e.type,key:i,ref:s,props:r,_owner:o}},Yt.createContext=function(e){return e={$$typeof:YE,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:HE,_context:e},e.Consumer=e},Yt.createElement=Hd,Yt.createFactory=function(e){var t=Hd.bind(null,e);return t.type=e,t},Yt.createRef=function(){return{current:null}},Yt.forwardRef=function(e){return{$$typeof:VE,render:e}},Yt.isValidElement=lu,Yt.lazy=function(e){return{$$typeof:JE,_payload:{_status:-1,_result:e},_init:ew}},Yt.memo=function(e,t){return{$$typeof:qE,type:e,compare:t===void 0?null:t}},Yt.startTransition=function(e){var t=Ba.transition;Ba.transition={};try{e()}finally{Ba.transition=t}},Yt.unstable_act=Vd,Yt.useCallback=function(e,t){return pn.current.useCallback(e,t)},Yt.useContext=function(e){return pn.current.useContext(e)},Yt.useDebugValue=function(){},Yt.useDeferredValue=function(e){return pn.current.useDeferredValue(e)},Yt.useEffect=function(e,t){return pn.current.useEffect(e,t)},Yt.useId=function(){return pn.current.useId()},Yt.useImperativeHandle=function(e,t,n){return pn.current.useImperativeHandle(e,t,n)},Yt.useInsertionEffect=function(e,t){return pn.current.useInsertionEffect(e,t)},Yt.useLayoutEffect=function(e,t){return pn.current.useLayoutEffect(e,t)},Yt.useMemo=function(e,t){return pn.current.useMemo(e,t)},Yt.useReducer=function(e,t,n){return pn.current.useReducer(e,t,n)},Yt.useRef=function(e){return pn.current.useRef(e)},Yt.useState=function(e){return pn.current.useState(e)},Yt.useSyncExternalStore=function(e,t,n){return pn.current.useSyncExternalStore(e,t,n)},Yt.useTransition=function(){return pn.current.useTransition()},Yt.version="18.3.1";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Xd="0123456789abcdef",qd=[],Da=[];for(let e=0;e<256;e++)qd[e]=Xd[e>>4&15]+Xd[e&15],e<16&&(e<10?Da[48+e]=e:Da[87+e]=e);const Jd=e=>{const t=e.length;let n="",r=0;for(;r<t;)n+=qd[e[r++]];return n},$a=e=>{const t=e.length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=Da[e.charCodeAt(s++)]<<4|Da[e.charCodeAt(s++)];return r};for(var Zd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",rw=typeof Uint8Array>"u"?[]:new Uint8Array(256),ja=0;ja<Zd.length;ja++)rw[Zd.charCodeAt(ja)]=ja;new TextDecoder,new TextEncoder;const Qd=typeof window<"u"?window:self,t0=Qd.crypto||Qd.msCrypto||{};t0.subtle||t0.webkitSubtle;const Ss=globalThis||void 0||self,dr=()=>new Map,hu=e=>{const t=dr();return e.forEach((n,r)=>{t.set(r,n)}),t},ki=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},iw=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},sw=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},Rs=()=>new Set,fu=e=>e[e.length-1],ow=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Yi=Array.from,aw=Array.isArray;class cw{constructor(){this._observers=dr()}on(t,n){return ki(this._observers,t,Rs).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Yi((this._observers.get(t)||dr()).values()).forEach(r=>r(...n))}destroy(){this._observers=dr()}}const Ti=Math.floor,za=Math.abs,e0=(e,t)=>e<t?e:t,Vi=(e,t)=>e>t?e:t,n0=e=>e!==0?e<0:1/e<0,r0=1,i0=2,du=4,pu=8,So=32,Qr=64,$n=128,Wa=31,mu=63,Xi=127,lw=2147483647,s0=Number.MAX_SAFE_INTEGER,uw=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ti(e)===e),hw=e=>e.toLowerCase(),fw=/^\s*/g,dw=e=>e.replace(fw,""),pw=/([A-Z])/g,o0=(e,t)=>dw(e.replace(pw,n=>`${t}${hw(n)}`)),mw=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Ro=typeof TextEncoder<"u"?new TextEncoder:null,gw=Ro?e=>Ro.encode(e):mw;let Io=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Io&&Io.decode(new Uint8Array).length===1&&(Io=null);class No{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Ka=()=>new No,yw=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Sr=e=>{const t=new Uint8Array(yw(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},_w=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Vi(n,t)*2),e.cpos=0)},Je=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},gu=Je,ne=(e,t)=>{for(;t>Xi;)Je(e,$n|Xi&t),t=Ti(t/128);Je(e,Xi&t)},yu=(e,t)=>{const n=n0(t);for(n&&(t=-t),Je(e,(t>mu?$n:0)|(n?Qr:0)|mu&t),t=Ti(t/64);t>0;)Je(e,(t>Xi?$n:0)|Xi&t),t=Ti(t/128)},_u=new Uint8Array(3e4),bw=_u.length/3,Ew=(e,t)=>{if(t.length<bw){const n=Ro.encodeInto(t,_u).written||0;ne(e,n);for(let r=0;r<n;r++)Je(e,_u[r])}else jn(e,gw(t))},ww=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;ne(e,r);for(let i=0;i<r;i++)Je(e,n.codePointAt(i))},Is=Ro&&Ro.encodeInto?Ew:ww,Ga=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=e0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Vi(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},jn=(e,t)=>{ne(e,t.byteLength),Ga(e,t)},bu=(e,t)=>{_w(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},xw=(e,t)=>bu(e,4).setFloat32(0,t,!1),kw=(e,t)=>bu(e,8).setFloat64(0,t,!1),Tw=(e,t)=>bu(e,8).setBigInt64(0,t,!1),a0=new DataView(new ArrayBuffer(4)),Aw=e=>(a0.setFloat32(0,e),a0.getFloat32(0)===e),Oo=(e,t)=>{switch(typeof t){case"string":Je(e,119),Is(e,t);break;case"number":uw(t)&&za(t)<=lw?(Je(e,125),yu(e,t)):Aw(t)?(Je(e,124),xw(e,t)):(Je(e,123),kw(e,t));break;case"bigint":Je(e,122),Tw(e,t);break;case"object":if(t===null)Je(e,126);else if(aw(t)){Je(e,117),ne(e,t.length);for(let n=0;n<t.length;n++)Oo(e,t[n])}else if(t instanceof Uint8Array)Je(e,116),jn(e,t);else{Je(e,118);const n=Object.keys(t);ne(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Is(e,i),Oo(e,t[i])}}break;case"boolean":Je(e,t?120:121);break;default:Je(e,127)}};class c0 extends No{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&ne(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const l0=e=>{e.count>0&&(yu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&ne(e.encoder,e.count-2))};class Ha{constructor(){this.encoder=new No,this.s=0,this.count=0}write(t){this.s===t?this.count++:(l0(this),this.count=1,this.s=t)}toUint8Array(){return l0(this),Sr(this.encoder)}}const u0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);yu(e.encoder,t),e.count>1&&ne(e.encoder,e.count-2)}};class Eu{constructor(){this.encoder=new No,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(u0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return u0(this),Sr(this.encoder)}}class vw{constructor(){this.sarr=[],this.s="",this.lensE=new Ha}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new No;return this.sarr.push(this.s),this.s="",Is(t,this.sarr.join("")),Ga(t,this.lensE.toUint8Array()),Sr(t)}}const Ai=e=>new Error(e),Rr=()=>{throw Ai("Method unimplemented")},Ir=()=>{throw Ai("Unexpected case")},h0=Ai("Unexpected end of array"),f0=Ai("Integer out of Range");class Ya{constructor(t){this.arr=t,this.pos=0}}const Ns=e=>new Ya(e),Sw=e=>e.pos!==e.arr.length,Rw=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},zn=e=>Rw(e,Kt(e)),Os=e=>e.arr[e.pos++],Kt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&Xi)*n,n*=128,i<$n)return t;if(t>s0)throw f0}throw h0},wu=e=>{let t=e.arr[e.pos++],n=t&mu,r=64;const i=(t&Qr)>0?-1:1;if(!(t&$n))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&Xi)*r,r*=128,t<$n)return i*n;if(n>s0)throw f0}throw h0},Cs=Io?e=>Io.decode(zn(e)):e=>{let t=Kt(e);if(t===0)return"";{let n=String.fromCodePoint(Os(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Os(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},xu=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Iw=[e=>{},e=>null,wu,e=>xu(e,4).getFloat32(0,!1),e=>xu(e,8).getFloat64(0,!1),e=>xu(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Cs,e=>{const t=Kt(e),n={};for(let r=0;r<t;r++){const i=Cs(e);n[i]=Co(e)}return n},e=>{const t=Kt(e),n=[];for(let r=0;r<t;r++)n.push(Co(e));return n},zn],Co=e=>Iw[127-Os(e)](e);class d0 extends Ya{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Sw(this)?this.count=Kt(this)+1:this.count=-1),this.count--,this.s}}class Va extends Ya{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=wu(this);const t=n0(this.s);this.count=1,t&&(this.s=-this.s,this.count=Kt(this)+2)}return this.count--,this.s}}class ku extends Ya{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=wu(this),n=t&1;this.diff=Ti(t/2),this.count=1,n&&(this.count=Kt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Nw{constructor(t){this.decoder=new Va(t),this.str=Cs(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Ow=crypto.getRandomValues.bind(crypto),p0=()=>Ow(new Uint32Array(1))[0],Cw="10000000-1000-4000-8000"+-1e11,Lw=()=>Cw.replace(/[018]/g,e=>(e^p0()&15>>e/4).toString(16)),m0=e=>new Promise(e);Promise.all.bind(Promise);var g0={},Xa={};Xa.byteLength=Fw,Xa.toByteArray=Bw,Xa.fromByteArray=jw;for(var Nr=[],qn=[],Mw=typeof Uint8Array<"u"?Uint8Array:Array,Tu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ls=0,Uw=Tu.length;Ls<Uw;++Ls)Nr[Ls]=Tu[Ls],qn[Tu.charCodeAt(Ls)]=Ls;qn[45]=62,qn[95]=63;function y0(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function Fw(e){var t=y0(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Pw(e,t,n){return(t+n)*3/4-n}function Bw(e){var t,n=y0(e),r=n[0],i=n[1],s=new Mw(Pw(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=qn[e.charCodeAt(c)]<<18|qn[e.charCodeAt(c+1)]<<12|qn[e.charCodeAt(c+2)]<<6|qn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=qn[e.charCodeAt(c)]<<2|qn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=qn[e.charCodeAt(c)]<<10|qn[e.charCodeAt(c+1)]<<4|qn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Dw(e){return Nr[e>>18&63]+Nr[e>>12&63]+Nr[e>>6&63]+Nr[e&63]}function $w(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Dw(r));return i.join("")}function jw(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push($w(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Nr[t>>2]+Nr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Nr[t>>10]+Nr[t>>4&63]+Nr[t<<2&63]+"=")),i.join("")}var Au={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Au.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=s*256+e[t+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+e[t+h],h+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(f?-1:1)*o*Math.pow(2,s-r)},Au.write=function(e,t,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,m=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=d/c:t+=d*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=a&255,f+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+f]=o&255,f+=p,o/=256,l-=8);e[n+f-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Xa,n=Au,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=M,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const v=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(v,g),v.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(v){if(v>i)throw new RangeError('The value "'+v+'" is invalid for option "size"');const g=new s(v);return Object.setPrototypeOf(g,u.prototype),g}function u(v,g,y){if(typeof v=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(v)}return h(v,g,y)}u.poolSize=8192;function h(v,g,y){if(typeof v=="string")return m(v,g);if(o.isView(v))return w(v);if(v==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof v);if(dt(v,o)||v&&dt(v.buffer,o)||typeof a<"u"&&(dt(v,a)||v&&dt(v.buffer,a)))return T(v,g,y);if(typeof v=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const N=v.valueOf&&v.valueOf();if(N!=null&&N!==v)return u.from(N,g,y);const $=A(v);if($)return $;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof v[Symbol.toPrimitive]=="function")return u.from(v[Symbol.toPrimitive]("string"),g,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof v)}u.from=function(v,g,y){return h(v,g,y)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(v){if(typeof v!="number")throw new TypeError('"size" argument must be of type number');if(v<0)throw new RangeError('The value "'+v+'" is invalid for option "size"')}function f(v,g,y){return d(v),v<=0?l(v):g!==void 0?typeof y=="string"?l(v).fill(g,y):l(v).fill(g):l(v)}u.alloc=function(v,g,y){return f(v,g,y)};function p(v){return d(v),l(v<0?0:I(v)|0)}u.allocUnsafe=function(v){return p(v)},u.allocUnsafeSlow=function(v){return p(v)};function m(v,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const y=S(v,g)|0;let N=l(y);const $=N.write(v,g);return $!==y&&(N=N.slice(0,$)),N}function E(v){const g=v.length<0?0:I(v.length)|0,y=l(g);for(let N=0;N<g;N+=1)y[N]=v[N]&255;return y}function w(v){if(dt(v,s)){const g=new s(v);return T(g.buffer,g.byteOffset,g.byteLength)}return E(v)}function T(v,g,y){if(g<0||v.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(v.byteLength<g+(y||0))throw new RangeError('"length" is outside of buffer bounds');let N;return g===void 0&&y===void 0?N=new s(v):y===void 0?N=new s(v,g):N=new s(v,g,y),Object.setPrototypeOf(N,u.prototype),N}function A(v){if(u.isBuffer(v)){const g=I(v.length)|0,y=l(g);return y.length===0||v.copy(y,0,0,g),y}if(v.length!==void 0)return typeof v.length!="number"||vt(v.length)?l(0):E(v);if(v.type==="Buffer"&&Array.isArray(v.data))return E(v.data)}function I(v){if(v>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return v|0}function M(v){return+v!=v&&(v=0),u.alloc(+v)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,y){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),dt(y,s)&&(y=u.from(y,y.offset,y.byteLength)),!u.isBuffer(g)||!u.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===y)return 0;let N=g.length,$=y.length;for(let Q=0,it=Math.min(N,$);Q<it;++Q)if(g[Q]!==y[Q]){N=g[Q],$=y[Q];break}return N<$?-1:$<N?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,y){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let N;if(y===void 0)for(y=0,N=0;N<g.length;++N)y+=g[N].length;const $=u.allocUnsafe(y);let Q=0;for(N=0;N<g.length;++N){let it=g[N];if(dt(it,s))Q+it.length>$.length?(u.isBuffer(it)||(it=u.from(it)),it.copy($,Q)):s.prototype.set.call($,it,Q);else if(u.isBuffer(it))it.copy($,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=it.length}return $};function S(v,g){if(u.isBuffer(v))return v.length;if(o.isView(v)||dt(v,o))return v.byteLength;if(typeof v!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof v);const y=v.length,N=arguments.length>2&&arguments[2]===!0;if(!N&&y===0)return 0;let $=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return ct(v).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return pt(v).length;default:if($)return N?-1:ct(v).length;g=(""+g).toLowerCase(),$=!0}}u.byteLength=S;function L(v,g,y){let N=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,g>>>=0,y<=g))return"";for(v||(v="utf8");;)switch(v){case"hex":return z(this,g,y);case"utf8":case"utf-8":return D(this,g,y);case"ascii":return ft(this,g,y);case"latin1":case"binary":return V(this,g,y);case"base64":return J(this,g,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Et(this,g,y);default:if(N)throw new TypeError("Unknown encoding: "+v);v=(v+"").toLowerCase(),N=!0}}u.prototype._isBuffer=!0;function B(v,g,y){const N=v[g];v[g]=v[y],v[y]=N}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<g;y+=2)B(this,y,y+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<g;y+=4)B(this,y,y+3),B(this,y+1,y+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<g;y+=8)B(this,y,y+7),B(this,y+1,y+6),B(this,y+2,y+5),B(this,y+3,y+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?D(this,0,g):L.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const y=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,y,N,$,Q){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(y===void 0&&(y=0),N===void 0&&(N=g?g.length:0),$===void 0&&($=0),Q===void 0&&(Q=this.length),y<0||N>g.length||$<0||Q>this.length)throw new RangeError("out of range index");if($>=Q&&y>=N)return 0;if($>=Q)return-1;if(y>=N)return 1;if(y>>>=0,N>>>=0,$>>>=0,Q>>>=0,this===g)return 0;let it=Q-$,Wt=N-y;const Te=Math.min(it,Wt),ge=this.slice($,Q),Ae=g.slice(y,N);for(let ce=0;ce<Te;++ce)if(ge[ce]!==Ae[ce]){it=ge[ce],Wt=Ae[ce];break}return it<Wt?-1:Wt<it?1:0};function O(v,g,y,N,$){if(v.length===0)return-1;if(typeof y=="string"?(N=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,vt(y)&&(y=$?0:v.length-1),y<0&&(y=v.length+y),y>=v.length){if($)return-1;y=v.length-1}else if(y<0)if($)y=0;else return-1;if(typeof g=="string"&&(g=u.from(g,N)),u.isBuffer(g))return g.length===0?-1:G(v,g,y,N,$);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?$?s.prototype.indexOf.call(v,g,y):s.prototype.lastIndexOf.call(v,g,y):G(v,[g],y,N,$);throw new TypeError("val must be string, number or Buffer")}function G(v,g,y,N,$){let Q=1,it=v.length,Wt=g.length;if(N!==void 0&&(N=String(N).toLowerCase(),N==="ucs2"||N==="ucs-2"||N==="utf16le"||N==="utf-16le")){if(v.length<2||g.length<2)return-1;Q=2,it/=2,Wt/=2,y/=2}function Te(Ae,ce){return Q===1?Ae[ce]:Ae.readUInt16BE(ce*Q)}let ge;if($){let Ae=-1;for(ge=y;ge<it;ge++)if(Te(v,ge)===Te(g,Ae===-1?0:ge-Ae)){if(Ae===-1&&(Ae=ge),ge-Ae+1===Wt)return Ae*Q}else Ae!==-1&&(ge-=ge-Ae),Ae=-1}else for(y+Wt>it&&(y=it-Wt),ge=y;ge>=0;ge--){let Ae=!0;for(let ce=0;ce<Wt;ce++)if(Te(v,ge+ce)!==Te(g,ce)){Ae=!1;break}if(Ae)return ge}return-1}u.prototype.includes=function(g,y,N){return this.indexOf(g,y,N)!==-1},u.prototype.indexOf=function(g,y,N){return O(this,g,y,N,!0)},u.prototype.lastIndexOf=function(g,y,N){return O(this,g,y,N,!1)};function et(v,g,y,N){y=Number(y)||0;const $=v.length-y;N?(N=Number(N),N>$&&(N=$)):N=$;const Q=g.length;N>Q/2&&(N=Q/2);let it;for(it=0;it<N;++it){const Wt=parseInt(g.substr(it*2,2),16);if(vt(Wt))return it;v[y+it]=Wt}return it}function C(v,g,y,N){return bt(ct(g,v.length-y),v,y,N)}function R(v,g,y,N){return bt(ht(g),v,y,N)}function b(v,g,y,N){return bt(pt(g),v,y,N)}function P(v,g,y,N){return bt(Z(g,v.length-y),v,y,N)}u.prototype.write=function(g,y,N,$){if(y===void 0)$="utf8",N=this.length,y=0;else if(N===void 0&&typeof y=="string")$=y,N=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(N)?(N=N>>>0,$===void 0&&($="utf8")):($=N,N=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Q=this.length-y;if((N===void 0||N>Q)&&(N=Q),g.length>0&&(N<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");$||($="utf8");let it=!1;for(;;)switch($){case"hex":return et(this,g,y,N);case"utf8":case"utf-8":return C(this,g,y,N);case"ascii":case"latin1":case"binary":return R(this,g,y,N);case"base64":return b(this,g,y,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,g,y,N);default:if(it)throw new TypeError("Unknown encoding: "+$);$=(""+$).toLowerCase(),it=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function J(v,g,y){return g===0&&y===v.length?t.fromByteArray(v):t.fromByteArray(v.slice(g,y))}function D(v,g,y){y=Math.min(v.length,y);const N=[];let $=g;for(;$<y;){const Q=v[$];let it=null,Wt=Q>239?4:Q>223?3:Q>191?2:1;if($+Wt<=y){let Te,ge,Ae,ce;switch(Wt){case 1:Q<128&&(it=Q);break;case 2:Te=v[$+1],(Te&192)===128&&(ce=(Q&31)<<6|Te&63,ce>127&&(it=ce));break;case 3:Te=v[$+1],ge=v[$+2],(Te&192)===128&&(ge&192)===128&&(ce=(Q&15)<<12|(Te&63)<<6|ge&63,ce>2047&&(ce<55296||ce>57343)&&(it=ce));break;case 4:Te=v[$+1],ge=v[$+2],Ae=v[$+3],(Te&192)===128&&(ge&192)===128&&(Ae&192)===128&&(ce=(Q&15)<<18|(Te&63)<<12|(ge&63)<<6|Ae&63,ce>65535&&ce<1114112&&(it=ce))}}it===null?(it=65533,Wt=1):it>65535&&(it-=65536,N.push(it>>>10&1023|55296),it=56320|it&1023),N.push(it),$+=Wt}return tt(N)}const st=4096;function tt(v){const g=v.length;if(g<=st)return String.fromCharCode.apply(String,v);let y="",N=0;for(;N<g;)y+=String.fromCharCode.apply(String,v.slice(N,N+=st));return y}function ft(v,g,y){let N="";y=Math.min(v.length,y);for(let $=g;$<y;++$)N+=String.fromCharCode(v[$]&127);return N}function V(v,g,y){let N="";y=Math.min(v.length,y);for(let $=g;$<y;++$)N+=String.fromCharCode(v[$]);return N}function z(v,g,y){const N=v.length;(!g||g<0)&&(g=0),(!y||y<0||y>N)&&(y=N);let $="";for(let Q=g;Q<y;++Q)$+=le[v[Q]];return $}function Et(v,g,y){const N=v.slice(g,y);let $="";for(let Q=0;Q<N.length-1;Q+=2)$+=String.fromCharCode(N[Q]+N[Q+1]*256);return $}u.prototype.slice=function(g,y){const N=this.length;g=~~g,y=y===void 0?N:~~y,g<0?(g+=N,g<0&&(g=0)):g>N&&(g=N),y<0?(y+=N,y<0&&(y=0)):y>N&&(y=N),y<g&&(y=g);const $=this.subarray(g,y);return Object.setPrototypeOf($,u.prototype),$};function at(v,g,y){if(v%1!==0||v<0)throw new RangeError("offset is not uint");if(v+g>y)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,y,N){g=g>>>0,y=y>>>0,N||at(g,y,this.length);let $=this[g],Q=1,it=0;for(;++it<y&&(Q*=256);)$+=this[g+it]*Q;return $},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,y,N){g=g>>>0,y=y>>>0,N||at(g,y,this.length);let $=this[g+--y],Q=1;for(;y>0&&(Q*=256);)$+=this[g+--y]*Q;return $},u.prototype.readUint8=u.prototype.readUInt8=function(g,y){return g=g>>>0,y||at(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,y){return g=g>>>0,y||at(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,y){return g=g>>>0,y||at(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,y){return g=g>>>0,y||at(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,y){return g=g>>>0,y||at(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=Pt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,Q=this[++g]+this[++g]*2**8+this[++g]*2**16+N*2**24;return BigInt($)+(BigInt(Q)<<BigInt(32))}),u.prototype.readBigUInt64BE=Pt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=y*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],Q=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+N;return(BigInt($)<<BigInt(32))+BigInt(Q)}),u.prototype.readIntLE=function(g,y,N){g=g>>>0,y=y>>>0,N||at(g,y,this.length);let $=this[g],Q=1,it=0;for(;++it<y&&(Q*=256);)$+=this[g+it]*Q;return Q*=128,$>=Q&&($-=Math.pow(2,8*y)),$},u.prototype.readIntBE=function(g,y,N){g=g>>>0,y=y>>>0,N||at(g,y,this.length);let $=y,Q=1,it=this[g+--$];for(;$>0&&(Q*=256);)it+=this[g+--$]*Q;return Q*=128,it>=Q&&(it-=Math.pow(2,8*y)),it},u.prototype.readInt8=function(g,y){return g=g>>>0,y||at(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,y){g=g>>>0,y||at(g,2,this.length);const N=this[g]|this[g+1]<<8;return N&32768?N|4294901760:N},u.prototype.readInt16BE=function(g,y){g=g>>>0,y||at(g,2,this.length);const N=this[g+1]|this[g]<<8;return N&32768?N|4294901760:N},u.prototype.readInt32LE=function(g,y){return g=g>>>0,y||at(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,y){return g=g>>>0,y||at(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=Pt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(N<<24);return(BigInt($)<<BigInt(32))+BigInt(y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=Pt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=(y<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt($)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+N)}),u.prototype.readFloatLE=function(g,y){return g=g>>>0,y||at(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,y){return g=g>>>0,y||at(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,y){return g=g>>>0,y||at(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,y){return g=g>>>0,y||at(g,8,this.length),n.read(this,g,!1,52,8)};function lt(v,g,y,N,$,Q){if(!u.isBuffer(v))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>$||g<Q)throw new RangeError('"value" argument is out of bounds');if(y+N>v.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,y,N,$){if(g=+g,y=y>>>0,N=N>>>0,!$){const Wt=Math.pow(2,8*N)-1;lt(this,g,y,N,Wt,0)}let Q=1,it=0;for(this[y]=g&255;++it<N&&(Q*=256);)this[y+it]=g/Q&255;return y+N},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,y,N,$){if(g=+g,y=y>>>0,N=N>>>0,!$){const Wt=Math.pow(2,8*N)-1;lt(this,g,y,N,Wt,0)}let Q=N-1,it=1;for(this[y+Q]=g&255;--Q>=0&&(it*=256);)this[y+Q]=g/it&255;return y+N},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,1,255,0),this[y]=g&255,y+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,65535,0),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,65535,0),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,4294967295,0),this[y+3]=g>>>24,this[y+2]=g>>>16,this[y+1]=g>>>8,this[y]=g&255,y+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,4294967295,0),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4};function Mt(v,g,y,N,$){ot(g,N,$,v,y,7);let Q=Number(g&BigInt(4294967295));v[y++]=Q,Q=Q>>8,v[y++]=Q,Q=Q>>8,v[y++]=Q,Q=Q>>8,v[y++]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return v[y++]=it,it=it>>8,v[y++]=it,it=it>>8,v[y++]=it,it=it>>8,v[y++]=it,y}function Xt(v,g,y,N,$){ot(g,N,$,v,y,7);let Q=Number(g&BigInt(4294967295));v[y+7]=Q,Q=Q>>8,v[y+6]=Q,Q=Q>>8,v[y+5]=Q,Q=Q>>8,v[y+4]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return v[y+3]=it,it=it>>8,v[y+2]=it,it=it>>8,v[y+1]=it,it=it>>8,v[y]=it,y+8}u.prototype.writeBigUInt64LE=Pt(function(g,y=0){return Mt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Pt(function(g,y=0){return Xt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,y,N,$){if(g=+g,y=y>>>0,!$){const Te=Math.pow(2,8*N-1);lt(this,g,y,N,Te-1,-Te)}let Q=0,it=1,Wt=0;for(this[y]=g&255;++Q<N&&(it*=256);)g<0&&Wt===0&&this[y+Q-1]!==0&&(Wt=1),this[y+Q]=(g/it>>0)-Wt&255;return y+N},u.prototype.writeIntBE=function(g,y,N,$){if(g=+g,y=y>>>0,!$){const Te=Math.pow(2,8*N-1);lt(this,g,y,N,Te-1,-Te)}let Q=N-1,it=1,Wt=0;for(this[y+Q]=g&255;--Q>=0&&(it*=256);)g<0&&Wt===0&&this[y+Q+1]!==0&&(Wt=1),this[y+Q]=(g/it>>0)-Wt&255;return y+N},u.prototype.writeInt8=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,1,127,-128),g<0&&(g=255+g+1),this[y]=g&255,y+1},u.prototype.writeInt16LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,32767,-32768),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeInt16BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,32767,-32768),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeInt32LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,2147483647,-2147483648),this[y]=g&255,this[y+1]=g>>>8,this[y+2]=g>>>16,this[y+3]=g>>>24,y+4},u.prototype.writeInt32BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4},u.prototype.writeBigInt64LE=Pt(function(g,y=0){return Mt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Pt(function(g,y=0){return Xt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ut(v,g,y,N,$,Q){if(y+N>v.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function Tt(v,g,y,N,$){return g=+g,y=y>>>0,$||Ut(v,g,y,4),n.write(v,g,y,N,23,4),y+4}u.prototype.writeFloatLE=function(g,y,N){return Tt(this,g,y,!0,N)},u.prototype.writeFloatBE=function(g,y,N){return Tt(this,g,y,!1,N)};function Dt(v,g,y,N,$){return g=+g,y=y>>>0,$||Ut(v,g,y,8),n.write(v,g,y,N,52,8),y+8}u.prototype.writeDoubleLE=function(g,y,N){return Dt(this,g,y,!0,N)},u.prototype.writeDoubleBE=function(g,y,N){return Dt(this,g,y,!1,N)},u.prototype.copy=function(g,y,N,$){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(N||(N=0),!$&&$!==0&&($=this.length),y>=g.length&&(y=g.length),y||(y=0),$>0&&$<N&&($=N),$===N||g.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("sourceEnd out of bounds");$>this.length&&($=this.length),g.length-y<$-N&&($=g.length-y+N);const Q=$-N;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,N,$):s.prototype.set.call(g,this.subarray(N,$),y),Q},u.prototype.fill=function(g,y,N,$){if(typeof g=="string"){if(typeof y=="string"?($=y,y=0,N=this.length):typeof N=="string"&&($=N,N=this.length),$!==void 0&&typeof $!="string")throw new TypeError("encoding must be a string");if(typeof $=="string"&&!u.isEncoding($))throw new TypeError("Unknown encoding: "+$);if(g.length===1){const it=g.charCodeAt(0);($==="utf8"&&it<128||$==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(y<0||this.length<y||this.length<N)throw new RangeError("Out of range index");if(N<=y)return this;y=y>>>0,N=N===void 0?this.length:N>>>0,g||(g=0);let Q;if(typeof g=="number")for(Q=y;Q<N;++Q)this[Q]=g;else{const it=u.isBuffer(g)?g:u.from(g,$),Wt=it.length;if(Wt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(Q=0;Q<N-y;++Q)this[Q+y]=it[Q%Wt]}return this};const Ft={};function ke(v,g,y){Ft[v]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${v}]`,this.stack,delete this.name}get code(){return v}set code($){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:$,writable:!0})}toString(){return`${this.name} [${v}]: ${this.message}`}}}ke("ERR_BUFFER_OUT_OF_BOUNDS",function(v){return v?`${v} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ke("ERR_INVALID_ARG_TYPE",function(v,g){return`The "${v}" argument must be of type number. Received type ${typeof g}`},TypeError),ke("ERR_OUT_OF_RANGE",function(v,g,y){let N=`The value of "${v}" is out of range.`,$=y;return Number.isInteger(y)&&Math.abs(y)>2**32?$=Oe(String(y)):typeof y=="bigint"&&($=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&($=Oe($)),$+="n"),N+=` It must be ${g}. Received ${$}`,N},RangeError);function Oe(v){let g="",y=v.length;const N=v[0]==="-"?1:0;for(;y>=N+4;y-=3)g=`_${v.slice(y-3,y)}${g}`;return`${v.slice(0,y)}${g}`}function x(v,g,y){nt(g,"offset"),(v[g]===void 0||v[g+y]===void 0)&&F(g,v.length-(y+1))}function ot(v,g,y,N,$,Q){if(v>y||v<g){const it=typeof g=="bigint"?"n":"";let Wt;throw g===0||g===BigInt(0)?Wt=`>= 0${it} and < 2${it} ** ${(Q+1)*8}${it}`:Wt=`>= -(2${it} ** ${(Q+1)*8-1}${it}) and < 2 ** ${(Q+1)*8-1}${it}`,new Ft.ERR_OUT_OF_RANGE("value",Wt,v)}x(N,$,Q)}function nt(v,g){if(typeof v!="number")throw new Ft.ERR_INVALID_ARG_TYPE(g,"number",v)}function F(v,g,y){throw Math.floor(v)!==v?(nt(v,y),new Ft.ERR_OUT_OF_RANGE("offset","an integer",v)):g<0?new Ft.ERR_BUFFER_OUT_OF_BOUNDS:new Ft.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,v)}const U=/[^+/0-9A-Za-z-_]/g;function H(v){if(v=v.split("=")[0],v=v.trim().replace(U,""),v.length<2)return"";for(;v.length%4!==0;)v=v+"=";return v}function ct(v,g){g=g||1/0;let y;const N=v.length;let $=null;const Q=[];for(let it=0;it<N;++it){if(y=v.charCodeAt(it),y>55295&&y<57344){if(!$){if(y>56319){(g-=3)>-1&&Q.push(239,191,189);continue}else if(it+1===N){(g-=3)>-1&&Q.push(239,191,189);continue}$=y;continue}if(y<56320){(g-=3)>-1&&Q.push(239,191,189),$=y;continue}y=($-55296<<10|y-56320)+65536}else $&&(g-=3)>-1&&Q.push(239,191,189);if($=null,y<128){if((g-=1)<0)break;Q.push(y)}else if(y<2048){if((g-=2)<0)break;Q.push(y>>6|192,y&63|128)}else if(y<65536){if((g-=3)<0)break;Q.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((g-=4)<0)break;Q.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return Q}function ht(v){const g=[];for(let y=0;y<v.length;++y)g.push(v.charCodeAt(y)&255);return g}function Z(v,g){let y,N,$;const Q=[];for(let it=0;it<v.length&&!((g-=2)<0);++it)y=v.charCodeAt(it),N=y>>8,$=y%256,Q.push($),Q.push(N);return Q}function pt(v){return t.toByteArray(H(v))}function bt(v,g,y,N){let $;for($=0;$<N&&!($+y>=g.length||$>=v.length);++$)g[$+y]=v[$];return $}function dt(v,g){return v instanceof g||v!=null&&v.constructor!=null&&v.constructor.name!=null&&v.constructor.name===g.name}function vt(v){return v!==v}const le=function(){const v="0123456789abcdef",g=new Array(256);for(let y=0;y<16;++y){const N=y*16;for(let $=0;$<16;++$)g[N+$]=v[y]+v[$]}return g}();function Pt(v){return typeof BigInt>"u"?Pn:v}function Pn(){throw new Error("BigInt not supported")}})(g0);const en=g0.Buffer;function zw(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _0={exports:{}},Le=_0.exports={},Or,Cr;function vu(){throw new Error("setTimeout has not been defined")}function Su(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Or=setTimeout:Or=vu}catch{Or=vu}try{typeof clearTimeout=="function"?Cr=clearTimeout:Cr=Su}catch{Cr=Su}})();function b0(e){if(Or===setTimeout)return setTimeout(e,0);if((Or===vu||!Or)&&setTimeout)return Or=setTimeout,setTimeout(e,0);try{return Or(e,0)}catch{try{return Or.call(null,e,0)}catch{return Or.call(this,e,0)}}}function Ww(e){if(Cr===clearTimeout)return clearTimeout(e);if((Cr===Su||!Cr)&&clearTimeout)return Cr=clearTimeout,clearTimeout(e);try{return Cr(e)}catch{try{return Cr.call(null,e)}catch{return Cr.call(this,e)}}}var ti=[],Ms=!1,qi,qa=-1;function Kw(){!Ms||!qi||(Ms=!1,qi.length?ti=qi.concat(ti):qa=-1,ti.length&&E0())}function E0(){if(!Ms){var e=b0(Kw);Ms=!0;for(var t=ti.length;t;){for(qi=ti,ti=[];++qa<t;)qi&&qi[qa].run();qa=-1,t=ti.length}qi=null,Ms=!1,Ww(e)}}Le.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ti.push(new w0(e,t)),ti.length===1&&!Ms&&b0(E0)};function w0(e,t){this.fun=e,this.array=t}w0.prototype.run=function(){this.fun.apply(null,this.array)},Le.title="browser",Le.browser=!0,Le.env={},Le.argv=[],Le.version="",Le.versions={};function ei(){}Le.on=ei,Le.addListener=ei,Le.once=ei,Le.off=ei,Le.removeListener=ei,Le.removeAllListeners=ei,Le.emit=ei,Le.prependListener=ei,Le.prependOnceListener=ei,Le.listeners=function(e){return[]},Le.binding=function(e){throw new Error("process.binding is not supported")},Le.cwd=function(){return"/"},Le.chdir=function(e){throw new Error("process.chdir is not supported")},Le.umask=function(){return 0};var Gw=_0.exports;const vi=zw(Gw),x0=e=>e===void 0?null:e;class Hw{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let k0=new Hw,Yw=!0;try{typeof localStorage<"u"&&localStorage&&(k0=localStorage,Yw=!1)}catch{}const Vw=k0,Xw=Object.assign,qw=Object.keys,Jw=(e,t)=>{for(const n in e)t(e[n],n)},T0=e=>qw(e).length,Zw=e=>{for(const t in e)return!1;return!0},Qw=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},tx=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),ex=(e,t)=>e===t||T0(e)===T0(t)&&Qw(e,(n,r)=>(n!==void 0||tx(t,r))&&t[r]===n),nx=Object.freeze,A0=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&A0(e[t])}return nx(e)},Ru=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Ru(e,t,n+1)}},rx=e=>e,ix=(e,t)=>t.includes(e);var v0={};const Lo=typeof vi<"u"&&vi.release&&/node|io\.js/.test(vi.release.name)&&Object.prototype.toString.call(typeof vi<"u"?vi:0)==="[object process]";let Lr;const sx=()=>{if(Lr===void 0)if(Lo){Lr=dr();const e=vi.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Lr.set(t,""),t=r):t!==null&&(Lr.set(t,r),t=null)}t!==null&&Lr.set(t,"")}else typeof location=="object"?(Lr=dr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Lr.set(`--${o0(t,"-")}`,n),Lr.set(`-${o0(t,"-")}`,n)}})):Lr=dr();return Lr},Iu=e=>sx().has(e),Ja=e=>x0(Lo?v0[e.toUpperCase().replaceAll("-","_")]:Vw.getItem(e)),S0=e=>Iu("--"+e)||Ja(e)!==null;S0("production");const ox=Lo&&ix(v0.FORCE_COLOR,["true","1","2"])||!Iu("--no-colors")&&!S0("no-color")&&(!Lo||vi.stdout.isTTY)&&(!Lo||Iu("--color")||Ja("COLORTERM")!==null||(Ja("TERM")||"").includes("color")),ax=e=>new Uint8Array(e),cx=e=>{const t=ax(e.byteLength);return t.set(e),t};class lx{constructor(t,n){this.left=t,this.right=n}}const ni=(e,t)=>new lx(e,t);typeof DOMParser<"u"&&new DOMParser;const ux=e=>iw(e,(t,n)=>`${n}:${t};`).join(""),ri=Symbol,R0=ri(),I0=ri(),hx=ri(),fx=ri(),dx=ri(),N0=ri(),px=ri(),Nu=ri(),mx=ri(),gx=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},yx={[R0]:ni("font-weight","bold"),[I0]:ni("font-weight","normal"),[hx]:ni("color","blue"),[dx]:ni("color","green"),[fx]:ni("color","grey"),[N0]:ni("color","red"),[px]:ni("color","purple"),[Nu]:ni("color","orange"),[mx]:ni("color","black")},O0=ox?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=dr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=yx[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=ux(r);s>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:gx,_x=(...e)=>{console.log(...O0(e)),C0.forEach(t=>t.print(e))},bx=(...e)=>{console.warn(...O0(e)),e.unshift(Nu),C0.forEach(t=>t.print(e))},C0=Rs(),L0=e=>({[Symbol.iterator](){return this},next:e}),Ex=(e,t)=>L0(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Ou=(e,t)=>L0(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Cu{constructor(t,n){this.clock=t,this.len=n}}class Mo{constructor(){this.clients=new Map}}const M0=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];q0(e,s,a.clock,a.len,n)}}),wx=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Ti((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},U0=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&wx(n,t.clock)!==null},Lu=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=Vi(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},xx=e=>{const t=new Mo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)ow(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Lu(t),t},Za=(e,t,n,r)=>{ki(e.clients,t,()=>[]).push(new Cu(n,r))},kx=()=>new Mo,Tx=e=>{const t=kx();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Cu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Us=(e,t)=>{ne(e.restEncoder,t.clients.size),Yi(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),ne(e.restEncoder,n);const i=r.length;ne(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Mu=e=>{const t=new Mo,n=Kt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Kt(e.restDecoder),s=Kt(e.restDecoder);if(s>0){const o=ki(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Cu(e.readDsClock(),e.readDsLen()))}}return t},F0=(e,t,n)=>{const r=new Mo,i=Kt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Kt(e.restDecoder),a=Kt(e.restDecoder),c=n.clients.get(o)||[],l=Ze(n,o);for(let u=0;u<a;u++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<l){l<d&&Za(r,o,l,d-l);let f=Mr(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,fc(t,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,fc(t,p,d-p.id.clock)),p.delete(t))}else Za(r,o,h,d-h)}}if(r.clients.size>0){const s=new Ji;return ne(s.restEncoder,0),Us(s,r),s.toUint8Array()}return null},P0=p0;class Fs extends cw{constructor({guid:t=Lw(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=P0(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Y0,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=m0(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>m0(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&he(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Yi(this.subdocs).map(t=>t.guid))}transact(t,n=null){return he(this,t,n)}get(t,n=nn){const r=ki(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==nn&&i!==n)if(i===nn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,$s)}getText(t=""){return this.get(t,ii)}getMap(t=""){return this.get(t,js)}getXmlElement(t=""){return this.get(t,Ws)}getXmlFragment(t=""){return this.get(t,Zi)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Yi(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Fs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,he(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class B0{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Kt(this.restDecoder)}readDsLen(){return Kt(this.restDecoder)}}class D0 extends B0{readLeftID(){return qt(Kt(this.restDecoder),Kt(this.restDecoder))}readRightID(){return qt(Kt(this.restDecoder),Kt(this.restDecoder))}readClient(){return Kt(this.restDecoder)}readInfo(){return Os(this.restDecoder)}readString(){return Cs(this.restDecoder)}readParentInfo(){return Kt(this.restDecoder)===1}readTypeRef(){return Kt(this.restDecoder)}readLen(){return Kt(this.restDecoder)}readAny(){return Co(this.restDecoder)}readBuf(){return cx(zn(this.restDecoder))}readJSON(){return JSON.parse(Cs(this.restDecoder))}readKey(){return Cs(this.restDecoder)}}class Ax{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Kt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Kt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Ps extends Ax{constructor(t){super(t),this.keys=[],Kt(t),this.keyClockDecoder=new ku(zn(t)),this.clientDecoder=new Va(zn(t)),this.leftClockDecoder=new ku(zn(t)),this.rightClockDecoder=new ku(zn(t)),this.infoDecoder=new d0(zn(t),Os),this.stringDecoder=new Nw(zn(t)),this.parentInfoDecoder=new d0(zn(t),Os),this.typeRefDecoder=new Va(zn(t)),this.lenDecoder=new Va(zn(t))}readLeftID(){return new Bs(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Bs(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Co(this.restDecoder)}readBuf(){return zn(this.restDecoder)}readJSON(){return Co(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class vx{constructor(){this.restEncoder=Ka()}toUint8Array(){return Sr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){ne(this.restEncoder,t)}writeDsLen(t){ne(this.restEncoder,t)}}class Uo extends vx{writeLeftID(t){ne(this.restEncoder,t.client),ne(this.restEncoder,t.clock)}writeRightID(t){ne(this.restEncoder,t.client),ne(this.restEncoder,t.clock)}writeClient(t){ne(this.restEncoder,t)}writeInfo(t){gu(this.restEncoder,t)}writeString(t){Is(this.restEncoder,t)}writeParentInfo(t){ne(this.restEncoder,t?1:0)}writeTypeRef(t){ne(this.restEncoder,t)}writeLen(t){ne(this.restEncoder,t)}writeAny(t){Oo(this.restEncoder,t)}writeBuf(t){jn(this.restEncoder,t)}writeJSON(t){Is(this.restEncoder,JSON.stringify(t))}writeKey(t){Is(this.restEncoder,t)}}class Sx{constructor(){this.restEncoder=Ka(),this.dsCurrVal=0}toUint8Array(){return Sr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,ne(this.restEncoder,n)}writeDsLen(t){t===0&&Ir(),ne(this.restEncoder,t-1),this.dsCurrVal+=t}}class Ji extends Sx{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Eu,this.clientEncoder=new Ha,this.leftClockEncoder=new Eu,this.rightClockEncoder=new Eu,this.infoEncoder=new c0(gu),this.stringEncoder=new vw,this.parentInfoEncoder=new c0(gu),this.typeRefEncoder=new Ha,this.lenEncoder=new Ha}toUint8Array(){const t=Ka();return ne(t,0),jn(t,this.keyClockEncoder.toUint8Array()),jn(t,this.clientEncoder.toUint8Array()),jn(t,this.leftClockEncoder.toUint8Array()),jn(t,this.rightClockEncoder.toUint8Array()),jn(t,Sr(this.infoEncoder)),jn(t,this.stringEncoder.toUint8Array()),jn(t,Sr(this.parentInfoEncoder)),jn(t,this.typeRefEncoder.toUint8Array()),jn(t,this.lenEncoder.toUint8Array()),Ga(t,Sr(this.restEncoder)),Sr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Oo(this.restEncoder,t)}writeBuf(t){jn(this.restEncoder,t)}writeJSON(t){Oo(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Rx=(e,t,n,r)=>{r=Vi(r,t[0].id.clock);const i=Mr(t,r);ne(e.restEncoder,t.length-i),e.writeClient(n),ne(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},Uu=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{Ze(t,s)>i&&r.set(s,i)}),Pu(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),ne(e.restEncoder,r.size),Yi(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Rx(e,t.clients.get(i),i,s)})},Ix=(e,t)=>{const n=dr(),r=Kt(e.restDecoder);for(let i=0;i<r;i++){const s=Kt(e.restDecoder),o=new Array(s),a=e.readClient();let c=Kt(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(Wa&u){case 0:{const h=e.readLen();o[l]=new Jn(qt(a,c),h),c+=h;break}case 10:{const h=Kt(e.restDecoder);o[l]=new Zn(qt(a,c),h),c+=h;break}default:{const h=(u&(Qr|$n))===0,d=new Ke(qt(a,c),null,(u&$n)===$n?e.readLeftID():null,null,(u&Qr)===Qr?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(u&So)===So?e.readString():null,wp(e,u));o[l]=d,c+=d.length}}}}return n},Nx=(e,t,n)=>{const r=[];let i=Yi(n.keys()).sort((f,p)=>f-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=n.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=n.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new Y0,c=new Map,l=(f,p)=>{const m=c.get(f);(m==null||m>p)&&c.set(f,p)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[f]),i=i.filter(E=>E!==p)}r.length=0};for(;;){if(u.constructor!==Zn){const p=ki(h,u.id.client,()=>Ze(t,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(e,t);if(m!==null){r.push(u);const E=n.get(m)||{refs:[],i:0};if(E.refs.length===E.i)l(m,Ze(t,m)),d();else{u=E.refs[E.i++];continue}}else(p===0||p<u.length)&&(u.integrate(e,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new Ji;return Uu(f,a,new Map),ne(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},Ox=(e,t)=>Uu(e,t.doc.store,t.beforeState),Cx=(e,t,n,r=new Ps(e))=>he(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=Ix(r,o),l=Nx(i,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<Ze(a,d)){s=!0;break}if(l){for(const[d,f]of l.missing){const p=u.missing.get(d);(p==null||p>f)&&u.missing.set(d,f)}u.update=ec([u.update,l.update])}}else a.pendingStructs=l;const h=F0(r,i,a);if(a.pendingDs){const d=new Ps(Ns(a.pendingDs));Kt(d.restDecoder);const f=F0(d,i,a);h&&f?a.pendingDs=ec([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,$0(i.doc,d)}},n,!1),$0=(e,t,n,r=Ps)=>{const i=Ns(t);Cx(i,e,n,new r(i))},j0=(e,t,n)=>$0(e,t,n,D0),Lx=(e,t,n=new Map)=>{Uu(e,t.store,n),Us(e,Tx(t.store))},Mx=(e,t=new Uint8Array([0]),n=new Ji)=>{const r=z0(t);Lx(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Hx(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===Uo)return Kx(i.map((s,o)=>o===0?s:Vx(s)));if(n.constructor===Ji)return ec(i)}return i[0]},Ux=(e,t)=>Mx(e,t,new Uo),Fx=e=>{const t=new Map,n=Kt(e.restDecoder);for(let r=0;r<n;r++){const i=Kt(e.restDecoder),s=Kt(e.restDecoder);t.set(i,s)}return t},z0=e=>Fx(new B0(Ns(e)));class Px{constructor(){this.l=[]}}const W0=()=>new Px,K0=(e,t)=>e.l.push(t),G0=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},H0=(e,t,n)=>Ru(e.l,[t,n]);class Bs{constructor(t,n){this.client=t,this.clock=n}}const Qa=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,qt=(e,t)=>new Bs(e,t),Bx=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Ir()},Ds=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!U0(t.ds,e.id),Fu=(e,t)=>{const n=ki(e.meta,Fu,Rs),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<Ze(r,s)&&Si(e,qt(s,i))}),M0(e,t.ds,i=>{}),n.add(t))};class Y0{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Pu=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},Ze=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},V0=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Ir()}n.push(t)},Mr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Ti(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Ti((n+r)/2)}throw Ir()},Bu=(e,t)=>{const n=e.clients.get(t.client);return n[Mr(n,t.clock)]},Du=(e,t,n)=>{const r=Mr(t,n),i=t[r];return i.id.clock<n&&i instanceof Ke?(t.splice(r+1,0,fc(e,i,n-i.id.clock)),r+1):r},Si=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Du(e,n,t.clock)]},X0=(e,t,n)=>{const r=t.clients.get(n.client),i=Mr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Jn&&r.splice(i+1,0,fc(e,s,n.clock-s.id.clock+1)),s},Dx=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Mr(r,t.id.clock)]=n},q0=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Du(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Du(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class $x{constructor(t,n,r){this.doc=t,this.deleteSet=new Mo,this.beforeState=Pu(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const J0=(e,t)=>t.deleteSet.clients.size===0&&!sw(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Lu(t.deleteSet),Ox(e,t),Us(e,t.deleteSet),!0),Z0=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&ki(e.changed,t,Rs).add(n)},tc=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ke&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},jx=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Mr(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof Ke&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},zx=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=e0(i.length-1,1+Mr(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+tc(i,c)}})},Q0=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Lu(s),n.afterState=Pu(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),H0(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Ru(a,[]),n._needFormattingCleanup&&ck(n)}finally{r.gc&&jx(s,i,r.gcFilter),zx(s,i),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=i.clients.get(h),p=Vi(Mr(f,d),1);for(let m=f.length-1;m>=p;)m-=1+tc(f,m)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=i.clients.get(h),p=Mr(f,d);p+1<f.length&&tc(f,p+1)>1||p>0&&tc(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(_x(Nu,R0,"[yjs] ",I0,N0,"Changed the client-id because another client seems to be using it."),r.clientID=P0()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Uo;J0(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Ji;J0(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Q0(e,t+1)}}},he=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new $x(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Q0(i,0)}}return o};function*Wx(e){const t=Kt(e.restDecoder);for(let n=0;n<t;n++){const r=Kt(e.restDecoder),i=e.readClient();let s=Kt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Kt(e.restDecoder);yield new Zn(qt(i,s),c),s+=c}else if(Wa&a){const c=(a&(Qr|$n))===0,l=new Ke(qt(i,s),null,(a&$n)===$n?e.readLeftID():null,null,(a&Qr)===Qr?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&So)===So?e.readString():null,wp(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new Jn(qt(i,s),c),s+=c}}}}class $u{constructor(t,n){this.gen=Wx(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Zn);return this.curr}}class ju{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Kx=e=>ec(e,D0,Uo),Gx=(e,t)=>{if(e.constructor===Jn){const{client:n,clock:r}=e.id;return new Jn(qt(n,r+t),e.length-t)}else if(e.constructor===Zn){const{client:n,clock:r}=e.id;return new Zn(qt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new Ke(qt(r,i+t),null,qt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},ec=(e,t=Ps,n=Ji)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Ns(u)));let i=r.map(u=>new $u(u,!0)),s=null;const o=new n,a=new ju(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===Zn?1:-1:p}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Ri(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===Zn)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Ri(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Zn(qt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===Zn?s.struct.length-=p:d=Gx(d,p)),s.struct.mergeWith(d)||(Ri(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==Zn;d=u.next())Ri(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Ri(a,s.struct,s.offset),s=null),zu(a);const c=r.map(u=>Mu(u)),l=xx(c);return Us(o,l),o.toUint8Array()},Hx=(e,t,n=Ps,r=Ji)=>{const i=z0(t),s=new r,o=new ju(s),a=new n(Ns(e)),c=new $u(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=i.get(h)||0;if(c.curr.constructor===Zn){c.next();continue}if(u.id.clock+u.length>d)for(Ri(o,u,Vi(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Ri(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}zu(o);const l=Mu(a);return Us(s,l),s.toUint8Array()},tp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Sr(e.encoder.restEncoder)}),e.encoder.restEncoder=Ka(),e.written=0)},Ri=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&tp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),ne(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},zu=e=>{tp(e);const t=e.encoder.restEncoder;ne(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];ne(t,r.written),Ga(t,r.restEncoder)}},Yx=(e,t,n,r)=>{const i=new n(Ns(e)),s=new $u(i,!1),o=new r,a=new ju(o);for(let l=s.curr;l!==null;l=s.next())Ri(a,t(l),0);zu(a);const c=Mu(i);return Us(o,c),o.toUint8Array()},Vx=e=>Yx(e,rx,Ps,Uo),ep="You must not compute changes after the event-handler fired.";class nc{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Xx(this.currentTarget,this.target))}deletes(t){return U0(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ai(ep);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=fu(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=fu(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=fu(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ai(ep);const n=this.target,r=Rs(),i=Rs(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const Xx=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},un=()=>{bx("Invalid access: Add Yjs type to a document before reading data.")},np=80;let Wu=0;class qx{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Wu++}}const Jx=e=>{e.timestamp=Wu++},rp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Wu++},Zx=(e,t,n)=>{if(e.length>=np){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return rp(r,t,n),r}else{const r=new qx(t,n);return e.push(r),r}},rc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>za(t-s.index)<za(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Jx(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&za(n.index-i)<r.parent.length/np?(rp(n,r,i),n):Zx(e._searchMarker,r,i)},Fo=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=Vi(t,i.index+n))}},ic=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;ki(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;H0(r._eH,n,t)};class nn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=W0(),this._dEH=W0(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Rr()}clone(){throw Rr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){K0(this._eH,t)}observeDeep(t){K0(this._dEH,t)}unobserve(t){G0(this._eH,t)}unobserveDeep(t){G0(this._dEH,t)}toJSON(){}}const ip=(e,t,n)=>{e.doc??un(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},sp=e=>{e.doc??un();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Po=(e,t)=>{let n=0,r=e._start;for(e.doc??un();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},op=(e,t)=>{const n=[];return Po(e,(r,i)=>{n.push(t(r,i,e))}),n},Qx=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},ap=(e,t)=>{e.doc??un();const n=rc(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},sc=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Ke(qt(o,Ze(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ts(l)),i.integrate(e,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new Ke(qt(o,Ze(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Bo(new Uint8Array(h))),i.integrate(e,0);break;case Fs:i=new Ke(qt(o,Ze(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new $o(h)),i.integrate(e,0);break;default:if(h instanceof nn)i=new Ke(qt(o,Ze(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new si(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},cp=()=>Ai("Length exceeded!"),lp=(e,t,n,r)=>{if(n>t._length)throw cp();if(n===0)return t._searchMarker&&Fo(t._searchMarker,n,r.length),sc(e,t,null,r);const i=n,s=rc(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Si(e,qt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Fo(t._searchMarker,i,r.length),sc(e,t,o,r)},tk=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return sc(e,t,i,n)},up=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=rc(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Si(e,qt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Si(e,qt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw cp();t._searchMarker&&Fo(t._searchMarker,i,-s+r)},oc=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Ku=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new ts([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ts([r]);break;case Uint8Array:a=new Bo(r);break;case Fs:a=new $o(r);break;default:if(r instanceof nn)a=new si(r);else throw new Error("Unexpected content type")}new Ke(qt(o,Ze(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},Gu=(e,t)=>{e.doc??un();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},hp=e=>{const t={};return e.doc??un(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},fp=(e,t)=>{e.doc??un();const n=e._map.get(t);return n!==void 0&&!n.deleted},ek=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Ds(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},ac=e=>(e.doc??un(),Ex(e._map.entries(),t=>!t[1].deleted));class nk extends nc{}class $s extends nn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new $s;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $s}clone(){const t=new $s;return t.insert(0,this.toArray().map(n=>n instanceof nn?n.clone():n)),t}get length(){return this.doc??un(),this._length}_callObserver(t,n){super._callObserver(t,n),ic(this,t,new nk(this,t))}insert(t,n){this.doc!==null?he(this.doc,r=>{lp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?he(this.doc,n=>{tk(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?he(this.doc,r=>{up(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return ap(this,t)}toArray(){return sp(this)}slice(t=0,n=this.length){return ip(this,t,n)}toJSON(){return this.map(t=>t instanceof nn?t.toJSON():t)}map(t){return op(this,t)}forEach(t){Po(this,t)}[Symbol.iterator](){return Qx(this)}_write(t){t.writeTypeRef(Sk)}}const rk=e=>new $s;class ik extends nc{constructor(t,n,r){super(t,n),this.keysChanged=r}}class js extends nn{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new js}clone(){const t=new js;return this.forEach((n,r)=>{t.set(r,n instanceof nn?n.clone():n)}),t}_callObserver(t,n){ic(this,t,new ik(this,t,n))}toJSON(){this.doc??un();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof nn?i.toJSON():i}}),t}get size(){return[...ac(this)].length}keys(){return Ou(ac(this),t=>t[0])}values(){return Ou(ac(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Ou(ac(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??un(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?he(this.doc,n=>{oc(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?he(this.doc,r=>{Ku(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Gu(this,t)}has(t){return fp(this,t)}clear(){this.doc!==null?he(this.doc,t=>{this.forEach(function(n,r,i){oc(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Rk)}}const sk=e=>new js,Ii=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&ex(e,t);class Hu{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Ir(),this.right.content.constructor){case We:this.right.deleted||zs(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const dp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case We:t.right.deleted||zs(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Si(e,qt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},cc=(e,t,n,r)=>{const i=new Map,s=r?rc(t,n):null;if(s){const o=new Hu(s.p.left,s.p,s.index,i);return dp(e,o,n-s.index)}else{const o=new Hu(null,t._start,0,i);return dp(e,o,n)}},pp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===We&&Ii(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Ke(qt(s,Ze(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new We(a,o));u.integrate(e,0),n.right=u,n.forward()})},zs=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},mp=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===We&&Ii(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},gp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Ii(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new Ke(qt(s,Ze(i.store,s)),u,u&&u.lastId,h,h&&h.id,t,null,new We(a,c)),n.right.integrate(e,0),n.forward()}}return o},Yu=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=e.doc,o=s.clientID;mp(n,i);const a=gp(e,t,n,i),c=r.constructor===String?new Ur(r):r instanceof nn?new si(r):new Qi(r);let{left:l,right:u,index:h}=n;t._searchMarker&&Fo(t._searchMarker,n.index,c.getLength()),u=new Ke(qt(o,Ze(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=h,n.forward(),pp(e,t,n,a)},yp=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;mp(n,i);const a=gp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===We));){if(!n.right.deleted)switch(n.right.content.constructor){case We:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(Ii(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Si(e,qt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Ke(qt(o,Ze(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Ur(c)),n.right.integrate(e,0),n.forward()}pp(e,t,n,a)},_p=(e,t,n,r,i)=>{let s=t;const o=dr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===We){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case We:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(t.delete(e),a++,!c&&(i.get(u)??null)===h&&d!==h&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&zs(i,l);break}}}t=t.right}return a},ok=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===We){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},ak=e=>{let t=0;return he(e.doc,n=>{let r=e._start,i=e._start,s=dr();const o=hu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case We:zs(o,i.content);break;default:t+=_p(n,r,i,s,o),s=hu(o),r=i;break}i=i.right}}),t},ck=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&q0(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===We&&o.constructor!==Jn&&t.add(o.parent)})}he(n,r=>{M0(e,e.deleteSet,i=>{if(i instanceof Jn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===We?t.add(s):ok(r,i)});for(const i of t)ak(i)})},bp=(e,t,n)=>{const r=n,i=hu(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case si:case Qi:case Ur:n<t.right.length&&Si(e,qt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&_p(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Fo(o._searchMarker,t.index,-r+n),t};class lk extends nc{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];he(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},i.size>0&&(f.attributes={},i.forEach((p,m)=>{p!==null&&(f.attributes[m]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},Zw(c)||(f.attributes=Xw({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case si:case Qi:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Ur:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case We:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(f)??null;Ii(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),Ii(p,s.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){s.set(f,p);const m=i.get(f)??null;Ii(m,p)||(a==="retain"&&d(),c[f]=m)}else if(!o.deleted){s.set(f,p);const m=c[f];m!==void 0&&(Ii(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),zs(i,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class ii extends nn{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??un(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new ii}clone(){const t=new ii;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new lk(this,t,n);ic(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??un();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Ur&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?he(this.doc,r=>{const i=new Hu(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Yu(r,this,i,a,o.attributes||{})}else o.retain!==void 0?yp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&bp(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??un();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;s.forEach((p,m)=>{d=!0,h[m]=p});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const u=()=>{for(;c!==null;){if(Ds(c,t)||n!==void 0&&Ds(c,n))switch(c.content.constructor){case Ur:{const h=s.get("ychange");t!==void 0&&!Ds(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Ds(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case si:case Qi:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,p)=>{d[p]=f})}i.push(h);break}case We:Ds(c,t)&&(l(),zs(s,c.content));break}c=c.right}l()};return t||n?he(o,h=>{t&&Fu(h,t),n&&Fu(h,n),u()},"cleanup"):u(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?he(i,s=>{const o=cc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Yu(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?he(i,s=>{const o=cc(s,this,t,!r);Yu(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?he(r,i=>{bp(i,cc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?he(i,s=>{const o=cc(s,this,t,!1);o.right!==null&&yp(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?he(this.doc,n=>{oc(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?he(this.doc,r=>{Ku(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Gu(this,t)}getAttributes(){return hp(this)}_write(t){t.writeTypeRef(Ik)}}const uk=e=>new ii;class Vu{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??un()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Ws||n.constructor===Zi)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Zi extends nn{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Zi}clone(){const t=new Zi;return t.insert(0,this.toArray().map(n=>n instanceof nn?n.clone():n)),t}get length(){return this.doc??un(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Vu(this,t)}querySelector(t){t=t.toUpperCase();const r=new Vu(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Yi(new Vu(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){ic(this,t,new dk(this,n,t))}toString(){return op(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Po(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?he(this.doc,r=>{lp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)he(this.doc,r=>{const i=t&&t instanceof nn?t._item:t;sc(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Ai("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?he(this.doc,r=>{up(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return sp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return ap(this,t)}slice(t=0,n=this.length){return ip(this,t,n)}forEach(t){Po(this,t)}_write(t){t.writeTypeRef(Ok)}}const hk=e=>new Zi;class Ws extends Zi{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Ws(this.nodeName)}clone(){const t=new Ws(this.nodeName),n=this.getAttributes();return Jw(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof nn?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?he(this.doc,n=>{oc(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?he(this.doc,r=>{Ku(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Gu(this,t)}hasAttribute(t){return fp(this,t)}getAttributes(t){return t?ek(this,t):hp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Po(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(Nk),t.writeKey(this.nodeName)}}const fk=e=>new Ws(e.readKey());class dk extends nc{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class lc extends js{constructor(t){super(),this.hookName=t}_copy(){return new lc(this.hookName)}clone(){const t=new lc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Ck),t.writeKey(this.hookName)}}const pk=e=>new lc(e.readKey());class uc extends ii{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new uc}clone(){const t=new uc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Lk)}}const mk=e=>new uc;class Xu{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Rr()}mergeWith(t){return!1}write(t,n,r){throw Rr()}integrate(t,n){throw Rr()}}const gk=0;class Jn extends Xu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),V0(t.doc.store,this)}write(t,n){t.writeInfo(gk),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Bo{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Bo(this.content)}splice(t){throw Rr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const yk=e=>new Bo(e.readBuf());class Do{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Do(this.len)}splice(t){const n=new Do(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Za(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const _k=e=>new Do(e.readLen()),Ep=(e,t)=>new Fs({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class $o{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new $o(Ep(this.doc.guid,this.opts))}splice(t){throw Rr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const bk=e=>new $o(Ep(e.readString(),e.readAny()));class Qi{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Qi(this.embed)}splice(t){throw Rr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Ek=e=>new Qi(e.readJSON());class We{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new We(this.key,this.value)}splice(t){throw Rr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const wk=e=>new We(e.readKey(),e.readJSON());class hc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new hc(this.arr)}splice(t){const n=new hc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const xk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new hc(n)},kk=Ja("node_env")==="development";class ts{constructor(t){this.arr=t,kk&&A0(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ts(this.arr)}splice(t){const n=new ts(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const Tk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new ts(n)};class Ur{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ur(this.str)}splice(t){const n=new Ur(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Ak=e=>new Ur(e.readString()),vk=[rk,sk,uk,fk,hk,pk,mk],Sk=0,Rk=1,Ik=2,Nk=3,Ok=4,Ck=5,Lk=6;class si{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new si(this.type._copy())}splice(t){throw Rr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Mk=e=>new si(vk[e.readTypeRef()](e)),fc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new Ke(qt(r,i+n),t,qt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=qt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class Ke extends Xu{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?i0:0}set marker(t){(this.info&pu)>0!==t&&(this.info^=pu)}get marker(){return(this.info&pu)>0}get keep(){return(this.info&r0)>0}set keep(t){this.keep!==t&&(this.info^=r0)}get countable(){return(this.info&i0)>0}get deleted(){return(this.info&du)>0}set deleted(t){this.deleted!==t&&(this.info^=du)}markDeleted(){this.info|=du}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Ze(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Ze(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Bs&&this.id.client!==this.parent.client&&this.parent.clock>=Ze(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=X0(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Si(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Jn||this.right&&this.right.constructor===Jn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ke?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Ke&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Bs){const r=Bu(n,this.parent);r.constructor===Jn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=X0(t,t.doc.store,qt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Qa(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Qa(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Bu(t.doc.store,i.origin)))s.has(Bu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),V0(t.doc.store,this),this.content.integrate(t,this),Z0(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Jn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:qt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Qa(t.origin,this.lastId)&&this.right===t&&Qa(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Za(t.deleteSet,this.id.client,this.id.clock,this.length),Z0(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Ir();this.content.gc(t),n?Dx(t,this,new Jn(this.id,this.length)):this.content=new Do(this.length)}write(t,n){const r=n>0?qt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Wa|(r===null?0:$n)|(i===null?0:Qr)|(s===null?0:So);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=Bx(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Bs?(t.writeParentInfo(!1),t.writeLeftID(a)):Ir();s!==null&&t.writeString(s)}this.content.write(t,n)}}const wp=(e,t)=>Uk[t&Wa](e),Uk=[()=>{Ir()},_k,xk,yk,Ak,Ek,wk,Mk,Tk,bk,()=>{Ir()}],Fk=10;class Zn extends Xu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Ir()}write(t,n){t.writeInfo(Fk),ne(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const xp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ss<"u"?Ss:{},kp="__ $YJS$ __";xp[kp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),xp[kp]=!0;let Tp=!1;const Wn=new Fs;function Ap(e,t,n){const r=Wn.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function Pk(e,t){Ap(e,0,t)}function qu(e,t){const n=new ii(t);Ap(e,1,n)}function Bk(e,t){Wn.getMap().set(e,t)}function Dk(e,t){const n=Wn.getMap(),r=new ii(t);n.set(e,r)}function vp(e,t){const n=Wn.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function $k(e,t){return vp(e,n=>{St(n)&&t(n)})}function Sp(e,t){return vp(e,n=>{n instanceof ii&&t(n.toJSON())})}const es=As("modem",["second"],e=>{if(es.session(e))switch(e.target){case"second":!Tp&&e.data%2===0&&es.emit(e.player,"modem:join");break;case"join":e.sender!==es.id()&&es.reply(e,"joinack",Jd(Ux(Wn)));break;case"joinack":e.sender!==es.id()&&(Tp=!0,j0(Wn,$a(e.data),Wn));break;case"sync":{e.sender!==es.id()&&k(e.data)&&j0(Wn,$a(e.data),Wn);break}}});function Rp(e,t){t!==Wn&&es.emit("","modem:sync",Jd(e))}Wn.on("update",Rp),Wn.on("destroy",()=>{Wn.off("update",Rp)});function jk(e,t){return e%t}function zk(e,t){return Math.floor(e/t)}function Wk(e,t){return{x:jk(e,t),y:zk(e,t)}}function Ks(e,t){return e.x+e.y*t}function Ju(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function Ip(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function Np(e,t,n,r){const i=[],s=Math.abs(n-e),o=Math.abs(r-t),a=e<n?1:-1,c=t<r?1:-1;let l=s-o;for(i.push({x:e,y:t});e!==n||t!==r;){const u=2*l;u>-o&&(l-=o,e+=a),u<s&&(l+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Op="170",Kk="",pr="srgb",Cp="srgb-linear",Lp="linear",Zu="srgb";function Gs(e,t,n){return Math.max(t,Math.min(n,e))}function Gk(e,t){return(e%t+t)%t}function Qu(e,t,n){return(1-n)*e+n*t}class jo{constructor(t=0,n=0){jo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Gs(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class zo{constructor(t,n,r,i,s,o,a,c,l){zo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l)}set(t,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],h=r[7],d=r[2],f=r[5],p=r[8],m=i[0],E=i[3],w=i[6],T=i[1],A=i[4],I=i[7],M=i[2],S=i[5],L=i[8];return s[0]=o*m+a*T+c*M,s[3]=o*E+a*A+c*S,s[6]=o*w+a*I+c*L,s[1]=l*m+u*T+h*M,s[4]=l*E+u*A+h*S,s[7]=l*w+u*I+h*L,s[2]=d*m+f*T+p*M,s[5]=d*E+f*A+p*S,s[8]=d*w+f*I+p*L,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=u*o-a*l,d=a*c-u*s,f=l*s-o*c,p=n*h+r*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(i*l-u*r)*m,t[2]=(a*r-i*o)*m,t[3]=d*m,t[4]=(u*n-i*c)*m,t[5]=(i*s-a*n)*m,t[6]=f*m,t[7]=(r*c-l*n)*m,t[8]=(o*n-r*s)*m,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(th.makeScale(t,n)),this}rotate(t){return this.premultiply(th.makeRotation(-t)),this}translate(t,n){return this.premultiply(th.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const th=new zo,Qn={enabled:!0,workingColorSpace:Cp,spaces:{},convert:function(e,t,n){return this.enabled===!1||t===n||!t||!n||(this.spaces[t].transfer===Zu&&(e.r=Hs(e.r),e.g=Hs(e.g),e.b=Hs(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Zu&&(e.r=Ys(e.r),e.g=Ys(e.g),e.b=Ys(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Kk?Lp:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function Hs(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function Ys(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const Mp=[.64,.33,.3,.6,.15,.06],Up=[.2126,.7152,.0722],Fp=[.3127,.329],Pp=new zo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Bp=new zo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Qn.define({[Cp]:{primaries:Mp,whitePoint:Fp,transfer:Lp,toXYZ:Pp,fromXYZ:Bp,luminanceCoefficients:Up,workingColorSpaceConfig:{unpackColorSpace:pr},outputColorSpaceConfig:{drawingBufferColorSpace:pr}},[pr]:{primaries:Mp,whitePoint:Fp,transfer:Zu,toXYZ:Pp,fromXYZ:Bp,luminanceCoefficients:Up,outputColorSpaceConfig:{drawingBufferColorSpace:pr}}});const Dp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ni={h:0,s:0,l:0},dc={h:0,s:0,l:0};function eh(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class nh{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=pr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Qn.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=Qn.workingColorSpace){return this.r=t,this.g=n,this.b=r,Qn.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=Qn.workingColorSpace){if(t=Gk(t,1),n=Gs(n,0,1),r=Gs(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=eh(o,s,t+1/3),this.g=eh(o,s,t),this.b=eh(o,s,t-1/3)}return Qn.toWorkingColorSpace(this,i),this}setStyle(t,n=pr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=pr){const r=Dp[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Hs(t.r),this.g=Hs(t.g),this.b=Hs(t.b),this}copyLinearToSRGB(t){return this.r=Ys(t.r),this.g=Ys(t.g),this.b=Ys(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=pr){return Qn.fromWorkingColorSpace(hn.copy(this),t),Math.round(Gs(hn.r*255,0,255))*65536+Math.round(Gs(hn.g*255,0,255))*256+Math.round(Gs(hn.b*255,0,255))}getHexString(t=pr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Qn.workingColorSpace){Qn.fromWorkingColorSpace(hn.copy(this),n);const r=hn.r,i=hn.g,s=hn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,n=Qn.workingColorSpace){return Qn.fromWorkingColorSpace(hn.copy(this),n),t.r=hn.r,t.g=hn.g,t.b=hn.b,t}getStyle(t=pr){Qn.fromWorkingColorSpace(hn.copy(this),t);const n=hn.r,r=hn.g,i=hn.b;return t!==pr?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Ni),this.setHSL(Ni.h+t,Ni.s+n,Ni.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Ni),t.getHSL(dc);const r=Qu(Ni.h,dc.h,n),i=Qu(Ni.s,dc.s,n),s=Qu(Ni.l,dc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const hn=new nh;nh.NAMES=Dp,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Op}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Op),new jo,new jo;function rn(e,t,n){return Math.max(t,Math.min(n,e))}function Hk(e){return e/180*Math.PI}function rh(e){return e*180/Math.PI}const Yk=yd("089fad0j9awfem09wavefc09uwaef");function Vk(){return Yk()}function Xk(e){return yd(e)()}function tr(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(Vk()*i)}function $p(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(Xk(e)*s)}function jp(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function qk(e){return e[tr(0,e.length-1)]}function Jk(e,t){return t[$p(e,0,t.length-1)]}function we(...e){return qk(e.flat())}function zp(e,...t){return Jk(e,t.flat())}function Zk(e){return[...new Set(e)].filter(k)}function Vs(e){return k(e)&&k(e.x)&&k(e.y)}function Pe(e,t){switch(t){case mt.NORTH:--e.y;break;case mt.SOUTH:++e.y;break;case mt.WEST:--e.x;break;case mt.EAST:++e.x;break}return e}function oi(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return mt.WEST;if(n>0)return mt.EAST;if(r<0)return mt.NORTH;if(r>0)return mt.SOUTH}const ih={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST"};function ns(e){return ae(e)&&Wp(e[0])}function Wp(e){return k(mt[e])&&kt(e)}function Qk(e){const t=mt[e];return k(t)?t:mt.IDLE}function sh(e){if(kt(e))return ih[Lt(e)]}function tT(e){if(ns(e))return e;if(Wp(e))return[e];const t=sh(e);if(k(t))return[t]}function Kp(e){const t=_.words[e],n=tT(t);return ns(n)?[n,e+1]:[void 0,e]}function Gp(e){var i,s;const t=[];let[n,r]=Kp(e);for(;ns(n);){switch(t.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=rt(_.words,r,[W.NUMBER,W.NUMBER]);t.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=rt(_.words,r,[W.DIR]);t.push(c.x,c.y),r=l;break}case"TO":{const[c,l,u]=rt(_.words,r,[W.DIR,W.DIR]),h=((i=_.element)==null?void 0:i.x)??0,d=((s=_.element)==null?void 0:s.y)??0;c.x-=h,c.y-=d,l.x-=h,l.y-=d,t.push(h+c.x+l.x,d+c.y+l.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":break;default:return[t,r]}const[o,a]=Kp(r);n=o,r=a}return t.length?[t,r]:[void 0,e]}function eT(e){return k(e)&&e<jt.ONBLACK?e:void 0}function nT(e){return k(e)&&e>jt.WHITE&&e<jt.ONCLEAR?e-jt.ONBLACK:void 0}const Wo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Fr(e){return ae(e)&&Yp(e[0])}function Hp(e){return Fr(e)&&e[0].startsWith("ON")}function Yp(e){return k(jt[e])&&kt(e)}function oh(e){if(kt(e))return Wo[Lt(e)]}function rT(e){return e.map(t=>jt[t]).find(t=>k(t)&&t<jt.ONBLACK)}function iT(e){return e.map(t=>jt[t]).find(t=>k(t)&&t>=jt.ONBLACK)}function sT(e){if(Fr(e))return e;if(Yp(e))return[e];const t=oh(e);if(k(t))return[t]}function Vp(e){const t=_.words[e],n=sT(t);return Fr(n)?[n,e+1]:[void 0,e]}function ah(e){const t=[];let n=e;const[r,i]=Vp(e);if(Fr(r)&&(t.push(...r),n=i),Fr(t)&&!Hp(t)){const[s,o]=Vp(i);Hp(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function Xp(e){const t={};return e.every(n=>{const r=jt[n];k(r)&&(r<jt.ONBLACK?t.color=r:t.bg=r-jt.ONBLACK)}),t}function Xs(e){return ae(e)&&typeof e[0]=="string"}function oT(e){const t=_.words[e];return kt(t)?[t,e+1]:[void 0,e]}function qp(e){const t=_.words[e];if(Xs(t))return[t,e+1];const[n,r]=ah(e),[i,s]=oT(r);return kt(i)?[[i,n],s]:[void 0,e]}function ch(e){if(!Xs(e))return;const[t]=e;return t}function Jp(e){if(!Xs(e))return;const[,t]=e,n=k(t)?rT(t):void 0;return k(n)?n:void 0}function Zp(e){if(!Xs(e))return;const[,t]=e,n=k(t)?iT(t):void 0;return k(n)?n:void 0}var lh;try{lh=new TextDecoder}catch{}var gt,er,j=0,fe={},Jt,Oi,nr=0,Pr=0,Qe,ai,vn=[],Vt,Qp={useRecords:!1,mapsAsObjects:!0};class tm{}const em=new tm;em.name="MessagePack 0xC1";var Ci=!1,nm=2,rm;try{new Function("")}catch{nm=1/0}class Ko{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(gt)return gm(()=>(ph(),this?this.unpack(t,n):Ko.prototype.unpack.call(Qp,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof en<"u"?en.from(t):new Uint8Array(t)),typeof n=="object"?(er=n.end||t.length,j=n.start||0):(j=0,er=n>-1?n:t.length),Pr=0,Oi=null,Qe=null,gt=t;try{Vt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw gt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Ko){if(fe=this,this.structures)return Jt=this.structures,pc(n);(!Jt||Jt.length>0)&&(Jt=[])}else fe=Qp,(!Jt||Jt.length>0)&&(Jt=[]);return pc(n)}unpackMultiple(t,n){let r,i=0;try{Ci=!0;let s=t.length,o=this?this.unpack(t,s):mc.unpack(t,s);if(n){if(n(o,i,j)===!1)return;for(;j<s;)if(i=j,n(pc(),i,j)===!1)return}else{for(r=[o];j<s;)i=j,r.push(pc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Ci=!1,ph()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function pc(e){try{if(!fe.trusted&&!Ci){let n=Jt.sharedLength||0;n<Jt.length&&(Jt.length=n)}let t;if(fe.randomAccessStructure&&gt[j]<64&&gt[j]>=32&&rm?(t=rm(gt,j,er,fe),gt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),j=er):t=Me(),Qe&&(j=Qe.postBundlePosition,Qe=null),Ci&&(Jt.restoreStructures=null),j==er)Jt&&Jt.restoreStructures&&im(),Jt=null,gt=null,ai&&(ai=null);else{if(j>er)throw new Error("Unexpected end of MessagePack data");if(!Ci){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Jt&&Jt.restoreStructures&&im(),ph(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||j>er)&&(t.incomplete=!0),t}}function im(){for(let e in Jt.restoreStructures)Jt[e]=Jt.restoreStructures[e];Jt.restoreStructures=null}function Me(){let e=gt[j++];if(e<160)if(e<128){if(e<64)return e;{let t=Jt[e&63]||fe.getStructures&&om()[e&63];return t?(t.read||(t.read=uh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,fe.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=fm();r==="__proto__"&&(r="__proto_"),t[r]=Me()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Me(),Me());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Me();return fe.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Pr>=j)return Oi.slice(j-nr,(j+=t)-nr);if(Pr==0&&er<140){let n=t<16?fh(t):lm(t);if(n!=null)return n}return hh(t)}else{let t;switch(e){case 192:return null;case 193:return Qe?(t=Me(),t>0?Qe[1].slice(Qe.position1,Qe.position1+=t):Qe[0].slice(Qe.position0,Qe.position0-=t)):em;case 194:return!1;case 195:return!0;case 196:if(t=gt[j++],t===void 0)throw new Error("Unexpected end of buffer");return dh(t);case 197:return t=Vt.getUint16(j),j+=2,dh(t);case 198:return t=Vt.getUint32(j),j+=4,dh(t);case 199:return rs(gt[j++]);case 200:return t=Vt.getUint16(j),j+=2,rs(t);case 201:return t=Vt.getUint32(j),j+=4,rs(t);case 202:if(t=Vt.getFloat32(j),fe.useFloat32>2){let n=mh[(gt[j]&127)<<1|gt[j+1]>>7];return j+=4,(n*t+(t>0?.5:-.5)>>0)/n}return j+=4,t;case 203:return t=Vt.getFloat64(j),j+=8,t;case 204:return gt[j++];case 205:return t=Vt.getUint16(j),j+=2,t;case 206:return t=Vt.getUint32(j),j+=4,t;case 207:return fe.int64AsType==="number"?(t=Vt.getUint32(j)*4294967296,t+=Vt.getUint32(j+4)):fe.int64AsType==="string"?t=Vt.getBigUint64(j).toString():fe.int64AsType==="auto"?(t=Vt.getBigUint64(j),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Vt.getBigUint64(j),j+=8,t;case 208:return Vt.getInt8(j++);case 209:return t=Vt.getInt16(j),j+=2,t;case 210:return t=Vt.getInt32(j),j+=4,t;case 211:return fe.int64AsType==="number"?(t=Vt.getInt32(j)*4294967296,t+=Vt.getUint32(j+4)):fe.int64AsType==="string"?t=Vt.getBigInt64(j).toString():fe.int64AsType==="auto"?(t=Vt.getBigInt64(j),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Vt.getBigInt64(j),j+=8,t;case 212:if(t=gt[j++],t==114)return pm(gt[j++]&63);{let n=vn[t];if(n)return n.read?(j++,n.read(Me())):n.noBuffer?(j++,n()):n(gt.subarray(j,++j));throw new Error("Unknown extension "+t)}case 213:return t=gt[j],t==114?(j++,pm(gt[j++]&63,gt[j++])):rs(2);case 214:return rs(4);case 215:return rs(8);case 216:return rs(16);case 217:return t=gt[j++],Pr>=j?Oi.slice(j-nr,(j+=t)-nr):cT(t);case 218:return t=Vt.getUint16(j),j+=2,Pr>=j?Oi.slice(j-nr,(j+=t)-nr):lT(t);case 219:return t=Vt.getUint32(j),j+=4,Pr>=j?Oi.slice(j-nr,(j+=t)-nr):uT(t);case 220:return t=Vt.getUint16(j),j+=2,am(t);case 221:return t=Vt.getUint32(j),j+=4,am(t);case 222:return t=Vt.getUint16(j),j+=2,cm(t);case 223:return t=Vt.getUint32(j),j+=4,cm(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const aT=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function uh(e,t){function n(){if(n.count++>nm){let i=e.read=new Function("r","return function(){return "+(fe.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":aT.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Me);return e.highByte===0&&(e.read=sm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Me()}return fe.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?sm(t,n):n}const sm=(e,t)=>function(){let n=gt[j++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Jt[r]||om()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=uh(i,e)),i.read()};function om(){let e=gm(()=>(gt=null,fe.getStructures()));return Jt=fe._mergeStructures(e,Jt)}var hh=Go,cT=Go,lT=Go,uT=Go;function Go(e){let t;if(e<16&&(t=fh(e)))return t;if(e>64&&lh)return lh.decode(gt.subarray(j,j+=e));const n=j+e,r=[];for(t="";j<n;){const i=gt[j++];if(!(i&128))r.push(i);else if((i&224)===192){const s=gt[j++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=gt[j++]&63,o=gt[j++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=gt[j++]&63,o=gt[j++]&63,a=gt[j++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=tn.apply(String,r),r.length=0)}return r.length>0&&(t+=tn.apply(String,r)),t}function am(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Me();return fe.freezeData?Object.freeze(t):t}function cm(e){if(fe.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=fm();r==="__proto__"&&(r="__proto_"),t[r]=Me()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Me(),Me());return t}}var tn=String.fromCharCode;function lm(e){let t=j,n=new Array(e);for(let r=0;r<e;r++){const i=gt[j++];if((i&128)>0){j=t;return}n[r]=i}return tn.apply(String,n)}function fh(e){if(e<4)if(e<2){if(e===0)return"";{let t=gt[j++];if((t&128)>1){j-=1;return}return tn(t)}}else{let t=gt[j++],n=gt[j++];if((t&128)>0||(n&128)>0){j-=2;return}if(e<3)return tn(t,n);let r=gt[j++];if((r&128)>0){j-=3;return}return tn(t,n,r)}else{let t=gt[j++],n=gt[j++],r=gt[j++],i=gt[j++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){j-=4;return}if(e<6){if(e===4)return tn(t,n,r,i);{let s=gt[j++];if((s&128)>0){j-=5;return}return tn(t,n,r,i,s)}}else if(e<8){let s=gt[j++],o=gt[j++];if((s&128)>0||(o&128)>0){j-=6;return}if(e<7)return tn(t,n,r,i,s,o);let a=gt[j++];if((a&128)>0){j-=7;return}return tn(t,n,r,i,s,o,a)}else{let s=gt[j++],o=gt[j++],a=gt[j++],c=gt[j++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){j-=8;return}if(e<10){if(e===8)return tn(t,n,r,i,s,o,a,c);{let l=gt[j++];if((l&128)>0){j-=9;return}return tn(t,n,r,i,s,o,a,c,l)}}else if(e<12){let l=gt[j++],u=gt[j++];if((l&128)>0||(u&128)>0){j-=10;return}if(e<11)return tn(t,n,r,i,s,o,a,c,l,u);let h=gt[j++];if((h&128)>0){j-=11;return}return tn(t,n,r,i,s,o,a,c,l,u,h)}else{let l=gt[j++],u=gt[j++],h=gt[j++],d=gt[j++];if((l&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){j-=12;return}if(e<14){if(e===12)return tn(t,n,r,i,s,o,a,c,l,u,h,d);{let f=gt[j++];if((f&128)>0){j-=13;return}return tn(t,n,r,i,s,o,a,c,l,u,h,d,f)}}else{let f=gt[j++],p=gt[j++];if((f&128)>0||(p&128)>0){j-=14;return}if(e<15)return tn(t,n,r,i,s,o,a,c,l,u,h,d,f,p);let m=gt[j++];if((m&128)>0){j-=15;return}return tn(t,n,r,i,s,o,a,c,l,u,h,d,f,p,m)}}}}}function um(){let e=gt[j++],t;if(e<192)t=e-160;else switch(e){case 217:t=gt[j++];break;case 218:t=Vt.getUint16(j),j+=2;break;case 219:t=Vt.getUint32(j),j+=4;break;default:throw new Error("Expected string")}return Go(t)}function dh(e){return fe.copyBuffers?Uint8Array.prototype.slice.call(gt,j,j+=e):gt.subarray(j,j+=e)}function rs(e){let t=gt[j++];if(vn[t]){let n;return vn[t](gt.subarray(j,n=j+=e),r=>{j=r;try{return Me()}finally{j=n}})}else throw new Error("Unknown extension type "+t)}var hm=new Array(4096);function fm(){let e=gt[j++];if(e>=160&&e<192){if(e=e-160,Pr>=j)return Oi.slice(j-nr,(j+=e)-nr);if(!(Pr==0&&er<180))return hh(e)}else return j--,dm(Me());let t=(e<<5^(e>1?Vt.getUint16(j):e>0?gt[j]:0))&4095,n=hm[t],r=j,i=j+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Vt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=gt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return j=r,n.string;i-=3,r=j}for(n=[],hm[t]=n,n.bytes=e;r<i;)s=Vt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=gt[r++],n.push(s);let a=e<16?fh(e):lm(e);return a!=null?n.string=a:n.string=hh(e)}function dm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const pm=(e,t)=>{let n=Me().map(dm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Jt[e];return i&&(i.isShared||Ci)&&((Jt.restoreStructures||(Jt.restoreStructures=[]))[e]=i),Jt[e]=n,n.read=uh(n,r),n.read()};vn[0]=()=>{},vn[0].noBuffer=!0,vn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let hT={Error,TypeError,ReferenceError};vn[101]=()=>{let e=Me();return(hT[e[0]]||Error)(e[1],{cause:e[2]})},vn[105]=e=>{if(fe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Vt.getUint32(j-4);ai||(ai=new Map);let n=gt[j],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};ai.set(t,i);let s=Me();return i.used?Object.assign(r,s):(i.target=s,s)},vn[112]=e=>{if(fe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Vt.getUint32(j-4),n=ai.get(t);return n.used=!0,n.target},vn[115]=()=>new Set(Me());const mm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let fT=typeof globalThis=="object"?globalThis:window;vn[116]=e=>{let t=e[0],n=mm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new fT[n](Uint8Array.prototype.slice.call(e,1).buffer)},vn[120]=()=>{let e=Me();return new RegExp(e[0],e[1])};const dT=[];vn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=j;return j+=t-e.length,Qe=dT,Qe=[um(),um()],Qe.position0=0,Qe.position1=0,Qe.postBundlePosition=j,j=n,Me()},vn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function gm(e){let t=er,n=j,r=nr,i=Pr,s=Oi,o=ai,a=Qe,c=new Uint8Array(gt.slice(0,er)),l=Jt,u=Jt.slice(0,Jt.length),h=fe,d=Ci,f=e();return er=t,j=n,nr=r,Pr=i,Oi=s,ai=o,Qe=a,gt=c,Ci=d,Jt=l,Jt.splice(0,Jt.length,...u),fe=h,Vt=new DataView(gt.buffer,gt.byteOffset,gt.byteLength),f}function ph(){gt=null,ai=null,Jt=null}const mh=new Array(147);for(let e=0;e<256;e++)mh[e]=+("1e"+Math.floor(45.15-e*.30103));var mc=new Ko({useRecords:!1});const pT=mc.unpack;mc.unpackMultiple,mc.unpack;let mT=new Float32Array(1);new Uint8Array(mT.buffer,0,4);let gc;try{gc=new TextEncoder}catch{}let gh,ym;const yc=typeof en<"u",_c=yc?function(e){return en.allocUnsafeSlow(e)}:Uint8Array,_m=yc?en:Uint8Array,bm=yc?4294967296:2144337920;let q,Ho,de,K=0,mn,ve=null,gT;const yT=21760,_T=/[\u0080-\uFFFF]/,qs=Symbol("record-id");class bT extends Ko{constructor(t){super(t),this.offset=0;let n,r,i,s,o=_m.prototype.utf8Write?function(R,b){return q.utf8Write(R,b,q.byteLength-b)}:gc&&gc.encodeInto?function(R,b){return gc.encodeInto(R,q.subarray(b)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||h+u>64,f=u+64,p=u+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],E=0,w=0;this.pack=this.encode=function(R,b){if(q||(q=new _c(8192),de=q.dataView||(q.dataView=new DataView(q.buffer,0,8192)),K=0),mn=q.length-10,mn-K<2048?(q=new _c(q.length),de=q.dataView||(q.dataView=new DataView(q.buffer,0,q.length)),mn=q.length-10,K=0):K=K+7&2147483640,n=K,b&vT&&(K+=b&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof R!="string"?(ve=[],ve.size=1/0):ve=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let J=i.sharedLength||0;if(J>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let D=0;D<J;D++){let st=i[D];if(!st)continue;let tt,ft=i.transitions;for(let V=0,z=st.length;V<z;V++){let Et=st[V];tt=ft[Et],tt||(tt=ft[Et]=Object.create(null)),ft=tt}ft[qs]=D+64}this.lastNamedStructuresLength=J}c||(i.nextId=J+64)}r&&(r=!1);let P;try{a.randomAccessStructure&&R&&R.constructor&&R.constructor===Object?C(R):I(R);let J=ve;if(ve&&xm(n,I,0),s&&s.idsToInsert){let D=s.idsToInsert.sort((V,z)=>V.offset>z.offset?1:-1),st=D.length,tt=-1;for(;J&&st>0;){let V=D[--st].offset+n;V<J.stringsPosition+n&&tt===-1&&(tt=0),V>J.position+n?tt>=0&&(tt+=6):(tt>=0&&(de.setUint32(J.position+n,de.getUint32(J.position+n)+tt),tt=-1),J=J.previous,st++)}tt>=0&&J&&de.setUint32(J.position+n,de.getUint32(J.position+n)+tt),K+=D.length*6,K>mn&&O(K),a.offset=K;let ft=wT(q.subarray(n,K),D);return s=null,ft}return a.offset=K,b&TT?(q.start=n,q.end=K,q):q.subarray(n,K)}catch(J){throw P=J,J}finally{if(i&&(T(),r&&a.saveStructures)){let J=i.sharedLength||0,D=q.subarray(n,K),st=xT(i,a);if(!P)return a.saveStructures(st,st.isCompatible)===!1?a.pack(R,b):(a.lastNamedStructuresLength=J,q.length>1073741824&&(q=null),D)}q.length>1073741824&&(q=null),b&AT&&(K=n)}};const T=()=>{w<10&&w++;let R=i.sharedLength||0;if(i.length>R&&!c&&(i.length=R),E>1e4)i.transitions=null,w=0,E=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let b=0,P=m.length;b<P;b++)m[b][qs]=0;m=[]}},A=R=>{var b=R.length;b<16?q[K++]=144|b:b<65536?(q[K++]=220,q[K++]=b>>8,q[K++]=b&255):(q[K++]=221,de.setUint32(K,b),K+=4);for(let P=0;P<b;P++)I(R[P])},I=R=>{K>mn&&(q=O(K));var b=typeof R,P;if(b==="string"){let J=R.length;if(ve&&J>=4&&J<4096){if((ve.size+=J)>yT){let ft,V=(ve[0]?ve[0].length*3+ve[1].length:0)+10;K+V>mn&&(q=O(K+V));let z;ve.position?(z=ve,q[K]=200,K+=3,q[K++]=98,ft=K-n,K+=4,xm(n,I,0),de.setUint16(ft+n-3,K-n-ft)):(q[K++]=214,q[K++]=98,ft=K-n,K+=4),ve=["",""],ve.previous=z,ve.size=0,ve.position=ft}let tt=_T.test(R);ve[tt?0:1]+=R,q[K++]=193,I(tt?-J:J);return}let D;J<32?D=1:J<256?D=2:J<65536?D=3:D=5;let st=J*3;if(K+st>mn&&(q=O(K+st)),J<64||!o){let tt,ft,V,z=K+D;for(tt=0;tt<J;tt++)ft=R.charCodeAt(tt),ft<128?q[z++]=ft:ft<2048?(q[z++]=ft>>6|192,q[z++]=ft&63|128):(ft&64512)===55296&&((V=R.charCodeAt(tt+1))&64512)===56320?(ft=65536+((ft&1023)<<10)+(V&1023),tt++,q[z++]=ft>>18|240,q[z++]=ft>>12&63|128,q[z++]=ft>>6&63|128,q[z++]=ft&63|128):(q[z++]=ft>>12|224,q[z++]=ft>>6&63|128,q[z++]=ft&63|128);P=z-K-D}else P=o(R,K+D);P<32?q[K++]=160|P:P<256?(D<2&&q.copyWithin(K+2,K+1,K+1+P),q[K++]=217,q[K++]=P):P<65536?(D<3&&q.copyWithin(K+3,K+2,K+2+P),q[K++]=218,q[K++]=P>>8,q[K++]=P&255):(D<5&&q.copyWithin(K+5,K+3,K+3+P),q[K++]=219,de.setUint32(K,P),K+=4),K+=P}else if(b==="number")if(R>>>0===R)R<32||R<128&&this.useRecords===!1||R<64&&!this.randomAccessStructure?q[K++]=R:R<256?(q[K++]=204,q[K++]=R):R<65536?(q[K++]=205,q[K++]=R>>8,q[K++]=R&255):(q[K++]=206,de.setUint32(K,R),K+=4);else if(R>>0===R)R>=-32?q[K++]=256+R:R>=-128?(q[K++]=208,q[K++]=R+256):R>=-32768?(q[K++]=209,de.setInt16(K,R),K+=2):(q[K++]=210,de.setInt32(K,R),K+=4);else{let J;if((J=this.useFloat32)>0&&R<4294967296&&R>=-2147483648){q[K++]=202,de.setFloat32(K,R);let D;if(J<4||(D=R*mh[(q[K]&127)<<1|q[K+1]>>7])>>0===D){K+=4;return}else K--}q[K++]=203,de.setFloat64(K,R),K+=8}else if(b==="object"||b==="function")if(!R)q[K++]=192;else{if(s){let D=s.get(R);if(D){if(!D.id){let st=s.idsToInsert||(s.idsToInsert=[]);D.id=st.push(D)}q[K++]=214,q[K++]=112,de.setUint32(K,D.id),K+=4;return}else s.set(R,{offset:K-n})}let J=R.constructor;if(J===Object)B(R);else if(J===Array)A(R);else if(J===Map)if(this.mapAsEmptyObject)q[K++]=128;else{P=R.size,P<16?q[K++]=128|P:P<65536?(q[K++]=222,q[K++]=P>>8,q[K++]=P&255):(q[K++]=223,de.setUint32(K,P),K+=4);for(let[D,st]of R)I(D),I(st)}else{for(let D=0,st=gh.length;D<st;D++){let tt=ym[D];if(R instanceof tt){let ft=gh[D];if(ft.write){ft.type&&(q[K++]=212,q[K++]=ft.type,q[K++]=0);let lt=ft.write.call(this,R);lt===R?Array.isArray(R)?A(R):B(R):I(lt);return}let V=q,z=de,Et=K;q=null;let at;try{at=ft.pack.call(this,R,lt=>(q=V,V=null,K+=lt,K>mn&&O(K),{target:q,targetView:de,position:K-lt}),I)}finally{V&&(q=V,de=z,K=Et,mn=q.length-10)}at&&(at.length+K>mn&&O(at.length+K),K=ET(at,q,K,ft.type));return}}if(Array.isArray(R))A(R);else{if(R.toJSON){const D=R.toJSON();if(D!==R)return I(D)}if(b==="function")return I(this.writeFunction&&this.writeFunction(R));B(R)}}}else if(b==="boolean")q[K++]=R?195:194;else if(b==="bigint"){if(R<BigInt(1)<<BigInt(63)&&R>=-(BigInt(1)<<BigInt(63)))q[K++]=211,de.setBigInt64(K,R);else if(R<BigInt(1)<<BigInt(64)&&R>0)q[K++]=207,de.setBigUint64(K,R);else if(this.largeBigIntToFloat)q[K++]=203,de.setFloat64(K,Number(R));else{if(this.largeBigIntToString)return I(R.toString());if(this.useBigIntExtension&&R<BigInt(2)**BigInt(1023)&&R>-(BigInt(2)**BigInt(1023))){q[K++]=199,K++,q[K++]=66;let J=[],D;do{let st=R&BigInt(255);D=(st&BigInt(128))===(R<BigInt(0)?BigInt(128):BigInt(0)),J.push(st),R>>=BigInt(8)}while(!((R===BigInt(0)||R===BigInt(-1))&&D));q[K-2]=J.length;for(let st=J.length;st>0;)q[K++]=Number(J[--st]);return}else throw new RangeError(R+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}K+=8}else if(b==="undefined")this.encodeUndefinedAsNil?q[K++]=192:(q[K++]=212,q[K++]=0,q[K++]=0);else throw new Error("Unknown type: "+b)},M=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?R=>{let b;if(this.skipValues){b=[];for(let D in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(D))&&!this.skipValues.includes(R[D])&&b.push(D)}else b=Object.keys(R);let P=b.length;P<16?q[K++]=128|P:P<65536?(q[K++]=222,q[K++]=P>>8,q[K++]=P&255):(q[K++]=223,de.setUint32(K,P),K+=4);let J;if(this.coercibleKeyAsNumber)for(let D=0;D<P;D++){J=b[D];let st=Number(J);I(isNaN(st)?J:st),I(R[J])}else for(let D=0;D<P;D++)I(J=b[D]),I(R[J])}:R=>{q[K++]=222;let b=K-n;K+=2;let P=0;for(let J in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(J))&&(I(J),I(R[J]),P++);if(P>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');q[b+++n]=P>>8,q[b+n]=P&255},S=this.useRecords===!1?M:t.progressiveRecords&&!d?R=>{let b,P=i.transitions||(i.transitions=Object.create(null)),J=K++-n,D;for(let st in R)if(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(st)){if(b=P[st],b)P=b;else{let tt=Object.keys(R),ft=P;P=i.transitions;let V=0;for(let z=0,Et=tt.length;z<Et;z++){let at=tt[z];b=P[at],b||(b=P[at]=Object.create(null),V++),P=b}J+n+1==K?(K--,G(P,tt,V)):et(P,tt,J,V),D=!0,P=ft[st]}I(R[st])}if(!D){let st=P[qs];st?q[J+n]=st:et(P,Object.keys(R),J,0)}}:R=>{let b,P=i.transitions||(i.transitions=Object.create(null)),J=0;for(let st in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(st))&&(b=P[st],b||(b=P[st]=Object.create(null),J++),P=b);let D=P[qs];D?D>=96&&d?(q[K++]=((D-=96)&31)+96,q[K++]=D>>5):q[K++]=D:G(P,P.__keys__||Object.keys(R),J);for(let st in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(st))&&I(R[st])},L=typeof this.useRecords=="function"&&this.useRecords,B=L?R=>{L(R)?S(R):M(R)}:S,O=R=>{let b;if(R>16777216){if(R-n>bm)throw new Error("Packed buffer would be larger than maximum buffer size");b=Math.min(bm,Math.round(Math.max((R-n)*(R>67108864?1.25:2),4194304)/4096)*4096)}else b=(Math.max(R-n<<2,q.length-1)>>12)+1<<12;let P=new _c(b);return de=P.dataView||(P.dataView=new DataView(P.buffer,0,b)),R=Math.min(R,q.length),q.copy?q.copy(P,0,n,R):P.set(q.slice(n,R)),K-=n,n=0,mn=P.length-10,q=P},G=(R,b,P)=>{let J=i.nextId;J||(J=64),J<f&&this.shouldShareStructure&&!this.shouldShareStructure(b)?(J=i.nextOwnId,J<p||(J=f),i.nextOwnId=J+1):(J>=p&&(J=f),i.nextId=J+1);let D=b.highByte=J>=96&&d?J-96>>5:-1;R[qs]=J,R.__keys__=b,i[J-64]=b,J<f?(b.isShared=!0,i.sharedLength=J-63,r=!0,D>=0?(q[K++]=(J&31)+96,q[K++]=D):q[K++]=J):(D>=0?(q[K++]=213,q[K++]=114,q[K++]=(J&31)+96,q[K++]=D):(q[K++]=212,q[K++]=114,q[K++]=J),P&&(E+=w*P),m.length>=h&&(m.shift()[qs]=0),m.push(R),I(b))},et=(R,b,P,J)=>{let D=q,st=K,tt=mn,ft=n;q=Ho,K=0,n=0,q||(Ho=q=new _c(8192)),mn=q.length-10,G(R,b,J),Ho=q;let V=K;if(q=D,K=st,mn=tt,n=ft,V>1){let z=K+V-1;z>mn&&O(z);let Et=P+n;q.copyWithin(Et+V,Et+1,K),q.set(Ho.slice(0,V),Et),K=z}else q[P+n]=Ho[0]},C=R=>{let b=gT(R,q,n,K,i,O,(P,J,D)=>{if(D)return r=!0;K=J;let st=q;return I(P),T(),st!==q?{position:K,targetView:de,target:q}:K},this);if(b===0)return B(R);K=b}}useBuffer(t){q=t,q.dataView||(q.dataView=new DataView(q.buffer,q.byteOffset,q.byteLength)),K=0}set position(t){K=t}get position(){return K}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}ym=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,tm],gh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Em(e,16,t):wm(yc?en.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==_m&&this.moreTypes?Em(e,mm.indexOf(n.name),t):wm(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Em(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function wm(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function ET(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function wT(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function xm(e,t,n){if(ve.length>0){de.setUint32(ve.position+e,K+n-ve.position-e),ve.stringsPosition=K-e;let r=ve;ve=null,t(r[0]),t(r[1])}}function xT(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let km=new bT({useRecords:!1});const kT=km.pack;km.pack;const TT=512,AT=1024,vT=2048,Y=As("SOFTWARE");function xe(){return null}function Js(e,t,n={}){if(!k(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];k(c)&&(a=c(a));const l=t[o];k(l)&&(o=l),a!==null&&r.push(o,a)}return r}function Yo(e,t,n={}){if(k(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];k(a)&&(s=a);const c=n[s];k(c)&&(o=c(o)),r[s]=o}return r}catch(r){ye(Y,"","binary",r.message)}}function ST(e){try{const t=qe(e);return kT(t)}catch(t){ye(Y,"","binary",t.message)}}function RT(e){try{return pT(e)}catch(t){ye(Y,"","binary",t.message)}}function Tm(){return{id:Ce()}}var bc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e))(bc||{});function Ec(e){return k(e==null?void 0:e.id)?Js(e,bc,{category:xe,kinddata:xe,stopped:xe,removed:xe,bucket:xe}):Js(e,bc,{id:xe,x:xe,y:xe,lx:xe,ly:xe,code:xe,category:xe,kinddata:xe,stopped:xe,removed:xe,bucket:xe})}function wc(e){return Yo(e,bc)}function Li(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function xc(e,t){if(!k(e)||!Fr(t))return;const{color:n,bg:r}=Xp(t);k(n)&&(e.color=n),k(r)&&(e.bg=r)}function Br(e){var t;return Lt((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}const It=60,re=25,Am=It*re;var _t=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(_t||{});function IT(){return new Array(It*re).map(()=>{})}function vm(e=Jl){const t={terrain:IT(),objects:{},id:""};return e(t)}var yh=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e))(yh||{});function NT(e){return Js(e,yh,{terrain:t=>t.map(Ec),objects:t=>Object.values(t).filter(n=>!n.removed).map(Ec),id:xe,named:xe,lookup:xe,codepage:xe,distmaps:xe,overboard:xe,underboard:xe})}function OT(e){return Yo(e,yh,{terrain:t=>t.map(wc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=wc(t[r]);k(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function mr(e,t){return!k(e)||!k(t==null?void 0:t.x)||!k(t==null?void 0:t.y)||t.x<0||t.x>=It||t.y<0||t.y>=re?-1:t.x+t.y*It}function sn(e,t){const n=mr(e,t);if(n<0||!k(e==null?void 0:e.lookup))return;const r=gn(e,e.lookup[n]??"");return k(r)?r:e.terrain[n]}function CT(e,t){const n=gn(e,t);if(k(n))return n;const r=parseFloat(t),i=Wk(isNaN(r)?-1:r,It);return Vo(e,i.x,i.y)}function Vo(e,t,n){return(t>=0&&t<It)??(n>=0&&n<re)?e==null?void 0:e.terrain[t+n*It]:void 0}function Sn(e,t){if(!k(e)||!k(t)||!k(t.x)||!k(t.y)||t.x<0||t.x>=It||t.y<0||t.y>=re)return;const n=qe(t),r=t.x+t.y*It;return e.terrain[r]=n,delete e.distmaps,e.terrain[r]}function _h(e,t){if(!k(e)||!k(t))return;const n=qe(t);return n.id=n.id??Ce(),e.objects[n.id]=n,e.objects[n.id]}function LT(e,t,n){return Sn(e,{...t,kind:n})}function bh(e,t,n,r){return _h(e,{...t,kind:n,id:r})}function gn(e,t){if(e)return e.objects[t]}function MT(e,t){const n=mr(e,t);if(n<0||!k(e==null?void 0:e.lookup))return;const r=gn(e,e.lookup[n]??"");if(k(r))return r}function Sm(e,t){return k(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function UT(e,t,n){if(!k(e)||!k(t))return;const r=e.objects[n];if(k(r))return r;if(Vs(t))return Nm(t,qo(e,"player"))}function kc(e,t){const n=e??Ht.ISWALK,r=t??Ht.ISWALK;switch(n){case Ht.ISWALK:return r!==Ht.ISWALK;case Ht.ISSWIM:return r!==Ht.ISSWIM;case Ht.ISSOLID:return!0;case Ht.ISBULLET:return r!==Ht.ISWALK&&r!==Ht.ISSWIM}}function Xo(e,t,n){const r=e==null?void 0:e.objects[n];if(k(r))return r;const i=qo(e,"player");return k(t)?(t.x<0&&(t.x=tr(0,It-1)),t.y<0&&(t.y=tr(0,re-1)),Nm(t,i)):we(...i)}function qo(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(k)}function FT(e){const t=[];for(let n=0;n<re;++n)for(let r=0;r<It;++r){const i={x:r,y:n},s=sn(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function Rm(e,t){const n=ch(t),r=Jp(t),i=Zp(t);return qo(e,n??"").filter(s=>{var o,a,c;return!(k(n)&&Lt((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||k(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??jt.WHITE)!==r||k(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??jt.BLACK)!==i)}).filter(k)}function Im(e,t){return k(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(k(i))return i;const s=qo(e,Lt(n));if(s.length)return s}else if(Vs(n)&&n.x>=0&&n.x<It&&n.y>=0&&n.y<re){const i=n.x+n.y*It,s=(r=e.lookup)==null?void 0:r[i];return k(s)?e.objects[s]:e.terrain[i]}}).flat().filter(k):[]}function Nm(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function Om(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}const Eh=14,Tc=3,Ac=8,vc=14,Sc=16,PT=16,BT=16;function Rc(e,t){return new Array(e).fill(t)}function DT(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:Rc(s,0),color:Rc(s,0),bg:Rc(s,i)}}function $T(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:jt.ONCLEAR}}function jT(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function zT(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:Rc(s,i)}}function WT(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function KT(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5}}function Cm(e,t){return`${e}:${t}`}const GT=1,HT=16,YT=256;var yn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(yn||{});function Lm(e){const t=Math.floor(e.length/Tc);if(t*Tc!==e.length)return;const n=Om(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function VT(e,t){return e&1<<t?255:0}function Mm(e){const t=Math.floor(e.length/Eh);if(t*Eh!==e.length)return;const n=Math.ceil(t/Sc),r=Ac*Sc,i=Om(r,vc*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*vc+a,u=e[c];for(let h=0;h<Ac;++h){const d=s*Ac+h;i.bits[d+l*r]=VT(u,7-h)}++a,a===vc&&(a=0,++s,s===Sc&&(s=0,++o))}return i}const XT=$a("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),qT=$a("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var Um=typeof Ss=="object"&&Ss&&Ss.Object===Object&&Ss,JT=typeof self=="object"&&self&&self.Object===Object&&self,Dr=Um||JT||Function("return this")(),rr=Dr.Symbol,Fm=Object.prototype,ZT=Fm.hasOwnProperty,QT=Fm.toString,Jo=rr?rr.toStringTag:void 0;function tA(e){var t=ZT.call(e,Jo),n=e[Jo];try{e[Jo]=void 0;var r=!0}catch{}var i=QT.call(e);return r&&(t?e[Jo]=n:delete e[Jo]),i}var eA=Object.prototype,nA=eA.toString;function rA(e){return nA.call(e)}var iA="[object Null]",sA="[object Undefined]",Pm=rr?rr.toStringTag:void 0;function Mi(e){return e==null?e===void 0?sA:iA:Pm&&Pm in Object(e)?tA(e):rA(e)}function gr(e){return e!=null&&typeof e=="object"}var oA="[object Symbol]";function Ic(e){return typeof e=="symbol"||gr(e)&&Mi(e)==oA}function Nc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var te=Array.isArray,aA=1/0,Bm=rr?rr.prototype:void 0,Dm=Bm?Bm.toString:void 0;function $m(e){if(typeof e=="string")return e;if(te(e))return Nc(e,$m)+"";if(Ic(e))return Dm?Dm.call(e):"";var t=e+"";return t=="0"&&1/e==-aA?"-0":t}var cA=/\s/;function lA(e){for(var t=e.length;t--&&cA.test(e.charAt(t)););return t}var uA=/^\s+/;function hA(e){return e&&e.slice(0,lA(e)+1).replace(uA,"")}function ir(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var jm=NaN,fA=/^[-+]0x[0-9a-f]+$/i,dA=/^0b[01]+$/i,pA=/^0o[0-7]+$/i,mA=parseInt;function gA(e){if(typeof e=="number")return e;if(Ic(e))return jm;if(ir(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ir(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=hA(e);var n=dA.test(e);return n||pA.test(e)?mA(e.slice(2),n?2:8):fA.test(e)?jm:+e}var zm=1/0,yA=17976931348623157e292;function _A(e){if(!e)return e===0?e:0;if(e=gA(e),e===zm||e===-zm){var t=e<0?-1:1;return t*yA}return e===e?e:0}function Oc(e){var t=_A(e),n=t%1;return t===t?n?t-n:t:0}function Zs(e){return e}var bA="[object AsyncFunction]",EA="[object Function]",wA="[object GeneratorFunction]",xA="[object Proxy]";function ci(e){if(!ir(e))return!1;var t=Mi(e);return t==EA||t==wA||t==bA||t==xA}var wh=Dr["__core-js_shared__"],Wm=function(){var e=/[^.]+$/.exec(wh&&wh.keys&&wh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function kA(e){return!!Wm&&Wm in e}var TA=Function.prototype,AA=TA.toString;function is(e){if(e!=null){try{return AA.call(e)}catch{}try{return e+""}catch{}}return""}var vA=/[\\^$.*+?()[\]{}|]/g,SA=/^\[object .+?Constructor\]$/,RA=Function.prototype,IA=Object.prototype,NA=RA.toString,OA=IA.hasOwnProperty,CA=RegExp("^"+NA.call(OA).replace(vA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function LA(e){if(!ir(e)||kA(e))return!1;var t=ci(e)?CA:SA;return t.test(is(e))}function MA(e,t){return e==null?void 0:e[t]}function ss(e,t){var n=MA(e,t);return LA(n)?n:void 0}var xh=ss(Dr,"WeakMap"),Km=Object.create,UA=function(){function e(){}return function(t){if(!ir(t))return{};if(Km)return Km(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function FA(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Ge(){}function PA(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var BA=800,DA=16,$A=Date.now;function jA(e){var t=0,n=0;return function(){var r=$A(),i=DA-(r-n);if(n=r,i>0){if(++t>=BA)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function zA(e){return function(){return e}}var Cc=function(){try{var e=ss(Object,"defineProperty");return e({},"",{}),e}catch{}}(),WA=Cc?function(e,t){return Cc(e,"toString",{configurable:!0,enumerable:!1,value:zA(t),writable:!0})}:Zs,KA=jA(WA);function Gm(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Hm(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function GA(e){return e!==e}function HA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function kh(e,t,n){return t===t?HA(e,t,n):Hm(e,GA,n)}function Ym(e,t){var n=e==null?0:e.length;return!!n&&kh(e,t,0)>-1}var YA=9007199254740991,VA=/^(?:0|[1-9]\d*)$/;function Lc(e,t){var n=typeof e;return t=t??YA,!!t&&(n=="number"||n!="symbol"&&VA.test(e))&&e>-1&&e%1==0&&e<t}function Th(e,t,n){t=="__proto__"&&Cc?Cc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Zo(e,t){return e===t||e!==e&&t!==t}var XA=Object.prototype,qA=XA.hasOwnProperty;function Mc(e,t,n){var r=e[t];(!(qA.call(e,t)&&Zo(r,n))||n===void 0&&!(t in e))&&Th(e,t,n)}function Ah(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?Th(n,a,c):Mc(n,a,c)}return n}var Vm=Math.max;function JA(e,t,n){return t=Vm(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=Vm(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),FA(e,this,a)}}function vh(e,t){return KA(JA(e,t,Zs),e+"")}var ZA=9007199254740991;function Sh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ZA}function $r(e){return e!=null&&Sh(e.length)&&!ci(e)}function Xm(e,t,n){if(!ir(n))return!1;var r=typeof t;return(r=="number"?$r(n)&&Lc(t,n.length):r=="string"&&t in n)?Zo(n[t],e):!1}function QA(e){return vh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&Xm(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var tv=Object.prototype;function Qo(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||tv;return e===n}function ev(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var nv="[object Arguments]";function qm(e){return gr(e)&&Mi(e)==nv}var Jm=Object.prototype,rv=Jm.hasOwnProperty,iv=Jm.propertyIsEnumerable,Uc=qm(function(){return arguments}())?qm:function(e){return gr(e)&&rv.call(e,"callee")&&!iv.call(e,"callee")};function sv(){return!1}var Zm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Qm=Zm&&typeof module=="object"&&module&&!module.nodeType&&module,ov=Qm&&Qm.exports===Zm,tg=ov?Dr.Buffer:void 0,av=tg?tg.isBuffer:void 0,ta=av||sv,cv="[object Arguments]",lv="[object Array]",uv="[object Boolean]",hv="[object Date]",fv="[object Error]",dv="[object Function]",pv="[object Map]",mv="[object Number]",gv="[object Object]",yv="[object RegExp]",_v="[object Set]",bv="[object String]",Ev="[object WeakMap]",wv="[object ArrayBuffer]",xv="[object DataView]",kv="[object Float32Array]",Tv="[object Float64Array]",Av="[object Int8Array]",vv="[object Int16Array]",Sv="[object Int32Array]",Rv="[object Uint8Array]",Iv="[object Uint8ClampedArray]",Nv="[object Uint16Array]",Ov="[object Uint32Array]",_e={};_e[kv]=_e[Tv]=_e[Av]=_e[vv]=_e[Sv]=_e[Rv]=_e[Iv]=_e[Nv]=_e[Ov]=!0,_e[cv]=_e[lv]=_e[wv]=_e[uv]=_e[xv]=_e[hv]=_e[fv]=_e[dv]=_e[pv]=_e[mv]=_e[gv]=_e[yv]=_e[_v]=_e[bv]=_e[Ev]=!1;function Cv(e){return gr(e)&&Sh(e.length)&&!!_e[Mi(e)]}function Fc(e){return function(t){return e(t)}}var eg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ea=eg&&typeof module=="object"&&module&&!module.nodeType&&module,Lv=ea&&ea.exports===eg,Rh=Lv&&Um.process,Ui=function(){try{var e=ea&&ea.require&&ea.require("util").types;return e||Rh&&Rh.binding&&Rh.binding("util")}catch{}}(),ng=Ui&&Ui.isTypedArray,Ih=ng?Fc(ng):Cv,Mv=Object.prototype,Uv=Mv.hasOwnProperty;function rg(e,t){var n=te(e),r=!n&&Uc(e),i=!n&&!r&&ta(e),s=!n&&!r&&!i&&Ih(e),o=n||r||i||s,a=o?ev(e.length,String):[],c=a.length;for(var l in e)(t||Uv.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Lc(l,c)))&&a.push(l);return a}function ig(e,t){return function(n){return e(t(n))}}var Fv=ig(Object.keys,Object),Pv=Object.prototype,Bv=Pv.hasOwnProperty;function sg(e){if(!Qo(e))return Fv(e);var t=[];for(var n in Object(e))Bv.call(e,n)&&n!="constructor"&&t.push(n);return t}function sr(e){return $r(e)?rg(e):sg(e)}var Dv=Object.prototype,$v=Dv.hasOwnProperty,Rn=QA(function(e,t){if(Qo(t)||$r(t)){Ah(t,sr(t),e);return}for(var n in t)$v.call(t,n)&&Mc(e,n,t[n])});function jv(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var zv=Object.prototype,Wv=zv.hasOwnProperty;function Kv(e){if(!ir(e))return jv(e);var t=Qo(e),n=[];for(var r in e)r=="constructor"&&(t||!Wv.call(e,r))||n.push(r);return n}function og(e){return $r(e)?rg(e,!0):Kv(e)}var Gv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hv=/^\w*$/;function Nh(e,t){if(te(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Ic(e)?!0:Hv.test(e)||!Gv.test(e)||t!=null&&e in Object(t)}var na=ss(Object,"create");function Yv(){this.__data__=na?na(null):{},this.size=0}function Vv(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Xv="__lodash_hash_undefined__",qv=Object.prototype,Jv=qv.hasOwnProperty;function Zv(e){var t=this.__data__;if(na){var n=t[e];return n===Xv?void 0:n}return Jv.call(t,e)?t[e]:void 0}var Qv=Object.prototype,tS=Qv.hasOwnProperty;function eS(e){var t=this.__data__;return na?t[e]!==void 0:tS.call(t,e)}var nS="__lodash_hash_undefined__";function rS(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=na&&t===void 0?nS:t,this}function os(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}os.prototype.clear=Yv,os.prototype.delete=Vv,os.prototype.get=Zv,os.prototype.has=eS,os.prototype.set=rS;function iS(){this.__data__=[],this.size=0}function Pc(e,t){for(var n=e.length;n--;)if(Zo(e[n][0],t))return n;return-1}var sS=Array.prototype,oS=sS.splice;function aS(e){var t=this.__data__,n=Pc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():oS.call(t,n,1),--this.size,!0}function cS(e){var t=this.__data__,n=Pc(t,e);return n<0?void 0:t[n][1]}function lS(e){return Pc(this.__data__,e)>-1}function uS(e,t){var n=this.__data__,r=Pc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function li(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}li.prototype.clear=iS,li.prototype.delete=aS,li.prototype.get=cS,li.prototype.has=lS,li.prototype.set=uS;var ra=ss(Dr,"Map");function hS(){this.size=0,this.__data__={hash:new os,map:new(ra||li),string:new os}}function fS(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Bc(e,t){var n=e.__data__;return fS(t)?n[typeof t=="string"?"string":"hash"]:n.map}function dS(e){var t=Bc(this,e).delete(e);return this.size-=t?1:0,t}function pS(e){return Bc(this,e).get(e)}function mS(e){return Bc(this,e).has(e)}function gS(e,t){var n=Bc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function ui(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ui.prototype.clear=hS,ui.prototype.delete=dS,ui.prototype.get=pS,ui.prototype.has=mS,ui.prototype.set=gS;var yS="Expected a function";function Oh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(yS);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Oh.Cache||ui),n}Oh.Cache=ui;var _S=500;function bS(e){var t=Oh(e,function(r){return n.size===_S&&n.clear(),r}),n=t.cache;return t}var ES=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,wS=/\\(\\)?/g,xS=bS(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(ES,function(n,r,i,s){t.push(i?s.replace(wS,"$1"):r||n)}),t});function ag(e){return e==null?"":$m(e)}function Dc(e,t){return te(e)?e:Nh(e,t)?[e]:xS(ag(e))}var kS=1/0;function ia(e){if(typeof e=="string"||Ic(e))return e;var t=e+"";return t=="0"&&1/e==-kS?"-0":t}function Ch(e,t){t=Dc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ia(t[n++])];return n&&n==r?e:void 0}function TS(e,t,n){var r=e==null?void 0:Ch(e,t);return r===void 0?n:r}function Lh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var cg=rr?rr.isConcatSpreadable:void 0;function AS(e){return te(e)||Uc(e)||!!(cg&&e&&e[cg])}function Mh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=AS),i||(i=[]);++s<o;){var a=e[s];n(a)?Lh(i,a):r||(i[i.length]=a)}return i}function Kn(e){var t=e==null?0:e.length;return t?Mh(e):[]}var lg=ig(Object.getPrototypeOf,Object);function Uh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function vS(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:Uh(e,t,n)}var SS="\\ud800-\\udfff",RS="\\u0300-\\u036f",IS="\\ufe20-\\ufe2f",NS="\\u20d0-\\u20ff",OS=RS+IS+NS,CS="\\ufe0e\\ufe0f",LS="\\u200d",MS=RegExp("["+LS+SS+OS+CS+"]");function ug(e){return MS.test(e)}function US(e){return e.split("")}var hg="\\ud800-\\udfff",FS="\\u0300-\\u036f",PS="\\ufe20-\\ufe2f",BS="\\u20d0-\\u20ff",DS=FS+PS+BS,$S="\\ufe0e\\ufe0f",jS="["+hg+"]",Fh="["+DS+"]",Ph="\\ud83c[\\udffb-\\udfff]",zS="(?:"+Fh+"|"+Ph+")",fg="[^"+hg+"]",dg="(?:\\ud83c[\\udde6-\\uddff]){2}",pg="[\\ud800-\\udbff][\\udc00-\\udfff]",WS="\\u200d",mg=zS+"?",gg="["+$S+"]?",KS="(?:"+WS+"(?:"+[fg,dg,pg].join("|")+")"+gg+mg+")*",GS=gg+mg+KS,HS="(?:"+[fg+Fh+"?",Fh,dg,pg,jS].join("|")+")",YS=RegExp(Ph+"(?="+Ph+")|"+HS+GS,"g");function VS(e){return e.match(YS)||[]}function XS(e){return ug(e)?VS(e):US(e)}function qS(e){return function(t){t=ag(t);var n=ug(t)?XS(t):void 0,r=n?n[0]:t.charAt(0),i=n?vS(n,1).join(""):t.slice(1);return r[e]()+i}}var yg=qS("toUpperCase");function JS(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function ZS(){this.__data__=new li,this.size=0}function QS(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function tR(e){return this.__data__.get(e)}function eR(e){return this.__data__.has(e)}var nR=200;function rR(e,t){var n=this.__data__;if(n instanceof li){var r=n.__data__;if(!ra||r.length<nR-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ui(r)}return n.set(e,t),this.size=n.size,this}function jr(e){var t=this.__data__=new li(e);this.size=t.size}jr.prototype.clear=ZS,jr.prototype.delete=QS,jr.prototype.get=tR,jr.prototype.has=eR,jr.prototype.set=rR;function iR(e,t){return e&&Ah(t,sr(t),e)}var _g=typeof exports=="object"&&exports&&!exports.nodeType&&exports,bg=_g&&typeof module=="object"&&module&&!module.nodeType&&module,sR=bg&&bg.exports===_g,Eg=sR?Dr.Buffer:void 0,wg=Eg?Eg.allocUnsafe:void 0;function oR(e,t){var n=e.length,r=wg?wg(n):new e.constructor(n);return e.copy(r),r}function Bh(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function xg(){return[]}var aR=Object.prototype,cR=aR.propertyIsEnumerable,kg=Object.getOwnPropertySymbols,Dh=kg?function(e){return e==null?[]:(e=Object(e),Bh(kg(e),function(t){return cR.call(e,t)}))}:xg;function lR(e,t){return Ah(e,Dh(e),t)}var uR=Object.getOwnPropertySymbols,hR=uR?function(e){for(var t=[];e;)Lh(t,Dh(e)),e=lg(e);return t}:xg;function Tg(e,t,n){var r=t(e);return te(e)?r:Lh(r,n(e))}function $h(e){return Tg(e,sr,Dh)}function fR(e){return Tg(e,og,hR)}var jh=ss(Dr,"DataView"),zh=ss(Dr,"Promise"),Qs=ss(Dr,"Set"),Ag="[object Map]",dR="[object Object]",vg="[object Promise]",Sg="[object Set]",Rg="[object WeakMap]",Ig="[object DataView]",pR=is(jh),mR=is(ra),gR=is(zh),yR=is(Qs),_R=is(xh),or=Mi;(jh&&or(new jh(new ArrayBuffer(1)))!=Ig||ra&&or(new ra)!=Ag||zh&&or(zh.resolve())!=vg||Qs&&or(new Qs)!=Sg||xh&&or(new xh)!=Rg)&&(or=function(e){var t=Mi(e),n=t==dR?e.constructor:void 0,r=n?is(n):"";if(r)switch(r){case pR:return Ig;case mR:return Ag;case gR:return vg;case yR:return Sg;case _R:return Rg}return t});var bR=Object.prototype,ER=bR.hasOwnProperty;function wR(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&ER.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var $c=Dr.Uint8Array;function xR(e){var t=new e.constructor(e.byteLength);return new $c(t).set(new $c(e)),t}function kR(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var TR=/\w*$/;function AR(e){var t=new e.constructor(e.source,TR.exec(e));return t.lastIndex=e.lastIndex,t}var Ng=rr?rr.prototype:void 0,Og=Ng?Ng.valueOf:void 0;function vR(e){return Og?Object(Og.call(e)):{}}function SR(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var RR="[object Boolean]",IR="[object Date]",NR="[object Map]",OR="[object Number]",CR="[object RegExp]",LR="[object Set]",MR="[object String]",UR="[object Symbol]",FR="[object ArrayBuffer]",PR="[object DataView]",BR="[object Float32Array]",DR="[object Float64Array]",$R="[object Int8Array]",jR="[object Int16Array]",zR="[object Int32Array]",WR="[object Uint8Array]",KR="[object Uint8ClampedArray]",GR="[object Uint16Array]",HR="[object Uint32Array]";function YR(e,t,n){var r=e.constructor;switch(t){case FR:return xR(e);case RR:case IR:return new r(+e);case PR:return kR(e);case BR:case DR:case $R:case jR:case zR:case WR:case KR:case GR:case HR:return SR(e);case NR:return new r;case OR:case MR:return new r(e);case CR:return AR(e);case LR:return new r;case UR:return vR(e)}}function VR(e){return typeof e.constructor=="function"&&!Qo(e)?UA(lg(e)):{}}var XR="[object Map]";function qR(e){return gr(e)&&or(e)==XR}var Cg=Ui&&Ui.isMap,JR=Cg?Fc(Cg):qR,ZR="[object Set]";function QR(e){return gr(e)&&or(e)==ZR}var Lg=Ui&&Ui.isSet,tI=Lg?Fc(Lg):QR,Mg="[object Arguments]",eI="[object Array]",nI="[object Boolean]",rI="[object Date]",iI="[object Error]",Ug="[object Function]",sI="[object GeneratorFunction]",oI="[object Map]",aI="[object Number]",Fg="[object Object]",cI="[object RegExp]",lI="[object Set]",uI="[object String]",hI="[object Symbol]",fI="[object WeakMap]",dI="[object ArrayBuffer]",pI="[object DataView]",mI="[object Float32Array]",gI="[object Float64Array]",yI="[object Int8Array]",_I="[object Int16Array]",bI="[object Int32Array]",EI="[object Uint8Array]",wI="[object Uint8ClampedArray]",xI="[object Uint16Array]",kI="[object Uint32Array]",pe={};pe[Mg]=pe[eI]=pe[dI]=pe[pI]=pe[nI]=pe[rI]=pe[mI]=pe[gI]=pe[yI]=pe[_I]=pe[bI]=pe[oI]=pe[aI]=pe[Fg]=pe[cI]=pe[lI]=pe[uI]=pe[hI]=pe[EI]=pe[wI]=pe[xI]=pe[kI]=!0,pe[iI]=pe[Ug]=pe[fI]=!1;function jc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!ir(e))return e;var a=te(e);if(a)return o=wR(e),PA(e,o);var c=or(e),l=c==Ug||c==sI;if(ta(e))return oR(e);if(c==Fg||c==Mg||l&&!i)return o=l?{}:VR(e),lR(e,iR(o,e));if(!pe[c])return i?e:{};o=YR(e,c),s||(s=new jr);var u=s.get(e);if(u)return u;s.set(e,o),tI(e)?e.forEach(function(f){o.add(jc(f,t,n,f,e,s))}):JR(e)&&e.forEach(function(f,p){o.set(p,jc(f,t,n,p,e,s))});var h=$h,d=a?void 0:h(e);return Gm(d||e,function(f,p){d&&(p=f,f=e[p]),Mc(o,p,jc(f,t,n,p,e,s))}),o}var TI=4;function on(e){return jc(e,TI)}function sa(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var AI="__lodash_hash_undefined__";function vI(e){return this.__data__.set(e,AI),this}function SI(e){return this.__data__.has(e)}function to(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new ui;++t<n;)this.add(e[t])}to.prototype.add=to.prototype.push=vI,to.prototype.has=SI;function Pg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Wh(e,t){return e.has(t)}var RI=1,II=2;function Bg(e,t,n,r,i,s){var o=n&RI,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var h=-1,d=!0,f=n&II?new to:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],m=t[h];if(r)var E=o?r(m,p,h,t,e,s):r(p,m,h,e,t,s);if(E!==void 0){if(E)continue;d=!1;break}if(f){if(!Pg(t,function(w,T){if(!Wh(f,T)&&(p===w||i(p,w,n,r,s)))return f.push(T)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function NI(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Kh(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var OI=1,CI=2,LI="[object Boolean]",MI="[object Date]",UI="[object Error]",FI="[object Map]",PI="[object Number]",BI="[object RegExp]",DI="[object Set]",$I="[object String]",jI="[object Symbol]",zI="[object ArrayBuffer]",WI="[object DataView]",Dg=rr?rr.prototype:void 0,Gh=Dg?Dg.valueOf:void 0;function KI(e,t,n,r,i,s,o){switch(n){case WI:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case zI:return!(e.byteLength!=t.byteLength||!s(new $c(e),new $c(t)));case LI:case MI:case PI:return Zo(+e,+t);case UI:return e.name==t.name&&e.message==t.message;case BI:case $I:return e==t+"";case FI:var a=NI;case DI:var c=r&OI;if(a||(a=Kh),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=CI,o.set(e,t);var u=Bg(a(e),a(t),r,i,s,o);return o.delete(e),u;case jI:if(Gh)return Gh.call(e)==Gh.call(t)}return!1}var GI=1,HI=Object.prototype,YI=HI.hasOwnProperty;function VI(e,t,n,r,i,s){var o=n&GI,a=$h(e),c=a.length,l=$h(t),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in t:YI.call(t,d)))return!1}var f=s.get(e),p=s.get(t);if(f&&p)return f==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var E=o;++h<c;){d=a[h];var w=e[d],T=t[d];if(r)var A=o?r(T,w,d,t,e,s):r(w,T,d,e,t,s);if(!(A===void 0?w===T||i(w,T,n,r,s):A)){m=!1;break}E||(E=d=="constructor")}if(m&&!E){var I=e.constructor,M=t.constructor;I!=M&&"constructor"in e&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof M=="function"&&M instanceof M)&&(m=!1)}return s.delete(e),s.delete(t),m}var XI=1,$g="[object Arguments]",jg="[object Array]",zc="[object Object]",qI=Object.prototype,zg=qI.hasOwnProperty;function JI(e,t,n,r,i,s){var o=te(e),a=te(t),c=o?jg:or(e),l=a?jg:or(t);c=c==$g?zc:c,l=l==$g?zc:l;var u=c==zc,h=l==zc,d=c==l;if(d&&ta(e)){if(!ta(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new jr),o||Ih(e)?Bg(e,t,n,r,i,s):KI(e,t,c,n,r,i,s);if(!(n&XI)){var f=u&&zg.call(e,"__wrapped__"),p=h&&zg.call(t,"__wrapped__");if(f||p){var m=f?e.value():e,E=p?t.value():t;return s||(s=new jr),i(m,E,n,r,s)}}return d?(s||(s=new jr),VI(e,t,n,r,i,s)):!1}function Hh(e,t,n,r,i){return e===t?!0:e==null||t==null||!gr(e)&&!gr(t)?e!==e&&t!==t:JI(e,t,n,r,Hh,i)}var ZI=1,QI=2;function tN(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new jr,h;if(!(h===void 0?Hh(l,c,ZI|QI,r,u):h))return!1}}return!0}function Wg(e){return e===e&&!ir(e)}function eN(e){for(var t=sr(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Wg(i)]}return t}function Kg(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function nN(e){var t=eN(e);return t.length==1&&t[0][2]?Kg(t[0][0],t[0][1]):function(n){return n===e||tN(n,e,t)}}function rN(e,t){return e!=null&&t in Object(e)}function Gg(e,t,n){t=Dc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=ia(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Sh(i)&&Lc(o,i)&&(te(e)||Uc(e)))}function iN(e,t){return e!=null&&Gg(e,t,rN)}var sN=1,oN=2;function aN(e,t){return Nh(e)&&Wg(t)?Kg(ia(e),t):function(n){var r=TS(n,e);return r===void 0&&r===t?iN(n,e):Hh(t,r,sN|oN)}}function cN(e){return function(t){return t==null?void 0:t[e]}}function lN(e){return function(t){return Ch(t,e)}}function uN(e){return Nh(e)?cN(ia(e)):lN(e)}function zr(e){return typeof e=="function"?e:e==null?Zs:typeof e=="object"?te(e)?aN(e[0],e[1]):nN(e):uN(e)}function hN(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function fN(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var dN=fN();function pN(e,t){return e&&dN(e,t,sr)}function mN(e,t){return function(n,r){if(n==null)return n;if(!$r(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var as=mN(pN);function gN(e,t,n,r){return as(e,function(i,s,o){t(r,i,n(i),o)}),r}function yN(e,t){return function(n,r){var i=te(n)?hN:gN,s=t?t():{};return i(n,e,zr(r),s)}}var Hg=Object.prototype,_N=Hg.hasOwnProperty,Yh=vh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Xm(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=og(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||Zo(u,Hg[l])&&!_N.call(e,l))&&(e[l]=s[l])}return e});function Yg(e){return gr(e)&&$r(e)}var bN=200;function EN(e,t,n,r){var i=-1,s=Ym,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=bN&&(s=Wh,o=!1,t=new to(t));t:for(;++i<a;){var u=e[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(t[d]===h)continue t;c.push(u)}else s(t,h,r)||c.push(u)}return c}var Wc=vh(function(e,t){return Yg(e)?EN(e,Mh(t,1,Yg,!0)):[]});function eo(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function an(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Oc(t),Uh(e,t<0?0:t,r)):[]}function oa(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Oc(t),t=r-t,Uh(e,0,t<0?0:t)):[]}function wN(e){return typeof e=="function"?e:Zs}function Nt(e,t){var n=te(e)?Gm:as;return n(e,wN(t))}function xN(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function kN(e,t){var n=!0;return as(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function yr(e,t,n){var r=te(e)?xN:kN;return r(e,zr(t))}function Vg(e,t){var n=[];return as(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function ar(e,t){var n=te(e)?Bh:Vg;return n(e,zr(t))}function TN(e){return function(t,n,r){var i=Object(t);if(!$r(t)){var s=zr(n);t=sr(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var AN=Math.max;function vN(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Oc(n);return i<0&&(i=AN(r+i,0)),Hm(e,zr(t),i)}var no=TN(vN);function _r(e){return e&&e.length?e[0]:void 0}function SN(e,t){var n=-1,r=$r(e)?Array(e.length):[];return as(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function xt(e,t){var n=te(e)?Nc:SN;return n(e,zr(t))}function cr(e,t){return Mh(xt(e,t))}var RN=Object.prototype,IN=RN.hasOwnProperty,Xg=yN(function(e,t,n){IN.call(e,n)?e[n].push(t):Th(e,n,[t])}),NN=Object.prototype,ON=NN.hasOwnProperty;function CN(e,t){return e!=null&&ON.call(e,t)}function Rt(e,t){return e!=null&&Gg(e,t,CN)}var LN="[object String]";function In(e){return typeof e=="string"||!te(e)&&gr(e)&&Mi(e)==LN}function MN(e,t){return Nc(t,function(n){return e[n]})}function Be(e){return e==null?[]:MN(e,sr(e))}var UN=Math.max;function _n(e,t,n,r){e=$r(e)?e:Be(e),n=n&&!r?Oc(n):0;var i=e.length;return n<0&&(n=UN(i+n,0)),In(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&kh(e,t,n)>-1}function qg(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return kh(e,t,i)}var FN="[object Map]",PN="[object Set]",BN=Object.prototype,DN=BN.hasOwnProperty;function me(e){if(e==null)return!0;if($r(e)&&(te(e)||typeof e=="string"||typeof e.splice=="function"||ta(e)||Ih(e)||Uc(e)))return!e.length;var t=or(e);if(t==FN||t==PN)return!e.size;if(Qo(e))return!sg(e).length;for(var n in e)if(DN.call(e,n))return!1;return!0}var $N="[object RegExp]";function jN(e){return gr(e)&&Mi(e)==$N}var Jg=Ui&&Ui.isRegExp,hi=Jg?Fc(Jg):jN;function fi(e){return e===void 0}var zN="Expected a function";function WN(e){if(typeof e!="function")throw new TypeError(zN);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function KN(e,t,n,r){if(!ir(e))return e;t=Dc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=ia(t[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=ir(u)?u:Lc(t[i+1])?[]:{})}Mc(a,c,l),a=a[c]}return e}function GN(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Ch(e,o);n(a,o)&&KN(s,Dc(o,e),a)}return s}function br(e,t){if(e==null)return{};var n=Nc(fR(e),function(r){return[r]});return t=zr(t),GN(e,n,function(r,i){return t(r,i[0])})}function HN(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Nn(e,t,n){var r=te(e)?JS:HN,i=arguments.length<3;return r(e,zr(t),n,i,as)}function Kc(e,t){var n=te(e)?Bh:Vg;return n(e,WN(zr(t)))}function YN(e,t){var n;return as(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function Vh(e,t,n){var r=te(e)?Pg:YN;return r(e,zr(t))}var VN=1/0,XN=Qs&&1/Kh(new Qs([,-0]))[1]==VN?function(e){return new Qs(e)}:Ge,qN=200;function JN(e,t,n){var r=-1,i=Ym,s=e.length,o=!0,a=[],c=a;if(s>=qN){var l=XN(e);if(l)return Kh(l);o=!1,i=Wh,c=new to}else c=a;t:for(;++r<s;){var u=e[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(u)}else i(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function Gc(e){return e&&e.length?JN(e):[]}function Xh(e){console&&console.error&&console.error(`Error: ${e}`)}function Zg(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function Qg(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function ty(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function ZN(e){return QN(e)?e.LABEL:e.name}function QN(e){return In(e.LABEL)&&e.LABEL!==""}class Wr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Nt(this.definition,n=>{n.accept(t)})}}class On extends Wr{constructor(t){super([]),this.idx=1,Rn(this,br(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class ro extends Wr{constructor(t){super(t.definition),this.orgText="",Rn(this,br(t,n=>n!==void 0))}}class Cn extends Wr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Rn(this,br(t,n=>n!==void 0))}}class Ln extends Wr{constructor(t){super(t.definition),this.idx=1,Rn(this,br(t,n=>n!==void 0))}}class Kr extends Wr{constructor(t){super(t.definition),this.idx=1,Rn(this,br(t,n=>n!==void 0))}}class Gr extends Wr{constructor(t){super(t.definition),this.idx=1,Rn(this,br(t,n=>n!==void 0))}}class He extends Wr{constructor(t){super(t.definition),this.idx=1,Rn(this,br(t,n=>n!==void 0))}}class Er extends Wr{constructor(t){super(t.definition),this.idx=1,Rn(this,br(t,n=>n!==void 0))}}class wr extends Wr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Rn(this,br(t,n=>n!==void 0))}}class Se{constructor(t){this.idx=1,Rn(this,br(t,n=>n!==void 0))}accept(t){t.visit(this)}}function tO(e){return xt(e,Hc)}function Hc(e){function t(n){return xt(n,Hc)}if(e instanceof On){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return In(e.label)&&(n.label=e.label),n}else{if(e instanceof Cn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Ln)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof Kr)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Gr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Hc(new Se({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Er)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Hc(new Se({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof He)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof wr)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Se){const n={type:"Terminal",name:e.terminalType.name,label:ZN(e.terminalType),idx:e.idx};In(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=hi(r)?r.source:r),n}else{if(e instanceof ro)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class cs{visit(t){const n=t;switch(n.constructor){case On:return this.visitNonTerminal(n);case Cn:return this.visitAlternative(n);case Ln:return this.visitOption(n);case Kr:return this.visitRepetitionMandatory(n);case Gr:return this.visitRepetitionMandatoryWithSeparator(n);case Er:return this.visitRepetitionWithSeparator(n);case He:return this.visitRepetition(n);case wr:return this.visitAlternation(n);case Se:return this.visitTerminal(n);case ro:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function eO(e){return e instanceof Cn||e instanceof Ln||e instanceof He||e instanceof Kr||e instanceof Gr||e instanceof Er||e instanceof Se||e instanceof ro}function Yc(e,t=[]){return e instanceof Ln||e instanceof He||e instanceof Er?!0:e instanceof wr?Vh(e.definition,r=>Yc(r,t)):e instanceof On&&_n(t,e)?!1:e instanceof Wr?(e instanceof On&&t.push(e),yr(e.definition,r=>Yc(r,t))):!1}function nO(e){return e instanceof wr}function Hr(e){if(e instanceof On)return"SUBRULE";if(e instanceof Ln)return"OPTION";if(e instanceof wr)return"OR";if(e instanceof Kr)return"AT_LEAST_ONE";if(e instanceof Gr)return"AT_LEAST_ONE_SEP";if(e instanceof Er)return"MANY_SEP";if(e instanceof He)return"MANY";if(e instanceof Se)return"CONSUME";throw Error("non exhaustive match")}class Vc{walk(t,n=[]){Nt(t.definition,(r,i)=>{const s=an(t.definition,i+1);if(r instanceof On)this.walkProdRef(r,s,n);else if(r instanceof Se)this.walkTerminal(r,s,n);else if(r instanceof Cn)this.walkFlat(r,s,n);else if(r instanceof Ln)this.walkOption(r,s,n);else if(r instanceof Kr)this.walkAtLeastOne(r,s,n);else if(r instanceof Gr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Er)this.walkManySep(r,s,n);else if(r instanceof He)this.walkMany(r,s,n);else if(r instanceof wr)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Ln({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=ey(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Ln({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=ey(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);Nt(t.definition,s=>{const o=new Cn({definition:[s]});this.walk(o,i)})}}function ey(e,t,n){return[new Ln({definition:[new Se({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function aa(e){if(e instanceof On)return aa(e.referencedRule);if(e instanceof Se)return sO(e);if(eO(e))return rO(e);if(nO(e))return iO(e);throw Error("non exhaustive match")}function rO(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Yc(s),t=t.concat(aa(s)),r=r+1,i=n.length>r;return Gc(t)}function iO(e){const t=xt(e.definition,n=>aa(n));return Gc(Kn(t))}function sO(e){return[e.terminalType]}const ny="_~IN~_";class oO extends Vc{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=cO(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Cn({definition:s}),a=aa(o);this.follows[i]=a}}function aO(e){const t={};return Nt(e,n=>{const r=new oO(n).startWalking();Rn(t,r)}),t}function cO(e,t){return e.name+t+ny}function Ot(e){return e.charCodeAt(0)}function qh(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function ca(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function io(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function lO(){throw Error("Internal Error - Should never get here!")}function ry(e){return e.type==="Character"}const Xc=[];for(let e=Ot("0");e<=Ot("9");e++)Xc.push(e);const qc=[Ot("_")].concat(Xc);for(let e=Ot("a");e<=Ot("z");e++)qc.push(e);for(let e=Ot("A");e<=Ot("Z");e++)qc.push(e);const iy=[Ot(" "),Ot("\f"),Ot(`
`),Ot("\r"),Ot("	"),Ot("\v"),Ot("	"),Ot("Â "),Ot("á"),Ot("â"),Ot("â"),Ot("â"),Ot("â"),Ot("â"),Ot("â"),Ot("â"),Ot("â"),Ot("â"),Ot("â"),Ot("â"),Ot("\u2028"),Ot("\u2029"),Ot("â¯"),Ot("â"),Ot("ã"),Ot("\uFEFF")],uO=/[0-9a-fA-F]/,Jc=/[0-9]/,hO=/[1-9]/;class fO{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":ca(r,"global");break;case"i":ca(r,"ignoreCase");break;case"m":ca(r,"multiLine");break;case"u":ca(r,"unicode");break;case"y":ca(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}io(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return lO()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;io(n);break}if(!(t===!0&&n===void 0)&&io(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),io(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ot(`
`),Ot("\r"),Ot("\u2028"),Ot("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Xc;break;case"D":t=Xc,n=!0;break;case"s":t=iy;break;case"S":t=iy,n=!0;break;case"w":t=qc;break;case"W":t=qc,n=!0;break}if(io(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Ot("\f");break;case"n":t=Ot(`
`);break;case"r":t=Ot("\r");break;case"t":t=Ot("	");break;case"v":t=Ot("\v");break}if(io(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ot("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Ot(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Ot(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,ry(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,ry(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else qh(r.value,t),t.push(Ot("-")),qh(i.value,t)}else qh(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ot("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(hO.test(t)===!1)throw Error("Expecting a positive integer");for(;Jc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Jc.test(t)===!1)throw Error("Expecting an integer");for(;Jc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ot(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Jc.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(uO.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class Jh{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let Zc={};const dO=new fO;function Qc(e){const t=e.toString();if(Zc.hasOwnProperty(t))return Zc[t];{const n=dO.pattern(t);return Zc[t]=n,n}}function pO(){Zc={}}const sy="Complement Sets are not supported for first char optimization",tl=`Unable to use "first char" lexer optimizations:
`;function mO(e,t=!1){try{const n=Qc(e);return Zh(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===sy)t&&Zg(`${tl}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Xh(`${tl}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Zh(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Zh(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":el(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(sy);Nt(o.value,c=>{if(typeof c=="number")el(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)el(u,t,n);else{for(let u=l.from;u<=l.to&&u<ua;u++)el(u,t,n);if(l.to>=ua){const u=l.from>=ua?l.from:ua,h=l.to,d=Fi(u),f=Fi(h);for(let p=d;p<=f;p++)t[p]=p}}}});break;case"Group":Zh(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Qh(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Be(t)}function el(e,t,n){const r=Fi(e);t[r]=r,n===!0&&gO(e,t)}function gO(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Fi(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Fi(i.charCodeAt(0));t[s]=s}}}function oy(e,t){return no(e.value,n=>{if(typeof n=="number")return _n(t,n);{const r=n;return no(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function Qh(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?te(e.value)?yr(e.value,Qh):Qh(e.value):!1}class yO extends Jh{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){_n(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?oy(t,this.targetCharCodes)===void 0&&(this.found=!0):oy(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function tf(e,t){if(t instanceof RegExp){const n=Qc(t),r=new yO(e);return r.visit(n),r.found}else return no(t,n=>_n(e,n.charCodeAt(0)))!==void 0}const ls="PATTERN",la="defaultMode",nl="modes";let ay=typeof new RegExp("(?:)").sticky=="boolean";function _O(e,t){t=Yh(t,{useSticky:ay,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(T,A)=>A()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{jO()});let r;n("Reject Lexer.NA",()=>{r=Kc(e,T=>T[ls]===Ye.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=xt(r,T=>{const A=T[ls];if(hi(A)){const I=A.source;return I.length===1&&I!=="^"&&I!=="$"&&I!=="."&&!A.ignoreCase?I:I.length===2&&I[0]==="\\"&&!_n(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],I[1])?I[1]:t.useSticky?ly(A):cy(A)}else{if(ci(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const I=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),M=new RegExp(I);return t.useSticky?ly(M):cy(M)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=xt(r,T=>T.tokenTypeIdx),a=xt(r,T=>{const A=T.GROUP;if(A!==Ye.SKIPPED){if(In(A))return A;if(fi(A))return!1;throw Error("non exhaustive match")}}),c=xt(r,T=>{const A=T.LONGER_ALT;if(A)return te(A)?xt(A,M=>qg(r,M)):[qg(r,A)]}),l=xt(r,T=>T.PUSH_MODE),u=xt(r,T=>Rt(T,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const T=fy(t.lineTerminatorCharacters);h=xt(r,A=>!1),t.positionTracking!=="onlyOffset"&&(h=xt(r,A=>Rt(A,"LINE_BREAKS")?!!A.LINE_BREAKS:hy(A,T)===!1&&tf(T,A.PATTERN)))});let d,f,p,m;n("Misc Mapping #2",()=>{d=xt(r,uy),f=xt(s,BO),p=Nn(r,(T,A)=>{const I=A.GROUP;return In(I)&&I!==Ye.SKIPPED&&(T[I]=[]),T},{}),m=xt(s,(T,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:h[A],isCustom:d[A],short:f[A],group:a[A],push:l[A],pop:u[A],tokenTypeIdx:o[A],tokenType:r[A]}))});let E=!0,w=[];return t.safeMode||n("First Char Optimization",()=>{w=Nn(r,(T,A,I)=>{if(typeof A.PATTERN=="string"){const M=A.PATTERN.charCodeAt(0),S=Fi(M);ef(T,S,m[I])}else if(te(A.START_CHARS_HINT)){let M;Nt(A.START_CHARS_HINT,S=>{const L=typeof S=="string"?S.charCodeAt(0):S,B=Fi(L);M!==B&&(M=B,ef(T,B,m[I]))})}else if(hi(A.PATTERN))if(A.PATTERN.unicode)E=!1,t.ensureOptimizations&&Xh(`${tl}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const M=mO(A.PATTERN,t.ensureOptimizations);me(M)&&(E=!1),Nt(M,S=>{ef(T,S,m[I])})}else t.ensureOptimizations&&Xh(`${tl}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),E=!1;return T},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:w,hasCustom:i,canBeOptimized:E}}function bO(e,t){let n=[];const r=wO(e);n=n.concat(r.errors);const i=xO(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(EO(s)),n=n.concat(NO(s)),n=n.concat(OO(s,t)),n=n.concat(CO(s)),n}function EO(e){let t=[];const n=ar(e,r=>hi(r[ls]));return t=t.concat(TO(n)),t=t.concat(SO(n)),t=t.concat(RO(n)),t=t.concat(IO(n)),t=t.concat(AO(n)),t}function wO(e){const t=ar(e,i=>!Rt(i,ls)),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Ie.MISSING_PATTERN,tokenTypes:[i]})),r=Wc(e,t);return{errors:n,valid:r}}function xO(e){const t=ar(e,i=>{const s=i[ls];return!hi(s)&&!ci(s)&&!Rt(s,"exec")&&!In(s)}),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ie.INVALID_PATTERN,tokenTypes:[i]})),r=Wc(e,t);return{errors:n,valid:r}}const kO=/[^\\][$]/;function TO(e){class t extends Jh{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=ar(e,i=>{const s=i.PATTERN;try{const o=Qc(s),a=new t;return a.visit(o),a.found}catch{return kO.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ie.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function AO(e){const t=ar(e,r=>r.PATTERN.test(""));return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Ie.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const vO=/[^\\[][\^]|^\^/;function SO(e){class t extends Jh{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=ar(e,i=>{const s=i.PATTERN;try{const o=Qc(s),a=new t;return a.visit(o),a.found}catch{return vO.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ie.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function RO(e){const t=ar(e,r=>{const i=r[ls];return i instanceof RegExp&&(i.multiline||i.global)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ie.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function IO(e){const t=[];let n=xt(e,s=>Nn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!_n(t,a)&&a.PATTERN!==Ye.NA&&(t.push(a),o.push(a)),o),[]));n=sa(n);const r=ar(n,s=>s.length>1);return xt(r,s=>{const o=xt(s,c=>c.name);return{message:`The same RegExp pattern ->${_r(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Ie.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function NO(e){const t=ar(e,r=>{if(!Rt(r,"GROUP"))return!1;const i=r.GROUP;return i!==Ye.SKIPPED&&i!==Ye.NA&&!In(i)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ie.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function OO(e,t){const n=ar(e,i=>i.PUSH_MODE!==void 0&&!_n(t,i.PUSH_MODE));return xt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Ie.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function CO(e){const t=[],n=Nn(e,(r,i,s)=>{const o=i.PATTERN;return o===Ye.NA||(In(o)?r.push({str:o,idx:s,tokenType:i}):hi(o)&&MO(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Nt(e,(r,i)=>{Nt(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&LO(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Ie.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function LO(e,t){if(hi(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(ci(t))return t(e,0,[],{});if(Rt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function MO(e){return no([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function cy(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function ly(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function UO(e,t,n){const r=[];return Rt(e,la)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+la+`> property in its definition
`,type:Ie.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Rt(e,nl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+nl+`> property in its definition
`,type:Ie.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Rt(e,nl)&&Rt(e,la)&&!Rt(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${la}: <${e.defaultMode}>which does not exist
`,type:Ie.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Rt(e,nl)&&Nt(e.modes,(i,s)=>{Nt(i,(o,a)=>{if(fi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Ie.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Rt(o,"LONGER_ALT")){const c=te(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Nt(c,l=>{!fi(l)&&!_n(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Ie.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function FO(e,t,n){const r=[];let i=!1;const s=sa(Kn(Be(e.modes))),o=Kc(s,c=>c[ls]===Ye.NA),a=fy(n);return t&&Nt(o,c=>{const l=hy(c,a);if(l!==!1){const h={message:$O(c,l),type:l.issue,tokenType:c};r.push(h)}else Rt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):tf(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ie.NO_LINE_BREAKS_FLAGS}),r}function PO(e){const t={},n=sr(e);return Nt(n,r=>{const i=e[r];if(te(i))t[r]=[];else throw Error("non exhaustive match")}),t}function uy(e){const t=e.PATTERN;if(hi(t))return!1;if(ci(t))return!0;if(Rt(t,"exec"))return!0;if(In(t))return!1;throw Error("non exhaustive match")}function BO(e){return In(e)&&e.length===1?e.charCodeAt(0):!1}const DO={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function hy(e,t){if(Rt(e,"LINE_BREAKS"))return!1;if(hi(e.PATTERN)){try{tf(t,e.PATTERN)}catch(n){return{issue:Ie.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(In(e.PATTERN))return!1;if(uy(e))return{issue:Ie.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function $O(e,t){if(t.issue===Ie.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Ie.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function fy(e){return xt(e,n=>In(n)?n.charCodeAt(0):n)}function ef(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const ua=256;let rl=[];function Fi(e){return e<ua?e:rl[e]}function jO(){if(me(rl)){rl=new Array(65536);for(let e=0;e<65536;e++)rl[e]=e>255?255+~~(e/255):e}}function ha(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function il(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let dy=1;const py={};function fa(e){const t=zO(e);WO(t),GO(t),KO(t),Nt(t,n=>{n.isParent=n.categoryMatches.length>0})}function zO(e){let t=on(e),n=e,r=!0;for(;r;){n=sa(Kn(xt(n,s=>s.CATEGORIES)));const i=Wc(n,t);t=t.concat(i),me(i)?r=!1:n=i}return t}function WO(e){Nt(e,t=>{gy(t)||(py[dy]=t,t.tokenTypeIdx=dy++),yy(t)&&!te(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),yy(t)||(t.CATEGORIES=[]),HO(t)||(t.categoryMatches=[]),YO(t)||(t.categoryMatchesMap={})})}function KO(e){Nt(e,t=>{t.categoryMatches=[],Nt(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(py[r].tokenTypeIdx)})})}function GO(e){Nt(e,t=>{my([],t)})}function my(e,t){Nt(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),Nt(t.CATEGORIES,n=>{const r=e.concat(t);_n(r,n)||my(r,n)})}function gy(e){return Rt(e,"tokenTypeIdx")}function yy(e){return Rt(e,"CATEGORIES")}function HO(e){return Rt(e,"categoryMatches")}function YO(e){return Rt(e,"categoryMatchesMap")}function VO(e){return Rt(e,"tokenTypeIdx")}const XO={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Ie;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Ie||(Ie={}));const da={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:XO,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(da);let Ye=class{constructor(t,n=da){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Qg(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Rn({},da,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===da.lineTerminatorsPattern)this.config.lineTerminatorsPattern=DO;else if(this.config.lineTerminatorCharacters===da.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),te(t)?i={modes:{defaultMode:on(t)},defaultMode:la}:(s=!1,i=on(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(UO(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(FO(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Nt(i.modes,(a,c)=>{i.modes[c]=Kc(a,l=>fi(l))});const o=sr(i.modes);if(Nt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(bO(a,o))}),me(this.lexerDefinitionErrors)){fa(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=_O(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Rn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!me(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=xt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Nt(this.lexerDefinitionWarning,a=>{Zg(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(ay?(this.chopInput=Zs,this.match=this.matchWithTest):(this.updateLastIndex=Ge,this.match=this.matchWithExec),s&&(this.handleModes=Ge),this.trackStartLines===!1&&(this.computeNewColumn=Zs),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Ge),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Nn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!me(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{pO()}),this.TRACE_INIT("toFastProperties",()=>{ty(this)})})}tokenize(t,n=this.defaultMode){if(!me(this.lexerDefinitionErrors)){const i=xt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,l,u,h,d,f,p,m,E,w;const T=t,A=T.length;let I=0,M=0;const S=this.hasCustom?0:Math.floor(t.length/10),L=new Array(S),B=[];let O=this.trackStartLines?1:void 0,G=this.trackStartLines?1:void 0;const et=PO(this.emptyGroups),C=this.trackStartLines,R=this.config.lineTerminatorsPattern;let b=0,P=[],J=[];const D=[],st=[];Object.freeze(st);let tt;function ft(){return P}function V(Mt){const Xt=Fi(Mt),Ut=J[Xt];return Ut===void 0?st:Ut}const z=Mt=>{if(D.length===1&&Mt.tokenType.PUSH_MODE===void 0){const Xt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Mt);B.push({offset:Mt.startOffset,line:Mt.startLine,column:Mt.startColumn,length:Mt.image.length,message:Xt})}else{D.pop();const Xt=eo(D);P=this.patternIdxToConfig[Xt],J=this.charCodeToPatternIdxToConfig[Xt],b=P.length;const Ut=this.canModeBeOptimized[Xt]&&this.config.safeMode===!1;J&&Ut?tt=V:tt=ft}};function Et(Mt){D.push(Mt),J=this.charCodeToPatternIdxToConfig[Mt],P=this.patternIdxToConfig[Mt],b=P.length,b=P.length;const Xt=this.canModeBeOptimized[Mt]&&this.config.safeMode===!1;J&&Xt?tt=V:tt=ft}Et.call(this,n);let at;const lt=this.config.recoveryEnabled;for(;I<A;){c=null;const Mt=T.charCodeAt(I),Xt=tt(Mt),Ut=Xt.length;for(r=0;r<Ut;r++){at=Xt[r];const Tt=at.pattern;l=null;const Dt=at.short;if(Dt!==!1?Mt===Dt&&(c=Tt):at.isCustom===!0?(w=Tt.exec(T,I,L,et),w!==null?(c=w[0],w.payload!==void 0&&(l=w.payload)):c=null):(this.updateLastIndex(Tt,I),c=this.match(Tt,t,I)),c!==null){if(a=at.longerAlt,a!==void 0){const Ft=a.length;for(s=0;s<Ft;s++){const ke=P[a[s]],Oe=ke.pattern;if(u=null,ke.isCustom===!0?(w=Oe.exec(T,I,L,et),w!==null?(o=w[0],w.payload!==void 0&&(u=w.payload)):o=null):(this.updateLastIndex(Oe,I),o=this.match(Oe,t,I)),o&&o.length>c.length){c=o,l=u,at=ke;break}}}break}}if(c!==null){if(h=c.length,d=at.group,d!==void 0&&(f=at.tokenTypeIdx,p=this.createTokenInstance(c,I,f,at.tokenType,O,G,h),this.handlePayload(p,l),d===!1?M=this.addToken(L,M,p):et[d].push(p)),t=this.chopInput(t,h),I=I+h,G=this.computeNewColumn(G,h),C===!0&&at.canLineTerminator===!0){let Tt=0,Dt,Ft;R.lastIndex=0;do Dt=R.test(c),Dt===!0&&(Ft=R.lastIndex-1,Tt++);while(Dt===!0);Tt!==0&&(O=O+Tt,G=h-Ft,this.updateTokenEndLineColumnLocation(p,d,Ft,Tt,O,G,h))}this.handleModes(at,z,Et,p)}else{const Tt=I,Dt=O,Ft=G;let ke=lt===!1;for(;ke===!1&&I<A;)for(t=this.chopInput(t,1),I++,i=0;i<b;i++){const Oe=P[i],x=Oe.pattern,ot=Oe.short;if(ot!==!1?T.charCodeAt(I)===ot&&(ke=!0):Oe.isCustom===!0?ke=x.exec(T,I,L,et)!==null:(this.updateLastIndex(x,I),ke=x.exec(t)!==null),ke===!0)break}if(m=I-Tt,G=this.computeNewColumn(G,m),E=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(T,Tt,m,Dt,Ft),B.push({offset:Tt,line:Dt,column:Ft,length:m,message:E}),lt===!1)break}}return this.hasCustom||(L.length=M),{tokens:L,groups:et,errors:B}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};Ye.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Ye.NA=/NOT_APPLICABLE/;function pa(e){return _y(e)?e.LABEL:e.name}function _y(e){return In(e.LABEL)&&e.LABEL!==""}const qO="parent",by="categories",Ey="label",wy="group",xy="push_mode",ky="pop_mode",Ty="longer_alt",Ay="line_breaks",vy="start_chars_hint";function Gn(e){return JO(e)}function JO(e){const t=e.pattern,n={};if(n.name=e.name,fi(t)||(n.PATTERN=t),Rt(e,qO))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Rt(e,by)&&(n.CATEGORIES=e[by]),fa([n]),Rt(e,Ey)&&(n.LABEL=e[Ey]),Rt(e,wy)&&(n.GROUP=e[wy]),Rt(e,ky)&&(n.POP_MODE=e[ky]),Rt(e,xy)&&(n.PUSH_MODE=e[xy]),Rt(e,Ty)&&(n.LONGER_ALT=e[Ty]),Rt(e,Ay)&&(n.LINE_BREAKS=e[Ay]),Rt(e,vy)&&(n.START_CHARS_HINT=e[vy]),n}const us=Gn({name:"EOF",pattern:Ye.NA});fa([us]);function sl(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function ZO(e,t){return ha(e,t)}const Sy={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${_y(e)?`--> ${pa(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+_r(t).image+"'";if(r)return s+r+a;{const c=Nn(e,(d,f)=>d.concat(f),[]),l=xt(c,d=>`[${xt(d,f=>pa(f)).join(", ")}]`),h=`one of these possible Token sequences:
${xt(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+_r(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${xt(e,l=>`[${xt(l,u=>pa(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Sy);const QO={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},hs={buildDuplicateFoundError(e,t){function n(u){return u instanceof Se?u.terminalType.name:u instanceof On?u.nonTerminalName:""}const r=e.name,i=_r(t),s=i.idx,o=Hr(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=xt(e.prefixPath,i=>pa(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=xt(e.prefixPath,i=>pa(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Hr(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=xt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof ro?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function tC(e,t){const n=new eC(e,t);return n.resolveRefs(),n.errors}class eC extends cs{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Nt(Be(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:bn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class nC extends Vc{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=on(this.path.ruleStack).reverse(),this.occurrenceStack=on(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){me(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class rC extends nC{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Cn({definition:i});this.possibleTokTypes=aa(s),this.found=!0}}}class ol extends Vc{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class iC extends ol{walkMany(t,n,r){if(t.idx===this.occurrence){const i=_r(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Se&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class Ry extends ol{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=_r(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Se&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class sC extends ol{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=_r(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Se&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class Iy extends ol{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=_r(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Se&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function nf(e,t,n=[]){n=on(n);let r=[],i=0;function s(a){return a.concat(an(e,i+1))}function o(a){const c=nf(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Cn)return o(a.definition);if(a instanceof On)return o(a.definition);if(a instanceof Ln)r=o(a.definition);else if(a instanceof Kr){const c=a.definition.concat([new He({definition:a.definition})]);return o(c)}else if(a instanceof Gr){const c=[new Cn({definition:a.definition}),new He({definition:[new Se({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Er){const c=a.definition.concat([new He({definition:[new Se({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof He){const c=a.definition.concat([new He({definition:a.definition})]);r=o(c)}else{if(a instanceof wr)return Nt(a.definition,c=>{me(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Se)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:an(e,i)}),r}function Ny(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!me(h);){const d=h.pop();if(d===o){a&&eo(h).idx<=l&&h.pop();continue}const f=d.def,p=d.idx,m=d.ruleStack,E=d.occurrenceStack;if(me(f))continue;const w=f[0];if(w===i){const T={idx:p,def:an(f),ruleStack:oa(m),occurrenceStack:oa(E)};h.push(T)}else if(w instanceof Se)if(p<c-1){const T=p+1,A=t[T];if(n(A,w.terminalType)){const I={idx:T,def:an(f),ruleStack:m,occurrenceStack:E};h.push(I)}}else if(p===c-1)u.push({nextTokenType:w.terminalType,nextTokenOccurrence:w.idx,ruleStack:m,occurrenceStack:E}),a=!0;else throw Error("non exhaustive match");else if(w instanceof On){const T=on(m);T.push(w.nonTerminalName);const A=on(E);A.push(w.idx);const I={idx:p,def:w.definition.concat(s,an(f)),ruleStack:T,occurrenceStack:A};h.push(I)}else if(w instanceof Ln){const T={idx:p,def:an(f),ruleStack:m,occurrenceStack:E};h.push(T),h.push(o);const A={idx:p,def:w.definition.concat(an(f)),ruleStack:m,occurrenceStack:E};h.push(A)}else if(w instanceof Kr){const T=new He({definition:w.definition,idx:w.idx}),A=w.definition.concat([T],an(f)),I={idx:p,def:A,ruleStack:m,occurrenceStack:E};h.push(I)}else if(w instanceof Gr){const T=new Se({terminalType:w.separator}),A=new He({definition:[T].concat(w.definition),idx:w.idx}),I=w.definition.concat([A],an(f)),M={idx:p,def:I,ruleStack:m,occurrenceStack:E};h.push(M)}else if(w instanceof Er){const T={idx:p,def:an(f),ruleStack:m,occurrenceStack:E};h.push(T),h.push(o);const A=new Se({terminalType:w.separator}),I=new He({definition:[A].concat(w.definition),idx:w.idx}),M=w.definition.concat([I],an(f)),S={idx:p,def:M,ruleStack:m,occurrenceStack:E};h.push(S)}else if(w instanceof He){const T={idx:p,def:an(f),ruleStack:m,occurrenceStack:E};h.push(T),h.push(o);const A=new He({definition:w.definition,idx:w.idx}),I=w.definition.concat([A],an(f)),M={idx:p,def:I,ruleStack:m,occurrenceStack:E};h.push(M)}else if(w instanceof wr)for(let T=w.definition.length-1;T>=0;T--){const A=w.definition[T],I={idx:p,def:A.definition.concat(an(f)),ruleStack:m,occurrenceStack:E};h.push(I),h.push(o)}else if(w instanceof Cn)h.push({idx:p,def:w.definition.concat(an(f)),ruleStack:m,occurrenceStack:E});else if(w instanceof ro)h.push(oC(w,p,m,E));else throw Error("non exhaustive match")}return u}function oC(e,t,n,r){const i=on(n);i.push(e.name);const s=on(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Ne;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Ne||(Ne={}));function Oy(e){if(e instanceof Ln||e==="Option")return Ne.OPTION;if(e instanceof He||e==="Repetition")return Ne.REPETITION;if(e instanceof Kr||e==="RepetitionMandatory")return Ne.REPETITION_MANDATORY;if(e instanceof Gr||e==="RepetitionMandatoryWithSeparator")return Ne.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Er||e==="RepetitionWithSeparator")return Ne.REPETITION_WITH_SEPARATOR;if(e instanceof wr||e==="Alternation")return Ne.ALTERNATION;throw Error("non exhaustive match")}function aC(e,t,n,r,i,s){const o=sf(e,t,n),a=Uy(o)?il:ha;return s(o,r,a,i)}function cC(e,t,n,r,i,s){const o=of(e,t,i,n),a=Uy(o)?il:ha;return s(o[0],a,r)}function lC(e,t,n,r){const i=e.length,s=yr(e,o=>yr(o,a=>a.length===1));if(t)return function(o){const a=xt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let d=0;d<u;d++){const f=l[d],p=f.length;for(let m=0;m<p;m++){const E=this.LA(m+1);if(n(E,f[m])===!1)continue t}return c}}};if(s&&!r){const o=xt(e,c=>Kn(c)),a=Nn(o,(c,l,u)=>(Nt(l,h=>{Rt(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),Nt(h.categoryMatches,d=>{Rt(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue t}return o}}}}function uC(e,t,n){const r=yr(e,s=>s.length===1),i=e.length;if(r&&!n){const s=Kn(e);if(s.length===1&&me(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Nn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Nt(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class hC extends Vc{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Ne.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Ne.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Ne.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Ne.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Ne.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class Cy extends cs{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Ne.OPTION)}visitRepetition(t){this.checkIsTarget(t,Ne.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Ne.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Ne.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Ne.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Ne.ALTERNATION)}}function Ly(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function rf(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function fC(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function My(e,t){const n=xt(e,o=>nf([o],1)),r=Ly(n.length),i=xt(n,o=>{const a={};return Nt(o,c=>{const l=rf(c.partialPath);Nt(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=Ly(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=rf(h);if(fC(i,f,c)||me(d)||h.length===t){const m=r[c];if(af(m,h)===!1){m.push(h);for(let E=0;E<f.length;E++){const w=f[E];i[c][w]=!0}}}else{const m=nf(d,o+1,h);s[c]=s[c].concat(m),Nt(m,E=>{const w=rf(E.partialPath);Nt(w,T=>{i[c][T]=!0})})}}}}return r}function sf(e,t,n,r){const i=new Cy(e,Ne.ALTERNATION,r);return t.accept(i),My(i.result,n)}function of(e,t,n,r){const i=new Cy(e,n);t.accept(i);const s=i.result,a=new hC(t,e,n).startWalking(),c=new Cn({definition:s}),l=new Cn({definition:a});return My([c,l],r)}function af(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function dC(e,t){return e.length<t.length&&yr(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function Uy(e){return yr(e,t=>yr(t,n=>yr(n,r=>me(r.categoryMatches))))}function pC(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return xt(t,n=>Object.assign({type:bn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function mC(e,t,n,r){const i=cr(e,c=>gC(c,n)),s=RC(e,t,n),o=cr(e,c=>TC(c,n)),a=cr(e,c=>bC(c,e,r,n));return i.concat(s,o,a)}function gC(e,t){const n=new _C;e.accept(n);const r=n.allProductions,i=Xg(r,yC),s=br(i,a=>a.length>1);return xt(Be(s),a=>{const c=_r(a),l=t.buildDuplicateFoundError(e,a),u=Hr(c),h={message:l,type:bn.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=Fy(c);return d&&(h.parameter=d),h})}function yC(e){return`${Hr(e)}_#_${e.idx}_#_${Fy(e)}`}function Fy(e){return e instanceof Se?e.terminalType.name:e instanceof On?e.nonTerminalName:""}class _C extends cs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function bC(e,t,n,r){const i=[];if(Nn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:bn.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function EC(e,t,n){const r=[];let i;return _n(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:bn.INVALID_RULE_OVERRIDE,ruleName:e})),r}function Py(e,t,n,r=[]){const i=[],s=al(t.definition);if(me(s))return[];{const o=e.name;_n(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:bn.LEFT_RECURSION,ruleName:o});const c=Wc(s,r.concat([e])),l=cr(c,u=>{const h=on(r);return h.push(u),Py(e,u,n,h)});return i.concat(l)}}function al(e){let t=[];if(me(e))return t;const n=_r(e);if(n instanceof On)t.push(n.referencedRule);else if(n instanceof Cn||n instanceof Ln||n instanceof Kr||n instanceof Gr||n instanceof Er||n instanceof He)t=t.concat(al(n.definition));else if(n instanceof wr)t=Kn(xt(n.definition,s=>al(s.definition)));else if(!(n instanceof Se))throw Error("non exhaustive match");const r=Yc(n),i=e.length>1;if(r&&i){const s=an(e);return t.concat(al(s))}else return t}class cf extends cs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function wC(e,t){const n=new cf;e.accept(n);const r=n.alternations;return cr(r,s=>{const o=oa(s.definition);return cr(o,(a,c)=>{const l=Ny([a],[],ha,1);return me(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:bn.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function xC(e,t,n){const r=new cf;e.accept(r);let i=r.alternations;return i=Kc(i,o=>o.ignoreAmbiguities===!0),cr(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=sf(a,e,c,o),u=vC(l,o,e,n),h=SC(l,o,e,n);return u.concat(h)})}class kC extends cs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function TC(e,t){const n=new cf;e.accept(n);const r=n.alternations;return cr(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:bn.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function AC(e,t,n){const r=[];return Nt(e,i=>{const s=new kC;i.accept(s);const o=s.allProductions;Nt(o,a=>{const c=Oy(a),l=a.maxLookahead||t,u=a.idx,d=of(u,i,c,l)[0];if(me(Kn(d))){const f=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:f,type:bn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function vC(e,t,n,r){const i=[],s=Nn(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||Nt(c,u=>{const h=[l];Nt(e,(d,f)=>{l!==f&&af(d,u)&&t.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!af(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return xt(s,a=>{const c=xt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:bn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function SC(e,t,n,r){const i=Nn(e,(o,a,c)=>{const l=xt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return sa(cr(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=ar(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&dC(d.path,l));return xt(u,d=>{const f=[d.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:f,prefixPath:d.path}),type:bn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function RC(e,t,n){const r=[],i=xt(t,s=>s.name);return Nt(e,s=>{const o=s.name;if(_n(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:bn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function IC(e){const t=Yh(e,{errMsgProvider:QO}),n={};return Nt(e.rules,r=>{n[r.name]=r}),tC(n,t.errMsgProvider)}function NC(e){return e=Yh(e,{errMsgProvider:hs}),mC(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const By="MismatchedTokenException",Dy="NoViableAltException",$y="EarlyExitException",jy="NotAllInputParsedException",zy=[By,Dy,$y,jy];Object.freeze(zy);function cl(e){return _n(zy,e.name)}class ll extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Wy extends ll{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=By}}class OC extends ll{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Dy}}class CC extends ll{constructor(t,n){super(t,n),this.name=jy}}class LC extends ll{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=$y}}const lf={},Ky="InRuleRecoveryException";class MC extends Error{constructor(t){super(t),this.name=Ky}}class UC{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Rt(t,"recoveryEnabled")?t.recoveryEnabled:di.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=FC)}getTokenToInsert(t){const n=sl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new Wy(f,l,this.LA(0));p.resyncedTokens=oa(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new MC("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||me(n))return!1;const r=this.LA(1);return no(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return _n(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=no(t,s=>ZO(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return lf;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return xt(t,(r,i)=>i===0?lf:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=xt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return Kn(t)}getFollowSetFromFollowKey(t){if(t===lf)return[us];const n=t.ruleName+t.idxInCallingRule+ny+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,us)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return oa(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=on(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return xt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function FC(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=us,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const PC=4,Pi=8,Gy=1<<Pi,Hy=2<<Pi,uf=3<<Pi,hf=4<<Pi,ff=5<<Pi,ul=6<<Pi;function df(e,t,n){return n|t|e}class BC{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:di.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(me(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return cr(t,n=>Py(n,n,hs))}validateEmptyOrAlternatives(t){return cr(t,n=>wC(n,hs))}validateAmbiguousAlternationAlternatives(t,n){return cr(t,r=>xC(r,n,hs))}validateSomeNonEmptyLookaheadPath(t,n){return AC(t,n,hs)}buildLookaheadForAlternation(t){return aC(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,lC)}buildLookaheadForOptional(t){return cC(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Oy(t.prodType),uC)}}class DC{initLooksAhead(t){this.dynamicTokensEnabled=Rt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:di.dynamicTokensEnabled,this.maxLookahead=Rt(t,"maxLookahead")?t.maxLookahead:di.maxLookahead,this.lookaheadStrategy=Rt(t,"lookaheadStrategy")?t.lookaheadStrategy:new BC({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Nt(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=jC(n);Nt(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Hr(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=df(this.fullRuleNameToShort[n.name],Gy,l.idx);this.setLaFuncCache(d,h)})}),Nt(i,l=>{this.computeLookaheadFunc(n,l.idx,uf,"Repetition",l.maxLookahead,Hr(l))}),Nt(s,l=>{this.computeLookaheadFunc(n,l.idx,Hy,"Option",l.maxLookahead,Hr(l))}),Nt(o,l=>{this.computeLookaheadFunc(n,l.idx,hf,"RepetitionMandatory",l.maxLookahead,Hr(l))}),Nt(a,l=>{this.computeLookaheadFunc(n,l.idx,ul,"RepetitionMandatoryWithSeparator",l.maxLookahead,Hr(l))}),Nt(c,l=>{this.computeLookaheadFunc(n,l.idx,ff,"RepetitionWithSeparator",l.maxLookahead,Hr(l))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=df(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return df(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class $C extends cs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const hl=new $C;function jC(e){hl.reset(),e.accept(hl);const t=hl.dslMethods;return hl.reset(),t}function Yy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function Vy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function zC(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function WC(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const KC="name";function Xy(e,t){Object.defineProperty(e,KC,{enumerable:!1,configurable:!0,writable:!1,value:t})}function GC(e,t){const n=sr(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function HC(e,t){const n=function(){};Xy(n,e+"BaseSemantics");const r={visit:function(i,s){if(te(i)&&(i=i[0]),!fi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=VC(this,t);if(!me(i)){const s=xt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function YC(e,t,n){const r=function(){};Xy(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Nt(t,s=>{i[s]=GC}),r.prototype=i,r.prototype.constructor=r,r}var pf;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(pf||(pf={}));function VC(e,t){return XC(e,t)}function XC(e,t){const n=ar(t,i=>ci(e[i])===!1),r=xt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:pf.MISSING_METHOD,methodName:i}));return sa(r)}class qC{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Rt(t,"nodeLocationTracking")?t.nodeLocationTracking:di.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Ge,this.cstFinallyStateUpdate=Ge,this.cstPostTerminal=Ge,this.cstPostNonTerminal=Ge,this.cstPostRule=Ge;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Vy,this.setNodeLocationFromNode=Vy,this.cstPostRule=Ge,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Ge,this.setNodeLocationFromNode=Ge,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Yy,this.setNodeLocationFromNode=Yy,this.cstPostRule=Ge,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Ge,this.setNodeLocationFromNode=Ge,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Ge,this.setNodeLocationFromNode=Ge,this.cstPostRule=Ge,this.setInitialNodeLocation=Ge;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];zC(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];WC(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(fi(this.baseCstVisitorConstructor)){const t=HC(this.className,sr(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(fi(this.baseCstVisitorWithDefaultsConstructor)){const t=YC(this.className,sr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class JC{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):pl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?pl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class ZC{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=ml){if(_n(this.definedRulesNames,t)){const o={message:hs.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:bn.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=ml){const i=EC(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(cl(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return tO(Be(this.gastProductionsCache))}}class QC{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=il,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Rt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(te(t)){if(me(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(te(t))this.tokensMap=Nn(t,(s,o)=>(s[o.name]=o,s),{});else if(Rt(t,"modes")&&yr(Kn(Be(t.modes)),VO)){const s=Kn(Be(t.modes)),o=Gc(s);this.tokensMap=Nn(o,(a,c)=>(a[c.name]=c,a),{})}else if(ir(t))this.tokensMap=on(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=us;const r=Rt(t,"modes")?Kn(Be(t.modes)):Be(t),i=yr(r,s=>me(s.categoryMatches));this.tokenMatcher=i?il:ha,fa(Be(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Rt(r,"resyncEnabled")?r.resyncEnabled:ml.resyncEnabled,s=Rt(r,"recoveryValueFunc")?r.recoveryValueFunc:ml.recoveryValueFunc,o=this.ruleShortNameIdx<<PC+Pi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(cl(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Hy,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(hf,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Ne.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,hf,t,sC)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(ul,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Iy],a,ul,t,Iy)}else throw this.raiseEarlyExitException(t,Ne.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(uf,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,uf,t,iC,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(ff,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Ry],a,ff,t,Ry)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,ul,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(Gy,n),i=te(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new CC(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw cl(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Wy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===Ky?r:s}}else throw r}saveRecogState(){const t=this.errors,n=on(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),us)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class tL{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Rt(t,"errorMessageProvider")?t.errorMessageProvider:di.errorMessageProvider}SAVE_ERROR(t){if(cl(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:on(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return on(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=of(t,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new LC(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=sf(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new OC(c,this.LA(1),a))}}class eL{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(fi(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Ny([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=_r(t.ruleStack),i=this.getGAstProductions()[n];return new rC(i,t).startWalking()}}const fl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(fl);const qy=!0,Jy=Math.pow(2,Pi)-1,Zy=Gn({name:"RECORDING_PHASE_TOKEN",pattern:Ye.NA});fa([Zy]);const Qy=sl(Zy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Qy);const nL={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class rL{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return pl}topLevelRuleRecord(t,n){try{const r=new ro({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return ma.call(this,Ln,t,n)}atLeastOneInternalRecord(t,n){ma.call(this,Kr,n,t)}atLeastOneSepFirstInternalRecord(t,n){ma.call(this,Gr,n,t,qy)}manyInternalRecord(t,n){ma.call(this,He,n,t)}manySepFirstInternalRecord(t,n){ma.call(this,Er,n,t,qy)}orInternalRecord(t,n){return iL.call(this,t,n)}subruleInternalRecord(t,n,r){if(dl(n),!t||Rt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${t_(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=eo(this.recordingProdStack),s=t.ruleName,o=new On({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?nL:fl}consumeInternalRecord(t,n,r){if(dl(n),!gy(t)){const o=new Error(`<CONSUME${t_(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=eo(this.recordingProdStack),s=new Se({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Qy}}function ma(e,t,n,r=!1){dl(n);const i=eo(this.recordingProdStack),s=ci(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Rt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),fl}function iL(e,t){dl(t);const n=eo(this.recordingProdStack),r=te(e)===!1,i=r===!1?e:e.DEF,s=new wr({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Rt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Vh(i,a=>ci(a.GATE));return s.hasPredicates=o,n.definition.push(s),Nt(i,a=>{const c=new Cn({definition:[]});s.definition.push(c),Rt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Rt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),fl}function t_(e){return e===0?"":`${e}`}function dl(e){if(e<0||e>Jy){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${Jy+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class sL{initPerformanceTracer(t){if(Rt(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=di.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=Qg(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function oL(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const pl=sl(us,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(pl);const di=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Sy,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),ml=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var bn;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(bn||(bn={}));let mf=class p1{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{ty(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Nt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=IC({rules:Be(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(me(r)&&this.skipValidations===!1){const i=NC({rules:Be(this.gastProductionsCache),tokenTypes:Be(this.tokensMap),errMsgProvider:hs,grammarName:n}),s=pC({lookaheadStrategy:this.lookaheadStrategy,rules:Be(this.gastProductionsCache),tokenTypes:Be(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),me(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=aO(Be(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Be(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Be(this.gastProductionsCache))})),!p1.DEFER_DEFINITION_ERRORS_HANDLING&&!me(this.definitionErrors))throw t=xt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Rt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Rt(n,"skipValidations")?n.skipValidations:di.skipValidations}};mf.DEFER_DEFINITION_ERRORS_HANDLING=!1,oL(mf,[UC,DC,qC,JC,QC,ZC,tL,eL,rL,sL]);class aL extends mf{constructor(t,n=di){const r=on(n);r.outputCst=!0,super(t,r)}}function cL(e){const t=new lL,n=Be(e);return xt(n,r=>t.visitRule(r))}class lL extends cs{visitRule(t){const n=this.visitEach(t.definition),r=Xg(n,s=>s.propertyName),i=xt(r,(s,o)=>{const a=!Vh(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=xt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:gl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:gl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:gl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:gl(t)}]}visitEachAndOverrideWith(t,n){return xt(this.visitEach(t),r=>Rn({},r,n))}visitEach(t){return Kn(xt(t,n=>this.visit(n)))}}function gl(e){return e instanceof On?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function uL(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(Kn(xt(e,r=>hL(r)))),t.includeVisitorInterface&&(n=n.concat(mL(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function hL(e){const t=fL(e),n=dL(e);return[t,n]}function fL(e){const t=n_(e.name),n=gf(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function dL(e){return`export type ${gf(e.name)} = {
  ${xt(e.properties,n=>pL(n)).join(`
  `)}
};`}function pL(e){const t=yL(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function mL(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${xt(t,n=>gL(n)).join(`
  `)}
}`}function gL(e){const t=gf(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function yL(e){if(te(e)){const t=Gc(xt(e,r=>e_(r)));return"("+Nn(t,(r,i)=>r+" | "+i)+")"}else return e_(e)}function e_(e){return e.kind==="token"?"IToken":n_(e.name)}function n_(e){return yg(e)+"CstNode"}function gf(e){return yg(e)+"CstChildren"}const _L={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function bL(e,t){const n=Object.assign(Object.assign({},_L),t),r=cL(e);return uL(r,n)}const Yr=!!JSON.parse("false"),EL=!!JSON.parse("false");JSON.parse("false");const wL=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const pi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Ac*pi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return vc*pi.DRAW_CHAR_SCALE}},yl=jp(32,126).map(e=>String.fromCharCode(e));function Gt(e){return Gn({...e,name:`token_${e.name}`})}function Bi(e,t=!1){return Gt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:cn,group:Ye.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:cn})}const ga=Gt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),xL=Gt({name:"whitespace",pattern:/ +/,group:Ye.SKIPPED}),kL=Gt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Ye.SKIPPED}),yf=Gt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),so=Gt({name:"command",pattern:/#/,start_chars_hint:["#"]});let r_=!1;function TL(e,t,n){if(!r_)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==ga)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const _f=Gt({name:"text",pattern:TL,line_breaks:!1,start_chars_hint:yl.filter(e=>"@#/?':!".includes(e)===!1)}),i_=Gt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),s_=Gt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),o_=Gt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),a_=Gt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),cn=Gt({name:"stringliteral",pattern:/[^-0-9"!;@#/?()\s]+[^-"!;@#/?()\s]*/,start_chars_hint:yl}),c_=Gt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),l_=Gt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),u_=Gt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:cn}),h_=Gt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:cn}),f_=Gt({name:"islessthan",pattern:/<|below/,longer_alt:cn}),d_=Gt({name:"isgreaterthan",pattern:/>|above/,longer_alt:cn}),p_=Gt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:cn}),m_=Gt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:cn}),bf=Gt({name:"or",pattern:/or/i,longer_alt:cn}),Ef=Gt({name:"not",pattern:/not/i,longer_alt:cn}),wf=Gt({name:"and",pattern:/and/i,longer_alt:cn}),xf=Gt({name:"plus",pattern:/\+/}),kf=Gt({name:"minus",pattern:/-/}),g_=Gt({name:"power",pattern:/\*\*/}),y_=Gt({name:"multiply",pattern:/\*/}),Tf=Gt({name:"divide",pattern:/\//}),__=Gt({name:"moddivide",pattern:/%/}),b_=Gt({name:"floordivide",pattern:/%%/}),E_=Gt({name:"query",pattern:/\?/}),w_=Gt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),x_=Gt({name:"rparen",pattern:/\)/,pop_mode:!0}),k_=Gt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:yl,longer_alt:cn}),T_=Gt({name:"command_toast",pattern:/toast .*/,start_chars_hint:yl,longer_alt:cn}),Af=Gt({name:"if",pattern:/if|try|take|give/,longer_alt:cn}),_l=Bi("do"),vf=Bi("done"),Sf=Bi("else"),A_=Bi("while"),v_=Bi("repeat"),S_=Bi("waitfor"),R_=Gt({name:"foreach",pattern:/foreach|for/,longer_alt:cn}),I_=Bi("break"),N_=Bi("continue");function O_(e){return[...e,l_,u_,h_,p_,f_,m_,d_,bf,Ef,wf,xf,kf,g_,y_,Tf,b_,__,E_,w_,x_,c_,cn]}const C_=O_([_f,yf,k_,T_,so,i_,s_,o_,a_,ga,xL,I_,N_,vf,_l,Sf,R_,Af,v_,S_,A_]),AL=new Ye({defaultMode:"use_newlines",modes:{use_newlines:C_,ignore_newlines:O_([kL])}},{skipValidations:!Yr,ensureOptimizations:Yr});function Rf(e){r_=!0;const t=AL.tokenize(e||` 
`),[n]=(ae(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(sl(ga,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function vL(e,t,n=!0){if(n){const[r,...i]=t;switch(Lt(r??"")){default:return{type:wt.OBJECT,values:t};case"loader":return{type:wt.LOADER,values:i};case"board":return{type:wt.BOARD,values:i};case"object":return{type:wt.OBJECT,values:i};case"terrain":return{type:wt.TERRAIN,values:i};case"charset":return{type:wt.CHARSET,values:i};case"palette":return{type:wt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Lt(i??""),a=[r,e,...s];switch(o){default:return{type:wt.CONST,values:t};case"rn":case"range":return{type:wt.RANGE,values:a};case"sl":case"select":return{type:wt.SELECT,values:a};case"nm":case"number":return{type:wt.NUMBER,values:a};case"tx":case"text":return{type:wt.TEXT,values:a};case"ln":case"link":return{type:wt.LINK,values:a};case"hk":case"hotkey":return{type:wt.HOTKEY,values:a};case"copyit":return{type:wt.COPYIT,values:a};case"openit":return{type:wt.OPENIT,values:a};case"zssedit":return{type:wt.ZSSEDIT,values:a};case"charedit":return{type:wt.CHAREDIT,values:a};case"coloredit":return{type:wt.COLOREDIT,values:a}}}}function Hn(e){switch(e){case wt.LOADER:return"loader";case wt.BOARD:return"board";case wt.OBJECT:return"object";case wt.TERRAIN:return"terrain";case wt.CHARSET:return"charset";case wt.PALETTE:return"palette";case wt.CONST:return"const";case wt.RANGE:return"range";case wt.SELECT:return"select";case wt.NUMBER:return"number";case wt.TEXT:return"text";case wt.LINK:return"link";case wt.HOTKEY:return"hotkey";case wt.COPYIT:return"copyit";case wt.OPENIT:return"openit";case wt.ZSSEDIT:return"zssedit";case wt.CHAREDIT:return"charedit";case wt.COLOREDIT:return"coloredit"}}var If=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(If||{});function L_(e){return Js(e,If,{bits:t=>Array.from(t)})}function M_(e){return Yo(e,If,{bits:t=>new Uint8Array(t)})}function SL(e,t){return{id:Ce(),code:e,...t}}var Nf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Nf||{});function RL(e){return Js(e,Nf,{board:NT,object:Ec,terrain:Ec,charset:L_,palette:L_,stats:xe})}function IL(e){return Yo(e,Nf,{board:OT,object:wc,terrain:wc,charset:M_,palette:M_})}function ya(e){const t={...fs(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function NL(e){return k(e)?(e.stats=void 0,fs(e)):{}}function U_(e){const t=Rf(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===yf){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=vL(kt(c)?c:"",l,r),h=Lt(u.values.join(" "));switch(r=!1,u.type){case wt.LOADER:n.type=_t.LOADER,n.name=h;break;case wt.BOARD:n.type=_t.BOARD,n.name=h;break;case wt.OBJECT:n.type=_t.OBJECT,n.name=h||"object";break;case wt.TERRAIN:n.type=_t.TERRAIN,n.name=h;break;case wt.CHARSET:n.type=_t.CHARSET,n.name=h;break;case wt.PALETTE:n.type=_t.PALETTE,n.name=h;break;case wt.CONST:{const[d,f]=u.values;if(kt(d)){const p=Lt(d);if(kt(f)){const m=parseFloat(f);n[p]=St(m)?m:f}else St(f)?n[p]=f:n[p]=1}break}case wt.RANGE:case wt.SELECT:case wt.NUMBER:case wt.TEXT:case wt.LINK:case wt.HOTKEY:case wt.ZSSEDIT:case wt.CHAREDIT:case wt.COLOREDIT:{const[d,...f]=u.values;if(kt(d)){const p=Lt(d);n[p]=[Hn(u.type),...f]}break}}}}return n}function fs(e){var t;return k(e)?(k((t=e.stats)==null?void 0:t.type)||(e.stats=U_(e.code),k(e.stats.type)||(e.stats.type=_t.OBJECT)),e.stats):{}}function F_(e){switch(e){default:case _t.ERROR:return"error";case _t.LOADER:return Hn(wt.LOADER);case _t.BOARD:return Hn(wt.BOARD);case _t.OBJECT:return Hn(wt.OBJECT);case _t.TERRAIN:return Hn(wt.TERRAIN);case _t.CHARSET:return Hn(wt.CHARSET);case _t.PALETTE:return Hn(wt.PALETTE)}}function mi(e){return fs(e).type??_t.ERROR}function gi(e){return F_(mi(e))}function Ue(e){return fs(e).name??""}function P_(e,t){return fs(e)[t]}const bl=new nh;function Of(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ae(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Ht.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Ht.ISSWIM;break;case"issolid":t.collision=Ht.ISSOLID;break;case"isbullet":t.collision=Ht.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function De(e){var t;if(k(e))switch(mi(e)){default:return;case _t.ERROR:return e.code??"";case _t.LOADER:return e.code??"";case _t.BOARD:{k(e.board)||(e.board=vm()),e.board.id=e.id;const n=ya(e);return e.board.isdark=n.isdark??e.board.isdark?1:0,e.board.startx=n.startx??e.board.startx,e.board.starty=n.starty??e.board.starty,e.board.over=n.over??e.board.over,e.board.under=n.under??e.board.under,e.board.camera=n.camera??e.board.camera,e.board.exitnorth=n.exitnorth??e.board.exitnorth,e.board.exitsouth=n.exitsouth??e.board.exitsouth,e.board.exitwest=n.exitwest??e.board.exitwest,e.board.exiteast=n.exiteast??e.board.exiteast,e.board.timelimit=n.timelimit??e.board.timelimit,e.board.restartonzap=n.restartonzap??e.board.restartonzap,e.board.maxplayershots=n.maxplayershots??e.board.maxplayershots,e.board}case _t.OBJECT:return k(e.object)||(e.object=Tm()),e.object.name=Ue(e),e.object.category=Dn.ISOBJECT,Of(ya(e),e.object),e.object;case _t.TERRAIN:return k(e.terrain)||(e.terrain=Tm()),e.terrain.name=Ue(e),e.terrain.category=Dn.ISTERRAIN,Of(ya(e),e.terrain),e.terrain;case _t.PALETTE:{if(k(e.palette)||(e.palette=Lm(qT)),k((t=e.palette)==null?void 0:t.bits)){const n=ya(e),r=Xn(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&kt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){bl.set(o);const c=a*Tc,l=bl.r*63,u=bl.g*63,h=bl.b*63;e.palette.bits[c+0]=rn(l,0,63),e.palette.bits[c+1]=rn(u,0,63),e.palette.bits[c+2]=rn(h,0,63)}}}}return e.palette}case _t.CHARSET:return k(e.charset)||(e.charset=Mm(XT)),e.charset}}function B_(e){return{id:Ce(),name:I1(),timestamp:0,activelist:[],pages:e,flags:{}}}var Cf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(Cf||{});function OL(e){return Js(e,Cf,{pages:t=>t.map(RL),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function CL(e){return Yo(e,Cf,{pages:t=>t.map(IL)})}function D_(e){k(e)&&(e.token=`${N1()}${tr(1111,9999)}`)}function yi(e,t){if(!k(e))return;const n=Lt(t);return e.pages.find(i=>i.id===t||n===Ue(i))}function En(e,t,n){if(!k(e))return;const r=Lt(n);return e.pages.find(s=>mi(s)===t&&(s.id===n||r===Ue(s)))}function Lf(e,t,n){let r=En(e,t,n);if(!k(r)){const i=F_(t);r=SL(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),j_(e,r)}return r}function ds(e,t){return k(e)?e.pages.filter(n=>mi(n)===t):[]}function Mn(e,t,n){if(!k(e))return[];const r=Lt(n);return e.pages.filter(s=>mi(s)===t).filter(s=>{const o=fs(s),a=Lt(Ue(s));return s.id===n||r===a||k(o[n])})}function El(e){return k(e)?qe(e.pages).sort((n,r)=>{const i=mi(n),s=mi(r);return i===s?Ue(n).localeCompare(Ue(r)):s-i}):[]}function $_(e,t){if(k(t)){const n=En(e,_t.TERRAIN,t.kind??"");if(k(n))return n;const r=En(e,_t.OBJECT,t.kind??"");if(k(r))return r}}function j_(e,t){if(!k(e)||!k(t))return!1;const n=yi(e,t.id);return k(n)?!1:(e.pages.push(t),D_(e),!0)}function z_(e,t){const n=yi(e,t);if(k(e)&&k(n)){const r=Lt(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Ue(i)),D_(e),n}}function xr(e,t){if(k(t)&&k(t.kind))return k(t.kinddata)||(t.kinddata=k(t.id)?_a(e,t.kind):Mf(e,t.kind)),t.kinddata}function oo(e,t,n){const r=xr(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function W_(e,t,n,r,i){const s=xr(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function _a(e,t){const n=t??"",r=En(e,_t.OBJECT,n);if(k(r)){const i=De(r);return{...qe(i),name:n,code:r.code}}}function Mf(e,t){const n=t??"",r=En(e,_t.TERRAIN,n);if(k(r)){const i=De(r);return{...qe(i),name:n,code:r.code}}}function Di(e,t){const n=yi(e,t);return De(n)}function _i(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function K_(e,t){e&&delete e.flags[t]}function G_(e,t,n){const r=_i(e,t);return r==null?void 0:r[n]}function LL(e,t,n,r){const i=_i(e,t);return i&&(i[n]=r),r}function ps(e,t){const n=G_(e,t,"board");return Di(e,kt(n)?n:"")}function ML(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function wl(e,t,n){if(!k(e))return;LL(e,t,"board",n);const r=Di(e,n);k(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function ao(e,t,n,r){if(!k(e))return;const i=ps(e,t);if(!k(i))return;const s=gn(i,t);if(!Li(s)||!(s!=null&&s.id))return;const o=Di(e,n);if(!k(o)||(ln(e,o),Pf(e,o,Ht.ISWALK,r)))return;delete i.objects[s.id];const a=mr(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=mr(o,s);o.lookup&&(o.lookup[c]=s.id),wl(e,t,o.id)}function UL(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=G_(e,r,"board");return kt(i)?i:""});return Zk(n)}function Uf(e){const t=UL(e),n=new Set,r=[];for(let i=0;i<t.length;++i){const s=Di(e,t[i]);if(k(s)&&!n.has(s.id)){if(kt(s.over))if(kt(s.overboard)){const o=Di(e,s.overboard);k(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=Mn(e,_t.BOARD,s.over);if(o.length){const a=we(o),c=De(a);k(c)&&(s.overboard=c.id)}}else kt(s.overboard)&&delete s.overboard;if(r.push(s),kt(s.under))if(kt(s.underboard)){const o=Di(e,s.underboard);k(o)||delete s.underboard}else{const o=Mn(e,_t.BOARD,s.under);if(o.length){const a=we(o),c=De(a);k(c)&&(s.underboard=c.id)}}else kt(s.underboard)&&delete s.underboard}}return r}function H_(e){return Ju(e.x,e.y,0,It-1,re-1,0)}function FL(e,t,n,r,i){if(!k(t))return;k(t.distmaps)||(t.distmaps={});const s=`${n}.${r.x}.${r.y}.${i.x}.${i.y}`;let o=t.distmaps[s];if(!k(o)){o=new Array(Am).fill(-2);const a=[{...i}];let c=0;for(;a.length;){const l=a.shift();if(k(l)&&H_(l)){const u=Ks(l,It);if(o[u]===-2){const h=Vo(t,l.x,l.y);kc(n,oo(e,h,"collision")??Ht.ISWALK)||(o[u]=c,a.push({x:l.x,y:l.y-1},{x:l.x,y:l.y+1},{x:l.x-1,y:l.y},{x:l.x+1,y:l.y})),++c}}}t.distmaps[s]=o}return o}function Y_(e,t){return H_(e)?t[Ks(e,It)]:-1}function V_(e,t,n,r,i,s){if(!k(e)||!k(t))return;const o=FL(e,t,n,r,i);if(!k(o))return;const a=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let c;if(s){let l=s?0:1e4;for(let u=0;u<a.length;++u){const h=Y_(a[u],o);h>=0&&h>l&&(l=h,c=a[u])}}else{let l=1e5;for(let u=0;u<a.length;++u){const h=Y_(a[u],o);h>=0&&h<l&&(l=h,c=a[u])}}return c}function ln(e,t){var a;if(!k(e)||!k(t)||k(t.lookup)&&k(t.named))return;const n=new Array(It*re).fill(void 0),r={},i=Object.values(t.objects);for(let c=0;c<i.length;++c){const l=i[c];if(k(l.x)&&k(l.y)&&k(l.id)&&!k(l.removed)){l.category=Dn.ISOBJECT,n[l.x+l.y*It]=l.id;const u=Lt(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<t.terrain.length;++c){const l=t.terrain[c];if(k(l)){l.x=s,l.y=o,l.category=Dn.ISTERRAIN;const u=Br(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=It&&(s=0,++o)}t.lookup=n,t.named=r}function X_(e,t,n,r){var s;if(!k(e)||!k(t)||!k(t.named)||!k(n))return;const i=Lt(n.name??((s=n.kinddata)==null?void 0:s.name)??"");t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function PL(e,t,n){if(!(!k(e)||!k(t)||!k(t.lookup)||!k(n==null?void 0:n.id))&&!k(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*It]=n.id}}function BL(e,t,n){var r;if(k(e)&&k(t)&&k(n==null?void 0:n.x)&&k(n.y)){const i=Br(n),s=mr(t,n);k((r=t.named)==null?void 0:r[i])&&t.named[i].delete(s)}}function Ff(e,t,n){var r;if(k(e)&&k(t)&&k(n==null?void 0:n.id)){if(k(t.lookup)&&k(n.x)&&k(n.y)){const s=n.x+n.y*It;t.lookup[s]===n.id&&(t.lookup[s]=void 0)}const i=Br(n);k((r=t.named)==null?void 0:r[i])&&k(n.id)&&t.named[i].delete(n.id)}}function q_(e,t,n,r,i,s){if(!k(e)||!k(t)||!k(n))return{x:0,y:0};const o={x:n.x??0,y:n.y??0},a={x:n.lx??o.x,y:n.ly??o.y},c=oi(a,o),l=It-1,u=re-1;for(let h=0;h<i.length;++h){const d=Qk(i[h]);switch(d){case mt.IDLE:break;case mt.NORTH:case mt.SOUTH:case mt.WEST:case mt.EAST:Pe(o,d);break;case mt.BY:{const[f,p]=i.slice(h+1);St(f)&&St(p)&&(o.x=rn(o.x+f,0,l),o.y=rn(o.y+p,0,u)),h+=2;break}case mt.TO:case mt.AT:{const[f,p]=i.slice(h+1);St(f)&&St(p)&&(o.x=rn(f,0,l),o.y=rn(p,0,u)),h+=2;break}case mt.FLOW:Pe(o,c);break;case mt.SEEK:{const f=UT(t,n,r);Vs(f)&&Pe(o,oi(s,f));break}case mt.RNDNS:Pe(o,we(mt.NORTH,mt.SOUTH));break;case mt.RNDNE:Pe(o,we(mt.NORTH,mt.EAST));break;case mt.RND:Pe(o,we(mt.NORTH,mt.SOUTH,mt.WEST,mt.EAST));break;case mt.CW:case mt.CCW:case mt.OPP:case mt.RNDP:{const f=q_(e,t,n,r,i.slice(h+1),s);switch(o.x=s.x,o.y=s.y,d){case mt.CW:switch(oi(s,f)){case mt.NORTH:Pe(o,mt.EAST);break;case mt.SOUTH:Pe(o,mt.WEST);break;case mt.EAST:Pe(o,mt.SOUTH);break;case mt.WEST:Pe(o,mt.NORTH);break}break;case mt.CCW:switch(oi(s,f)){case mt.NORTH:Pe(o,mt.WEST);break;case mt.SOUTH:Pe(o,mt.EAST);break;case mt.EAST:Pe(o,mt.NORTH);break;case mt.WEST:Pe(o,mt.SOUTH);break}break;case mt.OPP:switch(oi(s,f)){case mt.NORTH:Pe(o,mt.SOUTH);break;case mt.SOUTH:Pe(o,mt.NORTH);break;case mt.EAST:Pe(o,mt.WEST);break;case mt.WEST:Pe(o,mt.EAST);break}break;case mt.RNDP:switch(oi(s,f)){case mt.NORTH:case mt.SOUTH:o.x+=we(-1,1);break;case mt.WEST:case mt.EAST:o.y+=we(-1,1);break}break}break}case mt.FLEE:case mt.AWAY:{const[f,p]=i.slice(h+1);if(St(f)&&St(p)){const m={x:rn(f,0,l),y:rn(p,0,u)},E=oo(e,n,"collision"),w=V_(e,t,E,o,m,!0);k(w)&&(o.x=w.x,o.y=w.y)}h+=2;break}case mt.FIND:case mt.TOWARD:{const[f,p]=i.slice(h+1);if(St(f)&&St(p)){const m={x:rn(f,0,l),y:rn(p,0,u)};if(tr(1,100)<5)Pe(o,we(mt.NORTH,mt.SOUTH,mt.WEST,mt.EAST));else{const E=oo(e,n,"collision"),w=V_(e,t,E,o,m,!1);if(k(w))if(w.x!==f&&w.y!==p&&MT(t,w))switch(oi(s,w)){case mt.EAST:case mt.WEST:o.y+=we(-1,1);break;case mt.NORTH:case mt.SOUTH:o.x+=we(-1,1);break}else o.x=w.x,o.y=w.y}}h+=2;break}case mt.PLAYER:{const f=Xo(t,s,r);Vs(f)&&(o.x=f.x,o.y=f.y);break}}}return o}function DL(e,t,n,r){if(k(e)&&k(t)&&k(n)){const[i,s]=n,o=_a(e,i);if(k(o)&&k(o.name)){const a=bh(t,r,i);return xc(a,s),a}}}function ms(e,t,n,r,i){if(k(e)&&k(t)&&k(n)){const[s,o]=n,a=Mf(e,s);if(k(a)){const l=LT(t,r,s);if(k(l)){xc(l,o);const u=Ks(r,It);return xr(e,l),X_(e,t,l,u),l}}const c=_a(e,s);if(k(c)&&k(c.name)){const l=bh(t,r,s,i);if(k(l))return xc(l,o),PL(e,t,l),xr(e,l),X_(e,t,l),l}}}function kr(e,t,n,r){return!k(n)||Br(n)==="player"?!1:(n.id?(n.removed=r,Ff(e,t,n)):(Sn(t,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),BL(e,t,n)),!0)}function Pf(e,t,n,r){if(!k(e)||!k(t)||!k(t.lookup)||r.x<0||r.x>=It||r.y<0||r.y>=re)return!0;const i=r.x+r.y*It,s=gn(t,t.lookup[i]??"404");if(k(s))return!0;const o=t.terrain[i];if(k(o)){const a=xr(e,o),c=o.collision??(a==null?void 0:a.collision);return kc(n,c)}return!1}function $L(e,t,n,r){const i=gn(t,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=oo(e,i,"collision");return Pf(e,t,a,r)}function J_(e,t,n,r){var d;const i=gn(t,(n==null?void 0:n.id)??"");if(!k(e)||!k(t)||!k(i)||!k(i.x)||!k(i.y)||!k(t.lookup)||r.x<0||r.x>=It||r.y<0||r.y>=re)return{name:"edge",kind:"edge",collision:Ht.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=mr(t,i),o=mr(t,r),a=oo(e,i,"collision")??Ht.ISWALK,c=vr(i==null?void 0:i.id),l=gn(t,t.lookup[o]??""),u=vr((l==null?void 0:l.id)??"");if(k(l)&&(!c||!u))return{...l};const h=t.terrain[o];if(k(h)){const f=h.collision??((d=h==null?void 0:h.kinddata)==null?void 0:d.collision)??Ht.ISWALK;if(kc(a,f))return{...h,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,k(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function jL(e,t,n){const r=[];if(!k(e)||!k(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];k(o.id)&&k(o.removed)&&n-o.removed>Ma*5&&(r.push(o.id),Sm(t,o.id))}return r}function zL(e,t,n){const r=[];if(!k(e)||!k(t))return r;t.lookup=void 0,ln(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!k(a.id))continue;a.lx=a.x,a.ly=a.y;const c=xr(e,a),l=`${(c==null?void 0:c.code)??""}
${a.code??""}`;l&&r.push({id:a.id,type:_t.OBJECT,code:l,object:a,terrain:void 0})}const s=jL(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:_t.ERROR,code:"",object:void 0,terrain:void 0});return r}var Z_={exports:{}},Bf={exports:{}},Q_;function WL(){return Q_||(Q_=1,function(e,t){(function(n,r){e.exports=r()})(Tn,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(m){if(m)for(var E=0;E<u.length;E++)m[u[E]]!==void 0&&this["set"+r(u[E])](m[u[E]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",E=this.getLineNumber()||"",w=this.getColumnNumber()||"",T=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+E+":"+w+")":"[eval]:"+E+":"+w:T?T+" ("+m+":"+E+":"+w+")":m+":"+E+":"+w}},h.fromString=function(E){var w=E.indexOf("("),T=E.lastIndexOf(")"),A=E.substring(0,w),I=E.substring(w+1,T).split(","),M=E.substring(T+1);if(M.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(M,""),L=S[1],B=S[2],O=S[3];return new h({functionName:A,args:I||void 0,fileName:L,lineNumber:B||void 0,columnNumber:O||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+r(s[d])]=i(s[d]),h.prototype["set"+r(s[d])]=function(m){return function(E){this[m]=!!E}}(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=i(o[f]),h.prototype["set"+r(o[f])]=function(m){return function(E){if(!n(E))throw new TypeError(m+" must be a Number");this[m]=Number(E)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(E){this[m]=String(E)}}(a[p]);return h})}(Bf)),Bf.exports}(function(e,t){(function(n,r){e.exports=r(WL())})(Tn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,m=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:m,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;f.match(/\(([^)]*)\)/)&&(m=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var E=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:E,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Z_);var KL=Z_.exports,GL=ks(KL);function bi(e){const t={},n={tick(){},everytick(){},listcommands(){return Xn(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function be(e){return`${e??""}`}function ba(e,t){const n=parseFloat(be(e));return isNaN(n)?t:n}function tb(e,t,n){var i;const[r]=rt(t,0,[W.MAYBE_NAME]);AE(Y,e,((i=_.board)==null?void 0:i.id)??"",r??"",n)}function lr(e,t,n,r){const[i,s]=rt(r,0,[W.NUMBER_OR_STRING,W.MAYBE_NUMBER_OR_STRING]);Od(Y,e,t,n,i,s)}const HL=["echo","reverb","phaser","distortion","vibrato","fc"];function eb(e,t,n){const[r,i]=rt(n,0,[W.NUMBER_OR_STRING]);if(St(r))tu(Y,e,t,"volume",r);else if(HL.includes(Lt(r))){const[s,o]=rt(n,i,[W.NUMBER_OR_STRING,W.MAYBE_NUMBER_OR_STRING]);Od(Y,e,t,r,s,o)}else{const[s]=rt(n,i,[W.MAYBE_NUMBER_OR_STRING]);if(St(s)){const o=n.length-i,a=new Array(o).fill(W.NUMBER),c=rt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;tu(Y,e,t,r,l)}else{const[o]=rt(n,i,[W.MAYBE_NUMBER_OR_STRING]);tu(Y,e,t,r,o)}}}const Df=bi().command("talk",(e,t)=>{const[n]=rt(t,0,[W.ANY]);switch(Lt(n)){default:oE(Y,_.elementfocus);break;case"stop":aE(Y,_.elementfocus);break}return 0}).command("media",(e,t)=>{const[n]=rt(t,0,[W.ANY]);switch(Lt(n)){default:cE(Y,_.elementfocus);break;case"stop":lE(Y,_.elementfocus);break}return 0}).command("tts",(e,t)=>{const[n,r]=rt(t,0,[W.STRING]),i=t.slice(r).map(be).join("");return kE(Y,_.elementfocus,n,i),0}).command("tta",(e,t)=>{const n=t.map(be).join("");return TE(Y,_.elementfocus,n),0}).command("bpm",(e,t)=>{const[n]=rt(t,0,[W.NUMBER]);return SE(Y,_.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=rt(t,0,[W.NUMBER]);return RE(Y,_.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=rt(t,0,[W.NUMBER]);return IE(Y,_.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=rt(t,0,[W.NUMBER]);return NE(Y,_.elementfocus,n),0}).command("play",(e,t)=>(tb(_.elementfocus,t,!1),0)).command("bgplay",(e,t)=>(tb(_.elementfocus,t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)eb(_.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)lr(_.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)lr(_.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)lr(_.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)lr(_.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)lr(_.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)lr(_.elementfocus,n,"vibrato",t);return 0});for(let e=0;e<8;++e)Df.command(`synth${e+1}`,(t,n)=>(eb(_.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;Df.command(`echo${t}`,(n,r)=>(lr(_.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(lr(_.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(lr(_.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(lr(_.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(lr(_.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(lr(_.elementfocus,e,"vibrato",r),0))}function YL(e,t,n,r){const i=En(_.book,_t.BOARD,e),s=De(i);if(!k(s))return;const o=vm();ln(_.book,s),ln(_.book,o);const a=-Math.tan(t*.5),c=Math.sin(t),l=Math.round(12.5*a),u=Math.round(12.5*c),h=new Array(re).fill(0);Np(l,0,-l,re-1).forEach(E=>{E.x<0?h[E.y]=Math.min(h[E.y],E.x):h[E.y]=Math.max(h[E.y],E.x)});const f=new Array(It).fill(0);Np(0,u,It-1,-u).forEach(E=>{E.y<0?f[E.x]=Math.min(f[E.x],E.y):f[E.x]=Math.max(f[E.x],E.y)});const m=[h,f,h];for(let E=0;E<m.length;++E){const w=m[E];if(E!==1){for(let T=0;T<re;++T){const A=w[T],I=T*It;for(let M=0;M<It;M++){const S=(M+A+It)%It;n&&(o.terrain[S+I]=s.terrain[M+I])}}if(r){const T=Object.keys(s.objects);for(let A=0;A<T.length;++A){const I=T[A],{x:M,y:S}=s.objects[I];if(k(M)&&k(S)){const L=w[S];s.objects[I].x=(M+L+It)%It}}}}if(E===1){for(let T=0;T<It;++T){const A=w[T];for(let I=0;I<re;++I){const M=(I+A+re)%re;n&&(o.terrain[T+M*It]=s.terrain[T+I*It])}}if(r){const T=Object.keys(s.objects);for(let A=0;A<T.length;++A){const I=T[A],{x:M,y:S}=s.objects[I];if(k(M)&&k(S)){const L=w[M];s.objects[I].y=(S+L+re)%re}}}}n&&(s.terrain=[...o.terrain]),delete o.named,delete o.lookup,delete s.named,delete s.lookup,ln(_.book,o),ln(_.book,s)}}function VL(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var XL=VL;const qL=XL,Zt=function(){};Zt.prototype.FMX=0,Zt.prototype.FMY=0,Zt.prototype.FMXxFMY=0,Zt.prototype.T=0,Zt.prototype.N=0,Zt.prototype.initiliazedField=!1,Zt.prototype.generationComplete=!1,Zt.prototype.wave=null,Zt.prototype.compatible=null,Zt.prototype.weightLogWeights=null,Zt.prototype.sumOfWeights=0,Zt.prototype.sumOfWeightLogWeights=0,Zt.prototype.startingEntropy=0,Zt.prototype.sumsOfOnes=null,Zt.prototype.sumsOfWeights=null,Zt.prototype.sumsOfWeightLogWeights=null,Zt.prototype.entropies=null,Zt.prototype.propagator=null,Zt.prototype.observed=null,Zt.prototype.distribution=null,Zt.prototype.stack=null,Zt.prototype.stackSize=0,Zt.prototype.DX=[-1,0,1,0],Zt.prototype.DY=[0,1,0,-1],Zt.prototype.opposite=[2,3,0,1],Zt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},Zt.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=qL(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},Zt.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],h=this.compatible[l];for(let d=0;d<u.length;d++){const f=u[d],p=h[f];p[i]--,p[i]==0&&this.ban(l,f)}}}},Zt.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},Zt.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},Zt.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},Zt.prototype.isGenerationComplete=function(){return this.generationComplete},Zt.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},Zt.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var nb=Zt;const rb=nb,Ei=function(t,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const h=n,d=new Array(h);for(let O=0;O<h;O++)d[O]=new Array(r);this.colors=[];const f={};for(let O=0;O<r;O++)for(let G=0;G<n;G++){const et=(O*n+G)*4,C=[t[et],t[et+1],t[et+2],t[et+3]],R=C.join("-");f.hasOwnProperty(R)||(f[R]=this.colors.length,this.colors.push(C)),d[G][O]=f[R]}const p=this.colors.length,m=Math.pow(p,i*i),E=function(G){let et=new Array(i*i);for(let C=0;C<i;C++)for(let R=0;R<i;R++)et[R+C*i]=G(R,C);return et},w=function(G,et){return E(function(C,R){return d[(G+C)%n][(et+R)%r]})},T=function(G){return E(function(et,C){return G[i-1-C+et*i]})},A=function(G){return E(function(et,C){return G[i-1-et+C*i]})},I=function(G){let et=0,C=1;for(let R=0;R<G.length;R++)et+=G[G.length-1-R]*C,C*=p;return et},M=function(G){let et=G,C=m;const R=new Array(i*i);for(let b=0;b<R.length;b++){C/=p;let P=0;for(;et>=C;)et-=C,P++;R[b]=P}return R},S={},L=[];for(let O=0;O<(a?r:r-i+1);O++)for(let G=0;G<(a?n:n-i+1);G++){const et=new Array(8);et[0]=w(G,O),et[1]=A(et[0]),et[2]=T(et[0]),et[3]=A(et[2]),et[4]=T(et[2]),et[5]=A(et[4]),et[6]=T(et[4]),et[7]=A(et[6]);for(let C=0;C<l;C++){const R=I(et[C]);S[R]?S[R]++:(L.push(R),S[R]=1)}}this.T=L.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let O=0;O<this.T;O++){const G=parseInt(L[O],10);this.patterns[O]=M(G),this.weights[O]=S[G]}const B=function(G,et,C,R){const b=C<0?0:C,P=C<0?C+i:i,J=R<0?0:R,D=R<0?R+i:i;for(let st=J;st<D;st++)for(let tt=b;tt<P;tt++)if(G[tt+i*st]!=et[tt-C+i*(st-R)])return!1;return!0};this.propagator=new Array(4);for(let O=0;O<4;O++){this.propagator[O]=new Array(this.T);for(let G=0;G<this.T;G++){const et=[];for(let C=0;C<this.T;C++)B(this.patterns[G],this.patterns[C],this.DX[O],this.DY[O])&&et.push(C);this.propagator[O][G]=et}}};Ei.prototype=Object.create(rb.prototype),Ei.prototype.constructor=Ei,Ei.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Ei.prototype.clear=function(){if(rb.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Ei.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Ei.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Ei.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let h=0;h<this.N;h++){let d=n-h;d<0&&(d+=this.FMX);let f=r-u;if(f<0&&(f+=this.FMY),this.onBoundary(d,f))continue;const p=d+f*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const E=this.colors[this.patterns[m][h+u*this.N]];s+=E[0],o+=E[1],a+=E[2],c+=E[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var JL=Ei;const ZL=nb,$i=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const l=function(I){const M=new Array(o*o);for(let S=0;S<o;S++)for(let L=0;L<o;L++)M[L+S*o]=I(L,S);return M},u=function(I){return l(function(M,S){return I[o-1-S+M*o]})},h=function(I){return l(function(M,S){return I[o-1-M+S*o]})};this.tiles=[];const d=[],f=[],p={};let m,E,w;for(let A=0;A<t.tiles.length;A++){const I=t.tiles[A];if(c!==null&&c.indexOf(I.name)===-1)continue;switch(I.symmetry){case"L":w=4,m=function(S){return(S+1)%4},E=function(S){return S%2===0?S+1:S-1};break;case"T":w=4,m=function(S){return(S+1)%4},E=function(S){return S%2===0?S:4-S};break;case"I":w=2,m=function(S){return 1-S},E=function(S){return S};break;case"\\":w=2,m=function(S){return 1-S},E=function(S){return 1-S};break;case"F":w=8,m=function(S){return S<4?(S+1)%4:4+(S-1)%4},E=function(S){return S<4?S+4:S-4};break;default:w=1,m=function(S){return S},E=function(S){return S};break}this.T=f.length,p[I.name]=this.T;for(let S=0;S<w;S++)f.push([this.T+S,this.T+m(S),this.T+m(m(S)),this.T+m(m(m(S))),this.T+E(S),this.T+E(m(S)),this.T+E(m(m(S))),this.T+E(m(m(m(S))))]);let M;if(a)for(let S=0;S<w;S++)M=I.bitmap[S],this.tiles.push(l(function(L,B){return[M[(o*B+L)*4],M[(o*B+L)*4+1],M[(o*B+L)*4+2],M[(o*B+L)*4+3]]}));else{M=I.bitmap,this.tiles.push(l(function(S,L){return[M[(o*L+S)*4],M[(o*L+S)*4+1],M[(o*L+S)*4+2],M[(o*L+S)*4+3]]}));for(let S=1;S<w;S++)this.tiles.push(S<4?u(this.tiles[this.T+S-1]):h(this.tiles[this.T+S-4]))}for(let S=0;S<w;S++)d.push(I.weight||1)}this.T=f.length,this.weights=d,this.propagator=new Array(4);const T=new Array(4);for(let A=0;A<4;A++){this.propagator[A]=new Array(this.T),T[A]=new Array(this.T);for(let I=0;I<this.T;I++){T[A][I]=new Array(this.T);for(let M=0;M<this.T;M++)T[A][I][M]=!1}}for(let A=0;A<t.neighbors.length;A++){const I=t.neighbors[A],M=I.left.split(" ").filter(function(et){return et.length}),S=I.right.split(" ").filter(function(et){return et.length});if(c!==null&&(c.indexOf(M[0])===-1||c.indexOf(S[0])===-1))continue;const L=f[p[M[0]]][M.length==1?0:parseInt(M[1],10)],B=f[L][1],O=f[p[S[0]]][S.length==1?0:parseInt(S[1],10)],G=f[O][1];T[0][O][L]=!0,T[0][f[O][6]][f[L][6]]=!0,T[0][f[L][4]][f[O][4]]=!0,T[0][f[L][2]][f[O][2]]=!0,T[1][G][B]=!0,T[1][f[B][6]][f[G][6]]=!0,T[1][f[G][4]][f[B][4]]=!0,T[1][f[B][2]][f[G][2]]=!0}for(let A=0;A<this.T;A++)for(let I=0;I<this.T;I++)T[2][A][I]=T[0][I][A],T[3][A][I]=T[1][I][A];for(let A=0;A<4;A++)for(let I=0;I<this.T;I++){const M=[],S=T[A][I];for(let L=0;L<this.T;L++)S[L]&&M.push(L);this.propagator[A][I]=M}};$i.prototype=Object.create(ZL.prototype),$i.prototype.constructor=$i,$i.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},$i.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},$i.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},$i.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let h=0,d=0,f=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const E=this.tiles[m][l+c*this.tilesize],w=this.weights[m]*a;h+=E[0]*w,d+=E[1]*w,f+=E[2]*w,p+=E[3]*w}e[u]=h,e[u+1]=d,e[u+2]=f,e[u+3]=p}}}};var QL=$i,t6={OverlappingModel:JL,SimpleTiledModel:QL},e6=ks(t6);function ib(e){return`zss_snapshot_${e}`}function sb(e){const t=Xn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Br(r)==="player"&&delete e[t[n]]}return e}function n6(e){const t=Xn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Br(r)!=="player"&&delete e[t[n]]}return e}function r6(e){const t=En(_.book,_t.BOARD,e),n=De(t);if(!k(n))return;const r=ib(n.id);z_(_.book,r);const i=Ki(Bt.CONTENT,r,_t.BOARD),s=De(i);if(k(s))return s.terrain=qe(n.terrain),s.objects=sb(qe(n.objects)),s}function i6(e){const t=En(_.book,_t.BOARD,e),n=De(t);if(!k(n))return;const r=ib(n.id),i=En(_.book,_t.BOARD,r),s=De(i);k(s)&&(n.terrain=qe(s.terrain),n.objects={...sb(qe(s.objects)),...n6(qe(n.objects))})}const ob=5;function ab(e,t,n=2,r=1,i={x:0,y:0},s={x:It-1,y:re-1}){const o=En(_.book,_t.BOARD,e),a=En(_.book,_t.BOARD,t),c=De(o),l=De(a);if(!k(c)||!k(l))return!1;ln(_.book,c),ln(_.book,l);let u=0;const h=new Map,d=new Map;let f=0;const p=32,m=new Uint8Array(Am*4);for(let O=0;O<re;++O)for(let G=0;G<It;++G){const et=sn(l,{x:G,y:O}),C=(et==null?void 0:et.char)??0,R=(et==null?void 0:et.color)??p,b=(et==null?void 0:et.bg)??p;m[f++]=C,m[f++]=R,m[f++]=b;const P=xr(_.book,et),J=Lt((P==null?void 0:P.name)??"empty"),D=h.get(J);St(D)?m[f++]=D:(h.set(J,u),d.set(u,J),m[f++]=u++)}const E=Math.min(i.x,s.x),w=Math.min(i.y,s.y),T=Math.max(i.x,s.x),A=Math.max(i.y,s.y),I=T-E+1,M=A-w+1,S=new e6.OverlappingModel(m,It,re,n,I,M,!1,!1,r,0);let L=0;for(;L<ob&&!S.generate();++L);if(L===ob)return!1;f=0;const B=S.graphics();for(let O=w;O<=A;++O)for(let G=E;G<=T;++G){const et={x:G,y:O},C=B[f++],R=B[f++],b=B[f++];u=B[f++];const P=sn(c,et);(P==null?void 0:P.category)===Dn.ISOBJECT&&kr(_.book,c,P,_.timestamp),Sn(c,{x:G,y:O});const J=d.get(u)??"",D=ms(_.book,c,[J],et);if(k(D)&&(C>0&&(D.char=C),R<p&&(D.color=R),b<p&&(D.bg=b),Li(D))){const st=we(qo(l,J));k(st)&&(Sn(c,{...Vo(l,st.x??0,st.y??0),x:G,y:O}),D.p1=st.p1,D.p2=st.p2,D.p3=st.p3,D.code=st.code,D.cycle=st.cycle,D.light=st.light,D.stepx=st.stepx,D.stepy=st.stepy,D.pushable=st.pushable,D.collision=st.collision,D.destructible=st.destructible)}}return!0}const s6=jp(32,126).map(e=>String.fromCharCode(e)),o6=Gn({name:"Whitespace",pattern:/ +/}),a6=Gn({name:"WhitespaceSkipped",pattern:/ +/,group:Ye.SKIPPED}),$f=Gn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),cb=Gn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:s6}),jf=Gn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),zf=Gn({name:"EscapedDollar",pattern:"$$"}),Wf=Gn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Kf=Gn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),lb=Gn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function c6(e,t=""){return Gn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const ub=Object.keys(Wo).map(e=>c6(`\\$(${e})`,e)),l6=[o6,$f,...ub,jf,cb,Kf,zf,lb,Wf],u6=new Ye(l6,{skipValidations:!Yr,ensureOptimizations:Yr}),h6=new Ye([a6,$f,...ub,jf,cb,Kf,zf,lb,Wf],{skipValidations:!Yr,ensureOptimizations:Yr});function Gf(e,t=!1){return t?h6.tokenize(e):u6.tokenize(e)}function Hf(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function hb(e){e.active={...e.reset}}function fb(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case zf:s("$");break;case Kf:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r();break;case jf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case $f:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=Wo[l],h=eT(jt[u]),d=nT(jt[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):k(h)?t.active.color=h:k(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(k(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){hb(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;d6(u,u+l.length,t.active.color,t.active.bg,t),f6(u,l,t)}}}function db(e,t,n){const r=Gf(e);r.tokens&&(fb(r.tokens,t),n&&hb(t),t.changed())}function pb(e,t,n){const r=Gf(e);if(!r.tokens)return;const i=Hf(t,n,jt.WHITE,jt.BLACK);return i.measureonly=!0,fb(r.tokens,i),i.x>0&&++i.y,i}function f6(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function d6(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function mb(e,t,n){if(!Vs(_.element))return 0;const[r,i]=rt(t,0,[W.DIR,W.MAYBE_KIND]),s=i??["bullet"],o=DL(_.book,_.board,s,{x:_.element.x,y:_.element.y});if(k(o)){k(n)&&(o.arg=n),o.party=_.elementid,o.collision=Ht.ISBULLET,o.destructible=1,o.stepx=r.x-_.element.x,o.stepy=r.y-_.element.y,o.bg=jt.ONCLEAR;const a=xr(_.book,o),c=o.code??(a==null?void 0:a.code)??"";t1(_.book,_.board,o,c,1)}return e.yield(),0}function xl(e,t,n,r){var h,d;if(!Vs(_.element)||!k(_.book)||!k(_.board)||!k(_.element))return 0;ln(_.book,_.board);const[i,s]=rt(t,0,[W.DIR,W.KIND]),o=sn(_.board,i);if((o==null?void 0:o.category)===Dn.ISOBJECT&&(o!=null&&o.pushable)){const f={x:((h=_.element)==null?void 0:h.x)??0,y:((d=_.element)==null?void 0:d.y)??0},p=Pe(i,oi(f,i));J_(_.book,_.board,o,p)}const[a]=s,c=_a(_.book,a)??Mf(_.book,a),l=(c==null?void 0:c.collision)??Ht.ISWALK;if(!Pf(_.book,_.board,l,i)){const f=ms(_.book,_.board,s,i,n);k(f)&&k(r)&&(f.arg=r)}return 0}function p6(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=sn(t,{x:s,y:i});Li(o)&&kr(e,t,o,e.timestamp),Sn(t,{x:s,y:i})}}function m6(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s)Sn(t,{x:s,y:i})}function g6(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=sn(t,{x:s,y:i});Li(o)&&kr(e,t,o,e.timestamp),Sn(t,{x:s,y:i})}}function gb(e,t){k(e)&&(e.char=t.char,e.color=t.color,e.bg=t.bg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.code=t.code,e.cycle=t.cycle,e.light=t.light,e.stepx=t.stepx,e.stepy=t.stepy,e.pushable=t.pushable,e.collision=t.collision,e.destructible=t.destructible)}function yb(e){if(kt(e)){const t=Lt(e);switch(t){case"all":case"object":case"terrain":return t}}}const y6=bi().command("snapshot",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;const[n]=rt(t,0,[W.MAYBE_NAME]);return n?i6(_.board.id):r6(_.board.id),0}).command("remix",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;const[n,r,i,s,o,a,c]=rt(t,0,[W.NAME,W.MAYBE_NUMBER,W.MAYBE_NUMBER,W.MAYBE_NUMBER,W.MAYBE_NUMBER,W.MAYBE_NUMBER,W.MAYBE_NUMBER]),l=Mn(_.book,_t.BOARD,n),u=we(...l);if(k(u)){const h=k(s)&&k(o)?{x:s,y:o}:void 0,d=k(a)&&k(c)?{x:a,y:c}:void 0;ab(_.board.id,u.id,r,i,h,d)}return 0}).command("weave",(e,t)=>{const[n,r,i]=rt(t,0,[W.DIR,W.MAYBE_NUMBER_OR_STRING,W.MAYBE_NUMBER_OR_STRING]);return console.info({dir:n,maybeop1:r,maybeop2:i}),0}).command("pivot",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;const n=rt(t,0,[W.NUMBER_OR_STRING,W.MAYBE_NUMBER_OR_STRING]);let r=0,i="";for(let s=0;s<n.length-1;++s){const o=n[s];kt(o)&&(i=yb(o)),St(o)&&(r=Hk(o))}return r&&kt(i)&&YL(_.board.id,r,i!=="object",i!=="terrain"),0}).command("copy",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;const[n,r,i,s,o,a]=rt(t,0,[W.NAME,W.NUMBER,W.NUMBER,W.NUMBER,W.NUMBER,W.MAYBE_STRING]),c=yb(a),l=Mn(_.book,_t.BOARD,n),u=De(we(...l));if(ln(_.book,_.board),ln(_.book,u),k(u)){switch(c){default:case"all":p6(_.book,_.board,{x:r,y:i},{x:s,y:o});break;case"object":g6(_.book,_.board,{x:r,y:i},{x:s,y:o});break;case"terrain":m6(_.book,_.board,{x:r,y:i},{x:s,y:o});break}for(let h=i;h<=o;++h)for(let d=r;d<=s;++d){let f=!1,p=!1;switch(c){default:case"all":f=!0,p=!0;break;case"object":f=!0;break;case"terrain":p=!0;break}let m,E=sn(u,{x:d,y:h});if(Li(E)?m=Vo(u,d,h):(m=E,E=void 0),k(m)&&p){const w=ms(_.book,_.board,[m.kind??""],{x:d,y:h});gb(w,m)}if(k(E)&&f){const w=ms(_.book,_.board,[E.kind??""],{x:d,y:h});gb(w,E)}}}return 0}).command("board",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;const[n,r]=rt(t,0,[W.NAME]),[i,s]=rt(t,r,[W.MAYBE_NUMBER,W.MAYBE_NUMBER]),o=Mn(_.book,_t.BOARD,n);if(o.length){const a=we(...o);k(a)&&ao(_.book,_.elementfocus,a.id,{x:i??Math.round(It*.5),y:s??Math.round(re*.5)})}return 0}).command("edge",(e,t)=>{var s,o;if(!k(_.book)||!k(_.board)||!k(_.element))return 0;const[n,r]=rt(t,0,[W.DIR,W.NAME]),i=Mn(_.book,_t.BOARD,r);if(i.length){const a={x:((s=_.element)==null?void 0:s.x)??0,y:((o=_.element)==null?void 0:o.y)??0},c=oi(a,n),l=we(...i);switch(c){case mt.NORTH:_.board.exitnorth=l.id;break;case mt.SOUTH:_.board.exitsouth=l.id;break;case mt.WEST:_.board.exitwest=l.id;break;case mt.EAST:_.board.exiteast=l.id;break}}return 0}).command("shove",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;ln(_.book,_.board);const[n,r]=rt(t,0,[W.DIR,W.DIR]),i=sn(_.board,n);return Li(i)&&ld(_.book,_.board,i,r),0}).command("duplicate",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;ln(_.book,_.board);const[n,r]=rt(t,0,[W.DIR,W.DIR]),i=sn(_.board,n);return Li(i),0}).command("write",(e,t)=>{var l;if(!k(_.book)||!k(_.board))return 0;ln(_.book,_.board);const[n,r,i]=rt(t,0,[W.DIR,W.COLOR,W.STRING]),{color:s,bg:o}=Xp(r),a=((l=pb(i,256,1))==null?void 0:l.measuredwidth)??1,c=Hf(256,1,s??jt.WHITE,o??jt.BLACK);db(i,c,!1);for(let u=0;u<a;++u)Sn(_.board,{x:n.x+u,y:n.y,name:"text",char:c.char[u],color:c.color[u],bg:c.bg[u]});return 0}).command("change",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;ln(_.book,_.board);const[n,r]=rt(t,0,[W.KIND,W.KIND]);(ch(n)??"")==="empty"&&FT(_.board).forEach(c=>{ms(_.book,_.board,r,c)});const s=ch(r),o=Jp(r),a=Zp(r);return Rm(_.board,n).forEach(c=>{if(Br(c)===s)k(o)&&(c.color=o),k(a)&&(c.bg=a);else if(kr(_.book,_.board,c,_.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};ms(_.book,_.board,r,l)}}),0}).command("putwith",(e,t)=>{const[n,r]=rt(t,0,[W.ANY]);return xl(e,t.slice(r),void 0,n)}).command("put",(e,t)=>xl(e,t)).command("oneof",(e,t)=>{const[n,r]=rt(t,0,[W.ANY]);return k(_.board)&&gn(_.board,n)?0:xl(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=rt(t,0,[W.ANY,W.ANY]);return k(_.board)&&gn(_.board,r)?0:xl(e,t.slice(i),r,n)}).command("shootwith",(e,t)=>{const[n,r]=rt(t,0,[W.ANY]);return mb(e,t.slice(r),n)}).command("shoot",mb),ji="$dkpurple",_6="$196",b6="$205";function zt(e,t,n){Zr(e,t,n)}function E6(e,t,n){const r=_6.repeat(n);zt(e,t,`${ji}${r}`)}function Yf(e,t,n){const r=b6.repeat(n);zt(e,t,`${ji}${r}`)}function gs(e,t,n){zt(e,t,`${ji} ${" ".repeat(n.length)} `),E6(e,t,n.length+2),zt(e,t,`${ji} $white${n} `),Yf(e,t,n.length+2)}function wi(e,t,n){zt(e,t,`${ji} ${" ".repeat(n.length)} `),zt(e,t,`${ji} $gray${n} `),Yf(e,t,n.length+2)}function ee(e,t,n,r){zt(e,t,`${ji} $white${n} $blue${r}`)}function $e(e,t,n){zt(e,t,`${ji}$blue${n}`)}function _b(e){const[t,n]=e.split(":"),r=k(n);return[r?t:"self",r?n:e]}const w6=navigator.userAgent.includes("Mac")?"cmd":"ctrl";function co(){Md(Y,Tr())}const x6=bi().command("send",(e,t)=>{const[n,r]=rt(t,0,[W.NAME,W.ANY]);switch(Lt(n)){case"helpmenu":gs(Y,_.elementfocus,"H E L P"),zt(Y,_.elementfocus,""),ee(Y,_.elementfocus,"#help controls","zss controls and inputs"),zt(Y,_.elementfocus,"!helpcontrols;read help controls"),zt(Y,_.elementfocus,""),ee(Y,_.elementfocus,"#help text","text formatting"),zt(Y,_.elementfocus,"!helptext;read help text"),zt(Y,_.elementfocus,""),ee(Y,_.elementfocus,"#help developer","developer commands"),zt(Y,_.elementfocus,"!helpdeveloper;read help developer"),zt(Y,_.elementfocus,""),ee(Y,_.elementfocus,"#help player","player settings"),zt(Y,_.elementfocus,"!helpplayer;read help player"),wi(Y,_.elementfocus,"keyboard input"),ee(Y,_.elementfocus,"?","open console"),ee(Y,_.elementfocus,"esc","close console"),ee(Y,_.elementfocus,"tab","move console"),ee(Y,_.elementfocus,"up / down arrow keys","navigate console items"),ee(Y,_.elementfocus,"left / right arrow keys","change console items"),ee(Y,_.elementfocus,"enter","interact with console items"),ee(Y,_.elementfocus,"alt + arrow keys","skip words and console lines"),ee(Y,_.elementfocus,`${w6} + up / down arrow keys`,"input history");break;case"helpcontrols":gs(Y,_.elementfocus,"zss controls and inputs"),wi(Y,_.elementfocus,"keyboard input"),ee(Y,_.elementfocus,"arrow keys","move"),ee(Y,_.elementfocus,"shift + arrow keys","shoot"),ee(Y,_.elementfocus,"enter","ok / accept"),ee(Y,_.elementfocus,"escape","cancel / close"),ee(Y,_.elementfocus,"tab","menu / action"),wi(Y,_.elementfocus,"controller input"),ee(Y,_.elementfocus,"left stick","move"),ee(Y,_.elementfocus,"right stick","aim"),ee(Y,_.elementfocus,"a","ok / accept"),ee(Y,_.elementfocus,"b","cancel / close"),ee(Y,_.elementfocus,"y","menu / action"),ee(Y,_.elementfocus,"x","shoot"),ee(Y,_.elementfocus,"triggers","shoot");break;case"helptext":break;case"helpdeveloper":gs(Y,_.elementfocus,"developer commands"),ee(Y,_.elementfocus,"#books","list books in memory"),ee(Y,_.elementfocus,"#pages","list pages in opened book"),ee(Y,_.elementfocus,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),ee(Y,_.elementfocus,"#trash","list books and pages from open book you can delete"),ee(Y,_.elementfocus,"#save","flush state to register"),ee(Y,_.elementfocus,"#share","creates a click to copy share url and QR code");break;case"helpplayer":gs(Y,_.elementfocus,"player settings"),$e(Y,_.elementfocus,"todo");break;default:{const[i,s]=_b(n);ud(i==="self"&&_.elementisplayer?`${_.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(be),s=i.join(" ");switch(Lt(r)){case Hn(wt.LOADER):n=Ki(Bt.CONTENT,s,_t.LOADER);break;default:n=Ki(Bt.CONTENT,[r,...i].join(" "),_t.OBJECT);break;case Hn(wt.BOARD):n=Ki(Bt.CONTENT,s,_t.BOARD);break;case Hn(wt.OBJECT):n=Ki(Bt.CONTENT,s,_t.OBJECT);break;case Hn(wt.TERRAIN):n=Ki(Bt.CONTENT,s,_t.TERRAIN);break;case Hn(wt.CHARSET):n=Ki(Bt.CONTENT,s,_t.CHARSET);break;case Hn(wt.PALETTE):n=Ki(Bt.CONTENT,s,_t.PALETTE);break}return k(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(be).join(" ");return k(_.element)&&(_.element.tickertext=n,_.element.tickertime=_.timestamp),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n),s=r.map(be).join(" ");return Zr(Y,_.elementfocus,`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=rt(t,0,[W.MAYBE_NAME]),r=Jb(n);return k(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=rt(t,0,[W.NAME]),r=Ar(n);return k(r)?($e(Y,_.elementfocus,`opened [book] ${r.name}`),Ul(Bt.MAIN,r.id),e.command("pages")):ye(Y,_.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=rt(t,0,[W.NAME]),r=ue(Bt.MAIN),i=Ar(n);return k(i)&&(r===i&&Ul(Bt.MAIN,""),o8(n),$e(Y,_.elementfocus,`trashed [book] ${i.name}`),co(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=rt(t,0,[W.NAME]),r=Mn(_.book,_t.BOARD,n);if(r.length){const i=we(...r);k(i)&&ao(_.book,_.elementfocus,i.id,{x:tr(0,It-1),y:tr(0,re-1)})}return 0}).command("pageopenwith",(e,t)=>{const[n,r,i]=rt(t,0,[W.NAME,W.MAYBE_NAME,W.MAYBE_NAME]);return e.command("pageopen",r,i,n)}).command("pageopen",(e,t)=>{const[n,r,i]=rt(t,0,[W.NAME,W.MAYBE_NAME,W.MAYBE_NAME]),s=xn(Bt.MAIN);if(!k(s))return 0;const o=yi(s,n);if(k(o)){const a=Ue(o),c=gi(o);$e(Y,_.elementfocus,`opened [${c}] ${a}`);const l=[],u=yi(s,i??""),h=k(u)?Rf(u.code):void 0;if(k(h))for(let p=0;p<h.tokens.length;++p){const m=h.tokens[p];m.tokenType===_f&&l.push(m.image.startsWith('"')?m.image.slice(1):m.image)}const d=[o.id,r];qu(La(s.id,d),o.code);const f=gi(o);Cd(Y,_.elementfocus,s.id,d,f,`${a} - ${s.name}`,l)}else ye(Y,"pageopen",`page ${n} not found`,_.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=rt(t,0,[W.NAME]),r=xn(Bt.MAIN),i=z_(r,n);if(k(n)){const s=Ue(i),o=gi(i);$e(Y,_.elementfocus,`trashed [${o}] ${s}`),co(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(be).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{wi(Y,_.elementfocus,"books");const e=ue(Bt.MAIN);ee(Y,_.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=ue(Bt.CONTENT);ee(Y,_.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Yf(Y,_.elementfocus,7);const n=yo();return n.length?n.forEach(r=>{zt(Y,_.elementfocus,`!bookopen ${r.id};${r.name}`)}):$e(Y,_.elementfocus,"no books found"),zt(Y,_.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=xn(Bt.MAIN);return k(e)&&(wi(Y,_.elementfocus,"pages"),ee(Y,_.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?El(e).forEach(n=>{const r=Ue(n),i=gi(n);zt(Y,_.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(zt(Y,_.elementfocus,""),$e(Y,_.elementfocus,"$white no pages found"),$e(Y,_.elementfocus,"$white use @ to create a page"),$e(Y,_.elementfocus,"$white @board name of board"),$e(Y,_.elementfocus,"$white @object name of object"),$e(Y,_.elementfocus,"$white @terrain name of terrain"),$e(Y,_.elementfocus,"$white You can omit the type and it will default to object"),$e(Y,_.elementfocus,"$white @object name of object"),$e(Y,_.elementfocus,"$white @name of object"))),0}).command("boards",()=>{wi(Y,_.elementfocus,"boards");const e=xn(Bt.MAIN);if(k(e)){ee(Y,_.elementfocus,"main",`${e.name} $GREEN${e.id}`);const t=El(e);t.filter(n=>mi(n)===_t.BOARD).forEach(n=>{const r=Ue(n),i=gi(n);zt(Y,_.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),t.length===0&&(zt(Y,_.elementfocus,""),$e(Y,_.elementfocus,"$white no boards found"),$e(Y,_.elementfocus,"$white use @ to create a board"),$e(Y,_.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{wi(Y,_.elementfocus,"$REDTRASH"),$e(Y,_.elementfocus,"books");const e=yo();e.length&&(e.forEach(n=>{zt(Y,_.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),zt(Y,_.elementfocus,""));const t=ue(Bt.MAIN);return k(t)&&($e(Y,_.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Ue(n);zt(Y,_.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),zt(Y,_.elementfocus,"")),0}).command("dev",()=>(co(),EE(Y,_.elementfocus),0)).command("share",()=>(co(),wE(Y,_.elementfocus),0)).command("save",()=>(co(),0)).command("fork",()=>(UE(Y,_.elementfocus),0)).command("nuke",()=>(xE(Y,_.elementfocus),0)).command("restart",()=>(ME(Y,_.elementfocus),co(),0)).command("export",()=>{gs(Y,_.elementfocus,"E X P O R T"),wi(Y,_.elementfocus,"books");const e=yo();return e.length&&e.forEach(t=>zt(Y,_.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=rt(t,0,[W.NAME]),r=Ar(n);return k(r)&&(gs(Y,_.elementfocus,"E X P O R T"),wi(Y,_.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=El(r);zt(Y,_.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Ue(s),a=gi(s);zt(Y,_.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=rt(t,0,[W.NAME]),r=Ar(n);return k(r)&&Nd(Y,_.elementfocus,qe(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=rt(t,0,[W.NAME]),{target:r,path:i}=fr(n),s=Ar(r),o=yi(s,i);return k(o)&&Nd(Y,_.elementfocus,qe(o),`${Ue(o)}.${gi(o)}.json`),0}).command("gadget",()=>(OE(Y,_.elementfocus),0)).command("joincode",(e,t)=>{const[n]=rt(t,0,[W.MAYBE_NAME]);return uE(Y,_.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=rt(t,0,[W.MAYBE_NAME]);return hE(Y,_.elementfocus,!!n),0}),k6=bi().command("toast",(e,t)=>{const n=t.map(be).join("");return tE(Y,_.elementfocus,n),0}).command("palette",(e,t)=>{const[n]=rt(t,0,[W.NAME]),r=Zb(),i=En(_.book,_t.PALETTE,n);return k(i)?(r.palette=i.id,zt(Y,_.elementfocus,`loaded palette ${n}`)):ye(Y,_.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=rt(t,0,[W.NAME]),r=Zb(),i=En(_.book,_t.CHARSET,n);return k(i)?(r.charset=i.id,zt(Y,_.elementfocus,`loaded charset ${n}`)):ye(Y,_.elementfocus,"not-found",`unabled to find charset ${n}`),0}),Vf={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Ea(e){return ae(e)&&bb(e[0])}function bb(e){return k(Dn[e])&&kt(e)}function Eb(e){if(kt(e))return Vf[Lt(e)]}function wb(e){if(Ea(e))return e;if(bb(e))return[e];const t=Eb(e);if(k(t))return[t]}function T6(e){const t=_.words[e],n=wb(t);if(Ea(n))return[n,e+1];const[r,i]=Fn(e),s=wb(r);return Ea(s)?[s,i]:[void 0,e]}const Xf={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Ht.ISSOLID,Ht.ISWALK,Ht.ISSWIM,Ht.ISBULLET,Ht.ISWALK,Ht.ISSWIM;function kl(e){return ae(e)&&qf(e[0])}function qf(e){return k(Ht[e])&&kt(e)}function A6(e){if(kt(e))return Xf[Lt(e)]}function v6(e){const t=_.words[e];if(kl(t))return[t,e+1];if(qf(t))return[[t],e+1];const[n,r]=Fn(e);return kl(n)?[n,r]:qf(n)?[[n],r]:[void 0,e]}const S6=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),xb=new Set(["party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),R6=["NORTH","SOUTH","WEST","EAST"];function I6(e){const t=bs(e);if(St(t.inputcurrent)||(t.inputcurrent=0),ae(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=yn.NONE,i=0]=n??[yn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&GT?1:0,t.inputctrl=i&HT?1:0,t.inputshift=i&YT?1:0,r){case yn.MOVE_UP:case yn.MOVE_DOWN:case yn.MOVE_LEFT:case yn.MOVE_RIGHT:t.inputmove=[R6[r-yn.MOVE_UP]];break;case yn.OK_BUTTON:t.inputok=1;break;case yn.CANCEL_BUTTON:t.inputcancel=1;break;case yn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==yn.NONE&&o!==r}),t}function N6(e){const t=Vf[e];if(k(t))return t;const n=Xf[e];if(k(n))return n;const r=Wo[e];if(k(r))return r;const i=ih[e];if(k(i))return i}const O6=bi({get(e,t){var o,a,c,l,u,h,d,f,p,m,E,w,T,A,I,M,S,L,B,O;const n=N6(t);if(k(n))return[!0,n];if(_.elementisplayer&&S6.has(t)){const G=I6(_.elementid)[t];return[k(G),G]}const r=Xo(_.board,{x:((o=_.element)==null?void 0:o.x)??-1,y:((a=_.element)==null?void 0:a.y)??-1},_.elementfocus),i=(r==null?void 0:r.id)??_.elementfocus??Tr();switch(t){case"isdark":return[!0,(c=_.board)!=null&&c.isdark?1:0];case"startx":return[!0,((l=_.board)==null?void 0:l.startx)??0];case"starty":return[!0,((u=_.board)==null?void 0:u.starty)??0];case"over":return[!0,((h=_.board)==null?void 0:h.over)??""];case"under":return[!0,((d=_.board)==null?void 0:d.under)??""];case"camera":return[!0,((f=_.board)==null?void 0:f.camera)??""];case"exitnorth":return[!0,((p=_.board)==null?void 0:p.exitnorth)??""];case"exitsouth":return[!0,((m=_.board)==null?void 0:m.exitsouth)??""];case"exitwest":return[!0,((E=_.board)==null?void 0:E.exitwest)??""];case"exiteast":return[!0,((w=_.board)==null?void 0:w.exiteast)??""];case"timelimit":return[!0,((T=_.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((A=_.board)==null?void 0:A.restartonzap)??0];case"maxplayershots":return[!0,((I=_.board)==null?void 0:I.maxplayershots)??0];case"boardid":return[!0,((M=_.board)==null?void 0:M.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((S=_.element)==null?void 0:S.id)??""];case"thisx":return[!0,((L=_.element)==null?void 0:L.x)??-1];case"thisy":return[!0,((B=_.element)==null?void 0:B.y)??-1];default:{const G=(O=_.element)==null?void 0:O[t];if(xb.has(t))return[!0,G];break}}const s=bs(i)[t];return[k(s),s]},set(e,t,n){var o,a;const r=Xo(_.board,{x:((o=_.element)==null?void 0:o.x)??-1,y:((a=_.element)==null?void 0:a.y)??-1},_.elementfocus),i=(r==null?void 0:r.id)??_.elementfocus;switch(t){case"isdark":k(_.board)&&(_.board.isdark=n?1:0);break;case"startx":k(_.board)&&(_.board.startx=ba(n,0));break;case"starty":k(_.board)&&(_.board.starty=ba(n,0));break;case"over":k(_.board)&&(_.board.over=St(n)?n:be(n));break;case"under":k(_.board)&&(_.board.under=St(n)?n:be(n));break;case"camera":k(_.board)&&(_.board.camera=be(n));break;case"exitnorth":k(_.board)&&(_.board.exitnorth=be(n));break;case"exitsouth":k(_.board)&&(_.board.exitsouth=be(n));break;case"exitwest":k(_.board)&&(_.board.exitwest=be(n));break;case"exiteast":k(_.board)&&(_.board.exiteast=be(n));break;case"timelimit":k(_.board)&&(_.board.timelimit=ba(n,0));break;case"restartonzap":k(_.board)&&(_.board.restartonzap=n?1:0);break;case"maxplayershots":k(_.board)&&(_.board.maxplayershots=ba(n,0));break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(xb.has(t))return k(_.element)&&(_.element[t]=n),[!0,n];break}}const s=bs(i);return k(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=_.element)!=null&&e.removed)&&(k((t=_.element)==null?void 0:t.stepx)||k((n=_.element)==null?void 0:n.stepy))){const s={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};ld(_.book,_.board,_.element,{x:s.x+(_.element.stepx??0),y:s.y+(_.element.stepy??0)})===!1&&(_.element.stepx=0,_.element.stepy=0,oo(_.book,_.element,"destructible")&&kr(_.book,_.board,_.element,_.timestamp))}}}).command("clear",(e,t)=>(t.forEach(n=>e.set(be(n),0)),0)).command("set",(e,t)=>{const[n,r]=rt(t,0,[W.NAME,W.ANY]);return e.set(n,r),0}).command("become",(e,t)=>{var r,i;const[n]=rt(t,0,[W.KIND]);if(ln(_.book,_.board),Ff(_.book,_.board,_.element),kr(_.book,_.board,_.element,_.timestamp)){const s={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};ms(_.book,_.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=rt(t,0,[W.NUMBER]);return k(_.element)&&(_.element.char=n),0}).command("color",(e,t)=>{const[n]=rt(t,0,[W.COLOR]);return k(_.element)&&k(n)&&xc(_.element,n),0}).command("go",(e,t)=>{if(k(_.element)){const[n]=rt(t,0,[W.DIR]);if(ld(_.book,_.board,_.element,n),e.yield(),_.element.x===n.x&&_.element.y===n.y)return 0}return 1}).command("walk",(e,t)=>{if(!k(_.element))return 0;const[n]=rt(t,0,[W.DIR]),r=_.element.x??0,i=_.element.y??0;return _.element.stepx=n.x-r,_.element.stepy=n.y-i,0}),C6=bi().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=rt(t,0,[W.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(be(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(be(t[0])),0)).command("cycle",(e,t)=>{if(k(_.element)){const[n]=rt(t,0,[W.NUMBER]);_.element.cycle=rn(Math.round(n),1,255)}return 0}).command("die",e=>(kr(_.book,_.board,_.element,_.timestamp),e.endofprogram(),0)).command("endgame",()=>(Ld(Y,_.elementfocus),0)).command("run",(e,t)=>{const[n]=rt(t,0,[W.NAME]);return Fl(n),0}).command("runwith",(e,t)=>{const[n,r]=rt(t,0,[W.ANY,W.NAME]);return e.set("arg",n),Fl(r),0}),Tl={};function L6(e){var t;return(t=Tl[e])==null?void 0:t.arg}function M6(e){var t;return(t=Tl[e])==null?void 0:t.format}function lo(e){var t;return(t=Tl[e])==null?void 0:t.content}function U6(e,t,n,r,i){const s=ue(Bt.MAIN);if(!k(s))return;const o=ds(s,_t.LOADER).filter(a=>{const c=fs(a),l=c.format,u=kt(l)?new RegExp(l).test(t):!1,h=c.event,d=kt(h)?new RegExp(h).test(n):!1;return kt(l)&&kt(h)?u&&d:kt(l)?u:kt(h)?d:!1});for(let a=0;a<o.length;++a){const c=`${Ce()}_loader`;Tl[c]={arg:e,format:t,content:r,player:i},h8(c,o[a].code)}}function kb(e,t){if(!k(e))return;const n=Lt(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const F6=(e,t)=>{const n=lo(e.id());if(!k(n))return 0;const[r,i]=rt(t,0,[W.NAME]),s=Lt(r);switch(s){case"seek":{const[o]=rt(t,i,[W.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(t,i,[W.NAME]);e.set(o,kb(n,s));break}case"text":{const[o,a]=rt(t,i,[W.NAME,W.NAME]),c=kb(n,o);if(St(c)&&kt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(l);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=rt(t,i,[W.NAME]),a=Lf(_.book,_t.PALETTE,o),c=De(a);if(k(c)){const l=BT*Tc,u=Lm(new Uint8Array(n.bytes.buffer,n.cursor,l));k(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=rt(t,i,[W.NAME]),a=Lf(_.book,_t.CHARSET,o),c=De(a);if(k(c)){const l=Sc*PT*Eh,u=Mm(new Uint8Array(n.bytes.buffer,n.cursor,l));k(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},uo=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Al=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!Al(e[n],t[n]))return!1;return!0}if(uo(e)&&uo(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Al(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},vl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(uo(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},P6=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Tb=e=>e>="0"&&e<="9"||e==="-",B6=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var X;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(X||(X={}));const Ab={"(":X.TOK_LPAREN,")":X.TOK_RPAREN,"*":X.TOK_STAR,",":X.TOK_COMMA,".":X.TOK_DOT,":":X.TOK_COLON,"@":X.TOK_CURRENT,$:X.TOK_ROOT,"]":X.TOK_RBRACKET,"{":X.TOK_LBRACE,"}":X.TOK_RBRACE},D6={"!":!0,"<":!0,"=":!0,">":!0},$6={"	":!0,"\n":!0,"\r":!0," ":!0};class j6{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(P6(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:X.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Ab[t[this._current]]!==void 0)n.push({start:this._current,type:Ab[t[this._current]],value:t[this._current]}),this._current+=1;else if(Tb(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:X.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:X.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:X.TOK_LITERAL,value:o})}else if(D6[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if($6[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:X.TOK_AND,value:"&&"})):n.push({start:r,type:X.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:X.TOK_OR,value:"||"})):n.push({start:r,type:X.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&B6(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;Tb(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:X.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:X.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:X.TOK_FLATTEN,value:"[]"}):{start:n,type:X.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_NE,value:"!="}):{start:n,type:X.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_LTE,value:"<="}):{start:n,type:X.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_GTE,value:">="}):{start:n,type:X.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:X.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const z6=new j6,fn={[X.TOK_EOF]:0,[X.TOK_UNQUOTEDIDENTIFIER]:0,[X.TOK_QUOTEDIDENTIFIER]:0,[X.TOK_RBRACKET]:0,[X.TOK_RPAREN]:0,[X.TOK_COMMA]:0,[X.TOK_RBRACE]:0,[X.TOK_NUMBER]:0,[X.TOK_CURRENT]:0,[X.TOK_EXPREF]:0,[X.TOK_ROOT]:0,[X.TOK_PIPE]:1,[X.TOK_OR]:2,[X.TOK_AND]:3,[X.TOK_EQ]:5,[X.TOK_GT]:5,[X.TOK_LT]:5,[X.TOK_GTE]:5,[X.TOK_LTE]:5,[X.TOK_NE]:5,[X.TOK_FLATTEN]:9,[X.TOK_STAR]:20,[X.TOK_FILTER]:21,[X.TOK_DOT]:40,[X.TOK_NOT]:45,[X.TOK_LBRACE]:50,[X.TOK_LBRACKET]:55,[X.TOK_LPAREN]:60};class W6{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==X.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...z6.tokenize(t),{type:X.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<fn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case X.TOK_LITERAL:return{type:"Literal",value:t.value};case X.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case X.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===X.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case X.TOK_NOT:return r=this.expression(fn.Not),{type:"NotExpression",children:[r]};case X.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===X.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(fn.Star),{type:"ValueProjection",children:[n,r]};case X.TOK_FILTER:return this.led(t.type,{type:"Identity"});case X.TOK_LBRACE:return this.parseMultiselectHash();case X.TOK_FLATTEN:return n={type:X.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(fn.Flatten),{type:"Projection",children:[n,r]};case X.TOK_LBRACKET:return this.lookahead(0)===X.TOK_NUMBER||this.lookahead(0)===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===X.TOK_STAR&&this.lookahead(1)===X.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(fn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case X.TOK_CURRENT:return{type:X.TOK_CURRENT};case X.TOK_ROOT:return{type:X.TOK_ROOT};case X.TOK_EXPREF:return i=this.expression(fn.Expref),{type:"ExpressionReference",children:[i]};case X.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(i={type:X.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(X.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case X.TOK_DOT:const i=fn.Dot;return this.lookahead(0)!==X.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case X.TOK_PIPE:return r=this.expression(fn.Pipe),{type:X.TOK_PIPE,children:[n,r]};case X.TOK_OR:return r=this.expression(fn.Or),{type:"OrExpression",children:[n,r]};case X.TOK_AND:return r=this.expression(fn.And),{type:"AndExpression",children:[n,r]};case X.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(a={type:X.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===X.TOK_COMMA&&this.match(X.TOK_COMMA),o.push(a);return this.match(X.TOK_RPAREN),{name:s,type:"Function",children:o};case X.TOK_FILTER:const l=this.expression(0);return this.match(X.TOK_RBRACKET),r=this.lookahead(0)===X.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(fn.Filter),{type:"FilterProjection",children:[n,r,l]};case X.TOK_FLATTEN:const u={type:X.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(fn.Flatten);return{type:"Projection",children:[u,h]};case X.TOK_EQ:case X.TOK_NE:case X.TOK_GT:case X.TOK_GTE:case X.TOK_LT:case X.TOK_LTE:return this.parseComparator(n,t);case X.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===X.TOK_NUMBER||d.type===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(X.TOK_STAR),this.match(X.TOK_RBRACKET),r=this.parseProjectionRHS(fn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===X.TOK_COLON||this.lookahead(1)===X.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(X.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(fn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==X.TOK_RBRACKET&&n<3;){if(r===X.TOK_COLON)n+=1,this.advance();else if(r===X.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(X.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(fn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER,X.TOK_STAR].includes(n))return this.expression(t);if(n===X.TOK_LBRACKET)return this.match(X.TOK_LBRACKET),this.parseMultiselectList();if(n===X.TOK_LBRACE)return this.match(X.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(fn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===X.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===X.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===X.TOK_DOT)return this.match(X.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==X.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===X.TOK_COMMA&&(this.match(X.TOK_COMMA),this.lookahead(0)===X.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(X.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(X.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===X.TOK_COMMA)this.match(X.TOK_COMMA);else if(this.lookahead(0)===X.TOK_RBRACE){this.match(X.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const K6=new W6;var ut;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class G6{constructor(t){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>uo(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),h=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return u>h?1:u<h?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(m=>{var E;return(E=!m.optional)!==null&&E!==void 0?E:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,h=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let d,f,p;for(let m=0;m<r.length;m+=1){p=!1,d=r[m].types,f=this.getTypeName(n[m]);let E;for(E=0;E<d.length;E+=1)if(f!==void 0&&this.typeMatches(f,d[E],n[m])){p=!0;break}if(!p&&f!==void 0){const w=d.map(T=>this.TYPE_NAME_TABLE[T]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${m+1} to be type (${w}) but received type ${this.TYPE_NAME_TABLE[f]} instead.`)}}}typeMatches(t,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return t===ut.TYPE_ARRAY;if(t===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return t.jmespathType===X.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class H6{constructor(){this._rootValue=null,this.runtime=new G6(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,l,u,h,d,f;switch(t.type){case"Field":return n===null?null:uo(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],n),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=t.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...t.children],E=this.computeSliceParams(n.length,m),[w,T,A]=E;if(s=[],A>0)for(d=w;d<T;d+=A)s.push(n[d]);else for(d=w;d>T;d+=A)s.push(n[d]);return s;case"Projection":if(f=this.visit(t.children[0],n),!Array.isArray(f))return null;for(h=[],d=0;d<f.length;d+=1)i=this.visit(t.children[1],f[d]),i!==null&&h.push(i);return h;case"ValueProjection":if(f=this.visit(t.children[0],n),!uo(f))return null;h=[];const I=Object.values(f);for(d=0;d<I.length;d+=1)i=this.visit(t.children[1],I[d]),i!==null&&h.push(i);return h;case"FilterProjection":if(f=this.visit(t.children[0],n),!Array.isArray(f))return null;const M=[],S=[];for(d=0;d<f.length;d+=1)r=this.visit(t.children[2],f[d]),vl(r)||M.push(f[d]);for(let C=0;C<M.length;C+=1)i=this.visit(t.children[1],M[C]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case X.TOK_EQ:s=Al(o,a);break;case X.TOK_NE:s=!Al(o,a);break;case X.TOK_GT:s=o>a;break;case X.TOK_GTE:s=o>=a;break;case X.TOK_LT:s=o<a;break;case X.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case X.TOK_FLATTEN:const L=this.visit(t.children[0],n);if(!Array.isArray(L))return null;let B=[];for(d=0;d<L.length;d+=1)i=L[d],Array.isArray(i)?B=[...B,...i]:B.push(i);return B;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],d=0;d<t.children.length;d+=1)h.push(this.visit(t.children[d],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let O;for(d=0;d<t.children.length;d+=1)O=t.children[d],h[O.name]=this.visit(O.value,n);return h;case"OrExpression":return r=this.visit(t.children[0],n),vl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),vl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),vl(o);case"Literal":return t.value;case X.TOK_PIPE:return l=this.visit(t.children[0],n),this.visit(t.children[1],l);case X.TOK_CURRENT:return n;case X.TOK_ROOT:return this._rootValue;case"Function":const G=[];for(let C=0;C<t.children.length;C+=1)G.push(this.visit(t.children[C],n));return this.runtime.callFunction(t.name,G);case"ExpressionReference":const et=t.children[0];return et.jmespathType=X.TOK_EXPREF,et;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const Y6=new H6;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function V6(e,t){const n=K6.parse(t);return Y6.search(n,e)}const X6=(e,t)=>{const n=lo(e.id());if(!k(n))return 0;const[r,i]=rt(t,0,[W.NAME,W.NAME]),s=V6(n.json,r);return e.set(i,s),0},q6=(e,t)=>{const n=lo(e.id());if(!k(n))return 0;const[r,i]=rt(t,0,[W.NAME]);switch(Lt(r)){case"seek":{const[o]=rt(t,i,[W.NUMBER]);n.cursor=rn(o,0,n.lines.length-1);break}case"line":n.cursor=rn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[h,d]=rt(t,u,[W.NAME]);e.set(h,c[l]??0),++l,u=d}break}}return 0},J6=bi({get(e,t){const n=M6(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=lo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=lo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=lo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=rt(t,0,[W.NAME,W.ANY]);return ud(n,r),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(be).join(" ");return Zr(Y,_.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n),s=r.map(be).join(" ");return Zr(Y,_.elementfocus,"$175",`!${s};${i}`),0}).command("readline",q6).command("readjson",X6).command("readbin",F6).command("with",(e,t)=>{const[n]=rt(t,0,[W.NAME]),r=Mn(_.book,_t.BOARD,n);if(r.length){const i=we(...r);k(i)&&(_.board=De(i),_.element={x:-1,y:-1})}return 0});function vb(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=rt(i,a,[W.ANY]);ae(c)&&!ns(c)&&!Ea(c)&&!kl(c)&&!Fr(c)?o.push(...c):o.push(c),a=l}switch(Lt(r)){case"get":case"post:json":sE(Y,_.elementfocus,e,t,n,r,o);break}return 0}const Z6=bi().command("fetch",(e,t)=>{const[n,r,i="get",s]=rt(t,0,[W.NAME,W.NAME,W.MAYBE_STRING]);return vb(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=rt(t,0,[W.ANY,W.NAME,W.NAME,W.MAYBE_STRING]);return vb(n,r,i,s,t,o),0}).command("twitchchat",(e,t)=>{const[n]=rt(t,0,[W.ANY]);switch(Lt(n)){default:rE(Y,_.elementfocus,n);break;case"stop":iE(Y,_.elementfocus);break}return 0}).command("twitchbroadcast",(e,t)=>{const[n]=rt(t,0,[W.NAME]);switch(Lt(n)){default:eE(Y,_.elementfocus,n);break;case"stop":nE(Y,_.elementfocus);break}return 0}),Q6=bi({set(e,t,n){return x8(e,t,n),[!1,void 0]},everytick(){const e=qr(_.elementid),[t]=e;if(e.length===1&&kt(t)){if(k(_.element))if(t.trim().length===0){const n=kn(_.elementid);n.sidebar=[]}else _.element.tickertext=t,_.element.tickertime=_.timestamp}else if(e.length>1)if(_.elementisplayer){const n=kn(_.elementid);n.sidebar=e}else{const n=kn(_.elementfocus);n.scroll=e}}}).command("send",(e,t)=>{var c,l;const[n,r]=rt(t,0,[W.NAME,W.ANY]),[i,s]=_b(n);function o(u){for(let h=0;h<u.length;++h){const d=u[h];k(d.id)&&e.send(d.id,s,r)}}switch(Lt(i)){case"all":for(const u of Object.keys(((c=_.board)==null?void 0:c.objects)??{}))e.send(u,s,r);break;case"self":e.message({session:Y.session(),player:_.elementfocus,id:Ce(),sender:e.id(),target:s,data:r});break;case"others":for(const u of Object.keys(((l=_.board)==null?void 0:l.objects)??{}))u!==e.id()&&e.send(u,s,r);break;default:{o(Im(_.board,[i]));break}}return 0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(be).join("");return se(_.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n);return $t(_.elementid,e.id(),i,r,e.get,e.set),0});var zi=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(zi||{});const tM={audio:Df,board:y6,cli:x6,display:k6,element:O6,runtime:Q6,lifecycle:C6,loader:J6,network:Z6},Jf=["audio","board","display","network","lifecycle","element"],eM={0:[],1:["cli",...Jf],2:["loader",...Jf],3:["runtime",...Jf]},nM={0:new Map,1:new Map,2:new Map,3:new Map};function ho(e){return(eM[e]??[]).map(n=>tM[n]).filter(k)}function Zf(e){const t=[],n=ho(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function rM(e,t){const n=nM[e];if(!n.has(t)){let r;const i=ho(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!k(r));++s);n.set(t,r)}return n.get(t)}function iM(e,t,n){const r=ho(e);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(t,n);if(o)return[o,a]}}return[!1,void 0]}function sM(e,t,n,r){const i=ho(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,n,r);if(a)return[a,r]}}return[!1,void 0]}function oM(e,t){const n=ho(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function Sb(e,t){const n=ho(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var Rb={},Ib={},Nb={};const Ob="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Nb.encode=function(e){if(0<=e&&e<Ob.length)return Ob[e];throw new TypeError("Must be between 0 and 63: "+e)};const aM=Nb,Cb=5,Lb=1<<Cb,cM=Lb-1,lM=Lb;function uM(e){return e<0?(-e<<1)+1:(e<<1)+0}Ib.encode=function(t){let n="",r,i=uM(t);do r=i&cM,i>>>=Cb,i>0&&(r|=lM),n+=aM.encode(r);while(i>0);return n};var wa={};(function(e){function t(S,L,B){if(L in S)return S[L];if(arguments.length===3)return B;throw new Error('"'+L+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(S){const L=S.match(n);return L?{scheme:L[1],auth:L[2],host:L[3],port:L[4],path:L[5]}:null}e.urlParse=i;function s(S){let L="";return S.scheme&&(L+=S.scheme+":"),L+="//",S.auth&&(L+=S.auth+"@"),S.host&&(L+=S.host),S.port&&(L+=":"+S.port),S.path&&(L+=S.path),L}e.urlGenerate=s;const o=32;function a(S){const L=[];return function(B){for(let G=0;G<L.length;G++)if(L[G].input===B){const et=L[0];return L[0]=L[G],L[G]=et,L[0].result}const O=S(B);return L.unshift({input:B,result:O}),L.length>o&&L.pop(),O}}const c=a(function(L){let B=L;const O=i(L);if(O){if(!O.path)return L;B=O.path}const G=e.isAbsolute(B),et=[];let C=0,R=0;for(;;)if(C=R,R=B.indexOf("/",C),R===-1){et.push(B.slice(C));break}else for(et.push(B.slice(C,R));R<B.length&&B[R]==="/";)R++;let b=0;for(R=et.length-1;R>=0;R--){const P=et[R];P==="."?et.splice(R,1):P===".."?b++:b>0&&(P===""?(et.splice(R+1,b),b=0):(et.splice(R,2),b--))}return B=et.join("/"),B===""&&(B=G?"/":"."),O?(O.path=B,s(O)):B});e.normalize=c;function l(S,L){S===""&&(S="."),L===""&&(L=".");const B=i(L),O=i(S);if(O&&(S=O.path||"/"),B&&!B.scheme)return O&&(B.scheme=O.scheme),s(B);if(B||L.match(r))return L;if(O&&!O.host&&!O.path)return O.host=L,s(O);const G=L.charAt(0)==="/"?L:c(S.replace(/\/+$/,"")+"/"+L);return O?(O.path=G,s(O)):G}e.join=l,e.isAbsolute=function(S){return S.charAt(0)==="/"||n.test(S)};function u(S,L){S===""&&(S="."),S=S.replace(/\/$/,"");let B=0;for(;L.indexOf(S+"/")!==0;){const O=S.lastIndexOf("/");if(O<0||(S=S.slice(0,O),S.match(/^([^\/]+:\/)?\/*$/)))return L;++B}return Array(B+1).join("../")+L.substr(S.length+1)}e.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(S){return S}function f(S){return m(S)?"$"+S:S}e.toSetString=h?d:f;function p(S){return m(S)?S.slice(1):S}e.fromSetString=h?d:p;function m(S){if(!S)return!1;const L=S.length;if(L<9||S.charCodeAt(L-1)!==95||S.charCodeAt(L-2)!==95||S.charCodeAt(L-3)!==111||S.charCodeAt(L-4)!==116||S.charCodeAt(L-5)!==111||S.charCodeAt(L-6)!==114||S.charCodeAt(L-7)!==112||S.charCodeAt(L-8)!==95||S.charCodeAt(L-9)!==95)return!1;for(let B=L-10;B>=0;B--)if(S.charCodeAt(B)!==36)return!1;return!0}function E(S,L,B){let O=T(S.source,L.source);return O!==0||(O=S.originalLine-L.originalLine,O!==0)||(O=S.originalColumn-L.originalColumn,O!==0||B)||(O=S.generatedColumn-L.generatedColumn,O!==0)||(O=S.generatedLine-L.generatedLine,O!==0)?O:T(S.name,L.name)}e.compareByOriginalPositions=E;function w(S,L,B){let O=S.generatedLine-L.generatedLine;return O!==0||(O=S.generatedColumn-L.generatedColumn,O!==0||B)||(O=T(S.source,L.source),O!==0)||(O=S.originalLine-L.originalLine,O!==0)||(O=S.originalColumn-L.originalColumn,O!==0)?O:T(S.name,L.name)}e.compareByGeneratedPositionsDeflated=w;function T(S,L){return S===L?0:S===null?1:L===null?-1:S>L?1:-1}function A(S,L){let B=S.generatedLine-L.generatedLine;return B!==0||(B=S.generatedColumn-L.generatedColumn,B!==0)||(B=T(S.source,L.source),B!==0)||(B=S.originalLine-L.originalLine,B!==0)||(B=S.originalColumn-L.originalColumn,B!==0)?B:T(S.name,L.name)}e.compareByGeneratedPositionsInflated=A;function I(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=I;function M(S,L,B){if(L=L||"",S&&(S[S.length-1]!=="/"&&L[0]!=="/"&&(S+="/"),L=S+L),B){const O=i(B);if(!O)throw new Error("sourceMapURL could not be parsed");if(O.path){const G=O.path.lastIndexOf("/");G>=0&&(O.path=O.path.substring(0,G+1))}L=l(s(O),L)}return c(L)}e.computeSourceURL=M})(wa);var Qf={};let hM=class m1{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new m1;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Qf.ArraySet=hM;var Mb={};const Ub=wa;function fM(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||Ub.compareByGeneratedPositionsInflated(e,t)<=0}let dM=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){fM(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(Ub.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};Mb.MappingList=dM;const xa=Ib,je=wa,Sl=Qf.ArraySet,pM=Mb.MappingList;let Fb=class g1{constructor(t){t||(t={}),this._file=je.getArg(t,"file",null),this._sourceRoot=je.getArg(t,"sourceRoot",null),this._skipValidation=je.getArg(t,"skipValidation",!1),this._sources=new Sl,this._names=new Sl,this._mappings=new pM,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new g1({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=je.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=je.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=je.getArg(t,"generated"),r=je.getArg(t,"original",null);let i=je.getArg(t,"source",null),s=je.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=je.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[je.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[je.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=je.relative(s,i));const o=this._mappings.toArray().length>0?new Sl:this._sources,a=new Sl;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=je.join(r,c.source)),s!=null&&(c.source=je.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=je.join(r,c)),s!=null&&(c=je.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(l=d[f],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!je.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=xa.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=xa.encode(h-o),o=h,c+=xa.encode(l.originalLine-1-i),i=l.originalLine-1,c+=xa.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=xa.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=je.relative(n,r));const i=je.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};Fb.prototype._version=3,Rb.SourceMapGenerator=Fb;var Pb={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(Pb);var ka={exports:{}},mM={},gM=Object.freeze({__proto__:null,default:mM}),Bb=y1(gM);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;ka.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},ka.exports.initialize=t=>e=t}else{const e=Bb,t=Bb;ka.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},ka.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Db=ka.exports;const yM=Db;function _M(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Ta=null;var bM=function(){if(Ta)return Ta;const t=[];return Ta=yM().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,h,d){const f=new _M;f.generatedLine=r+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),t[t.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw Ta=null,n}),Ta};const At=wa,td=Pb,Rl=Qf.ArraySet,EM=Db,wM=bM,ed=Symbol("smcInternal");class Fe{constructor(t,n){return t==ed?Promise.resolve(this):kM(t,n)}static initialize(t){EM.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return TM(t,n)}static async with(t,n,r){const i=await new Fe(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Fe.prototype._version=3,Fe.GENERATED_ORDER=1,Fe.ORIGINAL_ORDER=2,Fe.GREATEST_LOWER_BOUND=1,Fe.LEAST_UPPER_BOUND=2;class Aa extends Fe{constructor(t,n){return super(ed).then(r=>{let i=t;typeof t=="string"&&(i=At.parseSourceMapInput(t));const s=At.getArg(i,"version");let o=At.getArg(i,"sources");const a=At.getArg(i,"names",[]);let c=At.getArg(i,"sourceRoot",null);const l=At.getArg(i,"sourcesContent",null),u=At.getArg(i,"mappings"),h=At.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=At.normalize(c)),o=o.map(String).map(At.normalize).map(function(d){return c&&At.isAbsolute(c)&&At.isAbsolute(d)?At.relative(c,d):d}),r._names=Rl.fromArray(a.map(String),!0),r._sources=Rl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return At.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,wM().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=At.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Aa(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Fe.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=At.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Fe.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Fe.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=At.getArg(t,"source");const r=At.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:At.getArg(t,"line"),generatedColumn:At.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=At.getArg(t,"bias",Fe.GREATEST_LOWER_BOUND);r==null&&(r=Fe.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=At.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=At.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=At.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:At.getArg(i,"originalLine",null),column:At.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=At.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=At.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=At.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:At.getArg(t,"line"),originalColumn:At.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=At.getArg(t,"bias",Fe.GREATEST_LOWER_BOUND);i==null&&(i=Fe.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:At.getArg(s,"generatedLine",null),column:At.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Aa.prototype.consumer=Fe;class xM extends Fe{constructor(t,n){return super(ed).then(r=>{let i=t;typeof t=="string"&&(i=At.parseSourceMapInput(t));const s=At.getArg(i,"version"),o=At.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Rl,r._names=new Rl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=At.getArg(c,"offset"),u=At.getArg(l,"line"),h=At.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new Fe(At.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(At.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(At.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:At.getArg(t,"line"),generatedColumn:At.getArg(t,"column")},r=td.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(At.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=At.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||Fe.GENERATED_ORDER;let o;switch(s){case Fe.GENERATED_ORDER:o=this._generatedMappings;break;case Fe.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=At.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return td.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=At.getArg(t,"line"),r={source:At.getArg(t,"source"),originalLine:n,originalColumn:At.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",At.compareByOriginalPositions,td.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:At.getArg(o,"generatedLine",null),column:At.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:At.getArg(o,"generatedLine",null),column:At.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function kM(e,t){let n=e;typeof e=="string"&&(n=At.parseSourceMapInput(e));const r=n.sections!=null?new xM(n,t):new Aa(n,t);return Promise.resolve(r)}function TM(e,t){return Aa.fromSourceMap(e,t)}var $b={};const AM=Rb.SourceMapGenerator,Il=wa,vM=/(\r?\n)/,SM=10,fo="$$$isSourceNode$$$";let RM=class md{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[fo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new md,s=t.split(vM);let o=0;const a=function(){const f=m(),p=m()||"";return f+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=s[o]||"";const p=h.substr(0,f.generatedColumn-l);s[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,p),u=f;return}for(;c<f.generatedLine;)i.add(a()),c++;l<f.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,f.generatedColumn)),s[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=Il.join(r,f)),i.setSourceContent(f,p))}),i;function d(f,p){if(f===null||f.source===void 0)i.add(p);else{const m=r?Il.join(r,f.source):f.source;i.add(new md(f.originalLine,f.originalColumn,m,p,f.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[fo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[fo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[fo]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[fo]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Il.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][fo]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Il.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new AM(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===SM?(n.line++,n.column=0,h+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};$b.SourceNode=RM;var IM=$b.SourceNode;let jb=0;const zb=Yr,NM=["Command","lines"];class OM extends aL{constructor(){super(C_,{traceInitPerf:Yr,skipValidations:!Yr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Ct(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Ct(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(ga)}])}));Ct(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Ct(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Ct(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Ct(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(s_)}));Ct(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(yf)}));Ct(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(_f)}])}));Ct(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(i_)}));Ct(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(o_),this.SUBRULE(this.words),this.CONSUME(a_)}));Ct(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(so),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Ct(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Ct(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Ct(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Ct(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(Tf),this.SUBRULE(this.words)}));Ct(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(E_),this.SUBRULE(this.words)}));Ct(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Af),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Ct(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(_l),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(ga)),this.CONSUME4(so),this.CONSUME4(vf)}}])}));Ct(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(_l),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(so),this.CONSUME(vf)}}])}));Ct(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(_l),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Ct(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(so),this.CONSUME(Sf),this.CONSUME(Af),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ct(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(so),this.CONSUME(Sf),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ct(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(A_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ct(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(v_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ct(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(S_),this.SUBRULE(this.words)}));Ct(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(R_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ct(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(I_)}));Ct(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(N_)}));Ct(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(k_)}));Ct(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(T_)}));Ct(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(bf),this.SUBRULE2(this.and_test)})}));Ct(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(wf),this.SUBRULE2(this.not_test)})}));Ct(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Ef),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Ct(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Ct(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(u_)},{ALT:()=>this.CONSUME(h_)},{ALT:()=>this.CONSUME(f_)},{ALT:()=>this.CONSUME(d_)},{ALT:()=>this.CONSUME(p_)},{ALT:()=>this.CONSUME(m_)}])}));Ct(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(bf),this.SUBRULE2(this.and_test_value)})}));Ct(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(wf),this.SUBRULE2(this.not_test_value)})}));Ct(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Ef),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Ct(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Ct(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(xf)},{ALT:()=>this.CONSUME(kf)}]),this.SUBRULE(this.term)}));Ct(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Ct(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(y_)},{ALT:()=>this.CONSUME(Tf)},{ALT:()=>this.CONSUME(__)},{ALT:()=>this.CONSUME(b_)}]),this.SUBRULE(this.factor)}));Ct(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(xf)},{ALT:()=>this.CONSUME(kf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Ct(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(g_),this.SUBRULE(this.factor)})}));Ct(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Ct(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(c_)},{ALT:()=>this.CONSUME(cn)},{ALT:()=>this.CONSUME(l_)},{ALT:()=>{this.CONSUME(w_),this.SUBRULE(this.words),this.CONSUME(x_)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=NM.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(jb++).toString().padStart(3),c=s?"font-weight: bold;":"";if(zb&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),zb&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),jb--},i)}}const po=new OM;if(EL){const e=po.getGAstProductions(),t=bL(e);console.info(t)}const CM=po.getBaseCstVisitorConstructor();var yt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(yt||{}),ys=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(ys||{}),Vr=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(Vr||{}),Nl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Nl||{});function LM(e){return!!(e!=null&&e.tokenType)}function ur(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class MM extends CM{constructor(){super();Ct(this,"unique",0);Yr&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&LM(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():k(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:ur(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:ur(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:ur(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:ur(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:ur(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,ur(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Ce(),i=Ce();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Ce(),i=Ce();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,ur(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Ce(),i=Ce();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Ce(),i=Ce(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Ce(),i=Ce(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Ce();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=ur(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}command_toast(n){const i=ur(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,"toast"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=ur(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=ur(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(ur(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.words)}):[]}}const UM=new MM,Un={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Ol="zss.js";function Qt(e,t){return new IM(e.startLine??1,e.startColumn??1,Ol,t)}function nd(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function rd(e){return`'${nd(e)}'`}function Cl(e){if(e.startsWith('"'))return Cl(e.replaceAll(/(^"|"$)/g,""));const t=Gf(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===Wf?`', api.get('${nd(r.image.substring(1))}'), '`:nd(r.image)).join("")}'].join('')`}function mo(e){return e.filter(t=>t!==void 0).map(ie)}function Wb(e){return Qt(e,"")}function FM(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function Ve(e,t,n){return Qt(e,[`api.${t}(`,...FM(n,", "),")"])}function PM(e){if(e.type===yt.COMPARE&&e.compare.type===yt.COMPARE_ITEM)switch(e.compare.method){case ys.IS_EQ:return Ve(e,"isEq",[ie(e.lhs),ie(e.rhs)]);case ys.IS_NOT_EQ:return Ve(e,"isNotEq",[ie(e.lhs),ie(e.rhs)]);case ys.IS_LESS_THAN:return Ve(e,"isLessThan",[ie(e.lhs),ie(e.rhs)]);case ys.IS_GREATER_THAN:return Ve(e,"isGreaterThan",[ie(e.lhs),ie(e.rhs)]);case ys.IS_LESS_THAN_OR_EQ:return Ve(e,"isLessThanOrEq",[ie(e.lhs),ie(e.rhs)]);case ys.IS_GREATER_THAN_OR_EQ:return Ve(e,"isGreaterThanOrEq",[ie(e.lhs),ie(e.rhs)])}return Qt(e,"")}function _s(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ie(n),")"])}function Kb(e,t,n){return e.prepend(`api.${t}(`),e.add([ie(n),")"])}function BM(e,t){if(e.type===yt.OPERATOR_ITEM)switch(e.operator){case Vr.PLUS:return _s(t,"opPlus",e.rhs);case Vr.MINUS:return _s(t,"opMinus",e.rhs);case Vr.POWER:return _s(t,"opPower",e.rhs);case Vr.MULTIPLY:return _s(t,"opMultiply",e.rhs);case Vr.DIVIDE:return _s(t,"opDivide",e.rhs);case Vr.MOD_DIVIDE:return _s(t,"opModDivide",e.rhs);case Vr.FLOOR_DIVIDE:return _s(t,"opFloorDivide",e.rhs);case Vr.UNI_PLUS:return Kb(t,"opUniPlus",e.rhs);case Vr.UNI_MINUS:return Kb(t,"opUniMinus",e.rhs)}return Qt(e,"")}function DM(e){if(e.type===yt.OPERATOR){const t=e.lhs?ie(e.lhs):Qt(e,"");return e.items.forEach(n=>BM(n,t)),t}return Qt(e,"")}function Ll(e,t){return Qt(e,[Ve(e,"jump",[`${t}`]),"; continue;"])}function xi(e){return Un.linelookup[e??""]??-1}function id(e,t){Un.linelookup[e]=t}function go(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===t&&(i.done=n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===t&&(i.skip=n);break;case yt.LINE:go(i.stmts,t,n);break}}}function Gb(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===t&&id(i.done,n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===t&&id(i.skip,n);break;case yt.LINE:Gb(i.stmts,t,n);break}}}function ie(e){var t;switch(e.type){case yt.PROGRAM:return Qt(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ie).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Ol}`]);case yt.API:return Qt(e,["  ",Ve(e,e.method,mo(e.words)),`;
`]);case yt.LINE:return Qt(e,[`case ${e.lineindex}:
`,...e.stmts.map(ie).flat(),`  break;
`]);case yt.MARK:return Qt(e,`  // ${e.comment}
`);case yt.GOTO:{const n=xi(e.id);return Qt(e,["  ",Ll(e,n),`
`])}case yt.COUNT:return Qt(e,`${e.index}`);case yt.LITERAL:switch(e.literal){case Nl.NUMBER:return Qt(e,`${e.value}`);case Nl.STRING:return Qt(e,rd(e.value));case Nl.TEMPLATE:return Qt(e,Cl(e.value))}return Wb(e);case yt.TEXT:return Qt(e,["  ",Ve(e,"text",[Cl(e.value)]),`;
`]);case yt.STAT:if(Un.isfirststat){Un.isfirststat=!1;const n=e.value.trim().split(" ").map(rd);return Qt(e,["  ",Ve(e,"stat",n),`;
`])}return Qt(e,`  // skipped ${e.value}
`);case yt.LABEL:{const n=Lt(e.name),r=e.active?"label":"comment";Un.labels[n]||(Un.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Un.labels[n].push(i),Qt(e,`  // ${i} '${n}' ${r}
`)}case yt.HYPERLINK:return Qt(e,["  ",Ve(e,"hyperlink",[Cl(e.text),...mo(e.link)]),`;
`]);case yt.MOVE:{const n=Ve(e,"command",[rd("go"),mo(e.words)].flat());return e.wait?Qt(e,["  if (",n,`) { continue; };
`]):Qt(e,["  ",n,`;
`])}case yt.COMMAND:return Qt(e,["  if (",Ve(e,"command",mo(e.words)),`) { continue; };
`]);case yt.IF:{const n=((t=e.block)==null?void 0:t.type)===yt.IF_BLOCK?e.block:void 0;if(k(n)){go([e.check],yt.IF_CHECK,n.skip);const r=Qt(e,ie(e.check));return n.lines.forEach(i=>r.add(ie(i))),Gb(n.altlines,yt.ELSE_IF,xi(n.done)),n.altlines.forEach(i=>r.add(ie(i))),r}return Qt(e,ie(e.check))}case yt.IF_CHECK:{const n=xi(e.skip);return n===-1?Qt(e,["  ",Ve(e,e.method,mo(e.words)),`;
`]):Qt(e,["  if (!",Ve(e,e.method,mo(e.words)),") { ",Ll(e,n),` }
`])}case yt.ELSE_IF:case yt.ELSE:{const n=Qt(e,"");return e.lines.forEach(r=>n.add(ie(r))),n}case yt.WHILE:{const n=xi(e.loop),r=xi(e.done),i=Qt(e,"");return go(e.lines,yt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case yt.REPEAT:{const n=xi(e.loop),r=xi(e.done),i=Qt(e,"");return go(e.lines,yt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case yt.WAITFOR:{const n=Qt(e,"");return go(e.lines,yt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ie(r))}),n}case yt.FOREACH:{const n=xi(e.loop),r=xi(e.done),i=Qt(e,"");return go(e.lines,yt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case yt.BREAK:return Qt(e,["  ",Ll(e,e.goto),`
`]);case yt.CONTINUE:return Qt(e,["  ",Ll(e,e.goto),`
`]);case yt.OR:return Ve(e,"or",e.items.map(ie));case yt.AND:return Ve(e,"and",e.items.map(ie));case yt.NOT:return Ve(e,"not",e.items.map(ie));case yt.COMPARE:return PM(e);case yt.OPERATOR:return DM(e);case yt.EXPR:return Ve(e,"expr",e.words.map(ie));default:return console.error("<unsupported node>",e.type,e),Wb(e)}}function Xr(e){if(k(e))switch(e.type===yt.LINE&&++Un.lineindex,e.lineindex=Un.lineindex,e.type){case yt.PROGRAM:e.lines.forEach(Xr);break;case yt.LINE:e.stmts.forEach(Xr);break;case yt.MARK:id(e.id,e.lineindex);break;case yt.IF:Xr(e.check),Xr(e.block);break;case yt.IF_BLOCK:e.lines.forEach(Xr),e.altlines.forEach(Xr);break;case yt.ELSE_IF:e.lines.forEach(Xr);break;case yt.ELSE:case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.WAITFOR:e.lines.forEach(Xr);break;case yt.MOVE:case yt.COMMAND:case yt.IF_CHECK:e.words.forEach(Xr);break}}function $M(e){return Un.labels={},Un.internal=1,Un.lineindex=0,Un.isfirststat=!0,Xr(e),{...ie(e).toStringWithSourceMap({file:`${Ol}.map`}),...Un}}function Hb(e){return ae(e)?e.length>0?1:0:e??0}function jM(e){return`${e}_chip`}function Yb(e=""){return`vm:${e??""}`}function zM(e,t,n){var l,u;const r=jM(e),i=bs(r);let s;const o=qe(Object.entries(n.labels??{}));(!ae(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(h,d){_.words=d;const f=rM(t,h);return k(f)?f(c,d):h!=="send"?a("send",[h,...d]):0}const c={halt(){i8(r)},id(){return e},set(h,d){const[f,p]=sM(t,c,h,d);if(f)return p},get(h){const[d,f]=iM(t,c,h);if(d)return f},tick(h){const d=St(i.ps)?i.ps:0,f=d%h===0;if(i.ps=d+1,f===!1)return!1;if(c.shouldtick()===!1)return Sb(t,c),!1;i.lc=0,i.ys=0,_.get=c.get,oM(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){ye(Y,_.elementfocus,"crash",p.message),i.es=1}return Sb(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return St(i.lc)?++i.lc>pi.HALT_AT_COUNT:!0},hm(){if(ae(i.mg)&&ae(i.lb)){const[h]=i.mg;if(k(h))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h)return p.find(m=>St(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,d,f,p){Y.emit(h,`${Yb(d)}:${f}`,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(ae(i.lb))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h){const m=p.findIndex(E=>E>0);m>=0&&(p[m]*=-1)}}},restore(h){if(ae(i.lb))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h)for(let m=0;m<p.length;m++)p[d]=Math.abs(p[d])}},getcase(){i.ec=St(i.ec)?i.ec:1;const h=c.hm();if(h&&ae(i.mg)){const[,d,f,p]=i.mg;c.set("sender",f),k(d)&&c.set("arg",d),p&&(c.set("player",p),_.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=St(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const d=GL.parse(h),[f]=d.filter(p=>p.fileName===Ol);return{line:(f==null?void 0:f.lineNumber)??0,column:(f==null?void 0:f.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[d,...f]=h;return a(Lt(be(d)),f)},if(...h){const[d,f]=rt(h,0,[W.ANY]),p=Hb(d);return p&&f<h.length&&c.command(...h.slice(f)),p?1:0},try(...h){const[,d]=rt(h,0,[W.DIR]),f=c.command("go",...h);return f&&d<h.length&&c.command(...h.slice(d)),f?1:0},take(...h){const[d,f,p]=rt(h,0,[W.NAME,W.ANY]),m=St(f),E=m?p:1,w=c.get(d),T=m?f:1;if(!St(w))return E<h.length&&c.command(...h.slice(E)),1;const A=w-T;return A<0?(E<h.length&&c.command(...h.slice(E)),1):(c.set(d,A),0)},give(...h){const[d,f,p]=rt(h,0,[W.NAME,W.ANY]),m=St(f),E=m?p:1,w=c.get(d),T=m?f:1,A=w===void 0?1:0;return A&&E<h.length&&c.command(...h.slice(E)),c.set(d,ba(w,0)+T),A},repeatstart(h,...d){const[f,p]=rt(d,0,[W.NUMBER]),m=`repeatcount${h}`,E=`repeatwords${h}`;i[m]=f,i[E]=p<d.length?d.slice(p):void 0},repeat(h){const d=`repeatcount${h}`,f=`repeatwords${h}`;if(!St(i[d]))return 0;const p=i[d];i[d]=p-1;const m=p>0,E=i[f];return m&&ae(E)&&c.command(...E),m?1:0},foreachstart(h,...d){const[f,p,m,E]=rt(d,0,[W.NAME,W.NUMBER,W.NUMBER,W.MAYBE_NUMBER]);let w=Math.min(p,m),T=Math.max(p,m);const A=(E??0)||1;if(A<0){const I=w;w=T,T=I}return c.set(f,w-A),0},foreach(h,...d){const[f,p,m,E,w]=rt(d,0,[W.NAME,W.NUMBER,W.NUMBER,W.MAYBE_NUMBER]);let T=Math.min(p,m),A=Math.max(p,m);const I=(E??0)||1;if(I<0){const L=T;T=A,A=L}let M=c.get(f);!St(M)||M<T||M>A?M=T:M+=I;const S=M<=A?1:0;return S&&(c.set(f,M),w<d.length&&c.command(...d.slice(w))),S},waitfor(...h){const[d]=rt(h,0,[W.ANY]),f=Hb(d);return f||c.yield(),f?1:0},or(...h){let d=0;for(let f=0;f<h.length;){const[p,m]=rt(h,f,[W.ANY]);if(d=p,d)break;f=m}return d},and(...h){let d=0;for(let f=0;f<h.length;){const[p,m]=rt(h,f,[W.ANY]);if(d=p,!d)break;f=m}return d},not(...h){const[d]=rt(h,0,[W.ANY]);return d?0:1},expr(...h){const[d]=rt(h,0,[W.ANY]);return d},isEq(h,d){const[f]=rt([h],0,[W.ANY]),[p]=rt([d],0,[W.ANY]);return typeof f=="object"||typeof p=="object"?q1(f,p)?1:0:f===p?1:0},isNotEq(h,d){return this.isEq(h,d)?0:1},isLessThan(h,d){const[f]=rt([h],0,[W.NUMBER]),[p]=rt([d],0,[W.NUMBER]);return f<p?1:0},isGreaterThan(h,d){const[f]=rt([h],0,[W.NUMBER]),[p]=rt([d],0,[W.NUMBER]);return f>p?1:0},isLessThanOrEq(h,d){const[f]=rt([h],0,[W.NUMBER]),[p]=rt([d],0,[W.NUMBER]);return f<=p?1:0},isGreaterThanOrEq(h,d){const[f]=rt([h],0,[W.NUMBER]),[p]=rt([d],0,[W.NUMBER]);return f>=p?1:0},opPlus(h,d){const[f]=rt([h],0,[W.ANY]),[p]=rt([d],0,[W.ANY]);return f+p},opMinus(h,d){const[f]=rt([h],0,[W.ANY]),[p]=rt([d],0,[W.ANY]);return f-p},opPower(h,d){const[f]=rt([h],0,[W.NUMBER]),[p]=rt([d],0,[W.NUMBER]);return Math.pow(f,p)},opMultiply(h,d){const[f]=rt([h],0,[W.NUMBER]),[p]=rt([d],0,[W.NUMBER]);return f*p},opDivide(h,d){const[f]=rt([h],0,[W.NUMBER]),[p]=rt([d],0,[W.NUMBER]);return f/p},opModDivide(h,d){const[f]=rt([h],0,[W.NUMBER]),[p]=rt([d],0,[W.NUMBER]);return f%p},opFloorDivide(h,d){const[f]=rt([h],0,[W.NUMBER]),[p]=rt([d],0,[W.NUMBER]);return Math.floor(f/p)},opUniPlus(h){const[d]=rt([h],0,[W.NUMBER]);return+d},opUniMinus(h){const[d]=rt([h],0,[W.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function sd(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ae(r)?r.forEach(i=>{t.push(sd(i))}):t.push(sd(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function WM(e){const t=Rf(`${e}
`);if(t.errors.length>0)return t;po.input=t.tokens;const n=po.program();if(po.errors.length>0)return{tokens:t.tokens,errors:po.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=UM.go(n);return r?(sd(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const od=Object.getPrototypeOf(function*(){}).constructor;function KM(e,t){const n=`compile-${e}`;console.time(n);const r=WM(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=$M(r.ast);if(i.code){wL&&console.info(i.code);try{return{...r,...i,source:i.code,code:new od("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new od("api"," ")}}}return{...r,...i,source:"",code:new od("api"," ")}}function GM(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=KM(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return k(s)?s.isended():!0},halt(i){const s=t[i];return k(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];k(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!k(t[i])){const h=n(a,c);if(l=t[i]=zM(i,s,h),(u=h.errors)!=null&&u.length){const[d]=h.errors,f=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((w,T)=>[w,T]);p.slice(f-5,f).forEach(([w,T])=>{ye(Y,Tr(),"build",`$grey${T+1} $grey${w}`)});const[m,E]=p[f]??[];if(kt(m)&&k(E)){const w=(d.column??1)-1,T=w+d.length,A=w<m.length?m:`${m}*`,I=A.substring(0,w),M=A.substring(w,T),S=A.substring(T);ye(Y,Tr(),"build",`$red${E+1} $grey${I}$red${M}$grey${S}`)}return d.message.split(`
`).forEach(w=>{ye(Y,Tr(),"build",w)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=fr(i.target),a=t[s];if(k(a)){const c={...i,target:o};a.message(c)}}};return r}let Vb=0;function HM(){switch(Vb++){case 0:return jt.BLUE;case 1:return jt.GREEN;case 2:return jt.CYAN;case 3:return jt.RED;case 4:return jt.PURPLE;case 5:return jt.YELLOW;default:return Vb=0,jt.WHITE}}const ze=new jo,wn={},Ml={};function Xb(e,t,n,r,i=0){const s=`tiles:${e}:${t}`;return k(wn[s])||(wn[s]=DT(e,t,n,r,i)),wn[s]}function YM(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return k(Ml[s])||(Ml[s]=$T(e,t,n)),Ml[s].id=i,Ml[s]}function VM(e,t){const n=`sprites:${e}:${t}`;return k(wn[n])||(wn[n]=jT(e,t)),wn[n]}function XM(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return k(wn[s])||(wn[s]=zT(e,t,n,r,i)),wn[s]}function ad(e,t,n,r){const i=`media:${e}:${t}`;k(wn[i])||(wn[i]=WT(e,t,n,r));const s=wn[i];return s.mime=n,s.media=r,s}function qM(e,t){const n=`control:${e}:${t}`;return k(wn[n])||(wn[n]=KT(e,t)),wn[n]}const Wi=.4;function qb(e,t){const n=[];ze.x=e-Wi,ze.y=t-Wi,n.push(ze.angle()),ze.x=e+Wi,ze.y=t-Wi,n.push(ze.angle()),ze.x=e-Wi,ze.y=t+Wi,n.push(ze.angle()),ze.x=e+Wi,ze.y=t+Wi,n.push(ze.angle());const r=Math.round(rh(Math.min(...n))),i=Math.round(rh(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function JM(e,t,n,r,i){var L;if(!k(r)||!k(r.terrain)||!k(r.objects))return[];const s=[];let o=t;const a=o===0,c=It,l=re,u=a?jt.BLACK:jt.ONCLEAR,h=Xb(e,o++,c,l,u);s.push(h);const d=o++,f=VM(e,d);f.sprites=[],s.push(f);const p=r.isdark?1:0,m=XM(e,o++,c,l,p);s.push(m),m.alphas.fill(p);const E=Xb(e,o++,c,l,jt.ONCLEAR);s.push(E),E.char.fill(0);const w={...Hf(It,re,HM(),jt.ONCLEAR),...E},T=qM(e,o++);if(i&&(s.push(T),kt(r.camera)))switch(Lt(r.camera)){default:T.viewscale=1.5;break;case"near":T.viewscale=3;break;case"far":T.viewscale=1;break}for(let B=0;B<r.terrain.length;++B){const O=r.terrain[B],G=W_(n,O,0,jt.WHITE,a?jt.BLACK:jt.ONCLEAR);h.char[B]=G.char,h.color[B]=G.color,h.bg[B]=G.bg}const A=Object.values(r.objects??{});for(let B=0;B<A.length;++B){const O=A[B];if(k(O.removed))continue;const G=O.id??"",et=W_(n,O,1,jt.WHITE,a?jt.BLACK:jt.ONCLEAR),C=YM(e,d,G,B);if(C.x=O.x??0,C.y=O.y??0,C.char=et.char,C.color=et.color,C.bg=et.bg,f.sprites.push(C),p){if(et.light>0){const R=[],b=rn(Math.round(et.light),1,10),P=b*.5,J=mr(r,C),D=1/P;if(m.alphas[J]=0,b>1)for(let st=1;st<=b;++st)for(let tt=C.y-st;tt<=C.y+st;++tt)for(let ft=C.x-st;ft<=C.x+st;++ft){if(ft===C.x&&tt===C.y)continue;ze.x=ft-C.x,ze.y=tt-C.y;const V=ze.length();if(V>b)continue;const z=mr(r,{x:ft,y:tt});if(z===-1)continue;const Et=Math.round(rh(ze.angle()));let at=0;for(let Tt=0;Tt<R.length;++Tt){const Dt=R[Tt];Et>=Dt[0]&&Et<=Dt[1]&&(at=Math.max(at,Dt[2]))}m.alphas[z]=Math.min(m.alphas[z],at+(V<P?0:(V-P)*D)),m.alphas[z]=rn(m.alphas[z],0,1);const lt=gn(r,((L=r.lookup)==null?void 0:L[z])??"");if(k(lt)){const Tt=[...qb(ze.x,ze.y),.25];R.push(Tt)}const Mt=r.terrain[z],Xt=xr(n,Mt),Ut=(Mt==null?void 0:Mt.collision)??(Xt==null?void 0:Xt.collision);if(kc(Ht.ISBULLET,Ut)){const Tt=[...qb(ze.x,ze.y),1];let Dt=0;for(Dt=0;Dt<R.length;++Dt){const Ft=R[Dt];if(Ft[1]>Ft[0]&&Tt[1]>=Ft[0]&&Tt[0]<=Ft[1]&&Tt[2]>=1&&Ft[2]>=1){R[Dt]=[Math.min(Tt[0],Ft[0]),Math.max(Tt[1],Ft[1]),1];break}}Dt===R.length&&R.push(Tt)}}}else if(vr(G)){const R=mr(r,C);m.alphas[R]=0}}if(kt(O.tickertext)&&St(O.tickertime)&&O.tickertext.length){const R=It,b=pb(O.tickertext,R,re-1),P=(b==null?void 0:b.measuredwidth)??1,J=O.x??0,D=O.y??0,st=D<re*.5;w.x=J-Math.floor(P*.5),w.y=D+(st?1:-1),w.x+P>It&&(w.x=It-P),w.x<0&&(w.x=0),db(O.tickertext,w,!0)}G===e&&(T.focusx=C.x,T.focusy=C.y,T.focusid=G)}const I=ue(Bt.MAIN),M=_i(I,Bt.MAIN);if(kt(M.palette)){const B=En(I,_t.PALETTE,M.palette),O=De(B);k(O==null?void 0:O.bits)&&s.push(ad(e,o++,"image/palette",Array.from(O.bits)))}if(kt(M.charset)){const B=En(I,_t.CHARSET,M.charset),O=De(B);k(O==null?void 0:O.bits)&&s.push(ad(e,o++,"image/charset",Array.from(O.bits)))}const S=Object.keys(r.objects).filter(vr);return s.push(ad(e,o++,"text/players",S.join(","))),s}const Yn=GM();var Bt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Bt||{});const Ee={halt:!1,session:Ce(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function ZM(){return Ee.session}function Tr(){return Ee.operator}function QM(e){Ee.operator=e}function t8(e){Ee.halt=e}function e8(){return Ee.halt}function yo(){return[...Ee.books.values()]}function n8(){const[e]=Ee.books.values();return e}function Ar(e){const t=Lt(e);return Ee.books.get(e)??yo().find(n=>n.name===t)}function Ul(e,t){k(Ar(t))&&(Ee.software[e]=t)}function ue(e){return Ar(Ee.software[e])}function Jb(e){const t=B_([]);return kt(e)&&(t.name=e),cd(t),Zr(Y,Ee.operator,`created [book] ${t.name}`),t}function r8(e){let t=Ar(e);return k(t)||(t=B_([]),t.name=e),cd(t),Zr(Y,Ee.operator,`created [book] ${t.name}`),t}function xn(e,t){let n=k(t)?r8(t):ue(e);return k(n)||(k(n)||(n=n8()),k(n)||(n=Jb(t)),k(n)&&Zr(Y,Ee.operator,`opened [book] ${n.name} for ${e}`)),Ul(e,n.id),n}function Ki(e,t,n){return Lf(xn(e),n,t)}function bs(e){const t=xn("main");return _i(t,e)}function Zb(){const e=xn("main");return _i(e,"main")}function i8(e){const t=xn("main");return K_(t,e)}function s8(e,t){Ee.books.clear(),e.forEach(r=>{Ee.books.set(r.id,r),r.name==="main"&&(Ee.software.main=r.id)});const n=Ar(t);if(k(n)&&Ul("main",n.id),!Ee.software.main){const r=Ee.books.values().next();r.value&&(Ee.software.main=r.value.id)}}function cd(e){return Ee.books.set(e.id,e),e.id}function o8(e){const t=Ar(e);t&&Ee.books.delete(t.id)}function a8(e){if(!kt(e)||!e)return ye(Y,e,"login",`failed for playerid ==>${e}<==`);const t=ue("main");if(!k(t))return ye(Y,e,"login:main","login failed to find book 'main'");const n=ps(t,e);if(k(n))return!0;const r=Mn(t,_t.BOARD,"title");if(r.length===0)return ye(Y,e,"login:title","login failed to find board with 'title' stat");const i=_a(t,"player");if(!k(i))return ye(Y,e,"login:player","login failed to find object type 'player'");const s=zp(e,r),o=De(s);if(k(o)){const a=P_(s,"startx"),c=P_(s,"starty"),l=St(a)?a:Math.round(It*.5),u=St(c)?c:Math.round(re*.5),h=i.name??"player",d=bh(o,{x:l,y:u},h,e);if(k(d==null?void 0:d.id))return d.player=e,wl(t,e,o.id),!0}return!1}function c8(e){const t=ue("main"),n=ps(t,e);wl(t,e,""),Ff(t,n,gn(n,e)),Sm(n,e),Yn.halt(e),K_(t,e)}function Vn(e){const t=ue("main");return ps(t,e)}function l8(e){const t=ue("main"),n=ML(t,e),r=ps(t,e),i=gn(r,e);return n&&k(i)}function u8(e){const t=ue("main"),n=Uf(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;vr(c)&&k(e[c])===!1&&(e[c]=0,wl(t,c,i.id))}}}function Qb(e){Yn.message(e)}function va(e,t,n,r){const i=Br(t);kt(n.id)&&Y.emit(e,"vm:touched",[n.id,i,r])}function ld(e,t,n,r){if(!k(n==null?void 0:n.id))return!1;const i=J_(e,t,n,r);if(k(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=Mn(e,_t.BOARD,(t==null?void 0:t.exitwest)??"");if(o.length){const a=we(o);ao(e,n.id,a.id,{x:It-1,y:r.y})}}else if(r.x>=It){const o=Mn(e,_t.BOARD,(t==null?void 0:t.exiteast)??"");if(o.length){const a=we(o);ao(e,n.id,a.id,{x:0,y:r.y})}}else if(r.y<0){const o=Mn(e,_t.BOARD,(t==null?void 0:t.exitnorth)??"");if(o.length){const a=we(o);ao(e,n.id,a.id,{x:r.x,y:re-1})}}else if(r.y>=re){const o=Mn(e,_t.BOARD,(t==null?void 0:t.exitsouth)??"");if(o.length){const a=we(o);ao(e,n.id,a.id,{x:r.x,y:0})}}}else va("",i,n,"thud");if(n.kind==="player"){const o=vr(i.id);va(n.id,n,i,o?"bump":"touch")}else if(n.collision===Ht.ISBULLET){const o=vr(n.party),a=vr(i.id);o!==a?va(n.party??"",n,i,"shot"):va("",n,i,"thud")}else va("",n,i,"bump");const s=xr(e,i);return i.destructible??(s==null?void 0:s.destructible)?(k(i==null?void 0:i.id)?kr(_.book,_.board,i,_.timestamp):Sn(t,{x:r.x,y:r.y}),!0):!1}return!0}function t1(e,t,n,r,i=jE){var h;if(!k(e)||!k(t)||!k(n))return;const s={..._};_.book=e,_.board=t,_.element=n,_.elementid=n.id??"",_.elementisplayer=vr(_.elementid);const o=_.element.player??Ee.operator;_.elementfocus=_.elementisplayer?_.elementid:o;const a=xr(e,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=Lt(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(Yn.tick(l,zi.RUNTIME,St(c)?c:i,u,r),St(n==null?void 0:n.tickertime)&&_.timestamp-n.tickertime>Ma*5&&(n.tickertime=0,n.tickertext=""),_.elementisplayer){const d=bs(_.elementid);St(d.inputcurrent)&&(d.inputcurrent=0)}Xn(s).forEach(d=>{_[d]=s[d]})}function h8(e,t){Ee.loaders.set(e,t)}function f8(e){Yn.halt(e)}function d8(){const e=Yn.ids();for(let n=0;n<e.length;++n)Yn.halt(e[n]);const t=ue("main");k(t)&&(t.flags={})}function p8(){const e=ue("main");if(!k(e))return;const t=e.timestamp+1,n=pi.HALT_AT_COUNT;pi.HALT_AT_COUNT=n*2,Ee.loaders.forEach((i,s)=>{const o={..._};_.timestamp=e.timestamp,_.book=e,_.board=void 0,_.element=void 0,_.elementid=s,_.elementisplayer=!1,_.elementfocus="";const a=L6(s);k(a)&&Yn.arg(s,a),Yn.tick(s,zi.LOADER,1,"loader",i),Yn.isended(s)&&(Yn.halt(s),Ee.loaders.delete(s)),Xn(o).forEach(c=>{_[c]=o[c]})}),pi.HALT_AT_COUNT=n,e.timestamp=t,_.timestamp=t;const r=Uf(e);for(let i=0;i<r.length;++i){const s=r[i],o=zL(e,s,t);for(let a=0;a<o.length;++a){const{id:c,type:l,code:u,object:h}=o[a];l===_t.ERROR?Yn.halt(c):t1(e,s,h,u)}}}function ud(e,t){const n=ue("main");if(!k(n))return;function r(a,c){for(let l=0;l<a.length;++l){const u=a[l];if(k(u.id)){const h=`${Yb(u.id)}:${c}`;Y.emit("",h,t)}}}const{target:i,path:s}=fr(e),o=Uf(n);for(let a=0;a<o.length;++a){const c=o[a];switch(Lt(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(Im(c,[i]),s);break}}}}function m8(e,t=""){var s;const n=xn("main");if(!k(n))return;const r=`${e}_cli`;_.timestamp=n.timestamp,_.book=n,_.board=ps(n,e),_.element=gn(_.board,e),_.elementid=((s=_.element)==null?void 0:s.id)??"",_.elementisplayer=!0,_.elementfocus=_.elementid||e;const i=pi.HALT_AT_COUNT;pi.HALT_AT_COUNT=i*8,Id(Y,e,"running",n.timestamp,r,t),Yn.once(r,zi.CLI,"cli",t),pi.HALT_AT_COUNT=i}function Fl(e){var o;const t=xn("main"),n=yi(t,e);if(!k(t)||!k(n)||!k(_.element))return;const r=`${e}_run`,i=Lt(_.element.name??((o=_.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";Yn.once(r,zi.RUNTIME,i,s)}function g8(e){const t=ue("main"),n=ps(t,e),r=[];if(!k(t)||!k(n))return r;const i=Di(t,n.overboard??""),o=[Di(t,n.underboard??""),n,i];let a=0;for(let c=0;c<o.length;++c){const l=o[c],u=JM(e,a,t,l,l===n);a+=u.length,r.push(...u)}return r}function _o(e,t=0){const n=[];let r=e;for(;r<_.words.length;){const[i,s]=Fn(r);if(ae(i)&&!ns(i)&&!Ea(i)&&!kl(i)&&!Fr(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),t>0&&n.length>=t)return[n,r]}return[n,r]}function Fn(e){var r,i,s,o,a,c,l,u,h;const t=_.words[e],n=e+1;if(Eb(t)){const[d,f]=T6(e);if(k(d))return[d,f]}if(A6(t)){const[d,f]=v6(e);if(k(d))return[d,f]}if(oh(t)){const[d,f]=ah(e);if(k(d))return[d,f]}if(kt(t)&&Lt(t)==="rnd"){const[d,f]=Fn(n),[p,m]=Fn(f);return St(d)&&St(p)?[tr(d,p),m]:St(d)?[tr(0,d),f]:[tr(0,1),n]}if(sh(t)){const[d,f]=Gp(e);if(k(d))return[d,f]}if(!k(t))return[void 0,e];if(St(t)||ae(t))return[t,n];if(kt(t)){const d=Lt(t),f=(r=_.get)==null?void 0:r.call(_,t);if(k(f))return[f,n];switch(d){case"aligned":case"alligned":{const p=Xo(_.board,{x:((i=_.element)==null?void 0:i.x)??-1,y:((s=_.element)==null?void 0:s.y)??-1},_.elementfocus);return!k(_.element)||!k(p)?[0,n]:[_.element.x===p.x||_.element.y===p.y?1:0,n]}case"contact":{const p=Xo(_.board,{x:((o=_.element)==null?void 0:o.x)??-1,y:((a=_.element)==null?void 0:a.y)??-1},_.elementfocus);if(!k(_.element)||!k(p))return[0,n];const m=(p.x??0)-(((c=_.element)==null?void 0:c.x)??0),E=(p.y??0)-(((l=_.element)==null?void 0:l.y)??0);return[m===0&&Math.abs(E)<2||E===0&&Math.abs(m)<2?1:0,n]}case"blocked":{const[p,m]=rt(_.words,n,[W.DIR]);return[$L(_.book,_.board,_.element,p)?1:0,m]}case"any":{const[p,m]=rt(_.words,n,[W.KIND]);return[Rm(_.board,p).length?1:0,m]}case"rnd":return[tr(0,1),n];case"abs":{const[p,m]=rt(_.words,n,[W.NUMBER]);return[Math.abs(p),m]}case"ceil":{const[p,m]=rt(_.words,n,[W.NUMBER]);return[Math.ceil(p),m]}case"floor":{const[p,m]=rt(_.words,n,[W.NUMBER]);return[Math.floor(p),m]}case"round":{const[p,m]=rt(_.words,n,[W.NUMBER]);return[Math.round(p),m]}case"clamp":{const[p,m,E,w]=rt(_.words,n,[W.NUMBER,W.NUMBER,W.NUMBER]);return[rn(p,m,E),w]}case"min":{const[p,m]=_o(n);return[Math.min(...p),m]}case"max":{const[p,m]=_o(n);return[Math.max(...p),m]}case"pick":{const[p,m]=_o(n);return[we(p),m]}case"pickwith":{const[p,m]=rt(_.words,n,[W.NUMBER_OR_STRING]),[E,w]=_o(m);return[zp(`${p}`,E),w]}case"random":{const[p,m]=_o(n,2),[E,w]=p;return[tr(E,w??0),m]}case"randomwith":{const[p,m]=rt(_.words,n,[W.NUMBER_OR_STRING]),[E,w]=_o(m,2),[T,A]=E;return[$p(`${p}`,T,A??0),w]}case"run":{const[p,m]=rt(_.words,n,[W.NAME]);return Fl(p),[(u=_.get)==null?void 0:u.call(_,"arg"),m]}case"runwith":{const[p,m,E]=rt(_.words,n,[W.ANY,W.NAME]);return k(_.element)&&(_.element.arg=p),Fl(m),[(h=_.get)==null?void 0:h.call(_,"arg"),E]}}}return[t,n]}const _={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var W=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.MAYBE_KIND=7]="MAYBE_KIND",e[e.MAYBE_NAME=8]="MAYBE_NAME",e[e.MAYBE_NUMBER=9]="MAYBE_NUMBER",e[e.MAYBE_STRING=10]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",e[e.ANY=12]="ANY",e))(W||{});function dn(e,t,n){throw console.info(n,_.element,_.elementid,_.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function e1(e){var r,i;const t={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};return k(_.board)&&k(_.element)?q_(_.book,_.board,_.element,_.elementfocus,e,t):t}function rt(e,t,n){const r=_.words;_.words=e;const i=[];let s=t;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=qp(s);Xs(a)?(s=c,i.push(a)):dn("kind",a,e);break}case 0:{if(oh(e[0])===void 0){const[a,c]=Fn(s);Fr(a)?(s=c,i.push(a)):dn("color",a,e)}else{const[a,c]=ah(s);Fr(a)?(s=c,i.push(a)):dn("color",a,e)}break}case 2:{if(sh(e[0])===void 0){const[a,c]=Fn(s);ns(a)?(s=c,i.push(e1(a))):dn("direction",a,e)}else{const[a,c]=Gp(s);ns(a)?(s=c,i.push(e1(a))):dn("direction",a,e)}break}case 3:{const a=_.words[s];kt(a)||dn("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Fn(s);if(kt(a)){const l=parseFloat(a);St(l)?i.push(l):dn("number",a,e)}else St(a)?i.push(a):dn("number",a,e);s=c;break}case 5:{const[a,c]=Fn(s);kt(a)||dn("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Fn(s);let l=a;if(kt(l)){const u=parseFloat(l);St(u)&&(l=u)}else St(l)||dn("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=qp(s);a!==void 0&&!Xs(a)&&dn("optional kind",a,e),s=c,i.push(a);break}case 8:{const a=_.words[s];a!==void 0&&!kt(a)&&dn("optional string",a,e),++s,i.push(a);break}case 9:{const[a,c]=Fn(s);if(kt(a)){const l=parseFloat(a);St(l)?i.push(l):dn("optional number",a,e)}else St(a)||a===void 0?i.push(a):dn("optional number",a,e);s=c;break}case 10:{const[a,c]=Fn(s);a!==void 0&&!kt(a)&&dn("optional string",a,e),s=c,i.push(a);break}case 11:{const[a,c]=Fn(s);let l=a;if(kt(l)){const u=parseFloat(l);St(u)&&(l=u)}else l!==void 0&&!St(l)&&dn("number or string",l,e);s=c,i.push(l);break}case 12:{const[a,c]=Fn(s);s=c,i.push(a);break}}return _.words=r,[...i,s]}const Pl={},bo={};function hd(){return{id:Ce(),layers:[],scroll:[],sidebar:[]}}const y8=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),_8=new Set(["tx","text"]),b8={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},n1={};let r1=e=>{let t=n1[e];return k(t)||(n1[e]=t=hd()),t};function E8(e){r1=e}function kn(e){return r1(e)}function fd(e){return k(Pl[e])||(Pl[e]=[]),Pl[e]}function w8(e){const t=kn(e);t.scroll=[]}function x8(e,t,n){Object.values(bo).forEach(r=>{if(r[t]!==void 0){const i=Cm(e.id(),t);St(n)&&Bk(i,n),kt(n)&&Dk(i,n)}})}function qr(e){const t=fd(e);return Pl[e]=[],t}function se(e,t){fd(e).push(t)}function $t(e,t,n,r,i=()=>0,s=Jl){const o=[t,n,...r],a=Lt(`${o[3]}`),c={..._};function l(u,h){k(h)&&h!==i(u)&&(_.board=c.board,_.element=c.element,_.elementfocus=c.elementfocus,s(u,h))}if(y8.has(a)){const u=`${o[2]}`;bo[t]=bo[t]??{};const h=i(u)??b8[a];if(bo[t][u]===void 0){const d=Cm(t,u);St(h)&&Pk(d,h),kt(h)&&qu(d,h),_8.has(a)?bo[t][u]=Sp(d,f=>{l(u,f)}):bo[t][u]=$k(d,f=>{l(u,f)})}}fd(e).push(o)}E8(e=>{if(vr(e)){const t=ue(Bt.MAIN),n=_i(t,Bt.GADGETSTORE);let r=n[e];return k(r)||(n[e]=r=hd()),r}return hd()});const Bl=As("gadgetserver",["tock","second"],e=>{if(!Bl.session(e))return;const t=ue(Bt.MAIN),n=(t==null?void 0:t.activelist)??[],r=_i(t,Bt.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=kn(s);o.layers=g8(s);const a=r[s]??{},c=Rd(a,o);c.length&&(r[s]=qe(o),dE(Bl,s,c))}break;case"second":{for(let i=0;i<n.length;++i){const s=n[i],o=Vn(s);k(o)&&vE(Bl,s,o.id)}break}case"desync":fE(Bl,e.player,kn(e.player));break;case"clearscroll":w8(e.player);break;case"clearplayer":{const i=ue(Bt.MAIN),s=_i(i,Bt.GADGETSTORE);delete s[e.player];const o=_i(i,Bt.GADGETSYNC);delete o[e.player];break}}});function Dl(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var i1={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var h=typeof Dl=="function"&&Dl;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[l]={exports:{}};r[l][0].call(f.exports,function(p){var m=r[l][1][p];return o(m||p)},f,f.exports,n,r,i,s)}return i[l].exports}for(var a=typeof Dl=="function"&&Dl,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,d,f,p,m,E=[],w=0,T=c.length,A=T,I=s.getTypeOf(c)!=="string";w<c.length;)A=T-w,h=I?(l=c[w++],u=w<T?c[w++]:0,w<T?c[w++]:0):(l=c.charCodeAt(w++),u=w<T?c.charCodeAt(w++):0,w<T?c.charCodeAt(w++):0),d=l>>2,f=(3&l)<<4|u>>4,p=1<A?(15&u)<<2|h>>6:64,m=2<A?63&h:64,E.push(a.charAt(d)+a.charAt(f)+a.charAt(p)+a.charAt(m));return E.join("")},i.decode=function(c){var l,u,h,d,f,p,m=0,E=0,w="data:";if(c.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var T,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=o.uint8array?new Uint8Array(0|A):new Array(0|A);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(f=a.indexOf(c.charAt(m++)))>>2,h=(3&f)<<6|(p=a.indexOf(c.charAt(m++))),T[E++]=l,f!==64&&(T[E++]=u),p!==64&&(T[E++]=h);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,h,d,f,p){this.compressedSize=u,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(f,p){var m,E="";for(m=0;m<p;m++)E+=String.fromCharCode(255&f),f>>>=8;return E}function o(f,p,m,E,w,T){var A,I,M=f.file,S=f.compression,L=T!==l.utf8encode,B=a.transformTo("string",T(M.name)),O=a.transformTo("string",l.utf8encode(M.name)),G=M.comment,et=a.transformTo("string",T(G)),C=a.transformTo("string",l.utf8encode(G)),R=O.length!==M.name.length,b=C.length!==G.length,P="",J="",D="",st=M.dir,tt=M.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ft.crc32=f.crc32,ft.compressedSize=f.compressedSize,ft.uncompressedSize=f.uncompressedSize);var V=0;p&&(V|=8),L||!R&&!b||(V|=2048);var z=0,Et=0;st&&(z|=16),w==="UNIX"?(Et=798,z|=function(lt,Mt){var Xt=lt;return lt||(Xt=Mt?16893:33204),(65535&Xt)<<16}(M.unixPermissions,st)):(Et=20,z|=function(lt){return 63&(lt||0)}(M.dosPermissions)),A=tt.getUTCHours(),A<<=6,A|=tt.getUTCMinutes(),A<<=5,A|=tt.getUTCSeconds()/2,I=tt.getUTCFullYear()-1980,I<<=4,I|=tt.getUTCMonth()+1,I<<=5,I|=tt.getUTCDate(),R&&(J=s(1,1)+s(u(B),4)+O,P+="up"+s(J.length,2)+J),b&&(D=s(1,1)+s(u(et),4)+C,P+="uc"+s(D.length,2)+D);var at="";return at+=`
\0`,at+=s(V,2),at+=S.magic,at+=s(A,2),at+=s(I,2),at+=s(ft.crc32,4),at+=s(ft.compressedSize,4),at+=s(ft.uncompressedSize,4),at+=s(B.length,2),at+=s(P.length,2),{fileRecord:h.LOCAL_FILE_HEADER+at+B+P,dirRecord:h.CENTRAL_FILE_HEADER+s(Et,2)+at+s(et.length,2)+"\0\0\0\0"+s(z,4)+s(E,4)+B+P+et}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),h=n("../signature");function d(f,p,m,E){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=E,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var p=f.meta.percent||0,m=this.entriesCount,E=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-E-1))/m:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var p=this.streamFiles&&!f.file.dir;if(p){var m=o(f,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var p=this.streamFiles&&!f.file.dir,m=o(f,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(E){return h.DATA_DESCRIPTOR+s(E.crc32,4)+s(E.compressedSize,4)+s(E.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-f,E=function(w,T,A,I,M){var S=a.transformTo("string",M(I));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(T,4)+s(A,4)+s(S.length,2)+S}(this.dirRecords.length,m,f,this.zipComment,this.encodeFileName);this.push({data:E,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var p=this;return f.on("data",function(m){p.processChunk(m)}),f.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),f.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var p=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var m=0;m<p.length;m++)try{p[m].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,p=0;p<f.length;p++)f[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var p=function(T,A){var I=T||A,M=s[I];if(!M)throw new Error(I+" is not a valid compression method !");return M}(f.options.compression,c.compression),m=f.options.compressionOptions||c.compressionOptions||{},E=f.dir,w=f.date;f._compressWorker(p,m).withStreamInfo("file",{name:d,dir:E,date:w,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function h(d){return new o.Promise(function(f,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(E){p(E)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(d,f){var p=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(m){var E=new c(f);return E.load(m),E}).then(function(m){var E=[o.Promise.resolve(m)],w=m.files;if(f.checkCRC32)for(var T=0;T<w.length;T++)E.push(h(w[T]));return o.Promise.all(E)}).then(function(m){for(var E=m.shift(),w=E.files,T=0;T<w.length;T++){var A=w[T],I=A.fileNameStr,M=s.resolve(A.fileNameStr);p.file(M,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:f.createFolders}),A.dir||(p.file(M).unsafeOriginalName=I)}return E.zipComment.length&&(p.comment=E.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,d){u.push(h)||u._helper.pause(),l&&l(d)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof en<"u",newBufferFrom:function(s,o){if(en.from&&en.from!==Uint8Array.from)return en.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new en(s,o)},allocBuffer:function(s){if(en.alloc)return en.alloc(s);var o=new en(s);return o.fill(0),o},isBuffer:function(s){return en.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(M,S,L){var B,O=a.getTypeOf(S),G=a.extend(L||{},u);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(M=w(M)),G.createFolders&&(B=E(M))&&T.call(this,B,!0);var et=O==="string"&&G.binary===!1&&G.base64===!1;L&&L.binary!==void 0||(G.binary=!et),(S instanceof h&&S.uncompressedSize===0||G.dir||!S||S.length===0)&&(G.base64=!1,G.binary=!0,S="",G.compression="STORE",O="string");var C=null;C=S instanceof h||S instanceof c?S:p.isNode&&p.isStream(S)?new m(M,S):a.prepareContent(M,S,G.binary,G.optimizedBinaryString,G.base64);var R=new d(M,C,G);this.files[M]=R}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),h=n("./compressedObject"),d=n("./zipObject"),f=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),E=function(M){M.slice(-1)==="/"&&(M=M.substring(0,M.length-1));var S=M.lastIndexOf("/");return 0<S?M.substring(0,S):""},w=function(M){return M.slice(-1)!=="/"&&(M+="/"),M},T=function(M,S){return S=S!==void 0?S:u.createFolders,M=w(M),this.files[M]||s.call(this,M,null,{dir:!0,createFolders:S}),this.files[M]};function A(M){return Object.prototype.toString.call(M)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(M){var S,L,B;for(S in this.files)B=this.files[S],(L=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&M(L,B)},filter:function(M){var S=[];return this.forEach(function(L,B){M(L,B)&&S.push(B)}),S},file:function(M,S,L){if(arguments.length!==1)return M=this.root+M,s.call(this,M,S,L),this;if(A(M)){var B=M;return this.filter(function(G,et){return!et.dir&&B.test(G)})}var O=this.files[this.root+M];return O&&!O.dir?O:null},folder:function(M){if(!M)return this;if(A(M))return this.filter(function(O,G){return G.dir&&M.test(O)});var S=this.root+M,L=T.call(this,S),B=this.clone();return B.root=L.name,B},remove:function(M){M=this.root+M;var S=this.files[M];if(S||(M.slice(-1)!=="/"&&(M+="/"),S=this.files[M]),S&&!S.dir)delete this.files[M];else for(var L=this.filter(function(O,G){return G.name.slice(0,M.length)===M}),B=0;B<L.length;B++)delete this.files[L[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(M){var S,L={};try{if((L=a.extend(M||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=L.type.toLowerCase(),L.compression=L.compression.toUpperCase(),L.type==="binarystring"&&(L.type="string"),!L.type)throw new Error("No output type specified.");a.checkSupport(L.type),L.platform!=="darwin"&&L.platform!=="freebsd"&&L.platform!=="linux"&&L.platform!=="sunos"||(L.platform="UNIX"),L.platform==="win32"&&(L.platform="DOS");var B=L.comment||this.comment||"";S=f.generateWorker(this,L,B)}catch(O){(S=new c("error")).error(O)}return new l(S,L.type||"string",L.mimeType)},generateAsync:function(M,S){return this.generateInternalStream(M).accumulate(S)},generateNodeStream:function(M,S){return(M=M||{}).type||(M.type="nodebuffer"),this.generateInternalStream(M).toNodejsStream(S)}};r.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),h=null;if(l.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(E,w){var T=[],A=p._internalType,I=p._outputType,M=p._mimeType;p.on("data",function(S,L){T.push(S),m&&m(L)}).on("error",function(S){T=[],w(S)}).on("end",function(){try{var S=function(L,B,O){switch(L){case"blob":return s.newBlob(s.transformTo("arraybuffer",B),O);case"base64":return c.encode(B);default:return s.transformTo(L,B)}}(I,function(L,B){var O,G=0,et=null,C=0;for(O=0;O<B.length;O++)C+=B[O].length;switch(L){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(et=new Uint8Array(C),O=0;O<B.length;O++)et.set(B[O],G),G+=B[O].length;return et;case"nodebuffer":return en.concat(B);default:throw new Error("concat : unsupported type '"+L+"'")}}(A,T),M);E(S)}catch(L){w(L)}T=[]}).resume()})}function f(p,m,E){var w=m;switch(m){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=m,this._mimeType=E,s.checkSupport(w),this._worker=p.pipe(new o(w)),p.lock()}catch(T){this._worker=new a("error"),this._worker.error(T)}}f.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var E=this;return p==="data"?this._worker.on(p,function(w){m.call(E,w.data,w.meta)}):this._worker.on(p,function(){s.delay(m,arguments,E)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof en<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(p){var m,E,w,T,A,I=p.length,M=0;for(T=0;T<I;T++)(64512&(E=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(w=p.charCodeAt(T+1)))==56320&&(E=65536+(E-55296<<10)+(w-56320),T++),M+=E<128?1:E<2048?2:E<65536?3:4;for(m=o.uint8array?new Uint8Array(M):new Array(M),T=A=0;A<M;T++)(64512&(E=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(w=p.charCodeAt(T+1)))==56320&&(E=65536+(E-55296<<10)+(w-56320),T++),E<128?m[A++]=E:(E<2048?m[A++]=192|E>>>6:(E<65536?m[A++]=224|E>>>12:(m[A++]=240|E>>>18,m[A++]=128|E>>>12&63),m[A++]=128|E>>>6&63),m[A++]=128|63&E);return m}(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(p){var m,E,w,T,A=p.length,I=new Array(2*A);for(m=E=0;m<A;)if((w=p[m++])<128)I[E++]=w;else if(4<(T=l[w]))I[E++]=65533,m+=T-1;else{for(w&=T===2?31:T===3?15:7;1<T&&m<A;)w=w<<6|63&p[m++],T--;1<T?I[E++]=65533:w<65536?I[E++]=w:(w-=65536,I[E++]=55296|w>>10&1023,I[E++]=56320|1023&w)}return I.length!==E&&(I.subarray?I=I.subarray(0,E):I.length=E),s.applyFromCharCode(I)}(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var p=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var E=function(T,A){var I;for((A=A||T.length)>T.length&&(A=T.length),I=A-1;0<=I&&(192&T[I])==128;)I--;return I<0||I===0?A:I+l[T[I]]>A?I:A}(p),w=p;E!==p.length&&(o.uint8array?(w=p.subarray(0,E),this.leftOver=p.subarray(E,p.length)):(w=p.slice(0,E),this.leftOver=p.slice(E,p.length))),this.push({data:i.utf8decode(w),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,E){for(var w=0;w<m.length;++w)E[w]=255&m.charCodeAt(w);return E}n("setimmediate"),i.newBlob=function(m,E){i.checkSupport("blob");try{return new Blob([m],{type:E})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(m),w.getBlob(E)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,E,w){var T=[],A=0,I=m.length;if(I<=w)return String.fromCharCode.apply(null,m);for(;A<I;)E==="array"||E==="nodebuffer"?T.push(String.fromCharCode.apply(null,m.slice(A,Math.min(A+w,I)))):T.push(String.fromCharCode.apply(null,m.subarray(A,Math.min(A+w,I)))),A+=w;return T.join("")},stringifyByChar:function(m){for(var E="",w=0;w<m.length;w++)E+=String.fromCharCode(m[w]);return E},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var E=65536,w=i.getTypeOf(m),T=!0;if(w==="uint8array"?T=h.applyCanBeUsed.uint8array:w==="nodebuffer"&&(T=h.applyCanBeUsed.nodebuffer),T)for(;1<E;)try{return h.stringifyByChunk(m,w,E)}catch{E=Math.floor(E/2)}return h.stringifyByChar(m)}function f(m,E){for(var w=0;w<m.length;w++)E[w]=m[w];return E}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return f(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return f(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,E){if(E=E||"",!m)return E;i.checkSupport(m);var w=i.getTypeOf(E);return p[w][m](E)},i.resolve=function(m){for(var E=m.split("/"),w=[],T=0;T<E.length;T++){var A=E[T];A==="."||A===""&&T!==0&&T!==E.length-1||(A===".."?w.pop():w.push(A))}return w.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var E,w,T="";for(w=0;w<(m||"").length;w++)T+="\\x"+((E=m.charCodeAt(w))<16?"0":"")+E.toString(16).toUpperCase();return T},i.delay=function(m,E,w){setImmediate(function(){m.apply(w||null,E||[])})},i.inherits=function(m,E){function w(){}w.prototype=E.prototype,m.prototype=new w},i.extend=function(){var m,E,w={};for(m=0;m<arguments.length;m++)for(E in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],E)&&w[E]===void 0&&(w[E]=arguments[m][E]);return w},i.prepareContent=function(m,E,w,T,A){return c.Promise.resolve(E).then(function(I){return s.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new c.Promise(function(M,S){var L=new FileReader;L.onload=function(B){M(B.target.result)},L.onerror=function(B){S(B.target.error)},L.readAsArrayBuffer(I)}):I}).then(function(I){var M=i.getTypeOf(I);return M?(M==="arraybuffer"?I=i.transformTo("uint8array",I):M==="string"&&(A?I=o.decode(I):w&&T!==!0&&(I=function(S){return u(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(I))),I):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===d;return this.reader.setIndex(f),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var p=d-f;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),h=n("./support");function d(f,p){this.options=f,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var p,m;if(f.skip(22),this.fileNameLength=f.readInt(2),m=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(E){for(var w in u)if(Object.prototype.hasOwnProperty.call(u,w)&&u[w].magic===E)return u[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var p=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(p),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var p,m,E,w=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<w;)p=f.readInt(2),m=f.readInt(2),E=f.readData(m),this.extraFields[p]={id:p,length:m,value:E};f.setIndex(w)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var E=this.findExtraFieldUnicodeComment();if(E!==null)this.fileCommentStr=E;else{var w=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,E){this.name=p,this.dir=E.dir,this.date=E.date,this.comment=E.comment,this.unixPermissions=E.unixPermissions,this.dosPermissions=E.dosPermissions,this._data=m,this._dataBinary=E.binary,this.options={compression:E.compression,compressionOptions:E.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,E="string";try{if(!p)throw new Error("No output type specified.");var w=(E=p.toLowerCase())==="string"||E==="text";E!=="binarystring"&&E!=="text"||(E="string"),m=this._decompressWorker();var T=!this._dataBinary;T&&!w&&(m=m.pipe(new c.Utf8EncodeWorker)),!T&&w&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(A){(m=new u("error")).error(A)}return new o(m,E,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var E=this._decompressWorker();return this._dataBinary||(E=E.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(E,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var f=[];function p(){var m,E;a=!0;for(var w=f.length;w;){for(E=f,f=[],m=-1;++m<w;)E[m]();w=f.length}a=!1}r.exports=function(m){f.push(m)!==1||a||o()}}).call(this,typeof Tn<"u"?Tn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,w!==o&&m(this,w)}function d(w,T,A){this.promise=w,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function f(w,T,A){s(function(){var I;try{I=T(A)}catch(M){return a.reject(w,M)}I===w?a.reject(w,new TypeError("Cannot resolve promise with itself")):a.resolve(w,I)})}function p(w){var T=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof T=="function")return function(){T.apply(w,arguments)}}function m(w,T){var A=!1;function I(L){A||(A=!0,a.reject(w,L))}function M(L){A||(A=!0,a.resolve(w,L))}var S=E(function(){T(M,I)});S.status==="error"&&I(S.value)}function E(w,T){var A={};try{A.value=w(T),A.status="success"}catch(I){A.status="error",A.value=I}return A}(r.exports=h).prototype.finally=function(w){if(typeof w!="function")return this;var T=this.constructor;return this.then(function(A){return T.resolve(w()).then(function(){return A})},function(A){return T.resolve(w()).then(function(){throw A})})},h.prototype.catch=function(w){return this.then(null,w)},h.prototype.then=function(w,T){if(typeof w!="function"&&this.state===l||typeof T!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==u?f(A,this.state===l?w:T,this.outcome):this.queue.push(new d(A,w,T)),A},d.prototype.callFulfilled=function(w){a.resolve(this.promise,w)},d.prototype.otherCallFulfilled=function(w){f(this.promise,this.onFulfilled,w)},d.prototype.callRejected=function(w){a.reject(this.promise,w)},d.prototype.otherCallRejected=function(w){f(this.promise,this.onRejected,w)},a.resolve=function(w,T){var A=E(p,T);if(A.status==="error")return a.reject(w,A.value);var I=A.value;if(I)m(w,I);else{w.state=l,w.outcome=T;for(var M=-1,S=w.queue.length;++M<S;)w.queue[M].callFulfilled(T)}return w},a.reject=function(w,T){w.state=c,w.outcome=T;for(var A=-1,I=w.queue.length;++A<I;)w.queue[A].callRejected(T);return w},h.resolve=function(w){return w instanceof this?w:a.resolve(new this(o),w)},h.reject=function(w){var T=new this(o);return a.reject(T,w)},h.all=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=w.length,I=!1;if(!A)return this.resolve([]);for(var M=new Array(A),S=0,L=-1,B=new this(o);++L<A;)O(w[L],L);return B;function O(G,et){T.resolve(G).then(function(C){M[et]=C,++S!==A||I||(I=!0,a.resolve(B,M))},function(C){I||(I=!0,a.reject(B,C))})}},h.race=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=w.length,I=!1;if(!A)return this.resolve([]);for(var M=-1,S=new this(o);++M<A;)L=w[M],T.resolve(L).then(function(B){I||(I=!0,a.resolve(S,B))},function(B){I||(I=!0,a.reject(S,B))});var L;return S}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,h=0,d=-1,f=0,p=8;function m(w){if(!(this instanceof m))return new m(w);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},w||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(A!==h)throw new Error(c[A]);if(T.header&&s.deflateSetHeader(this.strm,T.header),T.dictionary){var I;if(I=typeof T.dictionary=="string"?a.string2buf(T.dictionary):u.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(A=s.deflateSetDictionary(this.strm,I))!==h)throw new Error(c[A]);this._dict_set=!0}}function E(w,T){var A=new m(T);if(A.push(w,!0),A.err)throw A.msg||c[A.err];return A.result}m.prototype.push=function(w,T){var A,I,M=this.strm,S=this.options.chunkSize;if(this.ended)return!1;I=T===~~T?T:T===!0?4:0,typeof w=="string"?M.input=a.string2buf(w):u.call(w)==="[object ArrayBuffer]"?M.input=new Uint8Array(w):M.input=w,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new o.Buf8(S),M.next_out=0,M.avail_out=S),(A=s.deflate(M,I))!==1&&A!==h)return this.onEnd(A),!(this.ended=!0);M.avail_out!==0&&(M.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(M.output,M.next_out))):this.onData(o.shrinkBuf(M.output,M.next_out)))}while((0<M.avail_in||M.avail_out===0)&&A!==1);return I===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===h):I!==2||(this.onEnd(h),!(M.avail_out=0))},m.prototype.onData=function(w){this.chunks.push(w)},m.prototype.onEnd=function(w){w===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},i.Deflate=m,i.deflate=E,i.deflateRaw=function(w,T){return(T=T||{}).raw=!0,E(w,T)},i.gzip=function(w,T){return(T=T||{}).gzip=!0,E(w,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),h=n("./zlib/gzheader"),d=Object.prototype.toString;function f(m){if(!(this instanceof f))return new f(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var E=this.options;E.raw&&0<=E.windowBits&&E.windowBits<16&&(E.windowBits=-E.windowBits,E.windowBits===0&&(E.windowBits=-15)),!(0<=E.windowBits&&E.windowBits<16)||m&&m.windowBits||(E.windowBits+=32),15<E.windowBits&&E.windowBits<48&&!(15&E.windowBits)&&(E.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,E.windowBits);if(w!==c.Z_OK)throw new Error(l[w]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,E){var w=new f(E);if(w.push(m,!0),w.err)throw w.msg||l[w.err];return w.result}f.prototype.push=function(m,E){var w,T,A,I,M,S,L=this.strm,B=this.options.chunkSize,O=this.options.dictionary,G=!1;if(this.ended)return!1;T=E===~~E?E:E===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?L.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?L.input=new Uint8Array(m):L.input=m,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new o.Buf8(B),L.next_out=0,L.avail_out=B),(w=s.inflate(L,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&O&&(S=typeof O=="string"?a.string2buf(O):d.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,w=s.inflateSetDictionary(this.strm,S)),w===c.Z_BUF_ERROR&&G===!0&&(w=c.Z_OK,G=!1),w!==c.Z_STREAM_END&&w!==c.Z_OK)return this.onEnd(w),!(this.ended=!0);L.next_out&&(L.avail_out!==0&&w!==c.Z_STREAM_END&&(L.avail_in!==0||T!==c.Z_FINISH&&T!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(L.output,L.next_out),I=L.next_out-A,M=a.buf2string(L.output,A),L.next_out=I,L.avail_out=B-I,I&&o.arraySet(L.output,L.output,A,I,0),this.onData(M)):this.onData(o.shrinkBuf(L.output,L.next_out)))),L.avail_in===0&&L.avail_out===0&&(G=!0)}while((0<L.avail_in||L.avail_out===0)&&w!==c.Z_STREAM_END);return w===c.Z_STREAM_END&&(T=c.Z_FINISH),T===c.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===c.Z_OK):T!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(L.avail_out=0))},f.prototype.onData=function(m){this.chunks.push(m)},f.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=f,i.inflate=p,i.inflateRaw=function(m,E){return(E=E||{}).raw=!0,p(m,E)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),d);else for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){var l,u,h,d,f,p;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(p=new Uint8Array(h),l=d=0,u=c.length;l<u;l++)f=c[l],p.set(f,d),d+=f.length;return p}},a={arraySet:function(c,l,u,h,d){for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",p=0;p<d;p++)f+=String.fromCharCode(h[p]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,p,m,E,w=h.length,T=0;for(m=0;m<w;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),T+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(T),m=E=0;E<T;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),f<128?d[E++]=f:(f<2048?d[E++]=192|f>>>6:(f<65536?d[E++]=224|f>>>12:(d[E++]=240|f>>>18,d[E++]=128|f>>>12&63),d[E++]=128|f>>>6&63),d[E++]=128|63&f);return d},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,p=d.length;f<p;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,p,m,E,w=d||h.length,T=new Array(2*w);for(f=p=0;f<w;)if((m=h[f++])<128)T[p++]=m;else if(4<(E=c[m]))T[p++]=65533,f+=E-1;else{for(m&=E===2?31:E===3?15:7;1<E&&f<w;)m=m<<6|63&h[f++],E--;1<E?T[p++]=65533:m<65536?T[p++]=m:(m-=65536,T[p++]=55296|m>>10&1023,T[p++]=56320|1023&m)}return u(T,p)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var d=l;d<h;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),h=0,d=4,f=0,p=-2,m=-1,E=4,w=2,T=8,A=9,I=286,M=30,S=19,L=2*I+1,B=15,O=3,G=258,et=G+O+1,C=42,R=113,b=1,P=2,J=3,D=4;function st(x,ot){return x.msg=u[ot],ot}function tt(x){return(x<<1)-(4<x?9:0)}function ft(x){for(var ot=x.length;0<=--ot;)x[ot]=0}function V(x){var ot=x.state,nt=ot.pending;nt>x.avail_out&&(nt=x.avail_out),nt!==0&&(o.arraySet(x.output,ot.pending_buf,ot.pending_out,nt,x.next_out),x.next_out+=nt,ot.pending_out+=nt,x.total_out+=nt,x.avail_out-=nt,ot.pending-=nt,ot.pending===0&&(ot.pending_out=0))}function z(x,ot){a._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,ot),x.block_start=x.strstart,V(x.strm)}function Et(x,ot){x.pending_buf[x.pending++]=ot}function at(x,ot){x.pending_buf[x.pending++]=ot>>>8&255,x.pending_buf[x.pending++]=255&ot}function lt(x,ot){var nt,F,U=x.max_chain_length,H=x.strstart,ct=x.prev_length,ht=x.nice_match,Z=x.strstart>x.w_size-et?x.strstart-(x.w_size-et):0,pt=x.window,bt=x.w_mask,dt=x.prev,vt=x.strstart+G,le=pt[H+ct-1],Pt=pt[H+ct];x.prev_length>=x.good_match&&(U>>=2),ht>x.lookahead&&(ht=x.lookahead);do if(pt[(nt=ot)+ct]===Pt&&pt[nt+ct-1]===le&&pt[nt]===pt[H]&&pt[++nt]===pt[H+1]){H+=2,nt++;do;while(pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&pt[++H]===pt[++nt]&&H<vt);if(F=G-(vt-H),H=vt-G,ct<F){if(x.match_start=ot,ht<=(ct=F))break;le=pt[H+ct-1],Pt=pt[H+ct]}}while((ot=dt[ot&bt])>Z&&--U!=0);return ct<=x.lookahead?ct:x.lookahead}function Mt(x){var ot,nt,F,U,H,ct,ht,Z,pt,bt,dt=x.w_size;do{if(U=x.window_size-x.lookahead-x.strstart,x.strstart>=dt+(dt-et)){for(o.arraySet(x.window,x.window,dt,dt,0),x.match_start-=dt,x.strstart-=dt,x.block_start-=dt,ot=nt=x.hash_size;F=x.head[--ot],x.head[ot]=dt<=F?F-dt:0,--nt;);for(ot=nt=dt;F=x.prev[--ot],x.prev[ot]=dt<=F?F-dt:0,--nt;);U+=dt}if(x.strm.avail_in===0)break;if(ct=x.strm,ht=x.window,Z=x.strstart+x.lookahead,pt=U,bt=void 0,bt=ct.avail_in,pt<bt&&(bt=pt),nt=bt===0?0:(ct.avail_in-=bt,o.arraySet(ht,ct.input,ct.next_in,bt,Z),ct.state.wrap===1?ct.adler=c(ct.adler,ht,bt,Z):ct.state.wrap===2&&(ct.adler=l(ct.adler,ht,bt,Z)),ct.next_in+=bt,ct.total_in+=bt,bt),x.lookahead+=nt,x.lookahead+x.insert>=O)for(H=x.strstart-x.insert,x.ins_h=x.window[H],x.ins_h=(x.ins_h<<x.hash_shift^x.window[H+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[H+O-1])&x.hash_mask,x.prev[H&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=H,H++,x.insert--,!(x.lookahead+x.insert<O)););}while(x.lookahead<et&&x.strm.avail_in!==0)}function Xt(x,ot){for(var nt,F;;){if(x.lookahead<et){if(Mt(x),x.lookahead<et&&ot===h)return b;if(x.lookahead===0)break}if(nt=0,x.lookahead>=O&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+O-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),nt!==0&&x.strstart-nt<=x.w_size-et&&(x.match_length=lt(x,nt)),x.match_length>=O)if(F=a._tr_tally(x,x.strstart-x.match_start,x.match_length-O),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=O){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+O-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else F=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(F&&(z(x,!1),x.strm.avail_out===0))return b}return x.insert=x.strstart<O-1?x.strstart:O-1,ot===d?(z(x,!0),x.strm.avail_out===0?J:D):x.last_lit&&(z(x,!1),x.strm.avail_out===0)?b:P}function Ut(x,ot){for(var nt,F,U;;){if(x.lookahead<et){if(Mt(x),x.lookahead<et&&ot===h)return b;if(x.lookahead===0)break}if(nt=0,x.lookahead>=O&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+O-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=O-1,nt!==0&&x.prev_length<x.max_lazy_match&&x.strstart-nt<=x.w_size-et&&(x.match_length=lt(x,nt),x.match_length<=5&&(x.strategy===1||x.match_length===O&&4096<x.strstart-x.match_start)&&(x.match_length=O-1)),x.prev_length>=O&&x.match_length<=x.prev_length){for(U=x.strstart+x.lookahead-O,F=a._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-O),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=U&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+O-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=O-1,x.strstart++,F&&(z(x,!1),x.strm.avail_out===0))return b}else if(x.match_available){if((F=a._tr_tally(x,0,x.window[x.strstart-1]))&&z(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return b}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(F=a._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<O-1?x.strstart:O-1,ot===d?(z(x,!0),x.strm.avail_out===0?J:D):x.last_lit&&(z(x,!1),x.strm.avail_out===0)?b:P}function Tt(x,ot,nt,F,U){this.good_length=x,this.max_lazy=ot,this.nice_length=nt,this.max_chain=F,this.func=U}function Dt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*L),this.dyn_dtree=new o.Buf16(2*(2*M+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(B+1),this.heap=new o.Buf16(2*I+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*I+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ft(x){var ot;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=w,(ot=x.state).pending=0,ot.pending_out=0,ot.wrap<0&&(ot.wrap=-ot.wrap),ot.status=ot.wrap?C:R,x.adler=ot.wrap===2?0:1,ot.last_flush=h,a._tr_init(ot),f):st(x,p)}function ke(x){var ot=Ft(x);return ot===f&&function(nt){nt.window_size=2*nt.w_size,ft(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=O-1,nt.match_available=0,nt.ins_h=0}(x.state),ot}function Oe(x,ot,nt,F,U,H){if(!x)return p;var ct=1;if(ot===m&&(ot=6),F<0?(ct=0,F=-F):15<F&&(ct=2,F-=16),U<1||A<U||nt!==T||F<8||15<F||ot<0||9<ot||H<0||E<H)return st(x,p);F===8&&(F=9);var ht=new Dt;return(x.state=ht).strm=x,ht.wrap=ct,ht.gzhead=null,ht.w_bits=F,ht.w_size=1<<ht.w_bits,ht.w_mask=ht.w_size-1,ht.hash_bits=U+7,ht.hash_size=1<<ht.hash_bits,ht.hash_mask=ht.hash_size-1,ht.hash_shift=~~((ht.hash_bits+O-1)/O),ht.window=new o.Buf8(2*ht.w_size),ht.head=new o.Buf16(ht.hash_size),ht.prev=new o.Buf16(ht.w_size),ht.lit_bufsize=1<<U+6,ht.pending_buf_size=4*ht.lit_bufsize,ht.pending_buf=new o.Buf8(ht.pending_buf_size),ht.d_buf=1*ht.lit_bufsize,ht.l_buf=3*ht.lit_bufsize,ht.level=ot,ht.strategy=H,ht.method=nt,ke(x)}s=[new Tt(0,0,0,0,function(x,ot){var nt=65535;for(nt>x.pending_buf_size-5&&(nt=x.pending_buf_size-5);;){if(x.lookahead<=1){if(Mt(x),x.lookahead===0&&ot===h)return b;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var F=x.block_start+nt;if((x.strstart===0||x.strstart>=F)&&(x.lookahead=x.strstart-F,x.strstart=F,z(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-et&&(z(x,!1),x.strm.avail_out===0))return b}return x.insert=0,ot===d?(z(x,!0),x.strm.avail_out===0?J:D):(x.strstart>x.block_start&&(z(x,!1),x.strm.avail_out),b)}),new Tt(4,4,8,4,Xt),new Tt(4,5,16,8,Xt),new Tt(4,6,32,32,Xt),new Tt(4,4,16,16,Ut),new Tt(8,16,32,32,Ut),new Tt(8,16,128,128,Ut),new Tt(8,32,128,256,Ut),new Tt(32,128,258,1024,Ut),new Tt(32,258,258,4096,Ut)],i.deflateInit=function(x,ot){return Oe(x,ot,T,15,8,0)},i.deflateInit2=Oe,i.deflateReset=ke,i.deflateResetKeep=Ft,i.deflateSetHeader=function(x,ot){return x&&x.state?x.state.wrap!==2?p:(x.state.gzhead=ot,f):p},i.deflate=function(x,ot){var nt,F,U,H;if(!x||!x.state||5<ot||ot<0)return x?st(x,p):p;if(F=x.state,!x.output||!x.input&&x.avail_in!==0||F.status===666&&ot!==d)return st(x,x.avail_out===0?-5:p);if(F.strm=x,nt=F.last_flush,F.last_flush=ot,F.status===C)if(F.wrap===2)x.adler=0,Et(F,31),Et(F,139),Et(F,8),F.gzhead?(Et(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),Et(F,255&F.gzhead.time),Et(F,F.gzhead.time>>8&255),Et(F,F.gzhead.time>>16&255),Et(F,F.gzhead.time>>24&255),Et(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),Et(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(Et(F,255&F.gzhead.extra.length),Et(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(x.adler=l(x.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(Et(F,0),Et(F,0),Et(F,0),Et(F,0),Et(F,0),Et(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),Et(F,3),F.status=R);else{var ct=T+(F.w_bits-8<<4)<<8;ct|=(2<=F.strategy||F.level<2?0:F.level<6?1:F.level===6?2:3)<<6,F.strstart!==0&&(ct|=32),ct+=31-ct%31,F.status=R,at(F,ct),F.strstart!==0&&(at(F,x.adler>>>16),at(F,65535&x.adler)),x.adler=1}if(F.status===69)if(F.gzhead.extra){for(U=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>U&&(x.adler=l(x.adler,F.pending_buf,F.pending-U,U)),V(x),U=F.pending,F.pending!==F.pending_buf_size));)Et(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>U&&(x.adler=l(x.adler,F.pending_buf,F.pending-U,U)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){U=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>U&&(x.adler=l(x.adler,F.pending_buf,F.pending-U,U)),V(x),U=F.pending,F.pending===F.pending_buf_size)){H=1;break}H=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,Et(F,H)}while(H!==0);F.gzhead.hcrc&&F.pending>U&&(x.adler=l(x.adler,F.pending_buf,F.pending-U,U)),H===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){U=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>U&&(x.adler=l(x.adler,F.pending_buf,F.pending-U,U)),V(x),U=F.pending,F.pending===F.pending_buf_size)){H=1;break}H=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,Et(F,H)}while(H!==0);F.gzhead.hcrc&&F.pending>U&&(x.adler=l(x.adler,F.pending_buf,F.pending-U,U)),H===0&&(F.status=103)}else F.status=103;if(F.status===103&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&V(x),F.pending+2<=F.pending_buf_size&&(Et(F,255&x.adler),Et(F,x.adler>>8&255),x.adler=0,F.status=R)):F.status=R),F.pending!==0){if(V(x),x.avail_out===0)return F.last_flush=-1,f}else if(x.avail_in===0&&tt(ot)<=tt(nt)&&ot!==d)return st(x,-5);if(F.status===666&&x.avail_in!==0)return st(x,-5);if(x.avail_in!==0||F.lookahead!==0||ot!==h&&F.status!==666){var ht=F.strategy===2?function(Z,pt){for(var bt;;){if(Z.lookahead===0&&(Mt(Z),Z.lookahead===0)){if(pt===h)return b;break}if(Z.match_length=0,bt=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,bt&&(z(Z,!1),Z.strm.avail_out===0))return b}return Z.insert=0,pt===d?(z(Z,!0),Z.strm.avail_out===0?J:D):Z.last_lit&&(z(Z,!1),Z.strm.avail_out===0)?b:P}(F,ot):F.strategy===3?function(Z,pt){for(var bt,dt,vt,le,Pt=Z.window;;){if(Z.lookahead<=G){if(Mt(Z),Z.lookahead<=G&&pt===h)return b;if(Z.lookahead===0)break}if(Z.match_length=0,Z.lookahead>=O&&0<Z.strstart&&(dt=Pt[vt=Z.strstart-1])===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]){le=Z.strstart+G;do;while(dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&vt<le);Z.match_length=G-(le-vt),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=O?(bt=a._tr_tally(Z,1,Z.match_length-O),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(bt=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),bt&&(z(Z,!1),Z.strm.avail_out===0))return b}return Z.insert=0,pt===d?(z(Z,!0),Z.strm.avail_out===0?J:D):Z.last_lit&&(z(Z,!1),Z.strm.avail_out===0)?b:P}(F,ot):s[F.level].func(F,ot);if(ht!==J&&ht!==D||(F.status=666),ht===b||ht===J)return x.avail_out===0&&(F.last_flush=-1),f;if(ht===P&&(ot===1?a._tr_align(F):ot!==5&&(a._tr_stored_block(F,0,0,!1),ot===3&&(ft(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),V(x),x.avail_out===0))return F.last_flush=-1,f}return ot!==d?f:F.wrap<=0?1:(F.wrap===2?(Et(F,255&x.adler),Et(F,x.adler>>8&255),Et(F,x.adler>>16&255),Et(F,x.adler>>24&255),Et(F,255&x.total_in),Et(F,x.total_in>>8&255),Et(F,x.total_in>>16&255),Et(F,x.total_in>>24&255)):(at(F,x.adler>>>16),at(F,65535&x.adler)),V(x),0<F.wrap&&(F.wrap=-F.wrap),F.pending!==0?f:1)},i.deflateEnd=function(x){var ot;return x&&x.state?(ot=x.state.status)!==C&&ot!==69&&ot!==73&&ot!==91&&ot!==103&&ot!==R&&ot!==666?st(x,p):(x.state=null,ot===R?st(x,-3):f):p},i.deflateSetDictionary=function(x,ot){var nt,F,U,H,ct,ht,Z,pt,bt=ot.length;if(!x||!x.state||(H=(nt=x.state).wrap)===2||H===1&&nt.status!==C||nt.lookahead)return p;for(H===1&&(x.adler=c(x.adler,ot,bt,0)),nt.wrap=0,bt>=nt.w_size&&(H===0&&(ft(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),pt=new o.Buf8(nt.w_size),o.arraySet(pt,ot,bt-nt.w_size,nt.w_size,0),ot=pt,bt=nt.w_size),ct=x.avail_in,ht=x.next_in,Z=x.input,x.avail_in=bt,x.next_in=0,x.input=ot,Mt(nt);nt.lookahead>=O;){for(F=nt.strstart,U=nt.lookahead-(O-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[F+O-1])&nt.hash_mask,nt.prev[F&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=F,F++,--U;);nt.strstart=F,nt.lookahead=O-1,Mt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=O-1,nt.match_available=0,x.next_in=ht,x.input=Z,x.avail_in=ct,nt.wrap=H,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,h,d,f,p,m,E,w,T,A,I,M,S,L,B,O,G,et,C,R,b,P;a=s.state,c=s.next_in,b=s.input,l=c+(s.avail_in-5),u=s.next_out,P=s.output,h=u-(o-s.avail_out),d=u+(s.avail_out-257),f=a.dmax,p=a.wsize,m=a.whave,E=a.wnext,w=a.window,T=a.hold,A=a.bits,I=a.lencode,M=a.distcode,S=(1<<a.lenbits)-1,L=(1<<a.distbits)-1;t:do{A<15&&(T+=b[c++]<<A,A+=8,T+=b[c++]<<A,A+=8),B=I[T&S];e:for(;;){if(T>>>=O=B>>>24,A-=O,(O=B>>>16&255)===0)P[u++]=65535&B;else{if(!(16&O)){if(!(64&O)){B=I[(65535&B)+(T&(1<<O)-1)];continue e}if(32&O){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}G=65535&B,(O&=15)&&(A<O&&(T+=b[c++]<<A,A+=8),G+=T&(1<<O)-1,T>>>=O,A-=O),A<15&&(T+=b[c++]<<A,A+=8,T+=b[c++]<<A,A+=8),B=M[T&L];n:for(;;){if(T>>>=O=B>>>24,A-=O,!(16&(O=B>>>16&255))){if(!(64&O)){B=M[(65535&B)+(T&(1<<O)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(et=65535&B,A<(O&=15)&&(T+=b[c++]<<A,(A+=8)<O&&(T+=b[c++]<<A,A+=8)),f<(et+=T&(1<<O)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(T>>>=O,A-=O,(O=u-h)<et){if(m<(O=et-O)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(R=w,(C=0)===E){if(C+=p-O,O<G){for(G-=O;P[u++]=w[C++],--O;);C=u-et,R=P}}else if(E<O){if(C+=p+E-O,(O-=E)<G){for(G-=O;P[u++]=w[C++],--O;);if(C=0,E<G){for(G-=O=E;P[u++]=w[C++],--O;);C=u-et,R=P}}}else if(C+=E-O,O<G){for(G-=O;P[u++]=w[C++],--O;);C=u-et,R=P}for(;2<G;)P[u++]=R[C++],P[u++]=R[C++],P[u++]=R[C++],G-=3;G&&(P[u++]=R[C++],1<G&&(P[u++]=R[C++]))}else{for(C=u-et;P[u++]=P[C++],P[u++]=P[C++],P[u++]=P[C++],2<(G-=3););G&&(P[u++]=P[C++],1<G&&(P[u++]=P[C++]))}break}}break}}while(c<l&&u<d);c-=G=A>>3,T&=(1<<(A-=G<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=T,a.bits=A}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,h=2,d=0,f=-2,p=1,m=852,E=592;function w(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(C){var R;return C&&C.state?(R=C.state,C.total_in=C.total_out=R.total=0,C.msg="",R.wrap&&(C.adler=1&R.wrap),R.mode=p,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new s.Buf32(m),R.distcode=R.distdyn=new s.Buf32(E),R.sane=1,R.back=-1,d):f}function I(C){var R;return C&&C.state?((R=C.state).wsize=0,R.whave=0,R.wnext=0,A(C)):f}function M(C,R){var b,P;return C&&C.state?(P=C.state,R<0?(b=0,R=-R):(b=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?f:(P.window!==null&&P.wbits!==R&&(P.window=null),P.wrap=b,P.wbits=R,I(C))):f}function S(C,R){var b,P;return C?(P=new T,(C.state=P).window=null,(b=M(C,R))!==d&&(C.state=null),b):f}var L,B,O=!0;function G(C){if(O){var R;for(L=new s.Buf32(512),B=new s.Buf32(32),R=0;R<144;)C.lens[R++]=8;for(;R<256;)C.lens[R++]=9;for(;R<280;)C.lens[R++]=7;for(;R<288;)C.lens[R++]=8;for(l(u,C.lens,0,288,L,0,C.work,{bits:9}),R=0;R<32;)C.lens[R++]=5;l(h,C.lens,0,32,B,0,C.work,{bits:5}),O=!1}C.lencode=L,C.lenbits=9,C.distcode=B,C.distbits=5}function et(C,R,b,P){var J,D=C.state;return D.window===null&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new s.Buf8(D.wsize)),P>=D.wsize?(s.arraySet(D.window,R,b-D.wsize,D.wsize,0),D.wnext=0,D.whave=D.wsize):(P<(J=D.wsize-D.wnext)&&(J=P),s.arraySet(D.window,R,b-P,J,D.wnext),(P-=J)?(s.arraySet(D.window,R,b-P,P,0),D.wnext=P,D.whave=D.wsize):(D.wnext+=J,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=J))),0}i.inflateReset=I,i.inflateReset2=M,i.inflateResetKeep=A,i.inflateInit=function(C){return S(C,15)},i.inflateInit2=S,i.inflate=function(C,R){var b,P,J,D,st,tt,ft,V,z,Et,at,lt,Mt,Xt,Ut,Tt,Dt,Ft,ke,Oe,x,ot,nt,F,U=0,H=new s.Buf8(4),ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return f;(b=C.state).mode===12&&(b.mode=13),st=C.next_out,J=C.output,ft=C.avail_out,D=C.next_in,P=C.input,tt=C.avail_in,V=b.hold,z=b.bits,Et=tt,at=ft,ot=d;t:for(;;)switch(b.mode){case p:if(b.wrap===0){b.mode=13;break}for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(2&b.wrap&&V===35615){H[b.check=0]=255&V,H[1]=V>>>8&255,b.check=a(b.check,H,2,0),z=V=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&V)<<8)+(V>>8))%31){C.msg="incorrect header check",b.mode=30;break}if((15&V)!=8){C.msg="unknown compression method",b.mode=30;break}if(z-=4,x=8+(15&(V>>>=4)),b.wbits===0)b.wbits=x;else if(x>b.wbits){C.msg="invalid window size",b.mode=30;break}b.dmax=1<<x,C.adler=b.check=1,b.mode=512&V?10:12,z=V=0;break;case 2:for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(b.flags=V,(255&b.flags)!=8){C.msg="unknown compression method",b.mode=30;break}if(57344&b.flags){C.msg="unknown header flags set",b.mode=30;break}b.head&&(b.head.text=V>>8&1),512&b.flags&&(H[0]=255&V,H[1]=V>>>8&255,b.check=a(b.check,H,2,0)),z=V=0,b.mode=3;case 3:for(;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.head&&(b.head.time=V),512&b.flags&&(H[0]=255&V,H[1]=V>>>8&255,H[2]=V>>>16&255,H[3]=V>>>24&255,b.check=a(b.check,H,4,0)),z=V=0,b.mode=4;case 4:for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.head&&(b.head.xflags=255&V,b.head.os=V>>8),512&b.flags&&(H[0]=255&V,H[1]=V>>>8&255,b.check=a(b.check,H,2,0)),z=V=0,b.mode=5;case 5:if(1024&b.flags){for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.length=V,b.head&&(b.head.extra_len=V),512&b.flags&&(H[0]=255&V,H[1]=V>>>8&255,b.check=a(b.check,H,2,0)),z=V=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(tt<(lt=b.length)&&(lt=tt),lt&&(b.head&&(x=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Array(b.head.extra_len)),s.arraySet(b.head.extra,P,D,lt,x)),512&b.flags&&(b.check=a(b.check,P,lt,D)),tt-=lt,D+=lt,b.length-=lt),b.length))break t;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(tt===0)break t;for(lt=0;x=P[D+lt++],b.head&&x&&b.length<65536&&(b.head.name+=String.fromCharCode(x)),x&&lt<tt;);if(512&b.flags&&(b.check=a(b.check,P,lt,D)),tt-=lt,D+=lt,x)break t}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(tt===0)break t;for(lt=0;x=P[D+lt++],b.head&&x&&b.length<65536&&(b.head.comment+=String.fromCharCode(x)),x&&lt<tt;);if(512&b.flags&&(b.check=a(b.check,P,lt,D)),tt-=lt,D+=lt,x)break t}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(V!==(65535&b.check)){C.msg="header crc mismatch",b.mode=30;break}z=V=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),C.adler=b.check=0,b.mode=12;break;case 10:for(;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}C.adler=b.check=w(V),z=V=0,b.mode=11;case 11:if(b.havedict===0)return C.next_out=st,C.avail_out=ft,C.next_in=D,C.avail_in=tt,b.hold=V,b.bits=z,2;C.adler=b.check=1,b.mode=12;case 12:if(R===5||R===6)break t;case 13:if(b.last){V>>>=7&z,z-=7&z,b.mode=27;break}for(;z<3;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}switch(b.last=1&V,z-=1,3&(V>>>=1)){case 0:b.mode=14;break;case 1:if(G(b),b.mode=20,R!==6)break;V>>>=2,z-=2;break t;case 2:b.mode=17;break;case 3:C.msg="invalid block type",b.mode=30}V>>>=2,z-=2;break;case 14:for(V>>>=7&z,z-=7&z;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if((65535&V)!=(V>>>16^65535)){C.msg="invalid stored block lengths",b.mode=30;break}if(b.length=65535&V,z=V=0,b.mode=15,R===6)break t;case 15:b.mode=16;case 16:if(lt=b.length){if(tt<lt&&(lt=tt),ft<lt&&(lt=ft),lt===0)break t;s.arraySet(J,P,D,lt,st),tt-=lt,D+=lt,ft-=lt,st+=lt,b.length-=lt;break}b.mode=12;break;case 17:for(;z<14;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(b.nlen=257+(31&V),V>>>=5,z-=5,b.ndist=1+(31&V),V>>>=5,z-=5,b.ncode=4+(15&V),V>>>=4,z-=4,286<b.nlen||30<b.ndist){C.msg="too many length or distance symbols",b.mode=30;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;z<3;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.lens[ct[b.have++]]=7&V,V>>>=3,z-=3}for(;b.have<19;)b.lens[ct[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,nt={bits:b.lenbits},ot=l(0,b.lens,0,19,b.lencode,0,b.work,nt),b.lenbits=nt.bits,ot){C.msg="invalid code lengths set",b.mode=30;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;Tt=(U=b.lencode[V&(1<<b.lenbits)-1])>>>16&255,Dt=65535&U,!((Ut=U>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(Dt<16)V>>>=Ut,z-=Ut,b.lens[b.have++]=Dt;else{if(Dt===16){for(F=Ut+2;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(V>>>=Ut,z-=Ut,b.have===0){C.msg="invalid bit length repeat",b.mode=30;break}x=b.lens[b.have-1],lt=3+(3&V),V>>>=2,z-=2}else if(Dt===17){for(F=Ut+3;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}z-=Ut,x=0,lt=3+(7&(V>>>=Ut)),V>>>=3,z-=3}else{for(F=Ut+7;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}z-=Ut,x=0,lt=11+(127&(V>>>=Ut)),V>>>=7,z-=7}if(b.have+lt>b.nlen+b.ndist){C.msg="invalid bit length repeat",b.mode=30;break}for(;lt--;)b.lens[b.have++]=x}}if(b.mode===30)break;if(b.lens[256]===0){C.msg="invalid code -- missing end-of-block",b.mode=30;break}if(b.lenbits=9,nt={bits:b.lenbits},ot=l(u,b.lens,0,b.nlen,b.lencode,0,b.work,nt),b.lenbits=nt.bits,ot){C.msg="invalid literal/lengths set",b.mode=30;break}if(b.distbits=6,b.distcode=b.distdyn,nt={bits:b.distbits},ot=l(h,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,nt),b.distbits=nt.bits,ot){C.msg="invalid distances set",b.mode=30;break}if(b.mode=20,R===6)break t;case 20:b.mode=21;case 21:if(6<=tt&&258<=ft){C.next_out=st,C.avail_out=ft,C.next_in=D,C.avail_in=tt,b.hold=V,b.bits=z,c(C,at),st=C.next_out,J=C.output,ft=C.avail_out,D=C.next_in,P=C.input,tt=C.avail_in,V=b.hold,z=b.bits,b.mode===12&&(b.back=-1);break}for(b.back=0;Tt=(U=b.lencode[V&(1<<b.lenbits)-1])>>>16&255,Dt=65535&U,!((Ut=U>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(Tt&&!(240&Tt)){for(Ft=Ut,ke=Tt,Oe=Dt;Tt=(U=b.lencode[Oe+((V&(1<<Ft+ke)-1)>>Ft)])>>>16&255,Dt=65535&U,!(Ft+(Ut=U>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}V>>>=Ft,z-=Ft,b.back+=Ft}if(V>>>=Ut,z-=Ut,b.back+=Ut,b.length=Dt,Tt===0){b.mode=26;break}if(32&Tt){b.back=-1,b.mode=12;break}if(64&Tt){C.msg="invalid literal/length code",b.mode=30;break}b.extra=15&Tt,b.mode=22;case 22:if(b.extra){for(F=b.extra;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.length+=V&(1<<b.extra)-1,V>>>=b.extra,z-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;Tt=(U=b.distcode[V&(1<<b.distbits)-1])>>>16&255,Dt=65535&U,!((Ut=U>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(!(240&Tt)){for(Ft=Ut,ke=Tt,Oe=Dt;Tt=(U=b.distcode[Oe+((V&(1<<Ft+ke)-1)>>Ft)])>>>16&255,Dt=65535&U,!(Ft+(Ut=U>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}V>>>=Ft,z-=Ft,b.back+=Ft}if(V>>>=Ut,z-=Ut,b.back+=Ut,64&Tt){C.msg="invalid distance code",b.mode=30;break}b.offset=Dt,b.extra=15&Tt,b.mode=24;case 24:if(b.extra){for(F=b.extra;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.offset+=V&(1<<b.extra)-1,V>>>=b.extra,z-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){C.msg="invalid distance too far back",b.mode=30;break}b.mode=25;case 25:if(ft===0)break t;if(lt=at-ft,b.offset>lt){if((lt=b.offset-lt)>b.whave&&b.sane){C.msg="invalid distance too far back",b.mode=30;break}Mt=lt>b.wnext?(lt-=b.wnext,b.wsize-lt):b.wnext-lt,lt>b.length&&(lt=b.length),Xt=b.window}else Xt=J,Mt=st-b.offset,lt=b.length;for(ft<lt&&(lt=ft),ft-=lt,b.length-=lt;J[st++]=Xt[Mt++],--lt;);b.length===0&&(b.mode=21);break;case 26:if(ft===0)break t;J[st++]=b.length,ft--,b.mode=21;break;case 27:if(b.wrap){for(;z<32;){if(tt===0)break t;tt--,V|=P[D++]<<z,z+=8}if(at-=ft,C.total_out+=at,b.total+=at,at&&(C.adler=b.check=b.flags?a(b.check,J,at,st-at):o(b.check,J,at,st-at)),at=ft,(b.flags?V:w(V))!==b.check){C.msg="incorrect data check",b.mode=30;break}z=V=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(V!==(4294967295&b.total)){C.msg="incorrect length check",b.mode=30;break}z=V=0}b.mode=29;case 29:ot=1;break t;case 30:ot=-3;break t;case 31:return-4;case 32:default:return f}return C.next_out=st,C.avail_out=ft,C.next_in=D,C.avail_in=tt,b.hold=V,b.bits=z,(b.wsize||at!==C.avail_out&&b.mode<30&&(b.mode<27||R!==4))&&et(C,C.output,C.next_out,at-C.avail_out)?(b.mode=31,-4):(Et-=C.avail_in,at-=C.avail_out,C.total_in+=Et,C.total_out+=at,b.total+=at,b.wrap&&at&&(C.adler=b.check=b.flags?a(b.check,J,at,C.next_out-at):o(b.check,J,at,C.next_out-at)),C.data_type=b.bits+(b.last?64:0)+(b.mode===12?128:0)+(b.mode===20||b.mode===15?256:0),(Et==0&&at===0||R===4)&&ot===d&&(ot=-5),ot)},i.inflateEnd=function(C){if(!C||!C.state)return f;var R=C.state;return R.window&&(R.window=null),C.state=null,d},i.inflateGetHeader=function(C,R){var b;return C&&C.state&&2&(b=C.state).wrap?((b.head=R).done=!1,d):f},i.inflateSetDictionary=function(C,R){var b,P=R.length;return C&&C.state?(b=C.state).wrap!==0&&b.mode!==11?f:b.mode===11&&o(1,R,P,0)!==b.check?-3:et(C,R,P,P)?(b.mode=31,-4):(b.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,h,d,f,p,m,E,w){var T,A,I,M,S,L,B,O,G,et=w.bits,C=0,R=0,b=0,P=0,J=0,D=0,st=0,tt=0,ft=0,V=0,z=null,Et=0,at=new s.Buf16(16),lt=new s.Buf16(16),Mt=null,Xt=0;for(C=0;C<=15;C++)at[C]=0;for(R=0;R<f;R++)at[h[d+R]]++;for(J=et,P=15;1<=P&&at[P]===0;P--);if(P<J&&(J=P),P===0)return p[m++]=20971520,p[m++]=20971520,w.bits=1,0;for(b=1;b<P&&at[b]===0;b++);for(J<b&&(J=b),C=tt=1;C<=15;C++)if(tt<<=1,(tt-=at[C])<0)return-1;if(0<tt&&(u===0||P!==1))return-1;for(lt[1]=0,C=1;C<15;C++)lt[C+1]=lt[C]+at[C];for(R=0;R<f;R++)h[d+R]!==0&&(E[lt[h[d+R]]++]=R);if(L=u===0?(z=Mt=E,19):u===1?(z=o,Et-=257,Mt=a,Xt-=257,256):(z=c,Mt=l,-1),C=b,S=m,st=R=V=0,I=-1,M=(ft=1<<(D=J))-1,u===1&&852<ft||u===2&&592<ft)return 1;for(;;){for(B=C-st,G=E[R]<L?(O=0,E[R]):E[R]>L?(O=Mt[Xt+E[R]],z[Et+E[R]]):(O=96,0),T=1<<C-st,b=A=1<<D;p[S+(V>>st)+(A-=T)]=B<<24|O<<16|G|0,A!==0;);for(T=1<<C-1;V&T;)T>>=1;if(T!==0?(V&=T-1,V+=T):V=0,R++,--at[C]==0){if(C===P)break;C=h[d+E[R]]}if(J<C&&(V&M)!==I){for(st===0&&(st=J),S+=b,tt=1<<(D=C-st);D+st<P&&!((tt-=at[D+st])<=0);)D++,tt<<=1;if(ft+=1<<D,u===1&&852<ft||u===2&&592<ft)return 1;p[I=V&M]=J<<24|D<<16|S-m|0}}return V!==0&&(p[S+V]=C-st<<24|64<<16|0),w.bits=J,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(U){for(var H=U.length;0<=--H;)U[H]=0}var l=0,u=29,h=256,d=h+1+u,f=30,p=19,m=2*d+1,E=15,w=16,T=7,A=256,I=16,M=17,S=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],et=new Array(2*(d+2));c(et);var C=new Array(2*f);c(C);var R=new Array(512);c(R);var b=new Array(256);c(b);var P=new Array(u);c(P);var J,D,st,tt=new Array(f);function ft(U,H,ct,ht,Z){this.static_tree=U,this.extra_bits=H,this.extra_base=ct,this.elems=ht,this.max_length=Z,this.has_stree=U&&U.length}function V(U,H){this.dyn_tree=U,this.max_code=0,this.stat_desc=H}function z(U){return U<256?R[U]:R[256+(U>>>7)]}function Et(U,H){U.pending_buf[U.pending++]=255&H,U.pending_buf[U.pending++]=H>>>8&255}function at(U,H,ct){U.bi_valid>w-ct?(U.bi_buf|=H<<U.bi_valid&65535,Et(U,U.bi_buf),U.bi_buf=H>>w-U.bi_valid,U.bi_valid+=ct-w):(U.bi_buf|=H<<U.bi_valid&65535,U.bi_valid+=ct)}function lt(U,H,ct){at(U,ct[2*H],ct[2*H+1])}function Mt(U,H){for(var ct=0;ct|=1&U,U>>>=1,ct<<=1,0<--H;);return ct>>>1}function Xt(U,H,ct){var ht,Z,pt=new Array(E+1),bt=0;for(ht=1;ht<=E;ht++)pt[ht]=bt=bt+ct[ht-1]<<1;for(Z=0;Z<=H;Z++){var dt=U[2*Z+1];dt!==0&&(U[2*Z]=Mt(pt[dt]++,dt))}}function Ut(U){var H;for(H=0;H<d;H++)U.dyn_ltree[2*H]=0;for(H=0;H<f;H++)U.dyn_dtree[2*H]=0;for(H=0;H<p;H++)U.bl_tree[2*H]=0;U.dyn_ltree[2*A]=1,U.opt_len=U.static_len=0,U.last_lit=U.matches=0}function Tt(U){8<U.bi_valid?Et(U,U.bi_buf):0<U.bi_valid&&(U.pending_buf[U.pending++]=U.bi_buf),U.bi_buf=0,U.bi_valid=0}function Dt(U,H,ct,ht){var Z=2*H,pt=2*ct;return U[Z]<U[pt]||U[Z]===U[pt]&&ht[H]<=ht[ct]}function Ft(U,H,ct){for(var ht=U.heap[ct],Z=ct<<1;Z<=U.heap_len&&(Z<U.heap_len&&Dt(H,U.heap[Z+1],U.heap[Z],U.depth)&&Z++,!Dt(H,ht,U.heap[Z],U.depth));)U.heap[ct]=U.heap[Z],ct=Z,Z<<=1;U.heap[ct]=ht}function ke(U,H,ct){var ht,Z,pt,bt,dt=0;if(U.last_lit!==0)for(;ht=U.pending_buf[U.d_buf+2*dt]<<8|U.pending_buf[U.d_buf+2*dt+1],Z=U.pending_buf[U.l_buf+dt],dt++,ht===0?lt(U,Z,H):(lt(U,(pt=b[Z])+h+1,H),(bt=L[pt])!==0&&at(U,Z-=P[pt],bt),lt(U,pt=z(--ht),ct),(bt=B[pt])!==0&&at(U,ht-=tt[pt],bt)),dt<U.last_lit;);lt(U,A,H)}function Oe(U,H){var ct,ht,Z,pt=H.dyn_tree,bt=H.stat_desc.static_tree,dt=H.stat_desc.has_stree,vt=H.stat_desc.elems,le=-1;for(U.heap_len=0,U.heap_max=m,ct=0;ct<vt;ct++)pt[2*ct]!==0?(U.heap[++U.heap_len]=le=ct,U.depth[ct]=0):pt[2*ct+1]=0;for(;U.heap_len<2;)pt[2*(Z=U.heap[++U.heap_len]=le<2?++le:0)]=1,U.depth[Z]=0,U.opt_len--,dt&&(U.static_len-=bt[2*Z+1]);for(H.max_code=le,ct=U.heap_len>>1;1<=ct;ct--)Ft(U,pt,ct);for(Z=vt;ct=U.heap[1],U.heap[1]=U.heap[U.heap_len--],Ft(U,pt,1),ht=U.heap[1],U.heap[--U.heap_max]=ct,U.heap[--U.heap_max]=ht,pt[2*Z]=pt[2*ct]+pt[2*ht],U.depth[Z]=(U.depth[ct]>=U.depth[ht]?U.depth[ct]:U.depth[ht])+1,pt[2*ct+1]=pt[2*ht+1]=Z,U.heap[1]=Z++,Ft(U,pt,1),2<=U.heap_len;);U.heap[--U.heap_max]=U.heap[1],function(Pt,Pn){var v,g,y,N,$,Q,it=Pn.dyn_tree,Wt=Pn.max_code,Te=Pn.stat_desc.static_tree,ge=Pn.stat_desc.has_stree,Ae=Pn.stat_desc.extra_bits,ce=Pn.stat_desc.extra_base,Ia=Pn.stat_desc.max_length,jl=0;for(N=0;N<=E;N++)Pt.bl_count[N]=0;for(it[2*Pt.heap[Pt.heap_max]+1]=0,v=Pt.heap_max+1;v<m;v++)Ia<(N=it[2*it[2*(g=Pt.heap[v])+1]+1]+1)&&(N=Ia,jl++),it[2*g+1]=N,Wt<g||(Pt.bl_count[N]++,$=0,ce<=g&&($=Ae[g-ce]),Q=it[2*g],Pt.opt_len+=Q*(N+$),ge&&(Pt.static_len+=Q*(Te[2*g+1]+$)));if(jl!==0){do{for(N=Ia-1;Pt.bl_count[N]===0;)N--;Pt.bl_count[N]--,Pt.bl_count[N+1]+=2,Pt.bl_count[Ia]--,jl-=2}while(0<jl);for(N=Ia;N!==0;N--)for(g=Pt.bl_count[N];g!==0;)Wt<(y=Pt.heap[--v])||(it[2*y+1]!==N&&(Pt.opt_len+=(N-it[2*y+1])*it[2*y],it[2*y+1]=N),g--)}}(U,H),Xt(pt,le,U.bl_count)}function x(U,H,ct){var ht,Z,pt=-1,bt=H[1],dt=0,vt=7,le=4;for(bt===0&&(vt=138,le=3),H[2*(ct+1)+1]=65535,ht=0;ht<=ct;ht++)Z=bt,bt=H[2*(ht+1)+1],++dt<vt&&Z===bt||(dt<le?U.bl_tree[2*Z]+=dt:Z!==0?(Z!==pt&&U.bl_tree[2*Z]++,U.bl_tree[2*I]++):dt<=10?U.bl_tree[2*M]++:U.bl_tree[2*S]++,pt=Z,le=(dt=0)===bt?(vt=138,3):Z===bt?(vt=6,3):(vt=7,4))}function ot(U,H,ct){var ht,Z,pt=-1,bt=H[1],dt=0,vt=7,le=4;for(bt===0&&(vt=138,le=3),ht=0;ht<=ct;ht++)if(Z=bt,bt=H[2*(ht+1)+1],!(++dt<vt&&Z===bt)){if(dt<le)for(;lt(U,Z,U.bl_tree),--dt!=0;);else Z!==0?(Z!==pt&&(lt(U,Z,U.bl_tree),dt--),lt(U,I,U.bl_tree),at(U,dt-3,2)):dt<=10?(lt(U,M,U.bl_tree),at(U,dt-3,3)):(lt(U,S,U.bl_tree),at(U,dt-11,7));pt=Z,le=(dt=0)===bt?(vt=138,3):Z===bt?(vt=6,3):(vt=7,4)}}c(tt);var nt=!1;function F(U,H,ct,ht){at(U,(l<<1)+(ht?1:0),3),function(Z,pt,bt,dt){Tt(Z),Et(Z,bt),Et(Z,~bt),s.arraySet(Z.pending_buf,Z.window,pt,bt,Z.pending),Z.pending+=bt}(U,H,ct)}i._tr_init=function(U){nt||(function(){var H,ct,ht,Z,pt,bt=new Array(E+1);for(Z=ht=0;Z<u-1;Z++)for(P[Z]=ht,H=0;H<1<<L[Z];H++)b[ht++]=Z;for(b[ht-1]=Z,Z=pt=0;Z<16;Z++)for(tt[Z]=pt,H=0;H<1<<B[Z];H++)R[pt++]=Z;for(pt>>=7;Z<f;Z++)for(tt[Z]=pt<<7,H=0;H<1<<B[Z]-7;H++)R[256+pt++]=Z;for(ct=0;ct<=E;ct++)bt[ct]=0;for(H=0;H<=143;)et[2*H+1]=8,H++,bt[8]++;for(;H<=255;)et[2*H+1]=9,H++,bt[9]++;for(;H<=279;)et[2*H+1]=7,H++,bt[7]++;for(;H<=287;)et[2*H+1]=8,H++,bt[8]++;for(Xt(et,d+1,bt),H=0;H<f;H++)C[2*H+1]=5,C[2*H]=Mt(H,5);J=new ft(et,L,h+1,d,E),D=new ft(C,B,0,f,E),st=new ft(new Array(0),O,0,p,T)}(),nt=!0),U.l_desc=new V(U.dyn_ltree,J),U.d_desc=new V(U.dyn_dtree,D),U.bl_desc=new V(U.bl_tree,st),U.bi_buf=0,U.bi_valid=0,Ut(U)},i._tr_stored_block=F,i._tr_flush_block=function(U,H,ct,ht){var Z,pt,bt=0;0<U.level?(U.strm.data_type===2&&(U.strm.data_type=function(dt){var vt,le=4093624447;for(vt=0;vt<=31;vt++,le>>>=1)if(1&le&&dt.dyn_ltree[2*vt]!==0)return o;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return a;for(vt=32;vt<h;vt++)if(dt.dyn_ltree[2*vt]!==0)return a;return o}(U)),Oe(U,U.l_desc),Oe(U,U.d_desc),bt=function(dt){var vt;for(x(dt,dt.dyn_ltree,dt.l_desc.max_code),x(dt,dt.dyn_dtree,dt.d_desc.max_code),Oe(dt,dt.bl_desc),vt=p-1;3<=vt&&dt.bl_tree[2*G[vt]+1]===0;vt--);return dt.opt_len+=3*(vt+1)+5+5+4,vt}(U),Z=U.opt_len+3+7>>>3,(pt=U.static_len+3+7>>>3)<=Z&&(Z=pt)):Z=pt=ct+5,ct+4<=Z&&H!==-1?F(U,H,ct,ht):U.strategy===4||pt===Z?(at(U,2+(ht?1:0),3),ke(U,et,C)):(at(U,4+(ht?1:0),3),function(dt,vt,le,Pt){var Pn;for(at(dt,vt-257,5),at(dt,le-1,5),at(dt,Pt-4,4),Pn=0;Pn<Pt;Pn++)at(dt,dt.bl_tree[2*G[Pn]+1],3);ot(dt,dt.dyn_ltree,vt-1),ot(dt,dt.dyn_dtree,le-1)}(U,U.l_desc.max_code+1,U.d_desc.max_code+1,bt+1),ke(U,U.dyn_ltree,U.dyn_dtree)),Ut(U),ht&&Tt(U)},i._tr_tally=function(U,H,ct){return U.pending_buf[U.d_buf+2*U.last_lit]=H>>>8&255,U.pending_buf[U.d_buf+2*U.last_lit+1]=255&H,U.pending_buf[U.l_buf+U.last_lit]=255&ct,U.last_lit++,H===0?U.dyn_ltree[2*ct]++:(U.matches++,H--,U.dyn_ltree[2*(b[ct]+h+1)]++,U.dyn_dtree[2*z(H)]++),U.last_lit===U.lit_bufsize-1},i._tr_align=function(U){at(U,2,3),lt(U,A,et),function(H){H.bi_valid===16?(Et(H,H.bi_buf),H.bi_buf=0,H.bi_valid=0):8<=H.bi_valid&&(H.pending_buf[H.pending++]=255&H.bi_buf,H.bi_buf>>=8,H.bi_valid-=8)}(U)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,d=1,f={},p=!1,m=o.document,E=Object.getPrototypeOf&&Object.getPrototypeOf(o);E=E&&E.setTimeout?E:o,c={}.toString.call(o.process)==="[object process]"?function(I){vi.nextTick(function(){T(I)})}:function(){if(o.postMessage&&!o.importScripts){var I=!0,M=o.onmessage;return o.onmessage=function(){I=!1},o.postMessage("","*"),o.onmessage=M,I}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(I){o.postMessage(h+I,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(I){T(I.data)},function(I){u.port2.postMessage(I)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(I){var M=m.createElement("script");M.onreadystatechange=function(){T(I),M.onreadystatechange=null,l.removeChild(M),M=null},l.appendChild(M)}):function(I){setTimeout(T,0,I)},E.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var M=new Array(arguments.length-1),S=0;S<M.length;S++)M[S]=arguments[S+1];var L={callback:I,args:M};return f[d]=L,c(d),d++},E.clearImmediate=w}function w(I){delete f[I]}function T(I){if(p)setTimeout(T,0,I);else{var M=f[I];if(M){p=!0;try{(function(S){var L=S.callback,B=S.args;switch(B.length){case 0:L();break;case 1:L(B[0]);break;case 2:L(B[0],B[1]);break;case 3:L(B[0],B[1],B[2]);break;default:L.apply(a,B)}})(M)}finally{w(I),p=!1}}}}function A(I){I.source===o&&typeof I.data=="string"&&I.data.indexOf(h)===0&&T(+I.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Tn<"u"?Tn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(i1);var k8=i1.exports,dd=ks(k8);const s1={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(s1);var hr=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},Eo,Sa,Es;class T8{constructor(...t){Eo.set(this,new Map),Sa.set(this,new Map),Es.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),hr(this,Es,"f").has(r)||hr(this,Es,"f").set(r,new Set);const s=hr(this,Es,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&hr(this,Sa,"f").set(r,a),o=!1,c)continue;const l=hr(this,Eo,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);hr(this,Eo,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:hr(this,Eo,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&hr(this,Sa,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:hr(this,Es,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of hr(this,Es,"f").values())Object.freeze(t);return this}_getTestState(){return{types:hr(this,Eo,"f"),extensions:hr(this,Sa,"f")}}}Eo=new WeakMap,Sa=new WeakMap,Es=new WeakMap;var A8=new T8(s1)._freeze();function o1(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return A8.getType(e)??"application/octet-stream"}async function v8(e,t,n){try{Zr(Y,e,t.name);const r=await t.arrayBuffer();(await new dd().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=o1(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{ye(Y,e,"crash",c.message)})})}catch(r){ye(Y,e,"crash",r.message)}}async function S8(e,t,n){try{Zr(Y,t,e.name);const r=await e.arrayBuffer();n(new Uint8Array(r))}catch(r){ye(Y,t,"crash",r.message)}}function a1(e,t){function n(r){if(k(t))switch(r){case"text/plain":t.text().then(i=>eu(Y,e,void 0,"text",`file:${t.name}`,i)).catch(i=>ye(Y,e,"crash",i.message));break;case"application/json":t.text().then(i=>eu(Y,e,void 0,"json",`file:${t.name}`,i)).catch(i=>ye(Y,e,"crash",i.message));break;case"application/zip":v8(e,t,i=>a1(e,i)).catch(i=>ye(Y,e,"crash",i.message));break;case"application/octet-stream":S8(t,e,i=>eu(Y,e,void 0,"binary",`file:${t.name}`,i)).catch(i=>ye(Y,e,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=o1(t.name,new Uint8Array(i));if(s)n(s);else return ye(Y,e,"parsewebfile",`unsupported file ${t.name}`)}).catch(i=>ye(Y,e,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function wo(e,t,n){function r(i){ye(e,t,"crash",i.message)}n().catch(r)}function R8(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function I8(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const N8=new Date("1980/09/02");async function c1(e){return console.info("saved",e),new Promise((t,n)=>{const r=new dd;for(let i=0;i<e.length;++i){const s=e[i],o=OL(s);if(o){const a=ST(o);k(a)&&r.file(s.id,a,{date:N8})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(I8(i))}).catch(n)})}async function O8(e){return new Promise((t,n)=>{const r=new dd;r.loadAsync(R8(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=CL(RT(c));k(l)&&i.push(l)}t(i)}).catch(n)})}const l1="$yellow$205$205$205$196";function u1(e,t){return`${e.x},${e.y},${t.x},${t.y}`}let Xe;function C8(){return!!Xe}function L8(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let h=i;h<=o;++h)for(let d=r;d<=s;++d){const f={x:d-r,y:h-i},p=sn(e,{x:d,y:h});(p==null?void 0:p.category)===Dn.ISOBJECT?(l.push(qe(Vo(e,d,h))),Br(p)!=="player"&&u.push({...qe(p),...f,id:"blank"})):l.push({...qe(p),...f})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}function M8(e,t,n,r){const i=Vn(e);if(k(i))switch(Xe=L8(i,t,n),r){case"copyobjects":Xe.terrain=[];break;case"copyterrain":Xe.objects=[];break}}function U8(e,t,n){const r=u1(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,l1),$t(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),$t(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),$t(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=kn(e);i.scroll=qr(e)}function F8(e,t,n,r){const i=Vn(e);if(!k(i)||!k(Xe))return;const s=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),c=Math.max(t.y,n.y),l=a-s+1,u=c-o+1,h=Math.min(Xe.width,l),d=Math.min(Xe.height,u);switch(r){case"pasteall":{for(let f=0;f<d;++f)for(let p=0;p<h;++p){const m=Ks({x:p,y:f},Xe.width);Sn(i,{...Xe.terrain[m],x:s+p,y:o+f})}for(let f=0;f<Xe.objects.length;++f){const p=Xe.objects[f];k(p.x)&&k(p.y)&&Ju(p.x,p.y,0,l-1,u-1,0)&&_h(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let f=0;f<Xe.objects.length;++f){const p=Xe.objects[f];k(p.x)&&k(p.y)&&Ju(p.x,p.y,0,l-1,u-1,0)&&_h(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let f=0;f<d;++f)for(let p=0;p<h;++p){const m=Ks({x:p,y:f},Xe.width);Sn(i,{...Xe.terrain[m],x:s+p,y:o+f})}break;case"pasteterraintiled":for(let f=o;f<=c;++f)for(let p=s;p<=a;++p){const m=(p-s)%Xe.width,E=(f-o)%Xe.height,w=Ks({x:m,y:E},Xe.width);Sn(i,{...Xe.terrain[w],x:p,y:f})}break}}function P8(e,t,n){const r=u1(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,l1),$t(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),$t(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),$t(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),$t(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=kn(e);i.scroll=qr(e)}const ws="$yellow$205$205$205$196";function $l(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function B8(e,t,n,r){const i=Vn(e);if(!k(i))return;let s=0;function o(){return s}function a(l,u){St(u)&&(s=u,Ip(t.x,t.y,n.x,n.y).forEach(h=>{const d=sn(i,h);k(d)&&(d[l]=u)}))}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,ws),$t(e,`batch:${$l(t,n)}`,"char",[r,"charedit"],o,a);const c=kn(e);c.scroll=qr(e)}function D8(e,t,n,r){const i=Vn(e);if(!k(i))return;let s=0;function o(){return s}function a(l,u){if(St(u)){s=u;for(let h=t.y;h<=n.y;++h)for(let d=t.x;d<=n.x;++d){const f=sn(i,{x:d,y:h});k(f)&&(f[l]=u)}}}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,ws),$t(e,`batch:${$l(t,n)}`,"color",[r,"coloredit"],o,a);const c=kn(e);c.scroll=qr(e)}function $8(e,t,n,r){const i=Vn(e);if(!k(i))return;let s=0;function o(){return s}function a(l,u){St(u)&&(s=u,Ip(t.x,t.y,n.x,n.y).forEach(h=>{const d=sn(i,h);k(d)&&(d[l]=u)}))}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,ws),$t(e,`batch:${$l(t,n)}`,"color",[r,"coloredit"],o,a);const c=kn(e);c.scroll=qr(e)}const Ra={stat:"",patternsize:2,mirror:1};function j8(e,t,n){const r=xn(Bt.MAIN);if(!k(r))return;const i=Vn(e);if(!k(i))return;const s=$l(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,ws),$t(e,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),C8()&&$t(e,"batch","paste elements",[`paste:${s}`,"hk","2"," 2 ","next"]),$t(e,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(f){const{target:p}=fr(f);return Ra[p]}function a(f,p){if(St(p)||kt(p)){const{target:m}=fr(f);Ra[m]=p}}$t(e,"batch","remix",[`stat:${s}`,"text"],o,a),$t(e,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),$t(e,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),$t(e,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),se(e,ws),$t(e,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),$t(e,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),$t(e,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),se(e,ws),$t(e,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),se(e,ws),se(e,"codepages:");const c=Math.min(t.x,n.x),l=Math.min(t.y,n.y),u=Math.max(t.x,n.x),h=Math.max(t.y,n.y),d=new Set;for(let f=l;f<=h;++f)for(let p=c;p<=u;++p){const m=sn(i,{x:p,y:f}),E=$_(r,m);k(E)&&!d.has(E.id)&&(d.add(E.id),$t(e,"batch",`edit @${Ue(E)}`,[`pageopen:${E.id}`]))}}const xo="$yellow$205$205$205$196";function pd(e,t){return`inspect:${t!=null&&t.id?t.id:mr(e,t)}`}function z8(e,t,n){const r=xn(Bt.MAIN);if(!k(r))return;const i=Vn(e);if(!k(i))return;function s(d){var p;return(t==null?void 0:t[d])??((p=t==null?void 0:t.kinddata)==null?void 0:p[d])??0}function o(d,f){k(t)&&(t[d]=f)}const a=t.category===Dn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=pd(i,t);se(e,`${a}: ${c} ${l}`),se(e,xo),$t(e,u,"color",[n,"coloredit"],s,o);const h=kn(e);h.scroll=qr(e)}function W8(e,t,n){const r=xn(Bt.MAIN);if(!k(r))return;const i=Vn(e);if(!k(i))return;function s(d){var p;return(t==null?void 0:t[d])??((p=t==null?void 0:t.kinddata)==null?void 0:p[d])??0}function o(d,f){k(t)&&(t[d]=f)}const a=t.category===Dn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=pd(i,t);se(e,`${a}: ${c} ${l}`),se(e,xo),$t(e,u,"char",[n,"charedit"],s,o);const h=kn(e);h.scroll=qr(e)}function K8(e,t,n,r,i,s){var h,d,f;function o(p){var E;const m=(r==null?void 0:r[p])??((E=r==null?void 0:r.kinddata)==null?void 0:E[p]);if(!k(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Ht.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){k(r)&&(r[p]=m)}s?se(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):se(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),se(e,xo);const c=pd(t,r);s?($t(e,c,"cycle",["cycle","number","1","255"],o,a),$t(e,c,"collision",["collision","select","iswalking",`${Ht.ISWALK}`,"isswimming",`${Ht.ISSWIM}`],o,a)):$t(e,c,"collision",["collision","select","iswalkable",`${Ht.ISWALK}`,"isswimable",`${Ht.ISSWIM}`,"issolid",`${Ht.ISSOLID}`],o,a),s&&$t(e,c,"pushable",["pushable","select","no","0","yes","1"],o,a),$t(e,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const l=ya(n),u=Xn(l);for(let p=0;p<u.length;++p){const m=u[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(ae(l[m])){const[E,w,...T]=l[m];kt(w)&&$t(e,c,w||m,[m,E,...T],o,a)}break}}$t(e,c,"copy coords",["copycoords","hk","5"," 5 "]),se(e,xo),$t(e,c,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],o,a),$t(e,c,`color: ${r.color??((d=r.kinddata)==null?void 0:d.color)??15}`,["color","hk","c"," C ","next"],o,a),$t(e,c,`bg: ${r.bg??((f=r.kinddata)==null?void 0:f.bg)??0}`,["bg","hk","b"," B ","next"],o,a),se(e,xo),$t(e,c,"make empty",["empty","hk","0"],o,a),se(e,xo),$t(e,"batch",`edit @${Ue(n)}`,[`pageopen:${n.id}`])}const h1="$yellow$205$205$205$196";function G8(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function H8(e,t,n,r){const i=xn(Bt.MAIN);if(!k(i))return;const s=Vn(e);if(k(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=sn(s,{x:a,y:o});(c==null?void 0:c.category)===Dn.ISOBJECT&&kr(i,s,c,i.timestamp),Sn(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=sn(s,{x:a,y:o});(c==null?void 0:c.category)===Dn.ISOBJECT&&kr(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)Sn(s,{x:a,y:o});break}}}function Y8(e,t,n){const r=G8(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,h1),$t(e,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),$t(e,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),$t(e,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=kn(e);i.scroll=qr(e)}function V8(e,t,n){const r=xn(Bt.MAIN);if(!k(r))return;const i=Vn(e);if(!k(i))return;if(ln(r,i),t.x===n.x&&t.y===n.y){const o=sn(i,t),a=$_(r,o);k(o)&&k(a)&&K8(e,i,a,o,t,Li(o)),o!=null&&o.kind||(se(e,`empty: ${t.x}, ${t.y}`),se(e,h1),$t(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]))}else j8(e,t,n);const s=kn(e);s.scroll=qr(e)}function X8(e,t){const n=ue(Bt.MAIN);if(!k(n))return;const r=Vn(t);if(!k(r))return;const i=fr(e),s=CT(r,i.target);if(k(s))switch(i.path){case"copycoords":Ql(Y,Tr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":z8(t,s,i.path);break;case"char":W8(t,s,i.path);break;case"empty":kr(n,r,s,n.timestamp);break;case"code":wo(Y,t,async()=>{const o=Br(s),a="object";$e(Y,t,`opened [${a}] ${o}`);const c=[r.id,s.id];qu(La(n.id,c),s.code??""),pE(Y,t),await Ud(800),Cd(Y,t,n.id,c,a,`${o} - ${n.name}`,[])});break;default:console.info("unknown inspect",i);break}}function q8(e,t){const n=Vn(t);if(!k(n))return;const r=fr(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:i,y:s},l={x:o,y:a};switch(r.target){case"copy":U8(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":M8(t,c,l,r.target);break;case"paste":P8(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":F8(t,c,l,r.target);break;case"empty":Y8(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":H8(t,c,l,r.target);break;case"chars":B8(t,c,l,"char");break;case"colors":D8(t,c,l,"color");break;case"bgs":$8(t,c,l,"bg");break;case"copycoords":Ql(Y,t,[i,s,o,a].join(" "));break;case"remixrun":{const u=Mn(_.book,_t.BOARD,Ra.stat),h=we(...u);k(h)&&ab(n.id,h.id,Ra.patternsize,Ra.mirror,c,l);break}case"pageopen":wo(Y,t,async()=>{await Ud(800),LE(Y,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const J8=16,xs={},Z8=15*60*5;let f1=0;const ko={},To={};async function d1(e){const t=yo(),n=ue(Bt.MAIN);if(t.length&&k(n)){const r=await c1(t),i=e?"autosave":`${new Date().toISOString()} ${n.name} ${r.length} chars`;yE(oe,Tr(),i,r)}}async function Q8(){const e=yo(),t=ue(Bt.MAIN);if(e.length&&k(t)){const n=await c1(e);_E(oe,Tr(),n)}}const oe=As("vm",["tick","second"],e=>{var n;if(!oe.session(e))return;const t=Tr();switch(e.target){case"operator":QM(e.player),zt(oe,e.player,`operator set to ${e.player}`),oe.replynext(e,"ackoperator",!0);break;case"zsswords":{const r=ue(Bt.MAIN);oe.replynext(e,"ackzsswords",{cli:Zf(zi.CLI),loader:Zf(zi.LOADER),runtime:Zf(zi.RUNTIME),flags:[...Xn(bs(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...ds(r,_t.OBJECT).map(i=>Ue(i)),...Xn(Vf)],altkinds:[...ds(r,_t.TERRAIN),...ds(r,_t.BOARD),...ds(r,_t.PALETTE),...ds(r,_t.CHARSET),...ds(r,_t.LOADER)].map(i=>Ue(i)),colors:[...Xn(Wo)],dirs:[...Xn(ih).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Xn(Xf)]});break}case"books":e.player===t&&wo(oe,e.player,async()=>{if(ae(e.data)){const[r,i]=e.data,s=await O8(r),o=s.map(a=>a.name);s8(s,i),zt(oe,e.player,`loading ${o.join(", ")}`),Zl(oe,e.player)}});break;case"search":l8(e.player)||Zl(oe,e.player);break;case"logout":c8(e.player),delete xs[e.player],zt(oe,t,`player ${e.player} logout`),Zl(oe,e.player);break;case"login":a8(e.player)?(xs[e.player]=0,zt(oe,Tr(),`login from ${e.player}`),oe.replynext(e,"acklogin",!0)):gE(oe,e.player);break;case"doot":xs[e.player]=0,Id(oe,e.player,"active");break;case"input":{const r=bs(e.player),[i=yn.NONE,s=0]=e.data??[yn.NONE,0];ae(r.inputqueue)||(r.inputqueue=[]),i!==yn.NONE&&r.inputqueue.push([i,s]);break}case"codewatch":if(ae(e.data)){const[r,i]=e.data,s=La(r,i);k(To[s])||(To[s]=Sp(s,o=>{const[a,c]=i,l=Ar(r),u=yi(l,a);if(k(u))if(mi(u)===_t.BOARD&&k(c)){const h=De(u),d=gn(h,c);k(d)&&(d.code=o,Of(U_(o),d))}else u.code=o,NL(u)})),ko[s]=ko[s]??new Set,ko[s].add(e.player)}break;case"coderelease":if(ae(e.data)){const[r,i]=e.data,[,s]=i,o=La(r,i);k(ko[o])&&(ko[o].delete(e.player),ko[o].size===0&&((n=To[o])==null||n.call(To),To[o]=void 0,kt(s)&&f8(s)))}break;case"halt":e.player===t&&J1(e.data)&&t8(e.data);break;case"tick":e8()||p8();break;case"synthsend":kt(e.data)&&ud(e.data,void 0);break;case"second":{u8(xs);const r=Object.keys(xs);for(let i=0;i<r.length;++i)++xs[r[i]];for(let i=0;i<r.length;++i){const s=r[i];xs[s]>=J8&&Ld(oe,s)}++f1>=Z8&&(f1=0,wo(oe,e.player,async()=>{await d1(!0)}));break}case"copyjsonfile":if(e.player===t){const r=ue(Bt.MAIN);if(k(r)&&ae(e.data)){const[i]=e.data,s=yi(r,i);k(s)&&bE(oe,t,s,`${Ue(s)}.${gi(s)}.json`)}}break;case"refsheet":{const r=ue(Bt.MAIN),i=El(r);k(r)&&ae(e.data)&&(CE(oe,e.player),gs(oe,e.player,"use as refsheet"),i.forEach(s=>{const o=Ue(s),a=gi(s);zt(oe,e.player,`!pageopenwith ${s.id} ${e.data.join(" ")};$blue[${a}]$white ${o}`)}));break}case"fork":e.player===t&&wo(oe,e.player,async()=>{await Q8()});break;case"flush":e.player===t&&wo(oe,e.player,async()=>{await d1()});break;case"cli":m8(e.player,e.data);break;case"restart":e.player===t&&(d8(),Md(oe,e.player));break;case"inspect":if(ae(e.data)){const[r,i]=e.data;V8(e.player,r,i)}break;case"loader":if(ae(e.data)){const[r,i,s,o]=e.data;if(i==="file")a1(e.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){zt(oe,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=ue(Bt.MAIN);k(c)&&k(a.data)&&kt(a.exported)&&(cd(a.data),zt(oe,e.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){zt(oe,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=ue(Bt.MAIN);k(c)&&k(a.data)&&kt(a.exported)&&(j_(c,a.data),zt(oe,e.player,`loaded ${a.exported}`))}else U6(r,i,s,o,e.player)}break;default:{const{target:r,path:i}=fr(e.target);switch(Lt(r)){case"batch":q8(i,e.player);break;case"empty":{const s=fr(i);switch(s.target){case"copycoords":Ql(oe,Tr(),s.path.split(",").join(" "));break}break}case"inspect":X8(i,e.player);break;case"touched":if(ae(e.data)){const[s,o,a]=e.data;Qb({...e,target:`${s}:${a}`,data:void 0,sender:o})}break;default:Qb(e);break}break}}},ZM());function t3(){mE(oe)}const{forward:e3}=DE(e=>{$E(e)&&postMessage(e)});onmessage=function(t){e3(t.data)},setTimeout(t3,100)})();

var LP=Object.defineProperty;var MP=(hi,Vn,In)=>Vn in hi?LP(hi,Vn,{enumerable:!0,configurable:!0,writable:!0,value:In}):hi[Vn]=In;var Mt=(hi,Vn,In)=>MP(hi,typeof Vn!="symbol"?Vn+"":Vn,In);(function(){"use strict";const hi=new Set,Vn={emit(e,t,n,r,i){Vn.invoke(Tw(e,t,n,r,i))},invoke(e){hi.forEach(t=>t.handle(e))},connect(e){hi.add(e)},disconnect(e){hi.delete(e)}};var In=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ls(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function G1(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var Ud={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(In,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Ud);var K1=Ud.exports,Fd=Ls(K1),Pd={};(function(e){var t=In&&In.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,m;d<h;d++)(m||!(d in u))&&(m||(m=Array.prototype.slice.call(u,0,d)),m[d]=u[d]);return l.concat(m||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,m=l.adjectiveCount,p=m===void 0?1:m,w=l.addAdverb,b=w===void 0?!1:w,v=t(t(t([],t([],Array(p),!0).map(function(A){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),b?[n(e.adverbs)]:[],!0);return h&&(v=v.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),v.join(f)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return e.adjectives.length*f*e.nouns.length*e.verbs.length*(h?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return r(e.adjectives).length*f+f*p.length+r(e.nouns).length+p.length+r(e.verbs).length+(h?r(e.adverbs).length+p.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return i(e.adjectives).length*f+f*p.length+i(e.nouns).length+p.length+i(e.verbs).length+(h?i(e.adverbs).length+p.length:0)}e.minLength=c,e.default=s})(Pd);var Bd=Ls(Pd);const H1="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Y1=e=>crypto.getRandomValues(new Uint8Array(e)),V1=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},$d=(e,t=21)=>V1(e,t,Y1),X1=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=H1[n[e]&63];return t};var Dd="abcdefghijklmnopqrstuvwxyz",jd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",zd="0123456789",q1="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",J1="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const Z1=zd,Q1=Dd,tw=jd;var ew=Z1+Q1+tw,nu={lowercase:Dd,uppercase:jd,numbers:zd,nolookalikes:q1,nolookalikesSafe:J1,alphanumeric:ew};function $e(){return`sid_${X1(12).replaceAll("-",".")}`}$d(nu.numbers,4),$d(`${nu.numbers}${nu.lowercase}`,16);function Nn(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function nw(){return Bd({capitalize:!1,adjectiveCount:1})}function rw(){return Bd({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var iw=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),sw=Object.prototype.hasOwnProperty;function ru(e,t){return sw.call(e,t)}function iu(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)ru(e,i)&&r.push(i);return r}function Cn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function su(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function rs(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Wd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function ou(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(ou(e[t]))return!0}else if(typeof e=="object"){for(var r=iu(e),i=r.length,s=0;s<i;s++)if(ou(e[r[s]]))return!0}}return!1}function Gd(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Kd=function(e){iw(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,Gd(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Gd(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),Me=Kd,ow=Cn,Ms={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=za(n,this.path);r&&(r=Cn(r));var i=is(n,{op:"remove",path:this.from}).removed;return is(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=za(n,this.from);return is(n,{op:"add",path:this.path,value:Cn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Lo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},aw={add:function(e,t,n){return su(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Ms.move,copy:Ms.copy,test:Ms.test,_get:Ms._get};function za(e,t){if(t=="")return e;var n={op:"_get",path:t};return is(e,n),n.value}function is(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Wa(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=za(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Lo(e,t.value),o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=Cn(e));var a=t.path||"",c=a.split("/"),l=e,u=1,f=c.length,d=void 0,h=void 0,m=void 0;for(typeof n=="function"?m=n:m=Wa;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Wd(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!su(h))throw new Me("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);su(h)&&(h=~~h)}if(u>=f){if(n&&t.op==="add"&&h>l.length)throw new Me("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=aw[t.op].call(t,l,h,e);if(o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=f){var o=Ms[t.op].call(t,l,h,e);if(o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Me("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function au(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Cn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=is(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function cw(e,t,n){var r=is(e,t);if(r.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Wa(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Me("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Ms[e.op]){if(typeof e.path!="string")throw new Me("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Me('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Me("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&ou(e.value))throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Me("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Me("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Hd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Me("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function Hd(e,t,n){try{if(!Array.isArray(e))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)au(Cn(t),Cn(e),n||!0);else{n=n||Wa;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Me)return i;throw i}}function Lo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!Lo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Lo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var lw=Object.freeze({__proto__:null,JsonPatchError:Me,_areEquals:Lo,applyOperation:is,applyPatch:au,applyReducer:cw,deepClone:ow,getValueByPointer:za,validate:Hd,validator:Wa});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var cu=new WeakMap,uw=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),hw=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function fw(e){return cu.get(e)}function dw(e,t){return e.observers.get(t)}function pw(e,t){e.observers.delete(t.callback)}function mw(e,t){t.unobserve()}function gw(e,t){var n=[],r,i=fw(e);if(!i)i=new uw(e),cu.set(e,i);else{var s=dw(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=Cn(e),t){r.callback=t,r.next=null;var o=function(){lu(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){lu(r),clearTimeout(r.next),pw(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new hw(t,r)),r}function lu(e,t){t===void 0&&(t=!1);var n=cu.get(e.object);uu(n.value,e.object,e.patches,"",t),e.patches.length&&au(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function uu(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=iu(t),o=iu(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(ru(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?uu(u,f,n,r+"/"+rs(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+rs(l),value:Cn(u)}),n.push({op:"replace",path:r+"/"+rs(l),value:Cn(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+rs(l),value:Cn(u)}),n.push({op:"remove",path:r+"/"+rs(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!ru(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+rs(l),value:Cn(t[l])})}}}function Yd(e,t,n){n===void 0&&(n=!1);var r=[];return uu(e,t,r,"",n),r}var _w=Object.freeze({__proto__:null,compare:Yd,generate:lu,observe:gw,unobserve:mw});Object.assign({},lw,_w,{JsonPatchError:Kd,deepClone:Cn,escapePathComponent:rs,unescapePathComponent:Wd});var yw=typeof Element<"u",bw=typeof Map=="function",ww=typeof Set=="function",Ew=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ga(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ga(e[r],t[r]))return!1;return!0}var s;if(bw&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ga(r.value[1],t.get(r.value[0])))return!1;return!0}if(ww&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(Ew&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(yw&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ga(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var xw=function(t,n){try{return Ga(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},kw=Ls(xw);function E(e){return e!=null}const sr=Object.keys;function wr(e){return Cn(e)}function vw(e){return typeof e=="boolean"}function Tt(e){return typeof e=="number"&&isNaN(e)===!1}function _t(e){return typeof e=="string"}function le(e){return Array.isArray(e)}function hu(e){return e}var dt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(dt||{}),jt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(jt||{}),Ln=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Ln||{}),pt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.PLAYER=18]="PLAYER",e[e.FIND=19]="FIND",e[e.FLEE=20]="FLEE",e[e.TO=21]="TO",e[e.MID=22]="MID",e[e.OVER=23]="OVER",e[e.UNDER=24]="UNDER",e))(pt||{}),vt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.HOTKEY=11]="HOTKEY",e[e.COPYIT=12]="COPYIT",e[e.OPENIT=13]="OPENIT",e[e.ZSSEDIT=14]="ZSSEDIT",e[e.CHAREDIT=15]="CHAREDIT",e[e.COLOREDIT=16]="COLOREDIT",e))(vt||{});function Ot(e){return(e==null?void 0:e.toLowerCase().trim())??""}function Tw(e,t,n,r,i){return{session:e,player:t,id:$e(),sender:n,target:r,data:i}}function Xn(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Us(e,t=[],n=hu,r=""){const i=$e(),s=Ot(e),o=t.map(Ot);let a=r;const c={id(){return i},name(){return e},session(l){return E(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,f){Vn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=Xn(l.target),d=Ot(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&E(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return Vn.connect(c),c}function Aw(e){return typeof e=="object"&&_t(e.session)&&_t(e.player)&&_t(e.id)&&_t(e.sender)&&_t(e.target)}function fe(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function Rw(e,t,...n){return e.emit(t,"info",n),!0}function xe(e,t,...n){return e.emit(t,"log",n),!0}function Vd(e,t,n){e.emit(t,"toast",n)}function Sw(e,t,n){e.emit(t,"bridge:streamstart",n)}function Ow(e,t){e.emit(t,"bridge:streamstop",void 0)}function Iw(e,t,n){e.emit(t,"bridge:chatstart",n)}function Nw(e,t){e.emit(t,"bridge:chatstop")}function Cw(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function Lw(e,t){e.emit(t,"bridge:talkstart",t)}function Mw(e,t){e.emit(t,"bridge:talkstop",t)}function Uw(e,t){e.emit(t,"bridge:mediastart",t)}function Fw(e,t){e.emit(t,"bridge:mediastop",t)}function Pw(e,t,n){e.emit(t,"bridge:start",n)}function Bw(e,t,n){e.emit(t,"bridge:tab",n)}function $w(e,t,n){e.emit(t,"gadgetclient:paint",n)}function Dw(e,t,n){e.emit(t,"gadgetclient:patch",n)}function jw(e,t){e.emit(t,"gadgetserver:clearscroll")}function zw(e){e.emit("","ready")}function Xd(e,t){e.emit(t,"register:loginfail")}function fu(e,t){e.emit(t,"register:loginready",!0)}function Ww(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function Gw(e,t,n){e.emit(t,"register:forkmem",[n])}function Kw(e,t,n,r){e.emit(t,"register:itchiopublishmem",[n,r])}function du(e,t,n){e.emit(t,"register:copy",n)}function Hw(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function qd(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function Yw(e,t){e.emit(t,"register:dev",void 0)}function Vw(e,t){e.emit(t,"register:share",void 0)}function Xw(e,t){e.emit(t,"register:nuke",void 0)}function qw(e,t){e.emit(t,"register:enterar",void 0)}function Jw(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function Zw(e,t,n,r,i){e.emit(t,"synth:play",[n,r,i])}function Qw(e,t,n){e.emit(t,"synth:focus",n)}function tE(e,t,n){e.emit(t,"synth:bpm",n)}function eE(e,t,n){e.emit(t,"synth:playvolume",n)}function nE(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function rE(e,t,n){e.emit(t,"synth:ttsvolume",n)}function pu(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function Jd(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function Zd(e,t,n,r){e.emit(t,"register:config",[n,r])}function iE(e,t){e.emit(t,"register:configshow")}function sE(e,t){e.emit(t,"register:inspector")}function Qd(e,t,n,r,i,s){e.emit(t,"register:editor:open",[n,r,i,s])}function oE(e,t){e.emit(t,"vm:local")}function t0(e,t){e.emit(t,"vm:logout")}function Ka(e,t){const[n,r]=t;return`${e}:${[n,r].filter(E).join(":")}`}function aE(e,t,n){e.emit(t,"vm:cli",n)}function cE(e,t){e.emit(t,"vm:restart")}function e0(e,t){e.emit(t,"vm:flush")}function lE(e,t){e.emit(t,"vm:fork")}function uE(e,t){e.emit(t,"vm:itchiopublish")}function hE(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function fE(e,t){return{filename:e,json:t}}function dE(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function mu(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=hE(i,s);break;case"json":o=fE(i,s);break;case"binary":o=dE(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function pE(e){const t=new Set;function n(s){Aw(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Vn.invoke(s))}const r=Us("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Vn.disconnect(r)}return{forward:n,disconnect:i}}function mE(e){switch(e.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const t=Xn(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const gu=66.666,Ha=Math.round(1e3/gu),gE=3;function n0(e){return new Promise(t=>setTimeout(t,e))}const _u=Us("clock");let yu=0,Ya=0,bu=0,r0=performance.now();function i0(){const e=performance.now(),t=e-r0;bu+=t,bu>=gu&&(bu%=gu,_u.emit("","tick",Ya),_u.emit("","tock",Ya),++yu,++Ya,yu>=Ha&&(yu%=Ha,_u.emit("","second",Ya))),r0=e,setTimeout(i0,2)}i0();function _E(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var s0={exports:{}},De=s0.exports={},$r,Dr;function wu(){throw new Error("setTimeout has not been defined")}function Eu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?$r=setTimeout:$r=wu}catch{$r=wu}try{typeof clearTimeout=="function"?Dr=clearTimeout:Dr=Eu}catch{Dr=Eu}})();function o0(e){if($r===setTimeout)return setTimeout(e,0);if(($r===wu||!$r)&&setTimeout)return $r=setTimeout,setTimeout(e,0);try{return $r(e,0)}catch{try{return $r.call(null,e,0)}catch{return $r.call(this,e,0)}}}function yE(e){if(Dr===clearTimeout)return clearTimeout(e);if((Dr===Eu||!Dr)&&clearTimeout)return Dr=clearTimeout,clearTimeout(e);try{return Dr(e)}catch{try{return Dr.call(null,e)}catch{return Dr.call(this,e)}}}var fi=[],Fs=!1,ss,Va=-1;function bE(){!Fs||!ss||(Fs=!1,ss.length?fi=ss.concat(fi):Va=-1,fi.length&&a0())}function a0(){if(!Fs){var e=o0(bE);Fs=!0;for(var t=fi.length;t;){for(ss=fi,fi=[];++Va<t;)ss&&ss[Va].run();Va=-1,t=fi.length}ss=null,Fs=!1,yE(e)}}De.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];fi.push(new c0(e,t)),fi.length===1&&!Fs&&o0(a0)};function c0(e,t){this.fun=e,this.array=t}c0.prototype.run=function(){this.fun.apply(null,this.array)},De.title="browser",De.browser=!0,De.env={},De.argv=[],De.version="",De.versions={};function di(){}De.on=di,De.addListener=di,De.once=di,De.off=di,De.removeListener=di,De.removeAllListeners=di,De.emit=di,De.prependListener=di,De.prependOnceListener=di,De.listeners=function(e){return[]},De.binding=function(e){throw new Error("process.binding is not supported")},De.cwd=function(){return"/"},De.chdir=function(e){throw new Error("process.chdir is not supported")},De.umask=function(){return 0};var wE=s0.exports;const Er=_E(wE);var Gt={},xu=Symbol.for("react.transitional.element"),EE=Symbol.for("react.portal"),xE=Symbol.for("react.fragment"),kE=Symbol.for("react.strict_mode"),vE=Symbol.for("react.profiler"),TE=Symbol.for("react.consumer"),AE=Symbol.for("react.context"),RE=Symbol.for("react.forward_ref"),SE=Symbol.for("react.suspense"),OE=Symbol.for("react.memo"),l0=Symbol.for("react.lazy"),u0=Symbol.iterator;function IE(e){return e===null||typeof e!="object"?null:(e=u0&&e[u0]||e["@@iterator"],typeof e=="function"?e:null)}var h0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f0=Object.assign,d0={};function Ps(e,t,n){this.props=e,this.context=t,this.refs=d0,this.updater=n||h0}Ps.prototype.isReactComponent={},Ps.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Ps.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function p0(){}p0.prototype=Ps.prototype;function ku(e,t,n){this.props=e,this.context=t,this.refs=d0,this.updater=n||h0}var vu=ku.prototype=new p0;vu.constructor=ku,f0(vu,Ps.prototype),vu.isPureReactComponent=!0;var m0=Array.isArray,ke={H:null,A:null,T:null,S:null,V:null},g0=Object.prototype.hasOwnProperty;function Tu(e,t,n,r,i,s){return n=s.ref,{$$typeof:xu,type:e,key:t,ref:n!==void 0?n:null,props:s}}function NE(e,t){return Tu(e.type,t,void 0,void 0,void 0,e.props)}function Au(e){return typeof e=="object"&&e!==null&&e.$$typeof===xu}function CE(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var _0=/\/+/g;function Ru(e,t){return typeof e=="object"&&e!==null&&e.key!=null?CE(""+e.key):t.toString(36)}function y0(){}function LE(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(y0,y0):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function Bs(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case xu:case EE:o=!0;break;case l0:return o=e._init,Bs(o(e._payload),t,n,r,i)}}if(o)return i=i(e),o=r===""?"."+Ru(e,0):r,m0(i)?(n="",o!=null&&(n=o.replace(_0,"$&/")+"/"),Bs(i,t,n,"",function(l){return l})):i!=null&&(Au(i)&&(i=NE(i,n+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(_0,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=r===""?".":r+":";if(m0(e))for(var c=0;c<e.length;c++)r=e[c],s=a+Ru(r,c),o+=Bs(r,t,n,s,i);else if(c=IE(e),typeof c=="function")for(e=c.call(e),c=0;!(r=e.next()).done;)r=r.value,s=a+Ru(r,c++),o+=Bs(r,t,n,s,i);else if(s==="object"){if(typeof e.then=="function")return Bs(LE(e),t,n,r,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function Xa(e,t,n){if(e==null)return e;var r=[],i=0;return Bs(e,r,"","",function(s){return t.call(n,s,i++)}),r}function ME(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var b0=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof Er=="object"&&typeof Er.emit=="function"){Er.emit("uncaughtException",e);return}console.error(e)};function UE(){}Gt.Children={map:Xa,forEach:function(e,t,n){Xa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Xa(e,function(){t++}),t},toArray:function(e){return Xa(e,function(t){return t})||[]},only:function(e){if(!Au(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Gt.Component=Ps,Gt.Fragment=xE,Gt.Profiler=vE,Gt.PureComponent=ku,Gt.StrictMode=kE,Gt.Suspense=SE,Gt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ke,Gt.__COMPILER_RUNTIME={__proto__:null,c:function(e){return ke.H.useMemoCache(e)}},Gt.cache=function(e){return function(){return e.apply(null,arguments)}},Gt.cloneElement=function(e,t,n){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var r=f0({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!g0.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(r[o]=t[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return Tu(e.type,i,void 0,void 0,s,r)},Gt.createContext=function(e){return e={$$typeof:AE,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:TE,_context:e},e},Gt.createElement=function(e,t,n){var r,i={},s=null;if(t!=null)for(r in t.key!==void 0&&(s=""+t.key),t)g0.call(t,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=t[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return Tu(e,s,void 0,void 0,null,i)},Gt.createRef=function(){return{current:null}},Gt.forwardRef=function(e){return{$$typeof:RE,render:e}},Gt.isValidElement=Au,Gt.lazy=function(e){return{$$typeof:l0,_payload:{_status:-1,_result:e},_init:ME}},Gt.memo=function(e,t){return{$$typeof:OE,type:e,compare:t===void 0?null:t}},Gt.startTransition=function(e){var t=ke.T,n={};ke.T=n;try{var r=e(),i=ke.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(UE,b0)}catch(s){b0(s)}finally{ke.T=t}},Gt.unstable_useCacheRefresh=function(){return ke.H.useCacheRefresh()},Gt.use=function(e){return ke.H.use(e)},Gt.useActionState=function(e,t,n){return ke.H.useActionState(e,t,n)},Gt.useCallback=function(e,t){return ke.H.useCallback(e,t)},Gt.useContext=function(e){return ke.H.useContext(e)},Gt.useDebugValue=function(){},Gt.useDeferredValue=function(e,t){return ke.H.useDeferredValue(e,t)},Gt.useEffect=function(e,t,n){var r=ke.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Gt.useId=function(){return ke.H.useId()},Gt.useImperativeHandle=function(e,t,n){return ke.H.useImperativeHandle(e,t,n)},Gt.useInsertionEffect=function(e,t){return ke.H.useInsertionEffect(e,t)},Gt.useLayoutEffect=function(e,t){return ke.H.useLayoutEffect(e,t)},Gt.useMemo=function(e,t){return ke.H.useMemo(e,t)},Gt.useOptimistic=function(e,t){return ke.H.useOptimistic(e,t)},Gt.useReducer=function(e,t,n){return ke.H.useReducer(e,t,n)},Gt.useRef=function(e){return ke.H.useRef(e)},Gt.useState=function(e){return ke.H.useState(e)},Gt.useSyncExternalStore=function(e,t,n){return ke.H.useSyncExternalStore(e,t,n)},Gt.useTransition=function(){return ke.H.useTransition()},Gt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const w0="0123456789abcdef",E0=[],qa=[];for(let e=0;e<256;e++)E0[e]=w0[e>>4&15]+w0[e&15],e<16&&(e<10?qa[48+e]=e:qa[87+e]=e);const x0=e=>{const t=e.length;let n="",r=0;for(;r<t;)n+=E0[e[r++]];return n},Ja=e=>{const t=e.length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=qa[e.charCodeAt(s++)]<<4|qa[e.charCodeAt(s++)];return r};for(var k0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",FE=typeof Uint8Array>"u"?[]:new Uint8Array(256),Za=0;Za<k0.length;Za++)FE[k0.charCodeAt(Za)]=Za;new TextDecoder,new TextEncoder;const v0=typeof window<"u"?window:self,T0=v0.crypto||v0.msCrypto||{};T0.subtle||T0.webkitSubtle;const $s=globalThis||void 0||self,xr=()=>new Map,Su=e=>{const t=xr();return e.forEach((n,r)=>{t.set(r,n)}),t},Li=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},PE=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},BE=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},Ds=()=>new Set,Ou=e=>e[e.length-1],$E=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},os=Array.from,DE=Array.isArray;class jE{constructor(){this._observers=xr()}on(t,n){return Li(this._observers,t,Ds).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return os((this._observers.get(t)||xr()).values()).forEach(r=>r(...n))}destroy(){this._observers=xr()}}const Mi=Math.floor,Qa=Math.abs,A0=(e,t)=>e<t?e:t,as=(e,t)=>e>t?e:t,R0=e=>e!==0?e<0:1/e<0,S0=1,O0=2,Iu=4,Nu=8,Mo=32,pi=64,qn=128,tc=31,Cu=63,cs=127,zE=2147483647,I0=Number.MAX_SAFE_INTEGER,WE=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Mi(e)===e),GE=e=>e.toLowerCase(),KE=/^\s*/g,HE=e=>e.replace(KE,""),YE=/([A-Z])/g,N0=(e,t)=>HE(e.replace(YE,n=>`${t}${GE(n)}`)),VE=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Uo=typeof TextEncoder<"u"?new TextEncoder:null,XE=Uo?e=>Uo.encode(e):VE;let Fo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Fo&&Fo.decode(new Uint8Array).length===1&&(Fo=null);class Po{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ec=()=>new Po,qE=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},jr=e=>{const t=new Uint8Array(qE(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},JE=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(as(n,t)*2),e.cpos=0)},rn=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Lu=rn,ie=(e,t)=>{for(;t>cs;)rn(e,qn|cs&t),t=Mi(t/128);rn(e,cs&t)},Mu=(e,t)=>{const n=R0(t);for(n&&(t=-t),rn(e,(t>Cu?qn:0)|(n?pi:0)|Cu&t),t=Mi(t/64);t>0;)rn(e,(t>cs?qn:0)|cs&t),t=Mi(t/128)},Uu=new Uint8Array(3e4),ZE=Uu.length/3,QE=(e,t)=>{if(t.length<ZE){const n=Uo.encodeInto(t,Uu).written||0;ie(e,n);for(let r=0;r<n;r++)rn(e,Uu[r])}else Jn(e,XE(t))},tx=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;ie(e,r);for(let i=0;i<r;i++)rn(e,n.codePointAt(i))},js=Uo&&Uo.encodeInto?QE:tx,nc=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=A0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(as(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},Jn=(e,t)=>{ie(e,t.byteLength),nc(e,t)},Fu=(e,t)=>{JE(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},ex=(e,t)=>Fu(e,4).setFloat32(0,t,!1),nx=(e,t)=>Fu(e,8).setFloat64(0,t,!1),rx=(e,t)=>Fu(e,8).setBigInt64(0,t,!1),C0=new DataView(new ArrayBuffer(4)),ix=e=>(C0.setFloat32(0,e),C0.getFloat32(0)===e),Bo=(e,t)=>{switch(typeof t){case"string":rn(e,119),js(e,t);break;case"number":WE(t)&&Qa(t)<=zE?(rn(e,125),Mu(e,t)):ix(t)?(rn(e,124),ex(e,t)):(rn(e,123),nx(e,t));break;case"bigint":rn(e,122),rx(e,t);break;case"object":if(t===null)rn(e,126);else if(DE(t)){rn(e,117),ie(e,t.length);for(let n=0;n<t.length;n++)Bo(e,t[n])}else if(t instanceof Uint8Array)rn(e,116),Jn(e,t);else{rn(e,118);const n=Object.keys(t);ie(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];js(e,i),Bo(e,t[i])}}break;case"boolean":rn(e,t?120:121);break;default:rn(e,127)}};class L0 extends Po{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&ie(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const M0=e=>{e.count>0&&(Mu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&ie(e.encoder,e.count-2))};class rc{constructor(){this.encoder=new Po,this.s=0,this.count=0}write(t){this.s===t?this.count++:(M0(this),this.count=1,this.s=t)}toUint8Array(){return M0(this),jr(this.encoder)}}const U0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Mu(e.encoder,t),e.count>1&&ie(e.encoder,e.count-2)}};class Pu{constructor(){this.encoder=new Po,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(U0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return U0(this),jr(this.encoder)}}class sx{constructor(){this.sarr=[],this.s="",this.lensE=new rc}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Po;return this.sarr.push(this.s),this.s="",js(t,this.sarr.join("")),nc(t,this.lensE.toUint8Array()),jr(t)}}const Ui=e=>new Error(e),zr=()=>{throw Ui("Method unimplemented")},Wr=()=>{throw Ui("Unexpected case")},F0=Ui("Unexpected end of array"),P0=Ui("Integer out of Range");class ic{constructor(t){this.arr=t,this.pos=0}}const zs=e=>new ic(e),ox=e=>e.pos!==e.arr.length,ax=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Zn=e=>ax(e,Yt(e)),Ws=e=>e.arr[e.pos++],Yt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&cs)*n,n*=128,i<qn)return t;if(t>I0)throw P0}throw F0},Bu=e=>{let t=e.arr[e.pos++],n=t&Cu,r=64;const i=(t&pi)>0?-1:1;if(!(t&qn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&cs)*r,r*=128,t<qn)return i*n;if(n>I0)throw P0}throw F0},Gs=Fo?e=>Fo.decode(Zn(e)):e=>{let t=Yt(e);if(t===0)return"";{let n=String.fromCodePoint(Ws(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Ws(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},$u=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},cx=[e=>{},e=>null,Bu,e=>$u(e,4).getFloat32(0,!1),e=>$u(e,8).getFloat64(0,!1),e=>$u(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Gs,e=>{const t=Yt(e),n={};for(let r=0;r<t;r++){const i=Gs(e);n[i]=$o(e)}return n},e=>{const t=Yt(e),n=[];for(let r=0;r<t;r++)n.push($o(e));return n},Zn],$o=e=>cx[127-Ws(e)](e);class B0 extends ic{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),ox(this)?this.count=Yt(this)+1:this.count=-1),this.count--,this.s}}class sc extends ic{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Bu(this);const t=R0(this.s);this.count=1,t&&(this.s=-this.s,this.count=Yt(this)+2)}return this.count--,this.s}}class Du extends ic{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Bu(this),n=t&1;this.diff=Mi(t/2),this.count=1,n&&(this.count=Yt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class lx{constructor(t){this.decoder=new sc(t),this.str=Gs(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const ux=crypto.getRandomValues.bind(crypto),$0=()=>ux(new Uint32Array(1))[0],hx="10000000-1000-4000-8000"+-1e11,fx=()=>hx.replace(/[018]/g,e=>(e^$0()&15>>e/4).toString(16)),D0=e=>new Promise(e);Promise.all.bind(Promise);var j0={},oc={};oc.byteLength=mx,oc.toByteArray=_x,oc.fromByteArray=wx;for(var Gr=[],or=[],dx=typeof Uint8Array<"u"?Uint8Array:Array,ju="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ks=0,px=ju.length;Ks<px;++Ks)Gr[Ks]=ju[Ks],or[ju.charCodeAt(Ks)]=Ks;or[45]=62,or[95]=63;function z0(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function mx(e){var t=z0(e),n=t[0],r=t[1];return(n+r)*3/4-r}function gx(e,t,n){return(t+n)*3/4-n}function _x(e){var t,n=z0(e),r=n[0],i=n[1],s=new dx(gx(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=or[e.charCodeAt(c)]<<18|or[e.charCodeAt(c+1)]<<12|or[e.charCodeAt(c+2)]<<6|or[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=or[e.charCodeAt(c)]<<2|or[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=or[e.charCodeAt(c)]<<10|or[e.charCodeAt(c+1)]<<4|or[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function yx(e){return Gr[e>>18&63]+Gr[e>>12&63]+Gr[e>>6&63]+Gr[e&63]}function bx(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(yx(r));return i.join("")}function wx(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(bx(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Gr[t>>2]+Gr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Gr[t>>10]+Gr[t>>4&63]+Gr[t<<2&63]+"=")),i.join("")}var zu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */zu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=e[t+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+e[t+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+e[t+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},zu.write=function(e,t,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,m=r?1:-1,p=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?t+=d/c:t+=d*Math.pow(2,1-f),t*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(t*c-1)*Math.pow(2,i),o=o+f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[n+h]=a&255,h+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+h]=o&255,h+=m,o/=256,l-=8);e[n+h-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=oc,n=zu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=M,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const O=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(O,g),O.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(O){if(O>i)throw new RangeError('The value "'+O+'" is invalid for option "size"');const g=new s(O);return Object.setPrototypeOf(g,u.prototype),g}function u(O,g,y){if(typeof O=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(O)}return f(O,g,y)}u.poolSize=8192;function f(O,g,y){if(typeof O=="string")return p(O,g);if(o.isView(O))return b(O);if(O==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O);if(mt(O,o)||O&&mt(O.buffer,o)||typeof a<"u"&&(mt(O,a)||O&&mt(O.buffer,a)))return v(O,g,y);if(typeof O=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const L=O.valueOf&&O.valueOf();if(L!=null&&L!==O)return u.from(L,g,y);const j=A(O);if(j)return j;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof O[Symbol.toPrimitive]=="function")return u.from(O[Symbol.toPrimitive]("string"),g,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O)}u.from=function(O,g,y){return f(O,g,y)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(O){if(typeof O!="number")throw new TypeError('"size" argument must be of type number');if(O<0)throw new RangeError('The value "'+O+'" is invalid for option "size"')}function h(O,g,y){return d(O),O<=0?l(O):g!==void 0?typeof y=="string"?l(O).fill(g,y):l(O).fill(g):l(O)}u.alloc=function(O,g,y){return h(O,g,y)};function m(O){return d(O),l(O<0?0:R(O)|0)}u.allocUnsafe=function(O){return m(O)},u.allocUnsafeSlow=function(O){return m(O)};function p(O,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const y=S(O,g)|0;let L=l(y);const j=L.write(O,g);return j!==y&&(L=L.slice(0,j)),L}function w(O){const g=O.length<0?0:R(O.length)|0,y=l(g);for(let L=0;L<g;L+=1)y[L]=O[L]&255;return y}function b(O){if(mt(O,s)){const g=new s(O);return v(g.buffer,g.byteOffset,g.byteLength)}return w(O)}function v(O,g,y){if(g<0||O.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(O.byteLength<g+(y||0))throw new RangeError('"length" is outside of buffer bounds');let L;return g===void 0&&y===void 0?L=new s(O):y===void 0?L=new s(O,g):L=new s(O,g,y),Object.setPrototypeOf(L,u.prototype),L}function A(O){if(u.isBuffer(O)){const g=R(O.length)|0,y=l(g);return y.length===0||O.copy(y,0,0,g),y}if(O.length!==void 0)return typeof O.length!="number"||Nt(O.length)?l(0):w(O);if(O.type==="Buffer"&&Array.isArray(O.data))return w(O.data)}function R(O){if(O>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return O|0}function M(O){return+O!=O&&(O=0),u.alloc(+O)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,y){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),mt(y,s)&&(y=u.from(y,y.offset,y.byteLength)),!u.isBuffer(g)||!u.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===y)return 0;let L=g.length,j=y.length;for(let tt=0,it=Math.min(L,j);tt<it;++tt)if(g[tt]!==y[tt]){L=g[tt],j=y[tt];break}return L<j?-1:j<L?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,y){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let L;if(y===void 0)for(y=0,L=0;L<g.length;++L)y+=g[L].length;const j=u.allocUnsafe(y);let tt=0;for(L=0;L<g.length;++L){let it=g[L];if(mt(it,s))tt+it.length>j.length?(u.isBuffer(it)||(it=u.from(it)),it.copy(j,tt)):s.prototype.set.call(j,it,tt);else if(u.isBuffer(it))it.copy(j,tt);else throw new TypeError('"list" argument must be an Array of Buffers');tt+=it.length}return j};function S(O,g){if(u.isBuffer(O))return O.length;if(o.isView(O)||mt(O,o))return O.byteLength;if(typeof O!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof O);const y=O.length,L=arguments.length>2&&arguments[2]===!0;if(!L&&y===0)return 0;let j=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return ot(O).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return gt(O).length;default:if(j)return L?-1:ot(O).length;g=(""+g).toLowerCase(),j=!0}}u.byteLength=S;function I(O,g,y){let L=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,g>>>=0,y<=g))return"";for(O||(O="utf8");;)switch(O){case"hex":return W(this,g,y);case"utf8":case"utf-8":return B(this,g,y);case"ascii":return lt(this,g,y);case"latin1":case"binary":return X(this,g,y);case"base64":return V(this,g,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return kt(this,g,y);default:if(L)throw new TypeError("Unknown encoding: "+O);O=(O+"").toLowerCase(),L=!0}}u.prototype._isBuffer=!0;function P(O,g,y){const L=O[g];O[g]=O[y],O[y]=L}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<g;y+=2)P(this,y,y+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<g;y+=4)P(this,y,y+3),P(this,y+1,y+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<g;y+=8)P(this,y,y+7),P(this,y+1,y+6),P(this,y+2,y+5),P(this,y+3,y+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?B(this,0,g):I.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const y=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,y,L,j,tt){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(y===void 0&&(y=0),L===void 0&&(L=g?g.length:0),j===void 0&&(j=0),tt===void 0&&(tt=this.length),y<0||L>g.length||j<0||tt>this.length)throw new RangeError("out of range index");if(j>=tt&&y>=L)return 0;if(j>=tt)return-1;if(y>=L)return 1;if(y>>>=0,L>>>=0,j>>>=0,tt>>>=0,this===g)return 0;let it=tt-j,Wt=L-y;const Oe=Math.min(it,Wt),we=this.slice(j,tt),Ie=g.slice(y,L);for(let ue=0;ue<Oe;++ue)if(we[ue]!==Ie[ue]){it=we[ue],Wt=Ie[ue];break}return it<Wt?-1:Wt<it?1:0};function C(O,g,y,L,j){if(O.length===0)return-1;if(typeof y=="string"?(L=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,Nt(y)&&(y=j?0:O.length-1),y<0&&(y=O.length+y),y>=O.length){if(j)return-1;y=O.length-1}else if(y<0)if(j)y=0;else return-1;if(typeof g=="string"&&(g=u.from(g,L)),u.isBuffer(g))return g.length===0?-1:D(O,g,y,L,j);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?j?s.prototype.indexOf.call(O,g,y):s.prototype.lastIndexOf.call(O,g,y):D(O,[g],y,L,j);throw new TypeError("val must be string, number or Buffer")}function D(O,g,y,L,j){let tt=1,it=O.length,Wt=g.length;if(L!==void 0&&(L=String(L).toLowerCase(),L==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(O.length<2||g.length<2)return-1;tt=2,it/=2,Wt/=2,y/=2}function Oe(Ie,ue){return tt===1?Ie[ue]:Ie.readUInt16BE(ue*tt)}let we;if(j){let Ie=-1;for(we=y;we<it;we++)if(Oe(O,we)===Oe(g,Ie===-1?0:we-Ie)){if(Ie===-1&&(Ie=we),we-Ie+1===Wt)return Ie*tt}else Ie!==-1&&(we-=we-Ie),Ie=-1}else for(y+Wt>it&&(y=it-Wt),we=y;we>=0;we--){let Ie=!0;for(let ue=0;ue<Wt;ue++)if(Oe(O,we+ue)!==Oe(g,ue)){Ie=!1;break}if(Ie)return we}return-1}u.prototype.includes=function(g,y,L){return this.indexOf(g,y,L)!==-1},u.prototype.indexOf=function(g,y,L){return C(this,g,y,L,!0)},u.prototype.lastIndexOf=function(g,y,L){return C(this,g,y,L,!1)};function G(O,g,y,L){y=Number(y)||0;const j=O.length-y;L?(L=Number(L),L>j&&(L=j)):L=j;const tt=g.length;L>tt/2&&(L=tt/2);let it;for(it=0;it<L;++it){const Wt=parseInt(g.substr(it*2,2),16);if(Nt(Wt))return it;O[y+it]=Wt}return it}function U(O,g,y,L){return Et(ot(g,O.length-y),O,y,L)}function T(O,g,y,L){return Et(ft(g),O,y,L)}function _(O,g,y,L){return Et(gt(g),O,y,L)}function N(O,g,y,L){return Et(Q(g,O.length-y),O,y,L)}u.prototype.write=function(g,y,L,j){if(y===void 0)j="utf8",L=this.length,y=0;else if(L===void 0&&typeof y=="string")j=y,L=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(L)?(L=L>>>0,j===void 0&&(j="utf8")):(j=L,L=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const tt=this.length-y;if((L===void 0||L>tt)&&(L=tt),g.length>0&&(L<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");j||(j="utf8");let it=!1;for(;;)switch(j){case"hex":return G(this,g,y,L);case"utf8":case"utf-8":return U(this,g,y,L);case"ascii":case"latin1":case"binary":return T(this,g,y,L);case"base64":return _(this,g,y,L);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,g,y,L);default:if(it)throw new TypeError("Unknown encoding: "+j);j=(""+j).toLowerCase(),it=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function V(O,g,y){return g===0&&y===O.length?t.fromByteArray(O):t.fromByteArray(O.slice(g,y))}function B(O,g,y){y=Math.min(O.length,y);const L=[];let j=g;for(;j<y;){const tt=O[j];let it=null,Wt=tt>239?4:tt>223?3:tt>191?2:1;if(j+Wt<=y){let Oe,we,Ie,ue;switch(Wt){case 1:tt<128&&(it=tt);break;case 2:Oe=O[j+1],(Oe&192)===128&&(ue=(tt&31)<<6|Oe&63,ue>127&&(it=ue));break;case 3:Oe=O[j+1],we=O[j+2],(Oe&192)===128&&(we&192)===128&&(ue=(tt&15)<<12|(Oe&63)<<6|we&63,ue>2047&&(ue<55296||ue>57343)&&(it=ue));break;case 4:Oe=O[j+1],we=O[j+2],Ie=O[j+3],(Oe&192)===128&&(we&192)===128&&(Ie&192)===128&&(ue=(tt&15)<<18|(Oe&63)<<12|(we&63)<<6|Ie&63,ue>65535&&ue<1114112&&(it=ue))}}it===null?(it=65533,Wt=1):it>65535&&(it-=65536,L.push(it>>>10&1023|55296),it=56320|it&1023),L.push(it),j+=Wt}return Z(L)}const at=4096;function Z(O){const g=O.length;if(g<=at)return String.fromCharCode.apply(String,O);let y="",L=0;for(;L<g;)y+=String.fromCharCode.apply(String,O.slice(L,L+=at));return y}function lt(O,g,y){let L="";y=Math.min(O.length,y);for(let j=g;j<y;++j)L+=String.fromCharCode(O[j]&127);return L}function X(O,g,y){let L="";y=Math.min(O.length,y);for(let j=g;j<y;++j)L+=String.fromCharCode(O[j]);return L}function W(O,g,y){const L=O.length;(!g||g<0)&&(g=0),(!y||y<0||y>L)&&(y=L);let j="";for(let tt=g;tt<y;++tt)j+=he[O[tt]];return j}function kt(O,g,y){const L=O.slice(g,y);let j="";for(let tt=0;tt<L.length-1;tt+=2)j+=String.fromCharCode(L[tt]+L[tt+1]*256);return j}u.prototype.slice=function(g,y){const L=this.length;g=~~g,y=y===void 0?L:~~y,g<0?(g+=L,g<0&&(g=0)):g>L&&(g=L),y<0?(y+=L,y<0&&(y=0)):y>L&&(y=L),y<g&&(y=g);const j=this.subarray(g,y);return Object.setPrototypeOf(j,u.prototype),j};function ct(O,g,y){if(O%1!==0||O<0)throw new RangeError("offset is not uint");if(O+g>y)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,y,L){g=g>>>0,y=y>>>0,L||ct(g,y,this.length);let j=this[g],tt=1,it=0;for(;++it<y&&(tt*=256);)j+=this[g+it]*tt;return j},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,y,L){g=g>>>0,y=y>>>0,L||ct(g,y,this.length);let j=this[g+--y],tt=1;for(;y>0&&(tt*=256);)j+=this[g+--y]*tt;return j},u.prototype.readUint8=u.prototype.readUInt8=function(g,y){return g=g>>>0,y||ct(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,y){return g=g>>>0,y||ct(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,y){return g=g>>>0,y||ct(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,y){return g=g>>>0,y||ct(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,y){return g=g>>>0,y||ct(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=Dt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],L=this[g+7];(y===void 0||L===void 0)&&$(g,this.length-8);const j=y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,tt=this[++g]+this[++g]*2**8+this[++g]*2**16+L*2**24;return BigInt(j)+(BigInt(tt)<<BigInt(32))}),u.prototype.readBigUInt64BE=Dt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],L=this[g+7];(y===void 0||L===void 0)&&$(g,this.length-8);const j=y*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],tt=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+L;return(BigInt(j)<<BigInt(32))+BigInt(tt)}),u.prototype.readIntLE=function(g,y,L){g=g>>>0,y=y>>>0,L||ct(g,y,this.length);let j=this[g],tt=1,it=0;for(;++it<y&&(tt*=256);)j+=this[g+it]*tt;return tt*=128,j>=tt&&(j-=Math.pow(2,8*y)),j},u.prototype.readIntBE=function(g,y,L){g=g>>>0,y=y>>>0,L||ct(g,y,this.length);let j=y,tt=1,it=this[g+--j];for(;j>0&&(tt*=256);)it+=this[g+--j]*tt;return tt*=128,it>=tt&&(it-=Math.pow(2,8*y)),it},u.prototype.readInt8=function(g,y){return g=g>>>0,y||ct(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,y){g=g>>>0,y||ct(g,2,this.length);const L=this[g]|this[g+1]<<8;return L&32768?L|4294901760:L},u.prototype.readInt16BE=function(g,y){g=g>>>0,y||ct(g,2,this.length);const L=this[g+1]|this[g]<<8;return L&32768?L|4294901760:L},u.prototype.readInt32LE=function(g,y){return g=g>>>0,y||ct(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,y){return g=g>>>0,y||ct(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=Dt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],L=this[g+7];(y===void 0||L===void 0)&&$(g,this.length-8);const j=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(L<<24);return(BigInt(j)<<BigInt(32))+BigInt(y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=Dt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],L=this[g+7];(y===void 0||L===void 0)&&$(g,this.length-8);const j=(y<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(j)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+L)}),u.prototype.readFloatLE=function(g,y){return g=g>>>0,y||ct(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,y){return g=g>>>0,y||ct(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,y){return g=g>>>0,y||ct(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,y){return g=g>>>0,y||ct(g,8,this.length),n.read(this,g,!1,52,8)};function ht(O,g,y,L,j,tt){if(!u.isBuffer(O))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>j||g<tt)throw new RangeError('"value" argument is out of bounds');if(y+L>O.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,y,L,j){if(g=+g,y=y>>>0,L=L>>>0,!j){const Wt=Math.pow(2,8*L)-1;ht(this,g,y,L,Wt,0)}let tt=1,it=0;for(this[y]=g&255;++it<L&&(tt*=256);)this[y+it]=g/tt&255;return y+L},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,y,L,j){if(g=+g,y=y>>>0,L=L>>>0,!j){const Wt=Math.pow(2,8*L)-1;ht(this,g,y,L,Wt,0)}let tt=L-1,it=1;for(this[y+tt]=g&255;--tt>=0&&(it*=256);)this[y+tt]=g/it&255;return y+L},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,y,L){return g=+g,y=y>>>0,L||ht(this,g,y,1,255,0),this[y]=g&255,y+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,y,L){return g=+g,y=y>>>0,L||ht(this,g,y,2,65535,0),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,y,L){return g=+g,y=y>>>0,L||ht(this,g,y,2,65535,0),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,y,L){return g=+g,y=y>>>0,L||ht(this,g,y,4,4294967295,0),this[y+3]=g>>>24,this[y+2]=g>>>16,this[y+1]=g>>>8,this[y]=g&255,y+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,y,L){return g=+g,y=y>>>0,L||ht(this,g,y,4,4294967295,0),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4};function zt(O,g,y,L,j){st(g,L,j,O,y,7);let tt=Number(g&BigInt(4294967295));O[y++]=tt,tt=tt>>8,O[y++]=tt,tt=tt>>8,O[y++]=tt,tt=tt>>8,O[y++]=tt;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[y++]=it,it=it>>8,O[y++]=it,it=it>>8,O[y++]=it,it=it>>8,O[y++]=it,y}function oe(O,g,y,L,j){st(g,L,j,O,y,7);let tt=Number(g&BigInt(4294967295));O[y+7]=tt,tt=tt>>8,O[y+6]=tt,tt=tt>>8,O[y+5]=tt,tt=tt>>8,O[y+4]=tt;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[y+3]=it,it=it>>8,O[y+2]=it,it=it>>8,O[y+1]=it,it=it>>8,O[y]=it,y+8}u.prototype.writeBigUInt64LE=Dt(function(g,y=0){return zt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Dt(function(g,y=0){return oe(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,y,L,j){if(g=+g,y=y>>>0,!j){const Oe=Math.pow(2,8*L-1);ht(this,g,y,L,Oe-1,-Oe)}let tt=0,it=1,Wt=0;for(this[y]=g&255;++tt<L&&(it*=256);)g<0&&Wt===0&&this[y+tt-1]!==0&&(Wt=1),this[y+tt]=(g/it>>0)-Wt&255;return y+L},u.prototype.writeIntBE=function(g,y,L,j){if(g=+g,y=y>>>0,!j){const Oe=Math.pow(2,8*L-1);ht(this,g,y,L,Oe-1,-Oe)}let tt=L-1,it=1,Wt=0;for(this[y+tt]=g&255;--tt>=0&&(it*=256);)g<0&&Wt===0&&this[y+tt+1]!==0&&(Wt=1),this[y+tt]=(g/it>>0)-Wt&255;return y+L},u.prototype.writeInt8=function(g,y,L){return g=+g,y=y>>>0,L||ht(this,g,y,1,127,-128),g<0&&(g=255+g+1),this[y]=g&255,y+1},u.prototype.writeInt16LE=function(g,y,L){return g=+g,y=y>>>0,L||ht(this,g,y,2,32767,-32768),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeInt16BE=function(g,y,L){return g=+g,y=y>>>0,L||ht(this,g,y,2,32767,-32768),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeInt32LE=function(g,y,L){return g=+g,y=y>>>0,L||ht(this,g,y,4,2147483647,-2147483648),this[y]=g&255,this[y+1]=g>>>8,this[y+2]=g>>>16,this[y+3]=g>>>24,y+4},u.prototype.writeInt32BE=function(g,y,L){return g=+g,y=y>>>0,L||ht(this,g,y,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4},u.prototype.writeBigInt64LE=Dt(function(g,y=0){return zt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Dt(function(g,y=0){return oe(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function $t(O,g,y,L,j,tt){if(y+L>O.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function Pt(O,g,y,L,j){return g=+g,y=y>>>0,j||$t(O,g,y,4),n.write(O,g,y,L,23,4),y+4}u.prototype.writeFloatLE=function(g,y,L){return Pt(this,g,y,!0,L)},u.prototype.writeFloatBE=function(g,y,L){return Pt(this,g,y,!1,L)};function ce(O,g,y,L,j){return g=+g,y=y>>>0,j||$t(O,g,y,8),n.write(O,g,y,L,52,8),y+8}u.prototype.writeDoubleLE=function(g,y,L){return ce(this,g,y,!0,L)},u.prototype.writeDoubleBE=function(g,y,L){return ce(this,g,y,!1,L)},u.prototype.copy=function(g,y,L,j){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(L||(L=0),!j&&j!==0&&(j=this.length),y>=g.length&&(y=g.length),y||(y=0),j>0&&j<L&&(j=L),j===L||g.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(L<0||L>=this.length)throw new RangeError("Index out of range");if(j<0)throw new RangeError("sourceEnd out of bounds");j>this.length&&(j=this.length),g.length-y<j-L&&(j=g.length-y+L);const tt=j-L;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,L,j):s.prototype.set.call(g,this.subarray(L,j),y),tt},u.prototype.fill=function(g,y,L,j){if(typeof g=="string"){if(typeof y=="string"?(j=y,y=0,L=this.length):typeof L=="string"&&(j=L,L=this.length),j!==void 0&&typeof j!="string")throw new TypeError("encoding must be a string");if(typeof j=="string"&&!u.isEncoding(j))throw new TypeError("Unknown encoding: "+j);if(g.length===1){const it=g.charCodeAt(0);(j==="utf8"&&it<128||j==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(y<0||this.length<y||this.length<L)throw new RangeError("Out of range index");if(L<=y)return this;y=y>>>0,L=L===void 0?this.length:L>>>0,g||(g=0);let tt;if(typeof g=="number")for(tt=y;tt<L;++tt)this[tt]=g;else{const it=u.isBuffer(g)?g:u.from(g,j),Wt=it.length;if(Wt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(tt=0;tt<L-y;++tt)this[tt+y]=it[tt%Wt]}return this};const Xt={};function Se(O,g,y){Xt[O]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${O}]`,this.stack,delete this.name}get code(){return O}set code(j){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:j,writable:!0})}toString(){return`${this.name} [${O}]: ${this.message}`}}}Se("ERR_BUFFER_OUT_OF_BOUNDS",function(O){return O?`${O} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Se("ERR_INVALID_ARG_TYPE",function(O,g){return`The "${O}" argument must be of type number. Received type ${typeof g}`},TypeError),Se("ERR_OUT_OF_RANGE",function(O,g,y){let L=`The value of "${O}" is out of range.`,j=y;return Number.isInteger(y)&&Math.abs(y)>2**32?j=Be(String(y)):typeof y=="bigint"&&(j=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&(j=Be(j)),j+="n"),L+=` It must be ${g}. Received ${j}`,L},RangeError);function Be(O){let g="",y=O.length;const L=O[0]==="-"?1:0;for(;y>=L+4;y-=3)g=`_${O.slice(y-3,y)}${g}`;return`${O.slice(0,y)}${g}`}function k(O,g,y){nt(g,"offset"),(O[g]===void 0||O[g+y]===void 0)&&$(g,O.length-(y+1))}function st(O,g,y,L,j,tt){if(O>y||O<g){const it=typeof g=="bigint"?"n":"";let Wt;throw g===0||g===BigInt(0)?Wt=`>= 0${it} and < 2${it} ** ${(tt+1)*8}${it}`:Wt=`>= -(2${it} ** ${(tt+1)*8-1}${it}) and < 2 ** ${(tt+1)*8-1}${it}`,new Xt.ERR_OUT_OF_RANGE("value",Wt,O)}k(L,j,tt)}function nt(O,g){if(typeof O!="number")throw new Xt.ERR_INVALID_ARG_TYPE(g,"number",O)}function $(O,g,y){throw Math.floor(O)!==O?(nt(O,y),new Xt.ERR_OUT_OF_RANGE("offset","an integer",O)):g<0?new Xt.ERR_BUFFER_OUT_OF_BOUNDS:new Xt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,O)}const F=/[^+/0-9A-Za-z-_]/g;function Y(O){if(O=O.split("=")[0],O=O.trim().replace(F,""),O.length<2)return"";for(;O.length%4!==0;)O=O+"=";return O}function ot(O,g){g=g||1/0;let y;const L=O.length;let j=null;const tt=[];for(let it=0;it<L;++it){if(y=O.charCodeAt(it),y>55295&&y<57344){if(!j){if(y>56319){(g-=3)>-1&&tt.push(239,191,189);continue}else if(it+1===L){(g-=3)>-1&&tt.push(239,191,189);continue}j=y;continue}if(y<56320){(g-=3)>-1&&tt.push(239,191,189),j=y;continue}y=(j-55296<<10|y-56320)+65536}else j&&(g-=3)>-1&&tt.push(239,191,189);if(j=null,y<128){if((g-=1)<0)break;tt.push(y)}else if(y<2048){if((g-=2)<0)break;tt.push(y>>6|192,y&63|128)}else if(y<65536){if((g-=3)<0)break;tt.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((g-=4)<0)break;tt.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return tt}function ft(O){const g=[];for(let y=0;y<O.length;++y)g.push(O.charCodeAt(y)&255);return g}function Q(O,g){let y,L,j;const tt=[];for(let it=0;it<O.length&&!((g-=2)<0);++it)y=O.charCodeAt(it),L=y>>8,j=y%256,tt.push(j),tt.push(L);return tt}function gt(O){return t.toByteArray(Y(O))}function Et(O,g,y,L){let j;for(j=0;j<L&&!(j+y>=g.length||j>=O.length);++j)g[j+y]=O[j];return j}function mt(O,g){return O instanceof g||O!=null&&O.constructor!=null&&O.constructor.name!=null&&O.constructor.name===g.name}function Nt(O){return O!==O}const he=function(){const O="0123456789abcdef",g=new Array(256);for(let y=0;y<16;++y){const L=y*16;for(let j=0;j<16;++j)g[L+j]=O[y]+O[j]}return g}();function Dt(O){return typeof BigInt>"u"?Yn:O}function Yn(){throw new Error("BigInt not supported")}})(j0);const un=j0.Buffer,W0=e=>e===void 0?null:e;class Ex{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let G0=new Ex,xx=!0;try{typeof localStorage<"u"&&localStorage&&(G0=localStorage,xx=!1)}catch{}const kx=G0,vx=Object.assign,Tx=Object.keys,Ax=(e,t)=>{for(const n in e)t(e[n],n)},K0=e=>Tx(e).length,Rx=e=>{for(const t in e)return!1;return!0},Sx=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Ox=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Ix=(e,t)=>e===t||K0(e)===K0(t)&&Sx(e,(n,r)=>(n!==void 0||Ox(t,r))&&t[r]===n),Nx=Object.freeze,H0=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&H0(e[t])}return Nx(e)},Wu=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Wu(e,t,n+1)}},Cx=e=>e,Lx=(e,t)=>t.includes(e);var Y0={};const Do=typeof Er<"u"&&Er.release&&/node|io\.js/.test(Er.release.name)&&Object.prototype.toString.call(typeof Er<"u"?Er:0)==="[object process]";let Kr;const Mx=()=>{if(Kr===void 0)if(Do){Kr=xr();const e=Er.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Kr.set(t,""),t=r):t!==null&&(Kr.set(t,r),t=null)}t!==null&&Kr.set(t,"")}else typeof location=="object"?(Kr=xr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Kr.set(`--${N0(t,"-")}`,n),Kr.set(`-${N0(t,"-")}`,n)}})):Kr=xr();return Kr},Gu=e=>Mx().has(e),ac=e=>W0(Do?Y0[e.toUpperCase().replaceAll("-","_")]:kx.getItem(e)),V0=e=>Gu("--"+e)||ac(e)!==null;V0("production");const Ux=Do&&Lx(Y0.FORCE_COLOR,["true","1","2"])||!Gu("--no-colors")&&!V0("no-color")&&(!Do||Er.stdout.isTTY)&&(!Do||Gu("--color")||ac("COLORTERM")!==null||(ac("TERM")||"").includes("color")),Fx=e=>new Uint8Array(e),Px=e=>{const t=Fx(e.byteLength);return t.set(e),t};class Bx{constructor(t,n){this.left=t,this.right=n}}const mi=(e,t)=>new Bx(e,t);typeof DOMParser<"u"&&new DOMParser;const $x=e=>PE(e,(t,n)=>`${n}:${t};`).join(""),gi=Symbol,X0=gi(),q0=gi(),Dx=gi(),jx=gi(),zx=gi(),J0=gi(),Wx=gi(),Ku=gi(),Gx=gi(),Kx=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},Hx={[X0]:mi("font-weight","bold"),[q0]:mi("font-weight","normal"),[Dx]:mi("color","blue"),[zx]:mi("color","green"),[jx]:mi("color","grey"),[J0]:mi("color","red"),[Wx]:mi("color","purple"),[Ku]:mi("color","orange"),[Gx]:mi("color","black")},Z0=Ux?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=xr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=Hx[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=$x(r);s>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:Kx,Yx=(...e)=>{console.log(...Z0(e)),Q0.forEach(t=>t.print(e))},Vx=(...e)=>{console.warn(...Z0(e)),e.unshift(Ku),Q0.forEach(t=>t.print(e))},Q0=Ds(),tp=e=>({[Symbol.iterator](){return this},next:e}),Xx=(e,t)=>tp(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Hu=(e,t)=>tp(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Yu{constructor(t,n){this.clock=t,this.len=n}}class jo{constructor(){this.clients=new Map}}const ep=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];_p(e,s,a.clock,a.len,n)}}),qx=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Mi((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},np=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&qx(n,t.clock)!==null},Vu=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=as(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},Jx=e=>{const t=new jo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)$E(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Vu(t),t},cc=(e,t,n,r)=>{Li(e.clients,t,()=>[]).push(new Yu(n,r))},Zx=()=>new jo,Qx=e=>{const t=Zx();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Yu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Hs=(e,t)=>{ie(e.restEncoder,t.clients.size),os(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),ie(e.restEncoder,n);const i=r.length;ie(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Xu=e=>{const t=new jo,n=Yt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Yt(e.restDecoder),s=Yt(e.restDecoder);if(s>0){const o=Li(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Yu(e.readDsClock(),e.readDsLen()))}}return t},rp=(e,t,n)=>{const r=new jo,i=Yt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Yt(e.restDecoder),a=Yt(e.restDecoder),c=n.clients.get(o)||[],l=sn(n,o);for(let u=0;u<a;u++){const f=e.readDsClock(),d=f+e.readDsLen();if(f<l){l<d&&cc(r,o,l,d-l);let h=Hr(c,f),m=c[h];for(!m.deleted&&m.id.clock<f&&(c.splice(h+1,0,xc(t,m,f-m.id.clock)),h++);h<c.length&&(m=c[h++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(h,0,xc(t,m,d-m.id.clock)),m.delete(t))}else cc(r,o,f,d-f)}}if(r.clients.size>0){const s=new ls;return ie(s.restEncoder,0),Hs(s,r),s.toUint8Array()}return null},ip=$0;class Ys extends jE{constructor({guid:t=fx(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=ip(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new pp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=D0(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>D0(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&de(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(os(this.subdocs).map(t=>t.guid))}transact(t,n=null){return de(this,t,n)}get(t,n=hn){const r=Li(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==hn&&i!==n)if(i===hn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Js)}getText(t=""){return this.get(t,_i)}getMap(t=""){return this.get(t,Zs)}getXmlElement(t=""){return this.get(t,to)}getXmlFragment(t=""){return this.get(t,us)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,os(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Ys({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,de(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class sp{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Yt(this.restDecoder)}readDsLen(){return Yt(this.restDecoder)}}class op extends sp{readLeftID(){return Jt(Yt(this.restDecoder),Yt(this.restDecoder))}readRightID(){return Jt(Yt(this.restDecoder),Yt(this.restDecoder))}readClient(){return Yt(this.restDecoder)}readInfo(){return Ws(this.restDecoder)}readString(){return Gs(this.restDecoder)}readParentInfo(){return Yt(this.restDecoder)===1}readTypeRef(){return Yt(this.restDecoder)}readLen(){return Yt(this.restDecoder)}readAny(){return $o(this.restDecoder)}readBuf(){return Px(Zn(this.restDecoder))}readJSON(){return JSON.parse(Gs(this.restDecoder))}readKey(){return Gs(this.restDecoder)}}class tk{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Yt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Yt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Vs extends tk{constructor(t){super(t),this.keys=[],Yt(t),this.keyClockDecoder=new Du(Zn(t)),this.clientDecoder=new sc(Zn(t)),this.leftClockDecoder=new Du(Zn(t)),this.rightClockDecoder=new Du(Zn(t)),this.infoDecoder=new B0(Zn(t),Ws),this.stringDecoder=new lx(Zn(t)),this.parentInfoDecoder=new B0(Zn(t),Ws),this.typeRefDecoder=new sc(Zn(t)),this.lenDecoder=new sc(Zn(t))}readLeftID(){return new Xs(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Xs(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return $o(this.restDecoder)}readBuf(){return Zn(this.restDecoder)}readJSON(){return $o(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class ek{constructor(){this.restEncoder=ec()}toUint8Array(){return jr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){ie(this.restEncoder,t)}writeDsLen(t){ie(this.restEncoder,t)}}class zo extends ek{writeLeftID(t){ie(this.restEncoder,t.client),ie(this.restEncoder,t.clock)}writeRightID(t){ie(this.restEncoder,t.client),ie(this.restEncoder,t.clock)}writeClient(t){ie(this.restEncoder,t)}writeInfo(t){Lu(this.restEncoder,t)}writeString(t){js(this.restEncoder,t)}writeParentInfo(t){ie(this.restEncoder,t?1:0)}writeTypeRef(t){ie(this.restEncoder,t)}writeLen(t){ie(this.restEncoder,t)}writeAny(t){Bo(this.restEncoder,t)}writeBuf(t){Jn(this.restEncoder,t)}writeJSON(t){js(this.restEncoder,JSON.stringify(t))}writeKey(t){js(this.restEncoder,t)}}class nk{constructor(){this.restEncoder=ec(),this.dsCurrVal=0}toUint8Array(){return jr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,ie(this.restEncoder,n)}writeDsLen(t){t===0&&Wr(),ie(this.restEncoder,t-1),this.dsCurrVal+=t}}class ls extends nk{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Pu,this.clientEncoder=new rc,this.leftClockEncoder=new Pu,this.rightClockEncoder=new Pu,this.infoEncoder=new L0(Lu),this.stringEncoder=new sx,this.parentInfoEncoder=new L0(Lu),this.typeRefEncoder=new rc,this.lenEncoder=new rc}toUint8Array(){const t=ec();return ie(t,0),Jn(t,this.keyClockEncoder.toUint8Array()),Jn(t,this.clientEncoder.toUint8Array()),Jn(t,this.leftClockEncoder.toUint8Array()),Jn(t,this.rightClockEncoder.toUint8Array()),Jn(t,jr(this.infoEncoder)),Jn(t,this.stringEncoder.toUint8Array()),Jn(t,jr(this.parentInfoEncoder)),Jn(t,this.typeRefEncoder.toUint8Array()),Jn(t,this.lenEncoder.toUint8Array()),nc(t,jr(this.restEncoder)),jr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Bo(this.restEncoder,t)}writeBuf(t){Jn(this.restEncoder,t)}writeJSON(t){Bo(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const rk=(e,t,n,r)=>{r=as(r,t[0].id.clock);const i=Hr(t,r);ie(e.restEncoder,t.length-i),e.writeClient(n),ie(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},qu=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{sn(t,s)>i&&r.set(s,i)}),Zu(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),ie(e.restEncoder,r.size),os(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{rk(e,t.clients.get(i),i,s)})},ik=(e,t)=>{const n=xr(),r=Yt(e.restDecoder);for(let i=0;i<r;i++){const s=Yt(e.restDecoder),o=new Array(s),a=e.readClient();let c=Yt(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(tc&u){case 0:{const f=e.readLen();o[l]=new ar(Jt(a,c),f),c+=f;break}case 10:{const f=Yt(e.restDecoder);o[l]=new cr(Jt(a,c),f),c+=f;break}default:{const f=(u&(pi|qn))===0,d=new Xe(Jt(a,c),null,(u&qn)===qn?e.readLeftID():null,null,(u&pi)===pi?e.readRightID():null,f?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,f&&(u&Mo)===Mo?e.readString():null,zp(e,u));o[l]=d,c+=d.length}}}}return n},sk=(e,t,n)=>{const r=[];let i=os(n.keys()).sort((h,m)=>h-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new pp,c=new Map,l=(h,m)=>{const p=c.get(h);(p==null||p>m)&&c.set(h,m)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const m=h.id.client,p=n.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),n.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[h]),i=i.filter(w=>w!==m)}r.length=0};for(;;){if(u.constructor!==cr){const m=Li(f,u.id.client,()=>sn(t,u.id.client))-u.id.clock;if(m<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const p=u.getMissing(e,t);if(p!==null){r.push(u);const w=n.get(p)||{refs:[],i:0};if(w.refs.length===w.i)l(p,sn(t,p)),d();else{u=w.refs[w.i++];continue}}else(m===0||m<u.length)&&(u.integrate(e,m),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new ls;return qu(h,a,new Map),ie(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},ok=(e,t)=>qu(e,t.doc.store,t.beforeState),ak=(e,t,n,r=new Vs(e))=>de(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=ik(r,o),l=sk(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<sn(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const m=u.missing.get(d);(m==null||m>h)&&u.missing.set(d,h)}u.update=hc([u.update,l.update])}}else a.pendingStructs=l;const f=rp(r,i,a);if(a.pendingDs){const d=new Vs(zs(a.pendingDs));Yt(d.restDecoder);const h=rp(d,i,a);f&&h?a.pendingDs=hc([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,ap(i.doc,d)}},n,!1),ap=(e,t,n,r=Vs)=>{const i=zs(t);ak(i,e,n,new r(i))},cp=(e,t,n)=>ap(e,t,n,op),ck=(e,t,n=new Map)=>{qu(e,t.store,n),Hs(e,Qx(t.store))},lk=(e,t=new Uint8Array([0]),n=new ls)=>{const r=lp(t);ck(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Ek(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===zo)return bk(i.map((s,o)=>o===0?s:kk(s)));if(n.constructor===ls)return hc(i)}return i[0]},uk=(e,t)=>lk(e,t,new zo),hk=e=>{const t=new Map,n=Yt(e.restDecoder);for(let r=0;r<n;r++){const i=Yt(e.restDecoder),s=Yt(e.restDecoder);t.set(i,s)}return t},lp=e=>hk(new sp(zs(e)));class fk{constructor(){this.l=[]}}const up=()=>new fk,hp=(e,t)=>e.l.push(t),fp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},dp=(e,t,n)=>Wu(e.l,[t,n]);class Xs{constructor(t,n){this.client=t,this.clock=n}}const lc=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Jt=(e,t)=>new Xs(e,t),dk=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Wr()},qs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!np(t.ds,e.id),Ju=(e,t)=>{const n=Li(e.meta,Ju,Ds),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<sn(r,s)&&Fi(e,Jt(s,i))}),ep(e,t.ds,i=>{}),n.add(t))};class pp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Zu=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},sn=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},mp=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Wr()}n.push(t)},Hr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Mi(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Mi((n+r)/2)}throw Wr()},Qu=(e,t)=>{const n=e.clients.get(t.client);return n[Hr(n,t.clock)]},th=(e,t,n)=>{const r=Hr(t,n),i=t[r];return i.id.clock<n&&i instanceof Xe?(t.splice(r+1,0,xc(e,i,n-i.id.clock)),r+1):r},Fi=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[th(e,n,t.clock)]},gp=(e,t,n)=>{const r=t.clients.get(n.client),i=Hr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==ar&&r.splice(i+1,0,xc(e,s,n.clock-s.id.clock+1)),s},pk=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Hr(r,t.id.clock)]=n},_p=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=th(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&th(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class mk{constructor(t,n,r){this.doc=t,this.deleteSet=new jo,this.beforeState=Zu(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const yp=(e,t)=>t.deleteSet.clients.size===0&&!BE(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Vu(t.deleteSet),ok(e,t),Hs(e,t.deleteSet),!0),bp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Li(e.changed,t,Ds).add(n)},uc=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Xe&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},gk=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Hr(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Xe&&f.deleted&&!f.keep&&n(f)&&f.gc(t,!1)}}}},_k=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=A0(i.length-1,1+Hr(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+uc(i,c)}})},wp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Vu(s),n.afterState=Zu(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),dp(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Wu(a,[]),n._needFormattingCleanup&&Pk(n)}finally{r.gc&&gk(s,i,r.gcFilter),_k(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),m=as(Hr(h,d),1);for(let p=h.length-1;p>=m;)p-=1+uc(h,p)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),m=Hr(h,d);m+1<h.length&&uc(h,m+1)>1||m>0&&uc(h,m)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Yx(Ku,X0,"[yjs] ",q0,J0,"Changed the client-id because another client seems to be using it."),r.clientID=ip()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new zo;yp(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new ls;yp(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):wp(e,t+1)}}},de=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new mk(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&wp(i,0)}}return o};function*yk(e){const t=Yt(e.restDecoder);for(let n=0;n<t;n++){const r=Yt(e.restDecoder),i=e.readClient();let s=Yt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Yt(e.restDecoder);yield new cr(Jt(i,s),c),s+=c}else if(tc&a){const c=(a&(pi|qn))===0,l=new Xe(Jt(i,s),null,(a&qn)===qn?e.readLeftID():null,null,(a&pi)===pi?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&Mo)===Mo?e.readString():null,zp(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new ar(Jt(i,s),c),s+=c}}}}class eh{constructor(t,n){this.gen=yk(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===cr);return this.curr}}class nh{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const bk=e=>hc(e,op,zo),wk=(e,t)=>{if(e.constructor===ar){const{client:n,clock:r}=e.id;return new ar(Jt(n,r+t),e.length-t)}else if(e.constructor===cr){const{client:n,clock:r}=e.id;return new cr(Jt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new Xe(Jt(r,i+t),null,Jt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},hc=(e,t=Vs,n=ls)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(zs(u)));let i=r.map(u=>new eh(u,!0)),s=null;const o=new n,a=new nh(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const m=d.curr.id.clock-h.curr.id.clock;return m===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===cr?1:-1:m}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===cr)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Pi(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new cr(Jt(f,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===cr?s.struct.length-=m:d=wk(d,m)),s.struct.mergeWith(d)||(Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==cr;d=u.next())Pi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Pi(a,s.struct,s.offset),s=null),rh(a);const c=r.map(u=>Xu(u)),l=Jx(c);return Hs(o,l),o.toUint8Array()},Ek=(e,t,n=Vs,r=ls)=>{const i=lp(t),s=new r,o=new nh(s),a=new n(zs(e)),c=new eh(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===cr){c.next();continue}if(u.id.clock+u.length>d)for(Pi(o,u,as(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Pi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}rh(o);const l=Xu(a);return Hs(s,l),s.toUint8Array()},Ep=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:jr(e.encoder.restEncoder)}),e.encoder.restEncoder=ec(),e.written=0)},Pi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Ep(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),ie(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},rh=e=>{Ep(e);const t=e.encoder.restEncoder;ie(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];ie(t,r.written),nc(t,r.restEncoder)}},xk=(e,t,n,r)=>{const i=new n(zs(e)),s=new eh(i,!1),o=new r,a=new nh(o);for(let l=s.curr;l!==null;l=s.next())Pi(a,t(l),0);rh(a);const c=Xu(i);return Hs(o,c),o.toUint8Array()},kk=e=>xk(e,Cx,Vs,zo),xp="You must not compute changes after the event-handler fired.";class fc{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=vk(this.currentTarget,this.target))}deletes(t){return np(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ui(xp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Ou(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Ou(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Ou(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ui(xp);const n=this.target,r=Ds(),i=Ds(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const vk=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},gn=()=>{Vx("Invalid access: Add Yjs type to a document before reading data.")},kp=80;let ih=0;class Tk{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=ih++}}const Ak=e=>{e.timestamp=ih++},vp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=ih++},Rk=(e,t,n)=>{if(e.length>=kp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return vp(r,t,n),r}else{const r=new Tk(t,n);return e.push(r),r}},dc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Qa(t-s.index)<Qa(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Ak(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Qa(n.index-i)<r.parent.length/kp?(vp(n,r,i),n):Rk(e._searchMarker,r,i)},Wo=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=as(t,i.index+n))}},pc=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Li(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;dp(r._eH,n,t)};class hn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=up(),this._dEH=up(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw zr()}clone(){throw zr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){hp(this._eH,t)}observeDeep(t){hp(this._dEH,t)}unobserve(t){fp(this._eH,t)}unobserveDeep(t){fp(this._dEH,t)}toJSON(){}}const Tp=(e,t,n)=>{e.doc??gn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},Ap=e=>{e.doc??gn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Go=(e,t)=>{let n=0,r=e._start;for(e.doc??gn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},Rp=(e,t)=>{const n=[];return Go(e,(r,i)=>{n.push(t(r,i,e))}),n},Sk=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Sp=(e,t)=>{e.doc??gn();const n=dc(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},mc=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Xe(Jt(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new fs(l)),i.integrate(e,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Xe(Jt(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Ko(new Uint8Array(f))),i.integrate(e,0);break;case Ys:i=new Xe(Jt(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Yo(f)),i.integrate(e,0);break;default:if(f instanceof hn)i=new Xe(Jt(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new yi(f)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Op=()=>Ui("Length exceeded!"),Ip=(e,t,n,r)=>{if(n>t._length)throw Op();if(n===0)return t._searchMarker&&Wo(t._searchMarker,n,r.length),mc(e,t,null,r);const i=n,s=dc(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Fi(e,Jt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Wo(t._searchMarker,i,r.length),mc(e,t,o,r)},Ok=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return mc(e,t,i,n)},Np=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=dc(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Fi(e,Jt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Fi(e,Jt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Op();t._searchMarker&&Wo(t._searchMarker,i,-s+r)},gc=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},sh=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new fs([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new fs([r]);break;case Uint8Array:a=new Ko(r);break;case Ys:a=new Yo(r);break;default:if(r instanceof hn)a=new yi(r);else throw new Error("Unexpected content type")}new Xe(Jt(o,sn(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},oh=(e,t)=>{e.doc??gn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Cp=e=>{const t={};return e.doc??gn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Lp=(e,t)=>{e.doc??gn();const n=e._map.get(t);return n!==void 0&&!n.deleted},Ik=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&qs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},_c=e=>(e.doc??gn(),Xx(e._map.entries(),t=>!t[1].deleted));class Nk extends fc{}class Js extends hn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Js;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Js}clone(){const t=new Js;return t.insert(0,this.toArray().map(n=>n instanceof hn?n.clone():n)),t}get length(){return this.doc??gn(),this._length}_callObserver(t,n){super._callObserver(t,n),pc(this,t,new Nk(this,t))}insert(t,n){this.doc!==null?de(this.doc,r=>{Ip(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?de(this.doc,n=>{Ok(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?de(this.doc,r=>{Np(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Sp(this,t)}toArray(){return Ap(this)}slice(t=0,n=this.length){return Tp(this,t,n)}toJSON(){return this.map(t=>t instanceof hn?t.toJSON():t)}map(t){return Rp(this,t)}forEach(t){Go(this,t)}[Symbol.iterator](){return Sk(this)}_write(t){t.writeTypeRef(nv)}}const Ck=e=>new Js;class Lk extends fc{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Zs extends hn{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Zs}clone(){const t=new Zs;return this.forEach((n,r)=>{t.set(r,n instanceof hn?n.clone():n)}),t}_callObserver(t,n){pc(this,t,new Lk(this,t,n))}toJSON(){this.doc??gn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof hn?i.toJSON():i}}),t}get size(){return[..._c(this)].length}keys(){return Hu(_c(this),t=>t[0])}values(){return Hu(_c(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Hu(_c(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??gn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?de(this.doc,n=>{gc(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?de(this.doc,r=>{sh(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return oh(this,t)}has(t){return Lp(this,t)}clear(){this.doc!==null?de(this.doc,t=>{this.forEach(function(n,r,i){gc(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(rv)}}const Mk=e=>new Zs,Bi=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Ix(e,t);class ah{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Wr(),this.right.content.constructor){case Ve:this.right.deleted||Qs(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Mp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Ve:t.right.deleted||Qs(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Fi(e,Jt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},yc=(e,t,n,r)=>{const i=new Map,s=r?dc(t,n):null;if(s){const o=new ah(s.p.left,s.p,s.index,i);return Mp(e,o,n-s.index)}else{const o=new ah(null,t._start,0,i);return Mp(e,o,n)}},Up=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ve&&Bi(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Xe(Jt(s,sn(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new Ve(a,o));u.integrate(e,0),n.right=u,n.forward()})},Qs=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Fp=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Ve&&Bi(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Pp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Bi(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Xe(Jt(s,sn(i.store,s)),u,u&&u.lastId,f,f&&f.id,t,null,new Ve(a,c)),n.right.integrate(e,0),n.forward()}}return o},ch=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=e.doc,o=s.clientID;Fp(n,i);const a=Pp(e,t,n,i),c=r.constructor===String?new Yr(r):r instanceof hn?new yi(r):new hs(r);let{left:l,right:u,index:f}=n;t._searchMarker&&Wo(t._searchMarker,n.index,c.getLength()),u=new Xe(Jt(o,sn(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=f,n.forward(),Up(e,t,n,a)},Bp=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;Fp(n,i);const a=Pp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Ve));){if(!n.right.deleted)switch(n.right.content.constructor){case Ve:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(Bi(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Fi(e,Jt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Xe(Jt(o,sn(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Yr(c)),n.right.integrate(e,0),n.forward()}Up(e,t,n,a)},$p=(e,t,n,r,i)=>{let s=t;const o=xr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Ve){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case Ve:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(t.delete(e),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&Qs(i,l);break}}}t=t.right}return a},Uk=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Ve){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Fk=e=>{let t=0;return de(e.doc,n=>{let r=e._start,i=e._start,s=xr();const o=Su(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ve:Qs(o,i.content);break;default:t+=$p(n,r,i,s,o),s=Su(o),r=i;break}i=i.right}}),t},Pk=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&_p(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Ve&&o.constructor!==ar&&t.add(o.parent)})}de(n,r=>{ep(e,e.deleteSet,i=>{if(i instanceof ar||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===Ve?t.add(s):Uk(r,i)});for(const i of t)Fk(i)})},Dp=(e,t,n)=>{const r=n,i=Su(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case yi:case hs:case Yr:n<t.right.length&&Fi(e,Jt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&$p(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Wo(o._searchMarker,t.index,-r+n),t};class Bk extends fc{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];de(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((m,p)=>{m!==null&&(h.attributes[p]=m)}))),l="";break;case"retain":u>0&&(h={retain:u},Rx(c)||(h.attributes=vx({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case yi:case hs:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Yr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Ve:{const{key:h,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(h)??null;Bi(p,m)?m!==null&&o.delete(r):(a==="retain"&&d(),Bi(m,s.get(h)??null)?delete c[h]:c[h]=m)}}else if(this.deletes(o)){s.set(h,m);const p=i.get(h)??null;Bi(p,m)||(a==="retain"&&d(),c[h]=p)}else if(!o.deleted){s.set(h,m);const p=c[h];p!==void 0&&(Bi(p,m)?p!==null&&o.delete(r):(a==="retain"&&d(),m===null?delete c[h]:c[h]=m))}o.deleted||(a==="insert"&&d(),Qs(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class _i extends hn{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??gn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new _i}clone(){const t=new _i;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new Bk(this,t,n);pc(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??gn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Yr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?de(this.doc,r=>{const i=new ah(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ch(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Bp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Dp(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??gn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((m,p)=>{d=!0,f[p]=m});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(qs(c,t)||n!==void 0&&qs(c,n))switch(c.content.constructor){case Yr:{const f=s.get("ychange");t!==void 0&&!qs(c,t)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!qs(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case yi:case hs:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,m)=>{d[m]=h})}i.push(f);break}case Ve:qs(c,t)&&(l(),Qs(s,c.content));break}c=c.right}l()};return t||n?de(o,f=>{t&&Ju(f,t),n&&Ju(f,n),u()},"cleanup"):u(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?de(i,s=>{const o=yc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),ch(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?de(i,s=>{const o=yc(s,this,t,!r);ch(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?de(r,i=>{Dp(i,yc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?de(i,s=>{const o=yc(s,this,t,!1);o.right!==null&&Bp(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?de(this.doc,n=>{gc(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?de(this.doc,r=>{sh(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return oh(this,t)}getAttributes(){return Cp(this)}_write(t){t.writeTypeRef(iv)}}const $k=e=>new _i;class lh{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??gn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===to||n.constructor===us)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class us extends hn{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new us}clone(){const t=new us;return t.insert(0,this.toArray().map(n=>n instanceof hn?n.clone():n)),t}get length(){return this.doc??gn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new lh(this,t)}querySelector(t){t=t.toUpperCase();const r=new lh(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),os(new lh(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){pc(this,t,new zk(this,n,t))}toString(){return Rp(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Go(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?de(this.doc,r=>{Ip(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)de(this.doc,r=>{const i=t&&t instanceof hn?t._item:t;mc(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Ui("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?de(this.doc,r=>{Np(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Ap(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Sp(this,t)}slice(t=0,n=this.length){return Tp(this,t,n)}forEach(t){Go(this,t)}_write(t){t.writeTypeRef(ov)}}const Dk=e=>new us;class to extends us{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new to(this.nodeName)}clone(){const t=new to(this.nodeName),n=this.getAttributes();return Ax(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof hn?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?de(this.doc,n=>{gc(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?de(this.doc,r=>{sh(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return oh(this,t)}hasAttribute(t){return Lp(this,t)}getAttributes(t){return t?Ik(this,t):Cp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Go(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(sv),t.writeKey(this.nodeName)}}const jk=e=>new to(e.readKey());class zk extends fc{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class bc extends Zs{constructor(t){super(),this.hookName=t}_copy(){return new bc(this.hookName)}clone(){const t=new bc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(av),t.writeKey(this.hookName)}}const Wk=e=>new bc(e.readKey());class wc extends _i{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new wc}clone(){const t=new wc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(cv)}}const Gk=e=>new wc;class uh{constructor(t,n){this.id=t,this.length=n}get deleted(){throw zr()}mergeWith(t){return!1}write(t,n,r){throw zr()}integrate(t,n){throw zr()}}const Kk=0;class ar extends uh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),mp(t.doc.store,this)}write(t,n){t.writeInfo(Kk),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Ko{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ko(this.content)}splice(t){throw zr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const Hk=e=>new Ko(e.readBuf());class Ho{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ho(this.len)}splice(t){const n=new Ho(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){cc(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Yk=e=>new Ho(e.readLen()),jp=(e,t)=>new Ys({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Yo{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Yo(jp(this.doc.guid,this.opts))}splice(t){throw zr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Vk=e=>new Yo(jp(e.readString(),e.readAny()));class hs{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new hs(this.embed)}splice(t){throw zr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Xk=e=>new hs(e.readJSON());class Ve{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ve(this.key,this.value)}splice(t){throw zr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const qk=e=>new Ve(e.readKey(),e.readJSON());class Ec{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ec(this.arr)}splice(t){const n=new Ec(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const Jk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Ec(n)},Zk=ac("node_env")==="development";class fs{constructor(t){this.arr=t,Zk&&H0(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new fs(this.arr)}splice(t){const n=new fs(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const Qk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new fs(n)};class Yr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Yr(this.str)}splice(t){const n=new Yr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const tv=e=>new Yr(e.readString()),ev=[Ck,Mk,$k,jk,Dk,Wk,Gk],nv=0,rv=1,iv=2,sv=3,ov=4,av=5,cv=6;class yi{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new yi(this.type._copy())}splice(t){throw zr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const lv=e=>new yi(ev[e.readTypeRef()](e)),xc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new Xe(Jt(r,i+n),t,Jt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=Jt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class Xe extends uh{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?O0:0}set marker(t){(this.info&Nu)>0!==t&&(this.info^=Nu)}get marker(){return(this.info&Nu)>0}get keep(){return(this.info&S0)>0}set keep(t){this.keep!==t&&(this.info^=S0)}get countable(){return(this.info&O0)>0}get deleted(){return(this.info&Iu)>0}set deleted(t){this.deleted!==t&&(this.info^=Iu)}markDeleted(){this.info|=Iu}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=sn(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=sn(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Xs&&this.id.client!==this.parent.client&&this.parent.clock>=sn(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=gp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Fi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ar||this.right&&this.right.constructor===ar)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Xe?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Xe&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Xs){const r=Qu(n,this.parent);r.constructor===ar?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=gp(t,t.doc.store,Jt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),lc(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(lc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Qu(t.doc.store,i.origin)))s.has(Qu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),mp(t.doc.store,this),this.content.integrate(t,this),bp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new ar(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Jt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&lc(t.origin,this.lastId)&&this.right===t&&lc(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),cc(t.deleteSet,this.id.client,this.id.clock,this.length),bp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Wr();this.content.gc(t),n?pk(t,this,new ar(this.id,this.length)):this.content=new Ho(this.length)}write(t,n){const r=n>0?Jt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&tc|(r===null?0:qn)|(i===null?0:pi)|(s===null?0:Mo);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=dk(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Xs?(t.writeParentInfo(!1),t.writeLeftID(a)):Wr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const zp=(e,t)=>uv[t&tc](e),uv=[()=>{Wr()},Yk,Jk,Hk,tv,Xk,qk,lv,Qk,Vk,()=>{Wr()}],hv=10;class cr extends uh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Wr()}write(t,n){t.writeInfo(hv),ie(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Wp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof $s<"u"?$s:{},Gp="__ $YJS$ __";Wp[Gp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Wp[Gp]=!0;let Kp=!1;const Qn=new Ys;function Hp(e,t,n){const r=Qn.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function fv(e,t){Hp(e,0,t)}function hh(e,t){const n=new _i(t);Hp(e,1,n)}function dv(e,t){Qn.getMap().set(e,t)}function pv(e,t){const n=Qn.getMap(),r=new _i(t);n.set(e,r)}function Yp(e,t){const n=Qn.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function mv(e,t){return Yp(e,n=>{Tt(n)&&t(n)})}function Vp(e,t){return Yp(e,n=>{n instanceof _i&&t(n.toJSON())})}const ds=Us("modem",["second"],e=>{if(ds.session(e))switch(e.target){case"second":!Kp&&e.data%2===0&&ds.emit(e.player,"modem:join");break;case"join":e.sender!==ds.id()&&ds.reply(e,"joinack",x0(uk(Qn)));break;case"joinack":e.sender!==ds.id()&&(Kp=!0,cp(Qn,Ja(e.data),Qn));break;case"sync":{e.sender!==ds.id()&&E(e.data)&&cp(Qn,Ja(e.data),Qn);break}}});function Xp(e,t){t!==Qn&&ds.emit("","modem:sync",x0(e))}Qn.on("update",Xp),Qn.on("destroy",()=>{Qn.off("update",Xp)});function gv(e,t){return e%t}function _v(e,t){return Math.floor(e/t)}function yv(e,t){return{x:gv(e,t),y:_v(e,t)}}function Vr(e,t){return e.x+e.y*t}function fh(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function qp(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function Jp(e,t,n,r){const i=[],s=Math.abs(n-e),o=Math.abs(r-t),a=e<n?1:-1,c=t<r?1:-1;let l=s-o;for(i.push({x:e,y:t});e!==n||t!==r;){const u=2*l;u>-o&&(l-=o,e+=a),u<s&&(l+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Zp="176",bv="",kr="srgb",Qp="srgb-linear",tm="linear",dh="srgb";function vr(e,t,n){return Math.max(t,Math.min(n,e))}function wv(e,t){return(e%t+t)%t}function ph(e,t,n){return(1-n)*e+n*t}class Vo{constructor(t=0,n=0){Vo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=vr(this.x,t.x,n.x),this.y=vr(this.y,t.y,n.y),this}clampScalar(t,n){return this.x=vr(this.x,t,n),this.y=vr(this.y,t,n),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(vr(r,t,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(vr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Xo{constructor(t,n,r,i,s,o,a,c,l){Xo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l)}set(t,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],m=r[8],p=i[0],w=i[3],b=i[6],v=i[1],A=i[4],R=i[7],M=i[2],S=i[5],I=i[8];return s[0]=o*p+a*v+c*M,s[3]=o*w+a*A+c*S,s[6]=o*b+a*R+c*I,s[1]=l*p+u*v+f*M,s[4]=l*w+u*A+f*S,s[7]=l*b+u*R+f*I,s[2]=d*p+h*v+m*M,s[5]=d*w+h*A+m*S,s[8]=d*b+h*R+m*I,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,m=n*f+r*d+i*h;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=f*p,t[1]=(i*l-u*r)*p,t[2]=(a*r-i*o)*p,t[3]=d*p,t[4]=(u*n-i*c)*p,t[5]=(i*s-a*n)*p,t[6]=h*p,t[7]=(r*c-l*n)*p,t[8]=(o*n-r*s)*p,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(mh.makeScale(t,n)),this}rotate(t){return this.premultiply(mh.makeRotation(-t)),this}translate(t,n){return this.premultiply(mh.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const mh=new Xo,em=new Xo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),nm=new Xo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Ev(){const e={enabled:!0,workingColorSpace:Qp,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===dh&&(i.r=eo(i.r),i.g=eo(i.g),i.b=eo(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===dh&&(i.r=no(i.r),i.g=no(i.g),i.b=no(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===bv?tm:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[Qp]:{primaries:t,whitePoint:r,transfer:tm,toXYZ:em,fromXYZ:nm,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:kr},outputColorSpaceConfig:{drawingBufferColorSpace:kr}},[kr]:{primaries:t,whitePoint:r,transfer:dh,toXYZ:em,fromXYZ:nm,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:kr}}}),e}const Tr=Ev();function eo(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function no(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const rm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$i={h:0,s:0,l:0},kc={h:0,s:0,l:0};function gh(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class _h{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=kr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Tr.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=Tr.workingColorSpace){return this.r=t,this.g=n,this.b=r,Tr.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=Tr.workingColorSpace){if(t=wv(t,1),n=vr(n,0,1),r=vr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=gh(o,s,t+1/3),this.g=gh(o,s,t),this.b=gh(o,s,t-1/3)}return Tr.toWorkingColorSpace(this,i),this}setStyle(t,n=kr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=kr){const r=rm[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=eo(t.r),this.g=eo(t.g),this.b=eo(t.b),this}copyLinearToSRGB(t){return this.r=no(t.r),this.g=no(t.g),this.b=no(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=kr){return Tr.fromWorkingColorSpace(_n.copy(this),t),Math.round(vr(_n.r*255,0,255))*65536+Math.round(vr(_n.g*255,0,255))*256+Math.round(vr(_n.b*255,0,255))}getHexString(t=kr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Tr.workingColorSpace){Tr.fromWorkingColorSpace(_n.copy(this),n);const r=_n.r,i=_n.g,s=_n.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,n=Tr.workingColorSpace){return Tr.fromWorkingColorSpace(_n.copy(this),n),t.r=_n.r,t.g=_n.g,t.b=_n.b,t}getStyle(t=kr){Tr.fromWorkingColorSpace(_n.copy(this),t);const n=_n.r,r=_n.g,i=_n.b;return t!==kr?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL($i),this.setHSL($i.h+t,$i.s+n,$i.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL($i),t.getHSL(kc);const r=ph($i.h,kc.h,n),i=ph($i.s,kc.s,n),s=ph($i.l,kc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _n=new _h;_h.NAMES=rm,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Zp}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Zp),new Vo,new Vo;function fn(e,t,n){return Math.max(t,Math.min(n,e))}function im(e){return e/180*Math.PI}function sm(e){return e*180/Math.PI}const xv=Fd("089fad0j9awfem09wavefc09uwaef");function kv(){return xv()}function vv(e){return Fd(e)()}function lr(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(kv()*i)}function om(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(vv(e)*s)}function am(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function Tv(e){return e[lr(0,e.length-1)]}function Av(e,t){return t[om(e,0,t.length-1)]}function qe(...e){return Tv(e.flat())}function Rv(e,...t){return Av(e,t.flat())}function Sv(e){return[...new Set(e)].filter(E)}function ps(e){return E(e)&&E(e.x)&&E(e.y)}function je(e,t){switch(t){case pt.NORTH:--e.y;break;case pt.SOUTH:++e.y;break;case pt.WEST:--e.x;break;case pt.EAST:++e.x;break}return e}function Ov(e,t){return e<0?pt.WEST:e>0?pt.EAST:t<0?pt.NORTH:t>0?pt.SOUTH:pt.IDLE}function Ar(e,t){return Ov(t.x-e.x,t.y-e.y)}const yh={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Rr(e){return le(e)&&cm(e[0])}function cm(e){return E(pt[e])&&_t(e)}function Iv(e){const t=pt[e];return E(t)?t:pt.IDLE}function bh(e){if(_t(e))return yh[Ot(e)]}function Nv(e){if(Rr(e))return e;if(cm(e))return[e];const t=bh(e);if(E(t))return[t]}function lm(e){const t=x.words[e],n=Nv(t);return Rr(n)?[n,e+1]:[void 0,e]}function um(e){var i,s;const t=[];let[n,r]=lm(e);for(;Rr(n);){switch(t.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=rt(x.words,r,[K.NUMBER,K.NUMBER]);t.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=rt(x.words,r,[K.DIR]);t.push(c.destpt.x,c.destpt.y),r=l;break}case"TO":{const[c,l,u]=rt(x.words,r,[K.DIR,K.DIR]),f=((i=x.element)==null?void 0:i.x)??0,d=((s=x.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,t.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[t,r]}const[o,a]=lm(r);n=o,r=a}return t.length?[t,r]:[void 0,e]}function Cv(e){return E(e)&&e<dt.ONBLACK?e:void 0}function Lv(e){return E(e)&&e>dt.WHITE&&e<dt.ONCLEAR?e-dt.ONBLACK:void 0}const qo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Xr(e){return le(e)&&fm(e[0])}function hm(e){return Xr(e)&&e[0].startsWith("ON")}function fm(e){return E(dt[e])&&_t(e)}function vc(e){if(_t(e))return qo[Ot(e)]}function dm(e){return e.map(t=>dt[t]).find(t=>E(t)&&t<dt.ONBLACK)}function pm(e){return e.map(t=>dt[t]).find(t=>E(t)&&t>=dt.ONBLACK)}function Mv(e){if(Xr(e))return e;if(fm(e))return[e];const t=vc(e);if(E(t))return[t]}function mm(e){const t=x.words[e],n=Mv(t);return Xr(n)?[n,e+1]:[void 0,e]}function wh(e){const t=[];let n=e;const[r,i]=mm(e);if(Xr(r)&&(t.push(...r),n=i),Xr(t)&&!hm(t)){const[s,o]=mm(i);hm(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function gm(e){const t={};return e.every(n=>{const r=dt[n];E(r)&&(r<dt.ONBLACK?t.color=r:t.bg=r-dt.ONBLACK)}),t}function ro(e){return le(e)&&typeof e[0]=="string"}function Uv(e){const t=x.words[e];return _t(t)?[t,e+1]:[void 0,e]}function _m(e){const t=x.words[e];if(ro(t))return[t,e+1];const[n,r]=wh(e),[i,s]=Uv(r);return _t(i)?[[i,n],s]:[void 0,e]}function Tc(e){if(!ro(e))return;const[t]=e;return t}function Eh(e){if(!ro(e))return;const[,t]=e,n=E(t)?dm(t):void 0;return E(n)?n:void 0}function ym(e){if(!ro(e))return;const[,t]=e,n=E(t)?pm(t):void 0;return E(n)?n:void 0}const At=60,Vt=25,xh=At*Vt;var yt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(yt||{});function Jo(e,t){const n=e??jt.ISWALK,r=t??jt.ISWALK;switch(n){case jt.ISWALK:return r!==jt.ISWALK;case jt.ISSWIM:return r!==jt.ISSWIM;case jt.ISSOLID:return!0;case jt.ISBULLET:return r!==jt.ISWALK&&r!==jt.ISSWIM}}function Zo(e,t,n){const r=e==null?void 0:e.objects[n];if(E(r))return r;const i=Qo(e,"player");return E(t)?(t.x<0&&(t.x=lr(0,At-1)),t.y<0&&(t.y=lr(0,Vt-1)),wm(t,i)):qe(...i)}function Qo(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(E)}function Fv(e){const t=[];for(let n=0;n<Vt;++n)for(let r=0;r<At;++r){const i={x:r,y:n},s=ee(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function kh(e,t){const n=Tc(t),r=Eh(t),i=ym(t);return Qo(e,n??"").filter(s=>{var o,a,c;return!(E(n)&&Ot((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||E(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??dt.WHITE)!==r||E(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??dt.BLACK)!==i)}).filter(E)}function bm(e,t){return E(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(E(i))return i;const s=Qo(e,Ot(n));if(s.length)return s}else if(ps(n)&&n.x>=0&&n.x<At&&n.y>=0&&n.y<Vt){const i=n.x+n.y*At,s=(r=e.lookup)==null?void 0:r[i];return E(s)?e.objects[s]:e.terrain[i]}}).flat().filter(E):[]}function wm(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var vh;try{vh=new TextDecoder}catch{}var bt,ur,z=0,pe={},Zt,Di,hr=0,qr=0,on,bi,Mn=[],qt,Em={useRecords:!1,mapsAsObjects:!0};class xm{}const km=new xm;km.name="MessagePack 0xC1";var ji=!1,vm=2,Tm;try{new Function("")}catch{vm=1/0}class ta{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(bt)return Bm(()=>(Oh(),this?this.unpack(t,n):ta.prototype.unpack.call(Em,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof un<"u"?un.from(t):new Uint8Array(t)),typeof n=="object"?(ur=n.end||t.length,z=n.start||0):(z=0,ur=n>-1?n:t.length),qr=0,Di=null,on=null,bt=t;try{qt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw bt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof ta){if(pe=this,this.structures)return Zt=this.structures,Ac(n);(!Zt||Zt.length>0)&&(Zt=[])}else pe=Em,(!Zt||Zt.length>0)&&(Zt=[]);return Ac(n)}unpackMultiple(t,n){let r,i=0;try{ji=!0;let s=t.length,o=this?this.unpack(t,s):Rc.unpack(t,s);if(n){if(n(o,i,z)===!1)return;for(;z<s;)if(i=z,n(Ac(),i,z)===!1)return}else{for(r=[o];z<s;)i=z,r.push(Ac());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{ji=!1,Oh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function Ac(e){try{if(!pe.trusted&&!ji){let n=Zt.sharedLength||0;n<Zt.length&&(Zt.length=n)}let t;if(pe.randomAccessStructure&&bt[z]<64&&bt[z]>=32&&Tm?(t=Tm(bt,z,ur,pe),bt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),z=ur):t=ze(),on&&(z=on.postBundlePosition,on=null),ji&&(Zt.restoreStructures=null),z==ur)Zt&&Zt.restoreStructures&&Am(),Zt=null,bt=null,bi&&(bi=null);else{if(z>ur)throw new Error("Unexpected end of MessagePack data");if(!ji){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Zt&&Zt.restoreStructures&&Am(),Oh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||z>ur)&&(t.incomplete=!0),t}}function Am(){for(let e in Zt.restoreStructures)Zt[e]=Zt.restoreStructures[e];Zt.restoreStructures=null}function ze(){let e=bt[z++];if(e<160)if(e<128){if(e<64)return e;{let t=Zt[e&63]||pe.getStructures&&Sm()[e&63];return t?(t.read||(t.read=Th(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,pe.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Mm();r==="__proto__"&&(r="__proto_"),t[r]=ze()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(ze(),ze());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=ze();return pe.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(qr>=z)return Di.slice(z-hr,(z+=t)-hr);if(qr==0&&ur<140){let n=t<16?Rh(t):Nm(t);if(n!=null)return n}return Ah(t)}else{let t;switch(e){case 192:return null;case 193:return on?(t=ze(),t>0?on[1].slice(on.position1,on.position1+=t):on[0].slice(on.position0,on.position0-=t)):km;case 194:return!1;case 195:return!0;case 196:if(t=bt[z++],t===void 0)throw new Error("Unexpected end of buffer");return Sh(t);case 197:return t=qt.getUint16(z),z+=2,Sh(t);case 198:return t=qt.getUint32(z),z+=4,Sh(t);case 199:return ms(bt[z++]);case 200:return t=qt.getUint16(z),z+=2,ms(t);case 201:return t=qt.getUint32(z),z+=4,ms(t);case 202:if(t=qt.getFloat32(z),pe.useFloat32>2){let n=Ih[(bt[z]&127)<<1|bt[z+1]>>7];return z+=4,(n*t+(t>0?.5:-.5)>>0)/n}return z+=4,t;case 203:return t=qt.getFloat64(z),z+=8,t;case 204:return bt[z++];case 205:return t=qt.getUint16(z),z+=2,t;case 206:return t=qt.getUint32(z),z+=4,t;case 207:return pe.int64AsType==="number"?(t=qt.getUint32(z)*4294967296,t+=qt.getUint32(z+4)):pe.int64AsType==="string"?t=qt.getBigUint64(z).toString():pe.int64AsType==="auto"?(t=qt.getBigUint64(z),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=qt.getBigUint64(z),z+=8,t;case 208:return qt.getInt8(z++);case 209:return t=qt.getInt16(z),z+=2,t;case 210:return t=qt.getInt32(z),z+=4,t;case 211:return pe.int64AsType==="number"?(t=qt.getInt32(z)*4294967296,t+=qt.getUint32(z+4)):pe.int64AsType==="string"?t=qt.getBigInt64(z).toString():pe.int64AsType==="auto"?(t=qt.getBigInt64(z),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=qt.getBigInt64(z),z+=8,t;case 212:if(t=bt[z++],t==114)return Fm(bt[z++]&63);{let n=Mn[t];if(n)return n.read?(z++,n.read(ze())):n.noBuffer?(z++,n()):n(bt.subarray(z,++z));throw new Error("Unknown extension "+t)}case 213:return t=bt[z],t==114?(z++,Fm(bt[z++]&63,bt[z++])):ms(2);case 214:return ms(4);case 215:return ms(8);case 216:return ms(16);case 217:return t=bt[z++],qr>=z?Di.slice(z-hr,(z+=t)-hr):Bv(t);case 218:return t=qt.getUint16(z),z+=2,qr>=z?Di.slice(z-hr,(z+=t)-hr):$v(t);case 219:return t=qt.getUint32(z),z+=4,qr>=z?Di.slice(z-hr,(z+=t)-hr):Dv(t);case 220:return t=qt.getUint16(z),z+=2,Om(t);case 221:return t=qt.getUint32(z),z+=4,Om(t);case 222:return t=qt.getUint16(z),z+=2,Im(t);case 223:return t=qt.getUint32(z),z+=4,Im(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const Pv=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Th(e,t){function n(){if(n.count++>vm){let i=e.read=new Function("r","return function(){return "+(pe.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":Pv.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(ze);return e.highByte===0&&(e.read=Rm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=ze()}return pe.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?Rm(t,n):n}const Rm=(e,t)=>function(){let n=bt[z++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Zt[r]||Sm()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Th(i,e)),i.read()};function Sm(){let e=Bm(()=>(bt=null,pe.getStructures()));return Zt=pe._mergeStructures(e,Zt)}var Ah=ea,Bv=ea,$v=ea,Dv=ea;function ea(e){let t;if(e<16&&(t=Rh(e)))return t;if(e>64&&vh)return vh.decode(bt.subarray(z,z+=e));const n=z+e,r=[];for(t="";z<n;){const i=bt[z++];if(!(i&128))r.push(i);else if((i&224)===192){const s=bt[z++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=bt[z++]&63,o=bt[z++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=bt[z++]&63,o=bt[z++]&63,a=bt[z++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=an.apply(String,r),r.length=0)}return r.length>0&&(t+=an.apply(String,r)),t}function Om(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=ze();return pe.freezeData?Object.freeze(t):t}function Im(e){if(pe.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Mm();r==="__proto__"&&(r="__proto_"),t[r]=ze()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(ze(),ze());return t}}var an=String.fromCharCode;function Nm(e){let t=z,n=new Array(e);for(let r=0;r<e;r++){const i=bt[z++];if((i&128)>0){z=t;return}n[r]=i}return an.apply(String,n)}function Rh(e){if(e<4)if(e<2){if(e===0)return"";{let t=bt[z++];if((t&128)>1){z-=1;return}return an(t)}}else{let t=bt[z++],n=bt[z++];if((t&128)>0||(n&128)>0){z-=2;return}if(e<3)return an(t,n);let r=bt[z++];if((r&128)>0){z-=3;return}return an(t,n,r)}else{let t=bt[z++],n=bt[z++],r=bt[z++],i=bt[z++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){z-=4;return}if(e<6){if(e===4)return an(t,n,r,i);{let s=bt[z++];if((s&128)>0){z-=5;return}return an(t,n,r,i,s)}}else if(e<8){let s=bt[z++],o=bt[z++];if((s&128)>0||(o&128)>0){z-=6;return}if(e<7)return an(t,n,r,i,s,o);let a=bt[z++];if((a&128)>0){z-=7;return}return an(t,n,r,i,s,o,a)}else{let s=bt[z++],o=bt[z++],a=bt[z++],c=bt[z++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){z-=8;return}if(e<10){if(e===8)return an(t,n,r,i,s,o,a,c);{let l=bt[z++];if((l&128)>0){z-=9;return}return an(t,n,r,i,s,o,a,c,l)}}else if(e<12){let l=bt[z++],u=bt[z++];if((l&128)>0||(u&128)>0){z-=10;return}if(e<11)return an(t,n,r,i,s,o,a,c,l,u);let f=bt[z++];if((f&128)>0){z-=11;return}return an(t,n,r,i,s,o,a,c,l,u,f)}else{let l=bt[z++],u=bt[z++],f=bt[z++],d=bt[z++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){z-=12;return}if(e<14){if(e===12)return an(t,n,r,i,s,o,a,c,l,u,f,d);{let h=bt[z++];if((h&128)>0){z-=13;return}return an(t,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=bt[z++],m=bt[z++];if((h&128)>0||(m&128)>0){z-=14;return}if(e<15)return an(t,n,r,i,s,o,a,c,l,u,f,d,h,m);let p=bt[z++];if((p&128)>0){z-=15;return}return an(t,n,r,i,s,o,a,c,l,u,f,d,h,m,p)}}}}}function Cm(){let e=bt[z++],t;if(e<192)t=e-160;else switch(e){case 217:t=bt[z++];break;case 218:t=qt.getUint16(z),z+=2;break;case 219:t=qt.getUint32(z),z+=4;break;default:throw new Error("Expected string")}return ea(t)}function Sh(e){return pe.copyBuffers?Uint8Array.prototype.slice.call(bt,z,z+=e):bt.subarray(z,z+=e)}function ms(e){let t=bt[z++];if(Mn[t]){let n;return Mn[t](bt.subarray(z,n=z+=e),r=>{z=r;try{return ze()}finally{z=n}})}else throw new Error("Unknown extension type "+t)}var Lm=new Array(4096);function Mm(){let e=bt[z++];if(e>=160&&e<192){if(e=e-160,qr>=z)return Di.slice(z-hr,(z+=e)-hr);if(!(qr==0&&ur<180))return Ah(e)}else return z--,Um(ze());let t=(e<<5^(e>1?qt.getUint16(z):e>0?bt[z]:0))&4095,n=Lm[t],r=z,i=z+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=qt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=bt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return z=r,n.string;i-=3,r=z}for(n=[],Lm[t]=n,n.bytes=e;r<i;)s=qt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=bt[r++],n.push(s);let a=e<16?Rh(e):Nm(e);return a!=null?n.string=a:n.string=Ah(e)}function Um(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const Fm=(e,t)=>{let n=ze().map(Um),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Zt[e];return i&&(i.isShared||ji)&&((Zt.restoreStructures||(Zt.restoreStructures=[]))[e]=i),Zt[e]=n,n.read=Th(n,r),n.read()};Mn[0]=()=>{},Mn[0].noBuffer=!0,Mn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let jv={Error,TypeError,ReferenceError};Mn[101]=()=>{let e=ze();return(jv[e[0]]||Error)(e[1],{cause:e[2]})},Mn[105]=e=>{if(pe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=qt.getUint32(z-4);bi||(bi=new Map);let n=bt[z],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};bi.set(t,i);let s=ze();return i.used?Object.assign(r,s):(i.target=s,s)},Mn[112]=e=>{if(pe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=qt.getUint32(z-4),n=bi.get(t);return n.used=!0,n.target},Mn[115]=()=>new Set(ze());const Pm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let zv=typeof globalThis=="object"?globalThis:window;Mn[116]=e=>{let t=e[0],n=Pm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new zv[n](Uint8Array.prototype.slice.call(e,1).buffer)},Mn[120]=()=>{let e=ze();return new RegExp(e[0],e[1])};const Wv=[];Mn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=z;return z+=t-e.length,on=Wv,on=[Cm(),Cm()],on.position0=0,on.position1=0,on.postBundlePosition=z,z=n,ze()},Mn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Bm(e){let t=ur,n=z,r=hr,i=qr,s=Di,o=bi,a=on,c=new Uint8Array(bt.slice(0,ur)),l=Zt,u=Zt.slice(0,Zt.length),f=pe,d=ji,h=e();return ur=t,z=n,hr=r,qr=i,Di=s,bi=o,on=a,bt=c,ji=d,Zt=l,Zt.splice(0,Zt.length,...u),pe=f,qt=new DataView(bt.buffer,bt.byteOffset,bt.byteLength),h}function Oh(){bt=null,bi=null,Zt=null}const Ih=new Array(147);for(let e=0;e<256;e++)Ih[e]=+("1e"+Math.floor(45.15-e*.30103));var Rc=new ta({useRecords:!1});const Gv=Rc.unpack;Rc.unpackMultiple,Rc.unpack;let Kv=new Float32Array(1);new Uint8Array(Kv.buffer,0,4);let Sc;try{Sc=new TextEncoder}catch{}let Nh,$m;const Oc=typeof un<"u",Ic=Oc?function(e){return un.allocUnsafeSlow(e)}:Uint8Array,Dm=Oc?un:Uint8Array,jm=Oc?4294967296:2144337920;let J,na,me,H=0,xn,Ne=null,Hv;const Yv=21760,Vv=/[\u0080-\uFFFF]/,io=Symbol("record-id");class Xv extends ta{constructor(t){super(t),this.offset=0;let n,r,i,s,o=Dm.prototype.utf8Write?function(T,_){return J.utf8Write(T,_,J.byteLength-_)}:Sc&&Sc.encodeInto?function(T,_){return Sc.encodeInto(T,J.subarray(_)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let f=t.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,m=u+f+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],w=0,b=0;this.pack=this.encode=function(T,_){if(J||(J=new Ic(8192),me=J.dataView||(J.dataView=new DataView(J.buffer,0,8192)),H=0),xn=J.length-10,xn-H<2048?(J=new Ic(J.length),me=J.dataView||(J.dataView=new DataView(J.buffer,0,J.length)),xn=J.length-10,H=0):H=H+7&2147483640,n=H,_&nT&&(H+=_&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof T!="string"?(Ne=[],Ne.size=1/0):Ne=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let V=i.sharedLength||0;if(V>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let B=0;B<V;B++){let at=i[B];if(!at)continue;let Z,lt=i.transitions;for(let X=0,W=at.length;X<W;X++){let kt=at[X];Z=lt[kt],Z||(Z=lt[kt]=Object.create(null)),lt=Z}lt[io]=B+64}this.lastNamedStructuresLength=V}c||(i.nextId=V+64)}r&&(r=!1);let N;try{a.randomAccessStructure&&T&&T.constructor&&T.constructor===Object?U(T):R(T);let V=Ne;if(Ne&&Gm(n,R,0),s&&s.idsToInsert){let B=s.idsToInsert.sort((X,W)=>X.offset>W.offset?1:-1),at=B.length,Z=-1;for(;V&&at>0;){let X=B[--at].offset+n;X<V.stringsPosition+n&&Z===-1&&(Z=0),X>V.position+n?Z>=0&&(Z+=6):(Z>=0&&(me.setUint32(V.position+n,me.getUint32(V.position+n)+Z),Z=-1),V=V.previous,at++)}Z>=0&&V&&me.setUint32(V.position+n,me.getUint32(V.position+n)+Z),H+=B.length*6,H>xn&&C(H),a.offset=H;let lt=Jv(J.subarray(n,H),B);return s=null,lt}return a.offset=H,_&tT?(J.start=n,J.end=H,J):J.subarray(n,H)}catch(V){throw N=V,V}finally{if(i&&(v(),r&&a.saveStructures)){let V=i.sharedLength||0,B=J.subarray(n,H),at=Zv(i,a);if(!N)return a.saveStructures(at,at.isCompatible)===!1?a.pack(T,_):(a.lastNamedStructuresLength=V,J.length>1073741824&&(J=null),B)}J.length>1073741824&&(J=null),_&eT&&(H=n)}};const v=()=>{b<10&&b++;let T=i.sharedLength||0;if(i.length>T&&!c&&(i.length=T),w>1e4)i.transitions=null,b=0,w=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let _=0,N=p.length;_<N;_++)p[_][io]=0;p=[]}},A=T=>{var _=T.length;_<16?J[H++]=144|_:_<65536?(J[H++]=220,J[H++]=_>>8,J[H++]=_&255):(J[H++]=221,me.setUint32(H,_),H+=4);for(let N=0;N<_;N++)R(T[N])},R=T=>{H>xn&&(J=C(H));var _=typeof T,N;if(_==="string"){let V=T.length;if(Ne&&V>=4&&V<4096){if((Ne.size+=V)>Yv){let lt,X=(Ne[0]?Ne[0].length*3+Ne[1].length:0)+10;H+X>xn&&(J=C(H+X));let W;Ne.position?(W=Ne,J[H]=200,H+=3,J[H++]=98,lt=H-n,H+=4,Gm(n,R,0),me.setUint16(lt+n-3,H-n-lt)):(J[H++]=214,J[H++]=98,lt=H-n,H+=4),Ne=["",""],Ne.previous=W,Ne.size=0,Ne.position=lt}let Z=Vv.test(T);Ne[Z?0:1]+=T,J[H++]=193,R(Z?-V:V);return}let B;V<32?B=1:V<256?B=2:V<65536?B=3:B=5;let at=V*3;if(H+at>xn&&(J=C(H+at)),V<64||!o){let Z,lt,X,W=H+B;for(Z=0;Z<V;Z++)lt=T.charCodeAt(Z),lt<128?J[W++]=lt:lt<2048?(J[W++]=lt>>6|192,J[W++]=lt&63|128):(lt&64512)===55296&&((X=T.charCodeAt(Z+1))&64512)===56320?(lt=65536+((lt&1023)<<10)+(X&1023),Z++,J[W++]=lt>>18|240,J[W++]=lt>>12&63|128,J[W++]=lt>>6&63|128,J[W++]=lt&63|128):(J[W++]=lt>>12|224,J[W++]=lt>>6&63|128,J[W++]=lt&63|128);N=W-H-B}else N=o(T,H+B);N<32?J[H++]=160|N:N<256?(B<2&&J.copyWithin(H+2,H+1,H+1+N),J[H++]=217,J[H++]=N):N<65536?(B<3&&J.copyWithin(H+3,H+2,H+2+N),J[H++]=218,J[H++]=N>>8,J[H++]=N&255):(B<5&&J.copyWithin(H+5,H+3,H+3+N),J[H++]=219,me.setUint32(H,N),H+=4),H+=N}else if(_==="number")if(T>>>0===T)T<32||T<128&&this.useRecords===!1||T<64&&!this.randomAccessStructure?J[H++]=T:T<256?(J[H++]=204,J[H++]=T):T<65536?(J[H++]=205,J[H++]=T>>8,J[H++]=T&255):(J[H++]=206,me.setUint32(H,T),H+=4);else if(T>>0===T)T>=-32?J[H++]=256+T:T>=-128?(J[H++]=208,J[H++]=T+256):T>=-32768?(J[H++]=209,me.setInt16(H,T),H+=2):(J[H++]=210,me.setInt32(H,T),H+=4);else{let V;if((V=this.useFloat32)>0&&T<4294967296&&T>=-2147483648){J[H++]=202,me.setFloat32(H,T);let B;if(V<4||(B=T*Ih[(J[H]&127)<<1|J[H+1]>>7])>>0===B){H+=4;return}else H--}J[H++]=203,me.setFloat64(H,T),H+=8}else if(_==="object"||_==="function")if(!T)J[H++]=192;else{if(s){let B=s.get(T);if(B){if(!B.id){let at=s.idsToInsert||(s.idsToInsert=[]);B.id=at.push(B)}J[H++]=214,J[H++]=112,me.setUint32(H,B.id),H+=4;return}else s.set(T,{offset:H-n})}let V=T.constructor;if(V===Object)P(T);else if(V===Array)A(T);else if(V===Map)if(this.mapAsEmptyObject)J[H++]=128;else{N=T.size,N<16?J[H++]=128|N:N<65536?(J[H++]=222,J[H++]=N>>8,J[H++]=N&255):(J[H++]=223,me.setUint32(H,N),H+=4);for(let[B,at]of T)R(B),R(at)}else{for(let B=0,at=Nh.length;B<at;B++){let Z=$m[B];if(T instanceof Z){let lt=Nh[B];if(lt.write){lt.type&&(J[H++]=212,J[H++]=lt.type,J[H++]=0);let ht=lt.write.call(this,T);ht===T?Array.isArray(T)?A(T):P(T):R(ht);return}let X=J,W=me,kt=H;J=null;let ct;try{ct=lt.pack.call(this,T,ht=>(J=X,X=null,H+=ht,H>xn&&C(H),{target:J,targetView:me,position:H-ht}),R)}finally{X&&(J=X,me=W,H=kt,xn=J.length-10)}ct&&(ct.length+H>xn&&C(ct.length+H),H=qv(ct,J,H,lt.type));return}}if(Array.isArray(T))A(T);else{if(T.toJSON){const B=T.toJSON();if(B!==T)return R(B)}if(_==="function")return R(this.writeFunction&&this.writeFunction(T));P(T)}}}else if(_==="boolean")J[H++]=T?195:194;else if(_==="bigint"){if(T<BigInt(1)<<BigInt(63)&&T>=-(BigInt(1)<<BigInt(63)))J[H++]=211,me.setBigInt64(H,T);else if(T<BigInt(1)<<BigInt(64)&&T>0)J[H++]=207,me.setBigUint64(H,T);else if(this.largeBigIntToFloat)J[H++]=203,me.setFloat64(H,Number(T));else{if(this.largeBigIntToString)return R(T.toString());if(this.useBigIntExtension&&T<BigInt(2)**BigInt(1023)&&T>-(BigInt(2)**BigInt(1023))){J[H++]=199,H++,J[H++]=66;let V=[],B;do{let at=T&BigInt(255);B=(at&BigInt(128))===(T<BigInt(0)?BigInt(128):BigInt(0)),V.push(at),T>>=BigInt(8)}while(!((T===BigInt(0)||T===BigInt(-1))&&B));J[H-2]=V.length;for(let at=V.length;at>0;)J[H++]=Number(V[--at]);return}else throw new RangeError(T+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}H+=8}else if(_==="undefined")this.encodeUndefinedAsNil?J[H++]=192:(J[H++]=212,J[H++]=0,J[H++]=0);else throw new Error("Unknown type: "+_)},M=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?T=>{let _;if(this.skipValues){_=[];for(let B in T)(typeof T.hasOwnProperty!="function"||T.hasOwnProperty(B))&&!this.skipValues.includes(T[B])&&_.push(B)}else _=Object.keys(T);let N=_.length;N<16?J[H++]=128|N:N<65536?(J[H++]=222,J[H++]=N>>8,J[H++]=N&255):(J[H++]=223,me.setUint32(H,N),H+=4);let V;if(this.coercibleKeyAsNumber)for(let B=0;B<N;B++){V=_[B];let at=Number(V);R(isNaN(at)?V:at),R(T[V])}else for(let B=0;B<N;B++)R(V=_[B]),R(T[V])}:T=>{J[H++]=222;let _=H-n;H+=2;let N=0;for(let V in T)(typeof T.hasOwnProperty!="function"||T.hasOwnProperty(V))&&(R(V),R(T[V]),N++);if(N>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');J[_+++n]=N>>8,J[_+n]=N&255},S=this.useRecords===!1?M:t.progressiveRecords&&!d?T=>{let _,N=i.transitions||(i.transitions=Object.create(null)),V=H++-n,B;for(let at in T)if(typeof T.hasOwnProperty!="function"||T.hasOwnProperty(at)){if(_=N[at],_)N=_;else{let Z=Object.keys(T),lt=N;N=i.transitions;let X=0;for(let W=0,kt=Z.length;W<kt;W++){let ct=Z[W];_=N[ct],_||(_=N[ct]=Object.create(null),X++),N=_}V+n+1==H?(H--,D(N,Z,X)):G(N,Z,V,X),B=!0,N=lt[at]}R(T[at])}if(!B){let at=N[io];at?J[V+n]=at:G(N,Object.keys(T),V,0)}}:T=>{let _,N=i.transitions||(i.transitions=Object.create(null)),V=0;for(let at in T)(typeof T.hasOwnProperty!="function"||T.hasOwnProperty(at))&&(_=N[at],_||(_=N[at]=Object.create(null),V++),N=_);let B=N[io];B?B>=96&&d?(J[H++]=((B-=96)&31)+96,J[H++]=B>>5):J[H++]=B:D(N,N.__keys__||Object.keys(T),V);for(let at in T)(typeof T.hasOwnProperty!="function"||T.hasOwnProperty(at))&&R(T[at])},I=typeof this.useRecords=="function"&&this.useRecords,P=I?T=>{I(T)?S(T):M(T)}:S,C=T=>{let _;if(T>16777216){if(T-n>jm)throw new Error("Packed buffer would be larger than maximum buffer size");_=Math.min(jm,Math.round(Math.max((T-n)*(T>67108864?1.25:2),4194304)/4096)*4096)}else _=(Math.max(T-n<<2,J.length-1)>>12)+1<<12;let N=new Ic(_);return me=N.dataView||(N.dataView=new DataView(N.buffer,0,_)),T=Math.min(T,J.length),J.copy?J.copy(N,0,n,T):N.set(J.slice(n,T)),H-=n,n=0,xn=N.length-10,J=N},D=(T,_,N)=>{let V=i.nextId;V||(V=64),V<h&&this.shouldShareStructure&&!this.shouldShareStructure(_)?(V=i.nextOwnId,V<m||(V=h),i.nextOwnId=V+1):(V>=m&&(V=h),i.nextId=V+1);let B=_.highByte=V>=96&&d?V-96>>5:-1;T[io]=V,T.__keys__=_,i[V-64]=_,V<h?(_.isShared=!0,i.sharedLength=V-63,r=!0,B>=0?(J[H++]=(V&31)+96,J[H++]=B):J[H++]=V):(B>=0?(J[H++]=213,J[H++]=114,J[H++]=(V&31)+96,J[H++]=B):(J[H++]=212,J[H++]=114,J[H++]=V),N&&(w+=b*N),p.length>=f&&(p.shift()[io]=0),p.push(T),R(_))},G=(T,_,N,V)=>{let B=J,at=H,Z=xn,lt=n;J=na,H=0,n=0,J||(na=J=new Ic(8192)),xn=J.length-10,D(T,_,V),na=J;let X=H;if(J=B,H=at,xn=Z,n=lt,X>1){let W=H+X-1;W>xn&&C(W);let kt=N+n;J.copyWithin(kt+X,kt+1,H),J.set(na.slice(0,X),kt),H=W}else J[N+n]=na[0]},U=T=>{let _=Hv(T,J,n,H,i,C,(N,V,B)=>{if(B)return r=!0;H=V;let at=J;return R(N),v(),at!==J?{position:H,targetView:me,target:J}:H},this);if(_===0)return P(T);H=_}}useBuffer(t){J=t,J.dataView||(J.dataView=new DataView(J.buffer,J.byteOffset,J.byteLength)),H=0}set position(t){H=t}get position(){return H}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}$m=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,xm],Nh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?zm(e,16,t):Wm(Oc?un.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==Dm&&this.moreTypes?zm(e,Pm.indexOf(n.name),t):Wm(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function zm(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Wm(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function qv(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function Jv(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function Gm(e,t,n){if(Ne.length>0){me.setUint32(Ne.position+e,H+n-Ne.position-e),Ne.stringsPosition=H-e;let r=Ne;Ne=null,t(r[0]),t(r[1])}}function Zv(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let Km=new Xv({useRecords:!1});const Qv=Km.pack;Km.pack;const tT=512,eT=1024,nT=2048,et=Us("SOFTWARE");function ve(){return null}function so(e,t,n={}){if(!E(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];E(c)&&(a=c(a));const l=t[o];E(l)&&(o=l),a!==null&&r.push(o,a)}return r}function ra(e,t,n={}){if(E(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];E(a)&&(s=a);const c=n[s];E(c)&&(o=c(o)),r[s]=o}return r}catch(r){fe(et,"","binary",r.message)}}function rT(e){try{const t=wr(e);return Qv(t)}catch(t){fe(et,"","binary",t.message)}}function iT(e){try{return Gv(e)}catch(t){fe(et,"","binary",t.message)}}function Hm(){return{id:$e()}}var Nc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.breakable=16]="breakable",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e[e.lightdir=31]="lightdir",e[e.item=32]="item",e[e.p4=33]="p4",e[e.p5=34]="p5",e[e.p6=35]="p6",e))(Nc||{});function Cc(e){return E(e==null?void 0:e.id)?so(e,Nc,{category:ve,kinddata:ve,stopped:ve,removed:ve,bucket:ve}):so(e,Nc,{id:ve,x:ve,y:ve,lx:ve,ly:ve,code:ve,category:ve,kinddata:ve,stopped:ve,removed:ve,bucket:ve})}function Lc(e){return ra(e,Nc)}function We(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function ia(e,t){if(!E(e)||!Xr(t))return;const{color:n,bg:r}=gm(t);E(n)&&(e.color=n),E(r)&&(e.bg=r)}function Jr(e){var t;return Ot((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function Ue(e){var o;if(!E(e)||E(e.lookup)&&E(e.named))return;const t=new Array(At*Vt).fill(void 0),n={},r=Object.values(e.objects);for(let a=0;a<r.length;++a){const c=r[a];if(E(c.x)&&E(c.y)&&E(c.id)&&!E(c.removed)){c.category=Ln.ISOBJECT,t[c.x+c.y*At]=c.id;const l=Ot(c.name??((o=c.kinddata)==null?void 0:o.name)??"");n[l]||(n[l]=new Set),n[l].add(c.id)}}let i=0,s=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(E(c)){c.x=i,c.y=s,c.category=Ln.ISTERRAIN;const l=Jr(c);n[l]||(n[l]=new Set),n[l].add(a)}++i,i>=At&&(i=0,++s)}e.lookup=t,e.named=n}function sa(e){E(e)&&(delete e.named,delete e.lookup,Ue(e))}function Ym(e,t,n){var i;if(!E(e)||!E(e.named)||!E(t))return;const r=Ot(t.name??((i=t.kinddata)==null?void 0:i.name)??"");e.named[r]||(e.named[r]=new Set),e.named[r].add((t==null?void 0:t.id)??n??"")}function sT(e,t){if(!(!E(e)||!E(e.lookup)||!E(t==null?void 0:t.id))&&!E(t.removed)){const n=t.x??0,r=t.y??0;e.lookup[n+r*At]=t.id}}function oT(e,t){var n;if(E(e)&&E(t==null?void 0:t.x)&&E(t.y)){const r=Jr(t),i=Br(e,t);E((n=e.named)==null?void 0:n[r])&&e.named[r].delete(i)}}function Ch(e,t){var n;if(E(e)&&E(t==null?void 0:t.id)){if(E(e.lookup)&&E(t.x)&&E(t.y)){const i=t.x+t.y*At;e.lookup[i]===t.id&&(e.lookup[i]=void 0)}const r=Jr(t);E((n=e.named)==null?void 0:n[r])&&E(t.id)&&e.named[r].delete(t.id)}}var Vm={exports:{}},Lh={exports:{}},Xm;function aT(){return Xm||(Xm=1,function(e,t){(function(n,r){e.exports=r()})(In,function(){function n(p){return!isNaN(parseFloat(p))&&isFinite(p)}function r(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(p){if(p)for(var w=0;w<u.length;w++)p[u[w]]!==void 0&&this["set"+r(u[w])](p[u[w]])}f.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof f)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new f(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",w=this.getLineNumber()||"",b=this.getColumnNumber()||"",v=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+w+":"+b+")":"[eval]:"+w+":"+b:v?v+" ("+p+":"+w+":"+b+")":p+":"+w+":"+b}},f.fromString=function(w){var b=w.indexOf("("),v=w.lastIndexOf(")"),A=w.substring(0,b),R=w.substring(b+1,v).split(","),M=w.substring(v+1);if(M.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(M,""),I=S[1],P=S[2],C=S[3];return new f({functionName:A,args:R||void 0,fileName:I,lineNumber:P||void 0,columnNumber:C||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(p){return function(w){this[p]=!!w}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(p){return function(w){if(!n(w))throw new TypeError(p+" must be a Number");this[p]=Number(w)}}(o[h]);for(var m=0;m<a.length;m++)f.prototype["get"+r(a[m])]=i(a[m]),f.prototype["set"+r(a[m])]=function(p){return function(w){this[p]=String(w)}}(a[m]);return f})}(Lh)),Lh.exports}(function(e,t){(function(n,r){e.exports=r(aT())})(In,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),m=d&&f||void 0,p=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:m,fileName:p,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",m=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;h.match(/\(([^)]*)\)/)&&(p=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var w=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new r({functionName:m,args:w,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Vm);var cT=Vm.exports,lT=Ls(cT);const Mh=14,Mc=3,zi=8,Wi=14,Uc=16,uT=16,hT=16;var Fc=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(Fc||{});function oa(e,t){return new Array(e).fill(t)}function fT(e,t,n,r,i,s=0){const o=r*i;return{id:`tiles:${e}:${t}`,type:1,tag:n,width:r,height:i,char:oa(o,0),color:oa(o,0),bg:oa(o,s),wall:oa(o,0)}}function dT(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:dt.ONCLEAR}}function pT(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function mT(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:oa(s,i)}}function gT(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function _T(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function qm(e,t){return`${e}:${t}`}const yT=1,bT=16,wT=256;var kn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(kn||{});const Zr=!!JSON.parse("false"),ET=!!JSON.parse("false");JSON.parse("false");const xT=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const wi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return zi*wi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Wi*wi.DRAW_CHAR_SCALE}};function Ei(e){const t={},n={tick(){},everytick(){},listcommands(){return sr(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function Te(e){return`${e??""}`}function aa(e,t){const n=parseFloat(Te(e));return isNaN(n)?t:n}function Jm(e,t,n){var i;const[r]=rt(t,0,[K.MAYBE_NAME]);Zw(et,e,((i=x.board)==null?void 0:i.id)??"",r??"",n)}function Un(e,t,n,r){const[i,s]=rt(r,0,[K.NUMBER_OR_STRING,K.MAYBE_NUMBER_OR_STRING]);Jd(et,e,t,n,i,s)}const kT=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Zm(e,t,n){const[r,i]=rt(n,0,[K.NUMBER_OR_STRING]);if(Tt(r))pu(et,e,t,"volume",r);else if(kT.includes(Ot(r))){const[s,o]=rt(n,i,[K.NUMBER_OR_STRING,K.MAYBE_NUMBER_OR_STRING]);Jd(et,e,t,r,s,o)}else{const[s]=rt(n,i,[K.MAYBE_NUMBER_OR_STRING]);if(Tt(s)){const o=n.length-i,a=new Array(o).fill(K.NUMBER),c=rt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;pu(et,e,t,r,l)}else{const[o]=rt(n,i,[K.MAYBE_NUMBER_OR_STRING]);pu(et,e,t,r,o)}}}let Qm="en-US-GuyNeural";const Uh=Ei().command("talk",(e,t)=>{const[n]=rt(t,0,[K.ANY]);switch(Ot(n)){default:Lw(et,x.elementfocus);break;case"stop":Mw(et,x.elementfocus);break}return 0}).command("media",(e,t)=>{const[n]=rt(t,0,[K.ANY]);switch(Ot(n)){default:Uw(et,x.elementfocus);break;case"stop":Fw(et,x.elementfocus);break}return 0}).command("tts",(e,t)=>{const n=t.map(Te).join("");return Jw(et,x.elementfocus,Qm,n),0}).command("ttsvoice",(e,t)=>(Qm=t.map(Te).join(""),0)).command("bpm",(e,t)=>{const[n]=rt(t,0,[K.NUMBER]);return tE(et,x.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=rt(t,0,[K.NUMBER]);return eE(et,x.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=rt(t,0,[K.NUMBER]);return nE(et,x.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=rt(t,0,[K.NUMBER]);return rE(et,x.elementfocus,n),0}).command("play",(e,t)=>(Jm(x.elementfocus,t,!1),0)).command("bgplay",(e,t)=>(Jm(x.elementfocus,t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)Zm(x.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)Un(x.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)Un(x.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)Un(x.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)Un(x.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)Un(x.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)Un(x.elementfocus,n,"vibrato",t);return 0}).command("autowah",(e,t)=>{for(let n=0;n<3;++n)Un(x.elementfocus,n,"autowah",t);return 0});for(let e=0;e<8;++e)Uh.command(`synth${e+1}`,(t,n)=>(Zm(x.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;Uh.command(`echo${t}`,(n,r)=>(Un(x.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(Un(x.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(Un(x.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(Un(x.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(Un(x.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(Un(x.elementfocus,e,"vibrato",r),0)).command(`autowah${t}`,(n,r)=>(Un(x.elementfocus,e,"autowah",r),0))}function Fh(e,t,n,r=!1){if(!E(e)||!E(e.lookup)||n.x<0||n.x>=At||n.y<0||n.y>=Vt)return!0;const i=n.x+n.y*At,s=Sn(e,e.lookup[i]??"404");if(E(s))return!(r&&Nn(s.id));const o=e.terrain[i];return E(o)?Jo(t,Ht(o,"collision")):!1}function vT(e,t,n){const r=Sn(e,(t==null?void 0:t.id)??""),i=(r==null?void 0:r.x)??-1,s=(r==null?void 0:r.y)??-1;if(i-n.x===0&&s-n.y===0)return!0;const o=Ht(r,"collision");return Fh(e,o,n)}function Ph(e,t,n){var d;const r=Sn(e,(t==null?void 0:t.id)??"");if(!E(e)||!E(r)||!E(r.x)||!E(r.y)||!E(e.lookup)||n.x<0||n.x>=At||n.y<0||n.y>=Vt)return{name:"edge",kind:"edge",collision:jt.ISSOLID,x:n.x,y:n.y};if(r.x-n.x===0&&r.y-n.y===0)return;const i=Br(e,r),s=Br(e,n),o=Ht(r,"collision"),a=Nn(r==null?void 0:r.id),c=Ht(r,"collision")===jt.ISBULLET,l=Sn(e,e.lookup[s]??""),u=Nn((l==null?void 0:l.id)??"");if(E(l)&&(!a||!u)){const h=Ht(r,"group"),m=Ht(l,"group");if((h||m)&&h!=m)return{...l};const p=!!Ht(l,"item");if(a&&p)return r.x=n.x,r.y=n.y,{...l};const w=!!Ht(l,"breakable");if(c&&w)return r.x=n.x,r.y=n.y,{...l};if(o===jt.ISBULLET)return{...l};if(!!Ht(l,"pushable")){const v=Ar({x:r.x,y:r.y},n),A=je({x:l.x??0,y:l.y??0},v),R=Ph(e,l,A);if(E(R))return{...l}}else return{...l}}const f=e.terrain[s];if(E(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??jt.ISWALK;if(Jo(o,h))return{...f,x:n.x,y:n.y}}r.x=n.x,r.y=n.y,E(r.removed)||(e.lookup[i]=void 0,e.lookup[s]=r.id??"")}function TT(e,t){const n=[];if(!E(e))return n;const r=Object.values(e.objects);for(let i=0;i<r.length;++i){const s=r[i];E(s.id)&&E(s.removed)&&t-s.removed>Ha*5&&(n.push(s.id),T1(e,s.id))}return n}function AT(e,t){const n=[];if(!E(e))return n;e.lookup=void 0,Ue(e);const r=Object.values(e.objects);for(let s=0;s<r.length;++s){const o=r[s];if(!E(o.id))continue;o.lx=o.x,o.ly=o.y;const a=ui(o),c=`${(a==null?void 0:a.code)??""}
${o.code??""}`;if(c){if(o.removed){const l=t-o.removed,u=Ht(o,"cycle");if(l>u)continue}n.push({id:o.id,type:yt.OBJECT,code:c,object:o,terrain:void 0})}}const i=TT(e,t);for(let s=0;s<i.length;++s)n.push({id:i[s],type:yt.ERROR,code:"",object:void 0,terrain:void 0});return n}function tg(e,t,n){const r=[],i=[];if(!E(e))return{objectelements:r,terrainelements:i};function s(a,c){switch(n){case"all":return!0;case"self":return(a==null?void 0:a.id)===t;case"others":return(a==null?void 0:a.id)!==t;case"terrain":return c===!0;case"object":return c===!1}const l=Ht(a,n);return E(l)||Jr(a)===n||Ht(a,"group")===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&r.push(c)}for(let a=0;a<xh;++a){const c=e.terrain[a];E(c)&&s(c,!0)&&i.push(c)}return{objectelements:r,terrainelements:i}}function eg(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function ng(e){const t=Math.floor(e.length/Mc);if(t*Mc!==e.length)return;const n=eg(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function RT(e,t){return e&1<<t?255:0}function rg(e){const t=Math.floor(e.length/Mh);if(t*Mh!==e.length)return;const n=Math.ceil(t/Uc),r=zi*Uc,i=eg(r,Wi*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*Wi+a,u=e[c];for(let f=0;f<zi;++f){const d=s*zi+f;i.bits[d+l*r]=RT(u,7-f)}++a,a===Wi&&(a=0,++s,s===Uc&&(s=0,++o))}return i}const ST=Ja("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),OT=Ja("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var ig=typeof $s=="object"&&$s&&$s.Object===Object&&$s,IT=typeof self=="object"&&self&&self.Object===Object&&self,Qr=ig||IT||Function("return this")(),fr=Qr.Symbol,sg=Object.prototype,NT=sg.hasOwnProperty,CT=sg.toString,ca=fr?fr.toStringTag:void 0;function LT(e){var t=NT.call(e,ca),n=e[ca];try{e[ca]=void 0;var r=!0}catch{}var i=CT.call(e);return r&&(t?e[ca]=n:delete e[ca]),i}var MT=Object.prototype,UT=MT.toString;function FT(e){return UT.call(e)}var PT="[object Null]",BT="[object Undefined]",og=fr?fr.toStringTag:void 0;function Gi(e){return e==null?e===void 0?BT:PT:og&&og in Object(e)?LT(e):FT(e)}function Sr(e){return e!=null&&typeof e=="object"}var $T="[object Symbol]";function Pc(e){return typeof e=="symbol"||Sr(e)&&Gi(e)==$T}function Bc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var re=Array.isArray,DT=1/0,ag=fr?fr.prototype:void 0,cg=ag?ag.toString:void 0;function lg(e){if(typeof e=="string")return e;if(re(e))return Bc(e,lg)+"";if(Pc(e))return cg?cg.call(e):"";var t=e+"";return t=="0"&&1/e==-DT?"-0":t}var jT=/\s/;function zT(e){for(var t=e.length;t--&&jT.test(e.charAt(t)););return t}var WT=/^\s+/;function GT(e){return e&&e.slice(0,zT(e)+1).replace(WT,"")}function dr(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var ug=NaN,KT=/^[-+]0x[0-9a-f]+$/i,HT=/^0b[01]+$/i,YT=/^0o[0-7]+$/i,VT=parseInt;function XT(e){if(typeof e=="number")return e;if(Pc(e))return ug;if(dr(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=dr(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=GT(e);var n=HT.test(e);return n||YT.test(e)?VT(e.slice(2),n?2:8):KT.test(e)?ug:+e}var hg=1/0,qT=17976931348623157e292;function JT(e){if(!e)return e===0?e:0;if(e=XT(e),e===hg||e===-hg){var t=e<0?-1:1;return t*qT}return e===e?e:0}function $c(e){var t=JT(e),n=t%1;return t===t?n?t-n:t:0}function oo(e){return e}var ZT="[object AsyncFunction]",QT="[object Function]",tA="[object GeneratorFunction]",eA="[object Proxy]";function xi(e){if(!dr(e))return!1;var t=Gi(e);return t==QT||t==tA||t==ZT||t==eA}var Bh=Qr["__core-js_shared__"],fg=function(){var e=/[^.]+$/.exec(Bh&&Bh.keys&&Bh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function nA(e){return!!fg&&fg in e}var rA=Function.prototype,iA=rA.toString;function gs(e){if(e!=null){try{return iA.call(e)}catch{}try{return e+""}catch{}}return""}var sA=/[\\^$.*+?()[\]{}|]/g,oA=/^\[object .+?Constructor\]$/,aA=Function.prototype,cA=Object.prototype,lA=aA.toString,uA=cA.hasOwnProperty,hA=RegExp("^"+lA.call(uA).replace(sA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function fA(e){if(!dr(e)||nA(e))return!1;var t=xi(e)?hA:oA;return t.test(gs(e))}function dA(e,t){return e==null?void 0:e[t]}function _s(e,t){var n=dA(e,t);return fA(n)?n:void 0}var $h=_s(Qr,"WeakMap"),dg=Object.create,pA=function(){function e(){}return function(t){if(!dr(t))return{};if(dg)return dg(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function mA(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Je(){}function gA(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var _A=800,yA=16,bA=Date.now;function wA(e){var t=0,n=0;return function(){var r=bA(),i=yA-(r-n);if(n=r,i>0){if(++t>=_A)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function EA(e){return function(){return e}}var Dc=function(){try{var e=_s(Object,"defineProperty");return e({},"",{}),e}catch{}}(),xA=Dc?function(e,t){return Dc(e,"toString",{configurable:!0,enumerable:!1,value:EA(t),writable:!0})}:oo,kA=wA(xA);function pg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function mg(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function vA(e){return e!==e}function TA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function Dh(e,t,n){return t===t?TA(e,t,n):mg(e,vA,n)}function gg(e,t){var n=e==null?0:e.length;return!!n&&Dh(e,t,0)>-1}var AA=9007199254740991,RA=/^(?:0|[1-9]\d*)$/;function jc(e,t){var n=typeof e;return t=t??AA,!!t&&(n=="number"||n!="symbol"&&RA.test(e))&&e>-1&&e%1==0&&e<t}function jh(e,t,n){t=="__proto__"&&Dc?Dc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function la(e,t){return e===t||e!==e&&t!==t}var SA=Object.prototype,OA=SA.hasOwnProperty;function zc(e,t,n){var r=e[t];(!(OA.call(e,t)&&la(r,n))||n===void 0&&!(t in e))&&jh(e,t,n)}function zh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?jh(n,a,c):zc(n,a,c)}return n}var _g=Math.max;function IA(e,t,n){return t=_g(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=_g(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),mA(e,this,a)}}function Wh(e,t){return kA(IA(e,t,oo),e+"")}var NA=9007199254740991;function Gh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=NA}function ti(e){return e!=null&&Gh(e.length)&&!xi(e)}function yg(e,t,n){if(!dr(n))return!1;var r=typeof t;return(r=="number"?ti(n)&&jc(t,n.length):r=="string"&&t in n)?la(n[t],e):!1}function CA(e){return Wh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&yg(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var LA=Object.prototype;function ua(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||LA;return e===n}function MA(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var UA="[object Arguments]";function bg(e){return Sr(e)&&Gi(e)==UA}var wg=Object.prototype,FA=wg.hasOwnProperty,PA=wg.propertyIsEnumerable,Wc=bg(function(){return arguments}())?bg:function(e){return Sr(e)&&FA.call(e,"callee")&&!PA.call(e,"callee")};function BA(){return!1}var Eg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,xg=Eg&&typeof module=="object"&&module&&!module.nodeType&&module,$A=xg&&xg.exports===Eg,kg=$A?Qr.Buffer:void 0,DA=kg?kg.isBuffer:void 0,ha=DA||BA,jA="[object Arguments]",zA="[object Array]",WA="[object Boolean]",GA="[object Date]",KA="[object Error]",HA="[object Function]",YA="[object Map]",VA="[object Number]",XA="[object Object]",qA="[object RegExp]",JA="[object Set]",ZA="[object String]",QA="[object WeakMap]",tR="[object ArrayBuffer]",eR="[object DataView]",nR="[object Float32Array]",rR="[object Float64Array]",iR="[object Int8Array]",sR="[object Int16Array]",oR="[object Int32Array]",aR="[object Uint8Array]",cR="[object Uint8ClampedArray]",lR="[object Uint16Array]",uR="[object Uint32Array]",Ee={};Ee[nR]=Ee[rR]=Ee[iR]=Ee[sR]=Ee[oR]=Ee[aR]=Ee[cR]=Ee[lR]=Ee[uR]=!0,Ee[jA]=Ee[zA]=Ee[tR]=Ee[WA]=Ee[eR]=Ee[GA]=Ee[KA]=Ee[HA]=Ee[YA]=Ee[VA]=Ee[XA]=Ee[qA]=Ee[JA]=Ee[ZA]=Ee[QA]=!1;function hR(e){return Sr(e)&&Gh(e.length)&&!!Ee[Gi(e)]}function Gc(e){return function(t){return e(t)}}var vg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fa=vg&&typeof module=="object"&&module&&!module.nodeType&&module,fR=fa&&fa.exports===vg,Kh=fR&&ig.process,Ki=function(){try{var e=fa&&fa.require&&fa.require("util").types;return e||Kh&&Kh.binding&&Kh.binding("util")}catch{}}(),Tg=Ki&&Ki.isTypedArray,Hh=Tg?Gc(Tg):hR,dR=Object.prototype,pR=dR.hasOwnProperty;function Ag(e,t){var n=re(e),r=!n&&Wc(e),i=!n&&!r&&ha(e),s=!n&&!r&&!i&&Hh(e),o=n||r||i||s,a=o?MA(e.length,String):[],c=a.length;for(var l in e)(t||pR.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||jc(l,c)))&&a.push(l);return a}function Rg(e,t){return function(n){return e(t(n))}}var mR=Rg(Object.keys,Object),gR=Object.prototype,_R=gR.hasOwnProperty;function Sg(e){if(!ua(e))return mR(e);var t=[];for(var n in Object(e))_R.call(e,n)&&n!="constructor"&&t.push(n);return t}function pr(e){return ti(e)?Ag(e):Sg(e)}var yR=Object.prototype,bR=yR.hasOwnProperty,Fn=CA(function(e,t){if(ua(t)||ti(t)){zh(t,pr(t),e);return}for(var n in t)bR.call(t,n)&&zc(e,n,t[n])});function wR(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var ER=Object.prototype,xR=ER.hasOwnProperty;function kR(e){if(!dr(e))return wR(e);var t=ua(e),n=[];for(var r in e)r=="constructor"&&(t||!xR.call(e,r))||n.push(r);return n}function Og(e){return ti(e)?Ag(e,!0):kR(e)}var vR=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,TR=/^\w*$/;function Yh(e,t){if(re(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Pc(e)?!0:TR.test(e)||!vR.test(e)||t!=null&&e in Object(t)}var da=_s(Object,"create");function AR(){this.__data__=da?da(null):{},this.size=0}function RR(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var SR="__lodash_hash_undefined__",OR=Object.prototype,IR=OR.hasOwnProperty;function NR(e){var t=this.__data__;if(da){var n=t[e];return n===SR?void 0:n}return IR.call(t,e)?t[e]:void 0}var CR=Object.prototype,LR=CR.hasOwnProperty;function MR(e){var t=this.__data__;return da?t[e]!==void 0:LR.call(t,e)}var UR="__lodash_hash_undefined__";function FR(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=da&&t===void 0?UR:t,this}function ys(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ys.prototype.clear=AR,ys.prototype.delete=RR,ys.prototype.get=NR,ys.prototype.has=MR,ys.prototype.set=FR;function PR(){this.__data__=[],this.size=0}function Kc(e,t){for(var n=e.length;n--;)if(la(e[n][0],t))return n;return-1}var BR=Array.prototype,$R=BR.splice;function DR(e){var t=this.__data__,n=Kc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():$R.call(t,n,1),--this.size,!0}function jR(e){var t=this.__data__,n=Kc(t,e);return n<0?void 0:t[n][1]}function zR(e){return Kc(this.__data__,e)>-1}function WR(e,t){var n=this.__data__,r=Kc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function ki(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ki.prototype.clear=PR,ki.prototype.delete=DR,ki.prototype.get=jR,ki.prototype.has=zR,ki.prototype.set=WR;var pa=_s(Qr,"Map");function GR(){this.size=0,this.__data__={hash:new ys,map:new(pa||ki),string:new ys}}function KR(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Hc(e,t){var n=e.__data__;return KR(t)?n[typeof t=="string"?"string":"hash"]:n.map}function HR(e){var t=Hc(this,e).delete(e);return this.size-=t?1:0,t}function YR(e){return Hc(this,e).get(e)}function VR(e){return Hc(this,e).has(e)}function XR(e,t){var n=Hc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function vi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}vi.prototype.clear=GR,vi.prototype.delete=HR,vi.prototype.get=YR,vi.prototype.has=VR,vi.prototype.set=XR;var qR="Expected a function";function Vh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(qR);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Vh.Cache||vi),n}Vh.Cache=vi;var JR=500;function ZR(e){var t=Vh(e,function(r){return n.size===JR&&n.clear(),r}),n=t.cache;return t}var QR=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tS=/\\(\\)?/g,eS=ZR(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(QR,function(n,r,i,s){t.push(i?s.replace(tS,"$1"):r||n)}),t});function Ig(e){return e==null?"":lg(e)}function Yc(e,t){return re(e)?e:Yh(e,t)?[e]:eS(Ig(e))}var nS=1/0;function ma(e){if(typeof e=="string"||Pc(e))return e;var t=e+"";return t=="0"&&1/e==-nS?"-0":t}function Xh(e,t){t=Yc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ma(t[n++])];return n&&n==r?e:void 0}function rS(e,t,n){var r=e==null?void 0:Xh(e,t);return r===void 0?n:r}function qh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Ng=fr?fr.isConcatSpreadable:void 0;function iS(e){return re(e)||Wc(e)||!!(Ng&&e&&e[Ng])}function Jh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=iS),i||(i=[]);++s<o;){var a=e[s];n(a)?qh(i,a):r||(i[i.length]=a)}return i}function tr(e){var t=e==null?0:e.length;return t?Jh(e):[]}var Cg=Rg(Object.getPrototypeOf,Object);function Zh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function sS(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:Zh(e,t,n)}var oS="\\ud800-\\udfff",aS="\\u0300-\\u036f",cS="\\ufe20-\\ufe2f",lS="\\u20d0-\\u20ff",uS=aS+cS+lS,hS="\\ufe0e\\ufe0f",fS="\\u200d",dS=RegExp("["+fS+oS+uS+hS+"]");function Lg(e){return dS.test(e)}function pS(e){return e.split("")}var Mg="\\ud800-\\udfff",mS="\\u0300-\\u036f",gS="\\ufe20-\\ufe2f",_S="\\u20d0-\\u20ff",yS=mS+gS+_S,bS="\\ufe0e\\ufe0f",wS="["+Mg+"]",Qh="["+yS+"]",tf="\\ud83c[\\udffb-\\udfff]",ES="(?:"+Qh+"|"+tf+")",Ug="[^"+Mg+"]",Fg="(?:\\ud83c[\\udde6-\\uddff]){2}",Pg="[\\ud800-\\udbff][\\udc00-\\udfff]",xS="\\u200d",Bg=ES+"?",$g="["+bS+"]?",kS="(?:"+xS+"(?:"+[Ug,Fg,Pg].join("|")+")"+$g+Bg+")*",vS=$g+Bg+kS,TS="(?:"+[Ug+Qh+"?",Qh,Fg,Pg,wS].join("|")+")",AS=RegExp(tf+"(?="+tf+")|"+TS+vS,"g");function RS(e){return e.match(AS)||[]}function SS(e){return Lg(e)?RS(e):pS(e)}function OS(e){return function(t){t=Ig(t);var n=Lg(t)?SS(t):void 0,r=n?n[0]:t.charAt(0),i=n?sS(n,1).join(""):t.slice(1);return r[e]()+i}}var Dg=OS("toUpperCase");function IS(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function NS(){this.__data__=new ki,this.size=0}function CS(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function LS(e){return this.__data__.get(e)}function MS(e){return this.__data__.has(e)}var US=200;function FS(e,t){var n=this.__data__;if(n instanceof ki){var r=n.__data__;if(!pa||r.length<US-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new vi(r)}return n.set(e,t),this.size=n.size,this}function ei(e){var t=this.__data__=new ki(e);this.size=t.size}ei.prototype.clear=NS,ei.prototype.delete=CS,ei.prototype.get=LS,ei.prototype.has=MS,ei.prototype.set=FS;function PS(e,t){return e&&zh(t,pr(t),e)}var jg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zg=jg&&typeof module=="object"&&module&&!module.nodeType&&module,BS=zg&&zg.exports===jg,Wg=BS?Qr.Buffer:void 0,Gg=Wg?Wg.allocUnsafe:void 0;function $S(e,t){var n=e.length,r=Gg?Gg(n):new e.constructor(n);return e.copy(r),r}function ef(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function Kg(){return[]}var DS=Object.prototype,jS=DS.propertyIsEnumerable,Hg=Object.getOwnPropertySymbols,nf=Hg?function(e){return e==null?[]:(e=Object(e),ef(Hg(e),function(t){return jS.call(e,t)}))}:Kg;function zS(e,t){return zh(e,nf(e),t)}var WS=Object.getOwnPropertySymbols,GS=WS?function(e){for(var t=[];e;)qh(t,nf(e)),e=Cg(e);return t}:Kg;function Yg(e,t,n){var r=t(e);return re(e)?r:qh(r,n(e))}function rf(e){return Yg(e,pr,nf)}function KS(e){return Yg(e,Og,GS)}var sf=_s(Qr,"DataView"),of=_s(Qr,"Promise"),ao=_s(Qr,"Set"),Vg="[object Map]",HS="[object Object]",Xg="[object Promise]",qg="[object Set]",Jg="[object WeakMap]",Zg="[object DataView]",YS=gs(sf),VS=gs(pa),XS=gs(of),qS=gs(ao),JS=gs($h),mr=Gi;(sf&&mr(new sf(new ArrayBuffer(1)))!=Zg||pa&&mr(new pa)!=Vg||of&&mr(of.resolve())!=Xg||ao&&mr(new ao)!=qg||$h&&mr(new $h)!=Jg)&&(mr=function(e){var t=Gi(e),n=t==HS?e.constructor:void 0,r=n?gs(n):"";if(r)switch(r){case YS:return Zg;case VS:return Vg;case XS:return Xg;case qS:return qg;case JS:return Jg}return t});var ZS=Object.prototype,QS=ZS.hasOwnProperty;function tO(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&QS.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Vc=Qr.Uint8Array;function eO(e){var t=new e.constructor(e.byteLength);return new Vc(t).set(new Vc(e)),t}function nO(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var rO=/\w*$/;function iO(e){var t=new e.constructor(e.source,rO.exec(e));return t.lastIndex=e.lastIndex,t}var Qg=fr?fr.prototype:void 0,t_=Qg?Qg.valueOf:void 0;function sO(e){return t_?Object(t_.call(e)):{}}function oO(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var aO="[object Boolean]",cO="[object Date]",lO="[object Map]",uO="[object Number]",hO="[object RegExp]",fO="[object Set]",dO="[object String]",pO="[object Symbol]",mO="[object ArrayBuffer]",gO="[object DataView]",_O="[object Float32Array]",yO="[object Float64Array]",bO="[object Int8Array]",wO="[object Int16Array]",EO="[object Int32Array]",xO="[object Uint8Array]",kO="[object Uint8ClampedArray]",vO="[object Uint16Array]",TO="[object Uint32Array]";function AO(e,t,n){var r=e.constructor;switch(t){case mO:return eO(e);case aO:case cO:return new r(+e);case gO:return nO(e);case _O:case yO:case bO:case wO:case EO:case xO:case kO:case vO:case TO:return oO(e);case lO:return new r;case uO:case dO:return new r(e);case hO:return iO(e);case fO:return new r;case pO:return sO(e)}}function RO(e){return typeof e.constructor=="function"&&!ua(e)?pA(Cg(e)):{}}var SO="[object Map]";function OO(e){return Sr(e)&&mr(e)==SO}var e_=Ki&&Ki.isMap,IO=e_?Gc(e_):OO,NO="[object Set]";function CO(e){return Sr(e)&&mr(e)==NO}var n_=Ki&&Ki.isSet,LO=n_?Gc(n_):CO,r_="[object Arguments]",MO="[object Array]",UO="[object Boolean]",FO="[object Date]",PO="[object Error]",i_="[object Function]",BO="[object GeneratorFunction]",$O="[object Map]",DO="[object Number]",s_="[object Object]",jO="[object RegExp]",zO="[object Set]",WO="[object String]",GO="[object Symbol]",KO="[object WeakMap]",HO="[object ArrayBuffer]",YO="[object DataView]",VO="[object Float32Array]",XO="[object Float64Array]",qO="[object Int8Array]",JO="[object Int16Array]",ZO="[object Int32Array]",QO="[object Uint8Array]",tI="[object Uint8ClampedArray]",eI="[object Uint16Array]",nI="[object Uint32Array]",ge={};ge[r_]=ge[MO]=ge[HO]=ge[YO]=ge[UO]=ge[FO]=ge[VO]=ge[XO]=ge[qO]=ge[JO]=ge[ZO]=ge[$O]=ge[DO]=ge[s_]=ge[jO]=ge[zO]=ge[WO]=ge[GO]=ge[QO]=ge[tI]=ge[eI]=ge[nI]=!0,ge[PO]=ge[i_]=ge[KO]=!1;function Xc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!dr(e))return e;var a=re(e);if(a)return o=tO(e),gA(e,o);var c=mr(e),l=c==i_||c==BO;if(ha(e))return $S(e);if(c==s_||c==r_||l&&!i)return o=l?{}:RO(e),zS(e,PS(o,e));if(!ge[c])return i?e:{};o=AO(e,c),s||(s=new ei);var u=s.get(e);if(u)return u;s.set(e,o),LO(e)?e.forEach(function(h){o.add(Xc(h,t,n,h,e,s))}):IO(e)&&e.forEach(function(h,m){o.set(m,Xc(h,t,n,m,e,s))});var f=rf,d=a?void 0:f(e);return pg(d||e,function(h,m){d&&(m=h,h=e[m]),zc(o,m,Xc(h,t,n,m,e,s))}),o}var rI=4;function dn(e){return Xc(e,rI)}function ga(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var iI="__lodash_hash_undefined__";function sI(e){return this.__data__.set(e,iI),this}function oI(e){return this.__data__.has(e)}function co(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new vi;++t<n;)this.add(e[t])}co.prototype.add=co.prototype.push=sI,co.prototype.has=oI;function o_(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function af(e,t){return e.has(t)}var aI=1,cI=2;function a_(e,t,n,r,i,s){var o=n&aI,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var f=-1,d=!0,h=n&cI?new co:void 0;for(s.set(e,t),s.set(t,e);++f<a;){var m=e[f],p=t[f];if(r)var w=o?r(p,m,f,t,e,s):r(m,p,f,e,t,s);if(w!==void 0){if(w)continue;d=!1;break}if(h){if(!o_(t,function(b,v){if(!af(h,v)&&(m===b||i(m,b,n,r,s)))return h.push(v)})){d=!1;break}}else if(!(m===p||i(m,p,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function lI(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function cf(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var uI=1,hI=2,fI="[object Boolean]",dI="[object Date]",pI="[object Error]",mI="[object Map]",gI="[object Number]",_I="[object RegExp]",yI="[object Set]",bI="[object String]",wI="[object Symbol]",EI="[object ArrayBuffer]",xI="[object DataView]",c_=fr?fr.prototype:void 0,lf=c_?c_.valueOf:void 0;function kI(e,t,n,r,i,s,o){switch(n){case xI:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case EI:return!(e.byteLength!=t.byteLength||!s(new Vc(e),new Vc(t)));case fI:case dI:case gI:return la(+e,+t);case pI:return e.name==t.name&&e.message==t.message;case _I:case bI:return e==t+"";case mI:var a=lI;case yI:var c=r&uI;if(a||(a=cf),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=hI,o.set(e,t);var u=a_(a(e),a(t),r,i,s,o);return o.delete(e),u;case wI:if(lf)return lf.call(e)==lf.call(t)}return!1}var vI=1,TI=Object.prototype,AI=TI.hasOwnProperty;function RI(e,t,n,r,i,s){var o=n&vI,a=rf(e),c=a.length,l=rf(t),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in t:AI.call(t,d)))return!1}var h=s.get(e),m=s.get(t);if(h&&m)return h==t&&m==e;var p=!0;s.set(e,t),s.set(t,e);for(var w=o;++f<c;){d=a[f];var b=e[d],v=t[d];if(r)var A=o?r(v,b,d,t,e,s):r(b,v,d,e,t,s);if(!(A===void 0?b===v||i(b,v,n,r,s):A)){p=!1;break}w||(w=d=="constructor")}if(p&&!w){var R=e.constructor,M=t.constructor;R!=M&&"constructor"in e&&"constructor"in t&&!(typeof R=="function"&&R instanceof R&&typeof M=="function"&&M instanceof M)&&(p=!1)}return s.delete(e),s.delete(t),p}var SI=1,l_="[object Arguments]",u_="[object Array]",qc="[object Object]",OI=Object.prototype,h_=OI.hasOwnProperty;function II(e,t,n,r,i,s){var o=re(e),a=re(t),c=o?u_:mr(e),l=a?u_:mr(t);c=c==l_?qc:c,l=l==l_?qc:l;var u=c==qc,f=l==qc,d=c==l;if(d&&ha(e)){if(!ha(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ei),o||Hh(e)?a_(e,t,n,r,i,s):kI(e,t,c,n,r,i,s);if(!(n&SI)){var h=u&&h_.call(e,"__wrapped__"),m=f&&h_.call(t,"__wrapped__");if(h||m){var p=h?e.value():e,w=m?t.value():t;return s||(s=new ei),i(p,w,n,r,s)}}return d?(s||(s=new ei),RI(e,t,n,r,i,s)):!1}function uf(e,t,n,r,i){return e===t?!0:e==null||t==null||!Sr(e)&&!Sr(t)?e!==e&&t!==t:II(e,t,n,r,uf,i)}var NI=1,CI=2;function LI(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new ei,f;if(!(f===void 0?uf(l,c,NI|CI,r,u):f))return!1}}return!0}function f_(e){return e===e&&!dr(e)}function MI(e){for(var t=pr(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,f_(i)]}return t}function d_(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function UI(e){var t=MI(e);return t.length==1&&t[0][2]?d_(t[0][0],t[0][1]):function(n){return n===e||LI(n,e,t)}}function FI(e,t){return e!=null&&t in Object(e)}function p_(e,t,n){t=Yc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=ma(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Gh(i)&&jc(o,i)&&(re(e)||Wc(e)))}function PI(e,t){return e!=null&&p_(e,t,FI)}var BI=1,$I=2;function DI(e,t){return Yh(e)&&f_(t)?d_(ma(e),t):function(n){var r=rS(n,e);return r===void 0&&r===t?PI(n,e):uf(t,r,BI|$I)}}function jI(e){return function(t){return t==null?void 0:t[e]}}function zI(e){return function(t){return Xh(t,e)}}function WI(e){return Yh(e)?jI(ma(e)):zI(e)}function ni(e){return typeof e=="function"?e:e==null?oo:typeof e=="object"?re(e)?DI(e[0],e[1]):UI(e):WI(e)}function GI(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function KI(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var HI=KI();function YI(e,t){return e&&HI(e,t,pr)}function VI(e,t){return function(n,r){if(n==null)return n;if(!ti(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var bs=VI(YI);function XI(e,t,n,r){return bs(e,function(i,s,o){t(r,i,n(i),o)}),r}function qI(e,t){return function(n,r){var i=re(n)?GI:XI,s=t?t():{};return i(n,e,ni(r),s)}}var m_=Object.prototype,JI=m_.hasOwnProperty,hf=Wh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&yg(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Og(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||la(u,m_[l])&&!JI.call(e,l))&&(e[l]=s[l])}return e});function g_(e){return Sr(e)&&ti(e)}var ZI=200;function QI(e,t,n,r){var i=-1,s=gg,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=ZI&&(s=af,o=!1,t=new co(t));t:for(;++i<a;){var u=e[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(t[d]===f)continue t;c.push(u)}else s(t,f,r)||c.push(u)}return c}var Jc=Wh(function(e,t){return g_(e)?QI(e,Jh(t,1,g_,!0)):[]});function lo(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function pn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:$c(t),Zh(e,t<0?0:t,r)):[]}function _a(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:$c(t),t=r-t,Zh(e,0,t<0?0:t)):[]}function tN(e){return typeof e=="function"?e:oo}function Lt(e,t){var n=re(e)?pg:bs;return n(e,tN(t))}function eN(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function nN(e,t){var n=!0;return bs(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function Or(e,t,n){var r=re(e)?eN:nN;return r(e,ni(t))}function __(e,t){var n=[];return bs(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function gr(e,t){var n=re(e)?ef:__;return n(e,ni(t))}function rN(e){return function(t,n,r){var i=Object(t);if(!ti(t)){var s=ni(n);t=pr(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var iN=Math.max;function sN(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:$c(n);return i<0&&(i=iN(r+i,0)),mg(e,ni(t),i)}var uo=rN(sN);function Ir(e){return e&&e.length?e[0]:void 0}function oN(e,t){var n=-1,r=ti(e)?Array(e.length):[];return bs(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function xt(e,t){var n=re(e)?Bc:oN;return n(e,ni(t))}function _r(e,t){return Jh(xt(e,t))}var aN=Object.prototype,cN=aN.hasOwnProperty,y_=qI(function(e,t,n){cN.call(e,n)?e[n].push(t):jh(e,n,[t])}),lN=Object.prototype,uN=lN.hasOwnProperty;function hN(e,t){return e!=null&&uN.call(e,t)}function Ct(e,t){return e!=null&&p_(e,t,hN)}var fN="[object String]";function Pn(e){return typeof e=="string"||!re(e)&&Sr(e)&&Gi(e)==fN}function dN(e,t){return Bc(t,function(n){return e[n]})}function Ke(e){return e==null?[]:dN(e,pr(e))}var pN=Math.max;function vn(e,t,n,r){e=ti(e)?e:Ke(e),n=n&&!r?$c(n):0;var i=e.length;return n<0&&(n=pN(i+n,0)),Pn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Dh(e,t,n)>-1}function b_(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return Dh(e,t,i)}var mN="[object Map]",gN="[object Set]",_N=Object.prototype,yN=_N.hasOwnProperty;function _e(e){if(e==null)return!0;if(ti(e)&&(re(e)||typeof e=="string"||typeof e.splice=="function"||ha(e)||Hh(e)||Wc(e)))return!e.length;var t=mr(e);if(t==mN||t==gN)return!e.size;if(ua(e))return!Sg(e).length;for(var n in e)if(yN.call(e,n))return!1;return!0}var bN="[object RegExp]";function wN(e){return Sr(e)&&Gi(e)==bN}var w_=Ki&&Ki.isRegExp,Ti=w_?Gc(w_):wN;function Ai(e){return e===void 0}var EN="Expected a function";function xN(e){if(typeof e!="function")throw new TypeError(EN);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function kN(e,t,n,r){if(!dr(e))return e;t=Yc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=ma(t[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=dr(u)?u:jc(t[i+1])?[]:{})}zc(a,c,l),a=a[c]}return e}function vN(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Xh(e,o);n(a,o)&&kN(s,Yc(o,e),a)}return s}function Nr(e,t){if(e==null)return{};var n=Bc(KS(e),function(r){return[r]});return t=ni(t),vN(e,n,function(r,i){return t(r,i[0])})}function TN(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Bn(e,t,n){var r=re(e)?IS:TN,i=arguments.length<3;return r(e,ni(t),n,i,bs)}function Zc(e,t){var n=re(e)?ef:__;return n(e,xN(ni(t)))}function AN(e,t){var n;return bs(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function ff(e,t,n){var r=re(e)?o_:AN;return r(e,ni(t))}var RN=1/0,SN=ao&&1/cf(new ao([,-0]))[1]==RN?function(e){return new ao(e)}:Je,ON=200;function IN(e,t,n){var r=-1,i=gg,s=e.length,o=!0,a=[],c=a;if(s>=ON){var l=SN(e);if(l)return cf(l);o=!1,i=af,c=new co}else c=a;t:for(;++r<s;){var u=e[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function Qc(e){return e&&e.length?IN(e):[]}function df(e){console&&console.error&&console.error(`Error: ${e}`)}function E_(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function x_(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function k_(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function NN(e){return CN(e)?e.LABEL:e.name}function CN(e){return Pn(e.LABEL)&&e.LABEL!==""}class ri{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Lt(this.definition,n=>{n.accept(t)})}}class $n extends ri{constructor(t){super([]),this.idx=1,Fn(this,Nr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class ho extends ri{constructor(t){super(t.definition),this.orgText="",Fn(this,Nr(t,n=>n!==void 0))}}class Dn extends ri{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Fn(this,Nr(t,n=>n!==void 0))}}class jn extends ri{constructor(t){super(t.definition),this.idx=1,Fn(this,Nr(t,n=>n!==void 0))}}class ii extends ri{constructor(t){super(t.definition),this.idx=1,Fn(this,Nr(t,n=>n!==void 0))}}class si extends ri{constructor(t){super(t.definition),this.idx=1,Fn(this,Nr(t,n=>n!==void 0))}}class Ze extends ri{constructor(t){super(t.definition),this.idx=1,Fn(this,Nr(t,n=>n!==void 0))}}class Cr extends ri{constructor(t){super(t.definition),this.idx=1,Fn(this,Nr(t,n=>n!==void 0))}}class Lr extends ri{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Fn(this,Nr(t,n=>n!==void 0))}}class Ce{constructor(t){this.idx=1,Fn(this,Nr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function LN(e){return xt(e,tl)}function tl(e){function t(n){return xt(n,tl)}if(e instanceof $n){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Pn(e.label)&&(n.label=e.label),n}else{if(e instanceof Dn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof jn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof ii)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof si)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:tl(new Ce({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Cr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:tl(new Ce({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Ze)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Lr)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Ce){const n={type:"Terminal",name:e.terminalType.name,label:NN(e.terminalType),idx:e.idx};Pn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Ti(r)?r.source:r),n}else{if(e instanceof ho)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class ws{visit(t){const n=t;switch(n.constructor){case $n:return this.visitNonTerminal(n);case Dn:return this.visitAlternative(n);case jn:return this.visitOption(n);case ii:return this.visitRepetitionMandatory(n);case si:return this.visitRepetitionMandatoryWithSeparator(n);case Cr:return this.visitRepetitionWithSeparator(n);case Ze:return this.visitRepetition(n);case Lr:return this.visitAlternation(n);case Ce:return this.visitTerminal(n);case ho:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function MN(e){return e instanceof Dn||e instanceof jn||e instanceof Ze||e instanceof ii||e instanceof si||e instanceof Cr||e instanceof Ce||e instanceof ho}function el(e,t=[]){return e instanceof jn||e instanceof Ze||e instanceof Cr?!0:e instanceof Lr?ff(e.definition,r=>el(r,t)):e instanceof $n&&vn(t,e)?!1:e instanceof ri?(e instanceof $n&&t.push(e),Or(e.definition,r=>el(r,t))):!1}function UN(e){return e instanceof Lr}function oi(e){if(e instanceof $n)return"SUBRULE";if(e instanceof jn)return"OPTION";if(e instanceof Lr)return"OR";if(e instanceof ii)return"AT_LEAST_ONE";if(e instanceof si)return"AT_LEAST_ONE_SEP";if(e instanceof Cr)return"MANY_SEP";if(e instanceof Ze)return"MANY";if(e instanceof Ce)return"CONSUME";throw Error("non exhaustive match")}class nl{walk(t,n=[]){Lt(t.definition,(r,i)=>{const s=pn(t.definition,i+1);if(r instanceof $n)this.walkProdRef(r,s,n);else if(r instanceof Ce)this.walkTerminal(r,s,n);else if(r instanceof Dn)this.walkFlat(r,s,n);else if(r instanceof jn)this.walkOption(r,s,n);else if(r instanceof ii)this.walkAtLeastOne(r,s,n);else if(r instanceof si)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Cr)this.walkManySep(r,s,n);else if(r instanceof Ze)this.walkMany(r,s,n);else if(r instanceof Lr)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new jn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=v_(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new jn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=v_(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);Lt(t.definition,s=>{const o=new Dn({definition:[s]});this.walk(o,i)})}}function v_(e,t,n){return[new jn({definition:[new Ce({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function ya(e){if(e instanceof $n)return ya(e.referencedRule);if(e instanceof Ce)return BN(e);if(MN(e))return FN(e);if(UN(e))return PN(e);throw Error("non exhaustive match")}function FN(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=el(s),t=t.concat(ya(s)),r=r+1,i=n.length>r;return Qc(t)}function PN(e){const t=xt(e.definition,n=>ya(n));return Qc(tr(t))}function BN(e){return[e.terminalType]}const T_="_~IN~_";class $N extends nl{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=jN(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Dn({definition:s}),a=ya(o);this.follows[i]=a}}function DN(e){const t={};return Lt(e,n=>{const r=new $N(n).startWalking();Fn(t,r)}),t}function jN(e,t){return e.name+t+T_}function Ut(e){return e.charCodeAt(0)}function pf(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function ba(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function fo(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function zN(){throw Error("Internal Error - Should never get here!")}function A_(e){return e.type==="Character"}const rl=[];for(let e=Ut("0");e<=Ut("9");e++)rl.push(e);const il=[Ut("_")].concat(rl);for(let e=Ut("a");e<=Ut("z");e++)il.push(e);for(let e=Ut("A");e<=Ut("Z");e++)il.push(e);const R_=[Ut(" "),Ut("\f"),Ut(`
`),Ut("\r"),Ut("	"),Ut("\v"),Ut("	"),Ut("Â "),Ut("á"),Ut("â"),Ut("â"),Ut("â"),Ut("â"),Ut("â"),Ut("â"),Ut("â"),Ut("â"),Ut("â"),Ut("â"),Ut("â"),Ut("\u2028"),Ut("\u2029"),Ut("â¯"),Ut("â"),Ut("ã"),Ut("\uFEFF")],WN=/[0-9a-fA-F]/,sl=/[0-9]/,GN=/[1-9]/;class KN{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":ba(r,"global");break;case"i":ba(r,"ignoreCase");break;case"m":ba(r,"multiLine");break;case"u":ba(r,"unicode");break;case"y":ba(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}fo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return zN()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;fo(n);break}if(!(t===!0&&n===void 0)&&fo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),fo(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ut(`
`),Ut("\r"),Ut("\u2028"),Ut("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=rl;break;case"D":t=rl,n=!0;break;case"s":t=R_;break;case"S":t=R_,n=!0;break;case"w":t=il;break;case"W":t=il,n=!0;break}if(fo(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Ut("\f");break;case"n":t=Ut(`
`);break;case"r":t=Ut("\r");break;case"t":t=Ut("	");break;case"v":t=Ut("\v");break}if(fo(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ut("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Ut(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Ut(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,A_(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,A_(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else pf(r.value,t),t.push(Ut("-")),pf(i.value,t)}else pf(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ut("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(GN.test(t)===!1)throw Error("Expecting a positive integer");for(;sl.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(sl.test(t)===!1)throw Error("Expecting an integer");for(;sl.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ut(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return sl.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(WN.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class mf{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let ol={};const HN=new KN;function al(e){const t=e.toString();if(ol.hasOwnProperty(t))return ol[t];{const n=HN.pattern(t);return ol[t]=n,n}}function YN(){ol={}}const S_="Complement Sets are not supported for first char optimization",cl=`Unable to use "first char" lexer optimizations:
`;function VN(e,t=!1){try{const n=al(e);return gf(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===S_)t&&E_(`${cl}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),df(`${cl}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function gf(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)gf(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":ll(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(S_);Lt(o.value,c=>{if(typeof c=="number")ll(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)ll(u,t,n);else{for(let u=l.from;u<=l.to&&u<Ea;u++)ll(u,t,n);if(l.to>=Ea){const u=l.from>=Ea?l.from:Ea,f=l.to,d=Hi(u),h=Hi(f);for(let m=d;m<=h;m++)t[m]=m}}}});break;case"Group":gf(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&_f(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ke(t)}function ll(e,t,n){const r=Hi(e);t[r]=r,n===!0&&XN(e,t)}function XN(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Hi(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Hi(i.charCodeAt(0));t[s]=s}}}function O_(e,t){return uo(e.value,n=>{if(typeof n=="number")return vn(t,n);{const r=n;return uo(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function _f(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?re(e.value)?Or(e.value,_f):_f(e.value):!1}class qN extends mf{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){vn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?O_(t,this.targetCharCodes)===void 0&&(this.found=!0):O_(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function yf(e,t){if(t instanceof RegExp){const n=al(t),r=new qN(e);return r.visit(n),r.found}else return uo(t,n=>vn(e,n.charCodeAt(0)))!==void 0}const Es="PATTERN",wa="defaultMode",ul="modes";let I_=typeof new RegExp("(?:)").sticky=="boolean";function JN(e,t){t=hf(t,{useSticky:I_,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(v,A)=>A()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{wC()});let r;n("Reject Lexer.NA",()=>{r=Zc(e,v=>v[Es]===Qe.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=xt(r,v=>{const A=v[Es];if(Ti(A)){const R=A.source;return R.length===1&&R!=="^"&&R!=="$"&&R!=="."&&!A.ignoreCase?R:R.length===2&&R[0]==="\\"&&!vn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],R[1])?R[1]:t.useSticky?C_(A):N_(A)}else{if(xi(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const R=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),M=new RegExp(R);return t.useSticky?C_(M):N_(M)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=xt(r,v=>v.tokenTypeIdx),a=xt(r,v=>{const A=v.GROUP;if(A!==Qe.SKIPPED){if(Pn(A))return A;if(Ai(A))return!1;throw Error("non exhaustive match")}}),c=xt(r,v=>{const A=v.LONGER_ALT;if(A)return re(A)?xt(A,M=>b_(r,M)):[b_(r,A)]}),l=xt(r,v=>v.PUSH_MODE),u=xt(r,v=>Ct(v,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const v=U_(t.lineTerminatorCharacters);f=xt(r,A=>!1),t.positionTracking!=="onlyOffset"&&(f=xt(r,A=>Ct(A,"LINE_BREAKS")?!!A.LINE_BREAKS:M_(A,v)===!1&&yf(v,A.PATTERN)))});let d,h,m,p;n("Misc Mapping #2",()=>{d=xt(r,L_),h=xt(s,_C),m=Bn(r,(v,A)=>{const R=A.GROUP;return Pn(R)&&R!==Qe.SKIPPED&&(v[R]=[]),v},{}),p=xt(s,(v,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:f[A],isCustom:d[A],short:h[A],group:a[A],push:l[A],pop:u[A],tokenTypeIdx:o[A],tokenType:r[A]}))});let w=!0,b=[];return t.safeMode||n("First Char Optimization",()=>{b=Bn(r,(v,A,R)=>{if(typeof A.PATTERN=="string"){const M=A.PATTERN.charCodeAt(0),S=Hi(M);bf(v,S,p[R])}else if(re(A.START_CHARS_HINT)){let M;Lt(A.START_CHARS_HINT,S=>{const I=typeof S=="string"?S.charCodeAt(0):S,P=Hi(I);M!==P&&(M=P,bf(v,P,p[R]))})}else if(Ti(A.PATTERN))if(A.PATTERN.unicode)w=!1,t.ensureOptimizations&&df(`${cl}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const M=VN(A.PATTERN,t.ensureOptimizations);_e(M)&&(w=!1),Lt(M,S=>{bf(v,S,p[R])})}else t.ensureOptimizations&&df(`${cl}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),w=!1;return v},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:b,hasCustom:i,canBeOptimized:w}}function ZN(e,t){let n=[];const r=tC(e);n=n.concat(r.errors);const i=eC(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(QN(s)),n=n.concat(lC(s)),n=n.concat(uC(s,t)),n=n.concat(hC(s)),n}function QN(e){let t=[];const n=gr(e,r=>Ti(r[Es]));return t=t.concat(rC(n)),t=t.concat(oC(n)),t=t.concat(aC(n)),t=t.concat(cC(n)),t=t.concat(iC(n)),t}function tC(e){const t=gr(e,i=>!Ct(i,Es)),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Fe.MISSING_PATTERN,tokenTypes:[i]})),r=Jc(e,t);return{errors:n,valid:r}}function eC(e){const t=gr(e,i=>{const s=i[Es];return!Ti(s)&&!xi(s)&&!Ct(s,"exec")&&!Pn(s)}),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Fe.INVALID_PATTERN,tokenTypes:[i]})),r=Jc(e,t);return{errors:n,valid:r}}const nC=/[^\\][$]/;function rC(e){class t extends mf{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=gr(e,i=>{const s=i.PATTERN;try{const o=al(s),a=new t;return a.visit(o),a.found}catch{return nC.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Fe.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function iC(e){const t=gr(e,r=>r.PATTERN.test(""));return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Fe.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const sC=/[^\\[][\^]|^\^/;function oC(e){class t extends mf{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=gr(e,i=>{const s=i.PATTERN;try{const o=al(s),a=new t;return a.visit(o),a.found}catch{return sC.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Fe.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function aC(e){const t=gr(e,r=>{const i=r[Es];return i instanceof RegExp&&(i.multiline||i.global)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Fe.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function cC(e){const t=[];let n=xt(e,s=>Bn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!vn(t,a)&&a.PATTERN!==Qe.NA&&(t.push(a),o.push(a)),o),[]));n=ga(n);const r=gr(n,s=>s.length>1);return xt(r,s=>{const o=xt(s,c=>c.name);return{message:`The same RegExp pattern ->${Ir(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Fe.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function lC(e){const t=gr(e,r=>{if(!Ct(r,"GROUP"))return!1;const i=r.GROUP;return i!==Qe.SKIPPED&&i!==Qe.NA&&!Pn(i)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Fe.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function uC(e,t){const n=gr(e,i=>i.PUSH_MODE!==void 0&&!vn(t,i.PUSH_MODE));return xt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Fe.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function hC(e){const t=[],n=Bn(e,(r,i,s)=>{const o=i.PATTERN;return o===Qe.NA||(Pn(o)?r.push({str:o,idx:s,tokenType:i}):Ti(o)&&dC(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Lt(e,(r,i)=>{Lt(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&fC(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Fe.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function fC(e,t){if(Ti(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(xi(t))return t(e,0,[],{});if(Ct(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function dC(e){return uo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function N_(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function C_(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function pC(e,t,n){const r=[];return Ct(e,wa)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+wa+`> property in its definition
`,type:Fe.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ct(e,ul)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ul+`> property in its definition
`,type:Fe.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ct(e,ul)&&Ct(e,wa)&&!Ct(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${wa}: <${e.defaultMode}>which does not exist
`,type:Fe.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ct(e,ul)&&Lt(e.modes,(i,s)=>{Lt(i,(o,a)=>{if(Ai(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Fe.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ct(o,"LONGER_ALT")){const c=re(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Lt(c,l=>{!Ai(l)&&!vn(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Fe.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function mC(e,t,n){const r=[];let i=!1;const s=ga(tr(Ke(e.modes))),o=Zc(s,c=>c[Es]===Qe.NA),a=U_(n);return t&&Lt(o,c=>{const l=M_(c,a);if(l!==!1){const f={message:bC(c,l),type:l.issue,tokenType:c};r.push(f)}else Ct(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):yf(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Fe.NO_LINE_BREAKS_FLAGS}),r}function gC(e){const t={},n=pr(e);return Lt(n,r=>{const i=e[r];if(re(i))t[r]=[];else throw Error("non exhaustive match")}),t}function L_(e){const t=e.PATTERN;if(Ti(t))return!1;if(xi(t))return!0;if(Ct(t,"exec"))return!0;if(Pn(t))return!1;throw Error("non exhaustive match")}function _C(e){return Pn(e)&&e.length===1?e.charCodeAt(0):!1}const yC={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function M_(e,t){if(Ct(e,"LINE_BREAKS"))return!1;if(Ti(e.PATTERN)){try{yf(t,e.PATTERN)}catch(n){return{issue:Fe.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Pn(e.PATTERN))return!1;if(L_(e))return{issue:Fe.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function bC(e,t){if(t.issue===Fe.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Fe.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function U_(e){return xt(e,n=>Pn(n)?n.charCodeAt(0):n)}function bf(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const Ea=256;let hl=[];function Hi(e){return e<Ea?e:hl[e]}function wC(){if(_e(hl)){hl=new Array(65536);for(let e=0;e<65536;e++)hl[e]=e>255?255+~~(e/255):e}}function xa(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function fl(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let F_=1;const P_={};function ka(e){const t=EC(e);xC(t),vC(t),kC(t),Lt(t,n=>{n.isParent=n.categoryMatches.length>0})}function EC(e){let t=dn(e),n=e,r=!0;for(;r;){n=ga(tr(xt(n,s=>s.CATEGORIES)));const i=Jc(n,t);t=t.concat(i),_e(i)?r=!1:n=i}return t}function xC(e){Lt(e,t=>{$_(t)||(P_[F_]=t,t.tokenTypeIdx=F_++),D_(t)&&!re(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),D_(t)||(t.CATEGORIES=[]),TC(t)||(t.categoryMatches=[]),AC(t)||(t.categoryMatchesMap={})})}function kC(e){Lt(e,t=>{t.categoryMatches=[],Lt(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(P_[r].tokenTypeIdx)})})}function vC(e){Lt(e,t=>{B_([],t)})}function B_(e,t){Lt(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),Lt(t.CATEGORIES,n=>{const r=e.concat(t);vn(r,n)||B_(r,n)})}function $_(e){return Ct(e,"tokenTypeIdx")}function D_(e){return Ct(e,"CATEGORIES")}function TC(e){return Ct(e,"categoryMatches")}function AC(e){return Ct(e,"categoryMatchesMap")}function RC(e){return Ct(e,"tokenTypeIdx")}const SC={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Fe;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Fe||(Fe={}));const va={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:SC,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(va);let Qe=class{constructor(t,n=va){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=x_(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Fn({},va,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===va.lineTerminatorsPattern)this.config.lineTerminatorsPattern=yC;else if(this.config.lineTerminatorCharacters===va.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),re(t)?i={modes:{defaultMode:dn(t)},defaultMode:wa}:(s=!1,i=dn(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(pC(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(mC(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Lt(i.modes,(a,c)=>{i.modes[c]=Zc(a,l=>Ai(l))});const o=pr(i.modes);if(Lt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(ZN(a,o))}),_e(this.lexerDefinitionErrors)){ka(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=JN(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Fn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!_e(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=xt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Lt(this.lexerDefinitionWarning,a=>{E_(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(I_?(this.chopInput=oo,this.match=this.matchWithTest):(this.updateLastIndex=Je,this.match=this.matchWithExec),s&&(this.handleModes=Je),this.trackStartLines===!1&&(this.computeNewColumn=oo),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Je),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Bn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!_e(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{YN()}),this.TRACE_INIT("toFastProperties",()=>{k_(this)})})}tokenize(t,n=this.defaultMode){if(!_e(this.lexerDefinitionErrors)){const i=xt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,l,u,f,d,h,m,p,w,b;const v=t,A=v.length;let R=0,M=0;const S=this.hasCustom?0:Math.floor(t.length/10),I=new Array(S),P=[];let C=this.trackStartLines?1:void 0,D=this.trackStartLines?1:void 0;const G=gC(this.emptyGroups),U=this.trackStartLines,T=this.config.lineTerminatorsPattern;let _=0,N=[],V=[];const B=[],at=[];Object.freeze(at);let Z;function lt(){return N}function X(zt){const oe=Hi(zt),$t=V[oe];return $t===void 0?at:$t}const W=zt=>{if(B.length===1&&zt.tokenType.PUSH_MODE===void 0){const oe=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(zt);P.push({offset:zt.startOffset,line:zt.startLine,column:zt.startColumn,length:zt.image.length,message:oe})}else{B.pop();const oe=lo(B);N=this.patternIdxToConfig[oe],V=this.charCodeToPatternIdxToConfig[oe],_=N.length;const $t=this.canModeBeOptimized[oe]&&this.config.safeMode===!1;V&&$t?Z=X:Z=lt}};function kt(zt){B.push(zt),V=this.charCodeToPatternIdxToConfig[zt],N=this.patternIdxToConfig[zt],_=N.length,_=N.length;const oe=this.canModeBeOptimized[zt]&&this.config.safeMode===!1;V&&oe?Z=X:Z=lt}kt.call(this,n);let ct;const ht=this.config.recoveryEnabled;for(;R<A;){c=null;const zt=v.charCodeAt(R),oe=Z(zt),$t=oe.length;for(r=0;r<$t;r++){ct=oe[r];const Pt=ct.pattern;l=null;const ce=ct.short;if(ce!==!1?zt===ce&&(c=Pt):ct.isCustom===!0?(b=Pt.exec(v,R,I,G),b!==null?(c=b[0],b.payload!==void 0&&(l=b.payload)):c=null):(this.updateLastIndex(Pt,R),c=this.match(Pt,t,R)),c!==null){if(a=ct.longerAlt,a!==void 0){const Xt=a.length;for(s=0;s<Xt;s++){const Se=N[a[s]],Be=Se.pattern;if(u=null,Se.isCustom===!0?(b=Be.exec(v,R,I,G),b!==null?(o=b[0],b.payload!==void 0&&(u=b.payload)):o=null):(this.updateLastIndex(Be,R),o=this.match(Be,t,R)),o&&o.length>c.length){c=o,l=u,ct=Se;break}}}break}}if(c!==null){if(f=c.length,d=ct.group,d!==void 0&&(h=ct.tokenTypeIdx,m=this.createTokenInstance(c,R,h,ct.tokenType,C,D,f),this.handlePayload(m,l),d===!1?M=this.addToken(I,M,m):G[d].push(m)),t=this.chopInput(t,f),R=R+f,D=this.computeNewColumn(D,f),U===!0&&ct.canLineTerminator===!0){let Pt=0,ce,Xt;T.lastIndex=0;do ce=T.test(c),ce===!0&&(Xt=T.lastIndex-1,Pt++);while(ce===!0);Pt!==0&&(C=C+Pt,D=f-Xt,this.updateTokenEndLineColumnLocation(m,d,Xt,Pt,C,D,f))}this.handleModes(ct,W,kt,m)}else{const Pt=R,ce=C,Xt=D;let Se=ht===!1;for(;Se===!1&&R<A;)for(t=this.chopInput(t,1),R++,i=0;i<_;i++){const Be=N[i],k=Be.pattern,st=Be.short;if(st!==!1?v.charCodeAt(R)===st&&(Se=!0):Be.isCustom===!0?Se=k.exec(v,R,I,G)!==null:(this.updateLastIndex(k,R),Se=k.exec(t)!==null),Se===!0)break}if(p=R-Pt,D=this.computeNewColumn(D,p),w=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,Pt,p,ce,Xt),P.push({offset:Pt,line:ce,column:Xt,length:p,message:w}),ht===!1)break}}return this.hasCustom||(I.length=M),{tokens:I,groups:G,errors:P}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};Qe.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Qe.NA=/NOT_APPLICABLE/;function Ta(e){return j_(e)?e.LABEL:e.name}function j_(e){return Pn(e.LABEL)&&e.LABEL!==""}const OC="parent",z_="categories",W_="label",G_="group",K_="push_mode",H_="pop_mode",Y_="longer_alt",V_="line_breaks",X_="start_chars_hint";function er(e){return IC(e)}function IC(e){const t=e.pattern,n={};if(n.name=e.name,Ai(t)||(n.PATTERN=t),Ct(e,OC))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ct(e,z_)&&(n.CATEGORIES=e[z_]),ka([n]),Ct(e,W_)&&(n.LABEL=e[W_]),Ct(e,G_)&&(n.GROUP=e[G_]),Ct(e,H_)&&(n.POP_MODE=e[H_]),Ct(e,K_)&&(n.PUSH_MODE=e[K_]),Ct(e,Y_)&&(n.LONGER_ALT=e[Y_]),Ct(e,V_)&&(n.LINE_BREAKS=e[V_]),Ct(e,X_)&&(n.START_CHARS_HINT=e[X_]),n}const xs=er({name:"EOF",pattern:Qe.NA});ka([xs]);function dl(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function NC(e,t){return xa(e,t)}const q_={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${j_(e)?`--> ${Ta(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Ir(t).image+"'";if(r)return s+r+a;{const c=Bn(e,(d,h)=>d.concat(h),[]),l=xt(c,d=>`[${xt(d,h=>Ta(h)).join(", ")}]`),f=`one of these possible Token sequences:
${xt(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Ir(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${xt(e,l=>`[${xt(l,u=>Ta(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(q_);const CC={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},ks={buildDuplicateFoundError(e,t){function n(u){return u instanceof Ce?u.terminalType.name:u instanceof $n?u.nonTerminalName:""}const r=e.name,i=Ir(t),s=i.idx,o=oi(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=xt(e.prefixPath,i=>Ta(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=xt(e.prefixPath,i=>Ta(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=oi(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=xt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof ho?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function LC(e,t){const n=new MC(e,t);return n.resolveRefs(),n.errors}class MC extends ws{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Lt(Ke(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:Tn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class UC extends nl{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=dn(this.path.ruleStack).reverse(),this.occurrenceStack=dn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){_e(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class FC extends UC{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Dn({definition:i});this.possibleTokTypes=ya(s),this.found=!0}}}class pl extends nl{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class PC extends pl{walkMany(t,n,r){if(t.idx===this.occurrence){const i=Ir(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class J_ extends pl{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=Ir(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class BC extends pl{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=Ir(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class Z_ extends pl{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=Ir(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function wf(e,t,n=[]){n=dn(n);let r=[],i=0;function s(a){return a.concat(pn(e,i+1))}function o(a){const c=wf(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Dn)return o(a.definition);if(a instanceof $n)return o(a.definition);if(a instanceof jn)r=o(a.definition);else if(a instanceof ii){const c=a.definition.concat([new Ze({definition:a.definition})]);return o(c)}else if(a instanceof si){const c=[new Dn({definition:a.definition}),new Ze({definition:[new Ce({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Cr){const c=a.definition.concat([new Ze({definition:[new Ce({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Ze){const c=a.definition.concat([new Ze({definition:a.definition})]);r=o(c)}else{if(a instanceof Lr)return Lt(a.definition,c=>{_e(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ce)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:pn(e,i)}),r}function Q_(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!_e(f);){const d=f.pop();if(d===o){a&&lo(f).idx<=l&&f.pop();continue}const h=d.def,m=d.idx,p=d.ruleStack,w=d.occurrenceStack;if(_e(h))continue;const b=h[0];if(b===i){const v={idx:m,def:pn(h),ruleStack:_a(p),occurrenceStack:_a(w)};f.push(v)}else if(b instanceof Ce)if(m<c-1){const v=m+1,A=t[v];if(n(A,b.terminalType)){const R={idx:v,def:pn(h),ruleStack:p,occurrenceStack:w};f.push(R)}}else if(m===c-1)u.push({nextTokenType:b.terminalType,nextTokenOccurrence:b.idx,ruleStack:p,occurrenceStack:w}),a=!0;else throw Error("non exhaustive match");else if(b instanceof $n){const v=dn(p);v.push(b.nonTerminalName);const A=dn(w);A.push(b.idx);const R={idx:m,def:b.definition.concat(s,pn(h)),ruleStack:v,occurrenceStack:A};f.push(R)}else if(b instanceof jn){const v={idx:m,def:pn(h),ruleStack:p,occurrenceStack:w};f.push(v),f.push(o);const A={idx:m,def:b.definition.concat(pn(h)),ruleStack:p,occurrenceStack:w};f.push(A)}else if(b instanceof ii){const v=new Ze({definition:b.definition,idx:b.idx}),A=b.definition.concat([v],pn(h)),R={idx:m,def:A,ruleStack:p,occurrenceStack:w};f.push(R)}else if(b instanceof si){const v=new Ce({terminalType:b.separator}),A=new Ze({definition:[v].concat(b.definition),idx:b.idx}),R=b.definition.concat([A],pn(h)),M={idx:m,def:R,ruleStack:p,occurrenceStack:w};f.push(M)}else if(b instanceof Cr){const v={idx:m,def:pn(h),ruleStack:p,occurrenceStack:w};f.push(v),f.push(o);const A=new Ce({terminalType:b.separator}),R=new Ze({definition:[A].concat(b.definition),idx:b.idx}),M=b.definition.concat([R],pn(h)),S={idx:m,def:M,ruleStack:p,occurrenceStack:w};f.push(S)}else if(b instanceof Ze){const v={idx:m,def:pn(h),ruleStack:p,occurrenceStack:w};f.push(v),f.push(o);const A=new Ze({definition:b.definition,idx:b.idx}),R=b.definition.concat([A],pn(h)),M={idx:m,def:R,ruleStack:p,occurrenceStack:w};f.push(M)}else if(b instanceof Lr)for(let v=b.definition.length-1;v>=0;v--){const A=b.definition[v],R={idx:m,def:A.definition.concat(pn(h)),ruleStack:p,occurrenceStack:w};f.push(R),f.push(o)}else if(b instanceof Dn)f.push({idx:m,def:b.definition.concat(pn(h)),ruleStack:p,occurrenceStack:w});else if(b instanceof ho)f.push($C(b,m,p,w));else throw Error("non exhaustive match")}return u}function $C(e,t,n,r){const i=dn(n);i.push(e.name);const s=dn(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Pe;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Pe||(Pe={}));function ty(e){if(e instanceof jn||e==="Option")return Pe.OPTION;if(e instanceof Ze||e==="Repetition")return Pe.REPETITION;if(e instanceof ii||e==="RepetitionMandatory")return Pe.REPETITION_MANDATORY;if(e instanceof si||e==="RepetitionMandatoryWithSeparator")return Pe.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Cr||e==="RepetitionWithSeparator")return Pe.REPETITION_WITH_SEPARATOR;if(e instanceof Lr||e==="Alternation")return Pe.ALTERNATION;throw Error("non exhaustive match")}function DC(e,t,n,r,i,s){const o=xf(e,t,n),a=iy(o)?fl:xa;return s(o,r,a,i)}function jC(e,t,n,r,i,s){const o=kf(e,t,i,n),a=iy(o)?fl:xa;return s(o[0],a,r)}function zC(e,t,n,r){const i=e.length,s=Or(e,o=>Or(o,a=>a.length===1));if(t)return function(o){const a=xt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],m=h.length;for(let p=0;p<m;p++){const w=this.LA(p+1);if(n(w,h[p])===!1)continue t}return c}}};if(s&&!r){const o=xt(e,c=>tr(c)),a=Bn(o,(c,l,u)=>(Lt(l,f=>{Ct(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Lt(f.categoryMatches,d=>{Ct(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function WC(e,t,n){const r=Or(e,s=>s.length===1),i=e.length;if(r&&!n){const s=tr(e);if(s.length===1&&_e(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Bn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Lt(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class GC extends nl{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Pe.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Pe.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Pe.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Pe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class ey extends ws{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Pe.OPTION)}visitRepetition(t){this.checkIsTarget(t,Pe.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Pe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Pe.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Pe.ALTERNATION)}}function ny(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function Ef(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function KC(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function ry(e,t){const n=xt(e,o=>wf([o],1)),r=ny(n.length),i=xt(n,o=>{const a={};return Lt(o,c=>{const l=Ef(c.partialPath);Lt(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=ny(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=Ef(f);if(KC(i,h,c)||_e(d)||f.length===t){const p=r[c];if(vf(p,f)===!1){p.push(f);for(let w=0;w<h.length;w++){const b=h[w];i[c][b]=!0}}}else{const p=wf(d,o+1,f);s[c]=s[c].concat(p),Lt(p,w=>{const b=Ef(w.partialPath);Lt(b,v=>{i[c][v]=!0})})}}}}return r}function xf(e,t,n,r){const i=new ey(e,Pe.ALTERNATION,r);return t.accept(i),ry(i.result,n)}function kf(e,t,n,r){const i=new ey(e,n);t.accept(i);const s=i.result,a=new GC(t,e,n).startWalking(),c=new Dn({definition:s}),l=new Dn({definition:a});return ry([c,l],r)}function vf(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function HC(e,t){return e.length<t.length&&Or(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function iy(e){return Or(e,t=>Or(t,n=>Or(n,r=>_e(r.categoryMatches))))}function YC(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return xt(t,n=>Object.assign({type:Tn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function VC(e,t,n,r){const i=_r(e,c=>XC(c,n)),s=aL(e,t,n),o=_r(e,c=>rL(c,n)),a=_r(e,c=>ZC(c,e,r,n));return i.concat(s,o,a)}function XC(e,t){const n=new JC;e.accept(n);const r=n.allProductions,i=y_(r,qC),s=Nr(i,a=>a.length>1);return xt(Ke(s),a=>{const c=Ir(a),l=t.buildDuplicateFoundError(e,a),u=oi(c),f={message:l,type:Tn.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=sy(c);return d&&(f.parameter=d),f})}function qC(e){return`${oi(e)}_#_${e.idx}_#_${sy(e)}`}function sy(e){return e instanceof Ce?e.terminalType.name:e instanceof $n?e.nonTerminalName:""}class JC extends ws{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function ZC(e,t,n,r){const i=[];if(Bn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:Tn.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function QC(e,t,n){const r=[];let i;return vn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Tn.INVALID_RULE_OVERRIDE,ruleName:e})),r}function oy(e,t,n,r=[]){const i=[],s=ml(t.definition);if(_e(s))return[];{const o=e.name;vn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:Tn.LEFT_RECURSION,ruleName:o});const c=Jc(s,r.concat([e])),l=_r(c,u=>{const f=dn(r);return f.push(u),oy(e,u,n,f)});return i.concat(l)}}function ml(e){let t=[];if(_e(e))return t;const n=Ir(e);if(n instanceof $n)t.push(n.referencedRule);else if(n instanceof Dn||n instanceof jn||n instanceof ii||n instanceof si||n instanceof Cr||n instanceof Ze)t=t.concat(ml(n.definition));else if(n instanceof Lr)t=tr(xt(n.definition,s=>ml(s.definition)));else if(!(n instanceof Ce))throw Error("non exhaustive match");const r=el(n),i=e.length>1;if(r&&i){const s=pn(e);return t.concat(ml(s))}else return t}class Tf extends ws{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function tL(e,t){const n=new Tf;e.accept(n);const r=n.alternations;return _r(r,s=>{const o=_a(s.definition);return _r(o,(a,c)=>{const l=Q_([a],[],xa,1);return _e(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:Tn.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function eL(e,t,n){const r=new Tf;e.accept(r);let i=r.alternations;return i=Zc(i,o=>o.ignoreAmbiguities===!0),_r(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=xf(a,e,c,o),u=sL(l,o,e,n),f=oL(l,o,e,n);return u.concat(f)})}class nL extends ws{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function rL(e,t){const n=new Tf;e.accept(n);const r=n.alternations;return _r(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:Tn.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function iL(e,t,n){const r=[];return Lt(e,i=>{const s=new nL;i.accept(s);const o=s.allProductions;Lt(o,a=>{const c=ty(a),l=a.maxLookahead||t,u=a.idx,d=kf(u,i,c,l)[0];if(_e(tr(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:Tn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function sL(e,t,n,r){const i=[],s=Bn(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||Lt(c,u=>{const f=[l];Lt(e,(d,h)=>{l!==h&&vf(d,u)&&t.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!vf(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return xt(s,a=>{const c=xt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:Tn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function oL(e,t,n,r){const i=Bn(e,(o,a,c)=>{const l=xt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return ga(_r(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=gr(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&HC(d.path,l));return xt(u,d=>{const h=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:h,prefixPath:d.path}),type:Tn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:m,alternatives:h}})}))}function aL(e,t,n){const r=[],i=xt(t,s=>s.name);return Lt(e,s=>{const o=s.name;if(vn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:Tn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function cL(e){const t=hf(e,{errMsgProvider:CC}),n={};return Lt(e.rules,r=>{n[r.name]=r}),LC(n,t.errMsgProvider)}function lL(e){return e=hf(e,{errMsgProvider:ks}),VC(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const ay="MismatchedTokenException",cy="NoViableAltException",ly="EarlyExitException",uy="NotAllInputParsedException",hy=[ay,cy,ly,uy];Object.freeze(hy);function gl(e){return vn(hy,e.name)}class _l extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class fy extends _l{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=ay}}class uL extends _l{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=cy}}class hL extends _l{constructor(t,n){super(t,n),this.name=uy}}class fL extends _l{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=ly}}const Af={},dy="InRuleRecoveryException";class dL extends Error{constructor(t){super(t),this.name=dy}}class pL{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ct(t,"recoveryEnabled")?t.recoveryEnabled:Ri.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=mL)}getTokenToInsert(t){const n=dl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new fy(h,l,this.LA(0));m.resyncedTokens=_a(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),t.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new dL("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||_e(n))return!1;const r=this.LA(1);return uo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return vn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=uo(t,s=>NC(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Af;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return xt(t,(r,i)=>i===0?Af:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=xt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return tr(t)}getFollowSetFromFollowKey(t){if(t===Af)return[xs];const n=t.ruleName+t.idxInCallingRule+T_+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,xs)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return _a(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=dn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return xt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function mL(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=xs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const gL=4,Yi=8,py=1<<Yi,my=2<<Yi,Rf=3<<Yi,Sf=4<<Yi,Of=5<<Yi,yl=6<<Yi;function If(e,t,n){return n|t|e}class _L{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Ri.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(_e(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return _r(t,n=>oy(n,n,ks))}validateEmptyOrAlternatives(t){return _r(t,n=>tL(n,ks))}validateAmbiguousAlternationAlternatives(t,n){return _r(t,r=>eL(r,n,ks))}validateSomeNonEmptyLookaheadPath(t,n){return iL(t,n,ks)}buildLookaheadForAlternation(t){return DC(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,zC)}buildLookaheadForOptional(t){return jC(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,ty(t.prodType),WC)}}class yL{initLooksAhead(t){this.dynamicTokensEnabled=Ct(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Ri.dynamicTokensEnabled,this.maxLookahead=Ct(t,"maxLookahead")?t.maxLookahead:Ri.maxLookahead,this.lookaheadStrategy=Ct(t,"lookaheadStrategy")?t.lookaheadStrategy:new _L({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Lt(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=wL(n);Lt(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${oi(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=If(this.fullRuleNameToShort[n.name],py,l.idx);this.setLaFuncCache(d,f)})}),Lt(i,l=>{this.computeLookaheadFunc(n,l.idx,Rf,"Repetition",l.maxLookahead,oi(l))}),Lt(s,l=>{this.computeLookaheadFunc(n,l.idx,my,"Option",l.maxLookahead,oi(l))}),Lt(o,l=>{this.computeLookaheadFunc(n,l.idx,Sf,"RepetitionMandatory",l.maxLookahead,oi(l))}),Lt(a,l=>{this.computeLookaheadFunc(n,l.idx,yl,"RepetitionMandatoryWithSeparator",l.maxLookahead,oi(l))}),Lt(c,l=>{this.computeLookaheadFunc(n,l.idx,Of,"RepetitionWithSeparator",l.maxLookahead,oi(l))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=If(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return If(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class bL extends ws{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const bl=new bL;function wL(e){bl.reset(),e.accept(bl);const t=bl.dslMethods;return bl.reset(),t}function gy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function _y(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function EL(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function xL(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const kL="name";function yy(e,t){Object.defineProperty(e,kL,{enumerable:!1,configurable:!0,writable:!1,value:t})}function vL(e,t){const n=pr(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function TL(e,t){const n=function(){};yy(n,e+"BaseSemantics");const r={visit:function(i,s){if(re(i)&&(i=i[0]),!Ai(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=RL(this,t);if(!_e(i)){const s=xt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function AL(e,t,n){const r=function(){};yy(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Lt(t,s=>{i[s]=vL}),r.prototype=i,r.prototype.constructor=r,r}var Nf;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Nf||(Nf={}));function RL(e,t){return SL(e,t)}function SL(e,t){const n=gr(t,i=>xi(e[i])===!1),r=xt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:Nf.MISSING_METHOD,methodName:i}));return ga(r)}class OL{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Ct(t,"nodeLocationTracking")?t.nodeLocationTracking:Ri.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Je,this.cstFinallyStateUpdate=Je,this.cstPostTerminal=Je,this.cstPostNonTerminal=Je,this.cstPostRule=Je;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=_y,this.setNodeLocationFromNode=_y,this.cstPostRule=Je,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=gy,this.setNodeLocationFromNode=gy,this.cstPostRule=Je,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=Je,this.setInitialNodeLocation=Je;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];EL(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];xL(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(Ai(this.baseCstVisitorConstructor)){const t=TL(this.className,pr(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Ai(this.baseCstVisitorWithDefaultsConstructor)){const t=AL(this.className,pr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class IL{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):xl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?xl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class NL{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=kl){if(vn(this.definedRulesNames,t)){const o={message:ks.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Tn.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=kl){const i=QC(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(gl(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return LN(Ke(this.gastProductionsCache))}}class CL{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=fl,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ct(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(re(t)){if(_e(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(re(t))this.tokensMap=Bn(t,(s,o)=>(s[o.name]=o,s),{});else if(Ct(t,"modes")&&Or(tr(Ke(t.modes)),RC)){const s=tr(Ke(t.modes)),o=Qc(s);this.tokensMap=Bn(o,(a,c)=>(a[c.name]=c,a),{})}else if(dr(t))this.tokensMap=dn(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=xs;const r=Ct(t,"modes")?tr(Ke(t.modes)):Ke(t),i=Or(r,s=>_e(s.categoryMatches));this.tokenMatcher=i?fl:xa,ka(Ke(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ct(r,"resyncEnabled")?r.resyncEnabled:kl.resyncEnabled,s=Ct(r,"recoveryValueFunc")?r.recoveryValueFunc:kl.recoveryValueFunc,o=this.ruleShortNameIdx<<gL+Yi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(gl(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(my,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(Sf,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Pe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,Sf,t,BC)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(yl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Z_],a,yl,t,Z_)}else throw this.raiseEarlyExitException(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(Rf,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,Rf,t,PC,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(Of,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,J_],a,Of,t,J_)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,yl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(py,n),i=re(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new hL(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw gl(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new fy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===dy?r:s}}else throw r}saveRecogState(){const t=this.errors,n=dn(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),xs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class LL{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Ct(t,"errorMessageProvider")?t.errorMessageProvider:Ri.errorMessageProvider}SAVE_ERROR(t){if(gl(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:dn(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return dn(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=kf(t,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new fL(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=xf(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new uL(c,this.LA(1),a))}}class ML{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(Ai(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Q_([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=Ir(t.ruleStack),i=this.getGAstProductions()[n];return new FC(i,t).startWalking()}}const wl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(wl);const by=!0,wy=Math.pow(2,Yi)-1,Ey=er({name:"RECORDING_PHASE_TOKEN",pattern:Qe.NA});ka([Ey]);const xy=dl(Ey,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(xy);const UL={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class FL{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return xl}topLevelRuleRecord(t,n){try{const r=new ho({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return Aa.call(this,jn,t,n)}atLeastOneInternalRecord(t,n){Aa.call(this,ii,n,t)}atLeastOneSepFirstInternalRecord(t,n){Aa.call(this,si,n,t,by)}manyInternalRecord(t,n){Aa.call(this,Ze,n,t)}manySepFirstInternalRecord(t,n){Aa.call(this,Cr,n,t,by)}orInternalRecord(t,n){return PL.call(this,t,n)}subruleInternalRecord(t,n,r){if(El(n),!t||Ct(t,"ruleName")===!1){const a=new Error(`<SUBRULE${ky(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=lo(this.recordingProdStack),s=t.ruleName,o=new $n({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?UL:wl}consumeInternalRecord(t,n,r){if(El(n),!$_(t)){const o=new Error(`<CONSUME${ky(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=lo(this.recordingProdStack),s=new Ce({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),xy}}function Aa(e,t,n,r=!1){El(n);const i=lo(this.recordingProdStack),s=xi(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Ct(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),wl}function PL(e,t){El(t);const n=lo(this.recordingProdStack),r=re(e)===!1,i=r===!1?e:e.DEF,s=new Lr({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Ct(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=ff(i,a=>xi(a.GATE));return s.hasPredicates=o,n.definition.push(s),Lt(i,a=>{const c=new Dn({definition:[]});s.definition.push(c),Ct(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ct(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),wl}function ky(e){return e===0?"":`${e}`}function El(e){if(e<0||e>wy){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${wy+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class BL{initPerformanceTracer(t){if(Ct(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ri.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=x_(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function $L(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const xl=dl(xs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(xl);const Ri=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:q_,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),kl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Tn;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Tn||(Tn={}));let Cf=class j1{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{k_(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Lt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=cL({rules:Ke(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(_e(r)&&this.skipValidations===!1){const i=lL({rules:Ke(this.gastProductionsCache),tokenTypes:Ke(this.tokensMap),errMsgProvider:ks,grammarName:n}),s=YC({lookaheadStrategy:this.lookaheadStrategy,rules:Ke(this.gastProductionsCache),tokenTypes:Ke(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),_e(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=DN(Ke(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ke(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ke(this.gastProductionsCache))})),!j1.DEFER_DEFINITION_ERRORS_HANDLING&&!_e(this.definitionErrors))throw t=xt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Ct(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ct(n,"skipValidations")?n.skipValidations:Ri.skipValidations}};Cf.DEFER_DEFINITION_ERRORS_HANDLING=!1,$L(Cf,[pL,yL,OL,IL,CL,NL,LL,ML,FL,BL]);class DL extends Cf{constructor(t,n=Ri){const r=dn(n);r.outputCst=!0,super(t,r)}}function jL(e){const t=new zL,n=Ke(e);return xt(n,r=>t.visitRule(r))}class zL extends ws{visitRule(t){const n=this.visitEach(t.definition),r=y_(n,s=>s.propertyName),i=xt(r,(s,o)=>{const a=!ff(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=xt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:vl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:vl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:vl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:vl(t)}]}visitEachAndOverrideWith(t,n){return xt(this.visitEach(t),r=>Fn({},r,n))}visitEach(t){return tr(xt(t,n=>this.visit(n)))}}function vl(e){return e instanceof $n?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function WL(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(tr(xt(e,r=>GL(r)))),t.includeVisitorInterface&&(n=n.concat(VL(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function GL(e){const t=KL(e),n=HL(e);return[t,n]}function KL(e){const t=Ty(e.name),n=Lf(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function HL(e){return`export type ${Lf(e.name)} = {
  ${xt(e.properties,n=>YL(n)).join(`
  `)}
};`}function YL(e){const t=qL(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function VL(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${xt(t,n=>XL(n)).join(`
  `)}
}`}function XL(e){const t=Lf(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function qL(e){if(re(e)){const t=Qc(xt(e,r=>vy(r)));return"("+Bn(t,(r,i)=>r+" | "+i)+")"}else return vy(e)}function vy(e){return e.kind==="token"?"IToken":Ty(e.name)}function Ty(e){return Dg(e)+"CstNode"}function Lf(e){return Dg(e)+"CstChildren"}const JL={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function ZL(e,t){const n=Object.assign(Object.assign({},JL),t),r=jL(e);return WL(r,n)}const Ra=am(32,126).map(e=>String.fromCharCode(e));function Kt(e){return er({...e,name:`token_${e.name}`})}function Vi(e,t=!1){return Kt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:cn,group:Qe.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:cn})}const Sa=Kt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),QL=Kt({name:"whitespace",pattern:/ +/,group:Qe.SKIPPED}),t6=Kt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Qe.SKIPPED}),Mf=Kt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),po=Kt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Ay=!1;function e6(e,t,n){if(!Ay)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Sa)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const Ry=Kt({name:"text",pattern:e6,line_breaks:!1,start_chars_hint:Ra.filter(e=>"@#/?':!".includes(e)===!1)}),Sy=Kt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Uf=Kt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Oy=Kt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Iy=Kt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),cn=Kt({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Ra}),Ny=Kt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Cy=Kt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Ly=Kt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:cn}),My=Kt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:cn}),Uy=Kt({name:"islessthan",pattern:/<|below/,longer_alt:cn}),Fy=Kt({name:"isgreaterthan",pattern:/>|above/,longer_alt:cn}),Py=Kt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:cn}),By=Kt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:cn}),Ff=Kt({name:"or",pattern:/or/i,longer_alt:cn}),Pf=Kt({name:"not",pattern:/not/i,longer_alt:cn}),Bf=Kt({name:"and",pattern:/and/i,longer_alt:cn}),$f=Kt({name:"plus",pattern:/\+/}),Df=Kt({name:"minus",pattern:/-/}),$y=Kt({name:"power",pattern:/\*\*/}),Dy=Kt({name:"multiply",pattern:/\*/}),jf=Kt({name:"divide",pattern:/\//}),jy=Kt({name:"moddivide",pattern:/%/}),zy=Kt({name:"floordivide",pattern:/%%/}),Wy=Kt({name:"query",pattern:/\?/}),Gy=Kt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),Ky=Kt({name:"rparen",pattern:/\)/,pop_mode:!0}),Hy=Kt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Ra,longer_alt:cn}),Yy=Kt({name:"command_toast",pattern:/toast .*/,start_chars_hint:Ra,longer_alt:cn}),Vy=Kt({name:"command_ticker",pattern:/ticker .*/,start_chars_hint:Ra,longer_alt:cn}),zf=Kt({name:"if",pattern:/if|try|take|give/,longer_alt:cn}),Tl=Vi("do"),Wf=Vi("done"),Gf=Vi("else"),Xy=Vi("while"),qy=Vi("repeat"),Jy=Vi("waitfor"),Zy=Kt({name:"foreach",pattern:/foreach|for/,longer_alt:cn}),Qy=Vi("break"),tb=Vi("continue");function eb(e){return[...e,Cy,Ly,My,Py,Uy,By,Fy,Ff,Pf,Bf,$f,Df,$y,Dy,jf,zy,jy,Wy,Gy,Ky,Ny,cn]}const nb=eb([Ry,Mf,Hy,Yy,Vy,po,Sy,Uf,Oy,Iy,Sa,QL,Qy,tb,Wf,Tl,Gf,Zy,zf,qy,Jy,Xy]),n6=new Qe({defaultMode:"use_newlines",modes:{use_newlines:nb,ignore_newlines:eb([t6])}},{skipValidations:!Zr,ensureOptimizations:Zr,positionTracking:"full"});function rb(e){Ay=!0;const t=n6.tokenize(e||` 
`),[n]=(le(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(dl(Sa,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function r6(e,t,n=!0){if(n){const[r,...i]=t;switch(Ot(r??"")){default:return{type:vt.OBJECT,values:t};case"loader":return{type:vt.LOADER,values:i};case"board":return{type:vt.BOARD,values:i};case"object":return{type:vt.OBJECT,values:i};case"terrain":return{type:vt.TERRAIN,values:i};case"charset":return{type:vt.CHARSET,values:i};case"palette":return{type:vt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Ot(i??""),a=[r,e,...s];switch(o){default:return{type:vt.CONST,values:t};case"rn":case"range":return{type:vt.RANGE,values:a};case"sl":case"select":return{type:vt.SELECT,values:a};case"nm":case"number":return{type:vt.NUMBER,values:a};case"tx":case"text":return{type:vt.TEXT,values:a};case"hk":case"hotkey":return{type:vt.HOTKEY,values:a};case"copyit":return{type:vt.COPYIT,values:a};case"openit":return{type:vt.OPENIT,values:a};case"zssedit":return{type:vt.ZSSEDIT,values:a};case"charedit":return{type:vt.CHAREDIT,values:a};case"coloredit":return{type:vt.COLOREDIT,values:a}}}}function nr(e){switch(e){case vt.LOADER:return"loader";case vt.BOARD:return"board";case vt.OBJECT:return"object";case vt.TERRAIN:return"terrain";case vt.CHARSET:return"charset";case vt.PALETTE:return"palette";case vt.CONST:return"const";case vt.RANGE:return"range";case vt.SELECT:return"select";case vt.NUMBER:return"number";case vt.TEXT:return"text";case vt.HOTKEY:return"hotkey";case vt.COPYIT:return"copyit";case vt.OPENIT:return"openit";case vt.ZSSEDIT:return"zssedit";case vt.CHAREDIT:return"charedit";case vt.COLOREDIT:return"coloredit"}}var Kf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Kf||{});function ib(e){return so(e,Kf,{bits:t=>Array.from(t)})}function sb(e){return ra(e,Kf,{bits:t=>new Uint8Array(t)})}function ob(e,t){return{id:$e(),code:e,...t}}var Hf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Hf||{});function i6(e){return so(e,Hf,{board:LF,object:Cc,terrain:Cc,charset:ib,palette:ib,stats:ve})}function s6(e){return ra(e,Hf,{board:MF,object:Lc,terrain:Lc,charset:sb,palette:sb})}function Oa(e){const t={...vs(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function o6(e){return E(e)?(e.stats=void 0,vs(e)):{}}function ab(e){const t=rb(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===Mf){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=r6(_t(c)?c:"",l,r),f=Ot(u.values.join(" "));switch(r=!1,u.type){case vt.LOADER:n.type=yt.LOADER,n.name=f;break;case vt.BOARD:n.type=yt.BOARD,n.name=f;break;case vt.OBJECT:n.type=yt.OBJECT,n.name=f||"object";break;case vt.TERRAIN:n.type=yt.TERRAIN,n.name=f;break;case vt.CHARSET:n.type=yt.CHARSET,n.name=f;break;case vt.PALETTE:n.type=yt.PALETTE,n.name=f;break;case vt.CONST:{const[d,h]=u.values;if(_t(d)){const m=Ot(d);if(_t(h)){const p=parseFloat(h);n[m]=Tt(p)?p:h}else Tt(h)?n[m]=h:n[m]=1}break}case vt.RANGE:case vt.SELECT:case vt.NUMBER:case vt.TEXT:case vt.HOTKEY:case vt.ZSSEDIT:case vt.CHAREDIT:case vt.COLOREDIT:{const[d,...h]=u.values;if(_t(d)){const m=Ot(d);n[m]=[nr(u.type),...h]}break}}}}return n}function vs(e){var t;return E(e)?(E((t=e.stats)==null?void 0:t.type)||(e.stats=ab(e.code),E(e.stats.type)||(e.stats.type=yt.OBJECT)),e.stats):{}}function cb(e){switch(e){default:case yt.ERROR:return"error";case yt.LOADER:return nr(vt.LOADER);case yt.BOARD:return nr(vt.BOARD);case yt.OBJECT:return nr(vt.OBJECT);case yt.TERRAIN:return nr(vt.TERRAIN);case yt.CHARSET:return nr(vt.CHARSET);case yt.PALETTE:return nr(vt.PALETTE)}}function ai(e){return vs(e).type??yt.ERROR}function Mr(e){return cb(ai(e))}function Le(e){return vs(e).name??""}function Yf(e,t){return vs(e)[t]}const Al=new _h;function a6(e){if(!_t(e))return;const t=vc(e);if(E(t)&&E(dt[t]))return dt[t];const n=Ot(e),r=pt[n];if(E(r))return r}function Vf(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!le(s))switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"color":case"bg":case"lightdir":t[i]=a6(e[i])??e[i];break;case"isitem":t.item=1;break;case"notitem":t.item=0;break;case"ispushable":t.pushable=1;break;case"notpushable":t.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=jt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=jt.ISSWIM;break;case"issolid":t.collision=jt.ISSOLID;break;case"isbullet":t.collision=jt.ISBULLET;break;case"isbreakable":t.breakable=1;break;case"notbreakable":t.breakable=0;break}}}function Ae(e){var t;if(E(e))switch(ai(e)){default:return;case yt.ERROR:return e.code??"";case yt.LOADER:return e.code??"";case yt.BOARD:{E(e.board)||(e.board=Yl()),e.board.id=e.id;const n=Oa(e);return n.isdark&&(e.board.isdark=1),n.notdark&&(e.board.isdark=0),Tt(n.startx)&&(e.board.startx=n.startx),Tt(n.starty)&&(e.board.starty=n.starty),_t(n.over)&&(Ot(n.over)==="empty"?e.board.over=void 0:e.board.over=n.over,e.board.overboard=void 0),_t(n.under)&&(Ot(n.under)==="empty"?e.board.under=void 0:e.board.under=n.under,e.board.underboard=void 0),_t(n.camera)&&(Ot(n.camera)==="empty"?e.board.camera=void 0:e.board.camera=n.camera),_t(n.graphics)&&(Ot(n.graphics)==="empty"?e.board.graphics=void 0:e.board.graphics=n.graphics),Tt(n.facing)&&(e.board.facing=n.facing),_t(n.facing)&&Ot(n.facing)==="empty"&&(e.board.facing=void 0),_t(n.exitnorth)&&(e.board.exitnorth=n.exitnorth),_t(n.exitsouth)&&(e.board.exitsouth=n.exitsouth),_t(n.exitwest)&&(e.board.exitwest=n.exitwest),_t(n.exiteast)&&(e.board.exiteast=n.exiteast),Tt(n.timelimit)&&(e.board.timelimit=n.timelimit),n.restartonzap&&(e.board.restartonzap=1),n.norestartonzap&&(e.board.restartonzap=0),Tt(n.maxplayershots)&&(e.board.maxplayershots=n.maxplayershots),e.board}case yt.OBJECT:return E(e.object)||(e.object=Hm()),e.object.id=e.id,e.object.code=e.code,e.object.name=Le(e),e.object.category=Ln.ISOBJECT,Vf(Oa(e),e.object),e.object;case yt.TERRAIN:return E(e.terrain)||(e.terrain=Hm()),e.terrain.id=e.id,e.terrain.name=Le(e),e.terrain.category=Ln.ISTERRAIN,Vf(Oa(e),e.terrain),e.terrain;case yt.PALETTE:{if(E(e.palette)||(e.palette=ng(OT)),E((t=e.palette)==null?void 0:t.bits)){const n=Oa(e),r=sr(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&_t(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Al.set(o);const c=a*Mc,l=Al.r*63,u=Al.g*63,f=Al.b*63;e.palette.bits[c+0]=fn(l,0,63),e.palette.bits[c+1]=fn(u,0,63),e.palette.bits[c+2]=fn(f,0,63)}}}}return e.palette}case yt.CHARSET:return E(e.charset)||(e.charset=rg(ST)),e.charset}}function Xf(e){return{id:$e(),name:nw(),timestamp:0,activelist:[],pages:e,flags:{}}}var qf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(qf||{});function c6(e){return so(e,qf,{pages:t=>t.map(i6),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function l6(e){return ra(e,qf,{pages:t=>t.map(s6)})}function lb(e){E(e)&&(e.token=`${rw()}${lr(1111,9999)}`)}function Ts(e,t){if(!E(e))return;const n=Ot(t);return e.pages.find(i=>i.id===t||n===Le(i))}function tn(e,t,n){if(!E(e))return;const r=Ot(n);return e.pages.find(s=>ai(s)===t&&(s.id===n||r===Le(s)))}function Jf(e,t,n){let r=tn(e,t,n);if(!E(r)){const i=cb(t);return r=ob(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),Zf(e,r),[r,!0]}return[r,!1]}function As(e,t){return E(e)?e.pages.filter(n=>ai(n)===t):[]}function mo(e,t,n){if(!E(e))return[];const r=Ot(n);return e.pages.filter(s=>ai(s)===t).filter(s=>{const o=vs(s),a=Ot(Le(s));return s.id===n||r===a||E(o[n])})}function Ia(e){return E(e)?wr(e.pages).sort((n,r)=>{const i=ai(n),s=ai(r);return i===s?Le(n).localeCompare(Le(r)):s-i}):[]}function ub(e,t){if(E(t)){const n=tn(e,yt.TERRAIN,t.kind??"");if(E(n))return n;const r=tn(e,yt.OBJECT,t.kind??"");if(E(r))return r}}function Zf(e,t){if(!E(e)||!E(t))return!1;const n=Ts(e,t.id);return E(n)?!1:(e.pages.push(t),lb(e),!0)}function hb(e,t){const n=Ts(e,t);if(E(e)&&E(n)){const r=Ot(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Le(i)),lb(e),n}}function go(e,t,n,r){const i=e==null?void 0:e.kinddata;return{char:(e==null?void 0:e.char)??(i==null?void 0:i.char)??t,color:(e==null?void 0:e.color)??(i==null?void 0:i.color)??n,bg:(e==null?void 0:e.bg)??(i==null?void 0:i.bg)??r,light:(e==null?void 0:e.light)??(i==null?void 0:i.light)??0}}function u6(e,t){return!!(e!=null&&e.flags[t])}function Si(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function fb(e,t){e&&delete e.flags[t]}function db(e,t,n){const r=Si(e,t);return r==null?void 0:r[n]}function h6(e,t,n,r){const i=Si(e,t);return i&&(i[n]=r),r}function Na(e,t){const n=db(e,t,"board"),r=Pr(yt.BOARD,n);return Ae(r)}function f6(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Rl(e,t,n){if(!E(e))return;h6(e,t,"board",n);const r=Hn(n);E(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function _o(e,t,n,r){if(!E(e))return;const i=mn(t);if(!E(i))return;const s=Sn(i,t);if(!We(s)||!(s!=null&&s.id))return;const o=Hn(n);if(!E(o)||(Ue(o),Fh(o,jt.ISWALK,r,!0)))return;delete i.objects[s.id];const a=Br(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Br(o,s);o.lookup&&(o.lookup[c]=s.id),Rl(e,t,o.id)}function d6(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=db(e,r,"board");return _t(i)?i:""});return Sv(n)}function yo(e){const t=d6(e),n=new Set,r=[];for(let i=0;i<t.length;++i){const s=Hn(t[i]);if(E(s)&&!n.has(s.id)){if(_t(s.over))if(_t(s.overboard)){const o=Hn(s.overboard);E(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=Hn(s.over);E(o)&&(s.overboard=o.id)}else _t(s.overboard)&&delete s.overboard;if(r.push(s),_t(s.under))if(_t(s.underboard)){const o=Hn(s.underboard);E(o)||delete s.underboard}else{const o=Hn(s.under);E(o)&&(s.underboard=o.id)}else _t(s.underboard)&&delete s.underboard}}return r}const p6=am(32,126).map(e=>String.fromCharCode(e)),m6=er({name:"Whitespace",pattern:/ +/}),g6=er({name:"WhitespaceSkipped",pattern:/ +/,group:Qe.SKIPPED}),Qf=er({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),pb=er({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:p6}),td=er({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),ed=er({name:"EscapedDollar",pattern:"$$"}),nd=er({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),rd=er({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),mb=er({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function _6(e,t=""){return er({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const gb=Object.keys(qo).map(e=>_6(`\\$(${e})`,e)),y6=[m6,Qf,...gb,td,pb,rd,ed,mb,nd],b6=new Qe(y6,{skipValidations:!Zr,ensureOptimizations:Zr}),w6=new Qe([g6,Qf,...gb,td,pb,rd,ed,mb,nd],{skipValidations:!Zr,ensureOptimizations:Zr});function id(e,t=!1){return t?w6.tokenize(e):b6.tokenize(e)}function sd(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function _b(e){e.active={...e.reset}}function yb(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case ed:s("$");break;case rd:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r();break;case td:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Qf:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=qo[l],f=Cv(dt[u]),d=Lv(dt[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):E(f)?t.active.color=f:E(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(E(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){_b(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;x6(u,u+l.length,t.active.color,t.active.bg,t),E6(u,l,t)}}}function bb(e,t,n){const r=id(e);r.tokens&&(yb(r.tokens,t),n&&_b(t),t.changed())}function wb(e,t,n){const r=id(e);if(!r.tokens)return;const i=sd(t,n,dt.WHITE,dt.BLACK);return i.measureonly=!0,yb(r.tokens,i),i.x>0&&++i.y,i}function E6(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function x6(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function Sl(e,t,n){if(!ps(x.element))return 0;const[r,i]=rt(t,0,[K.DIR,K.MAYBE_KIND]),s=i??["bullet"],o=_F(x.board,s,{x:x.element.x,y:x.element.y});if(E(o)){E(n)&&(o.arg=n),o.cycle=1,o.party=x.elementid,o.collision=jt.ISBULLET,o.breakable=1,o.stepx=r.destpt.x-x.element.x,o.stepy=r.destpt.y-x.element.y,o.bg=dt.ONCLEAR;const a=ui(o),c=o.code??(a==null?void 0:a.code)??"";E1(x.book,x.board,o,c)}return e.yield(),0}function Ol(e,t,n,r){var l,u;if(!ps(x.element)||!E(x.book)||!E(x.board)||!E(x.element))return 0;Ue(x.board);const[i,s]=rt(t,0,[K.DIR,K.KIND]),o=ee(x.board,i.destpt);if((o==null?void 0:o.category)===Ln.ISOBJECT&&(o!=null&&o.pushable)){const f={x:((l=x.element)==null?void 0:l.x)??0,y:((u=x.element)==null?void 0:u.y)??0},d=je(i.destpt,Ar(f,i.destpt));Ph(x.board,o,d)}const[a]=s,c=ui({kind:a});if(We(c)||Rt(x.board,s,i.destpt,n),We(c)){const f=Ht(c,"collision");if(!Fh(x.board,f,i.destpt)){const h=Rt(x.board,s,i.destpt,n);E(h)&&E(r)&&(h.arg=r)}}return 0}function Eb(e,t,n){if(!E(x.book)||!E(x.board))return 0;Ue(x.board);const[r,i]=rt(t,0,[K.DIR,K.DIR]),s=ee(x.board,r.destpt);return We(s),0}const k6=Ei().command("board",(e,t)=>{if(!E(x.book)||!E(x.board))return 0;const[n,r]=rt(t,0,[K.STRING]),[i,s]=rt(t,r,[K.MAYBE_NUMBER,K.MAYBE_NUMBER]),o=Hn(n);return E(o)&&_o(x.book,x.elementfocus,o.id,{x:i??Math.round(At*.5),y:s??Math.round(Vt*.5)}),0}).command("build",(e,t)=>{if(!E(x.book)||!E(x.board)||!E(x.element))return 0;const[n,r]=rt(t,0,[K.NAME,K.MAYBE_STRING]);if(_t(r)){const s=Hn(r);return E(s)&&e.set(n,s.id),0}const i=Yl();return E(i)&&e.set(n,i.id),0}).command("shove",(e,t)=>{if(!E(x.book)||!E(x.board))return 0;Ue(x.board);const[n,r]=rt(t,0,[K.DIR,K.DIR]),i=ee(x.board,n.destpt);return We(i)&&ts(x.book,x.board,i,r.destpt),0}).command("dupe",Eb).command("duplicate",Eb).command("write",(e,t)=>{var d;if(!E(x.book)||!E(x.board))return 0;Ue(x.board);const[n,r,i]=rt(t,0,[K.DIR,K.COLOR]),s=t.slice(i).map(Te).join(" "),{color:o,bg:a}=gm(r),c=((d=wb(s,256,1))==null?void 0:d.measuredwidth)??1,l=sd(256,1,o??dt.WHITE,a??dt.BLACK);bb(s,l,!1);const u=c-1;switch(Ar(n.startpt,n.destpt)){case pt.EAST:for(let h=0;h<c;++h)Re(x.board,{x:n.destpt.x+h,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.WEST:for(let h=0;h<c;++h)Re(x.board,{x:n.destpt.x+h-u,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.NORTH:for(let h=0;h<c;++h)Re(x.board,{x:n.destpt.x,y:n.destpt.y+h-u,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.SOUTH:for(let h=0;h<c;++h)Re(x.board,{x:n.destpt.x,y:n.destpt.y+h,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break}return 0}).command("change",(e,t)=>{if(!E(x.book)||!E(x.board))return 0;Ue(x.board);const[n,r]=rt(t,0,[K.KIND,K.KIND]);(Tc(n)??"")==="empty"&&Fv(x.board).forEach(c=>{Rt(x.board,r,c)});const s=Tc(r),o=Eh(r),a=ym(r);return kh(x.board,n).forEach(c=>{if(Jr(c)===s)E(o)&&(c.color=o),E(a)&&(c.bg=a);else if(wn(x.board,c,x.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};Rt(x.board,r,l)}}),0}).command("put",(e,t)=>Ol(e,t)).command("putwith",(e,t)=>{const[n,r]=rt(t,0,[K.ANY]);return Ol(e,t.slice(r),void 0,n)}).command("oneof",(e,t)=>{const[n,r]=rt(t,0,[K.ANY]);return E(x.board)&&Sn(x.board,n)?0:Ol(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=rt(t,0,[K.ANY,K.ANY]);return E(x.board)&&Sn(x.board,r)?0:Ol(e,t.slice(i),r,n)}).command("shoot",Sl).command("shootwith",(e,t)=>{const[n,r]=rt(t,0,[K.ANY]);return Sl(e,t.slice(r),n)}).command("throwstar",(e,t)=>Sl(e,[...t,"star"])).command("throwstarwith",(e,t)=>{const[n,r]=rt(t,0,[K.ANY]);return Sl(e,[...t.slice(r),"star"],n)}),Xi="$dkpurple",v6="$196",T6="$205",en="$yellow$205$205$205$196";function ye(e,t,n){Rw(e,t,n)}function A6(e,t,n){const r=v6.repeat(n);ye(e,t,`${Xi}${r}`)}function od(e,t,n){const r=T6.repeat(n);ye(e,t,`${Xi}${r}`)}function ad(e,t,n){ye(e,t,`${Xi} ${" ".repeat(n.length)} `),A6(e,t,n.length+2),ye(e,t,`${Xi} $white${n} `),od(e,t,n.length+2)}function Rs(e,t,n){ye(e,t,`${Xi} ${" ".repeat(n.length)} `),ye(e,t,`${Xi} $gray${n} `),od(e,t,n.length+2)}function Ss(e,t,n,r){ye(e,t,`${Xi} $white${n} $blue${r}`)}function zn(e,t,n){ye(e,t,`${Xi}$blue${n}`)}function R6(e,t,n,r){ye(e,t,`!${n};${r}`)}var S6=`desc;$DKGRAYname and type of codepage
`,O6=Object.freeze({__proto__:null,default:S6}),I6="desc;changes object into specified element",N6=Object.freeze({__proto__:null,default:I6}),C6="desc;like #play but for sound effects",L6=Object.freeze({__proto__:null,default:C6}),M6="",U6=Object.freeze({__proto__:null,default:M6}),F6="",P6=Object.freeze({__proto__:null,default:F6}),B6="",$6=Object.freeze({__proto__:null,default:B6}),D6="",j6=Object.freeze({__proto__:null,default:D6}),z6="",W6=Object.freeze({__proto__:null,default:z6}),G6="",K6=Object.freeze({__proto__:null,default:G6}),H6="",Y6=Object.freeze({__proto__:null,default:H6}),V6="",X6=Object.freeze({__proto__:null,default:V6}),q6="",J6=Object.freeze({__proto__:null,default:q6}),Z6="",Q6=Object.freeze({__proto__:null,default:Z6}),tM="",eM=Object.freeze({__proto__:null,default:tM}),nM="",rM=Object.freeze({__proto__:null,default:nM}),iM="",sM=Object.freeze({__proto__:null,default:iM}),oM="",aM=Object.freeze({__proto__:null,default:oM}),cM="",lM=Object.freeze({__proto__:null,default:cM}),uM=`desc;$DKGRAYstarts a section of an if-do-done block
`,hM=Object.freeze({__proto__:null,default:uM}),fM=`desc;$DKGRAYcompletes an if-do-done block
`,dM=Object.freeze({__proto__:null,default:fM}),pM="",mM=Object.freeze({__proto__:null,default:pM}),gM="",_M=Object.freeze({__proto__:null,default:gM}),yM="",bM=Object.freeze({__proto__:null,default:yM}),wM=`desc;$DKGRAYelse logic in an if-do-done block
`,EM=Object.freeze({__proto__:null,default:wM}),xM=`desc;$DKGRAYconditional else logic in an if-do-done block
`,kM=Object.freeze({__proto__:null,default:xM}),vM="",TM=Object.freeze({__proto__:null,default:vM}),AM="",RM=Object.freeze({__proto__:null,default:AM}),SM="",OM=Object.freeze({__proto__:null,default:SM}),IM="",NM=Object.freeze({__proto__:null,default:IM}),CM="",LM=Object.freeze({__proto__:null,default:CM}),MM="",UM=Object.freeze({__proto__:null,default:MM}),FM="",PM=Object.freeze({__proto__:null,default:FM}),BM="",$M=Object.freeze({__proto__:null,default:BM}),DM=`desc;$DKGRAYhalt until the next cycle
`,jM=Object.freeze({__proto__:null,default:DM}),zM=`desc;$DKGRAYevals condition for true or false
`,WM=Object.freeze({__proto__:null,default:zM}),GM="",KM=Object.freeze({__proto__:null,default:GM}),HM="",YM=Object.freeze({__proto__:null,default:HM}),VM="",XM=Object.freeze({__proto__:null,default:VM}),qM="",JM=Object.freeze({__proto__:null,default:qM}),ZM="",QM=Object.freeze({__proto__:null,default:ZM}),t8="",e8=Object.freeze({__proto__:null,default:t8}),n8="",r8=Object.freeze({__proto__:null,default:n8}),i8="",s8=Object.freeze({__proto__:null,default:i8}),o8="",a8=Object.freeze({__proto__:null,default:o8}),c8="",l8=Object.freeze({__proto__:null,default:c8}),u8="",h8=Object.freeze({__proto__:null,default:u8}),f8="",d8=Object.freeze({__proto__:null,default:f8}),p8="",m8=Object.freeze({__proto__:null,default:p8}),g8="",_8=Object.freeze({__proto__:null,default:g8}),y8="",b8=Object.freeze({__proto__:null,default:y8}),w8="",E8=Object.freeze({__proto__:null,default:w8}),x8="",k8=Object.freeze({__proto__:null,default:x8}),v8="",T8=Object.freeze({__proto__:null,default:v8}),A8="",R8=Object.freeze({__proto__:null,default:A8}),S8="",O8=Object.freeze({__proto__:null,default:S8}),I8="",N8=Object.freeze({__proto__:null,default:I8}),C8=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,L8=Object.freeze({__proto__:null,default:C8}),M8="",U8=Object.freeze({__proto__:null,default:M8}),F8="",P8=Object.freeze({__proto__:null,default:F8}),B8="",$8=Object.freeze({__proto__:null,default:B8}),D8="",j8=Object.freeze({__proto__:null,default:D8}),z8="",W8=Object.freeze({__proto__:null,default:z8}),G8="",K8=Object.freeze({__proto__:null,default:G8}),H8="",Y8=Object.freeze({__proto__:null,default:H8}),V8="",X8=Object.freeze({__proto__:null,default:V8}),q8="",J8=Object.freeze({__proto__:null,default:q8}),Z8="",Q8=Object.freeze({__proto__:null,default:Z8}),t3="",e3=Object.freeze({__proto__:null,default:t3}),n3="",r3=Object.freeze({__proto__:null,default:n3}),i3="",s3=Object.freeze({__proto__:null,default:i3}),o3="",a3=Object.freeze({__proto__:null,default:o3}),c3="",l3=Object.freeze({__proto__:null,default:c3}),u3="",h3=Object.freeze({__proto__:null,default:u3}),f3="",d3=Object.freeze({__proto__:null,default:f3}),p3="",m3=Object.freeze({__proto__:null,default:p3}),g3="",_3=Object.freeze({__proto__:null,default:g3}),y3=`desc;$DKGRAYdesignates an inactive label or comment
`,b3=Object.freeze({__proto__:null,default:y3}),w3=`desc;$DKGRAYadds hyperlink text

`,E3=Object.freeze({__proto__:null,default:w3}),x3=`desc;$DKGRAYsends the given message when hotkey is pressed

`,k3=Object.freeze({__proto__:null,default:x3}),v3=`desc;$DKGRAYread number input into given stat/flag
`,T3=Object.freeze({__proto__:null,default:v3}),A3=`desc;$DKGRAYa slider input from 1 to 9 

`,R3=Object.freeze({__proto__:null,default:A3}),S3=`desc;$DKGRAYlist with label value pairs to pick from
`,O3=Object.freeze({__proto__:null,default:S3}),I3=`desc;$DKGRAYread text input into given stat/flag
`,N3=Object.freeze({__proto__:null,default:I3}),C3=`desc;$DKGRAYdesignates a starting point for running code
`,L3=Object.freeze({__proto__:null,default:C3}),M3=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,U3=Object.freeze({__proto__:null,default:M3}),F3=`desc;$DKGRAYwill move the object in the given direction
`,P3=Object.freeze({__proto__:null,default:F3}),B3=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,$3=Object.freeze({__proto__:null,default:B3}),D3=`desc;$DKGRAYcustom 8x14 charset
`,j3=Object.freeze({__proto__:null,default:D3}),z3=`desc;$DKGRAYsets stat to given value

`,W3=Object.freeze({__proto__:null,default:z3}),G3=`desc;$DKGRAYsends the given message when hotkey is pressed

`,K3=Object.freeze({__proto__:null,default:G3}),H3=`desc;$DKGRAYread external content and/or handle events
`,Y3=Object.freeze({__proto__:null,default:H3}),V3=`desc;$DKGRAYread number input into given stat/flag
`,X3=Object.freeze({__proto__:null,default:V3}),q3=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,J3=Object.freeze({__proto__:null,default:q3}),Z3=`desc;$DKGRAYcustom palette colors
`,Q3=Object.freeze({__proto__:null,default:Z3}),tU=`desc;$DKGRAYa slider input from 1 to 9 

`,eU=Object.freeze({__proto__:null,default:tU}),nU=`desc;$DKGRAYlist with label value pairs to pick from
`,rU=Object.freeze({__proto__:null,default:nU}),iU=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,sU=Object.freeze({__proto__:null,default:iU}),oU=`desc;$DKGRAYread text input into given stat/flag
`,aU=Object.freeze({__proto__:null,default:oU}),cU=`desc;$DKGRAYadds text
`,lU=Object.freeze({__proto__:null,default:cU}),uU=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,hU=Object.freeze({__proto__:null,default:uU}),fU=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,dU=Object.freeze({__proto__:null,default:fU}),pU=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,mU=Object.freeze({__proto__:null,default:pU}),gU=`header;player settings
#set user "name goes here"
`,_U=Object.freeze({__proto__:null,default:gU}),yU=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,bU=Object.freeze({__proto__:null,default:yU});const xb=Object.assign({"./editor/codepagename.txt":O6,"./editor/command/become.txt":N6,"./editor/command/bgplay.txt":L6,"./editor/command/bgvol.txt":U6,"./editor/command/bind.txt":P6,"./editor/command/board.txt":$6,"./editor/command/bpm.txt":j6,"./editor/command/break.txt":W6,"./editor/command/change.txt":K6,"./editor/command/char.txt":Y6,"./editor/command/charset.txt":X6,"./editor/command/clear.txt":J6,"./editor/command/color.txt":Q6,"./editor/command/continue.txt":eM,"./editor/command/copy.txt":rM,"./editor/command/cycle.txt":sM,"./editor/command/die.txt":aM,"./editor/command/distort.txt":lM,"./editor/command/do.txt":hM,"./editor/command/done.txt":dM,"./editor/command/duplicate.txt":mM,"./editor/command/echo.txt":_M,"./editor/command/edge.txt":bM,"./editor/command/else.txt":EM,"./editor/command/elseif.txt":kM,"./editor/command/end.txt":TM,"./editor/command/endgame.txt":RM,"./editor/command/endwith.txt":OM,"./editor/command/fcrush.txt":NM,"./editor/command/fetch.txt":LM,"./editor/command/fetchwith.txt":UM,"./editor/command/foreach.txt":PM,"./editor/command/go.txt":$M,"./editor/command/idle.txt":jM,"./editor/command/if.txt":WM,"./editor/command/lock.txt":KM,"./editor/command/oneof.txt":YM,"./editor/command/oneofwith.txt":XM,"./editor/command/palette.txt":JM,"./editor/command/phaser.txt":QM,"./editor/command/pivot.txt":e8,"./editor/command/play.txt":r8,"./editor/command/put.txt":s8,"./editor/command/putwith.txt":a8,"./editor/command/readbin.txt":l8,"./editor/command/readjson.txt":h8,"./editor/command/readline.txt":d8,"./editor/command/readrexpaint.txt":m8,"./editor/command/remix.txt":_8,"./editor/command/repeat.txt":b8,"./editor/command/restore.txt":E8,"./editor/command/reverb.txt":k8,"./editor/command/revert.txt":T8,"./editor/command/run.txt":R8,"./editor/command/runwith.txt":O8,"./editor/command/set.txt":N8,"./editor/command/shoot.txt":L8,"./editor/command/shootwith.txt":U8,"./editor/command/shove.txt":P8,"./editor/command/snapshot.txt":$8,"./editor/command/synth.txt":j8,"./editor/command/toast.txt":W8,"./editor/command/tts.txt":K8,"./editor/command/ttsvol.txt":Y8,"./editor/command/twitchbroadcast.txt":X8,"./editor/command/twitchchat.txt":J8,"./editor/command/unlock.txt":Q8,"./editor/command/vibrato.txt":e3,"./editor/command/vol.txt":r3,"./editor/command/waitfor.txt":s3,"./editor/command/walk.txt":a3,"./editor/command/weave.txt":l3,"./editor/command/while.txt":h3,"./editor/command/with.txt":d3,"./editor/command/write.txt":m3,"./editor/command/zap.txt":_3,"./editor/comment.txt":b3,"./editor/hyperlink.txt":E3,"./editor/hyperlink/hotkey.txt":k3,"./editor/hyperlink/number.txt":T3,"./editor/hyperlink/range.txt":R3,"./editor/hyperlink/select.txt":O3,"./editor/hyperlink/text.txt":N3,"./editor/label.txt":L3,"./editor/shortgo.txt":U3,"./editor/shorttry.txt":P3,"./editor/stat/board.txt":$3,"./editor/stat/charset.txt":j3,"./editor/stat/const.txt":W3,"./editor/stat/hotkey.txt":K3,"./editor/stat/loader.txt":Y3,"./editor/stat/number.txt":X3,"./editor/stat/object.txt":J3,"./editor/stat/palette.txt":Q3,"./editor/stat/range.txt":eU,"./editor/stat/select.txt":rU,"./editor/stat/terrain.txt":sU,"./editor/stat/text.txt":aU,"./editor/text.txt":lU,"./help/controls.txt":hU,"./help/developer.txt":dU,"./help/menu.txt":mU,"./help/player.txt":_U,"./help/text.txt":bU}),kb={};sr(xb).forEach(e=>{const t=e.replace(".txt","").replace("./","").replaceAll("/",":");kb[t]=xb[e].default});function wU(e){const t=Ot(e.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=kb[t];if(E(n))return n;const{target:r,path:i}=Xn(t);switch(r){case"editor":{const s=Xn(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function EU(e,t){const n=(e??"").split(`
`);for(let r=0;r<n.length;++r)t(n[r].split(";"))}function xU(e,t){const[n,...r]=t,i=r[0]??"",s=r[1]??"";switch(Ot(n.trim())){case"header":ad(et,e,i);break;case"section":Rs(et,e,i);break;case"option":Ss(et,e,i,s);break;default:n.trimStart().startsWith("!")?R6(et,e,n.trimStart().slice(1),i):ye(et,e,n);break}}function Oi(e){const[t,n]=rt(e,0,[K.NAME,K.ANY]);if(Ot(t)==="send"&&Rr(n)){const[,r,i,s]=rt(e,0,[K.NAME,K.DIR,K.MAYBE_NAME]);return _t(i)&&i.startsWith(":")?{targetdir:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetdir:r,label:e.slice(s-1).join(" ")}}else if(_t(t)){const[r,i,s]=rt(e,0,[K.NAME,K.MAYBE_NAME]);return _t(i)&&i.startsWith(":")?{targetname:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetname:"self",label:[r,...e.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function Os(){e0(et,ir())}function Ca(e){EU(wU(`help:${e}`),t=>xU(x.elementfocus,t))}function vb(e){switch(e.label){case"helpmenu":Ca("menu");break;case"helpcontrols":Ca("controls");break;case"helptext":Ca("text");break;case"helpdeveloper":Ca("developer");break;case"helpplayer":Ca("player");break;default:{const t=ae(Bt.MAIN),n=yo(t);E(e.targetname)?So(e.targetname,e.label,void 0,n):E(e.targetdir)&&So(e.targetdir.destpt,e.label,void 0,n);break}}}const kU=Ei().command("shortsend",(e,t)=>{const n=Oi(t);return vb(n),0}).command("send",(e,t)=>{const n=Oi(["send",...t]);return vb(n),0}).command("stat",(e,t)=>{const[n,...r]=t.map(Te),i=r.join(" ");function s(o,a){if(E(o)&&(e.command("pageopen",o.id),a)){const c=Le(o),l=Mr(o);ye(et,x.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(Ot(n)){case nr(vt.LOADER):{const[o,a]=Qi(Bt.MAIN,i,yt.LOADER);s(o,a);break}default:{const[o,a]=Qi(Bt.MAIN,[n,...r].join(" "),yt.OBJECT);s(o,a);break}case nr(vt.BOARD):{const[o,a]=Qi(Bt.MAIN,i,yt.BOARD);s(o,a);break}case nr(vt.OBJECT):{const[o,a]=Qi(Bt.MAIN,i,yt.OBJECT);s(o,a);break}case nr(vt.TERRAIN):{const[o,a]=Qi(Bt.MAIN,i,yt.TERRAIN);s(o,a);break}case nr(vt.CHARSET):{const[o,a]=Qi(Bt.MAIN,i,yt.CHARSET);s(o,a);break}case nr(vt.PALETTE):{const[o,a]=Qi(Bt.MAIN,i,yt.PALETTE);s(o,a);break}}return 0}).command("text",(e,t)=>{const n=t.map(Te).join(" ");if(E(x.element)&&x.elementisplayer){const{user:r}=yr(x.elementid),i=_t(r)?r:"player";x.element.tickertext=`${i}: ${n}`,x.element.tickertime=x.timestamp;const s=go(x.element,1,dt.WHITE,dt.BLACK);xe(et,x.elementid,`$${dt[s.color]}$ON${dt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),mu(et,x.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Oi(r);if(E(s.targetname)){const{user:o}=yr(x.elementid),a=_t(o)?o:"player",c=go(x.element,1,dt.WHITE,dt.BLACK),l=`$${dt[c.color]}$ON${dt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;xe(et,x.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(e,t)=>{const[n,r]=rt(t,0,[K.MAYBE_NAME,K.MAYBE_STRING]);return _t(n)&&_t(r)?Zd(et,x.elementfocus,n,r):iE(et,x.elementfocus),0}).command("bookcreate",(e,t)=>{const[n]=rt(t,0,[K.MAYBE_NAME]),r=g1(n);return E(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=Fr(n);return E(r)?(Zd(et,x.elementfocus,"selected",r.id),Os()):fe(et,x.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=ae(Bt.MAIN),i=Fr(n);return E(i)&&(r===i&&m1(Bt.MAIN,""),wF(n),xe(et,x.elementfocus,`trashed [book] ${i.name}`),Os(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=Hn(n);return E(r)&&_o(x.book,x.elementfocus,r.id,{x:lr(0,At-1),y:lr(0,Vt-1)}),0}).command("pageopen",(e,t)=>{const[n,r]=rt(t,0,[K.NAME,K.MAYBE_NAME]);let i,s;const o=Ur();for(let a=0;a<o.length&&(s=o[a],i=Ts(s,n),!E(i));++a);if(E(i)&&E(s)){const a=Le(i),c=Mr(i);xe(et,x.elementfocus,`opened [${c}] ${a}`);const l=[i.id,r];hh(Ka(s.id,l),i.code);const u=Mr(i);Qd(et,x.elementfocus,s.id,l,u,`${a} - ${s.name}`)}else fe(et,"pageopen",`page ${n} not found`,x.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=ln(Bt.MAIN),i=hb(r,n);if(E(n)){const s=Le(i),o=Mr(i);xe(et,x.elementfocus,`trashed [${o}] ${s}`),Os(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(Te).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Rs(et,x.elementfocus,"books");const e=ae(Bt.MAIN);Ss(et,x.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=ae(Bt.MAIN);Ss(et,x.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),od(et,x.elementfocus,7);const n=Ur();return n.length?n.forEach(r=>{ye(et,x.elementfocus,`!bookopen ${r.id};${r.name}`)}):zn(et,x.elementfocus,"no books found"),ye(et,x.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=ln(Bt.MAIN);if(!E(e))return 0;Rs(et,x.elementfocus,"pages"),Ss(et,x.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?Ia(e).forEach(r=>{const i=Le(r),s=Mr(r);ye(et,x.elementfocus,`!pageopen ${r.id};$blue[${s}]$white ${i}`)}):(ye(et,x.elementfocus,""),zn(et,x.elementfocus,"$white no pages found"),zn(et,x.elementfocus,"$white use @ to create a page"),zn(et,x.elementfocus,"$white @board name of board"),zn(et,x.elementfocus,"$white @object name of object"),zn(et,x.elementfocus,"$white @terrain name of terrain"),zn(et,x.elementfocus,"$white You can omit the type and it will default to object"),zn(et,x.elementfocus,"$white @object name of object"),zn(et,x.elementfocus,"$white @name of object"));const t=Ur();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Ss(et,x.elementfocus,"content",`${r.name} $GREEN${r.id}`),Ia(r).forEach(s=>{const o=Le(s),a=Mr(s);ye(et,x.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Rs(et,x.elementfocus,"boards");const e=ln(Bt.MAIN);if(E(e)){Ss(et,x.elementfocus,"main",`${e.name} $GREEN${e.id}`);const n=Ia(e);n.filter(r=>ai(r)===yt.BOARD).forEach(r=>{const i=Le(r),s=Mr(r);ye(et,x.elementfocus,`!boardopen ${r.id};$blue[${s}]$white ${i}`)}),n.length===0&&(ye(et,x.elementfocus,""),zn(et,x.elementfocus,"$white no boards found"),zn(et,x.elementfocus,"$white use @ to create a board"),zn(et,x.elementfocus,"$white @board name of board"))}const t=Ur();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Ss(et,x.elementfocus,"content",`${r.name} $GREEN${r.id}`),Ia(r).filter(s=>ai(s)===yt.BOARD).forEach(s=>{const o=Le(s),a=Mr(s);ye(et,x.elementfocus,`!boardopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("trash",()=>{Rs(et,x.elementfocus,"$REDTRASH"),zn(et,x.elementfocus,"books");const e=Ur();e.length&&(e.forEach(n=>{ye(et,x.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),ye(et,x.elementfocus,""));const t=ae(Bt.MAIN);return E(t)&&(zn(et,x.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Le(n);ye(et,x.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),ye(et,x.elementfocus,"")),0}).command("dev",()=>(Os(),Yw(et,x.elementfocus),0)).command("share",()=>(Os(),Vw(et,x.elementfocus),0)).command("save",()=>(Os(),0)).command("fork",()=>(lE(et,x.elementfocus),0)).command("itchiopublish",()=>(uE(et,x.elementfocus),0)).command("nuke",()=>(Xw(et,x.elementfocus),0)).command("restart",()=>(cE(et,x.elementfocus),Os(),0)).command("export",()=>{ad(et,x.elementfocus,"E X P O R T"),Rs(et,x.elementfocus,"books");const e=Ur();return e.length&&e.forEach(t=>ye(et,x.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=Fr(n);return E(r)&&(ad(et,x.elementfocus,"E X P O R T"),Rs(et,x.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=Ia(r);ye(et,x.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Le(s),a=Mr(s);ye(et,x.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=Fr(n);return E(r)&&qd(et,x.elementfocus,wr(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=rt(t,0,[K.NAME]),{target:r,path:i}=Xn(n),s=Fr(r),o=Ts(s,i);return E(o)&&qd(et,x.elementfocus,wr(o),`${Le(o)}.${Mr(o)}.json`),0}).command("gadget",()=>(sE(et,x.elementfocus),0)).command("joincode",(e,t)=>{const[n]=rt(t,0,[K.MAYBE_NAME]);return Pw(et,x.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=rt(t,0,[K.MAYBE_NAME]);return Bw(et,x.elementfocus,!!n),0}).command("startlookingglass",()=>(qw(et,x.elementfocus),0)),vU=Ei().command("toast",(e,t)=>{const n=t.map(Te).join("");return Vd(et,x.elementfocus,n),0}).command("ticker",(e,t)=>{const n=t.map(Te).join("");return E(x.element)&&(x.element.tickertext=n,x.element.tickertime=x.timestamp),0}).command("palette",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=y1(),i=tn(x.book,yt.PALETTE,n);return E(i)?(r.palette=i.id,xe(et,x.elementfocus,`loaded palette ${n}`)):fe(et,x.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=y1(),i=tn(x.book,yt.CHARSET,n);return E(i)?(r.charset=i.id,xe(et,x.elementfocus,`loaded charset ${n}`)):fe(et,x.elementfocus,"not-found",`unabled to find charset ${n}`),0}),cd={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};jt.ISSOLID,jt.ISWALK,jt.ISSWIM,jt.ISBULLET,jt.ISWALK,jt.ISSWIM;function Il(e){return le(e)&&ld(e[0])}function ld(e){return E(jt[e])&&_t(e)}function TU(e){if(_t(e))return cd[Ot(e)]}function AU(e){const t=x.words[e];if(Il(t))return[t,e+1];if(ld(t))return[[t],e+1];const[n,r]=Wn(e);return Il(n)?[n,r]:ld(n)?[[n],r]:[void 0,e]}function bo(e,t=0){const n=[];let r=e;for(;r<x.words.length;){const[i,s]=Wn(r);if(le(i)&&!Rr(i)&&!La(i)&&!Il(i)&&!Xr(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),t>0&&n.length>=t)return[n,r]}return[n,r]}function Wn(e){var r,i,s,o,a,c,l,u,f;const t=x.words[e],n=e+1;if(Ab(t)){const[d,h]=RU(e);if(E(d))return[d,h]}if(TU(t)){const[d,h]=AU(e);if(E(d))return[d,h]}if(vc(t)){const[d,h]=wh(e);if(E(d))return[d,h]}if(_t(t)&&Ot(t)==="rnd"){const[d,h]=Wn(n),[m,p]=Wn(h);return Tt(d)&&Tt(m)?[lr(d,m),p]:Tt(d)?[lr(0,d),h]:[lr(0,1),n]}if(bh(t)){const[d,h]=um(e);if(E(d))return[d,h]}if(!E(t))return[void 0,e];if(Tt(t)||le(t))return[t,n];if(_t(t)){const d=Ot(t),h=(r=x.get)==null?void 0:r.call(x,t);if(E(h))return[h,n];switch(d){case"aligned":case"alligned":{const m=Zo(x.board,{x:((i=x.element)==null?void 0:i.x)??-1,y:((s=x.element)==null?void 0:s.y)??-1},x.elementfocus);return!E(x.element)||!E(m)?[0,n]:[x.element.x===m.x||x.element.y===m.y?1:0,n]}case"contact":{const m=Zo(x.board,{x:((o=x.element)==null?void 0:o.x)??-1,y:((a=x.element)==null?void 0:a.y)??-1},x.elementfocus);if(!E(x.element)||!E(m))return[0,n];const p=(m.x??0)-(((c=x.element)==null?void 0:c.x)??0),w=(m.y??0)-(((l=x.element)==null?void 0:l.y)??0);return[p===0&&Math.abs(w)<2||w===0&&Math.abs(p)<2?1:0,n]}case"blocked":{const[m,p]=rt(x.words,n,[K.DIR]);return[vT(x.board,x.element,m.destpt)?1:0,p]}case"any":{const[m,p]=rt(x.words,n,[K.KIND]);return[kh(x.board,m).length?1:0,p]}case"count":{const[m,p]=rt(x.words,n,[K.KIND]);return[kh(x.board,m).length,p]}case"color":{const[m,p,w]=rt(x.words,n,[K.DIR,K.COLOR]),b=m.layer===pt.MID?ee(x.board,m.destpt):es(x.board,m.destpt.x,m.destpt.y);if(E(b)){const v=go(b,-1,-1,-1);return[dm(p)===v.color||pm(p)===v.bg?1:0,w]}return[0,w]}case"detect":{const[m,p,w]=rt(x.words,n,[K.DIR,K.KIND]),b=m.layer===pt.MID?ee(x.board,m.destpt):es(x.board,m.destpt.x,m.destpt.y);if(E(b)){const v=Ot(Tc(p)),A=Eh(p),R=go(b,-1,-1,-1);if(v&&v===Ot(Jr(b)))return[1,w];if(E(A)&&A===R.color)return[1,w]}return[0,w]}case"rnd":return[lr(0,1),n];case"abs":{const[m,p]=rt(x.words,n,[K.NUMBER]);return[Math.abs(m),p]}case"intceil":{const[m,p]=rt(x.words,n,[K.NUMBER]);return[Math.ceil(m),p]}case"intfloor":{const[m,p]=rt(x.words,n,[K.NUMBER]);return[Math.floor(m),p]}case"intround":{const[m,p]=rt(x.words,n,[K.NUMBER]);return[Math.round(m),p]}case"clamp":{const[m,p,w,b]=rt(x.words,n,[K.NUMBER,K.NUMBER,K.NUMBER]);return[fn(m,p,w),b]}case"min":{const[m,p]=bo(n);return[Math.min(...m),p]}case"max":{const[m,p]=bo(n);return[Math.max(...m),p]}case"pick":{const[m,p]=bo(n);return[qe(m),p]}case"pickwith":{const[m,p]=rt(x.words,n,[K.NUMBER_OR_STRING]),[w,b]=bo(p);return[Rv(`${m}`,w),b]}case"random":{const[m,p]=bo(n,2),[w,b]=m;return[lr(w,b??0),p]}case"randomwith":{const[m,p]=rt(x.words,n,[K.NUMBER_OR_STRING]),[w,b]=bo(p,2),[v,A]=w;return[om(`${m}`,v,A??0),b]}case"run":{const[m,p]=rt(x.words,n,[K.NAME]);return Hl(m),[(u=x.get)==null?void 0:u.call(x,"arg"),p]}case"runwith":{const[m,p,w]=rt(x.words,n,[K.ANY,K.NAME]);return E(x.element)&&(x.element.arg=m),Hl(p),[(f=x.get)==null?void 0:f.call(x,"arg"),w]}}}return[t,n]}const ud={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function La(e){return le(e)&&Tb(e[0])}function Tb(e){return E(Ln[e])&&_t(e)}function Ab(e){if(_t(e))return ud[Ot(e)]}function Rb(e){if(La(e))return e;if(Tb(e))return[e];const t=Ab(e);if(E(t))return[t]}function RU(e){const t=x.words[e],n=Rb(t);if(La(n))return[n,e+1];const[r,i]=Wn(e),s=Rb(r);return La(s)?[s,i]:[void 0,e]}const SU=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Sb=new Set(["char","color","bg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"]),OU=["NORTH","SOUTH","WEST","EAST"];function IU(e){const t=yr(e);if(Tt(t.inputcurrent)||(t.inputcurrent=0),le(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=kn.NONE,i=0]=n??[kn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&yT?1:0,t.inputctrl=i&bT?1:0,t.inputshift=i&wT?1:0,r){case kn.MOVE_UP:case kn.MOVE_DOWN:case kn.MOVE_LEFT:case kn.MOVE_RIGHT:t.inputmove=[OU[r-kn.MOVE_UP]];break;case kn.OK_BUTTON:t.inputok=1;break;case kn.CANCEL_BUTTON:t.inputcancel=1;break;case kn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==kn.NONE&&o!==r}),t}function NU(e){const t=ud[e];if(E(t))return t;const n=cd[e];if(E(n))return n;const r=qo[e];if(E(r))return r;const i=yh[e];if(E(i))return i}const CU=Ei({get(e,t){var o,a,c,l,u,f,d,h,m,p,w,b,v,A,R,M,S,I,P,C,D;const n=NU(t);if(E(n))return[!0,n];if(x.elementisplayer&&SU.has(t)){const G=IU(x.elementid)[t];return[E(G),G]}const r=Zo(x.board,{x:((o=x.element)==null?void 0:o.x)??-1,y:((a=x.element)==null?void 0:a.y)??-1},x.elementfocus),i=(r==null?void 0:r.id)??x.elementfocus??ir();switch(t){case"camera":case"graphics":case"facing":if(E((c=x.board)==null?void 0:c[t]))return[!0,(l=x.board)==null?void 0:l[t]];break;case"isdark":return[!0,(u=x.board)!=null&&u.isdark?1:0];case"startx":return[!0,((f=x.board)==null?void 0:f.startx)??0];case"starty":return[!0,((d=x.board)==null?void 0:d.starty)??0];case"over":return[!0,((h=x.board)==null?void 0:h.over)??""];case"under":return[!0,((m=x.board)==null?void 0:m.under)??""];case"exitnorth":return[!0,((p=x.board)==null?void 0:p.exitnorth)??""];case"exitsouth":return[!0,((w=x.board)==null?void 0:w.exitsouth)??""];case"exitwest":return[!0,((b=x.board)==null?void 0:b.exitwest)??""];case"exiteast":return[!0,((v=x.board)==null?void 0:v.exiteast)??""];case"timelimit":return[!0,((A=x.board)==null?void 0:A.timelimit)??0];case"restartonzap":return[!0,((R=x.board)==null?void 0:R.restartonzap)??0];case"maxplayershots":return[!0,((M=x.board)==null?void 0:M.maxplayershots)??0];case"currenttick":return[!0,x.timestamp];case"boardid":return[!0,((S=x.board)==null?void 0:S.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((I=x.element)==null?void 0:I.id)??""];case"thisx":return[!0,((P=x.element)==null?void 0:P.x)??-1];case"thisy":return[!0,((C=x.element)==null?void 0:C.y)??-1];default:{const G=(D=x.element)==null?void 0:D[t];if(Sb.has(t))return[!0,G];break}}const s=yr(i)[t];return[E(s),s]},set(e,t,n){var o,a;const r=Zo(x.board,{x:((o=x.element)==null?void 0:o.x)??-1,y:((a=x.element)==null?void 0:a.y)??-1},x.elementfocus),i=(r==null?void 0:r.id)??x.elementfocus;switch(t){case"camera":case"graphics":case"facing":break;case"isdark":if(E(x.board))return x.board.isdark=n?1:0,[!0,x.board.isdark];break;case"startx":if(E(x.board))return x.board.startx=aa(n,0),[!0,x.board.startx];break;case"starty":if(E(x.board))return x.board.starty=aa(n,0),[!0,x.board.starty];break;case"over":if(E(x.board))return x.board.over=Te(n),[!0,x.board.over];break;case"under":if(E(x.board))return[!0,x.board.under=Te(n)];break;case"exitnorth":if(E(x.board))return[!0,x.board.exitnorth=Te(n)];break;case"exitsouth":if(E(x.board))return[!0,x.board.exitsouth=Te(n)];break;case"exitwest":if(E(x.board))return[!0,x.board.exitwest=Te(n)];break;case"exiteast":if(E(x.board))return[!0,x.board.exiteast=Te(n)];break;case"timelimit":if(E(x.board))return[!0,x.board.timelimit=aa(n,0)];break;case"restartonzap":if(E(x.board))return[!0,x.board.restartonzap=n?1:0];break;case"maxplayershots":if(E(x.board))return[!0,x.board.maxplayershots=aa(n,0)];break;case"currenttick":return[!1,n];case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(Sb.has(t))return E(x.element)&&(x.element[t]=n),[!0,n];break}}const s=yr(i);return E(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=x.element)!=null&&e.removed)&&(E((t=x.element)==null?void 0:t.stepx)||E((n=x.element)==null?void 0:n.stepy))){const s={x:((r=x.element)==null?void 0:r.x)??0,y:((i=x.element)==null?void 0:i.y)??0};ts(x.book,x.board,x.element,{x:s.x+(x.element.stepx??0),y:s.y+(x.element.stepy??0)})===!1&&(x.element.stepx=0,x.element.stepy=0,Ht(x.element,"breakable")&&wn(x.board,x.element,x.timestamp))}}}).command("clear",(e,t)=>{for(let n=0;n<t.length;++n)e.set(Te(t[n]),0);return 0}).command("set",(e,t)=>{const[n,r]=rt(t,0,[K.NAME,K.ANY]);return e.set(n,r??1),0}).command("become",(e,t)=>{var r,i;const[n]=rt(t,0,[K.KIND]);if(Ue(x.board),Ch(x.board,x.element),wn(x.board,x.element,x.timestamp)){const s={x:((r=x.element)==null?void 0:r.x)??0,y:((i=x.element)==null?void 0:i.y)??0};Rt(x.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=rt(t,0,[K.ANY]);if(Rr(n)){const[r,i]=rt(t,0,[K.DIR,K.NUMBER]),s=ee(x.board,r.destpt);E(s)&&(s.char=i)}else E(x.element)&&Tt(n)&&(x.element.char=n);return 0}).command("color",(e,t)=>{const[n]=rt(t,0,[K.ANY]);if(Rr(n)){const[r,i]=rt(t,0,[K.DIR,K.COLOR]),s=ee(x.board,r.destpt);E(s)&&ia(x.element,i)}else{const[r]=rt(t,0,[K.COLOR]);E(x.element)&&E(r)&&ia(x.element,r)}return 0}).command("go",(e,t)=>{if(E(x.element)){const[n]=rt(t,0,[K.DIR]);if(ts(x.book,x.board,x.element,n.destpt),e.yield(),x.element.x===n.destpt.x&&x.element.y===n.destpt.y)return 0}return 1}).command("walk",(e,t)=>{if(!E(x.element))return 0;const[n]=rt(t,0,[K.DIR]),r=x.element.x??0,i=x.element.y??0;return x.element.stepx=n.destpt.x-r,x.element.stepy=n.destpt.y-i,0}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=rt(t,0,[K.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Te(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Te(t[0])),0)).command("cycle",(e,t)=>{if(E(x.element)){const[n]=rt(t,0,[K.NUMBER]);x.element.cycle=fn(Math.round(n),1,255)}return 0}).command("die",e=>(wn(x.board,x.element,x.timestamp),e.endofprogram(),0)).command("endgame",()=>(t0(et,x.elementfocus),0)).command("run",(e,t)=>{const[n]=rt(t,0,[K.NAME]);return Hl(n),0}).command("runwith",(e,t)=>{const[n,r]=rt(t,0,[K.ANY,K.NAME]);return e.set("arg",n),Hl(r),0}),Nl={};function LU(e){var t;return(t=Nl[e])==null?void 0:t.arg}function MU(e){var t;return(t=Nl[e])==null?void 0:t.format}function wo(e){var t;return(t=Nl[e])==null?void 0:t.content}function Ob(e,t,n,r,i){const s=ae(Bt.MAIN);if(!E(s))return;const o=As(s,yt.LOADER).filter(a=>{const c=vs(a),l=c.format,u=_t(l)?new RegExp(l).test(t):!1,f=c.event,d=_t(f)?new RegExp(f).test(n):!1;return _t(l)&&_t(f)?u&&d:_t(l)?u:_t(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${$e()}_loader`;Nl[c]={arg:e,format:t,content:r,player:i},TF(c,o[a].code)}}function Ib(e,t){if(!E(e))return;const n=Ot(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const UU=(e,t)=>{const n=wo(e.id());if(!E(n))return 0;const[r,i]=rt(t,0,[K.NAME]),s=Ot(r);switch(s){case"seek":{const[o]=rt(t,i,[K.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(t,i,[K.NAME]);e.set(o,Ib(n,s));break}case"text":{const[o,a]=rt(t,i,[K.NAME,K.NAME]),c=Ib(n,o);if(Tt(c)&&_t(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);e.set(a,f),n.cursor+=c}break}case"palette":{const[o]=rt(t,i,[K.NAME]),[a]=Jf(x.book,yt.PALETTE,o),c=Ae(a);if(E(c)){const l=hT*Mc,u=ng(new Uint8Array(n.bytes.buffer,n.cursor,l));E(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=rt(t,i,[K.NAME]),[a]=Jf(x.book,yt.CHARSET,o),c=Ae(a);if(E(c)){const l=Uc*uT*Mh,u=rg(new Uint8Array(n.bytes.buffer,n.cursor,l));E(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},Eo=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Cl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!Cl(e[n],t[n]))return!1;return!0}if(Eo(e)&&Eo(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Cl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},Ll=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(Eo(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},FU=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Nb=e=>e>="0"&&e<="9"||e==="-",PU=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var q;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(q||(q={}));const Cb={"(":q.TOK_LPAREN,")":q.TOK_RPAREN,"*":q.TOK_STAR,",":q.TOK_COMMA,".":q.TOK_DOT,":":q.TOK_COLON,"@":q.TOK_CURRENT,$:q.TOK_ROOT,"]":q.TOK_RBRACKET,"{":q.TOK_LBRACE,"}":q.TOK_RBRACE},BU={"!":!0,"<":!0,"=":!0,">":!0},$U={"	":!0,"\n":!0,"\r":!0," ":!0};class DU{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(FU(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:q.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Cb[t[this._current]]!==void 0)n.push({start:this._current,type:Cb[t[this._current]],value:t[this._current]}),this._current+=1;else if(Nb(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:q.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:q.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:q.TOK_LITERAL,value:o})}else if(BU[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if($U[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:q.TOK_AND,value:"&&"})):n.push({start:r,type:q.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:q.TOK_OR,value:"||"})):n.push({start:r,type:q.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&PU(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;Nb(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:q.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:q.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:q.TOK_FLATTEN,value:"[]"}):{start:n,type:q.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_NE,value:"!="}):{start:n,type:q.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_LTE,value:"<="}):{start:n,type:q.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_GTE,value:">="}):{start:n,type:q.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:q.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const jU=new DU,yn={[q.TOK_EOF]:0,[q.TOK_UNQUOTEDIDENTIFIER]:0,[q.TOK_QUOTEDIDENTIFIER]:0,[q.TOK_RBRACKET]:0,[q.TOK_RPAREN]:0,[q.TOK_COMMA]:0,[q.TOK_RBRACE]:0,[q.TOK_NUMBER]:0,[q.TOK_CURRENT]:0,[q.TOK_EXPREF]:0,[q.TOK_ROOT]:0,[q.TOK_PIPE]:1,[q.TOK_OR]:2,[q.TOK_AND]:3,[q.TOK_EQ]:5,[q.TOK_GT]:5,[q.TOK_LT]:5,[q.TOK_GTE]:5,[q.TOK_LTE]:5,[q.TOK_NE]:5,[q.TOK_FLATTEN]:9,[q.TOK_STAR]:20,[q.TOK_FILTER]:21,[q.TOK_DOT]:40,[q.TOK_NOT]:45,[q.TOK_LBRACE]:50,[q.TOK_LBRACKET]:55,[q.TOK_LPAREN]:60};class zU{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==q.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...jU.tokenize(t),{type:q.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<yn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case q.TOK_LITERAL:return{type:"Literal",value:t.value};case q.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case q.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===q.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case q.TOK_NOT:return r=this.expression(yn.Not),{type:"NotExpression",children:[r]};case q.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===q.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(yn.Star),{type:"ValueProjection",children:[n,r]};case q.TOK_FILTER:return this.led(t.type,{type:"Identity"});case q.TOK_LBRACE:return this.parseMultiselectHash();case q.TOK_FLATTEN:return n={type:q.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(yn.Flatten),{type:"Projection",children:[n,r]};case q.TOK_LBRACKET:return this.lookahead(0)===q.TOK_NUMBER||this.lookahead(0)===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===q.TOK_STAR&&this.lookahead(1)===q.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(yn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case q.TOK_CURRENT:return{type:q.TOK_CURRENT};case q.TOK_ROOT:return{type:q.TOK_ROOT};case q.TOK_EXPREF:return i=this.expression(yn.Expref),{type:"ExpressionReference",children:[i]};case q.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(i={type:q.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(q.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case q.TOK_DOT:const i=yn.Dot;return this.lookahead(0)!==q.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case q.TOK_PIPE:return r=this.expression(yn.Pipe),{type:q.TOK_PIPE,children:[n,r]};case q.TOK_OR:return r=this.expression(yn.Or),{type:"OrExpression",children:[n,r]};case q.TOK_AND:return r=this.expression(yn.And),{type:"AndExpression",children:[n,r]};case q.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(a={type:q.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===q.TOK_COMMA&&this.match(q.TOK_COMMA),o.push(a);return this.match(q.TOK_RPAREN),{name:s,type:"Function",children:o};case q.TOK_FILTER:const l=this.expression(0);return this.match(q.TOK_RBRACKET),r=this.lookahead(0)===q.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(yn.Filter),{type:"FilterProjection",children:[n,r,l]};case q.TOK_FLATTEN:const u={type:q.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(yn.Flatten);return{type:"Projection",children:[u,f]};case q.TOK_EQ:case q.TOK_NE:case q.TOK_GT:case q.TOK_GTE:case q.TOK_LT:case q.TOK_LTE:return this.parseComparator(n,t);case q.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===q.TOK_NUMBER||d.type===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(q.TOK_STAR),this.match(q.TOK_RBRACKET),r=this.parseProjectionRHS(yn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===q.TOK_COLON||this.lookahead(1)===q.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(q.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(yn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==q.TOK_RBRACKET&&n<3;){if(r===q.TOK_COLON)n+=1,this.advance();else if(r===q.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(q.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(yn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER,q.TOK_STAR].includes(n))return this.expression(t);if(n===q.TOK_LBRACKET)return this.match(q.TOK_LBRACKET),this.parseMultiselectList();if(n===q.TOK_LBRACE)return this.match(q.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(yn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===q.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===q.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===q.TOK_DOT)return this.match(q.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==q.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===q.TOK_COMMA&&(this.match(q.TOK_COMMA),this.lookahead(0)===q.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(q.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(q.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===q.TOK_COMMA)this.match(q.TOK_COMMA);else if(this.lookahead(0)===q.TOK_RBRACE){this.match(q.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const WU=new zU;var ut;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class GU{constructor(t){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>Eo(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(p=>{var w;return(w=!p.optional)!==null&&w!==void 0?w:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,m;for(let p=0;p<r.length;p+=1){m=!1,d=r[p].types,h=this.getTypeName(n[p]);let w;for(w=0;w<d.length;w+=1)if(h!==void 0&&this.typeMatches(h,d[w],n[p])){m=!0;break}if(!m&&h!==void 0){const b=d.map(v=>this.TYPE_NAME_TABLE[v]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${p+1} to be type (${b}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(t,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return t===ut.TYPE_ARRAY;if(t===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return t.jmespathType===q.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class KU{constructor(){this._rootValue=null,this.runtime=new GU(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,l,u,f,d,h;switch(t.type){case"Field":return n===null?null:Eo(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],n),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let m=t.value;return m<0&&(m=n.length+m),s=n[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const p=[...t.children],w=this.computeSliceParams(n.length,p),[b,v,A]=w;if(s=[],A>0)for(d=b;d<v;d+=A)s.push(n[d]);else for(d=b;d>v;d+=A)s.push(n[d]);return s;case"Projection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(t.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(t.children[0],n),!Eo(h))return null;f=[];const R=Object.values(h);for(d=0;d<R.length;d+=1)i=this.visit(t.children[1],R[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;const M=[],S=[];for(d=0;d<h.length;d+=1)r=this.visit(t.children[2],h[d]),Ll(r)||M.push(h[d]);for(let U=0;U<M.length;U+=1)i=this.visit(t.children[1],M[U]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case q.TOK_EQ:s=Cl(o,a);break;case q.TOK_NE:s=!Cl(o,a);break;case q.TOK_GT:s=o>a;break;case q.TOK_GTE:s=o>=a;break;case q.TOK_LT:s=o<a;break;case q.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case q.TOK_FLATTEN:const I=this.visit(t.children[0],n);if(!Array.isArray(I))return null;let P=[];for(d=0;d<I.length;d+=1)i=I[d],Array.isArray(i)?P=[...P,...i]:P.push(i);return P;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<t.children.length;d+=1)f.push(this.visit(t.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let C;for(d=0;d<t.children.length;d+=1)C=t.children[d],f[C.name]=this.visit(C.value,n);return f;case"OrExpression":return r=this.visit(t.children[0],n),Ll(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),Ll(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),Ll(o);case"Literal":return t.value;case q.TOK_PIPE:return l=this.visit(t.children[0],n),this.visit(t.children[1],l);case q.TOK_CURRENT:return n;case q.TOK_ROOT:return this._rootValue;case"Function":const D=[];for(let U=0;U<t.children.length;U+=1)D.push(this.visit(t.children[U],n));return this.runtime.callFunction(t.name,D);case"ExpressionReference":const G=t.children[0];return G.jmespathType=q.TOK_EXPREF,G;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const HU=new KU;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function YU(e,t){const n=WU.parse(t);return HU.search(n,e)}const VU=(e,t)=>{const n=wo(e.id());if(!E(n))return 0;const[r,i]=rt(t,0,[K.NAME,K.NAME]),s=YU(n.json,r);return e.set(i,s),0},XU=(e,t)=>{const n=wo(e.id());if(!E(n))return 0;const[r,i]=rt(t,0,[K.NAME]);switch(Ot(r)){case"seek":{const[o]=rt(t,i,[K.NUMBER]);n.cursor=fn(o,0,n.lines.length-1);break}case"line":n.cursor=fn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[f,d]=rt(t,u,[K.NAME]);e.set(f,c[l]??0),++l,u=d}break}}return 0};function Lb(e){const t=ae(Bt.MAIN),n=yo(t);E(e.targetdir)?So(e.targetdir.destpt,e.label,void 0,n):E(e.targetname)&&So(e.targetname,e.label,void 0,n)}const qU=Ei({get(e,t){const n=MU(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=wo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=wo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=wo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("shortsend",(e,t)=>{const n=Oi(t);return Lb(n),0}).command("send",(e,t)=>{const n=Oi(["send",...t]);return Lb(n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Te).join(" ");return xe(et,x.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Oi(r);return E(s.targetname)&&xe(et,x.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",XU).command("readjson",VU).command("readbin",UU).command("withboard",(e,t)=>{const[n]=rt(t,0,[K.STRING]),r=Hn(n);return E(r)&&(x.board=r,x.element={x:-1,y:-1}),0});function Mb(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=rt(i,a,[K.ANY]);le(c)&&!Rr(c)&&!La(c)&&!Il(c)&&!Xr(c)?o.push(...c):o.push(c),a=l}switch(Ot(r)){case"get":case"post:json":Cw(et,x.elementfocus,e,t,n,r,o);break}return 0}const JU=Ei().command("fetch",(e,t)=>{const[n,r,i="get",s]=rt(t,0,[K.NAME,K.NAME,K.MAYBE_STRING]);return Mb(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=rt(t,0,[K.ANY,K.NAME,K.NAME,K.MAYBE_STRING]);return Mb(n,r,i,s,t,o),0}).command("chat",(e,t)=>{const[n]=rt(t,0,[K.MAYBE_NAME]);return n?Iw(et,x.elementfocus,n):Nw(et,x.elementfocus),0}).command("broadcast",(e,t)=>{const[n]=rt(t,0,[K.MAYBE_NAME]);return n?Sw(et,x.elementfocus,n):Ow(et,x.elementfocus),0});function Ub(e,t){var n,r;if(E(t.targetname))switch(t.targetname){case"all":for(const i of Object.keys(((n=x.board)==null?void 0:n.objects)??{}))e.send(x.elementfocus,i,t.label);break;case"self":e.message({session:et.session(),player:x.elementfocus,id:$e(),sender:e.id(),target:t.label});break;case"others":for(const i of Object.keys(((r=x.board)==null?void 0:r.objects)??{}))i!==e.id()&&e.send(x.elementfocus,i,t.label);break;default:{const i=bm(x.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];E(o.id)&&e.send(x.elementfocus,o.id,t.label)}break}}else if(E(t.targetdir)){const i=ee(x.board,t.targetdir.destpt);E(i==null?void 0:i.id)&&e.send(x.elementfocus,i.id,t.label)}}const ZU=Ei({set(e,t,n){return GF(e,t,n),[!1,void 0]},everytick(){const e=On(x.elementid),[t]=e;if(e.length===1&&_t(t)){if(E(x.element))if(t.trim().length===0){const n=Ye(x.elementid);n.sidebar=[]}else x.element.tickertext=t,x.element.tickertime=x.timestamp}else if(e.length>1)if(x.elementisplayer){const n=Ye(x.elementid);n.sidebar=e}else{const n=Ye(x.elementfocus);n.scroll=e}}}).command("shortsend",(e,t)=>{const n=Oi(t);return Ub(e,n),0}).command("send",(e,t)=>{const n=Oi(["send",...t]);return Ub(e,n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Te).join("");return It(x.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Oi(r);return E(s.targetname)&&Ft(x.elementid,e.id(),i,`${s.targetname}:${s.label}`.split(" "),e.get,e.set),0});function Fb(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ee(t,{x:s,y:i});We(o)&&wn(t,o,e.timestamp),Re(t,{x:s,y:i})}}function QU(e,t,n){for(let r=t.y;r<=n.y;++r)for(let i=t.x;i<=n.x;++i)Re(e,{x:i,y:r})}function Pb(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ee(t,{x:s,y:i});We(o)&&wn(t,o,e.timestamp),Re(t,{x:s,y:i})}}function xo(e,t){E(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.code=t.code,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.stepx=t.stepx,e.stepy=t.stepy,e.pushable=t.pushable,e.collision=t.collision,e.breakable=t.breakable,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function hd(e,t,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return t2(e,t,n,"",i)}if(!E(x.book))return;const s=x.book,o=tn(s,yt.BOARD,e),a=Ae(o);if(!E(a))return;const c=tn(s,yt.BOARD,t),l=Ae(c);if(!E(l))return;Ue(a),Ue(l);let u=!1;if(E(a)&&E(l)){switch(i){case"all":Fb(s,l,n,r);break;case"object":Pb(s,l,n,r);break;case"terrain":QU(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,m=!1;switch(i){case"all":h=!0,m=!0;break;case"object":h=!0;break;case"terrain":m=!0;break}const p={x:d,y:f};let w,b=ee(a,p);if(We(b)?(w=es(a,d,f),Nn(b==null?void 0:b.id)&&(b=void 0)):(w=b,b=void 0),E(w)&&(m||u&&Ht(w,"group")===i)){u&&Fb(s,l,p,p);const v=Rt(l,[w.kind??""],p);xo(v,w)}if(E(b)&&(h||u&&Ht(b,"group")===i)){u&&Pb(s,l,p,p);const v=Rt(l,[b.kind??""],p);xo(v,b)}}sa(l)}}function t2(e,t,n,r,i){if(!E(x.book))return;const s=x.book,o=tn(s,yt.BOARD,e),a=Ae(o);if(!E(a))return;const c=tn(s,yt.BOARD,t),l=Ae(c);if(E(l)&&(Ue(a),Ue(l),E(a)&&E(l))){const{terrainelements:u,objectelements:f}=tg(a,r,i);if(u.length===0&&f.length===0)return;const d={x:At,y:Vt};for(let h=0;h<u.length;++h){const m=u[h];Tt(m.x)&&(d.x=Math.min(d.x,m.x)),Tt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<f.length;++h){const m=f[h];Tt(m.x)&&(d.x=Math.min(d.x,m.x)),Tt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<u.length;++h){const m=u[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},w=ee(l,p);E(w)&&(We(w)&&wn(l,w,s.timestamp),Re(l,p));const b=Rt(l,[m.kind??""],p);xo(b,m)}for(let h=0;h<f.length;++h){const m=f[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},w=Rt(l,[m.kind??""],p);xo(w,m)}sa(l)}}function e2(e,t,n,r,i){if(!E(x.book))return;const s=x.book,o=tn(s,yt.BOARD,e),a=Ae(o);if(!E(a))return;const c=Yl(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Ue(a),Ue(c);const f=-Math.tan(t*.5),d=Math.sin(t),h=Math.round(12.5*f),m=Math.round(12.5*d),p=new Array(Vt).fill(0);Jp(h,0,-h,Vt-1).forEach(R=>{R.x<0?p[R.y]=Math.min(p[R.y],R.x):p[R.y]=Math.max(p[R.y],R.x)});const b=new Array(At).fill(0);Jp(0,m,At-1,-m).forEach(R=>{R.y<0?b[R.x]=Math.min(b[R.x],R.y):b[R.x]=Math.max(b[R.x],R.y)});const A=[p,b,p];for(let R=0;R<A.length;++R){const M=A[R];if(R!==1){for(let S=0;S<Vt;++S){const I=M[S],P=S*At;for(let C=0;C<At;C++){const D=(C+I+At)%At;u&&(c.terrain[D+P]=a.terrain[C+P])}}if(l){const S=Object.keys(a.objects);for(let I=0;I<S.length;++I){const P=S[I],{x:C,y:D}=a.objects[P];if(E(C)&&E(D)){const G=M[D];a.objects[P].x=(C+G+At)%At,a.objects[P].lx=a.objects[P].x}}}}if(R===1){for(let S=0;S<At;++S){const I=M[S];for(let P=0;P<Vt;++P){const C=(P+I+Vt)%Vt;u&&(c.terrain[S+C*At]=a.terrain[S+P*At])}}if(l){const S=Object.keys(a.objects);for(let I=0;I<S.length;++I){const P=S[I],{x:C,y:D}=a.objects[P];if(E(C)&&E(D)){const G=M[C];a.objects[P].y=(D+G+Vt)%Vt,a.objects[P].ly=a.objects[P].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Ue(c),Ue(a)}}function n2(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var r2=n2;const i2=r2,Qt=function(){};Qt.prototype.FMX=0,Qt.prototype.FMY=0,Qt.prototype.FMXxFMY=0,Qt.prototype.T=0,Qt.prototype.N=0,Qt.prototype.initiliazedField=!1,Qt.prototype.generationComplete=!1,Qt.prototype.wave=null,Qt.prototype.compatible=null,Qt.prototype.weightLogWeights=null,Qt.prototype.sumOfWeights=0,Qt.prototype.sumOfWeightLogWeights=0,Qt.prototype.startingEntropy=0,Qt.prototype.sumsOfOnes=null,Qt.prototype.sumsOfWeights=null,Qt.prototype.sumsOfWeightLogWeights=null,Qt.prototype.entropies=null,Qt.prototype.propagator=null,Qt.prototype.observed=null,Qt.prototype.distribution=null,Qt.prototype.stack=null,Qt.prototype.stackSize=0,Qt.prototype.DX=[-1,0,1,0],Qt.prototype.DY=[0,1,0,-1],Qt.prototype.opposite=[2,3,0,1],Qt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},Qt.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=i2(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},Qt.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],m=f[h];m[i]--,m[i]==0&&this.ban(l,h)}}}},Qt.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},Qt.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},Qt.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},Qt.prototype.isGenerationComplete=function(){return this.generationComplete},Qt.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},Qt.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Bb=Qt;const $b=Bb,Ii=function(t,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let C=0;C<f;C++)d[C]=new Array(r);this.colors=[];const h={};for(let C=0;C<r;C++)for(let D=0;D<n;D++){const G=(C*n+D)*4,U=[t[G],t[G+1],t[G+2],t[G+3]],T=U.join("-");h.hasOwnProperty(T)||(h[T]=this.colors.length,this.colors.push(U)),d[D][C]=h[T]}const m=this.colors.length,p=Math.pow(m,i*i),w=function(D){let G=new Array(i*i);for(let U=0;U<i;U++)for(let T=0;T<i;T++)G[T+U*i]=D(T,U);return G},b=function(D,G){return w(function(U,T){return d[(D+U)%n][(G+T)%r]})},v=function(D){return w(function(G,U){return D[i-1-U+G*i]})},A=function(D){return w(function(G,U){return D[i-1-G+U*i]})},R=function(D){let G=0,U=1;for(let T=0;T<D.length;T++)G+=D[D.length-1-T]*U,U*=m;return G},M=function(D){let G=D,U=p;const T=new Array(i*i);for(let _=0;_<T.length;_++){U/=m;let N=0;for(;G>=U;)G-=U,N++;T[_]=N}return T},S={},I=[];for(let C=0;C<(a?r:r-i+1);C++)for(let D=0;D<(a?n:n-i+1);D++){const G=new Array(8);G[0]=b(D,C),G[1]=A(G[0]),G[2]=v(G[0]),G[3]=A(G[2]),G[4]=v(G[2]),G[5]=A(G[4]),G[6]=v(G[4]),G[7]=A(G[6]);for(let U=0;U<l;U++){const T=R(G[U]);S[T]?S[T]++:(I.push(T),S[T]=1)}}this.T=I.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let C=0;C<this.T;C++){const D=parseInt(I[C],10);this.patterns[C]=M(D),this.weights[C]=S[D]}const P=function(D,G,U,T){const _=U<0?0:U,N=U<0?U+i:i,V=T<0?0:T,B=T<0?T+i:i;for(let at=V;at<B;at++)for(let Z=_;Z<N;Z++)if(D[Z+i*at]!=G[Z-U+i*(at-T)])return!1;return!0};this.propagator=new Array(4);for(let C=0;C<4;C++){this.propagator[C]=new Array(this.T);for(let D=0;D<this.T;D++){const G=[];for(let U=0;U<this.T;U++)P(this.patterns[D],this.patterns[U],this.DX[C],this.DY[C])&&G.push(U);this.propagator[C][D]=G}}};Ii.prototype=Object.create($b.prototype),Ii.prototype.constructor=Ii,Ii.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Ii.prototype.clear=function(){if($b.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Ii.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Ii.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Ii.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const m=d+h*this.FMX;for(let p=0;p<this.T;p++)if(this.wave[m][p]){i++;const w=this.colors[this.patterns[p][f+u*this.N]];s+=w[0],o+=w[1],a+=w[2],c+=w[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var s2=Ii;const o2=Bb,qi=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const l=function(R){const M=new Array(o*o);for(let S=0;S<o;S++)for(let I=0;I<o;I++)M[I+S*o]=R(I,S);return M},u=function(R){return l(function(M,S){return R[o-1-S+M*o]})},f=function(R){return l(function(M,S){return R[o-1-M+S*o]})};this.tiles=[];const d=[],h=[],m={};let p,w,b;for(let A=0;A<t.tiles.length;A++){const R=t.tiles[A];if(c!==null&&c.indexOf(R.name)===-1)continue;switch(R.symmetry){case"L":b=4,p=function(S){return(S+1)%4},w=function(S){return S%2===0?S+1:S-1};break;case"T":b=4,p=function(S){return(S+1)%4},w=function(S){return S%2===0?S:4-S};break;case"I":b=2,p=function(S){return 1-S},w=function(S){return S};break;case"\\":b=2,p=function(S){return 1-S},w=function(S){return 1-S};break;case"F":b=8,p=function(S){return S<4?(S+1)%4:4+(S-1)%4},w=function(S){return S<4?S+4:S-4};break;default:b=1,p=function(S){return S},w=function(S){return S};break}this.T=h.length,m[R.name]=this.T;for(let S=0;S<b;S++)h.push([this.T+S,this.T+p(S),this.T+p(p(S)),this.T+p(p(p(S))),this.T+w(S),this.T+w(p(S)),this.T+w(p(p(S))),this.T+w(p(p(p(S))))]);let M;if(a)for(let S=0;S<b;S++)M=R.bitmap[S],this.tiles.push(l(function(I,P){return[M[(o*P+I)*4],M[(o*P+I)*4+1],M[(o*P+I)*4+2],M[(o*P+I)*4+3]]}));else{M=R.bitmap,this.tiles.push(l(function(S,I){return[M[(o*I+S)*4],M[(o*I+S)*4+1],M[(o*I+S)*4+2],M[(o*I+S)*4+3]]}));for(let S=1;S<b;S++)this.tiles.push(S<4?u(this.tiles[this.T+S-1]):f(this.tiles[this.T+S-4]))}for(let S=0;S<b;S++)d.push(R.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const v=new Array(4);for(let A=0;A<4;A++){this.propagator[A]=new Array(this.T),v[A]=new Array(this.T);for(let R=0;R<this.T;R++){v[A][R]=new Array(this.T);for(let M=0;M<this.T;M++)v[A][R][M]=!1}}for(let A=0;A<t.neighbors.length;A++){const R=t.neighbors[A],M=R.left.split(" ").filter(function(G){return G.length}),S=R.right.split(" ").filter(function(G){return G.length});if(c!==null&&(c.indexOf(M[0])===-1||c.indexOf(S[0])===-1))continue;const I=h[m[M[0]]][M.length==1?0:parseInt(M[1],10)],P=h[I][1],C=h[m[S[0]]][S.length==1?0:parseInt(S[1],10)],D=h[C][1];v[0][C][I]=!0,v[0][h[C][6]][h[I][6]]=!0,v[0][h[I][4]][h[C][4]]=!0,v[0][h[I][2]][h[C][2]]=!0,v[1][D][P]=!0,v[1][h[P][6]][h[D][6]]=!0,v[1][h[D][4]][h[P][4]]=!0,v[1][h[P][2]][h[D][2]]=!0}for(let A=0;A<this.T;A++)for(let R=0;R<this.T;R++)v[2][A][R]=v[0][R][A],v[3][A][R]=v[1][R][A];for(let A=0;A<4;A++)for(let R=0;R<this.T;R++){const M=[],S=v[A][R];for(let I=0;I<this.T;I++)S[I]&&M.push(I);this.propagator[A][R]=M}};qi.prototype=Object.create(o2.prototype),qi.prototype.constructor=qi,qi.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},qi.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},qi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},qi.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let f=0,d=0,h=0,m=0;for(let p=0;p<this.T;p++)if(i[p]){const w=this.tiles[p][l+c*this.tilesize],b=this.weights[p]*a;f+=w[0]*b,d+=w[1]*b,h+=w[2]*b,m+=w[3]*b}e[u]=f,e[u+1]=d,e[u+2]=h,e[u+3]=m}}}};var a2=qi,c2={OverlappingModel:s2,SimpleTiledModel:a2},l2=Ls(c2);const Db=5;function jb(e,t,n,r,i,s,o){if(!E(x.book))return!1;const a=x.book,c=tn(a,yt.BOARD,e),l=tn(a,yt.BOARD,t),u=Ae(c),f=Ae(l);if(!E(u)||!E(f))return!1;Ue(u),Ue(f);let d=0;const h=new Map,m=new Map;let p=0;const w=32,b=new Uint8Array(xh*4);for(let I=0;I<Vt;++I)for(let P=0;P<At;++P){const C=ee(f,{x:P,y:I}),D=(C==null?void 0:C.char)??0,G=(C==null?void 0:C.color)??w,U=(C==null?void 0:C.bg)??w;b[p++]=D,b[p++]=G,b[p++]=U;const T=ui(C),_=Ot((T==null?void 0:T.name)??"empty"),N=h.get(_);Tt(N)?b[p++]=N:(h.set(_,d),m.set(d,_),b[p++]=d++)}const v=s.x-i.x+1,A=s.y-i.y+1,R=new l2.OverlappingModel(b,At,Vt,n,v,A,!1,!1,r,0);let M=0;for(;M<Db&&!R.generate();++M);if(M===Db)return!1;p=0;const S=R.graphics();for(let I=i.y;I<=s.y;++I)for(let P=i.x;P<=s.x;++P){const C={x:P,y:I},D=S[p++],G=S[p++],U=S[p++];switch(d=S[p++],o){case"all":{const V=ee(u,{x:P,y:I});We(V)&&wn(u,V,a.timestamp),Re(u,{x:P,y:I});break}case"object":{const V=ee(u,{x:P,y:I});We(V)&&wn(u,V,a.timestamp);break}case"terrain":Re(u,{x:P,y:I});break}let T=m.get(d)??"";const _=ui({kind:T});switch(o){case"all":break;case"object":We(_)||(T="");break;case"terrain":We(_)&&(T="");break;default:if(Ht(_,"group")!==o&&(T=""),T){const V=ee(u,{x:P,y:I});We(V)&&wn(u,V,a.timestamp),Re(u,{x:P,y:I})}break}const N=T?Rt(u,[T],C):void 0;if(!(!E(N)||!E(_))&&(xo(N,_),D>0&&(N.char=D),G<w&&(N.color=G),U<w&&(N.bg=U),We(N))){const V=qe(Qo(f,T));E(V)&&(Re(u,{...es(f,V.x??0,V.y??0),x:P,y:I}),xo(N,V))}}return!0}function zb(e){return`zss_snapshot_${e}`}const Wb={x:0,y:0},Gb={x:At-1,y:Vt-1},Kb="all";function u2(e){const t=tn(x.book,yt.BOARD,e),n=Ae(t);if(!E(n))return;const r=zb(n.id);hb(x.book,r);const[i]=Qi(Bt.MAIN,r,yt.BOARD),s=Ae(i);if(E(s))return hd(e,s.id,Wb,Gb,Kb),s}function h2(e){const t=tn(x.book,yt.BOARD,e),n=Ae(t);if(!E(n))return;const r=zb(n.id),i=tn(x.book,yt.BOARD,r),s=Ae(i);if(E(s))return hd(s.id,e,Wb,Gb,Kb),s}function f2(e,t,n,r,i,s){switch(s){case"all":case"object":case"terrain":break;default:return d2(e,t,i,s)}if(!E(x.book))return;const o=x.book,a=tn(o,yt.BOARD,e),c=Ae(a);if(!E(c))return;const l=Yl();Ue(c);for(let u=n.y;u<=r.y;++u)for(let f=n.x;f<=r.x;++f){let d=!1,h=!1;switch(s){case"all":d=!0,h=!0;break;case"object":d=!0;break;case"terrain":h=!0;break}const m=(f+t.x+At)%At,p=(u+t.y+Vt)%Vt;if(d){const w=ee(c,{x:f,y:u});We(w)&&E(w==null?void 0:w.x)&&E(w==null?void 0:w.y)&&(w.x=m,w.lx=m,w.y=p,w.ly=p)}h&&(l.terrain[m+p*At]=c.terrain[f+u*At])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),sa(c)}function d2(e,t,n,r){if(!E(x.book))return;const i=x.book,s=tn(i,yt.BOARD,e),o=Ae(s);if(!E(o))return;Ue(o);const{terrainelements:a,objectelements:c}=tg(o,n,r);if(a.length===0&&c.length===0)return;const l=c.map(p=>p.id??""),u=a.map(p=>Vr({x:p.x??0,y:p.y??0},At)),f=[],d=[];for(let p=0;p<a.length;++p){const w=a[p],b={x:w.x??-1,y:w.y??-1},v=ee(o,b);E(v)&&We(v)&&(f.push(v.id??""),f.push(v.id??""),d.push(Vr({x:v.x??0,y:v.y??0},At)))}let h=!1;for(let p=0;p<a.length;++p){const w=a[p],b=Ht(w,"collision"),v={x:w.x??-1,y:w.y??-1},A=Vr(v,At),R={x:v.x+t.x,y:v.y+t.y};if(Vl(R)){const M=ee(o,R),S=(M==null?void 0:M.id)??"",I=Vr({x:(M==null?void 0:M.x)??0,y:(M==null?void 0:M.y)??0},At),P=Ht(M,"collision");if(E(M)&&We(M)&&f.includes(S)!==!0&&l.includes(S)!==!0){let C=!1;const D=d.includes(A),G=D?ee(o,v):void 0,U=D?Ht(G,"pushable"):!1,T=D&&U;if(Ht(M,"pushable")&&(b!==jt.ISWALK||D)){let _=D;E(G)&&U&&(h=ts(i,o,G,{x:(G.x??0)-t.x,y:(G.y??0)-t.y})!==!0,h||(_=!1)),(_||b!==jt.ISWALK)&&(h=ts(i,o,M,{x:(M.x??0)+t.x,y:(M.y??0)+t.y})!==!0,h&&(C=T))}else(b!==jt.ISWALK||T)&&(h=!0,C=T);C&&E(G)&&(h=ts(i,o,G,{x:(G.x??0)-t.x,y:(G.y??0)-t.y})!==!0)}else P===jt.ISSOLID&&u.includes(I)===!1&&(h=!0)}else h=!0}if(h)return;for(let p=0;p<c.length;++p){const w=c[p],b=Ht(w,"collision"),v={x:w.x??0,y:w.y??0},A={x:v.x+t.x,y:v.y+t.y};if(Vl(A)){const R=ee(o,A),M=(R==null?void 0:R.id)??"",S=Ht(R,"collision"),I=Ht(R,"group");E(R)&&We(R)&&f.includes(M)&&l.includes(M)!==!0?Ht(R,"pushable")?h=ts(i,o,R,A)!==!0:h=!0:Jo(b,S)&&r!==I&&(h=!0)}else h=!0}if(h)return;(t.x>0||t.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const w=a[p],b={x:w.x??-1,y:w.y??-1},v={x:b.x+t.x,y:b.y+t.y},A=es(o,v.x,v.y);if(E(w)&&E(A)){Re(o,{...w,x:v.x,y:v.y}),Re(o,{...A,x:b.x,y:b.y});const R=ee(o,b);We(R)&&E(R)&&(R.x=(R.x??0)+t.x,R.y=(R.y??0)+t.y,R.lx=(R.lx??0)+t.x,R.ly=(R.ly??0)+t.y)}}sa(o);for(let p=0;p<c.length;++p){const w=c[p],b={x:w.x??-1,y:w.y??-1},v={x:b.x+t.x,y:b.y+t.y};if(!ts(i,o,w,v))break}sa(o)}function Ml(e,t){let n="all";const r={x:0,y:0},i={x:At-1,y:Vt-1};for(let s=t;s<e.length;){const[o,a]=rt(e,s,[K.MAYBE_NUMBER_OR_STRING]);if(_t(o))n=Ot(o),s=a;else if(Tt(o)){const[c,l,u,f]=rt(e,a,[K.NUMBER,K.MAYBE_NUMBER,K.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const p2=Ei().command("snapshot",()=>(!E(x.book)||!E(x.board)||u2(x.board.id),0)).command("revert",()=>(!E(x.book)||!E(x.board)||h2(x.board.id),0)).command("copy",(e,t)=>{if(!E(x.book)||!E(x.board))return 0;const[n,r]=rt(t,0,[K.STRING]),i=bookreadcodepagesbytypeandstat(x.book,yt.BOARD,n),s=qe(...i);if(E(s)){const o=Ml(t,r);hd(s.id,x.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!E(x.book)||!E(x.board))return 0;const[n,r,i,s]=rt(t,0,[K.STRING,K.NUMBER,K.NUMBER]),o=bookreadcodepagesbytypeandstat(x.book,yt.BOARD,n),a=qe(...o);if(E(a)){const c=Ml(t,s);jb(x.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!E(x.book)||!E(x.board))return 0;const[n,r]=rt(t,0,[K.DIR]),i={x:n.destpt.x-(((o=x.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=x.element)==null?void 0:a.y)??0)},s=Ml(t,r);return f2(x.board.id,i,s.pt1,s.pt2,x.elementid,s.targetset),0}).command("pivot",(e,t)=>{if(!E(x.book)||!E(x.board))return 0;const[n,r]=rt(t,0,[K.NUMBER]),i=Ml(t,r);return e2(x.board.id,im(n),i.pt1,i.pt2,i.targetset),0});var Ji=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Ji||{});const m2={audio:Uh,board:k6,cli:kU,display:vU,element:CU,runtime:ZU,loader:qU,network:JU,transform:p2},fd=["audio","board","display","network","transform","element"],g2={0:[],1:["cli",...fd],2:["loader",...fd],3:["runtime",...fd]},_2={0:new Map,1:new Map,2:new Map,3:new Map};function ko(e){return(g2[e]??[]).map(n=>m2[n]).filter(E)}function dd(e){const t=[],n=ko(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function y2(e,t){const n=_2[e];if(!n.has(t)){let r;const i=ko(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!E(r));++s);n.set(t,r)}return n.get(t)}function b2(e,t,n){const r=ko(e);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(t,n);if(o)return[o,a]}}return[!1,void 0]}function w2(e,t,n,r){const i=ko(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,n,r);if(a)return[a,r]}}return[!1,void 0]}function E2(e,t){const n=ko(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function Hb(e,t){const n=ko(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var Yb={},Vb={},Xb={};const qb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Xb.encode=function(e){if(0<=e&&e<qb.length)return qb[e];throw new TypeError("Must be between 0 and 63: "+e)};const x2=Xb,Jb=5,Zb=1<<Jb,k2=Zb-1,v2=Zb;function T2(e){return e<0?(-e<<1)+1:(e<<1)+0}Vb.encode=function(t){let n="",r,i=T2(t);do r=i&k2,i>>>=Jb,i>0&&(r|=v2),n+=x2.encode(r);while(i>0);return n};var Ma={};(function(e){function t(S,I,P){if(I in S)return S[I];if(arguments.length===3)return P;throw new Error('"'+I+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(S){const I=S.match(n);return I?{scheme:I[1],auth:I[2],host:I[3],port:I[4],path:I[5]}:null}e.urlParse=i;function s(S){let I="";return S.scheme&&(I+=S.scheme+":"),I+="//",S.auth&&(I+=S.auth+"@"),S.host&&(I+=S.host),S.port&&(I+=":"+S.port),S.path&&(I+=S.path),I}e.urlGenerate=s;const o=32;function a(S){const I=[];return function(P){for(let D=0;D<I.length;D++)if(I[D].input===P){const G=I[0];return I[0]=I[D],I[D]=G,I[0].result}const C=S(P);return I.unshift({input:P,result:C}),I.length>o&&I.pop(),C}}const c=a(function(I){let P=I;const C=i(I);if(C){if(!C.path)return I;P=C.path}const D=e.isAbsolute(P),G=[];let U=0,T=0;for(;;)if(U=T,T=P.indexOf("/",U),T===-1){G.push(P.slice(U));break}else for(G.push(P.slice(U,T));T<P.length&&P[T]==="/";)T++;let _=0;for(T=G.length-1;T>=0;T--){const N=G[T];N==="."?G.splice(T,1):N===".."?_++:_>0&&(N===""?(G.splice(T+1,_),_=0):(G.splice(T,2),_--))}return P=G.join("/"),P===""&&(P=D?"/":"."),C?(C.path=P,s(C)):P});e.normalize=c;function l(S,I){S===""&&(S="."),I===""&&(I=".");const P=i(I),C=i(S);if(C&&(S=C.path||"/"),P&&!P.scheme)return C&&(P.scheme=C.scheme),s(P);if(P||I.match(r))return I;if(C&&!C.host&&!C.path)return C.host=I,s(C);const D=I.charAt(0)==="/"?I:c(S.replace(/\/+$/,"")+"/"+I);return C?(C.path=D,s(C)):D}e.join=l,e.isAbsolute=function(S){return S.charAt(0)==="/"||n.test(S)};function u(S,I){S===""&&(S="."),S=S.replace(/\/$/,"");let P=0;for(;I.indexOf(S+"/")!==0;){const C=S.lastIndexOf("/");if(C<0||(S=S.slice(0,C),S.match(/^([^\/]+:\/)?\/*$/)))return I;++P}return Array(P+1).join("../")+I.substr(S.length+1)}e.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(S){return S}function h(S){return p(S)?"$"+S:S}e.toSetString=f?d:h;function m(S){return p(S)?S.slice(1):S}e.fromSetString=f?d:m;function p(S){if(!S)return!1;const I=S.length;if(I<9||S.charCodeAt(I-1)!==95||S.charCodeAt(I-2)!==95||S.charCodeAt(I-3)!==111||S.charCodeAt(I-4)!==116||S.charCodeAt(I-5)!==111||S.charCodeAt(I-6)!==114||S.charCodeAt(I-7)!==112||S.charCodeAt(I-8)!==95||S.charCodeAt(I-9)!==95)return!1;for(let P=I-10;P>=0;P--)if(S.charCodeAt(P)!==36)return!1;return!0}function w(S,I,P){let C=v(S.source,I.source);return C!==0||(C=S.originalLine-I.originalLine,C!==0)||(C=S.originalColumn-I.originalColumn,C!==0||P)||(C=S.generatedColumn-I.generatedColumn,C!==0)||(C=S.generatedLine-I.generatedLine,C!==0)?C:v(S.name,I.name)}e.compareByOriginalPositions=w;function b(S,I,P){let C=S.generatedLine-I.generatedLine;return C!==0||(C=S.generatedColumn-I.generatedColumn,C!==0||P)||(C=v(S.source,I.source),C!==0)||(C=S.originalLine-I.originalLine,C!==0)||(C=S.originalColumn-I.originalColumn,C!==0)?C:v(S.name,I.name)}e.compareByGeneratedPositionsDeflated=b;function v(S,I){return S===I?0:S===null?1:I===null?-1:S>I?1:-1}function A(S,I){let P=S.generatedLine-I.generatedLine;return P!==0||(P=S.generatedColumn-I.generatedColumn,P!==0)||(P=v(S.source,I.source),P!==0)||(P=S.originalLine-I.originalLine,P!==0)||(P=S.originalColumn-I.originalColumn,P!==0)?P:v(S.name,I.name)}e.compareByGeneratedPositionsInflated=A;function R(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=R;function M(S,I,P){if(I=I||"",S&&(S[S.length-1]!=="/"&&I[0]!=="/"&&(S+="/"),I=S+I),P){const C=i(P);if(!C)throw new Error("sourceMapURL could not be parsed");if(C.path){const D=C.path.lastIndexOf("/");D>=0&&(C.path=C.path.substring(0,D+1))}I=l(s(C),I)}return c(I)}e.computeSourceURL=M})(Ma);var pd={};let A2=class z1{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new z1;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};pd.ArraySet=A2;var Qb={};const t1=Ma;function R2(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||t1.compareByGeneratedPositionsInflated(e,t)<=0}let S2=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){R2(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(t1.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};Qb.MappingList=S2;const Ua=Vb,He=Ma,Ul=pd.ArraySet,O2=Qb.MappingList;let e1=class W1{constructor(t){t||(t={}),this._file=He.getArg(t,"file",null),this._sourceRoot=He.getArg(t,"sourceRoot",null),this._skipValidation=He.getArg(t,"skipValidation",!1),this._sources=new Ul,this._names=new Ul,this._mappings=new O2,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new W1({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=He.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=He.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=He.getArg(t,"generated"),r=He.getArg(t,"original",null);let i=He.getArg(t,"source",null),s=He.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=He.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[He.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[He.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=He.relative(s,i));const o=this._mappings.toArray().length>0?new Ul:this._sources,a=new Ul;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=He.join(r,c.source)),s!=null&&(c.source=He.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=He.join(r,c)),s!=null&&(c=He.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,m=d.length;h<m;h++){if(l=d[h],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!He.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Ua.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Ua.encode(f-o),o=f,c+=Ua.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Ua.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Ua.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=He.relative(n,r));const i=He.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};e1.prototype._version=3,Yb.SourceMapGenerator=e1;var n1={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(n1);var Fa={exports:{}},I2={},N2=Object.freeze({__proto__:null,default:I2}),r1=G1(N2);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;Fa.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Fa.exports.initialize=t=>e=t}else{const e=r1,t=r1;Fa.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Fa.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var i1=Fa.exports;const C2=i1;function L2(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Pa=null;var M2=function(){if(Pa)return Pa;const t=[];return Pa=C2().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new L2;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),t[t.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw Pa=null,n}),Pa};const St=Ma,md=n1,Fl=pd.ArraySet,U2=i1,F2=M2,gd=Symbol("smcInternal");class Ge{constructor(t,n){return t==gd?Promise.resolve(this):B2(t,n)}static initialize(t){U2.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return $2(t,n)}static async with(t,n,r){const i=await new Ge(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Ge.prototype._version=3,Ge.GENERATED_ORDER=1,Ge.ORIGINAL_ORDER=2,Ge.GREATEST_LOWER_BOUND=1,Ge.LEAST_UPPER_BOUND=2;class Ba extends Ge{constructor(t,n){return super(gd).then(r=>{let i=t;typeof t=="string"&&(i=St.parseSourceMapInput(t));const s=St.getArg(i,"version");let o=St.getArg(i,"sources");const a=St.getArg(i,"names",[]);let c=St.getArg(i,"sourceRoot",null);const l=St.getArg(i,"sourcesContent",null),u=St.getArg(i,"mappings"),f=St.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=St.normalize(c)),o=o.map(String).map(St.normalize).map(function(d){return c&&St.isAbsolute(c)&&St.isAbsolute(d)?St.relative(c,d):d}),r._names=Fl.fromArray(a.map(String),!0),r._sources=Fl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return St.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,F2().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=St.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Ba(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Ge.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=St.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Ge.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Ge.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=St.getArg(t,"source");const r=St.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:St.getArg(t,"line"),generatedColumn:St.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=St.getArg(t,"bias",Ge.GREATEST_LOWER_BOUND);r==null&&(r=Ge.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=St.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=St.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=St.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:St.getArg(i,"originalLine",null),column:St.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=St.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=St.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=St.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:St.getArg(t,"line"),originalColumn:St.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=St.getArg(t,"bias",Ge.GREATEST_LOWER_BOUND);i==null&&(i=Ge.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:St.getArg(s,"generatedLine",null),column:St.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Ba.prototype.consumer=Ge;class P2 extends Ge{constructor(t,n){return super(gd).then(r=>{let i=t;typeof t=="string"&&(i=St.parseSourceMapInput(t));const s=St.getArg(i,"version"),o=St.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Fl,r._names=new Fl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=St.getArg(c,"offset"),u=St.getArg(l,"line"),f=St.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new Ge(St.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(St.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(St.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:St.getArg(t,"line"),generatedColumn:St.getArg(t,"column")},r=md.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(St.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=St.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||Ge.GENERATED_ORDER;let o;switch(s){case Ge.GENERATED_ORDER:o=this._generatedMappings;break;case Ge.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=St.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return md.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=St.getArg(t,"line"),r={source:St.getArg(t,"source"),originalLine:n,originalColumn:St.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",St.compareByOriginalPositions,md.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:St.getArg(o,"generatedLine",null),column:St.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:St.getArg(o,"generatedLine",null),column:St.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function B2(e,t){let n=e;typeof e=="string"&&(n=St.parseSourceMapInput(e));const r=n.sections!=null?new P2(n,t):new Ba(n,t);return Promise.resolve(r)}function $2(e,t){return Ba.fromSourceMap(e,t)}var s1={};const D2=Yb.SourceMapGenerator,Pl=Ma,j2=/(\r?\n)/,z2=10,vo="$$$isSourceNode$$$";let W2=class Md{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[vo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new Md,s=t.split(j2);let o=0;const a=function(){const h=p(),m=p()||"";return h+m;function p(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const m=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,m),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const m=n.sourceContentFor(h);m!=null&&(r!=null&&(h=Pl.join(r,h)),i.setSourceContent(h,m))}),i;function d(h,m){if(h===null||h.source===void 0)i.add(m);else{const p=r?Pl.join(r,h.source):h.source;i.add(new Md(h.originalLine,h.originalColumn,p,m,h.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[vo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[vo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[vo]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[vo]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Pl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][vo]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Pl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new D2(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===z2?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};s1.SourceNode=W2;var G2=s1.SourceNode;let o1=0;const a1=Zr,K2=["Command","lines"];class H2 extends DL{constructor(){super(nb,{traceInitPerf:Zr,skipValidations:!Zr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Mt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Mt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Sa)}])}));Mt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Mt(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Mt(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Mt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Uf)}));Mt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Mf)}));Mt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Ry)}])}));Mt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Sy)}));Mt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Oy),this.SUBRULE(this.words),this.CONSUME(Iy)}));Mt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(po),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Mt(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Mt(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Mt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Mt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(jf),this.SUBRULE(this.words)}));Mt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(Wy),this.SUBRULE(this.words)}));Mt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(zf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Mt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Tl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Sa)),this.CONSUME4(po),this.CONSUME4(Wf)}}])}));Mt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Tl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(po),this.CONSUME(Wf)}}])}));Mt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Tl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Mt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(po),this.CONSUME(Gf),this.CONSUME(zf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Mt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(po),this.CONSUME(Gf),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Mt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(Xy),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Mt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(qy),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Mt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(Jy),this.SUBRULE(this.words)}));Mt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(Zy),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Mt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(Qy)}));Mt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(tb)}));Mt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(Hy)}));Mt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Yy)}));Mt(this,"command_ticker",this.RULED("command_ticker",()=>{this.CONSUME(Vy)}));Mt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Ff),this.SUBRULE2(this.and_test)})}));Mt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Bf),this.SUBRULE2(this.not_test)})}));Mt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Pf),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Mt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Mt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Ly)},{ALT:()=>this.CONSUME(My)},{ALT:()=>this.CONSUME(Uy)},{ALT:()=>this.CONSUME(Fy)},{ALT:()=>this.CONSUME(Py)},{ALT:()=>this.CONSUME(By)}])}));Mt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Ff),this.SUBRULE2(this.and_test_value)})}));Mt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Bf),this.SUBRULE2(this.not_test_value)})}));Mt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Pf),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Mt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Mt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME($f)},{ALT:()=>this.CONSUME(Df)}]),this.SUBRULE(this.term)}));Mt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Mt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Dy)},{ALT:()=>this.CONSUME(jf)},{ALT:()=>this.CONSUME(jy)},{ALT:()=>this.CONSUME(zy)}]),this.SUBRULE(this.factor)}));Mt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME($f)},{ALT:()=>this.CONSUME(Df)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Mt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME($y),this.SUBRULE(this.factor)})}));Mt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Mt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Uf)},{ALT:()=>this.CONSUME(Ny)},{ALT:()=>this.CONSUME(cn)},{ALT:()=>this.CONSUME(Cy)},{ALT:()=>{this.CONSUME(Gy),this.SUBRULE(this.words),this.CONSUME(Ky)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=K2.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(o1++).toString().padStart(3),c=s?"font-weight: bold;":"";if(a1&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),a1&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),o1--},i)}}const To=new H2;if(ET){const e=To.getGAstProductions(),t=ZL(e);console.info(t)}const Y2=To.getBaseCstVisitorConstructor();var wt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(wt||{}),Is=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Is||{}),ci=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(ci||{}),Bl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Bl||{});function Gn(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class V2 extends Y2{constructor(){super();Mt(this,"unique",0);Zr&&this.validateVisitor()}visit(n){if(le(n)&&(n=n[0]),!!E(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():E(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:Gn(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:Gn(n.token_stat,"@").slice(1)}))}stmt_text(n,r){return this.createlinenode(r,this.createcodenode(r,{type:6,value:Gn(n.token_text,"")}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:Gn(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:Gn(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n,r){return n.words?this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.command_ticker?this.go(n.command_ticker):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n,r){const[i]=this.createlogicnode(r,Gn(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=$e(),s=$e();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=$e(),s=$e();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,Gn(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){return this.createcodenode(r,{type:17,lines:this.go(n.command_fork)})}command_while(n,r){const i=$e(),s=$e();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=$e(),s=$e(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=$e(),s=$e(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=$e();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=Gn(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}))}command_toast(n,r){const s=Gn(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,"toast"),this.createstringnode(r,s)].flat()}))}command_ticker(n,r){const s=Gn(n.token_command_ticker,"").replace("ticker","").trim();return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,"ticker"),this.createstringnode(r,s)].flat()}))}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}token(n,r){if(n.token_label){const i=Gn(n.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_stringliteraldouble){const i=Gn(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Gn(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Gn(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return n.token_lparen?this.createcodenode(r,{type:31,words:this.go(n.words)}):[]}}const X2=new V2,Kn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},$l="zss.js";function te(e,t){return new G2(e.startLine??1,e.startColumn??1,$l,t)}function _d(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function yd(e){return`'${_d(e)}'`}function Dl(e){if(e.startsWith('"'))return Dl(e.replaceAll(/(^"|"$)/g,""));const t=id(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===nd?`', api.get('${_d(r.image.substring(1))}'), '`:_d(r.image)).join("")}'].join('')`}function Ao(e){return e.filter(t=>t!==void 0).map(se)}function c1(e){return te(e,"")}function q2(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function nn(e,t,n){return te(e,[`api.${t}(`,...q2(n,", "),")"])}function J2(e){if(e.type===wt.COMPARE&&e.compare.type===wt.COMPARE_ITEM)switch(e.compare.method){case Is.IS_EQ:return nn(e,"isEq",[se(e.lhs),se(e.rhs)]);case Is.IS_NOT_EQ:return nn(e,"isNotEq",[se(e.lhs),se(e.rhs)]);case Is.IS_LESS_THAN:return nn(e,"isLessThan",[se(e.lhs),se(e.rhs)]);case Is.IS_GREATER_THAN:return nn(e,"isGreaterThan",[se(e.lhs),se(e.rhs)]);case Is.IS_LESS_THAN_OR_EQ:return nn(e,"isLessThanOrEq",[se(e.lhs),se(e.rhs)]);case Is.IS_GREATER_THAN_OR_EQ:return nn(e,"isGreaterThanOrEq",[se(e.lhs),se(e.rhs)])}return te(e,"")}function Ns(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",se(n),")"])}function l1(e,t,n){return e.prepend(`api.${t}(`),e.add([se(n),")"])}function Z2(e,t){if(e.type===wt.OPERATOR_ITEM)switch(e.operator){case ci.PLUS:return Ns(t,"opPlus",e.rhs);case ci.MINUS:return Ns(t,"opMinus",e.rhs);case ci.POWER:return Ns(t,"opPower",e.rhs);case ci.MULTIPLY:return Ns(t,"opMultiply",e.rhs);case ci.DIVIDE:return Ns(t,"opDivide",e.rhs);case ci.MOD_DIVIDE:return Ns(t,"opModDivide",e.rhs);case ci.FLOOR_DIVIDE:return Ns(t,"opFloorDivide",e.rhs);case ci.UNI_PLUS:return l1(t,"opUniPlus",e.rhs);case ci.UNI_MINUS:return l1(t,"opUniMinus",e.rhs)}return te(e,"")}function Q2(e){if(e.type===wt.OPERATOR){const t=e.lhs?se(e.lhs):te(e,"");return e.items.forEach(n=>Z2(n,t)),t}return te(e,"")}function jl(e,t){return te(e,[nn(e,"jump",[`${t}`]),"; continue;"])}function Ni(e){return Kn.linelookup[e??""]??-1}function bd(e,t){Kn.linelookup[e]=t}function Ro(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.ELSE_IF:i.type===t&&(i.done=n);break;case wt.IF_BLOCK:case wt.IF_CHECK:i.type===t&&(i.skip=n);break;case wt.LINE:Ro(i.stmts,t,n);break}}}function u1(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.ELSE_IF:i.type===t&&bd(i.done,n);break;case wt.IF_BLOCK:case wt.IF_CHECK:i.type===t&&bd(i.skip,n);break;case wt.LINE:u1(i.stmts,t,n);break}}}function se(e){var t;switch(e.type){case wt.PROGRAM:return te(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(se).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${$l}`]);case wt.API:return te(e,["  ",nn(e,e.method,Ao(e.words)),`;
`]);case wt.LINE:return te(e,[`case ${e.lineindex}:
`,...e.stmts.map(se).flat(),`  break;
`]);case wt.MARK:return te(e,`  // ${e.comment}
`);case wt.GOTO:{const n=Ni(e.id);return te(e,["  ",jl(e,n),`
`])}case wt.COUNT:return te(e,`${e.index}`);case wt.LITERAL:switch(e.literal){case Bl.NUMBER:return te(e,`${e.value}`);case Bl.STRING:return te(e,yd(e.value));case Bl.TEMPLATE:return te(e,Dl(e.value))}return c1(e);case wt.TEXT:return te(e,["  ",nn(e,"text",[Dl(e.value)]),`;
`]);case wt.STAT:if(Kn.isfirststat){Kn.isfirststat=!1;const n=e.value.trim().split(" ").map(yd);return te(e,["  ",nn(e,"stat",n),`;
`])}return te(e,`  // skipped ${e.value}
`);case wt.LABEL:{const n=Ot(e.name),r=e.active?"label":"comment";Kn.labels[n]||(Kn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Kn.labels[n].push(i),te(e,`  // ${i} '${n}' ${r}
`)}case wt.HYPERLINK:return te(e,["  ",nn(e,"hyperlink",[Dl(e.text),...Ao(e.link)]),`;
`]);case wt.MOVE:{const n=nn(e,"command",[yd("go"),Ao(e.words)].flat());return e.wait?te(e,["  if (",n,`) { continue; };
`]):te(e,["  ",n,`;
`])}case wt.COMMAND:return te(e,["  if (",nn(e,"command",Ao(e.words)),`) { continue; };
`]);case wt.IF:{const n=((t=e.block)==null?void 0:t.type)===wt.IF_BLOCK?e.block:void 0;if(E(n)){Ro([e.check],wt.IF_CHECK,n.skip);const r=te(e,se(e.check));return n.lines.forEach(i=>r.add(se(i))),u1(n.altlines,wt.ELSE_IF,Ni(n.done)),n.altlines.forEach(i=>r.add(se(i))),r}return te(e,se(e.check))}case wt.IF_CHECK:{const n=Ni(e.skip);return n===-1?te(e,["  ",nn(e,e.method,Ao(e.words)),`;
`]):te(e,["  if (!",nn(e,e.method,Ao(e.words)),") { ",jl(e,n),` }
`])}case wt.ELSE_IF:case wt.ELSE:{const n=te(e,"");return e.lines.forEach(r=>n.add(se(r))),n}case wt.WHILE:{const n=Ni(e.loop),r=Ni(e.done),i=te(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case wt.REPEAT:{const n=Ni(e.loop),r=Ni(e.done),i=te(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case wt.WAITFOR:{const n=te(e,"");return Ro(e.lines,wt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(se(r))}),n}case wt.FOREACH:{const n=Ni(e.loop),r=Ni(e.done),i=te(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case wt.BREAK:return te(e,["  ",jl(e,e.goto),`
`]);case wt.CONTINUE:return te(e,["  ",jl(e,e.goto),`
`]);case wt.OR:return nn(e,"or",e.items.map(se));case wt.AND:return nn(e,"and",e.items.map(se));case wt.NOT:return nn(e,"not",e.items.map(se));case wt.COMPARE:return J2(e);case wt.OPERATOR:return Q2(e);case wt.EXPR:return nn(e,"expr",e.words.map(se));default:return console.error("<unsupported node>",e.type,e),c1(e)}}function li(e){if(E(e))switch(e.type===wt.LINE&&++Kn.lineindex,e.lineindex=Kn.lineindex,e.type){case wt.PROGRAM:e.lines.forEach(li);break;case wt.LINE:e.stmts.forEach(li);break;case wt.MARK:bd(e.id,e.lineindex);break;case wt.IF:li(e.check),li(e.block);break;case wt.IF_BLOCK:e.lines.forEach(li),e.altlines.forEach(li);break;case wt.ELSE_IF:e.lines.forEach(li);break;case wt.ELSE:case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.WAITFOR:e.lines.forEach(li);break;case wt.MOVE:case wt.COMMAND:case wt.IF_CHECK:e.words.forEach(li);break}}function tF(e){Kn.labels={},Kn.internal=1,Kn.lineindex=0,Kn.isfirststat=!0,li(e)}function eF(e){return tF(e),{...se(e).toStringWithSourceMap({file:`${$l}.map`}),...Kn}}function h1(e){return le(e)?e.length>0?1:0:e??0}function nF(e){return`${e}_chip`}function f1(e=""){return`vm:${e??""}`}function rF(e,t,n){var l,u;const r=nF(e),i=yr(r);let s;const o=wr(Object.entries(n.labels??{}));(!le(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){x.words=d;const h=y2(t,f);return E(h)?h(c,d):f!=="send"?a("shortsend",[f,...d]):0}const c={halt(){yF(r)},id(){return e},set(f,d){const[h,m]=w2(t,c,f,d);if(h)return m},get(f){const[d,h]=b2(t,c,f);if(d)return h},tick(f){const d=Tt(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return Hb(t,c),!1;i.lc=0,i.ys=0,x.get=c.get,E2(t,c);try{const m=s==null?void 0:s.next();m!=null&&m.done&&(i.es=1)}catch(m){fe(et,x.elementfocus,"crash",m.message),i.es=1}return Hb(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Tt(i.lc)?++i.lc>wi.HALT_AT_COUNT:!0},hm(){if(le(i.mg)&&le(i.lb)){const[f]=i.mg;if(E(f))for(let d=0;d<i.lb.length;++d){const[h,m]=i.lb[d];if(h===f)return m.find(p=>Tt(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,m){et.emit(f,`${f1(d)}:${h}`,m)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(le(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f){const m=h[1].findIndex(p=>p>0);if(m>=0&&E(h[1])){h[1][m]*=-1;break}}}},restore(f){if(le(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f)for(let m=0;m<h[1].length;m++)h[1][m]=Math.abs(h[1][m])}},getcase(){i.ec=Tt(i.ec)?i.ec:1;const f=c.hm();if(f&&le(i.mg)){const[,d,h,m]=i.mg;c.set("sender",h),E(d)&&c.set("arg",d),m&&(c.set("player",m),x.elementfocus=m),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=Tt(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=lT.parse(f),[h]=d.filter(m=>m.fileName===$l);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(Ot(Te(d)),h)},if(...f){const[d,h]=rt(f,0,[K.ANY]),m=h1(d);return m&&h<f.length&&c.command(...f.slice(h)),m?1:0},try(...f){const[,d]=rt(f,0,[K.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,m]=rt(f,0,[K.NAME,K.ANY]),p=Tt(h),w=p?m:1,b=c.get(d),v=p?h:1;if(!Tt(b))return w<f.length&&c.command(...f.slice(w)),1;const A=b-v;return A<0?(w<f.length&&c.command(...f.slice(w)),1):(c.set(d,A),0)},give(...f){const[d,h,m]=rt(f,0,[K.NAME,K.ANY]),p=Tt(h),w=p?m:1,b=c.get(d),v=p?h:1,A=b===void 0?1:0;return A&&w<f.length&&c.command(...f.slice(w)),c.set(d,aa(b,0)+v),A},repeatstart(f,...d){const[h,m]=rt(d,0,[K.NUMBER]),p=`repeatcount${f}`,w=`repeatwords${f}`;i[p]=h,i[w]=m<d.length?d.slice(m):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!Tt(i[d]))return 0;const m=i[d];i[d]=m-1;const p=m>0,w=i[h];return p&&le(w)&&c.command(...w),p?1:0},foreachstart(f,...d){const[h,m,p,w]=rt(d,0,[K.NAME,K.NUMBER,K.NUMBER,K.MAYBE_NUMBER]);let b=Math.min(m,p),v=Math.max(m,p);const A=(w??0)||1;if(A<0){const R=b;b=v,v=R}return c.set(h,b-A),0},foreach(f,...d){const[h,m,p,w,b]=rt(d,0,[K.NAME,K.NUMBER,K.NUMBER,K.MAYBE_NUMBER]);let v=Math.min(m,p),A=Math.max(m,p);const R=(w??0)||1;if(R<0){const I=v;v=A,A=I}let M=c.get(h);!Tt(M)||M<v||M>A?M=v:M+=R;const S=M<=A?1:0;return S&&(c.set(h,M),b<d.length&&c.command(...d.slice(b))),S},waitfor(...f){const[d]=rt(f,0,[K.ANY]),h=h1(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=rt(f,h,[K.ANY]);if(d=m,d)break;h=p}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=rt(f,h,[K.ANY]);if(d=m,!d)break;h=p}return d},not(...f){const[d]=rt(f,0,[K.ANY]);return d?0:1},expr(...f){const[d]=rt(f,0,[K.ANY]);return d},isEq(f,d){const[h]=rt([f],0,[K.ANY]),[m]=rt([d],0,[K.ANY]);return typeof h=="object"||typeof m=="object"?kw(h,m)?1:0:h===m?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h<m?1:0},isGreaterThan(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h>m?1:0},isLessThanOrEq(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h<=m?1:0},isGreaterThanOrEq(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h>=m?1:0},opPlus(f,d){const[h]=rt([f],0,[K.ANY]),[m]=rt([d],0,[K.ANY]);return h+m},opMinus(f,d){const[h]=rt([f],0,[K.ANY]),[m]=rt([d],0,[K.ANY]);return h-m},opPower(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return Math.pow(h,m)},opMultiply(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h*m},opDivide(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h/m},opModDivide(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h%m},opFloorDivide(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return Math.floor(h/m)},opUniPlus(f){const[d]=rt([f],0,[K.NUMBER]);return+d},opUniMinus(f){const[d]=rt([f],0,[K.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function wd(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];le(r)?r.forEach(i=>{t.push(wd(i))}):t.push(wd(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function iF(e){const t=rb(`${e}
`);if(t.errors.length>0)return t;To.input=t.tokens;const n=To.program();if(To.errors.length>0)return{tokens:t.tokens,errors:To.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=X2.go(n);return r?(wd(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Ed=Object.getPrototypeOf(function*(){}).constructor;function sF(e,t){const n=`compile-${e}`;console.time(n);const r=iF(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=eF(r.ast);if(i.code){xT&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Ed("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Ed("api"," ")}}}return{...r,...i,source:"",code:new Ed("api"," ")}}function oF(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=sF(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return E(s)?s.isended():!0},halt(i){const s=t[i];return E(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];E(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!E(t[i])){const f=n(a,c);if(l=t[i]=rF(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,m=c.replaceAll(`\r
`,"").split(`
`).map((b,v)=>[b,v]);m.slice(h-5,h).forEach(([b,v])=>{fe(et,ir(),"build",`$grey${v+1} $grey${b}`)});const[p,w]=m[h]??[];if(_t(p)&&E(w)){const b=(d.column??1)-1,v=b+d.length,A=b<p.length?p:`${p}*`,R=A.substring(0,b),M=A.substring(b,v),S=A.substring(v);fe(et,ir(),"build",`$red${w+1} $grey${R}$red${M}$grey${S}`)}return d.message.split(`
`).forEach(b=>{fe(et,ir(),"build",b)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Xn(i.target),a=t[s];if(E(a)){const c={...i,target:o};a.message(c)}}};return r}const bn=new Vo,An={},zl={};function d1(e,t,n,r,i,s=0){const o=`tiles:${e}:${t}`;return E(An[o])||(An[o]=fT(e,t,n,r,i,s)),An[o]}function aF(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return E(zl[s])||(zl[s]=dT(e,t,n)),zl[s].id=i,zl[s]}function cF(e,t){const n=`sprites:${e}:${t}`;return E(An[n])||(An[n]=pT(e,t)),An[n]}function lF(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return E(An[s])||(An[s]=mT(e,t,n,r,i)),An[s]}function Wl(e,t,n,r){const i=`media:${e}:${t}`;E(An[i])||(An[i]=gT(e,t,n,r));const s=An[i];return s.mime=n,s.media=r,s}function uF(e,t){const n=`control:${e}:${t}`;return E(An[n])||(An[n]=_T(e,t)),An[n]}const Zi=3;function p1(e,t){const n=[],r=(e.x+.5)*zi,i=(e.y+.5)*Wi,s=t.x*zi,o=t.y*Wi,a=s-r,c=o-i;bn.x=a-Zi,bn.y=c-Zi,n.push(bn.angle()),bn.x=a+zi+Zi,bn.y=c-Zi,n.push(bn.angle()),bn.x=a-Zi,bn.y=c+Wi+Zi,n.push(bn.angle()),bn.x=a+zi+Zi,bn.y=c+Wi+Zi,n.push(bn.angle());const l=n.map(h=>Math.round(sm(h))),u=Math.min(...l),f=Math.max(...l);if(f-u>180){const h=l.filter(b=>b<180),m=l.filter(b=>b>180),p=Math.max(...h);return[Math.min(...m),p]}return[u,f]}function Gl(e,t,n,r,i,s,o,a,c){var A;const l={x:a,y:c},u=Br(e,l);if(u===-1)return;bn.x=a-i.x,bn.y=c-i.y;const f=bn.length();if(f>s)return;const d=Math.round(sm(bn.angle()));let h=0;for(let R=0;R<n.length;++R){const[M,S,I]=n[R];M>S?(d>=M||d<=S)&&(h=Math.max(h,I)):d>=M&&d<=S&&(h=Math.max(h,I))}const m=s*.5;t[u]=Math.min(t[u],h+(f<m?0:(f-m)*o)),t[u]=fn(t[u],0,1);const p=Sn(e,((A=e.lookup)==null?void 0:A[u])??"");if(E(p)){const R=[...p1(i,l),.25];r.push(R)}const w=e.terrain[u],b=ui(w),v=(w==null?void 0:w.collision)??(b==null?void 0:b.collision);if(Jo(jt.ISBULLET,v)){const R=[...p1(i,l),1];r.push(R)}}function xd(e,t,n,r,i,s){if(!E(n)||!E(n.terrain)||!E(n.objects))return[];const o=[];let a=t;const c=At,l=Vt,u=s?dt.BLACK:dt.ONCLEAR,f=d1(e,a++,"terrain",c,l,u);o.push(f);const d=a++,h=cF(e,d);h.sprites=[],o.push(h);const m=n.isdark?1:0,p=lF(e,a++,c,l,m);o.push(p),p.alphas.fill(m);const w=d1(e,a++,"tickers",c,l,dt.ONCLEAR);o.push(w),w.char.fill(0);const b={...sd(At,Vt,r,dt.ONCLEAR),...w},v=uF(e,a++);if(i){o.push(v);const{graphics:I,camera:P,facing:C}=yr(e),D=n.graphics??I??"",G=n.camera??P??"",U=n.facing??C??"";if(_t(D)){const T=Ot(D);switch(T){case"fpv":case"iso":case"mode7":v.graphics=T;break;default:case"flat":v.graphics="flat";break}}if(_t(G))switch(Ot(G)){default:case"mid":v.viewscale=Fc.MID;break;case"near":v.viewscale=Fc.NEAR;break;case"far":v.viewscale=Fc.FAR;break}Tt(U)&&(v.facing=im(U%360))}for(let I=0;I<n.terrain.length;++I){const P=n.terrain[I],C=go(P,0,dt.WHITE,s?dt.BLACK:dt.ONCLEAR),D=Ht(P,"collision");f.char[I]=C.char,f.color[I]=C.color,f.bg[I]=C.bg,f.wall[I]=D===jt.ISSOLID?1:0}const A=Object.values(n.objects??{});for(let I=0;I<A.length;++I){const P=A[I];if(_t(P.tickertext)&&Tt(P.tickertime)&&P.tickertext.length){const U=At,T=wb(P.tickertext,U,Vt-1),_=(T==null?void 0:T.measuredwidth)??1,N=P.x??0,V=P.y??0,B=V<Vt*.5;b.x=N-Math.floor(_*.5),b.y=V+(B?1:-1),b.x+_>At&&(b.x=At-_),b.x<0&&(b.x=0),bb(P.tickertext,b,!0)}if(E(P.removed))continue;const C=P.id??"",D=go(P,1,dt.WHITE,dt.BLACK),G=aF(e,d,C,I);if(G.x=P.x??0,G.y=P.y??0,G.char=D.char,G.color=D.color,G.bg=D.bg,h.sprites.push(G),m){if(D.light>0){const U=Br(n,G),T=fn(Math.round(D.light),1,Vt),_=1/(T*.5);if(p.alphas[U]=0,T>1){const N=[];for(let V=1;V<=T;++V){if(V===2){const Z=Ht(P,"lightdir");if(Rr(Z)){const lt=Xl(n,P,"",Z,G);switch(Ar(G,lt.destpt)){case pt.EAST:N.push([45,315,1]);break;case pt.WEST:N.push([225,135,1]);break;case pt.NORTH:N.push([315,225,1]);break;case pt.SOUTH:N.push([135,45,1]);break}}}const B=[];for(let Z=G.y-V;Z<=G.y+V;++Z)Gl(n,p.alphas,N,B,G,T,_,G.x-V,Z),Gl(n,p.alphas,N,B,G,T,_,G.x+V,Z);const at=V-1;for(let Z=G.x-at;Z<=G.x+at;++Z)Gl(n,p.alphas,N,B,G,T,_,Z,G.y-V),Gl(n,p.alphas,N,B,G,T,_,Z,G.y+V);for(let Z=0;Z<B.length;++Z){const lt=B[Z];let X=0;for(X=0;X<N.length;++X){const W=N[X];if(W[1]>W[0]&&lt[1]>=W[0]&&lt[0]<=W[1]&&lt[2]>=1&&W[2]>=1){N[X]=[Math.min(lt[0],W[0]),Math.max(lt[1],W[1]),1];break}}X===N.length&&N.push(lt)}}}}else if(Nn(C)){const U=Br(n,G);p.alphas[U]=0}}C===e&&(v.focusx=G.x,v.focusy=G.y,v.focusid=C)}o.push(Wl(e,a++,"text/mood",m?"dark":"bright"));const R=ae(Bt.MAIN),M=Si(R,Bt.MAIN);if(_t(M.palette)){const I=tn(R,yt.PALETTE,M.palette),P=Ae(I);E(P==null?void 0:P.bits)&&o.push(Wl(e,a++,"image/palette",Array.from(P.bits)))}if(_t(M.charset)){const I=tn(R,yt.CHARSET,M.charset),P=Ae(I);E(P==null?void 0:P.bits)&&o.push(Wl(e,a++,"image/charset",Array.from(P.bits)))}const S=Object.keys(n.objects).filter(Nn);return o.push(Wl(e,a++,"text/players",S.join(","))),o}const rr=oF();var Bt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Bt||{});const be={halt:!1,session:$e(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function hF(){return be.session}function ir(){return be.operator}function fF(e){be.operator=e}function dF(e){be.halt=e}function pF(){return be.halt}function Ur(){return[...be.books.values()]}function mF(){const[e]=be.books.values();return e}function Fr(e){const t=Ot(e);return be.books.get(e)??Ur().find(n=>n.name===t)}function m1(e,t){E(Fr(t))&&(be.software[e]=t)}function ae(e){return Fr(be.software[e])}function g1(e){const t=Xf([]);return _t(e)&&(t.name=e),Kl(t),xe(et,be.operator,`created [book] ${t.name}`),t}function gF(e){let t=Fr(e);return E(t)||(t=Xf([]),t.name=e),Kl(t),xe(et,be.operator,`created [book] ${t.name}`),t}function ln(e,t){let n=E(t)?gF(t):ae(e);return E(n)||(E(n)||(n=mF()),E(n)||(n=g1(t)),E(n)&&xe(et,be.operator,`opened [book] ${n.name} for ${e}`)),m1(e,n.id),n}function Qi(e,t,n){return Jf(ln(e),n,t)}function Pr(e,t){const n=ae("main"),r=qe(mo(n,e,t));if(E(r))return r;const i=Ur();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==(n==null?void 0:n.id)){const a=qe(mo(o,e,t));if(E(a))return a}}}function ui(e){if(!_t(e==null?void 0:e.kind)||!e.kind)return;const t=Pr(yt.OBJECT,e.kind);if(E(t))return e.kinddata=Ae(t),e.kinddata;const n=Pr(yt.TERRAIN,e.kind);if(E(n))return e.kinddata=Ae(n),e.kinddata}function Ht(e,t){const n=e==null?void 0:e.kinddata,r=(n==null?void 0:n.id)??"",i=e==null?void 0:e[t];if(E(i))return i;const s=n==null?void 0:n[t];if(E(s))return s;const o=Pr(yt.OBJECT,r)??Pr(yt.TERRAIN,r),a=Yf(o,t);if(E(a))return a;switch(t){case"group":return"";case"cycle":return gE;case"item":return 0;case"pushable":return 0;case"breakable":return 0;case"collision":return jt.ISWALK;default:return}}function Rt(e,t,n,r){if(!E(e)||!E(t))return;const[i,s]=t,o=Pr(yt.OBJECT,i);if(E(o)){const c=Td(e,n,i,r);if(E(c))return ia(c,s),sT(e,c),ui(c),Ym(e,c),c}const a=Pr(yt.TERRAIN,i);if(E(a)){const c=FF(e,n,i);if(E(c)){ia(c,s);const l=Vr(n,At);return ui(c),Ym(e,c,l),c}}}function _F(e,t,n){if(!E(e)||!E(t))return;const[r,i]=t,s=Pr(yt.OBJECT,r);if(E(s)){const o=Td(e,n,r);return ia(o,i),o}}function Hn(e){const t=Pr(yt.BOARD,e);return Ae(t)}function yr(e){const t=ln("main");return Si(t,e)}function _1(e){const t=ln("main");return u6(t,e)}function y1(){const e=ln("main");return Si(e,"main")}function yF(e){const t=ln("main");return fb(t,e)}function bF(e,t){be.books.clear(),e.forEach(r=>{be.books.set(r.id,r),r.name==="main"&&(be.software.main=r.id)});const n=Fr(t);if(E(n)&&(be.software.main=n.id),!be.software.main){const r=be.books.values().next();r.value&&(be.software.main=r.value.id)}}function Kl(e){return be.books.set(e.id,e),e.id}function wF(e){const t=Fr(e);t&&be.books.delete(t.id)}function b1(e){if(!_t(e)||!e)return fe(et,e,"login",`failed for playerid ==>${e}<==`);const t=ae("main");if(!E(t))return fe(et,e,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${e}<==`);const n=mn(e),r=Pr(yt.BOARD,"title");if(!E(n)&&!E(r))return fe(et,e,"login:title","login failed to find board with 'title' stat");const i=Pr(yt.OBJECT,"player");if(!E(i))return fe(et,e,"login:player","login failed to find object type 'player'");const s=Ae(r);if(E(s)){const o=Yf(r,"startx"),a=Yf(r,"starty"),c=Tt(o)?o:Math.round(At*.5),l=Tt(a)?a:Math.round(Vt*.5),u=Td(s,{x:c,y:l},"player",e);if(E(u==null?void 0:u.id))return u.player=e,Rl(t,e,s.id),!0}return!1}function EF(e){const t=ae("main"),n=Na(t,e);if(!E(t))return;const r=[e];for(let i=0;i<t.activelist.length;++i){const s=t.activelist[i];s.startsWith(e)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];Rl(t,s,""),Ch(n,Sn(n,s)),T1(n,s),rr.halt(s),fb(t,s)}}function mn(e){const t=ae("main");return Na(t,e)}function xF(e){const t=ae("main"),n=f6(t,e),r=Na(t,e),i=Sn(r,e);return n&&E(i)}function kF(e){const t=ae("main"),n=yo(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Nn(c)&&E(e[c])===!1&&(e[c]=0,Rl(t,c,i.id))}}}function w1(e){rr.message(e)}function Rn(e,t,n,r){const i=Jr(t);_t(n.id)&&et.emit(e,"vm:touched",[n.id,i,r])}function vF(e,t,n,r){const i=n.id??"";if(r.x<0){const s=mo(e,yt.BOARD,(t==null?void 0:t.exitwest)??"");if(s.length){const o=qe(s);_o(e,i,o.id,{x:At-1,y:r.y})}}else if(r.x>=At){const s=mo(e,yt.BOARD,(t==null?void 0:t.exiteast)??"");if(s.length){const o=qe(s);_o(e,i,o.id,{x:0,y:r.y})}}else if(r.y<0){const s=mo(e,yt.BOARD,(t==null?void 0:t.exitnorth)??"");if(s.length){const o=qe(s);_o(e,i,o.id,{x:r.x,y:Vt-1})}}else if(r.y>=Vt){const s=mo(e,yt.BOARD,(t==null?void 0:t.exitsouth)??"");if(s.length){const o=qe(s);_o(e,i,o.id,{x:r.x,y:0})}}}function ts(e,t,n,r){if(!E(n==null?void 0:n.id))return!1;const i=Ph(t,n,r);if(E(i)){const s=Nn(n.id),o=Nn(n.party??n.id),a=Ht(n,"collision")===jt.ISBULLET;let c="";n.party&&o&&(c=n.party),s&&(c=n.id);const l=Nn(i.id),u=Nn(i.party??i.id),f=Ht(i,"collision")===jt.ISBULLET,d=o===u;let h="";if(i.party&&u&&(h=i.party),l&&(h=i.id??""),s&&i.kind==="edge"?vF(e,t,n,r):s?l?(Rn("",i,n,"bump"),Rn("",n,i,"bump")):f?(Rn("",i,n,d?"partyshot":"shot"),Rn(c,n,i,"touch")):(Rn("",i,n,"thud"),Rn(c,n,i,"touch")):a?f?(Rn("",i,n,"thud"),Rn("",n,i,"thud")):(Rn("",i,n,l?"touch":"thud"),Rn(d?"":c,n,i,d?"partyshot":"shot")):l?Rn(h,i,n,"touch"):f?(Rn(d?"":h,i,n,d?"partyshot":"shot"),Rn("",n,i,d?"thud":"touch")):(Rn("",i,n,"thud"),Rn("",n,i,"bump")),s&&Ht(i,"item")||a&&Ht(i,"breakable")){if(E(i==null?void 0:i.id)){const m=ee(t,{x:i.x??-1,y:i.y??-1});E(m)&&wn(x.board,m,x.timestamp)}else Re(t,{x:r.x,y:r.y});return!0}return!1}return!0}function E1(e,t,n,r){var l;if(!E(e)||!E(t)||!E(n))return;const i={...x};x.book=e,x.board=t,x.element=n,x.elementid=n.id??"",x.elementisplayer=Nn(x.elementid);const s=x.element.player??be.operator;x.elementfocus=x.elementisplayer?x.elementid:s;const o=Ht(n,"cycle"),a=n.id??"",c=Ot(n.name??((l=n.kinddata)==null?void 0:l.name)??"");if(rr.tick(a,Ji.RUNTIME,o,c,r),Tt(n==null?void 0:n.tickertime)&&x.timestamp-n.tickertime>Ha*5&&(n.tickertime=0,n.tickertext=""),x.elementisplayer){const u=yr(x.elementid);Tt(u.inputcurrent)&&(u.inputcurrent=0)}sr(i).forEach(u=>{x[u]=i[u]})}function TF(e,t){be.loaders.set(e,t)}function AF(e){rr.halt(e)}function RF(){const e=rr.ids();for(let n=0;n<e.length;++n)rr.halt(e[n]);const t=ae("main");E(t)&&(t.flags={})}function SF(e=!1){const t=ae("main");if(!E(t))return;const n=t.timestamp+1,r=wi.HALT_AT_COUNT;wi.HALT_AT_COUNT=r*2,be.loaders.forEach((s,o)=>{const a={...x};x.timestamp=t.timestamp,x.book=t,x.board=void 0,x.element=void 0,x.elementid=o,x.elementisplayer=!1,x.elementfocus=ir();const c=LU(o);E(c)&&rr.arg(o,c),rr.tick(o,Ji.LOADER,1,"loader",s),rr.isended(o)&&(rr.halt(o),be.loaders.delete(o)),sr(a).forEach(l=>{x[l]=a[l]})}),wi.HALT_AT_COUNT=r,t.timestamp=n,x.timestamp=n;const i=yo(t);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)ui(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];ui(o.objects[u])}const c=AT(o,n);for(let l=0;l<c.length;++l){const{id:u,type:f,code:d,object:h}=c[l];f===yt.ERROR?rr.halt(u):(!e||Nn((h==null?void 0:h.id)??""))&&E1(t,o,h,d)}}}function So(e,t,n,r){const i=ae("main");if(!E(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(E(c.id)){const l=`${f1(c.id)}:${t}`;et.emit("",l,n)}}}if(ps(e)){for(let o=0;o<r.length;++o){const a=r[o],c=ee(a,e);E(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(Ot(e)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(bm(a,[e]));break}}}}function OF(e){const t=yr(e),n=t.playbuffer=_t(t.playbuffer)?t.playbuffer:"";n&&x1(e,n,!1)}function x1(e,t,n=!0){var o;const r=ln("main");if(!E(r))return;const i=`${e}_cli`;x.timestamp=r.timestamp,x.book=r,x.board=Na(r,e),x.element=Sn(x.board,e),x.elementid=((o=x.element)==null?void 0:o.id)??"",x.elementisplayer=!0,x.elementfocus=x.elementid||e;const s=wi.HALT_AT_COUNT;if(wi.HALT_AT_COUNT=s*8,rr.once(i,Ji.CLI,"cli",t),n){const a=yr(e);a.playbuffer=t}wi.HALT_AT_COUNT=s}function Hl(e){var a;const t=ln("main"),n=Ts(t,e);if(!E(t)||!E(n)||!E(x.element))return;const r={...x},i=`${e}_run`,s=Ot(x.element.name??((a=x.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";rr.once(i,Ji.RUNTIME,s,o),sr(r).forEach(c=>{x[c]=r[c]})}function IF(e,t){const n=ae("main"),r=Na(n,e),i=[],s=[],o=[];if(!E(n)||!E(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=Hn(r.overboard??""),l=Hn(r.underboard??"");return s.push(...xd(e,0,l,t,!1,!0)),o.push(...xd(e,s.length,r,t,!0,a!=="flat")),i.push(...xd(e,s.length+o.length,c,t,!1,!1)),{over:i,under:s,layers:o}}function NF(e,t,n,r){if(!E(e))return;E(e.distmaps)||(e.distmaps={});const i=`${t}.${n.x}.${n.y}.${r.x}.${r.y}`;let s=e.distmaps[i];if(!E(s)){s=new Array(xh).fill(-2);const o=[{...r}];let a=0;for(;o.length;){const c=o.shift();if(E(c)&&Vl(c)){const l=Vr(c,At);if(s[l]===-2){const u=es(e,c.x,c.y);Jo(t,Ht(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}e.distmaps[i]=s}return s}function k1(e,t){return Vl(e)?t[Vr(e,At)]:-1}function v1(e,t,n,r,i){if(!E(e))return;const s=NF(e,t,n,r);if(!E(s))return;const o=[{x:n.x,y:n.y-1},{x:n.x,y:n.y+1},{x:n.x-1,y:n.y},{x:n.x+1,y:n.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=k1(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=k1(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function CF(){return new Array(At*Vt).map(()=>{})}function Yl(e=hu){const t={terrain:CF(),objects:{},id:""};return e(t)}var kd=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(kd||{});function LF(e){return so(e,kd,{terrain:t=>t.map(Cc),objects:t=>Object.values(t).filter(n=>!n.removed).map(Cc),id:ve,named:ve,lookup:ve,codepage:ve,distmaps:ve,overboard:ve,underboard:ve})}function MF(e){return ra(e,kd,{terrain:t=>t.map(Lc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=Lc(t[r]);E(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Vl(e){return fh(e.x,e.y,0,At-1,Vt-1,0)}function Br(e,t){return!E(e)||!E(t==null?void 0:t.x)||!E(t==null?void 0:t.y)||t.x<0||t.x>=At||t.y<0||t.y>=Vt?-1:t.x+t.y*At}function ee(e,t){const n=Br(e,t);if(n<0||!E(e==null?void 0:e.lookup))return;const r=Sn(e,e.lookup[n]??"");return E(r)?r:e.terrain[n]}function UF(e,t){const n=Sn(e,t);if(E(n))return n;const r=parseFloat(t),i=yv(isNaN(r)?-1:r,At);return es(e,i.x,i.y)}function es(e,t,n){return(t>=0&&t<At)??(n>=0&&n<Vt)?e==null?void 0:e.terrain[t+n*At]:void 0}function Re(e,t){if(!E(e)||!E(t)||!E(t.x)||!E(t.y)||t.x<0||t.x>=At||t.y<0||t.y>=Vt)return;const n=wr(t),r=t.x+t.y*At;return e.terrain[r]=n,delete e.distmaps,e.terrain[r]}function vd(e,t){if(!E(e)||!E(t))return;const n=wr(t);return n.id=n.id??$e(),e.objects[n.id]=n,e.objects[n.id]}function FF(e,t,n){return Re(e,{...t,kind:n})}function Td(e,t,n,r){return vd(e,{...t,kind:n,id:r})}function Sn(e,t){if(e)return e.objects[t]}function PF(e,t){const n=Br(e,t);if(n<0||!E(e==null?void 0:e.lookup))return;const r=Sn(e,e.lookup[n]??"");if(E(r))return r}function wn(e,t,n){return!E(t)||Jr(t)==="player"?!1:(t.id?(t.removed=n,Ch(e,t)):(Re(e,{x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0}),oT(e,t)),!0)}function T1(e,t){return E(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function BF(e,t,n){if(!E(e)||!E(t))return;const r=e.objects[n];if(E(r))return r;if(ps(t))return wm(t,Qo(e,"player"))}function Xl(e,t,n,r,i){const s=pt.MID;if(!E(e)||!E(t))return{dir:r,startpt:i,destpt:i,layer:s};const o={x:t.x??0,y:t.y??0},a={x:t.lx??o.x,y:t.ly??o.y},c=Ar(a,o),l=At-1,u=Vt-1;for(let f=0;f<r.length;++f){const d=Iv(r[f]);switch(d){case pt.IDLE:break;case pt.NORTH:case pt.SOUTH:case pt.WEST:case pt.EAST:je(o,d);break;case pt.BY:{const[h,m]=r.slice(f+1);Tt(h)&&Tt(m)&&(o.x=fn(o.x+h,0,l),o.y=fn(o.y+m,0,u)),f+=2;break}case pt.TO:case pt.AT:{const[h,m]=r.slice(f+1);Tt(h)&&Tt(m)&&(o.x=fn(h,0,l),o.y=fn(m,0,u)),f+=2;break}case pt.FLOW:je(o,c);break;case pt.SEEK:{const h=BF(e,t,n);ps(h)&&je(o,Ar(i,h));break}case pt.RNDNS:je(o,qe(pt.NORTH,pt.SOUTH));break;case pt.RNDNE:je(o,qe(pt.NORTH,pt.EAST));break;case pt.RND:je(o,qe(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));break;case pt.CW:case pt.CCW:case pt.OPP:case pt.RNDP:{const h=Xl(e,t,n,r.slice(f+1),i);switch(o.x=i.x,o.y=i.y,d){case pt.CW:switch(Ar(i,h.destpt)){case pt.NORTH:je(o,pt.EAST);break;case pt.SOUTH:je(o,pt.WEST);break;case pt.EAST:je(o,pt.SOUTH);break;case pt.WEST:je(o,pt.NORTH);break}break;case pt.CCW:switch(Ar(i,h.destpt)){case pt.NORTH:je(o,pt.WEST);break;case pt.SOUTH:je(o,pt.EAST);break;case pt.EAST:je(o,pt.NORTH);break;case pt.WEST:je(o,pt.SOUTH);break}break;case pt.OPP:switch(Ar(i,h.destpt)){case pt.NORTH:je(o,pt.SOUTH);break;case pt.SOUTH:je(o,pt.NORTH);break;case pt.EAST:je(o,pt.WEST);break;case pt.WEST:je(o,pt.EAST);break}break;case pt.RNDP:switch(Ar(i,h.destpt)){case pt.NORTH:case pt.SOUTH:o.x+=qe(-1,1);break;case pt.WEST:case pt.EAST:o.y+=qe(-1,1);break}break}break}case pt.FLEE:case pt.AWAY:{const[h,m]=r.slice(f+1);if(Tt(h)&&Tt(m)){const p={x:fn(h,0,l),y:fn(m,0,u)},w=Ht(t,"collision"),b=v1(e,w,o,p,!0);E(b)&&(o.x=b.x,o.y=b.y)}f+=2;break}case pt.FIND:case pt.TOWARD:{const[h,m]=r.slice(f+1);if(Tt(h)&&Tt(m)){const p={x:fn(h,0,l),y:fn(m,0,u)};if(lr(1,100)<5)je(o,qe(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));else{const w=Ht(t,"collision"),b=v1(e,w,o,p,!1);if(E(b))if(b.x!==h&&b.y!==m&&PF(e,b))switch(Ar(i,b)){case pt.EAST:case pt.WEST:o.y+=qe(-1,1);break;case pt.NORTH:case pt.SOUTH:o.x+=qe(-1,1);break}else o.x=b.x,o.y=b.y}}f+=2;break}case pt.PLAYER:{const h=Zo(e,i,n);ps(h)&&(o.x=h.x,o.y=h.y);break}case pt.OVER:case pt.UNDER:{const h=Xl(e,t,n,r.slice(f+1),i);return h.layer=d,h}}}return{dir:r,startpt:i,destpt:o,layer:s}}const x={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var K=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.MAYBE_KIND=7]="MAYBE_KIND",e[e.MAYBE_NAME=8]="MAYBE_NAME",e[e.MAYBE_NUMBER=9]="MAYBE_NUMBER",e[e.MAYBE_STRING=10]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",e[e.ANY=12]="ANY",e))(K||{});function En(e,t,n){throw console.info(n,x.element,x.elementid,x.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function A1(e){var n,r;const t={x:((n=x.element)==null?void 0:n.x)??0,y:((r=x.element)==null?void 0:r.y)??0};return Xl(x.board,x.element,x.elementfocus,e,t)}function rt(e,t,n){const r=x.words;x.words=e;const i=[];let s=t;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=_m(s);ro(a)?(s=c,i.push(a)):En("kind",a,e);break}case 0:{if(vc(e[0])===void 0){const[a,c]=Wn(s);Xr(a)?(s=c,i.push(a)):En("color",a,e)}else{const[a,c]=wh(s);Xr(a)?(s=c,i.push(a)):En("color",a,e)}break}case 2:{if(bh(e[0])===void 0){const[a,c]=Wn(s);Rr(a)?(s=c,i.push(A1(a))):En("direction",a,e)}else{const[a,c]=um(s);Rr(a)?(s=c,i.push(A1(a))):En("direction",a,e)}break}case 3:{const a=x.words[s];_t(a)||En("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Wn(s);if(_t(a)){const l=parseFloat(a);Tt(l)?i.push(l):En("number",a,e)}else Tt(a)?i.push(a):En("number",a,e);s=c;break}case 5:{const[a,c]=Wn(s);_t(a)||En("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Wn(s);let l=a;if(_t(l)){const u=parseFloat(l);Tt(u)&&(l=u)}else Tt(l)||En("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=_m(s);a!==void 0&&!ro(a)&&En("optional kind",a,e),s=c,i.push(a);break}case 8:{const a=x.words[s];a!==void 0&&!_t(a)&&En("optional string",a,e),++s,i.push(a);break}case 9:{const[a,c]=Wn(s);if(_t(a)){const l=parseFloat(a);Tt(l)?i.push(l):En("optional number",a,e)}else Tt(a)||a===void 0?i.push(a):En("optional number",a,e);s=c;break}case 10:{const[a,c]=Wn(s);a!==void 0&&!_t(a)&&En("optional string",a,e),s=c,i.push(a);break}case 11:{const[a,c]=Wn(s);let l=a;if(_t(l)){const u=parseFloat(l);Tt(u)&&(l=u)}else l!==void 0&&!Tt(l)&&En("number or string",l,e);s=c,i.push(l);break}case 12:{const[a,c]=Wn(s);s=c,i.push(a);break}}return x.words=r,[...i,s]}const ql={},Oo={};function Ad(){return{id:$e(),layers:[],scroll:[],sidebar:[]}}const $F=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),DF=new Set(["tx","text"]),jF={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},R1={};let S1=e=>{let t=R1[e];return E(t)||(R1[e]=t=Ad()),t};function zF(e){S1=e}function Ye(e){return S1(e)}function Rd(e){return E(ql[e])||(ql[e]=[]),ql[e]}function WF(e){const t=Ye(e);t.scroll=[]}function GF(e,t,n){Object.values(Oo).forEach(r=>{if(r[t]!==void 0){const i=qm(e.id(),t);Tt(n)&&dv(i,n),_t(n)&&pv(i,n)}})}function On(e){const t=Rd(e);return ql[e]=[],t}function It(e,t){Rd(e).push(t)}function Ft(e,t,n,r,i=()=>0,s=hu){const o=[t,n,...r],a=Ot(`${o[3]}`),c={...x};function l(u,f){E(f)&&f!==i(u)&&(x.board=c.board,x.element=c.element,x.elementfocus=c.elementfocus,s(u,f))}if($F.has(a)){const u=`${o[2]}`;Oo[t]=Oo[t]??{};const f=i(u)??jF[a];if(Oo[t][u]===void 0){const d=qm(t,u);Tt(f)&&fv(d,f),_t(f)&&hh(d,f),DF.has(a)?Oo[t][u]=Vp(d,h=>{l(u,h)}):Oo[t][u]=mv(d,h=>{l(u,h)})}}Rd(e).push(o)}zF(e=>{if(Nn(e)){const t=ae(Bt.MAIN),n=Si(t,Bt.GADGETSTORE);let r=n[e];return E(r)||(n[e]=r=Ad()),r}return Ad()});let O1=0;function KF(){switch(O1++){case 0:return dt.BLUE;case 1:return dt.BLACK;case 2:return dt.GREEN;case 3:return dt.BLACK;case 4:return dt.CYAN;case 5:return dt.BLACK;case 6:return dt.RED;case 7:return dt.BLACK;case 8:return dt.PURPLE;case 9:return dt.BLACK;case 10:return dt.YELLOW;case 11:return dt.BLACK;case 12:return dt.WHITE;default:return O1=0,dt.BLACK}}const Jl=Us("gadgetserver",["tock","second"],e=>{if(!Jl.session(e))return;const t=ae(Bt.MAIN),n=(t==null?void 0:t.activelist)??[],r=Si(t,Bt.GADGETSYNC);switch(e.target){case"tock":{const i=KF();for(let s=0;s<n.length;++s){const o=n[s],{over:a,under:c,layers:l}=IF(o,i),u=Ye(o);u.over=a,u.under=c,u.layers=l;const f=r[o]??{},d=Yd(f,u);d.length&&(r[o]=wr(u),Dw(Jl,o,d))}break}case"second":for(let i=0;i<n.length;++i){const s=n[i],o=mn(s);E(o)&&Qw(Jl,s,o.id)}break;case"desync":$w(Jl,e.player,Ye(e.player));break;case"clearscroll":WF(e.player);break;case"clearplayer":{const i=Si(t,Bt.GADGETSTORE);delete i[e.player];const s=Si(t,Bt.GADGETSYNC);delete s[e.player];break}}});function Zl(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var I1={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof Zl=="function"&&Zl;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(m){var p=r[l][1][m];return o(p||m)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof Zl=="function"&&Zl,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,m,p,w=[],b=0,v=c.length,A=v,R=s.getTypeOf(c)!=="string";b<c.length;)A=v-b,f=R?(l=c[b++],u=b<v?c[b++]:0,b<v?c[b++]:0):(l=c.charCodeAt(b++),u=b<v?c.charCodeAt(b++):0,b<v?c.charCodeAt(b++):0),d=l>>2,h=(3&l)<<4|u>>4,m=1<A?(15&u)<<2|f>>6:64,p=2<A?63&f:64,w.push(a.charAt(d)+a.charAt(h)+a.charAt(m)+a.charAt(p));return w.join("")},i.decode=function(c){var l,u,f,d,h,m,p=0,w=0,b="data:";if(c.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var v,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=o.uint8array?new Uint8Array(0|A):new Array(0|A);p<c.length;)l=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(p++)))>>2,f=(3&h)<<6|(m=a.indexOf(c.charAt(p++))),v[w++]=l,h!==64&&(v[w++]=u),m!==64&&(v[w++]=f);return v}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,m){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u[p])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u.charCodeAt(p))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,m){var p,w="";for(p=0;p<m;p++)w+=String.fromCharCode(255&h),h>>>=8;return w}function o(h,m,p,w,b,v){var A,R,M=h.file,S=h.compression,I=v!==l.utf8encode,P=a.transformTo("string",v(M.name)),C=a.transformTo("string",l.utf8encode(M.name)),D=M.comment,G=a.transformTo("string",v(D)),U=a.transformTo("string",l.utf8encode(D)),T=C.length!==M.name.length,_=U.length!==D.length,N="",V="",B="",at=M.dir,Z=M.date,lt={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(lt.crc32=h.crc32,lt.compressedSize=h.compressedSize,lt.uncompressedSize=h.uncompressedSize);var X=0;m&&(X|=8),I||!T&&!_||(X|=2048);var W=0,kt=0;at&&(W|=16),b==="UNIX"?(kt=798,W|=function(ht,zt){var oe=ht;return ht||(oe=zt?16893:33204),(65535&oe)<<16}(M.unixPermissions,at)):(kt=20,W|=function(ht){return 63&(ht||0)}(M.dosPermissions)),A=Z.getUTCHours(),A<<=6,A|=Z.getUTCMinutes(),A<<=5,A|=Z.getUTCSeconds()/2,R=Z.getUTCFullYear()-1980,R<<=4,R|=Z.getUTCMonth()+1,R<<=5,R|=Z.getUTCDate(),T&&(V=s(1,1)+s(u(P),4)+C,N+="up"+s(V.length,2)+V),_&&(B=s(1,1)+s(u(G),4)+U,N+="uc"+s(B.length,2)+B);var ct="";return ct+=`
\0`,ct+=s(X,2),ct+=S.magic,ct+=s(A,2),ct+=s(R,2),ct+=s(lt.crc32,4),ct+=s(lt.compressedSize,4),ct+=s(lt.uncompressedSize,4),ct+=s(P.length,2),ct+=s(N.length,2),{fileRecord:f.LOCAL_FILE_HEADER+ct+P+N,dirRecord:f.CENTRAL_FILE_HEADER+s(kt,2)+ct+s(G.length,2)+"\0\0\0\0"+s(W,4)+s(w,4)+P+N+G}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,m,p,w){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=w,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var m=h.meta.percent||0,p=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-w-1))/p:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var m=this.streamFiles&&!h.file.dir;if(m){var p=o(h,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var m=this.streamFiles&&!h.file.dir,p=o(h,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(w){return f.DATA_DESCRIPTOR+s(w.crc32,4)+s(w.compressedSize,4)+s(w.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-h,w=function(b,v,A,R,M){var S=a.transformTo("string",M(R));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(b,2)+s(b,2)+s(v,4)+s(A,4)+s(S.length,2)+S}(this.dirRecords.length,p,h,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var m=this;return h.on("data",function(p){m.processChunk(p)}),h.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),h.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var m=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var p=0;p<m.length;p++)try{m[p].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,m=0;m<h.length;m++)h[m].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var m=function(v,A){var R=v||A,M=s[R];if(!M)throw new Error(R+" is not a valid compression method !");return M}(h.options.compression,c.compression),p=h.options.compressionOptions||c.compressionOptions||{},w=h.dir,b=h.date;h._compressWorker(m,p).withStreamInfo("file",{name:d,dir:w,date:b,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,m){var p=d.decompressed.getContentWorker().pipe(new l);p.on("error",function(w){m(w)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var m=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(p){var w=new c(h);return w.load(p),w}).then(function(p){var w=[o.Promise.resolve(p)],b=p.files;if(h.checkCRC32)for(var v=0;v<b.length;v++)w.push(f(b[v]));return o.Promise.all(w)}).then(function(p){for(var w=p.shift(),b=w.files,v=0;v<b.length;v++){var A=b[v],R=A.fileNameStr,M=s.resolve(A.fileNameStr);m.file(M,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:h.createFolders}),A.dir||(m.file(M).unsafeOriginalName=R)}return w.zipComment.length&&(m.comment=w.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof un<"u",newBufferFrom:function(s,o){if(un.from&&un.from!==Uint8Array.from)return un.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new un(s,o)},allocBuffer:function(s){if(un.alloc)return un.alloc(s);var o=new un(s);return o.fill(0),o},isBuffer:function(s){return un.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(M,S,I){var P,C=a.getTypeOf(S),D=a.extend(I||{},u);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&16384&D.unixPermissions&&(D.dir=!0),D.dosPermissions&&16&D.dosPermissions&&(D.dir=!0),D.dir&&(M=b(M)),D.createFolders&&(P=w(M))&&v.call(this,P,!0);var G=C==="string"&&D.binary===!1&&D.base64===!1;I&&I.binary!==void 0||(D.binary=!G),(S instanceof f&&S.uncompressedSize===0||D.dir||!S||S.length===0)&&(D.base64=!1,D.binary=!0,S="",D.compression="STORE",C="string");var U=null;U=S instanceof f||S instanceof c?S:m.isNode&&m.isStream(S)?new p(M,S):a.prepareContent(M,S,D.binary,D.optimizedBinaryString,D.base64);var T=new d(M,U,D);this.files[M]=T}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),m=n("./nodejsUtils"),p=n("./nodejs/NodejsStreamInputAdapter"),w=function(M){M.slice(-1)==="/"&&(M=M.substring(0,M.length-1));var S=M.lastIndexOf("/");return 0<S?M.substring(0,S):""},b=function(M){return M.slice(-1)!=="/"&&(M+="/"),M},v=function(M,S){return S=S!==void 0?S:u.createFolders,M=b(M),this.files[M]||s.call(this,M,null,{dir:!0,createFolders:S}),this.files[M]};function A(M){return Object.prototype.toString.call(M)==="[object RegExp]"}var R={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(M){var S,I,P;for(S in this.files)P=this.files[S],(I=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&M(I,P)},filter:function(M){var S=[];return this.forEach(function(I,P){M(I,P)&&S.push(P)}),S},file:function(M,S,I){if(arguments.length!==1)return M=this.root+M,s.call(this,M,S,I),this;if(A(M)){var P=M;return this.filter(function(D,G){return!G.dir&&P.test(D)})}var C=this.files[this.root+M];return C&&!C.dir?C:null},folder:function(M){if(!M)return this;if(A(M))return this.filter(function(C,D){return D.dir&&M.test(C)});var S=this.root+M,I=v.call(this,S),P=this.clone();return P.root=I.name,P},remove:function(M){M=this.root+M;var S=this.files[M];if(S||(M.slice(-1)!=="/"&&(M+="/"),S=this.files[M]),S&&!S.dir)delete this.files[M];else for(var I=this.filter(function(C,D){return D.name.slice(0,M.length)===M}),P=0;P<I.length;P++)delete this.files[I[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(M){var S,I={};try{if((I=a.extend(M||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");a.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var P=I.comment||this.comment||"";S=h.generateWorker(this,I,P)}catch(C){(S=new c("error")).error(C)}return new l(S,I.type||"string",I.mimeType)},generateAsync:function(M,S){return this.generateInternalStream(M).accumulate(S)},generateNodeStream:function(M,S){return(M=M||{}).type||(M.type="nodebuffer"),this.generateInternalStream(M).toNodejsStream(S)}};r.exports=R},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new u.Promise(function(w,b){var v=[],A=m._internalType,R=m._outputType,M=m._mimeType;m.on("data",function(S,I){v.push(S),p&&p(I)}).on("error",function(S){v=[],b(S)}).on("end",function(){try{var S=function(I,P,C){switch(I){case"blob":return s.newBlob(s.transformTo("arraybuffer",P),C);case"base64":return c.encode(P);default:return s.transformTo(I,P)}}(R,function(I,P){var C,D=0,G=null,U=0;for(C=0;C<P.length;C++)U+=P[C].length;switch(I){case"string":return P.join("");case"array":return Array.prototype.concat.apply([],P);case"uint8array":for(G=new Uint8Array(U),C=0;C<P.length;C++)G.set(P[C],D),D+=P[C].length;return G;case"nodebuffer":return un.concat(P);default:throw new Error("concat : unsupported type '"+I+"'")}}(A,v),M);w(S)}catch(I){b(I)}v=[]}).resume()})}function h(m,p,w){var b=p;switch(p){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=p,this._mimeType=w,s.checkSupport(b),this._worker=m.pipe(new o(b)),m.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}h.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var w=this;return m==="data"?this._worker.on(m,function(b){p.call(w,b.data,b.meta)}):this._worker.on(m,function(){s.delay(p,arguments,w)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof un<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(m){var p,w,b,v,A,R=m.length,M=0;for(v=0;v<R;v++)(64512&(w=m.charCodeAt(v)))==55296&&v+1<R&&(64512&(b=m.charCodeAt(v+1)))==56320&&(w=65536+(w-55296<<10)+(b-56320),v++),M+=w<128?1:w<2048?2:w<65536?3:4;for(p=o.uint8array?new Uint8Array(M):new Array(M),v=A=0;A<M;v++)(64512&(w=m.charCodeAt(v)))==55296&&v+1<R&&(64512&(b=m.charCodeAt(v+1)))==56320&&(w=65536+(w-55296<<10)+(b-56320),v++),w<128?p[A++]=w:(w<2048?p[A++]=192|w>>>6:(w<65536?p[A++]=224|w>>>12:(p[A++]=240|w>>>18,p[A++]=128|w>>>12&63),p[A++]=128|w>>>6&63),p[A++]=128|63&w);return p}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(m){var p,w,b,v,A=m.length,R=new Array(2*A);for(p=w=0;p<A;)if((b=m[p++])<128)R[w++]=b;else if(4<(v=l[b]))R[w++]=65533,p+=v-1;else{for(b&=v===2?31:v===3?15:7;1<v&&p<A;)b=b<<6|63&m[p++],v--;1<v?R[w++]=65533:b<65536?R[w++]=b:(b-=65536,R[w++]=55296|b>>10&1023,R[w++]=56320|1023&b)}return R.length!==w&&(R.subarray?R=R.subarray(0,w):R.length=w),s.applyFromCharCode(R)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var m=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var w=function(v,A){var R;for((A=A||v.length)>v.length&&(A=v.length),R=A-1;0<=R&&(192&v[R])==128;)R--;return R<0||R===0?A:R+l[v[R]]>A?R:A}(m),b=m;w!==m.length&&(o.uint8array?(b=m.subarray(0,w),this.leftOver=m.subarray(w,m.length)):(b=m.slice(0,w),this.leftOver=m.slice(w,m.length))),this.push({data:i.utf8decode(b),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(p){return p}function u(p,w){for(var b=0;b<p.length;++b)w[b]=255&p.charCodeAt(b);return w}n("setimmediate"),i.newBlob=function(p,w){i.checkSupport("blob");try{return new Blob([p],{type:w})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(p),b.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(p,w,b){var v=[],A=0,R=p.length;if(R<=b)return String.fromCharCode.apply(null,p);for(;A<R;)w==="array"||w==="nodebuffer"?v.push(String.fromCharCode.apply(null,p.slice(A,Math.min(A+b,R)))):v.push(String.fromCharCode.apply(null,p.subarray(A,Math.min(A+b,R)))),A+=b;return v.join("")},stringifyByChar:function(p){for(var w="",b=0;b<p.length;b++)w+=String.fromCharCode(p[b]);return w},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var w=65536,b=i.getTypeOf(p),v=!0;if(b==="uint8array"?v=f.applyCanBeUsed.uint8array:b==="nodebuffer"&&(v=f.applyCanBeUsed.nodebuffer),v)for(;1<w;)try{return f.stringifyByChunk(p,b,w)}catch{w=Math.floor(w/2)}return f.stringifyByChar(p)}function h(p,w){for(var b=0;b<p.length;b++)w[b]=p[b];return w}i.applyFromCharCode=d;var m={};m.string={string:l,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:d,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return h(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,w){if(w=w||"",!p)return w;i.checkSupport(p);var b=i.getTypeOf(w);return m[b][p](w)},i.resolve=function(p){for(var w=p.split("/"),b=[],v=0;v<w.length;v++){var A=w[v];A==="."||A===""&&v!==0&&v!==w.length-1||(A===".."?b.pop():b.push(A))}return b.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var w,b,v="";for(b=0;b<(p||"").length;b++)v+="\\x"+((w=p.charCodeAt(b))<16?"0":"")+w.toString(16).toUpperCase();return v},i.delay=function(p,w,b){setImmediate(function(){p.apply(b||null,w||[])})},i.inherits=function(p,w){function b(){}b.prototype=w.prototype,p.prototype=new b},i.extend=function(){var p,w,b={};for(p=0;p<arguments.length;p++)for(w in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],w)&&b[w]===void 0&&(b[w]=arguments[p][w]);return b},i.prepareContent=function(p,w,b,v,A){return c.Promise.resolve(w).then(function(R){return s.blob&&(R instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(R))!==-1)&&typeof FileReader<"u"?new c.Promise(function(M,S){var I=new FileReader;I.onload=function(P){M(P.target.result)},I.onerror=function(P){S(P.target.error)},I.readAsArrayBuffer(R)}):R}).then(function(R){var M=i.getTypeOf(R);return M?(M==="arraybuffer"?R=i.transformTo("uint8array",R):M==="string"&&(A?R=o.decode(R):b&&v!==!0&&(R=function(S){return u(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(R))),R):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var m=this.reader.readString(4)===d;return this.reader.setIndex(h),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,m=this.zip64EndOfCentralSize-44;0<m;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var m=d-h;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,m){this.options=h,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var m,p;if(h.skip(22),this.fileNameLength=h.readInt(2),p=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(w){for(var b in u)if(Object.prototype.hasOwnProperty.call(u,b)&&u[b].magic===w)return u[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var m=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(m),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var m,p,w,b=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<b;)m=h.readInt(2),p=h.readInt(2),w=h.readData(p),this.extraFields[m]={id:m,length:p,value:w};h.setIndex(b)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var b=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(m,p,w){this.name=m,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=p,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,w="string";try{if(!m)throw new Error("No output type specified.");var b=(w=m.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),p=this._decompressWorker();var v=!this._dataBinary;v&&!b&&(p=p.pipe(new c.Utf8EncodeWorker)),!v&&b&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(A){(p=new u("error")).error(A)}return new o(p,w,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(w,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(m),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var h=[];function m(){var p,w;a=!0;for(var b=h.length;b;){for(w=h,h=[],p=-1;++p<b;)w[p]();b=h.length}a=!1}r.exports=function(p){h.push(p)!==1||a||o()}}).call(this,typeof In<"u"?In:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,b!==o&&p(this,b)}function d(b,v,A){this.promise=b,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function h(b,v,A){s(function(){var R;try{R=v(A)}catch(M){return a.reject(b,M)}R===b?a.reject(b,new TypeError("Cannot resolve promise with itself")):a.resolve(b,R)})}function m(b){var v=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof v=="function")return function(){v.apply(b,arguments)}}function p(b,v){var A=!1;function R(I){A||(A=!0,a.reject(b,I))}function M(I){A||(A=!0,a.resolve(b,I))}var S=w(function(){v(M,R)});S.status==="error"&&R(S.value)}function w(b,v){var A={};try{A.value=b(v),A.status="success"}catch(R){A.status="error",A.value=R}return A}(r.exports=f).prototype.finally=function(b){if(typeof b!="function")return this;var v=this.constructor;return this.then(function(A){return v.resolve(b()).then(function(){return A})},function(A){return v.resolve(b()).then(function(){throw A})})},f.prototype.catch=function(b){return this.then(null,b)},f.prototype.then=function(b,v){if(typeof b!="function"&&this.state===l||typeof v!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==u?h(A,this.state===l?b:v,this.outcome):this.queue.push(new d(A,b,v)),A},d.prototype.callFulfilled=function(b){a.resolve(this.promise,b)},d.prototype.otherCallFulfilled=function(b){h(this.promise,this.onFulfilled,b)},d.prototype.callRejected=function(b){a.reject(this.promise,b)},d.prototype.otherCallRejected=function(b){h(this.promise,this.onRejected,b)},a.resolve=function(b,v){var A=w(m,v);if(A.status==="error")return a.reject(b,A.value);var R=A.value;if(R)p(b,R);else{b.state=l,b.outcome=v;for(var M=-1,S=b.queue.length;++M<S;)b.queue[M].callFulfilled(v)}return b},a.reject=function(b,v){b.state=c,b.outcome=v;for(var A=-1,R=b.queue.length;++A<R;)b.queue[A].callRejected(v);return b},f.resolve=function(b){return b instanceof this?b:a.resolve(new this(o),b)},f.reject=function(b){var v=new this(o);return a.reject(v,b)},f.all=function(b){var v=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=b.length,R=!1;if(!A)return this.resolve([]);for(var M=new Array(A),S=0,I=-1,P=new this(o);++I<A;)C(b[I],I);return P;function C(D,G){v.resolve(D).then(function(U){M[G]=U,++S!==A||R||(R=!0,a.resolve(P,M))},function(U){R||(R=!0,a.reject(P,U))})}},f.race=function(b){var v=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=b.length,R=!1;if(!A)return this.resolve([]);for(var M=-1,S=new this(o);++M<A;)I=b[M],v.resolve(I).then(function(P){R||(R=!0,a.resolve(S,P))},function(P){R||(R=!0,a.reject(S,P))});var I;return S}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,m=8;function p(b){if(!(this instanceof p))return new p(b);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},b||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(A!==f)throw new Error(c[A]);if(v.header&&s.deflateSetHeader(this.strm,v.header),v.dictionary){var R;if(R=typeof v.dictionary=="string"?a.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(A=s.deflateSetDictionary(this.strm,R))!==f)throw new Error(c[A]);this._dict_set=!0}}function w(b,v){var A=new p(v);if(A.push(b,!0),A.err)throw A.msg||c[A.err];return A.result}p.prototype.push=function(b,v){var A,R,M=this.strm,S=this.options.chunkSize;if(this.ended)return!1;R=v===~~v?v:v===!0?4:0,typeof b=="string"?M.input=a.string2buf(b):u.call(b)==="[object ArrayBuffer]"?M.input=new Uint8Array(b):M.input=b,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new o.Buf8(S),M.next_out=0,M.avail_out=S),(A=s.deflate(M,R))!==1&&A!==f)return this.onEnd(A),!(this.ended=!0);M.avail_out!==0&&(M.avail_in!==0||R!==4&&R!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(M.output,M.next_out))):this.onData(o.shrinkBuf(M.output,M.next_out)))}while((0<M.avail_in||M.avail_out===0)&&A!==1);return R===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===f):R!==2||(this.onEnd(f),!(M.avail_out=0))},p.prototype.onData=function(b){this.chunks.push(b)},p.prototype.onEnd=function(b){b===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},i.Deflate=p,i.deflate=w,i.deflateRaw=function(b,v){return(v=v||{}).raw=!0,w(b,v)},i.gzip=function(b,v){return(v=v||{}).gzip=!0,w(b,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(p){if(!(this instanceof h))return new h(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||p&&p.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var b=s.inflateInit2(this.strm,w.windowBits);if(b!==c.Z_OK)throw new Error(l[b]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function m(p,w){var b=new h(w);if(b.push(p,!0),b.err)throw b.msg||l[b.err];return b.result}h.prototype.push=function(p,w){var b,v,A,R,M,S,I=this.strm,P=this.options.chunkSize,C=this.options.dictionary,D=!1;if(this.ended)return!1;v=w===~~w?w:w===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?I.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?I.input=new Uint8Array(p):I.input=p,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new o.Buf8(P),I.next_out=0,I.avail_out=P),(b=s.inflate(I,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&C&&(S=typeof C=="string"?a.string2buf(C):d.call(C)==="[object ArrayBuffer]"?new Uint8Array(C):C,b=s.inflateSetDictionary(this.strm,S)),b===c.Z_BUF_ERROR&&D===!0&&(b=c.Z_OK,D=!1),b!==c.Z_STREAM_END&&b!==c.Z_OK)return this.onEnd(b),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&b!==c.Z_STREAM_END&&(I.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(I.output,I.next_out),R=I.next_out-A,M=a.buf2string(I.output,A),I.next_out=R,I.avail_out=P-R,R&&o.arraySet(I.output,I.output,A,R,0),this.onData(M)):this.onData(o.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(D=!0)}while((0<I.avail_in||I.avail_out===0)&&b!==c.Z_STREAM_END);return b===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(b=s.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(I.avail_out=0))},h.prototype.onData=function(p){this.chunks.push(p)},h.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=h,i.inflate=m,i.inflateRaw=function(p,w){return(w=w||{}).raw=!0,m(p,w)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,m;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(m=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],m.set(h,d),d+=h.length;return m}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",m=0;m<d;m++)h+=String.fromCharCode(f[m]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,m,p,w,b=f.length,v=0;for(p=0;p<b;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<b&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),v+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(v),p=w=0;w<v;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<b&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),h<128?d[w++]=h:(h<2048?d[w++]=192|h>>>6:(h<65536?d[w++]=224|h>>>12:(d[w++]=240|h>>>18,d[w++]=128|h>>>12&63),d[w++]=128|h>>>6&63),d[w++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,m=d.length;h<m;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,m,p,w,b=d||f.length,v=new Array(2*b);for(h=m=0;h<b;)if((p=f[h++])<128)v[m++]=p;else if(4<(w=c[p]))v[m++]=65533,h+=w-1;else{for(p&=w===2?31:w===3?15:7;1<w&&h<b;)p=p<<6|63&f[h++],w--;1<w?v[m++]=65533:p<65536?v[m++]=p:(p-=65536,v[m++]=55296|p>>10&1023,v[m++]=56320|1023&p)}return u(v,m)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,m=-2,p=-1,w=4,b=2,v=8,A=9,R=286,M=30,S=19,I=2*R+1,P=15,C=3,D=258,G=D+C+1,U=42,T=113,_=1,N=2,V=3,B=4;function at(k,st){return k.msg=u[st],st}function Z(k){return(k<<1)-(4<k?9:0)}function lt(k){for(var st=k.length;0<=--st;)k[st]=0}function X(k){var st=k.state,nt=st.pending;nt>k.avail_out&&(nt=k.avail_out),nt!==0&&(o.arraySet(k.output,st.pending_buf,st.pending_out,nt,k.next_out),k.next_out+=nt,st.pending_out+=nt,k.total_out+=nt,k.avail_out-=nt,st.pending-=nt,st.pending===0&&(st.pending_out=0))}function W(k,st){a._tr_flush_block(k,0<=k.block_start?k.block_start:-1,k.strstart-k.block_start,st),k.block_start=k.strstart,X(k.strm)}function kt(k,st){k.pending_buf[k.pending++]=st}function ct(k,st){k.pending_buf[k.pending++]=st>>>8&255,k.pending_buf[k.pending++]=255&st}function ht(k,st){var nt,$,F=k.max_chain_length,Y=k.strstart,ot=k.prev_length,ft=k.nice_match,Q=k.strstart>k.w_size-G?k.strstart-(k.w_size-G):0,gt=k.window,Et=k.w_mask,mt=k.prev,Nt=k.strstart+D,he=gt[Y+ot-1],Dt=gt[Y+ot];k.prev_length>=k.good_match&&(F>>=2),ft>k.lookahead&&(ft=k.lookahead);do if(gt[(nt=st)+ot]===Dt&&gt[nt+ot-1]===he&&gt[nt]===gt[Y]&&gt[++nt]===gt[Y+1]){Y+=2,nt++;do;while(gt[++Y]===gt[++nt]&&gt[++Y]===gt[++nt]&&gt[++Y]===gt[++nt]&&gt[++Y]===gt[++nt]&&gt[++Y]===gt[++nt]&&gt[++Y]===gt[++nt]&&gt[++Y]===gt[++nt]&&gt[++Y]===gt[++nt]&&Y<Nt);if($=D-(Nt-Y),Y=Nt-D,ot<$){if(k.match_start=st,ft<=(ot=$))break;he=gt[Y+ot-1],Dt=gt[Y+ot]}}while((st=mt[st&Et])>Q&&--F!=0);return ot<=k.lookahead?ot:k.lookahead}function zt(k){var st,nt,$,F,Y,ot,ft,Q,gt,Et,mt=k.w_size;do{if(F=k.window_size-k.lookahead-k.strstart,k.strstart>=mt+(mt-G)){for(o.arraySet(k.window,k.window,mt,mt,0),k.match_start-=mt,k.strstart-=mt,k.block_start-=mt,st=nt=k.hash_size;$=k.head[--st],k.head[st]=mt<=$?$-mt:0,--nt;);for(st=nt=mt;$=k.prev[--st],k.prev[st]=mt<=$?$-mt:0,--nt;);F+=mt}if(k.strm.avail_in===0)break;if(ot=k.strm,ft=k.window,Q=k.strstart+k.lookahead,gt=F,Et=void 0,Et=ot.avail_in,gt<Et&&(Et=gt),nt=Et===0?0:(ot.avail_in-=Et,o.arraySet(ft,ot.input,ot.next_in,Et,Q),ot.state.wrap===1?ot.adler=c(ot.adler,ft,Et,Q):ot.state.wrap===2&&(ot.adler=l(ot.adler,ft,Et,Q)),ot.next_in+=Et,ot.total_in+=Et,Et),k.lookahead+=nt,k.lookahead+k.insert>=C)for(Y=k.strstart-k.insert,k.ins_h=k.window[Y],k.ins_h=(k.ins_h<<k.hash_shift^k.window[Y+1])&k.hash_mask;k.insert&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[Y+C-1])&k.hash_mask,k.prev[Y&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=Y,Y++,k.insert--,!(k.lookahead+k.insert<C)););}while(k.lookahead<G&&k.strm.avail_in!==0)}function oe(k,st){for(var nt,$;;){if(k.lookahead<G){if(zt(k),k.lookahead<G&&st===f)return _;if(k.lookahead===0)break}if(nt=0,k.lookahead>=C&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+C-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),nt!==0&&k.strstart-nt<=k.w_size-G&&(k.match_length=ht(k,nt)),k.match_length>=C)if($=a._tr_tally(k,k.strstart-k.match_start,k.match_length-C),k.lookahead-=k.match_length,k.match_length<=k.max_lazy_match&&k.lookahead>=C){for(k.match_length--;k.strstart++,k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+C-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart,--k.match_length!=0;);k.strstart++}else k.strstart+=k.match_length,k.match_length=0,k.ins_h=k.window[k.strstart],k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+1])&k.hash_mask;else $=a._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++;if($&&(W(k,!1),k.strm.avail_out===0))return _}return k.insert=k.strstart<C-1?k.strstart:C-1,st===d?(W(k,!0),k.strm.avail_out===0?V:B):k.last_lit&&(W(k,!1),k.strm.avail_out===0)?_:N}function $t(k,st){for(var nt,$,F;;){if(k.lookahead<G){if(zt(k),k.lookahead<G&&st===f)return _;if(k.lookahead===0)break}if(nt=0,k.lookahead>=C&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+C-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),k.prev_length=k.match_length,k.prev_match=k.match_start,k.match_length=C-1,nt!==0&&k.prev_length<k.max_lazy_match&&k.strstart-nt<=k.w_size-G&&(k.match_length=ht(k,nt),k.match_length<=5&&(k.strategy===1||k.match_length===C&&4096<k.strstart-k.match_start)&&(k.match_length=C-1)),k.prev_length>=C&&k.match_length<=k.prev_length){for(F=k.strstart+k.lookahead-C,$=a._tr_tally(k,k.strstart-1-k.prev_match,k.prev_length-C),k.lookahead-=k.prev_length-1,k.prev_length-=2;++k.strstart<=F&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+C-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),--k.prev_length!=0;);if(k.match_available=0,k.match_length=C-1,k.strstart++,$&&(W(k,!1),k.strm.avail_out===0))return _}else if(k.match_available){if(($=a._tr_tally(k,0,k.window[k.strstart-1]))&&W(k,!1),k.strstart++,k.lookahead--,k.strm.avail_out===0)return _}else k.match_available=1,k.strstart++,k.lookahead--}return k.match_available&&($=a._tr_tally(k,0,k.window[k.strstart-1]),k.match_available=0),k.insert=k.strstart<C-1?k.strstart:C-1,st===d?(W(k,!0),k.strm.avail_out===0?V:B):k.last_lit&&(W(k,!1),k.strm.avail_out===0)?_:N}function Pt(k,st,nt,$,F){this.good_length=k,this.max_lazy=st,this.nice_length=nt,this.max_chain=$,this.func=F}function ce(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*I),this.dyn_dtree=new o.Buf16(2*(2*M+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),lt(this.dyn_ltree),lt(this.dyn_dtree),lt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(P+1),this.heap=new o.Buf16(2*R+1),lt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*R+1),lt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Xt(k){var st;return k&&k.state?(k.total_in=k.total_out=0,k.data_type=b,(st=k.state).pending=0,st.pending_out=0,st.wrap<0&&(st.wrap=-st.wrap),st.status=st.wrap?U:T,k.adler=st.wrap===2?0:1,st.last_flush=f,a._tr_init(st),h):at(k,m)}function Se(k){var st=Xt(k);return st===h&&function(nt){nt.window_size=2*nt.w_size,lt(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=C-1,nt.match_available=0,nt.ins_h=0}(k.state),st}function Be(k,st,nt,$,F,Y){if(!k)return m;var ot=1;if(st===p&&(st=6),$<0?(ot=0,$=-$):15<$&&(ot=2,$-=16),F<1||A<F||nt!==v||$<8||15<$||st<0||9<st||Y<0||w<Y)return at(k,m);$===8&&($=9);var ft=new ce;return(k.state=ft).strm=k,ft.wrap=ot,ft.gzhead=null,ft.w_bits=$,ft.w_size=1<<ft.w_bits,ft.w_mask=ft.w_size-1,ft.hash_bits=F+7,ft.hash_size=1<<ft.hash_bits,ft.hash_mask=ft.hash_size-1,ft.hash_shift=~~((ft.hash_bits+C-1)/C),ft.window=new o.Buf8(2*ft.w_size),ft.head=new o.Buf16(ft.hash_size),ft.prev=new o.Buf16(ft.w_size),ft.lit_bufsize=1<<F+6,ft.pending_buf_size=4*ft.lit_bufsize,ft.pending_buf=new o.Buf8(ft.pending_buf_size),ft.d_buf=1*ft.lit_bufsize,ft.l_buf=3*ft.lit_bufsize,ft.level=st,ft.strategy=Y,ft.method=nt,Se(k)}s=[new Pt(0,0,0,0,function(k,st){var nt=65535;for(nt>k.pending_buf_size-5&&(nt=k.pending_buf_size-5);;){if(k.lookahead<=1){if(zt(k),k.lookahead===0&&st===f)return _;if(k.lookahead===0)break}k.strstart+=k.lookahead,k.lookahead=0;var $=k.block_start+nt;if((k.strstart===0||k.strstart>=$)&&(k.lookahead=k.strstart-$,k.strstart=$,W(k,!1),k.strm.avail_out===0)||k.strstart-k.block_start>=k.w_size-G&&(W(k,!1),k.strm.avail_out===0))return _}return k.insert=0,st===d?(W(k,!0),k.strm.avail_out===0?V:B):(k.strstart>k.block_start&&(W(k,!1),k.strm.avail_out),_)}),new Pt(4,4,8,4,oe),new Pt(4,5,16,8,oe),new Pt(4,6,32,32,oe),new Pt(4,4,16,16,$t),new Pt(8,16,32,32,$t),new Pt(8,16,128,128,$t),new Pt(8,32,128,256,$t),new Pt(32,128,258,1024,$t),new Pt(32,258,258,4096,$t)],i.deflateInit=function(k,st){return Be(k,st,v,15,8,0)},i.deflateInit2=Be,i.deflateReset=Se,i.deflateResetKeep=Xt,i.deflateSetHeader=function(k,st){return k&&k.state?k.state.wrap!==2?m:(k.state.gzhead=st,h):m},i.deflate=function(k,st){var nt,$,F,Y;if(!k||!k.state||5<st||st<0)return k?at(k,m):m;if($=k.state,!k.output||!k.input&&k.avail_in!==0||$.status===666&&st!==d)return at(k,k.avail_out===0?-5:m);if($.strm=k,nt=$.last_flush,$.last_flush=st,$.status===U)if($.wrap===2)k.adler=0,kt($,31),kt($,139),kt($,8),$.gzhead?(kt($,($.gzhead.text?1:0)+($.gzhead.hcrc?2:0)+($.gzhead.extra?4:0)+($.gzhead.name?8:0)+($.gzhead.comment?16:0)),kt($,255&$.gzhead.time),kt($,$.gzhead.time>>8&255),kt($,$.gzhead.time>>16&255),kt($,$.gzhead.time>>24&255),kt($,$.level===9?2:2<=$.strategy||$.level<2?4:0),kt($,255&$.gzhead.os),$.gzhead.extra&&$.gzhead.extra.length&&(kt($,255&$.gzhead.extra.length),kt($,$.gzhead.extra.length>>8&255)),$.gzhead.hcrc&&(k.adler=l(k.adler,$.pending_buf,$.pending,0)),$.gzindex=0,$.status=69):(kt($,0),kt($,0),kt($,0),kt($,0),kt($,0),kt($,$.level===9?2:2<=$.strategy||$.level<2?4:0),kt($,3),$.status=T);else{var ot=v+($.w_bits-8<<4)<<8;ot|=(2<=$.strategy||$.level<2?0:$.level<6?1:$.level===6?2:3)<<6,$.strstart!==0&&(ot|=32),ot+=31-ot%31,$.status=T,ct($,ot),$.strstart!==0&&(ct($,k.adler>>>16),ct($,65535&k.adler)),k.adler=1}if($.status===69)if($.gzhead.extra){for(F=$.pending;$.gzindex<(65535&$.gzhead.extra.length)&&($.pending!==$.pending_buf_size||($.gzhead.hcrc&&$.pending>F&&(k.adler=l(k.adler,$.pending_buf,$.pending-F,F)),X(k),F=$.pending,$.pending!==$.pending_buf_size));)kt($,255&$.gzhead.extra[$.gzindex]),$.gzindex++;$.gzhead.hcrc&&$.pending>F&&(k.adler=l(k.adler,$.pending_buf,$.pending-F,F)),$.gzindex===$.gzhead.extra.length&&($.gzindex=0,$.status=73)}else $.status=73;if($.status===73)if($.gzhead.name){F=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>F&&(k.adler=l(k.adler,$.pending_buf,$.pending-F,F)),X(k),F=$.pending,$.pending===$.pending_buf_size)){Y=1;break}Y=$.gzindex<$.gzhead.name.length?255&$.gzhead.name.charCodeAt($.gzindex++):0,kt($,Y)}while(Y!==0);$.gzhead.hcrc&&$.pending>F&&(k.adler=l(k.adler,$.pending_buf,$.pending-F,F)),Y===0&&($.gzindex=0,$.status=91)}else $.status=91;if($.status===91)if($.gzhead.comment){F=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>F&&(k.adler=l(k.adler,$.pending_buf,$.pending-F,F)),X(k),F=$.pending,$.pending===$.pending_buf_size)){Y=1;break}Y=$.gzindex<$.gzhead.comment.length?255&$.gzhead.comment.charCodeAt($.gzindex++):0,kt($,Y)}while(Y!==0);$.gzhead.hcrc&&$.pending>F&&(k.adler=l(k.adler,$.pending_buf,$.pending-F,F)),Y===0&&($.status=103)}else $.status=103;if($.status===103&&($.gzhead.hcrc?($.pending+2>$.pending_buf_size&&X(k),$.pending+2<=$.pending_buf_size&&(kt($,255&k.adler),kt($,k.adler>>8&255),k.adler=0,$.status=T)):$.status=T),$.pending!==0){if(X(k),k.avail_out===0)return $.last_flush=-1,h}else if(k.avail_in===0&&Z(st)<=Z(nt)&&st!==d)return at(k,-5);if($.status===666&&k.avail_in!==0)return at(k,-5);if(k.avail_in!==0||$.lookahead!==0||st!==f&&$.status!==666){var ft=$.strategy===2?function(Q,gt){for(var Et;;){if(Q.lookahead===0&&(zt(Q),Q.lookahead===0)){if(gt===f)return _;break}if(Q.match_length=0,Et=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++,Et&&(W(Q,!1),Q.strm.avail_out===0))return _}return Q.insert=0,gt===d?(W(Q,!0),Q.strm.avail_out===0?V:B):Q.last_lit&&(W(Q,!1),Q.strm.avail_out===0)?_:N}($,st):$.strategy===3?function(Q,gt){for(var Et,mt,Nt,he,Dt=Q.window;;){if(Q.lookahead<=D){if(zt(Q),Q.lookahead<=D&&gt===f)return _;if(Q.lookahead===0)break}if(Q.match_length=0,Q.lookahead>=C&&0<Q.strstart&&(mt=Dt[Nt=Q.strstart-1])===Dt[++Nt]&&mt===Dt[++Nt]&&mt===Dt[++Nt]){he=Q.strstart+D;do;while(mt===Dt[++Nt]&&mt===Dt[++Nt]&&mt===Dt[++Nt]&&mt===Dt[++Nt]&&mt===Dt[++Nt]&&mt===Dt[++Nt]&&mt===Dt[++Nt]&&mt===Dt[++Nt]&&Nt<he);Q.match_length=D-(he-Nt),Q.match_length>Q.lookahead&&(Q.match_length=Q.lookahead)}if(Q.match_length>=C?(Et=a._tr_tally(Q,1,Q.match_length-C),Q.lookahead-=Q.match_length,Q.strstart+=Q.match_length,Q.match_length=0):(Et=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++),Et&&(W(Q,!1),Q.strm.avail_out===0))return _}return Q.insert=0,gt===d?(W(Q,!0),Q.strm.avail_out===0?V:B):Q.last_lit&&(W(Q,!1),Q.strm.avail_out===0)?_:N}($,st):s[$.level].func($,st);if(ft!==V&&ft!==B||($.status=666),ft===_||ft===V)return k.avail_out===0&&($.last_flush=-1),h;if(ft===N&&(st===1?a._tr_align($):st!==5&&(a._tr_stored_block($,0,0,!1),st===3&&(lt($.head),$.lookahead===0&&($.strstart=0,$.block_start=0,$.insert=0))),X(k),k.avail_out===0))return $.last_flush=-1,h}return st!==d?h:$.wrap<=0?1:($.wrap===2?(kt($,255&k.adler),kt($,k.adler>>8&255),kt($,k.adler>>16&255),kt($,k.adler>>24&255),kt($,255&k.total_in),kt($,k.total_in>>8&255),kt($,k.total_in>>16&255),kt($,k.total_in>>24&255)):(ct($,k.adler>>>16),ct($,65535&k.adler)),X(k),0<$.wrap&&($.wrap=-$.wrap),$.pending!==0?h:1)},i.deflateEnd=function(k){var st;return k&&k.state?(st=k.state.status)!==U&&st!==69&&st!==73&&st!==91&&st!==103&&st!==T&&st!==666?at(k,m):(k.state=null,st===T?at(k,-3):h):m},i.deflateSetDictionary=function(k,st){var nt,$,F,Y,ot,ft,Q,gt,Et=st.length;if(!k||!k.state||(Y=(nt=k.state).wrap)===2||Y===1&&nt.status!==U||nt.lookahead)return m;for(Y===1&&(k.adler=c(k.adler,st,Et,0)),nt.wrap=0,Et>=nt.w_size&&(Y===0&&(lt(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),gt=new o.Buf8(nt.w_size),o.arraySet(gt,st,Et-nt.w_size,nt.w_size,0),st=gt,Et=nt.w_size),ot=k.avail_in,ft=k.next_in,Q=k.input,k.avail_in=Et,k.next_in=0,k.input=st,zt(nt);nt.lookahead>=C;){for($=nt.strstart,F=nt.lookahead-(C-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[$+C-1])&nt.hash_mask,nt.prev[$&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=$,$++,--F;);nt.strstart=$,nt.lookahead=C-1,zt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=C-1,nt.match_available=0,k.next_in=ft,k.input=Q,k.avail_in=ot,nt.wrap=Y,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,m,p,w,b,v,A,R,M,S,I,P,C,D,G,U,T,_,N;a=s.state,c=s.next_in,_=s.input,l=c+(s.avail_in-5),u=s.next_out,N=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,m=a.wsize,p=a.whave,w=a.wnext,b=a.window,v=a.hold,A=a.bits,R=a.lencode,M=a.distcode,S=(1<<a.lenbits)-1,I=(1<<a.distbits)-1;t:do{A<15&&(v+=_[c++]<<A,A+=8,v+=_[c++]<<A,A+=8),P=R[v&S];e:for(;;){if(v>>>=C=P>>>24,A-=C,(C=P>>>16&255)===0)N[u++]=65535&P;else{if(!(16&C)){if(!(64&C)){P=R[(65535&P)+(v&(1<<C)-1)];continue e}if(32&C){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}D=65535&P,(C&=15)&&(A<C&&(v+=_[c++]<<A,A+=8),D+=v&(1<<C)-1,v>>>=C,A-=C),A<15&&(v+=_[c++]<<A,A+=8,v+=_[c++]<<A,A+=8),P=M[v&I];n:for(;;){if(v>>>=C=P>>>24,A-=C,!(16&(C=P>>>16&255))){if(!(64&C)){P=M[(65535&P)+(v&(1<<C)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(G=65535&P,A<(C&=15)&&(v+=_[c++]<<A,(A+=8)<C&&(v+=_[c++]<<A,A+=8)),h<(G+=v&(1<<C)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(v>>>=C,A-=C,(C=u-f)<G){if(p<(C=G-C)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(T=b,(U=0)===w){if(U+=m-C,C<D){for(D-=C;N[u++]=b[U++],--C;);U=u-G,T=N}}else if(w<C){if(U+=m+w-C,(C-=w)<D){for(D-=C;N[u++]=b[U++],--C;);if(U=0,w<D){for(D-=C=w;N[u++]=b[U++],--C;);U=u-G,T=N}}}else if(U+=w-C,C<D){for(D-=C;N[u++]=b[U++],--C;);U=u-G,T=N}for(;2<D;)N[u++]=T[U++],N[u++]=T[U++],N[u++]=T[U++],D-=3;D&&(N[u++]=T[U++],1<D&&(N[u++]=T[U++]))}else{for(U=u-G;N[u++]=N[U++],N[u++]=N[U++],N[u++]=N[U++],2<(D-=3););D&&(N[u++]=N[U++],1<D&&(N[u++]=N[U++]))}break}}break}}while(c<l&&u<d);c-=D=A>>3,v&=(1<<(A-=D<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=v,a.bits=A}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,m=1,p=852,w=592;function b(U){return(U>>>24&255)+(U>>>8&65280)+((65280&U)<<8)+((255&U)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(U){var T;return U&&U.state?(T=U.state,U.total_in=U.total_out=T.total=0,U.msg="",T.wrap&&(U.adler=1&T.wrap),T.mode=m,T.last=0,T.havedict=0,T.dmax=32768,T.head=null,T.hold=0,T.bits=0,T.lencode=T.lendyn=new s.Buf32(p),T.distcode=T.distdyn=new s.Buf32(w),T.sane=1,T.back=-1,d):h}function R(U){var T;return U&&U.state?((T=U.state).wsize=0,T.whave=0,T.wnext=0,A(U)):h}function M(U,T){var _,N;return U&&U.state?(N=U.state,T<0?(_=0,T=-T):(_=1+(T>>4),T<48&&(T&=15)),T&&(T<8||15<T)?h:(N.window!==null&&N.wbits!==T&&(N.window=null),N.wrap=_,N.wbits=T,R(U))):h}function S(U,T){var _,N;return U?(N=new v,(U.state=N).window=null,(_=M(U,T))!==d&&(U.state=null),_):h}var I,P,C=!0;function D(U){if(C){var T;for(I=new s.Buf32(512),P=new s.Buf32(32),T=0;T<144;)U.lens[T++]=8;for(;T<256;)U.lens[T++]=9;for(;T<280;)U.lens[T++]=7;for(;T<288;)U.lens[T++]=8;for(l(u,U.lens,0,288,I,0,U.work,{bits:9}),T=0;T<32;)U.lens[T++]=5;l(f,U.lens,0,32,P,0,U.work,{bits:5}),C=!1}U.lencode=I,U.lenbits=9,U.distcode=P,U.distbits=5}function G(U,T,_,N){var V,B=U.state;return B.window===null&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new s.Buf8(B.wsize)),N>=B.wsize?(s.arraySet(B.window,T,_-B.wsize,B.wsize,0),B.wnext=0,B.whave=B.wsize):(N<(V=B.wsize-B.wnext)&&(V=N),s.arraySet(B.window,T,_-N,V,B.wnext),(N-=V)?(s.arraySet(B.window,T,_-N,N,0),B.wnext=N,B.whave=B.wsize):(B.wnext+=V,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=V))),0}i.inflateReset=R,i.inflateReset2=M,i.inflateResetKeep=A,i.inflateInit=function(U){return S(U,15)},i.inflateInit2=S,i.inflate=function(U,T){var _,N,V,B,at,Z,lt,X,W,kt,ct,ht,zt,oe,$t,Pt,ce,Xt,Se,Be,k,st,nt,$,F=0,Y=new s.Buf8(4),ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!U||!U.state||!U.output||!U.input&&U.avail_in!==0)return h;(_=U.state).mode===12&&(_.mode=13),at=U.next_out,V=U.output,lt=U.avail_out,B=U.next_in,N=U.input,Z=U.avail_in,X=_.hold,W=_.bits,kt=Z,ct=lt,st=d;t:for(;;)switch(_.mode){case m:if(_.wrap===0){_.mode=13;break}for(;W<16;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}if(2&_.wrap&&X===35615){Y[_.check=0]=255&X,Y[1]=X>>>8&255,_.check=a(_.check,Y,2,0),W=X=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&X)<<8)+(X>>8))%31){U.msg="incorrect header check",_.mode=30;break}if((15&X)!=8){U.msg="unknown compression method",_.mode=30;break}if(W-=4,k=8+(15&(X>>>=4)),_.wbits===0)_.wbits=k;else if(k>_.wbits){U.msg="invalid window size",_.mode=30;break}_.dmax=1<<k,U.adler=_.check=1,_.mode=512&X?10:12,W=X=0;break;case 2:for(;W<16;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}if(_.flags=X,(255&_.flags)!=8){U.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){U.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=X>>8&1),512&_.flags&&(Y[0]=255&X,Y[1]=X>>>8&255,_.check=a(_.check,Y,2,0)),W=X=0,_.mode=3;case 3:for(;W<32;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}_.head&&(_.head.time=X),512&_.flags&&(Y[0]=255&X,Y[1]=X>>>8&255,Y[2]=X>>>16&255,Y[3]=X>>>24&255,_.check=a(_.check,Y,4,0)),W=X=0,_.mode=4;case 4:for(;W<16;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}_.head&&(_.head.xflags=255&X,_.head.os=X>>8),512&_.flags&&(Y[0]=255&X,Y[1]=X>>>8&255,_.check=a(_.check,Y,2,0)),W=X=0,_.mode=5;case 5:if(1024&_.flags){for(;W<16;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}_.length=X,_.head&&(_.head.extra_len=X),512&_.flags&&(Y[0]=255&X,Y[1]=X>>>8&255,_.check=a(_.check,Y,2,0)),W=X=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(Z<(ht=_.length)&&(ht=Z),ht&&(_.head&&(k=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),s.arraySet(_.head.extra,N,B,ht,k)),512&_.flags&&(_.check=a(_.check,N,ht,B)),Z-=ht,B+=ht,_.length-=ht),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(Z===0)break t;for(ht=0;k=N[B+ht++],_.head&&k&&_.length<65536&&(_.head.name+=String.fromCharCode(k)),k&&ht<Z;);if(512&_.flags&&(_.check=a(_.check,N,ht,B)),Z-=ht,B+=ht,k)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(Z===0)break t;for(ht=0;k=N[B+ht++],_.head&&k&&_.length<65536&&(_.head.comment+=String.fromCharCode(k)),k&&ht<Z;);if(512&_.flags&&(_.check=a(_.check,N,ht,B)),Z-=ht,B+=ht,k)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;W<16;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}if(X!==(65535&_.check)){U.msg="header crc mismatch",_.mode=30;break}W=X=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),U.adler=_.check=0,_.mode=12;break;case 10:for(;W<32;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}U.adler=_.check=b(X),W=X=0,_.mode=11;case 11:if(_.havedict===0)return U.next_out=at,U.avail_out=lt,U.next_in=B,U.avail_in=Z,_.hold=X,_.bits=W,2;U.adler=_.check=1,_.mode=12;case 12:if(T===5||T===6)break t;case 13:if(_.last){X>>>=7&W,W-=7&W,_.mode=27;break}for(;W<3;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}switch(_.last=1&X,W-=1,3&(X>>>=1)){case 0:_.mode=14;break;case 1:if(D(_),_.mode=20,T!==6)break;X>>>=2,W-=2;break t;case 2:_.mode=17;break;case 3:U.msg="invalid block type",_.mode=30}X>>>=2,W-=2;break;case 14:for(X>>>=7&W,W-=7&W;W<32;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}if((65535&X)!=(X>>>16^65535)){U.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&X,W=X=0,_.mode=15,T===6)break t;case 15:_.mode=16;case 16:if(ht=_.length){if(Z<ht&&(ht=Z),lt<ht&&(ht=lt),ht===0)break t;s.arraySet(V,N,B,ht,at),Z-=ht,B+=ht,lt-=ht,at+=ht,_.length-=ht;break}_.mode=12;break;case 17:for(;W<14;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}if(_.nlen=257+(31&X),X>>>=5,W-=5,_.ndist=1+(31&X),X>>>=5,W-=5,_.ncode=4+(15&X),X>>>=4,W-=4,286<_.nlen||30<_.ndist){U.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;W<3;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}_.lens[ot[_.have++]]=7&X,X>>>=3,W-=3}for(;_.have<19;)_.lens[ot[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,nt={bits:_.lenbits},st=l(0,_.lens,0,19,_.lencode,0,_.work,nt),_.lenbits=nt.bits,st){U.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;Pt=(F=_.lencode[X&(1<<_.lenbits)-1])>>>16&255,ce=65535&F,!(($t=F>>>24)<=W);){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}if(ce<16)X>>>=$t,W-=$t,_.lens[_.have++]=ce;else{if(ce===16){for($=$t+2;W<$;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}if(X>>>=$t,W-=$t,_.have===0){U.msg="invalid bit length repeat",_.mode=30;break}k=_.lens[_.have-1],ht=3+(3&X),X>>>=2,W-=2}else if(ce===17){for($=$t+3;W<$;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}W-=$t,k=0,ht=3+(7&(X>>>=$t)),X>>>=3,W-=3}else{for($=$t+7;W<$;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}W-=$t,k=0,ht=11+(127&(X>>>=$t)),X>>>=7,W-=7}if(_.have+ht>_.nlen+_.ndist){U.msg="invalid bit length repeat",_.mode=30;break}for(;ht--;)_.lens[_.have++]=k}}if(_.mode===30)break;if(_.lens[256]===0){U.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,nt={bits:_.lenbits},st=l(u,_.lens,0,_.nlen,_.lencode,0,_.work,nt),_.lenbits=nt.bits,st){U.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,nt={bits:_.distbits},st=l(f,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,nt),_.distbits=nt.bits,st){U.msg="invalid distances set",_.mode=30;break}if(_.mode=20,T===6)break t;case 20:_.mode=21;case 21:if(6<=Z&&258<=lt){U.next_out=at,U.avail_out=lt,U.next_in=B,U.avail_in=Z,_.hold=X,_.bits=W,c(U,ct),at=U.next_out,V=U.output,lt=U.avail_out,B=U.next_in,N=U.input,Z=U.avail_in,X=_.hold,W=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;Pt=(F=_.lencode[X&(1<<_.lenbits)-1])>>>16&255,ce=65535&F,!(($t=F>>>24)<=W);){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}if(Pt&&!(240&Pt)){for(Xt=$t,Se=Pt,Be=ce;Pt=(F=_.lencode[Be+((X&(1<<Xt+Se)-1)>>Xt)])>>>16&255,ce=65535&F,!(Xt+($t=F>>>24)<=W);){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}X>>>=Xt,W-=Xt,_.back+=Xt}if(X>>>=$t,W-=$t,_.back+=$t,_.length=ce,Pt===0){_.mode=26;break}if(32&Pt){_.back=-1,_.mode=12;break}if(64&Pt){U.msg="invalid literal/length code",_.mode=30;break}_.extra=15&Pt,_.mode=22;case 22:if(_.extra){for($=_.extra;W<$;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}_.length+=X&(1<<_.extra)-1,X>>>=_.extra,W-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;Pt=(F=_.distcode[X&(1<<_.distbits)-1])>>>16&255,ce=65535&F,!(($t=F>>>24)<=W);){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}if(!(240&Pt)){for(Xt=$t,Se=Pt,Be=ce;Pt=(F=_.distcode[Be+((X&(1<<Xt+Se)-1)>>Xt)])>>>16&255,ce=65535&F,!(Xt+($t=F>>>24)<=W);){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}X>>>=Xt,W-=Xt,_.back+=Xt}if(X>>>=$t,W-=$t,_.back+=$t,64&Pt){U.msg="invalid distance code",_.mode=30;break}_.offset=ce,_.extra=15&Pt,_.mode=24;case 24:if(_.extra){for($=_.extra;W<$;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}_.offset+=X&(1<<_.extra)-1,X>>>=_.extra,W-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){U.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(lt===0)break t;if(ht=ct-lt,_.offset>ht){if((ht=_.offset-ht)>_.whave&&_.sane){U.msg="invalid distance too far back",_.mode=30;break}zt=ht>_.wnext?(ht-=_.wnext,_.wsize-ht):_.wnext-ht,ht>_.length&&(ht=_.length),oe=_.window}else oe=V,zt=at-_.offset,ht=_.length;for(lt<ht&&(ht=lt),lt-=ht,_.length-=ht;V[at++]=oe[zt++],--ht;);_.length===0&&(_.mode=21);break;case 26:if(lt===0)break t;V[at++]=_.length,lt--,_.mode=21;break;case 27:if(_.wrap){for(;W<32;){if(Z===0)break t;Z--,X|=N[B++]<<W,W+=8}if(ct-=lt,U.total_out+=ct,_.total+=ct,ct&&(U.adler=_.check=_.flags?a(_.check,V,ct,at-ct):o(_.check,V,ct,at-ct)),ct=lt,(_.flags?X:b(X))!==_.check){U.msg="incorrect data check",_.mode=30;break}W=X=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;W<32;){if(Z===0)break t;Z--,X+=N[B++]<<W,W+=8}if(X!==(4294967295&_.total)){U.msg="incorrect length check",_.mode=30;break}W=X=0}_.mode=29;case 29:st=1;break t;case 30:st=-3;break t;case 31:return-4;case 32:default:return h}return U.next_out=at,U.avail_out=lt,U.next_in=B,U.avail_in=Z,_.hold=X,_.bits=W,(_.wsize||ct!==U.avail_out&&_.mode<30&&(_.mode<27||T!==4))&&G(U,U.output,U.next_out,ct-U.avail_out)?(_.mode=31,-4):(kt-=U.avail_in,ct-=U.avail_out,U.total_in+=kt,U.total_out+=ct,_.total+=ct,_.wrap&&ct&&(U.adler=_.check=_.flags?a(_.check,V,ct,U.next_out-ct):o(_.check,V,ct,U.next_out-ct)),U.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(kt==0&&ct===0||T===4)&&st===d&&(st=-5),st)},i.inflateEnd=function(U){if(!U||!U.state)return h;var T=U.state;return T.window&&(T.window=null),U.state=null,d},i.inflateGetHeader=function(U,T){var _;return U&&U.state&&2&(_=U.state).wrap?((_.head=T).done=!1,d):h},i.inflateSetDictionary=function(U,T){var _,N=T.length;return U&&U.state?(_=U.state).wrap!==0&&_.mode!==11?h:_.mode===11&&o(1,T,N,0)!==_.check?-3:G(U,T,N,N)?(_.mode=31,-4):(_.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,m,p,w,b){var v,A,R,M,S,I,P,C,D,G=b.bits,U=0,T=0,_=0,N=0,V=0,B=0,at=0,Z=0,lt=0,X=0,W=null,kt=0,ct=new s.Buf16(16),ht=new s.Buf16(16),zt=null,oe=0;for(U=0;U<=15;U++)ct[U]=0;for(T=0;T<h;T++)ct[f[d+T]]++;for(V=G,N=15;1<=N&&ct[N]===0;N--);if(N<V&&(V=N),N===0)return m[p++]=20971520,m[p++]=20971520,b.bits=1,0;for(_=1;_<N&&ct[_]===0;_++);for(V<_&&(V=_),U=Z=1;U<=15;U++)if(Z<<=1,(Z-=ct[U])<0)return-1;if(0<Z&&(u===0||N!==1))return-1;for(ht[1]=0,U=1;U<15;U++)ht[U+1]=ht[U]+ct[U];for(T=0;T<h;T++)f[d+T]!==0&&(w[ht[f[d+T]]++]=T);if(I=u===0?(W=zt=w,19):u===1?(W=o,kt-=257,zt=a,oe-=257,256):(W=c,zt=l,-1),U=_,S=p,at=T=X=0,R=-1,M=(lt=1<<(B=V))-1,u===1&&852<lt||u===2&&592<lt)return 1;for(;;){for(P=U-at,D=w[T]<I?(C=0,w[T]):w[T]>I?(C=zt[oe+w[T]],W[kt+w[T]]):(C=96,0),v=1<<U-at,_=A=1<<B;m[S+(X>>at)+(A-=v)]=P<<24|C<<16|D|0,A!==0;);for(v=1<<U-1;X&v;)v>>=1;if(v!==0?(X&=v-1,X+=v):X=0,T++,--ct[U]==0){if(U===N)break;U=f[d+w[T]]}if(V<U&&(X&M)!==R){for(at===0&&(at=V),S+=_,Z=1<<(B=U-at);B+at<N&&!((Z-=ct[B+at])<=0);)B++,Z<<=1;if(lt+=1<<B,u===1&&852<lt||u===2&&592<lt)return 1;m[R=X&M]=V<<24|B<<16|S-p|0}}return X!==0&&(m[S+X]=U-at<<24|64<<16|0),b.bits=V,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(F){for(var Y=F.length;0<=--Y;)F[Y]=0}var l=0,u=29,f=256,d=f+1+u,h=30,m=19,p=2*d+1,w=15,b=16,v=7,A=256,R=16,M=17,S=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(d+2));c(G);var U=new Array(2*h);c(U);var T=new Array(512);c(T);var _=new Array(256);c(_);var N=new Array(u);c(N);var V,B,at,Z=new Array(h);function lt(F,Y,ot,ft,Q){this.static_tree=F,this.extra_bits=Y,this.extra_base=ot,this.elems=ft,this.max_length=Q,this.has_stree=F&&F.length}function X(F,Y){this.dyn_tree=F,this.max_code=0,this.stat_desc=Y}function W(F){return F<256?T[F]:T[256+(F>>>7)]}function kt(F,Y){F.pending_buf[F.pending++]=255&Y,F.pending_buf[F.pending++]=Y>>>8&255}function ct(F,Y,ot){F.bi_valid>b-ot?(F.bi_buf|=Y<<F.bi_valid&65535,kt(F,F.bi_buf),F.bi_buf=Y>>b-F.bi_valid,F.bi_valid+=ot-b):(F.bi_buf|=Y<<F.bi_valid&65535,F.bi_valid+=ot)}function ht(F,Y,ot){ct(F,ot[2*Y],ot[2*Y+1])}function zt(F,Y){for(var ot=0;ot|=1&F,F>>>=1,ot<<=1,0<--Y;);return ot>>>1}function oe(F,Y,ot){var ft,Q,gt=new Array(w+1),Et=0;for(ft=1;ft<=w;ft++)gt[ft]=Et=Et+ot[ft-1]<<1;for(Q=0;Q<=Y;Q++){var mt=F[2*Q+1];mt!==0&&(F[2*Q]=zt(gt[mt]++,mt))}}function $t(F){var Y;for(Y=0;Y<d;Y++)F.dyn_ltree[2*Y]=0;for(Y=0;Y<h;Y++)F.dyn_dtree[2*Y]=0;for(Y=0;Y<m;Y++)F.bl_tree[2*Y]=0;F.dyn_ltree[2*A]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function Pt(F){8<F.bi_valid?kt(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function ce(F,Y,ot,ft){var Q=2*Y,gt=2*ot;return F[Q]<F[gt]||F[Q]===F[gt]&&ft[Y]<=ft[ot]}function Xt(F,Y,ot){for(var ft=F.heap[ot],Q=ot<<1;Q<=F.heap_len&&(Q<F.heap_len&&ce(Y,F.heap[Q+1],F.heap[Q],F.depth)&&Q++,!ce(Y,ft,F.heap[Q],F.depth));)F.heap[ot]=F.heap[Q],ot=Q,Q<<=1;F.heap[ot]=ft}function Se(F,Y,ot){var ft,Q,gt,Et,mt=0;if(F.last_lit!==0)for(;ft=F.pending_buf[F.d_buf+2*mt]<<8|F.pending_buf[F.d_buf+2*mt+1],Q=F.pending_buf[F.l_buf+mt],mt++,ft===0?ht(F,Q,Y):(ht(F,(gt=_[Q])+f+1,Y),(Et=I[gt])!==0&&ct(F,Q-=N[gt],Et),ht(F,gt=W(--ft),ot),(Et=P[gt])!==0&&ct(F,ft-=Z[gt],Et)),mt<F.last_lit;);ht(F,A,Y)}function Be(F,Y){var ot,ft,Q,gt=Y.dyn_tree,Et=Y.stat_desc.static_tree,mt=Y.stat_desc.has_stree,Nt=Y.stat_desc.elems,he=-1;for(F.heap_len=0,F.heap_max=p,ot=0;ot<Nt;ot++)gt[2*ot]!==0?(F.heap[++F.heap_len]=he=ot,F.depth[ot]=0):gt[2*ot+1]=0;for(;F.heap_len<2;)gt[2*(Q=F.heap[++F.heap_len]=he<2?++he:0)]=1,F.depth[Q]=0,F.opt_len--,mt&&(F.static_len-=Et[2*Q+1]);for(Y.max_code=he,ot=F.heap_len>>1;1<=ot;ot--)Xt(F,gt,ot);for(Q=Nt;ot=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Xt(F,gt,1),ft=F.heap[1],F.heap[--F.heap_max]=ot,F.heap[--F.heap_max]=ft,gt[2*Q]=gt[2*ot]+gt[2*ft],F.depth[Q]=(F.depth[ot]>=F.depth[ft]?F.depth[ot]:F.depth[ft])+1,gt[2*ot+1]=gt[2*ft+1]=Q,F.heap[1]=Q++,Xt(F,gt,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function(Dt,Yn){var O,g,y,L,j,tt,it=Yn.dyn_tree,Wt=Yn.max_code,Oe=Yn.stat_desc.static_tree,we=Yn.stat_desc.has_stree,Ie=Yn.stat_desc.extra_bits,ue=Yn.stat_desc.extra_base,ja=Yn.stat_desc.max_length,eu=0;for(L=0;L<=w;L++)Dt.bl_count[L]=0;for(it[2*Dt.heap[Dt.heap_max]+1]=0,O=Dt.heap_max+1;O<p;O++)ja<(L=it[2*it[2*(g=Dt.heap[O])+1]+1]+1)&&(L=ja,eu++),it[2*g+1]=L,Wt<g||(Dt.bl_count[L]++,j=0,ue<=g&&(j=Ie[g-ue]),tt=it[2*g],Dt.opt_len+=tt*(L+j),we&&(Dt.static_len+=tt*(Oe[2*g+1]+j)));if(eu!==0){do{for(L=ja-1;Dt.bl_count[L]===0;)L--;Dt.bl_count[L]--,Dt.bl_count[L+1]+=2,Dt.bl_count[ja]--,eu-=2}while(0<eu);for(L=ja;L!==0;L--)for(g=Dt.bl_count[L];g!==0;)Wt<(y=Dt.heap[--O])||(it[2*y+1]!==L&&(Dt.opt_len+=(L-it[2*y+1])*it[2*y],it[2*y+1]=L),g--)}}(F,Y),oe(gt,he,F.bl_count)}function k(F,Y,ot){var ft,Q,gt=-1,Et=Y[1],mt=0,Nt=7,he=4;for(Et===0&&(Nt=138,he=3),Y[2*(ot+1)+1]=65535,ft=0;ft<=ot;ft++)Q=Et,Et=Y[2*(ft+1)+1],++mt<Nt&&Q===Et||(mt<he?F.bl_tree[2*Q]+=mt:Q!==0?(Q!==gt&&F.bl_tree[2*Q]++,F.bl_tree[2*R]++):mt<=10?F.bl_tree[2*M]++:F.bl_tree[2*S]++,gt=Q,he=(mt=0)===Et?(Nt=138,3):Q===Et?(Nt=6,3):(Nt=7,4))}function st(F,Y,ot){var ft,Q,gt=-1,Et=Y[1],mt=0,Nt=7,he=4;for(Et===0&&(Nt=138,he=3),ft=0;ft<=ot;ft++)if(Q=Et,Et=Y[2*(ft+1)+1],!(++mt<Nt&&Q===Et)){if(mt<he)for(;ht(F,Q,F.bl_tree),--mt!=0;);else Q!==0?(Q!==gt&&(ht(F,Q,F.bl_tree),mt--),ht(F,R,F.bl_tree),ct(F,mt-3,2)):mt<=10?(ht(F,M,F.bl_tree),ct(F,mt-3,3)):(ht(F,S,F.bl_tree),ct(F,mt-11,7));gt=Q,he=(mt=0)===Et?(Nt=138,3):Q===Et?(Nt=6,3):(Nt=7,4)}}c(Z);var nt=!1;function $(F,Y,ot,ft){ct(F,(l<<1)+(ft?1:0),3),function(Q,gt,Et,mt){Pt(Q),kt(Q,Et),kt(Q,~Et),s.arraySet(Q.pending_buf,Q.window,gt,Et,Q.pending),Q.pending+=Et}(F,Y,ot)}i._tr_init=function(F){nt||(function(){var Y,ot,ft,Q,gt,Et=new Array(w+1);for(Q=ft=0;Q<u-1;Q++)for(N[Q]=ft,Y=0;Y<1<<I[Q];Y++)_[ft++]=Q;for(_[ft-1]=Q,Q=gt=0;Q<16;Q++)for(Z[Q]=gt,Y=0;Y<1<<P[Q];Y++)T[gt++]=Q;for(gt>>=7;Q<h;Q++)for(Z[Q]=gt<<7,Y=0;Y<1<<P[Q]-7;Y++)T[256+gt++]=Q;for(ot=0;ot<=w;ot++)Et[ot]=0;for(Y=0;Y<=143;)G[2*Y+1]=8,Y++,Et[8]++;for(;Y<=255;)G[2*Y+1]=9,Y++,Et[9]++;for(;Y<=279;)G[2*Y+1]=7,Y++,Et[7]++;for(;Y<=287;)G[2*Y+1]=8,Y++,Et[8]++;for(oe(G,d+1,Et),Y=0;Y<h;Y++)U[2*Y+1]=5,U[2*Y]=zt(Y,5);V=new lt(G,I,f+1,d,w),B=new lt(U,P,0,h,w),at=new lt(new Array(0),C,0,m,v)}(),nt=!0),F.l_desc=new X(F.dyn_ltree,V),F.d_desc=new X(F.dyn_dtree,B),F.bl_desc=new X(F.bl_tree,at),F.bi_buf=0,F.bi_valid=0,$t(F)},i._tr_stored_block=$,i._tr_flush_block=function(F,Y,ot,ft){var Q,gt,Et=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(mt){var Nt,he=4093624447;for(Nt=0;Nt<=31;Nt++,he>>>=1)if(1&he&&mt.dyn_ltree[2*Nt]!==0)return o;if(mt.dyn_ltree[18]!==0||mt.dyn_ltree[20]!==0||mt.dyn_ltree[26]!==0)return a;for(Nt=32;Nt<f;Nt++)if(mt.dyn_ltree[2*Nt]!==0)return a;return o}(F)),Be(F,F.l_desc),Be(F,F.d_desc),Et=function(mt){var Nt;for(k(mt,mt.dyn_ltree,mt.l_desc.max_code),k(mt,mt.dyn_dtree,mt.d_desc.max_code),Be(mt,mt.bl_desc),Nt=m-1;3<=Nt&&mt.bl_tree[2*D[Nt]+1]===0;Nt--);return mt.opt_len+=3*(Nt+1)+5+5+4,Nt}(F),Q=F.opt_len+3+7>>>3,(gt=F.static_len+3+7>>>3)<=Q&&(Q=gt)):Q=gt=ot+5,ot+4<=Q&&Y!==-1?$(F,Y,ot,ft):F.strategy===4||gt===Q?(ct(F,2+(ft?1:0),3),Se(F,G,U)):(ct(F,4+(ft?1:0),3),function(mt,Nt,he,Dt){var Yn;for(ct(mt,Nt-257,5),ct(mt,he-1,5),ct(mt,Dt-4,4),Yn=0;Yn<Dt;Yn++)ct(mt,mt.bl_tree[2*D[Yn]+1],3);st(mt,mt.dyn_ltree,Nt-1),st(mt,mt.dyn_dtree,he-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,Et+1),Se(F,F.dyn_ltree,F.dyn_dtree)),$t(F),ft&&Pt(F)},i._tr_tally=function(F,Y,ot){return F.pending_buf[F.d_buf+2*F.last_lit]=Y>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&Y,F.pending_buf[F.l_buf+F.last_lit]=255&ot,F.last_lit++,Y===0?F.dyn_ltree[2*ot]++:(F.matches++,Y--,F.dyn_ltree[2*(_[ot]+f+1)]++,F.dyn_dtree[2*W(Y)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){ct(F,2,3),ht(F,A,G),function(Y){Y.bi_valid===16?(kt(Y,Y.bi_buf),Y.bi_buf=0,Y.bi_valid=0):8<=Y.bi_valid&&(Y.pending_buf[Y.pending++]=255&Y.bi_buf,Y.bi_buf>>=8,Y.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},m=!1,p=o.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(o);w=w&&w.setTimeout?w:o,c={}.toString.call(o.process)==="[object process]"?function(R){Er.nextTick(function(){v(R)})}:function(){if(o.postMessage&&!o.importScripts){var R=!0,M=o.onmessage;return o.onmessage=function(){R=!1},o.postMessage("","*"),o.onmessage=M,R}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(R){o.postMessage(f+R,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(R){v(R.data)},function(R){u.port2.postMessage(R)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(R){var M=p.createElement("script");M.onreadystatechange=function(){v(R),M.onreadystatechange=null,l.removeChild(M),M=null},l.appendChild(M)}):function(R){setTimeout(v,0,R)},w.setImmediate=function(R){typeof R!="function"&&(R=new Function(""+R));for(var M=new Array(arguments.length-1),S=0;S<M.length;S++)M[S]=arguments[S+1];var I={callback:R,args:M};return h[d]=I,c(d),d++},w.clearImmediate=b}function b(R){delete h[R]}function v(R){if(m)setTimeout(v,0,R);else{var M=h[R];if(M){m=!0;try{(function(S){var I=S.callback,P=S.args;switch(P.length){case 0:I();break;case 1:I(P[0]);break;case 2:I(P[0],P[1]);break;case 3:I(P[0],P[1],P[2]);break;default:I.apply(a,P)}})(M)}finally{b(R),m=!1}}}}function A(R){R.source===o&&typeof R.data=="string"&&R.data.indexOf(f)===0&&v(+R.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof In<"u"?In:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(I1);var HF=I1.exports,Sd=Ls(HF);const N1={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(N1);var br=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},Io,$a,Cs;class YF{constructor(...t){Io.set(this,new Map),$a.set(this,new Map),Cs.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),br(this,Cs,"f").has(r)||br(this,Cs,"f").set(r,new Set);const s=br(this,Cs,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&br(this,$a,"f").set(r,a),o=!1,c)continue;const l=br(this,Io,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);br(this,Io,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:br(this,Io,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&br(this,$a,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:br(this,Cs,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of br(this,Cs,"f").values())Object.freeze(t);return this}_getTestState(){return{types:br(this,Io,"f"),extensions:br(this,$a,"f")}}}Io=new WeakMap,$a=new WeakMap,Cs=new WeakMap;var VF=new YF(N1)._freeze();function XF(e,t){console.info(t)}function qF(e,t){console.info(t)}function JF(e,t){let n=0;const r=new DataView(t.buffer);function i(){const D=r.getUint8(n);return n++,D}function s(){const D=r.getInt16(n,!0);return n+=2,D}function o(){const D=r.getInt32(n,!0);return n+=4,D}function a(D){let G="";const U=t.subarray(n,n+D);for(let T=0;T<U.length;++T)G+=String.fromCharCode(U[T]);return n+=D,G.replace("\r",`
`)}if(s()!=-1)return;const l=s(),u=s(),f=s(),d=a(7),h=s(),m=s(),p=s(),w=s(),b=s();s();const v=s(),A=i(),R=a(20).slice(0,A);for(let D=0;D<9;D++){const G=i();a(20).slice(0,G)}const M=s(),S=s(),I=i();console.info(u,f,d,h,m,p,w,b,v,M,S,I),n=512;const P=[];for(let D=0;D<l;++D){const G=s(),U=n,T=i(),N={boardname:a(50).slice(0,T),elements:[],stats:[]};for(;N.elements.length<1500;){let B=i();B===0&&(B=255);const at=i(),Z=i();for(let lt=0;lt<B;++lt)N.elements.push({element:at,color:Z})}N.maxplayershots=i(),N.isdark=i(),N.exitnorth=i(),N.exitsouth=i(),N.exitwest=i(),N.exiteast=i(),N.restartonzap=i(),N.messagelength=i(),N.message=a(58).slice(0,N.messagelength),N.playerenterx=i(),N.playerentery=i(),N.timelimit=s(),n+=16;const V=s();for(;N.stats.length<V;){const B={};B.x=i(),B.y=i(),B.stepx=s(),B.stepy=s(),B.cycle=s(),B.p1=i(),B.p2=i(),B.p3=i(),B.follower=s(),B.leader=s(),B.underelement=i(),B.undercolor=i(),B.pointer=o(),B.currentinstruction=s();const at=s();n+=8,at<0?B.bind=Math.abs(at):B.code=a(at),N.stats.push(B)}P.push(N),n=U+G}const C=Xf([]);C.name=R;for(let D=0;D<P.length;++D){const G=P[D],U=ob(`@board ${D===m?"title":G.boardname}`,{});Zf(C,U);const T=Ae(U);if(!E(T))continue;let _=0,N=0;for(let V=0;V<G.elements.length;++V){const B=G.elements[V];switch(B.element){case 0:case 1:case 2:case 3:case 4:break;case 5:Rt(T,["ammo",[dt[B.color]]],{x:_,y:N});break;case 6:Rt(T,["torch",[dt[B.color]]],{x:_,y:N});break;case 7:Rt(T,["gem",[dt[B.color]]],{x:_,y:N});break;case 8:Rt(T,["key",[dt[B.color]]],{x:_,y:N});break;case 9:Rt(T,["door",[dt[B.color]]],{x:_,y:N});break;case 10:Rt(T,["scroll",[dt[B.color]]],{x:_,y:N});break;case 11:Rt(T,["passage",[dt[B.color]]],{x:_,y:N});break;case 12:Rt(T,["duplicator",[dt[B.color]]],{x:_,y:N});break;case 13:Rt(T,["bomb",[dt[B.color]]],{x:_,y:N});break;case 14:Rt(T,["energize",[dt[B.color]]],{x:_,y:N});break;case 15:Rt(T,["star",[dt[B.color]]],{x:_,y:N});break;case 16:Rt(T,["clockwise",[dt[B.color]]],{x:_,y:N});break;case 17:Rt(T,["counter",[dt[B.color]]],{x:_,y:N});break;case 18:Rt(T,["bullet",[dt[B.color]]],{x:_,y:N});break;case 19:Rt(T,["water",[dt[B.color]]],{x:_,y:N});break;case 20:Rt(T,["forest",[dt[B.color]]],{x:_,y:N});break;case 21:Rt(T,["solid",[dt[B.color]]],{x:_,y:N});break;case 22:Rt(T,["normal",[dt[B.color]]],{x:_,y:N});break;case 23:Rt(T,["breakable",[dt[B.color]]],{x:_,y:N});break;case 24:Rt(T,["boulder",[dt[B.color]]],{x:_,y:N});break;case 25:Rt(T,["sliderns",[dt[B.color]]],{x:_,y:N});break;case 26:Rt(T,["sliderew",[dt[B.color]]],{x:_,y:N});break;case 27:Rt(T,["fake",[dt[B.color]]],{x:_,y:N});break;case 28:Rt(T,["invisible",[dt[B.color]]],{x:_,y:N});break;case 29:Rt(T,["blinkwall",[dt[B.color]]],{x:_,y:N});break;case 30:Rt(T,["transporter",[dt[B.color]]],{x:_,y:N});break;case 31:Rt(T,["line",[dt[B.color]]],{x:_,y:N});break;case 32:Rt(T,["ricochet",[dt[B.color]]],{x:_,y:N});break;case 33:Rt(T,["blinkns",[dt[B.color]]],{x:_,y:N});break;case 34:Rt(T,["bear",[dt[B.color]]],{x:_,y:N});break;case 35:Rt(T,["ruffian",[dt[B.color]]],{x:_,y:N});break;case 36:Rt(T,["object",[dt[B.color]]],{x:_,y:N});break;case 37:Rt(T,["slime",[dt[B.color]]],{x:_,y:N});break;case 38:Rt(T,["shark",[dt[B.color]]],{x:_,y:N});break;case 39:Rt(T,["spinninggun",[dt[B.color]]],{x:_,y:N});break;case 40:Rt(T,["pusher",[dt[B.color]]],{x:_,y:N});break;case 41:Rt(T,["lion",[dt[B.color]]],{x:_,y:N});break;case 42:Rt(T,["tiger",[dt[B.color]]],{x:_,y:N});break;case 43:Rt(T,["blinkns",[dt[B.color]]],{x:_,y:N});break;case 44:Rt(T,["head",[dt[B.color]]],{x:_,y:N});break;case 45:Rt(T,["segment",[dt[B.color]]],{x:_,y:N});break;case 46:break;case 47:Rt(T,["ammo",["BLUE"]],{x:_,y:N});break;case 48:Rt(T,["ammo",["GREEN"]],{x:_,y:N});break;case 49:Rt(T,["ammo",["CYAN"]],{x:_,y:N});break;case 50:Rt(T,["ammo",["RED"]],{x:_,y:N});break;case 51:Rt(T,["ammo",["PURPLE"]],{x:_,y:N});break;case 52:Rt(T,["ammo",["DKYELLOW"]],{x:_,y:N});break;case 53:Rt(T,["ammo",["BLACK"]],{x:_,y:N});break}++_,_===60&&(_=0,++N)}}Kl(C),Vd(et,e,`imported zzt file into ${C.name} book`)}function C1(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return VF.getType(e)??"application/octet-stream"}async function ZF(e,t,n){try{xe(et,e,"parsezipfile",t.name);const r=await t.arrayBuffer();(await new Sd().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=C1(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{fe(et,e,"crash",c.message)})})}catch(r){fe(et,e,"crash",r.message)}}function L1(e,t,n){if(E(n))switch(t){case"text/plain":n.text().then(r=>mu(et,e,void 0,"text",`file:${n.name}`,r)).catch(r=>fe(et,e,"crash",r.message));break;case"application/json":n.text().then(r=>mu(et,e,void 0,"json",`file:${n.name}`,r)).catch(r=>fe(et,e,"crash",r.message));break;case"application/zip":ZF(e,n,r=>M1(e,r)).catch(r=>fe(et,e,"crash",r.message));break;case"application/octet-stream":/.zzt$/i.test(n.name)&&n.arrayBuffer().then(r=>{JF(e,new Uint8Array(r))}).catch(r=>fe(et,e,"crash",r.message)),/.zzl$/i.test(n.name)&&n.text().then(r=>{XF(e,r)}).catch(r=>fe(et,e,"crash",r.message)),/.zzm$/i.test(n.name)&&n.text().then(r=>{qF(e,r)}).catch(r=>fe(et,e,"crash",r.message));break;default:n.arrayBuffer().then(r=>{const i=C1(n.name,new Uint8Array(r));if(i)L1(e,i,n);else return fe(et,e,"parsewebfile",`unsupported file ${n.name}`)}).catch(r=>fe(et,e,"crash",r.message));return}}function M1(e,t){L1(e,(t==null?void 0:t.type)??"",t)}function Ci(e,t,n){n().catch(r=>{console.error(r),fe(e,t,"crash",r==null?void 0:r.message)})}function QF(e){const[t,n]=e.split(":"),r=E(n);return[r?t:"self",r?n:e]}function tP(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function eP(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const nP=new Date("1980/09/02");async function Od(e){return console.info("saved",e),new Promise((t,n)=>{const r=new Sd;for(let i=0;i<e.length;++i){const s=e[i],o=c6(s);if(o){const a=rT(o);E(a)&&r.file(s.id,a,{date:nP})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(eP(i))}).catch(n)})}async function rP(e){return new Promise((t,n)=>{const r=new Sd;r.loadAsync(tP(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=l6(iT(c));E(l)&&i.push(l)}t(i)}).catch(n)})}function Ql(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function iP(e,t,n,r){const i=mn(e);if(!E(i))return;let s=0;function o(){return s}function a(l,u){Tt(u)&&(s=u,qp(t.x,t.y,n.x,n.y).forEach(f=>{const d=ee(i,f);E(d)&&(d[l]=u)}))}It(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),It(e,en),Ft(e,`batch:${Ql(t,n)}`,"char",[r,"charedit"],o,a);const c=Ye(e);c.scroll=On(e)}function sP(e,t,n,r){const i=mn(e);if(!E(i))return;let s=0;function o(){return s}function a(l,u){if(Tt(u)){s=u;for(let f=t.y;f<=n.y;++f)for(let d=t.x;d<=n.x;++d){const h=ee(i,{x:d,y:f});E(h)&&(h[l]=u)}}}It(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),It(e,en),Ft(e,`batch:${Ql(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ye(e);c.scroll=On(e)}function oP(e,t,n,r){const i=mn(e);if(!E(i))return;let s=0;function o(){return s}function a(l,u){Tt(u)&&(s=u,qp(t.x,t.y,n.x,n.y).forEach(f=>{const d=ee(i,f);E(d)&&(d[l]=u)}))}It(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),It(e,en),Ft(e,`batch:${Ql(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ye(e);c.scroll=On(e)}const Da={stat:"",patternsize:2,mirror:1};function aP(e,t,n,r){const i=ln(Bt.MAIN);if(!E(i))return;const s=mn(e);if(!E(s))return;const o=Ql(t,n);It(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),It(e,en),Ft(e,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),Ft(e,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),r&&Ft(e,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),Ft(e,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]);function a(m){const{target:p}=Xn(m);return Da[p]}function c(m,p){if(Tt(p)||_t(p)){const{target:w}=Xn(m);Da[w]=p}}Ft(e,"batch","remix",[`stat:${o}`,"text"],a,c),Ft(e,"batch","patternsize",[`patternsize:${o}`,"number","1","5"],a,c),Ft(e,"batch","mirror",[`mirror:${o}`,"number","1","8"],a,c),Ft(e,"batch","run",[`remixrun:${o}`,"hk","r"," R "]),It(e,en),Ft(e,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),Ft(e,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),Ft(e,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),It(e,en),Ft(e,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),It(e,en),It(e,"codepages:"),Ft(e,"batch","edit @board codepage",[`pageopen:${s.id}`]);const l=Math.min(t.x,n.x),u=Math.min(t.y,n.y),f=Math.max(t.x,n.x),d=Math.max(t.y,n.y),h=new Set;for(let m=u;m<=d;++m)for(let p=l;p<=f;++p){const w=ee(s,{x:p,y:m}),b=ub(i,w);E(b)&&!h.has(b.id)&&(h.add(b.id),Ft(e,"batch",`edit @${Le(b)}`,[`pageopen:${b.id}`]))}}function Id(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function cP(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=Id(n);return(i,s)=>r.then(o=>s(o.transaction(t,i).objectStore(t)))}let Nd;function U1(){return Nd||(Nd=cP("keyval-store","keyval")),Nd}function lP(e,t=U1()){return t("readonly",n=>Id(n.get(e)))}function uP(e,t,n=U1()){return n("readwrite",r=>new Promise((i,s)=>{r.get(e).onsuccess=function(){try{r.put(t(this.result),e),i(Id(r.transaction))}catch(o){s(o)}}}))}function Cd(e,t){return`${e.x},${e.y},${t.x},${t.y}`}async function F1(){return lP("secretheap")}async function P1(e){return uP("secretheap",e)}async function hP(){return!!await F1()}function B1(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},m=ee(e,{x:d,y:f});(m==null?void 0:m.category)===Ln.ISOBJECT?(l.push(wr(es(e,d,f))),Jr(m)!=="player"&&u.push({...wr(m),...h,id:"blank"})):l.push({...wr(m),...h})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}async function fP(e,t,n,r){const i=mn(e);if(!E(i))return;const s=B1(i,t,n);switch(r){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await P1(()=>s)}function dP(e,t,n){const r=Cd(t,n);It(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),It(e,en),Ft(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Ft(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Ft(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=Ye(e);i.scroll=On(e)}async function pP(e,t,n,r){const i=ln(Bt.MAIN);if(!E(i))return;const s=mn(e);if(!E(s))return;const o=B1(s,t,n);switch(r){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(r){case"cutall":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=ee(s,{x:c,y:a});(l==null?void 0:l.category)===Ln.ISOBJECT&&wn(s,l,i.timestamp),Re(s,{x:c,y:a})}break}case"cutobjects":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=ee(s,{x:c,y:a});(l==null?void 0:l.category)===Ln.ISOBJECT&&wn(s,l,i.timestamp)}break}case"cutterrain":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c)Re(s,{x:c,y:a});break}}await P1(()=>o)}function mP(e,t,n){const r=Cd(t,n);It(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),It(e,en),Ft(e,"batch","cut terrain & objects",[`cutall:${r}`,"hk","1"]),Ft(e,"batch","cut objects",[`cutobjects:${r}`,"hk","2"]),Ft(e,"batch","cut terrain",[`cutterrain:${r}`,"hk","3"]);const i=Ye(e);i.scroll=On(e)}async function gP(e,t,n,r){const i=mn(e),s=await F1();if(!E(i)||!E(s))return;const o=Math.min(t.x,n.x),a=Math.min(t.y,n.y),c=Math.max(t.x,n.x),l=Math.max(t.y,n.y),u=c-o+1,f=l-a+1,d=Math.min(s.width,u),h=Math.min(s.height,f);switch(r){case"pasteall":{for(let m=0;m<h;++m)for(let p=0;p<d;++p){const w=Vr({x:p,y:m},s.width);Re(i,{...s.terrain[w],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];E(p.x)&&E(p.y)&&fh(p.x,p.y,0,u-1,f-1,0)&&vd(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];E(p.x)&&E(p.y)&&fh(p.x,p.y,0,u-1,f-1,0)&&vd(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<h;++m)for(let p=0;p<d;++p){const w=Vr({x:p,y:m},s.width);Re(i,{...s.terrain[w],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=l;++m)for(let p=o;p<=c;++p){const w=(p-o)%s.width,b=(m-a)%s.height,v=Vr({x:w,y:b},s.width);Re(i,{...s.terrain[v],x:p,y:m})}break}}function _P(e,t,n){const r=Cd(t,n);It(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),It(e,en),Ft(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Ft(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Ft(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Ft(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=Ye(e);i.scroll=On(e)}function Ld(e,t){return`inspect:${t!=null&&t.id?t.id:Br(e,t)}`}function yP(e,t,n){const r=ln(Bt.MAIN);if(!E(r))return;const i=mn(e);if(!E(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){E(t)&&(t[d]=h)}const a=t.category===Ln.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Ld(i,t);It(e,`${a}: ${c} ${l}`),It(e,en),Ft(e,u,"color",[n,"coloredit"],s,o);const f=Ye(e);f.scroll=On(e)}function bP(e,t,n){const r=ln(Bt.MAIN);if(!E(r))return;const i=mn(e);if(!E(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){E(t)&&(t[d]=h)}const a=t.category===Ln.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Ld(i,t);It(e,`${a}: ${c} ${l}`),It(e,en),Ft(e,u,"char",[n,"charedit"],s,o);const f=Ye(e);f.scroll=On(e)}function wP(e,t,n,r,i,s){var h,m,p;const o=ln(Bt.MAIN);if(!E(o))return;function a(w){var v;const b=(r==null?void 0:r[w])??((v=r==null?void 0:r.kinddata)==null?void 0:v[w]);if(!E(b))switch(w){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return jt.ISWALK;case"pushable":return 0;case"breakable":return 0}return b}function c(w,b){E(r)&&(r[w]=b)}s?It(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):It(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`);const l=Ld(t,r);switch(s&&It(e,`cycle: ${Ht(r,"cycle")}`),Ht(r,"collision")){case jt.ISWALK:It(e,"collision: iswalk");break;case jt.ISSWIM:It(e,"collision: isswim");break;case jt.ISSOLID:It(e,"collision: issolid");break;case jt.ISBULLET:It(e,"collision: isbullet");break}s&&It(e,`ispushable: ${Ht(r,"pushable")?"yes":"no"}`),It(e,`isbreakable: ${Ht(r,"breakable")?"yes":"no"}`),It(e,en);const f=Oa(n),d=sr(f);for(let w=0;w<d.length;++w){const b=d[w];switch(b){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(le(f[b])){const[v,A,...R]=f[b];_t(A)&&Ft(e,l,A||b,[b,v,...R],a,c)}break}}Ft(e,l,"copy coords",["copycoords","hk","5"," 5 "]),It(e,en),Ft(e,l,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],a,c),Ft(e,l,`color: ${r.color??((m=r.kinddata)==null?void 0:m.color)??15}`,["color","hk","c"," C ","next"],a,c),Ft(e,l,`bg: ${r.bg??((p=r.kinddata)==null?void 0:p.bg)??0}`,["bg","hk","b"," B ","next"],a,c),It(e,en),Ft(e,l,"make empty",["empty","hk","0"],a,c),It(e,en),Ft(e,"batch","edit @board codepage",[`pageopen:${t.id}`]),Ft(e,"batch",`edit @${Le(n)}`,[`pageopen:${n.id}`])}function EP(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function xP(e,t,n,r){const i=ln(Bt.MAIN);if(!E(i))return;const s=mn(e);if(E(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=ee(s,{x:a,y:o});(c==null?void 0:c.category)===Ln.ISOBJECT&&wn(s,c,i.timestamp),Re(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=ee(s,{x:a,y:o});(c==null?void 0:c.category)===Ln.ISOBJECT&&wn(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)Re(s,{x:a,y:o});break}}}function kP(e,t,n){const r=ln(Bt.MAIN);if(!E(r))return;const i=mn(e);if(!E(i))return;const s=EP(t,n);It(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),It(e,en),Ft(e,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),Ft(e,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),Ft(e,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Ye(e);o.scroll=On(e)}async function vP(e,t,n){const r=ln(Bt.MAIN),i=await hP();if(!E(r))return;const s=mn(e);if(!E(s))return;if(Ue(s),t.x===n.x&&t.y===n.y){const a=ee(s,t),c=ub(r,a);E(a)&&E(c)&&wP(e,s,c,a,t,We(a)),a!=null&&a.kind||(It(e,`empty: ${t.x}, ${t.y}`),It(e,en),Ft(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]),Ft(e,"batch","edit @board codepage",[`pageopen:${s.id}`]))}else aP(e,t,n,i);const o=Ye(e);o.scroll=On(e)}function TP(e,t){const n=ae(Bt.MAIN);if(!E(n))return;const r=mn(t);if(!E(r))return;const i=Xn(e),s=UF(r,i.target);if(E(s))switch(i.path){case"copycoords":du(et,ir(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":yP(t,s,i.path);break;case"char":bP(t,s,i.path);break;case"empty":wn(r,s,n.timestamp);break;case"code":Ci(et,t,async()=>{const o=Jr(s),a="object";xe(et,t,`opened [${a}] ${o}`);const c=[r.id,s.id];hh(Ka(n.id,c),s.code??""),jw(et,t),await n0(800),Qd(et,t,n.id,c,a,`${o} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}async function AP(e,t){const n=mn(t);if(!E(n))return;const r=Xn(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":dP(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await fP(t,c,l,r.target);break;case"cut":mP(t,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await pP(t,c,l,r.target);break;case"paste":_P(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await gP(t,c,l,r.target);break;case"empty":kP(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":xP(t,c,l,r.target);break;case"chars":iP(t,c,l,"char");break;case"colors":sP(t,c,l,"color");break;case"bgs":oP(t,c,l,"bg");break;case"copycoords":du(et,t,[i,s,o,a].join(" "));break;case"remixrun":{const u=Hn(Da.stat);E(u)&&jb(n.id,u.id,Da.patternsize,Da.mirror,c,l,"all");break}case"pageopen":Ci(et,t,async()=>{await n0(800),aE(et,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const RP=16,ns={},tu={},SP=60;let $1=0;const No={},Co={};async function D1(e){const t=Ur(),n=ae(Bt.MAIN);if(t.length&&E(n)){const r=await Od(t),i=`${e?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;Ww(ne,ir(),i,r)}}async function OP(){const e=Ur(),t=ae(Bt.MAIN);if(e.length&&E(t)){const n=await Od(e);Gw(ne,ir(),n)}}async function IP(){const e=Ur(),t=ae(Bt.MAIN);return e.length&&E(t)?Od(e):""}const ne=Us("vm",["tick","second"],e=>{var n;if(!ne.session(e))return;const t=ir();switch(e.target){case"operator":fF(e.player),xe(ne,e.player,`operator set to ${e.player}`),ne.replynext(e,"ackoperator",!0);break;case"zsswords":{const r=ae(Bt.MAIN);ne.replynext(e,"ackzsswords",{cli:dd(Ji.CLI),loader:dd(Ji.LOADER),runtime:dd(Ji.RUNTIME),flags:[...sr(yr(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"],kinds:[...As(r,yt.OBJECT).map(i=>Le(i)),...sr(ud)],altkinds:[...As(r,yt.TERRAIN),...As(r,yt.BOARD),...As(r,yt.PALETTE),...As(r,yt.CHARSET),...As(r,yt.LOADER)].map(i=>Le(i)),colors:[...sr(qo)],dirs:[...sr(yh).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...sr(cd)],exprs:["aligned","alligned","contact","blocked","any","count","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":e.player===t&&Ci(ne,e.player,async()=>{if(le(e.data)){const[r,i]=e.data,s=await rP(r),o=s.map(a=>a.name);bF(s,i),xe(ne,e.player,`loading ${o.join(", ")}`),fu(ne,e.player)}});break;case"search":xF(e.player)||fu(ne,e.player);break;case"logout":EF(e.player),delete ns[e.player],xe(ne,t,`player ${e.player} logout`),fu(ne,e.player);break;case"login":b1(e.player)?(ns[e.player]=0,xe(ne,ir(),`login from ${e.player}`),ne.replynext(e,"acklogin",!0)):Xd(ne,e.player);break;case"local":b1(e.player)?(ns[e.player]=0,xe(ne,ir(),`login from ${e.player}`)):Xd(ne,e.player);break;case"doot":ns[e.player]=0,tu[e.player]=tu[e.player]??0,tu[e.player]%32===0&&xe(ne,e.player,`$whiteactive $blue${e.player}`),++tu[e.player];break;case"input":{if(e.player.includes("local")&&!_1(e.player)&&oE(ne,e.player),!e.player.includes("local")||_1(e.player)){const r=yr(e.player),[i=kn.NONE,s=0]=e.data??[kn.NONE,0];le(r.inputqueue)||(r.inputqueue=[]),i!==kn.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(le(e.data)){const[r,i]=e.data,s=Ka(r,i);E(Co[s])||(Co[s]=Vp(s,o=>{const[a,c]=i,l=Fr(r),u=Ts(l,a);if(E(u))if(ai(u)===yt.BOARD&&E(c)){const f=Ae(u),d=Sn(f,c);E(d)&&(d.code=o,Vf(ab(o),d))}else u.code=o,o6(u)})),No[s]=No[s]??new Set,No[s].add(e.player)}break;case"coderelease":if(le(e.data)){const[r,i]=e.data,[,s]=i,o=Ka(r,i);E(No[o])&&(No[o].delete(e.player),No[o].size===0&&((n=Co[o])==null||n.call(Co),Co[o]=void 0,_t(s)&&AF(s)))}break;case"halt":e.player===t&&vw(e.data)&&dF(e.data);break;case"tick":SF(pF());break;case"synthsend":if(_t(e.data)){const[r,i]=QF(e.data),s=ae(Bt.MAIN);So(r,i,void 0,yo(s))}break;case"second":{kF(ns);const r=Object.keys(ns);for(let i=0;i<r.length;++i)++ns[r[i]];for(let i=0;i<r.length;++i){const s=r[i];ns[s]>=RP&&t0(ne,s)}++$1>=SP&&($1=0,Ci(ne,e.player,async()=>{await D1(!0)}));break}case"copyjsonfile":if(e.player===t){const r=ae(Bt.MAIN);if(E(r)&&le(e.data)){const[i]=e.data,s=Ts(r,i);E(s)&&Hw(ne,t,s,`${Le(s)}.${Mr(s)}.json`)}}break;case"refscroll":{It(e.player,"stat refs"),It(e.player,en),Ft(e.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Ft(e.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),Ft(e.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const r=Ye(e.player);r.scroll=On(e.player);break}case"fork":e.player===t&&Ci(ne,e.player,async()=>{await OP()});break;case"itchiopublish":Ci(ne,e.player,async()=>{if(e.player===t){const r=ae(Bt.MAIN);if(E(r)){const i=await IP();Kw(ne,e.player,r.name,i)}}});break;case"flush":e.player===t&&Ci(ne,e.player,async()=>{await D1()});break;case"cli":x1(e.player,e.data);break;case"clirepeatlast":OF(e.player);break;case"restart":e.player===t&&(RF(),e0(ne,e.player));break;case"inspect":Ci(ne,e.player,async()=>{if(le(e.data)){const[r,i]=e.data;await vP(e.player,r,i)}});break;case"loader":if(le(e.data)){const[r,i,s,o]=e.data;switch(i){case"file":M1(e.player,o);break;case"json":if(/file:.*\.book.json/.test(s)){xe(ne,e.player,`loading ${s}`);const a=JSON.parse(o.json);E(a.data)&&_t(a.exported)&&(Kl(a.data),xe(ne,e.player,`loaded ${a.exported}`))}else if(/file:.*\..*\.codepage.json/.test(s)){xe(ne,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=ae(Bt.MAIN);E(c)&&E(a.data)&&_t(a.exported)&&(Zf(c,a.data),xe(ne,e.player,`loaded ${a.exported}`))}else Ob(r,i,s,o,e.player);break;default:Ob(r,i,s,o,e.player);break}}break;default:{const{target:r,path:i}=Xn(e.target);switch(Ot(r)){case"refscroll":switch(i){case"charscroll":{Ft(e.player,"refscroll","char",["char","charedit"]);const s=Ye(e.player);s.scroll=On(e.player);break}case"colorscroll":{Ft(e.player,"refscroll","color",["color","coloredit"]);const s=Ye(e.player);s.scroll=On(e.player);break}case"notesscroll":{It(e.player,"duration             cdefgab - notes "),It(e.player,"y - 64th note        x - rest"),It(e.player,"t - 32nd note        "),It(e.player,"s - 16th note.       drums"),It(e.player,"i - eight note.      0 - tick"),It(e.player,"q - quarter note     1 - tweet"),It(e.player,"h - half note        2 - cowbell"),It(e.player,"w - whole note       p - clap"),It(e.player,"                     4 - high snare"),It(e.player,"mods                 5 - high woodblock"),It(e.player,"3 - triplet          6 - low snare"),It(e.player,". - time and a half  7 - low tom"),It(e.player,"# - sharp            8 - low woodblock"),It(e.player,"! - flat             9 - bass drum");const s=Ye(e.player);s.scroll=On(e.player);break}}break;case"batch":Ci(ne,e.player,async()=>{await AP(i,e.player)});break;case"empty":{const s=Xn(i);switch(s.target){case"copycoords":du(ne,ir(),s.path.split(",").join(" "));break}break}case"inspect":TP(i,e.player);break;case"touched":if(le(e.data)){const[s,o,a]=e.data;w1({...e,target:`${s}:${a}`,data:void 0,sender:o})}break;default:{const s=Xn(i);if(Ot(s.target)==="self"||!s.path)e.target=e.target.replace("self:",""),w1(e);else{const o=ae(Bt.MAIN);So(s.target,s.path,void 0,yo(o))}break}}break}}},hF());function NP(){zw(ne)}const{forward:CP}=pE(e=>{mE(e)&&postMessage(e)});onmessage=function(t){CP(t.data)},setTimeout(NP,100)})();

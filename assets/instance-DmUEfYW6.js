var tL=Object.defineProperty;var nL=(on,X,it)=>X in on?tL(on,X,{enumerable:!0,configurable:!0,writable:!0,value:it}):on[X]=it;var P=(on,X,it)=>(nL(on,typeof X!="symbol"?X+"":X,it),it);(function(){"use strict";const on=new Set,X={emit(t,e,n,r){X.invoke(zy(t,e,n,r))},invoke(t){on.forEach(e=>e.handle(t))},connect(t){on.add(t)},disconnect(t){on.delete(t)}};var it=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function di(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Cy(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var gu={};(function(t){var e=it&&it.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,f=u.length,p;d<f;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function s(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function i(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,f=d===void 0?!0:d,p=l.adjectiveCount,_=p===void 0?1:p,S=l.addAdverb,T=S===void 0?!1:S,E=e(e(e([],e([],Array(_),!0).map(function(A){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),T?[n(t.adverbs)]:[],!0);return f&&(E=E.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),E.join(h)}t.humanId=i;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d;return t.adjectives.length*h*t.nouns.length*t.verbs.length*(f?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,_=p===void 0?"":p;return r(t.adjectives).length*h+h*_.length+r(t.nouns).length+_.length+r(t.verbs).length+(f?r(t.adverbs).length+_.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,_=p===void 0?"":p;return s(t.adjectives).length*h+h*_.length+s(t.nouns).length+_.length+s(t.verbs).length+(f?s(t.adverbs).length+_.length:0)}t.minLength=c,t.default=i})(gu);var Ly=di(gu);const My="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let xy=t=>crypto.getRandomValues(new Uint8Array(t)),Uy=(t,e,n)=>{let r=(2<<Math.log(t.length-1)/Math.LN2)-1,s=-~(1.6*r*e/t.length);return(i=e)=>{let o="";for(;;){let a=n(s),c=s;for(;c--;)if(o+=t[a[c]&r]||"",o.length===i)return o}}},mu=(t,e=21)=>Uy(t,e,xy),Py=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=My[n[t]&63];return e};var yu="abcdefghijklmnopqrstuvwxyz",_u="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Eu="0123456789",Dy="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",$y="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const By=Eu,Fy=yu,jy=_u;var Gy=By+Fy+jy,ia={lowercase:yu,uppercase:_u,numbers:Eu,nolookalikes:Dy,nolookalikesSafe:$y,alphanumeric:Gy};function Et(){return`sid_${Py().replaceAll("-",".")}`}const Ky=mu(ia.numbers,4),Wy=mu(`${ia.numbers}${ia.lowercase}`,16);function Hy(){return`pid_${Ky()}_${Wy()}`}function Vy(){return Ly({capitalize:!1,adjectiveCount:1})}function zy(t,e,n,r){return{id:Et(),target:t,sender:e,data:n,player:r}}function wu(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function as(t,e,n){const r=Et(),s=t.toLowerCase(),i=e.map(a=>a.toLowerCase()),o={id(){return r},name(){return t},tags(){return e},emit(a,c,l){X.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=wu(a.target),u=c.toLowerCase();i.findIndex(h=>h==="all"||h===u)!==-1&&n(a),(r===c||u==="all"||s===u)&&n({...a,target:l})}};return X.connect(o),o}function Yy(t){const e=new Set;function n(r){e.has(r.id)||(e.add(r.id),X.invoke(r))}return as("forward",["all"],r=>{e.has(r.id)||(e.add(r.id),t(r))}),n}var bu={},an={},cn={};Object.defineProperty(cn,"__esModule",{value:!0}),cn.throwUnsupportedData=cn.throwUnknownDataType=cn.getType=void 0;function Su(t){return Object.prototype.toString.call(t)}cn.getType=Su;function qy(t){throw new TypeError("unsupported data type: "+Su(t))}cn.throwUnknownDataType=qy;function Xy(t){throw new TypeError("unsupported data type: "+t)}cn.throwUnsupportedData=Xy;var Ie={},Ne={};Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.s_to_num=Ne.int_str_to_s=Ne.num_to_s=Ne.big_int_to_s=Ne.int_to_s=Ne.s_to_big_int=Ne.s_to_int=void 0;let ln="";for(let t=0;t<10;t++){const e=String.fromCharCode(48+t);ln+=e}for(let t=0;t<26;t++){const e=String.fromCharCode(65+t);ln+=e}for(let t=0;t<26;t++){const e=String.fromCharCode(97+t);ln+=e}const Rr=ln.length,oa={};for(let t=0;t<Rr;t++){const e=ln[t];oa[e]=t}function aa(t){let e=0,n=1;for(let r=t.length-1;r>=0;r--){const s=t[r];let i=oa[s];i*=n,e+=i,n*=Rr}return e}Ne.s_to_int=aa;function Tu(t){let e=BigInt(0),n=BigInt(1);const r=BigInt(Rr);for(let s=t.length-1;s>=0;s--){const i=t[s];let o=BigInt(oa[i]);o*=n,e+=o,n*=r}return e}Ne.s_to_big_int=Tu;function ca(t){if(t===0)return ln[0];const e=[];for(;t!==0;){const n=t%Rr,r=ln[n];e.push(r),t-=n,t/=Rr}return e.reverse().join("")}Ne.int_to_s=ca;function Au(t){const e=BigInt(0),n=BigInt(Rr);if(t===e)return ln[0];const r=[];for(;t!==e;){const s=t%n,i=ln[Number(s)];r.push(i),t/=n}return r.reverse().join("")}Ne.big_int_to_s=Au;function vu(t){return t.split("").reverse().join("")}function ku(t){if(t<0)return"-"+ku(-t);let[e,n]=t.toString().split(".");if(!n)return ca(t);let r;n&&([n,r]=n.split("e")),e=pi(e),n=vu(n),n=pi(n);let s=e+"."+n;if(r){switch(s+=".",r[0]){case"+":r=r.slice(1);break;case"-":s+="-",r=r.slice(1);break}r=pi(r),s+=r}return s}Ne.num_to_s=ku;function pi(t){const e=+t;return e.toString()===t&&e+1!==e&&e-1!==e?ca(e):":"+Au(BigInt(t))}Ne.int_str_to_s=pi;function la(t){return t[0]===":"?Tu(t.substring(1)).toString():aa(t).toString()}function Ru(t){if(t[0]==="-")return-Ru(t.substr(1));let[e,n,r]=t.split(".");if(!n)return aa(e);e=la(e),n=la(n),n=vu(n);let s=e+"."+n;if(r){s+="e";let i=!1;r[0]==="-"&&(i=!0,r=r.slice(1)),r=la(r),s+=i?-r:+r}return+s}Ne.s_to_num=Ru,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.decodeStr=Ie.encodeStr=Ie.decodeBool=Ie.encodeBool=Ie.decodeKey=Ie.decodeNum=Ie.encodeNum=void 0;const ua=Ne;function Jy(t){return"n|"+(0,ua.num_to_s)(t)}Ie.encodeNum=Jy;function Qy(t){return t=t.replace("n|",""),(0,ua.s_to_num)(t)}Ie.decodeNum=Qy;function Zy(t){return typeof t=="number"?t:(0,ua.s_to_int)(t)}Ie.decodeKey=Zy;function e_(t){return t?"b|T":"b|F"}Ie.encodeBool=e_;function t_(t){switch(t){case"b|T":return!0;case"b|F":return!1}return!!t}Ie.decodeBool=t_;function n_(t){switch(t[0]+t[1]){case"b|":case"o|":case"n|":case"a|":case"s|":t="s|"+t}return t}Ie.encodeStr=n_;function r_(t){return t[0]+t[1]==="s|"?t.substr(2):t}Ie.decodeStr=r_;var Qe={},cs={};Object.defineProperty(cs,"__esModule",{value:!0}),cs.config=void 0,cs.config={sort_key:!1,error_on_nan:!1,error_on_infinite:!1},Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.addValue=Qe.makeInMemoryMemory=Qe.makeInMemoryCache=Qe.makeInMemoryStore=Qe.memToValues=void 0;const ha=cs,fa=cn,da=Ie,s_=Ne;function i_(t){return t.store.toArray()}Qe.memToValues=i_;function Ou(){const t=[];return{forEach(e){for(let n=0;n<t.length;n++)if(e(t[n])==="break")return},add(e){t.push(e)},toArray(){return t}}}Qe.makeInMemoryStore=Ou;function Iu(){const t=Object.create(null),e=Object.create(null);return{getValue(n){return t[n]},getSchema(n){return e[n]},forEachValue(n){for(const[r,s]of Object.entries(t))if(n(r,s)==="break")return},forEachSchema(n){for(const[r,s]of Object.entries(e))if(n(r,s)==="break")return},setValue(n,r){t[n]=r},setSchema(n,r){e[n]=r},hasValue(n){return n in t},hasSchema(n){return n in e}}}Qe.makeInMemoryCache=Iu;function o_(){return{store:Ou(),cache:Iu(),keyCount:0}}Qe.makeInMemoryMemory=o_;function er(t,e){if(t.cache.hasValue(e))return t.cache.getValue(e);const n=t.keyCount++,r=(0,s_.num_to_s)(n);return t.store.add(e),t.cache.setValue(e,r),r}function a_(t,e){ha.config.sort_key&&e.sort();const n=e.join(",");if(t.cache.hasSchema(n))return t.cache.getSchema(n);const r=ls(t,e,void 0);return t.cache.setSchema(n,r),r}function ls(t,e,n){if(e===null)return"";switch(typeof e){case"undefined":if(Array.isArray(n))return ls(t,null,n);break;case"object":if(e===null)return er(t,null);if(Array.isArray(e)){let r="a";for(let s=0;s<e.length;s++){const i=e[s],o=i===null?"_":ls(t,i,e);r+="|"+o}return r==="a"&&(r="a|"),er(t,r)}else{const r=Object.keys(e);if(r.length===0)return er(t,"o|");let s="o";const i=a_(t,r);s+="|"+i;for(const o of r){const a=e[o],c=ls(t,a,e);s+="|"+c}return er(t,s)}case"boolean":return er(t,(0,da.encodeBool)(e));case"number":return Number.isNaN(e)?(ha.config.error_on_nan&&(0,fa.throwUnsupportedData)("[number NaN]"),""):Number.POSITIVE_INFINITY===e||Number.NEGATIVE_INFINITY===e?(ha.config.error_on_infinite&&(0,fa.throwUnsupportedData)("[number Infinity]"),""):er(t,(0,da.encodeNum)(e));case"string":return er(t,(0,da.encodeStr)(e))}return(0,fa.throwUnknownDataType)(e)}Qe.addValue=ls,Object.defineProperty(an,"__esModule",{value:!0}),an.decompress=an.decode=an.compress=void 0;const c_=cn,gi=Ie,pa=Qe;function l_(t){const e=(0,pa.makeInMemoryMemory)(),n=(0,pa.addValue)(e,t,void 0);return[(0,pa.memToValues)(e),n]}an.compress=l_;function u_(t,e){if(e==="o|")return{};const n={},r=e.split("|"),s=r[1];let i=us(t,s);const o=r.length;o-2===1&&!Array.isArray(i)&&(i=[i]);for(let a=2;a<o;a++){const c=i[a-2];let l=r[a];l=us(t,l),n[c]=l}return n}function h_(t,e){if(e==="a|")return[];const n=e.split("|"),r=n.length-1,s=new Array(r);for(let i=0;i<r;i++){let o=n[i+1];o=us(t,o),s[i]=o}return s}function us(t,e){if(e===""||e==="_")return null;const n=(0,gi.decodeKey)(e),r=t[n];if(r===null)return r;switch(typeof r){case"undefined":return r;case"number":return r;case"string":switch(r[0]+r[1]){case"b|":return(0,gi.decodeBool)(r);case"o|":return u_(t,r);case"n|":return(0,gi.decodeNum)(r);case"a|":return h_(t,r);default:return(0,gi.decodeStr)(r)}}return(0,c_.throwUnknownDataType)(r)}an.decode=us;function f_(t){const[e,n]=t;return us(e,n)}an.decompress=f_;var Or={};Object.defineProperty(Or,"__esModule",{value:!0}),Or.trimUndefinedRecursively=Or.trimUndefined=void 0;function d_(t){for(const e in t)t[e]===void 0&&delete t[e]}Or.trimUndefined=d_;function p_(t){Nu(t,new Set)}Or.trimUndefinedRecursively=p_;function Nu(t,e){e.add(t);for(const n in t)if(t[n]===void 0)delete t[n];else{const r=t[n];r&&typeof r=="object"&&!e.has(r)&&Nu(r,e)}}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.config=t.trimUndefinedRecursively=t.trimUndefined=t.addValue=t.decode=t.decompress=t.compress=void 0;var e=an;Object.defineProperty(t,"compress",{enumerable:!0,get:function(){return e.compress}}),Object.defineProperty(t,"decompress",{enumerable:!0,get:function(){return e.decompress}});var n=an;Object.defineProperty(t,"decode",{enumerable:!0,get:function(){return n.decode}});var r=Qe;Object.defineProperty(t,"addValue",{enumerable:!0,get:function(){return r.addValue}});var s=Or;Object.defineProperty(t,"trimUndefined",{enumerable:!0,get:function(){return s.trimUndefined}}),Object.defineProperty(t,"trimUndefinedRecursively",{enumerable:!0,get:function(){return s.trimUndefinedRecursively}});var i=cs;Object.defineProperty(t,"config",{enumerable:!0,get:function(){return i.config}})})(bu);/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var g_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)s.hasOwnProperty(i)&&(r[i]=s[i])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),m_=Object.prototype.hasOwnProperty;function ga(t,e){return m_.call(t,e)}function ma(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var s in t)ga(t,s)&&r.push(s);return r}function De(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function ya(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function tr(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Cu(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function _a(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(_a(t[e]))return!0}else if(typeof t=="object"){for(var r=ma(t),s=r.length,i=0;i<s;i++)if(_a(t[r[i]]))return!0}}return!1}function Lu(t,e){var n=[t];for(var r in e){var s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&n.push(r+": "+s)}return n.join(`
`)}var Mu=function(t){g_(e,t);function e(n,r,s,i,o){var a=this.constructor,c=t.call(this,Lu(n,{name:r,index:s,operation:i,tree:o}))||this;return c.name=r,c.index=s,c.operation=i,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Lu(n,{name:r,index:s,operation:i,tree:o}),c}return e}(Error),oe=Mu,y_=De,Ir={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=mi(n,this.path);r&&(r=De(r));var s=nr(n,{op:"remove",path:this.from}).removed;return nr(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=mi(n,this.from);return nr(n,{op:"add",path:this.path,value:De(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:hs(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},__={add:function(t,e,n){return ya(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:Ir.move,copy:Ir.copy,test:Ir.test,_get:Ir._get};function mi(t,e){if(e=="")return t;var n={op:"_get",path:e};return nr(t,n),n.value}function nr(t,e,n,r,s,i){if(n===void 0&&(n=!1),r===void 0&&(r=!0),s===void 0&&(s=!0),i===void 0&&(i=0),n&&(typeof n=="function"?n(e,0,t,e.path):yi(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=mi(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=hs(t,e.value),o.test===!1)throw new oe("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new oe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,t);return o}}else{r||(t=De(t));var a=e.path||"",c=a.split("/"),l=t,u=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=yi;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=Cu(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!ya(f))throw new oe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,t);ya(f)&&(f=~~f)}if(u>=h){if(n&&e.op==="add"&&f>l.length)throw new oe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,t);var o=__[e.op].call(e,l,f,t);if(o.test===!1)throw new oe("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return o}}else if(u>=h){var o=Ir[e.op].call(e,l,f,t);if(o.test===!1)throw new oe("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new oe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,t)}}}function Ea(t,e,n,r,s){if(r===void 0&&(r=!0),s===void 0&&(s=!0),n&&!Array.isArray(e))throw new oe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=De(t));for(var i=new Array(e.length),o=0,a=e.length;o<a;o++)i[o]=nr(t,e[o],n,!0,s,o),t=i[o].newDocument;return i.newDocument=t,i}function E_(t,e,n){var r=nr(t,e);if(r.test===!1)throw new oe("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function yi(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new oe("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(Ir[t.op]){if(typeof t.path!="string")throw new oe("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new oe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new oe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new oe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&_a(t.value))throw new oe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var s=t.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new oe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new oe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=xu([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new oe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new oe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function xu(t,e,n){try{if(!Array.isArray(t))throw new oe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Ea(De(e),De(t),n||!0);else{n=n||yi;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(s){if(s instanceof oe)return s;throw s}}function hs(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),s,i,o;if(n&&r){if(i=t.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!hs(t[s],e[s]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(i=a.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(a[s]))return!1;for(s=i;s--!==0;)if(o=a[s],!hs(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var w_=Object.freeze({__proto__:null,JsonPatchError:oe,_areEquals:hs,applyOperation:nr,applyPatch:Ea,applyReducer:E_,deepClone:y_,getValueByPointer:mi,validate:xu,validator:yi});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var wa=new WeakMap,b_=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),S_=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function T_(t){return wa.get(t)}function A_(t,e){return t.observers.get(e)}function v_(t,e){t.observers.delete(e.callback)}function k_(t,e){e.unobserve()}function R_(t,e){var n=[],r,s=T_(t);if(!s)s=new b_(t),wa.set(t,s);else{var i=A_(s,e);r=i&&i.observer}if(r)return r;if(r={},s.value=De(t),e){r.callback=e,r.next=null;var o=function(){ba(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){ba(r),clearTimeout(r.next),v_(s,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},s.observers.set(e,new S_(e,r)),r}function ba(t,e){e===void 0&&(e=!1);var n=wa.get(t.object);Sa(n.value,t.object,t.patches,"",e),t.patches.length&&Ea(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function Sa(t,e,n,r,s){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=ma(e),o=ma(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(ga(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?Sa(u,h,n,r+"/"+tr(l),s):u!==h&&(s&&n.push({op:"test",path:r+"/"+tr(l),value:De(u)}),n.push({op:"replace",path:r+"/"+tr(l),value:De(h)}))}else Array.isArray(t)===Array.isArray(e)?(s&&n.push({op:"test",path:r+"/"+tr(l),value:De(u)}),n.push({op:"remove",path:r+"/"+tr(l)}),a=!0):(s&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&i.length==o.length))for(var c=0;c<i.length;c++){var l=i[c];!ga(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+tr(l),value:De(e[l])})}}}function Ta(t,e,n){n===void 0&&(n=!1);var r=[];return Sa(t,e,r,"",n),r}var O_=Object.freeze({__proto__:null,compare:Ta,generate:ba,observe:R_,unobserve:k_});Object.assign({},w_,O_,{JsonPatchError:Mu,deepClone:De,escapePathComponent:tr,unescapePathComponent:Cu});function g(t){return t!=null}function I_(t,e){return Ta(t,e).length===0}function Uu(t){return De(t)}function pe(t){return typeof t=="number"}function z(t){return typeof t=="string"}function ge(t){return Array.isArray(t)}function N_(t){return t}function C_(t){return typeof t=="object"&&z(t.id)===!0&&z(t.name)===!0&&typeof t.flags=="object"&&typeof t.players=="object"&&ge(t.pages)===!0}var ve=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.CLEAR=32]="CLEAR",t[t.SHADOW=33]="SHADOW",t[t.BORROW=34]="BORROW",t))(ve||{});function _i(t,e){return new Array(t).fill(e)}function L_(t,e,n,r,s=0){const i=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:_i(i,0),color:_i(i,0),bg:_i(i,s)}}function M_(t,e,n,r=1,s=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:s,bg:32}}function x_(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function U_(t,e,n,r,s=0){const i=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:_i(i,s)}}function P_(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:2}}var ot=(t=>(t[t.START=0]="START",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.SCROLL=5]="SCROLL",t))(ot||{});const D_={start:0,left:1,right:2,top:3,bottom:4,scroll:5},$_={0:1,1:20,2:20,3:1,4:1,5:40};function Pu(t,e){return`${t}:${e}`}const B_=1,F_=16,j_=256;var me=(t=>(t[t.NONE=0]="NONE",t[t.MOVE_UP=1]="MOVE_UP",t[t.MOVE_DOWN=2]="MOVE_DOWN",t[t.MOVE_LEFT=3]="MOVE_LEFT",t[t.MOVE_RIGHT=4]="MOVE_RIGHT",t[t.OK_BUTTON=5]="OK_BUTTON",t[t.CANCEL_BUTTON=6]="CANCEL_BUTTON",t[t.MENU_BUTTON=7]="MENU_BUTTON",t))(me||{});function un(t,e,n,r){const s=r??"anon";return X.emit(`error:${e}`,t,n,s),q_(t,n,s)}function G_(t,e){X.emit("bip:retry",t,void 0,e)}function K_(t,e){X.emit("bip:loginfailed",t,void 0,e)}function W_(t,e,n){X.emit("gadgetclient:reset",t,e,n)}function H_(t,e,n){X.emit("gadgetclient:patch",t,e,n)}function V_(t,e){X.emit("register:flush",t,e)}function z_(t){X.emit("register:biosflash",t)}function Y_(t){X.emit("register:bioserase",t)}function wt(t,...e){return X.emit("tape:info",t,e),!0}function Du(t,...e){return X.emit("tape:debug",t,e),!0}function q_(t,...e){return X.emit("tape:error",t,e),!1}function X_(t){X.emit("tape:crash",t)}function J_(t,e,n,r,s,i){X.emit("tape:editor:open",t,[e,n,r,s],i)}function $u(t,e){return`${t}${e}`}function Aa(t){X.emit("vm:flush",t)}var Bu={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(it,function(){return n.importState=function(s){var i=new n;return i.importState(s),i},n;function n(){return function(s){var i=0,o=0,a=0,c=1;s.length==0&&(s=[+new Date]);var l=r();i=l(" "),o=l(" "),a=l(" ");for(var u=0;u<s.length;u++)i-=l(s[u]),i<0&&(i+=1),o-=l(s[u]),o<0&&(o+=1),a-=l(s[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*i+c*23283064365386963e-26;return i=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=s,h.exportState=function(){return[i,o,a,c]},h.importState=function(d){i=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,i=function(o){o=o.toString();for(var a=0;a<o.length;a++){s+=o.charCodeAt(a);var c=.02519603282416938*s;s=c>>>0,c-=s,c*=s,s=c>>>0,c-=s,s+=c*4294967296}return(s>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})})(Bu);var Q_=Bu.exports,Z_=di(Q_);const eE=Z_("089fad0j9awfem09wavefc09uwaef");function rr(t,e=0,n=1){return Math.max(e,Math.min(n,t))}function tE(){return eE()}function Ei(t,e){const n=Math.min(t,e),s=Math.max(t,e)-n+1;return n+Math.floor(tE()*s)}function va(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],s=Math.min(t,e),i=Math.max(t,e);for(let o=s;o<=i;o+=n)r.push(o);return r}function nE(t){return t[Ei(0,t.length-1)]}function hn(...t){return nE(t.flat())}function rE(t){return[...new Set(t)].filter(g)}function sE(...t){const e=t.flat().filter(g);return e.reduce((n,r)=>n+r,0)/e.length}function Fu(t,e){const n=t??Me.ISWALK,r=e??Me.ISWALK;switch(n){case Me.ISWALK:return r!==Me.ISWALK;case Me.ISSWIM:return r!==Me.ISSWIM;case Me.ISSOLID:return!0;case Me.ISBULLET:return r!==Me.ISWALK&&r!==Me.ISSWIM}}function ka(t,e){var r,s;return[...((s=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:s.values())??[]].map(i=>typeof i=="string"?t==null?void 0:t.objects[i]:t==null?void 0:t.terrain[i]).filter(g)}function iE(t,e){const n=Da(e),r=ah(e),s=ch(e);return t.filter(i=>!(g(n)&&Hu(i)!==n||g(r)&&pE(i)!==r||g(s)&&gE(i)!==s)).filter(g)}function Ra(t,e){return g(t)?e.map(n=>{var r;if(typeof n=="string"){const s=t.objects[n];if(g(s))return s;const i=ka(t,n.toLowerCase());if(i.length)return i}else if(Dt(n)&&n.x>=0&&n.x<t.width&&n.y>=0&&n.y<t.height){const s=n.x+n.y*t.width,i=(r=t.lookup)==null?void 0:r[s];return g(i)?t.objects[i]:t.terrain[s]}}).flat().filter(g):[]}function oE(t,e){let n=0,r;for(let s=0;s<e.length;++s){const i=e[s];if(i){const o=t.x-(i.x??0),a=t.y-(i.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=i)}}return r}function ju(){return{}}function aE(t){if(g(t))return Uu(t)}function Gu(){return{id:Et()}}function wi(t){if(g(t))return{kind:t.kind,id:t.id,x:t.x,y:t.y,lx:t.lx,ly:t.ly,code:t.code,name:t.name,char:t.char,color:t.color,bg:t.bg,pushable:t.pushable,collision:t.collision,destructible:t.destructible,stats:aE(t.stats)}}function Oa(t,e,n){return g(t)?(t.stats=t.stats??ju(),t.stats[e]??n):void 0}function Ia(t,e,n){g(t)&&(t.stats=t.stats??ju(),t.stats[e]=n)}function Na(t,e){Object.entries(e).forEach(([n,r])=>Ia(t,n,r))}const Ku=60,Wu=25,cE=new Array(Ku*Wu);function lE(t=N_){const e={id:Et(),x:0,y:0,width:Ku,height:Wu,terrain:cE.slice(0),objects:{}};return t(e)}function uE(t){if(g(t))return{id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,terrain:t.terrain.map(wi),objects:Object.fromEntries(Object.entries(t.objects).filter(([,e])=>e.kind!=="player").map(([e,n])=>[e,wi(n)])),stats:t.stats}}function hE(t,e,n){g(t)&&(t.stats=t.stats??{},t.stats[e]=n)}function fE(t,e){return!g(t)||e.x<0||e.x>=t.width||e.y<0||e.y>=t.height?-1:e.x+e.y*t.width}function dE(t,e){const n=fE(t,e);if(n<0||!g(t==null?void 0:t.lookup))return;const r=La(t,t.lookup[n]??"");return g(r)?r:t.terrain[n]}function Hu(t){var e;return((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"object").toLowerCase()}function pE(t){var e;return(t==null?void 0:t.color)??((e=t==null?void 0:t.kinddata)==null?void 0:e.color)??ve.BLACK}function gE(t){var e;return(t==null?void 0:t.bg)??((e=t==null?void 0:t.kinddata)==null?void 0:e.bg)??ve.BLACK}function bi(t,e){if(!g(t)||!ct(e))return;const n=nh(e);g(n)&&(t.color=n);const r=rh(e);g(r)&&(t.bg=r)}function mE(t,e){if(!g(t)||!g(e)||!g(e.x)||!g(e.y)||e.x<0||e.x>=t.width||e.y<0||e.y>=t.height)return;const n={...e},r=e.x+e.y*t.width;return t.terrain[r]=n,e}function yE(t,e){if(!g(t)||!g(e))return;const n={...e,id:e.id??Et()};return t.objects[n.id]=n,n}function Vu(t,e,n){return mE(t,{...e,kind:n})}function Ca(t,e,n,r){return yE(t,{...e,id:r??void 0,kind:n})}function La(t,e){if(t)return t.objects[e]}function Nr(t,e,n){if(!g(t)||!g(e))return{x:0,y:0};const r={x:e.x??0,y:e.y??0},s={x:e.lx??r.x,y:e.ly??r.y},i={...r},o=xn(s,r),a=t.width-1,c=t.height-1;for(let l=0;l<n.length;++l){const u=wE(n[l]);switch(u){case H.IDLE:break;case H.NORTH:case H.SOUTH:case H.WEST:case H.EAST:at(r,u);break;case H.BY:{const[h,d]=n.slice(l+1);pe(h)&&pe(d)&&(r.x=rr(r.x+h,0,a),r.y=rr(r.y+d,0,c)),l+=2;break}case H.AT:{const[h,d]=n.slice(l+1);pe(h)&&pe(d)&&(r.x=rr(h,0,a),r.y=rr(d,0,c)),l+=2;break}case H.FLOW:at(r,o);break;case H.SEEK:{const h=xa(t,e);Dt(h)&&at(r,xn(i,h));break}case H.RNDNS:at(r,hn(H.NORTH,H.SOUTH));break;case H.RNDNE:at(r,hn(H.NORTH,H.EAST));break;case H.RND:at(r,hn(H.NORTH,H.SOUTH,H.WEST,H.EAST));break;case H.CW:{const h=Nr(t,e,n.slice(l+1));at(r,xn(i,h));break}case H.CCW:{const h=Nr(t,e,n.slice(l+1));at(r,xn(i,h));break}case H.OPP:{const h=Nr(t,e,n.slice(l+1));at(r,xn(i,h));break}case H.RNDP:{const h=Nr(t,e,n.slice(l+1));switch(xn(i,h)){case H.NORTH:case H.SOUTH:r.x+=hn(-1,1);break;case H.WEST:case H.EAST:r.y+=hn(-1,1);break}break}}}return r}function Ma(t,e){return g(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function xa(t,e){var s;if(!g(t)||!g(e))return;const n=((s=e.stats)==null?void 0:s.player)??"",r=t.objects[n];if(g(r))return r;if(Dt(e))return oE(e,ka(t,"player"))}function _E(t,e,n){return{book:t.book,board:t.board,object:t.object,terrain:t.terrain,charset:t.charset,palette:t.palette,words:e,get:n}}var H=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t))(H||{}),Me=(t=>(t[t.ISSOLID=0]="ISSOLID",t[t.ISWALK=1]="ISWALK",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(Me||{}),Si=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(Si||{});function Dt(t){return g(t)&&g(t.x)&&g(t.y)}function at(t,e){switch(e){case 1:--t.y;break;case 2:++t.y;break;case 3:--t.x;break;case 4:++t.x;break}return t}function xn(t,e){const n=e.x-t.x,r=e.y-t.y;if(n<0)return 3;if(n>0)return 4;if(r<0)return 1;if(r>0)return 2}const zu={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Un(t){return ge(t)&&Yu(t[0])}function Yu(t){return g(Si[t])&&z(t)}function qu(t){if(z(t))return zu[t.toLowerCase()]}function Xu(t){if(Un(t))return t;if(Yu(t))return[t];const e=qu(t);if(g(e))return[e]}function Ti(t,e){const n=t.words[e],r=Xu(n);if(Un(r))return[r,e+1];const[s,i]=$e(t,e),o=Xu(s);return Un(o)?[o,i]:[void 0,e]}const Ju={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalkable:"ISWALKABLE",isswimmable:"ISSWIMABLE"};function sr(t){return ge(t)&&Ua(t[0])}function Ua(t){return g(Me[t])&&z(t)}function EE(t){if(z(t))return Ju[t.toLowerCase()]}function Qu(t,e){const n=t.words[e];if(sr(n))return[n,e+1];if(Ua(n))return[[n],e+1];const[r,s]=$e(t,e);return sr(r)?[r,s]:Ua(r)?[[r],s]:[void 0,e]}const Pa={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",clear:"CLEAR",shadow:"SHADOW",borrow:"BORROW",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY"};function ct(t){return ge(t)&&eh(t[0])}function Zu(t){return ct(t)&&t[0].startsWith("ON")}function eh(t){return g(ve[t])&&z(t)}function th(t){if(z(t))return Pa[t.toLowerCase()]}function nh(t){return t.map(e=>ve[e]).find(e=>g(e)&&e<ve.ONBLACK)}function rh(t){return t.map(e=>ve[e]).find(e=>g(e)&&e>=ve.ONBLACK)}function sh(t){if(ct(t))return t;if(eh(t))return[t];const e=th(t);if(g(e))return[e]}function ih(t,e){const n=t.words[e],r=sh(n);if(ct(r))return[r,e+1];const[s,i]=$e(t,e),o=sh(s);return ct(o)?[o,i]:[void 0,e]}function Ai(t,e){const n=[];let r=e;const[s,i]=ih(t,e);if(ct(s)&&(n.push(...s),r=i),ct(n)&&!Zu(n)){const[o,a]=ih(t,i);Zu(o)&&(r=a)}return n.length?[n,r]:[void 0,e]}function Cr(t){return ge(t)&&typeof t[0]=="string"}function oh(t,e){const n=t.words[e];if(Cr(n))return[n,e+1];const[r,s]=Ai(t,e),[i,o]=$e(t,s,!1);return z(i)?[[i,r],o]:[void 0,e]}function Da(t){if(!Cr(t))return;const[e]=t;return e}function ah(t){if(!Cr(t))return;const[,e]=t,n=g(e)?nh(e):void 0;return g(n)?n:void 0}function ch(t){if(!Cr(t))return;const[,e]=t,n=g(e)?rh(e):void 0;return g(n)?n:void 0}const lh={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function fn(t){return ge(t)&&uh(t[0])}function uh(t){return g(H[t])&&z(t)}function wE(t){const e=H[t];return g(e)?e:0}function hh(t){if(z(t))return lh[t.toLowerCase()]}function fh(t){if(fn(t))return t;if(uh(t))return[t];const e=hh(t);if(g(e))return[e]}function dh(t,e){const n=t.words[e],r=fh(n);if(fn(r))return[r,e+1];const[s,i]=$e(t,e),o=fh(s);return fn(o)?[o,i]:[void 0,e]}function $a(t,e){const n=[];let[r,s]=dh(t,e);for(;fn(r);){if(n.push(...r),r[0]==="AT"||r[0]==="BY"){const[a,c,l]=R(t,s,[5,5]);n.push(a,c),s=l}const[i,o]=dh(t,s);r=i,s=o}return n.length?[n,s]:[void 0,e]}function $e(t,e,n=!0){const r=t.words[e];if(qu(r)){const[s,i]=Ti(t,e);if(g(s))return[s,i]}if(EE(r)){const[s,i]=Qu(t,e);if(g(s))return[s,i]}if(th(r)){const[s,i]=Ai(t,e);if(g(s))return[s,i]}if(z(r)&&r.toLowerCase()==="rnd"){const[s,i]=$e(t,e+1),[o,a]=$e(t,i);return pe(s)&&pe(o)?[Ei(s,o),a]:pe(s)?[Ei(0,s),i]:[Ei(0,1),e+1]}if(hh(r)){const[s,i]=$a(t,e);if(g(s))return[s,i]}if(!g(r))return[void 0,e];if(Dt(r)||pe(r)||ge(r))return[r,e+1];if(z(r)){const s=r.toLowerCase();if(n){const i=t.get(r);if(g(i))return[i,e+1]}switch(s){case"aligned":case"alligned":break;case"contact":break;case"blocked":break;case"any":break;case"abs":{const[i,o]=R(t,e+1,[5]);return[Math.abs(i),o]}case"ceil":{const[i,o]=R(t,e+1,[5]);return[Math.ceil(i),o]}case"floor":{const[i,o]=R(t,e+1,[5]);return[Math.floor(i),o]}case"round":{const[i,o]=R(t,e+1,[5]);return[Math.round(i),o]}case"min":{const i=[];for(let o=e+1;o<t.words.length;){const[a,c]=$e(t,o);if(ge(a)&&!Dt(a)&&!fn(a)&&!Un(a)&&!sr(a)&&!ct(a))return[hn(a),c];o=c,i.push(a)}return[Math.min(...i),t.words.length]}case"max":{const i=[];for(let o=e+1;o<t.words.length;){const[a,c]=$e(t,o);if(ge(a)&&!Dt(a)&&!fn(a)&&!Un(a)&&!sr(a)&&!ct(a))return[hn(a),c];o=c,i.push(a)}return[Math.max(...i),t.words.length]}case"clamp":{const[i,o,a,c]=R(t,e+1,[5,5,5]);return[rr(i,o,a),c]}case"pick":{const i=[];for(let o=e+1;o<t.words.length;){const[a,c]=$e(t,o);if(ge(a)&&!Dt(a)&&!fn(a)&&!Un(a)&&!sr(a)&&!ct(a))return[hn(a),c];o=c,i.push(a)}return[hn(i),t.words.length]}case"range":{const[i,o,a,c]=R(t,e+1,[5,13,13]);return[va(i,o,a),c]}}}return[r,e+1]}var k=(t=>(t[t.CATEGORY=0]="CATEGORY",t[t.COLLISION=1]="COLLISION",t[t.COLOR=2]="COLOR",t[t.KIND=3]="KIND",t[t.DIR=4]="DIR",t[t.NUMBER=5]="NUMBER",t[t.STRING=6]="STRING",t[t.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",t[t.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",t[t.MAYBE_COLLISION=9]="MAYBE_COLLISION",t[t.MAYBE_COLOR=10]="MAYBE_COLOR",t[t.MAYBE_KIND=11]="MAYBE_KIND",t[t.MAYBE_DIR=12]="MAYBE_DIR",t[t.MAYBE_NUMBER=13]="MAYBE_NUMBER",t[t.MAYBE_STRING=14]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",t[t.ANY=16]="ANY",t))(k||{});function xe(t,e){throw new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function R(t,e,n){const r=[];let s=e;for(let i=0;i<n.length;++i)switch(n[i]){case 0:{const[o,a]=Ti(t,s);Un(o)||xe("terrain or object",o),s=a,r.push(o);break}case 1:{const[o,a]=Qu(t,s);sr(o)||xe("solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 2:{const[o,a]=Ai(t,s);ct(o)||xe("color",o),s=a,r.push(o);break}case 3:{const[o,a]=oh(t,s);Cr(o)?(s=a,r.push(o)):xe("kind",o);break}case 4:{const[o,a]=$a(t,s);if(fn(o)){const c=t.board?Nr(t.board,t.object,o):{x:0,y:0};s=a,r.push(c)}else xe("direction",o);break}case 5:{const[o,a]=$e(t,s);pe(o)||xe("number",o),s=a,r.push(o);break}case 6:{const o=t.words[s];z(o)||xe("string",o),++s,r.push(o);break}case 7:{const[o,a]=$e(t,s,!1);!pe(o)&&!z(o)&&xe("number or string",o),s=a,r.push(o);break}case 8:{const[o,a]=Ti(t,s);o!==void 0&&!Un(o)&&xe("optional terrain or object",o),s=a,r.push(o);break}case 9:{const[o,a]=Ti(t,s);o!==void 0&&!sr(o)&&xe("optional solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 10:{const[o,a]=Ai(t,s);o!==void 0&&!ct(o)&&xe("optional color",o),s=a,r.push(o);break}case 11:{const[o,a]=oh(t,s);o!==void 0&&!Cr(o)&&xe("optional kind",o),s=a,r.push(o);break}case 12:{const[o,a]=$a(t,s);if(fn(o)){const c=t.board?Nr(t.board,t.object,o):{x:0,y:0};s=a,r.push(c)}else o===void 0?(s=a,r.push(void 0)):xe("optional direction",o);break}case 13:{const[o,a]=$e(t,s);o!==void 0&&!pe(o)&&xe("optional number",o),s=a,r.push(o);break}case 14:{const o=t.words[s];o!==void 0&&!z(o)&&xe("optional string",o),++s,r.push(o);break}case 15:{const[o,a]=$e(t,s,!1);o!==void 0&&!pe(o)&&!z(o)&&xe("optional number or string",o),s=a,r.push(o);break}case 16:{const[o,a]=$e(t,s);s=a,r.push(o);break}}return[...r,s]}const Ba=40,Fa=Math.round(1e3/Ba),ph=3;var gh=typeof global=="object"&&global&&global.Object===Object&&global,bE=typeof self=="object"&&self&&self.Object===Object&&self,$t=gh||bE||Function("return this")(),lt=$t.Symbol,mh=Object.prototype,SE=mh.hasOwnProperty,TE=mh.toString,fs=lt?lt.toStringTag:void 0;function AE(t){var e=SE.call(t,fs),n=t[fs];try{t[fs]=void 0;var r=!0}catch{}var s=TE.call(t);return r&&(e?t[fs]=n:delete t[fs]),s}var vE=Object.prototype,kE=vE.toString;function RE(t){return kE.call(t)}var OE="[object Null]",IE="[object Undefined]",yh=lt?lt.toStringTag:void 0;function Pn(t){return t==null?t===void 0?IE:OE:yh&&yh in Object(t)?AE(t):RE(t)}function bt(t){return t!=null&&typeof t=="object"}var NE="[object Symbol]";function vi(t){return typeof t=="symbol"||bt(t)&&Pn(t)==NE}function ki(t,e){for(var n=-1,r=t==null?0:t.length,s=Array(r);++n<r;)s[n]=e(t[n],n,t);return s}var K=Array.isArray,CE=1/0,_h=lt?lt.prototype:void 0,Eh=_h?_h.toString:void 0;function wh(t){if(typeof t=="string")return t;if(K(t))return ki(t,wh)+"";if(vi(t))return Eh?Eh.call(t):"";var e=t+"";return e=="0"&&1/t==-CE?"-0":e}var LE=/\s/;function ME(t){for(var e=t.length;e--&&LE.test(t.charAt(e)););return e}var xE=/^\s+/;function UE(t){return t&&t.slice(0,ME(t)+1).replace(xE,"")}function ut(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var bh=NaN,PE=/^[-+]0x[0-9a-f]+$/i,DE=/^0b[01]+$/i,$E=/^0o[0-7]+$/i,BE=parseInt;function FE(t){if(typeof t=="number")return t;if(vi(t))return bh;if(ut(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=ut(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=UE(t);var n=DE.test(t);return n||$E.test(t)?BE(t.slice(2),n?2:8):PE.test(t)?bh:+t}var Sh=1/0,jE=17976931348623157e292;function GE(t){if(!t)return t===0?t:0;if(t=FE(t),t===Sh||t===-Sh){var e=t<0?-1:1;return e*jE}return t===t?t:0}function Ri(t){var e=GE(t),n=e%1;return e===e?n?e-n:e:0}function Lr(t){return t}var KE="[object AsyncFunction]",WE="[object Function]",HE="[object GeneratorFunction]",VE="[object Proxy]";function dn(t){if(!ut(t))return!1;var e=Pn(t);return e==WE||e==HE||e==KE||e==VE}var ja=$t["__core-js_shared__"],Th=function(){var t=/[^.]+$/.exec(ja&&ja.keys&&ja.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function zE(t){return!!Th&&Th in t}var YE=Function.prototype,qE=YE.toString;function ir(t){if(t!=null){try{return qE.call(t)}catch{}try{return t+""}catch{}}return""}var XE=/[\\^$.*+?()[\]{}|]/g,JE=/^\[object .+?Constructor\]$/,QE=Function.prototype,ZE=Object.prototype,ew=QE.toString,tw=ZE.hasOwnProperty,nw=RegExp("^"+ew.call(tw).replace(XE,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function rw(t){if(!ut(t)||zE(t))return!1;var e=dn(t)?nw:JE;return e.test(ir(t))}function sw(t,e){return t==null?void 0:t[e]}function or(t,e){var n=sw(t,e);return rw(n)?n:void 0}var Ga=or($t,"WeakMap"),Ah=Object.create,iw=function(){function t(){}return function(e){if(!ut(e))return{};if(Ah)return Ah(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function ow(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function ye(){}function aw(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var cw=800,lw=16,uw=Date.now;function hw(t){var e=0,n=0;return function(){var r=uw(),s=lw-(r-n);if(n=r,s>0){if(++e>=cw)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function fw(t){return function(){return t}}var Oi=function(){try{var t=or(Object,"defineProperty");return t({},"",{}),t}catch{}}(),dw=Oi?function(t,e){return Oi(t,"toString",{configurable:!0,enumerable:!1,value:fw(e),writable:!0})}:Lr,pw=hw(dw);function vh(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function kh(t,e,n,r){for(var s=t.length,i=n+-1;++i<s;)if(e(t[i],i,t))return i;return-1}function gw(t){return t!==t}function mw(t,e,n){for(var r=n-1,s=t.length;++r<s;)if(t[r]===e)return r;return-1}function Ka(t,e,n){return e===e?mw(t,e,n):kh(t,gw,n)}function Rh(t,e){var n=t==null?0:t.length;return!!n&&Ka(t,e,0)>-1}var yw=9007199254740991,_w=/^(?:0|[1-9]\d*)$/;function Ii(t,e){var n=typeof t;return e=e??yw,!!e&&(n=="number"||n!="symbol"&&_w.test(t))&&t>-1&&t%1==0&&t<e}function Wa(t,e,n){e=="__proto__"&&Oi?Oi(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ds(t,e){return t===e||t!==t&&e!==e}var Ew=Object.prototype,ww=Ew.hasOwnProperty;function Ni(t,e,n){var r=t[e];(!(ww.call(t,e)&&ds(r,n))||n===void 0&&!(e in t))&&Wa(t,e,n)}function Ha(t,e,n,r){var s=!n;n||(n={});for(var i=-1,o=e.length;++i<o;){var a=e[i],c=void 0;c===void 0&&(c=t[a]),s?Wa(n,a,c):Ni(n,a,c)}return n}var Oh=Math.max;function bw(t,e,n){return e=Oh(e===void 0?t.length-1:e,0),function(){for(var r=arguments,s=-1,i=Oh(r.length-e,0),o=Array(i);++s<i;)o[s]=r[e+s];s=-1;for(var a=Array(e+1);++s<e;)a[s]=r[s];return a[e]=n(o),ow(t,this,a)}}function Va(t,e){return pw(bw(t,e,Lr),t+"")}var Sw=9007199254740991;function za(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Sw}function Bt(t){return t!=null&&za(t.length)&&!dn(t)}function Ih(t,e,n){if(!ut(n))return!1;var r=typeof e;return(r=="number"?Bt(n)&&Ii(e,n.length):r=="string"&&e in n)?ds(n[e],t):!1}function Tw(t){return Va(function(e,n){var r=-1,s=n.length,i=s>1?n[s-1]:void 0,o=s>2?n[2]:void 0;for(i=t.length>3&&typeof i=="function"?(s--,i):void 0,o&&Ih(n[0],n[1],o)&&(i=s<3?void 0:i,s=1),e=Object(e);++r<s;){var a=n[r];a&&t(e,a,r,i)}return e})}var Aw=Object.prototype;function ps(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||Aw;return t===n}function vw(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var kw="[object Arguments]";function Nh(t){return bt(t)&&Pn(t)==kw}var Ch=Object.prototype,Rw=Ch.hasOwnProperty,Ow=Ch.propertyIsEnumerable,Ci=Nh(function(){return arguments}())?Nh:function(t){return bt(t)&&Rw.call(t,"callee")&&!Ow.call(t,"callee")};function Iw(){return!1}var Lh=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Mh=Lh&&typeof module=="object"&&module&&!module.nodeType&&module,Nw=Mh&&Mh.exports===Lh,xh=Nw?$t.Buffer:void 0,Cw=xh?xh.isBuffer:void 0,gs=Cw||Iw,Lw="[object Arguments]",Mw="[object Array]",xw="[object Boolean]",Uw="[object Date]",Pw="[object Error]",Dw="[object Function]",$w="[object Map]",Bw="[object Number]",Fw="[object Object]",jw="[object RegExp]",Gw="[object Set]",Kw="[object String]",Ww="[object WeakMap]",Hw="[object ArrayBuffer]",Vw="[object DataView]",zw="[object Float32Array]",Yw="[object Float64Array]",qw="[object Int8Array]",Xw="[object Int16Array]",Jw="[object Int32Array]",Qw="[object Uint8Array]",Zw="[object Uint8ClampedArray]",eb="[object Uint16Array]",tb="[object Uint32Array]",re={};re[zw]=re[Yw]=re[qw]=re[Xw]=re[Jw]=re[Qw]=re[Zw]=re[eb]=re[tb]=!0,re[Lw]=re[Mw]=re[Hw]=re[xw]=re[Vw]=re[Uw]=re[Pw]=re[Dw]=re[$w]=re[Bw]=re[Fw]=re[jw]=re[Gw]=re[Kw]=re[Ww]=!1;function nb(t){return bt(t)&&za(t.length)&&!!re[Pn(t)]}function Li(t){return function(e){return t(e)}}var Uh=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ms=Uh&&typeof module=="object"&&module&&!module.nodeType&&module,rb=ms&&ms.exports===Uh,Ya=rb&&gh.process,Dn=function(){try{var t=ms&&ms.require&&ms.require("util").types;return t||Ya&&Ya.binding&&Ya.binding("util")}catch{}}(),Ph=Dn&&Dn.isTypedArray,qa=Ph?Li(Ph):nb,sb=Object.prototype,ib=sb.hasOwnProperty;function Dh(t,e){var n=K(t),r=!n&&Ci(t),s=!n&&!r&&gs(t),i=!n&&!r&&!s&&qa(t),o=n||r||s||i,a=o?vw(t.length,String):[],c=a.length;for(var l in t)(e||ib.call(t,l))&&!(o&&(l=="length"||s&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Ii(l,c)))&&a.push(l);return a}function $h(t,e){return function(n){return t(e(n))}}var ob=$h(Object.keys,Object),ab=Object.prototype,cb=ab.hasOwnProperty;function Bh(t){if(!ps(t))return ob(t);var e=[];for(var n in Object(t))cb.call(t,n)&&n!="constructor"&&e.push(n);return e}function ht(t){return Bt(t)?Dh(t):Bh(t)}var lb=Object.prototype,ub=lb.hasOwnProperty,Ze=Tw(function(t,e){if(ps(e)||Bt(e)){Ha(e,ht(e),t);return}for(var n in e)ub.call(e,n)&&Ni(t,n,e[n])});function hb(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var fb=Object.prototype,db=fb.hasOwnProperty;function pb(t){if(!ut(t))return hb(t);var e=ps(t),n=[];for(var r in t)r=="constructor"&&(e||!db.call(t,r))||n.push(r);return n}function Fh(t){return Bt(t)?Dh(t,!0):pb(t)}var gb=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,mb=/^\w*$/;function Xa(t,e){if(K(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||vi(t)?!0:mb.test(t)||!gb.test(t)||e!=null&&t in Object(e)}var ys=or(Object,"create");function yb(){this.__data__=ys?ys(null):{},this.size=0}function _b(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Eb="__lodash_hash_undefined__",wb=Object.prototype,bb=wb.hasOwnProperty;function Sb(t){var e=this.__data__;if(ys){var n=e[t];return n===Eb?void 0:n}return bb.call(e,t)?e[t]:void 0}var Tb=Object.prototype,Ab=Tb.hasOwnProperty;function vb(t){var e=this.__data__;return ys?e[t]!==void 0:Ab.call(e,t)}var kb="__lodash_hash_undefined__";function Rb(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ys&&e===void 0?kb:e,this}function ar(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ar.prototype.clear=yb,ar.prototype.delete=_b,ar.prototype.get=Sb,ar.prototype.has=vb,ar.prototype.set=Rb;function Ob(){this.__data__=[],this.size=0}function Mi(t,e){for(var n=t.length;n--;)if(ds(t[n][0],e))return n;return-1}var Ib=Array.prototype,Nb=Ib.splice;function Cb(t){var e=this.__data__,n=Mi(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Nb.call(e,n,1),--this.size,!0}function Lb(t){var e=this.__data__,n=Mi(e,t);return n<0?void 0:e[n][1]}function Mb(t){return Mi(this.__data__,t)>-1}function xb(t,e){var n=this.__data__,r=Mi(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function pn(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}pn.prototype.clear=Ob,pn.prototype.delete=Cb,pn.prototype.get=Lb,pn.prototype.has=Mb,pn.prototype.set=xb;var _s=or($t,"Map");function Ub(){this.size=0,this.__data__={hash:new ar,map:new(_s||pn),string:new ar}}function Pb(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function xi(t,e){var n=t.__data__;return Pb(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Db(t){var e=xi(this,t).delete(t);return this.size-=e?1:0,e}function $b(t){return xi(this,t).get(t)}function Bb(t){return xi(this,t).has(t)}function Fb(t,e){var n=xi(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function gn(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}gn.prototype.clear=Ub,gn.prototype.delete=Db,gn.prototype.get=$b,gn.prototype.has=Bb,gn.prototype.set=Fb;var jb="Expected a function";function Ja(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(jb);var n=function(){var r=arguments,s=e?e.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var o=t.apply(this,r);return n.cache=i.set(s,o)||i,o};return n.cache=new(Ja.Cache||gn),n}Ja.Cache=gn;var Gb=500;function Kb(t){var e=Ja(t,function(r){return n.size===Gb&&n.clear(),r}),n=e.cache;return e}var Wb=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Hb=/\\(\\)?/g,Vb=Kb(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Wb,function(n,r,s,i){e.push(s?i.replace(Hb,"$1"):r||n)}),e});function zb(t){return t==null?"":wh(t)}function Ui(t,e){return K(t)?t:Xa(t,e)?[t]:Vb(zb(t))}var Yb=1/0;function Es(t){if(typeof t=="string"||vi(t))return t;var e=t+"";return e=="0"&&1/t==-Yb?"-0":e}function Qa(t,e){e=Ui(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[Es(e[n++])];return n&&n==r?t:void 0}function qb(t,e,n){var r=t==null?void 0:Qa(t,e);return r===void 0?n:r}function Za(t,e){for(var n=-1,r=e.length,s=t.length;++n<r;)t[s+n]=e[n];return t}var jh=lt?lt.isConcatSpreadable:void 0;function Xb(t){return K(t)||Ci(t)||!!(jh&&t&&t[jh])}function ec(t,e,n,r,s){var i=-1,o=t.length;for(n||(n=Xb),s||(s=[]);++i<o;){var a=t[i];n(a)?Za(s,a):r||(s[s.length]=a)}return s}function St(t){var e=t==null?0:t.length;return e?ec(t):[]}var Gh=$h(Object.getPrototypeOf,Object);function Kh(t,e,n){var r=-1,s=t.length;e<0&&(e=-e>s?0:s+e),n=n>s?s:n,n<0&&(n+=s),s=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(s);++r<s;)i[r]=t[r+e];return i}function Jb(t,e,n,r){var s=-1,i=t==null?0:t.length;for(r&&i&&(n=t[++s]);++s<i;)n=e(n,t[s],s,t);return n}function Qb(){this.__data__=new pn,this.size=0}function Zb(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function eS(t){return this.__data__.get(t)}function tS(t){return this.__data__.has(t)}var nS=200;function rS(t,e){var n=this.__data__;if(n instanceof pn){var r=n.__data__;if(!_s||r.length<nS-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new gn(r)}return n.set(t,e),this.size=n.size,this}function Ft(t){var e=this.__data__=new pn(t);this.size=e.size}Ft.prototype.clear=Qb,Ft.prototype.delete=Zb,Ft.prototype.get=eS,Ft.prototype.has=tS,Ft.prototype.set=rS;function sS(t,e){return t&&Ha(e,ht(e),t)}var Wh=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Hh=Wh&&typeof module=="object"&&module&&!module.nodeType&&module,iS=Hh&&Hh.exports===Wh,Vh=iS?$t.Buffer:void 0,zh=Vh?Vh.allocUnsafe:void 0;function oS(t,e){var n=t.length,r=zh?zh(n):new t.constructor(n);return t.copy(r),r}function tc(t,e){for(var n=-1,r=t==null?0:t.length,s=0,i=[];++n<r;){var o=t[n];e(o,n,t)&&(i[s++]=o)}return i}function Yh(){return[]}var aS=Object.prototype,cS=aS.propertyIsEnumerable,qh=Object.getOwnPropertySymbols,nc=qh?function(t){return t==null?[]:(t=Object(t),tc(qh(t),function(e){return cS.call(t,e)}))}:Yh;function lS(t,e){return Ha(t,nc(t),e)}var uS=Object.getOwnPropertySymbols,hS=uS?function(t){for(var e=[];t;)Za(e,nc(t)),t=Gh(t);return e}:Yh;function Xh(t,e,n){var r=e(t);return K(t)?r:Za(r,n(t))}function rc(t){return Xh(t,ht,nc)}function fS(t){return Xh(t,Fh,hS)}var sc=or($t,"DataView"),ic=or($t,"Promise"),Mr=or($t,"Set"),Jh="[object Map]",dS="[object Object]",Qh="[object Promise]",Zh="[object Set]",ef="[object WeakMap]",tf="[object DataView]",pS=ir(sc),gS=ir(_s),mS=ir(ic),yS=ir(Mr),_S=ir(Ga),ft=Pn;(sc&&ft(new sc(new ArrayBuffer(1)))!=tf||_s&&ft(new _s)!=Jh||ic&&ft(ic.resolve())!=Qh||Mr&&ft(new Mr)!=Zh||Ga&&ft(new Ga)!=ef)&&(ft=function(t){var e=Pn(t),n=e==dS?t.constructor:void 0,r=n?ir(n):"";if(r)switch(r){case pS:return tf;case gS:return Jh;case mS:return Qh;case yS:return Zh;case _S:return ef}return e});var ES=Object.prototype,wS=ES.hasOwnProperty;function bS(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&wS.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var Pi=$t.Uint8Array;function SS(t){var e=new t.constructor(t.byteLength);return new Pi(e).set(new Pi(t)),e}function TS(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var AS=/\w*$/;function vS(t){var e=new t.constructor(t.source,AS.exec(t));return e.lastIndex=t.lastIndex,e}var nf=lt?lt.prototype:void 0,rf=nf?nf.valueOf:void 0;function kS(t){return rf?Object(rf.call(t)):{}}function RS(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var OS="[object Boolean]",IS="[object Date]",NS="[object Map]",CS="[object Number]",LS="[object RegExp]",MS="[object Set]",xS="[object String]",US="[object Symbol]",PS="[object ArrayBuffer]",DS="[object DataView]",$S="[object Float32Array]",BS="[object Float64Array]",FS="[object Int8Array]",jS="[object Int16Array]",GS="[object Int32Array]",KS="[object Uint8Array]",WS="[object Uint8ClampedArray]",HS="[object Uint16Array]",VS="[object Uint32Array]";function zS(t,e,n){var r=t.constructor;switch(e){case PS:return SS(t);case OS:case IS:return new r(+t);case DS:return TS(t);case $S:case BS:case FS:case jS:case GS:case KS:case WS:case HS:case VS:return RS(t);case NS:return new r;case CS:case xS:return new r(t);case LS:return vS(t);case MS:return new r;case US:return kS(t)}}function YS(t){return typeof t.constructor=="function"&&!ps(t)?iw(Gh(t)):{}}var qS="[object Map]";function XS(t){return bt(t)&&ft(t)==qS}var sf=Dn&&Dn.isMap,JS=sf?Li(sf):XS,QS="[object Set]";function ZS(t){return bt(t)&&ft(t)==QS}var of=Dn&&Dn.isSet,eT=of?Li(of):ZS,af="[object Arguments]",tT="[object Array]",nT="[object Boolean]",rT="[object Date]",sT="[object Error]",cf="[object Function]",iT="[object GeneratorFunction]",oT="[object Map]",aT="[object Number]",lf="[object Object]",cT="[object RegExp]",lT="[object Set]",uT="[object String]",hT="[object Symbol]",fT="[object WeakMap]",dT="[object ArrayBuffer]",pT="[object DataView]",gT="[object Float32Array]",mT="[object Float64Array]",yT="[object Int8Array]",_T="[object Int16Array]",ET="[object Int32Array]",wT="[object Uint8Array]",bT="[object Uint8ClampedArray]",ST="[object Uint16Array]",TT="[object Uint32Array]",Q={};Q[af]=Q[tT]=Q[dT]=Q[pT]=Q[nT]=Q[rT]=Q[gT]=Q[mT]=Q[yT]=Q[_T]=Q[ET]=Q[oT]=Q[aT]=Q[lf]=Q[cT]=Q[lT]=Q[uT]=Q[hT]=Q[wT]=Q[bT]=Q[ST]=Q[TT]=!0,Q[sT]=Q[cf]=Q[fT]=!1;function Di(t,e,n,r,s,i){var o;if(o!==void 0)return o;if(!ut(t))return t;var a=K(t);if(a)return o=bS(t),aw(t,o);var c=ft(t),l=c==cf||c==iT;if(gs(t))return oS(t);if(c==lf||c==af||l&&!s)return o=l?{}:YS(t),lS(t,sS(o,t));if(!Q[c])return s?t:{};o=zS(t,c),i||(i=new Ft);var u=i.get(t);if(u)return u;i.set(t,o),eT(t)?t.forEach(function(f){o.add(Di(f,e,n,f,t,i))}):JS(t)&&t.forEach(function(f,p){o.set(p,Di(f,e,n,p,t,i))});var h=rc,d=a?void 0:h(t);return vh(d||t,function(f,p){d&&(p=f,f=t[p]),Ni(o,p,Di(f,e,n,p,t,i))}),o}var AT=4;function Ce(t){return Di(t,AT)}function ws(t){for(var e=-1,n=t==null?0:t.length,r=0,s=[];++e<n;){var i=t[e];i&&(s[r++]=i)}return s}var vT="__lodash_hash_undefined__";function kT(t){return this.__data__.set(t,vT),this}function RT(t){return this.__data__.has(t)}function xr(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new gn;++e<n;)this.add(t[e])}xr.prototype.add=xr.prototype.push=kT,xr.prototype.has=RT;function uf(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function oc(t,e){return t.has(e)}var OT=1,IT=2;function hf(t,e,n,r,s,i){var o=n&OT,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=i.get(t),u=i.get(e);if(l&&u)return l==e&&u==t;var h=-1,d=!0,f=n&IT?new xr:void 0;for(i.set(t,e),i.set(e,t);++h<a;){var p=t[h],_=e[h];if(r)var S=o?r(_,p,h,e,t,i):r(p,_,h,t,e,i);if(S!==void 0){if(S)continue;d=!1;break}if(f){if(!uf(e,function(T,E){if(!oc(f,E)&&(p===T||s(p,T,n,r,i)))return f.push(E)})){d=!1;break}}else if(!(p===_||s(p,_,n,r,i))){d=!1;break}}return i.delete(t),i.delete(e),d}function NT(t){var e=-1,n=Array(t.size);return t.forEach(function(r,s){n[++e]=[s,r]}),n}function ac(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var CT=1,LT=2,MT="[object Boolean]",xT="[object Date]",UT="[object Error]",PT="[object Map]",DT="[object Number]",$T="[object RegExp]",BT="[object Set]",FT="[object String]",jT="[object Symbol]",GT="[object ArrayBuffer]",KT="[object DataView]",ff=lt?lt.prototype:void 0,cc=ff?ff.valueOf:void 0;function WT(t,e,n,r,s,i,o){switch(n){case KT:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case GT:return!(t.byteLength!=e.byteLength||!i(new Pi(t),new Pi(e)));case MT:case xT:case DT:return ds(+t,+e);case UT:return t.name==e.name&&t.message==e.message;case $T:case FT:return t==e+"";case PT:var a=NT;case BT:var c=r&CT;if(a||(a=ac),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=LT,o.set(t,e);var u=hf(a(t),a(e),r,s,i,o);return o.delete(t),u;case jT:if(cc)return cc.call(t)==cc.call(e)}return!1}var HT=1,VT=Object.prototype,zT=VT.hasOwnProperty;function YT(t,e,n,r,s,i){var o=n&HT,a=rc(t),c=a.length,l=rc(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in e:zT.call(e,d)))return!1}var f=i.get(t),p=i.get(e);if(f&&p)return f==e&&p==t;var _=!0;i.set(t,e),i.set(e,t);for(var S=o;++h<c;){d=a[h];var T=t[d],E=e[d];if(r)var A=o?r(E,T,d,e,t,i):r(T,E,d,t,e,i);if(!(A===void 0?T===E||s(T,E,n,r,i):A)){_=!1;break}S||(S=d=="constructor")}if(_&&!S){var O=t.constructor,w=e.constructor;O!=w&&"constructor"in t&&"constructor"in e&&!(typeof O=="function"&&O instanceof O&&typeof w=="function"&&w instanceof w)&&(_=!1)}return i.delete(t),i.delete(e),_}var qT=1,df="[object Arguments]",pf="[object Array]",$i="[object Object]",XT=Object.prototype,gf=XT.hasOwnProperty;function JT(t,e,n,r,s,i){var o=K(t),a=K(e),c=o?pf:ft(t),l=a?pf:ft(e);c=c==df?$i:c,l=l==df?$i:l;var u=c==$i,h=l==$i,d=c==l;if(d&&gs(t)){if(!gs(e))return!1;o=!0,u=!1}if(d&&!u)return i||(i=new Ft),o||qa(t)?hf(t,e,n,r,s,i):WT(t,e,c,n,r,s,i);if(!(n&qT)){var f=u&&gf.call(t,"__wrapped__"),p=h&&gf.call(e,"__wrapped__");if(f||p){var _=f?t.value():t,S=p?e.value():e;return i||(i=new Ft),s(_,S,n,r,i)}}return d?(i||(i=new Ft),YT(t,e,n,r,s,i)):!1}function lc(t,e,n,r,s){return t===e?!0:t==null||e==null||!bt(t)&&!bt(e)?t!==t&&e!==e:JT(t,e,n,r,lc,s)}var QT=1,ZT=2;function eA(t,e,n,r){var s=n.length,i=s;if(t==null)return!i;for(t=Object(t);s--;){var o=n[s];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++s<i;){o=n[s];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new Ft,h;if(!(h===void 0?lc(l,c,QT|ZT,r,u):h))return!1}}return!0}function mf(t){return t===t&&!ut(t)}function tA(t){for(var e=ht(t),n=e.length;n--;){var r=e[n],s=t[r];e[n]=[r,s,mf(s)]}return e}function yf(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function nA(t){var e=tA(t);return e.length==1&&e[0][2]?yf(e[0][0],e[0][1]):function(n){return n===t||eA(n,t,e)}}function rA(t,e){return t!=null&&e in Object(t)}function _f(t,e,n){e=Ui(e,t);for(var r=-1,s=e.length,i=!1;++r<s;){var o=Es(e[r]);if(!(i=t!=null&&n(t,o)))break;t=t[o]}return i||++r!=s?i:(s=t==null?0:t.length,!!s&&za(s)&&Ii(o,s)&&(K(t)||Ci(t)))}function sA(t,e){return t!=null&&_f(t,e,rA)}var iA=1,oA=2;function aA(t,e){return Xa(t)&&mf(e)?yf(Es(t),e):function(n){var r=qb(n,t);return r===void 0&&r===e?sA(n,t):lc(e,r,iA|oA)}}function cA(t){return function(e){return e==null?void 0:e[t]}}function lA(t){return function(e){return Qa(e,t)}}function uA(t){return Xa(t)?cA(Es(t)):lA(t)}function jt(t){return typeof t=="function"?t:t==null?Lr:typeof t=="object"?K(t)?aA(t[0],t[1]):nA(t):uA(t)}function hA(t,e,n,r){for(var s=-1,i=t==null?0:t.length;++s<i;){var o=t[s];e(r,o,n(o),t)}return r}function fA(t){return function(e,n,r){for(var s=-1,i=Object(e),o=r(e),a=o.length;a--;){var c=o[++s];if(n(i[c],c,i)===!1)break}return e}}var dA=fA();function pA(t,e){return t&&dA(t,e,ht)}function gA(t,e){return function(n,r){if(n==null)return n;if(!Bt(n))return t(n,r);for(var s=n.length,i=-1,o=Object(n);++i<s&&r(o[i],i,o)!==!1;);return n}}var cr=gA(pA);function mA(t,e,n,r){return cr(t,function(s,i,o){e(r,s,n(s),o)}),r}function yA(t,e){return function(n,r){var s=K(n)?hA:mA,i=e?e():{};return s(n,t,jt(r),i)}}var Ef=Object.prototype,_A=Ef.hasOwnProperty,uc=Va(function(t,e){t=Object(t);var n=-1,r=e.length,s=r>2?e[2]:void 0;for(s&&Ih(e[0],e[1],s)&&(r=1);++n<r;)for(var i=e[n],o=Fh(i),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||ds(u,Ef[l])&&!_A.call(t,l))&&(t[l]=i[l])}return t});function wf(t){return bt(t)&&Bt(t)}var EA=200;function wA(t,e,n,r){var s=-1,i=Rh,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=EA&&(i=oc,o=!1,e=new xr(e));e:for(;++s<a;){var u=t[s],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(e[d]===h)continue e;c.push(u)}else i(e,h,r)||c.push(u)}return c}var Bi=Va(function(t,e){return wf(t)?wA(t,ec(e,1,wf,!0)):[]});function Ur(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Le(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:Ri(e),Kh(t,e<0?0:e,r)):[]}function bs(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:Ri(e),e=r-e,Kh(t,0,e<0?0:e)):[]}function bA(t){return typeof t=="function"?t:Lr}function M(t,e){var n=K(t)?vh:cr;return n(t,bA(e))}function SA(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function TA(t,e){var n=!0;return cr(t,function(r,s,i){return n=!!e(r,s,i),n}),n}function Tt(t,e,n){var r=K(t)?SA:TA;return r(t,jt(e))}function bf(t,e){var n=[];return cr(t,function(r,s,i){e(r,s,i)&&n.push(r)}),n}function dt(t,e){var n=K(t)?tc:bf;return n(t,jt(e))}function AA(t){return function(e,n,r){var s=Object(e);if(!Bt(e)){var i=jt(n);e=ht(e),n=function(a){return i(s[a],a,s)}}var o=t(e,n,r);return o>-1?s[i?e[o]:o]:void 0}}var vA=Math.max;function kA(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var s=n==null?0:Ri(n);return s<0&&(s=vA(r+s,0)),kh(t,jt(e),s)}var Pr=AA(kA);function At(t){return t&&t.length?t[0]:void 0}function RA(t,e){var n=-1,r=Bt(t)?Array(t.length):[];return cr(t,function(s,i,o){r[++n]=e(s,i,o)}),r}function N(t,e){var n=K(t)?ki:RA;return n(t,jt(e))}function pt(t,e){return ec(N(t,e))}var OA=Object.prototype,IA=OA.hasOwnProperty,NA=yA(function(t,e,n){IA.call(t,n)?t[n].push(e):Wa(t,n,[e])}),CA=Object.prototype,LA=CA.hasOwnProperty;function MA(t,e){return t!=null&&LA.call(t,e)}function L(t,e){return t!=null&&_f(t,e,MA)}var xA="[object String]";function He(t){return typeof t=="string"||!K(t)&&bt(t)&&Pn(t)==xA}function UA(t,e){return ki(e,function(n){return t[n]})}function _e(t){return t==null?[]:UA(t,ht(t))}var PA=Math.max;function Be(t,e,n,r){t=Bt(t)?t:_e(t),n=n&&!r?Ri(n):0;var s=t.length;return n<0&&(n=PA(s+n,0)),He(t)?n<=s&&t.indexOf(e,n)>-1:!!s&&Ka(t,e,n)>-1}function Sf(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var s=0;return Ka(t,e,s)}var DA="[object Map]",$A="[object Set]",BA=Object.prototype,FA=BA.hasOwnProperty;function Z(t){if(t==null)return!0;if(Bt(t)&&(K(t)||typeof t=="string"||typeof t.splice=="function"||gs(t)||qa(t)||Ci(t)))return!t.length;var e=ft(t);if(e==DA||e==$A)return!t.size;if(ps(t))return!Bh(t).length;for(var n in t)if(FA.call(t,n))return!1;return!0}var jA="[object RegExp]";function GA(t){return bt(t)&&Pn(t)==jA}var Tf=Dn&&Dn.isRegExp,mn=Tf?Li(Tf):GA;function yn(t){return t===void 0}var KA="Expected a function";function WA(t){if(typeof t!="function")throw new TypeError(KA);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function HA(t,e,n,r){if(!ut(t))return t;e=Ui(e,t);for(var s=-1,i=e.length,o=i-1,a=t;a!=null&&++s<i;){var c=Es(e[s]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(s!=o){var u=a[c];l=void 0,l===void 0&&(l=ut(u)?u:Ii(e[s+1])?[]:{})}Ni(a,c,l),a=a[c]}return t}function VA(t,e,n){for(var r=-1,s=e.length,i={};++r<s;){var o=e[r],a=Qa(t,o);n(a,o)&&HA(i,Ui(o,t),a)}return i}function vt(t,e){if(t==null)return{};var n=ki(fS(t),function(r){return[r]});return e=jt(e),VA(t,n,function(r,s){return e(r,s[0])})}function zA(t,e,n,r,s){return s(t,function(i,o,a){n=r?(r=!1,i):e(n,i,o,a)}),n}function et(t,e,n){var r=K(t)?Jb:zA,s=arguments.length<3;return r(t,jt(e),n,s,cr)}function Fi(t,e){var n=K(t)?tc:bf;return n(t,WA(jt(e)))}function YA(t,e){var n;return cr(t,function(r,s,i){return n=e(r,s,i),!n}),!!n}function Af(t,e,n){var r=K(t)?uf:YA;return r(t,jt(e))}var qA=1/0,XA=Mr&&1/ac(new Mr([,-0]))[1]==qA?function(t){return new Mr(t)}:ye,JA=200;function QA(t,e,n){var r=-1,s=Rh,i=t.length,o=!0,a=[],c=a;if(i>=JA){var l=XA(t);if(l)return ac(l);o=!1,s=oc,c=new xr}else c=a;e:for(;++r<i;){var u=t[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue e;a.push(u)}else s(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function hc(t){return t&&t.length?QA(t):[]}function fc(t){console&&console.error&&console.error(`Error: ${t}`)}function vf(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function kf(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function Rf(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function ZA(t){return ev(t)?t.LABEL:t.name}function ev(t){return He(t.LABEL)&&t.LABEL!==""}class Gt{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),M(this.definition,n=>{n.accept(e)})}}class tt extends Gt{constructor(e){super([]),this.idx=1,Ze(this,vt(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Dr extends Gt{constructor(e){super(e.definition),this.orgText="",Ze(this,vt(e,n=>n!==void 0))}}class Ve extends Gt{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Ze(this,vt(e,n=>n!==void 0))}}class ze extends Gt{constructor(e){super(e.definition),this.idx=1,Ze(this,vt(e,n=>n!==void 0))}}class Kt extends Gt{constructor(e){super(e.definition),this.idx=1,Ze(this,vt(e,n=>n!==void 0))}}class Wt extends Gt{constructor(e){super(e.definition),this.idx=1,Ze(this,vt(e,n=>n!==void 0))}}class Ee extends Gt{constructor(e){super(e.definition),this.idx=1,Ze(this,vt(e,n=>n!==void 0))}}class kt extends Gt{constructor(e){super(e.definition),this.idx=1,Ze(this,vt(e,n=>n!==void 0))}}class Rt extends Gt{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Ze(this,vt(e,n=>n!==void 0))}}class se{constructor(e){this.idx=1,Ze(this,vt(e,n=>n!==void 0))}accept(e){e.visit(this)}}function tv(t){return N(t,ji)}function ji(t){function e(n){return N(n,ji)}if(t instanceof tt){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return He(t.label)&&(n.label=t.label),n}else{if(t instanceof Ve)return{type:"Alternative",definition:e(t.definition)};if(t instanceof ze)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Kt)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof Wt)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:ji(new se({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof kt)return{type:"RepetitionWithSeparator",idx:t.idx,separator:ji(new se({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Ee)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Rt)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof se){const n={type:"Terminal",name:t.terminalType.name,label:ZA(t.terminalType),idx:t.idx};He(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=mn(r)?r.source:r),n}else{if(t instanceof Dr)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class $r{visit(e){const n=e;switch(n.constructor){case tt:return this.visitNonTerminal(n);case Ve:return this.visitAlternative(n);case ze:return this.visitOption(n);case Kt:return this.visitRepetitionMandatory(n);case Wt:return this.visitRepetitionMandatoryWithSeparator(n);case kt:return this.visitRepetitionWithSeparator(n);case Ee:return this.visitRepetition(n);case Rt:return this.visitAlternation(n);case se:return this.visitTerminal(n);case Dr:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function nv(t){return t instanceof Ve||t instanceof ze||t instanceof Ee||t instanceof Kt||t instanceof Wt||t instanceof kt||t instanceof se||t instanceof Dr}function Gi(t,e=[]){return t instanceof ze||t instanceof Ee||t instanceof kt?!0:t instanceof Rt?Af(t.definition,r=>Gi(r,e)):t instanceof tt&&Be(e,t)?!1:t instanceof Gt?(t instanceof tt&&e.push(t),Tt(t.definition,r=>Gi(r,e))):!1}function rv(t){return t instanceof Rt}function Ht(t){if(t instanceof tt)return"SUBRULE";if(t instanceof ze)return"OPTION";if(t instanceof Rt)return"OR";if(t instanceof Kt)return"AT_LEAST_ONE";if(t instanceof Wt)return"AT_LEAST_ONE_SEP";if(t instanceof kt)return"MANY_SEP";if(t instanceof Ee)return"MANY";if(t instanceof se)return"CONSUME";throw Error("non exhaustive match")}class Ki{walk(e,n=[]){M(e.definition,(r,s)=>{const i=Le(e.definition,s+1);if(r instanceof tt)this.walkProdRef(r,i,n);else if(r instanceof se)this.walkTerminal(r,i,n);else if(r instanceof Ve)this.walkFlat(r,i,n);else if(r instanceof ze)this.walkOption(r,i,n);else if(r instanceof Kt)this.walkAtLeastOne(r,i,n);else if(r instanceof Wt)this.walkAtLeastOneSep(r,i,n);else if(r instanceof kt)this.walkManySep(r,i,n);else if(r instanceof Ee)this.walkMany(r,i,n);else if(r instanceof Rt)this.walkOr(r,i,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const s=n.concat(r);this.walk(e,s)}walkOption(e,n,r){const s=n.concat(r);this.walk(e,s)}walkAtLeastOne(e,n,r){const s=[new ze({definition:e.definition})].concat(n,r);this.walk(e,s)}walkAtLeastOneSep(e,n,r){const s=Of(e,n,r);this.walk(e,s)}walkMany(e,n,r){const s=[new ze({definition:e.definition})].concat(n,r);this.walk(e,s)}walkManySep(e,n,r){const s=Of(e,n,r);this.walk(e,s)}walkOr(e,n,r){const s=n.concat(r);M(e.definition,i=>{const o=new Ve({definition:[i]});this.walk(o,s)})}}function Of(t,e,n){return[new ze({definition:[new se({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function Ss(t){if(t instanceof tt)return Ss(t.referencedRule);if(t instanceof se)return ov(t);if(nv(t))return sv(t);if(rv(t))return iv(t);throw Error("non exhaustive match")}function sv(t){let e=[];const n=t.definition;let r=0,s=n.length>r,i,o=!0;for(;s&&o;)i=n[r],o=Gi(i),e=e.concat(Ss(i)),r=r+1,s=n.length>r;return hc(e)}function iv(t){const e=N(t.definition,n=>Ss(n));return hc(St(e))}function ov(t){return[t.terminalType]}const If="_~IN~_";class av extends Ki{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const s=lv(e.referencedRule,e.idx)+this.topProd.name,i=n.concat(r),o=new Ve({definition:i}),a=Ss(o);this.follows[s]=a}}function cv(t){const e={};return M(t,n=>{const r=new av(n).startWalking();Ze(e,r)}),e}function lv(t,e){return t.name+e+If}function x(t){return t.charCodeAt(0)}function dc(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function Ts(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function Br(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function uv(){throw Error("Internal Error - Should never get here!")}function Nf(t){return t.type==="Character"}const Wi=[];for(let t=x("0");t<=x("9");t++)Wi.push(t);const Hi=[x("_")].concat(Wi);for(let t=x("a");t<=x("z");t++)Hi.push(t);for(let t=x("A");t<=x("Z");t++)Hi.push(t);const Cf=[x(" "),x("\f"),x(`
`),x("\r"),x("	"),x("\v"),x("	"),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x("\u2028"),x("\u2029"),x(""),x(""),x(""),x("\uFEFF")],hv=/[0-9a-fA-F]/,Vi=/[0-9]/,fv=/[1-9]/;class dv{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Ts(r,"global");break;case"i":Ts(r,"ignoreCase");break;case"m":Ts(r,"multiLine");break;case"u":Ts(r,"unicode");break;case"y":Ts(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Br(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return uv()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const s=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:s,atMost:s};break;case",":let i;this.isDigit()?(i=this.integerIncludingZero(),n={atLeast:s,atMost:i}):n={atLeast:s,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;Br(n);break}if(!(e===!0&&n===void 0)&&Br(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),Br(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[x(`
`),x("\r"),x("\u2028"),x("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=Wi;break;case"D":e=Wi,n=!0;break;case"s":e=Cf;break;case"S":e=Cf,n=!0;break;case"w":e=Hi;break;case"W":e=Hi,n=!0;break}if(Br(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=x("\f");break;case"n":e=x(`
`);break;case"r":e=x("\r");break;case"t":e=x("	");break;case"v":e=x("\v");break}if(Br(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:x("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:x(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:x(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,Nf(r)&&this.isRangeDash()){this.consumeChar("-");const s=this.classAtom();if(s.type,Nf(s)){if(s.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:s.value})}else dc(r.value,e),e.push(x("-")),dc(s.value,e)}else dc(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:x("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(fv.test(e)===!1)throw Error("Expecting a positive integer");for(;Vi.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Vi.test(e)===!1)throw Error("Expecting an integer");for(;Vi.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:x(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Vi.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let s=0;s<e;s++){const i=this.popChar();if(hv.test(i)===!1)throw Error("Expecting a HexDecimal digits");n+=i}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class pc{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(s=>{this.visit(s)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let zi={};const pv=new dv;function Yi(t){const e=t.toString();if(zi.hasOwnProperty(e))return zi[e];{const n=pv.pattern(e);return zi[e]=n,n}}function gv(){zi={}}const Lf="Complement Sets are not supported for first char optimization",qi=`Unable to use "first char" lexer optimizations:
`;function mv(t,e=!1){try{const n=Yi(t);return gc(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Lf)e&&vf(`${qi}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),fc(`${qi}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function gc(t,e,n){switch(t.type){case"Disjunction":for(let s=0;s<t.value.length;s++)gc(t.value[s],e,n);break;case"Alternative":const r=t.value;for(let s=0;s<r.length;s++){const i=r[s];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=i;switch(o.type){case"Character":Xi(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(Lf);M(o.value,c=>{if(typeof c=="number")Xi(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Xi(u,e,n);else{for(let u=l.from;u<=l.to&&u<vs;u++)Xi(u,e,n);if(l.to>=vs){const u=l.from>=vs?l.from:vs,h=l.to,d=$n(u),f=$n(h);for(let p=d;p<=f;p++)e[p]=p}}}});break;case"Group":gc(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&mc(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return _e(e)}function Xi(t,e,n){const r=$n(t);e[r]=r,n===!0&&yv(t,e)}function yv(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const s=$n(r.charCodeAt(0));e[s]=s}else{const s=n.toLowerCase();if(s!==n){const i=$n(s.charCodeAt(0));e[i]=i}}}function Mf(t,e){return Pr(t.value,n=>{if(typeof n=="number")return Be(e,n);{const r=n;return Pr(e,s=>r.from<=s&&s<=r.to)!==void 0}})}function mc(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?K(t.value)?Tt(t.value,mc):mc(t.value):!1}class _v extends pc{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Be(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?Mf(e,this.targetCharCodes)===void 0&&(this.found=!0):Mf(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function yc(t,e){if(e instanceof RegExp){const n=Yi(e),r=new _v(t);return r.visit(n),r.found}else return Pr(e,n=>Be(t,n.charCodeAt(0)))!==void 0}const lr="PATTERN",As="defaultMode",Ji="modes";let xf=typeof new RegExp("(?:)").sticky=="boolean";function Ev(t,e){e=uc(e,{useSticky:xf,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(E,A)=>A()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{Gv()});let r;n("Reject Lexer.NA",()=>{r=Fi(t,E=>E[lr]===we.NA)});let s=!1,i;n("Transform Patterns",()=>{s=!1,i=N(r,E=>{const A=E[lr];if(mn(A)){const O=A.source;return O.length===1&&O!=="^"&&O!=="$"&&O!=="."&&!A.ignoreCase?O:O.length===2&&O[0]==="\\"&&!Be(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],O[1])?O[1]:e.useSticky?Pf(A):Uf(A)}else{if(dn(A))return s=!0,{exec:A};if(typeof A=="object")return s=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const O=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),w=new RegExp(O);return e.useSticky?Pf(w):Uf(w)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=N(r,E=>E.tokenTypeIdx),a=N(r,E=>{const A=E.GROUP;if(A!==we.SKIPPED){if(He(A))return A;if(yn(A))return!1;throw Error("non exhaustive match")}}),c=N(r,E=>{const A=E.LONGER_ALT;if(A)return K(A)?N(A,w=>Sf(r,w)):[Sf(r,A)]}),l=N(r,E=>E.PUSH_MODE),u=N(r,E=>L(E,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const E=Bf(e.lineTerminatorCharacters);h=N(r,A=>!1),e.positionTracking!=="onlyOffset"&&(h=N(r,A=>L(A,"LINE_BREAKS")?!!A.LINE_BREAKS:$f(A,E)===!1&&yc(E,A.PATTERN)))});let d,f,p,_;n("Misc Mapping #2",()=>{d=N(r,Df),f=N(i,Bv),p=et(r,(E,A)=>{const O=A.GROUP;return He(O)&&O!==we.SKIPPED&&(E[O]=[]),E},{}),_=N(i,(E,A)=>({pattern:i[A],longerAlt:c[A],canLineTerminator:h[A],isCustom:d[A],short:f[A],group:a[A],push:l[A],pop:u[A],tokenTypeIdx:o[A],tokenType:r[A]}))});let S=!0,T=[];return e.safeMode||n("First Char Optimization",()=>{T=et(r,(E,A,O)=>{if(typeof A.PATTERN=="string"){const w=A.PATTERN.charCodeAt(0),m=$n(w);_c(E,m,_[O])}else if(K(A.START_CHARS_HINT)){let w;M(A.START_CHARS_HINT,m=>{const y=typeof m=="string"?m.charCodeAt(0):m,b=$n(y);w!==b&&(w=b,_c(E,b,_[O]))})}else if(mn(A.PATTERN))if(A.PATTERN.unicode)S=!1,e.ensureOptimizations&&fc(`${qi}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const w=mv(A.PATTERN,e.ensureOptimizations);Z(w)&&(S=!1),M(w,m=>{_c(E,m,_[O])})}else e.ensureOptimizations&&fc(`${qi}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),S=!1;return E},[])}),{emptyGroups:p,patternIdxToConfig:_,charCodeToPatternIdxToConfig:T,hasCustom:s,canBeOptimized:S}}function wv(t,e){let n=[];const r=Sv(t);n=n.concat(r.errors);const s=Tv(r.valid),i=s.valid;return n=n.concat(s.errors),n=n.concat(bv(i)),n=n.concat(Cv(i)),n=n.concat(Lv(i,e)),n=n.concat(Mv(i)),n}function bv(t){let e=[];const n=dt(t,r=>mn(r[lr]));return e=e.concat(vv(n)),e=e.concat(Ov(n)),e=e.concat(Iv(n)),e=e.concat(Nv(n)),e=e.concat(kv(n)),e}function Sv(t){const e=dt(t,s=>!L(s,lr)),n=N(e,s=>({message:"Token Type: ->"+s.name+"<- missing static 'PATTERN' property",type:ae.MISSING_PATTERN,tokenTypes:[s]})),r=Bi(t,e);return{errors:n,valid:r}}function Tv(t){const e=dt(t,s=>{const i=s[lr];return!mn(i)&&!dn(i)&&!L(i,"exec")&&!He(i)}),n=N(e,s=>({message:"Token Type: ->"+s.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:ae.INVALID_PATTERN,tokenTypes:[s]})),r=Bi(t,e);return{errors:n,valid:r}}const Av=/[^\\][$]/;function vv(t){class e extends pc{constructor(){super(...arguments),this.found=!1}visitEndAnchor(i){this.found=!0}}const n=dt(t,s=>{const i=s.PATTERN;try{const o=Yi(i),a=new e;return a.visit(o),a.found}catch{return Av.test(i.source)}});return N(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ae.EOI_ANCHOR_FOUND,tokenTypes:[s]}))}function kv(t){const e=dt(t,r=>r.PATTERN.test(""));return N(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:ae.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const Rv=/[^\\[][\^]|^\^/;function Ov(t){class e extends pc{constructor(){super(...arguments),this.found=!1}visitStartAnchor(i){this.found=!0}}const n=dt(t,s=>{const i=s.PATTERN;try{const o=Yi(i),a=new e;return a.visit(o),a.found}catch{return Rv.test(i.source)}});return N(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ae.SOI_ANCHOR_FOUND,tokenTypes:[s]}))}function Iv(t){const e=dt(t,r=>{const s=r[lr];return s instanceof RegExp&&(s.multiline||s.global)});return N(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:ae.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function Nv(t){const e=[];let n=N(t,i=>et(t,(o,a)=>(i.PATTERN.source===a.PATTERN.source&&!Be(e,a)&&a.PATTERN!==we.NA&&(e.push(a),o.push(a)),o),[]));n=ws(n);const r=dt(n,i=>i.length>1);return N(r,i=>{const o=N(i,c=>c.name);return{message:`The same RegExp pattern ->${At(i).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:ae.DUPLICATE_PATTERNS_FOUND,tokenTypes:i}})}function Cv(t){const e=dt(t,r=>{if(!L(r,"GROUP"))return!1;const s=r.GROUP;return s!==we.SKIPPED&&s!==we.NA&&!He(s)});return N(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:ae.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function Lv(t,e){const n=dt(t,s=>s.PUSH_MODE!==void 0&&!Be(e,s.PUSH_MODE));return N(n,s=>({message:`Token Type: ->${s.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${s.PUSH_MODE}<-which does not exist`,type:ae.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[s]}))}function Mv(t){const e=[],n=et(t,(r,s,i)=>{const o=s.PATTERN;return o===we.NA||(He(o)?r.push({str:o,idx:i,tokenType:s}):mn(o)&&Uv(o)&&r.push({str:o.source,idx:i,tokenType:s})),r},[]);return M(t,(r,s)=>{M(n,({str:i,idx:o,tokenType:a})=>{if(s<o&&xv(i,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:ae.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function xv(t,e){if(mn(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(dn(e))return e(t,0,[],{});if(L(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function Uv(t){return Pr([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function Uf(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function Pf(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function Pv(t,e,n){const r=[];return L(t,As)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+As+`> property in its definition
`,type:ae.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),L(t,Ji)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ji+`> property in its definition
`,type:ae.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),L(t,Ji)&&L(t,As)&&!L(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${As}: <${t.defaultMode}>which does not exist
`,type:ae.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),L(t,Ji)&&M(t.modes,(s,i)=>{M(s,(o,a)=>{if(yn(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${i}> at index: <${a}>
`,type:ae.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(L(o,"LONGER_ALT")){const c=K(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];M(c,l=>{!yn(l)&&!Be(s,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${i}>
`,type:ae.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function Dv(t,e,n){const r=[];let s=!1;const i=ws(St(_e(t.modes))),o=Fi(i,c=>c[lr]===we.NA),a=Bf(n);return e&&M(o,c=>{const l=$f(c,a);if(l!==!1){const h={message:jv(c,l),type:l.issue,tokenType:c};r.push(h)}else L(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(s=!0):yc(a,c.PATTERN)&&(s=!0)}),e&&!s&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:ae.NO_LINE_BREAKS_FLAGS}),r}function $v(t){const e={},n=ht(t);return M(n,r=>{const s=t[r];if(K(s))e[r]=[];else throw Error("non exhaustive match")}),e}function Df(t){const e=t.PATTERN;if(mn(e))return!1;if(dn(e))return!0;if(L(e,"exec"))return!0;if(He(e))return!1;throw Error("non exhaustive match")}function Bv(t){return He(t)&&t.length===1?t.charCodeAt(0):!1}const Fv={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function $f(t,e){if(L(t,"LINE_BREAKS"))return!1;if(mn(t.PATTERN)){try{yc(e,t.PATTERN)}catch(n){return{issue:ae.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(He(t.PATTERN))return!1;if(Df(t))return{issue:ae.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function jv(t,e){if(e.issue===ae.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===ae.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Bf(t){return N(t,n=>He(n)?n.charCodeAt(0):n)}function _c(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const vs=256;let Qi=[];function $n(t){return t<vs?t:Qi[t]}function Gv(){if(Z(Qi)){Qi=new Array(65536);for(let t=0;t<65536;t++)Qi[t]=t>255?255+~~(t/255):t}}function ks(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function Zi(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let Ff=1;const jf={};function Rs(t){const e=Kv(t);Wv(e),Vv(e),Hv(e),M(e,n=>{n.isParent=n.categoryMatches.length>0})}function Kv(t){let e=Ce(t),n=t,r=!0;for(;r;){n=ws(St(N(n,i=>i.CATEGORIES)));const s=Bi(n,e);e=e.concat(s),Z(s)?r=!1:n=s}return e}function Wv(t){M(t,e=>{Kf(e)||(jf[Ff]=e,e.tokenTypeIdx=Ff++),Wf(e)&&!K(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Wf(e)||(e.CATEGORIES=[]),zv(e)||(e.categoryMatches=[]),Yv(e)||(e.categoryMatchesMap={})})}function Hv(t){M(t,e=>{e.categoryMatches=[],M(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(jf[r].tokenTypeIdx)})})}function Vv(t){M(t,e=>{Gf([],e)})}function Gf(t,e){M(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),M(e.CATEGORIES,n=>{const r=t.concat(e);Be(r,n)||Gf(r,n)})}function Kf(t){return L(t,"tokenTypeIdx")}function Wf(t){return L(t,"CATEGORIES")}function zv(t){return L(t,"categoryMatches")}function Yv(t){return L(t,"categoryMatchesMap")}function qv(t){return L(t,"tokenTypeIdx")}const Xv={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,s){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var ae;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(ae||(ae={}));const Os={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:Xv,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Os);class we{constructor(e,n=Os){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(s,i)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${s}>`);const{time:a,value:c}=kf(i),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${s}> time: ${a}ms`),this.traceInitIndent--,c}else return i()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Ze({},Os,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let s,i=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Os.lineTerminatorsPattern)this.config.lineTerminatorsPattern=Fv;else if(this.config.lineTerminatorCharacters===Os.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),K(e)?s={modes:{defaultMode:Ce(e)},defaultMode:As}:(i=!1,s=Ce(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Pv(s,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(Dv(s,this.trackStartLines,this.config.lineTerminatorCharacters))})),s.modes=s.modes?s.modes:{},M(s.modes,(a,c)=>{s.modes[c]=Fi(a,l=>yn(l))});const o=ht(s.modes);if(M(s.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(wv(a,o))}),Z(this.lexerDefinitionErrors)){Rs(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=Ev(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Ze({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=s.defaultMode,!Z(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=N(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}M(this.lexerDefinitionWarning,a=>{vf(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(xf?(this.chopInput=Lr,this.match=this.matchWithTest):(this.updateLastIndex=ye,this.match=this.matchWithExec),i&&(this.handleModes=ye),this.trackStartLines===!1&&(this.computeNewColumn=Lr),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=ye),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=et(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!Z(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{gv()}),this.TRACE_INIT("toFastProperties",()=>{Rf(this)})})}tokenize(e,n=this.defaultMode){if(!Z(this.lexerDefinitionErrors)){const s=N(this.lexerDefinitionErrors,i=>i.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+s)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,s,i,o,a,c,l,u,h,d,f,p,_,S,T;const E=e,A=E.length;let O=0,w=0;const m=this.hasCustom?0:Math.floor(e.length/10),y=new Array(m),b=[];let v=this.trackStartLines?1:void 0,W=this.trackStartLines?1:void 0;const fe=$v(this.emptyGroups),is=this.trackStartLines,Oe=this.config.lineTerminatorsPattern;let sn=0,yt=[],hi=[];const sa=[],Ty=[];Object.freeze(Ty);let fi;function Ay(){return yt}function vy(Pe){const _t=$n(Pe),os=hi[_t];return os===void 0?Ty:os}const eL=Pe=>{if(sa.length===1&&Pe.tokenType.PUSH_MODE===void 0){const _t=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Pe);b.push({offset:Pe.startOffset,line:Pe.startLine,column:Pe.startColumn,length:Pe.image.length,message:_t})}else{sa.pop();const _t=Ur(sa);yt=this.patternIdxToConfig[_t],hi=this.charCodeToPatternIdxToConfig[_t],sn=yt.length;const os=this.canModeBeOptimized[_t]&&this.config.safeMode===!1;hi&&os?fi=vy:fi=Ay}};function ky(Pe){sa.push(Pe),hi=this.charCodeToPatternIdxToConfig[Pe],yt=this.patternIdxToConfig[Pe],sn=yt.length,sn=yt.length;const _t=this.canModeBeOptimized[Pe]&&this.config.safeMode===!1;hi&&_t?fi=vy:fi=Ay}ky.call(this,n);let Pt;const Ry=this.config.recoveryEnabled;for(;O<A;){c=null;const Pe=E.charCodeAt(O),_t=fi(Pe),os=_t.length;for(r=0;r<os;r++){Pt=_t[r];const st=Pt.pattern;l=null;const Ln=Pt.short;if(Ln!==!1?Pe===Ln&&(c=st):Pt.isCustom===!0?(T=st.exec(E,O,y,fe),T!==null?(c=T[0],T.payload!==void 0&&(l=T.payload)):c=null):(this.updateLastIndex(st,O),c=this.match(st,e,O)),c!==null){if(a=Pt.longerAlt,a!==void 0){const Zn=a.length;for(i=0;i<Zn;i++){const Mn=yt[a[i]],kr=Mn.pattern;if(u=null,Mn.isCustom===!0?(T=kr.exec(E,O,y,fe),T!==null?(o=T[0],T.payload!==void 0&&(u=T.payload)):o=null):(this.updateLastIndex(kr,O),o=this.match(kr,e,O)),o&&o.length>c.length){c=o,l=u,Pt=Mn;break}}}break}}if(c!==null){if(h=c.length,d=Pt.group,d!==void 0&&(f=Pt.tokenTypeIdx,p=this.createTokenInstance(c,O,f,Pt.tokenType,v,W,h),this.handlePayload(p,l),d===!1?w=this.addToken(y,w,p):fe[d].push(p)),e=this.chopInput(e,h),O=O+h,W=this.computeNewColumn(W,h),is===!0&&Pt.canLineTerminator===!0){let st=0,Ln,Zn;Oe.lastIndex=0;do Ln=Oe.test(c),Ln===!0&&(Zn=Oe.lastIndex-1,st++);while(Ln===!0);st!==0&&(v=v+st,W=h-Zn,this.updateTokenEndLineColumnLocation(p,d,Zn,st,v,W,h))}this.handleModes(Pt,eL,ky,p)}else{const st=O,Ln=v,Zn=W;let Mn=Ry===!1;for(;Mn===!1&&O<A;)for(e=this.chopInput(e,1),O++,s=0;s<sn;s++){const kr=yt[s],du=kr.pattern,Oy=kr.short;if(Oy!==!1?E.charCodeAt(O)===Oy&&(Mn=!0):kr.isCustom===!0?Mn=du.exec(E,O,y,fe)!==null:(this.updateLastIndex(du,O),Mn=du.exec(e)!==null),Mn===!0)break}if(_=O-st,W=this.computeNewColumn(W,_),S=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(E,st,_,Ln,Zn),b.push({offset:st,line:Ln,column:Zn,length:_,message:S}),Ry===!1)break}}return this.hasCustom||(y.length=w),{tokens:y,groups:fe,errors:b}}handleModes(e,n,r,s){if(e.pop===!0){const i=e.push;n(s),i!==void 0&&r.call(this,i)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,s,i,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,s===1&&c===!0||(e.endLine=i+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,s){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:s}}createStartOnlyToken(e,n,r,s,i,o){return{image:e,startOffset:n,startLine:i,startColumn:o,tokenTypeIdx:r,tokenType:s}}createFullToken(e,n,r,s,i,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:i,endLine:i,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:s}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}}we.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",we.NA=/NOT_APPLICABLE/;function Is(t){return Hf(t)?t.LABEL:t.name}function Hf(t){return He(t.LABEL)&&t.LABEL!==""}const Jv="parent",Vf="categories",zf="label",Yf="group",qf="push_mode",Xf="pop_mode",Jf="longer_alt",Qf="line_breaks",Zf="start_chars_hint";function U(t){return Qv(t)}function Qv(t){const e=t.pattern,n={};if(n.name=t.name,yn(e)||(n.PATTERN=e),L(t,Jv))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return L(t,Vf)&&(n.CATEGORIES=t[Vf]),Rs([n]),L(t,zf)&&(n.LABEL=t[zf]),L(t,Yf)&&(n.GROUP=t[Yf]),L(t,Xf)&&(n.POP_MODE=t[Xf]),L(t,qf)&&(n.PUSH_MODE=t[qf]),L(t,Jf)&&(n.LONGER_ALT=t[Jf]),L(t,Qf)&&(n.LINE_BREAKS=t[Qf]),L(t,Zf)&&(n.START_CHARS_HINT=t[Zf]),n}const ur=U({name:"EOF",pattern:we.NA});Rs([ur]);function eo(t,e,n,r,s,i,o,a){return{image:e,startOffset:n,endOffset:r,startLine:s,endLine:i,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function Zv(t,e){return ks(t,e)}const ed={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${Hf(t)?`--> ${Is(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:s}){const i="Expecting: ",a=`
but found: '`+At(e).image+"'";if(r)return i+r+a;{const c=et(t,(d,f)=>d.concat(f),[]),l=N(c,d=>`[${N(d,f=>Is(f)).join(", ")}]`),h=`one of these possible Token sequences:
${N(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return i+h+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const s="Expecting: ",o=`
but found: '`+At(e).image+"'";if(n)return s+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${N(t,l=>`[${N(l,u=>Is(u)).join(",")}]`).join(" ,")}>`;return s+c+o}}};Object.freeze(ed);const ek={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},hr={buildDuplicateFoundError(t,e){function n(u){return u instanceof se?u.terminalType.name:u instanceof tt?u.nonTerminalName:""}const r=t.name,s=At(e),i=s.idx,o=Ht(s),a=n(s),c=i>0;let l=`->${o}${c?i:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=N(t.prefixPath,s=>Is(s)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=N(t.prefixPath,s=>Is(s)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=Ht(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=N(t.leftRecursionPath,i=>i.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Dr?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function tk(t,e){const n=new nk(t,e);return n.resolveRefs(),n.errors}class nk extends $r{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){M(_e(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Fe.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class rk extends Ki{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Ce(this.path.ruleStack).reverse(),this.occurrenceStack=Ce(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const s=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,s)}}updateExpectedNext(){Z(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class sk extends rk{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const s=n.concat(r),i=new Ve({definition:s});this.possibleTokTypes=Ss(i),this.found=!0}}}class to extends Ki{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class ik extends to{walkMany(e,n,r){if(e.idx===this.occurrence){const s=At(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof se&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkMany(e,n,r)}}class td extends to{walkManySep(e,n,r){if(e.idx===this.occurrence){const s=At(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof se&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkManySep(e,n,r)}}class ok extends to{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const s=At(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof se&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOne(e,n,r)}}class nd extends to{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const s=At(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof se&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOneSep(e,n,r)}}function Ec(t,e,n=[]){n=Ce(n);let r=[],s=0;function i(a){return a.concat(Le(t,s+1))}function o(a){const c=Ec(i(a),e,n);return r.concat(c)}for(;n.length<e&&s<t.length;){const a=t[s];if(a instanceof Ve)return o(a.definition);if(a instanceof tt)return o(a.definition);if(a instanceof ze)r=o(a.definition);else if(a instanceof Kt){const c=a.definition.concat([new Ee({definition:a.definition})]);return o(c)}else if(a instanceof Wt){const c=[new Ve({definition:a.definition}),new Ee({definition:[new se({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof kt){const c=a.definition.concat([new Ee({definition:[new se({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Ee){const c=a.definition.concat([new Ee({definition:a.definition})]);r=o(c)}else{if(a instanceof Rt)return M(a.definition,c=>{Z(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof se)n.push(a.terminalType);else throw Error("non exhaustive match")}s++}return r.push({partialPath:n,suffixDef:Le(t,s)}),r}function rd(t,e,n,r){const s="EXIT_NONE_TERMINAL",i=[s],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Z(h);){const d=h.pop();if(d===o){a&&Ur(h).idx<=l&&h.pop();continue}const f=d.def,p=d.idx,_=d.ruleStack,S=d.occurrenceStack;if(Z(f))continue;const T=f[0];if(T===s){const E={idx:p,def:Le(f),ruleStack:bs(_),occurrenceStack:bs(S)};h.push(E)}else if(T instanceof se)if(p<c-1){const E=p+1,A=e[E];if(n(A,T.terminalType)){const O={idx:E,def:Le(f),ruleStack:_,occurrenceStack:S};h.push(O)}}else if(p===c-1)u.push({nextTokenType:T.terminalType,nextTokenOccurrence:T.idx,ruleStack:_,occurrenceStack:S}),a=!0;else throw Error("non exhaustive match");else if(T instanceof tt){const E=Ce(_);E.push(T.nonTerminalName);const A=Ce(S);A.push(T.idx);const O={idx:p,def:T.definition.concat(i,Le(f)),ruleStack:E,occurrenceStack:A};h.push(O)}else if(T instanceof ze){const E={idx:p,def:Le(f),ruleStack:_,occurrenceStack:S};h.push(E),h.push(o);const A={idx:p,def:T.definition.concat(Le(f)),ruleStack:_,occurrenceStack:S};h.push(A)}else if(T instanceof Kt){const E=new Ee({definition:T.definition,idx:T.idx}),A=T.definition.concat([E],Le(f)),O={idx:p,def:A,ruleStack:_,occurrenceStack:S};h.push(O)}else if(T instanceof Wt){const E=new se({terminalType:T.separator}),A=new Ee({definition:[E].concat(T.definition),idx:T.idx}),O=T.definition.concat([A],Le(f)),w={idx:p,def:O,ruleStack:_,occurrenceStack:S};h.push(w)}else if(T instanceof kt){const E={idx:p,def:Le(f),ruleStack:_,occurrenceStack:S};h.push(E),h.push(o);const A=new se({terminalType:T.separator}),O=new Ee({definition:[A].concat(T.definition),idx:T.idx}),w=T.definition.concat([O],Le(f)),m={idx:p,def:w,ruleStack:_,occurrenceStack:S};h.push(m)}else if(T instanceof Ee){const E={idx:p,def:Le(f),ruleStack:_,occurrenceStack:S};h.push(E),h.push(o);const A=new Ee({definition:T.definition,idx:T.idx}),O=T.definition.concat([A],Le(f)),w={idx:p,def:O,ruleStack:_,occurrenceStack:S};h.push(w)}else if(T instanceof Rt)for(let E=T.definition.length-1;E>=0;E--){const A=T.definition[E],O={idx:p,def:A.definition.concat(Le(f)),ruleStack:_,occurrenceStack:S};h.push(O),h.push(o)}else if(T instanceof Ve)h.push({idx:p,def:T.definition.concat(Le(f)),ruleStack:_,occurrenceStack:S});else if(T instanceof Dr)h.push(ak(T,p,_,S));else throw Error("non exhaustive match")}return u}function ak(t,e,n,r){const s=Ce(n);s.push(t.name);const i=Ce(r);return i.push(1),{idx:e,def:t.definition,ruleStack:s,occurrenceStack:i}}var ce;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(ce||(ce={}));function sd(t){if(t instanceof ze||t==="Option")return ce.OPTION;if(t instanceof Ee||t==="Repetition")return ce.REPETITION;if(t instanceof Kt||t==="RepetitionMandatory")return ce.REPETITION_MANDATORY;if(t instanceof Wt||t==="RepetitionMandatoryWithSeparator")return ce.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof kt||t==="RepetitionWithSeparator")return ce.REPETITION_WITH_SEPARATOR;if(t instanceof Rt||t==="Alternation")return ce.ALTERNATION;throw Error("non exhaustive match")}function ck(t,e,n,r,s,i){const o=bc(t,e,n),a=cd(o)?Zi:ks;return i(o,r,a,s)}function lk(t,e,n,r,s,i){const o=Sc(t,e,s,n),a=cd(o)?Zi:ks;return i(o[0],a,r)}function uk(t,e,n,r){const s=t.length,i=Tt(t,o=>Tt(o,a=>a.length===1));if(e)return function(o){const a=N(o,c=>c.GATE);for(let c=0;c<s;c++){const l=t[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let d=0;d<u;d++){const f=l[d],p=f.length;for(let _=0;_<p;_++){const S=this.LA(_+1);if(n(S,f[_])===!1)continue e}return c}}};if(i&&!r){const o=N(t,c=>St(c)),a=et(o,(c,l,u)=>(M(l,h=>{L(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),M(h.categoryMatches,d=>{L(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<s;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue e}return o}}}}function hk(t,e,n){const r=Tt(t,i=>i.length===1),s=t.length;if(r&&!n){const i=St(t);if(i.length===1&&Z(i[0].categoryMatches)){const a=i[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=et(i,(a,c,l)=>(a[c.tokenTypeIdx]=!0,M(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let i=0;i<s;i++){const o=t[i],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class fk extends Ki{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,s){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(s),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,ce.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,ce.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,ce.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,ce.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,ce.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class id extends $r{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,ce.OPTION)}visitRepetition(e){this.checkIsTarget(e,ce.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,ce.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,ce.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,ce.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,ce.ALTERNATION)}}function od(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function wc(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],s=[];for(let i=0;i<e.length;i++){const o=e[i];s.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];s.push(o+c)}}e=s}return e}function dk(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const s=t[r];for(let i=0;i<e.length;i++){const o=e[i];if(s[o]===!0)return!1}}return!0}function ad(t,e){const n=N(t,o=>Ec([o],1)),r=od(n.length),s=N(n,o=>{const a={};return M(o,c=>{const l=wc(c.partialPath);M(l,u=>{a[u]=!0})}),a});let i=n;for(let o=1;o<=e;o++){const a=i;i=od(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=wc(h);if(dk(s,f,c)||Z(d)||h.length===e){const _=r[c];if(Tc(_,h)===!1){_.push(h);for(let S=0;S<f.length;S++){const T=f[S];s[c][T]=!0}}}else{const _=Ec(d,o+1,h);i[c]=i[c].concat(_),M(_,S=>{const T=wc(S.partialPath);M(T,E=>{s[c][E]=!0})})}}}}return r}function bc(t,e,n,r){const s=new id(t,ce.ALTERNATION,r);return e.accept(s),ad(s.result,n)}function Sc(t,e,n,r){const s=new id(t,n);e.accept(s);const i=s.result,a=new fk(e,t,n).startWalking(),c=new Ve({definition:i}),l=new Ve({definition:a});return ad([c,l],r)}function Tc(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let s=0;s<r.length;s++){const i=e[s],o=r[s];if((i===o||o.categoryMatchesMap[i.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function pk(t,e){return t.length<e.length&&Tt(t,(n,r)=>{const s=e[r];return n===s||s.categoryMatchesMap[n.tokenTypeIdx]})}function cd(t){return Tt(t,e=>Tt(e,n=>Tt(n,r=>Z(r.categoryMatches))))}function gk(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return N(e,n=>Object.assign({type:Fe.CUSTOM_LOOKAHEAD_VALIDATION},n))}function mk(t,e,n,r){const s=pt(t,c=>yk(c,n)),i=Ik(t,e,n),o=pt(t,c=>vk(c,n)),a=pt(t,c=>wk(c,t,r,n));return s.concat(i,o,a)}function yk(t,e){const n=new Ek;t.accept(n);const r=n.allProductions,s=NA(r,_k),i=vt(s,a=>a.length>1);return N(_e(i),a=>{const c=At(a),l=e.buildDuplicateFoundError(t,a),u=Ht(c),h={message:l,type:Fe.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=ld(c);return d&&(h.parameter=d),h})}function _k(t){return`${Ht(t)}_#_${t.idx}_#_${ld(t)}`}function ld(t){return t instanceof se?t.terminalType.name:t instanceof tt?t.nonTerminalName:""}class Ek extends $r{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function wk(t,e,n,r){const s=[];if(et(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});s.push({message:o,type:Fe.DUPLICATE_RULE_NAME,ruleName:t.name})}return s}function bk(t,e,n){const r=[];let s;return Be(e,t)||(s=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:s,type:Fe.INVALID_RULE_OVERRIDE,ruleName:t})),r}function ud(t,e,n,r=[]){const s=[],i=no(e.definition);if(Z(i))return[];{const o=t.name;Be(i,t)&&s.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Fe.LEFT_RECURSION,ruleName:o});const c=Bi(i,r.concat([t])),l=pt(c,u=>{const h=Ce(r);return h.push(u),ud(t,u,n,h)});return s.concat(l)}}function no(t){let e=[];if(Z(t))return e;const n=At(t);if(n instanceof tt)e.push(n.referencedRule);else if(n instanceof Ve||n instanceof ze||n instanceof Kt||n instanceof Wt||n instanceof kt||n instanceof Ee)e=e.concat(no(n.definition));else if(n instanceof Rt)e=St(N(n.definition,i=>no(i.definition)));else if(!(n instanceof se))throw Error("non exhaustive match");const r=Gi(n),s=t.length>1;if(r&&s){const i=Le(t);return e.concat(no(i))}else return e}class Ac extends $r{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function Sk(t,e){const n=new Ac;t.accept(n);const r=n.alternations;return pt(r,i=>{const o=bs(i.definition);return pt(o,(a,c)=>{const l=rd([a],[],ks,1);return Z(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:i,emptyChoiceIdx:c}),type:Fe.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:i.idx,alternative:c+1}]:[]})})}function Tk(t,e,n){const r=new Ac;t.accept(r);let s=r.alternations;return s=Fi(s,o=>o.ignoreAmbiguities===!0),pt(s,o=>{const a=o.idx,c=o.maxLookahead||e,l=bc(a,t,c,o),u=Rk(l,o,t,n),h=Ok(l,o,t,n);return u.concat(h)})}class Ak extends $r{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function vk(t,e){const n=new Ac;t.accept(n);const r=n.alternations;return pt(r,i=>i.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:i}),type:Fe.TOO_MANY_ALTS,ruleName:t.name,occurrence:i.idx}]:[])}function kk(t,e,n){const r=[];return M(t,s=>{const i=new Ak;s.accept(i);const o=i.allProductions;M(o,a=>{const c=sd(a),l=a.maxLookahead||e,u=a.idx,d=Sc(u,s,c,l)[0];if(Z(St(d))){const f=n.buildEmptyRepetitionError({topLevelRule:s,repetition:a});r.push({message:f,type:Fe.NO_NON_EMPTY_LOOKAHEAD,ruleName:s.name})}})}),r}function Rk(t,e,n,r){const s=[],i=et(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||M(c,u=>{const h=[l];M(t,(d,f)=>{l!==f&&Tc(d,u)&&e.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!Tc(s,u)&&(s.push(u),a.push({alts:h,path:u}))}),a),[]);return N(i,a=>{const c=N(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Fe.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function Ok(t,e,n,r){const s=et(t,(o,a,c)=>{const l=N(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return ws(pt(s,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=dt(s,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&pk(d.path,l));return N(u,d=>{const f=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:f,prefixPath:d.path}),type:Fe.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function Ik(t,e,n){const r=[],s=N(e,i=>i.name);return M(t,i=>{const o=i.name;if(Be(s,o)){const a=n.buildNamespaceConflictError(i);r.push({message:a,type:Fe.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function Nk(t){const e=uc(t,{errMsgProvider:ek}),n={};return M(t.rules,r=>{n[r.name]=r}),tk(n,e.errMsgProvider)}function Ck(t){return t=uc(t,{errMsgProvider:hr}),mk(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const hd="MismatchedTokenException",fd="NoViableAltException",dd="EarlyExitException",pd="NotAllInputParsedException",gd=[hd,fd,dd,pd];Object.freeze(gd);function ro(t){return Be(gd,t.name)}class so extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class md extends so{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=hd}}class Lk extends so{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=fd}}class Mk extends so{constructor(e,n){super(e,n),this.name=pd}}class xk extends so{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=dd}}const vc={},yd="InRuleRecoveryException";class Uk extends Error{constructor(e){super(e),this.name=yd}}class Pk{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=L(e,"recoveryEnabled")?e.recoveryEnabled:_n.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Dk)}getTokenToInsert(e){const n=eo(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,s){const i=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:s,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new md(f,l,this.LA(0));p.resyncedTokens=bs(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,s)){h();return}else if(r.call(this)){h(),e.apply(this,n);return}else this.tokenMatcher(u,i)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new Uk("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||Z(n))return!1;const r=this.LA(1);return Pr(n,i=>this.tokenMatcher(r,i))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Be(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const s=Pr(e,i=>Zv(n,i));if(s!==void 0)return s;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return vc;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return N(e,(r,s)=>s===0?vc:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[s],inRule:this.shortRuleNameToFullName(e[s-1])})}flattenFollowSet(){const e=N(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return St(e)}getFollowSetFromFollowKey(e){if(e===vc)return[ur];const n=e.ruleName+e.idxInCallingRule+If+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,ur)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return bs(n)}attemptInRepetitionRecovery(e,n,r,s,i,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),s=Ce(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:s,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return N(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function Dk(t,e,n,r,s,i,o){const a=this.getKeyForAutomaticLookahead(r,s);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new i(f,s).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=ur,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const $k=4,Bn=8,_d=1<<Bn,Ed=2<<Bn,kc=3<<Bn,Rc=4<<Bn,Oc=5<<Bn,io=6<<Bn;function Ic(t,e,n){return n|e|t}class Bk{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:_n.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(Z(n)){const r=this.validateEmptyOrAlternatives(e.rules),s=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),i=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...s,...i]}return n}validateNoLeftRecursion(e){return pt(e,n=>ud(n,n,hr))}validateEmptyOrAlternatives(e){return pt(e,n=>Sk(n,hr))}validateAmbiguousAlternationAlternatives(e,n){return pt(e,r=>Tk(r,n,hr))}validateSomeNonEmptyLookaheadPath(e,n){return kk(e,n,hr)}buildLookaheadForAlternation(e){return ck(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,uk)}buildLookaheadForOptional(e){return lk(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,sd(e.prodType),hk)}}class Fk{initLooksAhead(e){this.dynamicTokensEnabled=L(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:_n.dynamicTokensEnabled,this.maxLookahead=L(e,"maxLookahead")?e.maxLookahead:_n.maxLookahead,this.lookaheadStrategy=L(e,"lookaheadStrategy")?e.lookaheadStrategy:new Bk({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){M(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:s,option:i,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=Gk(n);M(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Ht(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Ic(this.fullRuleNameToShort[n.name],_d,l.idx);this.setLaFuncCache(d,h)})}),M(s,l=>{this.computeLookaheadFunc(n,l.idx,kc,"Repetition",l.maxLookahead,Ht(l))}),M(i,l=>{this.computeLookaheadFunc(n,l.idx,Ed,"Option",l.maxLookahead,Ht(l))}),M(o,l=>{this.computeLookaheadFunc(n,l.idx,Rc,"RepetitionMandatory",l.maxLookahead,Ht(l))}),M(a,l=>{this.computeLookaheadFunc(n,l.idx,io,"RepetitionMandatoryWithSeparator",l.maxLookahead,Ht(l))}),M(c,l=>{this.computeLookaheadFunc(n,l.idx,Oc,"RepetitionWithSeparator",l.maxLookahead,Ht(l))})})})}computeLookaheadFunc(e,n,r,s,i,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:i||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:s}),c=Ic(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return Ic(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class jk extends $r{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const oo=new jk;function Gk(t){oo.reset(),t.accept(oo);const e=oo.dslMethods;return oo.reset(),e}function wd(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function bd(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function Kk(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function Wk(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const Hk="name";function Sd(t,e){Object.defineProperty(t,Hk,{enumerable:!1,configurable:!0,writable:!1,value:e})}function Vk(t,e){const n=ht(t),r=n.length;for(let s=0;s<r;s++){const i=n[s],o=t[i],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function zk(t,e){const n=function(){};Sd(n,t+"BaseSemantics");const r={visit:function(s,i){if(K(s)&&(s=s[0]),!yn(s))return this[s.name](s.children,i)},validateVisitor:function(){const s=qk(this,e);if(!Z(s)){const i=N(s,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${i.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function Yk(t,e,n){const r=function(){};Sd(r,t+"BaseSemanticsWithDefaults");const s=Object.create(n.prototype);return M(e,i=>{s[i]=Vk}),r.prototype=s,r.prototype.constructor=r,r}var Nc;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(Nc||(Nc={}));function qk(t,e){return Xk(t,e)}function Xk(t,e){const n=dt(e,s=>dn(t[s])===!1),r=N(n,s=>({msg:`Missing visitor method: <${s}> on ${t.constructor.name} CST Visitor.`,type:Nc.MISSING_METHOD,methodName:s}));return ws(r)}class Jk{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=L(e,"nodeLocationTracking")?e.nodeLocationTracking:_n.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=ye,this.cstFinallyStateUpdate=ye,this.cstPostTerminal=ye,this.cstPostNonTerminal=ye,this.cstPostRule=ye;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=bd,this.setNodeLocationFromNode=bd,this.cstPostRule=ye,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=ye,this.setNodeLocationFromNode=ye,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=wd,this.setNodeLocationFromNode=wd,this.cstPostRule=ye,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=ye,this.setNodeLocationFromNode=ye,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=ye,this.setNodeLocationFromNode=ye,this.cstPostRule=ye,this.setInitialNodeLocation=ye;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];Kk(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];Wk(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(yn(this.baseCstVisitorConstructor)){const e=zk(this.className,ht(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(yn(this.baseCstVisitorWithDefaultsConstructor)){const e=Yk(this.className,ht(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class Qk{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):lo}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?lo:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class Zk{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=uo){if(Be(this.definedRulesNames,e)){const o={message:hr.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Fe.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const s=this.defineRule(e,n,r);return this[e]=s,s}OVERRIDE_RULE(e,n,r=uo){const s=bk(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(s);const i=this.defineRule(e,n,r);return this[e]=i,i}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(s){if(ro(s))return!1;throw s}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return tv(_e(this.gastProductionsCache))}}class eR{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Zi,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},L(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(K(e)){if(Z(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(K(e))this.tokensMap=et(e,(i,o)=>(i[o.name]=o,i),{});else if(L(e,"modes")&&Tt(St(_e(e.modes)),qv)){const i=St(_e(e.modes)),o=hc(i);this.tokensMap=et(o,(a,c)=>(a[c.name]=c,a),{})}else if(ut(e))this.tokensMap=Ce(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=ur;const r=L(e,"modes")?St(_e(e.modes)):_e(e),s=Tt(r,i=>Z(i.categoryMatches));this.tokenMatcher=s?Zi:ks,Rs(_e(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const s=L(r,"resyncEnabled")?r.resyncEnabled:uo.resyncEnabled,i=L(r,"recoveryValueFunc")?r.recoveryValueFunc:uo.recoveryValueFunc,o=this.ruleShortNameIdx<<$k+Bn;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const s=this.RULE_STACK.length===1,i=n&&!this.isBackTracking()&&this.recoveryEnabled;if(ro(e)){const o=e;if(i){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(s)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(Ed,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof e!="function"){i=e.DEF;const o=e.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=e;if(s.call(this)===!0)return i.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(Rc,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const o=n.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=n;if(s.call(this)===!0){let o=this.doSingleRepetition(i);for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i)}else throw this.raiseEarlyExitException(e,ce.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],s,Rc,e,ok)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(io,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,i,a,s,nd],a,io,e,nd)}else throw this.raiseEarlyExitException(e,ce.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(kc,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const a=n.GATE;if(a!==void 0){const c=s;s=()=>a.call(this)&&c.call(this)}}else i=n;let o=!0;for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],s,kc,e,ik,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Oc,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,i,a,s,td],a,Oc,e,td)}}repetitionSepSecondInternal(e,n,r,s,i){for(;r();)this.CONSUME(n),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,s,i],r,io,e,i)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(_d,n),s=K(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,s);if(o!==void 0)return s[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Mk(n,e))}}subruleInternal(e,n,r){let s;try{const i=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,s=e.apply(this,i),this.cstPostNonTerminal(s,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),s}catch(i){throw this.subruleInternalError(i,r,e.ruleName)}}subruleInternalError(e,n,r){throw ro(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let s;try{const i=this.LA(1);this.tokenMatcher(i,e)===!0?(this.consumeToken(),s=i):this.consumeInternalError(e,i,r)}catch(i){s=this.consumeInternalRecovery(e,n,i)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,s),s}consumeInternalError(e,n,r){let s;const i=this.LA(0);throw r!==void 0&&r.ERR_MSG?s=r.ERR_MSG:s=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new md(s,n,i))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const s=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,s)}catch(i){throw i.name===yd?r:i}}else throw r}saveRecogState(){const e=this.errors,n=Ce(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),ur)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class tR{initErrorHandler(e){this._errors=[],this.errorMessageProvider=L(e,"errorMessageProvider")?e.errorMessageProvider:_n.errorMessageProvider}SAVE_ERROR(e){if(ro(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Ce(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Ce(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const s=this.getCurrRuleFullName(),i=this.getGAstProductions()[s],a=Sc(e,i,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:s});throw this.SAVE_ERROR(new xk(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),s=this.getGAstProductions()[r],i=bc(e,s,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Lk(c,this.LA(1),a))}}class nR{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(yn(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return rd([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=At(e.ruleStack),s=this.getGAstProductions()[n];return new sk(s,e).startWalking()}}const ao={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(ao);const Td=!0,Ad=Math.pow(2,Bn)-1,vd=U({name:"RECORDING_PHASE_TOKEN",pattern:we.NA});Rs([vd]);const kd=eo(vd,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(kd);const rR={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class sR{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,s){return this.consumeInternalRecord(r,e,s)},this[`SUBRULE${n}`]=function(r,s){return this.subruleInternalRecord(r,e,s)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return lo}topLevelRuleRecord(e,n){try{const r=new Dr({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Ns.call(this,ze,e,n)}atLeastOneInternalRecord(e,n){Ns.call(this,Kt,n,e)}atLeastOneSepFirstInternalRecord(e,n){Ns.call(this,Wt,n,e,Td)}manyInternalRecord(e,n){Ns.call(this,Ee,n,e)}manySepFirstInternalRecord(e,n){Ns.call(this,kt,n,e,Td)}orInternalRecord(e,n){return iR.call(this,e,n)}subruleInternalRecord(e,n,r){if(co(n),!e||L(e,"ruleName")===!1){const a=new Error(`<SUBRULE${Rd(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const s=Ur(this.recordingProdStack),i=e.ruleName,o=new tt({idx:n,nonTerminalName:i,label:r==null?void 0:r.LABEL,referencedRule:void 0});return s.definition.push(o),this.outputCst?rR:ao}consumeInternalRecord(e,n,r){if(co(n),!Kf(e)){const o=new Error(`<CONSUME${Rd(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const s=Ur(this.recordingProdStack),i=new se({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return s.definition.push(i),kd}}function Ns(t,e,n,r=!1){co(n);const s=Ur(this.recordingProdStack),i=dn(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),L(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),i.call(this),s.definition.push(o),this.recordingProdStack.pop(),ao}function iR(t,e){co(e);const n=Ur(this.recordingProdStack),r=K(t)===!1,s=r===!1?t:t.DEF,i=new Rt({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});L(t,"MAX_LOOKAHEAD")&&(i.maxLookahead=t.MAX_LOOKAHEAD);const o=Af(s,a=>dn(a.GATE));return i.hasPredicates=o,n.definition.push(i),M(s,a=>{const c=new Ve({definition:[]});i.definition.push(c),L(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:L(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),ao}function Rd(t){return t===0?"":`${t}`}function co(t){if(t<0||t>Ad){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${Ad+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class oR{initPerformanceTracer(e){if(L(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=_n.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:s,value:i}=kf(n),o=s>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${s}ms`),this.traceInitIndent--,i}else return n()}}function aR(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(s=>{if(s==="constructor")return;const i=Object.getOwnPropertyDescriptor(r,s);i&&(i.get||i.set)?Object.defineProperty(t.prototype,s,i):t.prototype[s]=n.prototype[s]})})}const lo=eo(ur,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(lo);const _n=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:ed,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),uo=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Fe;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Fe||(Fe={}));class Cs{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Rf(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),M(this.definedRulesNames,s=>{const o=this[s].originalGrammarAction;let a;this.TRACE_INIT(`${s} Rule`,()=>{a=this.topLevelRuleRecord(s,o)}),this.gastProductionsCache[s]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=Nk({rules:_e(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(Z(r)&&this.skipValidations===!1){const s=Ck({rules:_e(this.gastProductionsCache),tokenTypes:_e(this.tokensMap),errMsgProvider:hr,grammarName:n}),i=gk({lookaheadStrategy:this.lookaheadStrategy,rules:_e(this.gastProductionsCache),tokenTypes:_e(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(s,i)}}),Z(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const s=cv(_e(this.gastProductionsCache));this.resyncFollows=s}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var s,i;(i=(s=this.lookaheadStrategy).initialize)===null||i===void 0||i.call(s,{rules:_e(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(_e(this.gastProductionsCache))})),!Cs.DEFER_DEFINITION_ERRORS_HANDLING&&!Z(this.definitionErrors))throw e=N(this.definitionErrors,s=>s.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),L(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=L(n,"skipValidations")?n.skipValidations:_n.skipValidations}}Cs.DEFER_DEFINITION_ERRORS_HANDLING=!1,aR(Cs,[Pk,Fk,Jk,Qk,eR,Zk,tR,nR,sR,oR]);class cR extends Cs{constructor(e,n=_n){const r=Ce(n);r.outputCst=!0,super(e,r)}}const Vt=!!JSON.parse("false");JSON.parse("false");const lR=!!JSON.parse("false"),uR="";JSON.parse("false");const Cc=va(32,126).map(t=>String.fromCharCode(t)),Fr=U({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),hR=U({name:"Whitespace",pattern:/ +/,group:we.SKIPPED}),fR=U({name:"Whitespace",pattern:/\s+/,line_breaks:!0,group:we.SKIPPED}),Lc=U({name:"Stat",pattern:/@.*/,start_chars_hint:["@"]}),Fn=U({name:"Command",pattern:/#/,start_chars_hint:["#"]});let Od=!1;function dR(t,e,n){if(!Od)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Fr)return null;let s=e;for(;t[s]===" ";)s++;if("@#/?':!".includes(t[s]))return null;let i=e+1;for(;i<t.length&&t[i]!==`
`;)i++;return[t.substring(e,i)]}const Id=U({name:"Text",pattern:dR,line_breaks:!1,start_chars_hint:Cc.filter(t=>"@#/?':!".includes(t)===!1)}),Nd=U({name:"Comment",pattern:/'.*/,start_chars_hint:["'"]}),Cd=U({name:"Label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Ld=U({name:"HyperLink",pattern:/!/,start_chars_hint:["!"]}),Md=U({name:"HyperLinkText",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),je=U({name:"StringLiteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:Cc}),xd=U({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Ud=U({name:"NumberLiteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/});function Ye(t,e=!1){return U(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:je,group:we.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:je})}const Pd=U({name:"IsEq",pattern:/=|is|eq|equal/,longer_alt:je}),Dd=U({name:"IsNotEq",pattern:/!=|not ?eq|not ?equal/,longer_alt:je}),$d=U({name:"IsLessThan",pattern:/<|below/,longer_alt:je}),Bd=U({name:"IsGreaterThan",pattern:/>|above/,longer_alt:je}),Fd=U({name:"IsLessThanOrEqual",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:je}),jd=U({name:"IsGreaterThanOrEqual",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:je}),Mc=U({name:"Or",pattern:/or/i,longer_alt:je}),xc=U({name:"Not",pattern:/not/i,longer_alt:je}),Uc=U({name:"And",pattern:/and/i,longer_alt:je}),Pc=U({name:"Plus",pattern:/\+/}),Dc=U({name:"Minus",pattern:/-/}),Gd=U({name:"Power",pattern:/\*\*/}),Kd=U({name:"Multiply",pattern:/\*/}),$c=U({name:"Divide",pattern:/\//}),Wd=U({name:"ModDivide",pattern:/%/}),Hd=U({name:"FloorDivide",pattern:/%%/}),Vd=U({name:"Query",pattern:/\?/}),zd=U({name:"LParen",pattern:/\(/,push_mode:"ignore_newlines"}),Yd=U({name:"RParen",pattern:/\)/,pop_mode:!0}),qd=U({name:"play",pattern:/play .*/,start_chars_hint:Cc,longer_alt:je}),Bc=Ye("if"),Xd=Ye("do"),pR=Ye("then",!0),Fc=Ye("else"),Jd=Ye("endif"),Qd=Ye("while"),Zd=Ye("endwhile"),ep=Ye("repeat"),tp=Ye("endrepeat"),np=Ye("read"),rp=Ye("into"),sp=Ye("endread"),ip=Ye("break"),op=Ye("continue");function ap(t){return[...t,Ud,Pd,Dd,Fd,$d,jd,Bd,Mc,xc,Uc,Pc,Dc,Gd,Kd,$c,Hd,Wd,Vd,zd,Yd,xd,je]}const cp=ap([Id,Lc,qd,Fn,Nd,Cd,Ld,Md,Fr,hR,Bc,Xd,pR,Fc,Jd,Qd,Zd,ep,tp,np,rp,sp,ip,op]),gR=new we({defaultMode:"use_newlines",modes:{use_newlines:cp,ignore_newlines:ap([fR])}},{skipValidations:!Vt,ensureOptimizations:Vt});function jc(t){Od=!0;const e=gR.tokenize(t||` 
`),[n]=(ge(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(eo(Fr,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}var be=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(be||{});function mR(t,e){return{id:Et(),tags:new Set,code:t,...e}}function yR(t){if(g(t))return{id:t.id,code:t.code,tags:[...t.tags],func:t.func,board:uE(t.board),object:wi(t.object),terrain:wi(t.terrain)}}function _R(t,e){return g(t)?e.every(n=>t.tags.has(n)):!1}function lp(t,e,n,r){return!g(t)||Ls(t)!==e?!1:n.some(s=>s===t.id)||r.includes(Ot(t))?!0:_R(t,r)}function ER(t){return t.map(e=>e.image)}function wR(t,e){const[n,r,...s]=e;if(g(t.stats)&&g(n))switch(n.image.toLowerCase()){case"rn":case"range":case"sl":case"select":case"nm":case"number":case"tx":case"text":case"ln":case"link":if(g(r)){const i=r.image.toLowerCase();t.stats[i]=ER(s??[])}break}}function up(t){const e={...ho(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function bR(t){return g(t)?(t.stats=void 0,ho(t)):{}}function ho(t){var r;if(!g(t))return{};if(g((r=t.stats)==null?void 0:r.type))return t.stats;t.stats={};const e=jc(t.code);let n=!0;for(let s=0;s<e.tokens.length;++s){const i=e.tokens[s];if(i.tokenType===Lc){const[o,...a]=i.image.slice(1).split(" "),c=o.toLowerCase(),l=a.join(" "),u=l.toLowerCase().trim();switch(c){case"stat":{const h=jc(`!${l}`);h.tokens.length&&wR(t,h.tokens);break}case"flags":t.stats.flags=u;break;case"cli":t.stats.type=1,t.stats.name=u;break;case"board":t.stats.type=2,t.stats.name=u;break;case"object":t.stats.type=3,t.stats.name=u;break;case"terrain":t.stats.type=4,t.stats.name=u;break;case"charset":t.stats.type=5,t.stats.name=u;break;case"palette":t.stats.type=6,t.stats.name=u;break;default:n?t.stats.name=[c,...a].join(" ").trim():t.stats[c]=1;break}n=!1}}return g(t.stats.type)||(t.stats.type=3),t.stats}function Ls(t){return ho(t).type??0}function Ms(t){switch(Ls(t)){default:case 0:return"error";case 1:return"cli";case 2:return"board";case 3:return"object";case 4:return"terrain";case 5:return"charset";case 6:return"palette"}}function Ot(t){return(ho(t).name??"").toLowerCase()}function zt(t){var e;switch((e=t==null?void 0:t.stats)==null?void 0:e.type){default:return;case 0:return(t==null?void 0:t.error)??"";case 2:return g(t.board)||(t.board=lE()),t.board.id=t.id,t.board;case 3:return g(t.object)||(t.object=Gu()),t.object.name=Ot(t),t.object;case 4:return g(t.terrain)||(t.terrain=Gu()),t.terrain.name=Ot(t),t.terrain;case 5:return g(t.charset),t.charset;case 6:return g(t.palette),t.palette}}function SR(t,e){return{id:Et(),name:Vy(),tags:new Set(e),pages:t,flags:{},players:{}}}function TR(t){if(g(t))return{id:t.id,name:t.name,tags:[...t.tags],pages:t.pages.map(yR).filter(g),flags:{},players:{}}}function AR(t,e){return g(t)?e.every(n=>t.tags.has(n)):!1}function vR(t,e,n){if(!g(t))return!1;if(e.some(s=>s===t.id))return!0;const r=t.name.toLowerCase();return n.includes(r)?!0:AR(t,n)}function fr(t,e){if(!g(t))return;const n=e.toLowerCase();return t.pages.find(s=>s.id===e||n===Ot(s))}function Gc(t,e,n){if(!g(t))return;const r=n.toLowerCase();return t.pages.find(i=>Ls(i)===e&&(i.id===n||r===Ot(i)))}function kR(t,e){if(!g(t)||!g(e))return!1;const n=fr(t,e.id);return g(n)?!1:(t.pages.push(e),!0)}function RR(t,e){const n=fr(t,e);if(g(t)&&g(n)){const r=e.toLowerCase();return t.pages=t.pages.filter(s=>s.id!==e&&r!==Ot(s)),n}}function It(t,e){if(g(e)&&g(e.kind))return g(e.kinddata)||(e.kinddata=g(e.id)?Kc(t,e.kind):hp(t,e.kind)),e.kinddata}function Kc(t,e){const n=e??"",r=Gc(t,be.OBJECT,n);if(g(r)){const s=up(r);return{...zt(r),...s,name:n,code:r.code}}else return}function OR(t,e){const n=e.map(r=>r.toLowerCase());return((t==null?void 0:t.pages)??[]).filter(r=>lp(r,be.OBJECT,e,n)).map(r=>zt(r)).filter(g)}function hp(t,e){const n=e??"",r=Gc(t,be.TERRAIN,n);if(g(r)){const s=up(r);return{...zt(r),...s,name:n,code:r.code}}else return}function Wc(t,e){return zt(fr(t,e))}function Hc(t,e){const n=e.map(r=>r.toLowerCase());return((t==null?void 0:t.pages)??[]).filter(r=>lp(r,be.BOARD,e,n)).map(r=>zt(r)).filter(g)}function fp(t,e){if(t)return t.flags[e]=t.flags[e]??{},t.flags[e]}function dp(t,e,n){const r=fp(t,e);return r==null?void 0:r[n]}function pp(t,e,n,r){const s=fp(t,e);return s&&(s[n]=r),r}function gp(t,e){return Wc(t,(t==null?void 0:t.players[e])??"")}function IR(t,e,n){g(t)&&g(Wc(t,n))&&(t.players[e]=n)}function NR(t){return rE(Object.values((t==null?void 0:t.players)??{})).map(n=>Wc(t,n)).filter(g)}function CR(t,e,n,r){const s=La(e,(n==null?void 0:n.id)??"");if(!g(t)||!g(e)||!g(s)||!g(s.x)||!g(s.y)||!g(e.lookup)||r.x<0||r.x>=e.width||r.y<0||r.y>=e.height)return{kind:"edge",collision:Me.ISSOLID,x:r.x,y:r.y};if(s.x-r.x===0&&s.y-r.y===0)return;const i=r.x+r.y*e.width,o=It(t,s),a=s.collision??(o==null?void 0:o.collision),c=La(e,e.lookup[i]??"");if(g(c))return{...c};const l=e.terrain[i];if(g(l)){const u=It(t,l),h=l.collision??(u==null?void 0:u.collision);if(Fu(a,h))return{...l,x:r.x,y:r.y}}s.x=r.x,s.y=r.y,g(s.removed)||(e.lookup[i]=void 0,e.lookup[s.x+s.y*e.width]=s.id??"")}function jr(t,e){const n=It(t,e);return g(e==null?void 0:e.id)&&g(e.x)&&g(e.y)?(e.name??(n==null?void 0:n.name)??"object").toLowerCase():((e==null?void 0:e.name)??(n==null?void 0:n.name)??"terrain").toLowerCase()}function Vc(t,e,n,r){if(!g(t)||!g(e)||!g(e.named)||!g(n))return;const s=jr(t,n);e.named[s]||(e.named[s]=new Set),e.named[s].add((n==null?void 0:n.id)??r??"")}function LR(t,e,n){if(!(!g(t)||!g(e)||!g(e.lookup)||!g(n==null?void 0:n.id))&&!g(n.removed)){const r=n.x??0,s=n.y??0;e.lookup[r+s*e.width]=n.id}}function xs(t,e){if(!g(t)||!g(e)||g(e.lookup)&&g(e.named))return;const n=new Array(e.width*e.height).fill(void 0),r={},s=Object.values(e.objects);for(let a=0;a<s.length;++a){const c=s[a];if(g(c.x)&&g(c.y)&&g(c.id)&&!g(c.removed)){c.category=Si.ISOBJECT,n[c.x+c.y*e.width]=c.id;const l=jr(t,c);r[l]||(r[l]=new Set),r[l].add(c.id)}}let i=0,o=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(g(c)){c.x=i,c.y=o,c.category=Si.ISTERRAIN;const l=jr(t,c);r[l]||(r[l]=new Set),r[l].add(a)}++i,i>=e.width&&(i=0,++o)}e.lookup=n,e.named=r}function zc(t,e,n){return jr(t,e)!=="player"&&g(e)?(e.removed=n,!0):!1}function fo(t,e,n){var r;if(g(t)&&g(e)&&g(n==null?void 0:n.id)){if(g(e.lookup)&&g(n.x)&&g(n.y)){const i=n.x+n.y*e.width;e.lookup[i]===n.id&&delete e.lookup[i]}const s=jr(t,n);g((r=e.named)==null?void 0:r[s])&&g(n.id)&&e.named[s].delete(n.id)}}function MR(t,e,n){if(!g(t)||!g(e))return;const r=Object.values(e.objects);for(let s=0;s<r.length;++s){const i=r[s];g(i.id)&&g(i.removed)&&n-i.removed>Fa*5&&Ma(e,i.id)}}function xR(t,e,n){const r=[];if(!g(t)||!g(e))return r;e.lookup=void 0,xs(t,e);const s=Object.values(e.objects);for(let i=0;i<s.length;++i){const o=s[i];if(!g(o.id))continue;o.lx=o.x,o.ly=o.y;const a=It(t,o),c=o.code??(a==null?void 0:a.code)??"";c&&r.push({id:o.id,type:be.OBJECT,code:c,object:o,terrain:void 0})}return MR(t,e,n),r}function UR(t,e,n,r){if(g(t)&&g(e)&&g(n)){const[s,i]=n,o=Kc(t,s);if(g(o)&&g(o.name)){const a=Ca(e,r,s);return g(a)&&(a.headless=!0,bi(a,i),Vc(t,e,a)),a}}}function po(t,e,n,r){if(g(t)&&g(e)&&g(n)){const[s,i]=n,o=hp(t,s);if(g(o)){const c=Vu(e,r,s);bi(c,i);const l=r.x+r.y*e.width;return Vc(t,e,c,l),c}const a=Kc(t,s);if(g(a)&&g(a.name)){const c=Ca(e,r,s);return bi(c,i),LR(t,e,c),Vc(t,e,c),c}}}var Us=(t=>(t[t.VIEW=0]="VIEW",t[t.EDIT=1]="EDIT",t))(Us||{});function mp(t){return{id:Et(),type:t}}function yp(t,e){const n=mp(0);return n.book=t,n.board=e,n}function PR(t,e){const n=mp(1);return n.book=t,n.board=e,n}const qe={defaultplayer:"",books:new Map,chips:new Map,frames:new Map,tags:{main:new Set(["main"]),title:new Set(["title"]),player:new Set(["player"])}};function Yc(t){const e=t.toLowerCase();return[...qe.tags[e]??[]]}function Gr(){return Yc("main")}function _p(){return Yc("title")}function DR(){return Yc("player")}function $R(t){qe.defaultplayer=t}function Ep(t){const e=[yp([],[])];return qe.frames.set(t,e),e}function BR(t,e,n){const r=go(t);g(r)&&r.push(yp(e,n))}function FR(t,e,n){const r=go(t);g(r)&&r.push(PR(e,n))}function go(t){return qe.frames.get(t)??Ep(t)}function Kr(){return[...qe.books.values()]}function Yt(t){const e=t.toLowerCase();return qe.books.get(t)??Kr().find(n=>n.name.toLowerCase()===e)}function jn(t){const e=t.map(n=>n.toLowerCase());return Kr().filter(n=>vR(n,t,e))}function jR(t){qe.books.clear(),t.forEach(e=>{qe.books.set(e.id,e)})}function GR(t){return qe.books.set(t.id,t),t.id}function KR(t){const e=Yt(t);e&&qe.books.delete(e.id)}function q(t){let e=qe.chips.get(t);return g(e)||(e={book:void 0,board:void 0,object:void 0,terrain:void 0,charset:void 0,palette:void 0,player:qe.defaultplayer,inputqueue:new Set,inputmods:{[me.NONE]:0,[me.MOVE_UP]:0,[me.MOVE_DOWN]:0,[me.MOVE_LEFT]:0,[me.MOVE_RIGHT]:0,[me.OK_BUTTON]:0,[me.CANCEL_BUTTON]:0,[me.MENU_BUTTON]:0},inputcurrent:void 0},qe.chips.set(t,e)),e}function I(t,e){const n=q(t.id());return _E(n,e,t.get)}function WR(t){if(!z(t)||!t)return un("memory","login",`failed for playerid ==>${t}<==`,t);const e=Gr(),[n]=jn(e);if(!g(n))return un("memory","login",`login failed to find book ${e.join(". ")}`,t);const r=_p(),[s]=Hc(n,r);if(!g(s))return un("memory","login",`login failed to find board ${r.join(", ")}`,t);const i=DR(),[o]=OR(n,i);if(!g(o))return un("memory","login",`login failed to find object type ${i.join(", ")}`,t);const a={x:0,y:0},c=o.name??"player",l=Ca(s,a,c,t);return g(l==null?void 0:l.id)&&g(s.id)?(IR(n,t,s.id),!0):!1}function HR(t){qe.books.forEach(e=>Ma(gp(e,t),t))}function VR(t,e){const n=Gr(),[r]=jn(n);NR(r).forEach(i=>{const o=xR(r,i,e);for(let a=0;a<o.length;++a){const c=o[a],l=q(c.id);l.book=r,l.board=i,l.object=c.object,l.inputcurrent=void 0;const u=Oa(c.object,"player",""),h=It(r,c.object),d=Oa(h,"cycle",ph),f=Oa(c.object,"cycle",d),p=pe(f)?f:ph;l.player=z(u)?u:"";const _=Hu(c.object);t.tick(c.id,c.type,p,e,_,c.code)}})}function zR(t,e,n,r){const s=`${n}_cli`,i=q(s);i.player=n,i.book=void 0,i.board=void 0,i.inputcurrent=void 0,Du("memory","running",e,s,r),t.once(s,be.CLI,e,"cli",r)}function YR(t,e,n,r,s,i){const o=[];let a=e;const c=a===0,l=r.width??0,u=r.height??0,h=c?ve.BLACK:ve.CLEAR,d=L_(t,a++,l,u,h);o.push(d);const f=U_(t,a++,l,u);o.push(f);const p=a++,_=x_(t,p);o.push(_);const S=P_(t,a++);s&&o.push(S),r.terrain.forEach((w,m)=>{if(w){const y=It(n,w);d.char[m]=w.char??(y==null?void 0:y.char)??0,d.color[m]=w.color??(y==null?void 0:y.color)??h,d.bg[m]=w.bg??(y==null?void 0:y.bg)??h,d.color[m]!==ve.CLEAR&&(i[m]=d.color[m])}});const T=r.objects??{};Object.values(T).forEach(w=>{if(g(w.removed)||g(w.headless))return;const m=w.id??"",y=It(n,w),b=M_(t,p,m),v=w.lx??w.x??0,W=w.ly??w.y??0,fe=v+W*r.width;b.x=w.x??0,b.y=w.y??0,b.char=w.char??(y==null?void 0:y.char)??1,b.color=w.color??(y==null?void 0:y.color)??ve.WHITE,b.bg=w.bg??(y==null?void 0:y.bg)??ve.BORROW,_.sprites.push(b),b.bg===ve.SHADOW&&(b.bg=ve.CLEAR,f.alphas[v+W*l]=.5),b.bg===ve.BORROW&&(b.bg=i[fe]??ve.BLACK),b.color!==ve.CLEAR&&(i[fe]=b.color),m===t&&(S.focusx=b.x,S.focusy=b.y,S.focusid=m)});function E(w,m){if(!(w<0||w>=r.width||m<0||m>=r.height))return f.alphas[w+m*r.width]}const A=[[1,1,1,1,1],[1,3,5,3,1],[1,5,12,5,1],[1,3,5,3,1],[1,1,1,1,1]].flat(),O=new Array(f.alphas.length);for(let w=0;w<f.alphas.length;++w){const m=w%r.width,y=Math.floor(w/r.width),b=[[E(m-2,y-2),E(m-1,y-2),E(m,y-2),E(m+1,y-2),E(m+2,y-2)],[E(m-2,y-1),E(m-1,y-1),E(m,y-1),E(m+1,y-1),E(m+2,y-1)],[E(m-2,y),E(m-1,y),E(m,y),E(m+1,y),E(m+2,y)],[E(m-2,y+1),E(m-1,y+1),E(m,y+1),E(m+1,y+1),E(m+2,y+1)],[E(m-2,y+2),E(m-1,y+2),E(m,y+2),E(m+1,y+2),E(m+2,y+2)]].flat().map((v,W)=>g(v)?v*A[W]:void 0).filter(g);O[w]=rr(sE(b),0,1)}return f.alphas=O,o}function wp(t){switch(t.type){case Us.EDIT:return 1;case Us.VIEW:return 2}return 0}function qR(t){const[e]=jn(Gr()),n=gp(e,t),r=[];if(!g(e)||!g(n))return r;let s=0;const i=[...go(n.id??"")],o=new Array(n.width*n.height).fill(0);return i.sort((a,c)=>wp(a)-wp(c)),i.forEach(a=>{const[c]=jn(a.book??Gr());if(!g(c))return;const[l]=Hc(c,a.board??_p());if(!g(l))return;const u=YR(t,s,c,l,a.type===Us.VIEW,o);s+=u.length,r.push(...u)}),r}var bp={exports:{}},qc={exports:{}},Sp;function XR(){return Sp||(Sp=1,function(t,e){(function(n,r){t.exports=r()})(it,function(){function n(_){return!isNaN(parseFloat(_))&&isFinite(_)}function r(_){return _.charAt(0).toUpperCase()+_.substring(1)}function s(_){return function(){return this[_]}}var i=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=i.concat(o,a,c,l);function h(_){if(_)for(var S=0;S<u.length;S++)_[u[S]]!==void 0&&this["set"+r(u[S])](_[u[S]])}h.prototype={getArgs:function(){return this.args},setArgs:function(_){if(Object.prototype.toString.call(_)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=_},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(_){if(_ instanceof h)this.evalOrigin=_;else if(_ instanceof Object)this.evalOrigin=new h(_);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var _=this.getFileName()||"",S=this.getLineNumber()||"",T=this.getColumnNumber()||"",E=this.getFunctionName()||"";return this.getIsEval()?_?"[eval] ("+_+":"+S+":"+T+")":"[eval]:"+S+":"+T:E?E+" ("+_+":"+S+":"+T+")":_+":"+S+":"+T}},h.fromString=function(S){var T=S.indexOf("("),E=S.lastIndexOf(")"),A=S.substring(0,T),O=S.substring(T+1,E).split(","),w=S.substring(E+1);if(w.indexOf("@")===0)var m=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(w,""),y=m[1],b=m[2],v=m[3];return new h({functionName:A,args:O||void 0,fileName:y,lineNumber:b||void 0,columnNumber:v||void 0})};for(var d=0;d<i.length;d++)h.prototype["get"+r(i[d])]=s(i[d]),h.prototype["set"+r(i[d])]=function(_){return function(S){this[_]=!!S}}(i[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=s(o[f]),h.prototype["set"+r(o[f])]=function(_){return function(S){if(!n(S))throw new TypeError(_+" must be a Number");this[_]=Number(S)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=s(a[p]),h.prototype["set"+r(a[p])]=function(_){return function(S){this[_]=String(S)}}(a[p]);return h})}(qc)),qc.exports}(function(t,e){(function(n,r){t.exports=r(XR())})(it,function(r){var s=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(i))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,_=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:_,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,_;f.match(/\(([^)]*)\)/)&&(_=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var S=_===void 0||_==="[arguments not available]"?void 0:_.split(",");return new r({functionName:p,args:S,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(bp);var JR=bp.exports,QR=di(JR),Tp={},Ap={},vp={};const kp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");vp.encode=function(t){if(0<=t&&t<kp.length)return kp[t];throw new TypeError("Must be between 0 and 63: "+t)};const ZR=vp,Rp=5,Op=1<<Rp,e0=Op-1,t0=Op;function n0(t){return t<0?(-t<<1)+1:(t<<1)+0}Ap.encode=function(e){let n="",r,s=n0(e);do r=s&e0,s>>>=Rp,s>0&&(r|=t0),n+=ZR.encode(r);while(s>0);return n};var Ps={};(function(t){function e(m,y,b){if(y in m)return m[y];if(arguments.length===3)return b;throw new Error('"'+y+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function s(m){const y=m.match(n);return y?{scheme:y[1],auth:y[2],host:y[3],port:y[4],path:y[5]}:null}t.urlParse=s;function i(m){let y="";return m.scheme&&(y+=m.scheme+":"),y+="//",m.auth&&(y+=m.auth+"@"),m.host&&(y+=m.host),m.port&&(y+=":"+m.port),m.path&&(y+=m.path),y}t.urlGenerate=i;const o=32;function a(m){const y=[];return function(b){for(let W=0;W<y.length;W++)if(y[W].input===b){const fe=y[0];return y[0]=y[W],y[W]=fe,y[0].result}const v=m(b);return y.unshift({input:b,result:v}),y.length>o&&y.pop(),v}}const c=a(function(y){let b=y;const v=s(y);if(v){if(!v.path)return y;b=v.path}const W=t.isAbsolute(b),fe=[];let is=0,Oe=0;for(;;)if(is=Oe,Oe=b.indexOf("/",is),Oe===-1){fe.push(b.slice(is));break}else for(fe.push(b.slice(is,Oe));Oe<b.length&&b[Oe]==="/";)Oe++;let sn=0;for(Oe=fe.length-1;Oe>=0;Oe--){const yt=fe[Oe];yt==="."?fe.splice(Oe,1):yt===".."?sn++:sn>0&&(yt===""?(fe.splice(Oe+1,sn),sn=0):(fe.splice(Oe,2),sn--))}return b=fe.join("/"),b===""&&(b=W?"/":"."),v?(v.path=b,i(v)):b});t.normalize=c;function l(m,y){m===""&&(m="."),y===""&&(y=".");const b=s(y),v=s(m);if(v&&(m=v.path||"/"),b&&!b.scheme)return v&&(b.scheme=v.scheme),i(b);if(b||y.match(r))return y;if(v&&!v.host&&!v.path)return v.host=y,i(v);const W=y.charAt(0)==="/"?y:c(m.replace(/\/+$/,"")+"/"+y);return v?(v.path=W,i(v)):W}t.join=l,t.isAbsolute=function(m){return m.charAt(0)==="/"||n.test(m)};function u(m,y){m===""&&(m="."),m=m.replace(/\/$/,"");let b=0;for(;y.indexOf(m+"/")!==0;){const v=m.lastIndexOf("/");if(v<0||(m=m.slice(0,v),m.match(/^([^\/]+:\/)?\/*$/)))return y;++b}return Array(b+1).join("../")+y.substr(m.length+1)}t.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(m){return m}function f(m){return _(m)?"$"+m:m}t.toSetString=h?d:f;function p(m){return _(m)?m.slice(1):m}t.fromSetString=h?d:p;function _(m){if(!m)return!1;const y=m.length;if(y<9||m.charCodeAt(y-1)!==95||m.charCodeAt(y-2)!==95||m.charCodeAt(y-3)!==111||m.charCodeAt(y-4)!==116||m.charCodeAt(y-5)!==111||m.charCodeAt(y-6)!==114||m.charCodeAt(y-7)!==112||m.charCodeAt(y-8)!==95||m.charCodeAt(y-9)!==95)return!1;for(let b=y-10;b>=0;b--)if(m.charCodeAt(b)!==36)return!1;return!0}function S(m,y,b){let v=E(m.source,y.source);return v!==0||(v=m.originalLine-y.originalLine,v!==0)||(v=m.originalColumn-y.originalColumn,v!==0||b)||(v=m.generatedColumn-y.generatedColumn,v!==0)||(v=m.generatedLine-y.generatedLine,v!==0)?v:E(m.name,y.name)}t.compareByOriginalPositions=S;function T(m,y,b){let v=m.generatedLine-y.generatedLine;return v!==0||(v=m.generatedColumn-y.generatedColumn,v!==0||b)||(v=E(m.source,y.source),v!==0)||(v=m.originalLine-y.originalLine,v!==0)||(v=m.originalColumn-y.originalColumn,v!==0)?v:E(m.name,y.name)}t.compareByGeneratedPositionsDeflated=T;function E(m,y){return m===y?0:m===null?1:y===null?-1:m>y?1:-1}function A(m,y){let b=m.generatedLine-y.generatedLine;return b!==0||(b=m.generatedColumn-y.generatedColumn,b!==0)||(b=E(m.source,y.source),b!==0)||(b=m.originalLine-y.originalLine,b!==0)||(b=m.originalColumn-y.originalColumn,b!==0)?b:E(m.name,y.name)}t.compareByGeneratedPositionsInflated=A;function O(m){return JSON.parse(m.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=O;function w(m,y,b){if(y=y||"",m&&(m[m.length-1]!=="/"&&y[0]!=="/"&&(m+="/"),y=m+y),b){const v=s(b);if(!v)throw new Error("sourceMapURL could not be parsed");if(v.path){const W=v.path.lastIndexOf("/");W>=0&&(v.path=v.path.substring(0,W+1))}y=l(i(v),y)}return c(y)}t.computeSourceURL=w})(Ps);var Xc={};let r0=class Iy{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new Iy;for(let s=0,i=e.length;s<i;s++)r.add(e[s],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),s=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,s)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};Xc.ArraySet=r0;var Ip={};const Np=Ps;function s0(t,e){const n=t.generatedLine,r=e.generatedLine,s=t.generatedColumn,i=e.generatedColumn;return r>n||r==n&&i>=s||Np.compareByGeneratedPositionsInflated(t,e)<=0}let i0=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){s0(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(Np.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};Ip.MappingList=i0;const Ds=Ap,de=Ps,mo=Xc.ArraySet,o0=Ip.MappingList;let Cp=class Ny{constructor(e){e||(e={}),this._file=de.getArg(e,"file",null),this._sourceRoot=de.getArg(e,"sourceRoot",null),this._skipValidation=de.getArg(e,"skipValidation",!1),this._sources=new mo,this._names=new mo,this._mappings=new o0,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new Ny({file:e.file,sourceRoot:n});return e.eachMapping(function(s){const i={generated:{line:s.generatedLine,column:s.generatedColumn}};s.source!=null&&(i.source=s.source,n!=null&&(i.source=de.relative(n,i.source)),i.original={line:s.originalLine,column:s.originalColumn},s.name!=null&&(i.name=s.name)),r.addMapping(i)}),e.sources.forEach(function(s){let i=s;n!==null&&(i=de.relative(n,s)),r._sources.has(i)||r._sources.add(i);const o=e.sourceContentFor(s);o!=null&&r.setSourceContent(s,o)}),r}addMapping(e){const n=de.getArg(e,"generated"),r=de.getArg(e,"original",null);let s=de.getArg(e,"source",null),i=de.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,s,i),s!=null&&(s=String(s),this._sources.has(s)||this._sources.add(s)),i!=null&&(i=String(i),this._names.has(i)||this._names.add(i)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:s,name:i})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=de.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[de.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[de.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let s=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);s=e.file}const i=this._sourceRoot;i!=null&&(s=de.relative(i,s));const o=this._mappings.toArray().length>0?new mo:this._sources,a=new mo;this._mappings.unsortedForEach(function(c){if(c.source===s&&c.originalLine!=null){const h=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=de.join(r,c.source)),i!=null&&(c.source=de.relative(i,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=de.join(r,c)),i!=null&&(c=de.relative(i,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,s){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!s)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:s}))}}_serializeMappings(){let e=0,n=1,r=0,s=0,i=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(l=d[f],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!de.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=Ds.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=Ds.encode(h-o),o=h,c+=Ds.encode(l.originalLine-1-s),s=l.originalLine-1,c+=Ds.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Ds.encode(u-i),i=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=de.relative(n,r));const s=de.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,s)?this._sourcesContents[s]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};Cp.prototype._version=3,Tp.SourceMapGenerator=Cp;var Lp={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,s,i,o,a){const c=Math.floor((r-n)/2)+n,l=o(s,i[c],!0);return l===0?c:l>0?r-c>1?e(c,r,s,i,o,a):a==t.LEAST_UPPER_BOUND?r<i.length?r:-1:c:c-n>1?e(n,c,s,i,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,s,i,o){if(s.length===0)return-1;let a=e(-1,s.length,r,s,i,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&i(s[a],s[a-1],!0)===0;)--a;return a}})(Lp);var $s={exports:{}},a0={},c0=Object.freeze({__proto__:null,default:a0}),Mp=Cy(c0);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;$s.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},$s.exports.initialize=e=>t=e}else{const t=Mp,e=Mp;$s.exports=function(){return new Promise((r,s)=>{const i=e.join(__dirname,"mappings.wasm");t.readFile(i,null,(o,a)=>{if(o){s(o);return}r(a.buffer)})})},$s.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var xp=$s.exports;const l0=xp;function u0(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Bs=null;var h0=function(){if(Bs)return Bs;const e=[];return Bs=l0().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,s,i,o,a,c,l,u,h,d){const f=new u0;f.generatedLine=r+1,f.generatedColumn=s,i&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),e[e.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,s)=>{e.push(r);try{s()}finally{e.pop()}}})).then(null,n=>{throw Bs=null,n}),Bs};const C=Ps,Jc=Lp,yo=Xc.ArraySet,f0=xp,d0=h0,Qc=Symbol("smcInternal");class ue{constructor(e,n){return e==Qc?Promise.resolve(this):g0(e,n)}static initialize(e){f0.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return m0(e,n)}static async with(e,n,r){const s=await new ue(e,n);try{return await r(s)}finally{s.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ue.prototype._version=3,ue.GENERATED_ORDER=1,ue.ORIGINAL_ORDER=2,ue.GREATEST_LOWER_BOUND=1,ue.LEAST_UPPER_BOUND=2;class Fs extends ue{constructor(e,n){return super(Qc).then(r=>{let s=e;typeof e=="string"&&(s=C.parseSourceMapInput(e));const i=C.getArg(s,"version");let o=C.getArg(s,"sources");const a=C.getArg(s,"names",[]);let c=C.getArg(s,"sourceRoot",null);const l=C.getArg(s,"sourcesContent",null),u=C.getArg(s,"mappings"),h=C.getArg(s,"file",null);if(i!=r._version)throw new Error("Unsupported version: "+i);return c&&(c=C.normalize(c)),o=o.map(String).map(C.normalize).map(function(d){return c&&C.isAbsolute(c)&&C.isAbsolute(d)?C.relative(c,d):d}),r._names=yo.fromArray(a.map(String),!0),r._sources=yo.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return C.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,d0().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=C.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new Fs(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,s=this._wasm.exports.allocate_mappings(r),i=new Uint8Array(this._wasm.exports.memory.buffer,s,r);for(let a=0;a<r;a++)i[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(s);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const s=n||null,i=r||ue.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=C.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(s,a)},()=>{switch(i){case ue.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ue.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=C.getArg(e,"source");const r=C.getArg(e,"line"),s=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(s<0)throw new Error("Column numbers must be >= 0");const i=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),i.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,s)}),i}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:C.getArg(e,"line"),generatedColumn:C.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=C.getArg(e,"bias",ue.GREATEST_LOWER_BOUND);r==null&&(r=ue.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(i=>s=i,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),s&&s.generatedLine===n.generatedLine){let i=C.getArg(s,"source",null);i!==null&&(i=this._sources.at(i),i=C.computeSourceURL(this.sourceRoot,i,this._sourceMapURL));let o=C.getArg(s,"name",null);return o!==null&&(o=this._names.at(o)),{source:i,line:C.getArg(s,"originalLine",null),column:C.getArg(s,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let s=e;this.sourceRoot!=null&&(s=C.relative(this.sourceRoot,s));let i;if(this.sourceRoot!=null&&(i=C.urlParse(this.sourceRoot))){const o=s.replace(/^file:\/\//,"");if(i.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!i.path||i.path=="/")&&this._sources.has("/"+s))return this.sourcesContent[this._sources.indexOf("/"+s)]}if(n)return null;throw new Error('"'+s+'" is not in the SourceMap.')}generatedPositionFor(e){let n=C.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:C.getArg(e,"line"),originalColumn:C.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let s=C.getArg(e,"bias",ue.GREATEST_LOWER_BOUND);s==null&&(s=ue.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(o=>i=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,s)}),i&&i.source===r.source){let o=i.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:C.getArg(i,"generatedLine",null),column:C.getArg(i,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Fs.prototype.consumer=ue;class p0 extends ue{constructor(e,n){return super(Qc).then(r=>{let s=e;typeof e=="string"&&(s=C.parseSourceMapInput(e));const i=C.getArg(s,"version"),o=C.getArg(s,"sections");if(i!=r._version)throw new Error("Unsupported version: "+i);r._sources=new yo,r._names=new yo,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=C.getArg(c,"offset"),u=C.getArg(l,"line"),h=C.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new ue(C.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(C.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(C.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:C.getArg(e,"line"),generatedColumn:C.getArg(e,"column")},r=Jc.search(n,this._sections,function(i,o){const a=i.generatedLine-o.generatedOffset.generatedLine;return a||i.generatedColumn-o.generatedOffset.generatedColumn}),s=this._sections[r];return s?s.consumer.originalPositionFor({line:n.generatedLine-(s.generatedOffset.generatedLine-1),column:n.generatedColumn-(s.generatedOffset.generatedLine===n.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const i=this._sections[r].consumer.sourceContentFor(e,!0);if(i)return i}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(C.getArg(e,"source"))===-1)continue;const s=r.consumer.generatedPositionFor(e);if(s)return{line:s.line+(r.generatedOffset.generatedLine-1),column:s.column+(r.generatedOffset.generatedLine===s.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],s=this.__originalMappingsUnsorted=[];for(let i=0;i<this._sections.length;i++){const o=this._sections[i],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=C.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&s.push(d)}}}eachMapping(e,n,r){const s=n||null,i=r||ue.GENERATED_ORDER;let o;switch(i){case ue.GENERATED_ORDER:o=this._generatedMappings;break;case ue.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=C.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,s)}_findMapping(e,n,r,s,i,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[s]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[s]);return Jc.search(e,n,i,o)}allGeneratedPositionsFor(e){const n=C.getArg(e,"line"),r={source:C.getArg(e,"source"),originalLine:n,originalColumn:C.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const s=[];let i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",C.compareByOriginalPositions,Jc.LEAST_UPPER_BOUND);if(i>=0){let o=this._originalMappings[i];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:C.getArg(o,"generatedLine",null),column:C.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:C.getArg(o,"generatedLine",null),column:C.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}}return s}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function g0(t,e){let n=t;typeof t=="string"&&(n=C.parseSourceMapInput(t));const r=n.sections!=null?new p0(n,e):new Fs(n,e);return Promise.resolve(r)}function m0(t,e){return Fs.fromSourceMap(t,e)}var Up={};const y0=Tp.SourceMapGenerator,_o=Ps,_0=/(\r?\n)/,E0=10,Wr="$$$isSourceNode$$$";let w0=class pu{constructor(e,n,r,s,i){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=i??null,this[Wr]=!0,s!=null&&this.add(s)}static fromStringWithSourceMap(e,n,r){const s=new pu,i=e.split(_0);let o=0;const a=function(){const f=_(),p=_()||"";return f+p;function _(){return o<i.length?i[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=i[o]||"";const p=h.substr(0,f.generatedColumn-l);i[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,p),u=f;return}for(;c<f.generatedLine;)s.add(a()),c++;l<f.generatedColumn&&(h=i[o]||"",s.add(h.substr(0,f.generatedColumn)),i[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<i.length&&(u&&d(u,a()),s.add(i.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=_o.join(r,f)),s.setSourceContent(f,p))}),s;function d(f,p){if(f===null||f.source===void 0)s.add(p);else{const _=r?_o.join(r,f.source):f.source;s.add(new pu(f.originalLine,f.originalColumn,_,p,f.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[Wr]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[Wr]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,s=this.children.length;r<s;r++)n=this.children[r],n[Wr]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const s=this.children.length;if(s>0){for(n=[],r=0;r<s-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[Wr]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[_o.toSetString(e)]=n}walkSourceContents(e){for(let r=0,s=this.children.length;r<s;r++)this.children[r][Wr]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,s=n.length;r<s;r++)e(_o.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new y0(e);let s=!1,i=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((i!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),i=u.source,o=u.line,a=u.column,c=u.name,s=!0):s&&(r.addMapping({generated:{line:n.line,column:n.column}}),i=null,s=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===E0?(n.line++,n.column=0,h+1===d?(i=null,s=!1):s&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};Up.SourceNode=w0;var b0=Up.SourceNode,Pp={exports:{}},F={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var js=Symbol.for("react.element"),S0=Symbol.for("react.portal"),T0=Symbol.for("react.fragment"),A0=Symbol.for("react.strict_mode"),v0=Symbol.for("react.profiler"),k0=Symbol.for("react.provider"),R0=Symbol.for("react.context"),O0=Symbol.for("react.forward_ref"),I0=Symbol.for("react.suspense"),N0=Symbol.for("react.memo"),C0=Symbol.for("react.lazy"),Dp=Symbol.iterator;function L0(t){return t===null||typeof t!="object"?null:(t=Dp&&t[Dp]||t["@@iterator"],typeof t=="function"?t:null)}var $p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Bp=Object.assign,Fp={};function Hr(t,e,n){this.props=t,this.context=e,this.refs=Fp,this.updater=n||$p}Hr.prototype.isReactComponent={},Hr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},Hr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function jp(){}jp.prototype=Hr.prototype;function Zc(t,e,n){this.props=t,this.context=e,this.refs=Fp,this.updater=n||$p}var el=Zc.prototype=new jp;el.constructor=Zc,Bp(el,Hr.prototype),el.isPureReactComponent=!0;var Gp=Array.isArray,Kp=Object.prototype.hasOwnProperty,tl={current:null},Wp={key:!0,ref:!0,__self:!0,__source:!0};function Hp(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Kp.call(e,r)&&!Wp.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];s.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:js,type:t,key:i,ref:o,props:s,_owner:tl.current}}function M0(t,e){return{$$typeof:js,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function nl(t){return typeof t=="object"&&t!==null&&t.$$typeof===js}function x0(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Vp=/\/+/g;function rl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?x0(""+t.key):e.toString(36)}function Eo(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case js:case S0:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+rl(o,0):r,Gp(s)?(n="",t!=null&&(n=t.replace(Vp,"$&/")+"/"),Eo(s,e,n,"",function(l){return l})):s!=null&&(nl(s)&&(s=M0(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Vp,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Gp(t))for(var a=0;a<t.length;a++){i=t[a];var c=r+rl(i,a);o+=Eo(i,e,n,c,s)}else if(c=L0(t),typeof c=="function")for(t=c.call(t),a=0;!(i=t.next()).done;)i=i.value,c=r+rl(i,a++),o+=Eo(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function wo(t,e,n){if(t==null)return t;var r=[],s=0;return Eo(t,r,"","",function(i){return e.call(n,i,s++)}),r}function U0(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ge={current:null},bo={transition:null},P0={ReactCurrentDispatcher:Ge,ReactCurrentBatchConfig:bo,ReactCurrentOwner:tl};function zp(){throw Error("act(...) is not supported in production builds of React.")}F.Children={map:wo,forEach:function(t,e,n){wo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return wo(t,function(){e++}),e},toArray:function(t){return wo(t,function(e){return e})||[]},only:function(t){if(!nl(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},F.Component=Hr,F.Fragment=T0,F.Profiler=v0,F.PureComponent=Zc,F.StrictMode=A0,F.Suspense=I0,F.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P0,F.act=zp,F.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Bp({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=tl.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)Kp.call(e,c)&&!Wp.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:js,type:t.type,key:s,ref:i,props:r,_owner:o}},F.createContext=function(t){return t={$$typeof:R0,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:k0,_context:t},t.Consumer=t},F.createElement=Hp,F.createFactory=function(t){var e=Hp.bind(null,t);return e.type=t,e},F.createRef=function(){return{current:null}},F.forwardRef=function(t){return{$$typeof:O0,render:t}},F.isValidElement=nl,F.lazy=function(t){return{$$typeof:C0,_payload:{_status:-1,_result:t},_init:U0}},F.memo=function(t,e){return{$$typeof:N0,type:t,compare:e===void 0?null:e}},F.startTransition=function(t){var e=bo.transition;bo.transition={};try{t()}finally{bo.transition=e}},F.unstable_act=zp,F.useCallback=function(t,e){return Ge.current.useCallback(t,e)},F.useContext=function(t){return Ge.current.useContext(t)},F.useDebugValue=function(){},F.useDeferredValue=function(t){return Ge.current.useDeferredValue(t)},F.useEffect=function(t,e){return Ge.current.useEffect(t,e)},F.useId=function(){return Ge.current.useId()},F.useImperativeHandle=function(t,e,n){return Ge.current.useImperativeHandle(t,e,n)},F.useInsertionEffect=function(t,e){return Ge.current.useInsertionEffect(t,e)},F.useLayoutEffect=function(t,e){return Ge.current.useLayoutEffect(t,e)},F.useMemo=function(t,e){return Ge.current.useMemo(t,e)},F.useReducer=function(t,e,n){return Ge.current.useReducer(t,e,n)},F.useRef=function(t){return Ge.current.useRef(t)},F.useState=function(t){return Ge.current.useState(t)},F.useSyncExternalStore=function(t,e,n){return Ge.current.useSyncExternalStore(t,e,n)},F.useTransition=function(){return Ge.current.useTransition()},F.version="18.3.1",Pp.exports=F;var D0=Pp.exports;const $0=va(32,126).map(t=>String.fromCharCode(t)),B0=U({name:"Whitespace",pattern:/ +/}),F0=U({name:"WhitespaceSkipped",pattern:/ +/,group:we.SKIPPED}),Yp=U({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),qp=U({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:$0}),Xp=U({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Jp=U({name:"EscapedDollar",pattern:"$$"}),sl=U({name:"MaybeFlag",pattern:/\$[^ $\r\n]+/}),Qp=U({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),Zp=U({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function j0(t,e=""){return U({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const eg=Object.keys(Pa).map(t=>j0(`\\$(${t})`,t)),G0=[B0,Yp,...eg,Xp,qp,Qp,Jp,Zp,sl],K0=new we(G0,{skipValidations:!Vt,ensureOptimizations:Vt}),W0=new we([F0,Yp,...eg,Xp,qp,Qp,Jp,Zp,sl],{skipValidations:!Vt,ensureOptimizations:Vt});function H0(t,e=!1){return e?W0.tokenize(t):K0.tokenize(t)}function V0(t,e,n,r,s,i,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:s,leftedge:i,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:s,leftedge:i,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[]}}D0.createContext(V0(1,1,15,1));let tg=0;const ng=Vt,z0=["Command","lines"];class Y0 extends cR{constructor(){super(cp,{traceInitPerf:Vt,skipValidations:!Vt,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});P(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));P(this,"line",this.RULED("line",()=>{this.OPTION(()=>this.SUBRULE(this.stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(Fr))}));P(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.label)},{ALT:()=>this.SUBRULE(this.stat)},{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>this.SUBRULE(this.hyperlink)},{ALT:()=>this.SUBRULE(this.Short_go)},{ALT:()=>this.SUBRULE(this.Short_try)}])}));P(this,"do_stmt",this.RULED("do_stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stat)},{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>this.SUBRULE(this.hyperlink)},{ALT:()=>this.SUBRULE(this.Short_go)},{ALT:()=>this.SUBRULE(this.Short_try)}])}));P(this,"label",this.RULED("label",()=>{this.CONSUME(Cd)}));P(this,"stat",this.RULED("stat",()=>{this.CONSUME(Lc)}));P(this,"text",this.RULED("text",()=>{this.CONSUME(Id)}));P(this,"comment",this.RULED("comment",()=>{this.CONSUME(Nd)}));P(this,"hyperlink",this.RULED("hyperlink",()=>{this.CONSUME(Ld),this.SUBRULE(this.words),this.CONSUME(Md)}));P(this,"command",this.RULED("command",()=>{this.CONSUME(Fn),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.Command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));P(this,"flat_cmd",this.RULED("flat_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.Command_play)},{ALT:()=>this.SUBRULE(this.Short_go)},{ALT:()=>this.SUBRULE(this.Short_try)}])}));P(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.Command_if)},{ALT:()=>this.SUBRULE(this.Command_read)},{ALT:()=>this.SUBRULE(this.Command_while)},{ALT:()=>this.SUBRULE(this.Command_repeat)},{ALT:()=>this.SUBRULE(this.Command_break)},{ALT:()=>this.SUBRULE(this.Command_continue)}])}));P(this,"Short_go",this.RULED("Short_go",()=>{this.CONSUME($c),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.do_stmt))}));P(this,"Short_try",this.RULED("Short_try",()=>{this.CONSUME(Vd),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.do_stmt))}));P(this,"Command_play",this.RULED("Command_play",()=>{this.CONSUME(qd)}));P(this,"do_line",this.RULED("do_line",()=>{this.CONSUME(Xd),this.OPTION1(()=>this.CONSUME1(Fr)),this.OPTION2(()=>this.SUBRULE(this.do_stmt)),this.AT_LEAST_ONE(()=>this.CONSUME2(Fr))}));P(this,"Command_if",this.RULED("Command_if",()=>{this.CONSUME(Bc),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>{this.SUBRULE(this.flat_cmd)}},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));P(this,"Command_else_if",this.RULED("Command_else_if",()=>{this.CONSUME(Fn),this.CONSUME(Fc),this.CONSUME(Bc),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>{this.SUBRULE(this.flat_cmd)}},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));P(this,"Command_else",this.RULED("Command_else",()=>{this.CONSUME(Fn),this.CONSUME(Fc),this.OPTION(()=>{this.OR([{ALT:()=>{this.SUBRULE(this.flat_cmd)}},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.SUBRULE(this.Command_endif)}}])})}));P(this,"Command_endif",this.RULED("Command_endif",()=>{this.CONSUME(Fn),this.CONSUME(Jd)}));P(this,"Command_while",this.RULED("Command_while",()=>{this.CONSUME(Qd),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>{this.SUBRULE(this.flat_cmd)}},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(Fn),this.CONSUME4(Zd)}}])})}));P(this,"Command_repeat",this.RULED("Command_repeat",()=>{this.CONSUME(ep),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>{this.SUBRULE(this.flat_cmd)}},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(Fn),this.CONSUME4(tp)}}])})}));P(this,"Command_read_flags",this.RULED("Command_read_flags",()=>{this.AT_LEAST_ONE(()=>this.CONSUME(je))}));P(this,"Command_read",this.RULED("Command_read",()=>{this.CONSUME(np),this.SUBRULE(this.words),this.CONSUME(rp),this.SUBRULE(this.Command_read_flags),this.OPTION(()=>{this.OR([{ALT:()=>{this.SUBRULE(this.flat_cmd)}},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(Fn),this.CONSUME4(sp)}}])})}));P(this,"Command_break",this.RULED("Command_break",()=>{this.CONSUME(ip)}));P(this,"Command_continue",this.RULED("Command_continue",()=>{this.CONSUME(op)}));P(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Mc),this.SUBRULE2(this.and_test)})}));P(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Uc),this.SUBRULE2(this.not_test)})}));P(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(xc),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));P(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));P(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Pd)},{ALT:()=>this.CONSUME(Dd)},{ALT:()=>this.CONSUME($d)},{ALT:()=>this.CONSUME(Bd)},{ALT:()=>this.CONSUME(Fd)},{ALT:()=>this.CONSUME(jd)}])}));P(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Mc),this.SUBRULE2(this.and_test_value)})}));P(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Uc),this.SUBRULE2(this.not_test_value)})}));P(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(xc),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));P(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));P(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Pc)},{ALT:()=>this.CONSUME(Dc)}]),this.SUBRULE(this.term)}));P(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));P(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Kd)},{ALT:()=>this.CONSUME($c)},{ALT:()=>this.CONSUME(Wd)},{ALT:()=>this.CONSUME(Hd)}]),this.SUBRULE(this.factor)}));P(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Pc)},{ALT:()=>this.CONSUME(Dc)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));P(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Gd),this.SUBRULE(this.factor)})}));P(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));P(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(xd)},{ALT:()=>this.CONSUME(je)},{ALT:()=>this.CONSUME(Ud)},{ALT:()=>{this.CONSUME(zd),this.SUBRULE(this.expr),this.CONSUME(Yd)}}])}));this.performSelfAnalysis()}PEEK(n,r,...s){console.info(n,s.map(i=>[i.image,i.tokenType]),r)}RULED(n,r,s){const i=z0.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(tg++).toString().padStart(3),c=i?"font-weight: bold;":"";if(ng&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),ng&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),tg--},s)}}const Gs=new Y0,q0=Gs.getBaseCstVisitorConstructor();var ee=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.TEXT=1]="TEXT",t[t.LABEL=2]="LABEL",t[t.HYPERLINK=3]="HYPERLINK",t[t.STAT=4]="STAT",t[t.MOVE=5]="MOVE",t[t.COMMAND=6]="COMMAND",t[t.LITERAL=7]="LITERAL",t[t.IF=8]="IF",t[t.ELSE_IF=9]="ELSE_IF",t[t.ELSE=10]="ELSE",t[t.WHILE=11]="WHILE",t[t.BREAK=12]="BREAK",t[t.CONTINUE=13]="CONTINUE",t[t.REPEAT=14]="REPEAT",t[t.READ=15]="READ",t[t.OR=16]="OR",t[t.AND=17]="AND",t[t.NOT=18]="NOT",t[t.COMPARE=19]="COMPARE",t[t.OPERATOR=20]="OPERATOR",t[t.OPERATOR_ITEM=21]="OPERATOR_ITEM",t[t.EXPR=22]="EXPR",t))(ee||{}),dr=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(dr||{}),qt=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(qt||{}),So=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(So||{});function iL(t){return t}function J(t,e){return((e==null?void 0:e.map(n=>t.visit(n)).filter(n=>n))??[]).flat()}function En(t){return t.image}function rg(t,e){return D(t,{type:7,literal:1,value:e})}function X0(t){return!!(t!=null&&t.tokenType)}function J0(t){const e=Object.values(t).flat().filter(n=>!!n).map(n=>n&&X0(n)?{startLine:n.startLine,startColumn:n.startColumn,startOffset:n.startOffset,endLine:n.endLine,endColumn:n.endColumn,endOffset:n.endOffset}:n!=null&&n.location?{...n.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(n=>n.startLine!==0&&n.endLine!==0);return{startLine:Math.min(...e.map(n=>n.startLine??1)),startColumn:Math.min(...e.map(n=>n.startColumn??1)),startOffset:Math.min(...e.map(n=>n.startOffset??1)),endLine:Math.max(...e.map(n=>n.endLine??1)),endColumn:Math.max(...e.map(n=>n.endColumn??1)),endOffset:Math.max(...e.map(n=>n.endOffset??1))}}function D(t,e){return{...e,...J0(t)}}class Q0 extends q0{constructor(){super(),Vt&&this.validateVisitor()}program(e){return D(e,{type:0,lines:J(this,e.line)})}line(e){if(e.stmt)return this.visit(e.stmt)}stmt(e){if(e.label)return this.visit(e.label);if(e.stat)return this.visit(e.stat);if(e.text)return this.visit(e.text);if(e.comment)return this.visit(e.comment);if(e.command)return this.visit(e.command);if(e.hyperlink)return this.visit(e.hyperlink);if(e.Short_go)return this.visit(e.Short_go);if(e.Short_try)return this.visit(e.Short_try)}do_stmt(e){if(e.stat)return this.visit(e.stat);if(e.text)return this.visit(e.text);if(e.comment)return this.visit(e.comment);if(e.command)return this.visit(e.command);if(e.hyperlink)return this.visit(e.hyperlink);if(e.Short_go)return this.visit(e.Short_go);if(e.Short_try)return this.visit(e.Short_try)}label(e){var n;return D(e,{type:2,active:!0,name:En(((n=e.Label)==null?void 0:n[0])??":").slice(1).trim()})}stat(e){var n;return D(e,{type:4,value:(n=e.Stat)==null?void 0:n[0].image.slice(1)})}text(e){if(e.Text)return D(e,{type:1,value:En(e.Text[0])})}comment(e){return D(e,{type:2,active:!1,name:En(e.Comment[0]).slice(1).trim()})}hyperlink(e){var n;return D(e,{type:3,link:J(this,e.words).flat(),text:En(((n=e.HyperLinkText)==null?void 0:n[0])??";").slice(1)})}command(e){if(e.words)return D(e,{type:6,words:J(this,e.words).flat()});if(e.Command_play)return this.visit(e.Command_play);if(e.structured_cmd)return this.visit(e.structured_cmd)}flat_cmd(e){if(e.words)return D(e,{type:6,words:J(this,e.words).flat()});if(e.Command_play)return this.visit(e.Command_play);if(e.Short_go)return this.visit(e.Short_go);if(e.Short_try)return this.visit(e.Short_try)}structured_cmd(e){if(e.Command_if)return this.visit(e.Command_if);if(e.Command_read)return this.visit(e.Command_read);if(e.Command_while)return this.visit(e.Command_while);if(e.Command_repeat)return this.visit(e.Command_repeat);if(e.Command_break)return this.visit(e.Command_break);if(e.Command_continue)return this.visit(e.Command_continue)}Short_go(e){if(e.Divide)return D(e,{type:5,wait:!0,words:J(this,e.words).flat()})}Short_try(e){if(e.Query)return D(e,{type:5,wait:!1,words:J(this,e.words).flat()})}Command_play(e){if(e.play)return D(e,{type:6,words:[rg(e,"play"),rg(e,En(e.play[0]).replace("play","").trim())]})}do_line(e){return this.visit(e.do_stmt)}Command_if(e){const n=J(this,e.words).flat(),r=[this.visit(e.flat_cmd),...J(this,e.do_line)].flat(),s=[this.visit(e.Command_else_if),this.visit(e.Command_else)].flat();return D(e,{type:8,method:"if",words:n.filter(g),lines:r.filter(g),branches:s.filter(g)})}Command_else_if(e){const n=J(this,e.words).flat(),r=[this.visit(e.flat_cmd),...J(this,e.do_line)].flat(),s=J(this,e.Command_else_if).flat();return[D(e,{type:9,method:"if",words:n.filter(g),lines:r.filter(g)}),...s.filter(g),this.visit(e.Command_else)]}Command_else(e){const n=J(this,e.words).flat(),r=[this.visit(e.flat_cmd),...J(this,e.do_line)].flat();return D(e,{type:10,method:"if",words:n.filter(g),lines:r.filter(g)})}Command_endif(){}Command_while(e){const n=J(this,e.words).flat(),r=[this.visit(e.flat_cmd),...J(this,e.do_line)].flat();return D(e,{type:11,words:n.filter(g),lines:r.filter(g)})}Command_repeat(e){const n=J(this,e.words).flat(),r=[this.visit(e.flat_cmd),...J(this,e.do_line)].flat();return D(e,{type:14,words:n.filter(g),lines:r.filter(g)})}Command_read_flags(e){return J(this,e.StringLiteral).flat()}Command_read(e){const n=J(this,e.words).flat(),r=this.visit(e.Command_read_flags).flat(),s=[this.visit(e.flat_cmd),...J(this,e.do_line)].flat();return D(e,{type:15,words:n.filter(g),flags:r.filter(g),lines:s.filter(g)})}Command_break(e){return D(e,{type:12})}Command_continue(e){return D(e,{type:13})}expr(e){return e.and_test.length===1?this.visit(e.and_test):D(e,{type:16,items:J(this,e.and_test)})}and_test(e){return e.not_test.length===1?this.visit(e.not_test):D(e,{type:17,items:J(this,e.not_test)})}not_test(e){if(e.comparison)return this.visit(e.comparison);if(e.not_test)return D(e,{type:18,items:J(this,e.not_test)})}comparison(e){return e.arith_expr.length===1?this.visit(e.arith_expr):D(e,{type:19,lhs:this.visit(e.arith_expr[0]),compare:this.visit(e.comp_op),rhs:this.visit(e.arith_expr[1])})}comp_op(e){if(e.is||e.IsEq)return 0;if(e.IsNotEq)return 1;if(e.IsLessThan)return 2;if(e.IsGreaterThan)return 3;if(e.IsLessThanOrEqual)return 4;if(e.IsGreaterThanOrEqual)return 5}expr_value(e){return e.and_test_value.length===1?this.visit(e.and_test_value):D(e,{type:16,items:this.visit(e.and_test_value)})}and_test_value(e){return e.not_test_value.length===1?this.visit(e.not_test_value):D(e,{type:17,items:this.visit(e.not_test_value)})}not_test_value(e){if(e.arith_expr)return this.visit(e.arith_expr);if(e.not_test)return D(e,{type:18,items:this.visit(e.not_test)})}arith_expr(e){const n=this.visit(e.term);return e.arith_expr_item?D(e,{type:20,lhs:n,items:J(this,e.arith_expr_item)}):n}arith_expr_item(e){return D(e,{type:21,operator:e.Plus?1:2,rhs:this.visit(e.term)})}term(e){return e.term_item?D(e,{type:20,lhs:this.visit(e.factor),items:J(this,e.term_item)}):this.visit(e.factor)}term_item(e){let n=0;return e.Multiply&&(n=4),e.Divide&&(n=5),e.ModDivide&&(n=6),e.FloorDivide&&(n=7),D(e,{type:21,operator:n,rhs:this.visit(e.factor)})}factor(e){if(e.power)return this.visit(e.power);let n=0;return e.Plus&&(n=8),e.Minus&&(n=9),D(e,{type:20,lhs:void 0,items:[D(e,{type:21,operator:n,rhs:this.visit(e.factor)})]})}power(e){const n=this.visit(e.token);return e.factor?D(e,{type:20,lhs:n,items:[D(e,{type:21,operator:3,rhs:this.visit(e.factor)})]}):n}words(e){return J(this,e.expr)}token(e){if(e.StringLiteralDouble){const n=En(e.StringLiteralDouble[0]);return D(e,{type:7,literal:2,value:n.substring(1,n.length-1)})}if(e.StringLiteral)return D(e,{type:7,literal:1,value:En(e.StringLiteral[0])});if(e.NumberLiteral)return D(e,{type:7,literal:0,value:parseFloat(En(e.NumberLiteral[0]))});if(e.read)return D(e,{type:7,literal:1,value:En(e.read[0])});if(e.LParen)return D(e,{type:22,words:J(this,e.expr).flat()})}}const Z0=new Q0,Xe={internal:0,labels:{},labelIndex:0},To=`
         `,sg="if (api.hm()) { continue zss; }",eO="if (api.sy()) { yield 1; }",tO=`yield 1; ${sg}`;let ig=!1;const il={};function ol(t){if(!ig)return"";il[t]=il[t]??0;const e=il[t]++;return`${To}console.info('${t}-${e}')`}function Ao(){return`${tO};${ol("wait")}`}function al(){return`${eO}; ${sg}${ol("eol")};`}function nO(t){ig=t===uR}const vo="zss.js";function he(t,e){return new b0(t.startLine??1,t.startColumn??1,vo,e)}function cl(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function og(t){return`'${cl(t)}'`}function ko(t){if(t.startsWith('"'))return ko(t.substring(1,t.length-1));const e=H0(t);return e.errors.length?t:`'${e.tokens.map(r=>r.tokenType===sl?`', api.group('${cl(r.image.substring(1))}'), '`:cl(r.image)).join("")}'`}function wn(t){return t.filter(e=>e!==void 0).map(Y)}function ag(t){return he(t,"")}function rO(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function ie(t,e,n){return he(t,[`api.${e}(`,...rO(n,", "),")"])}function sO(t){if(t.type===ee.COMPARE)switch(t.compare){case dr.IS_EQ:return ie(t,"isEq",[Y(t.lhs),Y(t.rhs)]);case dr.IS_NOT_EQ:return ie(t,"isNotEq",[Y(t.lhs),Y(t.rhs)]);case dr.IS_LESS_THAN:return ie(t,"isLessThan",[Y(t.lhs),Y(t.rhs)]);case dr.IS_GREATER_THAN:return ie(t,"isGreaterThan",[Y(t.lhs),Y(t.rhs)]);case dr.IS_LESS_THAN_OR_EQ:return ie(t,"isLessThanOrEq",[Y(t.lhs),Y(t.rhs)]);case dr.IS_GREATER_THAN_OR_EQ:return ie(t,"isGreaterThanOrEq",[Y(t.lhs),Y(t.rhs)])}return he(t,"")}function pr(t,e,n,r){return e.prepend(`api.${n}(`),e.add([", ",Y(r),")"])}function cg(t,e,n,r){return e.prepend(`api.${n}(`),e.add([Y(r),")"])}function iO(t,e){if(t.type===ee.OPERATOR_ITEM)switch(t.operator){case qt.PLUS:return pr(t,e,"opPlus",t.rhs);case qt.MINUS:return pr(t,e,"opMinus",t.rhs);case qt.POWER:return pr(t,e,"opPower",t.rhs);case qt.MULTIPLY:return pr(t,e,"opMultiply",t.rhs);case qt.DIVIDE:return pr(t,e,"opDivide",t.rhs);case qt.MOD_DIVIDE:return pr(t,e,"opModDivide",t.rhs);case qt.FLOOR_DIVIDE:return pr(t,e,"opFloorDivide",t.rhs);case qt.UNI_PLUS:return cg(t,e,"opUniPlus",t.rhs);case qt.UNI_MINUS:return cg(t,e,"opUniMinus",t.rhs)}return he(t,"")}function oO(t){if(t.type===ee.OPERATOR){const e=t.lhs?Y(t.lhs):he(t,"");return t.items.forEach(n=>iO(n,e)),e}return he(t,"")}function Y(t){switch(t.type){case ee.PROGRAM:return he(t,[`try { // first-line
`,`zss: while (true) {
`,`switch (api.getcase()) {
`,`default:
`,`case 1: 
`,...t.lines.map(e=>[Y(e),`
`]).flat(),`}
`,`api.endofprogram();
`,`while(true) { ${Ao()} }
`,`}
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${vo}`]);case ee.LITERAL:switch(t.literal){case So.NUMBER:return he(t,`${t.value}`);case So.STRING:return he(t,og(t.value));case So.TEMPLATE:return he(t,ko(t.value))}return ag(t);case ee.TEXT:return ie(t,"text",[ko(t.value)]);case ee.STAT:return ie(t,"stat",[og(t.value)]);case ee.LABEL:{const e=Xe.labelIndex++;return Xe.labels[t.name]||(Xe.labels[t.name]=[]),Xe.labels[t.name].push(t.active?e:-e),he(t,`case ${e}: // ${t.name}`)}case ee.HYPERLINK:return ie(t,"hyperlink",[ko(t.text),...wn(t.link)]);case ee.MOVE:return he(t,["while (",ie(t,"move",[t.wait?"true":"false",...wn(t.words)]),`) { ${Ao()} };${To}${al()}`]);case ee.COMMAND:return he(t,["while (",ie(t,"command",wn(t.words)),`) { ${Ao()} };${To}${al()}`]);case ee.IF:{const e=he(t,["if (",ie(t,`${t.method}`,wn(t.words)),`) { ${ol("if")} 
`]);return t.lines&&t.lines.forEach(n=>e.add([Y(n),`
`])),t.branches&&t.branches.forEach(n=>e.add(Y(n))),e.add("}"),e}case ee.ELSE_IF:{const e=he(t,["} else if (",ie(t,t.method,wn(t.words)),`) {
`]);return t.lines&&t.lines.forEach(n=>e.add([Y(n),`
`])),e}case ee.ELSE:{const e=he(t,`} else {
`);return t.words.length&&e.add(["while (",ie(t,"command",wn(t.words)),`) { ${Ao()} };`]),t.lines&&t.lines.forEach(n=>e.add([Y(n),`
`])),e}case ee.WHILE:{const e=he(t,["while (",ie(t,"if",wn(t.words)),`) {
`]);return t.lines&&t.lines.forEach(n=>e.add([Y(n),`
`])),e.add("}"),e}case ee.REPEAT:{const e=he(t,[ie(t,"repeatstart",[`${Xe.internal}`,...wn(t.words)]),`;
while (`,ie(t,"repeat",[`${Xe.internal}`]),`) {${To}${al()}
`]);return Xe.internal+=1,t.lines&&t.lines.forEach(n=>e.add([Y(n),`
`])),e.add("}"),e}case ee.READ:{const[e,...n]=t.words,r=he(t,[ie(t,"readStart",[`${Xe.internal}`,Y(e)]),`;
while (`,ie(t,"read",[`${Xe.internal}`,...wn(n)]),`) {
`]);return Xe.internal+=1,t.lines&&t.lines.forEach(s=>r.add([Y(s),`
`])),r.add("}"),r}case ee.BREAK:return he(t,`break;
`);case ee.CONTINUE:return he(t,`continue;
`);case ee.OR:return ie(t,"or",t.items.map(Y));case ee.AND:return ie(t,"and",t.items.map(Y));case ee.NOT:return ie(t,"not",t.items.map(Y));case ee.COMPARE:return sO(t);case ee.OPERATOR:return oO(t);case ee.EXPR:return ie(t,"expr",t.words.map(Y));default:return console.error("<unsupported node>",t),ag(t)}}function aO(t){return Xe.internal=0,Xe.labels={restart:[1]},Xe.labelIndex=2,{...Y(t).toStringWithSourceMap({file:`${vo}.map`}),...Xe}}const cO=64;function lO(t){return ge(t)?t.length>0?1:0:t??0}function Je(t){return`${t??""}`}function uO(t,e){var A,O;const n=Uu(e.labels??{});let r,s="",i,o=0;const a={},c={},l={};let u=!1,h=0,d=0,f=(((A=e.errors)==null?void 0:A.length)??0)!==0;const p=[];let _={};function S(w){if(_[w]===void 0)for(let m=0;m<p.length;++m){const y=p[m].getcommand(w);y&&(_[w]=y)}return _[w]}function T(w,m){const y=S(w);if(!y)throw new Error(`unknown firmware command ${w}`);y(E,m)}const E={id(){return t},senderid(w=E.id()){return`vm:${w??E.id()}`},install(w){g(w)&&(_={},p.push(w))},set(w,m){const y=w.toLowerCase();for(let b=0;b<p.length;++b){const[v]=p[b].set(E,y,m);if(v)return m}return m},get(w){const m=w.toLowerCase();for(let y=0;y<p.length;++y){const[b,v]=p[y].get(E,m);if(b)return v}},timestamp(){return d},tick(w,m){d=m;const y=h%w===0;for(let b=0;b<p.length;++b)p[b].shouldtick(E,y);if(!E.shouldtick()||(++h,!y))return!1;o=0,u=!1;for(let b=0;b<p.length;++b)p[b].tick(E);try{const b=r==null?void 0:r.next();b!=null&&b.done&&(console.error("we crashed?",e.source),f=!0)}catch(b){console.error("we crashed?",b),f=!0}for(let b=0;b<p.length;++b)p[b].tock(E);return!0},shouldtick(){return f===!1||E.hm()!==0},shouldhalt(){return o++>cO},hm(){var m;const w=(i==null?void 0:i.target)??"";return g(i==null?void 0:i.target)?((m=n[w])==null?void 0:m.find(y=>y>0))??0:0},yield(){u=!0},sy(){return u||E.shouldhalt()},emit(w,m,y){X.emit(w,E.senderid(),m,y)},send(w,m,y,b){X.emit(`${E.senderid(w)}:${m}`,t,y,b)},lock(w){s=w},unlock(){s=""},message(w){s&&w.sender!==s||(i=w)},zap(w){const m=n[w];if(m){const y=m.findIndex(b=>b>0);y>=0&&(m[y]*=-1)}},restore(w){const m=n[w];if(m)for(let y=0;y<m.length;y++)m[y]=Math.abs(m[y])},getcase(){const w=E.hm();return w&&g(i)&&(E.set("sender",i.sender),E.set("data",i.data),i.player&&E.set("player",i.player),i=void 0,u=!1,f=!1),w},endofprogram(){E.yield(),f=!0},stacktrace(w){const m=QR.parse(w),[y]=m.filter(b=>b.fileName===vo);return{line:(y==null?void 0:y.lineNumber)??0,column:(y==null?void 0:y.columnNumber)??0}},text(w){return T("text",[w])},stat(...w){return T("stat",w)},hyperlink(...w){return T("hyperlink",w)},move(w,...m){const y=E.command("go",...m)&&w;return E.yield(),y?1:0},command(...w){if(w.length===0)return 0;const[m,...y]=w,b=S(Je(m));return g(b)?b(E,y):(T("send",[m,...y]),0)},if(...w){const[m,y]=R(I(E,w),0,[k.ANY]),b=lO(m);return b&&y<w.length&&E.command(...w.slice(y)),b?1:0},repeatstart(w,...m){const[y,b]=R(I(E,m),0,[k.NUMBER]);a[w]=y,c[w]=b<m.length?m.slice(b):void 0},repeat(w){const m=a[w]??0;a[w]=m-1;const y=m>0,b=c[w];return y&&b&&E.command(...b),y?1:0},readstart(w,m){if(!z(m))return;const y=E.get(m)??[];l[w]=ge(y)?y:[y]},read(w,...m){const y=l[w];if(ge(y)===!1)return 0;const b=y.shift();if(b===void 0)return 0;const v=m.map(Je);switch(typeof b){case"number":case"string":v.forEach(W=>{E.set(W,b)});break;case"object":Array.isArray(b)||v.forEach(W=>{const fe=b[W];E.set(W,fe)});break}return 1},or(...w){let m=0;for(let y=0;y<w.length;){const[b,v]=R(I(E,w),y,[k.ANY]);if(m=b,m)break;y=v}return m},and(...w){let m=0;for(let y=0;y<w.length;){const[b,v]=R(I(E,w),y,[k.ANY]);if(m=b,!m)break;y=v}return m},not(...w){const[m]=R(I(E,w),0,[k.ANY]);return m?0:1},expr(...w){const[m]=R(I(E,w),0,[k.ANY]);return m},isEq(w,m){const[y]=R(I(E,[w]),0,[k.ANY]),[b]=R(I(E,[m]),0,[k.ANY]);return I_(y,b)?1:0},isNotEq(w,m){const[y]=R(I(E,[w]),0,[k.ANY]),[b]=R(I(E,[m]),0,[k.ANY]);return y!==b?1:0},isLessThan(w,m){const[y]=R(I(E,[w]),0,[k.NUMBER]),[b]=R(I(E,[m]),0,[k.NUMBER]);return y<b?1:0},isGreaterThan(w,m){const[y]=R(I(E,[w]),0,[k.NUMBER]),[b]=R(I(E,[m]),0,[k.NUMBER]);return y>b?1:0},isLessThanOrEq(w,m){const[y]=R(I(E,[w]),0,[k.NUMBER]),[b]=R(I(E,[m]),0,[k.NUMBER]);return y<=b?1:0},isGreaterThanOrEq(w,m){const[y]=R(I(E,[w]),0,[k.NUMBER]),[b]=R(I(E,[m]),0,[k.NUMBER]);return y>=b?1:0},opPlus(w,m){const[y]=R(I(E,[w]),0,[k.ANY]),[b]=R(I(E,[m]),0,[k.ANY]);return y+b},opMinus(w,m){const[y]=R(I(E,[w]),0,[k.ANY]),[b]=R(I(E,[m]),0,[k.ANY]);return y-b},opPower(w,m){const[y]=R(I(E,[w]),0,[k.NUMBER]),[b]=R(I(E,[m]),0,[k.NUMBER]);return Math.pow(y,b)},opMultiply(w,m){const[y]=R(I(E,[w]),0,[k.NUMBER]),[b]=R(I(E,[m]),0,[k.NUMBER]);return y*b},opDivide(w,m){const[y]=R(I(E,[w]),0,[k.NUMBER]),[b]=R(I(E,[m]),0,[k.NUMBER]);return y/b},opModDivide(w,m){const[y]=R(I(E,[w]),0,[k.NUMBER]),[b]=R(I(E,[m]),0,[k.NUMBER]);return y%b},opFloorDivide(w,m){const[y]=R(I(E,[w]),0,[k.NUMBER]),[b]=R(I(E,[m]),0,[k.NUMBER]);return Math.floor(y/b)},opUniPlus(w){const[m]=R(I(E,[w]),0,[k.NUMBER]);return+m},opUniMinus(w){const[m]=R(I(E,[w]),0,[k.NUMBER]);return-m}};return r=(O=e.code)==null?void 0:O.call(e,E),E}function Xt(t){const e={},n={...t,getcommand(r){return e[r]},command(r,s){return e[r]=s,n}};return n}function hO(t){const e=zu[t];if(g(e))return e;const n=Ju[t];if(g(n))return n;const r=Pa[t];if(g(r))return r;const s=lh[t];if(g(s))return s}const fO=Xt({get(t,e){const n=hO(e);return g(n)?[!0,n]:[!1,void 0]},set(){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("clear",(t,e)=>{const n=Je(e[0]);return t.set(n,void 0),0}).command("set",(t,e)=>{const[n,r]=R(I(t,e),0,[k.STRING,k.ANY]);return t.set(n,r),0}).command("take",(t,e)=>{const[n,r,s]=R(I(t,e),0,[k.STRING,k.MAYBE_NUMBER]),i=t.get(n),o=r??1;if(!pe(i))return 1;const a=i-o;return a<0?(s<e.length&&t.command(...e.slice(s)),1):(t.set(n,a),0)}).command("give",(t,e)=>{const[n,r,s]=R(I(t,e),0,[k.STRING,k.MAYBE_NUMBER]),i=t.get(n),o=pe(i)?i:0,a=r??1;if(!pe(a))return 0;const c=i===void 0?1:0;return c&&s<e.length&&t.command(...e.slice(s)),t.set(n,o+a),c}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(Je(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(Je(e[0])),0)),dO=Xt({get(){return[!1,void 0]},set(){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("play",(t,e)=>{const n=I(t,e),[r]=R(n,0,[k.STRING]),s=t.get(r);return z(s)?t.emit("pcspeaker:play",[-1,s]):t.emit("pcspeaker:play",[-1,r]),0}),pO=Xt({get(t,e){return[!1,void 0]},set(t,e,n){return[!1,void 0]},shouldtick(t,e){},tick(t){},tock(t){}}).command("board_stub",(t,e)=>0),gO=Xt({get(t,e){return[!1,void 0]},set(t,e,n){return[!1,void 0]},shouldtick(t,e){},tick(t){},tock(t){}}).command("charset_stub",(t,e)=>0);function Ks(){return Ks=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ks.apply(this,arguments)}function mO(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,ll(t,e)}function ll(t,e){return ll=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},ll(t,e)}function yO(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var lg=function(){function t(n){this.trigger=n,this.observing=new Map}var e=t.prototype;return e.registerConnection=function(r){var s=this.observing.get(r.observable);s||(s={byKey:new Set,iterate:!1},this.observing.set(r.observable,s)),r.type==="iterate"?s.iterate=!0:s.byKey.add(r.key)},e.removeObservers=function(){var r=this;this.observing.forEach(function(s,i){s.iterate&&i[Se].connections.iterate.delete(r),s.byKey.forEach(function(o){i[Se].connections.byKey.get(o).delete(r)})}),this.observing.clear()},t}(),gr=[],Ro=function(t){mO(e,t);function e(r,s,i){var o;if(o=t.call(this,function(){return o._trigger()})||this,o.func=r,o.options=s,o.effect=i,o.isInitial=!0,o.reaction=function(){gr.push(yO(o));try{o.func()}finally{gr.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!i&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=e.prototype;return n._trigger=function(){if(gr.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},e}(lg);function ug(){return!!gr.length}function hg(){return gr.length?gr[gr.length-1]:void 0}function _O(t,e,n){var r=Ks({name:"unnamed",fireImmediately:!0},n),s=new Ro(t,r,e);return s}var Oo=0;function fg(){return Oo>0}function ul(t){Oo++;try{return t()}finally{Oo--,Oo===0&&wO()}}var hl=!1;function dg(){return hl}function pg(t){hl=!0;try{t()}finally{hl=!1}}function EO(t){return function(){return pg(t)}}var fl=[];function wO(){var t=[].concat(fl);fl=[],gg(t)}function gg(t){var e=new Set;t.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[Se].connections.iterate.forEach(function(s){e.add(s)}),(r=n.observable[Se].connections.byKey.get(n.key))==null||r.forEach(function(s){e.add(s)})}),e.forEach(function(n){n.trigger()})}function Io(t){if(fg()){fl.push(t);return}gg([t])}function mg(t,e){if(t.type==="iterate")t.observable[Se].connections.iterate.add(e);else{var n=t.observable[Se].connections.byKey.get(t.key);n||(n=new Set,t.observable[Se].connections.byKey.set(t.key,n)),n.add(e)}}function No(t,e){if(!dg()){var n=hg();n&&(mg(t,n),n.registerConnection(t)),e&&(mg(t,e),e.registerConnection(t))}}var dl=Symbol("$skipreactive"),Se=Symbol("$reactive"),gt=Symbol("$reactiveproxy");function Ws(t,e){return!!(t&&t[gt]&&t[gt].implicitObserver===e)}function pl(t){return t[dl]=!0,t}function yg(t){return!!(t&&!Ws(t)&&t[Se])}function gl(t,e,n){if(n===void 0&&(n=!1),t[dl]||Ws(t,e))return t;var r=bO(t,n);if(!e)return r;var s=r[Se].proxiesWithImplicitObserver.get(e);if(!s){var i={implicitObserver:e};Object.setPrototypeOf(i,_g),s=new Proxy(r[Se].raw,i),r[Se].proxiesWithImplicitObserver.set(e,s)}return s}var Hs=gl;function bO(t,e){if(e===void 0&&(e=!1),Ws(t))return t;if(yg(t))return t[Se].proxy;if(t[Se]||t[gt])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:t,proxiesWithImplicitObserver:new Map,shallow:e};Object.defineProperty(t,Se,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(t,_g);return n.proxy=r,r}var _g={has:function(e,n){var r=Reflect.has(e,n);return typeof n=="symbol"||No({observable:e,key:n,type:"has"},this.implicitObserver),r},get:function(e,n,r){if(n===gt)return{implicitObserver:this.implicitObserver};var s=Reflect.get(e,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),s;if(n==="length"&&Array.isArray(e)?No({observable:e,type:"iterate"},this.implicitObserver):No({observable:e,key:n,type:"get"},this.implicitObserver),yg(s))return gl(s,this.implicitObserver);if(e[Se].shallow)return s;if(typeof s=="object"&&s!==null&&!Ws(s,this.implicitObserver)&&!Object.isFrozen(s)){var i=Reflect.getOwnPropertyDescriptor(e,n);if((!i||!(i.writable===!1&&i.configurable===!1))&&(ug()||this.implicitObserver))return gl(s,this.implicitObserver)}return s},ownKeys:function(e){return No({observable:e,type:"iterate"},this.implicitObserver),Reflect.ownKeys(e)},set:function(e,n,r,s){return ul(function(){if(typeof n=="symbol")return Reflect.set(e,n,r,s);var i=Object.hasOwnProperty.call(e,n),o=Reflect.get(e,n,s),a=Reflect.set(e,n,r,s);if(!i)Io({observable:e,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(e)){if(!(o<r))for(var c=r+1;c<=o;c++)Io({observable:e,key:""+(c-1),oldValue:void 0,type:"delete"})}else Io({observable:e,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(e,n){return ul(function(){if(typeof n=="symbol")return Reflect.deleteProperty(e,n);var r=Object.hasOwnProperty.call(e,n),s=Reflect.get(e,n),i=Reflect.deleteProperty(e,n);return r&&Io({observable:e,key:n,oldValue:s,type:"delete"}),i})},preventExtensions:function(e){throw new Error("Dynamic observable objects cannot be frozen")}};function SO(t,e){var n=Ks({name:"unnamed",fireImmediately:!0},e),r=new Ro(t,n);return r}function TO(t,e,n){var r=Ks({name:"unnamed",fireImmediately:!0},n),s=new Ro(function(){t(e)},r);return e=Hs(e,s),r.fireImmediately&&s.trigger(),s}var Eg=function(){function t(){this._observable=Hs({_key:1})}var e=t.prototype;return e.reportObserved=function(r){return Hs(this._observable,r)._key},e.reportChanged=function(){this._observable._key++},t}();function AO(t,e,n){return new Eg}var vO=Object.freeze({__proto__:null,$reactive:Se,$reactiveproxy:gt,$skipreactive:dl,Atom:Eg,Observer:lg,Reaction:Ro,autorun:SO,autorunAsync:TO,createAtom:AO,hasRunningReaction:ug,isActionRunning:fg,isReactive:Ws,isTrackingDisabled:dg,markRaw:pl,reaction:_O,reactive:Hs,runInAction:ul,runningReaction:hg,untracked:pg,untrackedCB:EO});const Nt=()=>new Map,ml=t=>{const e=Nt();return t.forEach((n,r)=>{e.set(r,n)}),e},Gn=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},kO=(t,e)=>{const n=[];for(const[r,s]of t)n.push(e(s,r));return n},RO=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},Vr=()=>new Set,yl=t=>t[t.length-1],OO=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Kn=Array.from,IO=Array.isArray;class NO{constructor(){this._observers=Nt()}on(e,n){return Gn(this._observers,e,Vr).add(n),n}once(e,n){const r=(...s)=>{this.off(e,r),n(...s)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Kn((this._observers.get(e)||Nt()).values()).forEach(r=>r(...n))}destroy(){this._observers=Nt()}}const Wn=Math.floor,Co=Math.abs,wg=(t,e)=>t<e?t:e,mr=(t,e)=>t>e?t:e,bg=t=>t!==0?t<0:1/t<0,Sg=1,Tg=2,_l=4,El=8,Vs=32,bn=64,nt=128,Lo=31,wl=63,yr=127,CO=2147483647,Ag=Number.MAX_SAFE_INTEGER,LO=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Wn(t)===t),MO=t=>t.toLowerCase(),xO=/^\s*/g,UO=t=>t.replace(xO,""),PO=/([A-Z])/g,vg=(t,e)=>UO(t.replace(PO,n=>`${e}${MO(n)}`)),DO=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.codePointAt(s);return r},zs=typeof TextEncoder<"u"?new TextEncoder:null,$O=zs?t=>zs.encode(t):DO;let Ys=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ys&&Ys.decode(new Uint8Array).length===1&&(Ys=null);class qs{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Hn=()=>new qs,BO=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Ct=t=>{const e=new Uint8Array(BO(t));let n=0;for(let r=0;r<t.bufs.length;r++){const s=t.bufs[r];e.set(s,n),n+=s.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},FO=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(mr(n,e)*2),t.cpos=0)},ke=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},bl=ke,$=(t,e)=>{for(;e>yr;)ke(t,nt|yr&e),e=Wn(e/128);ke(t,yr&e)},Sl=(t,e)=>{const n=bg(e);for(n&&(e=-e),ke(t,(e>wl?nt:0)|(n?bn:0)|wl&e),e=Wn(e/64);e>0;)ke(t,(e>yr?nt:0)|yr&e),e=Wn(e/128)},Tl=new Uint8Array(3e4),jO=Tl.length/3,GO=(t,e)=>{if(e.length<jO){const n=zs.encodeInto(e,Tl).written||0;$(t,n);for(let r=0;r<n;r++)ke(t,Tl[r])}else Ue(t,$O(e))},KO=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;$(t,r);for(let s=0;s<r;s++)ke(t,n.codePointAt(s))},zr=zs&&zs.encodeInto?GO:KO,Mo=(t,e)=>{const n=t.cbuf.length,r=t.cpos,s=wg(n-r,e.length),i=e.length-s;t.cbuf.set(e.subarray(0,s),r),t.cpos+=s,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(mr(n*2,i)),t.cbuf.set(e.subarray(s)),t.cpos=i)},Ue=(t,e)=>{$(t,e.byteLength),Mo(t,e)},Al=(t,e)=>{FO(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},WO=(t,e)=>Al(t,4).setFloat32(0,e,!1),HO=(t,e)=>Al(t,8).setFloat64(0,e,!1),VO=(t,e)=>Al(t,8).setBigInt64(0,e,!1),kg=new DataView(new ArrayBuffer(4)),zO=t=>(kg.setFloat32(0,t),kg.getFloat32(0)===t),Xs=(t,e)=>{switch(typeof e){case"string":ke(t,119),zr(t,e);break;case"number":LO(e)&&Co(e)<=CO?(ke(t,125),Sl(t,e)):zO(e)?(ke(t,124),WO(t,e)):(ke(t,123),HO(t,e));break;case"bigint":ke(t,122),VO(t,e);break;case"object":if(e===null)ke(t,126);else if(IO(e)){ke(t,117),$(t,e.length);for(let n=0;n<e.length;n++)Xs(t,e[n])}else if(e instanceof Uint8Array)ke(t,116),Ue(t,e);else{ke(t,118);const n=Object.keys(e);$(t,n.length);for(let r=0;r<n.length;r++){const s=n[r];zr(t,s),Xs(t,e[s])}}break;case"boolean":ke(t,e?120:121);break;default:ke(t,127)}};class Rg extends qs{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&$(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Og=t=>{t.count>0&&(Sl(t.encoder,t.count===1?t.s:-t.s),t.count>1&&$(t.encoder,t.count-2))};class xo{constructor(){this.encoder=new qs,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Og(this),this.count=1,this.s=e)}toUint8Array(){return Og(this),Ct(this.encoder)}}const Ig=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Sl(t.encoder,e),t.count>1&&$(t.encoder,t.count-2)}};class vl{constructor(){this.encoder=new qs,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Ig(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Ig(this),Ct(this.encoder)}}class YO{constructor(){this.sarr=[],this.s="",this.lensE=new xo}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new qs;return this.sarr.push(this.s),this.s="",zr(e,this.sarr.join("")),Mo(e,this.lensE.toUint8Array()),Ct(e)}}const Vn=t=>new Error(t),Jt=()=>{throw Vn("Method unimplemented")},Qt=()=>{throw Vn("Unexpected case")},Ng=Vn("Unexpected end of array"),Cg=Vn("Integer out of Range");class Uo{constructor(e){this.arr=e,this.pos=0}}const _r=t=>new Uo(t),qO=t=>t.pos!==t.arr.length,XO=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Ke=t=>XO(t,B(t)),Yr=t=>t.arr[t.pos++],B=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const s=t.arr[t.pos++];if(e=e+(s&yr)*n,n*=128,s<nt)return e;if(e>Ag)throw Cg}throw Ng},kl=t=>{let e=t.arr[t.pos++],n=e&wl,r=64;const s=(e&bn)>0?-1:1;if(!(e&nt))return s*n;const i=t.arr.length;for(;t.pos<i;){if(e=t.arr[t.pos++],n=n+(e&yr)*r,r*=128,e<nt)return s*n;if(n>Ag)throw Cg}throw Ng},qr=Ys?t=>Ys.decode(Ke(t)):t=>{let e=B(t);if(e===0)return"";{let n=String.fromCodePoint(Yr(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Yr(t));else for(;e>0;){const r=e<1e4?e:1e4,s=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,s),e-=r}return decodeURIComponent(escape(n))}},Rl=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},JO=[t=>{},t=>null,kl,t=>Rl(t,4).getFloat32(0,!1),t=>Rl(t,8).getFloat64(0,!1),t=>Rl(t,8).getBigInt64(0,!1),t=>!1,t=>!0,qr,t=>{const e=B(t),n={};for(let r=0;r<e;r++){const s=qr(t);n[s]=Js(t)}return n},t=>{const e=B(t),n=[];for(let r=0;r<e;r++)n.push(Js(t));return n},Ke],Js=t=>JO[127-Yr(t)](t);class Lg extends Uo{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),qO(this)?this.count=B(this)+1:this.count=-1),this.count--,this.s}}class Po extends Uo{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=kl(this);const e=bg(this.s);this.count=1,e&&(this.s=-this.s,this.count=B(this)+2)}return this.count--,this.s}}class Ol extends Uo{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=kl(this),n=e&1;this.diff=Wn(e/2),this.count=1,n&&(this.count=B(this)+2)}return this.s+=this.diff,this.count--,this.s}}class QO{constructor(e){this.decoder=new Po(e),this.str=qr(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const ZO=crypto.getRandomValues.bind(crypto),Mg=()=>ZO(new Uint32Array(1))[0],eI="10000000-1000-4000-8000"+-1e11,tI=()=>eI.replace(/[018]/g,t=>(t^Mg()&15>>t/4).toString(16)),xg=t=>new Promise(t);Promise.all.bind(Promise);const Ug=t=>t===void 0?null:t;class nI{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Pg=new nI,rI=!0;try{typeof localStorage<"u"&&localStorage&&(Pg=localStorage,rI=!1)}catch{}const sI=Pg,iI=Object.assign,oI=Object.keys,aI=(t,e)=>{for(const n in t)e(t[n],n)},Dg=t=>oI(t).length,cI=t=>{for(const e in t)return!1;return!0},lI=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},uI=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),hI=(t,e)=>t===e||Dg(t)===Dg(e)&&lI(t,(n,r)=>(n!==void 0||uI(e,r))&&e[r]===n),Il=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Il(t,e,n+1)}},fI=t=>t,dI=(t,e)=>e.includes(t);var $g={};const Qs=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Zt;const pI=()=>{if(Zt===void 0)if(Qs){Zt=Nt();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Zt.set(e,""),e=r):e!==null&&(Zt.set(e,r),e=null)}e!==null&&Zt.set(e,"")}else typeof location=="object"?(Zt=Nt(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Zt.set(`--${vg(e,"-")}`,n),Zt.set(`-${vg(e,"-")}`,n)}})):Zt=Nt();return Zt},Nl=t=>pI().has(t),Cl=t=>Ug(Qs?$g[t.toUpperCase().replaceAll("-","_")]:sI.getItem(t));(t=>Nl("--"+t)||Cl(t)!==null)("production");const Bg=Qs&&dI($g.FORCE_COLOR,["true","1","2"]),gI=!Nl("--no-colors")&&(!Qs||process.stdout.isTTY||Bg)&&(!Qs||Nl("--color")||Bg||Cl("COLORTERM")!==null||(Cl("TERM")||"").includes("color")),mI=t=>new Uint8Array(t),yI=t=>{const e=mI(t.byteLength);return e.set(t),e};class _I{constructor(e,n){this.left=e,this.right=n}}const Sn=(t,e)=>new _I(t,e);typeof DOMParser<"u"&&new DOMParser;const EI=t=>kO(t,(e,n)=>`${n}:${e};`).join(""),Tn=Symbol,Fg=Tn(),jg=Tn(),wI=Tn(),bI=Tn(),SI=Tn(),Gg=Tn(),TI=Tn(),Kg=Tn(),AI=Tn(),vI=t=>{var r;t.length===1&&((r=t[0])==null?void 0:r.constructor)===Function&&(t=t[0]());const e=[];let n=0;for(;n<t.length;n++){const s=t[n];s===void 0||s.constructor===String||s.constructor===Number||s.constructor===Object&&e.push(JSON.stringify(s))}return e},kI={[Fg]:Sn("font-weight","bold"),[jg]:Sn("font-weight","normal"),[wI]:Sn("color","blue"),[SI]:Sn("color","green"),[bI]:Sn("color","grey"),[Gg]:Sn("color","red"),[TI]:Sn("color","purple"),[Kg]:Sn("color","orange"),[AI]:Sn("color","black")},RI=gI?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Nt();let s=[],i=0;for(;i<t.length;i++){const a=t[i],c=kI[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=EI(r);i>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(i>0&&(s=n,s.unshift(e.join("")));i<t.length;i++){const a=t[i];a instanceof Symbol||s.push(a)}return s}:vI,OI=(...t)=>{console.log(...RI(t)),II.forEach(e=>e.print(t))},II=Vr(),Wg=t=>({[Symbol.iterator](){return this},next:t}),NI=(t,e)=>Wg(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Ll=(t,e)=>Wg(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Ml{constructor(e,n){this.clock=e,this.len=n}}class Zs{constructor(){this.clients=new Map}}const Hg=(t,e,n)=>e.clients.forEach((r,s)=>{const i=t.doc.store.clients.get(s);for(let o=0;o<r.length;o++){const a=r[o];lm(t,i,a.clock,a.len,n)}}),CI=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const s=Wn((n+r)/2),i=t[s],o=i.clock;if(o<=e){if(e<o+i.len)return s;n=s+1}else r=s-1}return null},Vg=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&CI(n,e.clock)!==null},xl=t=>{t.clients.forEach(e=>{e.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<e.length;n++){const s=e[r-1],i=e[n];s.clock+s.len>=i.clock?s.len=mr(s.len,i.clock+i.len-s.clock):(r<n&&(e[r]=i),r++)}e.length=r})},LI=t=>{const e=new Zs;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,s)=>{if(!e.clients.has(s)){const i=r.slice();for(let o=n+1;o<t.length;o++)OO(i,t[o].clients.get(s)||[]);e.clients.set(s,i)}});return xl(e),e},Do=(t,e,n,r)=>{Gn(t.clients,e,()=>[]).push(new Ml(n,r))},MI=()=>new Zs,xI=t=>{const e=MI();return t.clients.forEach((n,r)=>{const s=[];for(let i=0;i<n.length;i++){const o=n[i];if(o.deleted){const a=o.id.clock;let c=o.length;if(i+1<n.length)for(let l=n[i+1];i+1<n.length&&l.deleted;l=n[++i+1])c+=l.length;s.push(new Ml(a,c))}}s.length>0&&e.clients.set(r,s)}),e},Xr=(t,e)=>{$(t.restEncoder,e.clients.size),Kn(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),$(t.restEncoder,n);const s=r.length;$(t.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},Ul=t=>{const e=new Zs,n=B(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const s=B(t.restDecoder),i=B(t.restDecoder);if(i>0){const o=Gn(e.clients,s,()=>[]);for(let a=0;a<i;a++)o.push(new Ml(t.readDsClock(),t.readDsLen()))}}return e},zg=(t,e,n)=>{const r=new Zs,s=B(t.restDecoder);for(let i=0;i<s;i++){t.resetDsCurVal();const o=B(t.restDecoder),a=B(t.restDecoder),c=n.clients.get(o)||[],l=Re(n,o);for(let u=0;u<a;u++){const h=t.readDsClock(),d=h+t.readDsLen();if(h<l){l<d&&Do(r,o,l,d-l);let f=Lt(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,Xo(e,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,Xo(e,p,d-p.id.clock)),p.delete(e))}else Do(r,o,h,d-h)}}if(r.clients.size>0){const i=new Er;return $(i.restEncoder,0),Xr(i,r),i.toUint8Array()}return null},Yg=Mg;class An extends NO{constructor({guid:e=tI(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Yg(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new om,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=xg(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>xg(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&te(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Kn(this.subdocs).map(e=>e.guid))}transact(e,n=null){return te(this,e,n)}get(e,n=le){const r=Gn(this.share,e,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==le&&s!==n)if(s===le){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,en)}getText(e=""){return this.get(e,Mt)}getMap(e=""){return this.get(e,tn)}getXmlElement(e=""){return this.get(e,vn)}getXmlFragment(e=""){return this.get(e,nn)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){Kn(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new An({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,te(e.parent.doc,r=>{const s=n.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class qg{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return B(this.restDecoder)}readDsLen(){return B(this.restDecoder)}}class Xg extends qg{readLeftID(){return j(B(this.restDecoder),B(this.restDecoder))}readRightID(){return j(B(this.restDecoder),B(this.restDecoder))}readClient(){return B(this.restDecoder)}readInfo(){return Yr(this.restDecoder)}readString(){return qr(this.restDecoder)}readParentInfo(){return B(this.restDecoder)===1}readTypeRef(){return B(this.restDecoder)}readLen(){return B(this.restDecoder)}readAny(){return Js(this.restDecoder)}readBuf(){return yI(Ke(this.restDecoder))}readJSON(){return JSON.parse(qr(this.restDecoder))}readKey(){return qr(this.restDecoder)}}class UI{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=B(this.restDecoder),this.dsCurrVal}readDsLen(){const e=B(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Jr extends UI{constructor(e){super(e),this.keys=[],B(e),this.keyClockDecoder=new Ol(Ke(e)),this.clientDecoder=new Po(Ke(e)),this.leftClockDecoder=new Ol(Ke(e)),this.rightClockDecoder=new Ol(Ke(e)),this.infoDecoder=new Lg(Ke(e),Yr),this.stringDecoder=new QO(Ke(e)),this.parentInfoDecoder=new Lg(Ke(e),Yr),this.typeRefDecoder=new Po(Ke(e)),this.lenDecoder=new Po(Ke(e))}readLeftID(){return new Qr(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Qr(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Js(this.restDecoder)}readBuf(){return Ke(this.restDecoder)}readJSON(){return Js(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Jg{constructor(){this.restEncoder=Hn()}toUint8Array(){return Ct(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){$(this.restEncoder,e)}writeDsLen(e){$(this.restEncoder,e)}}class ei extends Jg{writeLeftID(e){$(this.restEncoder,e.client),$(this.restEncoder,e.clock)}writeRightID(e){$(this.restEncoder,e.client),$(this.restEncoder,e.clock)}writeClient(e){$(this.restEncoder,e)}writeInfo(e){bl(this.restEncoder,e)}writeString(e){zr(this.restEncoder,e)}writeParentInfo(e){$(this.restEncoder,e?1:0)}writeTypeRef(e){$(this.restEncoder,e)}writeLen(e){$(this.restEncoder,e)}writeAny(e){Xs(this.restEncoder,e)}writeBuf(e){Ue(this.restEncoder,e)}writeJSON(e){zr(this.restEncoder,JSON.stringify(e))}writeKey(e){zr(this.restEncoder,e)}}class Qg{constructor(){this.restEncoder=Hn(),this.dsCurrVal=0}toUint8Array(){return Ct(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,$(this.restEncoder,n)}writeDsLen(e){e===0&&Qt(),$(this.restEncoder,e-1),this.dsCurrVal+=e}}class Er extends Qg{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new vl,this.clientEncoder=new xo,this.leftClockEncoder=new vl,this.rightClockEncoder=new vl,this.infoEncoder=new Rg(bl),this.stringEncoder=new YO,this.parentInfoEncoder=new Rg(bl),this.typeRefEncoder=new xo,this.lenEncoder=new xo}toUint8Array(){const e=Hn();return $(e,0),Ue(e,this.keyClockEncoder.toUint8Array()),Ue(e,this.clientEncoder.toUint8Array()),Ue(e,this.leftClockEncoder.toUint8Array()),Ue(e,this.rightClockEncoder.toUint8Array()),Ue(e,Ct(this.infoEncoder)),Ue(e,this.stringEncoder.toUint8Array()),Ue(e,Ct(this.parentInfoEncoder)),Ue(e,this.typeRefEncoder.toUint8Array()),Ue(e,this.lenEncoder.toUint8Array()),Mo(e,Ct(this.restEncoder)),Ct(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Xs(this.restEncoder,e)}writeBuf(e){Ue(this.restEncoder,e)}writeJSON(e){Xs(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const PI=(t,e,n,r)=>{r=mr(r,e[0].id.clock);const s=Lt(e,r);$(t.restEncoder,e.length-s),t.writeClient(n),$(t.restEncoder,r);const i=e[s];i.write(t,r-i.id.clock);for(let o=s+1;o<e.length;o++)e[o].write(t,0)},Pl=(t,e,n)=>{const r=new Map;n.forEach((s,i)=>{Re(e,i)>s&&r.set(i,s)}),Bo(e).forEach((s,i)=>{n.has(i)||r.set(i,0)}),$(t.restEncoder,r.size),Kn(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{PI(t,e.clients.get(s),s,i)})},DI=(t,e)=>{const n=Nt(),r=B(t.restDecoder);for(let s=0;s<r;s++){const i=B(t.restDecoder),o=new Array(i),a=t.readClient();let c=B(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<i;l++){const u=t.readInfo();switch(Lo&u){case 0:{const h=t.readLen();o[l]=new rt(j(a,c),h),c+=h;break}case 10:{const h=B(t.restDecoder);o[l]=new mt(j(a,c),h),c+=h;break}default:{const h=(u&(bn|nt))===0,d=new Ae(j(a,c),null,(u&nt)===nt?t.readLeftID():null,null,(u&bn)===bn?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(u&Vs)===Vs?t.readString():null,xm(t,u));o[l]=d,c+=d.length}}}}return n},$I=(t,e,n)=>{const r=[];let s=Kn(n.keys()).sort((f,p)=>f-p);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f};let o=i();if(o===null)return null;const a=new om,c=new Map,l=(f,p)=>{const _=c.get(f);(_==null||_>p)&&c.set(f,p)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,_=n.get(p);_?(_.i--,a.clients.set(p,_.refs.slice(_.i)),n.delete(p),_.i=0,_.refs=[]):a.clients.set(p,[f]),s=s.filter(S=>S!==p)}r.length=0};for(;;){if(u.constructor!==mt){const p=Gn(h,u.id.client,()=>Re(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const _=u.getMissing(t,e);if(_!==null){r.push(u);const S=n.get(_)||{refs:[],i:0};if(S.refs.length===S.i)l(_,Re(e,_)),d();else{u=S.refs[S.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=i(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new Er;return Pl(f,a,new Map),$(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},BI=(t,e)=>Pl(t,e.doc.store,e.beforeState),FI=(t,e,n,r=new Jr(t))=>te(e,s=>{s.local=!1;let i=!1;const o=s.doc,a=o.store,c=DI(r,o),l=$I(s,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<Re(a,d)){i=!0;break}if(l){for(const[d,f]of l.missing){const p=u.missing.get(d);(p==null||p>f)&&u.missing.set(d,f)}u.update=jo([u.update,l.update])}}else a.pendingStructs=l;const h=zg(r,s,a);if(a.pendingDs){const d=new Jr(_r(a.pendingDs));B(d.restDecoder);const f=zg(d,s,a);h&&f?a.pendingDs=jo([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(i){const d=a.pendingStructs.update;a.pendingStructs=null,Zg(s.doc,d)}},n,!1),Zg=(t,e,n,r=Jr)=>{const s=_r(e);FI(s,t,n,new r(s))},jI=(t,e,n)=>Zg(t,e,n,Xg),GI=(t,e,n=new Map)=>{Pl(t,e.store,n),Xr(t,xI(e.store))},KI=(t,e=new Uint8Array([0]),n=new Er)=>{const r=em(e);GI(n,t,r);const s=[n.toUint8Array()];if(t.store.pendingDs&&s.push(t.store.pendingDs),t.store.pendingStructs&&s.push(sN(t.store.pendingStructs.update,e)),s.length>1){if(n.constructor===ei)return nN(s.map((i,o)=>o===0?i:oN(i)));if(n.constructor===Er)return jo(s)}return s[0]},WI=(t,e)=>KI(t,e,new ei),HI=t=>{const e=new Map,n=B(t.restDecoder);for(let r=0;r<n;r++){const s=B(t.restDecoder),i=B(t.restDecoder);e.set(s,i)}return e},em=t=>HI(new qg(_r(t))),tm=(t,e)=>($(t.restEncoder,e.size),Kn(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{$(t.restEncoder,n),$(t.restEncoder,r)}),t),VI=(t,e)=>tm(t,Bo(e.store)),zI=(t,e=new Qg)=>(t instanceof Map?tm(e,t):VI(e,t),e.toUint8Array()),YI=t=>zI(t,new Jg);class qI{constructor(){this.l=[]}}const nm=()=>new qI,rm=(t,e)=>t.l.push(e),sm=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(s=>e!==s),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},im=(t,e,n)=>Il(t.l,[e,n]);class Qr{constructor(e,n){this.client=e,this.clock=n}}const $o=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,j=(t,e)=>new Qr(t,e),XI=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Qt()},Zr=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Vg(e.ds,t.id),Dl=(t,e)=>{const n=Gn(t.meta,Dl,Vr),r=t.doc.store;n.has(e)||(e.sv.forEach((s,i)=>{s<Re(r,i)&&zn(t,j(i,s))}),Hg(t,e.ds,s=>{}),n.add(e))};class om{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Bo=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const s=n[n.length-1];e.set(r,s.id.clock+s.length)}),e},Re=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},am=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Qt()}n.push(e)},Lt=(t,e)=>{let n=0,r=t.length-1,s=t[r],i=s.id.clock;if(i===e)return r;let o=Wn(e/(i+s.length-1)*r);for(;n<=r;){if(s=t[o],i=s.id.clock,i<=e){if(e<i+s.length)return o;n=o+1}else r=o-1;o=Wn((n+r)/2)}throw Qt()},$l=(t,e)=>{const n=t.clients.get(e.client);return n[Lt(n,e.clock)]},Bl=(t,e,n)=>{const r=Lt(e,n),s=e[r];return s.id.clock<n&&s instanceof Ae?(e.splice(r+1,0,Xo(t,s,n-s.id.clock)),r+1):r},zn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Bl(t,n,e.clock)]},cm=(t,e,n)=>{const r=e.clients.get(n.client),s=Lt(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==rt&&r.splice(s+1,0,Xo(t,i,n.clock-i.id.clock+1)),i},JI=(t,e,n)=>{const r=t.clients.get(e.id.client);r[Lt(r,e.id.clock)]=n},lm=(t,e,n,r,s)=>{if(r===0)return;const i=n+r;let o=Bl(t,e,n),a;do a=e[o++],i<a.id.clock+a.length&&Bl(t,e,i),s(a);while(o<e.length&&e[o].id.clock<i)};class QI{constructor(e,n,r){this.doc=e,this.deleteSet=new Zs,this.beforeState=Bo(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const um=(t,e)=>e.deleteSet.clients.size===0&&!RO(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(xl(e.deleteSet),BI(t,e),Xr(t,e.deleteSet),!0),hm=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Gn(t.changed,e,Vr).add(n)},Fo=(t,e)=>{let n=t[e],r=t[e-1],s=e;for(;s>0;n=r,r=t[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ae&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=e-s;return i&&t.splice(e+1-i,i),i},ZI=(t,e,n)=>{for(const[r,s]of t.clients.entries()){const i=e.clients.get(r);for(let o=s.length-1;o>=0;o--){const a=s[o],c=a.clock+a.len;for(let l=Lt(i,a.clock),u=i[l];l<i.length&&u.id.clock<c;u=i[++l]){const h=i[l];if(a.clock+a.len<=h.id.clock)break;h instanceof Ae&&h.deleted&&!h.keep&&n(h)&&h.gc(e,!1)}}}},eN=(t,e)=>{t.clients.forEach((n,r)=>{const s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],a=wg(s.length-1,1+Lt(s,o.clock+o.len-1));for(let c=a,l=s[c];c>0&&l.id.clock>=o.clock;l=s[c])c-=1+Fo(s,c)}})},fm=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{xl(i),n.afterState=Bo(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),im(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Il(a,[]),n._needFormattingCleanup&&wN(n)}finally{r.gc&&ZI(i,s,r.gcFilter),eN(i,s),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=s.clients.get(h),p=mr(Lt(f,d),1);for(let _=f.length-1;_>=p;)_-=1+Fo(f,_)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=s.clients.get(h),p=Lt(f,d);p+1<f.length&&Fo(f,p+1)>1||p>0&&Fo(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(OI(Kg,Fg,"[yjs] ",jg,Gg,"Changed the client-id because another client seems to be using it."),r.clientID=Yg()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new ei;um(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Er;um(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):fm(t,e+1)}}},te=(t,e,n=null,r=!0)=>{const s=t._transactionCleanups;let i=!1,o=null;t._transaction===null&&(i=!0,t._transaction=new QI(t,n,r),s.push(t._transaction),s.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(i){const a=t._transaction===s[0];t._transaction=null,a&&fm(s,0)}}return o};function*tN(t){const e=B(t.restDecoder);for(let n=0;n<e;n++){const r=B(t.restDecoder),s=t.readClient();let i=B(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=B(t.restDecoder);yield new mt(j(s,i),c),i+=c}else if(Lo&a){const c=(a&(bn|nt))===0,l=new Ae(j(s,i),null,(a&nt)===nt?t.readLeftID():null,null,(a&bn)===bn?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&Vs)===Vs?t.readString():null,xm(t,a));yield l,i+=l.length}else{const c=t.readLen();yield new rt(j(s,i),c),i+=c}}}}class Fl{constructor(e,n){this.gen=tN(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===mt);return this.curr}}class jl{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const nN=t=>jo(t,Xg,ei),rN=(t,e)=>{if(t.constructor===rt){const{client:n,clock:r}=t.id;return new rt(j(n,r+e),t.length-e)}else if(t.constructor===mt){const{client:n,clock:r}=t.id;return new mt(j(n,r+e),t.length-e)}else{const n=t,{client:r,clock:s}=n.id;return new Ae(j(r,s+e),null,j(r,s+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},jo=(t,e=Jr,n=Er)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(_r(u)));let s=r.map(u=>new Fl(u,!0)),i=null;const o=new n,a=new jl(o);for(;s=s.filter(d=>d.curr!==null),s.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===mt?1:-1:p}else return f.curr.id.client-d.curr.id.client}),s.length!==0;){const u=s[0],h=u.curr.id.client;if(i!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)Yn(a,i.struct,i.offset),i={struct:d,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===mt)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{Yn(a,i.struct,i.offset);const p=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new mt(j(h,i.struct.id.clock+i.struct.length),p),offset:0}}else{const p=i.struct.id.clock+i.struct.length-d.id.clock;p>0&&(i.struct.constructor===mt?i.struct.length-=p:d=rN(d,p)),i.struct.mergeWith(d)||(Yn(a,i.struct,i.offset),i={struct:d,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==mt;d=u.next())Yn(a,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(Yn(a,i.struct,i.offset),i=null),Gl(a);const c=r.map(u=>Ul(u)),l=LI(c);return Xr(o,l),o.toUint8Array()},sN=(t,e,n=Jr,r=Er)=>{const s=em(e),i=new r,o=new jl(i),a=new n(_r(t)),c=new Fl(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=s.get(h)||0;if(c.curr.constructor===mt){c.next();continue}if(u.id.clock+u.length>d)for(Yn(o,u,mr(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Yn(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}Gl(o);const l=Ul(a);return Xr(i,l),i.toUint8Array()},dm=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Ct(t.encoder.restEncoder)}),t.encoder.restEncoder=Hn(),t.written=0)},Yn=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&dm(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),$(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Gl=t=>{dm(t);const e=t.encoder.restEncoder;$(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];$(e,r.written),Mo(e,r.restEncoder)}},iN=(t,e,n,r)=>{const s=new n(_r(t)),i=new Fl(s,!1),o=new r,a=new jl(o);for(let l=i.curr;l!==null;l=i.next())Yn(a,e(l),0);Gl(a);const c=Ul(s);return Xr(o,c),o.toUint8Array()},oN=t=>iN(t,fI,Jr,ei),pm="You must not compute changes after the event-handler fired.";class Go{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=aN(this.currentTarget,this.target))}deletes(e){return Vg(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Vn(pm);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,a;if(this.adds(i)){let c=i.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(i))if(c!==null&&this.deletes(c))o="delete",a=yl(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=yl(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=yl(i.content.getContent());else return;e.set(s,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Vn(pm);const n=this.target,r=Vr(),s=Vr(),i=[];if(e={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&i.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,s.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const aN=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}e=e._item.parent}return n},gm=80;let Kl=0;class cN{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Kl++}}const lN=t=>{t.timestamp=Kl++},mm=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Kl++},uN=(t,e,n)=>{if(t.length>=gm){const r=t.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return mm(r,e,n),r}else{const r=new cN(e,n);return t.push(r),r}},Ko=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((i,o)=>Co(e-i.index)<Co(e-o.index)?i:o);let r=t._start,s=0;for(n!==null&&(r=n.p,s=n.index,lN(n));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&Co(n.index-s)<r.parent.length/gm?(mm(n,r,s),n):uN(t._searchMarker,r,s)},ti=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const s=t[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){t.splice(r,1);continue}s.p=i,i.marker=!0}(e<s.index||n>0&&e===s.index)&&(s.index=mr(e,s.index+n))}},Wo=(t,e,n)=>{const r=t,s=e.changedParentTypes;for(;Gn(s,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;im(r._eH,n,e)};class le{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=nm(),this._dEH=nm(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Jt()}clone(){throw Jt()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){rm(this._eH,e)}observeDeep(e){rm(this._dEH,e)}unobserve(e){sm(this._eH,e)}unobserveDeep(e){sm(this._dEH,e)}toJSON(){}}const ym=(t,e,n)=>{e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const s=[];let i=t._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)s.push(o[a]),r--;e=0}}i=i.right}return s},_m=t=>{const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}n=n.right}return e},ni=(t,e)=>{let n=0,r=t._start;for(;r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)e(s[i],n++,t)}r=r.right}},Em=(t,e)=>{const n=[];return ni(t,(r,s)=>{n.push(e(r,s,t))}),n},hN=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},wm=(t,e)=>{const n=Ko(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Ho=(t,e,n,r)=>{let s=n;const i=t.doc,o=i.clientID,a=i.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(s=new Ae(j(o,Re(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new Sr(l)),s.integrate(t,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:s=new Ae(j(o,Re(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new ri(new Uint8Array(h))),s.integrate(t,0);break;case An:s=new Ae(j(o,Re(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new ii(h)),s.integrate(t,0);break;default:if(h instanceof le)s=new Ae(j(o,Re(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new kn(h)),s.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},bm=()=>Vn("Length exceeded!"),Sm=(t,e,n,r)=>{if(n>e._length)throw bm();if(n===0)return e._searchMarker&&ti(e._searchMarker,n,r.length),Ho(t,e,null,r);const s=n,i=Ko(e,n);let o=e._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&zn(t,j(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&ti(e._searchMarker,s,r.length),Ho(t,e,o,r)},fN=(t,e,n)=>{let s=(e._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return Ho(t,e,s,n)},Tm=(t,e,n,r)=>{if(r===0)return;const s=n,i=r,o=Ko(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&zn(t,j(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&zn(t,j(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw bm();e._searchMarker&&ti(e._searchMarker,s,-i+r)},Vo=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Wl=(t,e,n,r)=>{const s=e._map.get(n)||null,i=t.doc,o=i.clientID;let a;if(r==null)a=new Sr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Sr([r]);break;case Uint8Array:a=new ri(r);break;case An:a=new ii(r);break;default:if(r instanceof le)a=new kn(r);else throw new Error("Unexpected content type")}new Ae(j(o,Re(i.store,o)),s,s&&s.lastId,null,null,e,n,a).integrate(t,0)},Hl=(t,e)=>{const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Am=t=>{const e={};return t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},vm=(t,e)=>{const n=t._map.get(e);return n!==void 0&&!n.deleted},dN=(t,e)=>{const n={};return t._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&Zr(i,e)&&(n[s]=i.content.getContent()[i.length-1])}),n},zo=t=>NI(t.entries(),e=>!e[1].deleted);class pN extends Go{constructor(e,n){super(e,n),this._transaction=n}}class en extends le{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new en;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new en}clone(){const e=new en;return e.insert(0,this.toArray().map(n=>n instanceof le?n.clone():n)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,n){super._callObserver(e,n),Wo(this,e,new pN(this,e))}insert(e,n){this.doc!==null?te(this.doc,r=>{Sm(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?te(this.doc,n=>{fN(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?te(this.doc,r=>{Tm(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return wm(this,e)}toArray(){return _m(this)}slice(e=0,n=this.length){return ym(this,e,n)}toJSON(){return this.map(e=>e instanceof le?e.toJSON():e)}map(e){return Em(this,e)}forEach(e){ni(this,e)}[Symbol.iterator](){return hN(this)}_write(e){e.writeTypeRef($N)}}const gN=t=>new en;class mN extends Go{constructor(e,n,r){super(e,n),this.keysChanged=r}}class tn extends le{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new tn}clone(){const e=new tn;return this.forEach((n,r)=>{e.set(r,n instanceof le?n.clone():n)}),e}_callObserver(e,n){Wo(this,e,new mN(this,e,n))}toJSON(){const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];e[r]=s instanceof le?s.toJSON():s}}),e}get size(){return[...zo(this._map)].length}keys(){return Ll(zo(this._map),e=>e[0])}values(){return Ll(zo(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Ll(zo(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?te(this.doc,n=>{Vo(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?te(this.doc,r=>{Wl(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Hl(this,e)}has(e){return vm(this,e)}clear(){this.doc!==null?te(this.doc,e=>{this.forEach(function(n,r,s){Vo(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(BN)}}const yN=t=>new tn,qn=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&hI(t,e);class Vl{constructor(e,n,r,s){this.left=e,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Qt(),this.right.content.constructor){case Te:this.right.deleted||es(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const km=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Te:e.right.deleted||es(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&zn(t,j(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Yo=(t,e,n,r)=>{const s=new Map,i=r?Ko(e,n):null;if(i){const o=new Vl(i.p.left,i.p,i.index,s);return km(t,o,n-i.index)}else{const o=new Vl(null,e._start,0,s);return km(t,o,n)}},Rm=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Te&&qn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=t.doc,i=s.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Ae(j(i,Re(s.store,i)),c,c&&c.lastId,l,l&&l.id,e,null,new Te(a,o));u.integrate(t,0),n.right=u,n.forward()})},es=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Om=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Te&&qn(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Im=(t,e,n,r)=>{const s=t.doc,i=s.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!qn(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new Ae(j(i,Re(s.store,i)),u,u&&u.lastId,h,h&&h.id,e,null,new Te(a,c)),n.right.integrate(t,0),n.forward()}}return o},zl=(t,e,n,r,s)=>{n.currentAttributes.forEach((d,f)=>{s[f]===void 0&&(s[f]=null)});const i=t.doc,o=i.clientID;Om(n,s);const a=Im(t,e,n,s),c=r.constructor===String?new rn(r):r instanceof le?new kn(r):new br(r);let{left:l,right:u,index:h}=n;e._searchMarker&&ti(e._searchMarker,n.index,c.getLength()),u=new Ae(j(o,Re(i.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=h,n.forward(),Rm(t,e,n,a)},Nm=(t,e,n,r,s)=>{const i=t.doc,o=i.clientID;Om(n,s);const a=Im(t,e,n,s);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Te));){if(!n.right.deleted)switch(n.right.content.constructor){case Te:{const{key:c,value:l}=n.right.content,u=s[c];if(u!==void 0){if(qn(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&zn(t,j(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Ae(j(o,Re(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new rn(c)),n.right.integrate(t,0),n.forward()}Rm(t,e,n,a)},Cm=(t,e,n,r,s)=>{let i=e;const o=Nt();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===Te){const l=i.content;o.set(l.key,l)}i=i.right}let a=0,c=!1;for(;e!==i;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Te:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(e.delete(t),a++,!c&&(s.get(u)??null)===h&&d!==h&&(d===null?s.delete(u):s.set(u,d))),!c&&!e.deleted&&es(s,l);break}}}e=e.right}return a},_N=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Te){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},EN=t=>{let e=0;return te(t.doc,n=>{let r=t._start,s=t._start,i=Nt();const o=ml(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case Te:es(o,s.content);break;default:e+=Cm(n,r,s,i,o),i=ml(o),r=s;break}s=s.right}}),e},wN=t=>{const e=new Set,n=t.doc;for(const[r,s]of t.afterState.entries()){const i=t.beforeState.get(r)||0;s!==i&&lm(t,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===Te&&o.constructor!==rt&&e.add(o.parent)})}te(n,r=>{Hg(t,t.deleteSet,s=>{if(s instanceof rt||!s.parent._hasFormatting||e.has(s.parent))return;const i=s.parent;s.content.constructor===Te?e.add(i):_N(r,s)});for(const s of e)EN(s)})},Lm=(t,e,n)=>{const r=n,s=ml(e.currentAttributes),i=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case kn:case br:case rn:n<e.right.length&&zn(t,j(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}i&&Cm(t,i,e.right,s,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&ti(o._searchMarker,e.index,-r+n),e};class bN extends Go{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];te(e,r=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},s.size>0&&(f.attributes={},s.forEach((p,_)=>{p!==null&&(f.attributes[_]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},cI(c)||(f.attributes=iI({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case kn:case br:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case rn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Te:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const _=s.get(f)??null;qn(_,p)?p!==null&&o.delete(r):(a==="retain"&&d(),qn(p,i.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){i.set(f,p);const _=s.get(f)??null;qn(_,p)||(a==="retain"&&d(),c[f]=_)}else if(!o.deleted){i.set(f,p);const _=c[f];_!==void 0&&(qn(_,p)?_!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),es(s,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Mt extends le{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Mt}clone(){const e=new Mt;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new bN(this,e,n);Wo(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===rn&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?te(this.doc,r=>{const s=new Vl(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const o=e[i];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&i===e.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&zl(r,this,s,a,o.attributes||{})}else o.retain!==void 0?Nm(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Lm(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){const s=[],i=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;i.forEach((p,_)=>{d=!0,h[_]=p});const f={insert:a};d&&(f.attributes=h),s.push(f),a=""}}const u=()=>{for(;c!==null;){if(Zr(c,e)||n!==void 0&&Zr(c,n))switch(c.content.constructor){case rn:{const h=i.get("ychange");e!==void 0&&!Zr(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),i.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Zr(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),i.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),i.delete("ychange")),a+=c.content.str;break}case kn:case br:{l();const h={insert:c.content.getContent()[0]};if(i.size>0){const d={};h.attributes=d,i.forEach((f,p)=>{d[p]=f})}s.push(h);break}case Te:Zr(c,e)&&(l(),es(i,c.content));break}c=c.right}l()};return e||n?te(o,h=>{e&&Dl(h,e),n&&Dl(h,n),u()},"cleanup"):u(),s}insert(e,n,r){if(n.length<=0)return;const s=this.doc;s!==null?te(s,i=>{const o=Yo(i,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),zl(i,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const s=this.doc;s!==null?te(s,i=>{const o=Yo(i,this,e,!r);zl(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?te(r,s=>{Lm(s,Yo(s,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const s=this.doc;s!==null?te(s,i=>{const o=Yo(i,this,e,!1);o.right!==null&&Nm(i,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?te(this.doc,n=>{Vo(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?te(this.doc,r=>{Wl(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Hl(this,e)}getAttributes(){return Am(this)}_write(e){e.writeTypeRef(FN)}}const SN=t=>new Mt;class Yl{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===vn||n.constructor===nn)&&n._start!==null)e=n._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class nn extends le{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new nn}clone(){const e=new nn;return e.insert(0,this.toArray().map(n=>n instanceof le?n.clone():n)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Yl(this,e)}querySelector(e){e=e.toUpperCase();const r=new Yl(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Kn(new Yl(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Wo(this,e,new vN(this,n,e))}toString(){return Em(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),ni(this,i=>{s.insertBefore(i.toDOM(e,n,r),null)}),s}insert(e,n){this.doc!==null?te(this.doc,r=>{Sm(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)te(this.doc,r=>{const s=e&&e instanceof le?e._item:e;Ho(r,this,s,n)});else{const r=this._prelimContent,s=e===null?0:r.findIndex(i=>i===e)+1;if(s===0&&e!==null)throw Vn("Reference item not found");r.splice(s,0,...n)}}delete(e,n=1){this.doc!==null?te(this.doc,r=>{Tm(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return _m(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return wm(this,e)}slice(e=0,n=this.length){return ym(this,e,n)}forEach(e){ni(this,e)}_write(e){e.writeTypeRef(GN)}}const TN=t=>new nn;class vn extends nn{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new vn(this.nodeName)}clone(){const e=new vn(this.nodeName),n=this.getAttributes();return aI(n,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof le?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?te(this.doc,n=>{Vo(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?te(this.doc,r=>{Wl(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Hl(this,e)}hasAttribute(e){return vm(this,e)}getAttributes(e){return e?dN(this,e):Am(this)}toDOM(e=document,n={},r){const s=e.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return ni(this,o=>{s.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(jN),e.writeKey(this.nodeName)}}const AN=t=>new vn(t.readKey());class vN extends Go{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class ts extends tn{constructor(e){super(),this.hookName=e}_copy(){return new ts(this.hookName)}clone(){const e=new ts(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const s=n[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(KN),e.writeKey(this.hookName)}}const kN=t=>new ts(t.readKey());class wr extends Mt{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new wr}clone(){const e=new wr;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const s=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{const n=[];for(const s in e.attributes){const i=[];for(const o in e.attributes[s])i.push({key:o,value:e.attributes[s][o]});i.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const i=n[s];r+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const a=i.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(WN)}}const RN=t=>new wr;class ql{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Jt()}mergeWith(e){return!1}write(e,n,r){throw Jt()}integrate(e,n){throw Jt()}}const ON=0;class rt extends ql{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),am(e.doc.store,this)}write(e,n){e.writeInfo(ON),e.writeLen(this.length-n)}getMissing(e,n){return null}}class ri{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ri(this.content)}splice(e){throw Jt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const IN=t=>new ri(t.readBuf());class si{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new si(this.len)}splice(e){const n=new si(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){Do(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const NN=t=>new si(t.readLen()),Mm=(t,e)=>new An({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class ii{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ii(Mm(this.doc.guid,this.opts))}splice(e){throw Jt()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const CN=t=>new ii(Mm(t.readString(),t.readAny()));class br{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new br(this.embed)}splice(e){throw Jt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const LN=t=>new br(t.readJSON());class Te{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Te(this.key,this.value)}splice(e){throw Jt()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const MN=t=>new Te(t.readKey(),t.readJSON());class qo{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new qo(this.arr)}splice(e){const n=new qo(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];e.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const xN=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const s=t.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new qo(n)};class Sr{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Sr(this.arr)}splice(e){const n=new Sr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];e.writeAny(i)}}getRef(){return 8}}const UN=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Sr(n)};class rn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new rn(this.str)}splice(e){const n=new rn(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const PN=t=>new rn(t.readString()),DN=[gN,yN,SN,AN,TN,kN,RN],$N=0,BN=1,FN=2,jN=3,GN=4,KN=5,WN=6;class kn{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new kn(this.type._copy())}splice(e){throw Jt()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const HN=t=>new kn(DN[t.readTypeRef()](t)),Xo=(t,e,n)=>{const{client:r,clock:s}=e.id,i=new Ae(j(r,s+n),e,j(r,s+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=j(e.redone.client,e.redone.clock+n)),e.right=i,i.right!==null&&(i.right.left=i),t._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=n,i};class Ae extends ql{constructor(e,n,r,s,i,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Tg:0}set marker(e){(this.info&El)>0!==e&&(this.info^=El)}get marker(){return(this.info&El)>0}get keep(){return(this.info&Sg)>0}set keep(e){this.keep!==e&&(this.info^=Sg)}get countable(){return(this.info&Tg)>0}get deleted(){return(this.info&_l)>0}set deleted(e){this.deleted!==e&&(this.info^=_l)}markDeleted(){this.info|=_l}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Re(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Re(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Qr&&this.id.client!==this.parent.client&&this.parent.clock>=Re(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=cm(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=zn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===rt||this.right&&this.right.constructor===rt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ae&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Ae&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Qr){const r=$l(n,this.parent);r.constructor===rt?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=cm(e,e.doc.store,j(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),$o(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if($o(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has($l(e.doc.store,s.origin)))i.has($l(e.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),am(e.doc.store,this),this.content.integrate(e,this),hm(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new rt(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:j(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&$o(e.origin,this.lastId)&&this.right===e&&$o(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Do(e.deleteSet,this.id.client,this.id.clock,this.length),hm(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Qt();this.content.gc(e),n?JI(e,this,new rt(this.id,this.length)):this.content=new si(this.length)}write(e,n){const r=n>0?j(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&Lo|(r===null?0:nt)|(s===null?0:bn)|(i===null?0:Vs);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=XI(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Qr?(e.writeParentInfo(!1),e.writeLeftID(a)):Qt();i!==null&&e.writeString(i)}this.content.write(e,n)}}const xm=(t,e)=>VN[e&Lo](t),VN=[()=>{Qt()},NN,xN,IN,PN,LN,MN,HN,UN,CN,()=>{Qt()}],zN=10;class mt extends ql{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Qt()}write(e,n){e.writeInfo(zN),$(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const Um=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Pm="__ $YJS$ __";Um[Pm]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Um[Pm]=!0;let Xl,Jl,YN=t=>t();function qN(t,e){if(Jl)return Jl(t,e);YN(t)}function Tr(t,e,n){if(Xl)return Xl.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function XN(t){Xl=function(e,n,r){const s=t.createAtom(e);return n&&n(),s},Jl=(e,n)=>t.reaction(e,n,{fireImmediately:!1})}const Dm=new WeakSet;function JN(t){if(Dm.has(t))return t;Dm.add(t);let e;const n=new Map;function r(){if(!e){const h=d=>{(d.changes.added.size||d.changes.deleted.size||d.changes.keys.size||d.changes.delta.length)&&e.reportChanged()};e=Tr("map",()=>{t.observe(h)},()=>{t.unobserve(h)})}e.reportObserved(t._implicitObserver)}function s(h){let d=n.get(h);if(!d){const f=p=>{d.reportChanged()};d=Tr(h+"",()=>{t.observe(f)},()=>{t.unobserve(f)}),n.set(h,d)}d.reportObserved(t._implicitObserver)}const i=t.get;t.get=function(h){if(typeof h!="number")throw new Error("unexpected");return s(h),Reflect.apply(i,this,arguments)};function o(h){const d=t[h];t[h]=function(){return r(),Reflect.apply(d,this,arguments)}}function a(h){let d=t,f=Object.getOwnPropertyDescriptor(d,h);if(f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),!f)throw new Error("property not found");const p=f.get;f.get=function(){return this._disableTracking||r(),Reflect.apply(p,this,arguments)},Object.defineProperty(t,h,f)}function c(h,d){let f=t,p=Object.getOwnPropertyDescriptor(f,h);if(p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),!p)throw new Error("property not found");Object.defineProperty(t,d,p)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const l=t.push;t.push=function(h){this._disableTracking=!0;const d=l.call(this,h);return this._disableTracking=!1,d};const u=t.slice;return t.slice=function(h,d){this._disableTracking=!0;const f=u.call(this,h,d);return this._disableTracking=!1,f},t}const $m=new WeakSet;function QN(t){if($m.has(t))return t;$m.add(t);let e;function n(){if(!e){let i=Array.from(t.share.keys());const o=a=>{const c=Array.from(t.share.keys());JSON.stringify(i)!==JSON.stringify(c)&&(i=c,e.reportChanged())};e=Tr("map",()=>{t.on("beforeObserverCalls",o)},()=>{t.off("beforeObserverCalls",o)})}e.reportObserved(t._implicitObserver)}const r=t.get;t.get=function(i){if(typeof i!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return Jo(o),o};function s(i){const o=t[i];let a;t[i]=function(){let c,l=arguments;return n(),a&&a.removeObservers(),a=qN(()=>(c=Reflect.apply(o,t,l),c),()=>e.reportChanged()),c}}return s("toJSON"),Object.defineProperty(t,"keys",{get:()=>(n(),Object.keys(t.share))}),t}const Bm=new WeakSet;function ZN(t){if(Bm.has(t))return t;Bm.add(t);let e;const n=new Map;function r(){if(!e){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&e.reportChanged()};e=Tr("map",()=>{t.observe(a)},()=>{t.unobserve(a)})}e.reportObserved(t._implicitObserver)}function s(a){let c=n.get(a);if(!c){const l=u=>{u.keysChanged.has(a)&&(u.changes.added.size||u.changes.deleted.size||u.changes.keys.size||u.changes.delta.length)&&c.reportChanged()};c=Tr(a,()=>{t.observe(l)},()=>{t.unobserve(l)}),n.set(a,c)}c.reportObserved(t._implicitObserver)}const i=t.get;t.get=function(a){if(typeof a!="string")throw new Error("unexpected");return s(a),Reflect.apply(i,this,arguments)};function o(a){const c=t[a];t[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),t}const Fm=new WeakSet;function jm(t){if(Fm.has(t))return t;Fm.add(t);let e;const n=s=>{e.reportChanged()};e=Tr("text",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(s){const i=t[s];t[s]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(i,this,arguments)}}return r("toString"),r("toJSON"),t}const Gm=new WeakSet;function Km(t){if(Gm.has(t))return t;Gm.add(t);let e;const n=i=>{(i.changes.added.size||i.changes.deleted.size||i.changes.keys.size||i.changes.delta.length)&&e.reportChanged()};e=Tr("xml",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(i){const o=t[i];t[i]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function s(i){let o=t,a=Object.getOwnPropertyDescriptor(o,i);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,i)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,i)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(t,i,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),s("firstChild"),t}function Jo(t){return t instanceof wr||t instanceof Mt?jm(t):t instanceof en?JN(t):t instanceof tn?ZN(t):t instanceof An||Object.prototype.hasOwnProperty.call(t,"autoLoad")?QN(t):t instanceof nn||t instanceof vn?Km(t):t}function Wm(t){t.share.forEach(e=>{e.constructor!==le&&Jo(e)})}function Hm(t,e){for(let r=t.length-1;r>=e;r--){let s=t[r];if(!s.deleted){var n;if(s instanceof rt)continue;(n=s.content)==null||n.getContent().forEach(i=>{i instanceof le&&Jo(i)})}}}const Vm=new WeakSet;function eC(t){Vm.has(t)||(Vm.add(t),Jo(t),t.store.clients.forEach(e=>{e&&Hm(e,0)}),Wm(t),t.on("beforeObserverCalls",e=>{Wm(t),e.afterState.forEach((n,r)=>{const s=e.beforeState.get(r)||0;if(s!==n){const i=e.doc.store.clients.get(r);if(!i)return;const o=Lt(i,s);Hm(i,o)}})}))}class oi{constructor(e){this.value=void 0,this.value=e}}function tC(t){return ArrayBuffer.isView(t)?new oi(t):new oi(Object.freeze(t))}function nC(t){const e=function(){var a;let c=(a=this[gt])==null?void 0:a.implicitObserver;return t._implicitObserver=c,t.slice.bind(t).apply(t,arguments).map(u=>{const h=Qo(u,c);return c&&typeof h=="object"?Hs(h,c):h})},n=function(a){return a.map(c=>{const l=Ql(c);let u=Ar(l)||l;if(u instanceof oi&&(u=u.value),u instanceof le&&u.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return u})},r=function(){return[].findIndex.apply(e.apply(this),arguments)},s={slice:e,unshift:(...o)=>(t.unshift(n(o)),t.lengthUntracked),push:(...o)=>(t.push(n(o)),t.lengthUntracked),insert:t.insert.bind(t),toJSON:t.toJSON.bind(t),forEach:function(){return[].forEach.apply(e.apply(this),arguments)},every:function(){return[].every.apply(e.apply(this),arguments)},filter:function(){return[].filter.apply(e.apply(this),arguments)},find:function(){return[].find.apply(e.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(e.apply(this),arguments)},includes:function(){return[].includes.apply(e.apply(this),arguments)},map:function(){return[].map.apply(e.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>aC(a,o))},splice:function(){let o=arguments[0]<0?t.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),l=e.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return t.doc?t.doc.transact(()=>{t.delete(o,a),t.insert(o,n(c))}):(t.delete(o,a),t.insert(o,n(c))),l}},i=[];for(let o in s)i[o]=s[o];return i}function ai(t){if(typeof t=="string"&&t.trim().length){const e=Number(t);if(Number.isInteger(e))return e}return t}function zm(t,e=new en){if(e[Se])throw new Error("unexpected");const n=nC(e),r=new Proxy(n,{set:(s,i,o)=>{throw typeof ai(i)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(s,i,o)=>{const a=ai(i);if(a===Zo)return e;if(typeof a=="number"){let u;if(o&&o[gt]){var c;u=(c=o[gt])==null?void 0:c.implicitObserver,e._implicitObserver=u}let h=e.get(a);return h=Qo(h,u),h}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const u=e.slice();return Reflect.get(u,a)}return a==="length"?e.length:Reflect.get(s,a,o)},deleteProperty:(s,i)=>{const o=ai(i);if(typeof o!="number")throw new Error;return o<e.lengthUntracked&&o>=0?(e.delete(o),!0):!1},has:(s,i)=>{const o=ai(i);return typeof o!="number"?Reflect.has(s,o):o<e.lengthUntracked&&o>=0},getOwnPropertyDescriptor(s,i){const o=ai(i);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<e.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:s=>{const i=[];for(let o=0;o<e.length;o++)i.push(o+"");return i.push("length"),i}});return n.push.apply(r,t),r}function Ym(t,e=new tn){if(e[Se])throw new Error("unexpected");const n=new Proxy({},{set:(r,s,i)=>{if(typeof s!="string")throw new Error;const o=Ql(i);let a=Ar(o)||o;if(a instanceof oi&&(a=a.value),a instanceof le&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return e.set(s,a),!0},get:(r,s,i)=>{if(s===Zo)return e;if(typeof s!="string")return Reflect.get(r,s);let o;if(i&&i[gt]){var a;o=(a=i[gt])==null?void 0:a.implicitObserver,e._implicitObserver=o}let c=e.get(s);return c=Qo(c,o),c},deleteProperty:(r,s)=>{if(typeof s!="string")throw new Error;return e.has(s)?(e.delete(s),!0):!1},has:(r,s)=>!!(typeof s=="string"&&e.has(s)),getOwnPropertyDescriptor(r,s){if(typeof s=="string"&&e.has(s))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.keys())});ci.set(e,n);for(let r in t)n[r]=t[r];return n}function rC(t){return t instanceof le}const ci=new WeakMap;function Qo(t,e){if(rC(t)){if(t._implicitObserver=e,t instanceof en||t instanceof tn){if(!ci.has(t)){const n=Ql(t);ci.set(t,n)}t=ci.get(t)}else if(t instanceof vn||t instanceof nn||t instanceof wr||t instanceof ts||t instanceof Mt)pl(t),t.__v_skip=!0;else throw new Error("unknown YType");return t}else{if(t===null)return null;if(typeof t=="object")return tC(t)}return t}function Ql(t){if(t==null)return t;if(t=Ar(t)||t,t instanceof en)return zm([],t);if(t instanceof tn)return Ym({},t);if(typeof t=="string")return t;if(Array.isArray(t))return zm(t);if(t instanceof vn||t instanceof nn||t instanceof wr||t instanceof ts)return t;if(t instanceof Mt)return t;if(typeof t=="object")return t instanceof oi?t:Ym(t);if(typeof t=="number"||typeof t=="boolean")return t;throw new Error("invalid")}function sC(t){for(let[e,n]of Object.entries(t))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function qm(t,e,n){let r=e[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?t.getXmlFragment(n):r==="text"?t.getText(n):Array.isArray(r)?t.getArray(n):t.getMap(n)}function iC(t,e){if(t[Se])throw new Error("unexpected");sC(e);const n=new Proxy({},{set:(r,s,i)=>{throw typeof s!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,s,i)=>{if(s===Zo)return t;if(typeof s!="string")return Reflect.get(r,s);let o;if(i&&i[gt]){var a;o=(a=i[gt])==null?void 0:a.implicitObserver,t._implicitObserver=o}if(s==="toJSON"){for(let u of Object.keys(e))qm(t,e,u);return Reflect.get(t,s)}let c=qm(t,e,s);return c=Qo(c,o),c},deleteProperty:(r,s)=>{throw new Error("deleteProperty not available for doc")},has:(r,s)=>!!(typeof s=="string"&&t.share.has(s)),getOwnPropertyDescriptor(r,s){if(typeof s=="string"&&t.share.has(s)||s==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.share.keys())});return ci.set(t,n),n}XN(vO);const Zo=Symbol("INTERNAL_SYMBOL");function Xm(t,e){const n=Ar(t)||t;if(!n)throw new Error("not a valid synced object");return n instanceof An?(n.on("update",e),()=>{n.off("update",e)}):(n.observeDeep(e),()=>{n.unobserveDeep(e)})}function oC(t){const e=Ar(t);if(!(e instanceof An))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return e}function Ar(t){if(typeof t!="object"||t===null)return;const e=t[Zo];return e&&(pl(e),e.__v_skip=!0),e}function aC(t,e){if(t===e)return!0;if(typeof t=="object"&&typeof e=="object"){const n=Ar(t),r=Ar(e);return!n||!r?!1:n===r}return!1}function cC(t,e=new An){return eC(e),iC(e,t)}const Zl=0,Jm=1,Qm=2,lC=(t,e)=>{$(t,Zl);const n=YI(e);Ue(t,n)},Zm=(t,e,n)=>{$(t,Jm),Ue(t,WI(e,n))},uC=(t,e,n)=>Zm(e,n,Ke(t)),ey=(t,e,n)=>{try{jI(e,Ke(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},hC=(t,e)=>{$(t,Qm),Ue(t,e)},fC=ey,dC=(t,e,n,r)=>{const s=B(t);switch(s){case Zl:uC(t,e,n);break;case Jm:ey(t,n,r);break;case Qm:fC(t,n,r);break;default:throw new Error("Unknown message type")}return s},Rn=cC({shared:[]});function ea(t,e,n){return t.find(r=>r.key===e&&r.type===n)}function ty(t,e,n){const r=ea(Rn.shared,t,e);g(r)||Rn.shared.push({key:t,type:e,value:n})}function pC(t,e){ty(t,0,e)}function ny(t,e){const n=new Mt(e);ty(t,1,n)}function gC(t,e){const n=ea(Rn.shared,t,0);if(g(n)){n.value=e;return}Rn.shared.push({key:t,type:0,value:e})}function mC(t,e){const n=new Mt(e),r=ea(Rn.shared,t,1);if(g(r)){r.value=n;return}Rn.shared.push({key:t,type:1,value:n})}function ry(t,e,n){let r;function s(){const o=ea(Rn.shared,t,e);g(o)&&(i(),r=Xm(o,()=>n(o.value)))}const i=Xm(Rn.shared,s);return s(),()=>r==null?void 0:r()}function yC(t,e){return ry(t,0,e)}function sy(t,e){return ry(t,1,n=>e(n.toJSON()))}function ta(t){return Ct(t)}let iy=!1;const Xn=oC(Rn),On=as("modem",["second"],t=>{switch(t.target){case"second":!iy&&t.data%2===0&&On.emit("modem:join");break;case"join":if(t.sender!==On.id()){On.reply(t,"joinack");const e=Hn();lC(e,Xn),On.reply(t,"sync",ta(e));const n=Hn();Zm(n,Xn),On.reply(t,"sync",ta(n))}break;case"joinack":iy=!0;break;case"sync":{if(g(t.data)&&t.sender!==On.id()){const e=_r(t.data),n=Hn();dC(e,n,Xn,On)===Zl&&On.emit("modem:sync",ta(n))}break}}});function oy(t){const e=Hn();hC(e,t),On.emit("modem:sync",ta(e))}Xn.on("update",oy),Xn.on("destroy",()=>{Xn==null||Xn.off("update",oy)});const _C=navigator.userAgent.indexOf("Mac")!==-1?"cmd":"ctrl",In="$dkpurple",EC="$196",ay="$205";function xt(t,e){return`$${t}${e}$blue`}function cy(t,e){return`$${t}${e}$ondkblue`}function ne(t){wt("cli",t)}function li(t){const e=EC.repeat(t.length+2),n=ay.repeat(t.length+2);ne(`${In} ${" ".repeat(t.length)} `),ne(`${In}${e}`),ne(`${In} $white${t} `),ne(`${In}${n}`)}function Nn(t){const e=ay.repeat(t.length+2);ne(`${In} ${" ".repeat(t.length)} `),ne(`${In} $gray${t} `),ne(`${In}${e}`)}function V(t,e){ne(`${In} $white${t} $blue${e}`)}function G(t){ne(`${In}$blue${t}`)}let Jn="";const eu="main";function ly(t){const e=SR([],[]);return z(t)?e.name=t:g(Yt(eu))||(e.name=eu),GR(e),G(`created ${e.name}`),na(),e}function ui(){let t=Yt(Jn);return g(t)?t:(t=Yt(eu),g(t)?(Jn=t.id,G(`opened [book] ${t.name}`),t):ly())}function na(){Aa("cli")}const wC=Xt({get(t,e){const n=q(t.id()),r=dp(n.book,n.player,e);return[g(r),r]},set(t,e,n){const r=q(t.id());return pp(r.book,r.player,e,n),[!0,n]},shouldtick(){},tick(){},tock(){}}).command("bookcreate",(t,e)=>{const[n]=R(I(t,e),0,[k.STRING]),r=ly(n);return t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const n=q(t.id()),[r]=R(I(t,e),0,[k.STRING]),s=Yt(r);return g(s)?(Jn=r,G(`opened [book] ${s.name}`),t.command("pages")):un("cli","bookopen",`book ${r} not found`,n.player),0}).command("bookopenorcreate",(t,e)=>{const[n]=R(I(t,e),0,[k.STRING]),r=Yt(n);return g(r)?t.command("bookopen",n):t.command("bookcreate",n),0}).command("booktrash",(t,e)=>{const[n]=R(I(t,e),0,[k.STRING]),r=Yt(Jn),s=Yt(n);return g(s)&&(r===s&&(Jn=""),KR(n),G(`trashed [book] ${s.name}`),na(),t.command("pages")),0}).command("pagecreate",(t,e)=>{const[n]=R(I(t,e),0,[k.STRING]),r=ui();if(!g(r))return 0;const s=`@${n}
`,i=mR(s,{}),o=Ot(i),a=Gc(r,Ls(i),o);if(!g(a)){kR(r,i);const c=Ms(i);G(`create [${c}] ${o}`),na(),t.command("pageopen",i.id)}return 0}).command("pageopen",(t,e)=>{const n=q(t.id()),[r]=R(I(t,e),0,[k.STRING]),s=ui();if(!g(s))return 0;Jn=s.id;const i=fr(s,r);if(g(i)){const o=Ot(i),a=Ms(i);G(`opened [${a}] ${o}`),ny($u(s.id,i.id),i.code);const c=Ms(i);J_("cli",Jn,i.id,c,`@book ${s.name}:${o}`,n.player)}else un("cli","pageopen",`page ${r} not found`,n.player);return 0}).command("pageopenorcreate",(t,e)=>{const[n]=R(I(t,e),0,[k.STRING]),r=ui();if(!g(r))return 0;const s=fr(r,n);return g(s)?t.command("pageopen",n):t.command("pagecreate",n),0}).command("pagetrash",(t,e)=>{const[n]=R(I(t,e),0,[k.STRING]),r=ui(),s=RR(r,n);if(g(n)){const i=Ot(s),o=Ms(s);G(`trashed [${o}] ${i}`),na(),t.command("pages")}return 0}).command("biosflash",()=>(z_("cli"),G("bios flashed"),0)).command("bioserase",()=>(Y_("cli"),G("bios erased, refreshing page recommended"),0)).command("help",(t,e)=>{const n=e.map(Je).join(" ")||"menu";return t.command(`help${n}`),0}).command("text",(t,e)=>{const n=q(t.id()),r=e.map(Je).join(" ");return wt("$2",`${n.player}: ${r}`),0}).command("hyperlink",(t,e)=>{const n=q(t.id()),[r,...s]=e,i=Je(r),o=s.map(Je).join(" ");return wt("$2",`!${o};${n.player}: ${i}`),0}).command("books",()=>{Nn("books");const t=Kr();return t.length?t.forEach(e=>{ne(`!bookopen ${e.id};${e.name}`)}):G("no books found"),ne("!bookcreate;create a new book"),0}).command("pages",t=>{Nn("pages");const e=ui();return g(e)?e.pages.length?e.pages.forEach(n=>{const r=Ot(n);ne(`!pageopen ${n.id};${r}`)}):(G("no pages found"),G("use @ to create a page"),G("@board Name of board"),G("@terrain Name of terrain"),G("@charset Name of charset"),G("@palette Name of palette"),G("You can omit the type and it will default to object"),G("@object Name of object"),G("@Name of object")):t.command("bookopen","main"),0}).command("stat",(t,e)=>{const[n]=e,r=Je(n);if(/^book /gi.test(r)){const s=r.substring(5);t.command("bookopenorcreate",s)}else t.command("pageopenorcreate",r);return 0}).command("trash",()=>{Nn("$REDTRASH"),G("books");const t=Kr();t.length&&(t.forEach(n=>{ne(`!booktrash ${n.id};$REDTRASH ${n.name}`)}),ne(""));const e=Yt(Jn);return g(e)&&(G(`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=Ot(n);ne(`!pagetrash ${n.id};$REDTRASH ${r}`)}),ne("")),0}).command("save",()=>(Aa("cli"),0)).command("update",()=>{const t=Kr().map(e=>e.name).join(" ");return ne(`!biosflash;$GREENWrite ${t} to bios`),0}).command("factoryreset",()=>(ne("!bioserase;$REDReset bios"),0)).command("send",(t,e)=>{const[n,r]=R(I(t,e),0,[k.STRING,k.ANY]);switch(n){case"helpmenu":li("H E L P"),V("#help controls","zss controls and inputs"),ne("!helpcontrols;read help controls"),ne(""),V("#help text","text formatting"),ne("!helptext;read help text"),ne(""),V("#help developer","developer commands"),ne("!helpdeveloper;read help developer"),ne(""),V("#help player","player settings"),ne("!helpplayer;read help player"),ne(""),Nn("keyboard input"),V("?","open console"),V("esc","close console"),V("tab","move console"),V("up / down arrow keys","navigate console items"),V("left / right arrow keys","change console items"),V("enter","interact with console items"),V("alt + arrow keys","skip words and console lines"),V(`${_C} + up / down arrow keys`,"input history");break;case"helpcontrols":li("zss controls and inputs"),Nn("keyboard input"),V("arrow keys","move"),V("shift + arrow keys","shoot"),V("enter","ok / accept"),V("escape","cancel / close"),V("tab","menu / action"),Nn("mouse input"),G("todo ???"),Nn("controller input"),V("left stick","move"),V("right stick","aim"),V("a","ok / accept"),V("b","cancel / close"),V("y","menu / action"),V("x","shoot"),V("triggers","shoot");break;case"helptext":li("text formatting"),Nn("typography"),G("plain text"),G("$centering text"),G('"\\"@quoted strings for special chars\\""'),G("$$0-255 for ascii chars $159$176$240"),G(`use color names like ${xt("red","$$red")} to change foreground color`),G(`use color names like ${cy("ongreen","$$ongreen")} to change background color`),G(`use clear ${cy("clear","to change background to")} transparent`),Nn("hyperlinks"),G(`${xt("white",'"!hotkey"')} message shortcut;${xt("gray","Label")}`),G(`${xt("white",'"!range"')} flag [labelmin] [labelmax];${xt("gray","Input Label")}`),G(`${xt("white",'"!select"')} flag ...list of values;${xt("gray","Input Label")}`),G(`${xt("white",'"!number"')} flag [minvalue] [maxvalue];${xt("gray","Input Label")}`),G(`${xt("white",'"!text"')} flag;${xt("gray","Input Label")}`);break;case"helpdeveloper":li("developer commands"),V("#books","list books in memory"),V("#pages","list pages in opened book"),V("@[pagetype:]page name","create & edit a new codepage in the currently opened book"),V("#trash","list books and pages from open book you can delete"),V("#save","flush state to register"),V("#update","write current books to bios"),V("#factoryreset","erase books stored in bios");break;case"helpplayer":li("player settings"),G("todo");break;default:wt("$2",`${n} ${r??""}`);break}return 0});var uy={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(t){(function(){var e=function(f,p){return p=p||"",f.replace(/(^|-)/g,"$1\\u"+p).replace(/,/g,"\\u"+p)},n=e("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+e("DF-F6,F8-FF","00"),s="A-Z"+e("C0-D6,D8-DE","00"),i="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(f,p,_,S){return f=f||n,p=p||r,_=_||s,S=S||i,{capitalize:new RegExp("(^|["+f+"])(["+p+"])","g"),pascal:new RegExp("(^|["+f+"])+(["+p+_+"])","g"),fill:new RegExp("["+f+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+p+"])","g"),improper:new RegExp("\\b("+S+")\\b","g"),relax:new RegExp("([^"+_+"])(["+_+"]*)(["+_+"])(?=[^"+_+"]|$)","g"),upper:new RegExp("^[^"+p+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+f+"]")}},a=o(),c={re:a,unicodes:e,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(f){return c.up.call(f.charAt(0))+f.slice(1)},decap:function(f){return c.low.call(f.charAt(0))+f.slice(1)},deapostrophe:function(f){return f.replace(a.apostrophe,"")},fill:function(f,p,_){return p!=null&&(f=f.replace(a.fill,function(S,T){return T?p+T:""})),_&&(f=c.deapostrophe(f)),f},prep:function(f,p,_,S){if(f=f==null?"":f+"",!S&&a.upper.test(f)&&(f=c.low.call(f)),!p&&!a.hole.test(f)){var T=c.fill(f," ");a.hole.test(T)&&(f=T)}return!_&&!a.room.test(f)&&(f=f.replace(a.relax,c.relax)),f},relax:function(f,p,_,S){return p+" "+(_?_+" ":"")+S}},l={_:c,of:function(f){for(var p=0,_=c.types.length;p<_;p++)if(l[c.types[p]].apply(l,arguments)===f)return c.types[p]},flip:function(f){return f.replace(/\w/g,function(p){return(p==c.up.call(p)?c.low:c.up).call(p)})},random:function(f){return f.replace(/\w/g,function(p){return(Math.round(Math.random())?c.up:c.low).call(p)})},type:function(f,p){l[f]=p,c.types.push(f)}},u={lower:function(f,p,_){return c.fill(c.low.call(c.prep(f,p)),p,_)},snake:function(f){return l.lower(f,"_",!0)},constant:function(f){return l.upper(f,"_",!0)},camel:function(f){return c.decap(l.pascal(f))},kebab:function(f){return l.lower(f,"-",!0)},upper:function(f,p,_){return c.fill(c.up.call(c.prep(f,p,!1,!0)),p,_)},capital:function(f,p,_){return c.fill(c.prep(f).replace(a.capitalize,function(S,T,E){return T+c.up.call(E)}),p,_)},header:function(f){return l.capital(f,"-",!0)},pascal:function(f){return c.fill(c.prep(f,!1,!0).replace(a.pascal,function(p,_,S){return c.up.call(S)}),"",!0)},title:function(f){return l.capital(f).replace(a.improper,function(p,_,S,T){return S>0&&S<T.lastIndexOf(" ")?c.low.call(p):p})},sentence:function(f,p,_){return f=l.lower(f).replace(a.sentence,function(S,T,E){return T+c.up.call(E)}),p&&p.forEach(function(S){f=f.replace(new RegExp("\\b"+l.lower(S)+"\\b","g"),c.cap)}),_&&_.forEach(function(S){f=f.replace(new RegExp("(\\b"+l.lower(S)+"\\. +)(\\w)"),function(T,E,A){return E+c.low.call(A)})}),f}};u.squish=u.pascal,l.default=l;for(var h in u)l.type(h,u[h]);var d=typeof d=="function"?d:function(){};d(t.exports?t.exports=l:this.Case=l)}).call(it)})(uy);var bC=uy.exports,SC=di(bC);const Qn={};function hy(t,e){return t.player=e,t.layers=[],t.layout=[],t.layoutreset=!0,t.layoutfocus="scroll",t}function fy(t){t.text=[],Object.values(Qn[t.id]??{}).forEach(e=>e==null?void 0:e()),Qn[t.id]={}}function dy(t){const e=t.layout.find(n=>n.name===t.layoutfocus);if(!e){const n={id:Et(),name:t.layoutfocus,edge:ot.RIGHT,size:20,text:[]};return t.layout.push(n),t.layoutreset=!1,n}return e}const tu={},TC=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),AC=new Set(["rn","range","sl","select","nm","number","tx","text"]),vC=new Set(["tx","text"]),kC={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""};function vr(t){let e=tu[t];return g(e)?e:tu[t]=e=hy({},t)}function RC(){return Object.keys(tu)}function OC(t){const e=vr(t);e.layout=e.layout.filter(n=>n.edge!==ot.SCROLL)}function IC(t,e,n){Object.values(Qn).forEach(r=>{if(r[e]!==void 0){const s=Pu(t.id(),e);pe(n)&&gC(s,n),z(n)&&mC(s,n)}})}function NC(t){const e=vr(t.id());e.layout=e.layout.filter(n=>n.edge!==ot.SCROLL||n.text.length>0)}function nu(t,e,n,r,s){const i=vr(t.id()),o=r,a=s??SC.capital(e),c=i.layout.find(l=>l.name===a);if(c)i.layoutreset=!0,i.layoutfocus=a,pe(o)&&(c.size=o);else switch(n){case ot.START:hy(i,t.id());break;case ot.LEFT:case ot.RIGHT:case ot.TOP:case ot.BOTTOM:case ot.SCROLL:{const l={id:Et(),name:a,edge:n,size:o??$_[n],text:[]};i.layout.push(l),i.layoutfocus=a;break}}}function CC(t,e){const n=vr(t.id()),r=dy(n);n.layoutreset&&(n.layoutreset=!1,fy(r)),r.text.push(e)}function LC(t,e,n,r){const s=vr(t.id()),i=dy(s);s.layoutreset&&(s.layoutreset=!1,fy(i));const o=n.toLowerCase(),a=[t.id(),e,...TC.has(o)?[o]:["hyperlink",n],...r],c=a[2];if(AC.has(c)){const l=`${a[3]??""}`;Qn[i.id]=Qn[i.id]??{};const u=t.get(l)??kC[c];if(Qn[i.id][l]===void 0){const h=Pu(t.id(),l);pe(u)&&pC(h,u),z(u)&&ny(h,u),vC.has(c)?Qn[i.id][l]=sy(h,d=>{g(d)&&d!==t.get(l)&&(console.info("modemobservevaluestring??",l,d,t.get(l)),t.set(l,d))}):Qn[i.id][l]=yC(h,d=>{g(d)&&d!==t.get(l)&&(console.info("modemobservevaluenumber??",l,d,t.get(l)),t.set(l,d))})}}i.text.push(a)}const MC=Xt({get(){return[!1,void 0]},set(t,e,n){return IC(t,e,n),[!1,void 0]},shouldtick(){},tick(t){var r;const e=q(t.id());let n="scroll";g((r=e.object)==null?void 0:r.name)&&(n=e.object.name),nu(t,"scroll",ot.SCROLL,void 0,n)},tock(t){NC(t)}}).command("gadget",(t,e)=>{const n=I(t,e),[r]=R(n,0,[k.STRING]),s=D_[r.toLowerCase()];if(s===ot.SCROLL){const[,i,o]=R(n,0,[k.STRING,k.MAYBE_STRING,k.MAYBE_NUMBER]);nu(t,r,s,o,i)}else{const[,i,o]=R(n,0,[k.STRING,k.MAYBE_NUMBER,k.MAYBE_STRING]);nu(t,r,s,i,o)}return 0}).command("frame",(t,e)=>{var c;const n=q(t.id()),[r,s,i]=R(I(t,e),0,[k.STRING,k.MAYBE_STRING,k.MAYBE_STRING]),o=((c=n.board)==null?void 0:c.id)??"",a=r.toLowerCase();if(a==="reset")Ep(o);else if(g(s)&&g(i))switch(s.toLowerCase()){case"edit":FR(o,[a],[i]);break;case"view":BR(o,[a],[i]);break}return 0}).command("text",(t,e)=>{const n=e.map(Je).join("");return CC(t,n),0}).command("hyperlink",(t,e)=>{const[n,r,...s]=e,i=Je(n),o=Je(r);return LC(t,i,o,s),0}),We={book:"",board:"",object:"",terrain:"",charset:"",palette:"",cursor:""};function py(t){const e=t.toLowerCase();switch(e){case"modbook":case"modboard":case"modobject":case"modterrain":case"modcharset":case"modpalette":return e.replace("mod","")}}function xC(){const[t]=jn([We.book]);if(g(t))return t;const[e]=jn(Gr());if(g(e))return e}function UC(t,e,n){const r=xC();if(!g(r))return;if(t==="book"){switch(e){case"name":z(n)&&(r.name=n);break;default:return!1}return wt("mods",`wrote ${n} to ${e} on book ${r.id}`)}const s=fr(r,We[t]),i=Ms(s),o=(s==null?void 0:s.id)??"";switch(Ls(s)){case be.BOARD:{const a=zt(s);g(a)&&hE(a,e,n);break}case be.OBJECT:{const a=zt(s);if(g(a))switch(e){case"char":case"color":case"bg":a[e]=n;break;case"cycle":Ia(a,"cycle",n);break;default:return!1}break}case be.TERRAIN:{const a=zt(s);if(g(a))switch(e){case"char":case"color":case"bg":a[e]=n;break;default:return!1}break}case be.CHARSET:{zt(s);break}case be.PALETTE:{zt(s);break}default:return!1}return wt("mods",`wrote ${n} to ${e} on ${i} ${o}`)}const PC=Xt({get(t,e){const n=py(e);return g(n)?[!0,We[n]]:[!1,void 0]},set(t,e,n){const r=py(e);return g(r)?(We[r]=n,[wt("mods",`wrote ${n} to ${e}`),We[r]]):[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("mod",(t,e)=>{const[n,r,s]=R(I(t,e),0,[k.STRING,k.MAYBE_NUMBER_OR_STRING,k.MAYBE_NUMBER_OR_STRING]);let i="",o;switch(n.toLowerCase()){case"book":We.cursor="book",i=r,o=s;break;case"board":We.cursor="board",i=r,o=s;break;case"object":We.cursor="object",i=r,o=s;break;case"terrain":We.cursor="terrain",i=r,o=s;break;case"charset":We.cursor="charset",i=r,o=s;break;case"palette":We.cursor="palette",i=r,o=s;break;default:i=n,o=r;break}return We.cursor&&wt("mods",`selected ${We.cursor} - ${i??""} ${o??""}`),We.cursor&&z(i)&&g(o)&&UC(We.cursor,i,o),0}),gy=new Set(["cycle","player","sender","inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu","data"]),DC=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),$C=["NORTH","SOUTH","WEST","EAST"];function BC(t){const e=q(t.id??"");if(e.inputcurrent!==void 0)return;const[n=me.NONE]=e.inputqueue;t.stats===void 0&&(t.stats={}),t.stats.inputmove=[],t.stats.inputok=0,t.stats.inputcancel=0,t.stats.inputmenu=0;const r=e.inputmods[n];switch(t.stats.inputalt=r&B_?1:0,t.stats.inputctrl=r&F_?1:0,t.stats.inputshift=r&j_?1:0,n){case me.MOVE_UP:case me.MOVE_DOWN:case me.MOVE_LEFT:case me.MOVE_RIGHT:t.stats.inputmove=[$C[n-me.MOVE_UP]];break;case me.OK_BUTTON:t.stats.inputok=1;break;case me.CANCEL_BUTTON:t.stats.inputcancel=1;break;case me.MENU_BUTTON:t.stats.inputmenu=1;break}e.inputcurrent=n,e.inputqueue.delete(n)}function ns(t,e,n,r){const s=z(e)?e:e.id,i=z(e)?void 0:{x:e.x??0,y:e.y??0},o=z(n)?n:n.id,a=s??i;g(o)&&g(a)&&t.send(o,r,a)}function my(t,e,n,r){g(n==null?void 0:n.id)?(n.headless=!0,fo(t,e,n)):Vu(e,r,"empty")}function yy(t,e,n,r,s){const i=CR(e,n,r,s);if(g(i)){ns(t,i,t.id(),"thud"),r.kind==="player"?ns(t,t.id(),i,"touch"):r.collision===Me.ISBULLET?ns(t,t.id(),i,"shot"):ns(t,t.id(),i,"bump");const o=It(e,i);return(i.destructible??(o==null?void 0:o.destructible))&&my(e,n,i,s),!1}return!0}function ru(t,e){if(z(t)){const n=t.toLowerCase();switch(n){case"edit":return[n,e+1]}}return[void 0,e]}function su(t,e,n){let r;const s=go((e==null?void 0:e.id)??"");switch(n){case"edit":{r=s.find(a=>a.type===Us.EDIT);break}}const[i]=r?jn((r==null?void 0:r.book)??[]):[t],[o]=r?Hc(i,(r==null?void 0:r.board)??[]):[e];return{maybebook:i,maybeboard:o}}const FC=Xt({get(t,e){var i;const n=q(t.id());if(n.object){DC.has(e)&&BC(n.object);const o=(i=n.object.stats)==null?void 0:i[e];if(g(o)||gy.has(e))return[!0,o]}const r=n.board?xa(n.board,n.object):void 0,s=dp(n.book,(r==null?void 0:r.id)??"",e);return[g(s),s]},set(t,e,n){var i,o;const r=q(t.id());if(g(r.object)&&(g((o=(i=r.object)==null?void 0:i.stats)==null?void 0:o[e])||gy.has(e)))return r.object.stats||(r.object.stats={}),r.object.stats[e]=n,[!0,n];const s=r.board?xa(r.board,r.object):void 0;return pp(r.book,(s==null?void 0:s.id)??"",e,n),[!0,n]},shouldtick(t,e){var r,s,i,o,a,c;const n=q(t.id());!e||!g((r=n.object)==null?void 0:r.x)||!g((s=n.object)==null?void 0:s.y)||!g((o=(i=n.object)==null?void 0:i.stats)==null?void 0:o.stepx)||!g((c=(a=n.object)==null?void 0:a.stats)==null?void 0:c.stepy)||yy(t,n.book,n.board,n.object,{x:n.object.x+n.object.stats.stepx,y:n.object.y+n.object.stats.stepy})||Na(n.object,{stepx:0,stepy:0})},tick(){},tock(t){var n;(n=q(t.id()).object)!=null&&n.headless&&t.command("die")}}).command("become",(t,e)=>{var i,o;const n=q(t.id()),r={x:((i=n.object)==null?void 0:i.x)??0,y:((o=n.object)==null?void 0:o.y)??0},[s]=R(I(t,e),0,[k.KIND]);return xs(n.book,n.board),fo(n.book,n.board,n.object),zc(n.book,n.object,t.timestamp())&&po(n.book,n.board,s,r),t.endofprogram(),0}).command("bind",()=>0).command("change",(t,e)=>{const n=q(t.id()),[r,s]=ru(e[0],0),[i,o]=R(I(t,e),s,[k.KIND,k.KIND]),{maybebook:a,maybeboard:c}=su(n.book,n.board,r);xs(a,c);const l=Da(i)??"",u=ka(c,l),h=iE(u,i),d=Da(o),f=ah(o),p=ch(o);return h.forEach(_=>{if(jr(a,_)===d)g(f)&&(_.color=f),g(p)&&(_.bg=p);else{if(g(_.id))switch(fo(a,c,_),r){case"edit":if(!Ma(c,_.id))return;break;default:if(!zc(a,_,t.timestamp()))return;break}Dt(_)&&po(a,c,o,_)}}),0}).command("char",(t,e)=>{const n=q(t.id()),[r]=R(I(t,e),0,[k.NUMBER]);return g(n.object)&&(n.object.char=r),0}).command("color",(t,e)=>{const n=q(t.id()),[r]=R(I(t,e),0,[k.COLOR]);return g(n.object)&&g(r)&&bi(n.object,r),0}).command("cycle",(t,e)=>{const n=q(t.id());if(g(n.object)){const[r]=R(I(t,e),0,[k.NUMBER]),s=rr(Math.round(r),1,255);Ia(n.object,"cycle",s)}return 0}).command("die",t=>{var n;const e=q(t.id());return(n=e.object)!=null&&n.headless&&fo(e.book,e.board,e.object),zc(e.book,e.object,t.timestamp()),t.endofprogram(),0}).command("endgame",t=>(t.set("health",0),0)).command("go",(t,e)=>{const n=q(t.id());if(!g(n.object))return 1;const[r]=R(I(t,e),0,[k.DIR]);return yy(t,n.book,n.board,n.object,r),n.object.x!==r.x&&n.object.y!==r.y?1:0}).command("put",(t,e)=>{const n=q(t.id()),[r,s]=ru(e[0],0),[i,o]=R(I(t,e),s,[k.DIR,k.KIND]),{maybebook:a,maybeboard:c}=su(n.book,n.board,r);return xs(a,c),po(a,c,o,i),0}).command("send",(t,e)=>{var h,d;const n=q(t.id()),[r,s]=R(I(t,e),0,[k.STRING,k.ANY]),[i,o]=r.split(":"),a=g(o)?i:"self",c=o??i;function l(f){f.forEach(p=>{g(p.id)&&t.send(p.id,c,s)})}const u=a.toLowerCase();switch(u){case"all":for(const f of Object.keys(((h=n.board)==null?void 0:h.objects)??{}))t.send(f,c,s);break;case"self":t.message({id:Et(),sender:t.id(),target:c,data:s});break;case"others":for(const f of Object.keys(((d=n.board)==null?void 0:d.objects)??{}))f!==t.id()&&t.send(f,c,s);break;case"player":break;default:{l(Ra(n.board,[a]));const f=t.get(u);ge(f)?l(Ra(n.board,f)):l(Ra(n.board,[f]));break}}return 0}).command("shoot",(t,e)=>{const n=q(t.id());if(!Dt(n.object))return 0;const[r,s]=ru(e[0],0),[i,o]=R(I(t,e),s,[k.DIR,k.MAYBE_KIND]),{maybebook:a,maybeboard:c}=su(n.book,n.board,r),l=xn(n.object,i),u=at({x:0,y:0},l),h=at({x:n.object.x,y:n.object.y},l);xs(a,c);let d=dE(c,h);if(g(d)&&!g(d.id)){const f=It(a,n.object),p=It(a,d);Fu(d.collision??(f==null?void 0:f.collision),d.collision??(p==null?void 0:p.collision))||(d=void 0)}if(g(d)){g(d.id)&&ns(t,t.id(),d,"shot");const f=It(a,d);(d.destructible??(f==null?void 0:f.destructible))&&my(a,c,d,h);const p=UR(a,c,o??["bullet"],h);g(p)&&(p.collision=Me.ISBULLET,ns(t,d,t.id(),"thud"))}else{const f=po(a,c,o??["bullet"],h);g(f)&&(f.collision=Me.ISBULLET,Na(f,{stepx:u.x,stepy:u.y}))}return t.yield(),0}).command("throwstar",(t,e)=>t.command("shoot",...e,"star")?1:0).command("try",(t,e)=>{const[,n]=R(I(t,e),0,[k.DIR]);return t.command("go",...e)&&n<e.length&&t.command(...e.slice(n)),t.yield(),0}).command("walk",(t,e)=>{const n=q(t.id());if(!Dt(n.object))return 0;const[r]=R(I(t,e),0,[k.DIR]),s=xn(n.object,r),i=at({x:0,y:0},s);return Na(n.object,{stepx:i.x,stepy:i.y}),0}).command("stat",(t,e)=>{const n=q(t.id());return n.object&&(n.object.name=e.map(Je).join(" ")),0}),jC=Xt({get(t,e){return[!1,void 0]},set(t,e,n){return[!1,void 0]},shouldtick(t,e){},tick(t){},tock(t){}}).command("stub",(t,e)=>0),GC=Xt({get(t,e){return[!1,void 0]},set(t,e,n){return[!1,void 0]},shouldtick(t,e){},tick(t){},tock(t){}}).command("stub",(t,e)=>0),KC={all:fO,audio:dO,board:pO,charset:gO,cli:wC,gadget:MC,mods:PC,object:FC,palette:jC,terrain:GC},WC={[be.ERROR]:[],[be.CLI]:["all","audio","mods","cli"],[be.BOARD]:["all","audio","gadget","mods","board"],[be.OBJECT]:["all","audio","gadget","mods","object"],[be.TERRAIN]:["all","audio","gadget","mods","terrain"],[be.CHARSET]:["all","audio","gadget","mods","charset"],[be.PALETTE]:["all","audio","gadget","mods","palette"]};function HC(t,e){(WC[e]??[]).forEach(r=>t.install(KC[r]))}function iu(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];ge(r)?r.forEach(s=>{e.push(iu(s))}):e.push(iu(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function VC(t){const e=jc(`${t}
`);if(e.errors.length>0)return e;Gs.input=e.tokens;const n=Gs.program();if(Gs.errors.length>0)return{tokens:e.tokens,errors:Gs.errors.map(s=>({offset:s.token.startOffset,line:s.token.startLine,column:s.token.startColumn,length:s.token.image.length,message:s.message}))};const r=Z0.visit(n);return r?(iu(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const ou=Object.getPrototypeOf(function*(){}).constructor;function zC(t,e){nO(t);const n=VC(e);if(n.errors&&n.errors.length>0)return n;if(!n.ast)return{...n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const r=aO(n.ast);if(r.code){lR&&console.info(r.code);try{return{...n,...r,source:r.code,code:new ou("api",r.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new ou("api"," ")}}}return{...n,...r,source:"",code:new ou("api"," ")}}function YC(){const t={},e={};function n(s,i){const o=t[i];if(o)return o;const a=zC(s,i);return t[i]=a,a}const r={ids(){return Object.keys(e)},has(s){return g(e[s])},halt(s){const i=e[s];return i&&delete e[s],!!i},tick(s,i,o,a,c,l){var h;let u=e[s];if(!g(e[s])){const d=n(c,l);if(u=e[s]=uO(s,d),(h=d.errors)!=null&&h.length){const[f]=d.errors,p=((f==null?void 0:f.line)??2)-1,_=l.replaceAll(`\r
`,"").split(`
`);return f.message.split(`
`).forEach(S=>{un("os","build",S)}),_.forEach((S,T)=>{if(T===p){const E=(f.column??1)-1,A=E+f.length,O=S.substring(0,E),w=S.substring(E,A),m=S.substring(A);un("os","build",`$grey${O}$red${w}$grey${m}`)}else un("os","build",`$grey${S}`)}),!1}HC(u,i)}return!!(u!=null&&u.tick(o,a))},once(s,i,o,a,c){return r.tick(s,i,1,o,a,c)&&r.halt(s)},message(s){const{target:i,path:o}=wu(s.target),a=e[i];if(g(a)){const c={...s,target:o};a.message(c)}}};return r}const au=Hy();$R(au);const cu=YC();let lu=0;const qC=32,rs={},XC=64;let _y=0;const Cn={},ss={},Ut=as("vm",["tick","second"],t=>{var e;switch(t.target){case"books":if(t.data.every(C_)&&t.player===au&&ge(t.data)===!0){const n=t.data,r=n.map(s=>s.name);jR(n),wt(Ut.name(),"reset by",t.sender,"with",...r,t.player),G_(Ut.name(),t.player)}break;case"login":if(t.player)if(WR(t.player))rs[t.player]=0,wt(Ut.name(),"player login",t.player);else{const[n]=jn(Gr());g(n)?X_(Ut.name()):K_(Ut.name(),t.player)}break;case"doot":t.player&&(rs[t.player]=0,Du(Ut.name(),"active",t.player));break;case"input":if(t.player){const n=q(t.player),[r=me.NONE,s=0]=t.data??{};n.inputqueue.add(r),n.inputmods[r]=s}break;case"codewatch":if(t.player&&ge(t.data)){const[n,r]=t.data;if(!g(ss[r])){const s=$u(n,r);ss[r]=sy(s,i=>{const o=fr(Yt(n),r);g(o)&&(o.code=i,bR(o))})}Cn[n]=Cn[n]??{},Cn[n][r]=Cn[n][r]??new Set,Cn[n][r].add(t.player)}break;case"coderelease":if(t.player&&ge(t.data)){const[n,r]=t.data;g(Cn[n])&&g(Cn[n][r])&&(Cn[n][r].delete(t.player),Cn[n][r].size===0&&((e=ss[r])==null||e.call(ss),ss[r]=void 0))}break;case"tick":lu=t.data??0,VR(cu,lu);break;case"second":Object.keys(rs).forEach(n=>{++rs[n],rs[n]>=qC&&(delete rs[n],HR(n),wt(Ut.name(),"player logout",n),Ut.emit("logout",void 0,n))}),++_y>=XC&&Aa(Ut.name());break;case"flush":{_y=0;const n=Kr().map(TR);bu.trimUndefinedRecursively(n),V_(Ut.name(),n);break}case"cli":zR(cu,lu,t.player??"",t.data??"");break;default:cu.message(t);break}});function JC(){Ut.emit("ready",void 0,au)}const uu=as("clock",[],()=>{});let hu=0,Ey=performance.now(),fu=0,ra=0;function QC(){uu.emit("tick",ra),uu.emit("tock",ra),++fu,++ra,fu>=Fa&&(fu%=Fa,uu.emit("second",ra))}function wy(){const t=performance.now(),e=t-Ey;hu+=e,hu>=Ba&&(hu%=Ba,QC()),Ey=t,setTimeout(wy)}wy();const by={},Sy=as("gadgetserver",["tock"],t=>{switch(t.target){case"tock":RC().forEach(e=>{const n=vr(e);n.layers=qR(e);const r=Ta(by[e]??{},n);r.length&&(by[e]=De(n),H_(Sy.name(),r,e))});break;case"desync":if(t.player){const e=vr(t.player);W_(Sy.name(),e,t.player)}break;case"clearscroll":t.player&&OC(t.player);break}}),ZC=Yy(t=>postMessage(t));onmessage=function(e){ZC(e.data)},queueMicrotask(JC)})();

var JI=Object.defineProperty;var QI=(Dt,We,Tn)=>We in Dt?JI(Dt,We,{enumerable:!0,configurable:!0,writable:!0,value:Tn}):Dt[We]=Tn;var F=(Dt,We,Tn)=>(QI(Dt,typeof We!="symbol"?We+"":We,Tn),Tn);(function(){"use strict";const Dt=new Set,We={emit(t,e,n,r){We.invoke(Zp(t,e,n,r))},invoke(t){Dt.forEach(e=>e.handle(t))},connect(t){Dt.add(t)},disconnect(t){Dt.delete(t)}},Tn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Xp=t=>crypto.getRandomValues(new Uint8Array(t)),Jp=(t,e,n)=>{let r=(2<<Math.log(t.length-1)/Math.LN2)-1,s=-~(1.6*r*e/t.length);return(i=e)=>{let o="";for(;;){let a=n(s),c=s;for(;c--;)if(o+=t[a[c]&r]||"",o.length===i)return o}}},Cc=(t,e=21)=>Jp(t,e,Xp),Qp=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=Tn[n[t]&63];return e};function Ft(){return Qp()}function Zp(t,e,n,r){return{id:Ft(),target:t,sender:e,data:n,player:r}}function bc(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function vr(t,e,n){const r=Ft(),s=t.toLowerCase(),i=e.map(a=>a.toLowerCase()),o={id(){return r},name(){return t},tags(){return e},emit(a,c,l){We.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=bc(a.target),u=c.toLowerCase();i.findIndex(h=>h==="all"||h===u)!==-1&&n(a),(r===c||u==="all"||s===u)&&n({...a,target:l})}};return We.connect(o),o}function eg(t){const e=new Set;function n(r){e.has(r.id)||(e.add(r.id),We.invoke(r))}return vr("forward",["all"],r=>{e.has(r.id)||(e.add(r.id),t(r))}),n}var vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function no(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function tg(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var kc="abcdefghijklmnopqrstuvwxyz",Mc="ABCDEFGHIJKLMNOPQRSTUVWXYZ",xc="0123456789",ng="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",rg="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const sg=xc,ig=kc,og=Mc;var ag=sg+ig+og,ro={lowercase:kc,uppercase:Mc,numbers:xc,nolookalikes:ng,nolookalikesSafe:rg,alphanumeric:ag};const Uc=32,cg=33;function Ns(t,e){return new Array(t).fill(e)}function lg(t,e,n,r,s=0){const i=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:Ns(i,0),color:Ns(i,0),bg:Ns(i,s)}}function ug(t,e,n,r=1,s=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:s,bg:Uc}}function hg(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function fg(t,e,n,r,s=0){const i=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:Ns(i,s)}}function dg(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:2}}var Qe=(t=>(t[t.START=0]="START",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.SCROLL=5]="SCROLL",t))(Qe||{});const pg={start:0,left:1,right:2,top:3,bottom:4,scroll:5},gg={0:1,1:20,2:20,3:1,4:1,5:40},mg=1,Eg=16,_g=256;var fe=(t=>(t[t.NONE=0]="NONE",t[t.MOVE_UP=1]="MOVE_UP",t[t.MOVE_DOWN=2]="MOVE_DOWN",t[t.MOVE_LEFT=3]="MOVE_LEFT",t[t.MOVE_RIGHT=4]="MOVE_RIGHT",t[t.OK_BUTTON=5]="OK_BUTTON",t[t.CANCEL_BUTTON=6]="CANCEL_BUTTON",t[t.MENU_BUTTON=7]="MENU_BUTTON",t))(fe||{}),Pc={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(vs,function(){return n.importState=function(s){var i=new n;return i.importState(s),i},n;function n(){return function(s){var i=0,o=0,a=0,c=1;s.length==0&&(s=[+new Date]);var l=r();i=l(" "),o=l(" "),a=l(" ");for(var u=0;u<s.length;u++)i-=l(s[u]),i<0&&(i+=1),o-=l(s[u]),o<0&&(o+=1),a-=l(s[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*i+c*23283064365386963e-26;return i=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=s,h.exportState=function(){return[i,o,a,c]},h.importState=function(d){i=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,i=function(o){o=o.toString();for(var a=0;a<o.length;a++){s+=o.charCodeAt(a);var c=.02519603282416938*s;s=c>>>0,c-=s,c*=s,s=c>>>0,c-=s,s+=c*4294967296}return(s>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})})(Pc);var yg=Pc.exports,Tg=no(yg);const Sg=Tg("089fad0j9awfem09wavefc09uwaef");function so(t,e,n){return Math.max(e,Math.min(n,t))}function Ag(){return Sg()}function Hn(t,e){const n=Math.min(t,e),s=Math.max(t,e)-n+1;return n+Math.floor(Ag()*s)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var wg=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)s.hasOwnProperty(i)&&(r[i]=s[i])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Rg=Object.prototype.hasOwnProperty;function io(t,e){return Rg.call(t,e)}function oo(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var s in t)io(t,s)&&r.push(s);return r}function ke(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function ao(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Sn(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Dc(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function co(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(co(t[e]))return!0}else if(typeof t=="object"){for(var r=oo(t),s=r.length,i=0;i<s;i++)if(co(t[r[i]]))return!0}}return!1}function Fc(t,e){var n=[t];for(var r in e){var s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&n.push(r+": "+s)}return n.join(`
`)}var $c=function(t){wg(e,t);function e(n,r,s,i,o){var a=this.constructor,c=t.call(this,Fc(n,{name:r,index:s,operation:i,tree:o}))||this;return c.name=r,c.index=s,c.operation=i,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Fc(n,{name:r,index:s,operation:i,tree:o}),c}return e}(Error),se=$c,vg=ke,Vn={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=Os(n,this.path);r&&(r=ke(r));var s=An(n,{op:"remove",path:this.from}).removed;return An(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=Os(n,this.from);return An(n,{op:"add",path:this.path,value:ke(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:Nr(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},Ng={add:function(t,e,n){return ao(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:Vn.move,copy:Vn.copy,test:Vn.test,_get:Vn._get};function Os(t,e){if(e=="")return t;var n={op:"_get",path:e};return An(t,n),n.value}function An(t,e,n,r,s,i){if(n===void 0&&(n=!1),r===void 0&&(r=!0),s===void 0&&(s=!0),i===void 0&&(i=0),n&&(typeof n=="function"?n(e,0,t,e.path):Is(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=Os(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=Nr(t,e.value),o.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new se("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,t);return o}}else{r||(t=ke(t));var a=e.path||"",c=a.split("/"),l=t,u=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=Is;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=Dc(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!ao(f))throw new se("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,t);ao(f)&&(f=~~f)}if(u>=h){if(n&&e.op==="add"&&f>l.length)throw new se("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,t);var o=Ng[e.op].call(e,l,f,t);if(o.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return o}}else if(u>=h){var o=Vn[e.op].call(e,l,f,t);if(o.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new se("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,t)}}}function lo(t,e,n,r,s){if(r===void 0&&(r=!0),s===void 0&&(s=!0),n&&!Array.isArray(e))throw new se("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=ke(t));for(var i=new Array(e.length),o=0,a=e.length;o<a;o++)i[o]=An(t,e[o],n,!0,s,o),t=i[o].newDocument;return i.newDocument=t,i}function Og(t,e,n){var r=An(t,e);if(r.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function Is(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new se("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(Vn[t.op]){if(typeof t.path!="string")throw new se("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new se('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new se("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new se("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&co(t.value))throw new se("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var s=t.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new se("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new se("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Bc([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new se("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new se("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Bc(t,e,n){try{if(!Array.isArray(t))throw new se("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)lo(ke(e),ke(t),n||!0);else{n=n||Is;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(s){if(s instanceof se)return s;throw s}}function Nr(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),s,i,o;if(n&&r){if(i=t.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!Nr(t[s],e[s]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(i=a.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(a[s]))return!1;for(s=i;s--!==0;)if(o=a[s],!Nr(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var Ig=Object.freeze({__proto__:null,JsonPatchError:se,_areEquals:Nr,applyOperation:An,applyPatch:lo,applyReducer:Og,deepClone:vg,getValueByPointer:Os,validate:Bc,validator:Is});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var uo=new WeakMap,Lg=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),Cg=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function bg(t){return uo.get(t)}function kg(t,e){return t.observers.get(e)}function Mg(t,e){t.observers.delete(e.callback)}function xg(t,e){e.unobserve()}function Ug(t,e){var n=[],r,s=bg(t);if(!s)s=new Lg(t),uo.set(t,s);else{var i=kg(s,e);r=i&&i.observer}if(r)return r;if(r={},s.value=ke(t),e){r.callback=e,r.next=null;var o=function(){ho(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){ho(r),clearTimeout(r.next),Mg(s,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},s.observers.set(e,new Cg(e,r)),r}function ho(t,e){e===void 0&&(e=!1);var n=uo.get(t.object);fo(n.value,t.object,t.patches,"",e),t.patches.length&&lo(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function fo(t,e,n,r,s){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=oo(e),o=oo(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(io(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?fo(u,h,n,r+"/"+Sn(l),s):u!==h&&(s&&n.push({op:"test",path:r+"/"+Sn(l),value:ke(u)}),n.push({op:"replace",path:r+"/"+Sn(l),value:ke(h)}))}else Array.isArray(t)===Array.isArray(e)?(s&&n.push({op:"test",path:r+"/"+Sn(l),value:ke(u)}),n.push({op:"remove",path:r+"/"+Sn(l)}),a=!0):(s&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&i.length==o.length))for(var c=0;c<i.length;c++){var l=i[c];!io(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+Sn(l),value:ke(e[l])})}}}function po(t,e,n){n===void 0&&(n=!1);var r=[];return fo(t,e,r,"",n),r}var Pg=Object.freeze({__proto__:null,compare:po,generate:ho,observe:Ug,unobserve:xg});Object.assign({},Ig,Pg,{JsonPatchError:$c,deepClone:ke,escapePathComponent:Sn,unescapePathComponent:Dc});function P(t){return t!==void 0}function L(t){return t!=null}function Dg(t,e){return po(t,e).length===0}function Fg(t){return ke(t)}function Ke(t){return typeof t=="number"}function Ne(t){return typeof t=="string"}function $t(t){return Array.isArray(t)}function $g(t){return t}function go(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],s=Math.min(t,e),i=Math.max(t,e);for(let o=s;o<=i;o+=n)r.push(o);return r}function Bg(t){return t[Hn(0,t.length-1)]}function Bt(...t){return Bg(t.flat())}function Gg(t){return[...new Set(t)].filter(P)}const Wg=Symbol(),Gc=Object.getPrototypeOf,mo=new WeakMap,Kg=t=>t&&(mo.has(t)?mo.get(t):Gc(t)===Object.prototype||Gc(t)===Array.prototype),jg=t=>Kg(t)&&t[Wg]||null,Wc=(t,e=!0)=>{mo.set(t,e)};var Kc={ZSS_LANG_DEV:"false",ZSS_STATS_DEV:"false",ZSS_SHOW_CODE:"false",ZSS_BRANCH_NAME:"main",ZSS_BRANCH_VERSION:"0.0.6",ZSS_COMMIT_HASH:"f7a38e1d4e172740eb7f7bab764d17e95dae0373",ZSS_COMMIT_MESSAGE:"ci: version bump to v0.0.6",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Eo=t=>typeof t=="object"&&t!==null,Yn=new WeakMap,Or=new WeakSet,Hg=(t=Object.is,e=(l,u)=>new Proxy(l,u),n=l=>Eo(l)&&!Or.has(l)&&(Array.isArray(l)||!(Symbol.iterator in l))&&!(l instanceof WeakMap)&&!(l instanceof WeakSet)&&!(l instanceof Error)&&!(l instanceof Number)&&!(l instanceof Date)&&!(l instanceof String)&&!(l instanceof RegExp)&&!(l instanceof ArrayBuffer),r=l=>{switch(l.status){case"fulfilled":return l.value;case"rejected":throw l.reason;default:throw l}},s=new WeakMap,i=(l,u,h=r)=>{const d=s.get(l);if((d==null?void 0:d[0])===u)return d[1];const f=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l));return Wc(f,!0),s.set(l,[u,f]),Reflect.ownKeys(l).forEach(p=>{if(Object.getOwnPropertyDescriptor(f,p))return;const m=Reflect.get(l,p),{enumerable:A}=Reflect.getOwnPropertyDescriptor(l,p),S={value:m,enumerable:A,configurable:!0};if(Or.has(m))Wc(m,!1);else if(m instanceof Promise)delete S.value,S.get=()=>h(m);else if(Yn.has(m)){const[y,w]=Yn.get(m);S.value=i(y,w(),h)}Object.defineProperty(f,p,S)}),Object.preventExtensions(f)},o=new WeakMap,a=[1,1],c=l=>{if(!Eo(l))throw new Error("object required");const u=o.get(l);if(u)return u;let h=a[0];const d=new Set,f=(R,I=++a[0])=>{h!==I&&(h=I,d.forEach(k=>k(R,I)))};let p=a[1];const m=(R=++a[1])=>(p!==R&&!d.size&&(p=R,S.forEach(([I])=>{const k=I[1](R);k>h&&(h=k)})),h),A=R=>(I,k)=>{const ue=[...I];ue[1]=[R,...ue[1]],f(ue,k)},S=new Map,y=(R,I)=>{if((Kc?"production":void 0)!=="production"&&S.has(R))throw new Error("prop listener already exists");if(d.size){const k=I[3](A(R));S.set(R,[I,k])}else S.set(R,[I])},w=R=>{var I;const k=S.get(R);k&&(S.delete(R),(I=k[1])==null||I.call(k))},E=R=>(d.add(R),d.size===1&&S.forEach(([k,ue],te)=>{if((Kc?"production":void 0)!=="production"&&ue)throw new Error("remove already exists");const Ce=k[3](A(te));S.set(te,[k,Ce])}),()=>{d.delete(R),d.size===0&&S.forEach(([k,ue],te)=>{ue&&(ue(),S.set(te,[k]))})}),T=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l)),_=e(T,{deleteProperty(R,I){const k=Reflect.get(R,I);w(I);const ue=Reflect.deleteProperty(R,I);return ue&&f(["delete",[I],k]),ue},set(R,I,k,ue){const te=Reflect.has(R,I),Ce=Reflect.get(R,I,ue);if(te&&(t(Ce,k)||o.has(k)&&t(Ce,o.get(k))))return!0;w(I),Eo(k)&&(k=jg(k)||k);let ve=k;if(k instanceof Promise)k.then(Ge=>{k.status="fulfilled",k.value=Ge,f(["resolve",[I],Ge])}).catch(Ge=>{k.status="rejected",k.reason=Ge,f(["reject",[I],Ge])});else{!Yn.has(k)&&n(k)&&(ve=c(k));const Ge=!Or.has(ve)&&Yn.get(ve);Ge&&y(I,Ge)}return Reflect.set(R,I,ve,ue),f(["set",[I],k,Ce]),!0}});o.set(l,_);const v=[T,m,i,E];return Yn.set(_,v),Reflect.ownKeys(l).forEach(R=>{const I=Object.getOwnPropertyDescriptor(l,R);"value"in I&&(_[R]=l[R],delete I.value,delete I.writable),Object.defineProperty(T,R,I)}),_})=>[c,Yn,Or,t,e,n,r,s,i,o,a],[Vg]=Hg();function Yg(t={}){return Vg(t)}function jc(t){return Or.add(t),t}var Hc={exports:{}},W={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ir=Symbol.for("react.element"),zg=Symbol.for("react.portal"),qg=Symbol.for("react.fragment"),Xg=Symbol.for("react.strict_mode"),Jg=Symbol.for("react.profiler"),Qg=Symbol.for("react.provider"),Zg=Symbol.for("react.context"),em=Symbol.for("react.forward_ref"),tm=Symbol.for("react.suspense"),nm=Symbol.for("react.memo"),rm=Symbol.for("react.lazy"),Vc=Symbol.iterator;function sm(t){return t===null||typeof t!="object"?null:(t=Vc&&t[Vc]||t["@@iterator"],typeof t=="function"?t:null)}var Yc={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},zc=Object.assign,qc={};function zn(t,e,n){this.props=t,this.context=e,this.refs=qc,this.updater=n||Yc}zn.prototype.isReactComponent={},zn.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},zn.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Xc(){}Xc.prototype=zn.prototype;function _o(t,e,n){this.props=t,this.context=e,this.refs=qc,this.updater=n||Yc}var yo=_o.prototype=new Xc;yo.constructor=_o,zc(yo,zn.prototype),yo.isPureReactComponent=!0;var Jc=Array.isArray,Qc=Object.prototype.hasOwnProperty,To={current:null},Zc={key:!0,ref:!0,__self:!0,__source:!0};function el(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Qc.call(e,r)&&!Zc.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];s.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Ir,type:t,key:i,ref:o,props:s,_owner:To.current}}function im(t,e){return{$$typeof:Ir,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function So(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ir}function om(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var tl=/\/+/g;function Ao(t,e){return typeof t=="object"&&t!==null&&t.key!=null?om(""+t.key):e.toString(36)}function Ls(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ir:case zg:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Ao(o,0):r,Jc(s)?(n="",t!=null&&(n=t.replace(tl,"$&/")+"/"),Ls(s,e,n,"",function(l){return l})):s!=null&&(So(s)&&(s=im(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(tl,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Jc(t))for(var a=0;a<t.length;a++){i=t[a];var c=r+Ao(i,a);o+=Ls(i,e,n,c,s)}else if(c=sm(t),typeof c=="function")for(t=c.call(t),a=0;!(i=t.next()).done;)i=i.value,c=r+Ao(i,a++),o+=Ls(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Cs(t,e,n){if(t==null)return t;var r=[],s=0;return Ls(t,r,"","",function(i){return e.call(n,i,s++)}),r}function am(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Me={current:null},bs={transition:null},cm={ReactCurrentDispatcher:Me,ReactCurrentBatchConfig:bs,ReactCurrentOwner:To};W.Children={map:Cs,forEach:function(t,e,n){Cs(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Cs(t,function(){e++}),e},toArray:function(t){return Cs(t,function(e){return e})||[]},only:function(t){if(!So(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},W.Component=zn,W.Fragment=qg,W.Profiler=Jg,W.PureComponent=_o,W.StrictMode=Xg,W.Suspense=tm,W.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cm,W.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=zc({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=To.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)Qc.call(e,c)&&!Zc.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:Ir,type:t.type,key:s,ref:i,props:r,_owner:o}},W.createContext=function(t){return t={$$typeof:Zg,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Qg,_context:t},t.Consumer=t},W.createElement=el,W.createFactory=function(t){var e=el.bind(null,t);return e.type=t,e},W.createRef=function(){return{current:null}},W.forwardRef=function(t){return{$$typeof:em,render:t}},W.isValidElement=So,W.lazy=function(t){return{$$typeof:rm,_payload:{_status:-1,_result:t},_init:am}},W.memo=function(t,e){return{$$typeof:nm,type:t,compare:e===void 0?null:e}},W.startTransition=function(t){var e=bs.transition;bs.transition={};try{t()}finally{bs.transition=e}},W.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},W.useCallback=function(t,e){return Me.current.useCallback(t,e)},W.useContext=function(t){return Me.current.useContext(t)},W.useDebugValue=function(){},W.useDeferredValue=function(t){return Me.current.useDeferredValue(t)},W.useEffect=function(t,e){return Me.current.useEffect(t,e)},W.useId=function(){return Me.current.useId()},W.useImperativeHandle=function(t,e,n){return Me.current.useImperativeHandle(t,e,n)},W.useInsertionEffect=function(t,e){return Me.current.useInsertionEffect(t,e)},W.useLayoutEffect=function(t,e){return Me.current.useLayoutEffect(t,e)},W.useMemo=function(t,e){return Me.current.useMemo(t,e)},W.useReducer=function(t,e,n){return Me.current.useReducer(t,e,n)},W.useRef=function(t){return Me.current.useRef(t)},W.useState=function(t){return Me.current.useState(t)},W.useSyncExternalStore=function(t,e,n){return Me.current.useSyncExternalStore(t,e,n)},W.useTransition=function(){return Me.current.useTransition()},W.version="18.2.0",Hc.exports=W;var lm=Hc.exports;function um(t,e){var r,s;return[...((s=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:s.values())??[]].map(i=>typeof i=="string"?t==null?void 0:t.objects[i]:t==null?void 0:t.terrain[i])}function hm(t,e,n){let r=0,s;for(let i=0;i<n.length;++i){const o=n[i];if(o){const a=e.x-(o.x??0),c=e.y-(o.y??0),l=Math.sqrt(a*a+c*c);(s===void 0||l<r)&&(r=l,s=o)}}return s}var nl=typeof global=="object"&&global&&global.Object===Object&&global,fm=typeof self=="object"&&self&&self.Object===Object&&self,yt=nl||fm||Function("return this")(),Ze=yt.Symbol,rl=Object.prototype,dm=rl.hasOwnProperty,pm=rl.toString,Lr=Ze?Ze.toStringTag:void 0;function gm(t){var e=dm.call(t,Lr),n=t[Lr];try{t[Lr]=void 0;var r=!0}catch{}var s=pm.call(t);return r&&(e?t[Lr]=n:delete t[Lr]),s}var mm=Object.prototype,Em=mm.toString;function _m(t){return Em.call(t)}var ym="[object Null]",Tm="[object Undefined]",sl=Ze?Ze.toStringTag:void 0;function rn(t){return t==null?t===void 0?Tm:ym:sl&&sl in Object(t)?gm(t):_m(t)}function at(t){return t!=null&&typeof t=="object"}var Sm="[object Symbol]";function ks(t){return typeof t=="symbol"||at(t)&&rn(t)==Sm}function Cr(t,e){for(var n=-1,r=t==null?0:t.length,s=Array(r);++n<r;)s[n]=e(t[n],n,t);return s}var V=Array.isArray,Am=1/0,il=Ze?Ze.prototype:void 0,ol=il?il.toString:void 0;function al(t){if(typeof t=="string")return t;if(V(t))return Cr(t,al)+"";if(ks(t))return ol?ol.call(t):"";var e=t+"";return e=="0"&&1/t==-Am?"-0":e}var wm=/\s/;function Rm(t){for(var e=t.length;e--&&wm.test(t.charAt(e)););return e}var vm=/^\s+/;function Nm(t){return t&&t.slice(0,Rm(t)+1).replace(vm,"")}function et(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var cl=NaN,Om=/^[-+]0x[0-9a-f]+$/i,Im=/^0b[01]+$/i,Lm=/^0o[0-7]+$/i,Cm=parseInt;function bm(t){if(typeof t=="number")return t;if(ks(t))return cl;if(et(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=et(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Nm(t);var n=Im.test(t);return n||Lm.test(t)?Cm(t.slice(2),n?2:8):Om.test(t)?cl:+t}var ll=1/0,km=17976931348623157e292;function Mm(t){if(!t)return t===0?t:0;if(t=bm(t),t===ll||t===-ll){var e=t<0?-1:1;return e*km}return t===t?t:0}function br(t){var e=Mm(t),n=e%1;return e===e?n?e-n:e:0}function qn(t){return t}var xm="[object AsyncFunction]",Um="[object Function]",Pm="[object GeneratorFunction]",Dm="[object Proxy]";function Gt(t){if(!et(t))return!1;var e=rn(t);return e==Um||e==Pm||e==xm||e==Dm}var wo=yt["__core-js_shared__"],ul=function(){var t=/[^.]+$/.exec(wo&&wo.keys&&wo.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Fm(t){return!!ul&&ul in t}var $m=Function.prototype,Bm=$m.toString;function wn(t){if(t!=null){try{return Bm.call(t)}catch{}try{return t+""}catch{}}return""}var Gm=/[\\^$.*+?()[\]{}|]/g,Wm=/^\[object .+?Constructor\]$/,Km=Function.prototype,jm=Object.prototype,Hm=Km.toString,Vm=jm.hasOwnProperty,Ym=RegExp("^"+Hm.call(Vm).replace(Gm,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function zm(t){if(!et(t)||Fm(t))return!1;var e=Gt(t)?Ym:Wm;return e.test(wn(t))}function qm(t,e){return t==null?void 0:t[e]}function Rn(t,e){var n=qm(t,e);return zm(n)?n:void 0}var Ro=Rn(yt,"WeakMap"),hl=Object.create,Xm=function(){function t(){}return function(e){if(!et(e))return{};if(hl)return hl(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function Jm(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function de(){}function Qm(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var Zm=800,eE=16,tE=Date.now;function nE(t){var e=0,n=0;return function(){var r=tE(),s=eE-(r-n);if(n=r,s>0){if(++e>=Zm)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function rE(t){return function(){return t}}var Ms=function(){try{var t=Rn(Object,"defineProperty");return t({},"",{}),t}catch{}}(),sE=Ms?function(t,e){return Ms(t,"toString",{configurable:!0,enumerable:!1,value:rE(e),writable:!0})}:qn,iE=sE,oE=nE(iE);function fl(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function dl(t,e,n,r){for(var s=t.length,i=n+(r?1:-1);r?i--:++i<s;)if(e(t[i],i,t))return i;return-1}function aE(t){return t!==t}function cE(t,e,n){for(var r=n-1,s=t.length;++r<s;)if(t[r]===e)return r;return-1}function vo(t,e,n){return e===e?cE(t,e,n):dl(t,aE,n)}function pl(t,e){var n=t==null?0:t.length;return!!n&&vo(t,e,0)>-1}var lE=9007199254740991,uE=/^(?:0|[1-9]\d*)$/;function xs(t,e){var n=typeof t;return e=e??lE,!!e&&(n=="number"||n!="symbol"&&uE.test(t))&&t>-1&&t%1==0&&t<e}function No(t,e,n){e=="__proto__"&&Ms?Ms(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function kr(t,e){return t===e||t!==t&&e!==e}var hE=Object.prototype,fE=hE.hasOwnProperty;function Us(t,e,n){var r=t[e];(!(fE.call(t,e)&&kr(r,n))||n===void 0&&!(e in t))&&No(t,e,n)}function Mr(t,e,n,r){var s=!n;n||(n={});for(var i=-1,o=e.length;++i<o;){var a=e[i],c=r?r(n[a],t[a],a,n,t):void 0;c===void 0&&(c=t[a]),s?No(n,a,c):Us(n,a,c)}return n}var gl=Math.max;function dE(t,e,n){return e=gl(e===void 0?t.length-1:e,0),function(){for(var r=arguments,s=-1,i=gl(r.length-e,0),o=Array(i);++s<i;)o[s]=r[e+s];s=-1;for(var a=Array(e+1);++s<e;)a[s]=r[s];return a[e]=n(o),Jm(t,this,a)}}function Oo(t,e){return oE(dE(t,e,qn),t+"")}var pE=9007199254740991;function Io(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=pE}function Tt(t){return t!=null&&Io(t.length)&&!Gt(t)}function Ps(t,e,n){if(!et(n))return!1;var r=typeof e;return(r=="number"?Tt(n)&&xs(e,n.length):r=="string"&&e in n)?kr(n[e],t):!1}function gE(t){return Oo(function(e,n){var r=-1,s=n.length,i=s>1?n[s-1]:void 0,o=s>2?n[2]:void 0;for(i=t.length>3&&typeof i=="function"?(s--,i):void 0,o&&Ps(n[0],n[1],o)&&(i=s<3?void 0:i,s=1),e=Object(e);++r<s;){var a=n[r];a&&t(e,a,r,i)}return e})}var mE=Object.prototype;function xr(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||mE;return t===n}function EE(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var _E="[object Arguments]";function ml(t){return at(t)&&rn(t)==_E}var El=Object.prototype,yE=El.hasOwnProperty,TE=El.propertyIsEnumerable,SE=ml(function(){return arguments}())?ml:function(t){return at(t)&&yE.call(t,"callee")&&!TE.call(t,"callee")},Ds=SE;function AE(){return!1}var _l=typeof exports=="object"&&exports&&!exports.nodeType&&exports,yl=_l&&typeof module=="object"&&module&&!module.nodeType&&module,wE=yl&&yl.exports===_l,Tl=wE?yt.Buffer:void 0,RE=Tl?Tl.isBuffer:void 0,vE=RE||AE,Ur=vE,NE="[object Arguments]",OE="[object Array]",IE="[object Boolean]",LE="[object Date]",CE="[object Error]",bE="[object Function]",kE="[object Map]",ME="[object Number]",xE="[object Object]",UE="[object RegExp]",PE="[object Set]",DE="[object String]",FE="[object WeakMap]",$E="[object ArrayBuffer]",BE="[object DataView]",GE="[object Float32Array]",WE="[object Float64Array]",KE="[object Int8Array]",jE="[object Int16Array]",HE="[object Int32Array]",VE="[object Uint8Array]",YE="[object Uint8ClampedArray]",zE="[object Uint16Array]",qE="[object Uint32Array]",Z={};Z[GE]=Z[WE]=Z[KE]=Z[jE]=Z[HE]=Z[VE]=Z[YE]=Z[zE]=Z[qE]=!0,Z[NE]=Z[OE]=Z[$E]=Z[IE]=Z[BE]=Z[LE]=Z[CE]=Z[bE]=Z[kE]=Z[ME]=Z[xE]=Z[UE]=Z[PE]=Z[DE]=Z[FE]=!1;function XE(t){return at(t)&&Io(t.length)&&!!Z[rn(t)]}function Pr(t){return function(e){return t(e)}}var Sl=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Dr=Sl&&typeof module=="object"&&module&&!module.nodeType&&module,JE=Dr&&Dr.exports===Sl,Lo=JE&&nl.process,sn=function(){try{var t=Dr&&Dr.require&&Dr.require("util").types;return t||Lo&&Lo.binding&&Lo.binding("util")}catch{}}(),Al=sn&&sn.isTypedArray,QE=Al?Pr(Al):XE,Co=QE,ZE=Object.prototype,e_=ZE.hasOwnProperty;function wl(t,e){var n=V(t),r=!n&&Ds(t),s=!n&&!r&&Ur(t),i=!n&&!r&&!s&&Co(t),o=n||r||s||i,a=o?EE(t.length,String):[],c=a.length;for(var l in t)(e||e_.call(t,l))&&!(o&&(l=="length"||s&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||xs(l,c)))&&a.push(l);return a}function Rl(t,e){return function(n){return t(e(n))}}var t_=Rl(Object.keys,Object),n_=Object.prototype,r_=n_.hasOwnProperty;function vl(t){if(!xr(t))return t_(t);var e=[];for(var n in Object(t))r_.call(t,n)&&n!="constructor"&&e.push(n);return e}function je(t){return Tt(t)?wl(t):vl(t)}var s_=Object.prototype,i_=s_.hasOwnProperty,He=gE(function(t,e){if(xr(e)||Tt(e)){Mr(e,je(e),t);return}for(var n in e)i_.call(e,n)&&Us(t,n,e[n])});function o_(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var a_=Object.prototype,c_=a_.hasOwnProperty;function l_(t){if(!et(t))return o_(t);var e=xr(t),n=[];for(var r in t)r=="constructor"&&(e||!c_.call(t,r))||n.push(r);return n}function Fs(t){return Tt(t)?wl(t,!0):l_(t)}var u_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,h_=/^\w*$/;function bo(t,e){if(V(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ks(t)?!0:h_.test(t)||!u_.test(t)||e!=null&&t in Object(e)}var Fr=Rn(Object,"create");function f_(){this.__data__=Fr?Fr(null):{},this.size=0}function d_(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var p_="__lodash_hash_undefined__",g_=Object.prototype,m_=g_.hasOwnProperty;function E_(t){var e=this.__data__;if(Fr){var n=e[t];return n===p_?void 0:n}return m_.call(e,t)?e[t]:void 0}var __=Object.prototype,y_=__.hasOwnProperty;function T_(t){var e=this.__data__;return Fr?e[t]!==void 0:y_.call(e,t)}var S_="__lodash_hash_undefined__";function A_(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Fr&&e===void 0?S_:e,this}function vn(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}vn.prototype.clear=f_,vn.prototype.delete=d_,vn.prototype.get=E_,vn.prototype.has=T_,vn.prototype.set=A_;function w_(){this.__data__=[],this.size=0}function $s(t,e){for(var n=t.length;n--;)if(kr(t[n][0],e))return n;return-1}var R_=Array.prototype,v_=R_.splice;function N_(t){var e=this.__data__,n=$s(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():v_.call(e,n,1),--this.size,!0}function O_(t){var e=this.__data__,n=$s(e,t);return n<0?void 0:e[n][1]}function I_(t){return $s(this.__data__,t)>-1}function L_(t,e){var n=this.__data__,r=$s(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Wt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Wt.prototype.clear=w_,Wt.prototype.delete=N_,Wt.prototype.get=O_,Wt.prototype.has=I_,Wt.prototype.set=L_;var $r=Rn(yt,"Map");function C_(){this.size=0,this.__data__={hash:new vn,map:new($r||Wt),string:new vn}}function b_(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Bs(t,e){var n=t.__data__;return b_(e)?n[typeof e=="string"?"string":"hash"]:n.map}function k_(t){var e=Bs(this,t).delete(t);return this.size-=e?1:0,e}function M_(t){return Bs(this,t).get(t)}function x_(t){return Bs(this,t).has(t)}function U_(t,e){var n=Bs(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Kt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Kt.prototype.clear=C_,Kt.prototype.delete=k_,Kt.prototype.get=M_,Kt.prototype.has=x_,Kt.prototype.set=U_;var P_="Expected a function";function ko(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(P_);var n=function(){var r=arguments,s=e?e.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var o=t.apply(this,r);return n.cache=i.set(s,o)||i,o};return n.cache=new(ko.Cache||Kt),n}ko.Cache=Kt;var D_=500;function F_(t){var e=ko(t,function(r){return n.size===D_&&n.clear(),r}),n=e.cache;return e}var $_=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,B_=/\\(\\)?/g,G_=F_(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace($_,function(n,r,s,i){e.push(s?i.replace(B_,"$1"):r||n)}),e});function W_(t){return t==null?"":al(t)}function Gs(t,e){return V(t)?t:bo(t,e)?[t]:G_(W_(t))}var K_=1/0;function Br(t){if(typeof t=="string"||ks(t))return t;var e=t+"";return e=="0"&&1/t==-K_?"-0":e}function Mo(t,e){e=Gs(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[Br(e[n++])];return n&&n==r?t:void 0}function j_(t,e,n){var r=t==null?void 0:Mo(t,e);return r===void 0?n:r}function xo(t,e){for(var n=-1,r=e.length,s=t.length;++n<r;)t[s+n]=e[n];return t}var Nl=Ze?Ze.isConcatSpreadable:void 0;function H_(t){return V(t)||Ds(t)||!!(Nl&&t&&t[Nl])}function Ws(t,e,n,r,s){var i=-1,o=t.length;for(n||(n=H_),s||(s=[]);++i<o;){var a=t[i];e>0&&n(a)?e>1?Ws(a,e-1,n,r,s):xo(s,a):r||(s[s.length]=a)}return s}function ct(t){var e=t==null?0:t.length;return e?Ws(t,1):[]}var V_=Rl(Object.getPrototypeOf,Object),Ol=V_;function Il(t,e,n){var r=-1,s=t.length;e<0&&(e=-e>s?0:s+e),n=n>s?s:n,n<0&&(n+=s),s=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(s);++r<s;)i[r]=t[r+e];return i}function Y_(t,e,n,r){var s=-1,i=t==null?0:t.length;for(r&&i&&(n=t[++s]);++s<i;)n=e(n,t[s],s,t);return n}function z_(){this.__data__=new Wt,this.size=0}function q_(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function X_(t){return this.__data__.get(t)}function J_(t){return this.__data__.has(t)}var Q_=200;function Z_(t,e){var n=this.__data__;if(n instanceof Wt){var r=n.__data__;if(!$r||r.length<Q_-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Kt(r)}return n.set(t,e),this.size=n.size,this}function St(t){var e=this.__data__=new Wt(t);this.size=e.size}St.prototype.clear=z_,St.prototype.delete=q_,St.prototype.get=X_,St.prototype.has=J_,St.prototype.set=Z_;function ey(t,e){return t&&Mr(e,je(e),t)}function ty(t,e){return t&&Mr(e,Fs(e),t)}var Ll=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Cl=Ll&&typeof module=="object"&&module&&!module.nodeType&&module,ny=Cl&&Cl.exports===Ll,bl=ny?yt.Buffer:void 0,kl=bl?bl.allocUnsafe:void 0;function ry(t,e){if(e)return t.slice();var n=t.length,r=kl?kl(n):new t.constructor(n);return t.copy(r),r}function Uo(t,e){for(var n=-1,r=t==null?0:t.length,s=0,i=[];++n<r;){var o=t[n];e(o,n,t)&&(i[s++]=o)}return i}function Ml(){return[]}var sy=Object.prototype,iy=sy.propertyIsEnumerable,xl=Object.getOwnPropertySymbols,Po=xl?function(t){return t==null?[]:(t=Object(t),Uo(xl(t),function(e){return iy.call(t,e)}))}:Ml;function oy(t,e){return Mr(t,Po(t),e)}var ay=Object.getOwnPropertySymbols,Ul=ay?function(t){for(var e=[];t;)xo(e,Po(t)),t=Ol(t);return e}:Ml;function cy(t,e){return Mr(t,Ul(t),e)}function Pl(t,e,n){var r=e(t);return V(t)?r:xo(r,n(t))}function Do(t){return Pl(t,je,Po)}function Dl(t){return Pl(t,Fs,Ul)}var Fo=Rn(yt,"DataView"),$o=Rn(yt,"Promise"),Xn=Rn(yt,"Set"),Fl="[object Map]",ly="[object Object]",$l="[object Promise]",Bl="[object Set]",Gl="[object WeakMap]",Wl="[object DataView]",uy=wn(Fo),hy=wn($r),fy=wn($o),dy=wn(Xn),py=wn(Ro),Nn=rn;(Fo&&Nn(new Fo(new ArrayBuffer(1)))!=Wl||$r&&Nn(new $r)!=Fl||$o&&Nn($o.resolve())!=$l||Xn&&Nn(new Xn)!=Bl||Ro&&Nn(new Ro)!=Gl)&&(Nn=function(t){var e=rn(t),n=e==ly?t.constructor:void 0,r=n?wn(n):"";if(r)switch(r){case uy:return Wl;case hy:return Fl;case fy:return $l;case dy:return Bl;case py:return Gl}return e});var Jn=Nn,gy=Object.prototype,my=gy.hasOwnProperty;function Ey(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&my.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var Ks=yt.Uint8Array;function Bo(t){var e=new t.constructor(t.byteLength);return new Ks(e).set(new Ks(t)),e}function _y(t,e){var n=e?Bo(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var yy=/\w*$/;function Ty(t){var e=new t.constructor(t.source,yy.exec(t));return e.lastIndex=t.lastIndex,e}var Kl=Ze?Ze.prototype:void 0,jl=Kl?Kl.valueOf:void 0;function Sy(t){return jl?Object(jl.call(t)):{}}function Ay(t,e){var n=e?Bo(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var wy="[object Boolean]",Ry="[object Date]",vy="[object Map]",Ny="[object Number]",Oy="[object RegExp]",Iy="[object Set]",Ly="[object String]",Cy="[object Symbol]",by="[object ArrayBuffer]",ky="[object DataView]",My="[object Float32Array]",xy="[object Float64Array]",Uy="[object Int8Array]",Py="[object Int16Array]",Dy="[object Int32Array]",Fy="[object Uint8Array]",$y="[object Uint8ClampedArray]",By="[object Uint16Array]",Gy="[object Uint32Array]";function Wy(t,e,n){var r=t.constructor;switch(e){case by:return Bo(t);case wy:case Ry:return new r(+t);case ky:return _y(t,n);case My:case xy:case Uy:case Py:case Dy:case Fy:case $y:case By:case Gy:return Ay(t,n);case vy:return new r;case Ny:case Ly:return new r(t);case Oy:return Ty(t);case Iy:return new r;case Cy:return Sy(t)}}function Ky(t){return typeof t.constructor=="function"&&!xr(t)?Xm(Ol(t)):{}}var jy="[object Map]";function Hy(t){return at(t)&&Jn(t)==jy}var Hl=sn&&sn.isMap,Vy=Hl?Pr(Hl):Hy,Yy="[object Set]";function zy(t){return at(t)&&Jn(t)==Yy}var Vl=sn&&sn.isSet,qy=Vl?Pr(Vl):zy,Xy=1,Jy=2,Qy=4,Yl="[object Arguments]",Zy="[object Array]",eT="[object Boolean]",tT="[object Date]",nT="[object Error]",zl="[object Function]",rT="[object GeneratorFunction]",sT="[object Map]",iT="[object Number]",ql="[object Object]",oT="[object RegExp]",aT="[object Set]",cT="[object String]",lT="[object Symbol]",uT="[object WeakMap]",hT="[object ArrayBuffer]",fT="[object DataView]",dT="[object Float32Array]",pT="[object Float64Array]",gT="[object Int8Array]",mT="[object Int16Array]",ET="[object Int32Array]",_T="[object Uint8Array]",yT="[object Uint8ClampedArray]",TT="[object Uint16Array]",ST="[object Uint32Array]",z={};z[Yl]=z[Zy]=z[hT]=z[fT]=z[eT]=z[tT]=z[dT]=z[pT]=z[gT]=z[mT]=z[ET]=z[sT]=z[iT]=z[ql]=z[oT]=z[aT]=z[cT]=z[lT]=z[_T]=z[yT]=z[TT]=z[ST]=!0,z[nT]=z[zl]=z[uT]=!1;function js(t,e,n,r,s,i){var o,a=e&Xy,c=e&Jy,l=e&Qy;if(n&&(o=s?n(t,r,s,i):n(t)),o!==void 0)return o;if(!et(t))return t;var u=V(t);if(u){if(o=Ey(t),!a)return Qm(t,o)}else{var h=Jn(t),d=h==zl||h==rT;if(Ur(t))return ry(t,a);if(h==ql||h==Yl||d&&!s){if(o=c||d?{}:Ky(t),!a)return c?cy(t,ty(o,t)):oy(t,ey(o,t))}else{if(!z[h])return s?t:{};o=Wy(t,h,a)}}i||(i=new St);var f=i.get(t);if(f)return f;i.set(t,o),qy(t)?t.forEach(function(A){o.add(js(A,e,n,A,t,i))}):Vy(t)&&t.forEach(function(A,S){o.set(S,js(A,e,n,S,t,i))});var p=l?c?Dl:Do:c?Fs:je,m=u?void 0:p(t);return fl(m||t,function(A,S){m&&(S=A,A=t[S]),Us(o,S,js(A,e,n,S,t,i))}),o}var AT=4;function Ae(t){return js(t,AT)}function Gr(t){for(var e=-1,n=t==null?0:t.length,r=0,s=[];++e<n;){var i=t[e];i&&(s[r++]=i)}return s}var wT="__lodash_hash_undefined__";function RT(t){return this.__data__.set(t,wT),this}function vT(t){return this.__data__.has(t)}function Qn(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Kt;++e<n;)this.add(t[e])}Qn.prototype.add=Qn.prototype.push=RT,Qn.prototype.has=vT;function Xl(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Go(t,e){return t.has(e)}var NT=1,OT=2;function Jl(t,e,n,r,s,i){var o=n&NT,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=i.get(t),u=i.get(e);if(l&&u)return l==e&&u==t;var h=-1,d=!0,f=n&OT?new Qn:void 0;for(i.set(t,e),i.set(e,t);++h<a;){var p=t[h],m=e[h];if(r)var A=o?r(m,p,h,e,t,i):r(p,m,h,t,e,i);if(A!==void 0){if(A)continue;d=!1;break}if(f){if(!Xl(e,function(S,y){if(!Go(f,y)&&(p===S||s(p,S,n,r,i)))return f.push(y)})){d=!1;break}}else if(!(p===m||s(p,m,n,r,i))){d=!1;break}}return i.delete(t),i.delete(e),d}function IT(t){var e=-1,n=Array(t.size);return t.forEach(function(r,s){n[++e]=[s,r]}),n}function Wo(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var LT=1,CT=2,bT="[object Boolean]",kT="[object Date]",MT="[object Error]",xT="[object Map]",UT="[object Number]",PT="[object RegExp]",DT="[object Set]",FT="[object String]",$T="[object Symbol]",BT="[object ArrayBuffer]",GT="[object DataView]",Ql=Ze?Ze.prototype:void 0,Ko=Ql?Ql.valueOf:void 0;function WT(t,e,n,r,s,i,o){switch(n){case GT:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case BT:return!(t.byteLength!=e.byteLength||!i(new Ks(t),new Ks(e)));case bT:case kT:case UT:return kr(+t,+e);case MT:return t.name==e.name&&t.message==e.message;case PT:case FT:return t==e+"";case xT:var a=IT;case DT:var c=r&LT;if(a||(a=Wo),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=CT,o.set(t,e);var u=Jl(a(t),a(e),r,s,i,o);return o.delete(t),u;case $T:if(Ko)return Ko.call(t)==Ko.call(e)}return!1}var KT=1,jT=Object.prototype,HT=jT.hasOwnProperty;function VT(t,e,n,r,s,i){var o=n&KT,a=Do(t),c=a.length,l=Do(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in e:HT.call(e,d)))return!1}var f=i.get(t),p=i.get(e);if(f&&p)return f==e&&p==t;var m=!0;i.set(t,e),i.set(e,t);for(var A=o;++h<c;){d=a[h];var S=t[d],y=e[d];if(r)var w=o?r(y,S,d,e,t,i):r(S,y,d,t,e,i);if(!(w===void 0?S===y||s(S,y,n,r,i):w)){m=!1;break}A||(A=d=="constructor")}if(m&&!A){var E=t.constructor,T=e.constructor;E!=T&&"constructor"in t&&"constructor"in e&&!(typeof E=="function"&&E instanceof E&&typeof T=="function"&&T instanceof T)&&(m=!1)}return i.delete(t),i.delete(e),m}var YT=1,Zl="[object Arguments]",eu="[object Array]",Hs="[object Object]",zT=Object.prototype,tu=zT.hasOwnProperty;function qT(t,e,n,r,s,i){var o=V(t),a=V(e),c=o?eu:Jn(t),l=a?eu:Jn(e);c=c==Zl?Hs:c,l=l==Zl?Hs:l;var u=c==Hs,h=l==Hs,d=c==l;if(d&&Ur(t)){if(!Ur(e))return!1;o=!0,u=!1}if(d&&!u)return i||(i=new St),o||Co(t)?Jl(t,e,n,r,s,i):WT(t,e,c,n,r,s,i);if(!(n&YT)){var f=u&&tu.call(t,"__wrapped__"),p=h&&tu.call(e,"__wrapped__");if(f||p){var m=f?t.value():t,A=p?e.value():e;return i||(i=new St),s(m,A,n,r,i)}}return d?(i||(i=new St),VT(t,e,n,r,s,i)):!1}function jo(t,e,n,r,s){return t===e?!0:t==null||e==null||!at(t)&&!at(e)?t!==t&&e!==e:qT(t,e,n,r,jo,s)}var XT=1,JT=2;function QT(t,e,n,r){var s=n.length,i=s,o=!r;if(t==null)return!i;for(t=Object(t);s--;){var a=n[s];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++s<i;){a=n[s];var c=a[0],l=t[c],u=a[1];if(o&&a[2]){if(l===void 0&&!(c in t))return!1}else{var h=new St;if(r)var d=r(l,u,c,t,e,h);if(!(d===void 0?jo(u,l,XT|JT,r,h):d))return!1}}return!0}function nu(t){return t===t&&!et(t)}function ZT(t){for(var e=je(t),n=e.length;n--;){var r=e[n],s=t[r];e[n]=[r,s,nu(s)]}return e}function ru(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function eS(t){var e=ZT(t);return e.length==1&&e[0][2]?ru(e[0][0],e[0][1]):function(n){return n===t||QT(n,t,e)}}function tS(t,e){return t!=null&&e in Object(t)}function su(t,e,n){e=Gs(e,t);for(var r=-1,s=e.length,i=!1;++r<s;){var o=Br(e[r]);if(!(i=t!=null&&n(t,o)))break;t=t[o]}return i||++r!=s?i:(s=t==null?0:t.length,!!s&&Io(s)&&xs(o,s)&&(V(t)||Ds(t)))}function nS(t,e){return t!=null&&su(t,e,tS)}var rS=1,sS=2;function iS(t,e){return bo(t)&&nu(e)?ru(Br(t),e):function(n){var r=j_(n,t);return r===void 0&&r===e?nS(n,t):jo(e,r,rS|sS)}}function oS(t){return function(e){return e==null?void 0:e[t]}}function aS(t){return function(e){return Mo(e,t)}}function cS(t){return bo(t)?oS(Br(t)):aS(t)}function At(t){return typeof t=="function"?t:t==null?qn:typeof t=="object"?V(t)?iS(t[0],t[1]):eS(t):cS(t)}function lS(t,e,n,r){for(var s=-1,i=t==null?0:t.length;++s<i;){var o=t[s];e(r,o,n(o),t)}return r}function uS(t){return function(e,n,r){for(var s=-1,i=Object(e),o=r(e),a=o.length;a--;){var c=o[t?a:++s];if(n(i[c],c,i)===!1)break}return e}}var hS=uS(),fS=hS;function dS(t,e){return t&&fS(t,e,je)}function pS(t,e){return function(n,r){if(n==null)return n;if(!Tt(n))return t(n,r);for(var s=n.length,i=e?s:-1,o=Object(n);(e?i--:++i<s)&&r(o[i],i,o)!==!1;);return n}}var gS=pS(dS),On=gS;function mS(t,e,n,r){return On(t,function(s,i,o){e(r,s,n(s),o)}),r}function ES(t,e){return function(n,r){var s=V(n)?lS:mS,i=e?e():{};return s(n,t,At(r),i)}}var iu=Object.prototype,_S=iu.hasOwnProperty,Ho=Oo(function(t,e){t=Object(t);var n=-1,r=e.length,s=r>2?e[2]:void 0;for(s&&Ps(e[0],e[1],s)&&(r=1);++n<r;)for(var i=e[n],o=Fs(i),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||kr(u,iu[l])&&!_S.call(t,l))&&(t[l]=i[l])}return t});function ou(t){return at(t)&&Tt(t)}function au(t,e,n){for(var r=-1,s=t==null?0:t.length;++r<s;)if(n(e,t[r]))return!0;return!1}var yS=200;function TS(t,e,n,r){var s=-1,i=pl,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;n&&(e=Cr(e,Pr(n))),r?(i=au,o=!1):e.length>=yS&&(i=Go,o=!1,e=new Qn(e));e:for(;++s<a;){var u=t[s],h=n==null?u:n(u);if(u=r||u!==0?u:0,o&&h===h){for(var d=l;d--;)if(e[d]===h)continue e;c.push(u)}else i(e,h,r)||c.push(u)}return c}var Vs=Oo(function(t,e){return ou(t)?TS(t,Ws(e,1,ou,!0)):[]});function Zn(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function we(t,e,n){var r=t==null?0:t.length;return r?(e=n||e===void 0?1:br(e),Il(t,e<0?0:e,r)):[]}function Wr(t,e,n){var r=t==null?0:t.length;return r?(e=n||e===void 0?1:br(e),e=r-e,Il(t,0,e<0?0:e)):[]}function SS(t){return typeof t=="function"?t:qn}function x(t,e){var n=V(t)?fl:On;return n(t,SS(e))}function AS(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function wS(t,e){var n=!0;return On(t,function(r,s,i){return n=!!e(r,s,i),n}),n}function lt(t,e,n){var r=V(t)?AS:wS;return n&&Ps(t,e,n)&&(e=void 0),r(t,At(e))}function cu(t,e){var n=[];return On(t,function(r,s,i){e(r,s,i)&&n.push(r)}),n}function tt(t,e){var n=V(t)?Uo:cu;return n(t,At(e))}function RS(t){return function(e,n,r){var s=Object(e);if(!Tt(e)){var i=At(n);e=je(e),n=function(a){return i(s[a],a,s)}}var o=t(e,n,r);return o>-1?s[i?e[o]:o]:void 0}}var vS=Math.max;function NS(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var s=n==null?0:br(n);return s<0&&(s=vS(r+s,0)),dl(t,At(e),s)}var er=RS(NS);function ut(t){return t&&t.length?t[0]:void 0}function OS(t,e){var n=-1,r=Tt(t)?Array(t.length):[];return On(t,function(s,i,o){r[++n]=e(s,i,o)}),r}function C(t,e){var n=V(t)?Cr:OS;return n(t,At(e))}function nt(t,e){return Ws(C(t,e),1)}var IS=Object.prototype,LS=IS.hasOwnProperty,CS=ES(function(t,e,n){LS.call(t,n)?t[n].push(e):No(t,n,[e])}),bS=Object.prototype,kS=bS.hasOwnProperty;function MS(t,e){return t!=null&&kS.call(t,e)}function M(t,e){return t!=null&&su(t,e,MS)}var xS="[object String]";function De(t){return typeof t=="string"||!V(t)&&at(t)&&rn(t)==xS}function US(t,e){return Cr(e,function(n){return t[n]})}function pe(t){return t==null?[]:US(t,je(t))}var PS=Math.max;function xe(t,e,n,r){t=Tt(t)?t:pe(t),n=n&&!r?br(n):0;var s=t.length;return n<0&&(n=PS(s+n,0)),De(t)?n<=s&&t.indexOf(e,n)>-1:!!s&&vo(t,e,n)>-1}var DS=Math.max;function lu(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var s=n==null?0:br(n);return s<0&&(s=DS(r+s,0)),vo(t,e,s)}var FS="[object Map]",$S="[object Set]",BS=Object.prototype,GS=BS.hasOwnProperty;function q(t){if(t==null)return!0;if(Tt(t)&&(V(t)||typeof t=="string"||typeof t.splice=="function"||Ur(t)||Co(t)||Ds(t)))return!t.length;var e=Jn(t);if(e==FS||e==$S)return!t.size;if(xr(t))return!vl(t).length;for(var n in t)if(GS.call(t,n))return!1;return!0}var WS="[object RegExp]";function KS(t){return at(t)&&rn(t)==WS}var uu=sn&&sn.isRegExp,jt=uu?Pr(uu):KS;function Ht(t){return t===void 0}var jS="Expected a function";function HS(t){if(typeof t!="function")throw new TypeError(jS);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function VS(t,e,n,r){if(!et(t))return t;e=Gs(e,t);for(var s=-1,i=e.length,o=i-1,a=t;a!=null&&++s<i;){var c=Br(e[s]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(s!=o){var u=a[c];l=r?r(u,c,a):void 0,l===void 0&&(l=et(u)?u:xs(e[s+1])?[]:{})}Us(a,c,l),a=a[c]}return t}function YS(t,e,n){for(var r=-1,s=e.length,i={};++r<s;){var o=e[r],a=Mo(t,o);n(a,o)&&VS(i,Gs(o,t),a)}return i}function ht(t,e){if(t==null)return{};var n=Cr(Dl(t),function(r){return[r]});return e=At(e),YS(t,n,function(r,s){return e(r,s[0])})}function zS(t,e,n,r,s){return s(t,function(i,o,a){n=r?(r=!1,i):e(n,i,o,a)}),n}function Ve(t,e,n){var r=V(t)?Y_:zS,s=arguments.length<3;return r(t,At(e),n,s,On)}function Ys(t,e){var n=V(t)?Uo:cu;return n(t,HS(At(e)))}function qS(t,e){var n;return On(t,function(r,s,i){return n=e(r,s,i),!n}),!!n}function hu(t,e,n){var r=V(t)?Xl:qS;return n&&Ps(t,e,n)&&(e=void 0),r(t,At(e))}var XS=1/0,JS=Xn&&1/Wo(new Xn([,-0]))[1]==XS?function(t){return new Xn(t)}:de,QS=200;function ZS(t,e,n){var r=-1,s=pl,i=t.length,o=!0,a=[],c=a;if(n)o=!1,s=au;else if(i>=QS){var l=e?null:JS(t);if(l)return Wo(l);o=!1,s=Go,c=new Qn}else c=e?[]:a;e:for(;++r<i;){var u=t[r],h=e?e(u):u;if(u=n||u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue e;e&&c.push(h),a.push(u)}else s(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function Vo(t){return t&&t.length?ZS(t):[]}function Yo(t){console&&console.error&&console.error(`Error: ${t}`)}function fu(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function du(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function pu(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function eA(t){return tA(t)?t.LABEL:t.name}function tA(t){return De(t.LABEL)&&t.LABEL!==""}class wt{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),x(this.definition,n=>{n.accept(e)})}}class Ye extends wt{constructor(e){super([]),this.idx=1,He(this,ht(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class tr extends wt{constructor(e){super(e.definition),this.orgText="",He(this,ht(e,n=>n!==void 0))}}class Fe extends wt{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,He(this,ht(e,n=>n!==void 0))}}class $e extends wt{constructor(e){super(e.definition),this.idx=1,He(this,ht(e,n=>n!==void 0))}}class Rt extends wt{constructor(e){super(e.definition),this.idx=1,He(this,ht(e,n=>n!==void 0))}}class vt extends wt{constructor(e){super(e.definition),this.idx=1,He(this,ht(e,n=>n!==void 0))}}class ge extends wt{constructor(e){super(e.definition),this.idx=1,He(this,ht(e,n=>n!==void 0))}}class ft extends wt{constructor(e){super(e.definition),this.idx=1,He(this,ht(e,n=>n!==void 0))}}class dt extends wt{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,He(this,ht(e,n=>n!==void 0))}}class ne{constructor(e){this.idx=1,He(this,ht(e,n=>n!==void 0))}accept(e){e.visit(this)}}function nA(t){return C(t,zs)}function zs(t){function e(n){return C(n,zs)}if(t instanceof Ye){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return De(t.label)&&(n.label=t.label),n}else{if(t instanceof Fe)return{type:"Alternative",definition:e(t.definition)};if(t instanceof $e)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Rt)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof vt)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:zs(new ne({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof ft)return{type:"RepetitionWithSeparator",idx:t.idx,separator:zs(new ne({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof ge)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof dt)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof ne){const n={type:"Terminal",name:t.terminalType.name,label:eA(t.terminalType),idx:t.idx};De(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=jt(r)?r.source:r),n}else{if(t instanceof tr)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class nr{visit(e){const n=e;switch(n.constructor){case Ye:return this.visitNonTerminal(n);case Fe:return this.visitAlternative(n);case $e:return this.visitOption(n);case Rt:return this.visitRepetitionMandatory(n);case vt:return this.visitRepetitionMandatoryWithSeparator(n);case ft:return this.visitRepetitionWithSeparator(n);case ge:return this.visitRepetition(n);case dt:return this.visitAlternation(n);case ne:return this.visitTerminal(n);case tr:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function rA(t){return t instanceof Fe||t instanceof $e||t instanceof ge||t instanceof Rt||t instanceof vt||t instanceof ft||t instanceof ne||t instanceof tr}function qs(t,e=[]){return t instanceof $e||t instanceof ge||t instanceof ft?!0:t instanceof dt?hu(t.definition,r=>qs(r,e)):t instanceof Ye&&xe(e,t)?!1:t instanceof wt?(t instanceof Ye&&e.push(t),lt(t.definition,r=>qs(r,e))):!1}function sA(t){return t instanceof dt}function Nt(t){if(t instanceof Ye)return"SUBRULE";if(t instanceof $e)return"OPTION";if(t instanceof dt)return"OR";if(t instanceof Rt)return"AT_LEAST_ONE";if(t instanceof vt)return"AT_LEAST_ONE_SEP";if(t instanceof ft)return"MANY_SEP";if(t instanceof ge)return"MANY";if(t instanceof ne)return"CONSUME";throw Error("non exhaustive match")}class Xs{walk(e,n=[]){x(e.definition,(r,s)=>{const i=we(e.definition,s+1);if(r instanceof Ye)this.walkProdRef(r,i,n);else if(r instanceof ne)this.walkTerminal(r,i,n);else if(r instanceof Fe)this.walkFlat(r,i,n);else if(r instanceof $e)this.walkOption(r,i,n);else if(r instanceof Rt)this.walkAtLeastOne(r,i,n);else if(r instanceof vt)this.walkAtLeastOneSep(r,i,n);else if(r instanceof ft)this.walkManySep(r,i,n);else if(r instanceof ge)this.walkMany(r,i,n);else if(r instanceof dt)this.walkOr(r,i,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const s=n.concat(r);this.walk(e,s)}walkOption(e,n,r){const s=n.concat(r);this.walk(e,s)}walkAtLeastOne(e,n,r){const s=[new $e({definition:e.definition})].concat(n,r);this.walk(e,s)}walkAtLeastOneSep(e,n,r){const s=gu(e,n,r);this.walk(e,s)}walkMany(e,n,r){const s=[new $e({definition:e.definition})].concat(n,r);this.walk(e,s)}walkManySep(e,n,r){const s=gu(e,n,r);this.walk(e,s)}walkOr(e,n,r){const s=n.concat(r);x(e.definition,i=>{const o=new Fe({definition:[i]});this.walk(o,s)})}}function gu(t,e,n){return[new $e({definition:[new ne({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function Kr(t){if(t instanceof Ye)return Kr(t.referencedRule);if(t instanceof ne)return aA(t);if(rA(t))return iA(t);if(sA(t))return oA(t);throw Error("non exhaustive match")}function iA(t){let e=[];const n=t.definition;let r=0,s=n.length>r,i,o=!0;for(;s&&o;)i=n[r],o=qs(i),e=e.concat(Kr(i)),r=r+1,s=n.length>r;return Vo(e)}function oA(t){const e=C(t.definition,n=>Kr(n));return Vo(ct(e))}function aA(t){return[t.terminalType]}const mu="_~IN~_";class cA extends Xs{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const s=uA(e.referencedRule,e.idx)+this.topProd.name,i=n.concat(r),o=new Fe({definition:i}),a=Kr(o);this.follows[s]=a}}function lA(t){const e={};return x(t,n=>{const r=new cA(n).startWalking();He(e,r)}),e}function uA(t,e){return t.name+e+mu}function U(t){return t.charCodeAt(0)}function zo(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function jr(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function rr(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function hA(){throw Error("Internal Error - Should never get here!")}function Eu(t){return t.type==="Character"}const Js=[];for(let t=U("0");t<=U("9");t++)Js.push(t);const Qs=[U("_")].concat(Js);for(let t=U("a");t<=U("z");t++)Qs.push(t);for(let t=U("A");t<=U("Z");t++)Qs.push(t);const _u=[U(" "),U("\f"),U(`
`),U("\r"),U("	"),U("\v"),U("	"),U(""),U(""),U(""),U(""),U(""),U(""),U(""),U(""),U(""),U(""),U(""),U(""),U(""),U("\u2028"),U("\u2029"),U(""),U(""),U(""),U("\uFEFF")],fA=/[0-9a-fA-F]/,Zs=/[0-9]/,dA=/[1-9]/;class pA{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":jr(r,"global");break;case"i":jr(r,"ignoreCase");break;case"m":jr(r,"multiLine");break;case"u":jr(r,"unicode");break;case"y":jr(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}rr(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return hA()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const s=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:s,atMost:s};break;case",":let i;this.isDigit()?(i=this.integerIncludingZero(),n={atLeast:s,atMost:i}):n={atLeast:s,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;rr(n);break}if(!(e===!0&&n===void 0)&&rr(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),rr(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[U(`
`),U("\r"),U("\u2028"),U("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=Js;break;case"D":e=Js,n=!0;break;case"s":e=_u;break;case"S":e=_u,n=!0;break;case"w":e=Qs;break;case"W":e=Qs,n=!0;break}if(rr(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=U("\f");break;case"n":e=U(`
`);break;case"r":e=U("\r");break;case"t":e=U("	");break;case"v":e=U("\v");break}if(rr(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:U("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:U(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:U(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,Eu(r)&&this.isRangeDash()){this.consumeChar("-");const s=this.classAtom();if(s.type,Eu(s)){if(s.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:s.value})}else zo(r.value,e),e.push(U("-")),zo(s.value,e)}else zo(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:U("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(dA.test(e)===!1)throw Error("Expecting a positive integer");for(;Zs.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Zs.test(e)===!1)throw Error("Expecting an integer");for(;Zs.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:U(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Zs.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let s=0;s<e;s++){const i=this.popChar();if(fA.test(i)===!1)throw Error("Expecting a HexDecimal digits");n+=i}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class qo{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(s=>{this.visit(s)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let ei={};const gA=new pA;function ti(t){const e=t.toString();if(ei.hasOwnProperty(e))return ei[e];{const n=gA.pattern(e);return ei[e]=n,n}}function mA(){ei={}}const yu="Complement Sets are not supported for first char optimization",ni=`Unable to use "first char" lexer optimizations:
`;function EA(t,e=!1){try{const n=ti(t);return Xo(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===yu)e&&fu(`${ni}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Yo(`${ni}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Xo(t,e,n){switch(t.type){case"Disjunction":for(let s=0;s<t.value.length;s++)Xo(t.value[s],e,n);break;case"Alternative":const r=t.value;for(let s=0;s<r.length;s++){const i=r[s];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=i;switch(o.type){case"Character":ri(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(yu);x(o.value,c=>{if(typeof c=="number")ri(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)ri(u,e,n);else{for(let u=l.from;u<=l.to&&u<Vr;u++)ri(u,e,n);if(l.to>=Vr){const u=l.from>=Vr?l.from:Vr,h=l.to,d=on(u),f=on(h);for(let p=d;p<=f;p++)e[p]=p}}}});break;case"Group":Xo(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Jo(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return pe(e)}function ri(t,e,n){const r=on(t);e[r]=r,n===!0&&_A(t,e)}function _A(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const s=on(r.charCodeAt(0));e[s]=s}else{const s=n.toLowerCase();if(s!==n){const i=on(s.charCodeAt(0));e[i]=i}}}function Tu(t,e){return er(t.value,n=>{if(typeof n=="number")return xe(e,n);{const r=n;return er(e,s=>r.from<=s&&s<=r.to)!==void 0}})}function Jo(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?V(t.value)?lt(t.value,Jo):Jo(t.value):!1}class yA extends qo{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){xe(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?Tu(e,this.targetCharCodes)===void 0&&(this.found=!0):Tu(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Qo(t,e){if(e instanceof RegExp){const n=ti(e),r=new yA(t);return r.visit(n),r.found}else return er(e,n=>xe(t,n.charCodeAt(0)))!==void 0}const In="PATTERN",Hr="defaultMode",si="modes";let Su=typeof new RegExp("(?:)").sticky=="boolean";function TA(t,e){e=Ho(e,{useSticky:Su,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(y,w)=>w()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{KA()});let r;n("Reject Lexer.NA",()=>{r=Ys(t,y=>y[In]===_e.NA)});let s=!1,i;n("Transform Patterns",()=>{s=!1,i=C(r,y=>{const w=y[In];if(jt(w)){const E=w.source;return E.length===1&&E!=="^"&&E!=="$"&&E!=="."&&!w.ignoreCase?E:E.length===2&&E[0]==="\\"&&!xe(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],E[1])?E[1]:e.useSticky?wu(w):Au(w)}else{if(Gt(w))return s=!0,{exec:w};if(typeof w=="object")return s=!0,w;if(typeof w=="string"){if(w.length===1)return w;{const E=w.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),T=new RegExp(E);return e.useSticky?wu(T):Au(T)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=C(r,y=>y.tokenTypeIdx),a=C(r,y=>{const w=y.GROUP;if(w!==_e.SKIPPED){if(De(w))return w;if(Ht(w))return!1;throw Error("non exhaustive match")}}),c=C(r,y=>{const w=y.LONGER_ALT;if(w)return V(w)?C(w,T=>lu(r,T)):[lu(r,w)]}),l=C(r,y=>y.PUSH_MODE),u=C(r,y=>M(y,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const y=Nu(e.lineTerminatorCharacters);h=C(r,w=>!1),e.positionTracking!=="onlyOffset"&&(h=C(r,w=>M(w,"LINE_BREAKS")?!!w.LINE_BREAKS:vu(w,y)===!1&&Qo(y,w.PATTERN)))});let d,f,p,m;n("Misc Mapping #2",()=>{d=C(r,Ru),f=C(i,BA),p=Ve(r,(y,w)=>{const E=w.GROUP;return De(E)&&E!==_e.SKIPPED&&(y[E]=[]),y},{}),m=C(i,(y,w)=>({pattern:i[w],longerAlt:c[w],canLineTerminator:h[w],isCustom:d[w],short:f[w],group:a[w],push:l[w],pop:u[w],tokenTypeIdx:o[w],tokenType:r[w]}))});let A=!0,S=[];return e.safeMode||n("First Char Optimization",()=>{S=Ve(r,(y,w,E)=>{if(typeof w.PATTERN=="string"){const T=w.PATTERN.charCodeAt(0),g=on(T);Zo(y,g,m[E])}else if(V(w.START_CHARS_HINT)){let T;x(w.START_CHARS_HINT,g=>{const _=typeof g=="string"?g.charCodeAt(0):g,v=on(_);T!==v&&(T=v,Zo(y,v,m[E]))})}else if(jt(w.PATTERN))if(w.PATTERN.unicode)A=!1,e.ensureOptimizations&&Yo(`${ni}	Unable to analyze < ${w.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const T=EA(w.PATTERN,e.ensureOptimizations);q(T)&&(A=!1),x(T,g=>{Zo(y,g,m[E])})}else e.ensureOptimizations&&Yo(`${ni}	TokenType: <${w.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),A=!1;return y},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:S,hasCustom:s,canBeOptimized:A}}function SA(t,e){let n=[];const r=wA(t);n=n.concat(r.errors);const s=RA(r.valid),i=s.valid;return n=n.concat(s.errors),n=n.concat(AA(i)),n=n.concat(kA(i)),n=n.concat(MA(i,e)),n=n.concat(xA(i)),n}function AA(t){let e=[];const n=tt(t,r=>jt(r[In]));return e=e.concat(NA(n)),e=e.concat(LA(n)),e=e.concat(CA(n)),e=e.concat(bA(n)),e=e.concat(OA(n)),e}function wA(t){const e=tt(t,s=>!M(s,In)),n=C(e,s=>({message:"Token Type: ->"+s.name+"<- missing static 'PATTERN' property",type:ie.MISSING_PATTERN,tokenTypes:[s]})),r=Vs(t,e);return{errors:n,valid:r}}function RA(t){const e=tt(t,s=>{const i=s[In];return!jt(i)&&!Gt(i)&&!M(i,"exec")&&!De(i)}),n=C(e,s=>({message:"Token Type: ->"+s.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:ie.INVALID_PATTERN,tokenTypes:[s]})),r=Vs(t,e);return{errors:n,valid:r}}const vA=/[^\\][$]/;function NA(t){class e extends qo{constructor(){super(...arguments),this.found=!1}visitEndAnchor(i){this.found=!0}}const n=tt(t,s=>{const i=s.PATTERN;try{const o=ti(i),a=new e;return a.visit(o),a.found}catch{return vA.test(i.source)}});return C(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ie.EOI_ANCHOR_FOUND,tokenTypes:[s]}))}function OA(t){const e=tt(t,r=>r.PATTERN.test(""));return C(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:ie.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const IA=/[^\\[][\^]|^\^/;function LA(t){class e extends qo{constructor(){super(...arguments),this.found=!1}visitStartAnchor(i){this.found=!0}}const n=tt(t,s=>{const i=s.PATTERN;try{const o=ti(i),a=new e;return a.visit(o),a.found}catch{return IA.test(i.source)}});return C(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ie.SOI_ANCHOR_FOUND,tokenTypes:[s]}))}function CA(t){const e=tt(t,r=>{const s=r[In];return s instanceof RegExp&&(s.multiline||s.global)});return C(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:ie.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function bA(t){const e=[];let n=C(t,i=>Ve(t,(o,a)=>(i.PATTERN.source===a.PATTERN.source&&!xe(e,a)&&a.PATTERN!==_e.NA&&(e.push(a),o.push(a)),o),[]));n=Gr(n);const r=tt(n,i=>i.length>1);return C(r,i=>{const o=C(i,c=>c.name);return{message:`The same RegExp pattern ->${ut(i).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:ie.DUPLICATE_PATTERNS_FOUND,tokenTypes:i}})}function kA(t){const e=tt(t,r=>{if(!M(r,"GROUP"))return!1;const s=r.GROUP;return s!==_e.SKIPPED&&s!==_e.NA&&!De(s)});return C(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:ie.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function MA(t,e){const n=tt(t,s=>s.PUSH_MODE!==void 0&&!xe(e,s.PUSH_MODE));return C(n,s=>({message:`Token Type: ->${s.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${s.PUSH_MODE}<-which does not exist`,type:ie.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[s]}))}function xA(t){const e=[],n=Ve(t,(r,s,i)=>{const o=s.PATTERN;return o===_e.NA||(De(o)?r.push({str:o,idx:i,tokenType:s}):jt(o)&&PA(o)&&r.push({str:o.source,idx:i,tokenType:s})),r},[]);return x(t,(r,s)=>{x(n,({str:i,idx:o,tokenType:a})=>{if(s<o&&UA(i,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:ie.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function UA(t,e){if(jt(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Gt(e))return e(t,0,[],{});if(M(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function PA(t){return er([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function Au(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function wu(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function DA(t,e,n){const r=[];return M(t,Hr)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Hr+`> property in its definition
`,type:ie.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),M(t,si)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+si+`> property in its definition
`,type:ie.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),M(t,si)&&M(t,Hr)&&!M(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Hr}: <${t.defaultMode}>which does not exist
`,type:ie.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),M(t,si)&&x(t.modes,(s,i)=>{x(s,(o,a)=>{if(Ht(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${i}> at index: <${a}>
`,type:ie.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(M(o,"LONGER_ALT")){const c=V(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];x(c,l=>{!Ht(l)&&!xe(s,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${i}>
`,type:ie.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function FA(t,e,n){const r=[];let s=!1;const i=Gr(ct(pe(t.modes))),o=Ys(i,c=>c[In]===_e.NA),a=Nu(n);return e&&x(o,c=>{const l=vu(c,a);if(l!==!1){const h={message:WA(c,l),type:l.issue,tokenType:c};r.push(h)}else M(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(s=!0):Qo(a,c.PATTERN)&&(s=!0)}),e&&!s&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:ie.NO_LINE_BREAKS_FLAGS}),r}function $A(t){const e={},n=je(t);return x(n,r=>{const s=t[r];if(V(s))e[r]=[];else throw Error("non exhaustive match")}),e}function Ru(t){const e=t.PATTERN;if(jt(e))return!1;if(Gt(e))return!0;if(M(e,"exec"))return!0;if(De(e))return!1;throw Error("non exhaustive match")}function BA(t){return De(t)&&t.length===1?t.charCodeAt(0):!1}const GA={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function vu(t,e){if(M(t,"LINE_BREAKS"))return!1;if(jt(t.PATTERN)){try{Qo(e,t.PATTERN)}catch(n){return{issue:ie.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(De(t.PATTERN))return!1;if(Ru(t))return{issue:ie.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function WA(t,e){if(e.issue===ie.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===ie.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Nu(t){return C(t,n=>De(n)?n.charCodeAt(0):n)}function Zo(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const Vr=256;let ii=[];function on(t){return t<Vr?t:ii[t]}function KA(){if(q(ii)){ii=new Array(65536);for(let t=0;t<65536;t++)ii[t]=t>255?255+~~(t/255):t}}function Yr(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function oi(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let Ou=1;const Iu={};function zr(t){const e=jA(t);HA(e),YA(e),VA(e),x(e,n=>{n.isParent=n.categoryMatches.length>0})}function jA(t){let e=Ae(t),n=t,r=!0;for(;r;){n=Gr(ct(C(n,i=>i.CATEGORIES)));const s=Vs(n,e);e=e.concat(s),q(s)?r=!1:n=s}return e}function HA(t){x(t,e=>{Cu(e)||(Iu[Ou]=e,e.tokenTypeIdx=Ou++),bu(e)&&!V(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),bu(e)||(e.CATEGORIES=[]),zA(e)||(e.categoryMatches=[]),qA(e)||(e.categoryMatchesMap={})})}function VA(t){x(t,e=>{e.categoryMatches=[],x(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(Iu[r].tokenTypeIdx)})})}function YA(t){x(t,e=>{Lu([],e)})}function Lu(t,e){x(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),x(e.CATEGORIES,n=>{const r=t.concat(e);xe(r,n)||Lu(r,n)})}function Cu(t){return M(t,"tokenTypeIdx")}function bu(t){return M(t,"CATEGORIES")}function zA(t){return M(t,"categoryMatches")}function qA(t){return M(t,"categoryMatchesMap")}function XA(t){return M(t,"tokenTypeIdx")}const JA={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,s){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var ie;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(ie||(ie={}));const qr={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:JA,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(qr);class _e{constructor(e,n=qr){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(s,i)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${s}>`);const{time:a,value:c}=du(i),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${s}> time: ${a}ms`),this.traceInitIndent--,c}else return i()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=He({},qr,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let s,i=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===qr.lineTerminatorsPattern)this.config.lineTerminatorsPattern=GA;else if(this.config.lineTerminatorCharacters===qr.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),V(e)?s={modes:{defaultMode:Ae(e)},defaultMode:Hr}:(i=!1,s=Ae(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(DA(s,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(FA(s,this.trackStartLines,this.config.lineTerminatorCharacters))})),s.modes=s.modes?s.modes:{},x(s.modes,(a,c)=>{s.modes[c]=Ys(a,l=>Ht(l))});const o=je(s.modes);if(x(s.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(SA(a,o))}),q(this.lexerDefinitionErrors)){zr(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=TA(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=He({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=s.defaultMode,!q(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=C(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}x(this.lexerDefinitionWarning,a=>{fu(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Su?(this.chopInput=qn,this.match=this.matchWithTest):(this.updateLastIndex=de,this.match=this.matchWithExec),i&&(this.handleModes=de),this.trackStartLines===!1&&(this.computeNewColumn=qn),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=de),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Ve(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!q(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{mA()}),this.TRACE_INIT("toFastProperties",()=>{pu(this)})})}tokenize(e,n=this.defaultMode){if(!q(this.lexerDefinitionErrors)){const s=C(this.lexerDefinitionErrors,i=>i.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+s)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,s,i,o,a,c,l,u,h,d,f,p,m,A,S;const y=e,w=y.length;let E=0,T=0;const g=this.hasCustom?0:Math.floor(e.length/10),_=new Array(g),v=[];let R=this.trackStartLines?1:void 0,I=this.trackStartLines?1:void 0;const k=$A(this.emptyGroups),ue=this.trackStartLines,te=this.config.lineTerminatorsPattern;let Ce=0,ve=[],Ge=[];const to=[],Wp=[];Object.freeze(Wp);let Rs;function Kp(){return ve}function jp(be){const ot=on(be),Rr=Ge[ot];return Rr===void 0?Wp:Rr}const XI=be=>{if(to.length===1&&be.tokenType.PUSH_MODE===void 0){const ot=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(be);v.push({offset:be.startOffset,line:be.startLine,column:be.startColumn,length:be.image.length,message:ot})}else{to.pop();const ot=Zn(to);ve=this.patternIdxToConfig[ot],Ge=this.charCodeToPatternIdxToConfig[ot],Ce=ve.length;const Rr=this.canModeBeOptimized[ot]&&this.config.safeMode===!1;Ge&&Rr?Rs=jp:Rs=Kp}};function Hp(be){to.push(be),Ge=this.charCodeToPatternIdxToConfig[be],ve=this.patternIdxToConfig[be],Ce=ve.length,Ce=ve.length;const ot=this.canModeBeOptimized[be]&&this.config.safeMode===!1;Ge&&ot?Rs=jp:Rs=Kp}Hp.call(this,n);let _t;const Vp=this.config.recoveryEnabled;for(;E<w;){c=null;const be=y.charCodeAt(E),ot=Rs(be),Rr=ot.length;for(r=0;r<Rr;r++){_t=ot[r];const Je=_t.pattern;l=null;const tn=_t.short;if(tn!==!1?be===tn&&(c=Je):_t.isCustom===!0?(S=Je.exec(y,E,_,k),S!==null?(c=S[0],S.payload!==void 0&&(l=S.payload)):c=null):(this.updateLastIndex(Je,E),c=this.match(Je,e,E)),c!==null){if(a=_t.longerAlt,a!==void 0){const yn=a.length;for(i=0;i<yn;i++){const nn=ve[a[i]],jn=nn.pattern;if(u=null,nn.isCustom===!0?(S=jn.exec(y,E,_,k),S!==null?(o=S[0],S.payload!==void 0&&(u=S.payload)):o=null):(this.updateLastIndex(jn,E),o=this.match(jn,e,E)),o&&o.length>c.length){c=o,l=u,_t=nn;break}}}break}}if(c!==null){if(h=c.length,d=_t.group,d!==void 0&&(f=_t.tokenTypeIdx,p=this.createTokenInstance(c,E,f,_t.tokenType,R,I,h),this.handlePayload(p,l),d===!1?T=this.addToken(_,T,p):k[d].push(p)),e=this.chopInput(e,h),E=E+h,I=this.computeNewColumn(I,h),ue===!0&&_t.canLineTerminator===!0){let Je=0,tn,yn;te.lastIndex=0;do tn=te.test(c),tn===!0&&(yn=te.lastIndex-1,Je++);while(tn===!0);Je!==0&&(R=R+Je,I=h-yn,this.updateTokenEndLineColumnLocation(p,d,yn,Je,R,I,h))}this.handleModes(_t,XI,Hp,p)}else{const Je=E,tn=R,yn=I;let nn=Vp===!1;for(;nn===!1&&E<w;)for(e=this.chopInput(e,1),E++,s=0;s<Ce;s++){const jn=ve[s],Ic=jn.pattern,Yp=jn.short;if(Yp!==!1?y.charCodeAt(E)===Yp&&(nn=!0):jn.isCustom===!0?nn=Ic.exec(y,E,_,k)!==null:(this.updateLastIndex(Ic,E),nn=Ic.exec(e)!==null),nn===!0)break}if(m=E-Je,I=this.computeNewColumn(I,m),A=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(y,Je,m,tn,yn),v.push({offset:Je,line:tn,column:yn,length:m,message:A}),Vp===!1)break}}return this.hasCustom||(_.length=T),{tokens:_,groups:k,errors:v}}handleModes(e,n,r,s){if(e.pop===!0){const i=e.push;n(s),i!==void 0&&r.call(this,i)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,s,i,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,s===1&&c===!0||(e.endLine=i+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,s){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:s}}createStartOnlyToken(e,n,r,s,i,o){return{image:e,startOffset:n,startLine:i,startColumn:o,tokenTypeIdx:r,tokenType:s}}createFullToken(e,n,r,s,i,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:i,endLine:i,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:s}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}}_e.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",_e.NA=/NOT_APPLICABLE/;function Xr(t){return ku(t)?t.LABEL:t.name}function ku(t){return De(t.LABEL)&&t.LABEL!==""}const QA="parent",Mu="categories",xu="label",Uu="group",Pu="push_mode",Du="pop_mode",Fu="longer_alt",$u="line_breaks",Bu="start_chars_hint";function D(t){return ZA(t)}function ZA(t){const e=t.pattern,n={};if(n.name=t.name,Ht(e)||(n.PATTERN=e),M(t,QA))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return M(t,Mu)&&(n.CATEGORIES=t[Mu]),zr([n]),M(t,xu)&&(n.LABEL=t[xu]),M(t,Uu)&&(n.GROUP=t[Uu]),M(t,Du)&&(n.POP_MODE=t[Du]),M(t,Pu)&&(n.PUSH_MODE=t[Pu]),M(t,Fu)&&(n.LONGER_ALT=t[Fu]),M(t,$u)&&(n.LINE_BREAKS=t[$u]),M(t,Bu)&&(n.START_CHARS_HINT=t[Bu]),n}const Ln=D({name:"EOF",pattern:_e.NA});zr([Ln]);function ai(t,e,n,r,s,i,o,a){return{image:e,startOffset:n,endOffset:r,startLine:s,endLine:i,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function ew(t,e){return Yr(t,e)}const Gu={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${ku(t)?`--> ${Xr(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:s}){const i="Expecting: ",a=`
but found: '`+ut(e).image+"'";if(r)return i+r+a;{const c=Ve(t,(d,f)=>d.concat(f),[]),l=C(c,d=>`[${C(d,f=>Xr(f)).join(", ")}]`),h=`one of these possible Token sequences:
${C(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return i+h+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const s="Expecting: ",o=`
but found: '`+ut(e).image+"'";if(n)return s+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${C(t,l=>`[${C(l,u=>Xr(u)).join(",")}]`).join(" ,")}>`;return s+c+o}}};Object.freeze(Gu);const tw={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Cn={buildDuplicateFoundError(t,e){function n(u){return u instanceof ne?u.terminalType.name:u instanceof Ye?u.nonTerminalName:""}const r=t.name,s=ut(e),i=s.idx,o=Nt(s),a=n(s),c=i>0;let l=`->${o}${c?i:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=C(t.prefixPath,s=>Xr(s)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=C(t.prefixPath,s=>Xr(s)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=Nt(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=C(t.leftRecursionPath,i=>i.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof tr?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function nw(t,e){const n=new rw(t,e);return n.resolveRefs(),n.errors}class rw extends nr{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){x(pe(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Ue.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class sw extends Xs{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Ae(this.path.ruleStack).reverse(),this.occurrenceStack=Ae(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const s=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,s)}}updateExpectedNext(){q(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class iw extends sw{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const s=n.concat(r),i=new Fe({definition:s});this.possibleTokTypes=Kr(i),this.found=!0}}}class ci extends Xs{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class ow extends ci{walkMany(e,n,r){if(e.idx===this.occurrence){const s=ut(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof ne&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkMany(e,n,r)}}class Wu extends ci{walkManySep(e,n,r){if(e.idx===this.occurrence){const s=ut(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof ne&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkManySep(e,n,r)}}class aw extends ci{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const s=ut(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof ne&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOne(e,n,r)}}class Ku extends ci{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const s=ut(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof ne&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOneSep(e,n,r)}}function ea(t,e,n=[]){n=Ae(n);let r=[],s=0;function i(a){return a.concat(we(t,s+1))}function o(a){const c=ea(i(a),e,n);return r.concat(c)}for(;n.length<e&&s<t.length;){const a=t[s];if(a instanceof Fe)return o(a.definition);if(a instanceof Ye)return o(a.definition);if(a instanceof $e)r=o(a.definition);else if(a instanceof Rt){const c=a.definition.concat([new ge({definition:a.definition})]);return o(c)}else if(a instanceof vt){const c=[new Fe({definition:a.definition}),new ge({definition:[new ne({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof ft){const c=a.definition.concat([new ge({definition:[new ne({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof ge){const c=a.definition.concat([new ge({definition:a.definition})]);r=o(c)}else{if(a instanceof dt)return x(a.definition,c=>{q(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof ne)n.push(a.terminalType);else throw Error("non exhaustive match")}s++}return r.push({partialPath:n,suffixDef:we(t,s)}),r}function ju(t,e,n,r){const s="EXIT_NONE_TERMINAL",i=[s],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!q(h);){const d=h.pop();if(d===o){a&&Zn(h).idx<=l&&h.pop();continue}const f=d.def,p=d.idx,m=d.ruleStack,A=d.occurrenceStack;if(q(f))continue;const S=f[0];if(S===s){const y={idx:p,def:we(f),ruleStack:Wr(m),occurrenceStack:Wr(A)};h.push(y)}else if(S instanceof ne)if(p<c-1){const y=p+1,w=e[y];if(n(w,S.terminalType)){const E={idx:y,def:we(f),ruleStack:m,occurrenceStack:A};h.push(E)}}else if(p===c-1)u.push({nextTokenType:S.terminalType,nextTokenOccurrence:S.idx,ruleStack:m,occurrenceStack:A}),a=!0;else throw Error("non exhaustive match");else if(S instanceof Ye){const y=Ae(m);y.push(S.nonTerminalName);const w=Ae(A);w.push(S.idx);const E={idx:p,def:S.definition.concat(i,we(f)),ruleStack:y,occurrenceStack:w};h.push(E)}else if(S instanceof $e){const y={idx:p,def:we(f),ruleStack:m,occurrenceStack:A};h.push(y),h.push(o);const w={idx:p,def:S.definition.concat(we(f)),ruleStack:m,occurrenceStack:A};h.push(w)}else if(S instanceof Rt){const y=new ge({definition:S.definition,idx:S.idx}),w=S.definition.concat([y],we(f)),E={idx:p,def:w,ruleStack:m,occurrenceStack:A};h.push(E)}else if(S instanceof vt){const y=new ne({terminalType:S.separator}),w=new ge({definition:[y].concat(S.definition),idx:S.idx}),E=S.definition.concat([w],we(f)),T={idx:p,def:E,ruleStack:m,occurrenceStack:A};h.push(T)}else if(S instanceof ft){const y={idx:p,def:we(f),ruleStack:m,occurrenceStack:A};h.push(y),h.push(o);const w=new ne({terminalType:S.separator}),E=new ge({definition:[w].concat(S.definition),idx:S.idx}),T=S.definition.concat([E],we(f)),g={idx:p,def:T,ruleStack:m,occurrenceStack:A};h.push(g)}else if(S instanceof ge){const y={idx:p,def:we(f),ruleStack:m,occurrenceStack:A};h.push(y),h.push(o);const w=new ge({definition:S.definition,idx:S.idx}),E=S.definition.concat([w],we(f)),T={idx:p,def:E,ruleStack:m,occurrenceStack:A};h.push(T)}else if(S instanceof dt)for(let y=S.definition.length-1;y>=0;y--){const w=S.definition[y],E={idx:p,def:w.definition.concat(we(f)),ruleStack:m,occurrenceStack:A};h.push(E),h.push(o)}else if(S instanceof Fe)h.push({idx:p,def:S.definition.concat(we(f)),ruleStack:m,occurrenceStack:A});else if(S instanceof tr)h.push(cw(S,p,m,A));else throw Error("non exhaustive match")}return u}function cw(t,e,n,r){const s=Ae(n);s.push(t.name);const i=Ae(r);return i.push(1),{idx:e,def:t.definition,ruleStack:s,occurrenceStack:i}}var oe;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(oe||(oe={}));function Hu(t){if(t instanceof $e||t==="Option")return oe.OPTION;if(t instanceof ge||t==="Repetition")return oe.REPETITION;if(t instanceof Rt||t==="RepetitionMandatory")return oe.REPETITION_MANDATORY;if(t instanceof vt||t==="RepetitionMandatoryWithSeparator")return oe.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof ft||t==="RepetitionWithSeparator")return oe.REPETITION_WITH_SEPARATOR;if(t instanceof dt||t==="Alternation")return oe.ALTERNATION;throw Error("non exhaustive match")}function lw(t,e,n,r,s,i){const o=na(t,e,n),a=qu(o)?oi:Yr;return i(o,r,a,s)}function uw(t,e,n,r,s,i){const o=ra(t,e,s,n),a=qu(o)?oi:Yr;return i(o[0],a,r)}function hw(t,e,n,r){const s=t.length,i=lt(t,o=>lt(o,a=>a.length===1));if(e)return function(o){const a=C(o,c=>c.GATE);for(let c=0;c<s;c++){const l=t[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let d=0;d<u;d++){const f=l[d],p=f.length;for(let m=0;m<p;m++){const A=this.LA(m+1);if(n(A,f[m])===!1)continue e}return c}}};if(i&&!r){const o=C(t,c=>ct(c)),a=Ve(o,(c,l,u)=>(x(l,h=>{M(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),x(h.categoryMatches,d=>{M(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<s;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue e}return o}}}}function fw(t,e,n){const r=lt(t,i=>i.length===1),s=t.length;if(r&&!n){const i=ct(t);if(i.length===1&&q(i[0].categoryMatches)){const a=i[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Ve(i,(a,c,l)=>(a[c.tokenTypeIdx]=!0,x(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let i=0;i<s;i++){const o=t[i],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class dw extends Xs{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,s){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(s),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,oe.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,oe.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,oe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,oe.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,oe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class Vu extends nr{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,oe.OPTION)}visitRepetition(e){this.checkIsTarget(e,oe.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,oe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,oe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,oe.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,oe.ALTERNATION)}}function Yu(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function ta(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],s=[];for(let i=0;i<e.length;i++){const o=e[i];s.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];s.push(o+c)}}e=s}return e}function pw(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const s=t[r];for(let i=0;i<e.length;i++){const o=e[i];if(s[o]===!0)return!1}}return!0}function zu(t,e){const n=C(t,o=>ea([o],1)),r=Yu(n.length),s=C(n,o=>{const a={};return x(o,c=>{const l=ta(c.partialPath);x(l,u=>{a[u]=!0})}),a});let i=n;for(let o=1;o<=e;o++){const a=i;i=Yu(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=ta(h);if(pw(s,f,c)||q(d)||h.length===e){const m=r[c];if(sa(m,h)===!1){m.push(h);for(let A=0;A<f.length;A++){const S=f[A];s[c][S]=!0}}}else{const m=ea(d,o+1,h);i[c]=i[c].concat(m),x(m,A=>{const S=ta(A.partialPath);x(S,y=>{s[c][y]=!0})})}}}}return r}function na(t,e,n,r){const s=new Vu(t,oe.ALTERNATION,r);return e.accept(s),zu(s.result,n)}function ra(t,e,n,r){const s=new Vu(t,n);e.accept(s);const i=s.result,a=new dw(e,t,n).startWalking(),c=new Fe({definition:i}),l=new Fe({definition:a});return zu([c,l],r)}function sa(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let s=0;s<r.length;s++){const i=e[s],o=r[s];if((i===o||o.categoryMatchesMap[i.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function gw(t,e){return t.length<e.length&&lt(t,(n,r)=>{const s=e[r];return n===s||s.categoryMatchesMap[n.tokenTypeIdx]})}function qu(t){return lt(t,e=>lt(e,n=>lt(n,r=>q(r.categoryMatches))))}function mw(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return C(e,n=>Object.assign({type:Ue.CUSTOM_LOOKAHEAD_VALIDATION},n))}function Ew(t,e,n,r){const s=nt(t,c=>_w(c,n)),i=Cw(t,e,n),o=nt(t,c=>Nw(c,n)),a=nt(t,c=>Sw(c,t,r,n));return s.concat(i,o,a)}function _w(t,e){const n=new Tw;t.accept(n);const r=n.allProductions,s=CS(r,yw),i=ht(s,a=>a.length>1);return C(pe(i),a=>{const c=ut(a),l=e.buildDuplicateFoundError(t,a),u=Nt(c),h={message:l,type:Ue.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=Xu(c);return d&&(h.parameter=d),h})}function yw(t){return`${Nt(t)}_#_${t.idx}_#_${Xu(t)}`}function Xu(t){return t instanceof ne?t.terminalType.name:t instanceof Ye?t.nonTerminalName:""}class Tw extends nr{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function Sw(t,e,n,r){const s=[];if(Ve(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});s.push({message:o,type:Ue.DUPLICATE_RULE_NAME,ruleName:t.name})}return s}function Aw(t,e,n){const r=[];let s;return xe(e,t)||(s=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:s,type:Ue.INVALID_RULE_OVERRIDE,ruleName:t})),r}function Ju(t,e,n,r=[]){const s=[],i=li(e.definition);if(q(i))return[];{const o=t.name;xe(i,t)&&s.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Ue.LEFT_RECURSION,ruleName:o});const c=Vs(i,r.concat([t])),l=nt(c,u=>{const h=Ae(r);return h.push(u),Ju(t,u,n,h)});return s.concat(l)}}function li(t){let e=[];if(q(t))return e;const n=ut(t);if(n instanceof Ye)e.push(n.referencedRule);else if(n instanceof Fe||n instanceof $e||n instanceof Rt||n instanceof vt||n instanceof ft||n instanceof ge)e=e.concat(li(n.definition));else if(n instanceof dt)e=ct(C(n.definition,i=>li(i.definition)));else if(!(n instanceof ne))throw Error("non exhaustive match");const r=qs(n),s=t.length>1;if(r&&s){const i=we(t);return e.concat(li(i))}else return e}class ia extends nr{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function ww(t,e){const n=new ia;t.accept(n);const r=n.alternations;return nt(r,i=>{const o=Wr(i.definition);return nt(o,(a,c)=>{const l=ju([a],[],Yr,1);return q(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:i,emptyChoiceIdx:c}),type:Ue.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:i.idx,alternative:c+1}]:[]})})}function Rw(t,e,n){const r=new ia;t.accept(r);let s=r.alternations;return s=Ys(s,o=>o.ignoreAmbiguities===!0),nt(s,o=>{const a=o.idx,c=o.maxLookahead||e,l=na(a,t,c,o),u=Iw(l,o,t,n),h=Lw(l,o,t,n);return u.concat(h)})}class vw extends nr{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function Nw(t,e){const n=new ia;t.accept(n);const r=n.alternations;return nt(r,i=>i.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:i}),type:Ue.TOO_MANY_ALTS,ruleName:t.name,occurrence:i.idx}]:[])}function Ow(t,e,n){const r=[];return x(t,s=>{const i=new vw;s.accept(i);const o=i.allProductions;x(o,a=>{const c=Hu(a),l=a.maxLookahead||e,u=a.idx,d=ra(u,s,c,l)[0];if(q(ct(d))){const f=n.buildEmptyRepetitionError({topLevelRule:s,repetition:a});r.push({message:f,type:Ue.NO_NON_EMPTY_LOOKAHEAD,ruleName:s.name})}})}),r}function Iw(t,e,n,r){const s=[],i=Ve(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||x(c,u=>{const h=[l];x(t,(d,f)=>{l!==f&&sa(d,u)&&e.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!sa(s,u)&&(s.push(u),a.push({alts:h,path:u}))}),a),[]);return C(i,a=>{const c=C(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Ue.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function Lw(t,e,n,r){const s=Ve(t,(o,a,c)=>{const l=C(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Gr(nt(s,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=tt(s,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&gw(d.path,l));return C(u,d=>{const f=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:f,prefixPath:d.path}),type:Ue.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function Cw(t,e,n){const r=[],s=C(e,i=>i.name);return x(t,i=>{const o=i.name;if(xe(s,o)){const a=n.buildNamespaceConflictError(i);r.push({message:a,type:Ue.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function bw(t){const e=Ho(t,{errMsgProvider:tw}),n={};return x(t.rules,r=>{n[r.name]=r}),nw(n,e.errMsgProvider)}function kw(t){return t=Ho(t,{errMsgProvider:Cn}),Ew(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const Qu="MismatchedTokenException",Zu="NoViableAltException",eh="EarlyExitException",th="NotAllInputParsedException",nh=[Qu,Zu,eh,th];Object.freeze(nh);function ui(t){return xe(nh,t.name)}class hi extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class rh extends hi{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Qu}}class Mw extends hi{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Zu}}class xw extends hi{constructor(e,n){super(e,n),this.name=th}}class Uw extends hi{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=eh}}const oa={},sh="InRuleRecoveryException";class Pw extends Error{constructor(e){super(e),this.name=sh}}class Dw{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=M(e,"recoveryEnabled")?e.recoveryEnabled:Vt.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Fw)}getTokenToInsert(e){const n=ai(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,s){const i=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:s,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new rh(f,l,this.LA(0));p.resyncedTokens=Wr(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,s)){h();return}else if(r.call(this)){h(),e.apply(this,n);return}else this.tokenMatcher(u,i)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new Pw("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||q(n))return!1;const r=this.LA(1);return er(n,i=>this.tokenMatcher(r,i))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return xe(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const s=er(e,i=>ew(n,i));if(s!==void 0)return s;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return oa;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return C(e,(r,s)=>s===0?oa:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[s],inRule:this.shortRuleNameToFullName(e[s-1])})}flattenFollowSet(){const e=C(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return ct(e)}getFollowSetFromFollowKey(e){if(e===oa)return[Ln];const n=e.ruleName+e.idxInCallingRule+mu+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,Ln)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Wr(n)}attemptInRepetitionRecovery(e,n,r,s,i,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),s=Ae(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:s,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return C(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function Fw(t,e,n,r,s,i,o){const a=this.getKeyForAutomaticLookahead(r,s);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new i(f,s).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=Ln,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const $w=4,an=8,ih=1<<an,oh=2<<an,aa=3<<an,ca=4<<an,la=5<<an,fi=6<<an;function ua(t,e,n){return n|e|t}class Bw{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:Vt.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(q(n)){const r=this.validateEmptyOrAlternatives(e.rules),s=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),i=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...s,...i]}return n}validateNoLeftRecursion(e){return nt(e,n=>Ju(n,n,Cn))}validateEmptyOrAlternatives(e){return nt(e,n=>ww(n,Cn))}validateAmbiguousAlternationAlternatives(e,n){return nt(e,r=>Rw(r,n,Cn))}validateSomeNonEmptyLookaheadPath(e,n){return Ow(e,n,Cn)}buildLookaheadForAlternation(e){return lw(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,hw)}buildLookaheadForOptional(e){return uw(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Hu(e.prodType),fw)}}class Gw{initLooksAhead(e){this.dynamicTokensEnabled=M(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Vt.dynamicTokensEnabled,this.maxLookahead=M(e,"maxLookahead")?e.maxLookahead:Vt.maxLookahead,this.lookaheadStrategy=M(e,"lookaheadStrategy")?e.lookaheadStrategy:new Bw({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){x(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:s,option:i,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=Kw(n);x(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Nt(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=ua(this.fullRuleNameToShort[n.name],ih,l.idx);this.setLaFuncCache(d,h)})}),x(s,l=>{this.computeLookaheadFunc(n,l.idx,aa,"Repetition",l.maxLookahead,Nt(l))}),x(i,l=>{this.computeLookaheadFunc(n,l.idx,oh,"Option",l.maxLookahead,Nt(l))}),x(o,l=>{this.computeLookaheadFunc(n,l.idx,ca,"RepetitionMandatory",l.maxLookahead,Nt(l))}),x(a,l=>{this.computeLookaheadFunc(n,l.idx,fi,"RepetitionMandatoryWithSeparator",l.maxLookahead,Nt(l))}),x(c,l=>{this.computeLookaheadFunc(n,l.idx,la,"RepetitionWithSeparator",l.maxLookahead,Nt(l))})})})}computeLookaheadFunc(e,n,r,s,i,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:i||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:s}),c=ua(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return ua(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class Ww extends nr{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const di=new Ww;function Kw(t){di.reset(),t.accept(di);const e=di.dslMethods;return di.reset(),e}function ah(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function ch(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function jw(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function Hw(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const Vw="name";function lh(t,e){Object.defineProperty(t,Vw,{enumerable:!1,configurable:!0,writable:!1,value:e})}function Yw(t,e){const n=je(t),r=n.length;for(let s=0;s<r;s++){const i=n[s],o=t[i],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function zw(t,e){const n=function(){};lh(n,t+"BaseSemantics");const r={visit:function(s,i){if(V(s)&&(s=s[0]),!Ht(s))return this[s.name](s.children,i)},validateVisitor:function(){const s=Xw(this,e);if(!q(s)){const i=C(s,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${i.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function qw(t,e,n){const r=function(){};lh(r,t+"BaseSemanticsWithDefaults");const s=Object.create(n.prototype);return x(e,i=>{s[i]=Yw}),r.prototype=s,r.prototype.constructor=r,r}var ha;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(ha||(ha={}));function Xw(t,e){return Jw(t,e)}function Jw(t,e){const n=tt(e,s=>Gt(t[s])===!1),r=C(n,s=>({msg:`Missing visitor method: <${s}> on ${t.constructor.name} CST Visitor.`,type:ha.MISSING_METHOD,methodName:s}));return Gr(r)}class Qw{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=M(e,"nodeLocationTracking")?e.nodeLocationTracking:Vt.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=de,this.cstFinallyStateUpdate=de,this.cstPostTerminal=de,this.cstPostNonTerminal=de,this.cstPostRule=de;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=ch,this.setNodeLocationFromNode=ch,this.cstPostRule=de,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=de,this.setNodeLocationFromNode=de,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=ah,this.setNodeLocationFromNode=ah,this.cstPostRule=de,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=de,this.setNodeLocationFromNode=de,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=de,this.setNodeLocationFromNode=de,this.cstPostRule=de,this.setInitialNodeLocation=de;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];jw(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];Hw(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Ht(this.baseCstVisitorConstructor)){const e=zw(this.className,je(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Ht(this.baseCstVisitorWithDefaultsConstructor)){const e=qw(this.className,je(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class Zw{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):mi}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?mi:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class eR{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=Ei){if(xe(this.definedRulesNames,e)){const o={message:Cn.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Ue.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const s=this.defineRule(e,n,r);return this[e]=s,s}OVERRIDE_RULE(e,n,r=Ei){const s=Aw(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(s);const i=this.defineRule(e,n,r);return this[e]=i,i}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(s){if(ui(s))return!1;throw s}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return nA(pe(this.gastProductionsCache))}}class tR{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=oi,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},M(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(V(e)){if(q(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(V(e))this.tokensMap=Ve(e,(i,o)=>(i[o.name]=o,i),{});else if(M(e,"modes")&&lt(ct(pe(e.modes)),XA)){const i=ct(pe(e.modes)),o=Vo(i);this.tokensMap=Ve(o,(a,c)=>(a[c.name]=c,a),{})}else if(et(e))this.tokensMap=Ae(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Ln;const r=M(e,"modes")?ct(pe(e.modes)):pe(e),s=lt(r,i=>q(i.categoryMatches));this.tokenMatcher=s?oi:Yr,zr(pe(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const s=M(r,"resyncEnabled")?r.resyncEnabled:Ei.resyncEnabled,i=M(r,"recoveryValueFunc")?r.recoveryValueFunc:Ei.recoveryValueFunc,o=this.ruleShortNameIdx<<$w+an;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const s=this.RULE_STACK.length===1,i=n&&!this.isBackTracking()&&this.recoveryEnabled;if(ui(e)){const o=e;if(i){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(s)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(oh,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof e!="function"){i=e.DEF;const o=e.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=e;if(s.call(this)===!0)return i.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(ca,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const o=n.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=n;if(s.call(this)===!0){let o=this.doSingleRepetition(i);for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i)}else throw this.raiseEarlyExitException(e,oe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],s,ca,e,aw)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(fi,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,i,a,s,Ku],a,fi,e,Ku)}else throw this.raiseEarlyExitException(e,oe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(aa,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const a=n.GATE;if(a!==void 0){const c=s;s=()=>a.call(this)&&c.call(this)}}else i=n;let o=!0;for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],s,aa,e,ow,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(la,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,i,a,s,Wu],a,la,e,Wu)}}repetitionSepSecondInternal(e,n,r,s,i){for(;r();)this.CONSUME(n),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,s,i],r,fi,e,i)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(ih,n),s=V(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,s);if(o!==void 0)return s[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new xw(n,e))}}subruleInternal(e,n,r){let s;try{const i=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,s=e.apply(this,i),this.cstPostNonTerminal(s,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),s}catch(i){throw this.subruleInternalError(i,r,e.ruleName)}}subruleInternalError(e,n,r){throw ui(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let s;try{const i=this.LA(1);this.tokenMatcher(i,e)===!0?(this.consumeToken(),s=i):this.consumeInternalError(e,i,r)}catch(i){s=this.consumeInternalRecovery(e,n,i)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,s),s}consumeInternalError(e,n,r){let s;const i=this.LA(0);throw r!==void 0&&r.ERR_MSG?s=r.ERR_MSG:s=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new rh(s,n,i))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const s=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,s)}catch(i){throw i.name===sh?r:i}}else throw r}saveRecogState(){const e=this.errors,n=Ae(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Ln)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class nR{initErrorHandler(e){this._errors=[],this.errorMessageProvider=M(e,"errorMessageProvider")?e.errorMessageProvider:Vt.errorMessageProvider}SAVE_ERROR(e){if(ui(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Ae(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Ae(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const s=this.getCurrRuleFullName(),i=this.getGAstProductions()[s],a=ra(e,i,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:s});throw this.SAVE_ERROR(new Uw(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),s=this.getGAstProductions()[r],i=na(e,s,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Mw(c,this.LA(1),a))}}class rR{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Ht(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return ju([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=ut(e.ruleStack),s=this.getGAstProductions()[n];return new iw(s,e).startWalking()}}const pi={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(pi);const uh=!0,hh=Math.pow(2,an)-1,fh=D({name:"RECORDING_PHASE_TOKEN",pattern:_e.NA});zr([fh]);const dh=ai(fh,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(dh);const sR={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class iR{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,s){return this.consumeInternalRecord(r,e,s)},this[`SUBRULE${n}`]=function(r,s){return this.subruleInternalRecord(r,e,s)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return mi}topLevelRuleRecord(e,n){try{const r=new tr({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Jr.call(this,$e,e,n)}atLeastOneInternalRecord(e,n){Jr.call(this,Rt,n,e)}atLeastOneSepFirstInternalRecord(e,n){Jr.call(this,vt,n,e,uh)}manyInternalRecord(e,n){Jr.call(this,ge,n,e)}manySepFirstInternalRecord(e,n){Jr.call(this,ft,n,e,uh)}orInternalRecord(e,n){return oR.call(this,e,n)}subruleInternalRecord(e,n,r){if(gi(n),!e||M(e,"ruleName")===!1){const a=new Error(`<SUBRULE${ph(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const s=Zn(this.recordingProdStack),i=e.ruleName,o=new Ye({idx:n,nonTerminalName:i,label:r==null?void 0:r.LABEL,referencedRule:void 0});return s.definition.push(o),this.outputCst?sR:pi}consumeInternalRecord(e,n,r){if(gi(n),!Cu(e)){const o=new Error(`<CONSUME${ph(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const s=Zn(this.recordingProdStack),i=new ne({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return s.definition.push(i),dh}}function Jr(t,e,n,r=!1){gi(n);const s=Zn(this.recordingProdStack),i=Gt(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),M(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),i.call(this),s.definition.push(o),this.recordingProdStack.pop(),pi}function oR(t,e){gi(e);const n=Zn(this.recordingProdStack),r=V(t)===!1,s=r===!1?t:t.DEF,i=new dt({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});M(t,"MAX_LOOKAHEAD")&&(i.maxLookahead=t.MAX_LOOKAHEAD);const o=hu(s,a=>Gt(a.GATE));return i.hasPredicates=o,n.definition.push(i),x(s,a=>{const c=new Fe({definition:[]});i.definition.push(c),M(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:M(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),pi}function ph(t){return t===0?"":`${t}`}function gi(t){if(t<0||t>hh){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${hh+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class aR{initPerformanceTracer(e){if(M(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Vt.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:s,value:i}=du(n),o=s>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${s}ms`),this.traceInitIndent--,i}else return n()}}function cR(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(s=>{if(s==="constructor")return;const i=Object.getOwnPropertyDescriptor(r,s);i&&(i.get||i.set)?Object.defineProperty(t.prototype,s,i):t.prototype[s]=n.prototype[s]})})}const mi=ai(Ln,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(mi);const Vt=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Gu,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Ei=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Ue;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Ue||(Ue={}));class Qr{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{pu(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),x(this.definedRulesNames,s=>{const o=this[s].originalGrammarAction;let a;this.TRACE_INIT(`${s} Rule`,()=>{a=this.topLevelRuleRecord(s,o)}),this.gastProductionsCache[s]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=bw({rules:pe(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(q(r)&&this.skipValidations===!1){const s=kw({rules:pe(this.gastProductionsCache),tokenTypes:pe(this.tokensMap),errMsgProvider:Cn,grammarName:n}),i=mw({lookaheadStrategy:this.lookaheadStrategy,rules:pe(this.gastProductionsCache),tokenTypes:pe(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(s,i)}}),q(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const s=lA(pe(this.gastProductionsCache));this.resyncFollows=s}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var s,i;(i=(s=this.lookaheadStrategy).initialize)===null||i===void 0||i.call(s,{rules:pe(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(pe(this.gastProductionsCache))})),!Qr.DEFER_DEFINITION_ERRORS_HANDLING&&!q(this.definitionErrors))throw e=C(this.definitionErrors,s=>s.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),M(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=M(n,"skipValidations")?n.skipValidations:Vt.skipValidations}}Qr.DEFER_DEFINITION_ERRORS_HANDLING=!1,cR(Qr,[Dw,Gw,Qw,Zw,tR,eR,nR,rR,iR,aR]);class lR extends Qr{constructor(e,n=Vt){const r=Ae(n);r.outputCst=!0,super(e,r)}}const Ot=!!JSON.parse("false");JSON.parse("false");const uR=!!JSON.parse("false"),fa=go(32,126).map(t=>String.fromCharCode(t)),Zr=D({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),hR=D({name:"Whitespace",pattern:/ +/,group:_e.SKIPPED}),fR=D({name:"Whitespace",pattern:/\s+/,line_breaks:!0,group:_e.SKIPPED}),da=D({name:"Stat",pattern:/@.*/,start_chars_hint:["@"]}),pt=D({name:"Command",pattern:/#/,start_chars_hint:["#"]});let gh=!1;function dR(t,e,n){if(!gh)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Zr)return null;let s=e;for(;t[s]===" ";)s++;if("@#/?':!".includes(t[s]))return null;let i=e+1;for(;i<t.length&&t[i]!==`
`;)i++;return[t.substring(e,i)]}const mh=D({name:"Text",pattern:dR,line_breaks:!1,start_chars_hint:fa.filter(t=>"@#/?':!".includes(t)===!1)}),Eh=D({name:"Comment",pattern:/'.*/,start_chars_hint:["'"]}),_h=D({name:"Label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),yh=D({name:"HyperLink",pattern:/!/,start_chars_hint:["!"]}),Th=D({name:"HyperLinkText",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),ze=D({name:"StringLiteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:fa}),Sh=D({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Ah=D({name:"NumberLiteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/});function rt(t){return D({name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:ze})}const wh=D({name:"IsEq",pattern:/=|is|eq|equal/,longer_alt:ze}),Rh=D({name:"IsNotEq",pattern:/!=|not ?eq|not ?equal/,longer_alt:ze}),vh=D({name:"IsLessThan",pattern:/<|below/,longer_alt:ze}),Nh=D({name:"IsGreaterThan",pattern:/>|above/,longer_alt:ze}),Oh=D({name:"IsLessThanOrEqual",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:ze}),Ih=D({name:"IsGreaterThanOrEqual",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:ze}),pa=D({name:"Or",pattern:/or/i,longer_alt:ze}),ga=D({name:"Not",pattern:/not/i,longer_alt:ze}),ma=D({name:"And",pattern:/and/i,longer_alt:ze}),Ea=D({name:"Plus",pattern:/\+/}),_a=D({name:"Minus",pattern:/-/}),Lh=D({name:"Power",pattern:/\*\*/}),Ch=D({name:"Multiply",pattern:/\*/}),ya=D({name:"Divide",pattern:/\//}),bh=D({name:"ModDivide",pattern:/%/}),kh=D({name:"FloorDivide",pattern:/%%/}),Mh=D({name:"Query",pattern:/\?/}),xh=D({name:"LParen",pattern:/\(/,push_mode:"ignore_newlines"}),Uh=D({name:"RParen",pattern:/\)/,pop_mode:!0}),Ph=D({name:"play",pattern:/play .*/,start_chars_hint:fa,longer_alt:ze}),Ta=rt("if"),bn=rt("do"),Sa=rt("else"),Dh=rt("endif"),Fh=rt("while"),$h=rt("endwhile"),Bh=rt("repeat"),Gh=rt("endrepeat"),Wh=rt("read"),Kh=rt("endread"),jh=rt("break"),Hh=rt("continue");function Vh(t){return[...t,wh,Rh,Oh,vh,Ih,Nh,pa,ga,ma,Ea,_a,Lh,Ch,ya,kh,bh,Mh,xh,Uh,Sh,ze,Ah]}const Yh=Vh([mh,da,Ph,pt,Eh,_h,yh,Th,Zr,hR,Ta,bn,Sa,Dh,Fh,$h,Bh,Gh,Wh,Kh,jh,Hh]),pR=new _e({defaultMode:"use_newlines",modes:{use_newlines:Yh,ignore_newlines:Vh([fR])}},{skipValidations:!Ot,ensureOptimizations:Ot});function Aa(t){gh=!0;const e=pR.tokenize(t||` 
`),[n]=(Array.isArray(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(ai(Zr,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}var qe=(t=>(t[t.ERROR=0]="ERROR",t[t.FUNC=1]="FUNC",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(qe||{});function It(t,e){return{id:Ft(),code:t,...e}}function gR(t){return t.map(e=>e.image)}function mR(t,e){const[n,r,...s]=e;if(P(t.stats)&&P(n))switch(n.image.toLowerCase()){case"rn":case"range":case"sl":case"select":case"nm":case"number":case"tx":case"text":case"ln":case"link":if(P(r)){const i=r.image.toLowerCase();t.stats[i]=gR(s??[])}break}}function zh(t){var n;if(!P(t))return{};if(P((n=t.stats)==null?void 0:n.type))return t.stats;t.stats={};const e=Aa(t.code);for(let r=0;r<e.tokens.length;++r){const s=e.tokens[r];if(s.tokenType===da){const[i,...o]=s.image.slice(1).split(" "),a=o.join(" ");switch(i.toLowerCase()){case"stat":{const c=Aa(`!${a}`);c.tokens.length&&mR(t,c.tokens);break}case"flags":t.stats.flags=a;break;case"func":t.stats.type=1,t.stats.name=a;break;case"board":t.stats.type=2,t.stats.name=a;break;case"object":t.stats.type=3,t.stats.name=a;break;case"terrain":t.stats.type=4,t.stats.name=a;break;case"charset":t.stats.type=5,t.stats.name=a;break;case"palette":t.stats.type=6,t.stats.name=a;break;default:t.stats.type=3,t.stats.name=[i,...o].join(" ");break}}}return P(t.stats.type)||(t.stats.type=3),t.stats}function ER(t){return zh(t).type??0}function _R(t){return(zh(t).name??"").toLowerCase()}function qh(t,e){return{id:Ft(),name:t,pages:e,flags:{},players:{}}}function wa(t,e,n){if(!L(t))return;const r=n.toLowerCase();return t.pages.find(i=>ER(i)===e&&(i.id===n||r===_R(i)))}function Ra(t,e,n){const r=wa(t,e,n);if(r)switch(e){case qe.ERROR:return r.error;case qe.FUNC:return r.code;case qe.BOARD:return r.board;case qe.OBJECT:return r.object;case qe.TERRAIN:return r.terrain;case qe.CHARSET:return r.charset;case qe.PALETTE:return r.palette}}function va(t,e){const n=e??"",r=wa(t,qe.OBJECT,n),s=Ra(t,qe.OBJECT,n);return L(r)?{...s,name:n,code:r.code}:void 0}function es(t,e){if(P(e)&&P(e.kind))return P(e.kinddata)||(e.kinddata=va(t,e.kind)),e.kinddata}function Xh(t,e){const n=e??"",r=wa(t,qe.TERRAIN,n),s=Ra(t,qe.TERRAIN,n);return L(r)?{...s,name:n,code:r.code}:void 0}function Jh(t,e){if(P(e)&&P(e.kind))return P(e.kinddata)||(e.kinddata=Xh(t,e.kind)),e.kinddata}function sr(t,e){return Ra(t,qe.BOARD,e)}function Qh(t,e){if(t)return t.flags[e]=t.flags[e]??{},t.flags[e]}function yR(t,e,n){const r=Qh(t,e);return r==null?void 0:r[n]}function TR(t,e,n,r){const s=Qh(t,e);return s&&(s[n]=r),r}function Zh(t,e){return sr(t,(t==null?void 0:t.players[e])??"")}function SR(t,e,n){P(t)&&P(sr(t,n))&&(t.players[e]=n)}function AR(t){return Gg(Object.values((t==null?void 0:t.players)??[])).map(e=>sr(t,e)).filter(P)}const ef=60,tf=25,wR=new Array(ef*tf);function nf(t=$g){const e={id:Ft(),x:0,y:0,width:ef,height:tf,terrain:wR.slice(0),objects:{}};return t(e)}function Na(t,e){if(!(!L(t)||!L(e)))for(const n of e){const r=ee[n];L(r)&&(r>=ee.ONBLACK&&r<=ee.SHADOW?t.bg=r-ee.ONBLACK:t.color=r)}}function RR(t,e,n){return(e>=0&&e<((t==null?void 0:t.width)??-1))??(n>=0&&n<((t==null?void 0:t.height)??-1))?t==null?void 0:t.terrain[e+n*t.width]:void 0}function vR(t,e,n,r){if(!(!L(t)||e<0||e>=t.width||n<0||n>=t.height))return t.terrain[e+n*t.width]=r,r}function NR(t,e,n,r){vR(t,e,n,{kind:r})}function rf(t,e){if(!P(t)||!P(e))return;const n={...e,id:e.id??Ft()};return t.objects[n.id]=n,n}function OR(t,e,n,r){return console.info({kind:r}),{}}function IR(t,e){if(t)return t.objects[e]}function Yt(t,e){switch(e){case K.NORTH:--t.y;break;case K.SOUTH:++t.y;break;case K.WEST:--t.x;break;case K.EAST:++t.x;break}return t}function ir(t,e,n){const r=(e==null?void 0:e.x)??0,s=(e==null?void 0:e.y)??0,i={x:r,y:s},o={...i},a=ar({x:(e==null?void 0:e.lx)??i.x,y:(e==null?void 0:e.ly)??i.y},i);for(let c=0;c<n.length&&i.x===r&&i.y===s;++c){const l=K[n[c]];switch(l){case K.IDLE:break;case K.NORTH:case K.SOUTH:case K.WEST:case K.EAST:Yt(i,l);break;case K.BY:break;case K.AT:break;case K.FLOW:Yt(i,a);break;case K.SEEK:{const u=Oa(t,e);or(u)&&Yt(i,ar(o,u));break}case K.RNDNS:Yt(i,Bt(K.NORTH,K.SOUTH));break;case K.RNDNE:Yt(i,Bt(K.NORTH,K.EAST));break;case K.RND:Yt(i,Bt(K.NORTH,K.SOUTH,K.WEST,K.EAST));break;case K.CW:{const u=ir(t,e,n.slice(c+1));Yt(i,ar(o,u));break}case K.CCW:{const u=ir(t,e,n.slice(c+1));Yt(i,ar(o,u));break}case K.OPP:{const u=ir(t,e,n.slice(c+1));Yt(i,ar(o,u));break}case K.RNDP:{const u=ir(t,e,n.slice(c+1));switch(ar(o,u)){case K.NORTH:case K.SOUTH:i.x+=Bt(-1,1);break;case K.WEST:case K.EAST:i.y+=Bt(-1,1);break}break}case K.EDIT:{i.frame="edit";break}}}return i}function LR(t,e){return P(t)&&P(t.objects[e])?(delete t.objects[e],!0):!1}function CR(t,e){switch(t){case ye.WALK:return e!==ye.WALK;case ye.SWIM:return e!==ye.SWIM;case ye.SOLID:return!0;case ye.BULLET:return e!==ye.WALK&&e!==ye.SWIM}}function sf(t,e,n,r){const s=IR(e,(n==null?void 0:n.id)??"");if(!P(t)||!P(e)||!P(s)||!P(e.lookup)||r.x<0||r.x>=e.width||r.y<0||r.y>=e.height)return!1;const i=r.x+r.y*e.width,o=es(t,s),a=s.collision??(o==null?void 0:o.collision)??ye.WALK,c=e.lookup[i];if(P(c))return!1;const l=e.terrain[i];if(P(l)){const u=Jh(t,l),h=l.collision??(u==null?void 0:u.collision)??ye.WALK;if(CR(a,h))return!1}return e.lookup[i]=void 0,s.x=r.x,s.y=r.y,e.lookup[s.x+s.y*e.width]=s.id??"",!0}function Oa(t,e){var s;if(!P(t)||!P(e))return;const n=((s=e.stats)==null?void 0:s.player)??"",r=t.objects[n];if(P(r))return r;if(or(e))return hm(t,e,um(t,"player"))}function bR(t,e){const n=new Array(e.width*e.height).fill(void 0),r={},s=Object.values(e.objects);for(let a=0;a<s.length;++a){const c=s[a];if(P(c.x)&&P(c.y)&&P(c.id)){const l=es(t,c);c.category=yi.OBJECT,n[c.x+c.y*e.width]=c.id;const u=(c.name??(l==null?void 0:l.name)??"object").toLowerCase();r[u]||(r[u]=new Set),r[u].add(c.id)}}let i=0,o=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(P(c)){const l=es(t,c);c.x=i,c.y=o,c.category=yi.TERRAIN;const u=(c.name??(l==null?void 0:l.name)??"terrain").toLowerCase();r[u]||(r[u]=new Set),r[u].add(a)}++i,i>=e.width&&(i=0,++o)}e.lookup=jc(n),e.named=jc(r)}function kR(t,e,n){if(!P(t)||!P(e))return;bR(t,e);const r=Object.values(e.objects);for(let s=0;s<r.length;++s){const i=r[s];if(!P(i.id))return;i.lx=i.x,i.ly=i.y;const o=es(t,i),a=i.code??(o==null?void 0:o.code)??"";if(!a)return;n(t,e,i,i.id,a)}}var ts=(t=>(t[t.VIEW=0]="VIEW",t[t.EDIT=1]="EDIT",t))(ts||{});function of(t){return{id:Ft(),type:t}}function af(t,e){const n=of(0);return n.book=t,n.board=e,n}function MR(t,e){const n=of(1);return n.book=t,n.board=e,n}const zt=Yg({defaultplayer:"",books:new Map,chips:new Map,frames:new Map});function xR(t){zt.defaultplayer=t}function cf(t){const e=[af(void 0,void 0)];return zt.frames.set(t,e),e}function UR(t,e,n){const r=_i(t);P(r)&&r.push(af(e,n))}function PR(t,e,n){const r=_i(t);P(r)&&r.push(MR(e,n))}function _i(t){return zt.frames.get(t)??cf(t)}function ns(t){const e=t.toLowerCase();return zt.books.get(t)||[...zt.books.values()].find(n=>n.name.toLowerCase()===e)}function lf(t){return zt.books.set(t.id,t),t.id}function X(t){let e=zt.chips.get(t);return P(e)||(e={book:void 0,board:void 0,target:void 0,inputqueue:new Set,inputmods:{[fe.NONE]:0,[fe.MOVE_UP]:0,[fe.MOVE_DOWN]:0,[fe.MOVE_LEFT]:0,[fe.MOVE_RIGHT]:0,[fe.OK_BUTTON]:0,[fe.CANCEL_BUTTON]:0,[fe.MENU_BUTTON]:0},inputcurrent:void 0},zt.chips.set(t,e)),e}const uf="player",hf="title";function DR(t){const e=ns(Ai.name),n=sr(e,hf),r=va(e,uf);if(P(n)&&P(r)){const s=rf(n,{id:t,x:0,y:0,kind:uf,stats:{player:t}});P(s==null?void 0:s.id)&&SR(e,t,hf)}}function FR(t){zt.books.forEach(e=>LR(Zh(e,t),t))}function $R(t){function e(r,s,i,o,a){const c=X(o);c.book=r,c.board=s,c.target=i,c.inputcurrent=void 0,t.tick(o,a)}const n=ns(Ai.name);AR(n).forEach(r=>kR(n,r,e))}function BR(t,e,n,r,s){const i=[];let o=e;const a=o===0,c=r.width??0,l=r.height??0,u=a?ee.BLACK:ee.CLEAR,h=lg(t,o++,c,l,u);i.push(h);const d=fg(t,o++,c,l);i.push(d);const f=o++,p=hg(t,f);i.push(p);const m=dg(t,o++);s&&i.push(m),r.terrain.forEach((S,y)=>{if(S){const w=Jh(n,S);h.char[y]=S.char??(w==null?void 0:w.char)??0,h.color[y]=S.color??(w==null?void 0:w.color)??u,h.bg[y]=S.bg??(w==null?void 0:w.bg)??u}});const A=r.objects??{};return Object.values(A).forEach(S=>{const y=S.id??"",w=es(n,S),E=ug(t,f,y),T=S.lx??S.x??0,g=S.ly??S.y??0;E.x=S.x??0,E.y=S.y??0,E.char=S.char??(w==null?void 0:w.char)??1,E.color=S.color??(w==null?void 0:w.color)??ee.WHITE,E.bg=S.bg??(w==null?void 0:w.bg)??ee.CLEAR,p.sprites.push(E),E.bg===ee.SHADOW&&(d.alphas[T+g*c]=.5),y===t&&(m.focusx=E.x,m.focusy=E.y,m.focusid=y)}),i}function ff(t){switch(t.type){case ts.EDIT:return 1;case ts.VIEW:return 2}return 0}function GR(t){const e=ns(Ai.name),n=Zh(e,t),r=[];if(!P(e)||!P(n))return r;let s=0;return _i(n.id??"").toSorted((o,a)=>ff(o)-ff(a)).forEach(o=>{const a=ns(o.book??"")??e,c=sr(a,o.board??"")??n;if(L(a)&&L(c)){const l=BR(t,s,a,c,o.type===ts.VIEW);s+=l.length,r.push(...l)}}),r}var ee=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.CLEAR=Uc]="CLEAR",t[t.SHADOW=cg]="SHADOW",t))(ee||{}),K=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.EDIT=16]="EDIT",t))(K||{}),ye=(t=>(t[t.SOLID=0]="SOLID",t[t.WALK=1]="WALK",t[t.SWIM=2]="SWIM",t[t.BULLET=3]="BULLET",t))(ye||{}),yi=(t=>(t[t.TERRAIN=0]="TERRAIN",t[t.OBJECT=1]="OBJECT",t))(yi||{});function or(t){return L(t)&&L(t.x)&&L(t.y)}function ar(t,e){const n=e.x-t.x,r=e.y-t.y;if(n<0)return 3;if(n>0)return 4;if(r<0)return 1;if(r>0)return 2}const df={terrain:"TERRAIN",object:"OBJECT"};function cn(t){return $t(t)&&pf(t[0])}function pf(t){return L(yi[t])&&Ne(t)}function gf(t){if(Ne(t))return df[t.toLowerCase()]}function mf(t){if(cn(t))return t;if(pf(t))return[t];const e=gf(t);if(L(e))return[e]}function Ti(t,e){const n=t.words[e],r=mf(n);if(cn(r))return[r,e+1];const[s,i]=Oe(t,e),o=mf(s);return cn(o)?[o,i]:[void 0,e]}const Ef={solid:"SOLID",walk:"WALK",swim:"SWIM",bullet:"BULLET",walkable:"WALK",swimmable:"SWIM"};function kn(t){return $t(t)&&Ia(t[0])}function Ia(t){return L(ye[t])&&Ne(t)}function WR(t){if(Ne(t))return Ef[t.toLowerCase()]}function _f(t,e){const n=t.words[e];if(kn(n))return[n,e+1];if(Ia(n))return[[n],e+1];const[r,s]=Oe(t,e);return kn(r)?[r,s]:Ia(r)?[[r],s]:[void 0,e]}const yf={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",clear:"CLEAR",shadow:"SHADOW",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY"};function gt(t){return $t(t)&&Sf(t[0])}function Tf(t){return gt(t)&&t[0].startsWith("ON")}function Sf(t){return L(ee[t])&&Ne(t)}function Af(t){if(Ne(t))return yf[t.toLowerCase()]}function wf(t){if(gt(t))return t;if(Sf(t))return[t];const e=Af(t);if(L(e))return[e]}function Rf(t,e){const n=t.words[e],r=wf(n);if(gt(r))return[r,e+1];const[s,i]=Oe(t,e),o=wf(s);return gt(o)?[o,i]:[void 0,e]}function Si(t,e){const n=[];let r=e;const[s,i]=Rf(t,e);if(gt(s)&&(n.push(...s),r=i),gt(n)&&!Tf(n)){const[o,a]=Rf(t,i);Tf(o)&&(n.push(...o),r=a)}return n.length?[n,r]:[void 0,e]}function La(t){return $t(t)&&typeof t[0]=="string"}function vf(t,e){const n=t.words[e];if(La(n))return[n,e+1];const[r,s]=Si(t,e),[i,o]=Oe(t,s,!1);return Ne(i)?[[i,r],o]:[void 0,e]}const Nf={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function qt(t){return $t(t)&&Of(t[0])}function Of(t){return L(K[t])&&Ne(t)}function If(t){if(Ne(t))return Nf[t.toLowerCase()]}function Lf(t){if(qt(t))return t;if(Of(t))return[t];const e=If(t);if(L(e))return[e]}function Cf(t,e){const n=t.words[e],r=Lf(n);if(qt(r))return[r,e+1];const[s,i]=Oe(t,e),o=Lf(s);return qt(o)?[o,i]:[void 0,e]}function Ca(t,e){const n=[];let[r,s]=Cf(t,e);for(;qt(r);){n.push(...r);const[i,o]=Cf(t,s);r=i,s=o}return n.length?[n,e+n.length]:[void 0,e]}function H(t,e){return{...X(t.id()),chip:t,words:e}}function Oe(t,e,n=!0){const r=t.words[e];if(gf(r)){const[s,i]=Ti(t,e);if(L(s))return[s,i]}if(WR(r)){const[s,i]=_f(t,e);if(L(s))return[s,i]}if(Af(r)){const[s,i]=Si(t,e);if(L(s))return[s,i]}if(Ne(r)&&r.toLowerCase()==="rnd"){const[s,i]=Oe(t,e+1),[o,a]=Oe(t,i);return Ke(s)&&Ke(o)?[Hn(s,o),a]:Ke(s)?[Hn(0,s),i]:[Hn(0,1),e+1]}if(If(r)){const[s,i]=Ca(t,e);if(L(s))return[s,i]}if(!L(r))return[void 0,e];if(or(r)||Ke(r)||$t(r))return[r,e+1];if(Ne(r)){const s=r.toLowerCase();if(n){const i=t.chip.get(r);if(L(i))return[i,e+1]}switch(s){case"aligned":case"alligned":break;case"contact":break;case"blocked":break;case"any":break;case"abs":{const[i,o]=O(t,e+1,[5]);return[Math.abs(i),o]}case"ceil":{const[i,o]=O(t,e+1,[5]);return[Math.ceil(i),o]}case"floor":{const[i,o]=O(t,e+1,[5]);return[Math.floor(i),o]}case"round":{const[i,o]=O(t,e+1,[5]);return[Math.round(i),o]}case"min":{const i=[];for(let o=e+1;o<t.words.length;){const[a,c]=Oe(t,o);if($t(a)&&!or(a)&&!qt(a)&&!cn(a)&&!kn(a)&&!gt(a))return[Bt(a),c];o=c,i.push(a)}return[Math.min(...i),t.words.length]}case"max":{const i=[];for(let o=e+1;o<t.words.length;){const[a,c]=Oe(t,o);if($t(a)&&!or(a)&&!qt(a)&&!cn(a)&&!kn(a)&&!gt(a))return[Bt(a),c];o=c,i.push(a)}return[Math.max(...i),t.words.length]}case"clamp":{const[i,o,a,c]=O(t,e+1,[5,5,5]);return[so(i,o,a),c]}case"pick":{const i=[];for(let o=e+1;o<t.words.length;){const[a,c]=Oe(t,o);if($t(a)&&!or(a)&&!qt(a)&&!cn(a)&&!kn(a)&&!gt(a))return[Bt(a),c];o=c,i.push(a)}return[Bt(i),t.words.length]}case"range":{const[i,o,a,c]=O(t,e+1,[5,13,13]);return[go(i,o,a),c]}}}return[r,e+1]}var N=(t=>(t[t.CATEGORY=0]="CATEGORY",t[t.COLLISION=1]="COLLISION",t[t.COLOR=2]="COLOR",t[t.KIND=3]="KIND",t[t.DIR=4]="DIR",t[t.NUMBER=5]="NUMBER",t[t.STRING=6]="STRING",t[t.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",t[t.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",t[t.MAYBE_COLLISION=9]="MAYBE_COLLISION",t[t.MAYBE_COLOR=10]="MAYBE_COLOR",t[t.MAYBE_KIND=11]="MAYBE_KIND",t[t.MAYBE_DIR=12]="MAYBE_DIR",t[t.MAYBE_NUMBER=13]="MAYBE_NUMBER",t[t.MAYBE_STRING=14]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",t[t.ANY=16]="ANY",t))(N||{});function Ie(t,e){throw new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function O(t,e,n){const r=[];let s=e;for(let i=0;i<n.length;++i)switch(n[i]){case 0:{const[o,a]=Ti(t,s);cn(o)||Ie("terrain or object",o),s=a,r.push(o);break}case 1:{const[o,a]=_f(t,s);kn(o)||Ie("solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 2:{const[o,a]=Si(t,s);gt(o)||Ie("color",o),s=a,r.push(o);break}case 3:{const[o,a]=vf(t,s);La(o)?(s=a,r.push(o)):Ie("kind",o);break}case 4:{const[o,a]=Ca(t,s);if(qt(o)){const c=t.board?ir(t.board,t.target,o):{x:0,y:0};s=a,r.push(c)}else Ie("direction",o);break}case 5:{const[o,a]=Oe(t,s);Ke(o)||Ie("number",o),s=a,r.push(o);break}case 6:{const o=t.words[s];Ne(o)||Ie("string",o),++s,r.push(o);break}case 7:{const[o,a]=Oe(t,s,!1);!Ke(o)&&!Ne(o)&&Ie("number or string",o),s=a,r.push(o);break}case 8:{const[o,a]=Ti(t,s);o!==void 0&&cn(o)&&Ie("optional terrain or object",o),s=a,r.push(o);break}case 9:{const[o,a]=Ti(t,s);o!==void 0&&kn(o)&&Ie("optional solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 10:{const[o,a]=Si(t,s);o!==void 0&&!gt(o)&&Ie("optional color",o),s=a,r.push(o);break}case 11:{const[o,a]=vf(t,s);La(o)?(s=a,r.push(o)):o!==void 0&&Ie("optional kind",o);break}case 12:{const[o,a]=Ca(t,s);if(qt(o)){const c=t.board?ir(t.board,t.target,o):{x:0,y:0};s=a,r.push(c)}else o!==void 0&&Ie("optional direction",o);break}case 13:{const[o,a]=Oe(t,s);o!==void 0&&!Ke(o)&&Ie("optional number",o),s=a,r.push(o);break}case 14:{const o=t.words[s];o!==void 0&&!Ne(o)&&Ie("optional string",o),++s,r.push(o);break}case 15:{const[o,a]=Oe(t,s,!1);o!==void 0&&!Ke(o)&&!Ne(o)&&Ie("optional number or string",o),s=a,r.push(o);break}case 16:{const[o,a]=Oe(t,s);s=a,r.push(o);break}}return[...r,s]}var KR=`@player

' create content
#book temp create

' load content in edit frame
#frame temp edit title

' setup ui
#gadget right 20
 
 $white   - - - - -
 $black$ongrey    ZED.CAFE    
 $white    - - - - -
 
!hotkey plot space " Space ";Plot
!hotkey draw tab "  Tab  ";Draw
 
!hotkey menu_test m  ;Menu Test
!hotkey cmmd_test x  ;Cmmd Test

' main loop
#cycle 1
#set blink
#set drawing white
#set playermove idle

:main
#give blink

#if blink < 19 do
  #char 22
  #color drawing
#else if blink < 25 do
  #char 219
#else do
  #clear blink
#endif

#if inputmove do
  #set playermove inputmove
  #if inputalt do
    #if drawing is blue do
      #repeat 10 do
        ?playermove
        #put edit idle brown ondkpurple pick wall wall2
      #endrepeat
    #else do
      ?10 playermove
    #endif
  #else do 
    ?playermove
    #if drawing is blue put edit idle brown ondkpurple pick wall wall2
  #endif
#else do
  #idle
#endif

#main

:plot
#put edit idle wall
#main

:draw
#if drawing is white do
  #set drawing blue
  #put edit idle brown ondkpurple pick wall wall2
#else do
  #set drawing white
#endif
#main

:menu_test
$3 Here is some test text and yeah! $3
----------------------------------
!number          frank1 100         ;Number Value 
!rn              frank2             ;Slider 
!select          frank3 A BB CC 333 ;Enum 
!text            frank4             ;Text Value 

#idle
#main

:cmmd_test
#change yellow spin red ondkblue fish
#idle
#main`,jR=`@spin
#cycle pick range 1 10
#color pick red white blue yellow dkblue dkred dkgreen pick clear shadow onblack

:think
#char pick range 1 22

?u
#if rnd ?u
#put edit idle dirt

?r
#if rnd ?r
#put edit idle dirt2

?d
#if rnd ?d
#put edit idle dirt

?l
#if rnd ?l
#put edit idle dirt2

#think
`;const Ai=qh("BIOS",[It("@board title",{board:nf(t=>{for(let e=0;e<32;e++)rf(t,{x:Hn(0,t.width-1),y:Hn(0,t.height-1),kind:"spin"});return t})}),It(KR,{object:{char:219,color:ee.WHITE,bg:ee.CLEAR}}),It(jR,{object:{char:1,color:ee.WHITE,bg:ee.CLEAR}}),It("@terrain field",{terrain:{char:176,color:ee.DKGRAY,collision:ye.WALK}}),It("@terrain wall",{terrain:{char:219,color:ee.CYAN,collision:ye.SOLID}})]);var bf={exports:{}},ba={exports:{}},kf;function HR(){return kf||(kf=1,function(t,e){(function(n,r){t.exports=r()})(vs,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function s(m){return function(){return this[m]}}var i=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=i.concat(o,a,c,l);function h(m){if(m)for(var A=0;A<u.length;A++)m[u[A]]!==void 0&&this["set"+r(u[A])](m[u[A]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",A=this.getLineNumber()||"",S=this.getColumnNumber()||"",y=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+A+":"+S+")":"[eval]:"+A+":"+S:y?y+" ("+m+":"+A+":"+S+")":m+":"+A+":"+S}},h.fromString=function(A){var S=A.indexOf("("),y=A.lastIndexOf(")"),w=A.substring(0,S),E=A.substring(S+1,y).split(","),T=A.substring(y+1);if(T.indexOf("@")===0)var g=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(T,""),_=g[1],v=g[2],R=g[3];return new h({functionName:w,args:E||void 0,fileName:_,lineNumber:v||void 0,columnNumber:R||void 0})};for(var d=0;d<i.length;d++)h.prototype["get"+r(i[d])]=s(i[d]),h.prototype["set"+r(i[d])]=function(m){return function(A){this[m]=!!A}}(i[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=s(o[f]),h.prototype["set"+r(o[f])]=function(m){return function(A){if(!n(A))throw new TypeError(m+" must be a Number");this[m]=Number(A)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=s(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(A){this[m]=String(A)}}(a[p]);return h})}(ba)),ba.exports}(function(t,e){(function(n,r){t.exports=r(HR())})(vs,function(r){var s=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(i))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,m=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:m,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;f.match(/\(([^)]*)\)/)&&(m=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var A=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:A,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(bf);var VR=bf.exports,YR=no(VR),Mf={},xf={},Uf={};const Pf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Uf.encode=function(t){if(0<=t&&t<Pf.length)return Pf[t];throw new TypeError("Must be between 0 and 63: "+t)};const zR=Uf,Df=5,Ff=1<<Df,qR=Ff-1,XR=Ff;function JR(t){return t<0?(-t<<1)+1:(t<<1)+0}xf.encode=function(e){let n="",r,s=JR(e);do r=s&qR,s>>>=Df,s>0&&(r|=XR),n+=zR.encode(r);while(s>0);return n};var rs={};(function(t){function e(g,_,v){if(_ in g)return g[_];if(arguments.length===3)return v;throw new Error('"'+_+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function s(g){const _=g.match(n);return _?{scheme:_[1],auth:_[2],host:_[3],port:_[4],path:_[5]}:null}t.urlParse=s;function i(g){let _="";return g.scheme&&(_+=g.scheme+":"),_+="//",g.auth&&(_+=g.auth+"@"),g.host&&(_+=g.host),g.port&&(_+=":"+g.port),g.path&&(_+=g.path),_}t.urlGenerate=i;const o=32;function a(g){const _=[];return function(v){for(let I=0;I<_.length;I++)if(_[I].input===v){const k=_[0];return _[0]=_[I],_[I]=k,_[0].result}const R=g(v);return _.unshift({input:v,result:R}),_.length>o&&_.pop(),R}}const c=a(function(_){let v=_;const R=s(_);if(R){if(!R.path)return _;v=R.path}const I=t.isAbsolute(v),k=[];let ue=0,te=0;for(;;)if(ue=te,te=v.indexOf("/",ue),te===-1){k.push(v.slice(ue));break}else for(k.push(v.slice(ue,te));te<v.length&&v[te]==="/";)te++;let Ce=0;for(te=k.length-1;te>=0;te--){const ve=k[te];ve==="."?k.splice(te,1):ve===".."?Ce++:Ce>0&&(ve===""?(k.splice(te+1,Ce),Ce=0):(k.splice(te,2),Ce--))}return v=k.join("/"),v===""&&(v=I?"/":"."),R?(R.path=v,i(R)):v});t.normalize=c;function l(g,_){g===""&&(g="."),_===""&&(_=".");const v=s(_),R=s(g);if(R&&(g=R.path||"/"),v&&!v.scheme)return R&&(v.scheme=R.scheme),i(v);if(v||_.match(r))return _;if(R&&!R.host&&!R.path)return R.host=_,i(R);const I=_.charAt(0)==="/"?_:c(g.replace(/\/+$/,"")+"/"+_);return R?(R.path=I,i(R)):I}t.join=l,t.isAbsolute=function(g){return g.charAt(0)==="/"||n.test(g)};function u(g,_){g===""&&(g="."),g=g.replace(/\/$/,"");let v=0;for(;_.indexOf(g+"/")!==0;){const R=g.lastIndexOf("/");if(R<0||(g=g.slice(0,R),g.match(/^([^\/]+:\/)?\/*$/)))return _;++v}return Array(v+1).join("../")+_.substr(g.length+1)}t.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(g){return g}function f(g){return m(g)?"$"+g:g}t.toSetString=h?d:f;function p(g){return m(g)?g.slice(1):g}t.fromSetString=h?d:p;function m(g){if(!g)return!1;const _=g.length;if(_<9||g.charCodeAt(_-1)!==95||g.charCodeAt(_-2)!==95||g.charCodeAt(_-3)!==111||g.charCodeAt(_-4)!==116||g.charCodeAt(_-5)!==111||g.charCodeAt(_-6)!==114||g.charCodeAt(_-7)!==112||g.charCodeAt(_-8)!==95||g.charCodeAt(_-9)!==95)return!1;for(let v=_-10;v>=0;v--)if(g.charCodeAt(v)!==36)return!1;return!0}function A(g,_,v){let R=y(g.source,_.source);return R!==0||(R=g.originalLine-_.originalLine,R!==0)||(R=g.originalColumn-_.originalColumn,R!==0||v)||(R=g.generatedColumn-_.generatedColumn,R!==0)||(R=g.generatedLine-_.generatedLine,R!==0)?R:y(g.name,_.name)}t.compareByOriginalPositions=A;function S(g,_,v){let R=g.generatedLine-_.generatedLine;return R!==0||(R=g.generatedColumn-_.generatedColumn,R!==0||v)||(R=y(g.source,_.source),R!==0)||(R=g.originalLine-_.originalLine,R!==0)||(R=g.originalColumn-_.originalColumn,R!==0)?R:y(g.name,_.name)}t.compareByGeneratedPositionsDeflated=S;function y(g,_){return g===_?0:g===null?1:_===null?-1:g>_?1:-1}function w(g,_){let v=g.generatedLine-_.generatedLine;return v!==0||(v=g.generatedColumn-_.generatedColumn,v!==0)||(v=y(g.source,_.source),v!==0)||(v=g.originalLine-_.originalLine,v!==0)||(v=g.originalColumn-_.originalColumn,v!==0)?v:y(g.name,_.name)}t.compareByGeneratedPositionsInflated=w;function E(g){return JSON.parse(g.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=E;function T(g,_,v){if(_=_||"",g&&(g[g.length-1]!=="/"&&_[0]!=="/"&&(g+="/"),_=g+_),v){const R=s(v);if(!R)throw new Error("sourceMapURL could not be parsed");if(R.path){const I=R.path.lastIndexOf("/");I>=0&&(R.path=R.path.substring(0,I+1))}_=l(i(R),_)}return c(_)}t.computeSourceURL=T})(rs);var ka={};let QR=class zp{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new zp;for(let s=0,i=e.length;s<i;s++)r.add(e[s],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),s=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,s)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};ka.ArraySet=QR;var $f={};const Bf=rs;function ZR(t,e){const n=t.generatedLine,r=e.generatedLine,s=t.generatedColumn,i=e.generatedColumn;return r>n||r==n&&i>=s||Bf.compareByGeneratedPositionsInflated(t,e)<=0}let ev=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){ZR(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(Bf.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};$f.MappingList=ev;const ss=xf,he=rs,wi=ka.ArraySet,tv=$f.MappingList;let Gf=class qp{constructor(e){e||(e={}),this._file=he.getArg(e,"file",null),this._sourceRoot=he.getArg(e,"sourceRoot",null),this._skipValidation=he.getArg(e,"skipValidation",!1),this._sources=new wi,this._names=new wi,this._mappings=new tv,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new qp({file:e.file,sourceRoot:n});return e.eachMapping(function(s){const i={generated:{line:s.generatedLine,column:s.generatedColumn}};s.source!=null&&(i.source=s.source,n!=null&&(i.source=he.relative(n,i.source)),i.original={line:s.originalLine,column:s.originalColumn},s.name!=null&&(i.name=s.name)),r.addMapping(i)}),e.sources.forEach(function(s){let i=s;n!==null&&(i=he.relative(n,s)),r._sources.has(i)||r._sources.add(i);const o=e.sourceContentFor(s);o!=null&&r.setSourceContent(s,o)}),r}addMapping(e){const n=he.getArg(e,"generated"),r=he.getArg(e,"original",null);let s=he.getArg(e,"source",null),i=he.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,s,i),s!=null&&(s=String(s),this._sources.has(s)||this._sources.add(s)),i!=null&&(i=String(i),this._names.has(i)||this._names.add(i)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:s,name:i})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=he.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[he.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[he.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let s=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);s=e.file}const i=this._sourceRoot;i!=null&&(s=he.relative(i,s));const o=this._mappings.toArray().length>0?new wi:this._sources,a=new wi;this._mappings.unsortedForEach(function(c){if(c.source===s&&c.originalLine!=null){const h=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=he.join(r,c.source)),i!=null&&(c.source=he.relative(i,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=he.join(r,c)),i!=null&&(c=he.relative(i,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,s){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!s)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:s}))}}_serializeMappings(){let e=0,n=1,r=0,s=0,i=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(l=d[f],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!he.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=ss.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=ss.encode(h-o),o=h,c+=ss.encode(l.originalLine-1-s),s=l.originalLine-1,c+=ss.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=ss.encode(u-i),i=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=he.relative(n,r));const s=he.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,s)?this._sourcesContents[s]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};Gf.prototype._version=3,Mf.SourceMapGenerator=Gf;var Wf={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,s,i,o,a){const c=Math.floor((r-n)/2)+n,l=o(s,i[c],!0);return l===0?c:l>0?r-c>1?e(c,r,s,i,o,a):a==t.LEAST_UPPER_BOUND?r<i.length?r:-1:c:c-n>1?e(n,c,s,i,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,s,i,o){if(s.length===0)return-1;let a=e(-1,s.length,r,s,i,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&i(s[a],s[a-1],!0)===0;)--a;return a}})(Wf);var is={exports:{}},nv={},rv=Object.freeze({__proto__:null,default:nv}),Kf=tg(rv);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;is.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},is.exports.initialize=e=>t=e}else{const t=Kf,e=Kf;is.exports=function(){return new Promise((r,s)=>{const i=e.join(__dirname,"mappings.wasm");t.readFile(i,null,(o,a)=>{if(o){s(o);return}r(a.buffer)})})},is.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var jf=is.exports;const sv=jf;function iv(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let os=null;var ov=function(){if(os)return os;const e=[];return os=sv().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,s,i,o,a,c,l,u,h,d){const f=new iv;f.generatedLine=r+1,f.generatedColumn=s,i&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),e[e.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,s)=>{e.push(r);try{s()}finally{e.pop()}}})).then(null,n=>{throw os=null,n}),os};const b=rs,Ma=Wf,Ri=ka.ArraySet,av=jf,cv=ov,xa=Symbol("smcInternal");class ae{constructor(e,n){return e==xa?Promise.resolve(this):uv(e,n)}static initialize(e){av.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return hv(e,n)}static async with(e,n,r){const s=await new ae(e,n);try{return await r(s)}finally{s.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ae.prototype._version=3,ae.GENERATED_ORDER=1,ae.ORIGINAL_ORDER=2,ae.GREATEST_LOWER_BOUND=1,ae.LEAST_UPPER_BOUND=2;class as extends ae{constructor(e,n){return super(xa).then(r=>{let s=e;typeof e=="string"&&(s=b.parseSourceMapInput(e));const i=b.getArg(s,"version");let o=b.getArg(s,"sources");const a=b.getArg(s,"names",[]);let c=b.getArg(s,"sourceRoot",null);const l=b.getArg(s,"sourcesContent",null),u=b.getArg(s,"mappings"),h=b.getArg(s,"file",null);if(i!=r._version)throw new Error("Unsupported version: "+i);return c&&(c=b.normalize(c)),o=o.map(String).map(b.normalize).map(function(d){return c&&b.isAbsolute(c)&&b.isAbsolute(d)?b.relative(c,d):d}),r._names=Ri.fromArray(a.map(String),!0),r._sources=Ri.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return b.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,cv().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=b.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new as(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,s=this._wasm.exports.allocate_mappings(r),i=new Uint8Array(this._wasm.exports.memory.buffer,s,r);for(let a=0;a<r;a++)i[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(s);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const s=n||null,i=r||ae.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=b.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(s,a)},()=>{switch(i){case ae.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ae.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=b.getArg(e,"source");const r=b.getArg(e,"line"),s=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(s<0)throw new Error("Column numbers must be >= 0");const i=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),i.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,s)}),i}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:b.getArg(e,"line"),generatedColumn:b.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=b.getArg(e,"bias",ae.GREATEST_LOWER_BOUND);r==null&&(r=ae.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(i=>s=i,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),s&&s.generatedLine===n.generatedLine){let i=b.getArg(s,"source",null);i!==null&&(i=this._sources.at(i),i=b.computeSourceURL(this.sourceRoot,i,this._sourceMapURL));let o=b.getArg(s,"name",null);return o!==null&&(o=this._names.at(o)),{source:i,line:b.getArg(s,"originalLine",null),column:b.getArg(s,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let s=e;this.sourceRoot!=null&&(s=b.relative(this.sourceRoot,s));let i;if(this.sourceRoot!=null&&(i=b.urlParse(this.sourceRoot))){const o=s.replace(/^file:\/\//,"");if(i.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!i.path||i.path=="/")&&this._sources.has("/"+s))return this.sourcesContent[this._sources.indexOf("/"+s)]}if(n)return null;throw new Error('"'+s+'" is not in the SourceMap.')}generatedPositionFor(e){let n=b.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:b.getArg(e,"line"),originalColumn:b.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let s=b.getArg(e,"bias",ae.GREATEST_LOWER_BOUND);s==null&&(s=ae.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(o=>i=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,s)}),i&&i.source===r.source){let o=i.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:b.getArg(i,"generatedLine",null),column:b.getArg(i,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}as.prototype.consumer=ae;class lv extends ae{constructor(e,n){return super(xa).then(r=>{let s=e;typeof e=="string"&&(s=b.parseSourceMapInput(e));const i=b.getArg(s,"version"),o=b.getArg(s,"sections");if(i!=r._version)throw new Error("Unsupported version: "+i);r._sources=new Ri,r._names=new Ri,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=b.getArg(c,"offset"),u=b.getArg(l,"line"),h=b.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new ae(b.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(b.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(b.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:b.getArg(e,"line"),generatedColumn:b.getArg(e,"column")},r=Ma.search(n,this._sections,function(i,o){const a=i.generatedLine-o.generatedOffset.generatedLine;return a||i.generatedColumn-o.generatedOffset.generatedColumn}),s=this._sections[r];return s?s.consumer.originalPositionFor({line:n.generatedLine-(s.generatedOffset.generatedLine-1),column:n.generatedColumn-(s.generatedOffset.generatedLine===n.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const i=this._sections[r].consumer.sourceContentFor(e,!0);if(i)return i}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(b.getArg(e,"source"))===-1)continue;const s=r.consumer.generatedPositionFor(e);if(s)return{line:s.line+(r.generatedOffset.generatedLine-1),column:s.column+(r.generatedOffset.generatedLine===s.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],s=this.__originalMappingsUnsorted=[];for(let i=0;i<this._sections.length;i++){const o=this._sections[i],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=b.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&s.push(d)}}}eachMapping(e,n,r){const s=n||null,i=r||ae.GENERATED_ORDER;let o;switch(i){case ae.GENERATED_ORDER:o=this._generatedMappings;break;case ae.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=b.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,s)}_findMapping(e,n,r,s,i,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[s]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[s]);return Ma.search(e,n,i,o)}allGeneratedPositionsFor(e){const n=b.getArg(e,"line"),r={source:b.getArg(e,"source"),originalLine:n,originalColumn:b.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const s=[];let i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",b.compareByOriginalPositions,Ma.LEAST_UPPER_BOUND);if(i>=0){let o=this._originalMappings[i];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:b.getArg(o,"generatedLine",null),column:b.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:b.getArg(o,"generatedLine",null),column:b.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}}return s}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function uv(t,e){let n=t;typeof t=="string"&&(n=b.parseSourceMapInput(t));const r=n.sections!=null?new lv(n,e):new as(n,e);return Promise.resolve(r)}function hv(t,e){return as.fromSourceMap(t,e)}var Hf={};const fv=Mf.SourceMapGenerator,vi=rs,dv=/(\r?\n)/,pv=10,cr="$$$isSourceNode$$$";let gv=class Lc{constructor(e,n,r,s,i){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=i??null,this[cr]=!0,s!=null&&this.add(s)}static fromStringWithSourceMap(e,n,r){const s=new Lc,i=e.split(dv);let o=0;const a=function(){const f=m(),p=m()||"";return f+p;function m(){return o<i.length?i[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=i[o]||"";const p=h.substr(0,f.generatedColumn-l);i[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,p),u=f;return}for(;c<f.generatedLine;)s.add(a()),c++;l<f.generatedColumn&&(h=i[o]||"",s.add(h.substr(0,f.generatedColumn)),i[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<i.length&&(u&&d(u,a()),s.add(i.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=vi.join(r,f)),s.setSourceContent(f,p))}),s;function d(f,p){if(f===null||f.source===void 0)s.add(p);else{const m=r?vi.join(r,f.source):f.source;s.add(new Lc(f.originalLine,f.originalColumn,m,p,f.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[cr]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[cr]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,s=this.children.length;r<s;r++)n=this.children[r],n[cr]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const s=this.children.length;if(s>0){for(n=[],r=0;r<s-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[cr]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[vi.toSetString(e)]=n}walkSourceContents(e){for(let r=0,s=this.children.length;r<s;r++)this.children[r][cr]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,s=n.length;r<s;r++)e(vi.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new fv(e);let s=!1,i=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((i!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),i=u.source,o=u.line,a=u.column,c=u.name,s=!0):s&&(r.addMapping({generated:{line:n.line,column:n.column}}),i=null,s=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===pv?(n.line++,n.column=0,h+1===d?(i=null,s=!1):s&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};Hf.SourceNode=gv;var mv=Hf.SourceNode;const Ev=go(32,126).map(t=>String.fromCharCode(t)),_v=D({name:"Whitespace",pattern:/ +/}),yv=D({name:"WhitespaceSkipped",pattern:/ +/,group:_e.SKIPPED}),Vf=D({name:"StringLiteral",pattern:/[^ $]+/,start_chars_hint:Ev}),Yf=D({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Ua=D({name:"MaybeFlag",pattern:/\$[^ $]+/}),zf=D({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),qf=D({name:"ContinueLine",pattern:/\\/});function Xf(t,e=""){return D({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const Jf=[["blue"],["green"],["cyan"],["red"],["purple"],["yellow"],["white"],["dkblue"],["dkgreen"],["dkcyan"],["dkred"],["dkpurple"],["dkyellow|brown","brown"],["dkwhite|ltgray|ltgrey|gray|grey","gray"],["dkgray|dkgrey|ltblack","dkgray"],["black"],["clear"]],Qf=Jf.map(([t,e])=>Xf(`\\$(${t})`,e||t)),Zf=[...Jf.map(([t,e])=>Xf(`\\$on(${t})`,`on${e||t}`))],Tv=[_v,qf,...Qf,...Zf,Yf,Vf,zf,Ua],Sv=new _e(Tv,{skipValidations:!Ot,ensureOptimizations:Ot}),Av=new _e([yv,qf,...Qf,...Zf,Yf,Vf,zf,Ua],{skipValidations:!Ot,ensureOptimizations:Ot});function wv(t,e=!1){return e?Av.tokenize(t):Sv.tokenize(t)}function Rv(t,e,n,r){return{measureOnly:!1,resetCheck:!0,x:0,y:0,isEven:!0,resetColor:n,resetBg:r,activeColor:n,activeBg:r,width:t,height:e,leftEdge:void 0,rightEdge:void 0,bottomEdge:void 0,char:[],color:[],bg:[]}}lm.createContext(Rv(1,1,15,1));let vv=0,ed=0;const td=Ot,Nv=["Command","lines"];class Ov extends lR{constructor(){super(Yh,{traceInitPerf:Ot,skipValidations:!Ot,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});F(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));F(this,"line",this.RULED("line",()=>{this.OPTION(()=>this.SUBRULE(this.stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(Zr))}));F(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stat)},{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.label)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));F(this,"stat",this.RULED("stat",()=>{this.CONSUME(da)}));F(this,"text",this.RULED("text",()=>{this.CONSUME(mh)}));F(this,"label",this.RULED("label",()=>{this.CONSUME(_h)}));F(this,"comment",this.RULED("comment",()=>{this.CONSUME(Eh)}));F(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>{this.CONSUME(pt),this.AT_LEAST_ONE1(()=>this.SUBRULE1(this.command))}},{ALT:()=>{this.AT_LEAST_ONE2(()=>this.SUBRULE2(this.command))}}])}));F(this,"command",this.RULED("command",()=>{this.OR([{ALT:()=>this.SUBRULE(this.flat_cmd)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));F(this,"flat_cmd",this.RULED("flat_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.hyperlink)},{ALT:()=>this.SUBRULE(this.Short_go)},{ALT:()=>this.SUBRULE(this.Short_try)},{ALT:()=>this.SUBRULE(this.Command_play)}])}));F(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.Command_if)},{ALT:()=>this.SUBRULE(this.Command_read)},{ALT:()=>this.SUBRULE(this.Command_while)},{ALT:()=>this.SUBRULE(this.Command_repeat)},{ALT:()=>this.SUBRULE(this.Command_break)},{ALT:()=>this.SUBRULE(this.Command_continue)}])}));F(this,"hyperlink",this.RULED("hyperlink",()=>{this.CONSUME(yh),this.SUBRULE(this.words),this.CONSUME(Th)}));F(this,"Short_go",this.RULED("Short_go",()=>{this.CONSUME(ya),this.SUBRULE(this.words)}));F(this,"Short_try",this.RULED("Short_try",()=>{this.CONSUME(Mh),this.SUBRULE(this.words)}));F(this,"Command_play",this.RULED("Command_play",()=>{this.CONSUME(Ph)}));F(this,"do_line",this.RULED("do_line",()=>{this.OPTION(()=>this.SUBRULE(this.do_stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(Zr))}));F(this,"do_stmt",this.RULED("do_stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));F(this,"Command_if",this.RULED("Command_if",()=>{this.CONSUME(Ta),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(bn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));F(this,"Command_else_if",this.RULED("Command_else_if",()=>{this.CONSUME(pt),this.CONSUME(Sa),this.CONSUME(Ta),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(bn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));F(this,"Command_else",this.RULED("Command_else",()=>{this.CONSUME(pt),this.CONSUME(Sa),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(bn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.SUBRULE(this.Command_endif)}}])})}));F(this,"Command_endif",this.RULED("Command_endif",()=>{this.CONSUME(pt),this.CONSUME(Dh)}));F(this,"Command_while",this.RULED("Command_while",()=>{this.CONSUME(pt),this.CONSUME(Fh),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(bn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(pt),this.CONSUME4($h)}}])})}));F(this,"Command_repeat",this.RULED("Command_repeat",()=>{this.CONSUME(pt),this.CONSUME(Bh),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(bn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(pt),this.CONSUME4(Gh)}}])})}));F(this,"Command_read",this.RULED("Command_read",()=>{this.CONSUME(pt),this.CONSUME(Wh),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(bn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(pt),this.CONSUME4(Kh)}}])})}));F(this,"Command_break",this.RULED("Command_break",()=>{this.CONSUME(jh)}));F(this,"Command_continue",this.RULED("Command_continue",()=>{this.CONSUME(Hh)}));F(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(pa),this.SUBRULE2(this.and_test)})}));F(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(ma),this.SUBRULE2(this.not_test)})}));F(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(ga),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));F(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));F(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(wh)},{ALT:()=>this.CONSUME(Rh)},{ALT:()=>this.CONSUME(vh)},{ALT:()=>this.CONSUME(Nh)},{ALT:()=>this.CONSUME(Oh)},{ALT:()=>this.CONSUME(Ih)}])}));F(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(pa),this.SUBRULE2(this.and_test_value)})}));F(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(ma),this.SUBRULE2(this.not_test_value)})}));F(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(ga),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));F(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));F(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Ea)},{ALT:()=>this.CONSUME(_a)}]),this.SUBRULE(this.term)}));F(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));F(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Ch)},{ALT:()=>this.CONSUME(ya)},{ALT:()=>this.CONSUME(bh)},{ALT:()=>this.CONSUME(kh)}]),this.SUBRULE(this.factor)}));F(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Ea)},{ALT:()=>this.CONSUME(_a)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));F(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Lh),this.SUBRULE(this.factor)})}));F(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));F(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Sh)},{ALT:()=>this.CONSUME(ze)},{ALT:()=>this.CONSUME(Ah)},{ALT:()=>{this.CONSUME(xh),this.SUBRULE(this.expr),this.CONSUME(Uh)}}])}));this.performSelfAnalysis()}PEEK(n,r,...s){console.info(n,s.map(i=>[i.image,i.tokenType]),r)}RULED(n,r,s){const i=Nv.some(o=>n.includes(o));return this.RULE(n,()=>{const o=vv++,a=ed++,c=a.toString().padStart(3),l=" ".repeat(a),u=i?"font-weight: bold;":"";if(td&&!this.RECORDING_PHASE){const d=[this.LA(0),this.LA(1),this.LA(2)].map(f=>[`[${f.tokenType.name}]`,f.image.replaceAll(`
`,"\\n")]).flat();console.info(`${c}%c${l}> ${n} ${o} ${d.join(" ")}`,u)}r(),td&&!this.RECORDING_PHASE&&console.info(`${c}%c${l}< ${n} ${o}`,u),ed--},s)}}const cs=new Ov,Iv=cs.getBaseCstVisitorConstructor();var J=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.TEXT=1]="TEXT",t[t.LABEL=2]="LABEL",t[t.HYPERLINK=3]="HYPERLINK",t[t.STAT=4]="STAT",t[t.MOVE=5]="MOVE",t[t.COMMAND=6]="COMMAND",t[t.LITERAL=7]="LITERAL",t[t.IF=8]="IF",t[t.ELSE_IF=9]="ELSE_IF",t[t.ELSE=10]="ELSE",t[t.WHILE=11]="WHILE",t[t.BREAK=12]="BREAK",t[t.CONTINUE=13]="CONTINUE",t[t.REPEAT=14]="REPEAT",t[t.READ=15]="READ",t[t.OR=16]="OR",t[t.AND=17]="AND",t[t.NOT=18]="NOT",t[t.COMPARE=19]="COMPARE",t[t.OPERATOR=20]="OPERATOR",t[t.OPERATOR_ITEM=21]="OPERATOR_ITEM",t[t.EXPR=22]="EXPR",t))(J||{}),Mn=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(Mn||{}),Lt=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(Lt||{}),Ni=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(Ni||{});function eL(t){return t}function ce(t,e){return((e==null?void 0:e.map(n=>t.visit(n)).filter(n=>n))||[]).flat()}function ln(t){return t.image}function nd(t,e){return G(t,{type:7,literal:1,value:e})}function Lv(t){return!!(t!=null&&t.tokenType)}function Cv(t){const e=Object.values(t).flat().filter(n=>!!n).map(n=>n&&Lv(n)?{startLine:n.startLine,startColumn:n.startColumn,startOffset:n.startOffset,endLine:n.endLine,endColumn:n.endColumn,endOffset:n.endOffset}:n!=null&&n.location?{...n.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(n=>n.startLine!==0&&n.endLine!==0);return{startLine:Math.min(...e.map(n=>n.startLine||1)),startColumn:Math.min(...e.map(n=>n.startColumn||1)),startOffset:Math.min(...e.map(n=>n.startOffset||1)),endLine:Math.max(...e.map(n=>n.endLine||1)),endColumn:Math.max(...e.map(n=>n.endColumn||1)),endOffset:Math.max(...e.map(n=>n.endOffset||1))}}function G(t,e){return{...e,...Cv(t)}}class bv extends Iv{constructor(){super(),Ot&&this.validateVisitor()}program(e){return G(e,{type:0,lines:ce(this,e.line)})}line(e){if(e.stmt)return this.visit(e.stmt)}stmt(e){if(e.stat)return this.visit(e.stat);if(e.text)return this.visit(e.text);if(e.label)return this.visit(e.label);if(e.comment)return this.visit(e.comment);if(e.commands)return this.visit(e.commands)}stat(){}text(e){if(e.Text)return G(e,{type:1,value:ln(e.Text[0])})}label(e){var n;return G(e,{type:2,active:!0,name:ln(((n=e.Label)==null?void 0:n[0])??":").slice(1).trim()})}comment(e){return G(e,{type:2,active:!1,name:ln(e.Comment[0]).slice(1).trim()})}commands(e){return ce(this,e.command)}command(e){if(e.flat_cmd)return this.visit(e.flat_cmd);if(e.structured_cmd)return this.visit(e.structured_cmd)}flat_cmd(e){if(e.words)return G(e,{type:6,words:ce(this,e.words).flat()});if(e.hyperlink)return this.visit(e.hyperlink);if(e.Short_go)return this.visit(e.Short_go);if(e.Short_try)return this.visit(e.Short_try);if(e.Command_play)return this.visit(e.Command_play)}structured_cmd(e){if(e.Command_if)return this.visit(e.Command_if);if(e.Command_read)return this.visit(e.Command_read);if(e.Command_while)return this.visit(e.Command_while);if(e.Command_repeat)return this.visit(e.Command_repeat);if(e.Command_break)return this.visit(e.Command_break);if(e.Command_continue)return this.visit(e.Command_continue)}hyperlink(e){var n;return G(e,{type:3,link:ce(this,e.words).flat(),text:ln(((n=e.HyperLinkText)==null?void 0:n[0])??";").slice(1)})}Short_go(e){if(e.Divide)return G(e,{type:5,wait:!0,words:ce(this,e.words).flat()})}Short_try(e){if(e.Query)return G(e,{type:5,wait:!1,words:ce(this,e.words).flat()})}Command_play(e){if(e.Command_play)return G(e,{type:6,words:[nd(e,"play"),nd(e,ln(e.Command_play[0]).replace("#play","").trim())]})}do_line(e){return this.visit(e.do_stmt)}do_stmt(e){if(e.text)return this.visit(e.text);if(e.comment)return this.visit(e.comment);if(e.commands)return this.visit(e.commands)}Command_if(e){const n=ce(this,e.words).flat(),r=[this.visit(e.command),...ce(this,e.do_line)].flat(),s=[this.visit(e.Command_else_if),this.visit(e.Command_else)].flat();return G(e,{type:8,method:"if",words:n.filter(L),lines:r.filter(L),branches:s.filter(L)})}Command_else_if(e){const n=ce(this,e.words).flat(),r=[this.visit(e.command),...ce(this,e.do_line)].flat(),s=ce(this,e.Command_else_if).flat();return[G(e,{type:9,method:"if",words:n.filter(L),lines:r.filter(L)}),...s.filter(L),this.visit(e.Command_else)]}Command_else(e){const n=ce(this,e.words).flat(),r=[this.visit(e.command),...ce(this,e.do_line)].flat();return G(e,{type:10,method:"if",words:n.filter(L),lines:r.filter(L)})}Command_endif(){}Command_while(e){const n=ce(this,e.words).flat(),r=[this.visit(e.command),...ce(this,e.do_line)].flat();return G(e,{type:11,words:n.filter(L),lines:r.filter(L)})}Command_repeat(e){const n=ce(this,e.words).flat(),r=[this.visit(e.command),...ce(this,e.do_line)].flat();return G(e,{type:14,words:n.filter(L),lines:r.filter(L)})}Command_read(e){const n=ce(this,e.words).flat(),r=[this.visit(e.command),...ce(this,e.do_line)].flat();return G(e,{type:15,words:n.filter(L),lines:r.filter(L)})}Command_break(e){return G(e,{type:12})}Command_continue(e){return G(e,{type:13})}expr(e){return e.and_test.length===1?this.visit(e.and_test):G(e,{type:16,items:this.visit(e.and_test)})}and_test(e){return e.not_test.length===1?this.visit(e.not_test):G(e,{type:17,items:this.visit(e.not_test)})}not_test(e){if(e.comparison)return this.visit(e.comparison);if(e.not_test)return G(e,{type:18,items:this.visit(e.not_test)})}comparison(e){return e.arith_expr.length===1?this.visit(e.arith_expr):G(e,{type:19,lhs:this.visit(e.arith_expr[0]),compare:this.visit(e.comp_op),rhs:this.visit(e.arith_expr[1])})}comp_op(e){if(e.is||e.IsEq)return 0;if(e.IsNotEq)return 1;if(e.IsLessThan)return 2;if(e.IsGreaterThan)return 3;if(e.IsLessThanOrEqual)return 4;if(e.IsGreaterThanOrEqual)return 5}expr_value(e){return e.and_test_value.length===1?this.visit(e.and_test_value):G(e,{type:16,items:this.visit(e.and_test_value)})}and_test_value(e){return e.not_test_value.length===1?this.visit(e.not_test_value):G(e,{type:17,items:this.visit(e.not_test_value)})}not_test_value(e){if(e.arith_expr)return this.visit(e.arith_expr);if(e.not_test)return G(e,{type:18,items:this.visit(e.not_test)})}arith_expr(e){const n=this.visit(e.term);return e.arith_expr_item?G(e,{type:20,lhs:n,items:this.visit(e.arith_expr_item)}):n}arith_expr_item(e){return G(e,{type:21,operator:e.Plus?1:2,rhs:this.visit(e.term)})}term(e){return e.term_item?G(e,{type:20,lhs:this.visit(e.factor),items:this.visit(e.term_item)}):this.visit(e.factor)}term_item(e){let n=0;return e.Multiply&&(n=4),e.Divide&&(n=5),e.ModDivide&&(n=6),e.FloorDivide&&(n=7),G(e,{type:21,operator:n,rhs:this.visit(e.factor)})}factor(e){if(e.power)return this.visit(e.power);let n=0;return e.Plus&&(n=8),e.Minus&&(n=9),G(e,{type:20,lhs:void 0,items:[G(e,{type:21,operator:n,rhs:this.visit(e.factor)})]})}power(e){const n=this.visit(e.token);return e.factor?G(e,{type:20,lhs:n,items:[G(e,{type:21,operator:3,rhs:this.visit(e.factor)})]}):n}words(e){return ce(this,e.expr)}token(e){if(e.StringLiteralDouble){const n=ln(e.StringLiteralDouble[0]);return G(e,{type:7,literal:2,value:n.substring(1,n.length-1)})}if(e.StringLiteral)return G(e,{type:7,literal:1,value:ln(e.StringLiteral[0])});if(e.NumberLiteral)return G(e,{type:7,literal:0,value:parseFloat(ln(e.NumberLiteral[0]))});if(e.LParen)return G(e,{type:22,words:ce(this,e.expr).flat()})}}const kv=new bv,Be={internal:0,labels:{},labelIndex:0},Oi="if (api.hm()) { continue zss; }",rd=`if (api.sy()) { yield 1; ${Oi} };`,Ii=`yield 1; ${Oi}`,Li="zss.js";function le(t,e){return new mv(t.startLine||1,t.startColumn||1,Li,e)}function Pa(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Mv(t){return`'${Pa(t)}'`}function Ci(t){if(t.startsWith('"'))return Ci(t.substring(1,t.length-1));const e=wv(t);return e.errors.length?t:`'${e.tokens.map(r=>r.tokenType===Ua?`', api.group('${Pa(r.image.substring(1))}'), '`:Pa(r.image)).join("")}'`}function Ct(t){return t.filter(e=>e!==void 0).map(Y)}function sd(t){return le(t,"")}function xv(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function re(t,e,n){return le(t,[`api.${e}(`,...xv(n,", "),")"])}function Uv(t){if(t.type===J.COMPARE)switch(t.compare){case Mn.IS_EQ:return re(t,"isEq",[Y(t.lhs),Y(t.rhs)]);case Mn.IS_NOT_EQ:return re(t,"isNotEq",[Y(t.lhs),Y(t.rhs)]);case Mn.IS_LESS_THAN:return re(t,"isLessThan",[Y(t.lhs),Y(t.rhs)]);case Mn.IS_GREATER_THAN:return re(t,"isGreaterThan",[Y(t.lhs),Y(t.rhs)]);case Mn.IS_LESS_THAN_OR_EQ:return re(t,"isLessThanOrEq",[Y(t.lhs),Y(t.rhs)]);case Mn.IS_GREATER_THAN_OR_EQ:return re(t,"isGreaterThanOrEq",[Y(t.lhs),Y(t.rhs)])}return le(t,"")}function xn(t,e,n,r){return e.prepend(`api.${n}(`),e.add([", ",Y(r),")"])}function id(t,e,n,r){return e.prepend(`api.${n}(`),e.add([Y(r),")"])}function Pv(t,e){if(t.type===J.OPERATOR_ITEM)switch(t.operator){case Lt.PLUS:return xn(t,e,"opPlus",t.rhs);case Lt.MINUS:return xn(t,e,"opMinus",t.rhs);case Lt.POWER:return xn(t,e,"opPower",t.rhs);case Lt.MULTIPLY:return xn(t,e,"opMultiply",t.rhs);case Lt.DIVIDE:return xn(t,e,"opDivide",t.rhs);case Lt.MOD_DIVIDE:return xn(t,e,"opModDivide",t.rhs);case Lt.FLOOR_DIVIDE:return xn(t,e,"opFloorDivide",t.rhs);case Lt.UNI_PLUS:return id(t,e,"opUniPlus",t.rhs);case Lt.UNI_MINUS:return id(t,e,"opUniMinus",t.rhs)}return le(t,"")}function Dv(t){if(t.type===J.OPERATOR){const e=t.lhs?Y(t.lhs):le(t,"");return t.items.forEach(n=>Pv(n,e)),e}return le(t,"")}function Y(t){switch(t.type){case J.PROGRAM:return le(t,[`try { // first-line
`,`zss: while (true) {
`,`switch (api.getcase()) {
`,`default:
`,`case 1: 
`,...t.lines.map(e=>[Y(e),`
`]).flat(),`}
`,`api.endofprogram();
`,`while(true) { ${Ii} }
`,`}
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Li}`]);case J.LITERAL:switch(t.literal){case Ni.NUMBER:return le(t,`${t.value}`);case Ni.STRING:return le(t,Mv(t.value));case Ni.TEMPLATE:return le(t,Ci(t.value))}return sd(t);case J.TEXT:return re(t,"text",[Ci(t.value)]);case J.STAT:return re(t,"stat",Ct(t.words));case J.LABEL:{const e=Be.labelIndex++;return Be.labels[t.name]||(Be.labels[t.name]=[]),Be.labels[t.name].push(t.active?e:-e),le(t,`case ${e}: // ${t.name}`)}case J.HYPERLINK:return re(t,"hyperlink",[Ci(t.text),...Ct(t.link)]);case J.MOVE:return le(t,["while (",re(t,"move",[t.wait?"true":"false",...Ct(t.words)]),`) { ${Ii} };
         ${rd} ${Oi}`]);case J.COMMAND:return le(t,["while (",re(t,"command",Ct(t.words)),`) { ${Ii} };
         ${rd} ${Oi}`]);case J.IF:{const e=le(t,["if (",re(t,`${t.method}`,Ct(t.words)),`) {
`]);return t.lines&&t.lines.forEach(n=>e.add([Y(n),`
`])),t.branches&&t.branches.forEach(n=>e.add(Y(n))),e.add("}"),e}case J.ELSE_IF:{const e=le(t,["} else if (",re(t,t.method,Ct(t.words)),`) {
`]);return t.lines&&t.lines.forEach(n=>e.add([Y(n),`
`])),e}case J.ELSE:{const e=le(t,`} else {
`);return t.words.length&&e.add(["while (",re(t,"command",Ct(t.words)),`) { ${Ii} };`]),t.lines&&t.lines.forEach(n=>e.add([Y(n),`
`])),e}case J.WHILE:{const e=le(t,["while (",re(t,"if",Ct(t.words)),`) {
`]);return t.lines&&t.lines.forEach(n=>e.add([Y(n),`
`])),e.add("}"),e}case J.REPEAT:{const e=le(t,[re(t,"repeatStart",[`${Be.internal}`,...Ct(t.words)]),`;
while (`,re(t,"repeat",[`${Be.internal}`]),`) {
`]);return Be.internal+=1,t.lines&&t.lines.forEach(n=>e.add([Y(n),`
`])),e.add("}"),e}case J.READ:{const[e,...n]=t.words,r=le(t,[re(t,"readStart",[`${Be.internal}`,Y(e)]),`;
while (`,re(t,"read",[`${Be.internal}`,...Ct(n)]),`) {
`]);return Be.internal+=1,t.lines&&t.lines.forEach(s=>r.add([Y(s),`
`])),r.add("}"),r}case J.BREAK:return le(t,`break;
`);case J.CONTINUE:return le(t,`continue;
`);case J.OR:return re(t,"or",t.items.map(Y));case J.AND:return re(t,"and",t.items.map(Y));case J.NOT:return re(t,"not",t.items.map(Y));case J.COMPARE:return Uv(t);case J.OPERATOR:return Dv(t);case J.EXPR:return re(t,"expr",t.words.map(Y));default:return console.error("<unsupported node>",t),sd(t)}}function Fv(t){return Be.internal=0,Be.labels={restart:[1]},Be.labelIndex=2,{...Y(t).toStringWithSourceMap({file:`${Li}.map`}),...Be}}const $v=64;function Bv(t){return Array.isArray(t)?t.length>0?1:0:t??0}function Xt(t){return`${t??""}`}function Gv(t,e){var w;const n=Fg(e.labels??{});let r,s="",i,o=0;const a={},c={},l={};let u=!1,h=3,d=0,f=!1;const p=[];let m={};function A(E){if(m[E]===void 0)for(let T=0;T<p.length;++T){const g=p[T].getcommand(E);g&&(m[E]=g)}return m[E]}function S(E,T){const g=A(E);if(!g)throw new Error(`unknown firmware command ${E}`);return g(y,T)}const y={id(){return t},install(E){m={},p.push(E)},set(E,T){const g=E.toLowerCase();for(let _=0;_<p.length;++_){const[v]=p[_].set(y,g,T);if(v)return T}return T},get(E){const T=E.toLowerCase();for(let g=0;g<p.length;++g){const[_,v]=p[g].get(y,T);if(_)return v}},cycle(E){h=E},tick(){for(let T=0;T<p.length;++T)p[T].shouldtick(y);if(!y.shouldtick())return!1;const E=d%h===0;if(++d,!E)return!1;o=0,u=!1;for(let T=0;T<p.length;++T)p[T].tick(y);try{const T=r==null?void 0:r.next();T!=null&&T.done&&(console.error("we crashed?",e.source),f=!0)}catch(T){console.error("we crashed?",T),f=!0}for(let T=0;T<p.length;++T)p[T].tock(y);return!0},shouldtick(){return f===!1||y.hm()!==0},shouldhalt(){return o++>$v},hm(){var T;const E=(i==null?void 0:i.target)??"";return((T=n[E])==null?void 0:T.find(g=>g>0))??0},yield(){u=!0},sy(){return u||y.shouldhalt()},send(E,T){const g=`vm:${t}:${E}`;We.emit(g,t,T)},lock(E){s=E},unlock(){s=""},message(E){s&&E.sender!==s||(i=E)},zap(E){const T=n[E];if(T){const g=T.findIndex(_=>_>0);g>=0&&(T[g]*=-1)}},restore(E){const T=n[E];if(T)for(let g=0;g<T.length;g++)T[g]=Math.abs(T[g])},getcase(){if(i){const E=y.hm();return y.set("sender",i.sender),y.set("data",i.data),i.player&&y.set("player",i.player),i=void 0,u=!1,f=!1,E}return 0},endofprogram(){y.yield(),f=!0},stacktrace(E){const T=YR.parse(E),[g]=T.filter(_=>_.fileName===Li);return{line:(g==null?void 0:g.lineNumber)??0,column:(g==null?void 0:g.columnNumber)??0}},text(E){return S("text",[E])},stat(...E){return S("stat",E)},hyperlink(...E){return S("hyperlink",E)},move(E,...T){const g=y.command("go",...T);return y.yield(),g&&E?1:0},command(...E){if(E.length===0)return 0;const[T,...g]=E,_=A(Xt(T));return _?_(y,g):S("send",[T,...g])},if(...E){const T=H(y,E),[g,_]=O(T,0,[N.ANY]),v=Bv(g);return v&&_<E.length&&y.command(...E.slice(_)),v},repeatStart(E,...T){const g=H(y,T),[_,v]=O(g,0,[N.NUMBER]);a[E]=_,c[E]=v<T.length?T.slice(v):void 0},repeat(E){const T=a[E]??0;a[E]=T-1;const g=T>0,_=c[E];return g&&_&&y.command(..._),g},readStart(E,T){if(!Ne(T))return;const g=y.get(T)??[];l[E]=Array.isArray(g)?g:[g]},read(E,...T){const g=l[E];if(Array.isArray(g)===!1)return!1;const _=g.shift();if(_===void 0)return!1;const v=T.map(Xt);switch(typeof _){case"number":case"string":v.forEach(R=>{y.set(R,_)});break;case"object":v.forEach(R=>{const I=_[R];y.set(R,I)});break}return!0},or(...E){const T=H(y,E);let g=0;for(let _=0;_<E.length;){const[v,R]=O(T,0,[N.ANY]);if(g=v,g)break;_=R}return g},and(...E){const T=H(y,E);let g=0;for(let _=0;_<E.length;){const[v,R]=O(T,0,[N.ANY]);if(g=v,!g)break;_=R}return g},not(...E){const T=H(y,E),[g]=O(T,0,[N.ANY]);return g?0:1},expr(...E){const T=H(y,E),[g]=O(T,0,[N.ANY]);return g},isEq(E,T){const[g]=O(H(y,[E]),0,[N.ANY]),[_]=O(H(y,[T]),0,[N.ANY]);return Dg(g,_)?1:0},isNotEq(E,T){const[g]=O(H(y,[E]),0,[N.ANY]),[_]=O(H(y,[T]),0,[N.ANY]);return g!==_?1:0},isLessThan(E,T){const[g]=O(H(y,[E]),0,[N.NUMBER]),[_]=O(H(y,[T]),0,[N.NUMBER]);return g<_?1:0},isGreaterThan(E,T){const[g]=O(H(y,[E]),0,[N.NUMBER]),[_]=O(H(y,[T]),0,[N.NUMBER]);return g>_?1:0},isLessThanOrEq(E,T){const[g]=O(H(y,[E]),0,[N.NUMBER]),[_]=O(H(y,[T]),0,[N.NUMBER]);return g<=_?1:0},isGreaterThanOrEq(E,T){const[g]=O(H(y,[E]),0,[N.NUMBER]),[_]=O(H(y,[T]),0,[N.NUMBER]);return g>=_?1:0},opPlus(E,T){const[g]=O(H(y,[E]),0,[N.ANY]),[_]=O(H(y,[T]),0,[N.ANY]);return g+_},opMinus(E,T){const[g]=O(H(y,[E]),0,[N.ANY]),[_]=O(H(y,[T]),0,[N.ANY]);return g-_},opPower(E,T){const[g]=O(H(y,[E]),0,[N.NUMBER]),[_]=O(H(y,[T]),0,[N.NUMBER]);return Math.pow(g,_)},opMultiply(E,T){const[g]=O(H(y,[E]),0,[N.NUMBER]),[_]=O(H(y,[T]),0,[N.NUMBER]);return g*_},opDivide(E,T){const[g]=O(H(y,[E]),0,[N.NUMBER]),[_]=O(H(y,[T]),0,[N.NUMBER]);return g/_},opModDivide(E,T){const[g]=O(H(y,[E]),0,[N.NUMBER]),[_]=O(H(y,[T]),0,[N.NUMBER]);return g%_},opFloorDivide(E,T){const[g]=O(H(y,[E]),0,[N.NUMBER]),[_]=O(H(y,[T]),0,[N.NUMBER]);return Math.floor(g/_)},opUniPlus(E){const[T]=O(H(y,[E]),0,[N.NUMBER]);return+T},opUniMinus(E){const[T]=O(H(y,[E]),0,[N.NUMBER]);return-T}};return r=(w=e.code)==null?void 0:w.call(e,y),y}function od(t){const e={},n={...t,getcommand(r){return e[r]},command(r,s){return e[r]=s,n}};return n}var ad={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(t){(function(){var e=function(f,p){return p=p||"",f.replace(/(^|-)/g,"$1\\u"+p).replace(/,/g,"\\u"+p)},n=e("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+e("DF-F6,F8-FF","00"),s="A-Z"+e("C0-D6,D8-DE","00"),i="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(f,p,m,A){return f=f||n,p=p||r,m=m||s,A=A||i,{capitalize:new RegExp("(^|["+f+"])(["+p+"])","g"),pascal:new RegExp("(^|["+f+"])+(["+p+m+"])","g"),fill:new RegExp("["+f+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+p+"])","g"),improper:new RegExp("\\b("+A+")\\b","g"),relax:new RegExp("([^"+m+"])(["+m+"]*)(["+m+"])(?=[^"+m+"]|$)","g"),upper:new RegExp("^[^"+p+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+f+"]")}},a=o(),c={re:a,unicodes:e,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(f){return c.up.call(f.charAt(0))+f.slice(1)},decap:function(f){return c.low.call(f.charAt(0))+f.slice(1)},deapostrophe:function(f){return f.replace(a.apostrophe,"")},fill:function(f,p,m){return p!=null&&(f=f.replace(a.fill,function(A,S){return S?p+S:""})),m&&(f=c.deapostrophe(f)),f},prep:function(f,p,m,A){if(f=f==null?"":f+"",!A&&a.upper.test(f)&&(f=c.low.call(f)),!p&&!a.hole.test(f)){var S=c.fill(f," ");a.hole.test(S)&&(f=S)}return!m&&!a.room.test(f)&&(f=f.replace(a.relax,c.relax)),f},relax:function(f,p,m,A){return p+" "+(m?m+" ":"")+A}},l={_:c,of:function(f){for(var p=0,m=c.types.length;p<m;p++)if(l[c.types[p]].apply(l,arguments)===f)return c.types[p]},flip:function(f){return f.replace(/\w/g,function(p){return(p==c.up.call(p)?c.low:c.up).call(p)})},random:function(f){return f.replace(/\w/g,function(p){return(Math.round(Math.random())?c.up:c.low).call(p)})},type:function(f,p){l[f]=p,c.types.push(f)}},u={lower:function(f,p,m){return c.fill(c.low.call(c.prep(f,p)),p,m)},snake:function(f){return l.lower(f,"_",!0)},constant:function(f){return l.upper(f,"_",!0)},camel:function(f){return c.decap(l.pascal(f))},kebab:function(f){return l.lower(f,"-",!0)},upper:function(f,p,m){return c.fill(c.up.call(c.prep(f,p,!1,!0)),p,m)},capital:function(f,p,m){return c.fill(c.prep(f).replace(a.capitalize,function(A,S,y){return S+c.up.call(y)}),p,m)},header:function(f){return l.capital(f,"-",!0)},pascal:function(f){return c.fill(c.prep(f,!1,!0).replace(a.pascal,function(p,m,A){return c.up.call(A)}),"",!0)},title:function(f){return l.capital(f).replace(a.improper,function(p,m,A,S){return A>0&&A<S.lastIndexOf(" ")?c.low.call(p):p})},sentence:function(f,p,m){return f=l.lower(f).replace(a.sentence,function(A,S,y){return S+c.up.call(y)}),p&&p.forEach(function(A){f=f.replace(new RegExp("\\b"+l.lower(A)+"\\b","g"),c.cap)}),m&&m.forEach(function(A){f=f.replace(new RegExp("(\\b"+l.lower(A)+"\\. +)(\\w)"),function(S,y,w){return y+c.low.call(w)})}),f}};u.squish=u.pascal,l.default=l;for(var h in u)l.type(h,u[h]);var d=typeof d=="function"?d:function(){};d(t.exports?t.exports=l:this.Case=l)}).call(vs)})(ad);var Wv=ad.exports,Kv=no(Wv);const cd=1,ld=2,Da=4,Fa=8,ls=32,Jt=64,Xe=128,bi=31,$a=63,Un=127,jv=2147483647,un=Math.floor,ki=Math.abs,ud=(t,e)=>t<e?t:e,Pn=(t,e)=>t>e?t:e,hd=t=>t!==0?t<0:1/t<0,fd=Number.MAX_SAFE_INTEGER,Hv=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&un(t)===t),lr=()=>new Set,Ba=t=>t[t.length-1],Vv=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},hn=Array.from,Yv=Array.isArray,zv=t=>t.toLowerCase(),qv=/^\s*/g,Xv=t=>t.replace(qv,""),Jv=/([A-Z])/g,dd=(t,e)=>Xv(t.replace(Jv,n=>`${e}${zv(n)}`)),Qv=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.codePointAt(s);return r},us=typeof TextEncoder<"u"?new TextEncoder:null,Zv=us?t=>us.encode(t):Qv;let hs=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});hs&&hs.decode(new Uint8Array).length===1&&(hs=null);const fn=t=>new Error(t),bt=()=>{throw fn("Method unimplemented")},kt=()=>{throw fn("Unexpected case")};class fs{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const dn=()=>new fs,eN=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},mt=t=>{const e=new Uint8Array(eN(t));let n=0;for(let r=0;r<t.bufs.length;r++){const s=t.bufs[r];e.set(s,n),n+=s.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},tN=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Pn(n,e)*2),t.cpos=0)},Te=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},Ga=Te,$=(t,e)=>{for(;e>Un;)Te(t,Xe|Un&e),e=un(e/128);Te(t,Un&e)},Wa=(t,e)=>{const n=hd(e);for(n&&(e=-e),Te(t,(e>$a?Xe:0)|(n?Jt:0)|$a&e),e=un(e/64);e>0;)Te(t,(e>Un?Xe:0)|Un&e),e=un(e/128)},Ka=new Uint8Array(3e4),nN=Ka.length/3,rN=(t,e)=>{if(e.length<nN){const n=us.encodeInto(e,Ka).written||0;$(t,n);for(let r=0;r<n;r++)Te(t,Ka[r])}else Le(t,Zv(e))},sN=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;$(t,r);for(let s=0;s<r;s++)Te(t,n.codePointAt(s))},ur=us&&us.encodeInto?rN:sN,Mi=(t,e)=>{const n=t.cbuf.length,r=t.cpos,s=ud(n-r,e.length),i=e.length-s;t.cbuf.set(e.subarray(0,s),r),t.cpos+=s,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Pn(n*2,i)),t.cbuf.set(e.subarray(s)),t.cpos=i)},Le=(t,e)=>{$(t,e.byteLength),Mi(t,e)},ja=(t,e)=>{tN(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},iN=(t,e)=>ja(t,4).setFloat32(0,e,!1),oN=(t,e)=>ja(t,8).setFloat64(0,e,!1),aN=(t,e)=>ja(t,8).setBigInt64(0,e,!1),pd=new DataView(new ArrayBuffer(4)),cN=t=>(pd.setFloat32(0,t),pd.getFloat32(0)===t),ds=(t,e)=>{switch(typeof e){case"string":Te(t,119),ur(t,e);break;case"number":Hv(e)&&ki(e)<=jv?(Te(t,125),Wa(t,e)):cN(e)?(Te(t,124),iN(t,e)):(Te(t,123),oN(t,e));break;case"bigint":Te(t,122),aN(t,e);break;case"object":if(e===null)Te(t,126);else if(Yv(e)){Te(t,117),$(t,e.length);for(let n=0;n<e.length;n++)ds(t,e[n])}else if(e instanceof Uint8Array)Te(t,116),Le(t,e);else{Te(t,118);const n=Object.keys(e);$(t,n.length);for(let r=0;r<n.length;r++){const s=n[r];ur(t,s),ds(t,e[s])}}break;case"boolean":Te(t,e?120:121);break;default:Te(t,127)}};class gd extends fs{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&$(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const md=t=>{t.count>0&&(Wa(t.encoder,t.count===1?t.s:-t.s),t.count>1&&$(t.encoder,t.count-2))};class xi{constructor(){this.encoder=new fs,this.s=0,this.count=0}write(e){this.s===e?this.count++:(md(this),this.count=1,this.s=e)}toUint8Array(){return md(this),mt(this.encoder)}}const Ed=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Wa(t.encoder,e),t.count>1&&$(t.encoder,t.count-2)}};class Ha{constructor(){this.encoder=new fs,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Ed(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Ed(this),mt(this.encoder)}}class lN{constructor(){this.sarr=[],this.s="",this.lensE=new xi}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new fs;return this.sarr.push(this.s),this.s="",ur(e,this.sarr.join("")),Mi(e,this.lensE.toUint8Array()),mt(e)}}const _d=fn("Unexpected end of array"),yd=fn("Integer out of Range");class Ui{constructor(e){this.arr=e,this.pos=0}}const Dn=t=>new Ui(t),uN=t=>t.pos!==t.arr.length,hN=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Pe=t=>hN(t,B(t)),hr=t=>t.arr[t.pos++],B=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const s=t.arr[t.pos++];if(e=e+(s&Un)*n,n*=128,s<Xe)return e;if(e>fd)throw yd}throw _d},Va=t=>{let e=t.arr[t.pos++],n=e&$a,r=64;const s=(e&Jt)>0?-1:1;if(!(e&Xe))return s*n;const i=t.arr.length;for(;t.pos<i;){if(e=t.arr[t.pos++],n=n+(e&Un)*r,r*=128,e<Xe)return s*n;if(n>fd)throw yd}throw _d},fr=hs?t=>hs.decode(Pe(t)):t=>{let e=B(t);if(e===0)return"";{let n=String.fromCodePoint(hr(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(hr(t));else for(;e>0;){const r=e<1e4?e:1e4,s=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,s),e-=r}return decodeURIComponent(escape(n))}},Ya=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},fN=[t=>{},t=>null,Va,t=>Ya(t,4).getFloat32(0,!1),t=>Ya(t,8).getFloat64(0,!1),t=>Ya(t,8).getBigInt64(0,!1),t=>!1,t=>!0,fr,t=>{const e=B(t),n={};for(let r=0;r<e;r++){const s=fr(t);n[s]=ps(t)}return n},t=>{const e=B(t),n=[];for(let r=0;r<e;r++)n.push(ps(t));return n},Pe],ps=t=>fN[127-hr(t)](t);class Td extends Ui{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),uN(this)?this.count=B(this)+1:this.count=-1),this.count--,this.s}}class Pi extends Ui{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Va(this);const e=hd(this.s);this.count=1,e&&(this.s=-this.s,this.count=B(this)+2)}return this.count--,this.s}}class za extends Ui{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Va(this),n=e&1;this.diff=un(e/2),this.count=1,n&&(this.count=B(this)+2)}return this.s+=this.diff,this.count--,this.s}}class dN{constructor(e){this.decoder=new Pi(e),this.str=fr(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const Et=()=>new Map,qa=t=>{const e=Et();return t.forEach((n,r)=>{e.set(r,n)}),e},pn=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},pN=(t,e)=>{const n=[];for(const[r,s]of t)n.push(e(s,r));return n},gN=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1};class mN{constructor(){this._observers=Et()}on(e,n){return pn(this._observers,e,lr).add(n),n}once(e,n){const r=(...s)=>{this.off(e,r),n(...s)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return hn((this._observers.get(e)||Et()).values()).forEach(r=>r(...n))}destroy(){this._observers=Et()}}const EN=crypto.getRandomValues.bind(crypto),Sd=()=>EN(new Uint32Array(1))[0],_N="10000000-1000-4000-8000"+-1e11,yN=()=>_N.replace(/[018]/g,t=>(t^Sd()&15>>t/4).toString(16)),Ad=t=>new Promise(t);Promise.all.bind(Promise);const wd=t=>t===void 0?null:t;class TN{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Rd=new TN,SN=!0;try{typeof localStorage<"u"&&localStorage&&(Rd=localStorage,SN=!1)}catch{}const AN=Rd,wN=Object.assign,RN=Object.keys,vN=(t,e)=>{for(const n in t)e(t[n],n)},vd=t=>RN(t).length,NN=t=>{for(const e in t)return!1;return!0},ON=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},IN=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),LN=(t,e)=>t===e||vd(t)===vd(e)&&ON(t,(n,r)=>(n!==void 0||IN(e,r))&&e[r]===n),Xa=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Xa(t,e,n+1)}},CN=t=>t,bN=(t,e)=>e.includes(t);var Nd={};const gs=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Mt;const kN=()=>{if(Mt===void 0)if(gs){Mt=Et();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Mt.set(e,""),e=r):e!==null&&(Mt.set(e,r),e=null)}e!==null&&Mt.set(e,"")}else typeof location=="object"?(Mt=Et(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Mt.set(`--${dd(e,"-")}`,n),Mt.set(`-${dd(e,"-")}`,n)}})):Mt=Et();return Mt},Ja=t=>kN().has(t),Qa=t=>wd(gs?Nd[t.toUpperCase().replaceAll("-","_")]:AN.getItem(t));(t=>Ja("--"+t)||Qa(t)!==null)("production");const Od=gs&&bN(Nd.FORCE_COLOR,["true","1","2"]),MN=!Ja("no-colors")&&(!gs||process.stdout.isTTY||Od)&&(!gs||Ja("color")||Od||Qa("COLORTERM")!==null||(Qa("TERM")||"").includes("color")),xN=t=>new Uint8Array(t),UN=t=>{const e=xN(t.byteLength);return e.set(t),e};class PN{constructor(e,n){this.left=e,this.right=n}}const Qt=(t,e)=>new PN(t,e);typeof DOMParser<"u"&&new DOMParser;const DN=t=>pN(t,(e,n)=>`${n}:${e};`).join(""),Zt=Symbol,Id=Zt(),Ld=Zt(),FN=Zt(),$N=Zt(),BN=Zt(),Cd=Zt(),GN=Zt(),bd=Zt(),WN=Zt(),KN=t=>{var r;t.length===1&&((r=t[0])==null?void 0:r.constructor)===Function&&(t=t[0]());const e=[];let n=0;for(;n<t.length;n++){const s=t[n];s===void 0||s.constructor===String||s.constructor===Number||s.constructor===Object&&e.push(JSON.stringify(s))}return e},jN={[Id]:Qt("font-weight","bold"),[Ld]:Qt("font-weight","normal"),[FN]:Qt("color","blue"),[BN]:Qt("color","green"),[$N]:Qt("color","grey"),[Cd]:Qt("color","red"),[GN]:Qt("color","purple"),[bd]:Qt("color","orange"),[WN]:Qt("color","black")},HN=MN?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Et();let s=[],i=0;for(;i<t.length;i++){const a=t[i],c=jN[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=DN(r);i>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(i>0&&(s=n,s.unshift(e.join("")));i<t.length;i++){const a=t[i];a instanceof Symbol||s.push(a)}return s}:KN,VN=(...t)=>{console.log(...HN(t)),YN.forEach(e=>e.print(t))},YN=lr(),kd=t=>({[Symbol.iterator](){return this},next:t}),zN=(t,e)=>kd(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Za=(t,e)=>kd(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class ec{constructor(e,n){this.clock=e,this.len=n}}class ms{constructor(){this.clients=new Map}}const Md=(t,e,n)=>e.clients.forEach((r,s)=>{const i=t.doc.store.clients.get(s);for(let o=0;o<r.length;o++){const a=r[o];Jd(t,i,a.clock,a.len,n)}}),qN=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const s=un((n+r)/2),i=t[s],o=i.clock;if(o<=e){if(e<o+i.len)return s;n=s+1}else r=s-1}return null},xd=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&qN(n,e.clock)!==null},tc=t=>{t.clients.forEach(e=>{e.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<e.length;n++){const s=e[r-1],i=e[n];s.clock+s.len>=i.clock?s.len=Pn(s.len,i.clock+i.len-s.clock):(r<n&&(e[r]=i),r++)}e.length=r})},XN=t=>{const e=new ms;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,s)=>{if(!e.clients.has(s)){const i=r.slice();for(let o=n+1;o<t.length;o++)Vv(i,t[o].clients.get(s)||[]);e.clients.set(s,i)}});return tc(e),e},Di=(t,e,n,r)=>{pn(t.clients,e,()=>[]).push(new ec(n,r))},JN=()=>new ms,QN=t=>{const e=JN();return t.clients.forEach((n,r)=>{const s=[];for(let i=0;i<n.length;i++){const o=n[i];if(o.deleted){const a=o.id.clock;let c=o.length;if(i+1<n.length)for(let l=n[i+1];i+1<n.length&&l.deleted;l=n[++i+1])c+=l.length;s.push(new ec(a,c))}}s.length>0&&e.clients.set(r,s)}),e},dr=(t,e)=>{$(t.restEncoder,e.clients.size),hn(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),$(t.restEncoder,n);const s=r.length;$(t.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},nc=t=>{const e=new ms,n=B(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const s=B(t.restDecoder),i=B(t.restDecoder);if(i>0){const o=pn(e.clients,s,()=>[]);for(let a=0;a<i;a++)o.push(new ec(t.readDsClock(),t.readDsLen()))}}return e},Ud=(t,e,n)=>{const r=new ms,s=B(t.restDecoder);for(let i=0;i<s;i++){t.resetDsCurVal();const o=B(t.restDecoder),a=B(t.restDecoder),c=n.clients.get(o)||[],l=Se(n,o);for(let u=0;u<a;u++){const h=t.readDsClock(),d=h+t.readDsLen();if(h<l){l<d&&Di(r,o,l,d-l);let f=xt(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,Qi(e,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,Qi(e,p,d-p.id.clock)),p.delete(e))}else Di(r,o,h,d-h)}}if(r.clients.size>0){const i=new Fn;return $(i.restEncoder,0),dr(i,r),i.toUint8Array()}return null},Pd=Sd;class pr extends mN{constructor({guid:e=yN(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Pd(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new zd,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Ad(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Ad(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Q(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(hn(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Q(this,e,n)}get(e,n=Re){const r=pn(this.share,e,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==Re&&s!==n)if(s===Re){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,_r)}getText(e=""){return this.get(e,$n)}getMap(e=""){return this.get(e,yr)}getXmlElement(e=""){return this.get(e,Sr)}getXmlFragment(e=""){return this.get(e,Bn)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){hn(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new pr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Q(e.parent.doc,r=>{const s=n.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Dd{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return B(this.restDecoder)}readDsLen(){return B(this.restDecoder)}}class Fd extends Dd{readLeftID(){return j(B(this.restDecoder),B(this.restDecoder))}readRightID(){return j(B(this.restDecoder),B(this.restDecoder))}readClient(){return B(this.restDecoder)}readInfo(){return hr(this.restDecoder)}readString(){return fr(this.restDecoder)}readParentInfo(){return B(this.restDecoder)===1}readTypeRef(){return B(this.restDecoder)}readLen(){return B(this.restDecoder)}readAny(){return ps(this.restDecoder)}readBuf(){return UN(Pe(this.restDecoder))}readJSON(){return JSON.parse(fr(this.restDecoder))}readKey(){return fr(this.restDecoder)}}class ZN{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=B(this.restDecoder),this.dsCurrVal}readDsLen(){const e=B(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class gr extends ZN{constructor(e){super(e),this.keys=[],B(e),this.keyClockDecoder=new za(Pe(e)),this.clientDecoder=new Pi(Pe(e)),this.leftClockDecoder=new za(Pe(e)),this.rightClockDecoder=new za(Pe(e)),this.infoDecoder=new Td(Pe(e),hr),this.stringDecoder=new dN(Pe(e)),this.parentInfoDecoder=new Td(Pe(e),hr),this.typeRefDecoder=new Pi(Pe(e)),this.lenDecoder=new Pi(Pe(e))}readLeftID(){return new mr(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new mr(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ps(this.restDecoder)}readBuf(){return Pe(this.restDecoder)}readJSON(){return ps(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class $d{constructor(){this.restEncoder=dn()}toUint8Array(){return mt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){$(this.restEncoder,e)}writeDsLen(e){$(this.restEncoder,e)}}class Es extends $d{writeLeftID(e){$(this.restEncoder,e.client),$(this.restEncoder,e.clock)}writeRightID(e){$(this.restEncoder,e.client),$(this.restEncoder,e.clock)}writeClient(e){$(this.restEncoder,e)}writeInfo(e){Ga(this.restEncoder,e)}writeString(e){ur(this.restEncoder,e)}writeParentInfo(e){$(this.restEncoder,e?1:0)}writeTypeRef(e){$(this.restEncoder,e)}writeLen(e){$(this.restEncoder,e)}writeAny(e){ds(this.restEncoder,e)}writeBuf(e){Le(this.restEncoder,e)}writeJSON(e){ur(this.restEncoder,JSON.stringify(e))}writeKey(e){ur(this.restEncoder,e)}}class Bd{constructor(){this.restEncoder=dn(),this.dsCurrVal=0}toUint8Array(){return mt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,$(this.restEncoder,n)}writeDsLen(e){e===0&&kt(),$(this.restEncoder,e-1),this.dsCurrVal+=e}}class Fn extends Bd{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Ha,this.clientEncoder=new xi,this.leftClockEncoder=new Ha,this.rightClockEncoder=new Ha,this.infoEncoder=new gd(Ga),this.stringEncoder=new lN,this.parentInfoEncoder=new gd(Ga),this.typeRefEncoder=new xi,this.lenEncoder=new xi}toUint8Array(){const e=dn();return $(e,0),Le(e,this.keyClockEncoder.toUint8Array()),Le(e,this.clientEncoder.toUint8Array()),Le(e,this.leftClockEncoder.toUint8Array()),Le(e,this.rightClockEncoder.toUint8Array()),Le(e,mt(this.infoEncoder)),Le(e,this.stringEncoder.toUint8Array()),Le(e,mt(this.parentInfoEncoder)),Le(e,this.typeRefEncoder.toUint8Array()),Le(e,this.lenEncoder.toUint8Array()),Mi(e,mt(this.restEncoder)),mt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ds(this.restEncoder,e)}writeBuf(e){Le(this.restEncoder,e)}writeJSON(e){ds(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const eO=(t,e,n,r)=>{r=Pn(r,e[0].id.clock);const s=xt(e,r);$(t.restEncoder,e.length-s),t.writeClient(n),$(t.restEncoder,r);const i=e[s];i.write(t,r-i.id.clock);for(let o=s+1;o<e.length;o++)e[o].write(t,0)},rc=(t,e,n)=>{const r=new Map;n.forEach((s,i)=>{Se(e,i)>s&&r.set(i,s)}),$i(e).forEach((s,i)=>{n.has(i)||r.set(i,0)}),$(t.restEncoder,r.size),hn(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{eO(t,e.clients.get(s),s,i)})},tO=(t,e)=>{const n=Et(),r=B(t.restDecoder);for(let s=0;s<r;s++){const i=B(t.restDecoder),o=new Array(i),a=t.readClient();let c=B(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<i;l++){const u=t.readInfo();switch(bi&u){case 0:{const h=t.readLen();o[l]=new st(j(a,c),h),c+=h;break}case 10:{const h=B(t.restDecoder);o[l]=new it(j(a,c),h),c+=h;break}default:{const h=(u&(Jt|Xe))===0,d=new Ee(j(a,c),null,(u&Xe)===Xe?t.readLeftID():null,null,(u&Jt)===Jt?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(u&ls)===ls?t.readString():null,Ap(t,u));o[l]=d,c+=d.length}}}}return n},nO=(t,e,n)=>{const r=[];let s=hn(n.keys()).sort((f,p)=>f-p);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f};let o=i();if(o===null)return null;const a=new zd,c=new Map,l=(f,p)=>{const m=c.get(f);(m==null||m>p)&&c.set(f,p)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[f]),s=s.filter(A=>A!==p)}r.length=0};for(;;){if(u.constructor!==it){const p=pn(h,u.id.client,()=>Se(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const A=n.get(m)||{refs:[],i:0};if(A.refs.length===A.i)l(m,Se(e,m)),d();else{u=A.refs[A.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=i(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new Fn;return rc(f,a,new Map),$(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},rO=(t,e)=>rc(t,e.doc.store,e.beforeState),sO=(t,e,n,r=new gr(t))=>Q(e,s=>{s.local=!1;let i=!1;const o=s.doc,a=o.store,c=tO(r,o),l=nO(s,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<Se(a,d)){i=!0;break}if(l){for(const[d,f]of l.missing){const p=u.missing.get(d);(p==null||p>f)&&u.missing.set(d,f)}u.update=Gi([u.update,l.update])}}else a.pendingStructs=l;const h=Ud(r,s,a);if(a.pendingDs){const d=new gr(Dn(a.pendingDs));B(d.restDecoder);const f=Ud(d,s,a);h&&f?a.pendingDs=Gi([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(i){const d=a.pendingStructs.update;a.pendingStructs=null,Gd(s.doc,d)}},n,!1),Gd=(t,e,n,r=gr)=>{const s=Dn(e);sO(s,t,n,new r(s))},iO=(t,e,n)=>Gd(t,e,n,Fd),oO=(t,e,n=new Map)=>{rc(t,e.store,n),dr(t,QN(e.store))},aO=(t,e=new Uint8Array([0]),n=new Fn)=>{const r=Wd(e);oO(n,t,r);const s=[n.toUint8Array()];if(t.store.pendingDs&&s.push(t.store.pendingDs),t.store.pendingStructs&&s.push(AO(t.store.pendingStructs.update,e)),s.length>1){if(n.constructor===Es)return TO(s.map((i,o)=>o===0?i:RO(i)));if(n.constructor===Fn)return Gi(s)}return s[0]},cO=(t,e)=>aO(t,e,new Es),lO=t=>{const e=new Map,n=B(t.restDecoder);for(let r=0;r<n;r++){const s=B(t.restDecoder),i=B(t.restDecoder);e.set(s,i)}return e},Wd=t=>lO(new Dd(Dn(t))),Kd=(t,e)=>($(t.restEncoder,e.size),hn(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{$(t.restEncoder,n),$(t.restEncoder,r)}),t),uO=(t,e)=>Kd(t,$i(e.store)),hO=(t,e=new Bd)=>(t instanceof Map?Kd(e,t):uO(e,t),e.toUint8Array()),fO=t=>hO(t,new $d);class dO{constructor(){this.l=[]}}const jd=()=>new dO,Hd=(t,e)=>t.l.push(e),Vd=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(s=>e!==s),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Yd=(t,e,n)=>Xa(t.l,[e,n]);class mr{constructor(e,n){this.client=e,this.clock=n}}const Fi=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,j=(t,e)=>new mr(t,e),pO=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw kt()},Er=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!xd(e.ds,t.id),sc=(t,e)=>{const n=pn(t.meta,sc,lr),r=t.doc.store;n.has(e)||(e.sv.forEach((s,i)=>{s<Se(r,i)&&gn(t,j(i,s))}),Md(t,e.ds,s=>{}),n.add(e))};class zd{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const $i=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const s=n[n.length-1];e.set(r,s.id.clock+s.length)}),e},Se=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},qd=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw kt()}n.push(e)},xt=(t,e)=>{let n=0,r=t.length-1,s=t[r],i=s.id.clock;if(i===e)return r;let o=un(e/(i+s.length-1)*r);for(;n<=r;){if(s=t[o],i=s.id.clock,i<=e){if(e<i+s.length)return o;n=o+1}else r=o-1;o=un((n+r)/2)}throw kt()},ic=(t,e)=>{const n=t.clients.get(e.client);return n[xt(n,e.clock)]},oc=(t,e,n)=>{const r=xt(e,n),s=e[r];return s.id.clock<n&&s instanceof Ee?(e.splice(r+1,0,Qi(t,s,n-s.id.clock)),r+1):r},gn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[oc(t,n,e.clock)]},Xd=(t,e,n)=>{const r=e.clients.get(n.client),s=xt(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==st&&r.splice(s+1,0,Qi(t,i,n.clock-i.id.clock+1)),i},gO=(t,e,n)=>{const r=t.clients.get(e.id.client);r[xt(r,e.id.clock)]=n},Jd=(t,e,n,r,s)=>{if(r===0)return;const i=n+r;let o=oc(t,e,n),a;do a=e[o++],i<a.id.clock+a.length&&oc(t,e,i),s(a);while(o<e.length&&e[o].id.clock<i)};class mO{constructor(e,n,r){this.doc=e,this.deleteSet=new ms,this.beforeState=$i(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Qd=(t,e)=>e.deleteSet.clients.size===0&&!gN(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(tc(e.deleteSet),rO(t,e),dr(t,e.deleteSet),!0),Zd=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&pn(t.changed,e,lr).add(n)},Bi=(t,e)=>{let n=t[e],r=t[e-1],s=e;for(;s>0;n=r,r=t[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ee&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=e-s;return i&&t.splice(e+1-i,i),i},EO=(t,e,n)=>{for(const[r,s]of t.clients.entries()){const i=e.clients.get(r);for(let o=s.length-1;o>=0;o--){const a=s[o],c=a.clock+a.len;for(let l=xt(i,a.clock),u=i[l];l<i.length&&u.id.clock<c;u=i[++l]){const h=i[l];if(a.clock+a.len<=h.id.clock)break;h instanceof Ee&&h.deleted&&!h.keep&&n(h)&&h.gc(e,!1)}}}},_O=(t,e)=>{t.clients.forEach((n,r)=>{const s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],a=ud(s.length-1,1+xt(s,o.clock+o.len-1));for(let c=a,l=s[c];c>0&&l.id.clock>=o.clock;l=s[c])c-=1+Bi(s,c)}})},ep=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{tc(i),n.afterState=$i(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),Yd(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Xa(a,[]),n._needFormattingCleanup&&FO(n)}finally{r.gc&&EO(i,s,r.gcFilter),_O(i,s),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=s.clients.get(h),p=Pn(xt(f,d),1);for(let m=f.length-1;m>=p;)m-=1+Bi(f,m)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=s.clients.get(h),p=xt(f,d);p+1<f.length&&Bi(f,p+1)>1||p>0&&Bi(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(VN(bd,Id,"[yjs] ",Ld,Cd,"Changed the client-id because another client seems to be using it."),r.clientID=Pd()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Es;Qd(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Fn;Qd(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):ep(t,e+1)}}},Q=(t,e,n=null,r=!0)=>{const s=t._transactionCleanups;let i=!1,o=null;t._transaction===null&&(i=!0,t._transaction=new mO(t,n,r),s.push(t._transaction),s.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(i){const a=t._transaction===s[0];t._transaction=null,a&&ep(s,0)}}return o};function*yO(t){const e=B(t.restDecoder);for(let n=0;n<e;n++){const r=B(t.restDecoder),s=t.readClient();let i=B(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=B(t.restDecoder);yield new it(j(s,i),c),i+=c}else if(bi&a){const c=(a&(Jt|Xe))===0,l=new Ee(j(s,i),null,(a&Xe)===Xe?t.readLeftID():null,null,(a&Jt)===Jt?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&ls)===ls?t.readString():null,Ap(t,a));yield l,i+=l.length}else{const c=t.readLen();yield new st(j(s,i),c),i+=c}}}}class ac{constructor(e,n){this.gen=yO(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===it);return this.curr}}class cc{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const TO=t=>Gi(t,Fd,Es),SO=(t,e)=>{if(t.constructor===st){const{client:n,clock:r}=t.id;return new st(j(n,r+e),t.length-e)}else if(t.constructor===it){const{client:n,clock:r}=t.id;return new it(j(n,r+e),t.length-e)}else{const n=t,{client:r,clock:s}=n.id;return new Ee(j(r,s+e),null,j(r,s+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Gi=(t,e=gr,n=Fn)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(Dn(u)));let s=r.map(u=>new ac(u,!0)),i=null;const o=new n,a=new cc(o);for(;s=s.filter(d=>d.curr!==null),s.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===it?1:-1:p}else return f.curr.id.client-d.curr.id.client}),s.length!==0;){const u=s[0],h=u.curr.id.client;if(i!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)mn(a,i.struct,i.offset),i={struct:d,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===it)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{mn(a,i.struct,i.offset);const p=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new it(j(h,i.struct.id.clock+i.struct.length),p),offset:0}}else{const p=i.struct.id.clock+i.struct.length-d.id.clock;p>0&&(i.struct.constructor===it?i.struct.length-=p:d=SO(d,p)),i.struct.mergeWith(d)||(mn(a,i.struct,i.offset),i={struct:d,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==it;d=u.next())mn(a,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(mn(a,i.struct,i.offset),i=null),lc(a);const c=r.map(u=>nc(u)),l=XN(c);return dr(o,l),o.toUint8Array()},AO=(t,e,n=gr,r=Fn)=>{const s=Wd(e),i=new r,o=new cc(i),a=new n(Dn(t)),c=new ac(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=s.get(h)||0;if(c.curr.constructor===it){c.next();continue}if(u.id.clock+u.length>d)for(mn(o,u,Pn(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)mn(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}lc(o);const l=nc(a);return dr(i,l),i.toUint8Array()},tp=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:mt(t.encoder.restEncoder)}),t.encoder.restEncoder=dn(),t.written=0)},mn=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&tp(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),$(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},lc=t=>{tp(t);const e=t.encoder.restEncoder;$(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];$(e,r.written),Mi(e,r.restEncoder)}},wO=(t,e,n,r)=>{const s=new n(Dn(t)),i=new ac(s,!1),o=new r,a=new cc(o);for(let l=i.curr;l!==null;l=i.next())mn(a,e(l),0);lc(a);const c=nc(s);return dr(o,c),o.toUint8Array()},RO=t=>wO(t,CN,gr,Es),np="You must not compute changes after the event-handler fired.";class Wi{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=vO(this.currentTarget,this.target))}deletes(e){return xd(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw fn(np);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,a;if(this.adds(i)){let c=i.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(i))if(c!==null&&this.deletes(c))o="delete",a=Ba(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Ba(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=Ba(i.content.getContent());else return;e.set(s,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw fn(np);const n=this.target,r=lr(),s=lr(),i=[];if(e={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&i.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,s.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const vO=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}e=e._item.parent}return n},rp=80;let uc=0;class NO{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=uc++}}const OO=t=>{t.timestamp=uc++},sp=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=uc++},IO=(t,e,n)=>{if(t.length>=rp){const r=t.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return sp(r,e,n),r}else{const r=new NO(e,n);return t.push(r),r}},Ki=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((i,o)=>ki(e-i.index)<ki(e-o.index)?i:o);let r=t._start,s=0;for(n!==null&&(r=n.p,s=n.index,OO(n));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&ki(n.index-s)<r.parent.length/rp?(sp(n,r,s),n):IO(t._searchMarker,r,s)},_s=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const s=t[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){t.splice(r,1);continue}s.p=i,i.marker=!0}(e<s.index||n>0&&e===s.index)&&(s.index=Pn(e,s.index+n))}},ji=(t,e,n)=>{const r=t,s=e.changedParentTypes;for(;pn(s,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;Yd(r._eH,n,e)};class Re{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=jd(),this._dEH=jd(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw bt()}clone(){throw bt()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Hd(this._eH,e)}observeDeep(e){Hd(this._dEH,e)}unobserve(e){Vd(this._eH,e)}unobserveDeep(e){Vd(this._dEH,e)}toJSON(){}}const ip=(t,e,n)=>{e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const s=[];let i=t._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)s.push(o[a]),r--;e=0}}i=i.right}return s},op=t=>{const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}n=n.right}return e},ys=(t,e)=>{let n=0,r=t._start;for(;r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)e(s[i],n++,t)}r=r.right}},ap=(t,e)=>{const n=[];return ys(t,(r,s)=>{n.push(e(r,s,t))}),n},LO=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},cp=(t,e)=>{const n=Ki(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Hi=(t,e,n,r)=>{let s=n;const i=t.doc,o=i.clientID,a=i.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(s=new Ee(j(o,Se(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new Wn(l)),s.integrate(t,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:s=new Ee(j(o,Se(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new Ts(new Uint8Array(h))),s.integrate(t,0);break;case pr:s=new Ee(j(o,Se(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new As(h)),s.integrate(t,0);break;default:if(h instanceof Re)s=new Ee(j(o,Se(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new en(h)),s.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},lp=()=>fn("Length exceeded!"),up=(t,e,n,r)=>{if(n>e._length)throw lp();if(n===0)return e._searchMarker&&_s(e._searchMarker,n,r.length),Hi(t,e,null,r);const s=n,i=Ki(e,n);let o=e._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&gn(t,j(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&_s(e._searchMarker,s,r.length),Hi(t,e,o,r)},CO=(t,e,n)=>{let s=(e._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return Hi(t,e,s,n)},hp=(t,e,n,r)=>{if(r===0)return;const s=n,i=r,o=Ki(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&gn(t,j(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&gn(t,j(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw lp();e._searchMarker&&_s(e._searchMarker,s,-i+r)},Vi=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},hc=(t,e,n,r)=>{const s=e._map.get(n)||null,i=t.doc,o=i.clientID;let a;if(r==null)a=new Wn([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Wn([r]);break;case Uint8Array:a=new Ts(r);break;case pr:a=new As(r);break;default:if(r instanceof Re)a=new en(r);else throw new Error("Unexpected content type")}new Ee(j(o,Se(i.store,o)),s,s&&s.lastId,null,null,e,n,a).integrate(t,0)},fc=(t,e)=>{const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},fp=t=>{const e={};return t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},dp=(t,e)=>{const n=t._map.get(e);return n!==void 0&&!n.deleted},bO=(t,e)=>{const n={};return t._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&Er(i,e)&&(n[s]=i.content.getContent()[i.length-1])}),n},Yi=t=>zN(t.entries(),e=>!e[1].deleted);class kO extends Wi{constructor(e,n){super(e,n),this._transaction=n}}class _r extends Re{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new _r;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new _r}clone(){const e=new _r;return e.insert(0,this.toArray().map(n=>n instanceof Re?n.clone():n)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,n){super._callObserver(e,n),ji(this,e,new kO(this,e))}insert(e,n){this.doc!==null?Q(this.doc,r=>{up(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Q(this.doc,n=>{CO(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Q(this.doc,r=>{hp(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return cp(this,e)}toArray(){return op(this)}slice(e=0,n=this.length){return ip(this,e,n)}toJSON(){return this.map(e=>e instanceof Re?e.toJSON():e)}map(e){return ap(this,e)}forEach(e){ys(this,e)}[Symbol.iterator](){return LO(this)}_write(e){e.writeTypeRef(nI)}}const MO=t=>new _r;class xO extends Wi{constructor(e,n,r){super(e,n),this.keysChanged=r}}class yr extends Re{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new yr}clone(){const e=new yr;return this.forEach((n,r)=>{e.set(r,n instanceof Re?n.clone():n)}),e}_callObserver(e,n){ji(this,e,new xO(this,e,n))}toJSON(){const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];e[r]=s instanceof Re?s.toJSON():s}}),e}get size(){return[...Yi(this._map)].length}keys(){return Za(Yi(this._map),e=>e[0])}values(){return Za(Yi(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Za(Yi(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Q(this.doc,n=>{Vi(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Q(this.doc,r=>{hc(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return fc(this,e)}has(e){return dp(this,e)}clear(){this.doc!==null?Q(this.doc,e=>{this.forEach(function(n,r,s){Vi(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(rI)}}const UO=t=>new yr,En=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&LN(t,e);class dc{constructor(e,n,r,s){this.left=e,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&kt(),this.right.content.constructor){case me:this.right.deleted||Tr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const pp=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case me:e.right.deleted||Tr(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&gn(t,j(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},zi=(t,e,n,r)=>{const s=new Map,i=r?Ki(e,n):null;if(i){const o=new dc(i.p.left,i.p,i.index,s);return pp(t,o,n-i.index)}else{const o=new dc(null,e._start,0,s);return pp(t,o,n)}},gp=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===me&&En(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=t.doc,i=s.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Ee(j(i,Se(s.store,i)),c,c&&c.lastId,l,l&&l.id,e,null,new me(a,o));u.integrate(t,0),n.right=u,n.forward()})},Tr=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},mp=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===me&&En(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Ep=(t,e,n,r)=>{const s=t.doc,i=s.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!En(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new Ee(j(i,Se(s.store,i)),u,u&&u.lastId,h,h&&h.id,e,null,new me(a,c)),n.right.integrate(t,0),n.forward()}}return o},pc=(t,e,n,r,s)=>{n.currentAttributes.forEach((d,f)=>{s[f]===void 0&&(s[f]=null)});const i=t.doc,o=i.clientID;mp(n,s);const a=Ep(t,e,n,s),c=r.constructor===String?new Ut(r):r instanceof Re?new en(r):new Gn(r);let{left:l,right:u,index:h}=n;e._searchMarker&&_s(e._searchMarker,n.index,c.getLength()),u=new Ee(j(o,Se(i.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=h,n.forward(),gp(t,e,n,a)},_p=(t,e,n,r,s)=>{const i=t.doc,o=i.clientID;mp(n,s);const a=Ep(t,e,n,s);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===me));){if(!n.right.deleted)switch(n.right.content.constructor){case me:{const{key:c,value:l}=n.right.content,u=s[c];if(u!==void 0){if(En(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&gn(t,j(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Ee(j(o,Se(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Ut(c)),n.right.integrate(t,0),n.forward()}gp(t,e,n,a)},yp=(t,e,n,r,s)=>{let i=e;const o=Et();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===me){const l=i.content;o.set(l.key,l)}i=i.right}let a=0,c=!1;for(;e!==i;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case me:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(e.delete(t),a++,!c&&(s.get(u)??null)===h&&d!==h&&(d===null?s.delete(u):s.set(u,d))),!c&&!e.deleted&&Tr(s,l);break}}}e=e.right}return a},PO=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===me){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},DO=t=>{let e=0;return Q(t.doc,n=>{let r=t._start,s=t._start,i=Et();const o=qa(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case me:Tr(o,s.content);break;default:e+=yp(n,r,s,i,o),i=qa(o),r=s;break}s=s.right}}),e},FO=t=>{const e=new Set,n=t.doc;for(const[r,s]of t.afterState.entries()){const i=t.beforeState.get(r)||0;s!==i&&Jd(t,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===me&&o.constructor!==st&&e.add(o.parent)})}Q(n,r=>{Md(t,t.deleteSet,s=>{if(s instanceof st||!s.parent._hasFormatting||e.has(s.parent))return;const i=s.parent;s.content.constructor===me?e.add(i):PO(r,s)});for(const s of e)DO(s)})},Tp=(t,e,n)=>{const r=n,s=qa(e.currentAttributes),i=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case en:case Gn:case Ut:n<e.right.length&&gn(t,j(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}i&&yp(t,i,e.right,s,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&_s(o._searchMarker,e.index,-r+n),e};class $O extends Wi{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Q(e,r=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},s.size>0&&(f.attributes={},s.forEach((p,m)=>{p!==null&&(f.attributes[m]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},NN(c)||(f.attributes=wN({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case en:case Gn:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Ut:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case me:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=s.get(f)??null;En(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),En(p,i.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){i.set(f,p);const m=s.get(f)??null;En(m,p)||(a==="retain"&&d(),c[f]=m)}else if(!o.deleted){i.set(f,p);const m=c[f];m!==void 0&&(En(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),Tr(s,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class $n extends Re{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new $n}clone(){const e=new $n;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new $O(this,e,n);ji(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Ut&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Q(this.doc,r=>{const s=new dc(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const o=e[i];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&i===e.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&pc(r,this,s,a,o.attributes||{})}else o.retain!==void 0?_p(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Tp(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){const s=[],i=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;i.forEach((p,m)=>{d=!0,h[m]=p});const f={insert:a};d&&(f.attributes=h),s.push(f),a=""}}const u=()=>{for(;c!==null;){if(Er(c,e)||n!==void 0&&Er(c,n))switch(c.content.constructor){case Ut:{const h=i.get("ychange");e!==void 0&&!Er(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),i.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Er(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),i.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),i.delete("ychange")),a+=c.content.str;break}case en:case Gn:{l();const h={insert:c.content.getContent()[0]};if(i.size>0){const d={};h.attributes=d,i.forEach((f,p)=>{d[p]=f})}s.push(h);break}case me:Er(c,e)&&(l(),Tr(i,c.content));break}c=c.right}l()};return e||n?Q(o,h=>{e&&sc(h,e),n&&sc(h,n),u()},"cleanup"):u(),s}insert(e,n,r){if(n.length<=0)return;const s=this.doc;s!==null?Q(s,i=>{const o=zi(i,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),pc(i,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const s=this.doc;s!==null?Q(s,i=>{const o=zi(i,this,e,!r);pc(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Q(r,s=>{Tp(s,zi(s,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const s=this.doc;s!==null?Q(s,i=>{const o=zi(i,this,e,!1);o.right!==null&&_p(i,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Q(this.doc,n=>{Vi(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Q(this.doc,r=>{hc(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return fc(this,e)}getAttributes(){return fp(this)}_write(e){e.writeTypeRef(sI)}}const BO=t=>new $n;class gc{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===Sr||n.constructor===Bn)&&n._start!==null)e=n._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Bn extends Re{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Bn}clone(){const e=new Bn;return e.insert(0,this.toArray().map(n=>n instanceof Re?n.clone():n)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new gc(this,e)}querySelector(e){e=e.toUpperCase();const r=new gc(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),hn(new gc(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){ji(this,e,new KO(this,n,e))}toString(){return ap(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),ys(this,i=>{s.insertBefore(i.toDOM(e,n,r),null)}),s}insert(e,n){this.doc!==null?Q(this.doc,r=>{up(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Q(this.doc,r=>{const s=e&&e instanceof Re?e._item:e;Hi(r,this,s,n)});else{const r=this._prelimContent,s=e===null?0:r.findIndex(i=>i===e)+1;if(s===0&&e!==null)throw fn("Reference item not found");r.splice(s,0,...n)}}delete(e,n=1){this.doc!==null?Q(this.doc,r=>{hp(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return op(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return cp(this,e)}slice(e=0,n=this.length){return ip(this,e,n)}forEach(e){ys(this,e)}_write(e){e.writeTypeRef(oI)}}const GO=t=>new Bn;class Sr extends Bn{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new Sr(this.nodeName)}clone(){const e=new Sr(this.nodeName),n=this.getAttributes();return vN(n,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof Re?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?Q(this.doc,n=>{Vi(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Q(this.doc,r=>{hc(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return fc(this,e)}hasAttribute(e){return dp(this,e)}getAttributes(e){return e?bO(this,e):fp(this)}toDOM(e=document,n={},r){const s=e.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return ys(this,o=>{s.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(iI),e.writeKey(this.nodeName)}}const WO=t=>new Sr(t.readKey());class KO extends Wi{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class qi extends yr{constructor(e){super(),this.hookName=e}_copy(){return new qi(this.hookName)}clone(){const e=new qi(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const s=n[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(aI),e.writeKey(this.hookName)}}const jO=t=>new qi(t.readKey());class Xi extends $n{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Xi}clone(){const e=new Xi;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const s=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{const n=[];for(const s in e.attributes){const i=[];for(const o in e.attributes[s])i.push({key:o,value:e.attributes[s][o]});i.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const i=n[s];r+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const a=i.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(cI)}}const HO=t=>new Xi;class mc{constructor(e,n){this.id=e,this.length=n}get deleted(){throw bt()}mergeWith(e){return!1}write(e,n,r){throw bt()}integrate(e,n){throw bt()}}const VO=0;class st extends mc{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),qd(e.doc.store,this)}write(e,n){e.writeInfo(VO),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Ts{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ts(this.content)}splice(e){throw bt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const YO=t=>new Ts(t.readBuf());class Ss{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ss(this.len)}splice(e){const n=new Ss(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){Di(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const zO=t=>new Ss(t.readLen()),Sp=(t,e)=>new pr({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class As{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new As(Sp(this.doc.guid,this.opts))}splice(e){throw bt()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const qO=t=>new As(Sp(t.readString(),t.readAny()));class Gn{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Gn(this.embed)}splice(e){throw bt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const XO=t=>new Gn(t.readJSON());class me{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new me(this.key,this.value)}splice(e){throw bt()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const JO=t=>new me(t.readKey(),t.readJSON());class Ji{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ji(this.arr)}splice(e){const n=new Ji(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];e.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const QO=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const s=t.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new Ji(n)};class Wn{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Wn(this.arr)}splice(e){const n=new Wn(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];e.writeAny(i)}}getRef(){return 8}}const ZO=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Wn(n)};class Ut{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ut(this.str)}splice(e){const n=new Ut(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const eI=t=>new Ut(t.readString()),tI=[MO,UO,BO,WO,GO,jO,HO],nI=0,rI=1,sI=2,iI=3,oI=4,aI=5,cI=6;class en{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new en(this.type._copy())}splice(e){throw bt()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const lI=t=>new en(tI[t.readTypeRef()](t)),Qi=(t,e,n)=>{const{client:r,clock:s}=e.id,i=new Ee(j(r,s+n),e,j(r,s+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=j(e.redone.client,e.redone.clock+n)),e.right=i,i.right!==null&&(i.right.left=i),t._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=n,i};class Ee extends mc{constructor(e,n,r,s,i,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?ld:0}set marker(e){(this.info&Fa)>0!==e&&(this.info^=Fa)}get marker(){return(this.info&Fa)>0}get keep(){return(this.info&cd)>0}set keep(e){this.keep!==e&&(this.info^=cd)}get countable(){return(this.info&ld)>0}get deleted(){return(this.info&Da)>0}set deleted(e){this.deleted!==e&&(this.info^=Da)}markDeleted(){this.info|=Da}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Se(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Se(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===mr&&this.id.client!==this.parent.client&&this.parent.clock>=Se(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Xd(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=gn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===st||this.right&&this.right.constructor===st)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ee&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Ee&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===mr){const r=ic(n,this.parent);r.constructor===st?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=Xd(e,e.doc.store,j(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),Fi(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(Fi(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(ic(e.doc.store,s.origin)))i.has(ic(e.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),qd(e.doc.store,this),this.content.integrate(e,this),Zd(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new st(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:j(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Fi(e.origin,this.lastId)&&this.right===e&&Fi(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Di(e.deleteSet,this.id.client,this.id.clock,this.length),Zd(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw kt();this.content.gc(e),n?gO(e,this,new st(this.id,this.length)):this.content=new Ss(this.length)}write(e,n){const r=n>0?j(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&bi|(r===null?0:Xe)|(s===null?0:Jt)|(i===null?0:ls);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=pO(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===mr?(e.writeParentInfo(!1),e.writeLeftID(a)):kt();i!==null&&e.writeString(i)}this.content.write(e,n)}}const Ap=(t,e)=>uI[e&bi](t),uI=[()=>{kt()},zO,QO,YO,eI,XO,JO,lI,ZO,qO,()=>{kt()}],hI=10;class it extends mc{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){kt()}write(e,n){e.writeInfo(hI),$(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const wp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Rp="__ $YJS$ __";wp[Rp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),wp[Rp]=!0;const Ec=0,vp=1,Np=2,fI=(t,e)=>{$(t,Ec);const n=fO(e);Le(t,n)},Op=(t,e,n)=>{$(t,vp),Le(t,cO(e,n))},dI=(t,e,n)=>Op(e,n,Pe(t)),Ip=(t,e,n)=>{try{iO(e,Pe(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},pI=(t,e)=>{$(t,Np),Le(t,e)},gI=Ip,mI=(t,e,n,r)=>{const s=B(t);switch(s){case Ec:dI(t,e,n);break;case vp:Ip(t,n,r);break;case Np:gI(t,n,r);break;default:throw new Error("Unknown message type")}return s},Ar={},_c={},yc={},ws={},Pt=vr("shared",["second"],t=>{switch(t.target){case"second":Object.keys(yc).forEach(e=>{const n=ws[e];n===void 0?Pt.emit("shared:join",e):n<10?ws[e]=n+1:delete ws[e]}),Object.keys(_c).forEach(e=>{Pt.emit("shared:active",e)});break;case"join":{const e=t.data,n=Ar[e];if(n&&_c[e]){Pt.reply(t,"joinack",e);const r=dn();fI(r,n),Pt.reply(t,"sync",eo(e,r));const s=dn();Op(s,n),Pt.reply(t,"sync",eo(e,s))}break}case"joinack":{const e=t.data;Ar[e]&&yc[e]&&(ws[e]=0);break}case"active":{const e=t.data;Ar[e]&&yc[e]&&(ws[e]=0);break}case"sync":{const[e,n,r]=t.data,s=Ar[n];if(s&&e!==Pt.id()){const i=Dn(r),o=dn();if(mI(i,o,s,Pt)===Ec){const c=eo(n,o);Pt.emit("shared:sync",c)}}break}}});function EI(t){let e=Ar[t];if(e)return e;Ar[t]=e=new pr({guid:t});function n(r){const s=dn();pI(s,r),Pt.emit("shared:sync",eo(t,s))}return e.on("update",n),e.on("destroy",()=>{e==null||e.off("update",n)}),e}function Zi(t){return EI(t).getMap()}function eo(t,e){const n=mt(e);return[Pt.id()??"",t,n]}function Lp(t,e){const n=t.get(e);return n!=null&&n.toJSON?n.toJSON():n}function Cp(t,e,n){typeof n=="string"?t.set(e,new $n(n)):t.set(e,n)}function _I(t,e,n){console.info({guid:t,key:e,value:n}),_c[t]=!0;const r=Zi(t);r.get(e)===void 0&&n!==void 0&&Cp(r,e,n)}function yI(t,e,n){const r=Zi(t),s=Lp(r,e);(s===void 0||n!==s)&&Cp(r,e,n)}function TI(t,e,n){const r=Zi(t);function s(){n(Lp(r,e))}function i(o){o.keysChanged.has(e)&&s()}return s(),r.observe(i),()=>{r.unobserve(i)}}function SI(t,e,n){const r=Zi(t);let s=r.get(e);function i(){n(s)}function o(c){c.keysChanged.has(e)&&s===void 0&&a(),s&&r.unobserve(o)}function a(){s=r.get(e),s?(s.observeDeep(i),i()):r.observe(o)}return a(),()=>{s?s.unobserveDeep(i):r.unobserve(o)}}const _n={};function bp(t,e){return t.player=e,t.layers=[],t.layout=[],t.layoutreset=!0,t.layoutfocus="scroll",t}function kp(t){t.text=[],Object.values(_n[t.id]??{}).forEach(e=>e==null?void 0:e()),_n[t.id]={}}function Mp(t){const e=t.layout.find(n=>n.name===t.layoutfocus);if(!e){const n={id:Ft(),name:t.layoutfocus,edge:Qe.RIGHT,size:20,text:[]};return t.layout.push(n),t.layoutreset=!1,n}return e}const Tc={},AI=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),wI=new Set(["rn","range","sl","select","nm","number","tx","text"]),RI=new Set(["tx","text"]),vI={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""};function Kn(t){let e=Tc[t];return P(e)?e:Tc[t]=e=bp({},t)}function NI(){return Object.keys(Tc)}function OI(t){const e=Kn(t);e.layout=e.layout.filter(n=>n.edge!==Qe.SCROLL)}function II(t,e,n){Object.values(_n).forEach(r=>{r[e]!==void 0&&yI(t.id(),e,n)})}function LI(t){const e=Kn(t.id());e.layout=e.layout.filter(n=>n.edge!==Qe.SCROLL||n.text.length>0)}function Sc(t,e,n,r,s){const i=Kn(t.id()),o=r,a=s||Kv.capital(e),c=i.layout.find(l=>l.name===a);if(c)i.layoutreset=!0,i.layoutfocus=a,Ke(o)&&(c.size=o);else switch(n){case Qe.START:bp(i,t.id());break;case Qe.LEFT:case Qe.RIGHT:case Qe.TOP:case Qe.BOTTOM:case Qe.SCROLL:const l={id:Ft(),name:a,edge:n,size:o??gg[n],text:[]};i.layout.push(l),i.layoutfocus=a;break}}function CI(t,e){const n=Kn(t.id()),r=Mp(n);n.layoutreset&&(n.layoutreset=!1,kp(r)),r.text.push(e)}function bI(t,e,n,r){const s=Kn(t.id()),i=Mp(s);s.layoutreset&&(s.layoutreset=!1,kp(i));const o=n.toLowerCase(),a=[t.id(),e,...AI.has(o)?[o]:["hypertext",n],...r],c=a[2];if(wI.has(c)){const l=`${a[3]??""}`;_n[i.id]=_n[i.id]??{};const u=t.get(l);_n[i.id][l]===void 0&&(_I(t.id(),l,u??vI[c]),RI.has(c)?_n[i.id][l]=SI(t.id(),l,h=>{if(h!==void 0){const d=h.toJSON();d!==t.get(l)&&t.set(l,d)}}):_n[i.id][l]=TI(t.id(),l,h=>{h!==void 0&&h!==t.get(l)&&t.set(l,h)}))}i.text.push(a)}const kI=od({get(){return[!1,void 0]},set(t,e,n){return II(t,e,n),[!1,void 0]},shouldtick(){},tick(t){var r,s;const e=X(t.id()),n=((r=e.target)==null?void 0:r.name)??((s=e.target)==null?void 0:s.kind)??"Scroll";Sc(t,"scroll",Qe.SCROLL,void 0,n)},tock(t){LI(t)}}).command("color",(t,e)=>{const n=X(t.id()),[r]=O({...n,chip:t,words:e},0,[N.COLOR]);return L(n.target)&&L(r)&&Na(n.target,r),0}).command("gadget",(t,e)=>{const r={...X(t.id()),chip:t,words:e},[s]=O(r,0,[N.STRING]),i=pg[s.toLowerCase()];if(i===Qe.SCROLL){const[,o,a]=O(r,0,[N.STRING,N.MAYBE_STRING,N.MAYBE_NUMBER]);Sc(t,s,i,a,o)}else{const[,o,a]=O(r,0,[N.STRING,N.MAYBE_NUMBER,N.MAYBE_STRING]);Sc(t,s,i,o,a)}return 0}).command("book",(t,e)=>{const n=X(t.id()),[r,s]=O({...n,chip:t,words:e},0,[N.STRING,N.STRING]),i=r.toLowerCase(),o=s.toLowerCase();switch(o){case"create":lf(qh(i,[It("@board title",{board:nf(a=>a)}),It("@terrain dirt",{terrain:{char:176,bg:ee.BLACK,color:ee.DKYELLOW,collision:ye.WALK}}),It("@terrain dirt2",{terrain:{char:176,bg:ee.BLACK,color:ee.DKGRAY,collision:ye.WALK}}),It("@terrain wall",{terrain:{char:177,bg:ee.DKGREEN,color:ee.GREEN,collision:ye.SOLID}}),It("@terrain wall2",{terrain:{char:176,bg:ee.DKGREEN,color:ee.GREEN,collision:ye.SOLID}})]));break;default:console.info("book",{ltarget:i,laction:o});break}return 0}).command("frame",(t,e)=>{var c;const n=X(t.id()),[r,s,i]=O({...n,chip:t,words:e},0,[N.STRING,N.MAYBE_STRING,N.MAYBE_STRING]),o=((c=n.board)==null?void 0:c.id)??"",a=r.toLowerCase();if(a==="reset")cf(o);else if(L(s)&&L(i)){const l=s.toLowerCase();switch(l){case"edit":PR(o,a,i);break;case"view":UR(o,a,i);break;default:console.info("frame",{ltype:l,ltarget:a,maybeboard:i});break}}return 0});function MI(t,e,n,r){if(!t||!e)return;const[s,i]=r,o=Xh(t,s);L(o)&&(NR(e,n.x,n.y,s),Na(RR(e,n.x,n.y),i));const a=va(t,r[0]);L(a)&&L(a.name)&&(OR(e,n.x,n.y,a),Na(a,i))}const xp=new Set(["cycle","player","sender","inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu","data"]),xI=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]);function UI(t){const e=df[t];if(L(e))return e;const n=Ef[t];if(L(n))return n;const r=yf[t];if(L(r))return r;const s=Nf[t];if(L(s))return s}const PI=["NORTH","SOUTH","WEST","EAST"];function DI(t){const e=X(t.id??"");if(e.inputcurrent!==void 0)return;const[n=fe.NONE]=e.inputqueue;t.stats===void 0&&(t.stats={}),t.stats.inputmove=[],t.stats.inputok=0,t.stats.inputcancel=0,t.stats.inputmenu=0;const r=e.inputmods[n];switch(t.stats.inputalt=r&mg?1:0,t.stats.inputctrl=r&Eg?1:0,t.stats.inputshift=r&_g?1:0,n){case fe.MOVE_UP:case fe.MOVE_DOWN:case fe.MOVE_LEFT:case fe.MOVE_RIGHT:t.stats.inputmove=[PI[n-fe.MOVE_UP]];break;case fe.OK_BUTTON:t.stats.inputok=1;break;case fe.CANCEL_BUTTON:t.stats.inputcancel=1;break;case fe.MENU_BUTTON:t.stats.inputmenu=1;break}e.inputcurrent=n,e.inputqueue.delete(n)}const FI={zzt:od({get(t,e){var o;const n=UI(e);if(L(n))return[!0,n];const r=X(t.id());if(r.target){xI.has(e)&&DI(r.target);const a=(o=r.target.stats)==null?void 0:o[e];if(L(a)||xp.has(e))return[!0,a]}const s=r.board?Oa(r.board,r.target):void 0,i=yR(r.book,(s==null?void 0:s.id)??"",e);return[L(i),i]},set(t,e,n){var i,o;const r=X(t.id());if(L(r.target)&&(L((o=(i=r.target)==null?void 0:i.stats)==null?void 0:o[e])||xp.has(e)))return r.target.stats||(r.target.stats={}),r.target.stats[e]=n,[!0,n];const s=r.board?Oa(r.board,r.target):void 0;return TR(r.book,(s==null?void 0:s.id)??"",e,n),[!0,n]},shouldtick(t){var n,r,s,i;const e=X(t.id());if((r=(n=e.target)==null?void 0:n.stats)!=null&&r.stepx||(i=(s=e.target)==null?void 0:s.stats)!=null&&i.stepy){const o={x:(e.target.x??0)+(e.target.stats.stepx??0),y:(e.target.y??0)+(e.target.stats.stepy??0)};sf(e.book,e.board,e.target,o)}},tick(){},tock(){}}).command("become",(t,e)=>(console.info(e),0)).command("bind",(t,e)=>(console.info(e),0)).command("change",(t,e)=>{const n=X(t.id()),[r,s]=O({...n,chip:t,words:e},0,[N.KIND,N.KIND]);return console.info({target:r,into:s}),0}).command("char",(t,e)=>{const n=X(t.id()),[r]=O({...n,chip:t,words:e},0,[N.NUMBER]);return L(n.target)&&(n.target.char=r),0}).command("clear",(t,e)=>{const n=Xt(e[0]);return t.set(n,void 0),0}).command("cycle",(t,e)=>{const n=X(t.id()),[r]=O({...n,chip:t,words:e},0,[N.NUMBER]);return t.cycle(so(Math.round(r),1,255)),0}).command("die",t=>(t.endofprogram(),0)).command("end",t=>(t.endofprogram(),0)).command("endgame",t=>(t.set("health",0),0)).command("give",(t,e)=>{const n=X(t.id()),[r,s,i]=O({...n,chip:t,words:e},0,[N.STRING,N.MAYBE_NUMBER]),o=t.get(r),a=Ke(o)?o:0,c=s??1;if(!Ke(c))return 0;const l=o===void 0?1:0;return l&&i<e.length&&t.command(...e.slice(i)),t.set(r,a+c),l}).command("go",(t,e)=>{var l,u,h,d;const n=X(t.id()),r=(l=n.target)==null?void 0:l.x,s=(u=n.target)==null?void 0:u.y;let i=0,o=1;const[a,c]=Oe({...n,chip:t,words:e},0);for(Ke(a)&&(i=c,o=so(Math.round(a),1,1024));o>0;){const[f]=O({...n,chip:t,words:e},i,[N.DIR]);if(sf(n.book,n.board,n.target,f))--o;else break}return((h=n.target)==null?void 0:h.x)===r&&((d=n.target)==null?void 0:d.y)===s?1:0}).command("idle",t=>(t.yield(),0)).command("lock",t=>(t.lock(t.id()),0)).command("play",(t,e)=>(console.info(e),0)).command("put",(t,e)=>{var i;const n=X(t.id()),[r,s]=O({...n,chip:t,words:e},0,[N.DIR,N.KIND]);switch(r.frame){case"edit":{const o=_i(((i=n.board)==null?void 0:i.id)??"").find(l=>l.type===ts.EDIT),a=ns((o==null?void 0:o.book)??"")??n.book,c=sr(a,(o==null?void 0:o.board)??"");MI(a,c,r,s);break}}return 0}).command("restore",(t,e)=>(t.restore(Xt(e[0])),0)).command("send",(t,e)=>{const n=X(t.id()),[r,s]=O({...n,chip:t,words:e},0,[N.STRING,N.ANY]);return t.send(r,s),0}).command("set",(t,e)=>{const n=X(t.id()),[r,s]=O({...n,chip:t,words:e},0,[N.STRING,N.ANY]);return t.set(r,s),0}).command("shoot",(t,e)=>{const n=X(t.id());return O({...n,chip:t,words:e},0,[N.DIR,N.MAYBE_KIND]),0}).command("take",(t,e)=>{const n=X(t.id()),[r,s,i]=O({...n,chip:t,words:e},0,[N.STRING,N.MAYBE_NUMBER]),o=t.get(r),a=s??1;if(!Ke(o))return 1;const c=o-a;return c<0?(i<e.length&&t.command(...e.slice(i)),1):(t.set(r,c),0)}).command("throwstar",(t,e)=>{const n=X(t.id());return O({...n,chip:t,words:e},0,[N.DIR,N.MAYBE_KIND]),0}).command("try",(t,e)=>{const n=X(t.id()),[,r]=O({...n,chip:t,words:e},0,[N.DIR]);return t.command("go",...e.slice(0,r))&&r<e.length&&t.command(...e.slice(r)),t.yield(),0}).command("unlock",t=>(t.unlock(),0)).command("walk",(t,e)=>{var s;const n=X(t.id()),[r]=O({...n,chip:t,words:e},0,[N.DIR]);return L((s=n.target)==null?void 0:s.stats)&&(n.target.stats.stepx=r.x-(n.target.x??0),n.target.stats.stepy=r.y-(n.target.y??0)),0}).command("zap",(t,e)=>(t.zap(Xt(e[0])),0)).command("stat",(t,e)=>{const n=X(t.id());return n.target&&(n.target.name=e.map(Xt).join(" ")),0}).command("text",(t,e)=>{const n=e.map(Xt).join("");return CI(t,n),0}).command("hyperlink",(t,e)=>{const[n,r,...s]=e,i=Xt(n),o=Xt(r);return bI(t,i,o,s),0}),zss:kI};function $I(t){Object.values(FI).forEach(e=>{t.install(e)})}function Ac(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset||0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];Array.isArray(r)?r.forEach(s=>{e.push(Ac(s))}):e.push(Ac(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)||0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)||0))},t.range}function BI(t){const e=Aa(`${t}
`);if(e.errors.length>0)return{errors:e.errors,tokens:[]};cs.input=e.tokens;const n=cs.program();if(cs.errors.length>0)return{tokens:e.tokens,errors:cs.errors};const r=kv.visit(n);return r?(Ac(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:["no ast output"]}}const wc=Object.getPrototypeOf(function*(){}).constructor;function GI(t){const e=BI(t);if(e.errors&&e.errors.length>0)return e;if(!e.ast)return{...e,errors:["no ast output"]};const n=Fv(e.ast);if(n.code){uR&&console.info(n.code);try{return{...e,...n,source:n.code,code:new wc("api",n.code)}}catch(r){return{errors:[{message:r.message}],source:"there was an error",code:new wc("api"," ")}}}return{...e,...n,source:"there was an error",code:new wc("api"," ")}}function WI(){const t={},e={};function n(s){const i=t[s];if(i)return i;const o=GI(s);return t[s]=o,o}return{ids(){return Object.keys(e)},has(s){return P(e[s])},halt(s){const i=e[s];return i&&delete e[s],!!i},tick(s,i){var a;let o=e[s];if(!P(e[s])){const c=n(i);if((a=c.errors)!=null&&a.length)return console.error(c.errors),console.info(c.tokens),e[s]=null,!1;o=e[s]=Gv(s,c),$I(o)}return!!(o!=null&&o.tick())},message(s){const{target:i,path:o}=bc(s.target),a=e[i];L(a)&&a.message({...s,target:o})}}}const KI=Cc(ro.numbers,4),jI=Cc(`${ro.numbers}${ro.lowercase}`,16),Up=`pid_${KI()}_${jI()}`;xR(Up);const Pp=WI(),HI=32*15,wr={},VI=vr("vm",["login","tick","tock"],t=>{switch(t.target){case"login":t.player&&(wr[t.player]=0,DR(t.player));break;case"tick":$R(Pp);break;case"tock":Object.keys(wr).forEach(e=>{++wr[e],wr[e]>HI&&(delete wr[e],FR(e))});break;case"doot":t.player&&(wr[t.player]=0);break;case"input":if(t.player){const e=X(t.player),[n=fe.NONE,r=0]=t.data??{};e.inputqueue.add(n),e.inputmods[n]=r}break;default:Pp.message(t);break}});function YI(){lf(Ai),VI.emit("ready",void 0,Up)}const Rc=40,Dp=Math.round(1e3/Rc),vc=vr("clock",[],()=>{});let Nc=0,Fp=performance.now(),Oc=0;function zI(){vc.emit("tick"),vc.emit("tock"),++Oc,Oc>=Dp&&(Oc%=Dp,vc.emit("second"))}function $p(){const t=performance.now(),e=t-Fp;Nc+=e,Nc>=Rc&&(Nc%=Rc,zI()),Fp=t,setTimeout($p)}$p();const Bp={},Gp=vr("gadgetserver",["tock"],t=>{switch(t.target){case"tock":NI().forEach(e=>{const n=Kn(e);n.layers=GR(e);const r=po(Bp[e]??{},n);r.length&&(Bp[e]=ke(n),Gp.emit("gadgetclient:patch",r,e))});break;case"desync":if(t.player){const e=Kn(t.player);Gp.emit("gadgetclient:reset",e,t.player)}break;case"clearscroll":t.player&&OI(t.player);break}}),qI=eg(t=>postMessage(t));onmessage=function(e){qI(e.data)},queueMicrotask(YI)})();
